# TG-Matrix Backend Dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£ç³»çµ±ä¾è³´
RUN apt-get update && apt-get install -y \
    gcc \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# è¤‡è£½ä¾è³´æ–‡ä»¶
COPY requirements.txt .

# å®‰è£ Python ä¾è³´
RUN pip install --no-cache-dir -r requirements.txt

# è¤‡è£½æ‡‰ç”¨ä»£ç¢¼
COPY . .

# å‰µå»ºå¿…è¦ç›®éŒ„
RUN mkdir -p /app/sessions /app/logs /app/data

# ğŸ”§ ä¿®å¾©ï¼šç¦ç”¨ Python è¼¸å‡ºç·©è¡ï¼Œç¢ºä¿ Docker logs èƒ½å³æ™‚çœ‹åˆ° stderr æ—¥èªŒ
ENV PYTHONUNBUFFERED=1

# æš´éœ²ç«¯å£
EXPOSE 8000

# å•Ÿå‹•å‘½ä»¤ - ä½¿ç”¨ Web æœå‹™å™¨æ¨¡å¼
CMD ["python", "-u", "web_server.py"]
