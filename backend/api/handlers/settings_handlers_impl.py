"""
Extracted handler implementations: settings
Auto-generated by refactor_main.py
"""
import json
import sys
import time
import asyncio
import traceback
from datetime import datetime, timedelta
from typing import Any, Dict, List, Optional

from service_context import get_service_context
from database import db

# All handlers receive (self, payload) where self is BackendService instance.
# They are called via: await handler_impl(self, payload)
# Inside, use self.db, self.send_event(), self.telegram_manager, etc.
# This is a transitional pattern - later, replace self.xxx with ctx.xxx


async def handle_save_settings(self, payload: Dict[str, Any]):
    """Handle save-settings command"""
    try:
        settings = payload.get('settings', {})
        for key, value in settings.items():
            await db.set_setting(key, value)
        
        await db.add_log("Settings saved", "success")
        self.send_log("Settings saved successfully", "success")
        
        # Send updated settings
        all_settings = await db.get_all_settings()
        self.send_event("settings-updated", all_settings)
    
    except Exception as e:
        self.send_log(f"Error saving settings: {str(e)}", "error")


async def handle_get_settings(self):
    """Handle get-settings command"""
    try:
        settings = await db.get_all_settings()
        self.send_event("settings-loaded", settings)
    
    except Exception as e:
        self.send_log(f"Error loading settings: {str(e)}", "error")

