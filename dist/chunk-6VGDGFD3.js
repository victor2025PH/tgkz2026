import{a as A}from"./chunk-24SFQVZB.js";import{e as V,g as O,h as B,j as S}from"./chunk-FF535MQ4.js";import{t as I}from"./chunk-BCTLVZY2.js";import{b as T}from"./chunk-6FHZTSI7.js";import{o as P}from"./chunk-35776WZA.js";import{$a as w,La as E,Mb as D,O as f,T as u,U as m,Ya as C,Za as y,ab as M,bb as k,cb as x,da as p,db as o,eb as r,fb as h,jb as v,nb as g,pb as l,xa as d,xb as a,yb as F,zb as b}from"./chunk-MB4RORS3.js";var N=()=>[0,1,2,3,4,5];function j(n,t){n&1&&(o(0,"div",1),h(1,"div",5),o(2,"h2"),a(3,"\u6B63\u5728\u9A57\u8B49..."),r(),o(4,"p"),a(5,"\u8ACB\u7A0D\u5019"),r()())}function z(n,t){n&1&&(o(0,"div",2)(1,"div",6),a(2,"\u2705"),r(),o(3,"h2"),a(4,"\u9A57\u8B49\u6210\u529F\uFF01"),r(),o(5,"p"),a(6,"\u60A8\u7684\u90F5\u7BB1\u5DF2\u6210\u529F\u9A57\u8B49\uFF0C\u73FE\u5728\u53EF\u4EE5\u4F7F\u7528\u6240\u6709\u529F\u80FD\u4E86"),r(),o(7,"button",7),a(8,"\u958B\u59CB\u4F7F\u7528"),r()())}function H(n,t){if(n&1){let e=v();o(0,"div",3)(1,"div",8),a(2,"\u274C"),r(),o(3,"h2"),a(4,"\u9A57\u8B49\u5931\u6557"),r(),o(5,"p"),a(6),r(),o(7,"div",9)(8,"button",10),g("click",function(){u(e);let s=l();return m(s.resendEmail())}),a(9,"\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u90F5\u4EF6"),r(),o(10,"a",11),a(11,"\u8FD4\u56DE\u767B\u5165"),r()()()}if(n&2){let e=l();d(6),F(e.error())}}function R(n,t){if(n&1){let e=v();o(0,"input",17),g("input",function(s){let c=u(e).$implicit,_=l(2);return m(_.onCodeInput(s,c))})("keydown",function(s){let c=u(e).$implicit,_=l(2);return m(_.onKeyDown(s,c))})("paste",function(s){u(e);let c=l(2);return m(c.onPaste(s))}),r()}if(n&2){let e=t.$implicit,i=l(2);x("value",i.codeDigits()[e]||"")("disabled",i.isLoading())}}function K(n,t){n&1&&(h(0,"span",18),o(1,"span"),a(2,"\u9A57\u8B49\u4E2D..."),r())}function $(n,t){n&1&&a(0," \u9A57\u8B49 ")}function q(n,t){if(n&1&&a(0),n&2){let e=l(2);b(" ",e.resendCooldown(),"s \u5F8C\u91CD\u65B0\u767C\u9001 ")}}function Y(n,t){n&1&&a(0," \u91CD\u65B0\u767C\u9001 ")}function G(n,t){if(n&1){let e=v();o(0,"div",4)(1,"h2"),a(2,"\u9A57\u8B49\u60A8\u7684\u90F5\u7BB1"),r(),o(3,"p"),a(4),r(),o(5,"div",12),M(6,R,1,2,"input",13,w),r(),o(8,"button",14),g("click",function(){u(e);let s=l();return m(s.verifyByCode())}),C(9,K,3,0)(10,$,1,0),r(),o(11,"p",15),a(12," \u6C92\u6709\u6536\u5230\u90F5\u4EF6\uFF1F "),o(13,"button",16),g("click",function(){u(e);let s=l();return m(s.resendEmail())}),C(14,q,1,1)(15,Y,1,0),r()()()}if(n&2){let e=l();d(4),b("\u8ACB\u8F38\u5165\u767C\u9001\u5230 ",e.email," \u7684 6 \u4F4D\u9A57\u8B49\u78BC"),d(2),k(D(5,N)),d(2),x("disabled",e.isLoading()||e.code.length<6),d(),y(e.isLoading()?9:10),d(4),x("disabled",e.resendCooldown()>0),d(),y(e.resendCooldown()>0?14:15)}}var L=class n{constructor(){this.authService=f(A);this.router=f(O);this.route=f(V);this.i18n=f(T);this.email="";this.code="";this.codeDigits=p(["","","","","",""]);this.verifying=p(!1);this.isLoading=p(!1);this.success=p(!1);this.error=p(null);this.resendCooldown=p(0)}ngOnInit(){let t=this.route.snapshot.queryParams.token;this.email=this.route.snapshot.queryParams.email||"",t&&this.verifyByToken(t)}async verifyByToken(t){this.verifying.set(!0),this.error.set(null);try{let e=await this.authService.verifyEmail(t);e.success?this.success.set(!0):this.error.set(e.error||"\u9A57\u8B49\u5931\u6557")}catch(e){this.error.set(e.message||"\u9A57\u8B49\u5931\u6557")}finally{this.verifying.set(!1)}}async verifyByCode(){if(!(this.code.length<6)){this.isLoading.set(!0),this.error.set(null);try{let t=await this.authService.verifyEmailByCode(this.email,this.code);t.success?this.success.set(!0):this.error.set(t.error||"\u9A57\u8B49\u5931\u6557")}catch(t){this.error.set(t.message||"\u9A57\u8B49\u5931\u6557")}finally{this.isLoading.set(!1)}}}async resendEmail(){if(!(this.resendCooldown()>0))try{await this.authService.resendVerificationEmail(),this.resendCooldown.set(60),this.cooldownInterval=setInterval(()=>{let t=this.resendCooldown();t<=1?(clearInterval(this.cooldownInterval),this.resendCooldown.set(0)):this.resendCooldown.set(t-1)},1e3)}catch(t){this.error.set(t.message||"\u767C\u9001\u5931\u6557")}}onCodeInput(t,e){let i=t.target,s=i.value.replace(/\D/g,""),c=[...this.codeDigits()];c[e]=s,this.codeDigits.set(c),this.code=c.join(""),s&&e<5&&i.parentElement?.children[e+1]?.focus()}onKeyDown(t,e){let i=t.target;t.key==="Backspace"&&!i.value&&e>0&&i.parentElement?.children[e-1]?.focus()}onPaste(t){t.preventDefault();let e=t.clipboardData?.getData("text")?.replace(/\D/g,"").slice(0,6)||"",i=e.split("");for(;i.length<6;)i.push("");this.codeDigits.set(i),this.code=e}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-verify-email"]],decls:5,vars:1,consts:[[1,"verify-email-page"],[1,"verifying-state"],[1,"success-state"],[1,"error-state"],[1,"code-form"],[1,"loading-spinner","large"],[1,"success-icon"],["routerLink","/",1,"primary-btn"],[1,"error-icon"],[1,"actions"],[1,"secondary-btn",3,"click"],["routerLink","/auth/login",1,"link"],[1,"code-input-group"],["type","text","maxlength","1",1,"code-input",3,"value","disabled"],[1,"primary-btn",3,"click","disabled"],[1,"resend-text"],[1,"link-btn",3,"click","disabled"],["type","text","maxlength","1",1,"code-input",3,"input","keydown","paste","value","disabled"],[1,"loading-spinner"]],template:function(e,i){e&1&&(o(0,"div",0),C(1,j,6,0,"div",1)(2,z,9,0,"div",2)(3,H,12,1,"div",3)(4,G,16,6,"div",4),r()),e&2&&(d(),y(i.verifying()?1:i.success()?2:i.error()?3:4))},dependencies:[P,I,S,B],styles:[".verify-email-page[_ngcontent-%COMP%]{color:var(--text-primary, #fff);text-align:center;padding:2rem}.verifying-state[_ngcontent-%COMP%], .success-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.success-icon[_ngcontent-%COMP%], .error-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.loading-spinner[_ngcontent-%COMP%]{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.loading-spinner.large[_ngcontent-%COMP%]{width:48px;height:48px;border-width:4px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.code-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:.5rem}.code-form[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary, #888);margin-bottom:2rem}.code-input-group[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:center;margin-bottom:2rem}.code-input[_ngcontent-%COMP%]{width:48px;height:56px;text-align:center;font-size:1.5rem;font-weight:600;background:var(--bg-secondary, #1a1a1a);border:2px solid var(--border-color, #333);border-radius:8px;color:var(--text-primary, #fff);transition:all .2s}.code-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #3b82f6);box-shadow:0 0 0 3px #3b82f633}.primary-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.875rem 2rem;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border:none;border-radius:8px;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}.primary-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.primary-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.secondary-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--bg-secondary, #1a1a1a);border:1px solid var(--border-color, #333);border-radius:8px;color:var(--text-primary, #fff);cursor:pointer;transition:all .2s}.secondary-btn[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary, #252525)}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-top:1rem}.link[_ngcontent-%COMP%], .link-btn[_ngcontent-%COMP%]{color:var(--primary, #3b82f6);text-decoration:none;background:none;border:none;cursor:pointer;font-size:inherit}.link[_ngcontent-%COMP%]:hover, .link-btn[_ngcontent-%COMP%]:hover:not(:disabled){text-decoration:underline}.link-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.resend-text[_ngcontent-%COMP%]{margin-top:1.5rem;color:var(--text-secondary, #888)}"],changeDetection:0})}};export{L as VerifyEmailComponent};
