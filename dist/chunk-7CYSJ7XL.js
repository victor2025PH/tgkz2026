import{a as L}from"./chunk-JKWWU3OM.js";import{e as B}from"./chunk-PHWS6WVI.js";import{c as N,f as F,k as R,l as A,m as j,t as V}from"./chunk-36YFMG3E.js";import{$a as E,Aa as r,Ab as W,Eb as x,Fb as _,Gb as v,Ia as b,Na as P,Sa as h,W as C,X as y,_a as S,cb as O,db as D,eb as p,fb as t,ga as m,gb as n,hb as T,lb as w,mc as I,nb as u,pb as g,qc as z,ub as k,vb as M,xb as a,yb as d,zb as f}from"./chunk-YLSLTE5F.js";var G=(c,o)=>o.id;function H(c,o){if(c&1&&(t(0,"div",30)(1,"div",31)(2,"span",32),a(3,"\u6536\u5165"),n(),t(4,"span",33),a(5),n()(),t(6,"div",34)(7,"span",32),a(8,"\u652F\u51FA"),n(),t(9,"span",33),a(10),n()(),t(11,"div",35)(12,"span",32),a(13,"\u5171"),n(),t(14,"span",33),a(15),n()()()),c&2){let i,e,l,s=g();r(5),d(((i=s.result())==null||i.summary==null?null:i.summary.total_in_display)||"$0.00"),r(5),d(((e=s.result())==null||e.summary==null?null:e.summary.total_out_display)||"$0.00"),r(5),f("",((l=s.result())==null||l.pagination==null?null:l.pagination.total)||0," \u7B46")}}function J(c,o){if(c&1&&(t(0,"div",36)(1,"div",37)(2,"div",38),a(3),n(),t(4,"div",39)(5,"div",40),a(6),n(),t(7,"div",41)(8,"span",42),a(9),n(),t(10,"span",43),a(11),n()()()(),t(12,"div",44)(13,"div",45),a(14),n(),t(15,"div",46),a(16),n()()()),c&2){let i=o.$implicit,e=g();M("income",i.amount>0)("expense",i.amount<0),r(3),d(e.getTypeIcon(i.type)),r(3),d(i.description||e.getTypeName(i.type)),r(3),d(i.order_id),r(2),d(e.formatDate(i.created_at)),r(2),M("positive",i.amount>0)("negative",i.amount<0),r(),f(" ",i.amount_display," "),r(),k("color",e.getStatusColor(i.status)),r(),f(" ",e.getStatusName(i.status)," ")}}function K(c,o){c&1&&(t(0,"div",27)(1,"span",4),a(2,"\u{1F4ED}"),n(),t(3,"span",47),a(4,"\u66AB\u7121\u4EA4\u6613\u8A18\u9304"),n()())}function Q(c,o){if(c&1){let i=w();t(0,"div",48)(1,"button",49),u("click",function(){C(i);let l=g();return y(l.goToPage(l.currentPage()-1))}),a(2," \u2190 \u4E0A\u4E00\u9801 "),n(),t(3,"span",50),a(4),n(),t(5,"button",49),u("click",function(){C(i);let l=g();return y(l.goToPage(l.currentPage()+1))}),a(6," \u4E0B\u4E00\u9801 \u2192 "),n()()}if(c&2){let i,e,l,s=g();r(),p("disabled",!(!((i=s.result())==null||i.pagination==null)&&i.pagination.has_prev)),r(3),W(" \u7B2C ",s.currentPage()," / ",(e=s.result())==null||e.pagination==null?null:e.pagination.total_pages," \u9801 "),r(),p("disabled",!(!((l=s.result())==null||l.pagination==null)&&l.pagination.has_next))}}function U(c,o){c&1&&(t(0,"div",51),T(1,"div",52),t(2,"span"),a(3,"\u52A0\u8F09\u4E2D..."),n()())}var q=class c{constructor(o,i){this.walletService=o;this.router=i;this.transactions=m([]);this.result=m(null);this.currentPage=m(1);this.loading=m(!1);this.filters={type:"",status:"",range:"30"}}ngOnInit(){this.loadData()}async loadData(){this.loading.set(!0);try{let{startDate:o,endDate:i}=this.getDateRange(),e=await this.walletService.loadTransactions({page:this.currentPage(),pageSize:20,type:this.filters.type||void 0,status:this.filters.status||void 0,startDate:o,endDate:i});e&&(this.result.set(e),this.transactions.set(e.transactions))}catch(o){console.error("Load transactions error:",o)}finally{this.loading.set(!1)}}getDateRange(){if(this.filters.range==="all")return{};let o=parseInt(this.filters.range),i=new Date,e=new Date;return e.setDate(e.getDate()-o),{startDate:e.toISOString(),endDate:i.toISOString()}}onRangeChange(){this.currentPage.set(1),this.loadData()}goToPage(o){if(o<1)return;let i=this.result()?.pagination?.total_pages||1;o>i||(this.currentPage.set(o),this.loadData())}goBack(){this.router.navigate(["/wallet"])}exportData(){let{startDate:o,endDate:i}=this.getDateRange();this.walletService.exportTransactions(o,i)}formatDate(o){return o?new Date(o).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}getTypeIcon(o){return this.walletService.getTypeIcon(o)}getTypeName(o){return this.walletService.getTypeName(o)}getStatusName(o){return{pending:"\u8655\u7406\u4E2D",success:"\u6210\u529F",failed:"\u5931\u6557",cancelled:"\u5DF2\u53D6\u6D88",refunded:"\u5DF2\u9000\u6B3E"}[o]||o}getStatusColor(o){return{pending:"#f59e0b",success:"#22c55e",failed:"#ef4444",cancelled:"#6b7280",refunded:"#8b5cf6"}[o]||"#999"}static{this.\u0275fac=function(i){return new(i||c)(b(L),b(B))}}static{this.\u0275cmp=P({type:c,selectors:[["app-wallet-transactions"]],decls:61,vars:7,consts:[[1,"transactions-view"],[1,"view-header"],[1,"header-left"],[1,"back-btn",3,"click"],[1,"icon"],[1,"header-actions"],[1,"export-btn",3,"click"],[1,"filters"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value",""],["value","recharge"],["value","consume"],["value","refund"],["value","withdraw"],["value","bonus"],["value","success"],["value","pending"],["value","failed"],["value","refunded"],["value","7"],["value","30"],["value","90"],["value","all"],["class","summary",4,"ngIf"],[1,"transaction-list"],[1,"transaction-item",3,"income","expense"],[1,"empty-state"],["class","pagination",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"summary"],[1,"summary-item","income"],[1,"label"],[1,"value"],[1,"summary-item","expense"],[1,"summary-item","count"],[1,"transaction-item"],[1,"tx-left"],[1,"tx-icon"],[1,"tx-info"],[1,"tx-desc"],[1,"tx-meta"],[1,"tx-order"],[1,"tx-time"],[1,"tx-right"],[1,"tx-amount"],[1,"tx-status"],[1,"text"],[1,"pagination"],[1,"page-btn",3,"click","disabled"],[1,"page-info"],[1,"loading-overlay"],[1,"loading-spinner"]],template:function(i,e){if(i&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),u("click",function(){return e.goBack()}),t(4,"span",4),a(5,"\u2190"),n()(),t(6,"h1"),a(7,"\u{1F4DC} \u4EA4\u6613\u8A18\u9304"),n()(),t(8,"div",5)(9,"button",6),u("click",function(){return e.exportData()}),a(10," \u{1F4E5} \u5C0E\u51FA "),n()()(),t(11,"div",7)(12,"div",8)(13,"label"),a(14,"\u985E\u578B"),n(),t(15,"select",9),v("ngModelChange",function(s){return _(e.filters.type,s)||(e.filters.type=s),s}),u("change",function(){return e.loadData()}),t(16,"option",10),a(17,"\u5168\u90E8"),n(),t(18,"option",11),a(19,"\u5145\u503C"),n(),t(20,"option",12),a(21,"\u6D88\u8CBB"),n(),t(22,"option",13),a(23,"\u9000\u6B3E"),n(),t(24,"option",14),a(25,"\u63D0\u73FE"),n(),t(26,"option",15),a(27,"\u8D08\u9001"),n()()(),t(28,"div",8)(29,"label"),a(30,"\u72C0\u614B"),n(),t(31,"select",9),v("ngModelChange",function(s){return _(e.filters.status,s)||(e.filters.status=s),s}),u("change",function(){return e.loadData()}),t(32,"option",10),a(33,"\u5168\u90E8"),n(),t(34,"option",16),a(35,"\u6210\u529F"),n(),t(36,"option",17),a(37,"\u8655\u7406\u4E2D"),n(),t(38,"option",18),a(39,"\u5931\u6557"),n(),t(40,"option",19),a(41,"\u5DF2\u9000\u6B3E"),n()()(),t(42,"div",8)(43,"label"),a(44,"\u6642\u9593\u7BC4\u570D"),n(),t(45,"select",9),v("ngModelChange",function(s){return _(e.filters.range,s)||(e.filters.range=s),s}),u("change",function(){return e.onRangeChange()}),t(46,"option",20),a(47,"\u6700\u8FD17\u5929"),n(),t(48,"option",21),a(49,"\u6700\u8FD130\u5929"),n(),t(50,"option",22),a(51,"\u6700\u8FD190\u5929"),n(),t(52,"option",23),a(53,"\u5168\u90E8"),n()()()(),h(54,H,16,3,"div",24),t(55,"div",25),O(56,J,17,16,"div",26,G),S(58,K,5,0,"div",27),n(),h(59,Q,7,4,"div",28)(60,U,4,0,"div",29),n()),i&2){let l;r(15),x("ngModel",e.filters.type),r(16),x("ngModel",e.filters.status),r(14),x("ngModel",e.filters.range),r(9),p("ngIf",e.result()),r(2),D(e.transactions()),r(2),E(e.transactions().length===0&&!e.loading()?58:-1),r(),p("ngIf",((l=e.result())==null||l.pagination==null?null:l.pagination.total_pages)>1),r(),p("ngIf",e.loading())}},dependencies:[z,I,V,A,j,R,N,F],styles:[".transactions-view[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);padding:20px;color:#fff}.view-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.back-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;background:#ffffff1a;border:none;color:#fff;font-size:20px;cursor:pointer;transition:all .2s}.back-btn[_ngcontent-%COMP%]:hover{background:#fff3}h1[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin:0}.export-btn[_ngcontent-%COMP%]{padding:10px 20px;border-radius:12px;background:#ffffff1a;border:none;color:#fff;font-size:14px;cursor:pointer;transition:all .2s}.export-btn[_ngcontent-%COMP%]:hover{background:#fff3}.filters[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;flex-wrap:wrap}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;opacity:.7}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 12px;border-radius:8px;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);color:#fff;font-size:14px;min-width:120px}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:#1a1a2e}.summary[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px}.summary-item[_ngcontent-%COMP%]{flex:1;padding:16px;border-radius:12px;background:#ffffff0d;text-align:center}.summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:12px;opacity:.7;margin-bottom:4px}.summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:18px;font-weight:600}.summary-item.income[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#22c55e}.summary-item.expense[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#ef4444}.transaction-list[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;overflow:hidden}.transaction-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid rgba(255,255,255,.05)}.transaction-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.tx-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.tx-icon[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;background:#ffffff1a;display:flex;align-items:center;justify-content:center;font-size:20px}.tx-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.tx-desc[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.tx-meta[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:12px;opacity:.5}.tx-right[_ngcontent-%COMP%]{text-align:right}.tx-amount[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:4px}.tx-amount.positive[_ngcontent-%COMP%]{color:#22c55e}.tx-amount.negative[_ngcontent-%COMP%]{color:#ef4444}.tx-status[_ngcontent-%COMP%]{font-size:12px}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:20px;margin-top:20px}.page-btn[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;background:#ffffff1a;border:none;color:#fff;font-size:14px;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed}.page-btn[_ngcontent-%COMP%]:not(:disabled):hover{background:#fff3}.page-info[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:60px;opacity:.5}.empty-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;z-index:100}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(255,255,255,.2);border-top-color:#667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};export{q as a};
