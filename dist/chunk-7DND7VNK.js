import{e as P,g as L}from"./chunk-FF535MQ4.js";import{b as I}from"./chunk-6FHZTSI7.js";import{o as O}from"./chunk-35776WZA.js";import{La as M,Nb as k,O as p,T as u,U as f,V as h,W as S,Ya as m,Za as g,da as x,gb as n,hb as e,ib as _,jb as C,kb as w,ob as v,pb as d,ta as b,xa as o,xb as i,yb as s,zb as E}from"./chunk-MB4RORS3.js";var z=a=>({seconds:a});function V(a,r){if(a&1&&(n(0,"div",4),_(1,"div",11),n(2,"p"),i(3),e()()),a&2){let t=d();o(3),s(t.t("scanLogin.verifying"))}}function j(a,r){if(a&1&&(n(0,"p",18),i(1),e()),a&2){let t=d(2);o(),E(" ",t.t("scanLogin.expiresIn",k(1,z,t.countdown()))," ")}}function U(a,r){if(a&1){let t=C();n(0,"div",5)(1,"div",12),i(2,"\u{1F4F1}"),e(),n(3,"h2"),i(4),e(),n(5,"p",13),i(6),e(),n(7,"a",14),v("click",function(){u(t);let l=d();return f(l.onTelegramClick())}),n(8,"span",15),h(),n(9,"svg",16),_(10,"path",17),e()(),S(),n(11,"span"),i(12),e()(),m(13,j,2,3,"p",18),n(14,"div",19)(15,"div",20)(16,"span",21),i(17,"1"),e(),n(18,"span"),i(19),e()(),n(20,"div",20)(21,"span",21),i(22,"2"),e(),n(23,"span"),i(24),e()(),n(25,"div",20)(26,"span",21),i(27,"3"),e(),n(28,"span"),i(29),e()()()()}if(a&2){let t=d();o(4),s(t.t("scanLogin.confirmTitle")),o(2),s(t.t("scanLogin.confirmDesc")),o(),w("href",t.tokenStatus().deepLinkUrl,b),o(5),s(t.t("scanLogin.openTelegram")),o(),g(t.countdown()>0?13:-1),o(6),s(t.t("scanLogin.step1")),o(5),s(t.t("scanLogin.step2")),o(5),s(t.t("scanLogin.step3"))}}function A(a,r){if(a&1&&(n(0,"div",6)(1,"div",22),i(2,"\u23F3"),e(),n(3,"h2"),i(4),e(),n(5,"p"),i(6),e(),_(7,"div",23),e()),a&2){let t=d();o(4),s(t.t("scanLogin.waitingTitle")),o(2),s(t.t("scanLogin.waitingDesc"))}}function F(a,r){if(a&1&&(n(0,"div",7)(1,"div",24),i(2,"\u2705"),e(),n(3,"h2"),i(4),e(),n(5,"p"),i(6),e()()),a&2){let t=d();o(4),s(t.t("scanLogin.successTitle")),o(2),s(t.t("scanLogin.successDesc"))}}function N(a,r){if(a&1){let t=C();n(0,"div",8)(1,"div",25),i(2,"\u23F0"),e(),n(3,"h2"),i(4),e(),n(5,"p"),i(6),e(),n(7,"button",26),v("click",function(){u(t);let l=d();return f(l.goToLogin())}),i(8),e()()}if(a&2){let t=d();o(4),s(t.t("scanLogin.expiredTitle")),o(2),s(t.t("scanLogin.expiredDesc")),o(2),E(" ",t.t("scanLogin.backToLogin")," ")}}function G(a,r){if(a&1){let t=C();n(0,"div",9)(1,"div",25),i(2,"\u274C"),e(),n(3,"h2"),i(4),e(),n(5,"p"),i(6),e(),n(7,"button",26),v("click",function(){u(t);let l=d();return f(l.goToLogin())}),i(8),e()()}if(a&2){let t=d();o(4),s(t.t("scanLogin.errorTitle")),o(2),s(t.tokenStatus().message||t.t("scanLogin.errorDesc")),o(2),E(" ",t.t("scanLogin.backToLogin")," ")}}var y=class a{constructor(){this.route=p(P);this.router=p(L);this.i18n=p(I);this.tokenStatus=x({status:"loading"});this.countdown=x(0);this.waitingConfirm=x(!1);this.token="";this.countdownInterval=null;this.pollInterval=null}ngOnInit(){if(this.token=this.route.snapshot.queryParams.token||"",!this.token){this.tokenStatus.set({status:"error",message:this.t("scanLogin.noToken")});return}this.verifyToken()}ngOnDestroy(){this.countdownInterval&&clearInterval(this.countdownInterval),this.pollInterval&&clearInterval(this.pollInterval)}t(r,t){return this.i18n.t(r,t)}async verifyToken(){try{let t=await(await fetch(`/api/v1/auth/login-token/${this.token}`)).json();if(!t.success){this.tokenStatus.set({status:"error",message:t.error||this.t("scanLogin.tokenInvalid")});return}let{status:c,expires_in:l,deep_link_url:T,bot_username:D}=t.data;if(c==="expired"){this.tokenStatus.set({status:"expired"});return}if(c==="confirmed"){this.tokenStatus.set({status:"confirmed"});return}this.tokenStatus.set({status:"valid",deepLinkUrl:T,botUsername:D,expiresIn:l||300}),this.countdown.set(l||300),this.startCountdown()}catch(r){console.error("Token verification error:",r),this.tokenStatus.set({status:"error",message:this.t("scanLogin.networkError")})}}onTelegramClick(){this.waitingConfirm.set(!0),this.startPolling()}startCountdown(){this.countdownInterval=setInterval(()=>{let r=this.countdown();r<=0?(clearInterval(this.countdownInterval),this.tokenStatus.set({status:"expired"})):this.countdown.set(r-1)},1e3)}startPolling(){this.pollInterval=setInterval(async()=>{try{let t=await(await fetch(`/api/v1/auth/login-token/${this.token}`)).json();t.success&&t.data&&(t.data.status==="confirmed"?(clearInterval(this.pollInterval),this.waitingConfirm.set(!1),this.tokenStatus.set({status:"confirmed"})):t.data.status==="expired"&&(clearInterval(this.pollInterval),this.waitingConfirm.set(!1),this.tokenStatus.set({status:"expired"})))}catch(r){console.error("Polling error:",r)}},2e3)}goToLogin(){window.location.href="https://tgw.usdt2026.cc/auth/login"}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275cmp=M({type:a,selectors:[["app-scan-login"]],decls:16,vars:6,consts:[[1,"scan-login-page"],[1,"scan-card"],[1,"logo"],[1,"logo-icon"],[1,"status-section","loading"],[1,"status-section","valid"],[1,"status-section","waiting"],[1,"status-section","confirmed"],[1,"status-section","expired"],[1,"status-section","error"],[1,"footer"],[1,"spinner"],[1,"info-icon"],[1,"description"],[1,"telegram-btn",3,"click","href"],[1,"btn-icon"],["viewBox","0 0 24 24","fill","currentColor","width","24","height","24"],["d","M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"],[1,"countdown"],[1,"steps"],[1,"step"],[1,"step-num"],[1,"pulse-icon"],[1,"spinner","small"],[1,"success-icon"],[1,"error-icon"],[1,"retry-btn",3,"click"]],template:function(t,c){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),i(4,"\u{1F510}"),e(),n(5,"h1"),i(6,"TG-Matrix"),e()(),m(7,V,4,1,"div",4),m(8,U,30,8,"div",5),m(9,A,8,2,"div",6),m(10,F,7,2,"div",7),m(11,N,9,3,"div",8),m(12,G,9,3,"div",9),n(13,"div",10)(14,"p"),i(15,"\xA9 2026 TG-Matrix. All rights reserved."),e()()()()),t&2&&(o(7),g(c.tokenStatus().status==="loading"?7:-1),o(),g(c.tokenStatus().status==="valid"?8:-1),o(),g(c.waitingConfirm()?9:-1),o(),g(c.tokenStatus().status==="confirmed"?10:-1),o(),g(c.tokenStatus().status==="expired"?11:-1),o(),g(c.tokenStatus().status==="error"?12:-1))},dependencies:[O],styles:[".scan-login-page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a,#1e293b);padding:1rem}.scan-card[_ngcontent-%COMP%]{background:#1e293be6;border-radius:20px;padding:2rem;max-width:400px;width:100%;text-align:center;box-shadow:0 20px 60px #0000004d;border:1px solid rgba(255,255,255,.1)}.logo[_ngcontent-%COMP%]{margin-bottom:2rem}.logo-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:.5rem}.logo[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff;margin:0}.status-section[_ngcontent-%COMP%]{padding:1rem 0}.info-icon[_ngcontent-%COMP%], .success-icon[_ngcontent-%COMP%], .error-icon[_ngcontent-%COMP%], .pulse-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.pulse-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}h2[_ngcontent-%COMP%]{color:#fff;font-size:1.25rem;margin:0 0 .5rem}.description[_ngcontent-%COMP%]{color:#94a3b8;font-size:.9rem;margin:0 0 1.5rem}.telegram-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.75rem;padding:1rem 2rem;background:linear-gradient(135deg,#08c,#06a);border:none;border-radius:12px;color:#fff;font-size:1.1rem;font-weight:600;text-decoration:none;cursor:pointer;transition:all .3s ease;width:100%;box-shadow:0 4px 15px #08c6}.telegram-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #0088cc80}.telegram-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center}.btn-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}.countdown[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem;margin:1rem 0 0}.steps[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.1)}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem 0;color:#94a3b8;font-size:.9rem}.step-num[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem;background:linear-gradient(135deg,#08c,#06a);border-radius:50%;color:#fff;font-size:.75rem;font-weight:600}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(255,255,255,.1);border-top-color:#08c;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:1rem auto}.spinner.small[_ngcontent-%COMP%]{width:24px;height:24px;border-width:2px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.retry-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.75rem 1.5rem;background:transparent;border:1px solid #64748b;border-radius:8px;color:#94a3b8;font-size:.9rem;cursor:pointer;transition:all .2s ease;margin-top:1rem}.retry-btn[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:#fff;color:#fff}.footer[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.05)}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#475569;font-size:.75rem;margin:0}.status-section.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#94a3b8}.status-section.waiting[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fbbf24}.status-section.confirmed[_ngcontent-%COMP%]   .success-icon[_ngcontent-%COMP%], .status-section.confirmed[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#4ade80}.status-section.expired[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%], .status-section.error[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%], .status-section.expired[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .status-section.error[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#f87171}"]})}};export{y as ScanLoginComponent};
