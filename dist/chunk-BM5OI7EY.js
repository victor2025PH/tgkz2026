import{h as ie,u as se}from"./chunk-JVCW4UCO.js";import{c as oe}from"./chunk-6CC5VJPY.js";import{a as ae}from"./chunk-GQQBGSXN.js";import{a as te,b as ne,d as le}from"./chunk-ITEZR6M3.js";import{a as ee}from"./chunk-3V3KVMT4.js";import{b as re}from"./chunk-CXXWQ5XE.js";import{b as J,c as W,f as K,k as Q,l as X,m as Y,t as Z}from"./chunk-36YFMG3E.js";import{$a as C,Aa as l,Ab as H,M as U,Na as V,R as D,Vb as S,W as v,X as b,Y as N,Z as G,_a as f,a as O,b as j,bb as q,cb as T,db as F,eb as E,fb as r,ga as g,gb as o,hb as A,ib as u,jb as d,kb as z,lb as w,mb as M,nb as _,ob as P,pb as c,qc as B,ub as I,vb as k,wb as L,xb as n,yb as h,zb as x}from"./chunk-YLSLTE5F.js";var R=class a{constructor(){this.api=D(ae);this._summary=g(null);this.summary=this._summary.asReadonly();this._leadSources=g([]);this.leadSources=this._leadSources.asReadonly();this._templatePerf=g([]);this.templatePerf=this._templatePerf.asReadonly();this._dailyTrends=g([]);this.dailyTrends=this._dailyTrends.asReadonly();this._funnelData=g([]);this.funnelData=this._funnelData.asReadonly();this._abTests=g([]);this.abTests=this._abTests.asReadonly();this._retryInfo=g(null);this.retryInfo=this._retryInfo.asReadonly();this._dedupStats=g(null);this.dedupStats=this._dedupStats.asReadonly();this._duplicateGroups=g([]);this.duplicateGroups=this._duplicateGroups.asReadonly();this._loading=g({});this.loading=this._loading.asReadonly();this._lastError=g("");this.lastError=this._lastError.asReadonly();this.isAnyLoading=S(()=>Object.values(this._loading()).some(t=>t));this._scoreResults=g([]);this.scoreResults=this._scoreResults.asReadonly()}setLoading(t,e){this._loading.update(i=>j(O({},i),{[t]:e}))}async loadSummary(t){this.setLoading("summary",!0);try{let e=t?`?user_id=${t}`:"",i=await this.api.get(`/api/v1/analytics/summary${e}`,{cache:!0,ttl:6e4});return i.success&&i.data?.data?(this._summary.set(i.data.data),i.data.data):i.success&&i.data?(this._summary.set(i.data),i.data):null}catch(e){return this._lastError.set(e.message||"Failed to load summary"),null}finally{this.setLoading("summary",!1)}}async loadLeadSources(t=30){this.setLoading("sources",!0);try{let e=await this.api.get(`/api/v1/analytics/sources?days=${t}`,{cache:!0,ttl:6e4}),i=e.data?.data||e.data||[];return this._leadSources.set(Array.isArray(i)?i:[]),this._leadSources()}catch{return[]}finally{this.setLoading("sources",!1)}}async loadTemplatePerformance(t=30){this.setLoading("templates",!0);try{let e=await this.api.get(`/api/v1/analytics/templates?days=${t}`,{cache:!0,ttl:6e4}),i=e.data?.data||e.data||[];return this._templatePerf.set(Array.isArray(i)?i:[]),this._templatePerf()}catch{return[]}finally{this.setLoading("templates",!1)}}async loadDailyTrends(t=30){this.setLoading("trends",!0);try{let e=await this.api.get(`/api/v1/analytics/trends?days=${t}`,{cache:!0,ttl:6e4}),i=e.data?.data||e.data||[];return this._dailyTrends.set(Array.isArray(i)?i:[]),this._dailyTrends()}catch{return[]}finally{this.setLoading("trends",!1)}}async loadFunnel(t){this.setLoading("funnel",!0);try{let e=t?`?user_id=${t}`:"",i=await this.api.get(`/api/v1/analytics/funnel${e}`,{cache:!0,ttl:6e4}),s=i.data?.data||i.data||[];return this._funnelData.set(Array.isArray(s)?s:[]),this._funnelData()}catch{return[]}finally{this.setLoading("funnel",!1)}}async loadAllAnalytics(t=30){await Promise.all([this.loadSummary(),this.loadLeadSources(t),this.loadTemplatePerformance(t),this.loadDailyTrends(t),this.loadFunnel()])}async scoreLeads(t){this.setLoading("scoring",!0);try{let e=await this.api.post("/api/v1/leads/score",{lead_ids:t||[]}),i=e.data?.data?.results||e.data?.results||[];return this._scoreResults.set(i),i.length>0&&this.syncScoresToLocal(i),i}catch{return[]}finally{this.setLoading("scoring",!1)}}syncScoresToLocal(t){try{let e=localStorage.getItem("tg_leads_data");if(!e)return;let i=JSON.parse(e),s=new Map;t.forEach(y=>s.set(y.id,y));let m=!1;for(let y of i){let p=s.get(y.id);p&&(y.lead_score=p.lead_score,y.intent_level=p.intent_level,y.value_level=p.value_level,y.intent_score=p.intent_score,y.quality_score=p.quality_score,y.activity_score=p.activity_score,m=!0)}m&&localStorage.setItem("tg_leads_data",JSON.stringify(i))}catch(e){console.warn("[BusinessApi] Score sync to localStorage failed:",e)}}async pullScoredLeads(t=200){try{let e=await this.api.get("/api/v1/analytics/summary",{cache:!1});return this._scoreResults()}catch{return[]}}async scanDuplicates(t=50){this.setLoading("dedup",!0);try{let e=await this.api.get(`/api/v1/leads/dedup/scan?limit=${t}`);if(e.success){let i=e.data?.data||e.data||{};this._duplicateGroups.set(i.duplicate_groups||[]),this._dedupStats.set(i.stats||null)}}catch(e){this._lastError.set(e.message||"Failed to scan duplicates")}finally{this.setLoading("dedup",!1)}}async mergeDuplicates(t,e){this.setLoading("merge",!0);try{return(await this.api.post("/api/v1/leads/dedup/merge",{primary_id:t,duplicate_ids:e})).success?(await this.scanDuplicates(),!0):!1}catch{return!1}finally{this.setLoading("merge",!1)}}async loadRetrySchedule(){this.setLoading("retry",!0);try{let t=await this.api.get("/api/v1/retry/schedule",{cache:!0,ttl:3e5}),e=t.data?.data||t.data;return e?(this._retryInfo.set(e),e):null}catch{return null}finally{this.setLoading("retry",!1)}}async loadABTests(){this.setLoading("abTests",!0);try{let t=await this.api.get("/api/v1/ab-tests"),e=t.data?.data||t.data||[];return this._abTests.set(Array.isArray(e)?e:[]),this._abTests()}catch{return[]}finally{this.setLoading("abTests",!1)}}async createABTest(t,e,i){this.setLoading("abCreate",!0);try{let s=await this.api.post("/api/v1/ab-tests",{name:t,template_ids:e,template_names:i});return s.success?(await this.loadABTests(),s.data?.data||s.data):null}catch{return null}finally{this.setLoading("abCreate",!1)}}async getABTest(t){try{let e=await this.api.get(`/api/v1/ab-tests/${t}`);return e.data?.data||e.data||null}catch{return null}}async completeABTest(t){this.setLoading("abComplete",!0);try{let e=await this.api.post(`/api/v1/ab-tests/${t}/complete`,{});return e.success?(await this.loadABTests(),e.data?.data||e.data):null}catch{return null}finally{this.setLoading("abComplete",!1)}}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275prov=U({token:a,factory:a.\u0275fac,providedIn:"root"})}};var pe=(a,t)=>t.id,_e=(a,t)=>t.primary_id;function ge(a,t){a&1&&(N(),u(0,"svg",10),z(1,"circle",11)(2,"path",12),d(),G(),u(3,"span"),n(4,"\u8A55\u5206\u4E2D..."),d())}function xe(a,t){a&1&&(u(0,"span"),n(1,"\u{1F504} \u6279\u91CF\u8A55\u5206"),d())}function ve(a,t){if(a&1&&(u(0,"div",27)(1,"div",29),n(2),d(),u(3,"div",30)(4,"div",31),n(5),d(),u(6,"div",32)(7,"span",33),n(8),d(),u(9,"span",34),n(10),d()()(),u(11,"div",35)(12,"div"),n(13),d(),u(14,"div"),n(15),d()()()),a&2){let e=t.$implicit,i=c(2);l(),L(i.getScoreBgClass(e.intent_level)),l(),x(" ",e.lead_score," "),l(3),H("#",e.id," ",e.telegram_id||""),l(2),L(i.getIntentBadgeClass(e.intent_level)),l(),x(" ",e.intent_level," "),l(2),x(" ",e.value_level," "),l(3),x("\u610F\u5411 ",e.intent_score),l(2),x("\u8CEA\u91CF ",e.quality_score)}}function be(a,t){if(a&1&&(u(0,"div",13)(1,"div",14)(2,"div",15),n(3),d(),u(4,"div",16),n(5,"\u{1F525} Hot"),d()(),u(6,"div",17)(7,"div",18),n(8),d(),u(9,"div",19),n(10,"\u{1F321}\uFE0F Warm"),d()(),u(11,"div",20)(12,"div",21),n(13),d(),u(14,"div",22),n(15,"\u{1F610} Neutral"),d()(),u(16,"div",23)(17,"div",24),n(18),d(),u(19,"div",25),n(20,"\u2744\uFE0F Cold"),d()()(),u(21,"div",26),T(22,ve,16,11,"div",27,pe),d(),u(24,"div",28),n(25),d()),a&2){let e=c();l(3),h(e.hotCount()),l(5),h(e.warmCount()),l(5),h(e.neutralCount()),l(5),h(e.coldCount()),l(4),F(e.scoreResults().slice(0,20)),l(3),x(" \u5DF2\u8A55\u5206 ",e.scoreResults().length," \u689D\u7DDA\u7D22 ")}}function fe(a,t){a&1&&(u(0,"div",5)(1,"p",36),n(2,"\u{1F4CA}"),d(),u(3,"p"),n(4,"\u9EDE\u64CA\u300C\u6279\u91CF\u8A55\u5206\u300D\u5C0D\u672A\u8A55\u5206\u7DDA\u7D22\u81EA\u52D5\u6253\u5206"),d(),u(5,"p",37),n(6,"\u5C07\u57FA\u65BC\u5B8C\u6574\u5EA6\u3001\u6D3B\u8E8D\u5EA6\u3001\u610F\u5411\u4FE1\u865F\u7B49 5 \u500B\u7DAD\u5EA6\u8A55\u5206"),d()())}function Ce(a,t){a&1&&(N(),u(0,"svg",10),z(1,"circle",11)(2,"path",12),d(),G(),u(3,"span"),n(4,"\u6383\u63CF\u4E2D..."),d())}function he(a,t){a&1&&(u(0,"span"),n(1,"\u{1F50E} \u6383\u63CF\u91CD\u8907"),d())}function ye(a,t){if(a&1&&(u(0,"div",7)(1,"div",38)(2,"div",39),n(3),d(),u(4,"div",40),n(5,"\u7E3D\u806F\u7E6B\u4EBA"),d()(),u(6,"div",41)(7,"div",42),n(8),d(),u(9,"div",43),n(10,"\u91CD\u8907\u7D44"),d()(),u(11,"div",44)(12,"div",45),n(13),d(),u(14,"div",16),n(15,"\u9810\u4F30\u91CD\u8907"),d()()()),a&2){let e=t;l(3),h(e.total_contacts),l(5),h(e.duplicate_username_groups),l(5),h(e.estimated_duplicates)}}function Se(a,t){if(a&1&&(u(0,"span",54),n(1),d(),n(2)),a&2){let e=t.$implicit,i=t.$index,s=t.$count;l(),x("#",e),l(),x("",i===s-1?"":", "," ")}}function De(a,t){if(a&1&&n(0),a&2){let e=c(2).$implicit;x(" \u7528\u6236\u540D: ",e.details.username," ")}}function Ee(a,t){if(a&1&&n(0),a&2){let e=c(2).$implicit;x(" \u96FB\u8A71: ",e.details.phone," ")}}function we(a,t){if(a&1&&n(0),a&2){let e=c(2).$implicit;x(" (",e.details.count," \u689D\u8A18\u9304) ")}}function Te(a,t){if(a&1&&(u(0,"div",53),f(1,De,1,1),f(2,Ee,1,1),f(3,we,1,1),d()),a&2){let e=c().$implicit;l(),C(e.details.username?1:-1),l(),C(e.details.phone?2:-1),l(),C(e.details.count?3:-1)}}function Fe(a,t){if(a&1){let e=w();u(0,"div",46)(1,"div",47)(2,"div",48)(3,"span",49),n(4),d(),u(5,"span",50),n(6),d()(),u(7,"button",51),P("click",function(){let s=v(e).$implicit,m=c(2);return b(m.mergeGroup(s))}),n(8," \u5408\u4F75 "),d()(),u(9,"div",52),n(10),T(11,Se,3,2,null,null,q),d(),f(13,Te,4,3,"div",53),d()}if(a&2){let e=t.$implicit,i=c(2);l(3),L(e.match_type==="exact_phone"?"bg-purple-500/20 text-purple-400":e.match_type==="exact_telegram_id"?"bg-blue-500/20 text-blue-400":"bg-amber-500/20 text-amber-400"),l(),x(" ",e.match_type==="exact_phone"?"\u{1F4DE} \u96FB\u8A71\u91CD\u8907":e.match_type==="exact_telegram_id"?"\u{1F194} ID\u91CD\u8907":"\u{1F464} \u7528\u6236\u540D\u91CD\u8907"," "),l(2),x(" \u4FE1\u5FC3\u5EA6 ",(e.confidence*100).toFixed(0),"% "),l(),M("disabled",i.isMerging()),l(3),x(" \u4FDD\u7559 #",e.primary_id,"\uFF0C\u5408\u4F75 "),l(),F(e.duplicate_ids),l(2),C(e.details?13:-1)}}function Le(a,t){if(a&1&&(u(0,"div",8),T(1,Fe,14,7,"div",46,_e),d()),a&2){let e=c();l(),F(e.duplicateGroups())}}function ke(a,t){a&1&&(u(0,"div",9)(1,"p"),n(2,"\u2705 \u672A\u767C\u73FE\u91CD\u8907\u7DDA\u7D22"),d()())}function Ae(a,t){a&1&&(u(0,"div",9)(1,"p",36),n(2,"\u{1F50D}"),d(),u(3,"p"),n(4,"\u9EDE\u64CA\u300C\u6383\u63CF\u91CD\u8907\u300D\u6AA2\u67E5\u7DDA\u7D22\u6578\u64DA\u5EAB"),d()())}var $=class a{constructor(){this.bizApi=D(R);this.isScoring=g(!1);this.scoreResults=g([]);this.isScanning=g(!1);this.isMerging=g(!1);this.duplicateGroups=this.bizApi.duplicateGroups;this.dedupStats=this.bizApi.dedupStats;this.hotCount=S(()=>this.scoreResults().filter(t=>t.intent_level==="hot").length);this.warmCount=S(()=>this.scoreResults().filter(t=>t.intent_level==="warm").length);this.neutralCount=S(()=>this.scoreResults().filter(t=>t.intent_level==="neutral").length);this.coldCount=S(()=>this.scoreResults().filter(t=>t.intent_level==="cold").length)}ngOnInit(){}async runBatchScoring(){this.isScoring.set(!0);try{let t=await this.bizApi.scoreLeads();this.scoreResults.set(t)}finally{this.isScoring.set(!1)}}async scanDuplicates(){this.isScanning.set(!0);try{await this.bizApi.scanDuplicates(50)}finally{this.isScanning.set(!1)}}async mergeGroup(t){this.isMerging.set(!0);try{await this.bizApi.mergeDuplicates(t.primary_id,t.duplicate_ids)}finally{this.isMerging.set(!1)}}getScoreBgClass(t){switch(t){case"hot":return"bg-red-500/20 text-red-400";case"warm":return"bg-orange-500/20 text-orange-400";case"neutral":return"bg-blue-500/20 text-blue-400";default:return"bg-slate-500/20 text-slate-400"}}getIntentBadgeClass(t){switch(t){case"hot":return"bg-red-500/20 text-red-400";case"warm":return"bg-orange-500/20 text-orange-400";case"neutral":return"bg-blue-500/20 text-blue-400";default:return"bg-slate-500/20 text-slate-400"}}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=V({type:a,selectors:[["app-lead-scoring-panel"]],decls:25,vars:7,consts:[[1,"space-y-4"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"px-4","py-1.5","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-400","hover:to-blue-400","text-white","text-sm","rounded-lg","transition-all","disabled:opacity-50","flex","items-center","gap-2",3,"click","disabled"],[1,"text-center","py-8","text-slate-500"],[1,"px-4","py-1.5","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-400","hover:to-orange-400","text-white","text-sm","rounded-lg","transition-all","disabled:opacity-50","flex","items-center","gap-2",3,"click","disabled"],[1,"grid","grid-cols-3","gap-3","mb-4"],[1,"space-y-3","max-h-60","overflow-y-auto"],[1,"text-center","py-6","text-slate-500"],["viewBox","0 0 24 24","fill","none",1,"w-4","h-4","animate-spin"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"grid","grid-cols-4","gap-3","mb-4"],[1,"p-3","bg-red-500/10","border","border-red-500/20","rounded-xl","text-center"],[1,"text-2xl","font-bold","text-red-400"],[1,"text-xs","text-red-400/70","mt-1"],[1,"p-3","bg-orange-500/10","border","border-orange-500/20","rounded-xl","text-center"],[1,"text-2xl","font-bold","text-orange-400"],[1,"text-xs","text-orange-400/70","mt-1"],[1,"p-3","bg-blue-500/10","border","border-blue-500/20","rounded-xl","text-center"],[1,"text-2xl","font-bold","text-blue-400"],[1,"text-xs","text-blue-400/70","mt-1"],[1,"p-3","bg-slate-500/10","border","border-slate-500/20","rounded-xl","text-center"],[1,"text-2xl","font-bold","text-slate-400"],[1,"text-xs","text-slate-400/70","mt-1"],[1,"space-y-2","max-h-60","overflow-y-auto"],[1,"flex","items-center","gap-3","p-2","bg-slate-700/30","rounded-lg","hover:bg-slate-700/50","transition-colors"],[1,"text-xs","text-slate-500","mt-2","text-center"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","text-lg","font-bold"],[1,"flex-1","min-w-0"],[1,"text-sm","text-white"],[1,"flex","items-center","gap-2","mt-0.5"],[1,"text-xs","px-1.5","py-0.5","rounded"],[1,"text-xs","px-1.5","py-0.5","rounded","bg-slate-600/50","text-slate-300"],[1,"text-right","text-xs","text-slate-400"],[1,"text-lg","mb-2"],[1,"text-xs","mt-1"],[1,"p-3","bg-slate-700/30","rounded-lg","text-center"],[1,"text-xl","font-bold","text-white"],[1,"text-xs","text-slate-400","mt-1"],[1,"p-3","bg-amber-500/10","border","border-amber-500/20","rounded-lg","text-center"],[1,"text-xl","font-bold","text-amber-400"],[1,"text-xs","text-amber-400/70","mt-1"],[1,"p-3","bg-red-500/10","border","border-red-500/20","rounded-lg","text-center"],[1,"text-xl","font-bold","text-red-400"],[1,"p-3","bg-slate-700/30","rounded-lg","border","border-slate-600/30"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2"],[1,"text-xs","px-2","py-0.5","rounded"],[1,"text-xs","text-slate-400"],[1,"px-3","py-1","text-xs","bg-amber-500/20","hover:bg-amber-500/30","text-amber-400","rounded-lg","transition-all","disabled:opacity-50",3,"click","disabled"],[1,"text-xs","text-slate-300"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-amber-400"]],template:function(e,i){if(e&1&&(u(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3)(4,"span"),n(5,"\u2B50"),d(),n(6," \u7DDA\u7D22\u667A\u80FD\u8A55\u5206 "),d(),u(7,"button",4),P("click",function(){return i.runBatchScoring()}),f(8,ge,5,0)(9,xe,2,0,"span"),d()(),f(10,be,26,5)(11,fe,7,0,"div",5),d(),u(12,"div",1)(13,"div",2)(14,"h3",3)(15,"span"),n(16,"\u{1F50D}"),d(),n(17," \u7DDA\u7D22\u53BB\u91CD "),d(),u(18,"button",6),P("click",function(){return i.scanDuplicates()}),f(19,Ce,5,0)(20,he,2,0,"span"),d()(),f(21,ye,16,3,"div",7),f(22,Le,3,0,"div",8)(23,ke,3,0,"div",9)(24,Ae,5,0,"div",9),d()()),e&2){let s;l(7),M("disabled",i.isScoring()),l(),C(i.isScoring()?8:9),l(2),C(i.scoreResults().length>0?10:11),l(8),M("disabled",i.isScanning()),l(),C(i.isScanning()?19:20),l(2),C((s=i.dedupStats())?21:-1,s),l(),C(i.duplicateGroups().length>0?22:i.dedupStats()?23:24)}},dependencies:[B],styles:["[_nghost-%COMP%]{display:block}"]})}};var ue=(a,t)=>t.id;function Ie(a,t){a&1&&(r(0,"div",8),A(1,"app-lead-scoring-panel"),o())}function Ve(a,t){a&1&&n(0," \u5DF2\u5168\u9078 ")}function Me(a,t){a&1&&n(0," \u90E8\u5206\u9078\u4E2D ")}function Pe(a,t){a&1&&n(0," \u5168\u9078 ")}function Be(a,t){if(a&1&&(r(0,"span",37),n(1),o()),a&2){let e=c();l(),x(" \u5DF2\u9078 ",e.selectedCount()," \u500B ")}}function Re(a,t){if(a&1&&(r(0,"span",12),n(1),o()),a&2){let e=c();l(),x(" \u5171 ",e.filteredContacts().length," \u500B\u5BA2\u6236 ")}}function $e(a,t){if(a&1){let e=w();r(0,"div",32)(1,"button",44),_("click",function(){v(e);let s=c();return b(s.batchSend())}),n(2," \u{1F4E8} \u7FA4\u767C "),o(),r(3,"button",45),_("click",function(){v(e);let s=c();return b(s.batchInvite())}),n(4," \u{1F465} \u62C9\u7FA4 "),o(),r(5,"button",46),_("click",function(){v(e);let s=c();return b(s.batchDelete())}),n(6," \u{1F5D1}\uFE0F \u522A\u9664 "),o()()}if(a&2){let e=c();l(5),E("disabled",e.isDeleting())}}function Ne(a,t){if(a&1){let e=w();r(0,"div",39)(1,"span",47),n(2),o(),A(3,"div",38),r(4,"button",48),_("click",function(){v(e);let s=c();return b(s.batchSend())}),r(5,"span"),n(6,"\u{1F4E8}"),o(),n(7," \u7FA4\u767C\u6D88\u606F "),o(),r(8,"button",49),_("click",function(){v(e);let s=c();return b(s.batchInvite())}),r(9,"span"),n(10,"\u{1F465}"),o(),n(11," \u6279\u91CF\u62C9\u7FA4 "),o(),r(12,"button",50),_("click",function(){v(e);let s=c();return b(s.startMultiRoleCollaboration())}),r(13,"span"),n(14,"\u{1F916}"),o(),n(15," AI \u591A\u89D2\u8272\u71DF\u92B7 "),o(),r(16,"button",51),_("click",function(){v(e);let s=c();return b(s.batchDelete())}),r(17,"span"),n(18),o(),n(19),o(),r(20,"button",52),_("click",function(){v(e);let s=c();return b(s.clearSelection())}),n(21," \u2716 \u53D6\u6D88\u9078\u64C7 "),o()()}if(a&2){let e=c();l(2),x(" \u{1F446} \u5DF2\u9078\u64C7 ",e.selectedCount()," \u500B\u5BA2\u6236 - \u8ACB\u9078\u64C7\u6279\u91CF\u64CD\u4F5C "),l(14),E("disabled",e.isDeleting()),l(2),h(e.isDeleting()?"\u23F3":"\u{1F5D1}\uFE0F"),l(),x(" ",e.isDeleting()?"\u522A\u9664\u4E2D...":"\u522A\u9664"," ")}}function Ge(a,t){if(a&1){let e=w();r(0,"div",41)(1,"span",53),n(2,"\u{1F4ED}"),o(),r(3,"p",54),n(4,"\u66AB\u7121\u5BA2\u6236\u6578\u64DA"),o(),r(5,"p",55),n(6,"\u8ACB\u5148\u5230\u300C\u8CC7\u6E90\u4E2D\u5FC3\u300D\u6DFB\u52A0\u5BA2\u6236\uFF0C\u6216\u5F9E\u76E3\u63A7\u7FA4\u7D44\u81EA\u52D5\u6536\u96C6"),o(),r(7,"button",56),_("click",function(){v(e);let s=c();return b(s.goToResourceCenter())}),n(8," \u524D\u5F80\u8CC7\u6E90\u4E2D\u5FC3 \u2192 "),o()()}}function ze(a,t){if(a&1&&(r(0,"p",65),n(1),o()),a&2){let e=c().$implicit;l(),x("@",e.username)}}function Oe(a,t){a&1&&(r(0,"div",70),n(1," \u2B06\uFE0F \u8ACB\u4F7F\u7528\u4E0A\u65B9\u6279\u91CF\u64CD\u4F5C\u6B04 "),o())}function je(a,t){if(a&1){let e=w();r(0,"button",71),_("click",function(s){v(e);let m=c().$implicit;return c(2).sendMessage(m),b(s.stopPropagation())}),n(1," \u{1F4AC} \u767C\u9001 "),o(),r(2,"button",72),_("click",function(s){v(e);let m=c().$implicit;return c(2).inviteToGroup(m),b(s.stopPropagation())}),n(3," \u{1F465} \u62C9\u7FA4 "),o(),r(4,"button",73),_("click",function(s){v(e);let m=c().$implicit;return c(2).deleteContact(m),b(s.stopPropagation())}),n(5," \u{1F5D1}\uFE0F "),o()}}function Ue(a,t){if(a&1){let e=w();r(0,"div",58),_("click",function(){let s=v(e).$implicit,m=c(2);return b(m.toggleSelect(s.id))}),r(1,"div",59)(2,"input",60),_("change",function(){let s=v(e).$implicit,m=c(2);return b(m.toggleSelect(s.id))})("click",function(s){return v(e),b(s.stopPropagation())}),o()(),r(3,"div",61)(4,"div",62),n(5),o(),r(6,"div",63)(7,"p",64),n(8),o(),f(9,ze,2,1,"p",65),o()(),r(10,"div",66)(11,"span",67),n(12),o(),r(13,"span",68),n(14),o()(),r(15,"div",69),f(16,Oe,2,0,"div",70)(17,je,6,0),o()()}if(a&2){let e=t.$implicit,i=c(2);k("ring-2",i.isSelected(e.id))("ring-cyan-500",i.isSelected(e.id)),l(2),E("checked",i.isSelected(e.id)),l(3),x(" ",i.getInitial(e)," "),l(3),h(e.display_name||e.username||e.telegram_id),l(),C(e.username?9:-1),l(3),x(" ",e.source_name||e.source_type||"\u672A\u77E5\u4F86\u6E90"," "),l(),L(i.getStatusClass(e.status)),l(),x(" ",i.getStatusLabel(e.status)," "),l(2),C(i.selectedIds().size>1?16:17)}}function qe(a,t){if(a&1&&(r(0,"div",42),T(1,Ue,18,13,"div",57,ue),o()),a&2){let e=c();l(),F(e.filteredContacts())}}function He(a,t){if(a&1&&(r(0,"p",82),n(1),o()),a&2){let e=c().$implicit;l(),x("@",e.username)}}function Je(a,t){a&1&&(r(0,"div",85),n(1," \u2B06\uFE0F \u4F7F\u7528\u6279\u91CF\u64CD\u4F5C "),o())}function We(a,t){if(a&1){let e=w();r(0,"div",32)(1,"button",86),_("click",function(){v(e);let s=c().$implicit,m=c(2);return b(m.sendMessage(s))}),n(2," \u{1F4AC} "),o(),r(3,"button",87),_("click",function(){v(e);let s=c().$implicit,m=c(2);return b(m.inviteToGroup(s))}),n(4," \u{1F465} "),o(),r(5,"button",88),_("click",function(){v(e);let s=c().$implicit,m=c(2);return b(m.viewContact(s))}),n(6," \u{1F441}\uFE0F "),o(),r(7,"button",89),_("click",function(){v(e);let s=c().$implicit,m=c(2);return b(m.deleteContact(s))}),n(8," \u{1F5D1}\uFE0F "),o()()}}function Ke(a,t){if(a&1){let e=w();r(0,"tr",78)(1,"td",79)(2,"input",76),_("change",function(){let s=v(e).$implicit,m=c(2);return b(m.toggleSelect(s.id))}),o()(),r(3,"td",79)(4,"div",2)(5,"div",80),n(6),o(),r(7,"div")(8,"p",81),n(9),o(),f(10,He,2,1,"p",82),o()()(),r(11,"td",83)(12,"span",84),n(13),o()(),r(14,"td",79)(15,"span",68),n(16),o()(),r(17,"td",79),f(18,Je,2,0,"div",85)(19,We,9,0,"div",32),o()()}if(a&2){let e=t.$implicit,i=c(2);l(2),E("checked",i.isSelected(e.id)),l(4),x(" ",i.getInitial(e)," "),l(3),h(e.display_name||e.username||e.telegram_id),l(),C(e.username?10:-1),l(3),h(e.source_name||e.source_type||"-"),l(2),L(i.getStatusClass(e.status)),l(),x(" ",i.getStatusLabel(e.status)," "),l(2),C(i.selectedIds().size>1?18:19)}}function Qe(a,t){if(a&1){let e=w();r(0,"table",43)(1,"thead")(2,"tr",74)(3,"th",75)(4,"input",76),_("change",function(){v(e);let s=c();return b(s.toggleSelectAll())}),o()(),r(5,"th",77),n(6,"\u5BA2\u6236"),o(),r(7,"th",77),n(8,"\u4F86\u6E90"),o(),r(9,"th",77),n(10,"\u72C0\u614B"),o(),r(11,"th",77),n(12,"\u64CD\u4F5C"),o()()(),r(13,"tbody"),T(14,Ke,20,9,"tr",78,ue),o()()}if(a&2){let e=c();l(4),E("checked",e.isAllSelected()),l(10),F(e.filteredContacts())}}var ce=class a{constructor(){this.i18n=D(re);this.nav=D(le);this.ipc=D(ee);this.toast=D(te);this.dialog=D(ie);this.exportService=D(se);this.membershipService=D(ne);this.contactsService=D(oe);this.searchTerm=g("");this.statusFilter=g("");this.selectedIds=g(new Set);this.viewMode=g("card");this.showToolsPanel=g(!1);this.isDeleting=g(!1);this.isSending=g(!1);this.isInviting=g(!1);this.sendProgress=g({sent:0,total:0,success:0,failed:0});this.inviteProgress=g({invited:0,total:0,success:0,failed:0,skipped:0});this.contacts=S(()=>this.contactsService.contacts());this.filteredContacts=S(()=>{let t=this.contacts(),e=this.searchTerm().toLowerCase(),i=this.statusFilter();return t=t.filter(s=>s.contact_type==="user"),e&&(t=t.filter(s=>s.display_name?.toLowerCase().includes(e)||s.username?.toLowerCase().includes(e)||s.telegram_id?.toString().includes(e)||s.source_name?.toLowerCase().includes(e))),i&&(t=t.filter(s=>s.status===i)),t});this.pendingCount=S(()=>this.contacts().filter(t=>t.contact_type==="user"&&t.status==="new").length);this.sentCount=S(()=>this.contacts().filter(t=>t.contact_type==="user"&&t.status==="contacted").length);this.repliedCount=S(()=>this.contacts().filter(t=>t.contact_type==="user"&&t.status==="replied").length);this.failedCount=S(()=>this.contacts().filter(t=>t.contact_type==="user"&&t.status==="failed").length);this.selectedCount=S(()=>this.selectedIds().size);this.ipcCleanup=[]}ngOnInit(){this.contactsService.loadContacts(),this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(t=>t())}setupIpcListeners(){let t=this.ipc.on("message-sent",p=>{p.success?(this.toast.success("\u6D88\u606F\u767C\u9001\u6210\u529F"),p.telegramId&&this.contactsService.updateContactStatus(p.telegramId,"contacted")):p.telegramId&&this.contactsService.updateContactStatus(p.telegramId,"failed")}),e=this.ipc.on("private-message-received",p=>{p.telegramId&&(this.contactsService.updateContactStatus(p.telegramId,"replied"),this.toast.info("\u6536\u5230\u5BA2\u6236\u56DE\u8986"))}),i=this.ipc.on("batch-send:progress",p=>{this.sendProgress.set(p),console.log(`\u767C\u9001\u9032\u5EA6: ${p.sent}/${p.total}, \u6210\u529F: ${p.success}, \u5931\u6557: ${p.failed}`)}),s=this.ipc.on("batch-send:complete",p=>{this.isSending.set(!1),this.sendProgress.set({sent:0,total:0,success:0,failed:0}),p.failed>0?this.toast.warning(`\u6279\u91CF\u767C\u9001\u5B8C\u6210: \u6210\u529F ${p.success}\uFF0C\u5931\u6557 ${p.failed}${p.failureSummary?` (${p.failureSummary})`:""}`):this.toast.success(`\u6279\u91CF\u767C\u9001\u5B8C\u6210: \u6210\u529F ${p.success} \u689D`),this.contactsService.loadContacts()}),m=this.ipc.on("batch-invite:progress",p=>{this.inviteProgress.set(p),console.log(`\u62C9\u7FA4\u9032\u5EA6: ${p.invited}/${p.total}`)}),y=this.ipc.on("batch-invite:complete",p=>{this.isInviting.set(!1),this.inviteProgress.set({invited:0,total:0,success:0,failed:0,skipped:0}),this.toast.success(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210: \u6210\u529F ${p.success}\uFF0C\u8DF3\u904E ${p.skipped}\uFF0C\u5931\u6557 ${p.failed}`),this.contactsService.loadContacts()});this.ipcCleanup.push(t,e,i,s,m,y)}refresh(){this.contactsService.loadContacts(),this.toast.info("\u6B63\u5728\u5237\u65B0...")}goToResourceCenter(){this.nav.navigateTo("resource-center")}isSelected(t){return this.selectedIds().has(t)}toggleSelect(t){this.selectedIds.update(e=>{let i=new Set(e);return i.has(t)?i.delete(t):i.add(t),i})}isAllSelected(){let t=this.filteredContacts();return t.length>0&&t.every(e=>this.selectedIds().has(e.id))}isPartialSelected(){let t=this.filteredContacts(),e=this.selectedIds().size;return e>0&&e<t.length&&!this.isAllSelected()}toggleSelectAll(){let t=this.filteredContacts();this.isAllSelected()?this.selectedIds.set(new Set):this.selectedIds.set(new Set(t.map(e=>e.id)))}selectAll(){let t=this.filteredContacts();this.selectedIds.set(new Set(t.map(e=>e.id))),this.toast.info(`\u5DF2\u5168\u9078 ${t.length} \u500B\u5BA2\u6236`)}invertSelection(){let t=this.filteredContacts(),e=this.selectedIds(),i=new Set;t.forEach(s=>{e.has(s.id)||i.add(s.id)}),this.selectedIds.set(i),this.toast.info(`\u5DF2\u9078\u64C7 ${i.size} \u500B\u5BA2\u6236`)}batchSend(){let t=this.contacts().filter(i=>this.selectedIds().has(i.id));if(t.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}let e=this.convertToSendTargets(t);if(e.length===0){this.toast.error("\u9078\u4E2D\u7684\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.dialog.openBatchSend(e)}sendMessage(t){let e=this.convertToSendTargets([t]);if(e.length===0){this.toast.error("\u6B64\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.dialog.openBatchSend(e)}convertToSendTargets(t){return t.filter(e=>e.telegram_id).map(e=>({telegramId:e.telegram_id,username:e.username||"",firstName:e.first_name||e.display_name?.split(" ")[0]||"",lastName:e.last_name||e.display_name?.split(" ")[1]||"",displayName:e.display_name||e.username||e.telegram_id,groupName:e.source_name||"",source:e.source_type||""}))}batchInvite(){let t=this.contacts().filter(i=>this.selectedIds().has(i.id));if(t.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}let e=t.map(i=>({telegramId:i.telegram_id||String(i.id),username:i.username||"",firstName:i.first_name||i.display_name?.split(" ")[0]||"",lastName:i.last_name||i.display_name?.split(" ")[1]||""}));this.dialog.openBatchInvite(e)}inviteToGroup(t){let e={telegramId:t.telegram_id||String(t.id),username:t.username||"",firstName:t.first_name||t.display_name?.split(" ")[0]||"",lastName:t.last_name||t.display_name?.split(" ")[1]||""};this.dialog.openBatchInvite([e])}batchDelete(){let t=this.selectedIds().size;if(t===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}if(this.isDeleting()){this.toast.warning("\u6B63\u5728\u522A\u9664\u4E2D\uFF0C\u8ACB\u7A0D\u5019...");return}if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u9078\u4E2D\u7684 ${t} \u500B\u5BA2\u6236\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002`))return;let i=this.contacts().filter(m=>this.selectedIds().has(m.id)).map(m=>m.telegram_id).filter(Boolean);if(i.length===0){this.toast.error("\u9078\u4E2D\u7684\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.isDeleting.set(!0),this.contactsService.deleteContacts(i),this.toast.info(`\u6B63\u5728\u522A\u9664 ${i.length} \u500B\u5BA2\u6236...`);let s=this.ipc.once("unified-contacts:delete-result",m=>{this.isDeleting.set(!1),m.success?(this.toast.success(`\u5DF2\u522A\u9664 ${m.deleted||m.leadsDeleted||i.length} \u500B\u5BA2\u6236`),this.clearSelection()):this.toast.error(`\u522A\u9664\u5931\u6557: ${m.error||"\u672A\u77E5\u932F\u8AA4"}`)});setTimeout(()=>{this.isDeleting()&&(this.isDeleting.set(!1),this.toast.warning("\u522A\u9664\u64CD\u4F5C\u8D85\u6642\uFF0C\u8ACB\u5237\u65B0\u9801\u9762\u67E5\u770B\u7D50\u679C"))},3e4)}deleteContact(t){if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236\u300C${t.display_name||t.username||t.telegram_id}\u300D\u55CE\uFF1F`))return;if(!t.telegram_id){this.toast.error("\u6B64\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.isDeleting.set(!0),this.contactsService.deleteContacts([t.telegram_id]),this.toast.info("\u6B63\u5728\u522A\u9664\u5BA2\u6236...");let e=this.ipc.once("unified-contacts:delete-result",i=>{this.isDeleting.set(!1),i.success?this.toast.success("\u5BA2\u6236\u5DF2\u522A\u9664"):this.toast.error(`\u522A\u9664\u5931\u6557: ${i.error||"\u672A\u77E5\u932F\u8AA4"}`)})}clearSelection(){this.selectedIds.set(new Set)}viewContact(t){console.log("View contact:",t)}getInitial(t){return(t.display_name||t.username||t.telegram_id||"?").charAt(0).toUpperCase()}getStatusClass(t){return{new:"bg-blue-500/20 text-blue-400",contacted:"bg-emerald-500/20 text-emerald-400",replied:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",blacklisted:"bg-slate-500/20 text-slate-400"}[t]||"bg-slate-500/20 text-slate-400"}getStatusLabel(t){return{new:"\u5F85\u767C\u9001",contacted:"\u5DF2\u767C\u9001",replied:"\u5DF2\u56DE\u8986",failed:"\u767C\u9001\u5931\u6557",blacklisted:"\u5DF2\u62C9\u9ED1"}[t]||t||"\u672A\u77E5"}startMultiRoleCollaboration(){let t=this.contacts().filter(i=>this.selectedIds().has(i.id));if(t.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}let e=t.map(i=>({id:i.id?.toString()||i.telegram_id,telegramId:i.telegram_id||i.id?.toString()||"",username:i.username,firstName:i.first_name||i.display_name?.split(" ")[0],lastName:i.last_name||i.display_name?.split(" ")[1],intentScore:this.calculateContactIntent(i),source:i.source_type||"leads"}));sessionStorage.setItem("multiRoleTargetUsers",JSON.stringify(e)),this.toast.success(`\u{1F916} \u5DF2\u9078\u64C7 ${e.length} \u500B\u76EE\u6A19\uFF0C\u6B63\u5728\u8DF3\u8F49\u5230\u591A\u89D2\u8272\u5354\u4F5C\u4E2D\u5FC3...`),this.ipc.send("navigate-to-multi-role",{targetUsers:e}),setTimeout(()=>{this.ipc.send("multi-role:open-ai-planner",{targetUsers:e})},500)}calculateContactIntent(t){let e=30;return t.status==="replied"?e+=30:t.status==="contacted"?e+=15:t.status==="new"&&(e+=10),t.source_type==="lead"?e+=20:t.source_type==="member"&&(e+=10),t.tags?.includes("\u9AD8\u610F\u5411")?e+=25:t.tags?.includes("\u6709\u8208\u8DA3")&&(e+=15),t.last_message_at&&(e+=10),Math.min(100,e)}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=V({type:a,selectors:[["app-leads-view"]],decls:103,vars:46,consts:[[1,"page-content"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-2xl","font-bold",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","transition-colors",2,"background-color","var(--bg-tertiary)","color","var(--text-primary)",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","disabled:opacity-50",3,"click","disabled"],[1,"mb-6","animate-in","slide-in-from-top"],[1,"grid","grid-cols-2","md:grid-cols-5","gap-4","mb-6"],[1,"rounded-xl","p-4","text-center",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"text-2xl","mb-1"],[1,"text-sm",2,"color","var(--text-muted)"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-blue-400"],[1,"text-xl","font-bold","text-emerald-400"],[1,"text-xl","font-bold","text-green-400"],[1,"text-xl","font-bold","text-red-400"],[1,"flex","items-center","gap-4","mb-6"],[1,"flex-1","relative"],["type","text","placeholder","\u641C\u7D22\u5BA2\u6236\u540D\u7A31\u3001\u7528\u6236\u540D\u6216\u4F86\u6E90...",1,"w-full","py-3","px-4","pl-10","rounded-xl",2,"background-color","var(--bg-tertiary)","color","var(--text-primary)","border","1px solid var(--border-color)",3,"ngModelChange","ngModel"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-400"],[1,"py-3","px-4","rounded-xl",2,"background-color","var(--bg-tertiary)","color","var(--text-primary)","border","1px solid var(--border-color)",3,"ngModelChange","ngModel"],["value",""],["value","new"],["value","contacted"],["value","replied"],["value","failed"],[1,"flex","rounded-lg","overflow-hidden",2,"border","1px solid var(--border-color)"],[1,"p-2","px-3","transition-colors",3,"click"],[1,"flex","items-center","gap-4","mb-4","p-3","rounded-xl",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],["type","checkbox",1,"w-5","h-5","rounded","accent-cyan-500","cursor-pointer",3,"change","checked","indeterminate"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-colors",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-colors",2,"background-color","var(--bg-tertiary)","color","var(--text-muted)",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-colors","disabled:opacity-50",2,"background-color","var(--bg-tertiary)","color","var(--text-muted)",3,"click","disabled"],[1,"w-px","h-6","bg-slate-700"],[1,"px-3","py-1","rounded-full","text-sm","font-medium","bg-cyan-500/20","text-cyan-400"],[1,"flex-1"],[1,"sticky","top-0","z-50","flex","items-center","gap-4","mb-4","p-4","rounded-xl","border","transition-all","duration-300","shadow-lg","backdrop-blur-sm","bg-gradient-to-r","from-amber-500/30","to-orange-500/30","border-amber-500/50",2,"background-color","rgba(15, 23, 42, 0.95)"],[1,"rounded-xl","overflow-hidden",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"p-12","text-center",2,"color","var(--text-muted)"],[1,"p-4","grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],[1,"w-full"],[1,"flex","items-center","gap-1.5","px-3","py-1.5","rounded-lg","text-xs","bg-cyan-500","hover:bg-cyan-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-1.5","px-3","py-1.5","rounded-lg","text-xs","bg-purple-500","hover:bg-purple-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-1.5","px-3","py-1.5","rounded-lg","text-xs","bg-red-500/20","hover:bg-red-500/30","text-red-400","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-amber-400","font-bold","text-lg"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-cyan-500","hover:bg-cyan-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-purple-500","hover:bg-purple-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-gradient-to-r","from-pink-500","to-purple-500","hover:opacity-90","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-red-500/20","hover:bg-red-500/30","text-red-400","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center","gap-2","px-3","py-2","rounded-lg","hover:bg-slate-700/50","transition-colors","text-slate-400",3,"click"],[1,"text-5xl","mb-4","block"],[1,"text-lg","mb-2"],[1,"text-sm","mb-4"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"rounded-xl","p-4","transition-all","hover:scale-[1.02]","cursor-pointer","relative","group",2,"background-color","var(--bg-tertiary)","border","1px solid var(--border-color)",3,"ring-2","ring-cyan-500"],[1,"rounded-xl","p-4","transition-all","hover:scale-[1.02]","cursor-pointer","relative","group",2,"background-color","var(--bg-tertiary)","border","1px solid var(--border-color)",3,"click"],[1,"absolute","top-3","right-3"],["type","checkbox",1,"rounded","w-5","h-5","accent-cyan-500","cursor-pointer",3,"change","click","checked"],[1,"flex","items-center","gap-3","mb-3"],[1,"w-12","h-12","rounded-full","bg-gradient-to-r","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-white","font-bold","text-lg","shadow-lg"],[1,"flex-1","min-w-0"],[1,"font-medium","truncate",2,"color","var(--text-primary)"],[1,"text-xs","truncate",2,"color","var(--text-muted)"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-xs","px-2","py-1","rounded","bg-slate-700/50",2,"color","var(--text-muted)"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],[1,"flex","items-center","gap-2","pt-2","border-t",2,"border-color","var(--border-color)"],[1,"flex-1","text-center","py-2","text-xs","text-amber-400"],[1,"flex-1","flex","items-center","justify-center","gap-1","py-2","rounded-lg","text-xs","font-medium","transition-colors","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400",3,"click"],[1,"flex-1","flex","items-center","justify-center","gap-1","py-2","rounded-lg","text-xs","font-medium","transition-colors","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400",3,"click"],["title","\u522A\u9664",1,"p-2","rounded-lg","text-xs","transition-colors","hover:bg-red-500/20","text-red-400",3,"click"],[2,"background-color","var(--bg-tertiary)"],[1,"py-3","px-4","text-left","text-sm","font-medium","w-10",2,"color","var(--text-muted)"],["type","checkbox",1,"rounded",3,"change","checked"],[1,"py-3","px-4","text-left","text-sm","font-medium",2,"color","var(--text-muted)"],[1,"border-t","transition-colors","hover:bg-slate-800/30",2,"border-color","var(--border-color)"],[1,"py-3","px-4"],[1,"w-10","h-10","rounded-full","bg-gradient-to-r","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-white","font-bold"],[1,"font-medium",2,"color","var(--text-primary)"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"py-3","px-4",2,"color","var(--text-muted)"],[1,"text-xs","px-2","py-1","rounded","bg-slate-700/50"],[1,"text-xs","text-amber-400"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","rounded-lg","hover:bg-cyan-500/20","transition-colors","text-cyan-400",3,"click"],["title","\u62C9\u7FA4",1,"p-2","rounded-lg","hover:bg-purple-500/20","transition-colors","text-purple-400",3,"click"],["title","\u67E5\u770B\u8A73\u60C5",1,"p-2","rounded-lg","hover:bg-slate-700/50","transition-colors","text-slate-400",3,"click"],["title","\u522A\u9664",1,"p-2","rounded-lg","hover:bg-red-500/20","transition-colors","text-red-400",3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"\u{1F4E4}"),o(),r(5,"h2",4),n(6,"\u767C\u9001\u63A7\u5236\u53F0"),o()(),r(7,"div",2)(8,"button",5),_("click",function(){return i.showToolsPanel.set(!i.showToolsPanel())}),r(9,"span"),n(10,"\u2B50"),o(),n(11," \u8A55\u5206 & \u53BB\u91CD "),o(),r(12,"button",6),_("click",function(){return i.refresh()}),r(13,"span"),n(14,"\u{1F504}"),o(),n(15," \u5237\u65B0 "),o(),r(16,"button",7),_("click",function(){return i.batchSend()}),r(17,"span"),n(18,"\u{1F4E8}"),o(),n(19," \u6279\u91CF\u767C\u9001 "),o()()(),f(20,Ie,2,0,"div",8),r(21,"div",9)(22,"div",10)(23,"div",11),n(24,"\u{1F465}"),o(),r(25,"div",12),n(26,"\u7E3D\u5BA2\u6236"),o(),r(27,"div",13),n(28),o()(),r(29,"div",10)(30,"div",11),n(31,"\u23F3"),o(),r(32,"div",12),n(33,"\u5F85\u767C\u9001"),o(),r(34,"div",14),n(35),o()(),r(36,"div",10)(37,"div",11),n(38,"\u2705"),o(),r(39,"div",12),n(40,"\u5DF2\u767C\u9001"),o(),r(41,"div",15),n(42),o()(),r(43,"div",10)(44,"div",11),n(45,"\u{1F4AC}"),o(),r(46,"div",12),n(47,"\u5DF2\u56DE\u8986"),o(),r(48,"div",16),n(49),o()(),r(50,"div",10)(51,"div",11),n(52,"\u274C"),o(),r(53,"div",12),n(54,"\u767C\u9001\u5931\u6557"),o(),r(55,"div",17),n(56),o()()(),r(57,"div",18)(58,"div",19)(59,"input",20),_("ngModelChange",function(m){return i.searchTerm.set(m)}),o(),r(60,"span",21),n(61,"\u{1F50D}"),o()(),r(62,"select",22),_("ngModelChange",function(m){return i.statusFilter.set(m)}),r(63,"option",23),n(64,"\u5168\u90E8\u72C0\u614B"),o(),r(65,"option",24),n(66,"\u5F85\u767C\u9001"),o(),r(67,"option",25),n(68,"\u5DF2\u767C\u9001"),o(),r(69,"option",26),n(70,"\u5DF2\u56DE\u8986"),o(),r(71,"option",27),n(72,"\u767C\u9001\u5931\u6557"),o()(),r(73,"div",28)(74,"button",29),_("click",function(){return i.viewMode.set("list")}),n(75," \u{1F4CB} "),o(),r(76,"button",29),_("click",function(){return i.viewMode.set("card")}),n(77," \u{1F0CF} "),o()()(),r(78,"div",30)(79,"div",2)(80,"input",31),_("change",function(){return i.toggleSelectAll()}),o(),r(81,"span",12),f(82,Ve,1,0)(83,Me,1,0)(84,Pe,1,0),o()(),r(85,"div",32)(86,"button",33),_("click",function(){return i.selectAll()}),n(87),o(),r(88,"button",34),_("click",function(){return i.invertSelection()}),n(89," \u{1F504} \u53CD\u9078 "),o(),r(90,"button",35),_("click",function(){return i.clearSelection()}),n(91," \u2716 \u6E05\u9664 "),o()(),A(92,"div",36),r(93,"div",32),f(94,Be,2,1,"span",37)(95,Re,2,1,"span",12),o(),A(96,"div",38),f(97,$e,7,1,"div",32),o(),f(98,Ne,22,4,"div",39),r(99,"div",40),f(100,Ge,9,0,"div",41)(101,qe,3,0,"div",42)(102,Qe,16,1,"table",43),o()()),e&2&&(l(8),I("background-color",i.showToolsPanel()?"":"var(--bg-tertiary)")("color",i.showToolsPanel()?"":"var(--text-primary)"),k("bg-amber-500",i.showToolsPanel())("text-white",i.showToolsPanel()),l(8),E("disabled",i.selectedCount()===0),l(4),C(i.showToolsPanel()?20:-1),l(8),h(i.contacts().length),l(7),h(i.pendingCount()),l(7),h(i.sentCount()),l(7),h(i.repliedCount()),l(7),h(i.failedCount()),l(3),E("ngModel",i.searchTerm()),l(3),E("ngModel",i.statusFilter()),l(12),I("background-color",i.viewMode()!=="list"?"var(--bg-tertiary)":""),k("bg-cyan-500",i.viewMode()==="list")("text-white",i.viewMode()==="list"),l(2),I("background-color",i.viewMode()!=="card"?"var(--bg-tertiary)":""),k("bg-cyan-500",i.viewMode()==="card")("text-white",i.viewMode()==="card"),l(4),E("checked",i.isAllSelected())("indeterminate",i.isPartialSelected()),l(2),C(i.isAllSelected()?82:i.isPartialSelected()?83:84),l(4),I("background-color",i.isAllSelected()?"":"var(--bg-tertiary)")("color",i.isAllSelected()?"":"var(--text-muted)"),k("bg-cyan-500",i.isAllSelected())("text-white",i.isAllSelected()),l(),x(" \u2611\uFE0F \u5168\u9078 (",i.filteredContacts().length,") "),l(3),E("disabled",i.selectedCount()===0),l(4),C(i.selectedCount()>0?94:95),l(3),C(i.selectedCount()>0?97:-1),l(),C(i.selectedCount()>1?98:-1),l(2),C(i.filteredContacts().length===0?100:i.viewMode()==="card"?101:102))},dependencies:[B,Z,X,Y,J,Q,W,K,$],encapsulation:2,changeDetection:0})}};export{R as a,ce as b};
