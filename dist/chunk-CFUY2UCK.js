import{a as U}from"./chunk-SJSUUKGP.js";import{b as V,c as N,f as R,h as j,n as q,o as H,t as L}from"./chunk-36YFMG3E.js";import{a as $}from"./chunk-B6NL44GT.js";import{g as B}from"./chunk-N7GMY4UM.js";import{Aa as a,Ab as D,Eb as v,Fb as M,Gb as y,Ia as b,Mb as F,Na as A,Sa as g,Vb as O,W as _,X as h,eb as c,fb as i,ga as x,gb as o,lb as w,lc as I,mc as z,nb as u,pb as m,qc as T,ub as W,vb as C,xb as r,yb as p,zb as f}from"./chunk-YLSLTE5F.js";var J=()=>[];function K(d,e){if(d&1){let t=w();i(0,"button",30),u("click",function(){let l=_(t).$implicit,s=m();return h(s.setAmount(l))}),r(1),o()}if(d&2){let t=e.$implicit,n=m();C("active",n.withdrawAmount===t),a(),f(" ",n.formatAmount(t*100)," ")}}function Q(d,e){d&1&&(i(0,"span",37),r(1,"\u5373\u5C07\u4E0A\u7DDA"),o())}function X(d,e){d&1&&(i(0,"span",38),r(1,"\u2713"),o())}function Y(d,e){if(d&1){let t=w();i(0,"div",31),u("click",function(){let l=_(t).$implicit,s=m();return h(l.enabled&&s.selectMethod(l.id))}),i(1,"span",32),r(2),o(),i(3,"div",33)(4,"span",34),r(5),o(),g(6,Q,2,0,"span",35),o(),g(7,X,2,0,"span",36),o()}if(d&2){let t=e.$implicit,n=m();C("selected",n.selectedMethod===t.id)("disabled",!t.enabled),a(2),p(n.getMethodIcon(t.id)),a(3),p(t.name),a(),c("ngIf",!t.enabled),a(),c("ngIf",n.selectedMethod===t.id)}}function Z(d,e){if(d&1){let t=w();i(0,"div",9)(1,"h2"),r(2),o(),i(3,"input",39),y("ngModelChange",function(l){_(t);let s=m();return M(s.withdrawAddress,l)||(s.withdrawAddress=l),h(l)}),o(),i(4,"div",40),r(5,"\u8ACB\u78BA\u4FDD\u5730\u5740\u6B63\u78BA\uFF0C\u63D0\u73FE\u5F8C\u7121\u6CD5\u64A4\u56DE"),o()()}if(d&2){let t=m();a(2),p(t.getMethodLabel(t.selectedMethod)),a(),v("ngModel",t.withdrawAddress),c("placeholder",t.getAddressPlaceholder(t.selectedMethod))}}function ee(d,e){d&1&&(i(0,"div",41),r(1," \u{1F389} \u672C\u6708\u514D\u8CBB\u63D0\u73FE\u6A5F\u6703\uFF0C\u624B\u7E8C\u8CBB $0 "),o())}function te(d,e){if(d&1&&(i(0,"div",50)(1,"div",51)(2,"div",52)(3,"div",53),r(4),o(),i(5,"div",54),r(6),o()(),i(7,"div",55)(8,"div",56),r(9),o(),i(10,"div",57),r(11),o()()(),i(12,"div",58)(13,"span"),r(14),o()()()),d&2){let t=e.$implicit,n=m(2);a(4),p(t.order_no),a(2),p(n.formatDate(t.created_at)),a(3),p(t.actual_display),a(),W("color",n.getStatusColor(t.status)),a(),f(" ",n.getStatusName(t.status)," "),a(3),D("",t.method," \u2192 ",n.maskAddress(t.address))}}function ne(d,e){d&1&&(i(0,"div",59),r(1," \u66AB\u7121\u63D0\u73FE\u8A18\u9304 "),o())}function ie(d,e){if(d&1){let t=w();i(0,"div",42),u("click",function(){_(t);let l=m();return h(l.closeHistory())}),i(1,"div",43),u("click",function(l){return _(t),h(l.stopPropagation())}),i(2,"div",44)(3,"h3"),r(4,"\u63D0\u73FE\u8A18\u9304"),o(),i(5,"button",45),u("click",function(){_(t);let l=m();return h(l.closeHistory())}),r(6,"\xD7"),o()(),i(7,"div",46)(8,"div",47),g(9,te,15,8,"div",48)(10,ne,2,0,"div",49),o()()()()}if(d&2){let t=m();a(9),c("ngForOf",t.withdrawOrders()),a(),c("ngIf",t.withdrawOrders().length===0)}}var G=class d{constructor(e,t,n){this.walletService=e;this.api=t;this.router=n;this.withdrawAmount=0;this.selectedMethod="usdt_trc20";this.withdrawAddress="";this.quickAmounts=[10,50,100,500];this.config=x(null);this.loading=x(!1);this.showHistoryModal=x(!1);this.withdrawOrders=x([]);this.feeAmount=O(()=>{let e=this.config();if(!e)return 0;let t=this.withdrawAmountCents();if(t<=0)return 0;let n=Math.round(t*e.fee_rate);return Math.max(n,e.min_fee)});this.actualAmount=O(()=>this.withdrawAmountCents()-this.feeAmount())}ngOnInit(){this.loadConfig(),this.walletService.loadWallet()}async loadConfig(){try{let e=await this.api.get("/api/wallet/withdraw/config");e?.success&&e?.data&&this.config.set(e.data)}catch(e){console.error("Load withdraw config error:",e)}}withdrawAmountCents(){return(this.withdrawAmount||0)*100}isFreeWithdraw(){return!1}canSubmit(){let e=this.config();if(!e||this.loading())return!1;let t=this.withdrawAmountCents();return!(t<e.min_amount||t>e.max_amount||!this.selectedMethod||!this.withdrawAddress)}onAmountChange(){}setAmount(e){this.withdrawAmount=e}setMaxAmount(){let e=this.walletService.wallet();if(e){let t=this.config(),n=Math.min(e.balance,t?.max_amount||1e5);this.withdrawAmount=n/100}}selectMethod(e){this.selectedMethod=e,this.withdrawAddress=""}formatAmount(e){return"$"+(e/100).toFixed(2)}formatDate(e){return e?new Date(e).toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}getMethodIcon(e){return{usdt_trc20:"\u{1F48E}",usdt_erc20:"\u{1F48E}",bank:"\u{1F3E6}"}[e]||"\u{1F4B3}"}getMethodLabel(e){return{usdt_trc20:"USDT \u6536\u6B3E\u5730\u5740 (TRC20)",usdt_erc20:"USDT \u6536\u6B3E\u5730\u5740 (ERC20)",bank:"\u9280\u884C\u5361\u865F"}[e]||"\u6536\u6B3E\u5730\u5740"}getAddressPlaceholder(e){return{usdt_trc20:"\u8ACB\u8F38\u5165 TRC20 \u5730\u5740\uFF0C\u4EE5 T \u958B\u982D",usdt_erc20:"\u8ACB\u8F38\u5165 ERC20 \u5730\u5740\uFF0C\u4EE5 0x \u958B\u982D",bank:"\u8ACB\u8F38\u5165\u9280\u884C\u5361\u865F"}[e]||"\u8ACB\u8F38\u5165\u6536\u6B3E\u5730\u5740"}getStatusName(e){return{pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6279\u51C6",processing:"\u8655\u7406\u4E2D",completed:"\u5DF2\u5B8C\u6210",rejected:"\u5DF2\u62D2\u7D55",cancelled:"\u5DF2\u53D6\u6D88"}[e]||e}getStatusColor(e){return{pending:"#f59e0b",approved:"#3b82f6",processing:"#8b5cf6",completed:"#22c55e",rejected:"#ef4444",cancelled:"#9ca3af"}[e]||"#666"}maskAddress(e){return!e||e.length<10?e:e.slice(0,6)+"..."+e.slice(-4)}async submit(){if(this.canSubmit()){this.loading.set(!0);try{let e=await this.api.post("/api/wallet/withdraw/create",{amount:this.withdrawAmountCents(),method:this.selectedMethod,address:this.withdrawAddress});e?.success?(alert("\u63D0\u73FE\u7533\u8ACB\u5DF2\u63D0\u4EA4\uFF0C\u8ACB\u7B49\u5F85\u5BE9\u6838"),await this.walletService.loadWallet(),window.dispatchEvent(new CustomEvent("changeView",{detail:"wallet"}))):alert(e?.error||"\u63D0\u73FE\u5931\u6557")}catch(e){console.error("Submit withdraw error:",e),alert("\u63D0\u73FE\u5931\u6557")}finally{this.loading.set(!1)}}}async showHistory(){try{let e=await this.api.get("/api/wallet/withdraw/orders");e?.success&&e?.data?.orders&&this.withdrawOrders.set(e.data.orders)}catch(e){console.error("Load withdraw orders error:",e)}this.showHistoryModal.set(!0)}closeHistory(){this.showHistoryModal.set(!1)}goBack(){window.dispatchEvent(new CustomEvent("changeView",{detail:"wallet"}))}static{this.\u0275fac=function(t){return new(t||d)(b(U),b($),b(B))}}static{this.\u0275cmp=A({type:d,selectors:[["app-wallet-withdraw"]],decls:63,vars:18,consts:[[1,"withdraw-view"],[1,"view-header"],[1,"header-left"],[1,"back-btn",3,"click"],[1,"history-btn",3,"click"],[1,"balance-card"],[1,"balance-label"],[1,"balance-amount"],[1,"balance-note"],[1,"section"],[1,"amount-input"],[1,"currency"],["type","number","placeholder","\u8ACB\u8F38\u5165\u63D0\u73FE\u91D1\u984D",3,"ngModelChange","ngModel","min","max"],[1,"amount-hints"],[1,"quick-amounts"],["class","quick-btn",3,"active","click",4,"ngFor","ngForOf"],[1,"quick-btn","all",3,"click"],[1,"methods"],["class","method-item",3,"selected","disabled","click",4,"ngFor","ngForOf"],["class","section",4,"ngIf"],[1,"section","summary"],[1,"summary-row"],[1,"label"],[1,"value"],[1,"value","fee"],[1,"summary-row","total"],["class","free-note",4,"ngIf"],[1,"action-bar"],[1,"submit-btn",3,"click","disabled"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"quick-btn",3,"click"],[1,"method-item",3,"click"],[1,"method-icon"],[1,"method-info"],[1,"method-name"],["class","method-status",4,"ngIf"],["class","check",4,"ngIf"],[1,"method-status"],[1,"check"],["type","text",1,"address-input",3,"ngModelChange","ngModel","placeholder"],[1,"address-hint"],[1,"free-note"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"order-list"],["class","order-item",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"order-item"],[1,"order-main"],[1,"order-info"],[1,"order-no"],[1,"order-time"],[1,"order-amount"],[1,"amount"],[1,"status"],[1,"order-detail"],[1,"empty"]],template:function(t,n){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),u("click",function(){return n.goBack()}),r(4,"\u2190"),o(),i(5,"h1"),r(6,"\u63D0\u73FE"),o()(),i(7,"button",4),u("click",function(){return n.showHistory()}),r(8,"\u{1F4CB} \u63D0\u73FE\u8A18\u9304"),o()(),i(9,"div",5)(10,"div",6),r(11,"\u53EF\u63D0\u73FE\u9918\u984D"),o(),i(12,"div",7),r(13),o(),i(14,"div",8),r(15,"\u8D08\u9001\u9918\u984D\u4E0D\u53EF\u63D0\u73FE"),o()(),i(16,"div",9)(17,"h2"),r(18,"\u63D0\u73FE\u91D1\u984D"),o(),i(19,"div",10)(20,"span",11),r(21,"$"),o(),i(22,"input",12),y("ngModelChange",function(s){return M(n.withdrawAmount,s)||(n.withdrawAmount=s),s}),u("ngModelChange",function(){return n.onAmountChange()}),o()(),i(23,"div",13)(24,"span"),r(25),o(),i(26,"span"),r(27,"|"),o(),i(28,"span"),r(29),o()(),i(30,"div",14),g(31,K,2,3,"button",15),i(32,"button",16),u("click",function(){return n.setMaxAmount()}),r(33," \u5168\u90E8\u63D0\u73FE "),o()()(),i(34,"div",9)(35,"h2"),r(36,"\u63D0\u73FE\u65B9\u5F0F"),o(),i(37,"div",17),g(38,Y,8,8,"div",18),o()(),g(39,Z,6,3,"div",19),i(40,"div",20)(41,"h2"),r(42,"\u63D0\u73FE\u660E\u7D30"),o(),i(43,"div",21)(44,"span",22),r(45,"\u63D0\u73FE\u91D1\u984D"),o(),i(46,"span",23),r(47),o()(),i(48,"div",21)(49,"span",22),r(50),o(),i(51,"span",24),r(52),o()(),i(53,"div",25)(54,"span",22),r(55,"\u5BE6\u969B\u5230\u8CEC"),o(),i(56,"span",23),r(57),o()(),g(58,ee,2,0,"div",26),o(),i(59,"div",27)(60,"button",28),u("click",function(){return n.submit()}),r(61),o()(),g(62,ie,11,2,"div",29),o()),t&2){let l,s,E,P,k,S;a(13),p(n.walletService.balanceDisplay()),a(9),v("ngModel",n.withdrawAmount),c("min",(((l=n.config())==null?null:l.min_amount)||0)/100)("max",(((s=n.config())==null?null:s.max_amount)||0)/100),a(3),f("\u6700\u4F4E ",n.formatAmount(((E=n.config())==null?null:E.min_amount)||1e3)),a(4),f("\u55AE\u7B46\u4E0A\u9650 ",n.formatAmount(((P=n.config())==null?null:P.max_amount)||1e5)),a(2),c("ngForOf",n.quickAmounts),a(7),c("ngForOf",((k=n.config())==null?null:k.methods)||F(17,J)),a(),c("ngIf",n.selectedMethod),a(8),p(n.formatAmount(n.withdrawAmountCents())),a(3),f("\u624B\u7E8C\u8CBB (",(((S=n.config())==null?null:S.fee_rate)||0)*100,"%)"),a(2),f("-",n.formatAmount(n.feeAmount())),a(5),p(n.formatAmount(n.actualAmount())),a(),c("ngIf",n.isFreeWithdraw()),a(2),c("disabled",!n.canSubmit()),a(),f(" ",n.loading()?"\u8655\u7406\u4E2D...":"\u78BA\u8A8D\u63D0\u73FE"," "),a(),c("ngIf",n.showHistoryModal())}},dependencies:[T,I,z,L,V,j,N,H,q,R],styles:[".withdraw-view[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);padding:20px 20px 100px;color:#fff}.view-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.back-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;background:#ffffff1a;border:none;color:#fff;font-size:20px;cursor:pointer}h1[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin:0}.history-btn[_ngcontent-%COMP%]{padding:10px 16px;background:#ffffff1a;border:none;border-radius:10px;color:#fff;font-size:14px;cursor:pointer}.balance-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:20px;padding:24px;text-align:center;margin-bottom:24px}.balance-label[_ngcontent-%COMP%]{font-size:14px;opacity:.8}.balance-amount[_ngcontent-%COMP%]{font-size:36px;font-weight:700;margin:8px 0}.balance-note[_ngcontent-%COMP%]{font-size:12px;opacity:.6}.section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px;margin-bottom:20px}.section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin:0 0 16px}.amount-input[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffffff1a;border-radius:12px;padding:0 16px}.amount-input[_ngcontent-%COMP%]   .currency[_ngcontent-%COMP%]{font-size:24px;font-weight:600;opacity:.6}.amount-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:16px 12px;background:transparent;border:none;color:#fff;font-size:24px;font-weight:600}.amount-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#ffffff4d}.amount-hints[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:12px;font-size:12px;opacity:.6}.quick-amounts[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}.quick-btn[_ngcontent-%COMP%]{padding:10px 16px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:14px;cursor:pointer}.quick-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border-color:transparent}.quick-btn.all[_ngcontent-%COMP%]{flex:1;min-width:100px}.methods[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.method-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;background:#ffffff0d;border:2px solid transparent;border-radius:12px;cursor:pointer;transition:all .2s}.method-item[_ngcontent-%COMP%]:hover:not(.disabled){border-color:#fff3}.method-item.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea1a}.method-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.method-icon[_ngcontent-%COMP%]{font-size:24px}.method-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.method-name[_ngcontent-%COMP%]{font-size:15px;font-weight:500}.method-status[_ngcontent-%COMP%]{font-size:12px;opacity:.6}.check[_ngcontent-%COMP%]{color:#667eea;font-size:18px}.address-input[_ngcontent-%COMP%]{width:100%;padding:14px 16px;background:#ffffff1a;border:1px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:14px;font-family:monospace}.address-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.address-hint[_ngcontent-%COMP%]{font-size:12px;opacity:.5;margin-top:8px}.summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.05)}.summary-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{opacity:.7}.summary-row[_ngcontent-%COMP%]   .value.fee[_ngcontent-%COMP%]{color:#ef4444}.summary-row.total[_ngcontent-%COMP%]{padding-top:16px;font-size:18px;font-weight:600;border-bottom:none}.summary-row.total[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#22c55e}.free-note[_ngcontent-%COMP%]{text-align:center;padding:12px;background:#22c55e1a;border-radius:8px;color:#22c55e;font-size:13px;margin-top:12px}.action-bar[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;padding:16px 20px;background:#1a1a2ef2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.submit-btn[_ngcontent-%COMP%]{width:100%;padding:16px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:600;cursor:pointer}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:100;padding:20px}.modal[_ngcontent-%COMP%]{background:#1a1a2e;border-radius:20px;max-width:400px;width:100%;max-height:70vh;overflow:hidden}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid rgba(255,255,255,.1)}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px}.close-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:#ffffff1a;border:none;color:#fff;font-size:20px;cursor:pointer}.modal-body[_ngcontent-%COMP%]{padding:20px;max-height:50vh;overflow-y:auto}.order-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.order-item[_ngcontent-%COMP%]{padding:16px;background:#ffffff0d;border-radius:12px}.order-main[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.order-no[_ngcontent-%COMP%]{font-family:monospace;font-size:13px}.order-time[_ngcontent-%COMP%]{font-size:12px;opacity:.5}.order-amount[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:16px;font-weight:600;text-align:right}.order-amount[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{font-size:12px;text-align:right}.order-detail[_ngcontent-%COMP%]{font-size:12px;opacity:.6}.empty[_ngcontent-%COMP%]{text-align:center;padding:40px;opacity:.5}"]})}};export{G as a};
