import{a as _e,b as N}from"./chunk-HCWSPVSO.js";import{d as ge,e as ve}from"./chunk-6CC5VJPY.js";import{a as pe}from"./chunk-SHW2YL4T.js";import{a as xe}from"./chunk-AHIGNWD7.js";import{a as ee,b as ce,d as ue}from"./chunk-ITEZR6M3.js";import{a as de}from"./chunk-3V3KVMT4.js";import{b as me}from"./chunk-CXXWQ5XE.js";import{t as Z}from"./chunk-36YFMG3E.js";import{$a as b,Aa as a,Ab as P,M as U,Na as L,R as A,Vb as T,W as v,X as x,Xb as q,Y as O,Z as K,_a as f,a as h,b as E,ca as z,cb as I,db as V,eb as Y,fb as c,ga as S,gb as u,hb as B,ib as s,jb as l,kb as Q,lb as k,mb as J,nb as F,ob as w,pb as m,qc as $,ub as R,vb as D,wb as X,xb as n,yb as p,zb as _}from"./chunk-YLSLTE5F.js";var H=(o,t)=>t.id,Ce=(o,t)=>t.contactId;function we(o,t){o&1&&(O(),s(0,"svg",6),Q(1,"circle",30)(2,"path",31),l())}function Ee(o,t){o&1&&n(0," \u{1F504} ")}function ke(o,t){if(o&1&&(s(0,"span",38),n(1),l()),o&2){let e=m().$implicit,i=m();D("bg-green-500/20",e.change>=0)("text-green-400",e.change>=0)("bg-red-500/20",e.change<0)("text-red-400",e.change<0),a(),P(" ",e.change>=0?"\u2191":"\u2193"," ",i.Math.abs(e.change).toFixed(1),"% ")}}function Se(o,t){if(o&1&&(s(0,"div",37),n(1),l()),o&2){let e=m().$implicit;a(),p(e.changeLabel)}}function ye(o,t){if(o&1){let e=k();s(0,"div",32),w("click",function(){let r=v(e).$implicit,d=m();return x(d.onMetricClick(r))}),s(1,"div",33)(2,"span",34),n(3),l(),f(4,ke,2,10,"span",35),l(),s(5,"div",3),n(6),l(),s(7,"div",36),n(8),l(),f(9,Se,2,1,"div",37),l()}if(o&2){let e=t.$implicit;R("background",e.bgGradient)("border-color",e.color+"30"),a(3),p(e.icon),a(),b(e.change!==void 0?4:-1),a(2),p(e.value),a(2),p(e.label),a(),b(e.changeLabel?9:-1)}}function De(o,t){if(o&1){let e=k();s(0,"button",45),w("click",function(){v(e);let r=m().$implicit,d=m();return x(d.onInsightAction(r))}),n(1),l()}if(o&2){let e=m().$implicit;a(),_(" ",e.actionLabel," \u2192 ")}}function Te(o,t){if(o&1&&(s(0,"div",39)(1,"div",40)(2,"span",34),n(3),l(),s(4,"div",41)(5,"div",42),n(6),l(),s(7,"div",43),n(8),l(),f(9,De,2,1,"button",44),l()()()),o&2){let e=t.$implicit;D("border-green-500/30",e.type==="success")("border-yellow-500/30",e.type==="warning")("border-blue-500/30",e.type==="info")("border-purple-500/30",e.type==="tip"),a(3),p(e.icon),a(3),p(e.title),a(2),p(e.description),a(),b(e.actionLabel?9:-1)}}function Ae(o,t){if(o&1){let e=k();s(0,"div",46),w("click",function(){let r=v(e).$implicit,d=m();return x(d.onLeadClick(r))}),s(1,"div",47),n(2),l(),s(3,"div",48),n(4),l(),s(5,"div",49)(6,"div",50),n(7),l(),s(8,"div",36),n(9),l()(),s(10,"div",51)(11,"div",52),n(12),l(),s(13,"div",53),n(14),l()()()}if(o&2){let e=t.$implicit,i=t.$index,r=m();a(),D("bg-amber-500/20",i===0)("text-amber-400",i===0)("bg-slate-700",i!==0)("text-slate-400",i!==0),a(),_(" ",i+1," "),a(2),_(" ",r.getInitial(e.contactId)," "),a(3),_("\u5BA2\u6236 ",e.contactId.slice(-6)),a(2),P(" ",e.activityCount," \u6B21\u4E92\u52D5 \xB7 ",r.formatDate(e.lastActivity)," "),a(2),R("color",r.getHeatColor(e.heatLevel)),a(),_(" ",e.totalScore," "),a(),R("color",r.getHeatColor(e.heatLevel)),a(),P(" ",r.getHeatIcon(e.heatLevel)," ",r.getHeatLabel(e.heatLevel)," ")}}function Ie(o,t){o&1&&(s(0,"div",21)(1,"div",54),n(2,"\u{1F4ED}"),l(),s(3,"p"),n(4,"\u66AB\u7121\u71B1\u9580\u5BA2\u6236\u6578\u64DA"),l(),s(5,"p",55),n(6,"\u958B\u59CB\u767C\u9001\u6D88\u606F\u4EE5\u751F\u6210\u8A55\u5206"),l()())}function Ve(o,t){if(o&1){let e=k();s(0,"button",56),w("click",function(){let r=v(e).$implicit,d=m();return x(d.navigateTo.emit(r.view))}),s(1,"div",57),n(2),l(),s(3,"div",58),n(4),l(),s(5,"div",59),n(6),l()()}if(o&2){let e=t.$implicit;R("background",e.color+"15")("border","1px solid "+e.color+"30"),a(2),p(e.icon),a(2),p(e.label),a(2),p(e.description)}}function Me(o,t){if(o&1&&(s(0,"div",27)(1,"div",60),n(2),l(),s(3,"div",49)(4,"div",61),n(5),l(),s(6,"div",62),n(7),l()(),s(8,"div",63),n(9),l()()),o&2){let e=t.$implicit;a(),D("bg-blue-500/20",e.type==="message")("bg-green-500/20",e.type==="reply")("bg-purple-500/20",e.type==="conversion")("bg-amber-500/20",e.type==="lead")("bg-slate-700",e.type==="system"),a(),_(" ",e.icon," "),a(3),p(e.title),a(2),p(e.description),a(2),p(e.time)}}function Fe(o,t){o&1&&(s(0,"div",28),n(1," \u66AB\u7121\u6D3B\u52D5\u8A18\u9304 "),l())}function Re(o,t){if(o&1&&(s(0,"div",41)(1,"div",68)(2,"span",4),n(3),l(),s(4,"span",69),n(5),l()(),s(6,"div",70),Q(7,"div",71),l()()),o&2){let e=t.$implicit;a(3),p(e.name),a(2),_("",e.stats.conversionRate.toFixed(1),"%"),a(2),R("width",e.stats.conversionRate*2,"%")}}function Pe(o,t){if(o&1&&(s(0,"div",65)(1,"div",66),n(2),l(),s(3,"div",67),I(4,Re,8,4,"div",41,H),l()()),o&2){let e=t.$implicit;a(2),p(e.name),a(2),V(e.variants)}}function We(o,t){if(o&1&&(s(0,"div",29)(1,"div",12)(2,"h2",13),n(3," \u{1F9EA} \u904B\u884C\u4E2D\u7684 A/B \u6E2C\u8A66 "),l(),s(4,"span",64),n(5),l()(),s(6,"div",15),I(7,Pe,6,1,"div",65,H),l()()),o&2){let e=m();a(5),_(" ",e.abTestingService.activeTests().length," \u500B\u6E2C\u8A66 "),a(2),V(e.abTestingService.activeTests().slice(0,2))}}var te=class o{constructor(){this.scoringService=A(ge);this.abTestingService=A(ve);this.navigateTo=q();this.isRefreshing=S(!1);this.Math=Math;this.quickActions=[{id:"q1",icon:"\u{1F3AF}",label:"\u7B56\u7565\u898F\u5283",description:"AI \u71DF\u92B7\u52A9\u624B",color:"#f97316",view:"ai-assistant"},{id:"q2",icon:"\u{1F916}",label:"\u81EA\u52D5\u57F7\u884C",description:"AI \u5718\u968A\u92B7\u552E",color:"#a855f7",view:"ai-team"},{id:"q3",icon:"\u{1F4C7}",label:"\u8CC7\u6E90\u4E2D\u5FC3",description:"\u7BA1\u7406\u806F\u7E6B\u4EBA",color:"#22c55e",view:"resource-center"},{id:"q4",icon:"\u{1F4CA}",label:"\u6578\u64DA\u5206\u6790",description:"\u67E5\u770B\u5831\u544A",color:"#06b6d4",view:"analytics"}];this.metricCards=T(()=>{let t=this.scoringService.stats();return[{id:"m1",icon:"\u{1F465}",label:"\u7E3D\u806F\u7E6B\u4EBA",value:t.total,change:12.5,changeLabel:"\u8F03\u4E0A\u9031",color:"#3b82f6",bgGradient:"linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05))"},{id:"m2",icon:"\u{1F525}",label:"\u71B1\u9580\u5BA2\u6236",value:t.byLevel.hot+t.byLevel.burning,change:8.3,changeLabel:"\u9AD8\u8CFC\u8CB7\u610F\u5411",color:"#f97316",bgGradient:"linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(234, 88, 12, 0.05))"},{id:"m3",icon:"\u{1F4CA}",label:"\u5E73\u5747\u8A55\u5206",value:t.avgScore.toFixed(0),change:t.avgScore>30?5.2:-2.1,changeLabel:"\u4E92\u52D5\u71B1\u5EA6",color:"#22c55e",bgGradient:"linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.05))"},{id:"m4",icon:"\u{1F9EA}",label:"A/B \u6E2C\u8A66",value:this.abTestingService.stats().running,changeLabel:"\u904B\u884C\u4E2D",color:"#a855f7",bgGradient:"linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(139, 92, 246, 0.05))"}]});this.aiInsights=S([]);this.hotLeads=T(()=>this.scoringService.getHotLeads(5));this.recentActivities=S([])}ngOnInit(){this.generateInsights(),this.loadRecentActivities()}ngOnDestroy(){}getGreeting(){let t=new Date().getHours();return t<12?"\u65E9\u5B89 \u2600\uFE0F":t<18?"\u5348\u5B89 \u{1F324}\uFE0F":"\u665A\u5B89 \u{1F319}"}getTodayDate(){return new Date().toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",weekday:"long"})}async refresh(){this.isRefreshing.set(!0),await new Promise(t=>setTimeout(t,1e3)),this.generateInsights(),this.loadRecentActivities(),this.isRefreshing.set(!1)}generateInsights(){let t=this.scoringService.stats(),e=[];t.byLevel.burning>0&&e.push({id:"i1",icon:"\u{1F3AF}",type:"success",title:`${t.byLevel.burning} \u500B\u7206\u71B1\u5BA2\u6236`,description:"\u9019\u4E9B\u5BA2\u6236\u8CFC\u8CB7\u610F\u5411\u6975\u9AD8\uFF0C\u5EFA\u8B70\u7ACB\u5373\u8DDF\u9032\uFF01",action:"hot-leads",actionLabel:"\u7ACB\u5373\u67E5\u770B"}),t.byLevel.cold>t.total*.5&&e.push({id:"i2",icon:"\u26A0\uFE0F",type:"warning",title:"\u8D85\u904E\u534A\u6578\u5BA2\u6236\u8655\u65BC\u51B7\u6DE1\u72C0\u614B",description:"\u5EFA\u8B70\u91CD\u65B0\u555F\u52D5\u71DF\u92B7\u6D3B\u52D5\uFF0C\u63D0\u5347\u5BA2\u6236\u4E92\u52D5",action:"ai-assistant",actionLabel:"\u5275\u5EFA\u71DF\u92B7\u6D3B\u52D5"});let i=this.abTestingService.stats();i.completed>0&&i.avgConversionLift>10&&e.push({id:"i3",icon:"\u{1F4C8}",type:"success",title:`A/B \u6E2C\u8A66\u63D0\u5347\u8F49\u5316 ${i.avgConversionLift.toFixed(1)}%`,description:"\u60A8\u7684\u6E2C\u8A66\u7B56\u7565\u6548\u679C\u986F\u8457\uFF0C\u5EFA\u8B70\u7E7C\u7E8C\u512A\u5316",action:"analytics",actionLabel:"\u67E5\u770B\u8A73\u60C5"}),e.length<2&&e.push({id:"i4",icon:"\u{1F4A1}",type:"tip",title:"\u4F7F\u7528 AI \u7B56\u7565\u898F\u5283",description:"\u8B93 AI \u5E6B\u60A8\u751F\u6210\u9AD8\u8F49\u5316\u7684\u71DF\u92B7\u7B56\u7565",action:"ai-assistant",actionLabel:"\u958B\u59CB\u898F\u5283"}),e.length<4&&e.push({id:"i5",icon:"\u{1F916}",type:"info",title:"\u5617\u8A66 AI \u5718\u968A\u92B7\u552E",description:"\u4E00\u53E5\u8A71\u555F\u52D5 AI \u81EA\u52D5\u5316\u92B7\u552E\u6D41\u7A0B",action:"ai-team",actionLabel:"\u4E86\u89E3\u66F4\u591A"}),this.aiInsights.set(e.slice(0,4))}regenerateInsights(){this.generateInsights()}loadRecentActivities(){let e=this.scoringService.globalHistory().slice(0,10).map(i=>({id:i.id,icon:this.getActivityIcon(i.action),title:i.reason,description:`\u5BA2\u6236 ${i.contactId.slice(-6)} \xB7 ${i.points>0?"+":""}${i.points} \u5206`,time:this.formatTime(i.timestamp),type:this.getActivityType(i.action)}));this.recentActivities.set(e)}getActivityIcon(t){return{message_sent:"\u{1F4E4}",message_replied:"\u{1F4AC}",positive_reply:"\u{1F60A}",negative_reply:"\u{1F61E}",price_inquiry:"\u{1F4B0}",demo_requested:"\u{1F3AC}",meeting_scheduled:"\u{1F4C5}",referral_made:"\u{1F91D}"}[t]||"\u{1F4CC}"}getActivityType(t){return t.includes("reply")?"reply":t.includes("message")?"message":t.includes("meeting")||t.includes("demo")?"conversion":"lead"}formatTime(t){let e=new Date(t),r=new Date().getTime()-e.getTime(),d=Math.floor(r/6e4);if(d<1)return"\u525B\u525B";if(d<60)return`${d} \u5206\u9418\u524D`;let C=Math.floor(d/60);return C<24?`${C} \u5C0F\u6642\u524D`:e.toLocaleDateString("zh-TW",{month:"short",day:"numeric"})}getInitial(t){return t.charAt(0).toUpperCase()}formatDate(t){return t?this.formatTime(t):"\u7121\u8A18\u9304"}getHeatColor(t){return this.scoringService.getHeatLevelConfig(t).color}getHeatIcon(t){return this.scoringService.getHeatLevelConfig(t).icon}getHeatLabel(t){return this.scoringService.getHeatLevelConfig(t).label}onMetricClick(t){switch(t.id){case"m1":this.navigateTo.emit("resource-center");break;case"m2":this.navigateTo.emit("leads");break;case"m3":this.navigateTo.emit("analytics");break;case"m4":break}}onInsightAction(t){t.action&&this.navigateTo.emit(t.action)}onLeadClick(t){this.navigateTo.emit("leads")}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=L({type:o,selectors:[["app-smart-dashboard"]],outputs:{navigateTo:"navigateTo"},decls:51,vars:7,consts:[[1,"smart-dashboard","h-full","overflow-y-auto","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900"],[1,"p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-slate-400"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","flex","items-center","gap-2","disabled:opacity-50",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"w-4","h-4","animate-spin"],[1,"grid","grid-cols-4","gap-4"],[1,"p-5","rounded-2xl","border","transition-all","hover:scale-[1.02]","cursor-pointer",3,"background","border-color"],[1,"grid","grid-cols-3","gap-6"],[1,"col-span-2","space-y-6"],[1,"p-5","bg-gradient-to-r","from-purple-500/10","via-cyan-500/10","to-blue-500/10","rounded-2xl","border","border-purple-500/20"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-cyan-400","hover:text-cyan-300","transition-colors",3,"click"],[1,"grid","grid-cols-2","gap-4"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30","hover:border-slate-600/50","transition-colors",3,"border-green-500/30","border-yellow-500/30","border-blue-500/30","border-purple-500/30"],[1,"p-5","bg-slate-800/30","rounded-2xl","border","border-slate-700/50"],[1,"text-sm","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"space-y-3"],[1,"flex","items-center","gap-4","p-3","bg-slate-800/50","rounded-xl","hover:bg-slate-700/50","transition-colors","cursor-pointer"],[1,"text-center","py-8","text-slate-500"],[1,"space-y-6"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-3"],[1,"p-4","rounded-xl","text-left","transition-all","hover:scale-[1.03]","group",3,"background","border"],[1,"space-y-3","max-h-80","overflow-y-auto"],[1,"flex","items-start","gap-3","p-2","rounded-lg","hover:bg-slate-700/30","transition-colors"],[1,"text-center","py-6","text-slate-500","text-sm"],[1,"p-5","bg-gradient-to-r","from-amber-500/10","to-orange-500/10","rounded-2xl","border","border-amber-500/20"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"p-5","rounded-2xl","border","transition-all","hover:scale-[1.02]","cursor-pointer",3,"click"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-2xl"],[1,"text-xs","px-2","py-1","rounded-full",3,"bg-green-500/20","text-green-400","bg-red-500/20","text-red-400"],[1,"text-sm","text-slate-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-xs","px-2","py-1","rounded-full"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30","hover:border-slate-600/50","transition-colors"],[1,"flex","items-start","gap-3"],[1,"flex-1"],[1,"font-medium","text-white","mb-1"],[1,"text-sm","text-slate-400","mb-2"],[1,"text-xs","text-cyan-400","hover:text-cyan-300","transition-colors"],[1,"text-xs","text-cyan-400","hover:text-cyan-300","transition-colors",3,"click"],[1,"flex","items-center","gap-4","p-3","bg-slate-800/50","rounded-xl","hover:bg-slate-700/50","transition-colors","cursor-pointer",3,"click"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","font-bold","text-sm"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-white","font-bold"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","truncate"],[1,"text-right"],[1,"text-lg","font-bold"],[1,"text-xs","flex","items-center","gap-1"],[1,"text-4xl","mb-2"],[1,"text-sm","mt-1"],[1,"p-4","rounded-xl","text-left","transition-all","hover:scale-[1.03]","group",3,"click"],[1,"text-2xl","mb-2"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-slate-400","mt-0.5"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","text-sm"],[1,"text-sm","text-white"],[1,"text-xs","text-slate-500","truncate"],[1,"text-xs","text-slate-500","whitespace-nowrap"],[1,"px-2","py-1","bg-amber-500/20","text-amber-400","text-xs","rounded-full"],[1,"p-4","bg-slate-800/50","rounded-xl"],[1,"font-medium","text-white","mb-2"],[1,"flex","items-center","gap-4","text-sm"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-white"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),n(5),l(),s(6,"p",4),n(7),l()(),s(8,"button",5),w("click",function(){return i.refresh()}),f(9,we,3,0,":svg:svg",6)(10,Ee,1,0),n(11," \u5237\u65B0 "),l()(),s(12,"div",7),I(13,ye,10,9,"div",8,H),l(),s(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"h2",13),n(20," \u{1F916} AI \u667A\u80FD\u6D1E\u5BDF "),l(),s(21,"button",14),w("click",function(){return i.regenerateInsights()}),n(22," \u2728 \u91CD\u65B0\u5206\u6790 "),l()(),s(23,"div",15),I(24,Te,10,12,"div",16,H),l()(),s(26,"div",17)(27,"div",12)(28,"h2",13),n(29," \u{1F525} \u71B1\u9580\u5BA2\u6236 "),l(),s(30,"button",18),w("click",function(){return i.navigateTo.emit("leads")}),n(31," \u67E5\u770B\u5168\u90E8 \u2192 "),l()(),s(32,"div",19),I(33,Ae,15,20,"div",20,Ce,!1,Ie,7,0,"div",21),l()()(),s(36,"div",22)(37,"div",17)(38,"h2",23),n(39," \u26A1 \u5FEB\u901F\u64CD\u4F5C "),l(),s(40,"div",24),I(41,Ve,7,7,"button",25,H),l()(),s(43,"div",17)(44,"h2",23),n(45," \u{1F4E1} \u5BE6\u6642\u52D5\u614B "),l(),s(46,"div",26),I(47,Me,10,14,"div",27,H,!1,Fe,2,0,"div",28),l()()()(),f(50,We,9,1,"div",29),l()()),e&2&&(a(5),_(" ",i.getGreeting()," "),a(2),_(" ",i.getTodayDate()," \xB7 \u8B93 AI \u52A9\u60A8\u9AD8\u6548\u71DF\u92B7 "),a(),J("disabled",i.isRefreshing()),a(),b(i.isRefreshing()?9:10),a(4),V(i.metricCards()),a(11),V(i.aiInsights()),a(9),V(i.hotLeads()),a(8),V(i.quickActions),a(6),V(i.recentActivities()),a(3),b(i.abTestingService.activeTests().length>0?50:-1))},dependencies:[$],styles:["[_nghost-%COMP%]{display:block;height:100%}.smart-dashboard[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.smart-dashboard[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.smart-dashboard[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}"]})}};var ie=(o,t)=>t.id;function Be(o,t){if(o&1){let e=k();s(0,"div",7)(1,"div",10)(2,"span",11),n(3,"\u{1F4A1}"),l(),s(4,"span",12),n(5,"AI \u63A8\u85A6"),l()(),s(6,"h3",13),n(7),l(),s(8,"p",14),n(9),l(),s(10,"button",15),w("click",function(){v(e);let r=m(2);return x(r.startWorkflow(r.recommendedWorkflow()))}),n(11," \u958B\u59CB\u6B64\u6D41\u7A0B "),l()()}if(o&2){let e=m(2);a(7),p(e.recommendedWorkflow().title),a(2),p(e.recommendedWorkflow().description)}}function Le(o,t){if(o&1){let e=k();s(0,"div",16),w("click",function(){let r=v(e).$implicit,d=m(2);return x(d.startWorkflow(r))}),s(1,"div",17)(2,"span",18),n(3),l(),s(4,"div",19)(5,"div",20)(6,"h4",21),n(7),l(),s(8,"span",22),n(9),l()(),s(10,"p",23),n(11),l(),s(12,"div",24)(13,"span"),n(14),l(),s(15,"span"),n(16),l()()()()()}if(o&2){let e=t.$implicit,i=m(2);a(3),p(e.icon),a(4),_(" ",e.title," "),a(),D("bg-green-500/20",e.difficulty==="easy")("text-green-400",e.difficulty==="easy")("bg-yellow-500/20",e.difficulty==="medium")("text-yellow-400",e.difficulty==="medium")("bg-red-500/20",e.difficulty==="advanced")("text-red-400",e.difficulty==="advanced"),a(),_(" ",i.getDifficultyLabel(e.difficulty)," "),a(2),p(e.description),a(3),_("",e.steps.length," \u6B65\u9A5F"),a(2),_("\u7D04 ",e.estimatedTime)}}function $e(o,t){if(o&1&&(s(0,"div",5),f(1,Be,12,2,"div",7),s(2,"div",8),I(3,Le,17,18,"div",9,ie),l()()),o&2){let e=m();a(),b(e.recommendedWorkflow()?1:-1),a(2),V(e.workflows())}}function Oe(o,t){if(o&1){let e=k();s(0,"button",29),w("click",function(){let r=v(e).$implicit,d=m(2);return x(d.activeCategory.set(r.id))}),n(1),l()}if(o&2){let e=t.$implicit,i=m(2);D("bg-purple-500",i.activeCategory()===e.id)("text-white",i.activeCategory()===e.id)("bg-slate-700/50",i.activeCategory()!==e.id)("text-slate-400",i.activeCategory()!==e.id)("hover:bg-slate-600/50",i.activeCategory()!==e.id),a(),P(" ",e.icon," ",e.label," ")}}function Qe(o,t){o&1&&(s(0,"div",31),n(1," \u2B50 "),l())}function Ne(o,t){if(o&1&&(s(0,"div",32),n(1),l()),o&2){let e=m().$implicit;a(),_(" ",e.badge," ")}}function He(o,t){if(o&1){let e=k();s(0,"div",30),w("click",function(){let r=v(e).$implicit,d=m(2);return x(d.executeAction(r))}),f(1,Qe,2,0,"div",31),f(2,Ne,2,1,"div",32),s(3,"div",33),n(4),l(),s(5,"h4",34),n(6),l(),s(7,"p",35),n(8),l()()}if(o&2){let e=t.$implicit;a(),b(e.isRecommended?1:-1),a(),b(e.badge?2:-1),a(2),p(e.icon),a(2),_(" ",e.title," "),a(2),p(e.description)}}function je(o,t){if(o&1&&(s(0,"div",5)(1,"div",25),I(2,Oe,2,12,"button",26,ie),l(),s(4,"div",27),I(5,He,9,5,"div",28,ie),l()()),o&2){let e=m();a(2),V(e.categories),a(3),V(e.filteredActions())}}function qe(o,t){o&1&&n(0," \u2713 ")}function Ge(o,t){if(o&1&&n(0),o&2){let e=m().$index;_(" ",e+1," ")}}function Ue(o,t){o&1&&n(0," \u2717 ")}function Ke(o,t){if(o&1&&n(0),o&2){let e=m().$index;_(" ",e+1," ")}}function ze(o,t){o&1&&(s(0,"span",58),n(1,"\u53EF\u9078"),l())}function Ye(o,t){if(o&1){let e=k();s(0,"button",61),w("click",function(){v(e);let r=m(2).$implicit,d=m(2);return x(d.skipStep(r))}),n(1," \u8DF3\u904E "),l()}}function Je(o,t){if(o&1){let e=k();s(0,"div",59)(1,"button",15),w("click",function(){v(e);let r=m().$implicit,d=m(2);return x(d.executeStep(r))}),n(2," \u57F7\u884C\u6B64\u6B65\u9A5F "),l(),f(3,Ye,2,0,"button",60),l()}if(o&2){let e=m().$implicit;a(3),b(e.isOptional?3:-1)}}function Xe(o,t){if(o&1&&(s(0,"div",51)(1,"div",55),f(2,qe,1,0)(3,Ge,1,1)(4,Ue,1,0)(5,Ke,1,1),l(),s(6,"div",56)(7,"div",20)(8,"span",11),n(9),l(),s(10,"h4",57),n(11),l(),f(12,ze,2,0,"span",58),l(),s(13,"p",14),n(14),l(),f(15,Je,4,1,"div",59),l()()),o&2){let e,i=t.$implicit,r=t.$index,d=m(2);a(),D("bg-green-500",i.status==="completed")("text-white",i.status==="completed")("bg-cyan-500",i.status==="active")("text-white",i.status==="active")("animate-pulse",i.status==="active")("bg-slate-600",i.status==="pending")("text-slate-400",i.status==="pending")("bg-slate-700",i.status==="skipped")("text-slate-500",i.status==="skipped")("bg-red-500",i.status==="error")("text-white",i.status==="error"),a(),b((e=i.status)==="completed"?2:e==="active"?3:e==="error"?4:5),a(4),D("border-l-2",r<d.activeWorkflow().steps.length-1)("border-green-500",i.status==="completed")("border-cyan-500",i.status==="active")("border-slate-600",i.status==="pending"||i.status==="skipped")("ml-5",r<d.activeWorkflow().steps.length-1)("pl-8",r<d.activeWorkflow().steps.length-1),a(3),p(i.icon),a(),D("text-white",i.status==="active")("text-green-400",i.status==="completed")("text-slate-400",i.status==="pending")("text-slate-500",i.status==="skipped"),a(),_(" ",i.title," "),a(),b(i.isOptional?12:-1),a(2),p(i.description),a(),b(i.status==="active"?15:-1)}}function Ze(o,t){if(o&1){let e=k();s(0,"button",62),w("click",function(){v(e);let r=m(2);return x(r.finishWorkflow())}),n(1," \u{1F389} \u5B8C\u6210\u5DE5\u4F5C\u6D41 "),l()}}function et(o,t){if(o&1){let e=k();s(0,"div",36),w("click",function(){v(e);let r=m();return x(r.closeWorkflow())}),s(1,"div",37),w("click",function(r){return v(e),x(r.stopPropagation())}),s(2,"div",38)(3,"div",39)(4,"div",40)(5,"span",41),n(6),l(),s(7,"div")(8,"h2",42),n(9),l(),s(10,"p",43),n(11),l()()(),s(12,"button",44),w("click",function(){v(e);let r=m();return x(r.closeWorkflow())}),O(),s(13,"svg",45),Q(14,"path",46),l()()(),K(),s(15,"div",47),Q(16,"div",48),l(),s(17,"div",49),n(18),l()(),s(19,"div",50)(20,"div",5),I(21,Xe,16,48,"div",51,ie),l()(),s(23,"div",52)(24,"button",53),w("click",function(){v(e);let r=m();return x(r.closeWorkflow())}),n(25," \u7A0D\u5F8C\u7E7C\u7E8C "),l(),f(26,Ze,2,0,"button",54),l()()()}if(o&2){let e=m();a(6),p(e.activeWorkflow().icon),a(3),p(e.activeWorkflow().title),a(2),p(e.activeWorkflow().description),a(5),R("width",e.workflowProgress(),"%"),a(2),P(" ",e.completedStepsCount(),"/",e.activeWorkflow().steps.length," \u6B65\u9A5F\u5B8C\u6210 "),a(3),V(e.activeWorkflow().steps),a(5),b(e.isWorkflowComplete()?26:-1)}}var ne=class o{constructor(){this.navigateTo=q();this.workflowCompleted=q();this.mode=S("actions");this.activeCategory=S("all");this.activeWorkflow=S(null);this.categories=[{id:"all",icon:"\u{1F4CB}",label:"\u5168\u90E8"},{id:"account",icon:"\u{1F464}",label:"\u5E33\u865F"},{id:"resource",icon:"\u{1F50D}",label:"\u8CC7\u6E90"},{id:"automation",icon:"\u26A1",label:"\u81EA\u52D5\u5316"},{id:"message",icon:"\u{1F4AC}",label:"\u6D88\u606F"},{id:"analysis",icon:"\u{1F4CA}",label:"\u5206\u6790"}];this.workflows=S([{id:"quick-start",title:"\u5FEB\u901F\u958B\u59CB\u76E3\u63A7",description:"\u5F9E\u6DFB\u52A0\u5E33\u865F\u5230\u958B\u59CB\u76E3\u63A7\u7684\u5B8C\u6574\u6D41\u7A0B",icon:"\u{1F680}",category:"automation",estimatedTime:"10\u5206\u9418",difficulty:"easy",steps:[{id:"s1",title:"\u6DFB\u52A0\u76E3\u63A7\u5E33\u865F",description:"\u6DFB\u52A0\u4E26\u767B\u9304\u4E00\u500B Telegram \u5E33\u865F",icon:"\u{1F464}",status:"pending",isOptional:!1,actionView:"add-account"},{id:"s2",title:"\u767C\u73FE\u76EE\u6A19\u7FA4\u7D44",description:"\u641C\u7D22\u4E26\u6DFB\u52A0\u8981\u76E3\u63A7\u7684\u7FA4\u7D44",icon:"\u{1F50D}",status:"pending",isOptional:!1,actionView:"resources"},{id:"s3",title:"\u8A2D\u7F6E\u95DC\u9375\u8A5E",description:"\u914D\u7F6E\u89F8\u767C\u6D88\u606F\u7684\u95DC\u9375\u8A5E",icon:"\u{1F511}",status:"pending",isOptional:!1,actionView:"automation"},{id:"s4",title:"\u958B\u59CB\u76E3\u63A7",description:"\u555F\u52D5\u76E3\u63A7\u7CFB\u7D71",icon:"\u25B6\uFE0F",status:"pending",isOptional:!1,actionHandler:"start-monitoring"}]},{id:"full-automation",title:"\u5B8C\u6574\u81EA\u52D5\u5316\u71DF\u92B7",description:"\u8A2D\u7F6E\u5F9E\u76E3\u63A7\u5230\u81EA\u52D5\u8DDF\u9032\u7684\u5168\u6D41\u7A0B",icon:"\u{1F3AF}",category:"automation",estimatedTime:"20\u5206\u9418",difficulty:"medium",steps:[{id:"s1",title:"\u914D\u7F6E\u5E33\u865F\u89D2\u8272",description:"\u8A2D\u7F6E\u76E3\u63A7\u865F\u548C\u767C\u9001\u865F",icon:"\u{1F465}",status:"pending",isOptional:!1,actionView:"accounts"},{id:"s2",title:"\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44",description:"\u6DFB\u52A0\u76EE\u6A19\u7FA4\u7D44",icon:"\u{1F4AC}",status:"pending",isOptional:!1,actionView:"resources"},{id:"s3",title:"\u8A2D\u7F6E\u95DC\u9375\u8A5E",description:"\u914D\u7F6E\u89F8\u767C\u95DC\u9375\u8A5E",icon:"\u{1F511}",status:"pending",isOptional:!1,actionView:"automation"},{id:"s4",title:"\u5275\u5EFA\u6D3B\u52D5",description:"\u8A2D\u7F6E\u81EA\u52D5\u56DE\u8986\u6D3B\u52D5",icon:"\u26A1",status:"pending",isOptional:!1,actionView:"automation"},{id:"s5",title:"\u914D\u7F6E AI \u56DE\u8986",description:"\u8A2D\u7F6E AI \u81EA\u52D5\u554F\u5019",icon:"\u{1F916}",status:"pending",isOptional:!0,actionView:"ai-center"},{id:"s6",title:"\u958B\u59CB\u76E3\u63A7",description:"\u555F\u52D5\u81EA\u52D5\u5316\u7CFB\u7D71",icon:"\u25B6\uFE0F",status:"pending",isOptional:!1,actionHandler:"start-monitoring"}]},{id:"multi-role",title:"\u591A\u89D2\u8272\u5354\u4F5C\u8A2D\u7F6E",description:"\u914D\u7F6E\u591A\u5E33\u865F\u5287\u672C\u5F0F\u5354\u4F5C",icon:"\u{1F3AD}",category:"conversion",estimatedTime:"30\u5206\u9418",difficulty:"advanced",steps:[{id:"s1",title:"\u6E96\u5099\u591A\u500B\u5E33\u865F",description:"\u6DFB\u52A0\u81F3\u5C113\u500B\u5E33\u865F",icon:"\u{1F465}",status:"pending",isOptional:!1,actionView:"accounts"},{id:"s2",title:"\u5206\u914D\u89D2\u8272",description:"\u70BA\u5E33\u865F\u5206\u914D\u92B7\u552E\u3001\u5C08\u5BB6\u7B49\u89D2\u8272",icon:"\u{1F3AD}",status:"pending",isOptional:!1,actionView:"multi-role"},{id:"s3",title:"\u9078\u64C7\u5287\u672C",description:"\u9078\u64C7\u6216\u5275\u5EFA\u5354\u4F5C\u5287\u672C",icon:"\u{1F4DC}",status:"pending",isOptional:!1,actionView:"multi-role"},{id:"s4",title:"\u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44",description:"\u8A2D\u7F6E\u5354\u4F5C\u76EE\u6A19\u7FA4\u7D44",icon:"\u{1F4AC}",status:"pending",isOptional:!1,actionView:"multi-role"},{id:"s5",title:"\u57F7\u884C\u5287\u672C",description:"\u555F\u52D5\u591A\u89D2\u8272\u5354\u4F5C",icon:"\u{1F3AC}",status:"pending",isOptional:!1,actionHandler:"run-script"}]}]);this.quickActions=S([{id:"add-account",title:"\u6DFB\u52A0\u5E33\u865F",description:"\u6DFB\u52A0 Telegram \u5E33\u865F",icon:"\u2795",category:"account",actionView:"add-account",isRecommended:!0},{id:"scan-session",title:"\u6062\u5FA9\u5E33\u865F",description:"\u6383\u63CF\u4E26\u6062\u5FA9 Session",icon:"\u{1F504}",category:"account",actionView:"accounts",actionHandler:"scan-sessions"},{id:"discover-groups",title:"\u767C\u73FE\u7FA4\u7D44",description:"\u641C\u7D22\u65B0\u7FA4\u7D44\u8CC7\u6E90",icon:"\u{1F50D}",category:"resource",actionView:"resources"},{id:"add-group",title:"\u6DFB\u52A0\u7FA4\u7D44",description:"\u624B\u52D5\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44",icon:"\u{1F4AC}",category:"resource",actionView:"automation"},{id:"add-keyword",title:"\u6DFB\u52A0\u95DC\u9375\u8A5E",description:"\u8A2D\u7F6E\u89F8\u767C\u95DC\u9375\u8A5E",icon:"\u{1F511}",category:"automation",actionView:"automation"},{id:"create-campaign",title:"\u5275\u5EFA\u6D3B\u52D5",description:"\u65B0\u5EFA\u81EA\u52D5\u5316\u6D3B\u52D5",icon:"\u26A1",category:"automation",actionView:"automation",actionHandler:"new-campaign"},{id:"send-batch",title:"\u6279\u91CF\u767C\u9001",description:"\u767C\u9001\u6279\u91CF\u6D88\u606F",icon:"\u{1F4E4}",category:"message",actionView:"ads"},{id:"view-leads",title:"\u67E5\u770B\u7DDA\u7D22",description:"\u7BA1\u7406\u6F5B\u5728\u5BA2\u6236",icon:"\u{1F465}",category:"message",actionView:"leads"},{id:"view-stats",title:"\u6578\u64DA\u5206\u6790",description:"\u67E5\u770B\u7D71\u8A08\u5831\u8868",icon:"\u{1F4CA}",category:"analysis",actionView:"nurturing-analytics"},{id:"export-data",title:"\u5C0E\u51FA\u6578\u64DA",description:"\u5C0E\u51FA\u5BA2\u6236\u6578\u64DA",icon:"\u{1F4E5}",category:"analysis",actionView:"leads",actionHandler:"export-leads"},{id:"start-monitoring",title:"\u958B\u59CB\u76E3\u63A7",description:"\u555F\u52D5\u81EA\u52D5\u76E3\u63A7",icon:"\u25B6\uFE0F",category:"automation",actionView:"automation",actionHandler:"start-monitoring",isRecommended:!0},{id:"ai-settings",title:"AI \u8A2D\u7F6E",description:"\u914D\u7F6E AI \u56DE\u8986",icon:"\u{1F916}",category:"automation",actionView:"ai-center"}]);this.recommendedWorkflow=T(()=>this.workflows().find(t=>t.id==="quick-start"));this.filteredActions=T(()=>{let t=this.activeCategory();return t==="all"?this.quickActions():this.quickActions().filter(e=>e.category===t)});this.workflowProgress=T(()=>{let t=this.activeWorkflow();return t?t.steps.filter(i=>i.status==="completed"||i.status==="skipped").length/t.steps.length*100:0});this.completedStepsCount=T(()=>{let t=this.activeWorkflow();return t?t.steps.filter(e=>e.status==="completed"||e.status==="skipped").length:0});this.isWorkflowComplete=T(()=>{let t=this.activeWorkflow();return t?t.steps.every(e=>e.status==="completed"||e.status==="skipped"):!1})}ngOnInit(){}getDifficultyLabel(t){return{easy:"\u7C21\u55AE",medium:"\u4E2D\u7B49",advanced:"\u9032\u968E"}[t]||t}startWorkflow(t){let e=E(h({},t),{steps:t.steps.map((i,r)=>E(h({},i),{status:r===0?"active":"pending"}))});this.activeWorkflow.set(e)}closeWorkflow(){this.activeWorkflow.set(null)}executeStep(t){t.actionView&&this.navigateTo.emit({view:t.actionView,handler:t.actionHandler}),this.activeWorkflow.update(e=>{if(!e)return null;let i=e.steps.findIndex(r=>r.id===t.id);return E(h({},e),{steps:e.steps.map((r,d)=>d===i?E(h({},r),{status:"completed"}):d===i+1?E(h({},r),{status:"active"}):r)})})}skipStep(t){this.activeWorkflow.update(e=>{if(!e)return null;let i=e.steps.findIndex(r=>r.id===t.id);return E(h({},e),{steps:e.steps.map((r,d)=>d===i?E(h({},r),{status:"skipped"}):d===i+1?E(h({},r),{status:"active"}):r)})})}finishWorkflow(){let t=this.activeWorkflow();t&&this.workflowCompleted.emit(t),this.closeWorkflow()}executeAction(t){this.navigateTo.emit({view:t.actionView,handler:t.actionHandler})}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=L({type:o,selectors:[["app-quick-workflow"]],outputs:{navigateTo:"navigateTo",workflowCompleted:"workflowCompleted"},decls:15,vars:35,consts:[[1,"quick-workflow"],[1,"flex","items-center","gap-3","mb-6"],[1,"flex-1","py-3","rounded-xl","border","transition-all","text-center",3,"click"],[1,"text-xl","block","mb-1"],[1,"text-sm","font-medium"],[1,"space-y-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"p-4","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10","border","border-cyan-500/30","rounded-xl"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"group","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-cyan-500/30","rounded-xl","cursor-pointer","transition-all"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-lg"],[1,"text-sm","font-semibold","text-cyan-400"],[1,"text-white","font-semibold","mb-1"],[1,"text-sm","text-slate-400","mb-3"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","text-sm","font-medium","rounded-lg","transition-all",3,"click"],[1,"group","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-cyan-500/30","rounded-xl","cursor-pointer","transition-all",3,"click"],[1,"flex","items-start","gap-3"],[1,"text-2xl"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-1"],[1,"font-medium","text-white","group-hover:text-cyan-400","transition-colors"],[1,"text-xs","px-1.5","py-0.5","rounded"],[1,"text-xs","text-slate-400","mb-2"],[1,"flex","items-center","gap-3","text-xs","text-slate-500"],[1,"flex","gap-2","overflow-x-auto","pb-2"],[1,"px-3","py-1.5","rounded-lg","text-sm","whitespace-nowrap","transition-all",3,"bg-purple-500","text-white","bg-slate-700/50","text-slate-400","hover:bg-slate-600/50"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-3"],[1,"group","relative","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-purple-500/30","rounded-xl","cursor-pointer","transition-all","text-center"],[1,"px-3","py-1.5","rounded-lg","text-sm","whitespace-nowrap","transition-all",3,"click"],[1,"group","relative","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-purple-500/30","rounded-xl","cursor-pointer","transition-all","text-center",3,"click"],[1,"absolute","-top-2","-right-2","px-1.5","py-0.5","bg-gradient-to-r","from-yellow-500","to-orange-500","text-white","text-xs","font-semibold","rounded-full"],[1,"absolute","-top-2","-left-2","px-1.5","py-0.5","bg-red-500","text-white","text-xs","font-bold","rounded-full"],[1,"text-3xl","mb-2"],[1,"text-sm","font-medium","text-white","group-hover:text-purple-400","transition-colors","mb-1"],[1,"text-xs","text-slate-500"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-2xl","mx-4","overflow-hidden",3,"click"],[1,"p-6","bg-gradient-to-r","from-cyan-500/20","to-blue-500/20","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","text-slate-400","hover:text-white","hover:bg-slate-700/50","rounded-lg","transition-all",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],["d","M6 18L18 6M6 6l12 12"],[1,"mt-4","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all","duration-500"],[1,"mt-2","text-xs","text-slate-400","text-right"],[1,"p-6","max-h-[400px]","overflow-y-auto"],[1,"flex","items-start","gap-4"],[1,"p-4","border-t","border-slate-700/50","flex","justify-between"],[1,"px-4","py-2","text-slate-400","hover:text-white","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-400","hover:to-emerald-400","text-white","font-medium","rounded-lg","transition-all"],[1,"flex-shrink-0","w-10","h-10","rounded-full","flex","items-center","justify-center","font-bold","text-sm","transition-all"],[1,"flex-1","pb-4"],[1,"font-medium"],[1,"text-xs","px-1.5","py-0.5","bg-slate-700","text-slate-400","rounded"],[1,"flex","gap-2"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","text-sm","rounded-lg","transition-all"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","text-sm","rounded-lg","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-400","hover:to-emerald-400","text-white","font-medium","rounded-lg","transition-all",3,"click"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"button",2),w("click",function(){return i.mode.set("workflows")}),s(3,"span",3),n(4,"\u{1F3AF}"),l(),s(5,"span",4),n(6,"\u5F15\u5C0E\u5F0F\u5DE5\u4F5C\u6D41"),l()(),s(7,"button",2),w("click",function(){return i.mode.set("actions")}),s(8,"span",3),n(9,"\u26A1"),l(),s(10,"span",4),n(11,"\u5FEB\u901F\u64CD\u4F5C"),l()()(),f(12,$e,5,1,"div",5),f(13,je,7,0,"div",5),f(14,et,27,8,"div",6),l()),e&2&&(a(2),D("bg-gradient-to-r",i.mode()==="workflows")("from-cyan-500/20",i.mode()==="workflows")("to-blue-500/20",i.mode()==="workflows")("border-cyan-500/50",i.mode()==="workflows")("text-white",i.mode()==="workflows")("bg-slate-800/50",i.mode()!=="workflows")("border-slate-600/50",i.mode()!=="workflows")("text-slate-400",i.mode()!=="workflows"),a(5),D("bg-gradient-to-r",i.mode()==="actions")("from-purple-500/20",i.mode()==="actions")("to-pink-500/20",i.mode()==="actions")("border-purple-500/50",i.mode()==="actions")("text-white",i.mode()==="actions")("bg-slate-800/50",i.mode()!=="actions")("border-slate-600/50",i.mode()!=="actions")("text-slate-400",i.mode()!=="actions"),a(5),b(i.mode()==="workflows"?12:-1),a(),b(i.mode()==="actions"?13:-1),a(),b(i.activeWorkflow()?14:-1))},dependencies:[$],encapsulation:2})}};var j=class o{constructor(){this.analytics=A(N);this._timeSlotStats=S(new Map);this._userPatterns=S(new Map);this._scheduledTasks=S([]);this.timeSlotStats=T(()=>Array.from(this._timeSlotStats().values()));this.scheduledTasks=this._scheduledTasks.asReadonly();this.topTimeSlots=T(()=>this.timeSlotStats().sort((t,e)=>e.score-t.score).slice(0,10));this.currentSlotScore=T(()=>{let t=new Date,e=this.getSlotKey(t.getHours(),t.getDay());return this._timeSlotStats().get(e)?.score??50});this.STORAGE_KEY="smartTiming";this.schedulerInterval=null;this.loadFromStorage(),this.startScheduler()}recordUserActivity(t,e=new Date){let i=e.getHours(),r=e.getDay(),d=this._userPatterns().get(t);if(d){let C=[...new Set([...d.activeHours,i])].slice(-24),g=[...new Set([...d.preferredDays,r])].slice(-7);this._userPatterns.update(M=>{let W=new Map(M);return W.set(t,E(h({},d),{activeHours:C,preferredDays:g,lastActiveTime:e,reliability:Math.min(d.reliability+.1,1)})),W})}else this._userPatterns.update(C=>{let g=new Map(C);return g.set(t,{userId:t,activeHours:[i],preferredDays:[r],avgResponseDelay:30,lastActiveTime:e,reliability:.3}),g});this.saveToStorage()}recordSessionResult(t){let e=t.timestamp.getHours(),i=t.timestamp.getDay(),r=this.getSlotKey(e,i),d=this._timeSlotStats().get(r);if(d){let C=d.totalSessions+1,g=t.responded?1:0,M=t.converted?1:0,W=E(h({},d),{totalSessions:C,responseRate:(d.responseRate*d.totalSessions+g)/C,conversionRate:(d.conversionRate*d.totalSessions+M)/C,avgResponseTime:t.responseTime?(d.avgResponseTime*d.totalSessions+t.responseTime)/C:d.avgResponseTime,score:0});W.score=this.calculateSlotScore(W),this._timeSlotStats.update(y=>{let le=new Map(y);return le.set(r,W),le})}else{let C={hour:e,dayOfWeek:i,totalSessions:1,responseRate:t.responded?1:0,avgResponseTime:t.responseTime??30,conversionRate:t.converted?1:0,score:0};C.score=this.calculateSlotScore(C),this._timeSlotStats.update(g=>{let M=new Map(g);return M.set(r,C),M})}this.saveToStorage()}calculateSlotScore(t){if(t.totalSessions<2)return 50;let e=0;e+=t.responseRate*40,e+=t.conversionRate*40;let i=Math.max(0,1-t.avgResponseTime/120);return e+=i*20,t.hour>=9&&t.hour<=21&&(e*=1.1),(t.dayOfWeek===0||t.dayOfWeek===6)&&(e*=.9),Math.min(100,Math.round(e))}getBestTimeToSend(t){let e=[],i=new Date;if(t){let d=this._userPatterns().get(t);if(d&&d.reliability>.5)for(let C of d.activeHours)e.push({hour:C,dayOfWeek:i.getDay(),score:85+Math.random()*10,reason:"\u57FA\u65BC\u8A72\u7528\u6236\u7684\u6B77\u53F2\u6D3B\u8E8D\u6642\u6BB5",predictedResponseRate:.7+Math.random()*.2})}let r=this.topTimeSlots();for(let d of r.slice(0,5))e.findIndex(g=>g.hour===d.hour)===-1&&e.push({hour:d.hour,dayOfWeek:d.dayOfWeek,score:d.score,reason:`\u6B77\u53F2\u6578\u64DA\u986F\u793A\u8A72\u6642\u6BB5\u56DE\u8986\u7387 ${(d.responseRate*100).toFixed(0)}%`,predictedResponseRate:d.responseRate});if(e.length<3){let d=[10,14,19,20];for(let C of d)e.some(g=>g.hour===C)||e.push({hour:C,dayOfWeek:i.getDay(),score:60,reason:"\u57FA\u65BC\u4E00\u822C\u7528\u6236\u7FD2\u6163\u7684\u63A8\u85A6\u6642\u6BB5",predictedResponseRate:.5})}return e.sort((d,C)=>C.score-d.score).slice(0,5)}getNextBestTime(t){let e=this.getBestTimeToSend(t),i=new Date,r=i.getHours();for(let g of e)if(g.hour>r){let M=new Date(i);return M.setHours(g.hour,0,0,0),M}let d=e[0]?.hour??10,C=new Date(i);return C.setDate(C.getDate()+1),C.setHours(d,0,0,0),C}isGoodTimeNow(){let t=this.currentSlotScore();if(t>=75)return{isGood:!0,score:t,suggestion:"\u2705 \u7576\u524D\u662F\u7D55\u4F73\u6642\u6A5F\uFF0C\u5EFA\u8B70\u7ACB\u5373\u767C\u9001"};if(t>=50)return{isGood:!0,score:t,suggestion:"\u{1F44C} \u7576\u524D\u6642\u6A5F\u5C1A\u53EF\uFF0C\u53EF\u4EE5\u767C\u9001"};{let e=this.getNextBestTime(),i=Math.round((e.getTime()-Date.now())/(1e3*60*60));return{isGood:!1,score:t,suggestion:`\u23F0 \u5EFA\u8B70\u7B49\u5F85 ${i} \u5C0F\u6642\u5F8C\u767C\u9001\uFF0C\u6548\u679C\u66F4\u4F73`}}}scheduleTask(t){let e=E(h({},t),{id:`task_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,status:"pending",createdAt:new Date});return this._scheduledTasks.update(i=>[...i,e]),this.saveToStorage(),console.log(`[SmartTiming] \u5DF2\u5275\u5EFA\u8ABF\u5EA6\u4EFB\u52D9: ${e.id}, \u9810\u8A08\u57F7\u884C\u6642\u9593: ${e.scheduledTime}`),e}smartSchedule(t){let e=this.getNextBestTime(t.targetUserId);return this.scheduleTask(E(h({},t),{scheduledTime:e}))}cancelTask(t){this._scheduledTasks.update(e=>e.map(i=>i.id===t?E(h({},i),{status:"cancelled"}):i)),this.saveToStorage()}startScheduler(){this.schedulerInterval||(this.schedulerInterval=setInterval(()=>{this.checkAndExecuteTasks()},6e4),console.log("[SmartTiming] \u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5"))}checkAndExecuteTasks(){let t=new Date,e=this._scheduledTasks().filter(i=>i.status==="pending"&&new Date(i.scheduledTime)<=t);for(let i of e)this.executeTask(i)}executeTask(t){console.log(`[SmartTiming] \u57F7\u884C\u8ABF\u5EA6\u4EFB\u52D9: ${t.id}`),this._scheduledTasks.update(e=>e.map(i=>i.id===t.id?E(h({},i),{status:"executed"}):i)),window.dispatchEvent(new CustomEvent("scheduled-task-execute",{detail:t})),this.saveToStorage()}getHeatmapData(){let t=[];for(let e=0;e<7;e++)for(let i=0;i<24;i++){let r=this.getSlotKey(i,e),d=this._timeSlotStats().get(r);t.push({hour:i,day:e,score:d?.score??50})}return t}getTodaySlots(){let t=new Date().getDay(),e=[];for(let i=0;i<24;i++){let r=this.getSlotKey(i,t),d=this._timeSlotStats().get(r);e.push(d??{hour:i,dayOfWeek:t,totalSessions:0,responseRate:0,avgResponseTime:0,conversionRate:0,score:50})}return e}getSlotKey(t,e){return`${e}_${t}`}saveToStorage(){let t={timeSlotStats:Array.from(this._timeSlotStats().entries()),userPatterns:Array.from(this._userPatterns().entries()),scheduledTasks:this._scheduledTasks(),savedAt:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}loadFromStorage(){try{let t=localStorage.getItem(this.STORAGE_KEY);if(!t)return;let e=JSON.parse(t);if(e.timeSlotStats&&this._timeSlotStats.set(new Map(e.timeSlotStats)),e.userPatterns){let i=new Map;for(let[r,d]of e.userPatterns)i.set(r,E(h({},d),{lastActiveTime:d.lastActiveTime?new Date(d.lastActiveTime):void 0}));this._userPatterns.set(i)}e.scheduledTasks&&this._scheduledTasks.set(e.scheduledTasks.map(i=>E(h({},i),{scheduledTime:new Date(i.scheduledTime),createdAt:new Date(i.createdAt)}))),console.log("[SmartTiming] \u5DF2\u5F9E\u5B58\u5132\u6062\u5FA9\u6578\u64DA")}catch(t){console.error("[SmartTiming] \u6062\u5FA9\u6578\u64DA\u5931\u6557:",t)}}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}};var fe=[{id:"rule_low_conversion",name:"\u4F4E\u8F49\u5316\u7387\u544A\u8B66",enabled:!0,type:"alert",condition:{metric:"conversion_rate",operator:"lt",value:10,timeWindow:60},action:{type:"send_alert",params:{level:"warning",message:"\u8FD11\u5C0F\u6642\u8F49\u5316\u7387\u4F4E\u65BC10%"}},priority:1,triggerCount:0},{id:"rule_no_response",name:"\u9023\u7E8C\u7121\u56DE\u8986\u5207\u63DB\u89D2\u8272",enabled:!0,type:"role_switch",condition:{metric:"no_response_count",operator:"gte",value:3},action:{type:"switch_role",params:{strategy:"next_best"}},priority:2,triggerCount:0},{id:"rule_slow_response",name:"\u7528\u6236\u56DE\u8986\u6162\u6642\u6E1B\u7DE9\u7BC0\u594F",enabled:!0,type:"rhythm_adjust",condition:{metric:"response_rate",operator:"lt",value:.3},action:{type:"adjust_delay",params:{multiplier:1.5}},priority:3,triggerCount:0},{id:"rule_high_interest",name:"\u9AD8\u8208\u8DA3\u5EA6\u52A0\u5FEB\u7BC0\u594F",enabled:!0,type:"rhythm_adjust",condition:{metric:"interest_score",operator:"gt",value:80},action:{type:"adjust_delay",params:{multiplier:.7}},priority:4,triggerCount:0}],oe=class o{constructor(){this.analytics=A(N);this.timing=A(j);this.toast=A(ee);this._rules=S(fe);this.rules=this._rules.asReadonly();this._rhythmConfig=S({baseDelay:5,varianceRatio:.3,minDelay:2,maxDelay:30,adaptiveMode:!0});this.rhythmConfig=this._rhythmConfig.asReadonly();this._alerts=S([]);this.alerts=this._alerts.asReadonly();this.unacknowledgedCount=T(()=>this._alerts().filter(t=>!t.acknowledged).length);this.sessionContext=S({noResponseCount:0,userResponseTimes:[],interestScores:[]});this.STORAGE_KEY="smartAutomation";this.lastRuleCheck=0;this.RULE_CHECK_COOLDOWN=6e4;this.ruleCheckTimeout=null;this.loadFromStorage(),setInterval(()=>{let t=this.analytics.totalStats();this.checkRulesWithCooldown(t)},this.RULE_CHECK_COOLDOWN)}checkRulesWithCooldown(t){let e=Date.now();e-this.lastRuleCheck<this.RULE_CHECK_COOLDOWN||(this.lastRuleCheck=e,this.checkRules(t))}addRule(t){let e=E(h({},t),{id:`rule_${Date.now()}`,triggerCount:0});this._rules.update(i=>[...i,e]),this.saveToStorage()}updateRule(t,e){this._rules.update(i=>i.map(r=>r.id===t?h(h({},r),e):r)),this.saveToStorage()}toggleRule(t){this._rules.update(e=>e.map(i=>i.id===t?E(h({},i),{enabled:!i.enabled}):i)),this.saveToStorage()}checkRules(t){let e=this._rules().filter(i=>i.enabled).sort((i,r)=>i.priority-r.priority);for(let i of e)this.evaluateCondition(i.condition,t)&&this.executeAction(i)}evaluateCondition(t,e){let i;switch(t.metric){case"conversion_rate":i=e.conversionRate;break;case"response_rate":i=e.avgEngagementScore/100;break;case"interest_score":i=e.avgInterestScore;break;case"no_response_count":i=this.sessionContext().noResponseCount;break;case"message_count":i=e.totalSessions;break;default:return!1}switch(t.operator){case"lt":return i<t.value;case"gt":return i>t.value;case"eq":return i===t.value;case"lte":return i<=t.value;case"gte":return i>=t.value;default:return!1}}executeAction(t){switch(console.log(`[SmartAutomation] \u89F8\u767C\u898F\u5247: ${t.name}`),this._rules.update(e=>e.map(i=>i.id===t.id?E(h({},i),{triggerCount:i.triggerCount+1,lastTriggered:new Date}):i)),t.action.type){case"send_alert":this.createAlert({type:t.action.params.level||"warning",title:t.name,message:t.action.params.message});break;case"switch_role":this.triggerRoleSwitch(t.action.params.strategy);break;case"adjust_delay":this.adjustRhythm(t.action.params.multiplier);break;case"pause":window.dispatchEvent(new CustomEvent("automation:pause",{detail:t}));break;case"escalate":this.createAlert({type:"error",title:"\u9700\u8981\u4EBA\u5DE5\u4ECB\u5165",message:`\u898F\u5247\u300C${t.name}\u300D\u5EFA\u8B70\u66AB\u505C\u81EA\u52D5\u5316\uFF0C\u8ACB\u4EBA\u5DE5\u8655\u7406`});break}this.saveToStorage()}getRecommendedRoles(){let t=this.analytics.roleComboStats(),e=this.analytics.topRoleCombos();if(e.length===0)return[];let i=t.length>0?t.reduce((r,d)=>r+d.conversionRate,0)/t.length:10;return e.slice(0,3).map((r,d)=>({roleCombo:r,confidence:Math.min(.9-d*.1,r.totalSessions/20),reason:this.getRecommendationReason(r,d),expectedImprovement:Math.max(0,r.conversionRate-i)}))}getRecommendationReason(t,e){return e===0?`\u8F49\u5316\u7387\u6700\u9AD8 (${t.conversionRate.toFixed(1)}%)\uFF0C\u57FA\u65BC ${t.totalSessions} \u6B21\u4F7F\u7528`:t.trend==="up"?"\u6548\u679C\u6301\u7E8C\u4E0A\u5347\uFF0C\u8FD1\u671F\u8868\u73FE\u512A\u79C0":`\u7A69\u5B9A\u8868\u73FE\uFF0C\u8F49\u5316\u7387 ${t.conversionRate.toFixed(1)}%`}triggerRoleSwitch(t){let e=this.getRecommendedRoles();e.length>0&&(window.dispatchEvent(new CustomEvent("automation:role-switch",{detail:{strategy:t,recommended:e[0].roleCombo}})),this.toast.info(`\u{1F4A1} \u5EFA\u8B70\u5207\u63DB\u81F3\u89D2\u8272\u7D44\u5408: ${e[0].roleCombo.comboName}`))}updateRhythmConfig(t){this._rhythmConfig.update(e=>h(h({},e),t)),this.saveToStorage()}adjustRhythm(t){let e=this._rhythmConfig(),i=Math.max(e.minDelay,Math.min(e.maxDelay,e.baseDelay*t));this._rhythmConfig.update(r=>E(h({},r),{baseDelay:i})),console.log(`[SmartAutomation] \u7BC0\u594F\u8ABF\u6574: ${e.baseDelay}s \u2192 ${i}s`)}getAdaptiveDelay(t){let e=this._rhythmConfig();if(!e.adaptiveMode)return e.baseDelay;let i=e.baseDelay;t?.userResponseTime!==void 0&&(t.userResponseTime<30?i*=.8:t.userResponseTime>120&&(i*=1.3)),t?.interestScore!==void 0&&(t.interestScore>80?i*=.7:t.interestScore<30&&(i*=1.2));let r=i*e.varianceRatio*(Math.random()-.5);return i+=r,Math.max(e.minDelay,Math.min(e.maxDelay,i))}recordUserResponse(t,e,i){this.sessionContext.update(r=>({noResponseCount:t?0:r.noResponseCount+1,userResponseTimes:e?[...r.userResponseTimes.slice(-9),e]:r.userResponseTimes,interestScores:i?[...r.interestScores.slice(-9),i]:r.interestScores}))}resetSessionContext(){this.sessionContext.set({noResponseCount:0,userResponseTimes:[],interestScores:[]})}createAlert(t){let e=E(h({id:`alert_${Date.now()}`},t),{timestamp:new Date,acknowledged:!1});return this._alerts.update(i=>[e,...i].slice(0,50)),this.saveToStorage(),t.type==="error"?this.toast.error(`\u{1F6A8} ${t.title}: ${t.message}`):t.type==="warning"&&this.toast.warning(`\u26A0\uFE0F ${t.title}: ${t.message}`),console.log(`[SmartAutomation] \u65B0\u544A\u8B66: ${t.title}`),e}acknowledgeAlert(t,e){this._alerts.update(i=>i.map(r=>r.id===t?E(h({},r),{acknowledged:!0,actionTaken:e}):r)),this.saveToStorage()}acknowledgeAllAlerts(){this._alerts.update(t=>t.map(e=>E(h({},e),{acknowledged:!0}))),this.saveToStorage()}clearAcknowledgedAlerts(){this._alerts.update(t=>t.filter(e=>!e.acknowledged)),this.saveToStorage()}saveToStorage(){let t={rules:this._rules(),rhythmConfig:this._rhythmConfig(),alerts:this._alerts().slice(0,20),savedAt:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}loadFromStorage(){try{let t=localStorage.getItem(this.STORAGE_KEY);if(!t)return;let e=JSON.parse(t);if(e.rules){let i=new Set(e.rules.map(d=>d.id)),r=[...e.rules.map(d=>E(h({},d),{lastTriggered:d.lastTriggered?new Date(d.lastTriggered):void 0})),...fe.filter(d=>!i.has(d.id))];this._rules.set(r)}e.rhythmConfig&&this._rhythmConfig.set(e.rhythmConfig),e.alerts&&this._alerts.set(e.alerts.map(i=>E(h({},i),{timestamp:new Date(i.timestamp)}))),console.log("[SmartAutomation] \u5DF2\u5F9E\u5B58\u5132\u6062\u5FA9\u6578\u64DA")}catch(t){console.error("[SmartAutomation] \u6062\u5FA9\u6578\u64DA\u5931\u6557:",t)}}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}};var se=(o,t)=>t.id,tt=(o,t)=>t.roleCombo.comboId;function it(o,t){if(o&1&&(s(0,"span",30),n(1),l()),o&2){let e=m().$implicit;a(),_(" ",e.badge," ")}}function nt(o,t){if(o&1){let e=k();s(0,"button",26),w("click",function(){let r=v(e).$implicit,d=m();return x(d.executeAction(r))}),s(1,"div",27),n(2),l(),s(3,"div",28),n(4),l(),s(5,"div",29),n(6),l(),f(7,it,2,1,"span",30),l()}if(o&2){let e=t.$implicit,i=m();X(i.getActionButtonClass(e)),J("disabled",e.disabled),a(2),p(e.icon),a(2),p(e.name),a(2),p(e.description),a(),b(e.badge?7:-1)}}function ot(o,t){if(o&1&&(s(0,"span",33),n(1),l()),o&2){let e=m().$implicit;a(),_("\xD7",e.usageCount)}}function rt(o,t){if(o&1){let e=k();s(0,"button",31),w("click",function(){let r=v(e).$implicit,d=m();return x(d.launchPreset(r))}),s(1,"span"),n(2),l(),s(3,"span",32),n(4),l(),f(5,ot,2,1,"span",33),l()}if(o&2){let e=t.$implicit;a(2),p(e.icon),a(2),p(e.name),a(),b(e.usageCount>0?5:-1)}}function at(o,t){if(o&1){let e=k();s(0,"div",35)(1,"div",2)(2,"div",36)(3,"span",37),n(4,"\u{1F3AD}"),l(),s(5,"span",38),n(6),l()(),s(7,"div",36)(8,"span",39),n(9),l(),s(10,"button",40),w("click",function(){let r=v(e).$implicit,d=m(2);return x(d.applyRecommendation(r))}),n(11," \u4F7F\u7528 "),l()()(),s(12,"div",29),n(13),l()()}if(o&2){let e=t.$implicit;a(6),p(e.roleCombo.comboName),a(3),_("+",e.expectedImprovement.toFixed(1),"%"),a(4),p(e.reason)}}function st(o,t){if(o&1&&(s(0,"div",23)(1,"h4",34)(2,"span"),n(3,"\u{1F4A1}"),l(),n(4," AI \u63A8\u85A6 "),l(),I(5,at,14,3,"div",35,tt),l()),o&2){let e=m();a(5),V(e.recommendations())}}function lt(o,t){if(o&1){let e=k();s(0,"div",24)(1,"div",2)(2,"div",36)(3,"span",41),n(4,"\u{1F514}"),l(),s(5,"span",32),n(6),l()(),s(7,"button",42),w("click",function(){v(e);let r=m();return x(r.viewAlerts.emit())}),n(8," \u67E5\u770B\u5168\u90E8 "),l()()()}if(o&2){let e=m();a(6),_("",e.alertCount()," \u500B\u672A\u8655\u7406\u544A\u8B66")}}function dt(o,t){if(o&1){let e=k();s(0,"div",47)(1,"div",5)(2,"span",50),n(3),l(),s(4,"div")(5,"div",38),n(6),l(),s(7,"div",7),n(8),l()()(),s(9,"button",51),w("click",function(){let r=v(e).$implicit,d=m(2);return x(d.deletePreset(r.id))}),n(10," \u{1F5D1}\uFE0F "),l()()}if(o&2){let e=t.$implicit;a(3),p(e.icon),a(3),p(e.name),a(2),p(e.description)}}function ct(o,t){if(o&1){let e=k();s(0,"div",43),w("click",function(){v(e);let r=m();return x(r.showPresetManager.set(!1))}),s(1,"div",44),w("click",function(r){return v(e),x(r.stopPropagation())}),s(2,"h3",45),n(3,"\u7BA1\u7406\u5E38\u7528\u914D\u7F6E"),l(),s(4,"div",46),I(5,dt,11,3,"div",47,se),l(),s(7,"div",48)(8,"button",49),w("click",function(){v(e);let r=m();return x(r.showPresetManager.set(!1))}),n(9," \u95DC\u9589 "),l()()()()}if(o&2){let e=m();a(5),V(e.presets())}}var re=class o{constructor(){this.timing=A(j);this.automation=A(oe);this.analytics=A(N);this.startMarketing=new z;this.viewAlerts=new z;this.navigateTo=new z;this.showPresetManager=S(!1);this.presets=S([{id:"preset_quick_group",name:"\u7FA4\u7D44\u5FEB\u653B",icon:"\u{1F680}",description:"\u9867\u554F+\u5C08\u5BB6\u7D44\u5408\u5FEB\u901F\u5165\u7FA4",roleCombo:["consultant","expert"],targetType:"group",timing:"now",usageCount:12},{id:"preset_private_nurture",name:"\u79C1\u804A\u57F9\u80B2",icon:"\u{1F4AC}",description:"\u55AE\u89D2\u8272\u7CBE\u7D30\u5316\u79C1\u804A",roleCombo:["consultant"],targetType:"private",timing:"smart",usageCount:8},{id:"preset_scheduled",name:"\u5B9A\u6642\u71DF\u92B7",icon:"\u23F0",description:"\u667A\u80FD\u9078\u6642\u5B9A\u6642\u767C\u9001",targetType:"both",timing:"scheduled",usageCount:5}]);this.timingStatus=T(()=>this.timing.isGoodTimeNow());this.alertCount=T(()=>this.automation.unacknowledgedCount());this.recommendations=T(()=>this.automation.getRecommendedRoles());this.quickActions=[]}ngOnInit(){this.initQuickActions()}initQuickActions(){this.quickActions=[{id:"action_start_now",name:"\u7ACB\u5373\u958B\u59CB",icon:"\u{1F680}",description:"\u73FE\u5728\u958B\u59CB\u71DF\u92B7",color:"purple",category:"marketing",action:()=>this.startMarketing.emit({type:"immediate",config:{}})},{id:"action_smart_schedule",name:"\u667A\u80FD\u5B9A\u6642",icon:"\u23F1\uFE0F",description:"\u9078\u64C7\u6700\u4F73\u6642\u6A5F",color:"blue",category:"marketing",action:()=>this.startMarketing.emit({type:"smart_schedule",config:{}})},{id:"action_view_report",name:"\u67E5\u770B\u5831\u8868",icon:"\u{1F4CA}",description:"\u71DF\u92B7\u6548\u679C\u5206\u6790",color:"green",category:"analysis",action:()=>this.navigateTo.emit("marketing-report"),badge:this.analytics.todayStats().conversions>0?`+${this.analytics.todayStats().conversions}`:void 0},{id:"action_automation",name:"\u81EA\u52D5\u5316\u8A2D\u7F6E",icon:"\u2699\uFE0F",description:"\u914D\u7F6E\u81EA\u52D5\u898F\u5247",color:"slate",category:"automation",action:()=>this.navigateTo.emit("automation")}]}timingScoreClass(){let t=this.timingStatus().score;return t>=75?"text-green-400":t>=50?"text-amber-400":"text-red-400"}timingBgClass(){let t=this.timingStatus().score;return t>=75?"bg-green-500/20 text-green-400":t>=50?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}getActionButtonClass(t){let e="border-slate-700 bg-slate-800 hover:bg-slate-700";if(t.disabled)return e+" opacity-50 cursor-not-allowed";switch(t.color){case"purple":return"border-purple-500/30 bg-purple-500/10 hover:bg-purple-500/20";case"blue":return"border-blue-500/30 bg-blue-500/10 hover:bg-blue-500/20";case"green":return"border-green-500/30 bg-green-500/10 hover:bg-green-500/20";default:return e}}executeAction(t){t.disabled||t.action()}launchPreset(t){this.presets.update(e=>e.map(i=>i.id===t.id?E(h({},i),{usageCount:i.usageCount+1,lastUsed:new Date}):i)),this.startMarketing.emit({type:"preset",config:{presetId:t.id,roleCombo:t.roleCombo,targetType:t.targetType,timing:t.timing}})}createNewPreset(){console.log("\u5275\u5EFA\u65B0\u9810\u8A2D")}deletePreset(t){this.presets.update(e=>e.filter(i=>i.id!==t))}applyRecommendation(t){this.startMarketing.emit({type:"recommended",config:{roleCombo:t.roleCombo,confidence:t.confidence}})}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=L({type:o,selectors:[["app-quick-actions-panel"]],outputs:{startMarketing:"startMarketing",viewAlerts:"viewAlerts",navigateTo:"navigateTo"},decls:46,vars:14,consts:[[1,"quick-actions-panel","bg-slate-900","border","border-slate-700","rounded-xl","overflow-hidden"],[1,"p-4","bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border-b","border-slate-700"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"text-right"],[1,"text-xs","text-slate-400"],[1,"flex","items-center","gap-1"],[1,"text-lg","font-bold"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","text-2xl"],[1,"mt-3","p-2","bg-slate-800/50","rounded-lg","text-sm"],[1,"p-4"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-3"],[1,"p-4","rounded-xl","border","transition-all","hover:scale-105","relative",3,"disabled","class"],[1,"p-4","border-t","border-slate-700"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium","text-white","flex","items-center","gap-2"],[1,"text-xs","text-purple-400","hover:text-purple-300",3,"click"],[1,"flex","gap-2","flex-wrap"],[1,"px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","hover:bg-slate-700","transition-all","flex","items-center","gap-2"],[1,"px-3","py-2","border","border-dashed","border-slate-600","rounded-lg","hover:border-purple-500","transition-all","flex","items-center","gap-2","text-slate-500","hover:text-purple-400",3,"click"],[1,"text-sm"],[1,"p-4","border-t","border-slate-700","bg-gradient-to-r","from-indigo-500/10","to-violet-500/10"],[1,"p-4","border-t","border-slate-700","bg-red-500/10"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center"],[1,"p-4","rounded-xl","border","transition-all","hover:scale-105","relative",3,"click","disabled"],[1,"text-3xl","mb-2"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-slate-400","mt-1"],[1,"absolute","top-2","right-2","px-1.5","py-0.5","text-xs","rounded-full","bg-red-500","text-white"],[1,"px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","hover:bg-slate-700","transition-all","flex","items-center","gap-2",3,"click"],[1,"text-sm","text-white"],[1,"text-xs","text-slate-500"],[1,"text-sm","font-medium","text-white","flex","items-center","gap-2","mb-3"],[1,"p-3","bg-slate-800/50","rounded-lg","mb-2","last:mb-0"],[1,"flex","items-center","gap-2"],[1,"text-purple-400"],[1,"text-white","font-medium"],[1,"text-xs","text-green-400"],[1,"px-2","py-1","text-xs","bg-purple-500","text-white","rounded","hover:bg-purple-600",3,"click"],[1,"text-red-400"],[1,"text-xs","text-red-400","hover:text-red-300",3,"click"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-xl","w-full","max-w-md","p-6",3,"click"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"space-y-3","max-h-96","overflow-y-auto"],[1,"p-3","bg-slate-800","rounded-lg","flex","items-center","justify-between"],[1,"flex","justify-end","gap-3","mt-4"],[1,"px-4","py-2","text-slate-400","hover:text-white",3,"click"],[1,"text-xl"],[1,"text-red-400","hover:text-red-300",3,"click"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h3",3)(5,"span"),n(6,"\u26A1"),l(),n(7," \u5FEB\u901F\u555F\u52D5 "),l(),s(8,"p",4),n(9,"\u4E00\u9375\u958B\u59CB\u71DF\u92B7\u4EFB\u52D9"),l()(),s(10,"div",5)(11,"div",6)(12,"div",7),n(13,"\u7576\u524D\u6642\u6A5F"),l(),s(14,"div",8)(15,"span",9),n(16),l(),s(17,"span",7),n(18,"\u5206"),l()()(),s(19,"div",10),n(20),l()()(),s(21,"div",11),n(22),l()(),s(23,"div",12)(24,"div",13),I(25,nt,8,7,"button",14,se),l()(),s(27,"div",15)(28,"div",16)(29,"h4",17)(30,"span"),n(31,"\u{1F4CC}"),l(),n(32," \u5E38\u7528\u914D\u7F6E "),l(),s(33,"button",18),w("click",function(){return i.showPresetManager.set(!0)}),n(34," \u7BA1\u7406\u914D\u7F6E "),l()(),s(35,"div",19),I(36,rt,6,3,"button",20,se),s(38,"button",21),w("click",function(){return i.createNewPreset()}),s(39,"span"),n(40,"\u2795"),l(),s(41,"span",22),n(42,"\u65B0\u589E"),l()()()(),f(43,st,7,0,"div",23),f(44,lt,9,1,"div",24),l(),f(45,ct,10,0,"div",25)),e&2&&(a(15),X(i.timingScoreClass()),a(),_(" ",i.timingStatus().score," "),a(3),X(i.timingBgClass()),a(),_(" ",i.timingStatus().isGood?"\u2713":"\u23F0"," "),a(),D("text-green-400",i.timingStatus().isGood)("text-amber-400",!i.timingStatus().isGood),a(),_(" ",i.timingStatus().suggestion," "),a(3),V(i.quickActions),a(11),V(i.presets()),a(7),b(i.recommendations().length>0?43:-1),a(),b(i.alertCount()>0?44:-1),a(),b(i.showPresetManager()?45:-1))},dependencies:[$,Z],styles:[".quick-actions-panel[_ngcontent-%COMP%]{max-width:100%}"]})}};var he=(o,t)=>t.id;function mt(o,t){o&1&&(c(0,"span",5),n(1,"\u{1F512}"),u())}function ut(o,t){if(o&1){let e=k();c(0,"app-smart-dashboard",8),F("navigateTo",function(r){v(e);let d=m();return x(d.navigateTo(r))}),u()}}function pt(o,t){o&1&&B(0,"div",20)}function gt(o,t){o&1&&B(0,"div",25)}function vt(o,t){o&1&&B(0,"span",27)}function xt(o,t){o&1&&B(0,"div",28)}function _t(o,t){o&1&&B(0,"div",29)}function ft(o,t){if(o&1){let e=k();c(0,"div",52),F("click",function(){v(e);let r=m(2);return x(r.navigateTo("trigger-rules"))}),n(1," \u26A0\uFE0F \u9700\u914D\u7F6E\u898F\u5247 "),u()}}function bt(o,t){if(o&1){let e=k();c(0,"div",31)(1,"div",53)(2,"div",12),B(3,"div",54),c(4,"span",55),n(5),u()(),c(6,"button",56),F("click",function(){v(e);let r=m(2);return x(r.cancelAndRefresh())}),c(7,"span"),n(8,"\u2715"),u(),c(9,"span"),n(10,"\u53D6\u6D88"),u()()(),c(11,"div",57),B(12,"div",58),u(),c(13,"div",59)(14,"div",60)(15,"span"),n(16),u(),c(17,"span"),n(18,"\u5E33\u865F"),u()(),c(19,"div",60)(20,"span"),n(21),u(),c(22,"span"),n(23,"\u7FA4\u7D44"),u()(),c(24,"div",60)(25,"span"),n(26),u(),c(27,"span"),n(28,"\u76E3\u63A7"),u()(),c(29,"div",60)(30,"span"),n(31),u(),c(32,"span"),n(33,"AI"),u()(),c(34,"div",60)(35,"span"),n(36),u(),c(37,"span"),n(38,"\u5B8C\u6210"),u()()()()}if(o&2){let e=m(2);a(5),p(e.startMessage()),a(7),R("width",e.startProgress(),"%"),a(2),D("text-emerald-400",e.startProgress()>=10)("text-slate-500",e.startProgress()<10),a(2),p(e.startProgress()>=10?"\u2713":"\u25CB"),a(3),D("text-emerald-400",e.startProgress()>=40)("text-slate-500",e.startProgress()<40),a(2),p(e.startProgress()>=40?"\u2713":"\u25CB"),a(3),D("text-emerald-400",e.startProgress()>=60)("text-slate-500",e.startProgress()<60),a(2),p(e.startProgress()>=60?"\u2713":"\u25CB"),a(3),D("text-emerald-400",e.startProgress()>=80)("text-slate-500",e.startProgress()<80),a(2),p(e.startProgress()>=80?"\u2713":"\u25CB"),a(3),D("text-emerald-400",e.startProgress()>=100)("text-slate-500",e.startProgress()<100),a(2),p(e.startProgress()>=100?"\u2713":"\u25CB")}}function ht(o,t){if(o&1){let e=k();c(0,"button",61),F("click",function(){v(e);let r=m(2);return x(r.oneClickStart())}),c(1,"span",62),n(2,"\u26A1"),u(),c(3,"span"),n(4,"\u4E00\u9375\u5168\u90E8\u555F\u52D5"),u()()}if(o&2){let e=m(2);Y("disabled",e.starting())}}function Ct(o,t){if(o&1){let e=k();c(0,"button",63),F("click",function(){v(e);let r=m(2);return x(r.oneClickStop())}),c(1,"span",62),n(2,"\u{1F6D1}"),u(),c(3,"span"),n(4,"\u4E00\u9375\u505C\u6B62\u6240\u6709"),u()()}}function wt(o,t){o&1&&(c(0,"span",72),n(1,"\u2192"),u())}function Et(o,t){if(o&1&&(c(0,"div",70)(1,"span",71),n(2),u(),f(3,wt,2,0,"span",72),u()),o&2){let e=t.$implicit,i=t.$index,r=m().$implicit,d=m(2);a(2),P(" ",d.getStepIcon(e.type)," ",e.name," "),a(),b(i<r.steps.length-1?3:-1)}}function kt(o,t){if(o&1){let e=k();c(0,"div",40)(1,"div",64)(2,"div",65)(3,"span"),n(4),u(),c(5,"span",66),n(6),u()(),c(7,"button",67),F("click",function(){let r=v(e).$implicit,d=m(2);return x(d.automationWorkflow.toggleWorkflow(r.id,!r.enabled))}),n(8),u()(),c(9,"div",68)(10,"span"),n(11),u(),c(12,"span"),n(13),u(),c(14,"span"),n(15),u()(),c(16,"div",69),I(17,Et,4,3,"div",70,he),u()()}if(o&2){let e=t.$implicit,i=m(2);a(3),D("text-emerald-400",e.enabled)("text-slate-500",!e.enabled),a(),_(" ",e.enabled?"\u{1F7E2}":"\u26AA"," "),a(2),p(e.name),a(),D("bg-emerald-500",e.enabled)("hover:bg-emerald-600",e.enabled)("text-white",e.enabled)("bg-slate-600",!e.enabled)("hover:bg-slate-500",!e.enabled)("text-slate-300",!e.enabled),a(),_(" ",e.enabled?"\u904B\u884C\u4E2D":"\u5DF2\u66AB\u505C"," "),a(3),_("\u4ECA\u65E5\u89F8\u767C: ",e.stats.todayTriggers),a(2),_("\u9032\u884C\u4E2D: ",i.automationWorkflow.activeExecutionCount()),a(2),_("\u8F49\u5316: ",e.stats.conversions),a(2),V(e.steps)}}function St(o,t){if(o&1){let e=k();c(0,"app-quick-actions-panel",9),F("startMarketing",function(r){v(e);let d=m();return x(d.handleQuickStart(r))})("navigateTo",function(r){v(e);let d=m();return x(d.navigateTo(r))})("viewAlerts",function(){v(e);let r=m();return x(r.navigateTo("monitoring"))}),u(),c(1,"div",10)(2,"div",11)(3,"div",12)(4,"span",13),n(5,"\u{1F680}"),u(),c(6,"h3",14),n(7,"\u4E00\u9375\u904B\u884C\u4E2D\u5FC3"),u()(),c(8,"button",15),F("click",function(){v(e);let r=m();return x(r.refreshStatus())}),O(),c(9,"svg",16),B(10,"path",17),u()()(),K(),c(11,"div",18)(12,"div",19),f(13,pt,1,0,"div",20),c(14,"div",21)(15,"div",22),n(16,"\u{1F511}"),u(),c(17,"div",23),n(18,"\u5E33\u865F\u5728\u7DDA"),u(),c(19,"div",24),n(20),u()()(),c(21,"div",19),f(22,gt,1,0,"div",25),c(23,"div",21)(24,"div",22),n(25,"\u{1F4E1}"),u(),c(26,"div",23),n(27,"\u76E3\u63A7\u72C0\u614B"),u(),c(28,"div",26),f(29,vt,1,0,"span",27),n(30),u()()(),c(31,"div",19),f(32,xt,1,0,"div",28),c(33,"div",21)(34,"div",22),n(35,"\u{1F916}"),u(),c(36,"div",23),n(37,"AI \u804A\u5929"),u(),c(38,"div",24),n(39),u()()(),c(40,"div",19),f(41,_t,1,0,"div",29),c(42,"div",21)(43,"div",22),n(44,"\u26A1"),u(),c(45,"div",23),n(46,"\u89F8\u767C\u898F\u5247"),u(),c(47,"div",24),n(48),u(),f(49,ft,2,0,"div",30),u()()(),f(50,bt,39,28,"div",31),c(51,"div",32),f(52,ht,5,1,"button",33)(53,Ct,5,0,"button",34),u()(),c(54,"div",35)(55,"div",36)(56,"div",11)(57,"div",12)(58,"span",37),n(59,"\u{1F3AF}"),u(),c(60,"h3",38),n(61,"\u5F15\u5C0E\u5F0F\u5DE5\u4F5C\u6D41"),u()()(),c(62,"p",39),n(63," \u95DC\u9375\u8A5E\u89F8\u767C \u2192 AI \u7B56\u5283 \u2192 \u79C1\u804A\u57F9\u80B2 \u2192 \u8208\u8DA3\u5EFA\u7FA4 \u2192 \u7D44\u7FA4\u6210\u4EA4 "),u(),I(64,kt,19,22,"div",40,he),c(66,"div",41),n(67," \u{1F4A1} \u555F\u7528\u5F8C\uFF0C\u7576\u76E3\u63A7\u7FA4\u7D44\u89F8\u767C\u95DC\u9375\u8A5E\u6642\uFF0C\u5C07\u81EA\u52D5\u57F7\u884C AI \u7B56\u5283\u4E26\u958B\u59CB\u591A\u89D2\u8272\u5354\u4F5C "),u()(),c(68,"div",36)(69,"div",42)(70,"span",37),n(71,"\u26A1"),u(),c(72,"h3",38),n(73,"\u5FEB\u901F\u64CD\u4F5C"),u()(),c(74,"div",43)(75,"button",44),F("click",function(){v(e);let r=m();return x(r.navigateTo("multi-role"))}),c(76,"div",45),n(77,"\u{1F3AD}"),u(),c(78,"div",46),n(79,"\u624B\u52D5\u7B56\u5283"),u(),c(80,"div",47),n(81,"\u958B\u59CB AI \u591A\u89D2\u8272\u5354\u4F5C"),u()(),c(82,"button",48),F("click",function(){v(e);let r=m();return x(r.navigateTo("monitoring-groups"))}),c(83,"div",45),n(84,"\u{1F465}"),u(),c(85,"div",46),n(86,"\u76E3\u63A7\u7FA4\u7D44"),u(),c(87,"div",47),n(88,"\u914D\u7F6E\u76E3\u63A7\u4F86\u6E90"),u()(),c(89,"button",49),F("click",function(){v(e);let r=m();return x(r.navigateTo("keyword-sets"))}),c(90,"div",45),n(91,"\u{1F511}"),u(),c(92,"div",46),n(93,"\u95DC\u9375\u8A5E\u96C6"),u(),c(94,"div",47),n(95,"\u8A2D\u7F6E\u89F8\u767C\u8A5E"),u()(),c(96,"button",50),F("click",function(){v(e);let r=m();return x(r.navigateTo("leads"))}),c(97,"div",45),n(98,"\u{1F4CB}"),u(),c(99,"div",46),n(100,"\u67E5\u770B\u7DDA\u7D22"),u(),c(101,"div",47),n(102,"\u7BA1\u7406\u6F5B\u5728\u5BA2\u6236"),u()()()()(),c(103,"app-quick-workflow",51),F("navigateTo",function(r){v(e);let d=m();return x(d.navigateTo(r))})("startMonitoring",function(){v(e);let r=m();return x(r.startMonitoring())})("stopMonitoring",function(){v(e);let r=m();return x(r.stopMonitoring())}),u()}if(o&2){let e,i,r,d,C,g,M,W,y=m();a(13),b(y.onlineAccountsCount()>0?13:-1),a(6),R("color",y.onlineAccountsCount()>0?"var(--success)":"var(--error)"),a(),P(" ",y.onlineAccountsCount(),"/",y.totalAccountsCount()," "),a(2),b(y.isMonitoring()?22:-1),a(6),R("color",y.isMonitoring()?"var(--success)":"var(--error)"),a(),b(y.isMonitoring()?29:-1),a(),_(" ",y.isMonitoring()?"\u904B\u884C\u4E2D":"\u672A\u555F\u52D5"," "),a(2),b((e=y.status().ai)!=null&&e.enabled?32:-1),a(6),R("color",(i=y.status().ai)!=null&&i.enabled?"var(--success)":"var(--error)"),a(),_(" ",(r=y.status().ai)!=null&&r.enabled?((r=y.status().ai)==null?null:r.mode)==="full"?"\u5168\u81EA\u52D5":"\u534A\u81EA\u52D5":"\u672A\u555F\u7528"," "),a(2),b((((d=y.status().campaigns)==null?null:d.active)||0)>0?41:-1),a(6),R("color",(((C=y.status().campaigns)==null?null:C.active)||0)>0?"var(--success)":"var(--warning)"),a(),P(" ",((g=y.status().campaigns)==null?null:g.active)||0,"/",((g=y.status().campaigns)==null?null:g.total)||0," "),a(),b((((M=y.status().campaigns)==null?null:M.active)||0)===0?49:-1),a(),b(y.starting()?50:-1),a(2),b(!y.isMonitoring()||!((W=y.status().ai)!=null&&W.enabled)?52:53),a(12),V(y.automationWorkflow.workflows()),a(39),Y("systemStatus",y.status())("isMonitoring",y.isMonitoring())}}var be=class o{constructor(){this.i18n=A(me);this.nav=A(ue);this.ipc=A(de);this.toast=A(ee);this.accountService=A(pe);this.membershipService=A(ce);this.automationWorkflow=A(_e);this.mode=S("classic");this.starting=S(!1);this.startProgress=S(0);this.startMessage=S("");this.monitoringService=A(xe);this.isMonitoring=T(()=>this.monitoringService.monitoringActive());this.startTimeoutId=null;this.START_TIMEOUT_MS=12e4;this.heartbeatIntervalId=null;this.HEARTBEAT_INTERVAL_MS=3e4;this._status=S({});this.status=this._status.asReadonly();this.onlineAccountsCount=T(()=>this.accountService.accounts().filter(e=>e.status==="Online"||e.is_connected).length);this.totalAccountsCount=T(()=>this.accountService.accounts().length);this.ipcCleanup=[]}ngOnInit(){console.log("[DashboardView] Component initialized"),this.loadInitialData(),this.setupIpcListeners(),this.startHeartbeat()}ngOnDestroy(){this.ipcCleanup.forEach(t=>t()),this.clearStartTimeout(),this.stopHeartbeat()}startHeartbeat(){this.stopHeartbeat(),this.heartbeatIntervalId=setInterval(()=>{console.log("[DashboardView] \u5FC3\u8DF3\uFF1A\u5237\u65B0\u72C0\u614B"),this.refreshStatus()},this.HEARTBEAT_INTERVAL_MS)}stopHeartbeat(){this.heartbeatIntervalId&&(clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=null)}loadInitialData(){this.refreshStatus()}setupIpcListeners(){let t=this.ipc.on("system-status",g=>{this._status.set(g)}),e=this.ipc.on("monitoring-started",g=>{console.log("[DashboardView] \u76E3\u63A7\u5DF2\u555F\u52D5:",g),this.toast.success(g.message||"\u76E3\u63A7\u5DF2\u6210\u529F\u555F\u52D5")}),i=this.ipc.on("monitoring-start-failed",g=>{console.log("[DashboardView] \u76E3\u63A7\u555F\u52D5\u5931\u6557:",g);let M=g.message||"\u76E3\u63A7\u555F\u52D5\u5931\u6557";g.reason==="config_check_failed"&&g.issues?.length?M=`\u914D\u7F6E\u932F\u8AA4: ${g.issues[0]?.message||M}`:g.reason==="no_accessible_groups"?M="\u7121\u6CD5\u8A2A\u554F\u76E3\u63A7\u7FA4\u7D44\uFF0C\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44":g.reason==="all_accounts_failed"&&(M="\u6240\u6709\u76E3\u63A7\u5E33\u865F\u90FD\u7121\u6CD5\u555F\u52D5"),this.toast.error(M,5e3)}),r=this.ipc.on("monitoring-stopped",()=>{console.log("[DashboardView] \u76E3\u63A7\u5DF2\u505C\u6B62"),this.toast.info("\u76E3\u63A7\u5DF2\u505C\u6B62")}),d=this.ipc.on("one-click-start-progress",g=>{console.log("[DashboardView] \u6536\u5230\u4E00\u9375\u555F\u52D5\u9032\u5EA6:",g),this.startProgress.set(g.progress),this.startMessage.set(g.message),(g.step==="complete"||g.step==="error"||g.progress>=100)&&setTimeout(()=>{this.starting.set(!1),this.refreshStatus()},500)}),C=this.ipc.on("one-click-start-result",g=>{console.log("[DashboardView] \u6536\u5230\u4E00\u9375\u555F\u52D5\u7D50\u679C:",g),this.clearStartTimeout(),this.starting.set(!1),this.startProgress.set(100),this.startMessage.set(g.overall_success?"\u2705 \u555F\u52D5\u5B8C\u6210":"\u26A0\uFE0F \u90E8\u5206\u555F\u52D5\u5931\u6557"),g.monitoring?.success!==void 0&&console.log("[DashboardView] \u4E00\u9375\u555F\u52D5\u7D50\u679C\u76E3\u63A7\u72C0\u614B:",g.monitoring.success),this.refreshStatus(),setTimeout(()=>{this.startMessage.set("")},3e3)});this.ipcCleanup.push(t,e,i,r,d,C)}t(t,e){return this.i18n.t(t,e)}switchMode(t){if(t==="smart"&&!this.membershipService.hasFeature("smartMode")){this.toast.warning("\u9700\u8981\u9EC3\u91D1\u5927\u5E2B\u6216\u4EE5\u4E0A\u6703\u54E1");return}this.mode.set(t)}navigateTo(t){let e=typeof t=="string"?t:t.view,i=typeof t=="string"?void 0:t.handler,d={resources:"resource-center",accounts:"accounts","add-account":"add-account",automation:"automation",ads:"leads",leads:"leads","nurturing-analytics":"nurturing-analytics","ai-center":"aiCenter","multi-role":"multi-role"}[e]||e;console.log("[DashboardView] navigateTo:",{rawView:e,view:d,handler:i}),i&&this.executeHandler(i),d&&this.nav.navigateTo(d)}executeHandler(t){switch(console.log("[DashboardView] executeHandler:",t),t){case"scan-sessions":this.ipc.send("scan-orphan-sessions"),this.toast.info("\u{1F50D} \u6B63\u5728\u6383\u63CF\u53EF\u6062\u5FA9\u7684 Session...");break;case"new-campaign":this.ipc.send("open-add-campaign-dialog"),this.toast.info("\u26A1 \u6B63\u5728\u6253\u958B\u5275\u5EFA\u6D3B\u52D5\u5C0D\u8A71\u6846...");break;case"export-leads":this.ipc.send("open-export-dialog"),this.toast.info("\u{1F4E5} \u6B63\u5728\u6253\u958B\u5C0E\u51FA\u5C0D\u8A71\u6846...");break;case"start-monitoring":this.startMonitoring();break;case"run-script":this.toast.info("\u{1F3AC} \u6B63\u5728\u555F\u52D5\u5287\u672C\u57F7\u884C..."),this.ipc.send("run-multi-role-script");break;case"openAddAccountDialog":this.ipc.send("open-add-account-dialog");break;case"stopMonitoring":this.stopMonitoring();break;default:console.warn("[DashboardView] Unknown handler:",t),this.toast.info(`\u6B63\u5728\u8655\u7406: ${t}...`)}}refreshStatus(){this.ipc.send("get-system-status"),this.ipc.send("get-monitoring-status")}oneClickStart(){if(this.starting()){this.toast.warning("\u6B63\u5728\u555F\u52D5\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let t=this.totalAccountsCount();if(t===0){this.toast.error("\u274C \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55\u5E33\u865F\uFF0C\u8ACB\u5148\u6DFB\u52A0\u5E33\u865F",4e3);return}this.starting.set(!0),this.startProgress.set(0),this.startMessage.set(`\u{1F680} \u958B\u59CB\u555F\u52D5 (${t} \u500B\u5E33\u865F)...`),this.clearStartTimeout(),this.startTimeoutId=setTimeout(()=>{this.starting()&&(console.warn("[DashboardView] \u4E00\u9375\u555F\u52D5\u8D85\u6642\uFF0C\u81EA\u52D5\u6062\u5FA9"),this.starting.set(!1),this.startMessage.set("\u26A0\uFE0F \u555F\u52D5\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u5F8C\u7AEF\u72C0\u614B"),this.toast.warning("\u555F\u52D5\u8D85\u6642\uFF0C\u6B63\u5728\u5237\u65B0\u72C0\u614B...",3e3),this.refreshStatus())},this.START_TIMEOUT_MS),this.ipc.send("one-click-start",{forceRefresh:!0}),this.toast.info(`\u{1F680} \u958B\u59CB\u4E00\u9375\u555F\u52D5\uFF0C\u5F8C\u7AEF\u5C07\u81EA\u52D5\u9023\u63A5 ${t} \u500B\u5E33\u865F`,3e3)}clearStartTimeout(){this.startTimeoutId&&(clearTimeout(this.startTimeoutId),this.startTimeoutId=null)}cancelAndRefresh(){console.log("[DashboardView] \u7528\u6236\u53D6\u6D88\u555F\u52D5"),this.clearStartTimeout(),this.starting.set(!1),this.startProgress.set(0),this.startMessage.set(""),this.toast.info("\u5DF2\u53D6\u6D88\uFF0C\u6B63\u5728\u5237\u65B0\u72C0\u614B...",2e3),this.refreshStatus()}oneClickStop(){this.ipc.send("one-click-stop"),this.toast.info("\u6B63\u5728\u505C\u6B62\u6240\u6709\u670D\u52D9...")}startMonitoring(){this.ipc.send("start-monitoring")}stopMonitoring(){this.ipc.send("stop-monitoring")}handleQuickStart(t){switch(console.log("[Dashboard] \u5FEB\u6377\u555F\u52D5:",t),t.type){case"immediate":this.toast.info("\u{1F680} \u6B63\u5728\u555F\u52D5\u5373\u6642\u71DF\u92B7..."),this.navigateTo("multi-role");break;case"smart_schedule":this.toast.info("\u23F1\uFE0F \u6B63\u5728\u914D\u7F6E\u667A\u80FD\u5B9A\u6642..."),this.navigateTo("multi-role");break;case"preset":this.toast.success(`\u{1F4CC} \u4F7F\u7528\u9810\u8A2D\u914D\u7F6E: ${t.config.presetId}`),this.navigateTo("multi-role");break;case"recommended":this.toast.success(`\u{1F4A1} \u4F7F\u7528\u63A8\u85A6\u7D44\u5408: ${t.config.roleCombo?.comboName}`),this.navigateTo("multi-role");break;default:this.navigateTo("multi-role")}}getStepIcon(t){return{evaluate:"\u{1F4CA}",plan:"\u{1F3AF}",private_chat:"\u{1F4AC}",detect_interest:"\u{1F50D}",create_group:"\u{1F465}",group_marketing:"\u{1F680}",record:"\u{1F4DD}"}[t]||"\u25B6\uFE0F"}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=L({type:o,selectors:[["app-dashboard-view"]],decls:12,vars:22,consts:[[1,"page-content"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-4xl","font-bold",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-2","bg-slate-800/50","rounded-xl","p-1"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1",3,"click","title"],[1,"text-xs"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],[1,"block","-mx-8","-mb-8",2,"height","calc(100vh - 140px)"],[1,"block","-mx-8","-mb-8",2,"height","calc(100vh - 140px)",3,"navigateTo"],[1,"mb-6",3,"startMarketing","navigateTo","viewAlerts"],[1,"rounded-xl","p-6","mb-8",2,"background","linear-gradient(to right, var(--primary-bg), rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1))","border","1px solid var(--primary)","box-shadow","var(--shadow-lg)"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-xl","font-bold",2,"color","var(--text-primary)"],["title","\u5237\u65B0\u72C0\u614B",1,"transition-colors",2,"color","var(--text-muted)",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"rounded-lg","p-4","text-center","relative","overflow-hidden",2,"background-color","var(--bg-card)"],[1,"absolute","inset-0","bg-gradient-to-t","from-emerald-500/10","to-transparent"],[1,"relative"],[1,"text-2xl","mb-1"],[1,"text-sm",2,"color","var(--text-muted)"],[1,"text-xl","font-bold"],[1,"absolute","inset-0","bg-gradient-to-t","from-cyan-500/10","to-transparent"],[1,"text-xl","font-bold","flex","items-center","justify-center","gap-2"],[1,"w-2.5","h-2.5","rounded-full","bg-emerald-400","animate-pulse"],[1,"absolute","inset-0","bg-gradient-to-t","from-purple-500/10","to-transparent"],[1,"absolute","inset-0","bg-gradient-to-t","from-orange-500/10","to-transparent"],[1,"text-xs","text-yellow-400","mt-1","cursor-pointer","hover:underline"],[1,"bg-slate-800/50","rounded-lg","p-4","mb-4","border","border-cyan-500/30"],[1,"flex","gap-4"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2",3,"disabled"],[1,"flex-1","bg-gradient-to-r","from-red-500","to-orange-500","hover:from-red-600","hover:to-orange-600","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-8"],[1,"rounded-xl","p-6",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"text-2xl"],[1,"text-lg","font-bold",2,"color","var(--text-primary)"],[1,"text-sm","mb-4",2,"color","var(--text-muted)"],[1,"p-4","rounded-lg","mb-3",2,"background-color","var(--bg-secondary)"],[1,"text-xs","p-3","rounded-lg",2,"background-color","var(--bg-tertiary)","color","var(--text-muted)"],[1,"flex","items-center","gap-3","mb-4"],[1,"grid","grid-cols-2","gap-3"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-purple-500/10","border","border-transparent","hover:border-purple-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[1,"text-xl","mb-1"],[1,"font-medium","text-sm",2,"color","var(--text-primary)"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-cyan-500/10","border","border-transparent","hover:border-cyan-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-amber-500/10","border","border-transparent","hover:border-amber-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-emerald-500/10","border","border-transparent","hover:border-emerald-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[3,"navigateTo","startMonitoring","stopMonitoring","systemStatus","isMonitoring"],[1,"text-xs","text-yellow-400","mt-1","cursor-pointer","hover:underline",3,"click"],[1,"flex","items-center","justify-between","mb-3"],[1,"animate-spin","h-5","w-5","border-2","border-cyan-500","border-t-transparent","rounded-full"],[1,"text-cyan-300","font-medium"],["title","\u53D6\u6D88\u4E26\u5237\u65B0\u72C0\u614B",1,"px-3","py-1","text-xs","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors","flex","items-center","gap-1",3,"click"],[1,"w-full","bg-slate-700","rounded-full","h-2.5","mb-3"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","h-2.5","rounded-full","transition-all","duration-300"],[1,"flex","justify-between","text-xs"],[1,"flex","items-center","gap-1"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"text-xl"],[1,"flex-1","bg-gradient-to-r","from-red-500","to-orange-500","hover:from-red-600","hover:to-orange-600","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2",3,"click"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2"],[1,"font-medium",2,"color","var(--text-primary)"],[1,"px-3","py-1","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"flex","items-center","gap-4","text-xs",2,"color","var(--text-muted)"],[1,"flex","items-center","gap-1","mt-3","overflow-x-auto","pb-1"],[1,"flex","items-center"],[1,"px-2","py-1","text-xs","rounded","whitespace-nowrap",2,"background-color","var(--bg-tertiary)","color","var(--text-secondary)"],[1,"mx-1",2,"color","var(--text-muted)"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"h2",2),n(3),u(),c(4,"div",3)(5,"button",4),F("click",function(){return i.switchMode("smart")}),n(6," \u{1F916} \u667A\u80FD\u6A21\u5F0F "),f(7,mt,2,0,"span",5),u(),c(8,"button",6),F("click",function(){return i.switchMode("classic")}),n(9," \u{1F4CA} \u7D93\u5178\u6A21\u5F0F "),u()()(),f(10,ut,1,0,"app-smart-dashboard",7)(11,St,104,24),u()),e&2&&(a(3),p(i.t("dashboard")),a(2),D("bg-gradient-to-r",i.mode()==="smart")("from-cyan-500",i.mode()==="smart")("to-blue-500",i.mode()==="smart")("text-white",i.mode()==="smart")("text-slate-400",i.mode()!=="smart")("opacity-60",!i.membershipService.hasFeature("smartMode")),Y("title",i.membershipService.hasFeature("smartMode")?"":"\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),a(2),b(i.membershipService.hasFeature("smartMode")?-1:7),a(),D("bg-slate-700",i.mode()==="classic")("text-white",i.mode()==="classic")("text-slate-400",i.mode()!=="classic"),a(2),b(i.mode()==="smart"?10:11))},dependencies:[$,Z,te,ne,re],encapsulation:2,changeDetection:0})}};export{be as a};
