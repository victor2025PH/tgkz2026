{
  "version": 3,
  "sources": ["src/auth/telegram-callback.component.ts"],
  "sourcesContent": ["/**\r\n * Telegram OAuth ÂõûË™øÁµÑ‰ª∂\r\n * \r\n * ËôïÁêÜ Telegram Login Widget ÁöÑÂõûË™ø\r\n */\r\n\r\nimport { Component, inject, OnInit, signal, ChangeDetectionStrategy } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { AuthService } from '../core/auth.service';\r\n\r\n@Component({\r\n  selector: 'app-telegram-callback',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  template: `\r\n    <div class=\"callback-page\">\r\n      @if (isLoading()) {\r\n        <div class=\"loading\">\r\n          <div class=\"spinner\"></div>\r\n          <p>Ê≠£Âú®ËôïÁêÜ Telegram ÁôªÂÖ•...</p>\r\n        </div>\r\n      } @else if (error()) {\r\n        <div class=\"error\">\r\n          <span class=\"error-icon\">‚ö†Ô∏è</span>\r\n          <h3>ÁôªÂÖ•Â§±Êïó</h3>\r\n          <p>{{ error() }}</p>\r\n          <button class=\"back-btn\" (click)=\"goToLogin()\">ËøîÂõûÁôªÂÖ•</button>\r\n        </div>\r\n      }\r\n    </div>\r\n  `,\r\n  styles: [`\r\n    .callback-page {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      min-height: 100vh;\r\n      background: var(--bg-primary, #0a0a0a);\r\n      color: var(--text-primary, #fff);\r\n    }\r\n    \r\n    .loading {\r\n      text-align: center;\r\n    }\r\n    \r\n    .spinner {\r\n      width: 48px;\r\n      height: 48px;\r\n      border: 3px solid rgba(255, 255, 255, 0.1);\r\n      border-top-color: var(--primary, #3b82f6);\r\n      border-radius: 50%;\r\n      animation: spin 1s linear infinite;\r\n      margin: 0 auto 1rem;\r\n    }\r\n    \r\n    @keyframes spin {\r\n      to { transform: rotate(360deg); }\r\n    }\r\n    \r\n    .error {\r\n      text-align: center;\r\n      padding: 2rem;\r\n      background: var(--bg-secondary, #1a1a1a);\r\n      border-radius: 12px;\r\n      max-width: 400px;\r\n    }\r\n    \r\n    .error-icon {\r\n      font-size: 3rem;\r\n      display: block;\r\n      margin-bottom: 1rem;\r\n    }\r\n    \r\n    .error h3 {\r\n      margin-bottom: 0.5rem;\r\n      color: #f87171;\r\n    }\r\n    \r\n    .error p {\r\n      color: var(--text-secondary, #888);\r\n      margin-bottom: 1.5rem;\r\n    }\r\n    \r\n    .back-btn {\r\n      padding: 0.75rem 1.5rem;\r\n      background: var(--primary, #3b82f6);\r\n      border: none;\r\n      border-radius: 8px;\r\n      color: white;\r\n      font-size: 1rem;\r\n      cursor: pointer;\r\n      transition: opacity 0.2s;\r\n    }\r\n    \r\n    .back-btn:hover {\r\n      opacity: 0.9;\r\n    }\r\n  `]\r\n})\r\nexport class TelegramCallbackComponent implements OnInit {\r\n  private authService = inject(AuthService);\r\n  private router = inject(Router);\r\n  private route = inject(ActivatedRoute);\r\n  \r\n  isLoading = signal(true);\r\n  error = signal<string | null>(null);\r\n  \r\n  async ngOnInit() {\r\n    try {\r\n      // üîß ÂÑ™ÂåñÔºöÊîØÊåÅÂ§öÁ®Æ Telegram ÂõûË™øÊ†ºÂºè\r\n      let authData: any = null;\r\n      \r\n      // 1. ÂòóË©¶Âæû hash fragment Áç≤Âèñ tgAuthResultÔºàTelegram OAuth Ê®ôÊ∫ñÊ†ºÂºèÔºâ\r\n      const hash = window.location.hash;\r\n      if (hash && hash.includes('tgAuthResult=')) {\r\n        const match = hash.match(/tgAuthResult=([^&]+)/);\r\n        if (match && match[1]) {\r\n          try {\r\n            // Ëß£Á¢º base64 ‰∏¶Ëß£Êûê JSON\r\n            const decoded = atob(match[1]);\r\n            authData = JSON.parse(decoded);\r\n            console.log('Telegram auth data from tgAuthResult:', authData);\r\n          } catch (e) {\r\n            console.error('Failed to parse tgAuthResult:', e);\r\n          }\r\n        }\r\n      }\r\n      \r\n      // 2. ÂòóË©¶Âæû query params Áç≤Âèñ\r\n      if (!authData) {\r\n        const params = this.route.snapshot.queryParams;\r\n        if (params['id'] && params['hash']) {\r\n          authData = {\r\n            id: params['id'],\r\n            first_name: params['first_name'],\r\n            last_name: params['last_name'],\r\n            username: params['username'],\r\n            photo_url: params['photo_url'],\r\n            auth_date: params['auth_date'],\r\n            hash: params['hash']\r\n          };\r\n        }\r\n      }\r\n      \r\n      // 3. ÂòóË©¶Âæû fragment params Áç≤ÂèñÔºàËàäÊ†ºÂºèÔºâ\r\n      if (!authData) {\r\n        const fragment = this.route.snapshot.fragment;\r\n        if (fragment && fragment.includes('id=')) {\r\n          const fragmentParams = new URLSearchParams(fragment);\r\n          authData = {\r\n            id: fragmentParams.get('id'),\r\n            first_name: fragmentParams.get('first_name'),\r\n            last_name: fragmentParams.get('last_name'),\r\n            username: fragmentParams.get('username'),\r\n            photo_url: fragmentParams.get('photo_url'),\r\n            auth_date: fragmentParams.get('auth_date'),\r\n            hash: fragmentParams.get('hash')\r\n          };\r\n        }\r\n      }\r\n      \r\n      if (!authData || !authData.id) {\r\n        throw new Error('Áº∫Â∞ë Telegram Ë™çË≠âÊï∏Êìö');\r\n      }\r\n      \r\n      await this.processTelegramAuth(authData);\r\n      \r\n    } catch (e: any) {\r\n      console.error('Telegram callback error:', e);\r\n      this.error.set(e.message || 'Telegram ÁôªÂÖ•Â§±Êïó');\r\n    } finally {\r\n      this.isLoading.set(false);\r\n    }\r\n  }\r\n  \r\n  private async processTelegramAuth(authData: any) {\r\n    if (!authData.id || !authData.hash) {\r\n      throw new Error('ÁÑ°ÊïàÁöÑ Telegram Ë™çË≠âÊï∏Êìö');\r\n    }\r\n    \r\n    // ÁôºÈÄÅÂà∞ÂæåÁ´ØÈ©óË≠â\r\n    const result = await this.authService.telegramLogin(authData);\r\n    \r\n    if (result.success) {\r\n      // Ê™¢Êü•ÊòØÂê¶Êúâ‰øùÂ≠òÁöÑÈáçÂÆöÂêë URL\r\n      const returnUrl = sessionStorage.getItem('auth_return_url') || '/';\r\n      sessionStorage.removeItem('auth_return_url');\r\n      \r\n      // Â¶ÇÊûúÊòØÂΩàÁ™óÊ®°ÂºèÔºåÁôºÈÄÅÊ∂àÊÅØÁµ¶Áà∂Á™óÂè£\r\n      if (window.opener) {\r\n        window.opener.postMessage({\r\n          type: 'telegram_auth',\r\n          auth: authData\r\n        }, window.location.origin);\r\n        window.close();\r\n      } else {\r\n        this.router.navigateByUrl(returnUrl);\r\n      }\r\n    } else {\r\n      throw new Error(result.error || 'Telegram ÁôªÂÖ•Â§±Êïó');\r\n    }\r\n  }\r\n  \r\n  goToLogin() {\r\n    this.router.navigate(['/auth/login']);\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
