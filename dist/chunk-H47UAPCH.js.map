{
  "version": 3,
  "sources": ["src/environments/environment.ts", "src/core/auth.guard.ts"],
  "sourcesContent": ["/**\r\n * ÈñãÁôºÁí∞Â¢ÉÈÖçÁΩÆ\r\n */\r\nexport const environment = {\r\n  production: false,\r\n  \r\n  // API Ê®°Âºè: 'auto' | 'ipc' | 'http'\r\n  // auto: Ëá™ÂãïÊ™¢Ê∏¨ÔºàElectron Áî® IPCÔºåÁÄèË¶ΩÂô®Áî® HTTPÔºâ\r\n  apiMode: 'auto',\r\n  \r\n  // HTTP API ÈÖçÁΩÆÔºàÂÉÖ http Ê®°Âºè‰ΩøÁî®Ôºâ\r\n  apiBaseUrl: 'http://localhost:8000',\r\n  wsUrl: 'ws://localhost:8000/ws',\r\n  \r\n  // ÂäüËÉΩÈñãÈóú\r\n  features: {\r\n    maxAccounts: 999,\r\n    aiEnabled: true,\r\n    teamFeatures: true,\r\n    apiAccess: true,\r\n    debug: true\r\n  },\r\n  \r\n  // ÁâàÊú¨‰ø°ÊÅØ\r\n  version: '2.1.1',\r\n  buildDate: new Date().toISOString()\r\n};\r\n", "/**\r\n * Ë™çË≠âÂÆàË°õ\r\n * \r\n * ÂÑ™ÂåñË®≠Ë®àÔºö\r\n * 1. ÊîØÊåÅÂ§öÁ®ÆË∑ØÁî±‰øùË≠∑Á≠ñÁï•\r\n * 2. Ë®ÇÈñ±Á¥öÂà•Ê™¢Êü•\r\n * 3. ÂäüËÉΩÊ¨äÈôêÊ™¢Êü•\r\n * 4. ÈáçÂÆöÂêëÂà∞ÁôªÂÖ•È†Å\r\n */\r\n\r\nimport { inject } from '@angular/core';\r\nimport { Router, CanActivateFn, ActivatedRouteSnapshot, RouterStateSnapshot } from '@angular/router';\r\nimport { AuthService } from './auth.service';\r\nimport { environment } from '../environments/environment';\r\n\r\n/**\r\n * Âü∫Á§éË™çË≠âÂÆàË°õ\r\n * Ê™¢Êü•Áî®Êà∂ÊòØÂê¶Â∑≤ÁôªÂÖ•\r\n */\r\nexport const authGuard: CanActivateFn = (\r\n  route: ActivatedRouteSnapshot,\r\n  state: RouterStateSnapshot\r\n) => {\r\n  const authService = inject(AuthService);\r\n  const router = inject(Router);\r\n  \r\n  // Êú¨Âú∞ÁâàÔºàElectronÔºâ‰∏çÈúÄË¶ÅË™çË≠â\r\n  // ÂøÖÈ†àÂêåÊôÇÊªøË∂≥Ôºö1) apiMode ÁÇ∫ ipc 2) Âú® Electron Áí∞Â¢É‰∏≠\r\n  const isElectron = !!(window as any).electronAPI || !!(window as any).electron;\r\n  if (environment.apiMode === 'ipc' && isElectron) {\r\n    return true;\r\n  }\r\n  \r\n  // SaaS Ê®°ÂºèÔºöÊ™¢Êü•Ë™çË≠âÁãÄÊÖã\r\n  // üîß ‰øÆÂæ©ÔºöÂè™Ê™¢Êü• Token ÊòØÂê¶Â≠òÂú®Ôºå‰∏çË¶ÅÊ∏ÖÈô§ÂèØËÉΩÊúâÊïàÁöÑÊúÉË©±\r\n  const token = authService.accessToken();\r\n  \r\n  // ‰πüÊ™¢Êü• localStorage ‰∏≠ÁöÑ TokenÔºàÂèØËÉΩÂ∞öÊú™ÂêåÊ≠•Âà∞ AuthServiceÔºâ\r\n  const localToken = localStorage.getItem('tgm_access_token');\r\n  \r\n  console.log('[AuthGuard] Checking auth:', {\r\n    isAuthenticated: authService.isAuthenticated(),\r\n    hasServiceToken: !!token,\r\n    hasLocalToken: !!localToken\r\n  });\r\n  \r\n  if (token && token.length > 10) {\r\n    return true;\r\n  }\r\n  \r\n  // üîß ÂÇôÁî®Ê™¢Êü•ÔºöÂ¶ÇÊûú localStorage ‰∏≠Êúâ TokenÔºåÂÖÅË®±Ë®™Âïè\r\n  if (localToken && localToken.length > 10) {\r\n    console.log('[AuthGuard] Using localStorage token fallback');\r\n    return true;\r\n  }\r\n  \r\n  // üîß Âè™ÊúâÂú®Á¢∫ÂÆöÊ≤íÊúâ Token ÊôÇÊâçÊ∏ÖÈô§Ôºà‰∏çË¶ÅÈÅéÊó©Ê∏ÖÈô§Ôºâ\r\n  // authService.clearSession();  // ÁßªÈô§ÈÄôË°åÔºåÈÅøÂÖçÈÅéÊó©Ê∏ÖÈô§ÊúâÊïàÊúÉË©±\r\n  \r\n  // ‰øùÂ≠òÂéüÂßã URL Áî®ÊñºÁôªÂÖ•ÂæåÈáçÂÆöÂêë\r\n  const returnUrl = state.url;\r\n  router.navigate(['/auth/login'], { queryParams: { returnUrl } });\r\n  return false;\r\n};\r\n\r\n/**\r\n * Ë®™ÂÆ¢ÂÆàË°õ\r\n * Â∑≤ÁôªÂÖ•Áî®Êà∂ÁÑ°Ê≥ïË®™ÂïèÔºàÂ¶ÇÁôªÂÖ•È†ÅÔºâ\r\n */\r\nexport const guestGuard: CanActivateFn = () => {\r\n  const authService = inject(AuthService);\r\n  const router = inject(Router);\r\n  \r\n  // Âö¥Ê†ºÊ™¢Êü•Ë™çË≠âÁãÄÊÖã\r\n  const isAuthenticated = authService.isAuthenticated();\r\n  const hasValidToken = authService.accessToken() && (authService.accessToken()?.length || 0) > 10;\r\n  \r\n  if (!isAuthenticated || !hasValidToken) {\r\n    return true;\r\n  }\r\n  \r\n  // Â∑≤ÁôªÂÖ•ÔºåÈáçÂÆöÂêëÂà∞È¶ñÈ†Å\r\n  router.navigate(['/dashboard']);\r\n  return false;\r\n};\r\n\r\n/**\r\n * Ë®ÇÈñ±Á¥öÂà•ÂÆàË°õÂ∑•Âª†\r\n * Ê™¢Êü•Áî®Êà∂Ë®ÇÈñ±Á¥öÂà•\r\n */\r\nexport function subscriptionGuard(requiredTier: string): CanActivateFn {\r\n  const tierLevels: Record<string, number> = {\r\n    'free': 0,\r\n    'basic': 1,\r\n    'pro': 2,\r\n    'enterprise': 3\r\n  };\r\n  \r\n  return (route: ActivatedRouteSnapshot, state: RouterStateSnapshot) => {\r\n    const authService = inject(AuthService);\r\n    const router = inject(Router);\r\n    \r\n    // Êú¨Âú∞Áâà‰∏çÈôêÂà∂\r\n    if (environment.apiMode === 'ipc') {\r\n      return true;\r\n    }\r\n    \r\n    if (!authService.isAuthenticated()) {\r\n      router.navigate(['/login'], { queryParams: { returnUrl: state.url } });\r\n      return false;\r\n    }\r\n    \r\n    const userTier = authService.subscriptionTier();\r\n    const userLevel = tierLevels[userTier] || 0;\r\n    const requiredLevel = tierLevels[requiredTier] || 0;\r\n    \r\n    if (userLevel >= requiredLevel) {\r\n      return true;\r\n    }\r\n    \r\n    // Ë®ÇÈñ±Á¥öÂà•‰∏çË∂≥ÔºåÈáçÂÆöÂêëÂà∞ÂçáÁ¥öÈ†ÅÈù¢\r\n    router.navigate(['/upgrade'], { \r\n      queryParams: { \r\n        required: requiredTier,\r\n        feature: route.data?.['feature'] || 'this feature'\r\n      } \r\n    });\r\n    return false;\r\n  };\r\n}\r\n\r\n/**\r\n * ÂäüËÉΩÊ¨äÈôêÂÆàË°õÂ∑•Âª†\r\n */\r\nexport function featureGuard(feature: string): CanActivateFn {\r\n  return () => {\r\n    const authService = inject(AuthService);\r\n    const router = inject(Router);\r\n    \r\n    // Êú¨Âú∞Áâà‰∏çÈôêÂà∂\r\n    if (environment.apiMode === 'ipc') {\r\n      return true;\r\n    }\r\n    \r\n    if (authService.hasFeature(feature)) {\r\n      return true;\r\n    }\r\n    \r\n    router.navigate(['/upgrade'], { queryParams: { feature } });\r\n    return false;\r\n  };\r\n}\r\n\r\n/**\r\n * ÁÆ°ÁêÜÂì°ÂÆàË°õ\r\n */\r\nexport const adminGuard: CanActivateFn = () => {\r\n  const authService = inject(AuthService);\r\n  const router = inject(Router);\r\n  \r\n  const user = authService.user();\r\n  if (user?.role === 'admin') {\r\n    return true;\r\n  }\r\n  \r\n  router.navigate(['/']);\r\n  return false;\r\n};\r\n\r\n/**\r\n * Â∏≥ËôüÊï∏ÈáèÂÆàË°õ\r\n * Ê™¢Êü•Áî®Êà∂ÊòØÂê¶ÂèØ‰ª•Ê∑ªÂä†Êõ¥Â§öÂ∏≥Ëôü\r\n */\r\nexport const accountLimitGuard: CanActivateFn = async () => {\r\n  const authService = inject(AuthService);\r\n  const router = inject(Router);\r\n  \r\n  // Êú¨Âú∞Áâà‰∏çÈôêÂà∂\r\n  if (environment.apiMode === 'ipc') {\r\n    return true;\r\n  }\r\n  \r\n  // TODO: Áç≤ÂèñÁï∂ÂâçÂ∏≥ËôüÊï∏Èáè‰∏¶Ëàá maxAccounts ÊØîËºÉ\r\n  const maxAccounts = authService.maxAccounts();\r\n  \r\n  // Êö´ÊôÇÂÖÅË®±\r\n  return true;\r\n};\r\n"],
  "mappings": ";;;;;;;;;;;AAGO,IAAM,cAAc;EACzB,YAAY;;;EAIZ,SAAS;;EAGT,YAAY;EACZ,OAAO;;EAGP,UAAU;IACR,aAAa;IACb,WAAW;IACX,cAAc;IACd,WAAW;IACX,OAAO;;;EAIT,SAAS;EACT,YAAW,oBAAI,KAAI,GAAG,YAAW;;;;ACN5B,IAAM,YAA2B,CACtC,OACA,UACE;AACF,QAAM,cAAc,OAAO,WAAW;AACtC,QAAM,SAAS,OAAO,MAAM;AAI5B,QAAM,aAAa,CAAC,CAAE,OAAe,eAAe,CAAC,CAAE,OAAe;AACtE,MAAI,YAAY,YAAY,SAAS,YAAY;AAC/C,WAAO;EACT;AAIA,QAAM,QAAQ,YAAY,YAAW;AAGrC,QAAM,aAAa,aAAa,QAAQ,kBAAkB;AAE1D,UAAQ,IAAI,8BAA8B;IACxC,iBAAiB,YAAY,gBAAe;IAC5C,iBAAiB,CAAC,CAAC;IACnB,eAAe,CAAC,CAAC;GAClB;AAED,MAAI,SAAS,MAAM,SAAS,IAAI;AAC9B,WAAO;EACT;AAGA,MAAI,cAAc,WAAW,SAAS,IAAI;AACxC,YAAQ,IAAI,+CAA+C;AAC3D,WAAO;EACT;AAMA,QAAM,YAAY,MAAM;AACxB,SAAO,SAAS,CAAC,aAAa,GAAG,EAAE,aAAa,EAAE,UAAS,EAAE,CAAE;AAC/D,SAAO;AACT;AAMO,IAAM,aAA4B,MAAK;AAC5C,QAAM,cAAc,OAAO,WAAW;AACtC,QAAM,SAAS,OAAO,MAAM;AAG5B,QAAM,kBAAkB,YAAY,gBAAe;AACnD,QAAM,gBAAgB,YAAY,YAAW,MAAO,YAAY,YAAW,GAAI,UAAU,KAAK;AAE9F,MAAI,CAAC,mBAAmB,CAAC,eAAe;AACtC,WAAO;EACT;AAGA,SAAO,SAAS,CAAC,YAAY,CAAC;AAC9B,SAAO;AACT;",
  "names": []
}
