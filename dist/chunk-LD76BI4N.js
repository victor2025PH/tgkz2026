import{b as Q}from"./chunk-QCWWCRCA.js";import{a as A}from"./chunk-MKTJUSEE.js";import{t as P}from"./chunk-3FNGYHNZ.js";import{b as J}from"./chunk-ET36GW2V.js";import{o as M}from"./chunk-HDSZBSQ2.js";import{a as T,b as K}from"./chunk-CCGO3GAA.js";import{$a as j,Ab as D,La as w,O as p,T as O,U as B,V,Ya as F,Za as R,a as $,ab as E,b as N,bb as x,da as c,db as G,eb as H,gb as n,hb as a,ib as g,jb as q,kb as v,nb as z,ob as _,pb as I,ub as y,vb as f,xa as r,xb as o,yb as u,zb as L}from"./chunk-XBIFDY2N.js";var Y=(s,e)=>e.value,Z=(s,e)=>e.date,ee=(s,e)=>e.source,te=(s,e)=>e.title;function ie(s,e){if(s&1){let i=q();n(0,"button",56),_("click",function(){let d=O(i).$implicit,l=I();return B(l.changePeriod(d.value))}),o(1),a()}if(s&2){let i=e.$implicit,t=I();f("bg-cyan-500",t.selectedPeriod()===i.value)("text-white",t.selectedPeriod()===i.value)("text-slate-400",t.selectedPeriod()!==i.value)("hover:text-white",t.selectedPeriod()!==i.value),r(),L(" ",i.label," ")}}function ne(s,e){s&1&&(V(),n(0,"svg",12),g(1,"circle",57)(2,"path",58),a())}function ae(s,e){s&1&&o(0," \u{1F504} ")}function oe(s,e){if(s&1&&(n(0,"div",31)(1,"div",59),g(2,"div",60)(3,"div",61)(4,"div",62),a(),n(5,"span",49),o(6),a()()),s&2){let i=e.$implicit,t=I();r(2),y("height",t.getBarHeight(i.sent,"sent"),"%"),v("title","\u767C\u9001: "+i.sent),r(),y("height",t.getBarHeight(i.replies,"replies"),"%"),v("title","\u56DE\u8986: "+i.replies),r(),y("height",t.getBarHeight(i.conversions,"conversions"),"%"),v("title","\u6210\u4EA4: "+i.conversions),r(2),u(t.formatDateLabel(i.date))}}function re(s,e){if(s&1&&(n(0,"div")(1,"div",63)(2,"span",64),o(3),a(),n(4,"span",20),o(5),a()(),n(6,"div",65),g(7,"div",66),a()()),s&2){let i=e.$implicit;r(3),u(i.source),r(2),D("",i.count," (",i.percentage.toFixed(1),"%)"),r(2),y("width",i.percentage,"%")("background-color",i.color)}}function se(s,e){s&1&&(n(0,"span",43),o(1,"\u23F3"),a())}function de(s,e){s&1&&o(0," \u2728 ")}function le(s,e){if(s&1&&(n(0,"div",67)(1,"div",68)(2,"span",69),o(3),a(),n(4,"div")(5,"div",70),o(6),a(),n(7,"div",20),o(8),a()()()()),s&2){let i=e.$implicit;f("border-green-500/30",i.type==="success")("border-yellow-500/30",i.type==="warning")("border-blue-500/30",i.type==="info")("border-purple-500/30",i.type==="tip"),r(3),u(i.icon),r(3),u(i.title),r(2),u(i.description)}}function me(s,e){if(s&1&&(n(0,"div",47),g(1,"div",71),n(2,"span",72),o(3),a()()),s&2){let i=e.$implicit,t=I();r(),y("background-color",t.getHeatmapColor(t.hourlyData()[i]||0)),v("title",i+":00 - \u56DE\u8986\u7387: "+(t.hourlyData()[i]||0)+"%"),r(2),u(i)}}var k=class s{constructor(){this.ipc=p(A);this.toast=p(T);this.periods=[{value:"today",label:"\u4ECA\u65E5"},{value:"week",label:"\u672C\u9031"},{value:"month",label:"\u672C\u6708"},{value:"quarter",label:"\u5B63\u5EA6"}];this.selectedPeriod=c("week");this.isLoading=c(!1);this.isGeneratingInsights=c(!1);this.hours=Array.from({length:24},(e,i)=>i);this.stats=c({totalSent:0,totalReplies:0,totalConversions:0,conversionRate:0,sentChange:0,repliesChange:0,conversionsChange:0,rateChange:0});this.trendData=c([]);this.sourceDistribution=c([]);this.aiInsights=c([]);this.hourlyData=c({})}ngOnInit(){this.setupIpcListeners(),this.loadData()}ngOnDestroy(){}setupIpcListeners(){this.ipc.on("analytics:stats",e=>{e.success&&this.stats.set(e.stats),this.isLoading.set(!1)}),this.ipc.on("analytics:trend",e=>{e.success&&this.trendData.set(e.trend)}),this.ipc.on("analytics:sources",e=>{e.success&&this.sourceDistribution.set(e.sources)}),this.ipc.on("analytics:hourly",e=>{e.success&&this.hourlyData.set(e.hourly)}),this.ipc.on("analytics:insights",e=>{e.success&&this.aiInsights.set(e.insights),this.isGeneratingInsights.set(!1)})}loadData(){this.isLoading.set(!0),this.ipc.send("analytics:get-stats",{period:this.selectedPeriod()}),this.ipc.send("analytics:get-trend",{period:this.selectedPeriod()}),this.ipc.send("analytics:get-sources",{period:this.selectedPeriod()}),this.ipc.send("analytics:get-hourly",{period:this.selectedPeriod()}),setTimeout(()=>{this.isLoading()&&(this.generateMockData(),this.isLoading.set(!1))},1e3)}generateMockData(){let e=Math.floor(Math.random()*1e3)+500,i=Math.floor(e*(.2+Math.random()*.2)),t=Math.floor(i*(.1+Math.random()*.15));this.stats.set({totalSent:e,totalReplies:i,totalConversions:t,conversionRate:t/e*100,sentChange:(Math.random()-.3)*30,repliesChange:(Math.random()-.3)*30,conversionsChange:(Math.random()-.3)*30,rateChange:(Math.random()-.3)*5});let d=[],l=this.selectedPeriod()==="today"?24:this.selectedPeriod()==="week"?7:this.selectedPeriod()==="month"?30:90;for(let m=0;m<Math.min(l,14);m++){let h=new Date;h.setDate(h.getDate()-m),d.unshift({date:h.toISOString().split("T")[0],sent:Math.floor(Math.random()*100)+20,replies:Math.floor(Math.random()*30)+5,conversions:Math.floor(Math.random()*10)+1})}this.trendData.set(d);let C=[{source:"\u7FA4\u7D44\u63D0\u53D6",count:Math.floor(Math.random()*500)+200,color:"#3b82f6"},{source:"\u95DC\u9375\u8A5E\u5339\u914D",count:Math.floor(Math.random()*300)+100,color:"#10b981"},{source:"\u624B\u52D5\u6DFB\u52A0",count:Math.floor(Math.random()*200)+50,color:"#f59e0b"},{source:"AI \u63A8\u85A6",count:Math.floor(Math.random()*150)+30,color:"#8b5cf6"}],b=C.reduce((m,h)=>m+h.count,0);this.sourceDistribution.set(C.map(m=>N($({},m),{percentage:m.count/b*100})));let S={};for(let m=0;m<24;m++){let h=m>=9&&m<=18?30:10;S[m]=Math.floor(Math.random()*20)+h}this.hourlyData.set(S),this.generateInsights()}generateInsights(){let e=this.stats(),i=[];e.conversionRate>5&&i.push({icon:"\u{1F389}",type:"success",title:"\u8F49\u5316\u7387\u8868\u73FE\u512A\u79C0",description:`\u7576\u524D\u8F49\u5316\u7387 ${e.conversionRate.toFixed(1)}% \u9AD8\u65BC\u884C\u696D\u5E73\u5747\u6C34\u5E73\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01`}),e.sentChange>10&&i.push({icon:"\u{1F4C8}",type:"info",title:"\u767C\u9001\u91CF\u986F\u8457\u589E\u9577",description:`\u767C\u9001\u91CF\u8F03\u4E0A\u671F\u589E\u9577 ${e.sentChange.toFixed(1)}%\uFF0C\u89F8\u9054\u66F4\u591A\u6F5B\u5728\u5BA2\u6236\u3002`});let t=this.hourlyData(),d=0,l=0;for(let[b,S]of Object.entries(t))S>l&&(l=S,d=parseInt(b));i.push({icon:"\u23F0",type:"tip",title:`\u6700\u4F73\u767C\u9001\u6642\u6BB5\uFF1A${d}:00-${d+1}:00`,description:`\u8A72\u6642\u6BB5\u56DE\u8986\u7387\u9AD8\u9054 ${l}%\uFF0C\u5EFA\u8B70\u91CD\u9EDE\u5B89\u6392\u767C\u9001\u3002`});let C=this.sourceDistribution();if(C.length>0){let b=C[0];i.push({icon:"\u{1F3AF}",type:"info",title:`\u4E3B\u8981\u7528\u6236\u4F86\u6E90\uFF1A${b.source}`,description:`\u4F54\u6BD4 ${b.percentage.toFixed(1)}%\uFF0C\u53EF\u8003\u616E\u52A0\u5F37\u8A72\u6E20\u9053\u6295\u5165\u3002`})}this.aiInsights.set(i)}changePeriod(e){this.selectedPeriod.set(e),this.loadData()}refreshData(){this.loadData()}regenerateInsights(){this.isGeneratingInsights.set(!0),this.ipc.send("analytics:generate-insights",{period:this.selectedPeriod(),stats:this.stats()}),setTimeout(()=>{this.isGeneratingInsights()&&(this.generateInsights(),this.isGeneratingInsights.set(!1))},1500)}exportReport(){this.toast.info("\u6B63\u5728\u751F\u6210\u5831\u544A..."),this.ipc.send("analytics:export",{period:this.selectedPeriod(),stats:this.stats(),trend:this.trendData(),sources:this.sourceDistribution(),insights:this.aiInsights()}),setTimeout(()=>{this.toast.success("\u5831\u544A\u5DF2\u751F\u6210\uFF0C\u8ACB\u9078\u64C7\u4FDD\u5B58\u4F4D\u7F6E")},1e3)}formatNumber(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}formatPercent(e){return Math.abs(e).toFixed(1)+"%"}formatDateLabel(e){let i=new Date(e);return`${i.getMonth()+1}/${i.getDate()}`}getBarHeight(e,i){let t=this.trendData();if(t.length===0)return 0;let d=1;return t.forEach(l=>{i==="sent"&&l.sent>d&&(d=l.sent),i==="replies"&&l.replies>d&&(d=l.replies),i==="conversions"&&l.conversions>d&&(d=l.conversions)}),Math.max(5,e/d*100)}getHeatmapColor(e){return e<15?"rgb(51, 65, 85)":e<25?"rgb(20, 83, 45)":e<35?"rgb(21, 128, 61)":e<45?"rgb(34, 197, 94)":"rgb(74, 222, 128)"}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275cmp=w({type:s,selectors:[["app-smart-analytics"]],decls:116,vars:48,consts:[[1,"smart-analytics","h-full","flex","flex-col","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","overflow-hidden"],[1,"flex-shrink-0","p-6","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","rounded-2xl","bg-gradient-to-br","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-2xl","shadow-lg","shadow-cyan-500/20"],[1,"text-2xl","font-bold","text-white"],[1,"text-slate-400","text-sm"],[1,"flex","items-center","gap-3"],[1,"flex","bg-slate-800/50","rounded-xl","p-1"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"bg-cyan-500","text-white","text-slate-400","hover:text-white"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","flex","items-center","gap-2",3,"click"],[1,"p-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","disabled:opacity-50",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"w-5","h-5","animate-spin"],[1,"flex-1","overflow-y-auto","p-6","space-y-6"],[1,"grid","grid-cols-4","gap-4"],[1,"p-5","bg-gradient-to-br","from-blue-500/10","to-blue-600/5","rounded-2xl","border","border-blue-500/20"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-blue-400","text-2xl"],[1,"text-xs","px-2","py-1","rounded-full"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-sm","text-slate-400"],[1,"p-5","bg-gradient-to-br","from-green-500/10","to-green-600/5","rounded-2xl","border","border-green-500/20"],[1,"text-green-400","text-2xl"],[1,"p-5","bg-gradient-to-br","from-purple-500/10","to-purple-600/5","rounded-2xl","border","border-purple-500/20"],[1,"text-purple-400","text-2xl"],[1,"p-5","bg-gradient-to-br","from-amber-500/10","to-amber-600/5","rounded-2xl","border","border-amber-500/20"],[1,"text-amber-400","text-2xl"],[1,"grid","grid-cols-3","gap-6"],[1,"col-span-2","p-5","bg-slate-800/30","rounded-2xl","border","border-slate-700/50"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"h-64","flex","items-end","gap-1"],[1,"flex-1","flex","flex-col","items-center","gap-1"],[1,"flex","items-center","justify-center","gap-6","mt-4"],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","bg-blue-500","rounded"],[1,"w-3","h-3","bg-green-500","rounded"],[1,"w-3","h-3","bg-purple-500","rounded"],[1,"p-5","bg-slate-800/30","rounded-2xl","border","border-slate-700/50"],[1,"space-y-3"],[1,"p-5","bg-gradient-to-r","from-cyan-500/10","via-blue-500/10","to-purple-500/10","rounded-2xl","border","border-cyan-500/20"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors","disabled:opacity-50","flex","items-center","gap-1",3,"click","disabled"],[1,"animate-spin"],[1,"grid","grid-cols-2","gap-4"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30",3,"border-green-500/30","border-yellow-500/30","border-blue-500/30","border-purple-500/30"],[1,"flex","gap-1"],[1,"flex-1","flex","flex-col","items-center"],[1,"flex","items-center","justify-end","gap-4","mt-3"],[1,"text-xs","text-slate-500"],[1,"flex","gap-0.5"],[1,"w-4","h-3","rounded","bg-slate-700"],[1,"w-4","h-3","rounded","bg-green-900"],[1,"w-4","h-3","rounded","bg-green-700"],[1,"w-4","h-3","rounded","bg-green-500"],[1,"w-4","h-3","rounded","bg-green-400"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"w-full","flex","gap-0.5","items-end","h-48"],[1,"flex-1","bg-blue-500/60","rounded-t","transition-all","hover:bg-blue-500",3,"title"],[1,"flex-1","bg-green-500/60","rounded-t","transition-all","hover:bg-green-500",3,"title"],[1,"flex-1","bg-purple-500/60","rounded-t","transition-all","hover:bg-purple-500",3,"title"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","text-slate-300"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","rounded-full","transition-all"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30"],[1,"flex","items-start","gap-3"],[1,"text-2xl"],[1,"font-medium","text-white","mb-1"],[1,"w-full","h-8","rounded","transition-all",3,"title"],[1,"text-xs","text-slate-500","mt-1"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),o(5," \u{1F4CA} "),a(),n(6,"div")(7,"h1",5),o(8,"\u667A\u80FD\u5206\u6790\u5831\u544A"),a(),n(9,"p",6),o(10,"AI \u9A45\u52D5\u7684\u6578\u64DA\u6D1E\u5BDF"),a()()(),n(11,"div",7)(12,"div",8),E(13,ie,2,9,"button",9,Y),a(),n(15,"button",10),_("click",function(){return t.exportReport()}),o(16," \u{1F4E5} \u5C0E\u51FA\u5831\u544A "),a(),n(17,"button",11),_("click",function(){return t.refreshData()}),F(18,ne,3,0,":svg:svg",12)(19,ae,1,0),a()()()(),n(20,"div",13)(21,"div",14)(22,"div",15)(23,"div",16)(24,"span",17),o(25,"\u{1F4E4}"),a(),n(26,"span",18),o(27),a()(),n(28,"div",19),o(29),a(),n(30,"div",20),o(31,"\u7E3D\u767C\u9001\u6578"),a()(),n(32,"div",21)(33,"div",16)(34,"span",22),o(35,"\u{1F4AC}"),a(),n(36,"span",18),o(37),a()(),n(38,"div",19),o(39),a(),n(40,"div",20),o(41,"\u7E3D\u56DE\u8986\u6578"),a()(),n(42,"div",23)(43,"div",16)(44,"span",24),o(45,"\u2705"),a(),n(46,"span",18),o(47),a()(),n(48,"div",19),o(49),a(),n(50,"div",20),o(51,"\u7E3D\u6210\u4EA4\u6578"),a()(),n(52,"div",25)(53,"div",16)(54,"span",26),o(55,"\u{1F4C8}"),a(),n(56,"span",18),o(57),a()(),n(58,"div",19),o(59),a(),n(60,"div",20),o(61,"\u8F49\u5316\u7387"),a()()(),n(62,"div",27)(63,"div",28)(64,"h3",29),o(65," \u{1F4C8} \u767C\u9001\u8207\u56DE\u8986\u8DA8\u52E2 "),a(),n(66,"div",30),E(67,oe,7,10,"div",31,Z),a(),n(69,"div",32)(70,"div",33),g(71,"div",34),n(72,"span",20),o(73,"\u767C\u9001"),a()(),n(74,"div",33),g(75,"div",35),n(76,"span",20),o(77,"\u56DE\u8986"),a()(),n(78,"div",33),g(79,"div",36),n(80,"span",20),o(81,"\u6210\u4EA4"),a()()()(),n(82,"div",37)(83,"h3",29),o(84," \u{1F967} \u7528\u6236\u4F86\u6E90\u5206\u5E03 "),a(),n(85,"div",38),E(86,re,8,7,"div",null,ee),a()()(),n(88,"div",39)(89,"div",40)(90,"h3",41),o(91," \u{1F916} AI \u667A\u80FD\u6D1E\u5BDF "),a(),n(92,"button",42),_("click",function(){return t.regenerateInsights()}),F(93,se,2,0,"span",43)(94,de,1,0),o(95," \u91CD\u65B0\u751F\u6210 "),a()(),n(96,"div",44),E(97,le,9,11,"div",45,te),a()(),n(99,"div",37)(100,"h3",29),o(101," \u{1F550} \u6700\u4F73\u767C\u9001\u6642\u6BB5 "),a(),n(102,"div",46),E(103,me,4,4,"div",47,j),a(),n(105,"div",48)(106,"span",49),o(107,"\u4F4E"),a(),n(108,"div",50),g(109,"div",51)(110,"div",52)(111,"div",53)(112,"div",54)(113,"div",55),a(),n(114,"span",49),o(115,"\u9AD8"),a()()()()()),i&2&&(r(13),x(t.periods),r(4),v("disabled",t.isLoading()),r(),R(t.isLoading()?18:19),r(8),f("bg-green-500/20",t.stats().sentChange>=0)("text-green-400",t.stats().sentChange>=0)("bg-red-500/20",t.stats().sentChange<0)("text-red-400",t.stats().sentChange<0),r(),D(" ",t.stats().sentChange>=0?"\u2191":"\u2193"," ",t.formatPercent(t.stats().sentChange)," "),r(2),u(t.formatNumber(t.stats().totalSent)),r(7),f("bg-green-500/20",t.stats().repliesChange>=0)("text-green-400",t.stats().repliesChange>=0)("bg-red-500/20",t.stats().repliesChange<0)("text-red-400",t.stats().repliesChange<0),r(),D(" ",t.stats().repliesChange>=0?"\u2191":"\u2193"," ",t.formatPercent(t.stats().repliesChange)," "),r(2),u(t.formatNumber(t.stats().totalReplies)),r(7),f("bg-green-500/20",t.stats().conversionsChange>=0)("text-green-400",t.stats().conversionsChange>=0)("bg-red-500/20",t.stats().conversionsChange<0)("text-red-400",t.stats().conversionsChange<0),r(),D(" ",t.stats().conversionsChange>=0?"\u2191":"\u2193"," ",t.formatPercent(t.stats().conversionsChange)," "),r(2),u(t.formatNumber(t.stats().totalConversions)),r(7),f("bg-green-500/20",t.stats().rateChange>=0)("text-green-400",t.stats().rateChange>=0)("bg-red-500/20",t.stats().rateChange<0)("text-red-400",t.stats().rateChange<0),r(),D(" ",t.stats().rateChange>=0?"\u2191":"\u2193"," ",t.formatPercent(t.stats().rateChange)," "),r(2),L("",t.stats().conversionRate.toFixed(1),"%"),r(8),x(t.trendData()),r(19),x(t.sourceDistribution()),r(6),v("disabled",t.isGeneratingInsights()),r(),R(t.isGeneratingInsights()?93:94),r(4),x(t.aiInsights()),r(6),x(t.hours))},dependencies:[M,P],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})}};var U=class s{constructor(){this.i18n=p(J);this.nav=p(Q);this.ipc=p(A);this.toast=p(T);this.membershipService=p(K);this.dateRange=c(null);this.ipcCleanup=[]}ngOnInit(){let e=new Date,i=new Date;i.setDate(i.getDate()-30),this.dateRange.set({start:i,end:e}),this.loadAnalyticsData(),this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}loadAnalyticsData(){let e=this.dateRange();e&&this.ipc.send("get-analytics-data",{startDate:e.start.toISOString(),endDate:e.end.toISOString()})}setupIpcListeners(){let e=this.ipc.on("analytics-data-loaded",()=>{});this.ipcCleanup.push(e)}navigateTo(e){this.nav.navigateTo(e)}setDateRange(e){this.dateRange.set(e),this.loadAnalyticsData()}t(e,i){return this.i18n.t(e,i)}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275cmp=w({type:s,selectors:[["app-analytics-view"]],decls:1,vars:0,consts:[[3,"dateRangeChange","navigateTo"]],template:function(i,t){i&1&&(G(0,"app-smart-analytics",0),z("dateRangeChange",function(l){return t.setDateRange(l)})("navigateTo",function(l){return t.navigateTo(l)}),H())},dependencies:[M,P,k],encapsulation:2,changeDetection:0})}};export{U as a};
