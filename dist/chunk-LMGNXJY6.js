import{a}from"./chunk-KD3U4L4Z.js";import{a as g}from"./chunk-6MHYDRXN.js";import{J as u,O as c,Wb as s,a as r,b as n,da as i}from"./chunk-MB4RORS3.js";var h=class d{constructor(){this.ipcService=c(a);this.toastService=c(g);this.monitoredGroups=i([]);this.keywordSets=i([]);this.triggerRules=i([]);this.monitoringActive=i(!1);this.showJoinMonitorDialog=i(!1);this.joinMonitorConfig=i({resourceId:0,resourceTitle:"",accountPhone:"",selectedKeywordSetId:null,customKeywords:[]});this.showQuickCreateKeywordSet=i(!1);this.quickKeywordSetName=i("");this.quickKeywords=i([]);this.quickKeywordInput=i("");this.showBatchJoinMonitorDialog=i(!1);this.batchJoinMonitorProgress=i(0);this.isBatchJoining=i(!1);this.activeMonitoredGroups=s(()=>this.monitoredGroups().filter(e=>e.status==="active"));this.activeKeywordSets=s(()=>this.keywordSets().filter(e=>e.active));this.totalMatchedCount=s(()=>this.monitoredGroups().reduce((e,o)=>e+(o.matchedCount||0),0));this.recommendedKeywords=["\u4ED8\u6B3E","\u652F\u4ED8","\u6536\u6B3E","USDT","BTC","\u6BD4\u7279\u5E63","\u6295\u8CC7","\u7406\u8CA1","\u8CFA\u9322","\u517C\u8077","\u4EE3\u7406","\u5408\u4F5C"];this.setupIpcListeners()}loadMonitoredGroups(){this.ipcService.send("get-monitored-groups",{})}loadKeywordSets(){this.ipcService.send("get-keyword-sets",{})}loadTriggerRules(){this.ipcService.send("get-trigger-rules",{})}loadAllMonitoringData(){this.loadMonitoredGroups(),this.loadKeywordSets(),this.loadTriggerRules()}startMonitoring(){this.ipcService.send("start-monitoring",{}),this.monitoringActive.set(!0)}stopMonitoring(){this.ipcService.send("stop-monitoring",{}),this.monitoringActive.set(!1)}toggleMonitoring(){this.monitoringActive()?this.stopMonitoring():this.startMonitoring()}addMonitoredGroup(e){this.ipcService.send("add-monitored-group",e)}removeMonitoredGroup(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u76E3\u63A7\u6B64\u7FA4\u7D44\u55CE\uFF1F")&&this.ipcService.send("remove-monitored-group",{id:e})}pauseMonitoredGroup(e){this.ipcService.send("pause-monitored-group",{id:e})}resumeMonitoredGroup(e){this.ipcService.send("resume-monitored-group",{id:e})}openJoinAndMonitorDialog(e){this.joinMonitorConfig.set({resourceId:e.id,resourceTitle:e.title||e.name,accountPhone:"",selectedKeywordSetId:null,customKeywords:[]}),this.showJoinMonitorDialog.set(!0)}closeJoinMonitorDialog(){this.showJoinMonitorDialog.set(!1)}selectMonitorAccount(e){this.joinMonitorConfig.update(o=>n(r({},o),{accountPhone:e}))}selectKeywordSet(e){this.joinMonitorConfig.update(o=>n(r({},o),{selectedKeywordSetId:e}))}addMonitorKeyword(e){let o=e||this.quickKeywordInput().trim();o&&(this.joinMonitorConfig.update(t=>n(r({},t),{customKeywords:[...t.customKeywords,o]})),this.quickKeywordInput.set(""))}removeMonitorKeyword(e){this.joinMonitorConfig.update(o=>n(r({},o),{customKeywords:o.customKeywords.filter(t=>t!==e)}))}executeJoinAndMonitor(){let e=this.joinMonitorConfig();if(!e.accountPhone){this.toastService.warning("\u8ACB\u9078\u64C7\u57F7\u884C\u5E33\u865F");return}if(!e.selectedKeywordSetId&&e.customKeywords.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u95DC\u9375\u8A5E\u96C6\u6216\u6DFB\u52A0\u81EA\u5B9A\u7FA9\u95DC\u9375\u8A5E");return}this.ipcService.send("join-and-monitor",{resourceId:e.resourceId,accountPhone:e.accountPhone,keywordSetId:e.selectedKeywordSetId,customKeywords:e.customKeywords}),this.closeJoinMonitorDialog(),this.toastService.success("\u6B63\u5728\u52A0\u5165\u4E26\u8A2D\u7F6E\u76E3\u63A7...")}openQuickCreateKeywordSet(){this.quickKeywordSetName.set(""),this.quickKeywords.set([]),this.quickKeywordInput.set(""),this.showQuickCreateKeywordSet.set(!0)}closeQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!1)}addQuickKeyword(){let e=this.quickKeywordInput().trim();e&&(this.quickKeywords.update(o=>[...o,e]),this.quickKeywordInput.set(""))}removeQuickKeyword(e){this.quickKeywords.update(o=>o.filter(t=>t!==e))}addQuickRecommendedKeyword(e){this.quickKeywords().includes(e)||this.quickKeywords.update(o=>[...o,e])}executeQuickCreateKeywordSet(){let e=this.quickKeywordSetName().trim(),o=this.quickKeywords();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31");return}if(o.length===0){this.toastService.warning("\u8ACB\u6DFB\u52A0\u81F3\u5C11\u4E00\u500B\u95DC\u9375\u8A5E");return}this.ipcService.send("create-keyword-set",{name:e,keywords:o.map(t=>({keyword:t,isRegex:!1}))}),this.closeQuickCreateKeywordSet(),this.toastService.success("\u95DC\u9375\u8A5E\u96C6\u5275\u5EFA\u6210\u529F")}openBatchJoinMonitorDialog(){this.batchJoinMonitorProgress.set(0),this.isBatchJoining.set(!1),this.showBatchJoinMonitorDialog.set(!0)}closeBatchJoinMonitorDialog(){this.showBatchJoinMonitorDialog.set(!1)}executeBatchJoinMonitor(e,o,t){if(e.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}if(!o){this.toastService.warning("\u8ACB\u9078\u64C7\u57F7\u884C\u5E33\u865F");return}this.isBatchJoining.set(!0),this.batchJoinMonitorProgress.set(0),this.ipcService.send("batch-join-and-monitor",{resourceIds:e.map(l=>l.id),accountPhone:o,keywordSetId:t})}createKeywordSet(e,o){this.ipcService.send("create-keyword-set",{name:e,keywords:o})}deleteKeywordSet(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u95DC\u9375\u8A5E\u96C6\u55CE\uFF1F")&&this.ipcService.send("delete-keyword-set",{id:e})}toggleKeywordSetStatus(e){this.ipcService.send("toggle-keyword-set-status",{id:e})}addKeywordToSet(e,o){this.ipcService.send("add-keyword-to-set",{setId:e,keyword:o})}removeKeywordFromSet(e,o){this.ipcService.send("remove-keyword-from-set",{setId:e,keyword:o})}createTriggerRule(e){this.ipcService.send("create-trigger-rule",e)}deleteTriggerRule(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u89F8\u767C\u898F\u5247\u55CE\uFF1F")&&this.ipcService.send("delete-trigger-rule",{id:e})}toggleTriggerRuleStatus(e){this.ipcService.send("toggle-trigger-rule-status",{id:e})}getKeywordSetName(e){return this.keywordSets().find(o=>o.id===e)?.name||"Unknown"}getKeywordPreview(e){if(!e||e.length===0)return"";let o=e.slice(0,3).map(t=>t.keyword).join(", ");return e.length>3?`${o} \u7B49 ${e.length} \u500B`:o}getRecommendedKeywords(){return this.recommendedKeywords}setupIpcListeners(){this.ipcService.on("monitored-groups-result",e=>this.handleMonitoredGroups(e)),this.ipcService.on("keyword-sets-result",e=>this.handleKeywordSets(e)),this.ipcService.on("trigger-rules-result",e=>this.handleTriggerRules(e)),this.ipcService.on("monitoring-started",e=>{console.log("[MonitoringManagement] monitoring-started:",e),this.monitoringActive.set(!0)}),this.ipcService.on("monitoring-stopped",()=>{console.log("[MonitoringManagement] monitoring-stopped"),this.monitoringActive.set(!1)}),this.ipcService.on("monitoring-status-changed",e=>{console.log("[MonitoringManagement] monitoring-status-changed:",e),this.monitoringActive.set(e)}),this.ipcService.on("monitoring-status",e=>{let o=e.isMonitoring??e.active??!1;console.log("[MonitoringManagement] monitoring-status:",o),this.monitoringActive.set(o)}),this.ipcService.on("group-added-to-monitor",e=>this.handleGroupAdded(e)),this.ipcService.on("keyword-set-created",e=>this.handleKeywordSetCreated(e)),this.ipcService.on("batch-join-progress",e=>this.handleBatchJoinProgress(e)),this.ipcService.on("batch-join-completed",e=>this.handleBatchJoinCompleted(e))}handleMonitoredGroups(e){(e.success||e.groups)&&this.monitoredGroups.set(e.groups||[])}handleKeywordSets(e){(e.success||e.sets)&&this.keywordSets.set(e.sets||[])}handleTriggerRules(e){(e.success||e.rules)&&this.triggerRules.set(e.rules||[])}handleGroupAdded(e){e.success?(this.toastService.success("\u7FA4\u7D44\u5DF2\u52A0\u5165\u76E3\u63A7"),this.loadMonitoredGroups()):this.toastService.error(`\u52A0\u5165\u5931\u6557: ${e.error}`)}handleKeywordSetCreated(e){e.success&&this.loadKeywordSets()}handleBatchJoinProgress(e){this.batchJoinMonitorProgress.set(e.progress||0)}handleBatchJoinCompleted(e){this.isBatchJoining.set(!1),this.batchJoinMonitorProgress.set(100),e.success?(this.toastService.success(`\u6279\u91CF\u52A0\u5165\u5B8C\u6210: ${e.successCount}/${e.totalCount} \u500B\u7FA4\u7D44`),this.loadMonitoredGroups()):this.toastService.error(`\u6279\u91CF\u52A0\u5165\u5931\u6557: ${e.error}`),setTimeout(()=>this.closeBatchJoinMonitorDialog(),1500)}static{this.\u0275fac=function(o){return new(o||d)}}static{this.\u0275prov=u({token:d,factory:d.\u0275fac,providedIn:"root"})}};export{h as a};
