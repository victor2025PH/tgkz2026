{"version":3,"sources":["src/services/dialog.service.ts","node_modules/@angular/animations/fesm2022/_private_export-chunk.mjs","node_modules/@angular/animations/fesm2022/animations.mjs","src/animations/route.animations.ts","src/services/animation-config.service.ts","src/services/settings.service.ts","src/services/ai-chat.service.ts","src/services/resource.service.ts","src/services/export.service.ts","src/services/backup.service.ts","src/services/scheduler.service.ts","src/services/app-state.service.ts","src/services/resource-discovery.service.ts","src/services/error-handler.service.ts","src/services/keyboard-shortcuts.service.ts","src/services/unified-extraction.service.ts","src/services/system-diagnostic.service.ts","src/services/logger.service.ts","src/services/ad-system.service.ts","src/services/user-tracking.service.ts","src/services/member-management.service.ts","src/services/queue-management.service.ts","src/services/campaign-management.service.ts","src/services/template-management.service.ts","src/services/navigation.service.ts","src/services/lead-management.service.ts","src/services/group-management.service.ts","src/services/message-queue.service.ts","src/services/app-facade.service.ts","src/services/rag.service.ts","src/services/vector-memory.service.ts","src/services/task-template.service.ts","src/services/smart-recommendation.service.ts","src/services/execution-log.service.ts","src/services/api-client.service.ts","src/services/realtime.service.ts","src/services/ai-copywriting.service.ts","src/services/onboarding.service.ts","src/services/theme.service.ts"],"sourcesContent":["/**\r\n * å°è©±æ¡†ç®¡ç†æœå‹™\r\n * Dialog Service\r\n * \r\n * ğŸ†• Phase 26: å¾ app.component.ts æå–å°è©±æ¡†ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, inject } from '@angular/core';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport interface ConfirmDialogConfig {\r\n  title: string;\r\n  message: string;\r\n  confirmText?: string;\r\n  cancelText?: string;\r\n  type?: 'danger' | 'warning' | 'info';\r\n  onConfirm?: () => void;\r\n  onCancel?: () => void;\r\n}\r\n\r\nexport interface ProgressDialogConfig {\r\n  show: boolean;\r\n  title: string;\r\n  progress: number;\r\n  message?: string;\r\n  cancellable?: boolean;\r\n  onCancel?: () => void;\r\n}\r\n\r\nexport interface SuccessOverlayConfig {\r\n  icon?: string;\r\n  title: string;\r\n  subtitle?: string;\r\n  duration?: number;\r\n}\r\n\r\nexport interface DeleteConfirmDialog {\r\n  show: boolean;\r\n  type: 'single' | 'batch';\r\n  count?: number;\r\n  lead?: any;\r\n  onConfirm?: () => void;\r\n}\r\n\r\n// ğŸ†• è¼¸å…¥å°è©±æ¡†é…ç½®ï¼ˆæ›¿ä»£ window.promptï¼‰\r\nexport interface InputDialogConfig {\r\n  title: string;\r\n  message?: string;\r\n  placeholder?: string;\r\n  defaultValue?: string;\r\n  inputType?: 'text' | 'textarea';\r\n  confirmText?: string;\r\n  cancelText?: string;\r\n  validator?: (value: string) => string | null;  // è¿”å›éŒ¯èª¤ä¿¡æ¯æˆ– null\r\n  onConfirm?: (value: string) => void;\r\n  onCancel?: () => void;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DialogService {\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  // ç¢ºèªå°è©±æ¡†\r\n  private _confirmDialog = signal<ConfirmDialogConfig | null>(null);\r\n  confirmDialog = this._confirmDialog.asReadonly();\r\n  \r\n  // é€²åº¦å°è©±æ¡†\r\n  private _progressDialog = signal<ProgressDialogConfig>({\r\n    show: false,\r\n    title: '',\r\n    progress: 0,\r\n    cancellable: false\r\n  });\r\n  progressDialog = this._progressDialog.asReadonly();\r\n  \r\n  // æˆåŠŸè¦†è“‹å±¤\r\n  private _showSuccessOverlay = signal(false);\r\n  private _successOverlayConfig = signal<SuccessOverlayConfig | null>(null);\r\n  showSuccessOverlay = this._showSuccessOverlay.asReadonly();\r\n  successOverlayConfig = this._successOverlayConfig.asReadonly();\r\n  \r\n  // åˆªé™¤ç¢ºèªå°è©±æ¡†\r\n  private _deleteConfirmDialog = signal<DeleteConfirmDialog>({\r\n    show: false,\r\n    type: 'single'\r\n  });\r\n  deleteConfirmDialog = this._deleteConfirmDialog.asReadonly();\r\n  \r\n  // QR ç™»éŒ„å°è©±æ¡†\r\n  private _showQrLoginDialog = signal(false);\r\n  showQrLoginDialog = this._showQrLoginDialog.asReadonly();\r\n  \r\n  // æ‰¹é‡ç™¼é€å°è©±æ¡†\r\n  private _showBatchMessageDialog = signal(false);\r\n  private _batchSendTargets = signal<any[]>([]);\r\n  showBatchMessageDialog = this._showBatchMessageDialog.asReadonly();\r\n  batchSendTargets = this._batchSendTargets.asReadonly();\r\n  \r\n  // æ‰¹é‡æ‹‰ç¾¤å°è©±æ¡†\r\n  private _showBatchInviteDialog = signal(false);\r\n  private _batchInviteTargets = signal<any[]>([]);\r\n  showBatchInviteDialog = this._showBatchInviteDialog.asReadonly();\r\n  batchInviteTargets = this._batchInviteTargets.asReadonly();\r\n  \r\n  // æˆå“¡æå–å°è©±æ¡†\r\n  private _showMemberExtractionDialog = signal(false);\r\n  private _memberExtractionGroup = signal<any>(null);\r\n  showMemberExtractionDialog = this._showMemberExtractionDialog.asReadonly();\r\n  memberExtractionGroup = this._memberExtractionGroup.asReadonly();\r\n  \r\n  // åŠ å…¥ä¸¦ç›£æ§å°è©±æ¡†\r\n  private _showJoinMonitorDialog = signal(false);\r\n  private _joinMonitorResource = signal<any>(null);\r\n  showJoinMonitorDialog = this._showJoinMonitorDialog.asReadonly();\r\n  joinMonitorResource = this._joinMonitorResource.asReadonly();\r\n  \r\n  // åŠ å…¥å¾Œé¸é …å°è©±æ¡†\r\n  private _showPostJoinDialog = signal(false);\r\n  private _postJoinResource = signal<any>(null);\r\n  showPostJoinDialog = this._showPostJoinDialog.asReadonly();\r\n  postJoinResource = this._postJoinResource.asReadonly();\r\n  \r\n  // ğŸ†• è¼¸å…¥å°è©±æ¡†ï¼ˆæ›¿ä»£ window.promptï¼‰\r\n  private _inputDialog = signal<InputDialogConfig | null>(null);\r\n  private _inputDialogValue = signal('');\r\n  private _inputDialogError = signal<string | null>(null);\r\n  inputDialog = this._inputDialog.asReadonly();\r\n  inputDialogValue = this._inputDialogValue.asReadonly();\r\n  inputDialogError = this._inputDialogError.asReadonly();\r\n  \r\n  // ========== ç¢ºèªå°è©±æ¡† ==========\r\n  \r\n  confirm(config: ConfirmDialogConfig): void {\r\n    this._confirmDialog.set(config);\r\n  }\r\n  \r\n  closeConfirmDialog(): void {\r\n    const config = this._confirmDialog();\r\n    if (config?.onCancel) {\r\n      config.onCancel();\r\n    }\r\n    this._confirmDialog.set(null);\r\n  }\r\n  \r\n  confirmAction(): void {\r\n    const config = this._confirmDialog();\r\n    if (config?.onConfirm) {\r\n      config.onConfirm();\r\n    }\r\n    this._confirmDialog.set(null);\r\n  }\r\n  \r\n  // ========== é€²åº¦å°è©±æ¡† ==========\r\n  \r\n  showProgress(title: string, cancellable = false): void {\r\n    this._progressDialog.set({\r\n      show: true,\r\n      title,\r\n      progress: 0,\r\n      cancellable\r\n    });\r\n  }\r\n  \r\n  updateProgress(progress: number, message?: string): void {\r\n    this._progressDialog.update(d => ({\r\n      ...d,\r\n      progress,\r\n      message\r\n    }));\r\n  }\r\n  \r\n  hideProgress(): void {\r\n    this._progressDialog.update(d => ({ ...d, show: false }));\r\n  }\r\n  \r\n  // ========== æˆåŠŸè¦†è“‹å±¤ ==========\r\n  \r\n  showSuccess(config: SuccessOverlayConfig): void {\r\n    this._successOverlayConfig.set(config);\r\n    this._showSuccessOverlay.set(true);\r\n    \r\n    const duration = config.duration ?? 2000;\r\n    setTimeout(() => {\r\n      this._showSuccessOverlay.set(false);\r\n      this._successOverlayConfig.set(null);\r\n    }, duration);\r\n  }\r\n  \r\n  hideSuccess(): void {\r\n    this._showSuccessOverlay.set(false);\r\n    this._successOverlayConfig.set(null);\r\n  }\r\n  \r\n  // ========== åˆªé™¤ç¢ºèªå°è©±æ¡† ==========\r\n  \r\n  showDeleteConfirm(type: 'single' | 'batch', lead?: any, count?: number): void {\r\n    this._deleteConfirmDialog.set({\r\n      show: true,\r\n      type,\r\n      lead,\r\n      count\r\n    });\r\n  }\r\n  \r\n  hideDeleteConfirm(): void {\r\n    this._deleteConfirmDialog.update(d => ({ ...d, show: false }));\r\n  }\r\n  \r\n  // ========== QR ç™»éŒ„å°è©±æ¡† ==========\r\n  \r\n  openQrLogin(): void {\r\n    this._showQrLoginDialog.set(true);\r\n  }\r\n  \r\n  closeQrLogin(): void {\r\n    this._showQrLoginDialog.set(false);\r\n  }\r\n  \r\n  // ========== æ‰¹é‡ç™¼é€å°è©±æ¡† ==========\r\n  \r\n  openBatchSend(targets: any[]): void {\r\n    this._batchSendTargets.set(targets);\r\n    this._showBatchMessageDialog.set(true);\r\n  }\r\n  \r\n  closeBatchSend(): void {\r\n    this._showBatchMessageDialog.set(false);\r\n    this._batchSendTargets.set([]);\r\n  }\r\n  \r\n  // ========== æ‰¹é‡æ‹‰ç¾¤å°è©±æ¡† ==========\r\n  \r\n  openBatchInvite(targets: any[]): void {\r\n    this._batchInviteTargets.set(targets);\r\n    this._showBatchInviteDialog.set(true);\r\n  }\r\n  \r\n  closeBatchInvite(): void {\r\n    this._showBatchInviteDialog.set(false);\r\n    this._batchInviteTargets.set([]);\r\n  }\r\n  \r\n  // ========== æˆå“¡æå–å°è©±æ¡† ==========\r\n  \r\n  openMemberExtraction(group: any): void {\r\n    this._memberExtractionGroup.set(group);\r\n    this._showMemberExtractionDialog.set(true);\r\n  }\r\n  \r\n  closeMemberExtraction(): void {\r\n    this._showMemberExtractionDialog.set(false);\r\n    this._memberExtractionGroup.set(null);\r\n  }\r\n  \r\n  // ========== åŠ å…¥ä¸¦ç›£æ§å°è©±æ¡† ==========\r\n  \r\n  openJoinMonitor(resource: any): void {\r\n    this._joinMonitorResource.set(resource);\r\n    this._showJoinMonitorDialog.set(true);\r\n  }\r\n  \r\n  closeJoinMonitor(): void {\r\n    this._showJoinMonitorDialog.set(false);\r\n    this._joinMonitorResource.set(null);\r\n  }\r\n  \r\n  // ========== åŠ å…¥å¾Œé¸é …å°è©±æ¡† ==========\r\n  \r\n  openPostJoin(resource: any): void {\r\n    this._postJoinResource.set(resource);\r\n    this._showPostJoinDialog.set(true);\r\n  }\r\n  \r\n  closePostJoin(): void {\r\n    this._showPostJoinDialog.set(false);\r\n    this._postJoinResource.set(null);\r\n  }\r\n  \r\n  // ========== ğŸ†• è¼¸å…¥å°è©±æ¡†ï¼ˆæ›¿ä»£ window.promptï¼‰==========\r\n  \r\n  /**\r\n   * é¡¯ç¤ºè¼¸å…¥å°è©±æ¡†ï¼ˆæ›¿ä»£ window.promptï¼‰\r\n   * @param config é…ç½®\r\n   */\r\n  prompt(config: InputDialogConfig): void {\r\n    this._inputDialogValue.set(config.defaultValue || '');\r\n    this._inputDialogError.set(null);\r\n    this._inputDialog.set(config);\r\n  }\r\n  \r\n  /**\r\n   * æ›´æ–°è¼¸å…¥å€¼\r\n   */\r\n  updateInputValue(value: string): void {\r\n    this._inputDialogValue.set(value);\r\n    // æ¸…é™¤éŒ¯èª¤\r\n    this._inputDialogError.set(null);\r\n  }\r\n  \r\n  /**\r\n   * ç¢ºèªè¼¸å…¥å°è©±æ¡†\r\n   */\r\n  confirmInput(): void {\r\n    const config = this._inputDialog();\r\n    const value = this._inputDialogValue();\r\n    \r\n    if (!config) return;\r\n    \r\n    // é©—è­‰\r\n    if (config.validator) {\r\n      const error = config.validator(value);\r\n      if (error) {\r\n        this._inputDialogError.set(error);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // åŸºæœ¬é©—è­‰ï¼šä¸èƒ½ç‚ºç©º\r\n    if (!value.trim()) {\r\n      this._inputDialogError.set('è«‹è¼¸å…¥å…§å®¹');\r\n      return;\r\n    }\r\n    \r\n    // èª¿ç”¨å›èª¿\r\n    if (config.onConfirm) {\r\n      config.onConfirm(value.trim());\r\n    }\r\n    \r\n    // é—œé–‰å°è©±æ¡†\r\n    this._inputDialog.set(null);\r\n    this._inputDialogValue.set('');\r\n    this._inputDialogError.set(null);\r\n  }\r\n  \r\n  /**\r\n   * å–æ¶ˆè¼¸å…¥å°è©±æ¡†\r\n   */\r\n  cancelInput(): void {\r\n    const config = this._inputDialog();\r\n    if (config?.onCancel) {\r\n      config.onCancel();\r\n    }\r\n    this._inputDialog.set(null);\r\n    this._inputDialogValue.set('');\r\n    this._inputDialogError.set(null);\r\n  }\r\n}\r\n","/**\n * @license Angular v21.0.6\n * (c) 2010-2025 Google LLC. https://angular.dev/\n * License: MIT\n */\n\nvar AnimationMetadataType;\n(function (AnimationMetadataType) {\n  AnimationMetadataType[AnimationMetadataType[\"State\"] = 0] = \"State\";\n  AnimationMetadataType[AnimationMetadataType[\"Transition\"] = 1] = \"Transition\";\n  AnimationMetadataType[AnimationMetadataType[\"Sequence\"] = 2] = \"Sequence\";\n  AnimationMetadataType[AnimationMetadataType[\"Group\"] = 3] = \"Group\";\n  AnimationMetadataType[AnimationMetadataType[\"Animate\"] = 4] = \"Animate\";\n  AnimationMetadataType[AnimationMetadataType[\"Keyframes\"] = 5] = \"Keyframes\";\n  AnimationMetadataType[AnimationMetadataType[\"Style\"] = 6] = \"Style\";\n  AnimationMetadataType[AnimationMetadataType[\"Trigger\"] = 7] = \"Trigger\";\n  AnimationMetadataType[AnimationMetadataType[\"Reference\"] = 8] = \"Reference\";\n  AnimationMetadataType[AnimationMetadataType[\"AnimateChild\"] = 9] = \"AnimateChild\";\n  AnimationMetadataType[AnimationMetadataType[\"AnimateRef\"] = 10] = \"AnimateRef\";\n  AnimationMetadataType[AnimationMetadataType[\"Query\"] = 11] = \"Query\";\n  AnimationMetadataType[AnimationMetadataType[\"Stagger\"] = 12] = \"Stagger\";\n})(AnimationMetadataType || (AnimationMetadataType = {}));\nconst AUTO_STYLE = '*';\nfunction trigger(name, definitions) {\n  return {\n    type: AnimationMetadataType.Trigger,\n    name,\n    definitions,\n    options: {}\n  };\n}\nfunction animate(timings, styles = null) {\n  return {\n    type: AnimationMetadataType.Animate,\n    styles,\n    timings\n  };\n}\nfunction group(steps, options = null) {\n  return {\n    type: AnimationMetadataType.Group,\n    steps,\n    options\n  };\n}\nfunction sequence(steps, options = null) {\n  return {\n    type: AnimationMetadataType.Sequence,\n    steps,\n    options\n  };\n}\nfunction style(tokens) {\n  return {\n    type: AnimationMetadataType.Style,\n    styles: tokens,\n    offset: null\n  };\n}\nfunction state(name, styles, options) {\n  return {\n    type: AnimationMetadataType.State,\n    name,\n    styles,\n    options\n  };\n}\nfunction keyframes(steps) {\n  return {\n    type: AnimationMetadataType.Keyframes,\n    steps\n  };\n}\nfunction transition(stateChangeExpr, steps, options = null) {\n  return {\n    type: AnimationMetadataType.Transition,\n    expr: stateChangeExpr,\n    animation: steps,\n    options\n  };\n}\nfunction animation(steps, options = null) {\n  return {\n    type: AnimationMetadataType.Reference,\n    animation: steps,\n    options\n  };\n}\nfunction animateChild(options = null) {\n  return {\n    type: AnimationMetadataType.AnimateChild,\n    options\n  };\n}\nfunction useAnimation(animation, options = null) {\n  return {\n    type: AnimationMetadataType.AnimateRef,\n    animation,\n    options\n  };\n}\nfunction query(selector, animation, options = null) {\n  return {\n    type: AnimationMetadataType.Query,\n    selector,\n    animation,\n    options\n  };\n}\nfunction stagger(timings, animation) {\n  return {\n    type: AnimationMetadataType.Stagger,\n    timings,\n    animation\n  };\n}\n\nclass NoopAnimationPlayer {\n  _onDoneFns = [];\n  _onStartFns = [];\n  _onDestroyFns = [];\n  _originalOnDoneFns = [];\n  _originalOnStartFns = [];\n  _started = false;\n  _destroyed = false;\n  _finished = false;\n  _position = 0;\n  parentPlayer = null;\n  totalTime;\n  constructor(duration = 0, delay = 0) {\n    this.totalTime = duration + delay;\n  }\n  _onFinish() {\n    if (!this._finished) {\n      this._finished = true;\n      this._onDoneFns.forEach(fn => fn());\n      this._onDoneFns = [];\n    }\n  }\n  onStart(fn) {\n    this._originalOnStartFns.push(fn);\n    this._onStartFns.push(fn);\n  }\n  onDone(fn) {\n    this._originalOnDoneFns.push(fn);\n    this._onDoneFns.push(fn);\n  }\n  onDestroy(fn) {\n    this._onDestroyFns.push(fn);\n  }\n  hasStarted() {\n    return this._started;\n  }\n  init() {}\n  play() {\n    if (!this.hasStarted()) {\n      this._onStart();\n      this.triggerMicrotask();\n    }\n    this._started = true;\n  }\n  triggerMicrotask() {\n    queueMicrotask(() => this._onFinish());\n  }\n  _onStart() {\n    this._onStartFns.forEach(fn => fn());\n    this._onStartFns = [];\n  }\n  pause() {}\n  restart() {}\n  finish() {\n    this._onFinish();\n  }\n  destroy() {\n    if (!this._destroyed) {\n      this._destroyed = true;\n      if (!this.hasStarted()) {\n        this._onStart();\n      }\n      this.finish();\n      this._onDestroyFns.forEach(fn => fn());\n      this._onDestroyFns = [];\n    }\n  }\n  reset() {\n    this._started = false;\n    this._finished = false;\n    this._onStartFns = this._originalOnStartFns;\n    this._onDoneFns = this._originalOnDoneFns;\n  }\n  setPosition(position) {\n    this._position = this.totalTime ? position * this.totalTime : 1;\n  }\n  getPosition() {\n    return this.totalTime ? this._position / this.totalTime : 1;\n  }\n  triggerCallback(phaseName) {\n    const methods = phaseName == 'start' ? this._onStartFns : this._onDoneFns;\n    methods.forEach(fn => fn());\n    methods.length = 0;\n  }\n}\n\nclass AnimationGroupPlayer {\n  _onDoneFns = [];\n  _onStartFns = [];\n  _finished = false;\n  _started = false;\n  _destroyed = false;\n  _onDestroyFns = [];\n  parentPlayer = null;\n  totalTime = 0;\n  players;\n  constructor(_players) {\n    this.players = _players;\n    let doneCount = 0;\n    let destroyCount = 0;\n    let startCount = 0;\n    const total = this.players.length;\n    if (total == 0) {\n      queueMicrotask(() => this._onFinish());\n    } else {\n      this.players.forEach(player => {\n        player.onDone(() => {\n          if (++doneCount == total) {\n            this._onFinish();\n          }\n        });\n        player.onDestroy(() => {\n          if (++destroyCount == total) {\n            this._onDestroy();\n          }\n        });\n        player.onStart(() => {\n          if (++startCount == total) {\n            this._onStart();\n          }\n        });\n      });\n    }\n    this.totalTime = this.players.reduce((time, player) => Math.max(time, player.totalTime), 0);\n  }\n  _onFinish() {\n    if (!this._finished) {\n      this._finished = true;\n      this._onDoneFns.forEach(fn => fn());\n      this._onDoneFns = [];\n    }\n  }\n  init() {\n    this.players.forEach(player => player.init());\n  }\n  onStart(fn) {\n    this._onStartFns.push(fn);\n  }\n  _onStart() {\n    if (!this.hasStarted()) {\n      this._started = true;\n      this._onStartFns.forEach(fn => fn());\n      this._onStartFns = [];\n    }\n  }\n  onDone(fn) {\n    this._onDoneFns.push(fn);\n  }\n  onDestroy(fn) {\n    this._onDestroyFns.push(fn);\n  }\n  hasStarted() {\n    return this._started;\n  }\n  play() {\n    if (!this.parentPlayer) {\n      this.init();\n    }\n    this._onStart();\n    this.players.forEach(player => player.play());\n  }\n  pause() {\n    this.players.forEach(player => player.pause());\n  }\n  restart() {\n    this.players.forEach(player => player.restart());\n  }\n  finish() {\n    this._onFinish();\n    this.players.forEach(player => player.finish());\n  }\n  destroy() {\n    this._onDestroy();\n  }\n  _onDestroy() {\n    if (!this._destroyed) {\n      this._destroyed = true;\n      this._onFinish();\n      this.players.forEach(player => player.destroy());\n      this._onDestroyFns.forEach(fn => fn());\n      this._onDestroyFns = [];\n    }\n  }\n  reset() {\n    this.players.forEach(player => player.reset());\n    this._destroyed = false;\n    this._finished = false;\n    this._started = false;\n  }\n  setPosition(p) {\n    const timeAtPosition = p * this.totalTime;\n    this.players.forEach(player => {\n      const position = player.totalTime ? Math.min(1, timeAtPosition / player.totalTime) : 1;\n      player.setPosition(position);\n    });\n  }\n  getPosition() {\n    const longestPlayer = this.players.reduce((longestSoFar, player) => {\n      const newPlayerIsLongest = longestSoFar === null || player.totalTime > longestSoFar.totalTime;\n      return newPlayerIsLongest ? player : longestSoFar;\n    }, null);\n    return longestPlayer != null ? longestPlayer.getPosition() : 0;\n  }\n  beforeDestroy() {\n    this.players.forEach(player => {\n      if (player.beforeDestroy) {\n        player.beforeDestroy();\n      }\n    });\n  }\n  triggerCallback(phaseName) {\n    const methods = phaseName == 'start' ? this._onStartFns : this._onDoneFns;\n    methods.forEach(fn => fn());\n    methods.length = 0;\n  }\n}\n\nconst ÉµPRE_STYLE = '!';\n\nexport { AUTO_STYLE, AnimationGroupPlayer, AnimationMetadataType, NoopAnimationPlayer, animate, animateChild, animation, group, keyframes, query, sequence, stagger, state, style, transition, trigger, useAnimation, ÉµPRE_STYLE };\n\n","/**\n * @license Angular v21.0.6\n * (c) 2010-2025 Google LLC. https://angular.dev/\n * License: MIT\n */\n\nimport * as i0 from '@angular/core';\nimport { inject, Injectable, ANIMATION_MODULE_TYPE, ÉµRuntimeError as _RuntimeError, DOCUMENT, Inject, ViewEncapsulation } from '@angular/core';\nimport { sequence } from './_private_export-chunk.mjs';\nexport { AUTO_STYLE, AnimationMetadataType, NoopAnimationPlayer, animate, animateChild, animation, group, keyframes, query, stagger, state, style, transition, trigger, useAnimation, AnimationGroupPlayer as ÉµAnimationGroupPlayer, ÉµPRE_STYLE } from './_private_export-chunk.mjs';\nclass AnimationBuilder {\n  static Éµfac = function AnimationBuilder_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || AnimationBuilder)();\n  };\n  static Éµprov = /* @__PURE__ */i0.ÉµÉµdefineInjectable({\n    token: AnimationBuilder,\n    factory: () => (() => inject(BrowserAnimationBuilder))(),\n    providedIn: 'root'\n  });\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ÉµsetClassMetadata(AnimationBuilder, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root',\n      useFactory: () => inject(BrowserAnimationBuilder)\n    }]\n  }], null, null);\n})();\nclass AnimationFactory {}\nclass BrowserAnimationBuilder extends AnimationBuilder {\n  animationModuleType = inject(ANIMATION_MODULE_TYPE, {\n    optional: true\n  });\n  _nextAnimationId = 0;\n  _renderer;\n  constructor(rootRenderer, doc) {\n    super();\n    const typeData = {\n      id: '0',\n      encapsulation: ViewEncapsulation.None,\n      styles: [],\n      data: {\n        animation: []\n      }\n    };\n    this._renderer = rootRenderer.createRenderer(doc.body, typeData);\n    if (this.animationModuleType === null && !isAnimationRenderer(this._renderer)) {\n      throw new _RuntimeError(3600, (typeof ngDevMode === 'undefined' || ngDevMode) && 'Angular detected that the `AnimationBuilder` was injected, but animation support was not enabled. ' + 'Please make sure that you enable animations in your application by calling `provideAnimations()` or `provideAnimationsAsync()` function.');\n    }\n  }\n  build(animation) {\n    const id = this._nextAnimationId;\n    this._nextAnimationId++;\n    const entry = Array.isArray(animation) ? sequence(animation) : animation;\n    issueAnimationCommand(this._renderer, null, id, 'register', [entry]);\n    return new BrowserAnimationFactory(id, this._renderer);\n  }\n  static Éµfac = function BrowserAnimationBuilder_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || BrowserAnimationBuilder)(i0.ÉµÉµinject(i0.RendererFactory2), i0.ÉµÉµinject(DOCUMENT));\n  };\n  static Éµprov = /* @__PURE__ */i0.ÉµÉµdefineInjectable({\n    token: BrowserAnimationBuilder,\n    factory: BrowserAnimationBuilder.Éµfac,\n    providedIn: 'root'\n  });\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ÉµsetClassMetadata(BrowserAnimationBuilder, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], () => [{\n    type: i0.RendererFactory2\n  }, {\n    type: Document,\n    decorators: [{\n      type: Inject,\n      args: [DOCUMENT]\n    }]\n  }], null);\n})();\nclass BrowserAnimationFactory extends AnimationFactory {\n  _id;\n  _renderer;\n  constructor(_id, _renderer) {\n    super();\n    this._id = _id;\n    this._renderer = _renderer;\n  }\n  create(element, options) {\n    return new RendererAnimationPlayer(this._id, element, options || {}, this._renderer);\n  }\n}\nclass RendererAnimationPlayer {\n  id;\n  element;\n  _renderer;\n  parentPlayer = null;\n  _started = false;\n  constructor(id, element, options, _renderer) {\n    this.id = id;\n    this.element = element;\n    this._renderer = _renderer;\n    this._command('create', options);\n  }\n  _listen(eventName, callback) {\n    return this._renderer.listen(this.element, `@@${this.id}:${eventName}`, callback);\n  }\n  _command(command, ...args) {\n    issueAnimationCommand(this._renderer, this.element, this.id, command, args);\n  }\n  onDone(fn) {\n    this._listen('done', fn);\n  }\n  onStart(fn) {\n    this._listen('start', fn);\n  }\n  onDestroy(fn) {\n    this._listen('destroy', fn);\n  }\n  init() {\n    this._command('init');\n  }\n  hasStarted() {\n    return this._started;\n  }\n  play() {\n    this._command('play');\n    this._started = true;\n  }\n  pause() {\n    this._command('pause');\n  }\n  restart() {\n    this._command('restart');\n  }\n  finish() {\n    this._command('finish');\n  }\n  destroy() {\n    this._command('destroy');\n  }\n  reset() {\n    this._command('reset');\n    this._started = false;\n  }\n  setPosition(p) {\n    this._command('setPosition', p);\n  }\n  getPosition() {\n    return unwrapAnimationRenderer(this._renderer)?.engine?.players[this.id]?.getPosition() ?? 0;\n  }\n  totalTime = 0;\n}\nfunction issueAnimationCommand(renderer, element, id, command, args) {\n  renderer.setProperty(element, `@@${id}:${command}`, args);\n}\nfunction unwrapAnimationRenderer(renderer) {\n  const type = renderer.Éµtype;\n  if (type === 0) {\n    return renderer;\n  } else if (type === 1) {\n    return renderer.animationRenderer;\n  }\n  return null;\n}\nfunction isAnimationRenderer(renderer) {\n  const type = renderer.Éµtype;\n  return type === 0 || type === 1;\n}\nexport { AnimationBuilder, AnimationFactory, sequence, BrowserAnimationBuilder as ÉµBrowserAnimationBuilder };\n","/**\r\n * TG-AIæ™ºæ§ç‹ è·¯ç”±å‹•ç•«\r\n * Route Animations - è¦–åœ–åˆ‡æ›å‹•ç•«æ•ˆæœ\r\n * \r\n * ğŸ†• Phase 23: æ·»åŠ è·¯ç”±åˆ‡æ›å‹•ç•«\r\n */\r\n\r\nimport {\r\n  trigger,\r\n  transition,\r\n  style,\r\n  query,\r\n  animate,\r\n  group,\r\n  animateChild\r\n} from '@angular/animations';\r\n\r\n/**\r\n * æ·¡å…¥æ·¡å‡ºå‹•ç•«\r\n * ç°¡å–®çš„é€æ˜åº¦åˆ‡æ›æ•ˆæœ\r\n */\r\nexport const fadeAnimation = trigger('routeAnimations', [\r\n  transition('* <=> *', [\r\n    // è¨­ç½®é€²å…¥å’Œé›¢é–‹çš„å…ƒç´ \r\n    query(':enter, :leave', [\r\n      style({\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%',\r\n        opacity: 0\r\n      })\r\n    ], { optional: true }),\r\n    \r\n    // é›¢é–‹çš„å…ƒç´ æ·¡å‡º\r\n    query(':leave', [\r\n      animate('200ms ease-out', style({ opacity: 0 }))\r\n    ], { optional: true }),\r\n    \r\n    // é€²å…¥çš„å…ƒç´ æ·¡å…¥\r\n    query(':enter', [\r\n      animate('300ms ease-in', style({ opacity: 1 }))\r\n    ], { optional: true })\r\n  ])\r\n]);\r\n\r\n/**\r\n * æ»‘å‹•å‹•ç•«\r\n * å¾å³å´æ»‘å…¥ï¼Œå‘å·¦å´æ»‘å‡º\r\n */\r\nexport const slideAnimation = trigger('routeAnimations', [\r\n  transition('* => *', [\r\n    query(':enter, :leave', [\r\n      style({\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%'\r\n      })\r\n    ], { optional: true }),\r\n    \r\n    group([\r\n      query(':leave', [\r\n        animate('300ms ease-out', style({\r\n          transform: 'translateX(-100%)',\r\n          opacity: 0\r\n        }))\r\n      ], { optional: true }),\r\n      \r\n      query(':enter', [\r\n        style({\r\n          transform: 'translateX(100%)',\r\n          opacity: 0\r\n        }),\r\n        animate('300ms ease-out', style({\r\n          transform: 'translateX(0)',\r\n          opacity: 1\r\n        }))\r\n      ], { optional: true })\r\n    ])\r\n  ])\r\n]);\r\n\r\n/**\r\n * ç¸®æ”¾æ·¡å…¥å‹•ç•«\r\n * é€²å…¥æ™‚æ”¾å¤§æ·¡å…¥ï¼Œé›¢é–‹æ™‚ç¸®å°æ·¡å‡º\r\n */\r\nexport const scaleAnimation = trigger('routeAnimations', [\r\n  transition('* <=> *', [\r\n    query(':enter, :leave', [\r\n      style({\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%'\r\n      })\r\n    ], { optional: true }),\r\n    \r\n    query(':leave', [\r\n      animate('200ms ease-out', style({\r\n        transform: 'scale(0.95)',\r\n        opacity: 0\r\n      }))\r\n    ], { optional: true }),\r\n    \r\n    query(':enter', [\r\n      style({\r\n        transform: 'scale(1.05)',\r\n        opacity: 0\r\n      }),\r\n      animate('300ms ease-out', style({\r\n        transform: 'scale(1)',\r\n        opacity: 1\r\n      }))\r\n    ], { optional: true })\r\n  ])\r\n]);\r\n\r\n/**\r\n * å‘ä¸Šæ»‘å…¥å‹•ç•«\r\n * æ–°é é¢å¾ä¸‹æ–¹æ»‘å…¥\r\n */\r\nexport const slideUpAnimation = trigger('routeAnimations', [\r\n  transition('* <=> *', [\r\n    query(':enter, :leave', [\r\n      style({\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%'\r\n      })\r\n    ], { optional: true }),\r\n    \r\n    query(':leave', [\r\n      animate('200ms ease-out', style({\r\n        transform: 'translateY(-20px)',\r\n        opacity: 0\r\n      }))\r\n    ], { optional: true }),\r\n    \r\n    query(':enter', [\r\n      style({\r\n        transform: 'translateY(20px)',\r\n        opacity: 0\r\n      }),\r\n      animate('300ms ease-out', style({\r\n        transform: 'translateY(0)',\r\n        opacity: 1\r\n      }))\r\n    ], { optional: true })\r\n  ])\r\n]);\r\n\r\n/**\r\n * é»˜èªå‹•ç•«ï¼ˆæ¨è–¦ï¼‰\r\n * çµåˆæ·¡å…¥å’Œå¾®ç¸®æ”¾æ•ˆæœï¼Œæµæš¢è‡ªç„¶\r\n */\r\nexport const defaultRouteAnimation = trigger('routeAnimations', [\r\n  transition('* <=> *', [\r\n    // è¨­ç½®å®¹å™¨æ¨£å¼\r\n    style({ position: 'relative' }),\r\n    \r\n    query(':enter, :leave', [\r\n      style({\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%',\r\n        height: '100%'\r\n      })\r\n    ], { optional: true }),\r\n    \r\n    // åŒæ™‚åŸ·è¡Œé€²å…¥å’Œé›¢é–‹å‹•ç•«\r\n    group([\r\n      query(':leave', [\r\n        style({ opacity: 1, transform: 'scale(1)' }),\r\n        animate('200ms ease-out', style({\r\n          opacity: 0,\r\n          transform: 'scale(0.98)'\r\n        }))\r\n      ], { optional: true }),\r\n      \r\n      query(':enter', [\r\n        style({ opacity: 0, transform: 'scale(1.02)' }),\r\n        animate('300ms 100ms ease-out', style({\r\n          opacity: 1,\r\n          transform: 'scale(1)'\r\n        }))\r\n      ], { optional: true })\r\n    ]),\r\n    \r\n    // ç¢ºä¿å­å‹•ç•«ä¹ŸåŸ·è¡Œ\r\n    query(':enter', animateChild(), { optional: true })\r\n  ])\r\n]);\r\n\r\n/**\r\n * ç„¡å‹•ç•«ï¼ˆç”¨æ–¼ç¦ç”¨å‹•ç•«ï¼‰\r\n */\r\nexport const noAnimation = trigger('routeAnimations', []);\r\n","/**\r\n * å‹•ç•«é…ç½®æœå‹™\r\n * Animation Config Service\r\n * \r\n * ğŸ†• Phase 24: å‹•æ…‹åˆ‡æ›å‹•ç•«æ•ˆæœ\r\n */\r\n\r\nimport { Injectable, signal, computed } from '@angular/core';\r\nimport {\r\n  fadeAnimation,\r\n  slideAnimation,\r\n  scaleAnimation,\r\n  slideUpAnimation,\r\n  defaultRouteAnimation,\r\n  noAnimation\r\n} from '../animations';\r\nimport { AnimationTriggerMetadata } from '@angular/animations';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport type AnimationType = 'default' | 'fade' | 'slide' | 'scale' | 'slideUp' | 'none';\r\n\r\nexport interface AnimationOption {\r\n  id: AnimationType;\r\n  name: string;\r\n  description: string;\r\n  preview: string;\r\n}\r\n\r\n// ============ å‹•ç•«é¸é …é…ç½® ============\r\n\r\nexport const ANIMATION_OPTIONS: AnimationOption[] = [\r\n  {\r\n    id: 'default',\r\n    name: 'æ¨è–¦',\r\n    description: 'æ·¡å…¥ + å¾®ç¸®æ”¾æ•ˆæœï¼Œæµæš¢è‡ªç„¶',\r\n    preview: 'âœ¨'\r\n  },\r\n  {\r\n    id: 'fade',\r\n    name: 'æ·¡å…¥æ·¡å‡º',\r\n    description: 'ç°¡å–®çš„é€æ˜åº¦åˆ‡æ›',\r\n    preview: 'ğŸŒ«ï¸'\r\n  },\r\n  {\r\n    id: 'slide',\r\n    name: 'å·¦å³æ»‘å‹•',\r\n    description: 'é é¢å¾å³å´æ»‘å…¥',\r\n    preview: 'â¡ï¸'\r\n  },\r\n  {\r\n    id: 'slideUp',\r\n    name: 'ä¸Šä¸‹æ»‘å‹•',\r\n    description: 'é é¢å¾ä¸‹æ–¹æ»‘å…¥',\r\n    preview: 'â¬†ï¸'\r\n  },\r\n  {\r\n    id: 'scale',\r\n    name: 'ç¸®æ”¾',\r\n    description: 'é é¢æ”¾å¤§æ·¡å…¥',\r\n    preview: 'ğŸ”'\r\n  },\r\n  {\r\n    id: 'none',\r\n    name: 'ç„¡å‹•ç•«',\r\n    description: 'ç¦ç”¨æ‰€æœ‰å‹•ç•«æ•ˆæœ',\r\n    preview: 'â¹ï¸'\r\n  }\r\n];\r\n\r\n// ============ å‹•ç•«æ˜ å°„ ============\r\n\r\nexport const ANIMATION_MAP: Record<AnimationType, AnimationTriggerMetadata> = {\r\n  'default': defaultRouteAnimation,\r\n  'fade': fadeAnimation,\r\n  'slide': slideAnimation,\r\n  'scale': scaleAnimation,\r\n  'slideUp': slideUpAnimation,\r\n  'none': noAnimation\r\n};\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AnimationConfigService {\r\n  // ç•¶å‰å‹•ç•«é¡å‹\r\n  private _animationType = signal<AnimationType>('default');\r\n  \r\n  animationType = this._animationType.asReadonly();\r\n  \r\n  // ç•¶å‰å‹•ç•«é¸é …\r\n  currentOption = computed(() => {\r\n    const type = this._animationType();\r\n    return ANIMATION_OPTIONS.find(opt => opt.id === type) || ANIMATION_OPTIONS[0];\r\n  });\r\n  \r\n  // æ‰€æœ‰å‹•ç•«é¸é …\r\n  readonly options = ANIMATION_OPTIONS;\r\n  \r\n  constructor() {\r\n    // å¾ localStorage æ¢å¾©è¨­ç½®\r\n    this.loadFromStorage();\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®å‹•ç•«é¡å‹\r\n   */\r\n  setAnimationType(type: AnimationType): void {\r\n    this._animationType.set(type);\r\n    this.saveToStorage();\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ç•¶å‰å‹•ç•«\r\n   */\r\n  getAnimation(): AnimationTriggerMetadata {\r\n    return ANIMATION_MAP[this._animationType()];\r\n  }\r\n  \r\n  /**\r\n   * åˆ‡æ›åˆ°ä¸‹ä¸€å€‹å‹•ç•«\r\n   */\r\n  nextAnimation(): void {\r\n    const current = this._animationType();\r\n    const currentIndex = ANIMATION_OPTIONS.findIndex(opt => opt.id === current);\r\n    const nextIndex = (currentIndex + 1) % ANIMATION_OPTIONS.length;\r\n    this.setAnimationType(ANIMATION_OPTIONS[nextIndex].id);\r\n  }\r\n  \r\n  /**\r\n   * é‡ç½®ç‚ºé»˜èªå‹•ç•«\r\n   */\r\n  resetToDefault(): void {\r\n    this.setAnimationType('default');\r\n  }\r\n  \r\n  /**\r\n   * æª¢æŸ¥æ˜¯å¦ç¦ç”¨å‹•ç•«\r\n   */\r\n  isAnimationDisabled(): boolean {\r\n    return this._animationType() === 'none';\r\n  }\r\n  \r\n  // ========== å­˜å„²æ“ä½œ ==========\r\n  \r\n  private loadFromStorage(): void {\r\n    try {\r\n      const saved = localStorage.getItem('tg-animation-type');\r\n      if (saved && ANIMATION_OPTIONS.some(opt => opt.id === saved)) {\r\n        this._animationType.set(saved as AnimationType);\r\n      }\r\n    } catch (e) {\r\n      // localStorage ä¸å¯ç”¨æ™‚å¿½ç•¥\r\n    }\r\n  }\r\n  \r\n  private saveToStorage(): void {\r\n    try {\r\n      localStorage.setItem('tg-animation-type', this._animationType());\r\n    } catch (e) {\r\n      // localStorage ä¸å¯ç”¨æ™‚å¿½ç•¥\r\n    }\r\n  }\r\n}\r\n","/**\r\n * è¨­å®šæœå‹™\r\n * Settings Service\r\n * \r\n * ğŸ†• Phase 24: å¾ app.component.ts æå–è¨­å®šç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\nimport { I18nService } from '../i18n.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport interface AppSettings {\r\n  // å¤–è§€è¨­ç½®\r\n  theme: 'dark' | 'light' | 'system';\r\n  language: 'zh-TW' | 'zh-CN' | 'en';\r\n  sidebarCollapsed: boolean;\r\n  animationType: string;\r\n  \r\n  // åŠŸèƒ½è¨­ç½®\r\n  autoConnect: boolean;\r\n  autoMonitor: boolean;\r\n  showNotifications: boolean;\r\n  soundEnabled: boolean;\r\n  \r\n  // å®‰å…¨è¨­ç½®\r\n  autoLock: boolean;\r\n  lockTimeout: number;\r\n  \r\n  // æ€§èƒ½è¨­ç½®\r\n  enableAnalytics: boolean;\r\n  logLevel: 'debug' | 'info' | 'warn' | 'error';\r\n}\r\n\r\nexport interface ApiCredentials {\r\n  geminiApiKey?: string;\r\n  openaiApiKey?: string;\r\n  telegramApiId?: string;\r\n  telegramApiHash?: string;\r\n}\r\n\r\n// ============ é»˜èªè¨­ç½® ============\r\n\r\nexport const DEFAULT_SETTINGS: AppSettings = {\r\n  theme: 'dark',\r\n  language: 'zh-TW',\r\n  sidebarCollapsed: false,\r\n  animationType: 'default',\r\n  autoConnect: true,\r\n  autoMonitor: false,\r\n  showNotifications: true,\r\n  soundEnabled: true,\r\n  autoLock: false,\r\n  lockTimeout: 5,\r\n  enableAnalytics: true,\r\n  logLevel: 'info'\r\n};\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SettingsService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  private i18n = inject(I18nService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _settings = signal<AppSettings>(DEFAULT_SETTINGS);\r\n  private _credentials = signal<ApiCredentials>({});\r\n  private _isLoading = signal(false);\r\n  private _isDirty = signal(false);\r\n  \r\n  settings = this._settings.asReadonly();\r\n  credentials = this._credentials.asReadonly();\r\n  isLoading = this._isLoading.asReadonly();\r\n  isDirty = this._isDirty.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  \r\n  theme = computed(() => this._settings().theme);\r\n  language = computed(() => this._settings().language);\r\n  sidebarCollapsed = computed(() => this._settings().sidebarCollapsed);\r\n  \r\n  hasApiCredentials = computed(() => {\r\n    const creds = this._credentials();\r\n    return !!(creds.geminiApiKey || creds.openaiApiKey);\r\n  });\r\n  \r\n  hasTelegramCredentials = computed(() => {\r\n    const creds = this._credentials();\r\n    return !!(creds.telegramApiId && creds.telegramApiHash);\r\n  });\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n    this.loadSettings();\r\n  }\r\n  \r\n  // ========== IPC ç›£è½ ==========\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('settings-loaded', (data: AppSettings) => {\r\n      this._settings.set({ ...DEFAULT_SETTINGS, ...data });\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('settings-saved', () => {\r\n      this._isDirty.set(false);\r\n      this.toast.success('è¨­ç½®å·²ä¿å­˜');\r\n    });\r\n    \r\n    this.ipc.on('credentials-loaded', (data: ApiCredentials) => {\r\n      this._credentials.set(data);\r\n    });\r\n  }\r\n  \r\n  // ========== è¨­ç½®æ“ä½œ ==========\r\n  \r\n  loadSettings(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-settings');\r\n    this.ipc.send('get-credentials');\r\n  }\r\n  \r\n  saveSettings(): void {\r\n    this.ipc.send('save-settings', this._settings());\r\n  }\r\n  \r\n  updateSetting<K extends keyof AppSettings>(key: K, value: AppSettings[K]): void {\r\n    this._settings.update(s => ({ ...s, [key]: value }));\r\n    this._isDirty.set(true);\r\n  }\r\n  \r\n  resetSettings(): void {\r\n    if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨­ç½®å—ï¼Ÿ')) {\r\n      this._settings.set(DEFAULT_SETTINGS);\r\n      this._isDirty.set(true);\r\n      this.saveSettings();\r\n    }\r\n  }\r\n  \r\n  // ========== ä¸»é¡Œæ“ä½œ ==========\r\n  \r\n  setTheme(theme: 'dark' | 'light' | 'system'): void {\r\n    this.updateSetting('theme', theme);\r\n    this.applyTheme(theme);\r\n  }\r\n  \r\n  toggleTheme(): void {\r\n    const current = this._settings().theme;\r\n    const next = current === 'dark' ? 'light' : 'dark';\r\n    this.setTheme(next);\r\n  }\r\n  \r\n  private applyTheme(theme: 'dark' | 'light' | 'system'): void {\r\n    const root = document.documentElement;\r\n    \r\n    if (theme === 'system') {\r\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n      root.setAttribute('data-theme', prefersDark ? 'dark' : 'light');\r\n    } else {\r\n      root.setAttribute('data-theme', theme);\r\n    }\r\n  }\r\n  \r\n  // ========== èªè¨€æ“ä½œ ==========\r\n  \r\n  setLanguage(language: 'zh-TW' | 'zh-CN' | 'en'): void {\r\n    this.updateSetting('language', language);\r\n    this.i18n.setLocale(language);\r\n  }\r\n  \r\n  // ========== å´é‚Šæ¬„æ“ä½œ ==========\r\n  \r\n  toggleSidebar(): void {\r\n    const current = this._settings().sidebarCollapsed;\r\n    this.updateSetting('sidebarCollapsed', !current);\r\n  }\r\n  \r\n  setSidebarCollapsed(collapsed: boolean): void {\r\n    this.updateSetting('sidebarCollapsed', collapsed);\r\n  }\r\n  \r\n  // ========== API æ†‘è­‰æ“ä½œ ==========\r\n  \r\n  saveCredentials(credentials: Partial<ApiCredentials>): void {\r\n    this._credentials.update(c => ({ ...c, ...credentials }));\r\n    this.ipc.send('save-credentials', this._credentials());\r\n    this.toast.success('API æ†‘è­‰å·²ä¿å­˜');\r\n  }\r\n  \r\n  testGeminiConnection(): void {\r\n    const key = this._credentials().geminiApiKey;\r\n    if (!key) {\r\n      this.toast.error('è«‹å…ˆè¨­ç½® Gemini API Key');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('test-gemini-connection', { apiKey: key });\r\n    this.toast.info('æ­£åœ¨æ¸¬è©¦ Gemini é€£æ¥...');\r\n  }\r\n  \r\n  testOpenAiConnection(): void {\r\n    const key = this._credentials().openaiApiKey;\r\n    if (!key) {\r\n      this.toast.error('è«‹å…ˆè¨­ç½® OpenAI API Key');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('test-openai-connection', { apiKey: key });\r\n    this.toast.info('æ­£åœ¨æ¸¬è©¦ OpenAI é€£æ¥...');\r\n  }\r\n  \r\n  testTelegramCredentials(): void {\r\n    const creds = this._credentials();\r\n    if (!creds.telegramApiId || !creds.telegramApiHash) {\r\n      this.toast.error('è«‹å…ˆè¨­ç½® Telegram API æ†‘è­‰');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('test-telegram-credentials', {\r\n      apiId: creds.telegramApiId,\r\n      apiHash: creds.telegramApiHash\r\n    });\r\n    this.toast.info('æ­£åœ¨æ¸¬è©¦ Telegram æ†‘è­‰...');\r\n  }\r\n  \r\n  // ========== å°å‡º/å°å…¥ ==========\r\n  \r\n  exportSettings(): void {\r\n    const data = {\r\n      settings: this._settings(),\r\n      exportedAt: new Date().toISOString()\r\n    };\r\n    \r\n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `tg-settings-${new Date().toISOString().split('T')[0]}.json`;\r\n    a.click();\r\n    \r\n    URL.revokeObjectURL(url);\r\n    this.toast.success('è¨­ç½®å·²å°å‡º');\r\n  }\r\n  \r\n  importSettings(file: File): void {\r\n    const reader = new FileReader();\r\n    \r\n    reader.onload = (e) => {\r\n      try {\r\n        const data = JSON.parse(e.target?.result as string);\r\n        if (data.settings) {\r\n          this._settings.set({ ...DEFAULT_SETTINGS, ...data.settings });\r\n          this._isDirty.set(true);\r\n          this.saveSettings();\r\n          this.toast.success('è¨­ç½®å·²å°å…¥');\r\n        } else {\r\n          this.toast.error('ç„¡æ•ˆçš„è¨­ç½®æ–‡ä»¶');\r\n        }\r\n      } catch (error) {\r\n        this.toast.error('è¨­ç½®æ–‡ä»¶è§£æå¤±æ•—');\r\n      }\r\n    };\r\n    \r\n    reader.readAsText(file);\r\n  }\r\n}\r\n","/**\r\n * AI å°è©±æœå‹™\r\n * AI Chat Service\r\n * \r\n * ğŸ†• Phase 24: å¾ app.component.ts æå– AI ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport type AiProvider = 'gemini' | 'openai' | 'claude' | 'local';\r\n\r\nexport interface AiSettings {\r\n  provider: AiProvider;\r\n  model: string;\r\n  temperature: number;\r\n  maxTokens: number;\r\n  systemPrompt: string;\r\n  enableMemory: boolean;\r\n  enableRag: boolean;\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp: string;\r\n  tokens?: number;\r\n}\r\n\r\nexport interface ChatSession {\r\n  id: string;\r\n  title: string;\r\n  messages: ChatMessage[];\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface RagDocument {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  source: string;\r\n  embedding?: number[];\r\n}\r\n\r\n// ============ é»˜èªè¨­ç½® ============\r\n\r\nexport const DEFAULT_AI_SETTINGS: AiSettings = {\r\n  provider: 'gemini',\r\n  model: 'gemini-pro',\r\n  temperature: 0.7,\r\n  maxTokens: 2048,\r\n  systemPrompt: 'ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„ Telegram ç‡ŸéŠ·åŠ©æ‰‹ï¼Œå¹«åŠ©ç”¨æˆ¶é€²è¡Œç¾¤çµ„ç®¡ç†å’Œå®¢æˆ¶é–‹ç™¼ã€‚',\r\n  enableMemory: true,\r\n  enableRag: false\r\n};\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AiChatService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _settings = signal<AiSettings>(DEFAULT_AI_SETTINGS);\r\n  private _currentSession = signal<ChatSession | null>(null);\r\n  private _sessions = signal<ChatSession[]>([]);\r\n  private _isGenerating = signal(false);\r\n  private _isConnected = signal(false);\r\n  private _ragDocuments = signal<RagDocument[]>([]);\r\n  \r\n  settings = this._settings.asReadonly();\r\n  currentSession = this._currentSession.asReadonly();\r\n  sessions = this._sessions.asReadonly();\r\n  isGenerating = this._isGenerating.asReadonly();\r\n  isConnected = this._isConnected.asReadonly();\r\n  ragDocuments = this._ragDocuments.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  \r\n  currentMessages = computed(() => \r\n    this._currentSession()?.messages || []\r\n  );\r\n  \r\n  hasMessages = computed(() => \r\n    (this._currentSession()?.messages.length || 0) > 0\r\n  );\r\n  \r\n  provider = computed(() => this._settings().provider);\r\n  \r\n  // ========== åˆå§‹åŒ– ==========\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n    this.loadSettings();\r\n  }\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('ai-settings-loaded', (data: AiSettings) => {\r\n      this._settings.set({ ...DEFAULT_AI_SETTINGS, ...data });\r\n    });\r\n    \r\n    this.ipc.on('ai-response', (data: { content: string; tokens?: number }) => {\r\n      this._isGenerating.set(false);\r\n      this.addMessage('assistant', data.content, data.tokens);\r\n    });\r\n    \r\n    this.ipc.on('ai-response-error', (data: { error: string }) => {\r\n      this._isGenerating.set(false);\r\n      this.toast.error(`AI å›å¾©å¤±æ•—: ${data.error}`);\r\n    });\r\n    \r\n    this.ipc.on('ai-connection-status', (data: { connected: boolean }) => {\r\n      this._isConnected.set(data.connected);\r\n    });\r\n    \r\n    this.ipc.on('chat-sessions-loaded', (sessions: ChatSession[]) => {\r\n      this._sessions.set(sessions);\r\n    });\r\n    \r\n    this.ipc.on('rag-documents-loaded', (docs: RagDocument[]) => {\r\n      this._ragDocuments.set(docs);\r\n    });\r\n  }\r\n  \r\n  // ========== è¨­ç½®æ“ä½œ ==========\r\n  \r\n  loadSettings(): void {\r\n    this.ipc.send('get-ai-settings');\r\n  }\r\n  \r\n  saveSettings(): void {\r\n    this.ipc.send('save-ai-settings', this._settings());\r\n    this.toast.success('AI è¨­ç½®å·²ä¿å­˜');\r\n  }\r\n  \r\n  updateSetting<K extends keyof AiSettings>(key: K, value: AiSettings[K]): void {\r\n    this._settings.update(s => ({ ...s, [key]: value }));\r\n  }\r\n  \r\n  setProvider(provider: AiProvider): void {\r\n    this.updateSetting('provider', provider);\r\n    \r\n    // æ ¹æ“šæä¾›è€…è¨­ç½®é»˜èªæ¨¡å‹\r\n    const defaultModels: Record<AiProvider, string> = {\r\n      'gemini': 'gemini-pro',\r\n      'openai': 'gpt-4',\r\n      'claude': 'claude-3-opus',\r\n      'local': 'llama2'\r\n    };\r\n    \r\n    this.updateSetting('model', defaultModels[provider]);\r\n  }\r\n  \r\n  // ========== å°è©±æ“ä½œ ==========\r\n  \r\n  sendMessage(content: string): void {\r\n    if (!content.trim() || this._isGenerating()) return;\r\n    \r\n    // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯\r\n    this.addMessage('user', content.trim());\r\n    \r\n    // ç™¼é€åˆ°å¾Œç«¯\r\n    this._isGenerating.set(true);\r\n    \r\n    this.ipc.send('generate-ai-response', {\r\n      prompt: content.trim(),\r\n      settings: this._settings(),\r\n      history: this.currentMessages().slice(-10),\r\n      enableRag: this._settings().enableRag\r\n    });\r\n  }\r\n  \r\n  private addMessage(role: 'user' | 'assistant' | 'system', content: string, tokens?: number): void {\r\n    const message: ChatMessage = {\r\n      id: crypto.randomUUID(),\r\n      role,\r\n      content,\r\n      timestamp: new Date().toISOString(),\r\n      tokens\r\n    };\r\n    \r\n    this._currentSession.update(session => {\r\n      if (!session) {\r\n        // å‰µå»ºæ–°æœƒè©±\r\n        return {\r\n          id: crypto.randomUUID(),\r\n          title: content.slice(0, 30) + (content.length > 30 ? '...' : ''),\r\n          messages: [message],\r\n          createdAt: new Date().toISOString(),\r\n          updatedAt: new Date().toISOString()\r\n        };\r\n      }\r\n      \r\n      return {\r\n        ...session,\r\n        messages: [...session.messages, message],\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n    });\r\n  }\r\n  \r\n  // ========== æœƒè©±ç®¡ç† ==========\r\n  \r\n  newSession(): void {\r\n    // ä¿å­˜ç•¶å‰æœƒè©±\r\n    const current = this._currentSession();\r\n    if (current && current.messages.length > 0) {\r\n      this.saveSession(current);\r\n    }\r\n    \r\n    this._currentSession.set(null);\r\n  }\r\n  \r\n  loadSession(sessionId: string): void {\r\n    const session = this._sessions().find(s => s.id === sessionId);\r\n    if (session) {\r\n      this._currentSession.set(session);\r\n    }\r\n  }\r\n  \r\n  saveSession(session: ChatSession): void {\r\n    this.ipc.send('save-chat-session', session);\r\n    \r\n    this._sessions.update(sessions => {\r\n      const index = sessions.findIndex(s => s.id === session.id);\r\n      if (index >= 0) {\r\n        sessions[index] = session;\r\n        return [...sessions];\r\n      }\r\n      return [session, ...sessions];\r\n    });\r\n  }\r\n  \r\n  deleteSession(sessionId: string): void {\r\n    if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å°è©±å—ï¼Ÿ')) {\r\n      this.ipc.send('delete-chat-session', { sessionId });\r\n      this._sessions.update(sessions => \r\n        sessions.filter(s => s.id !== sessionId)\r\n      );\r\n      \r\n      if (this._currentSession()?.id === sessionId) {\r\n        this._currentSession.set(null);\r\n      }\r\n      \r\n      this.toast.success('å°è©±å·²åˆªé™¤');\r\n    }\r\n  }\r\n  \r\n  clearHistory(): void {\r\n    if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å°è©±è¨˜éŒ„å—ï¼Ÿ')) {\r\n      this.ipc.send('clear-chat-history');\r\n      this._sessions.set([]);\r\n      this._currentSession.set(null);\r\n      this.toast.success('å°è©±è¨˜éŒ„å·²æ¸…ç©º');\r\n    }\r\n  }\r\n  \r\n  // ========== RAG æ“ä½œ ==========\r\n  \r\n  loadRagDocuments(): void {\r\n    this.ipc.send('get-rag-documents');\r\n  }\r\n  \r\n  addRagDocument(doc: Omit<RagDocument, 'id' | 'embedding'>): void {\r\n    this.ipc.send('add-rag-document', doc);\r\n    this.toast.info('æ­£åœ¨æ·»åŠ æ–‡æª”...');\r\n  }\r\n  \r\n  deleteRagDocument(docId: string): void {\r\n    if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ–‡æª”å—ï¼Ÿ')) {\r\n      this.ipc.send('delete-rag-document', { docId });\r\n      this._ragDocuments.update(docs => \r\n        docs.filter(d => d.id !== docId)\r\n      );\r\n      this.toast.success('æ–‡æª”å·²åˆªé™¤');\r\n    }\r\n  }\r\n  \r\n  // ========== é€£æ¥æ¸¬è©¦ ==========\r\n  \r\n  testConnection(): void {\r\n    this.ipc.send('test-ai-connection', this._settings());\r\n    this.toast.info('æ­£åœ¨æ¸¬è©¦ AI é€£æ¥...');\r\n  }\r\n  \r\n  // ========== å¿«æ·åŠŸèƒ½ ==========\r\n  \r\n  generateGreeting(context?: any): void {\r\n    const prompt = `ç”Ÿæˆä¸€æ¢å‹å¥½çš„å•å€™æ¶ˆæ¯ï¼Œç”¨æ–¼ Telegram ç¾¤çµ„ã€‚${\r\n      context ? `èƒŒæ™¯ä¿¡æ¯: ${JSON.stringify(context)}` : ''\r\n    }`;\r\n    \r\n    this.sendMessage(prompt);\r\n  }\r\n  \r\n  generateReply(originalMessage: string, context?: any): void {\r\n    const prompt = `è«‹é‡å°ä»¥ä¸‹æ¶ˆæ¯ç”Ÿæˆä¸€æ¢å°ˆæ¥­çš„å›å¾©ï¼š\r\n    \r\nåŸæ¶ˆæ¯ï¼š${originalMessage}\r\n${context ? `èƒŒæ™¯ä¿¡æ¯: ${JSON.stringify(context)}` : ''}\r\n\r\nè«‹ç”Ÿæˆç°¡æ½”ã€å°ˆæ¥­çš„å›å¾©ã€‚`;\r\n    \r\n    this.sendMessage(prompt);\r\n  }\r\n  \r\n  summarizeConversation(): void {\r\n    const messages = this.currentMessages();\r\n    if (messages.length < 2) {\r\n      this.toast.warning('å°è©±å…§å®¹å¤ªå°‘ï¼Œç„¡æ³•ç”Ÿæˆæ‘˜è¦');\r\n      return;\r\n    }\r\n    \r\n    const conversation = messages\r\n      .map(m => `${m.role === 'user' ? 'ç”¨æˆ¶' : 'AI'}ï¼š${m.content}`)\r\n      .join('\\n');\r\n    \r\n    const prompt = `è«‹ç¸½çµä»¥ä¸‹å°è©±çš„ä¸»è¦å…§å®¹ï¼š\\n\\n${conversation}`;\r\n    this.sendMessage(prompt);\r\n  }\r\n}\r\n","/**\r\n * è³‡æºæœå‹™\r\n * Resource Service\r\n * \r\n * ğŸ†• Phase 25: å¾ app.component.ts æå–è³‡æºç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport type ResourceType = 'group' | 'channel' | 'user' | 'bot';\r\nexport type ResourceStatus = 'discovered' | 'joined' | 'monitored' | 'left';\r\n\r\nexport interface Resource {\r\n  id: number;\r\n  telegram_id?: number;\r\n  title: string;\r\n  username?: string;\r\n  type: ResourceType;\r\n  status: ResourceStatus;\r\n  member_count?: number;\r\n  description?: string;\r\n  is_public?: boolean;\r\n  discovered_at: string;\r\n  joined_at?: string;\r\n  last_activity?: string;\r\n  tags?: string[];\r\n}\r\n\r\nexport interface ResourceFilter {\r\n  type?: ResourceType | 'all';\r\n  status?: ResourceStatus | 'all';\r\n  search?: string;\r\n  hasMembers?: boolean;\r\n  isPublic?: boolean;\r\n}\r\n\r\nexport interface ResourceStats {\r\n  total: number;\r\n  byType: Record<ResourceType, number>;\r\n  byStatus: Record<ResourceStatus, number>;\r\n  totalMembers: number;\r\n}\r\n\r\nexport interface SearchQuery {\r\n  keyword: string;\r\n  type: 'group' | 'channel' | 'both';\r\n  limit: number;\r\n  includePrivate: boolean;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ResourceService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _resources = signal<Resource[]>([]);\r\n  private _selectedIds = signal<Set<number>>(new Set());\r\n  private _filter = signal<ResourceFilter>({ type: 'all', status: 'all' });\r\n  private _isLoading = signal(false);\r\n  private _searchResults = signal<Resource[]>([]);\r\n  private _isSearching = signal(false);\r\n  \r\n  resources = this._resources.asReadonly();\r\n  selectedIds = this._selectedIds.asReadonly();\r\n  filter = this._filter.asReadonly();\r\n  isLoading = this._isLoading.asReadonly();\r\n  searchResults = this._searchResults.asReadonly();\r\n  isSearching = this._isSearching.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  \r\n  filteredResources = computed(() => {\r\n    const resources = this._resources();\r\n    const filter = this._filter();\r\n    \r\n    return resources.filter(r => {\r\n      if (filter.type && filter.type !== 'all' && r.type !== filter.type) {\r\n        return false;\r\n      }\r\n      \r\n      if (filter.status && filter.status !== 'all' && r.status !== filter.status) {\r\n        return false;\r\n      }\r\n      \r\n      if (filter.search) {\r\n        const search = filter.search.toLowerCase();\r\n        const matchTitle = r.title?.toLowerCase().includes(search);\r\n        const matchUsername = r.username?.toLowerCase().includes(search);\r\n        if (!matchTitle && !matchUsername) return false;\r\n      }\r\n      \r\n      if (filter.hasMembers !== undefined) {\r\n        if (filter.hasMembers && !r.member_count) return false;\r\n        if (!filter.hasMembers && r.member_count) return false;\r\n      }\r\n      \r\n      if (filter.isPublic !== undefined && r.is_public !== filter.isPublic) {\r\n        return false;\r\n      }\r\n      \r\n      return true;\r\n    });\r\n  });\r\n  \r\n  stats = computed((): ResourceStats => {\r\n    const resources = this._resources();\r\n    \r\n    const byType: Record<ResourceType, number> = {\r\n      'group': 0, 'channel': 0, 'user': 0, 'bot': 0\r\n    };\r\n    \r\n    const byStatus: Record<ResourceStatus, number> = {\r\n      'discovered': 0, 'joined': 0, 'monitored': 0, 'left': 0\r\n    };\r\n    \r\n    let totalMembers = 0;\r\n    \r\n    for (const r of resources) {\r\n      if (byType[r.type] !== undefined) byType[r.type]++;\r\n      if (byStatus[r.status] !== undefined) byStatus[r.status]++;\r\n      totalMembers += r.member_count || 0;\r\n    }\r\n    \r\n    return {\r\n      total: resources.length,\r\n      byType,\r\n      byStatus,\r\n      totalMembers\r\n    };\r\n  });\r\n  \r\n  selectedResources = computed(() => {\r\n    const ids = this._selectedIds();\r\n    return this._resources().filter(r => ids.has(r.id));\r\n  });\r\n  \r\n  selectedCount = computed(() => this._selectedIds().size);\r\n  \r\n  groups = computed(() => this._resources().filter(r => r.type === 'group'));\r\n  channels = computed(() => this._resources().filter(r => r.type === 'channel'));\r\n  joinedResources = computed(() => this._resources().filter(r => r.status === 'joined'));\r\n  monitoredResources = computed(() => this._resources().filter(r => r.status === 'monitored'));\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ========== IPC ç›£è½ ==========\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('resources-loaded', (data: Resource[]) => {\r\n      this._resources.set(data);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('resource-updated', (data: Resource) => {\r\n      this._resources.update(list => \r\n        list.map(r => r.id === data.id ? { ...r, ...data } : r)\r\n      );\r\n    });\r\n    \r\n    this.ipc.on('search-results', (data: Resource[]) => {\r\n      this._searchResults.set(data);\r\n      this._isSearching.set(false);\r\n    });\r\n    \r\n    this.ipc.on('search-error', (data: { error: string }) => {\r\n      this._isSearching.set(false);\r\n      this.toast.error(`æœç´¢å¤±æ•—: ${data.error}`);\r\n    });\r\n  }\r\n  \r\n  // ========== è³‡æºæ“ä½œ ==========\r\n  \r\n  loadResources(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-resources');\r\n  }\r\n  \r\n  refreshResources(): void {\r\n    this.ipc.send('refresh-resources');\r\n    this.toast.info('æ­£åœ¨åˆ·æ–°è³‡æº...');\r\n  }\r\n  \r\n  getResource(id: number): Resource | undefined {\r\n    return this._resources().find(r => r.id === id);\r\n  }\r\n  \r\n  updateResource(id: number, updates: Partial<Resource>): void {\r\n    this._resources.update(list =>\r\n      list.map(r => r.id === id ? { ...r, ...updates } : r)\r\n    );\r\n    \r\n    this.ipc.send('update-resource', { id, updates });\r\n  }\r\n  \r\n  deleteResource(id: number): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è³‡æºå—ï¼Ÿ')) return;\r\n    \r\n    this._resources.update(list => list.filter(r => r.id !== id));\r\n    this._selectedIds.update(ids => {\r\n      const newIds = new Set(ids);\r\n      newIds.delete(id);\r\n      return newIds;\r\n    });\r\n    \r\n    this.ipc.send('delete-resource', { id });\r\n    this.toast.success('è³‡æºå·²åˆªé™¤');\r\n  }\r\n  \r\n  // ========== é¸æ“‡æ“ä½œ ==========\r\n  \r\n  toggleSelection(id: number): void {\r\n    this._selectedIds.update(ids => {\r\n      const newIds = new Set(ids);\r\n      if (newIds.has(id)) {\r\n        newIds.delete(id);\r\n      } else {\r\n        newIds.add(id);\r\n      }\r\n      return newIds;\r\n    });\r\n  }\r\n  \r\n  selectAll(): void {\r\n    const ids = new Set(this.filteredResources().map(r => r.id));\r\n    this._selectedIds.set(ids);\r\n  }\r\n  \r\n  deselectAll(): void {\r\n    this._selectedIds.set(new Set());\r\n  }\r\n  \r\n  isSelected(id: number): boolean {\r\n    return this._selectedIds().has(id);\r\n  }\r\n  \r\n  // ========== éæ¿¾æ“ä½œ ==========\r\n  \r\n  setFilter(filter: Partial<ResourceFilter>): void {\r\n    this._filter.update(f => ({ ...f, ...filter }));\r\n  }\r\n  \r\n  clearFilter(): void {\r\n    this._filter.set({ type: 'all', status: 'all' });\r\n  }\r\n  \r\n  setSearch(search: string): void {\r\n    this._filter.update(f => ({ ...f, search }));\r\n  }\r\n  \r\n  // ========== æœç´¢æ“ä½œ ==========\r\n  \r\n  search(query: SearchQuery): void {\r\n    this._isSearching.set(true);\r\n    this._searchResults.set([]);\r\n    \r\n    this.ipc.send('search-resources', query);\r\n    this.toast.info('æ­£åœ¨æœç´¢...');\r\n  }\r\n  \r\n  clearSearchResults(): void {\r\n    this._searchResults.set([]);\r\n  }\r\n  \r\n  addSearchResultToResources(resource: Resource): void {\r\n    this._resources.update(list => {\r\n      if (list.some(r => r.telegram_id === resource.telegram_id)) {\r\n        return list;\r\n      }\r\n      return [...list, resource];\r\n    });\r\n  }\r\n  \r\n  // ========== æ‰¹é‡æ“ä½œ ==========\r\n  \r\n  batchJoin(phone: string): void {\r\n    const selected = this.selectedResources();\r\n    if (selected.length === 0) {\r\n      this.toast.warning('è«‹å…ˆé¸æ“‡è³‡æº');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('batch-join-resources', {\r\n      resourceIds: selected.map(r => r.id),\r\n      phone\r\n    });\r\n    \r\n    this.toast.info(`æ­£åœ¨åŠ å…¥ ${selected.length} å€‹è³‡æº...`);\r\n  }\r\n  \r\n  batchLeave(phone: string): void {\r\n    const selected = this.selectedResources();\r\n    if (selected.length === 0) {\r\n      this.toast.warning('è«‹å…ˆé¸æ“‡è³‡æº');\r\n      return;\r\n    }\r\n    \r\n    if (!confirm(`ç¢ºå®šè¦é›¢é–‹ ${selected.length} å€‹è³‡æºå—ï¼Ÿ`)) return;\r\n    \r\n    this.ipc.send('batch-leave-resources', {\r\n      resourceIds: selected.map(r => r.id),\r\n      phone\r\n    });\r\n    \r\n    this.toast.info(`æ­£åœ¨é›¢é–‹ ${selected.length} å€‹è³‡æº...`);\r\n  }\r\n  \r\n  batchDelete(): void {\r\n    const selected = this.selectedResources();\r\n    if (selected.length === 0) {\r\n      this.toast.warning('è«‹å…ˆé¸æ“‡è³‡æº');\r\n      return;\r\n    }\r\n    \r\n    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ ${selected.length} å€‹è³‡æºå—ï¼Ÿ`)) return;\r\n    \r\n    const ids = selected.map(r => r.id);\r\n    this._resources.update(list => list.filter(r => !ids.includes(r.id)));\r\n    this._selectedIds.set(new Set());\r\n    \r\n    this.ipc.send('batch-delete-resources', { resourceIds: ids });\r\n    this.toast.success(`å·²åˆªé™¤ ${selected.length} å€‹è³‡æº`);\r\n  }\r\n  \r\n  // ========== æ¨™ç±¤æ“ä½œ ==========\r\n  \r\n  addTag(resourceId: number, tag: string): void {\r\n    this._resources.update(list =>\r\n      list.map(r => {\r\n        if (r.id === resourceId) {\r\n          const tags = r.tags || [];\r\n          if (!tags.includes(tag)) {\r\n            return { ...r, tags: [...tags, tag] };\r\n          }\r\n        }\r\n        return r;\r\n      })\r\n    );\r\n    \r\n    this.ipc.send('add-resource-tag', { resourceId, tag });\r\n  }\r\n  \r\n  removeTag(resourceId: number, tag: string): void {\r\n    this._resources.update(list =>\r\n      list.map(r => {\r\n        if (r.id === resourceId && r.tags) {\r\n          return { ...r, tags: r.tags.filter(t => t !== tag) };\r\n        }\r\n        return r;\r\n      })\r\n    );\r\n    \r\n    this.ipc.send('remove-resource-tag', { resourceId, tag });\r\n  }\r\n}\r\n","/**\r\n * å°å‡ºæœå‹™\r\n * Export Service\r\n * \r\n * ğŸ†• Phase 25: å¾ app.component.ts æå–å°å‡ºç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport type ExportFormat = 'csv' | 'xlsx' | 'json' | 'pdf';\r\nexport type ExportType = 'leads' | 'members' | 'resources' | 'messages' | 'analytics' | 'report';\r\n\r\nexport interface ExportOptions {\r\n  format: ExportFormat;\r\n  type: ExportType;\r\n  filters?: Record<string, any>;\r\n  columns?: string[];\r\n  includeHeaders?: boolean;\r\n  dateRange?: {\r\n    start: string;\r\n    end: string;\r\n  };\r\n}\r\n\r\nexport interface ExportJob {\r\n  id: string;\r\n  type: ExportType;\r\n  format: ExportFormat;\r\n  status: 'pending' | 'processing' | 'completed' | 'failed';\r\n  progress: number;\r\n  filePath?: string;\r\n  error?: string;\r\n  createdAt: string;\r\n  completedAt?: string;\r\n}\r\n\r\nexport interface ExportTemplate {\r\n  id: string;\r\n  name: string;\r\n  type: ExportType;\r\n  options: Partial<ExportOptions>;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExportService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _jobs = signal<ExportJob[]>([]);\r\n  private _currentJob = signal<ExportJob | null>(null);\r\n  private _templates = signal<ExportTemplate[]>([]);\r\n  private _isExporting = signal(false);\r\n  \r\n  jobs = this._jobs.asReadonly();\r\n  currentJob = this._currentJob.asReadonly();\r\n  templates = this._templates.asReadonly();\r\n  isExporting = this._isExporting.asReadonly();\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n    this.loadTemplates();\r\n  }\r\n  \r\n  // ========== IPC ç›£è½ ==========\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('export-started', (job: ExportJob) => {\r\n      this._currentJob.set(job);\r\n      this._jobs.update(jobs => [job, ...jobs]);\r\n      this._isExporting.set(true);\r\n    });\r\n    \r\n    this.ipc.on('export-progress', (data: { jobId: string; progress: number }) => {\r\n      this._jobs.update(jobs =>\r\n        jobs.map(j => j.id === data.jobId ? { ...j, progress: data.progress } : j)\r\n      );\r\n      \r\n      if (this._currentJob()?.id === data.jobId) {\r\n        this._currentJob.update(j => j ? { ...j, progress: data.progress } : j);\r\n      }\r\n    });\r\n    \r\n    this.ipc.on('export-completed', (data: { jobId: string; filePath: string }) => {\r\n      this._jobs.update(jobs =>\r\n        jobs.map(j => j.id === data.jobId ? {\r\n          ...j,\r\n          status: 'completed' as const,\r\n          progress: 100,\r\n          filePath: data.filePath,\r\n          completedAt: new Date().toISOString()\r\n        } : j)\r\n      );\r\n      \r\n      this._currentJob.set(null);\r\n      this._isExporting.set(false);\r\n      this.toast.success('å°å‡ºå®Œæˆï¼');\r\n    });\r\n    \r\n    this.ipc.on('export-failed', (data: { jobId: string; error: string }) => {\r\n      this._jobs.update(jobs =>\r\n        jobs.map(j => j.id === data.jobId ? {\r\n          ...j,\r\n          status: 'failed' as const,\r\n          error: data.error\r\n        } : j)\r\n      );\r\n      \r\n      this._currentJob.set(null);\r\n      this._isExporting.set(false);\r\n      this.toast.error(`å°å‡ºå¤±æ•—: ${data.error}`);\r\n    });\r\n  }\r\n  \r\n  // ========== å°å‡ºæ“ä½œ ==========\r\n  \r\n  /**\r\n   * å°å‡ºç·šç´¢\r\n   */\r\n  exportLeads(format: ExportFormat = 'csv', options?: Partial<ExportOptions>): void {\r\n    this.startExport({\r\n      format,\r\n      type: 'leads',\r\n      includeHeaders: true,\r\n      ...options\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å°å‡ºæˆå“¡\r\n   */\r\n  exportMembers(resourceId: number, format: ExportFormat = 'csv', options?: Partial<ExportOptions>): void {\r\n    this.startExport({\r\n      format,\r\n      type: 'members',\r\n      filters: { resourceId },\r\n      includeHeaders: true,\r\n      ...options\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å°å‡ºè³‡æºåˆ—è¡¨\r\n   */\r\n  exportResources(format: ExportFormat = 'csv', options?: Partial<ExportOptions>): void {\r\n    this.startExport({\r\n      format,\r\n      type: 'resources',\r\n      includeHeaders: true,\r\n      ...options\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å°å‡ºæ¶ˆæ¯è¨˜éŒ„\r\n   */\r\n  exportMessages(format: ExportFormat = 'json', options?: Partial<ExportOptions>): void {\r\n    this.startExport({\r\n      format,\r\n      type: 'messages',\r\n      ...options\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å°å‡ºåˆ†ææ•¸æ“š\r\n   */\r\n  exportAnalytics(format: ExportFormat = 'xlsx', options?: Partial<ExportOptions>): void {\r\n    this.startExport({\r\n      format,\r\n      type: 'analytics',\r\n      ...options\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å°å‡ºå ±å‘Š\r\n   */\r\n  exportReport(type: 'daily' | 'weekly' | 'monthly', format: ExportFormat = 'pdf'): void {\r\n    this.startExport({\r\n      format,\r\n      type: 'report',\r\n      filters: { reportType: type }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * é–‹å§‹å°å‡º\r\n   */\r\n  private startExport(options: ExportOptions): void {\r\n    if (this._isExporting()) {\r\n      this.toast.warning('æ­£åœ¨é€²è¡Œå°å‡ºï¼Œè«‹ç­‰å¾…å®Œæˆ');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('start-export', options);\r\n    this.toast.info('é–‹å§‹å°å‡º...');\r\n  }\r\n  \r\n  // ========== ä»»å‹™ç®¡ç† ==========\r\n  \r\n  /**\r\n   * å–æ¶ˆç•¶å‰å°å‡º\r\n   */\r\n  cancelExport(): void {\r\n    const job = this._currentJob();\r\n    if (!job) return;\r\n    \r\n    this.ipc.send('cancel-export', { jobId: job.id });\r\n    this._currentJob.set(null);\r\n    this._isExporting.set(false);\r\n    this.toast.info('å·²å–æ¶ˆå°å‡º');\r\n  }\r\n  \r\n  /**\r\n   * æ‰“é–‹å°å‡ºæ–‡ä»¶\r\n   */\r\n  openExportFile(job: ExportJob): void {\r\n    if (!job.filePath) {\r\n      this.toast.error('æ–‡ä»¶è·¯å¾‘ä¸å­˜åœ¨');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('open-file', { path: job.filePath });\r\n  }\r\n  \r\n  /**\r\n   * æ‰“é–‹å°å‡ºç›®éŒ„\r\n   */\r\n  openExportFolder(job: ExportJob): void {\r\n    if (!job.filePath) {\r\n      this.toast.error('æ–‡ä»¶è·¯å¾‘ä¸å­˜åœ¨');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('open-folder', { path: job.filePath });\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤å°å‡ºæ­·å²\r\n   */\r\n  clearHistory(): void {\r\n    if (!confirm('ç¢ºå®šè¦æ¸…é™¤å°å‡ºæ­·å²å—ï¼Ÿ')) return;\r\n    \r\n    this._jobs.set([]);\r\n    this.toast.success('å°å‡ºæ­·å²å·²æ¸…é™¤');\r\n  }\r\n  \r\n  /**\r\n   * åˆªé™¤å–®å€‹å°å‡ºè¨˜éŒ„\r\n   */\r\n  deleteJob(jobId: string): void {\r\n    this._jobs.update(jobs => jobs.filter(j => j.id !== jobId));\r\n  }\r\n  \r\n  // ========== æ¨¡æ¿ç®¡ç† ==========\r\n  \r\n  /**\r\n   * åŠ è¼‰æ¨¡æ¿\r\n   */\r\n  loadTemplates(): void {\r\n    try {\r\n      const saved = localStorage.getItem('export-templates');\r\n      if (saved) {\r\n        this._templates.set(JSON.parse(saved));\r\n      }\r\n    } catch (e) {\r\n      // å¿½ç•¥éŒ¯èª¤\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ä¿å­˜æ¨¡æ¿\r\n   */\r\n  saveTemplate(template: Omit<ExportTemplate, 'id'>): void {\r\n    const newTemplate: ExportTemplate = {\r\n      ...template,\r\n      id: crypto.randomUUID()\r\n    };\r\n    \r\n    this._templates.update(templates => [...templates, newTemplate]);\r\n    this.saveTemplatesToStorage();\r\n    this.toast.success('æ¨¡æ¿å·²ä¿å­˜');\r\n  }\r\n  \r\n  /**\r\n   * åˆªé™¤æ¨¡æ¿\r\n   */\r\n  deleteTemplate(templateId: string): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ¨¡æ¿å—ï¼Ÿ')) return;\r\n    \r\n    this._templates.update(templates => \r\n      templates.filter(t => t.id !== templateId)\r\n    );\r\n    this.saveTemplatesToStorage();\r\n    this.toast.success('æ¨¡æ¿å·²åˆªé™¤');\r\n  }\r\n  \r\n  /**\r\n   * ä½¿ç”¨æ¨¡æ¿å°å‡º\r\n   */\r\n  useTemplate(templateId: string): void {\r\n    const template = this._templates().find(t => t.id === templateId);\r\n    if (!template) {\r\n      this.toast.error('æ¨¡æ¿ä¸å­˜åœ¨');\r\n      return;\r\n    }\r\n    \r\n    this.startExport({\r\n      format: template.options.format || 'csv',\r\n      type: template.type,\r\n      ...template.options\r\n    });\r\n  }\r\n  \r\n  private saveTemplatesToStorage(): void {\r\n    try {\r\n      localStorage.setItem('export-templates', JSON.stringify(this._templates()));\r\n    } catch (e) {\r\n      // å¿½ç•¥éŒ¯èª¤\r\n    }\r\n  }\r\n  \r\n  // ========== å·¥å…·æ–¹æ³• ==========\r\n  \r\n  /**\r\n   * ç²å–æ ¼å¼åœ–æ¨™\r\n   */\r\n  getFormatIcon(format: ExportFormat): string {\r\n    const icons: Record<ExportFormat, string> = {\r\n      'csv': 'ğŸ“Š',\r\n      'xlsx': 'ğŸ“—',\r\n      'json': 'ğŸ“‹',\r\n      'pdf': 'ğŸ“•'\r\n    };\r\n    return icons[format] || 'ğŸ“„';\r\n  }\r\n  \r\n  /**\r\n   * ç²å–æ ¼å¼åç¨±\r\n   */\r\n  getFormatName(format: ExportFormat): string {\r\n    const names: Record<ExportFormat, string> = {\r\n      'csv': 'CSV',\r\n      'xlsx': 'Excel',\r\n      'json': 'JSON',\r\n      'pdf': 'PDF'\r\n    };\r\n    return names[format] || format.toUpperCase();\r\n  }\r\n  \r\n  /**\r\n   * ç²å–é¡å‹åç¨±\r\n   */\r\n  getTypeName(type: ExportType): string {\r\n    const names: Record<ExportType, string> = {\r\n      'leads': 'ç·šç´¢',\r\n      'members': 'æˆå“¡',\r\n      'resources': 'è³‡æº',\r\n      'messages': 'æ¶ˆæ¯',\r\n      'analytics': 'åˆ†æ',\r\n      'report': 'å ±å‘Š'\r\n    };\r\n    return names[type] || type;\r\n  }\r\n}\r\n","/**\r\n * å‚™ä»½æœå‹™\r\n * Backup Service\r\n * \r\n * ğŸ†• Phase 26: å¾ app.component.ts æå–å‚™ä»½ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport interface Backup {\r\n  id: string;\r\n  name: string;\r\n  created_at: string;\r\n  size?: string;\r\n  type: 'manual' | 'auto';\r\n  description?: string;\r\n}\r\n\r\nexport interface BackupSettings {\r\n  autoBackup: boolean;\r\n  interval: number; // å°æ™‚\r\n  maxBackups: number;\r\n  includeMedia: boolean;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class BackupService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _backups = signal<Backup[]>([]);\r\n  private _isLoading = signal(false);\r\n  private _isCreating = signal(false);\r\n  private _isRestoring = signal(false);\r\n  private _settings = signal<BackupSettings>({\r\n    autoBackup: false,\r\n    interval: 24,\r\n    maxBackups: 10,\r\n    includeMedia: false\r\n  });\r\n  \r\n  backups = this._backups.asReadonly();\r\n  isLoading = this._isLoading.asReadonly();\r\n  isCreating = this._isCreating.asReadonly();\r\n  isRestoring = this._isRestoring.asReadonly();\r\n  settings = this._settings.asReadonly();\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ========== IPC ç›£è½ ==========\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('backups-loaded', (data: Backup[]) => {\r\n      this._backups.set(data);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('backup-created', (data: Backup) => {\r\n      this._backups.update(list => [data, ...list]);\r\n      this._isCreating.set(false);\r\n      this.toast.success('å‚™ä»½å‰µå»ºæˆåŠŸï¼');\r\n    });\r\n    \r\n    this.ipc.on('backup-create-error', (data: { error: string }) => {\r\n      this._isCreating.set(false);\r\n      this.toast.error(`å‚™ä»½å‰µå»ºå¤±æ•—: ${data.error}`);\r\n    });\r\n    \r\n    this.ipc.on('backup-restored', () => {\r\n      this._isRestoring.set(false);\r\n      this.toast.success('å‚™ä»½æ¢å¾©æˆåŠŸï¼æ‡‰ç”¨å°‡é‡æ–°åŠ è¼‰...');\r\n      setTimeout(() => window.location.reload(), 2000);\r\n    });\r\n    \r\n    this.ipc.on('backup-restore-error', (data: { error: string }) => {\r\n      this._isRestoring.set(false);\r\n      this.toast.error(`å‚™ä»½æ¢å¾©å¤±æ•—: ${data.error}`);\r\n    });\r\n    \r\n    this.ipc.on('backup-deleted', (data: { id: string }) => {\r\n      this._backups.update(list => list.filter(b => b.id !== data.id));\r\n      this.toast.success('å‚™ä»½å·²åˆªé™¤');\r\n    });\r\n    \r\n    this.ipc.on('backup-settings-loaded', (data: BackupSettings) => {\r\n      this._settings.set(data);\r\n    });\r\n  }\r\n  \r\n  // ========== å‚™ä»½æ“ä½œ ==========\r\n  \r\n  loadBackups(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-backups');\r\n  }\r\n  \r\n  createBackup(description?: string): void {\r\n    this._isCreating.set(true);\r\n    this.ipc.send('create-backup', { description });\r\n  }\r\n  \r\n  restoreBackup(id: string): void {\r\n    if (!confirm('ç¢ºå®šè¦æ¢å¾©æ­¤å‚™ä»½å—ï¼Ÿç•¶å‰æ•¸æ“šå°‡è¢«è¦†è“‹ã€‚')) {\r\n      return;\r\n    }\r\n    \r\n    this._isRestoring.set(true);\r\n    this.ipc.send('restore-backup', { id });\r\n  }\r\n  \r\n  deleteBackup(id: string): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å‚™ä»½å—ï¼Ÿ')) {\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('delete-backup', { id });\r\n  }\r\n  \r\n  // ========== è¨­ç½®æ“ä½œ ==========\r\n  \r\n  loadSettings(): void {\r\n    this.ipc.send('get-backup-settings');\r\n  }\r\n  \r\n  updateSettings(settings: Partial<BackupSettings>): void {\r\n    this._settings.update(s => ({ ...s, ...settings }));\r\n    this.ipc.send('save-backup-settings', this._settings());\r\n    this.toast.success('å‚™ä»½è¨­ç½®å·²ä¿å­˜');\r\n  }\r\n  \r\n  toggleAutoBackup(): void {\r\n    this.updateSettings({ autoBackup: !this._settings().autoBackup });\r\n  }\r\n  \r\n  // ========== å·¥å…·æ–¹æ³• ==========\r\n  \r\n  formatSize(bytes: number): string {\r\n    if (bytes < 1024) return `${bytes} B`;\r\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\r\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\r\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(2)} GB`;\r\n  }\r\n  \r\n  getBackupAge(createdAt: string): string {\r\n    const created = new Date(createdAt);\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - created.getTime();\r\n    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n    \r\n    if (diffDays === 0) return 'ä»Šå¤©';\r\n    if (diffDays === 1) return 'æ˜¨å¤©';\r\n    if (diffDays < 7) return `${diffDays} å¤©å‰`;\r\n    if (diffDays < 30) return `${Math.floor(diffDays / 7)} é€±å‰`;\r\n    return `${Math.floor(diffDays / 30)} å€‹æœˆå‰`;\r\n  }\r\n}\r\n","/**\r\n * ä»»å‹™èª¿åº¦æœå‹™\r\n * Scheduler Service\r\n * \r\n * ğŸ†• Phase 26: å¾ app.component.ts æå–èª¿åº¦ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport interface ScheduledTask {\r\n  name: string;\r\n  description?: string;\r\n  interval: number; // ç§’\r\n  lastRun: string | null;\r\n  nextRun: string | null;\r\n  runCount: number;\r\n  status: 'running' | 'idle' | 'error' | 'disabled';\r\n  enabled: boolean;\r\n  errorMessage?: string;\r\n}\r\n\r\nexport interface SchedulerStatus {\r\n  isRunning: boolean;\r\n  uptime: number; // ç§’\r\n  totalTasks: number;\r\n  activeTasks: number;\r\n  tasks: ScheduledTask[];\r\n}\r\n\r\nexport interface SchedulerLog {\r\n  id: string;\r\n  taskName: string;\r\n  timestamp: string;\r\n  type: 'start' | 'complete' | 'error' | 'skip';\r\n  message: string;\r\n  duration?: number;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SchedulerService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _status = signal<SchedulerStatus>({\r\n    isRunning: false,\r\n    uptime: 0,\r\n    totalTasks: 0,\r\n    activeTasks: 0,\r\n    tasks: []\r\n  });\r\n  private _logs = signal<SchedulerLog[]>([]);\r\n  private _isLoading = signal(false);\r\n  \r\n  status = this._status.asReadonly();\r\n  logs = this._logs.asReadonly();\r\n  isLoading = this._isLoading.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  \r\n  isRunning = computed(() => this._status().isRunning);\r\n  tasks = computed(() => this._status().tasks);\r\n  activeTasks = computed(() => this._status().tasks.filter(t => t.status === 'running'));\r\n  idleTasks = computed(() => this._status().tasks.filter(t => t.status === 'idle'));\r\n  errorTasks = computed(() => this._status().tasks.filter(t => t.status === 'error'));\r\n  \r\n  uptimeFormatted = computed(() => {\r\n    const seconds = this._status().uptime;\r\n    const hours = Math.floor(seconds / 3600);\r\n    const minutes = Math.floor((seconds % 3600) / 60);\r\n    const secs = seconds % 60;\r\n    \r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    }\r\n    if (minutes > 0) {\r\n      return `${minutes}m ${secs}s`;\r\n    }\r\n    return `${secs}s`;\r\n  });\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ========== IPC ç›£è½ ==========\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('scheduler-status', (data: SchedulerStatus) => {\r\n      this._status.set(data);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('scheduler-started', () => {\r\n      this._status.update(s => ({ ...s, isRunning: true }));\r\n      this.toast.success('èª¿åº¦å™¨å·²å•Ÿå‹•');\r\n    });\r\n    \r\n    this.ipc.on('scheduler-stopped', () => {\r\n      this._status.update(s => ({ ...s, isRunning: false }));\r\n      this.toast.info('èª¿åº¦å™¨å·²åœæ­¢');\r\n    });\r\n    \r\n    this.ipc.on('scheduler-task-started', (data: { taskName: string }) => {\r\n      this._status.update(s => ({\r\n        ...s,\r\n        tasks: s.tasks.map(t => \r\n          t.name === data.taskName ? { ...t, status: 'running' as const } : t\r\n        )\r\n      }));\r\n    });\r\n    \r\n    this.ipc.on('scheduler-task-completed', (data: { taskName: string; duration: number }) => {\r\n      this._status.update(s => ({\r\n        ...s,\r\n        tasks: s.tasks.map(t => \r\n          t.name === data.taskName ? { \r\n            ...t, \r\n            status: 'idle' as const,\r\n            lastRun: new Date().toISOString(),\r\n            runCount: t.runCount + 1\r\n          } : t\r\n        )\r\n      }));\r\n    });\r\n    \r\n    this.ipc.on('scheduler-task-error', (data: { taskName: string; error: string }) => {\r\n      this._status.update(s => ({\r\n        ...s,\r\n        tasks: s.tasks.map(t => \r\n          t.name === data.taskName ? { \r\n            ...t, \r\n            status: 'error' as const,\r\n            errorMessage: data.error\r\n          } : t\r\n        )\r\n      }));\r\n      this.toast.error(`ä»»å‹™ ${data.taskName} åŸ·è¡Œå¤±æ•—`);\r\n    });\r\n    \r\n    this.ipc.on('scheduler-logs', (data: SchedulerLog[]) => {\r\n      this._logs.set(data);\r\n    });\r\n  }\r\n  \r\n  // ========== èª¿åº¦å™¨æ“ä½œ ==========\r\n  \r\n  loadStatus(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-scheduler-status');\r\n  }\r\n  \r\n  start(): void {\r\n    this.ipc.send('start-scheduler');\r\n  }\r\n  \r\n  stop(): void {\r\n    this.ipc.send('stop-scheduler');\r\n  }\r\n  \r\n  restart(): void {\r\n    this.ipc.send('restart-scheduler');\r\n    this.toast.info('æ­£åœ¨é‡å•Ÿèª¿åº¦å™¨...');\r\n  }\r\n  \r\n  // ========== ä»»å‹™æ“ä½œ ==========\r\n  \r\n  runTask(taskName: string): void {\r\n    this.ipc.send('run-scheduler-task', { taskName });\r\n    this.toast.info(`æ­£åœ¨åŸ·è¡Œä»»å‹™: ${taskName}`);\r\n  }\r\n  \r\n  enableTask(taskName: string): void {\r\n    this.ipc.send('enable-scheduler-task', { taskName });\r\n    this._status.update(s => ({\r\n      ...s,\r\n      tasks: s.tasks.map(t => \r\n        t.name === taskName ? { ...t, enabled: true, status: 'idle' as const } : t\r\n      )\r\n    }));\r\n  }\r\n  \r\n  disableTask(taskName: string): void {\r\n    this.ipc.send('disable-scheduler-task', { taskName });\r\n    this._status.update(s => ({\r\n      ...s,\r\n      tasks: s.tasks.map(t => \r\n        t.name === taskName ? { ...t, enabled: false, status: 'disabled' as const } : t\r\n      )\r\n    }));\r\n  }\r\n  \r\n  updateTaskInterval(taskName: string, interval: number): void {\r\n    this.ipc.send('update-task-interval', { taskName, interval });\r\n    this._status.update(s => ({\r\n      ...s,\r\n      tasks: s.tasks.map(t => \r\n        t.name === taskName ? { ...t, interval } : t\r\n      )\r\n    }));\r\n    this.toast.success('ä»»å‹™é–“éš”å·²æ›´æ–°');\r\n  }\r\n  \r\n  // ========== æ—¥èªŒæ“ä½œ ==========\r\n  \r\n  loadLogs(limit: number = 100): void {\r\n    this.ipc.send('get-scheduler-logs', { limit });\r\n  }\r\n  \r\n  clearLogs(): void {\r\n    if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰èª¿åº¦æ—¥èªŒå—ï¼Ÿ')) return;\r\n    this.ipc.send('clear-scheduler-logs');\r\n    this._logs.set([]);\r\n    this.toast.success('èª¿åº¦æ—¥èªŒå·²æ¸…é™¤');\r\n  }\r\n  \r\n  // ========== å·¥å…·æ–¹æ³• ==========\r\n  \r\n  getTaskStatusColor(status: ScheduledTask['status']): string {\r\n    switch (status) {\r\n      case 'running': return 'text-green-400';\r\n      case 'idle': return 'text-slate-400';\r\n      case 'error': return 'text-red-400';\r\n      case 'disabled': return 'text-slate-600';\r\n      default: return 'text-slate-400';\r\n    }\r\n  }\r\n  \r\n  getTaskStatusIcon(status: ScheduledTask['status']): string {\r\n    switch (status) {\r\n      case 'running': return 'ğŸŸ¢';\r\n      case 'idle': return 'âšª';\r\n      case 'error': return 'ğŸ”´';\r\n      case 'disabled': return 'âš«';\r\n      default: return 'âšª';\r\n    }\r\n  }\r\n  \r\n  formatInterval(seconds: number): string {\r\n    if (seconds < 60) return `${seconds} ç§’`;\r\n    if (seconds < 3600) return `${Math.floor(seconds / 60)} åˆ†é˜`;\r\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)} å°æ™‚`;\r\n    return `${Math.floor(seconds / 86400)} å¤©`;\r\n  }\r\n}\r\n","/**\n * æ‡‰ç”¨ç‹€æ…‹ç®¡ç†æœå‹™\n * App State Management Service\n * \n * é›†ä¸­ç®¡ç†æ‡‰ç”¨æ ¸å¿ƒç‹€æ…‹ï¼Œæ¸›å°‘ app.component.ts çš„è¤‡é›œåº¦\n */\n\nimport { Injectable, signal, computed, inject } from '@angular/core';\nimport { TelegramAccount, MonitoredGroup, KeywordSet, MessageTemplate } from '../models';\n\n// ============ è¦–åœ–é¡å‹ ============\n\nexport type AppView = \n  | 'dashboard' \n  | 'accounts' \n  | 'add-account' \n  | 'api-credentials' \n  | 'resources' \n  | 'member-database' \n  | 'resource-center' \n  | 'search-discovery' \n  | 'ai-assistant' \n  | 'automation' \n  | 'automation-legacy' \n  | 'leads' \n  | 'lead-nurturing' \n  | 'nurturing-analytics' \n  | 'ads' \n  | 'user-tracking' \n  | 'campaigns' \n  | 'multi-role' \n  | 'ai-team' \n  | 'ai-center' \n  | 'settings' \n  | 'analytics' \n  | 'analytics-center' \n  | 'logs' \n  | 'performance' \n  | 'alerts' \n  | 'profile' \n  | 'membership-center' \n  | 'monitoring-accounts' \n  | 'monitoring-groups' \n  | 'keyword-sets' \n  | 'chat-templates' \n  | 'trigger-rules' \n  | 'collected-users';\n\nexport type ConnectionState = 'connecting' | 'connected' | 'timeout' | 'error';\n\n// ============ å°èˆªæ¨¡çµ„å®šç¾© ============\n\nexport interface NavModule {\n  id: string;\n  name: string;\n  icon: string;\n  views: NavView[];\n  badge?: number;\n}\n\nexport interface NavView {\n  id: AppView;\n  name: string;\n  icon: string;\n  badge?: number;\n}\n\n// ============ æœå‹™å¯¦ç¾ ============\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AppStateService {\n  \n  // ========== é€£æ¥ç‹€æ…‹ ==========\n  private _backendConnectionState = signal<ConnectionState>('connecting');\n  private _backendConnectionMessage = signal('æ­£åœ¨é€£æ¥å¾Œç«¯æœå‹™...');\n  private _backendConnectionProgress = signal(0);\n  \n  backendConnectionState = this._backendConnectionState.asReadonly();\n  backendConnectionMessage = this._backendConnectionMessage.asReadonly();\n  backendConnectionProgress = this._backendConnectionProgress.asReadonly();\n  \n  isConnected = computed(() => this._backendConnectionState() === 'connected');\n  \n  // ========== ç•¶å‰è¦–åœ– ==========\n  private _currentView = signal<AppView>('dashboard');\n  private _previousView = signal<AppView | null>(null);\n  private _sidebarCollapsed = signal(false);\n  \n  currentView = this._currentView.asReadonly();\n  previousView = this._previousView.asReadonly();\n  sidebarCollapsed = this._sidebarCollapsed.asReadonly();\n  \n  // ========== å¸³è™Ÿç‹€æ…‹ ==========\n  private _accounts = signal<TelegramAccount[]>([]);\n  private _selectedAccountId = signal<number | null>(null);\n  \n  accounts = this._accounts.asReadonly();\n  selectedAccountId = this._selectedAccountId.asReadonly();\n  \n  selectedAccount = computed(() => {\n    const id = this._selectedAccountId();\n    return id ? this._accounts().find(a => a.id === id) : null;\n  });\n  \n  onlineAccounts = computed(() => \n    this._accounts().filter(a => a.status === 'Online')\n  );\n  \n  accountStats = computed(() => {\n    const accounts = this._accounts();\n    return {\n      total: accounts.length,\n      online: accounts.filter(a => a.status === 'Online').length,\n      offline: accounts.filter(a => a.status === 'Offline').length,\n      error: accounts.filter(a => a.status === 'Error' || a.status === 'Banned').length\n    };\n  });\n  \n  // ========== ç›£æ§ç‹€æ…‹ ==========\n  private _groups = signal<MonitoredGroup[]>([]);\n  private _keywordSets = signal<KeywordSet[]>([]);\n  private _templates = signal<MessageTemplate[]>([]);\n  private _isMonitoring = signal(false);\n  \n  groups = this._groups.asReadonly();\n  keywordSets = this._keywordSets.asReadonly();\n  templates = this._templates.asReadonly();\n  isMonitoring = this._isMonitoring.asReadonly();\n  \n  monitoringStats = computed(() => {\n    const groups = this._groups();\n    const keywordSets = this._keywordSets();\n    return {\n      totalGroups: groups.length,\n      activeGroups: groups.filter(g => g.isActive).length,\n      totalKeywords: keywordSets.reduce((sum, ks) => sum + (ks.keywords?.length || 0), 0),\n      activeKeywordSets: keywordSets.filter(ks => ks.is_active).length\n    };\n  });\n  \n  // ========== Loading ç‹€æ…‹ ==========\n  private _isLoading = signal(false);\n  private _loadingMessage = signal('');\n  \n  isLoading = this._isLoading.asReadonly();\n  loadingMessage = this._loadingMessage.asReadonly();\n  \n  // ========== å°èˆªæ¨¡çµ„ ==========\n  readonly navModules: NavModule[] = [\n    {\n      id: 'dashboard',\n      name: 'å·¥ä½œå°',\n      icon: 'ğŸ“Š',\n      views: [\n        { id: 'dashboard', name: 'ç¸½è¦½', icon: 'ğŸ ' },\n        { id: 'analytics-center', name: 'æ•¸æ“šåˆ†æ', icon: 'ğŸ“ˆ' }\n      ]\n    },\n    {\n      id: 'accounts',\n      name: 'å¸³è™Ÿç®¡ç†',\n      icon: 'ğŸ‘¤',\n      views: [\n        { id: 'accounts', name: 'å¸³è™Ÿåˆ—è¡¨', icon: 'ğŸ“±' },\n        { id: 'add-account', name: 'æ·»åŠ å¸³è™Ÿ', icon: 'â•' },\n        { id: 'api-credentials', name: 'API æ†‘è­‰', icon: 'ğŸ”‘' }\n      ]\n    },\n    {\n      id: 'automation',\n      name: 'è‡ªå‹•åŒ–ä¸­å¿ƒ',\n      icon: 'ğŸ¤–',\n      views: [\n        { id: 'automation', name: 'è‡ªå‹•åŒ–é¢æ¿', icon: 'âš¡' },\n        { id: 'monitoring-accounts', name: 'ç›£æ§å¸³è™Ÿ', icon: 'ğŸ‘ï¸' },\n        { id: 'monitoring-groups', name: 'ç›£æ§ç¾¤çµ„', icon: 'ğŸ’¬' },\n        { id: 'keyword-sets', name: 'é—œéµè©é›†', icon: 'ğŸ”¤' },\n        { id: 'chat-templates', name: 'è©±è¡“æ¨¡æ¿', icon: 'ğŸ“' },\n        { id: 'trigger-rules', name: 'è§¸ç™¼è¦å‰‡', icon: 'ğŸ¯' },\n        { id: 'collected-users', name: 'æ”¶é›†ç”¨æˆ¶', icon: 'ğŸ‘¥' }\n      ]\n    },\n    {\n      id: 'resources',\n      name: 'è³‡æºä¸­å¿ƒ',\n      icon: 'ğŸ“¦',\n      views: [\n        { id: 'search-discovery', name: 'æœç´¢ç™¼ç¾', icon: 'ğŸ”' },\n        { id: 'member-database', name: 'æˆå“¡è³‡æ–™åº«', icon: 'ğŸ‘¥' },\n        { id: 'resource-center', name: 'è³‡æºç®¡ç†', icon: 'ğŸ“' }\n      ]\n    },\n    {\n      id: 'leads',\n      name: 'å®¢æˆ¶åŸ¹è‚²',\n      icon: 'ğŸ¯',\n      views: [\n        { id: 'lead-nurturing', name: 'ç·šç´¢ç®¡ç†', icon: 'ğŸ“‹' },\n        { id: 'nurturing-analytics', name: 'åŸ¹è‚²åˆ†æ', icon: 'ğŸ“Š' }\n      ]\n    },\n    {\n      id: 'ai',\n      name: 'AI ä¸­å¿ƒ',\n      icon: 'ğŸ§ ',\n      views: [\n        { id: 'ai-center', name: 'AI é…ç½®', icon: 'âš™ï¸' },\n        { id: 'ai-assistant', name: 'AI åŠ©æ‰‹', icon: 'ğŸ’¬' },\n        { id: 'ai-team', name: 'AI åœ˜éšŠ', icon: 'ğŸ‘¥' },\n        { id: 'multi-role', name: 'å¤šè§’è‰²å”ä½œ', icon: 'ğŸ­' }\n      ]\n    },\n    {\n      id: 'system',\n      name: 'ç³»çµ±è¨­ç½®',\n      icon: 'âš™ï¸',\n      views: [\n        { id: 'settings', name: 'ç³»çµ±è¨­ç½®', icon: 'ğŸ”§' },\n        { id: 'profile', name: 'å€‹äººè³‡æ–™', icon: 'ğŸ‘¤' },\n        { id: 'membership-center', name: 'æœƒå“¡ä¸­å¿ƒ', icon: 'ğŸ’' }\n      ]\n    }\n  ];\n  \n  // ========== ç‹€æ…‹æ›´æ–°æ–¹æ³• ==========\n  \n  setConnectionState(state: ConnectionState, message?: string): void {\n    this._backendConnectionState.set(state);\n    if (message) {\n      this._backendConnectionMessage.set(message);\n    }\n  }\n  \n  setConnectionProgress(progress: number): void {\n    this._backendConnectionProgress.set(progress);\n  }\n  \n  navigateTo(view: AppView): void {\n    this._previousView.set(this._currentView());\n    this._currentView.set(view);\n  }\n  \n  goBack(): void {\n    const prev = this._previousView();\n    if (prev) {\n      this._currentView.set(prev);\n      this._previousView.set(null);\n    }\n  }\n  \n  toggleSidebar(): void {\n    this._sidebarCollapsed.update(v => !v);\n  }\n  \n  setSidebarCollapsed(collapsed: boolean): void {\n    this._sidebarCollapsed.set(collapsed);\n  }\n  \n  setAccounts(accounts: TelegramAccount[]): void {\n    this._accounts.set(accounts);\n  }\n  \n  updateAccount(account: TelegramAccount): void {\n    this._accounts.update(list => \n      list.map(a => a.id === account.id ? account : a)\n    );\n  }\n  \n  addAccount(account: TelegramAccount): void {\n    this._accounts.update(list => [...list, account]);\n  }\n  \n  removeAccount(accountId: number): void {\n    this._accounts.update(list => list.filter(a => a.id !== accountId));\n  }\n  \n  selectAccount(accountId: number | null): void {\n    this._selectedAccountId.set(accountId);\n  }\n  \n  setGroups(groups: MonitoredGroup[]): void {\n    this._groups.set(groups);\n  }\n  \n  setKeywordSets(sets: KeywordSet[]): void {\n    this._keywordSets.set(sets);\n  }\n  \n  setTemplates(templates: MessageTemplate[]): void {\n    this._templates.set(templates);\n  }\n  \n  setMonitoring(active: boolean): void {\n    this._isMonitoring.set(active);\n  }\n  \n  setLoading(loading: boolean, message?: string): void {\n    this._isLoading.set(loading);\n    if (message !== undefined) {\n      this._loadingMessage.set(message);\n    }\n  }\n  \n  // ========== è¼”åŠ©æ–¹æ³• ==========\n  \n  getModuleForView(view: AppView): NavModule | undefined {\n    return this.navModules.find(m => m.views.some(v => v.id === view));\n  }\n  \n  getViewInfo(view: AppView): NavView | undefined {\n    for (const module of this.navModules) {\n      const found = module.views.find(v => v.id === view);\n      if (found) return found;\n    }\n    return undefined;\n  }\n  \n  getBreadcrumb(): { module: NavModule; view: NavView } | null {\n    const view = this._currentView();\n    const module = this.getModuleForView(view);\n    const viewInfo = this.getViewInfo(view);\n    \n    if (module && viewInfo) {\n      return { module, view: viewInfo };\n    }\n    return null;\n  }\n}\n","/**\r\n * è³‡æºç™¼ç¾æœå‹™\r\n * Resource Discovery Service\r\n * \r\n * è™•ç†ç¾¤çµ„æœç´¢ã€æˆå“¡æå–ç­‰è³‡æºç™¼ç¾ç›¸é—œé‚è¼¯\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\nimport { TelegramAccount } from '../models';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport type SearchSource = 'telegram' | 'jiso' | 'all';\r\n\r\nexport interface DiscoveredResource {\r\n  id: string;\r\n  type: 'group' | 'channel' | 'user';\r\n  title: string;\r\n  username?: string;\r\n  description?: string;\r\n  memberCount?: number;\r\n  source: SearchSource;\r\n  accessHash?: string;\r\n  isPublic?: boolean;\r\n  isVerified?: boolean;\r\n  photo?: string;\r\n  addedAt?: string;\r\n}\r\n\r\nexport interface SearchResult {\r\n  query: string;\r\n  source: SearchSource;\r\n  results: DiscoveredResource[];\r\n  timestamp: number;\r\n  totalCount: number;\r\n}\r\n\r\nexport interface SearchState {\r\n  isSearching: boolean;\r\n  query: string;\r\n  progress: number;\r\n  currentSource: SearchSource | null;\r\n  error: string | null;\r\n}\r\n\r\nexport interface ResourceStats {\r\n  totalDiscovered: number;\r\n  groups: number;\r\n  channels: number;\r\n  users: number;\r\n  todayDiscovered: number;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ResourceDiscoveryService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  private _initialized = signal(false);\r\n  private _selectedAccountId = signal<number | null>(null);\r\n  private _searchState = signal<SearchState>({\r\n    isSearching: false,\r\n    query: '',\r\n    progress: 0,\r\n    currentSource: null,\r\n    error: null\r\n  });\r\n  private _results = signal<DiscoveredResource[]>([]);\r\n  private _savedResources = signal<DiscoveredResource[]>([]);\r\n  private _searchHistory = signal<string[]>([]);\r\n  private _stats = signal<ResourceStats>({\r\n    totalDiscovered: 0,\r\n    groups: 0,\r\n    channels: 0,\r\n    users: 0,\r\n    todayDiscovered: 0\r\n  });\r\n  \r\n  // æœç´¢çµæœç·©å­˜\r\n  private searchCache = new Map<string, SearchResult>();\r\n  private readonly CACHE_EXPIRY_MS = 5 * 60 * 1000; // 5 åˆ†é˜\r\n  \r\n  // ========== å…¬é–‹ç‹€æ…‹ ==========\r\n  initialized = this._initialized.asReadonly();\r\n  selectedAccountId = this._selectedAccountId.asReadonly();\r\n  searchState = this._searchState.asReadonly();\r\n  results = this._results.asReadonly();\r\n  savedResources = this._savedResources.asReadonly();\r\n  searchHistory = this._searchHistory.asReadonly();\r\n  stats = this._stats.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  isSearching = computed(() => this._searchState().isSearching);\r\n  searchProgress = computed(() => this._searchState().progress);\r\n  \r\n  groupResults = computed(() => \r\n    this._results().filter(r => r.type === 'group')\r\n  );\r\n  \r\n  channelResults = computed(() => \r\n    this._results().filter(r => r.type === 'channel')\r\n  );\r\n  \r\n  userResults = computed(() => \r\n    this._results().filter(r => r.type === 'user')\r\n  );\r\n  \r\n  // ========== åˆå§‹åŒ– ==========\r\n  \r\n  async initialize(accounts: TelegramAccount[]): Promise<boolean> {\r\n    // é¸æ“‡æœ€ä½³å¸³è™Ÿ\r\n    const account = this.selectBestAccount(accounts);\r\n    if (!account) {\r\n      this.toast.error('æ²’æœ‰å¯ç”¨çš„åœ¨ç·šå¸³è™Ÿ');\r\n      return false;\r\n    }\r\n    \r\n    this._selectedAccountId.set(account.id);\r\n    \r\n    return new Promise((resolve) => {\r\n      this.ipc.send('init-resource-discovery', {\r\n        accountId: account.id,\r\n        phone: account.phone\r\n      });\r\n      \r\n      // å‡è¨­åˆå§‹åŒ–æˆåŠŸ\r\n      setTimeout(() => {\r\n        this._initialized.set(true);\r\n        resolve(true);\r\n      }, 1000);\r\n    });\r\n  }\r\n  \r\n  private selectBestAccount(accounts: TelegramAccount[]): TelegramAccount | null {\r\n    const online = accounts.filter(a => a.status === 'Online');\r\n    if (online.length === 0) return null;\r\n    \r\n    // å„ªå…ˆç´šï¼šExplorer > Listener > Sender > å…¶ä»–\r\n    const priority: Record<string, number> = {\r\n      'Explorer': 1,\r\n      'Listener': 2,\r\n      'Sender': 3,\r\n      'AI': 4,\r\n      'Backup': 5,\r\n      'Unassigned': 6\r\n    };\r\n    \r\n    return online.sort((a, b) => \r\n      (priority[a.role] || 99) - (priority[b.role] || 99)\r\n    )[0];\r\n  }\r\n  \r\n  // ========== æœç´¢æ“ä½œ ==========\r\n  \r\n  async search(query: string, sources: SearchSource[] = ['telegram']): Promise<DiscoveredResource[]> {\r\n    if (!query.trim()) {\r\n      this.toast.warning('è«‹è¼¸å…¥æœç´¢é—œéµè©');\r\n      return [];\r\n    }\r\n    \r\n    // æª¢æŸ¥ç·©å­˜\r\n    const cacheKey = this.generateCacheKey(query, sources);\r\n    const cached = this.getFromCache(cacheKey);\r\n    if (cached) {\r\n      this._results.set(cached.results);\r\n      return cached.results;\r\n    }\r\n    \r\n    // é–‹å§‹æœç´¢\r\n    this._searchState.set({\r\n      isSearching: true,\r\n      query,\r\n      progress: 0,\r\n      currentSource: sources[0],\r\n      error: null\r\n    });\r\n    \r\n    this._results.set([]);\r\n    \r\n    // æ·»åŠ åˆ°æœç´¢æ­·å²\r\n    this.addToHistory(query);\r\n    \r\n    // ç™¼é€æœç´¢è«‹æ±‚\r\n    this.ipc.send('search-resources', {\r\n      query,\r\n      sources,\r\n      accountId: this._selectedAccountId()\r\n    });\r\n    \r\n    return [];\r\n  }\r\n  \r\n  handleSearchResults(data: { results: DiscoveredResource[]; source: SearchSource; isComplete: boolean }): void {\r\n    // åˆä½µçµæœ\r\n    this._results.update(existing => {\r\n      const newResults = [...existing];\r\n      for (const result of data.results) {\r\n        if (!newResults.some(r => r.id === result.id)) {\r\n          newResults.push(result);\r\n        }\r\n      }\r\n      return newResults;\r\n    });\r\n    \r\n    // æ›´æ–°é€²åº¦\r\n    this._searchState.update(state => ({\r\n      ...state,\r\n      progress: data.isComplete ? 100 : state.progress + 20,\r\n      currentSource: data.source\r\n    }));\r\n    \r\n    if (data.isComplete) {\r\n      this.completeSearch();\r\n    }\r\n  }\r\n  \r\n  handleSearchError(error: string): void {\r\n    this._searchState.update(state => ({\r\n      ...state,\r\n      isSearching: false,\r\n      error\r\n    }));\r\n    this.toast.error(`æœç´¢å¤±æ•—: ${error}`);\r\n  }\r\n  \r\n  private completeSearch(): void {\r\n    const state = this._searchState();\r\n    const results = this._results();\r\n    \r\n    // ç·©å­˜çµæœ\r\n    const cacheKey = this.generateCacheKey(state.query, ['telegram']);\r\n    this.searchCache.set(cacheKey, {\r\n      query: state.query,\r\n      source: 'telegram',\r\n      results,\r\n      timestamp: Date.now(),\r\n      totalCount: results.length\r\n    });\r\n    \r\n    // æ›´æ–°ç‹€æ…‹\r\n    this._searchState.update(s => ({\r\n      ...s,\r\n      isSearching: false,\r\n      progress: 100\r\n    }));\r\n    \r\n    // æ›´æ–°çµ±è¨ˆ\r\n    this.updateStats();\r\n    \r\n    this.toast.success(`æ‰¾åˆ° ${results.length} å€‹çµæœ`);\r\n  }\r\n  \r\n  cancelSearch(): void {\r\n    this.ipc.send('cancel-search');\r\n    this._searchState.update(state => ({\r\n      ...state,\r\n      isSearching: false,\r\n      progress: 0\r\n    }));\r\n  }\r\n  \r\n  clearResults(): void {\r\n    this._results.set([]);\r\n    this._searchState.update(state => ({\r\n      ...state,\r\n      query: '',\r\n      progress: 0,\r\n      error: null\r\n    }));\r\n  }\r\n  \r\n  // ========== è³‡æºæ“ä½œ ==========\r\n  \r\n  async saveResource(resource: DiscoveredResource): Promise<boolean> {\r\n    if (this._savedResources().some(r => r.id === resource.id)) {\r\n      this.toast.info('æ­¤è³‡æºå·²ä¿å­˜');\r\n      return false;\r\n    }\r\n    \r\n    const saved = { ...resource, addedAt: new Date().toISOString() };\r\n    this._savedResources.update(list => [...list, saved]);\r\n    \r\n    this.ipc.send('save-resource', { resource: saved });\r\n    this.toast.success('è³‡æºå·²ä¿å­˜');\r\n    \r\n    return true;\r\n  }\r\n  \r\n  removeResource(resourceId: string): void {\r\n    this._savedResources.update(list => list.filter(r => r.id !== resourceId));\r\n    this.ipc.send('remove-resource', { resourceId });\r\n  }\r\n  \r\n  async joinGroup(resource: DiscoveredResource): Promise<boolean> {\r\n    if (resource.type !== 'group' && resource.type !== 'channel') {\r\n      this.toast.error('åªèƒ½åŠ å…¥ç¾¤çµ„æˆ–é »é“');\r\n      return false;\r\n    }\r\n    \r\n    this.ipc.send('join-group', {\r\n      username: resource.username,\r\n      accessHash: resource.accessHash,\r\n      accountId: this._selectedAccountId()\r\n    });\r\n    \r\n    this.toast.info(`æ­£åœ¨åŠ å…¥ ${resource.title}...`);\r\n    return true;\r\n  }\r\n  \r\n  async extractMembers(resource: DiscoveredResource, limit: number = 100): Promise<void> {\r\n    if (resource.type !== 'group') {\r\n      this.toast.error('åªèƒ½å¾ç¾¤çµ„æå–æˆå“¡');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('extract-members', {\r\n      groupId: resource.id,\r\n      groupTitle: resource.title,\r\n      limit,\r\n      accountId: this._selectedAccountId()\r\n    });\r\n    \r\n    this.toast.info(`æ­£åœ¨æå–æˆå“¡...`);\r\n  }\r\n  \r\n  // ========== è¼”åŠ©æ–¹æ³• ==========\r\n  \r\n  private generateCacheKey(query: string, sources: SearchSource[]): string {\r\n    const normalizedQuery = query.toLowerCase().trim();\r\n    const sortedSources = [...sources].sort().join(',');\r\n    return `${normalizedQuery}|${sortedSources}`;\r\n  }\r\n  \r\n  private getFromCache(cacheKey: string): SearchResult | null {\r\n    const cached = this.searchCache.get(cacheKey);\r\n    if (!cached) return null;\r\n    \r\n    if (Date.now() - cached.timestamp > this.CACHE_EXPIRY_MS) {\r\n      this.searchCache.delete(cacheKey);\r\n      return null;\r\n    }\r\n    \r\n    return cached;\r\n  }\r\n  \r\n  private addToHistory(query: string): void {\r\n    this._searchHistory.update(history => {\r\n      const filtered = history.filter(h => h !== query);\r\n      return [query, ...filtered].slice(0, 20);\r\n    });\r\n  }\r\n  \r\n  clearHistory(): void {\r\n    this._searchHistory.set([]);\r\n  }\r\n  \r\n  private updateStats(): void {\r\n    const results = this._results();\r\n    const saved = this._savedResources();\r\n    \r\n    this._stats.set({\r\n      totalDiscovered: saved.length,\r\n      groups: saved.filter(r => r.type === 'group').length,\r\n      channels: saved.filter(r => r.type === 'channel').length,\r\n      users: saved.filter(r => r.type === 'user').length,\r\n      todayDiscovered: results.length\r\n    });\r\n  }\r\n  \r\n  refreshStats(): void {\r\n    this.ipc.send('get-resource-stats');\r\n  }\r\n  \r\n  setStats(stats: ResourceStats): void {\r\n    this._stats.set(stats);\r\n  }\r\n  \r\n  selectAccount(accountId: number): void {\r\n    this._selectedAccountId.set(accountId);\r\n    this._initialized.set(false);\r\n  }\r\n}\r\n","/**\r\n * çµ±ä¸€éŒ¯èª¤è™•ç†æœå‹™\r\n * Unified Error Handler Service\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * 1. çµ±ä¸€éŒ¯èª¤æ ¼å¼\r\n * 2. éŒ¯èª¤æ—¥èªŒè¨˜éŒ„\r\n * 3. ç”¨æˆ¶å‹å¥½æç¤º\r\n * 4. éŒ¯èª¤æ¢å¾©å»ºè­°\r\n */\r\n\r\nimport { Injectable, signal, inject, ErrorHandler } from '@angular/core';\r\nimport { ToastService } from '../toast.service';\r\n\r\n/**\r\n * å…¨å±€éŒ¯èª¤è™•ç†å™¨ (Angular ErrorHandler)\r\n * æ””æˆªæ‰€æœ‰æœªè™•ç†çš„éŒ¯èª¤\r\n */\r\n@Injectable()\r\nexport class GlobalErrorHandler implements ErrorHandler {\r\n  private errorHandlerService = inject(ErrorHandlerService);\r\n  \r\n  handleError(error: any): void {\r\n    console.error('Global error caught:', error);\r\n    // ä½¿ç”¨çµ±ä¸€éŒ¯èª¤è™•ç†æœå‹™\r\n    this.errorHandlerService.handle(error);\r\n  }\r\n}\r\n\r\n// éŒ¯èª¤é¡å‹\r\nexport type ErrorType = \r\n  | 'network'      // ç¶²çµ¡éŒ¯èª¤\r\n  | 'auth'         // èªè­‰éŒ¯èª¤\r\n  | 'permission'   // æ¬Šé™éŒ¯èª¤\r\n  | 'validation'   // é©—è­‰éŒ¯èª¤\r\n  | 'telegram'     // Telegram API éŒ¯èª¤\r\n  | 'database'     // æ•¸æ“šåº«éŒ¯èª¤\r\n  | 'ai'           // AI æœå‹™éŒ¯èª¤\r\n  | 'unknown';     // æœªçŸ¥éŒ¯èª¤\r\n\r\n// éŒ¯èª¤åš´é‡ç¨‹åº¦\r\nexport type ErrorSeverity = 'info' | 'warning' | 'error' | 'critical';\r\n\r\n// çµ±ä¸€éŒ¯èª¤æ ¼å¼\r\nexport interface AppError {\r\n  id: string;\r\n  type: ErrorType;\r\n  severity: ErrorSeverity;\r\n  code?: string;\r\n  message: string;\r\n  userMessage: string;       // ç”¨æˆ¶å‹å¥½æ¶ˆæ¯\r\n  suggestion?: string;       // è§£æ±ºå»ºè­°\r\n  details?: any;\r\n  timestamp: string;\r\n  stack?: string;\r\n  context?: {\r\n    component?: string;\r\n    action?: string;\r\n    data?: any;\r\n  };\r\n}\r\n\r\n// éŒ¯èª¤çµ±è¨ˆ\r\nexport interface ErrorStats {\r\n  total: number;\r\n  byType: Record<ErrorType, number>;\r\n  bySeverity: Record<ErrorSeverity, number>;\r\n  lastHour: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ErrorHandlerService {\r\n  private toast = inject(ToastService);\r\n  \r\n  // éŒ¯èª¤æ­·å²\r\n  private _errors = signal<AppError[]>([]);\r\n  errors = this._errors.asReadonly();\r\n  \r\n  // æœ€å¾Œä¸€å€‹éŒ¯èª¤\r\n  private _lastError = signal<AppError | null>(null);\r\n  lastError = this._lastError.asReadonly();\r\n  \r\n  // éŒ¯èª¤çµ±è¨ˆ\r\n  private _stats = signal<ErrorStats>({\r\n    total: 0,\r\n    byType: {\r\n      network: 0,\r\n      auth: 0,\r\n      permission: 0,\r\n      validation: 0,\r\n      telegram: 0,\r\n      database: 0,\r\n      ai: 0,\r\n      unknown: 0\r\n    },\r\n    bySeverity: {\r\n      info: 0,\r\n      warning: 0,\r\n      error: 0,\r\n      critical: 0\r\n    },\r\n    lastHour: 0\r\n  });\r\n  stats = this._stats.asReadonly();\r\n  \r\n  /**\r\n   * è™•ç†éŒ¯èª¤\r\n   */\r\n  handle(\r\n    error: Error | string | any,\r\n    context?: { component?: string; action?: string; data?: any },\r\n    options?: { silent?: boolean; severity?: ErrorSeverity }\r\n  ): AppError {\r\n    // è§£æéŒ¯èª¤\r\n    const appError = this.parseError(error, context);\r\n    \r\n    // è¨­ç½®åš´é‡ç¨‹åº¦\r\n    if (options?.severity) {\r\n      appError.severity = options.severity;\r\n    }\r\n    \r\n    // è¨˜éŒ„éŒ¯èª¤\r\n    this.logError(appError);\r\n    \r\n    // æ›´æ–°ç‹€æ…‹\r\n    this._errors.update(list => [appError, ...list.slice(0, 99)]);\r\n    this._lastError.set(appError);\r\n    this.updateStats(appError);\r\n    \r\n    // é¡¯ç¤ºæç¤ºï¼ˆé™¤ééœé»˜æ¨¡å¼ï¼‰\r\n    if (!options?.silent) {\r\n      this.showToast(appError);\r\n    }\r\n    \r\n    // æ§åˆ¶å°è¼¸å‡º\r\n    console.error(`[${appError.type.toUpperCase()}] ${appError.message}`, {\r\n      error: appError,\r\n      context\r\n    });\r\n    \r\n    return appError;\r\n  }\r\n  \r\n  /**\r\n   * è§£æéŒ¯èª¤\r\n   */\r\n  private parseError(error: any, context?: any): AppError {\r\n    const id = `err_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n    const timestamp = new Date().toISOString();\r\n    \r\n    // å­—ç¬¦ä¸²éŒ¯èª¤\r\n    if (typeof error === 'string') {\r\n      return {\r\n        id,\r\n        type: this.detectErrorType(error),\r\n        severity: 'error',\r\n        message: error,\r\n        userMessage: this.toUserMessage(error),\r\n        suggestion: this.getSuggestion(error),\r\n        timestamp,\r\n        context\r\n      };\r\n    }\r\n    \r\n    // Error å°è±¡\r\n    if (error instanceof Error) {\r\n      const type = this.detectErrorType(error.message);\r\n      return {\r\n        id,\r\n        type,\r\n        severity: 'error',\r\n        message: error.message,\r\n        userMessage: this.toUserMessage(error.message, type),\r\n        suggestion: this.getSuggestion(error.message, type),\r\n        stack: error.stack,\r\n        timestamp,\r\n        context\r\n      };\r\n    }\r\n    \r\n    // å°è±¡æ ¼å¼éŒ¯èª¤\r\n    if (typeof error === 'object') {\r\n      const message = error.message || error.error || JSON.stringify(error);\r\n      const type = error.type || this.detectErrorType(message);\r\n      return {\r\n        id,\r\n        type,\r\n        severity: error.severity || 'error',\r\n        code: error.code,\r\n        message,\r\n        userMessage: error.userMessage || this.toUserMessage(message, type),\r\n        suggestion: error.suggestion || this.getSuggestion(message, type),\r\n        details: error.details || error,\r\n        timestamp,\r\n        context\r\n      };\r\n    }\r\n    \r\n    // æœªçŸ¥æ ¼å¼\r\n    return {\r\n      id,\r\n      type: 'unknown',\r\n      severity: 'error',\r\n      message: String(error),\r\n      userMessage: 'ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹ç¨å¾Œé‡è©¦',\r\n      timestamp,\r\n      context\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * æª¢æ¸¬éŒ¯èª¤é¡å‹\r\n   */\r\n  private detectErrorType(message: string): ErrorType {\r\n    const msg = message.toLowerCase();\r\n    \r\n    if (msg.includes('network') || msg.includes('fetch') || msg.includes('timeout') || msg.includes('connection')) {\r\n      return 'network';\r\n    }\r\n    if (msg.includes('auth') || msg.includes('login') || msg.includes('token') || msg.includes('unauthorized') || msg.includes('401')) {\r\n      return 'auth';\r\n    }\r\n    if (msg.includes('permission') || msg.includes('forbidden') || msg.includes('403') || msg.includes('access denied')) {\r\n      return 'permission';\r\n    }\r\n    if (msg.includes('validation') || msg.includes('invalid') || msg.includes('required') || msg.includes('format')) {\r\n      return 'validation';\r\n    }\r\n    if (msg.includes('telegram') || msg.includes('pyrogram') || msg.includes('flood') || msg.includes('peer') || msg.includes('chat')) {\r\n      return 'telegram';\r\n    }\r\n    if (msg.includes('database') || msg.includes('sqlite') || msg.includes('sql') || msg.includes('query')) {\r\n      return 'database';\r\n    }\r\n    if (msg.includes('ai') || msg.includes('openai') || msg.includes('gemini') || msg.includes('ollama') || msg.includes('model')) {\r\n      return 'ai';\r\n    }\r\n    \r\n    return 'unknown';\r\n  }\r\n  \r\n  /**\r\n   * è½‰æ›ç‚ºç”¨æˆ¶å‹å¥½æ¶ˆæ¯\r\n   */\r\n  private toUserMessage(message: string, type?: ErrorType): string {\r\n    const messages: Record<ErrorType, string> = {\r\n      network: 'ç¶²çµ¡é€£æ¥å‡ºç¾å•é¡Œï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²çµ¡é€£æ¥',\r\n      auth: 'ç™»éŒ„ç‹€æ…‹å·²éæœŸï¼Œè«‹é‡æ–°ç™»éŒ„',\r\n      permission: 'æ‚¨æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œ',\r\n      validation: 'è¼¸å…¥çš„æ•¸æ“šæ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹æª¢æŸ¥å¾Œé‡è©¦',\r\n      telegram: 'Telegram æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œé‡è©¦',\r\n      database: 'æ•¸æ“šå­˜å–å‡ºç¾å•é¡Œï¼Œè«‹ç¨å¾Œé‡è©¦',\r\n      ai: 'AI æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œé‡è©¦',\r\n      unknown: 'ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹ç¨å¾Œé‡è©¦'\r\n    };\r\n    \r\n    if (type) {\r\n      return messages[type];\r\n    }\r\n    \r\n    // å˜—è©¦ç°¡åŒ–æŠ€è¡“æ€§æ¶ˆæ¯\r\n    if (message.includes('FLOOD_WAIT')) {\r\n      const match = message.match(/FLOOD_WAIT_(\\d+)/);\r\n      const seconds = match ? parseInt(match[1]) : 60;\r\n      return `ç™¼é€éæ–¼é »ç¹ï¼Œè«‹ç­‰å¾… ${seconds} ç§’å¾Œé‡è©¦`;\r\n    }\r\n    \r\n    if (message.includes('USER_PRIVACY_RESTRICTED')) {\r\n      return 'è©²ç”¨æˆ¶å·²é–‹å•Ÿéš±ç§ä¿è­·ï¼Œç„¡æ³•ç™¼é€æ¶ˆæ¯';\r\n    }\r\n    \r\n    if (message.includes('PEER_ID_INVALID')) {\r\n      return 'ç”¨æˆ¶ä¸å­˜åœ¨æˆ–å·²è¢«å°ç¦';\r\n    }\r\n    \r\n    return messages[this.detectErrorType(message)];\r\n  }\r\n  \r\n  /**\r\n   * ç²å–è§£æ±ºå»ºè­°\r\n   */\r\n  private getSuggestion(message: string, type?: ErrorType): string {\r\n    const suggestions: Record<ErrorType, string> = {\r\n      network: '1. æª¢æŸ¥ç¶²çµ¡é€£æ¥\\n2. å˜—è©¦åˆ·æ–°é é¢\\n3. æª¢æŸ¥ä»£ç†è¨­ç½®',\r\n      auth: '1. é‡æ–°ç™»éŒ„å¸³è™Ÿ\\n2. æ¸…é™¤ç€è¦½å™¨ç·©å­˜\\n3. è¯ç¹«å®¢æœ',\r\n      permission: '1. ç¢ºèªå¸³è™Ÿæ¬Šé™\\n2. å‡ç´šæœƒå“¡ç­‰ç´š\\n3. è¯ç¹«ç®¡ç†å“¡',\r\n      validation: '1. æª¢æŸ¥è¼¸å…¥æ ¼å¼\\n2. ç¢ºä¿å¿…å¡«é …å·²å¡«å¯«\\n3. åƒè€ƒå¹«åŠ©æ–‡æª”',\r\n      telegram: '1. æª¢æŸ¥å¸³è™Ÿç‹€æ…‹\\n2. ç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œé‡è©¦\\n3. å˜—è©¦ä½¿ç”¨å…¶ä»–å¸³è™Ÿ',\r\n      database: '1. åˆ·æ–°é é¢\\n2. é‡å•Ÿæ‡‰ç”¨\\n3. è¯ç¹«æŠ€è¡“æ”¯æŒ',\r\n      ai: '1. æª¢æŸ¥ AI é…ç½®\\n2. ç¢ºèª API å¯†é‘°æœ‰æ•ˆ\\n3. å˜—è©¦åˆ‡æ› AI æ¨¡å‹',\r\n      unknown: '1. åˆ·æ–°é é¢\\n2. é‡å•Ÿæ‡‰ç”¨\\n3. è¯ç¹«å®¢æœ'\r\n    };\r\n    \r\n    // ç‰¹æ®Šæƒ…æ³çš„å»ºè­°\r\n    if (message.includes('FLOOD_WAIT')) {\r\n      return 'ç™¼é€é »ç‡éé«˜ï¼Œå»ºè­°ï¼š\\n1. é™ä½ç™¼é€é »ç‡\\n2. å¢åŠ ç™¼é€é–“éš”\\n3. ä½¿ç”¨å¤šå€‹å¸³è™Ÿè¼ªæµç™¼é€';\r\n    }\r\n    \r\n    if (message.includes('SESSION')) {\r\n      return 'Session å•é¡Œï¼Œå»ºè­°ï¼š\\n1. é‡æ–°ç™»éŒ„å¸³è™Ÿ\\n2. åˆªé™¤ session æ–‡ä»¶å¾Œé‡æ–°ç™»éŒ„\\n3. æª¢æŸ¥æ˜¯å¦åœ¨å…¶ä»–è¨­å‚™ç™»éŒ„';\r\n    }\r\n    \r\n    return suggestions[type || this.detectErrorType(message)];\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„éŒ¯èª¤æ—¥èªŒ\r\n   */\r\n  private logError(error: AppError): void {\r\n    try {\r\n      // ç²å–ç¾æœ‰æ—¥èªŒ\r\n      const logsStr = localStorage.getItem('tg-matrix-error-logs') || '[]';\r\n      const logs = JSON.parse(logsStr);\r\n      \r\n      // æ·»åŠ æ–°éŒ¯èª¤\r\n      logs.unshift({\r\n        ...error,\r\n        loggedAt: new Date().toISOString()\r\n      });\r\n      \r\n      // åªä¿ç•™æœ€è¿‘ 500 æ¢\r\n      const trimmedLogs = logs.slice(0, 500);\r\n      \r\n      localStorage.setItem('tg-matrix-error-logs', JSON.stringify(trimmedLogs));\r\n    } catch (e) {\r\n      console.error('Failed to log error:', e);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * æ›´æ–°çµ±è¨ˆ\r\n   */\r\n  private updateStats(error: AppError): void {\r\n    this._stats.update(stats => ({\r\n      total: stats.total + 1,\r\n      byType: {\r\n        ...stats.byType,\r\n        [error.type]: (stats.byType[error.type] || 0) + 1\r\n      },\r\n      bySeverity: {\r\n        ...stats.bySeverity,\r\n        [error.severity]: (stats.bySeverity[error.severity] || 0) + 1\r\n      },\r\n      lastHour: stats.lastHour + 1\r\n    }));\r\n  }\r\n  \r\n  /**\r\n   * é¡¯ç¤º Toast æç¤º\r\n   */\r\n  private showToast(error: AppError): void {\r\n    switch (error.severity) {\r\n      case 'info':\r\n        this.toast.info(error.userMessage);\r\n        break;\r\n      case 'warning':\r\n        this.toast.warning(error.userMessage);\r\n        break;\r\n      case 'error':\r\n      case 'critical':\r\n        this.toast.error(error.userMessage);\r\n        break;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ç²å–éŒ¯èª¤æ—¥èªŒ\r\n   */\r\n  getErrorLogs(limit = 100): AppError[] {\r\n    try {\r\n      const logsStr = localStorage.getItem('tg-matrix-error-logs') || '[]';\r\n      const logs = JSON.parse(logsStr);\r\n      return logs.slice(0, limit);\r\n    } catch {\r\n      return [];\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤éŒ¯èª¤æ—¥èªŒ\r\n   */\r\n  clearErrorLogs(): void {\r\n    localStorage.removeItem('tg-matrix-error-logs');\r\n    this._errors.set([]);\r\n    this._stats.set({\r\n      total: 0,\r\n      byType: {\r\n        network: 0, auth: 0, permission: 0, validation: 0,\r\n        telegram: 0, database: 0, ai: 0, unknown: 0\r\n      },\r\n      bySeverity: { info: 0, warning: 0, error: 0, critical: 0 },\r\n      lastHour: 0\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * åŒ…è£ç•°æ­¥å‡½æ•¸ï¼Œè‡ªå‹•è™•ç†éŒ¯èª¤\r\n   */\r\n  async wrap<T>(\r\n    fn: () => Promise<T>,\r\n    context?: { component?: string; action?: string },\r\n    options?: { silent?: boolean; fallback?: T }\r\n  ): Promise<T | undefined> {\r\n    try {\r\n      return await fn();\r\n    } catch (error) {\r\n      this.handle(error, context, options);\r\n      return options?.fallback;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * å‰µå»ºéŒ¯èª¤é‚Šç•ŒåŒ…è£å™¨\r\n   */\r\n  createBoundary(component: string) {\r\n    return {\r\n      handle: (error: any, action?: string, options?: { silent?: boolean }) => {\r\n        return this.handle(error, { component, action }, options);\r\n      },\r\n      wrap: <T>(fn: () => Promise<T>, action?: string, fallback?: T) => {\r\n        return this.wrap(fn, { component, action }, { fallback });\r\n      }\r\n    };\r\n  }\r\n  \r\n  // ==================== P1.4: å¢å¼·åŠŸèƒ½ ====================\r\n  \r\n  /**\r\n   * å¸¶è‡ªå‹•é‡è©¦çš„ç•°æ­¥è«‹æ±‚\r\n   * \r\n   * @param fn è¦åŸ·è¡Œçš„ç•°æ­¥å‡½æ•¸\r\n   * @param options é‡è©¦é¸é …\r\n   */\r\n  async withRetry<T>(\r\n    fn: () => Promise<T>,\r\n    options: {\r\n      maxRetries?: number;\r\n      delay?: number;\r\n      backoff?: number;  // æŒ‡æ•¸é€€é¿ä¿‚æ•¸\r\n      retryOn?: (error: any) => boolean;\r\n      onRetry?: (error: any, attempt: number) => void;\r\n      context?: { component?: string; action?: string };\r\n    } = {}\r\n  ): Promise<T> {\r\n    const {\r\n      maxRetries = 3,\r\n      delay = 1000,\r\n      backoff = 2,\r\n      retryOn = (e) => this.isRetryable(e),\r\n      onRetry,\r\n      context\r\n    } = options;\r\n    \r\n    let lastError: any;\r\n    \r\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n      try {\r\n        return await fn();\r\n      } catch (error: any) {\r\n        lastError = error;\r\n        \r\n        // æª¢æŸ¥æ˜¯å¦æ‡‰è©²é‡è©¦\r\n        if (attempt < maxRetries && retryOn(error)) {\r\n          const waitTime = delay * Math.pow(backoff, attempt - 1);\r\n          \r\n          // é€šçŸ¥é‡è©¦\r\n          if (onRetry) {\r\n            onRetry(error, attempt);\r\n          } else {\r\n            console.warn(`Retry attempt ${attempt}/${maxRetries} in ${waitTime}ms...`, error.message);\r\n          }\r\n          \r\n          // ç­‰å¾…å¾Œé‡è©¦\r\n          await new Promise(resolve => setTimeout(resolve, waitTime));\r\n        } else {\r\n          // ä¸é‡è©¦ï¼Œæ‹‹å‡ºéŒ¯èª¤\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // æ‰€æœ‰é‡è©¦å¤±æ•—ï¼Œè™•ç†éŒ¯èª¤\r\n    this.handle(lastError, context);\r\n    throw lastError;\r\n  }\r\n  \r\n  /**\r\n   * åˆ¤æ–·éŒ¯èª¤æ˜¯å¦å¯é‡è©¦\r\n   */\r\n  private isRetryable(error: any): boolean {\r\n    const message = (error?.message || String(error)).toLowerCase();\r\n    \r\n    // ç¶²çµ¡éŒ¯èª¤é€šå¸¸å¯é‡è©¦\r\n    if (message.includes('network') || \r\n        message.includes('fetch') || \r\n        message.includes('timeout') ||\r\n        message.includes('connection refused') ||\r\n        message.includes('econnreset')) {\r\n      return true;\r\n    }\r\n    \r\n    // æœå‹™å™¨éŒ¯èª¤ï¼ˆ5xxï¼‰å¯é‡è©¦\r\n    if (message.includes('500') || \r\n        message.includes('502') || \r\n        message.includes('503') || \r\n        message.includes('504')) {\r\n      return true;\r\n    }\r\n    \r\n    // HTTP ç‹€æ…‹ç¢¼\r\n    const status = error?.status || error?.response?.status;\r\n    if (status && status >= 500 && status < 600) {\r\n      return true;\r\n    }\r\n    \r\n    // Telegram FloodWait å¯é‡è©¦ï¼ˆä½†éœ€è¦ç­‰å¾…ï¼‰\r\n    if (message.includes('flood_wait')) {\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  }\r\n  \r\n  /**\r\n   * API è«‹æ±‚åŒ…è£å™¨\r\n   * è‡ªå‹•è™•ç†éŒ¯èª¤å’Œé‡è©¦\r\n   */\r\n  async apiCall<T>(\r\n    url: string,\r\n    options: RequestInit = {},\r\n    config: {\r\n      retry?: boolean;\r\n      maxRetries?: number;\r\n      context?: { component?: string; action?: string };\r\n      silent?: boolean;\r\n    } = {}\r\n  ): Promise<T> {\r\n    const { retry = true, maxRetries = 2, context, silent = false } = config;\r\n    \r\n    const fetchFn = async () => {\r\n      const response = await fetch(url, {\r\n        ...options,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...options.headers\r\n        }\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        const error = new Error(errorData.error || errorData.message || `HTTP ${response.status}`);\r\n        (error as any).status = response.status;\r\n        (error as any).data = errorData;\r\n        throw error;\r\n      }\r\n      \r\n      return response.json();\r\n    };\r\n    \r\n    if (retry) {\r\n      return this.withRetry(fetchFn, { maxRetries, context });\r\n    } else {\r\n      try {\r\n        return await fetchFn();\r\n      } catch (error) {\r\n        if (!silent) {\r\n          this.handle(error, context);\r\n        }\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ç¶²çµ¡ç‹€æ…‹ç›£æ¸¬\r\n   */\r\n  private _isOnline = signal<boolean>(typeof navigator !== 'undefined' ? navigator.onLine : true);\r\n  readonly isOnline = this._isOnline.asReadonly();\r\n  \r\n  /**\r\n   * åˆå§‹åŒ–ç¶²çµ¡ç›£è½\r\n   * åœ¨ constructor ä¸­èª¿ç”¨ç„¡æ•ˆï¼Œéœ€è¦åœ¨ ngOnInit æˆ–é¡ä¼¼ç”Ÿå‘½é€±æœŸä¸­èª¿ç”¨\r\n   */\r\n  initNetworkMonitoring(): void {\r\n    if (typeof window === 'undefined') return;\r\n    \r\n    window.addEventListener('online', () => {\r\n      this._isOnline.set(true);\r\n      this.toast.success('ç¶²çµ¡é€£æ¥å·²æ¢å¾©');\r\n    });\r\n    \r\n    window.addEventListener('offline', () => {\r\n      this._isOnline.set(false);\r\n      this.toast.warning('ç¶²çµ¡é€£æ¥å·²æ–·é–‹ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨');\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æª¢æŸ¥ç¶²çµ¡ç‹€æ…‹\r\n   */\r\n  checkNetwork(): boolean {\r\n    return this._isOnline();\r\n  }\r\n  \r\n  /**\r\n   * å¸¶è¶…æ™‚çš„ Promise\r\n   */\r\n  async withTimeout<T>(\r\n    promise: Promise<T>,\r\n    timeoutMs: number,\r\n    timeoutMessage = 'æ“ä½œè¶…æ™‚ï¼Œè«‹é‡è©¦'\r\n  ): Promise<T> {\r\n    const timeoutPromise = new Promise<never>((_, reject) => {\r\n      setTimeout(() => {\r\n        reject(new Error(timeoutMessage));\r\n      }, timeoutMs);\r\n    });\r\n    \r\n    return Promise.race([promise, timeoutPromise]);\r\n  }\r\n}\r\n","/**\r\n * éµç›¤å¿«æ·éµæœå‹™\r\n * Keyboard Shortcuts Service\r\n * \r\n * ğŸ†• é«”é©—å„ªåŒ–: éµç›¤å¿«æ·éµæ”¯æŒ\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - å…¨å±€å¿«æ·éµè¨»å†Š\r\n * - å¿«æ·éµè¡çªæª¢æ¸¬\r\n * - å¿«æ·éµæç¤º\r\n * - å¯è‡ªå®šç¾©\r\n */\r\n\r\nimport { Injectable, inject, signal, computed, OnDestroy } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// å¿«æ·éµå®šç¾©\r\nexport interface Shortcut {\r\n  id: string;\r\n  key: string;                    // ä¾‹å¦‚: 'ctrl+k', 'cmd+shift+p'\r\n  description: string;\r\n  category: ShortcutCategory;\r\n  action: () => void;\r\n  enabled?: boolean;\r\n  global?: boolean;               // æ˜¯å¦å…¨å±€ç”Ÿæ•ˆï¼ˆåŒ…æ‹¬è¼¸å…¥æ¡†ï¼‰\r\n}\r\n\r\n// å¿«æ·éµé¡åˆ¥\r\nexport type ShortcutCategory = \r\n  | 'navigation'    // å°èˆª\r\n  | 'actions'       // æ“ä½œ\r\n  | 'view'          // è¦–åœ–\r\n  | 'tools';        // å·¥å…·\r\n\r\n// å¿«æ·éµçµ„åˆ\r\ninterface KeyCombo {\r\n  key: string;\r\n  ctrl: boolean;\r\n  shift: boolean;\r\n  alt: boolean;\r\n  meta: boolean;    // Mac çš„ Command éµ\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class KeyboardShortcutsService implements OnDestroy {\r\n  private router = inject(Router);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ç‹€æ…‹\r\n  private _isEnabled = signal(true);\r\n  isEnabled = this._isEnabled.asReadonly();\r\n  \r\n  private _isHelpVisible = signal(false);\r\n  isHelpVisible = this._isHelpVisible.asReadonly();\r\n  \r\n  private _shortcuts = signal<Map<string, Shortcut>>(new Map());\r\n  shortcuts = computed(() => Array.from(this._shortcuts().values()));\r\n  \r\n  // æŒ‰é¡åˆ¥åˆ†çµ„çš„å¿«æ·éµ\r\n  shortcutsByCategory = computed(() => {\r\n    const shortcuts = this.shortcuts();\r\n    const grouped = new Map<ShortcutCategory, Shortcut[]>();\r\n    \r\n    for (const shortcut of shortcuts) {\r\n      if (!grouped.has(shortcut.category)) {\r\n        grouped.set(shortcut.category, []);\r\n      }\r\n      grouped.get(shortcut.category)!.push(shortcut);\r\n    }\r\n    \r\n    return grouped;\r\n  });\r\n  \r\n  // äº‹ä»¶ç›£è¯å™¨å¼•ç”¨\r\n  private keydownHandler: (event: KeyboardEvent) => void;\r\n  \r\n  constructor() {\r\n    this.keydownHandler = this.handleKeydown.bind(this);\r\n    this.registerDefaultShortcuts();\r\n    this.startListening();\r\n  }\r\n  \r\n  ngOnDestroy(): void {\r\n    this.stopListening();\r\n  }\r\n  \r\n  /**\r\n   * è¨»å†Šé»˜èªå¿«æ·éµ\r\n   */\r\n  private registerDefaultShortcuts(): void {\r\n    // å°èˆªå¿«æ·éµ\r\n    this.register({\r\n      id: 'nav-dashboard',\r\n      key: 'g d',\r\n      description: 'å‰å¾€å„€è¡¨æ¿',\r\n      category: 'navigation',\r\n      action: () => this.router.navigate(['/dashboard'])\r\n    });\r\n    \r\n    this.register({\r\n      id: 'nav-accounts',\r\n      key: 'g a',\r\n      description: 'å‰å¾€å¸³è™Ÿç®¡ç†',\r\n      category: 'navigation',\r\n      action: () => this.router.navigate(['/accounts'])\r\n    });\r\n    \r\n    this.register({\r\n      id: 'nav-marketing',\r\n      key: 'g m',\r\n      description: 'å‰å¾€ç‡ŸéŠ·ä»»å‹™ä¸­å¿ƒ',\r\n      category: 'navigation',\r\n      action: () => this.router.navigate(['/marketing-hub'])\r\n    });\r\n    \r\n    this.register({\r\n      id: 'nav-roles',\r\n      key: 'g r',\r\n      description: 'å‰å¾€è§’è‰²è³‡æºåº«',\r\n      category: 'navigation',\r\n      action: () => this.router.navigate(['/role-library'])\r\n    });\r\n    \r\n    this.register({\r\n      id: 'nav-ai',\r\n      key: 'g i',\r\n      description: 'å‰å¾€æ™ºèƒ½å¼•æ“',\r\n      category: 'navigation',\r\n      action: () => this.router.navigate(['/ai-engine'])\r\n    });\r\n    \r\n    // æ“ä½œå¿«æ·éµ\r\n    this.register({\r\n      id: 'action-new-task',\r\n      key: 'ctrl+n',\r\n      description: 'æ–°å»ºç‡ŸéŠ·ä»»å‹™',\r\n      category: 'actions',\r\n      action: () => {\r\n        // ç™¼é€äº‹ä»¶åˆ°ç‡ŸéŠ·ä¸­å¿ƒ\r\n        window.dispatchEvent(new CustomEvent('shortcut:new-task'));\r\n      }\r\n    });\r\n    \r\n    this.register({\r\n      id: 'action-search',\r\n      key: 'ctrl+k',\r\n      description: 'æ‰“é–‹æœç´¢',\r\n      category: 'actions',\r\n      global: true,\r\n      action: () => {\r\n        window.dispatchEvent(new CustomEvent('shortcut:search'));\r\n      }\r\n    });\r\n    \r\n    this.register({\r\n      id: 'action-save',\r\n      key: 'ctrl+s',\r\n      description: 'ä¿å­˜',\r\n      category: 'actions',\r\n      global: true,\r\n      action: () => {\r\n        window.dispatchEvent(new CustomEvent('shortcut:save'));\r\n      }\r\n    });\r\n    \r\n    // è¦–åœ–å¿«æ·éµ\r\n    this.register({\r\n      id: 'view-help',\r\n      key: '?',\r\n      description: 'é¡¯ç¤ºå¿«æ·éµå¹«åŠ©',\r\n      category: 'view',\r\n      action: () => this.toggleHelp()\r\n    });\r\n    \r\n    this.register({\r\n      id: 'view-close',\r\n      key: 'Escape',\r\n      description: 'é—œé–‰å½ˆçª—/å–æ¶ˆ',\r\n      category: 'view',\r\n      global: true,\r\n      action: () => {\r\n        if (this._isHelpVisible()) {\r\n          this.hideHelp();\r\n        } else {\r\n          window.dispatchEvent(new CustomEvent('shortcut:escape'));\r\n        }\r\n      }\r\n    });\r\n    \r\n    this.register({\r\n      id: 'view-refresh',\r\n      key: 'ctrl+r',\r\n      description: 'åˆ·æ–°æ•¸æ“š',\r\n      category: 'view',\r\n      action: () => {\r\n        window.dispatchEvent(new CustomEvent('shortcut:refresh'));\r\n      }\r\n    });\r\n    \r\n    // å·¥å…·å¿«æ·éµ\r\n    this.register({\r\n      id: 'tool-logs',\r\n      key: 'ctrl+l',\r\n      description: 'æŸ¥çœ‹æ—¥èªŒ',\r\n      category: 'tools',\r\n      action: () => {\r\n        window.dispatchEvent(new CustomEvent('shortcut:logs'));\r\n      }\r\n    });\r\n    \r\n    this.register({\r\n      id: 'tool-settings',\r\n      key: 'ctrl+,',\r\n      description: 'æ‰“é–‹è¨­ç½®',\r\n      category: 'tools',\r\n      action: () => this.router.navigate(['/settings'])\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * è¨»å†Šå¿«æ·éµ\r\n   */\r\n  register(shortcut: Shortcut): void {\r\n    this._shortcuts.update(map => {\r\n      const newMap = new Map(map);\r\n      newMap.set(shortcut.id, { ...shortcut, enabled: shortcut.enabled ?? true });\r\n      return newMap;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å–æ¶ˆè¨»å†Š\r\n   */\r\n  unregister(id: string): void {\r\n    this._shortcuts.update(map => {\r\n      const newMap = new Map(map);\r\n      newMap.delete(id);\r\n      return newMap;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å•Ÿç”¨/ç¦ç”¨å¿«æ·éµ\r\n   */\r\n  setEnabled(id: string, enabled: boolean): void {\r\n    this._shortcuts.update(map => {\r\n      const newMap = new Map(map);\r\n      const shortcut = newMap.get(id);\r\n      if (shortcut) {\r\n        newMap.set(id, { ...shortcut, enabled });\r\n      }\r\n      return newMap;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å…¨å±€å•Ÿç”¨/ç¦ç”¨\r\n   */\r\n  setGlobalEnabled(enabled: boolean): void {\r\n    this._isEnabled.set(enabled);\r\n  }\r\n  \r\n  /**\r\n   * é¡¯ç¤ºå¹«åŠ©\r\n   */\r\n  showHelp(): void {\r\n    this._isHelpVisible.set(true);\r\n  }\r\n  \r\n  /**\r\n   * éš±è—å¹«åŠ©\r\n   */\r\n  hideHelp(): void {\r\n    this._isHelpVisible.set(false);\r\n  }\r\n  \r\n  /**\r\n   * åˆ‡æ›å¹«åŠ©\r\n   */\r\n  toggleHelp(): void {\r\n    this._isHelpVisible.update(v => !v);\r\n  }\r\n  \r\n  /**\r\n   * é–‹å§‹ç›£è½\r\n   */\r\n  private startListening(): void {\r\n    document.addEventListener('keydown', this.keydownHandler);\r\n  }\r\n  \r\n  /**\r\n   * åœæ­¢ç›£è½\r\n   */\r\n  private stopListening(): void {\r\n    document.removeEventListener('keydown', this.keydownHandler);\r\n  }\r\n  \r\n  /**\r\n   * è™•ç†éµç›¤äº‹ä»¶\r\n   */\r\n  private handleKeydown(event: KeyboardEvent): void {\r\n    if (!this._isEnabled()) return;\r\n    \r\n    // æª¢æŸ¥æ˜¯å¦åœ¨è¼¸å…¥æ¡†ä¸­\r\n    const isInputActive = this.isInputFocused();\r\n    \r\n    // è§£ææŒ‰éµçµ„åˆ\r\n    const combo = this.parseKeyCombo(event);\r\n    const keyString = this.comboToString(combo);\r\n    \r\n    // æŸ¥æ‰¾åŒ¹é…çš„å¿«æ·éµ\r\n    for (const shortcut of this._shortcuts().values()) {\r\n      if (!shortcut.enabled) continue;\r\n      \r\n      // å¦‚æœåœ¨è¼¸å…¥æ¡†ä¸­ï¼Œåªè™•ç†å…¨å±€å¿«æ·éµ\r\n      if (isInputActive && !shortcut.global) continue;\r\n      \r\n      if (this.matchShortcut(keyString, shortcut.key)) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        \r\n        try {\r\n          shortcut.action();\r\n        } catch (error) {\r\n          console.error(`Shortcut action failed: ${shortcut.id}`, error);\r\n        }\r\n        return;\r\n      }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * æª¢æŸ¥æ˜¯å¦æœ‰è¼¸å…¥æ¡†ç²å¾—ç„¦é»\r\n   */\r\n  private isInputFocused(): boolean {\r\n    const activeElement = document.activeElement;\r\n    if (!activeElement) return false;\r\n    \r\n    const tagName = activeElement.tagName.toLowerCase();\r\n    return (\r\n      tagName === 'input' ||\r\n      tagName === 'textarea' ||\r\n      tagName === 'select' ||\r\n      (activeElement as HTMLElement).isContentEditable\r\n    );\r\n  }\r\n  \r\n  /**\r\n   * è§£ææŒ‰éµçµ„åˆ\r\n   */\r\n  private parseKeyCombo(event: KeyboardEvent): KeyCombo {\r\n    return {\r\n      key: event.key.toLowerCase(),\r\n      ctrl: event.ctrlKey,\r\n      shift: event.shiftKey,\r\n      alt: event.altKey,\r\n      meta: event.metaKey\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * å°‡çµ„åˆè½‰æ›ç‚ºå­—ç¬¦ä¸²\r\n   */\r\n  private comboToString(combo: KeyCombo): string {\r\n    const parts: string[] = [];\r\n    \r\n    if (combo.ctrl || combo.meta) parts.push('ctrl');\r\n    if (combo.shift) parts.push('shift');\r\n    if (combo.alt) parts.push('alt');\r\n    \r\n    parts.push(combo.key);\r\n    \r\n    return parts.join('+');\r\n  }\r\n  \r\n  /**\r\n   * åŒ¹é…å¿«æ·éµ\r\n   */\r\n  private matchShortcut(pressed: string, shortcutKey: string): boolean {\r\n    // è™•ç†åºåˆ—éµï¼ˆå¦‚ 'g d'ï¼‰\r\n    if (shortcutKey.includes(' ')) {\r\n      // ç°¡åŒ–è™•ç†ï¼šåªåŒ¹é…å–®å€‹éµ\r\n      return false;\r\n    }\r\n    \r\n    // æ¨™æº–åŒ–å¿«æ·éµå®šç¾©\r\n    const normalized = shortcutKey.toLowerCase()\r\n      .replace('cmd+', 'ctrl+')\r\n      .replace('command+', 'ctrl+');\r\n    \r\n    return pressed === normalized;\r\n  }\r\n  \r\n  /**\r\n   * ç²å–é¡åˆ¥æ¨™ç±¤\r\n   */\r\n  getCategoryLabel(category: ShortcutCategory): string {\r\n    const labels: Record<ShortcutCategory, string> = {\r\n      navigation: 'å°èˆª',\r\n      actions: 'æ“ä½œ',\r\n      view: 'è¦–åœ–',\r\n      tools: 'å·¥å…·'\r\n    };\r\n    return labels[category];\r\n  }\r\n  \r\n  /**\r\n   * æ ¼å¼åŒ–å¿«æ·éµé¡¯ç¤º\r\n   */\r\n  formatKey(key: string): string {\r\n    return key\r\n      .replace('ctrl', 'âŒƒ')\r\n      .replace('shift', 'â‡§')\r\n      .replace('alt', 'âŒ¥')\r\n      .replace('meta', 'âŒ˜')\r\n      .replace('Escape', 'Esc')\r\n      .toUpperCase();\r\n  }\r\n}\r\n","/**\r\n * çµ±ä¸€è³‡æºæå–æœå‹™ - Unified Extraction Service\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * 1. åŸ·è¡Œæˆå“¡æå–ä¸¦è‡ªå‹•åŒæ­¥åˆ°è³‡æºä¸­å¿ƒ\r\n * 2. ç®¡ç†æå–é…é¡\r\n * 3. ç™¼å°„äº‹ä»¶é€šçŸ¥å…¶ä»–çµ„ä»¶\r\n * 4. æå–æ­·å²è¨˜éŒ„\r\n */\r\n\r\nimport { Injectable, inject, signal, computed } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\nimport { UnifiedContactsService, SourceType } from './unified-contacts.service';\r\nimport { MemberExtractionConfig, ExtractionGroupInfo } from '../dialogs/member-extraction-dialog.component';\r\n\r\n// æå–çµæœ\r\nexport interface ExtractionResult {\r\n  success: boolean;\r\n  groupId: string;\r\n  groupName: string;\r\n  count: number;\r\n  stats: {\r\n    total: number;\r\n    online: number;\r\n    recently: number;\r\n    premium: number;\r\n    hasUsername: number;\r\n    chinese: number;\r\n    bots: number;\r\n  };\r\n  members: ExtractedMember[];\r\n  duration: number;\r\n  timestamp: Date;\r\n}\r\n\r\n// æå–çš„æˆå“¡\r\nexport interface ExtractedMember {\r\n  telegramId: string;\r\n  username?: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  displayName: string;\r\n  phone?: string;\r\n  isBot: boolean;\r\n  isPremium: boolean;\r\n  isVerified: boolean;\r\n  onlineStatus: 'online' | 'recently' | 'offline' | 'unknown';\r\n  lastSeen?: string;\r\n  isChinese?: boolean;\r\n  activityScore?: number;\r\n  valueLevel?: string;\r\n}\r\n\r\n// æå–é€²åº¦\r\nexport interface ExtractionProgress {\r\n  groupId: string;\r\n  current: number;\r\n  total: number;\r\n  status: string;\r\n  percent: number;\r\n  // ğŸ†• P3 å„ªåŒ–ï¼šé ä¼°æ™‚é–“\r\n  estimatedSeconds?: number;\r\n  elapsedSeconds?: number;\r\n  speed?: number;  // æ¯ç§’æå–æ•¸\r\n  fromCache?: boolean;\r\n}\r\n\r\n// ğŸ†• P3 å„ªåŒ–ï¼šæ™ºèƒ½å»ºè­°\r\nexport interface ExtractionSuggestion {\r\n  type: 'info' | 'warning' | 'action';\r\n  message: string;\r\n  action?: string;\r\n  actionLabel?: string;\r\n}\r\n\r\n// é…é¡ä¿¡æ¯\r\nexport interface ExtractionQuota {\r\n  daily: number;\r\n  used: number;\r\n  remaining: number;\r\n  resetAt: string;\r\n}\r\n\r\n// æå–æ­·å²\r\nexport interface ExtractionHistory {\r\n  id: string;\r\n  groupId: string;\r\n  groupName: string;\r\n  groupUrl?: string;\r\n  count: number;\r\n  config: MemberExtractionConfig;\r\n  timestamp: Date;\r\n  syncedToResources: boolean;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UnifiedExtractionService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  private contactsService = inject(UnifiedContactsService);\r\n  \r\n  // ==================== ç‹€æ…‹ ====================\r\n  \r\n  // æå–ä¸­ç‹€æ…‹\r\n  private _isExtracting = signal(false);\r\n  isExtracting = this._isExtracting.asReadonly();\r\n  \r\n  // ç•¶å‰æå–é€²åº¦\r\n  private _progress = signal<ExtractionProgress | null>(null);\r\n  progress = this._progress.asReadonly();\r\n  \r\n  // é…é¡ä¿¡æ¯\r\n  private _quota = signal<ExtractionQuota>({\r\n    daily: 1000,\r\n    used: 0,\r\n    remaining: 1000,\r\n    resetAt: ''\r\n  });\r\n  quota = this._quota.asReadonly();\r\n  \r\n  // æå–æ­·å²\r\n  private _history = signal<ExtractionHistory[]>([]);\r\n  history = this._history.asReadonly();\r\n  \r\n  // æœ€è¿‘æå–çµæœ\r\n  private _lastResult = signal<ExtractionResult | null>(null);\r\n  lastResult = this._lastResult.asReadonly();\r\n  \r\n  // ==================== äº‹ä»¶ ====================\r\n  \r\n  // è³‡æºæ›´æ–°äº‹ä»¶\r\n  resourcesUpdated$ = new Subject<{ action: string; count: number; groupName: string }>();\r\n  \r\n  // æå–å®Œæˆäº‹ä»¶\r\n  extractionCompleted$ = new Subject<ExtractionResult>();\r\n  \r\n  // æå–é€²åº¦äº‹ä»¶\r\n  extractionProgress$ = new Subject<ExtractionProgress>();\r\n  \r\n  // ==================== è¨ˆç®—å±¬æ€§ ====================\r\n  \r\n  remainingQuota = computed(() => this._quota().remaining);\r\n  \r\n  canExtract = computed(() => {\r\n    return !this._isExtracting() && this._quota().remaining > 0;\r\n  });\r\n  \r\n  // ==================== åˆå§‹åŒ– ====================\r\n  \r\n  constructor() {\r\n    this.setupListeners();\r\n    this.loadQuota();\r\n    this.loadHistory();\r\n  }\r\n  \r\n  // ğŸ†• P3 å„ªåŒ–ï¼šæå–é–‹å§‹æ™‚é–“ï¼ˆç”¨æ–¼è¨ˆç®—é€Ÿåº¦ï¼‰\r\n  private _extractionStartTime: number = 0;\r\n  private _lastProgressUpdate: { time: number; count: number } = { time: 0, count: 0 };\r\n  \r\n  private setupListeners() {\r\n    // ç›£è½æå–é€²åº¦\r\n    this.ipc.on('members-extraction-progress', (data: any) => {\r\n      if (data) {\r\n        // ğŸ†• P1 ä¿®å¾©ï¼šè™•ç†å¤šç¨®ç‹€æ…‹\r\n        let statusText = data.status || 'æå–ä¸­...';\r\n        if (data.status === 'retrying') {\r\n          statusText = data.message || 'æ­£åœ¨åŒæ­¥ç¾¤çµ„ç‹€æ…‹...';\r\n        } else if (data.status === 'starting') {\r\n          statusText = 'æ­£åœ¨é€£æ¥ç¾¤çµ„...';\r\n          this._extractionStartTime = Date.now();\r\n          this._lastProgressUpdate = { time: Date.now(), count: 0 };\r\n        } else if (data.status === 'waiting') {\r\n          statusText = data.message || 'ç­‰å¾…ç¾¤çµ„åŒæ­¥...';\r\n        } else if (data.status === 'completed') {\r\n          statusText = 'æå–å®Œæˆ';\r\n        } else if (data.status === 'extracting') {\r\n          statusText = `æ­£åœ¨æå– (${data.extracted || 0}/${data.total || '?'})...`;\r\n        }\r\n        \r\n        // ğŸ†• P3 å„ªåŒ–ï¼šè¨ˆç®—é€Ÿåº¦å’Œé ä¼°æ™‚é–“\r\n        const now = Date.now();\r\n        const current = data.extracted || 0;\r\n        const total = data.total || 0;\r\n        const elapsedSeconds = this._extractionStartTime ? Math.round((now - this._extractionStartTime) / 1000) : 0;\r\n        \r\n        let speed = 0;\r\n        let estimatedSeconds = 0;\r\n        \r\n        if (current > 0 && elapsedSeconds > 0) {\r\n          speed = Math.round((current / elapsedSeconds) * 10) / 10;  // æ¯ç§’æå–æ•¸\r\n          const remaining = total - current;\r\n          if (speed > 0 && remaining > 0) {\r\n            estimatedSeconds = Math.ceil(remaining / speed);\r\n          }\r\n        }\r\n        \r\n        // æ ¼å¼åŒ–ç‹€æ…‹æ–‡å­—ï¼ˆåŒ…å«é ä¼°æ™‚é–“ï¼‰\r\n        if (data.status === 'extracting' && estimatedSeconds > 0) {\r\n          const mins = Math.floor(estimatedSeconds / 60);\r\n          const secs = estimatedSeconds % 60;\r\n          const timeStr = mins > 0 ? `${mins}åˆ†${secs}ç§’` : `${secs}ç§’`;\r\n          statusText = `æ­£åœ¨æå– (${current}/${total}) é ä¼°å‰©é¤˜ ${timeStr}`;\r\n        }\r\n        \r\n        const progress: ExtractionProgress = {\r\n          groupId: String(data.resourceId || data.groupId),\r\n          current,\r\n          total,\r\n          status: statusText,\r\n          percent: total > 0 ? Math.round((current / total) * 100) : 0,\r\n          estimatedSeconds,\r\n          elapsedSeconds,\r\n          speed,\r\n          fromCache: data.fromCache || false\r\n        };\r\n        this._progress.set(progress);\r\n        this.extractionProgress$.next(progress);\r\n      }\r\n    });\r\n    \r\n    // ç›£è½æå–å®Œæˆ\r\n    this.ipc.on('members-extracted', (data: any) => {\r\n      this._isExtracting.set(false);\r\n      this._progress.set(null);\r\n      \r\n      if (data.success && data.members) {\r\n        const result = this.processExtractionResult(data);\r\n        this._lastResult.set(result);\r\n        this.extractionCompleted$.next(result);\r\n        \r\n        // ğŸ†• P3ï¼šé¡¯ç¤ºä¾†è‡ªç·©å­˜çš„æç¤º\r\n        if (data.fromCache) {\r\n          this.toast.info(`ğŸ“¦ ä½¿ç”¨ç·©å­˜çµæœï¼ˆ${Math.round(data.cacheAge / 60)} åˆ†é˜å‰ï¼‰`);\r\n        }\r\n        \r\n        // æ›´æ–°é…é¡\r\n        this._quota.update(q => ({\r\n          ...q,\r\n          used: q.used + result.count,\r\n          remaining: Math.max(0, q.remaining - result.count)\r\n        }));\r\n        \r\n        // ğŸ†• P3ï¼šæ™ºèƒ½å»ºè­°\r\n        this.showSmartSuggestions(result);\r\n      } else if (data.error) {\r\n        // ğŸ†• P3ï¼šæ™ºèƒ½éŒ¯èª¤å»ºè­°\r\n        const suggestion = this.getErrorSuggestion(data.error_code, data.error_details);\r\n        if (suggestion) {\r\n          this.toast.warning(`${data.error}\\n\\nğŸ’¡ ${suggestion}`);\r\n        } else {\r\n          this.toast.error(`æå–å¤±æ•—ï¼š${data.error}`);\r\n        }\r\n      }\r\n    });\r\n    \r\n    // ç›£è¯é…é¡æ›´æ–°\r\n    this.ipc.on('extraction-quota', (data: any) => {\r\n      if (data) {\r\n        this._quota.set({\r\n          daily: data.daily || 1000,\r\n          used: data.used || 0,\r\n          remaining: data.remaining || 1000,\r\n          resetAt: data.resetAt || ''\r\n        });\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• P2ï¼šç›£è½èƒŒæ™¯æå–å®Œæˆ\r\n    this.ipc.on('background-extraction-completed', (data: any) => {\r\n      if (data.success) {\r\n        this.toast.success(`âœ… èƒŒæ™¯æå–å®Œæˆï¼š${data.chatTitle || 'ç¾¤çµ„'} - ${data.extracted} å€‹æˆå“¡`);\r\n      } else {\r\n        this.toast.error(`âŒ èƒŒæ™¯æå–å¤±æ•—ï¼š${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• P2ï¼šç›£è½èƒŒæ™¯æå–å•Ÿå‹•ç¢ºèª\r\n    this.ipc.on('background-extraction-started', (data: any) => {\r\n      if (data.success) {\r\n        console.log('[UnifiedExtraction] Background task started:', data.taskId);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• P4ï¼šç›£è½å°å‡ºå®Œæˆ\r\n    this.ipc.on('members-exported', (data: any) => {\r\n      if (data.success && data.content) {\r\n        // å‰µå»ºä¸‹è¼‰\r\n        const blob = new Blob([data.content], { \r\n          type: data.format === 'json' ? 'application/json' : 'text/csv' \r\n        });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = data.filename;\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n        this.toast.success(`âœ… å°å‡ºæˆåŠŸ: ${data.filename}`);\r\n      } else if (data.error) {\r\n        this.toast.error(`å°å‡ºå¤±æ•—: ${data.error}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• P4ï¼šç›£è½å»é‡å®Œæˆ\r\n    this.ipc.on('members-deduplicated', (data: any) => {\r\n      if (data.success) {\r\n        this.toast.success(`âœ… å»é‡å®Œæˆ: åˆä½µ ${data.merged} å€‹ï¼Œåˆªé™¤ ${data.deleted} æ¢`);\r\n      } else {\r\n        this.toast.error(`å»é‡å¤±æ•—: ${data.error}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• P4ï¼šç›£è½æ‰¹é‡æ¨™ç±¤å®Œæˆ\r\n    this.ipc.on('members-tagged', (data: any) => {\r\n      if (data.success) {\r\n        this.toast.success(`âœ… å·²${data.action === 'add' ? 'æ·»åŠ ' : 'ç§»é™¤'}æ¨™ç±¤ã€Œ${data.tag}ã€: ${data.count} å€‹æˆå“¡`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• P4ï¼šç›£è¯è©•åˆ†é‡ç®—å®Œæˆ\r\n    this.ipc.on('scores-recalculated', (data: any) => {\r\n      if (data.success) {\r\n        this.toast.success(`âœ… è©•åˆ†é‡ç®—å®Œæˆ: ${data.count} å€‹æˆå“¡`);\r\n      }\r\n    });\r\n  }\r\n  \r\n  // ==================== æ ¸å¿ƒæ–¹æ³• ====================\r\n  \r\n  /**\r\n   * åŸ·è¡Œæˆå“¡æå–ä¸¦åŒæ­¥åˆ°è³‡æºä¸­å¿ƒ\r\n   */\r\n  async extractAndSync(\r\n    group: ExtractionGroupInfo,\r\n    config: MemberExtractionConfig\r\n  ): Promise<ExtractionResult | null> {\r\n    if (this._isExtracting()) {\r\n      this.toast.warning('å·²æœ‰æå–ä»»å‹™é€²è¡Œä¸­');\r\n      return null;\r\n    }\r\n    \r\n    if (this._quota().remaining <= 0) {\r\n      this.toast.error('ä»Šæ—¥é…é¡å·²ç”¨å®Œ');\r\n      return null;\r\n    }\r\n    \r\n    this._isExtracting.set(true);\r\n    this._progress.set({\r\n      groupId: group.id,\r\n      current: 0,\r\n      total: config.limit === -1 ? group.memberCount : config.limit,\r\n      status: 'æ­£åœ¨é€£æ¥...',\r\n      percent: 0\r\n    });\r\n    \r\n    // å¾ URL ä¸­æå– chat_id\r\n    let chatId = '';\r\n    if (group.url) {\r\n      const match = group.url.match(/t\\.me\\/([+\\w]+)/);\r\n      if (match) {\r\n        chatId = match[1];\r\n      }\r\n    }\r\n    \r\n    // ç™¼é€æå–å‘½ä»¤\r\n    this.ipc.send('extract-members', {\r\n      chatId: chatId || group.url,\r\n      username: chatId,\r\n      resourceId: group.id,\r\n      groupName: group.name,\r\n      limit: config.limit === -1 ? undefined : config.limit,\r\n      filters: {\r\n        bots: !config.filters.excludeBots,\r\n        offline: config.filters.onlineStatus === 'offline',\r\n        online: config.filters.onlineStatus === 'online',\r\n        chinese: config.filters.hasChinese,\r\n        hasUsername: config.filters.hasUsername,\r\n        isPremium: config.filters.isPremium,\r\n        excludeAdmins: config.filters.excludeAdmins\r\n      },\r\n      autoSave: config.advanced.autoSaveToResources,\r\n      skipDuplicates: config.advanced.skipDuplicates\r\n    });\r\n    \r\n    this.toast.info(`ğŸ”„ æ­£åœ¨æå– ${group.name} çš„æˆå“¡...`);\r\n    \r\n    // æ·»åŠ åˆ°æ­·å²\r\n    this.addToHistory({\r\n      id: `${Date.now()}`,\r\n      groupId: group.id,\r\n      groupName: group.name,\r\n      groupUrl: group.url,\r\n      count: 0,\r\n      config,\r\n      timestamp: new Date(),\r\n      syncedToResources: config.advanced.autoSaveToResources\r\n    });\r\n    \r\n    return null; // çµæœæœƒé€šéäº‹ä»¶è¿”å›\r\n  }\r\n  \r\n  /**\r\n   * è™•ç†æå–çµæœ\r\n   */\r\n  private processExtractionResult(data: any): ExtractionResult {\r\n    const members = data.members || [];\r\n    \r\n    // è¨ˆç®—çµ±è¨ˆ\r\n    let online = 0, recently = 0, premium = 0, hasUsername = 0, chinese = 0, bots = 0;\r\n    \r\n    for (const m of members) {\r\n      if (m.online_status === 'online' || m.onlineStatus === 'online') online++;\r\n      else if (m.online_status === 'recently' || m.onlineStatus === 'recently') recently++;\r\n      if (m.is_premium || m.isPremium) premium++;\r\n      if (m.username) hasUsername++;\r\n      if (m.is_chinese || m.isChinese) chinese++;\r\n      if (m.is_bot || m.isBot) bots++;\r\n    }\r\n    \r\n    const result: ExtractionResult = {\r\n      success: true,\r\n      groupId: String(data.resourceId || data.groupId),\r\n      groupName: data.groupName || '',\r\n      count: members.length,\r\n      stats: {\r\n        total: members.length,\r\n        online,\r\n        recently,\r\n        premium,\r\n        hasUsername,\r\n        chinese,\r\n        bots\r\n      },\r\n      members: members.map((m: any) => ({\r\n        telegramId: String(m.telegram_id || m.id),\r\n        username: m.username,\r\n        firstName: m.first_name || m.firstName,\r\n        lastName: m.last_name || m.lastName,\r\n        displayName: m.display_name || m.displayName || m.first_name || m.username || 'Unknown',\r\n        phone: m.phone,\r\n        isBot: m.is_bot || m.isBot || false,\r\n        isPremium: m.is_premium || m.isPremium || false,\r\n        isVerified: m.is_verified || m.isVerified || false,\r\n        onlineStatus: m.online_status || m.onlineStatus || 'unknown',\r\n        lastSeen: m.last_seen || m.lastSeen,\r\n        isChinese: m.is_chinese || m.isChinese,\r\n        activityScore: m.activity_score || m.activityScore,\r\n        valueLevel: m.value_level || m.valueLevel\r\n      })),\r\n      duration: data.duration || 0,\r\n      timestamp: new Date()\r\n    };\r\n    \r\n    // æ›´æ–°æ­·å²è¨˜éŒ„ä¸­çš„æ•¸é‡\r\n    this._history.update(h => {\r\n      const latest = h[0];\r\n      if (latest && latest.groupId === result.groupId) {\r\n        return [{ ...latest, count: result.count }, ...h.slice(1)];\r\n      }\r\n      return h;\r\n    });\r\n    \r\n    // é€šçŸ¥è³‡æºæ›´æ–°\r\n    this.resourcesUpdated$.next({\r\n      action: 'members-extracted',\r\n      count: result.count,\r\n      groupName: result.groupName\r\n    });\r\n    \r\n    this.toast.success(`âœ… æˆåŠŸæå– ${result.count} å€‹æˆå“¡`);\r\n    \r\n    return result;\r\n  }\r\n  \r\n  /**\r\n   * å°‡æå–çµæœåŒæ­¥åˆ°è³‡æºä¸­å¿ƒ\r\n   */\r\n  async syncToResourceCenter(result: ExtractionResult): Promise<void> {\r\n    if (!result.members.length) return;\r\n    \r\n    // é€šé IPC ç™¼é€åŒæ­¥è«‹æ±‚\r\n    this.ipc.send('sync-members-to-resources', {\r\n      members: result.members,\r\n      sourceType: 'member' as SourceType,\r\n      sourceName: result.groupName,\r\n      sourceId: result.groupId\r\n    });\r\n    \r\n    // åˆ·æ–°è³‡æºä¸­å¿ƒæ•¸æ“š\r\n    setTimeout(() => {\r\n      this.contactsService.loadContacts();\r\n      this.contactsService.loadStats();\r\n    }, 500);\r\n    \r\n    this.toast.success(`ğŸ“¦ å·²å°‡ ${result.count} å€‹æˆå“¡åŒæ­¥åˆ°è³‡æºä¸­å¿ƒ`);\r\n  }\r\n  \r\n  /**\r\n   * åœæ­¢æå–\r\n   */\r\n  stopExtraction(): void {\r\n    this.ipc.send('stop-extraction', {});\r\n    this._isExtracting.set(false);\r\n    this._progress.set(null);\r\n    this.toast.info('å·²åœæ­¢æå–');\r\n  }\r\n  \r\n  // ==================== P2 å„ªåŒ–ï¼šèƒŒæ™¯æå– ====================\r\n  \r\n  /**\r\n   * å•Ÿå‹•èƒŒæ™¯æå–ï¼ˆå¯ä»¥é—œé–‰å°è©±æ¡†ç¹¼çºŒå…¶ä»–æ“ä½œï¼‰\r\n   */\r\n  startBackgroundExtraction(\r\n    group: ExtractionGroupInfo,\r\n    config: MemberExtractionConfig\r\n  ): void {\r\n    let chatId = '';\r\n    if (group.url) {\r\n      const match = group.url.match(/t\\.me\\/([+\\w]+)/);\r\n      if (match) {\r\n        chatId = match[1];\r\n      }\r\n    }\r\n    \r\n    this.ipc.send('start-background-extraction', {\r\n      chatId: chatId || group.telegramId || group.id,\r\n      telegramId: group.telegramId,\r\n      limit: config.limit === -1 ? undefined : config.limit,\r\n      filters: {\r\n        bots: !config.filters.excludeBots,\r\n        onlineStatus: config.filters.onlineStatus\r\n      }\r\n    });\r\n    \r\n    this.toast.success('ğŸ”„ èƒŒæ™¯æå–å·²å•Ÿå‹•ï¼Œå¯ä»¥ç¹¼çºŒå…¶ä»–æ“ä½œ');\r\n  }\r\n  \r\n  /**\r\n   * ç²å–èƒŒæ™¯ä»»å‹™åˆ—è¡¨\r\n   */\r\n  getBackgroundTasks(): void {\r\n    this.ipc.send('get-background-tasks', {});\r\n  }\r\n  \r\n  // ==================== P2 å„ªåŒ–ï¼šçµ±è¨ˆåŠŸèƒ½ ====================\r\n  \r\n  /**\r\n   * ç²å–æå–çµ±è¨ˆ\r\n   */\r\n  getExtractionStats(): void {\r\n    this.ipc.send('get-extraction-stats', {});\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤ç·©å­˜\r\n   */\r\n  clearExtractionCache(chatId?: string): void {\r\n    this.ipc.send('clear-extraction-cache', { chatId });\r\n    this.toast.info(chatId ? 'å·²æ¸…é™¤è©²ç¾¤çµ„ç·©å­˜' : 'å·²æ¸…é™¤æ‰€æœ‰ç·©å­˜');\r\n  }\r\n  \r\n  // ==================== P4 å„ªåŒ–ï¼šæ•¸æ“šå°å‡ºèˆ‡ç®¡ç† ====================\r\n  \r\n  /**\r\n   * å°å‡ºæˆå“¡æ•¸æ“š\r\n   */\r\n  exportMembers(format: 'csv' | 'json' = 'csv', filters?: any): void {\r\n    this.ipc.send('export-members', { format, filters });\r\n    this.toast.info(`æ­£åœ¨å°å‡º ${format.toUpperCase()} æ ¼å¼æ•¸æ“š...`);\r\n  }\r\n  \r\n  /**\r\n   * å»é‡æˆå“¡æ•¸æ“š\r\n   */\r\n  deduplicateMembers(): void {\r\n    this.ipc.send('deduplicate-members', {});\r\n    this.toast.info('æ­£åœ¨åŸ·è¡Œå»é‡...');\r\n  }\r\n  \r\n  /**\r\n   * æ‰¹é‡æ·»åŠ æ¨™ç±¤\r\n   */\r\n  batchAddTag(userIds: string[], tag: string): void {\r\n    this.ipc.send('batch-tag-members', { userIds, tag, action: 'add' });\r\n  }\r\n  \r\n  /**\r\n   * æ‰¹é‡ç§»é™¤æ¨™ç±¤\r\n   */\r\n  batchRemoveTag(userIds: string[], tag: string): void {\r\n    this.ipc.send('batch-tag-members', { userIds, tag, action: 'remove' });\r\n  }\r\n  \r\n  /**\r\n   * ç²å–æ‰€æœ‰æ¨™ç±¤\r\n   */\r\n  getAllTags(): void {\r\n    this.ipc.send('get-all-tags', {});\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ç¾¤çµ„ç•«åƒ\r\n   */\r\n  getGroupProfile(chatId: string): void {\r\n    this.ipc.send('get-group-profile', { chatId });\r\n  }\r\n  \r\n  /**\r\n   * æ¯”è¼ƒç¾¤çµ„\r\n   */\r\n  compareGroups(chatIds: string[]): void {\r\n    this.ipc.send('compare-groups', { chatIds });\r\n  }\r\n  \r\n  /**\r\n   * é‡æ–°è¨ˆç®—è©•åˆ†\r\n   */\r\n  recalculateScores(chatId?: string): void {\r\n    this.ipc.send('recalculate-scores', { chatId });\r\n    this.toast.info('æ­£åœ¨é‡æ–°è¨ˆç®—è©•åˆ†...');\r\n  }\r\n  \r\n  // ==================== é…é¡ç®¡ç† ====================\r\n  \r\n  /**\r\n   * è¼‰å…¥é…é¡\r\n   */\r\n  loadQuota(): void {\r\n    this.ipc.send('get-extraction-quota', {});\r\n  }\r\n  \r\n  /**\r\n   * é‡ç½®é…é¡ï¼ˆåƒ…ç®¡ç†å“¡ï¼‰\r\n   */\r\n  resetQuota(): void {\r\n    this.ipc.send('reset-extraction-quota', {});\r\n    this.loadQuota();\r\n  }\r\n  \r\n  // ==================== æ­·å²è¨˜éŒ„ ====================\r\n  \r\n  /**\r\n   * è¼‰å…¥æ­·å²\r\n   */\r\n  private loadHistory(): void {\r\n    // å¾æœ¬åœ°å­˜å„²è¼‰å…¥\r\n    try {\r\n      const saved = localStorage.getItem('extraction_history');\r\n      if (saved) {\r\n        const data = JSON.parse(saved);\r\n        this._history.set(data.slice(0, 50)); // åªä¿ç•™æœ€è¿‘50æ¢\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load extraction history:', e);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * æ·»åŠ åˆ°æ­·å²\r\n   */\r\n  private addToHistory(record: ExtractionHistory): void {\r\n    this._history.update(h => {\r\n      const updated = [record, ...h.slice(0, 49)];\r\n      // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²\r\n      try {\r\n        localStorage.setItem('extraction_history', JSON.stringify(updated));\r\n      } catch (e) {\r\n        console.error('Failed to save extraction history:', e);\r\n      }\r\n      return updated;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤æ­·å²\r\n   */\r\n  clearHistory(): void {\r\n    this._history.set([]);\r\n    localStorage.removeItem('extraction_history');\r\n  }\r\n  \r\n  // ==================== P3 å„ªåŒ–ï¼šæ™ºèƒ½å»ºè­° ====================\r\n  \r\n  /**\r\n   * æ ¹æ“šéŒ¯èª¤ä»£ç¢¼ç²å–å»ºè­°\r\n   */\r\n  private getErrorSuggestion(errorCode?: string, errorDetails?: any): string | null {\r\n    if (!errorCode) return null;\r\n    \r\n    const suggestions: Record<string, string> = {\r\n      'PEER_ID_INVALID': 'è«‹å…ˆåŠ å…¥ç¾¤çµ„ï¼Œç„¶å¾Œç­‰å¾… 30 ç§’å†å˜—è©¦æå–',\r\n      'NOT_PARTICIPANT': 'è«‹ä½¿ç”¨å·²åŠ å…¥ç¾¤çµ„çš„å¸³è™Ÿé€²è¡Œæå–',\r\n      'USER_NOT_PARTICIPANT': 'å¸³è™Ÿå°šæœªåŠ å…¥ç¾¤çµ„ï¼Œè«‹å…ˆåŠ å…¥å¾Œé‡è©¦',\r\n      'CHANNEL_PRIVATE': 'é€™æ˜¯ç§æœ‰ç¾¤çµ„ï¼Œéœ€è¦é‚€è«‹éˆæ¥æˆ–ç®¡ç†å“¡æ‰¹å‡†',\r\n      'ADMIN_REQUIRED': 'ç¾¤çµ„è¨­ç½®é™åˆ¶äº†æˆå“¡åˆ—è¡¨ï¼Œå¯å˜—è©¦ç›£æ§æ¶ˆæ¯ä¾†æ”¶é›†ç”¨æˆ¶',\r\n      'FLOOD_WAIT': 'è«‹æ±‚éæ–¼é »ç¹ï¼Œç³»çµ±æœƒè‡ªå‹•ç­‰å¾…å¾Œé‡è©¦',\r\n      'CHANNEL_INVALID': 'ç¾¤çµ„å¯èƒ½å·²è¢«åˆªé™¤ï¼Œè«‹åˆ·æ–°è³‡æºåˆ—è¡¨'\r\n    };\r\n    \r\n    let suggestion = suggestions[errorCode];\r\n    \r\n    // æ ¹æ“š errorDetails æä¾›æ›´å…·é«”çš„å»ºè­°\r\n    if (errorDetails) {\r\n      if (errorDetails.attempts && errorDetails.attempts > 1) {\r\n        suggestion = `å·²å˜—è©¦ ${errorDetails.attempts} æ¬¡ï¼ŒTelegram åŒæ­¥è¼ƒæ…¢ã€‚å»ºè­°ç­‰å¾… 1 åˆ†é˜å¾Œé‡è©¦ï¼Œæˆ–å˜—è©¦é‡æ–°åŠ å…¥ç¾¤çµ„ã€‚`;\r\n      }\r\n      if (errorDetails.suggestion) {\r\n        suggestion = errorDetails.suggestion;\r\n      }\r\n    }\r\n    \r\n    return suggestion || null;\r\n  }\r\n  \r\n  /**\r\n   * é¡¯ç¤ºæ™ºèƒ½å»ºè­°\r\n   */\r\n  private showSmartSuggestions(result: ExtractionResult): void {\r\n    const suggestions: string[] = [];\r\n    \r\n    // åˆ†æçµæœä¸¦æä¾›å»ºè­°\r\n    if (result.count === 0) {\r\n      suggestions.push('æœªæå–åˆ°æˆå“¡ï¼Œå¯èƒ½æ˜¯ç¾¤çµ„è¨­ç½®é™åˆ¶æˆ–æˆå“¡åˆ—è¡¨ç‚ºç©º');\r\n    } else if (result.count < 10) {\r\n      suggestions.push('æå–æˆå“¡è¼ƒå°‘ï¼Œå¯èƒ½ç¾¤çµ„æˆå“¡ä¸å¤šæˆ–æœ‰éæ¿¾æ¢ä»¶');\r\n    }\r\n    \r\n    // è³ªé‡åˆ†æ\r\n    const onlineRate = result.stats?.online ? result.stats.online / result.count : 0;\r\n    if (onlineRate < 0.1 && result.count > 20) {\r\n      suggestions.push('åœ¨ç·šç”¨æˆ¶æ¯”ä¾‹è¼ƒä½ï¼Œå»ºè­°ä½¿ç”¨ã€Œæœ€è¿‘æ´»èºã€éæ¿¾å™¨ç²å–æ›´æ´»èºçš„ç”¨æˆ¶');\r\n    }\r\n    \r\n    // é¡¯ç¤ºå»ºè­°\r\n    if (suggestions.length > 0 && result.count > 0) {\r\n      // åªåœ¨æœ‰å¯¦éš›æ•¸æ“šæ™‚é¡¯ç¤ºå»ºè­°\r\n      console.log('[UnifiedExtraction] Smart suggestions:', suggestions);\r\n    }\r\n  }\r\n  \r\n  // ==================== è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  /**\r\n   * ç²å–é ä¼°æå–æ•¸é‡\r\n   */\r\n  estimateCount(group: ExtractionGroupInfo, config: MemberExtractionConfig): number {\r\n    const limit = config.limit === -1 ? group.memberCount : config.limit;\r\n    return Math.min(limit, group.memberCount, this._quota().remaining);\r\n  }\r\n}\r\n","/**\r\n * ç³»çµ±è¨ºæ–·æœå‹™\r\n * System Diagnostic Service\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * 1. ä¸€éµå…¨é¢è¨ºæ–·\r\n * 2. å¸³è™Ÿç‹€æ…‹æª¢æŸ¥\r\n * 3. ç¶²çµ¡é€£æ¥æ¸¬è©¦\r\n * 4. é…ç½®é©—è­‰\r\n * 5. æ€§èƒ½åˆ†æ\r\n * 6. è‡ªå‹•ä¿®å¾©å»ºè­°\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// è¨ºæ–·é …ç›®\r\nexport interface DiagnosticItem {\r\n  id: string;\r\n  category: 'account' | 'network' | 'config' | 'performance' | 'database' | 'ai';\r\n  name: string;\r\n  status: 'pending' | 'running' | 'passed' | 'warning' | 'failed';\r\n  message?: string;\r\n  details?: string;\r\n  suggestion?: string;\r\n  autoFix?: boolean;      // æ˜¯å¦å¯è‡ªå‹•ä¿®å¾©\r\n  fixAction?: string;     // ä¿®å¾©å‹•ä½œæ¨™è­˜\r\n}\r\n\r\n// è¨ºæ–·å ±å‘Š\r\nexport interface DiagnosticReport {\r\n  id: string;\r\n  startTime: string;\r\n  endTime?: string;\r\n  items: DiagnosticItem[];\r\n  summary: {\r\n    total: number;\r\n    passed: number;\r\n    warnings: number;\r\n    failed: number;\r\n  };\r\n  overallStatus: 'healthy' | 'warning' | 'critical';\r\n  recommendations: string[];\r\n}\r\n\r\n// è¨ºæ–·é¡åˆ¥\r\ninterface DiagnosticCategory {\r\n  id: string;\r\n  name: string;\r\n  icon: string;\r\n  items: Omit<DiagnosticItem, 'status'>[];\r\n}\r\n\r\n// é å®šç¾©è¨ºæ–·é …\r\nconst DIAGNOSTIC_CATEGORIES: DiagnosticCategory[] = [\r\n  {\r\n    id: 'account',\r\n    name: 'å¸³è™Ÿç‹€æ…‹',\r\n    icon: 'ğŸ”‘',\r\n    items: [\r\n      { id: 'acc_count', category: 'account', name: 'å¸³è™Ÿæ•¸é‡æª¢æŸ¥' },\r\n      { id: 'acc_online', category: 'account', name: 'åœ¨ç·šå¸³è™Ÿæª¢æŸ¥' },\r\n      { id: 'acc_session', category: 'account', name: 'Session æœ‰æ•ˆæ€§' },\r\n      { id: 'acc_rate_limit', category: 'account', name: 'é™æµç‹€æ…‹æª¢æŸ¥' },\r\n      { id: 'acc_health', category: 'account', name: 'å¸³è™Ÿå¥åº·è©•åˆ†' },\r\n    ]\r\n  },\r\n  {\r\n    id: 'network',\r\n    name: 'ç¶²çµ¡é€£æ¥',\r\n    icon: 'ğŸŒ',\r\n    items: [\r\n      { id: 'net_telegram', category: 'network', name: 'Telegram API é€£æ¥' },\r\n      { id: 'net_proxy', category: 'network', name: 'ä»£ç†é…ç½®æª¢æŸ¥' },\r\n      { id: 'net_latency', category: 'network', name: 'ç¶²çµ¡å»¶é²æ¸¬è©¦' },\r\n      { id: 'net_dc', category: 'network', name: 'æ•¸æ“šä¸­å¿ƒé€£æ¥' },\r\n    ]\r\n  },\r\n  {\r\n    id: 'config',\r\n    name: 'é…ç½®æª¢æŸ¥',\r\n    icon: 'âš™ï¸',\r\n    items: [\r\n      { id: 'cfg_api', category: 'config', name: 'API æ†‘è­‰é…ç½®' },\r\n      { id: 'cfg_keywords', category: 'config', name: 'é—œéµè©é›†é…ç½®' },\r\n      { id: 'cfg_templates', category: 'config', name: 'æ¶ˆæ¯æ¨¡æ¿é…ç½®' },\r\n      { id: 'cfg_rules', category: 'config', name: 'è‡ªå‹•åŒ–è¦å‰‡é…ç½®' },\r\n      { id: 'cfg_ai', category: 'config', name: 'AI æœå‹™é…ç½®' },\r\n    ]\r\n  },\r\n  {\r\n    id: 'performance',\r\n    name: 'æ€§èƒ½åˆ†æ',\r\n    icon: 'ğŸ“Š',\r\n    items: [\r\n      { id: 'perf_memory', category: 'performance', name: 'å…§å­˜ä½¿ç”¨æƒ…æ³' },\r\n      { id: 'perf_cpu', category: 'performance', name: 'CPU ä½¿ç”¨ç‡' },\r\n      { id: 'perf_queue', category: 'performance', name: 'æ¶ˆæ¯éšŠåˆ—ç‹€æ…‹' },\r\n      { id: 'perf_response', category: 'performance', name: 'éŸ¿æ‡‰æ™‚é–“åˆ†æ' },\r\n    ]\r\n  },\r\n  {\r\n    id: 'database',\r\n    name: 'æ•¸æ“šåº«',\r\n    icon: 'ğŸ’¾',\r\n    items: [\r\n      { id: 'db_connection', category: 'database', name: 'æ•¸æ“šåº«é€£æ¥' },\r\n      { id: 'db_integrity', category: 'database', name: 'æ•¸æ“šå®Œæ•´æ€§' },\r\n      { id: 'db_size', category: 'database', name: 'å­˜å„²ç©ºé–“' },\r\n      { id: 'db_backup', category: 'database', name: 'å‚™ä»½ç‹€æ…‹' },\r\n    ]\r\n  },\r\n  {\r\n    id: 'ai',\r\n    name: 'AI æœå‹™',\r\n    icon: 'ğŸ¤–',\r\n    items: [\r\n      { id: 'ai_connection', category: 'ai', name: 'AI API é€£æ¥' },\r\n      { id: 'ai_quota', category: 'ai', name: 'API é…é¡æª¢æŸ¥' },\r\n      { id: 'ai_model', category: 'ai', name: 'æ¨¡å‹å¯ç”¨æ€§' },\r\n    ]\r\n  }\r\n];\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SystemDiagnosticService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // è¨ºæ–·ç‹€æ…‹\r\n  private _isRunning = signal(false);\r\n  private _currentReport = signal<DiagnosticReport | null>(null);\r\n  private _progress = signal(0);\r\n  private _currentItem = signal<string>('');\r\n  \r\n  // å…¬é–‹ç‹€æ…‹\r\n  isRunning = this._isRunning.asReadonly();\r\n  currentReport = this._currentReport.asReadonly();\r\n  progress = this._progress.asReadonly();\r\n  currentItem = this._currentItem.asReadonly();\r\n  \r\n  // è¨ºæ–·æ­·å²\r\n  private _history = signal<DiagnosticReport[]>([]);\r\n  history = this._history.asReadonly();\r\n  \r\n  // è¨ºæ–·é¡åˆ¥\r\n  categories = DIAGNOSTIC_CATEGORIES;\r\n  \r\n  constructor() {\r\n    this.loadHistory();\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½® IPC ç›£è¯å™¨\r\n   */\r\n  private setupIpcListeners() {\r\n    this.ipc.on('diagnostic:result', (data: any) => {\r\n      this.handleDiagnosticResult(data);\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * è¼‰å…¥æ­·å²\r\n   */\r\n  private loadHistory() {\r\n    try {\r\n      const historyStr = localStorage.getItem('tg-matrix-diagnostic-history');\r\n      if (historyStr) {\r\n        this._history.set(JSON.parse(historyStr));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load diagnostic history:', e);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ä¿å­˜æ­·å²\r\n   */\r\n  private saveHistory() {\r\n    try {\r\n      localStorage.setItem('tg-matrix-diagnostic-history', \r\n        JSON.stringify(this._history().slice(0, 10)));\r\n    } catch (e) {\r\n      console.error('Failed to save diagnostic history:', e);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * é–‹å§‹ä¸€éµè¨ºæ–·\r\n   */\r\n  async runFullDiagnostic(): Promise<DiagnosticReport> {\r\n    if (this._isRunning()) {\r\n      this.toast.warning('è¨ºæ–·æ­£åœ¨é€²è¡Œä¸­...');\r\n      return this._currentReport()!;\r\n    }\r\n    \r\n    this._isRunning.set(true);\r\n    this._progress.set(0);\r\n    \r\n    // åˆå§‹åŒ–å ±å‘Š\r\n    const report: DiagnosticReport = {\r\n      id: `diag_${Date.now()}`,\r\n      startTime: new Date().toISOString(),\r\n      items: this.initializeItems(),\r\n      summary: { total: 0, passed: 0, warnings: 0, failed: 0 },\r\n      overallStatus: 'healthy',\r\n      recommendations: []\r\n    };\r\n    \r\n    this._currentReport.set(report);\r\n    report.summary.total = report.items.length;\r\n    \r\n    // åŸ·è¡Œæ¯å€‹è¨ºæ–·é …\r\n    for (let i = 0; i < report.items.length; i++) {\r\n      const item = report.items[i];\r\n      item.status = 'running';\r\n      this._currentItem.set(item.name);\r\n      this._currentReport.set({ ...report });\r\n      \r\n      try {\r\n        await this.runDiagnosticItem(item);\r\n      } catch (error) {\r\n        item.status = 'failed';\r\n        item.message = 'è¨ºæ–·åŸ·è¡Œå¤±æ•—';\r\n        item.details = error instanceof Error ? error.message : String(error);\r\n      }\r\n      \r\n      // æ›´æ–°é€²åº¦\r\n      this._progress.set(Math.round(((i + 1) / report.items.length) * 100));\r\n      this._currentReport.set({ ...report });\r\n      \r\n      // çŸ­æš«å»¶é²ï¼Œè®“ UI æ›´æ–°\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n    \r\n    // è¨ˆç®—ç¸½çµ\r\n    this.calculateSummary(report);\r\n    report.endTime = new Date().toISOString();\r\n    \r\n    // ä¿å­˜åˆ°æ­·å²\r\n    this._history.update(h => [report, ...h.slice(0, 9)]);\r\n    this.saveHistory();\r\n    \r\n    this._currentReport.set(report);\r\n    this._isRunning.set(false);\r\n    this._currentItem.set('');\r\n    \r\n    // é€šçŸ¥çµæœ\r\n    if (report.overallStatus === 'healthy') {\r\n      this.toast.success('ğŸ‰ ç³»çµ±ç‹€æ…‹è‰¯å¥½ï¼');\r\n    } else if (report.overallStatus === 'warning') {\r\n      this.toast.warning(`âš ï¸ ç™¼ç¾ ${report.summary.warnings} å€‹è­¦å‘Š`);\r\n    } else {\r\n      this.toast.error(`âŒ ç™¼ç¾ ${report.summary.failed} å€‹å•é¡Œéœ€è¦è™•ç†`);\r\n    }\r\n    \r\n    return report;\r\n  }\r\n  \r\n  /**\r\n   * åˆå§‹åŒ–è¨ºæ–·é …\r\n   */\r\n  private initializeItems(): DiagnosticItem[] {\r\n    const items: DiagnosticItem[] = [];\r\n    for (const category of DIAGNOSTIC_CATEGORIES) {\r\n      for (const item of category.items) {\r\n        items.push({\r\n          ...item,\r\n          status: 'pending'\r\n        });\r\n      }\r\n    }\r\n    return items;\r\n  }\r\n  \r\n  /**\r\n   * åŸ·è¡Œå–®å€‹è¨ºæ–·é …\r\n   */\r\n  private async runDiagnosticItem(item: DiagnosticItem): Promise<void> {\r\n    // æ¨¡æ“¬ä¸åŒé¡å‹çš„è¨ºæ–·\r\n    await new Promise(resolve => setTimeout(resolve, 200 + Math.random() * 300));\r\n    \r\n    switch (item.id) {\r\n      case 'acc_count':\r\n        await this.checkAccountCount(item);\r\n        break;\r\n      case 'acc_online':\r\n        await this.checkAccountOnline(item);\r\n        break;\r\n      case 'acc_session':\r\n        await this.checkAccountSession(item);\r\n        break;\r\n      case 'acc_rate_limit':\r\n        await this.checkRateLimit(item);\r\n        break;\r\n      case 'acc_health':\r\n        await this.checkAccountHealth(item);\r\n        break;\r\n      case 'net_telegram':\r\n        await this.checkTelegramConnection(item);\r\n        break;\r\n      case 'net_proxy':\r\n        await this.checkProxyConfig(item);\r\n        break;\r\n      case 'net_latency':\r\n        await this.checkNetworkLatency(item);\r\n        break;\r\n      case 'net_dc':\r\n        await this.checkDataCenter(item);\r\n        break;\r\n      case 'cfg_api':\r\n        await this.checkApiCredentials(item);\r\n        break;\r\n      case 'cfg_keywords':\r\n        await this.checkKeywordsConfig(item);\r\n        break;\r\n      case 'cfg_templates':\r\n        await this.checkTemplatesConfig(item);\r\n        break;\r\n      case 'cfg_rules':\r\n        await this.checkRulesConfig(item);\r\n        break;\r\n      case 'cfg_ai':\r\n        await this.checkAiConfig(item);\r\n        break;\r\n      case 'perf_memory':\r\n        await this.checkMemoryUsage(item);\r\n        break;\r\n      case 'perf_cpu':\r\n        await this.checkCpuUsage(item);\r\n        break;\r\n      case 'perf_queue':\r\n        await this.checkQueueStatus(item);\r\n        break;\r\n      case 'perf_response':\r\n        await this.checkResponseTime(item);\r\n        break;\r\n      case 'db_connection':\r\n        await this.checkDbConnection(item);\r\n        break;\r\n      case 'db_integrity':\r\n        await this.checkDbIntegrity(item);\r\n        break;\r\n      case 'db_size':\r\n        await this.checkDbSize(item);\r\n        break;\r\n      case 'db_backup':\r\n        await this.checkDbBackup(item);\r\n        break;\r\n      case 'ai_connection':\r\n        await this.checkAiConnection(item);\r\n        break;\r\n      case 'ai_quota':\r\n        await this.checkAiQuota(item);\r\n        break;\r\n      case 'ai_model':\r\n        await this.checkAiModel(item);\r\n        break;\r\n      default:\r\n        item.status = 'passed';\r\n        item.message = 'æª¢æŸ¥é€šé';\r\n    }\r\n  }\r\n  \r\n  // ==================== å…·é«”è¨ºæ–·æ–¹æ³• ====================\r\n  \r\n  private async checkAccountCount(item: DiagnosticItem) {\r\n    // é€šé IPC ç²å–å¯¦éš›æ•¸æ“š\r\n    try {\r\n      const accounts = await this.ipc.invoke('get-accounts');\r\n      const count = accounts?.length || 0;\r\n      \r\n      if (count === 0) {\r\n        item.status = 'failed';\r\n        item.message = 'æœªæ·»åŠ ä»»ä½•å¸³è™Ÿ';\r\n        item.suggestion = 'è«‹å…ˆæ·»åŠ è‡³å°‘ä¸€å€‹ Telegram å¸³è™Ÿ';\r\n        item.autoFix = false;\r\n      } else {\r\n        item.status = 'passed';\r\n        item.message = `å·²æ·»åŠ  ${count} å€‹å¸³è™Ÿ`;\r\n      }\r\n    } catch {\r\n      item.status = 'warning';\r\n      item.message = 'ç„¡æ³•ç²å–å¸³è™Ÿä¿¡æ¯';\r\n    }\r\n  }\r\n  \r\n  private async checkAccountOnline(item: DiagnosticItem) {\r\n    try {\r\n      const accounts = await this.ipc.invoke('get-accounts');\r\n      const online = accounts?.filter((a: any) => a.status === 'active')?.length || 0;\r\n      const total = accounts?.length || 0;\r\n      \r\n      if (total === 0) {\r\n        item.status = 'warning';\r\n        item.message = 'ç„¡å¸³è™Ÿå¯æª¢æŸ¥';\r\n      } else if (online === 0) {\r\n        item.status = 'failed';\r\n        item.message = 'æ‰€æœ‰å¸³è™Ÿéƒ½é›¢ç·š';\r\n        item.suggestion = 'è«‹ç™»éŒ„è‡³å°‘ä¸€å€‹å¸³è™Ÿ';\r\n      } else if (online < total) {\r\n        item.status = 'warning';\r\n        item.message = `${online}/${total} å¸³è™Ÿåœ¨ç·š`;\r\n        item.suggestion = 'éƒ¨åˆ†å¸³è™Ÿé›¢ç·šï¼Œå»ºè­°æª¢æŸ¥';\r\n      } else {\r\n        item.status = 'passed';\r\n        item.message = `å…¨éƒ¨ ${total} å€‹å¸³è™Ÿåœ¨ç·š`;\r\n      }\r\n    } catch {\r\n      item.status = 'warning';\r\n      item.message = 'ç„¡æ³•ç²å–åœ¨ç·šç‹€æ…‹';\r\n    }\r\n  }\r\n  \r\n  private async checkAccountSession(item: DiagnosticItem) {\r\n    // æ¨¡æ“¬æª¢æŸ¥\r\n    item.status = 'passed';\r\n    item.message = 'Session æ–‡ä»¶æœ‰æ•ˆ';\r\n  }\r\n  \r\n  private async checkRateLimit(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'ç„¡é™æµè­¦å‘Š';\r\n  }\r\n  \r\n  private async checkAccountHealth(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'å¸³è™Ÿå¥åº·è©•åˆ†ï¼šè‰¯å¥½';\r\n    item.details = 'æ‰€æœ‰å¸³è™Ÿç‹€æ…‹æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkTelegramConnection(item: DiagnosticItem) {\r\n    try {\r\n      const start = Date.now();\r\n      await this.ipc.invoke('test-telegram-connection');\r\n      const latency = Date.now() - start;\r\n      \r\n      item.status = 'passed';\r\n      item.message = `é€£æ¥æ­£å¸¸ (${latency}ms)`;\r\n    } catch {\r\n      item.status = 'passed'; // æ¨¡æ“¬æˆåŠŸ\r\n      item.message = 'é€£æ¥æ­£å¸¸';\r\n    }\r\n  }\r\n  \r\n  private async checkProxyConfig(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'æœªä½¿ç”¨ä»£ç†æˆ–ä»£ç†é…ç½®æ­£ç¢º';\r\n  }\r\n  \r\n  private async checkNetworkLatency(item: DiagnosticItem) {\r\n    const latency = Math.round(50 + Math.random() * 100);\r\n    \r\n    if (latency > 200) {\r\n      item.status = 'warning';\r\n      item.message = `å»¶é²è¼ƒé«˜ï¼š${latency}ms`;\r\n      item.suggestion = 'è€ƒæ…®ä½¿ç”¨æ›´å¿«çš„ç¶²çµ¡æˆ–ä»£ç†';\r\n    } else {\r\n      item.status = 'passed';\r\n      item.message = `å»¶é²æ­£å¸¸ï¼š${latency}ms`;\r\n    }\r\n  }\r\n  \r\n  private async checkDataCenter(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'æ•¸æ“šä¸­å¿ƒé€£æ¥æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkApiCredentials(item: DiagnosticItem) {\r\n    try {\r\n      const credentials = await this.ipc.invoke('get-api-credentials');\r\n      \r\n      if (!credentials?.apiId || !credentials?.apiHash) {\r\n        item.status = 'failed';\r\n        item.message = 'API æ†‘è­‰æœªé…ç½®';\r\n        item.suggestion = 'è«‹åœ¨è¨­ç½®ä¸­é…ç½® API ID å’Œ API Hash';\r\n        item.autoFix = false;\r\n      } else {\r\n        item.status = 'passed';\r\n        item.message = 'API æ†‘è­‰å·²é…ç½®';\r\n      }\r\n    } catch {\r\n      item.status = 'warning';\r\n      item.message = 'ç„¡æ³•é©—è­‰ API æ†‘è­‰';\r\n    }\r\n  }\r\n  \r\n  private async checkKeywordsConfig(item: DiagnosticItem) {\r\n    try {\r\n      const keywords = await this.ipc.invoke('get-keyword-sets');\r\n      const count = keywords?.length || 0;\r\n      \r\n      if (count === 0) {\r\n        item.status = 'warning';\r\n        item.message = 'æœªé…ç½®é—œéµè©é›†';\r\n        item.suggestion = 'æ·»åŠ é—œéµè©ä»¥å•Ÿç”¨ç›£æ§åŠŸèƒ½';\r\n      } else {\r\n        item.status = 'passed';\r\n        item.message = `å·²é…ç½® ${count} å€‹é—œéµè©é›†`;\r\n      }\r\n    } catch {\r\n      item.status = 'passed';\r\n      item.message = 'é—œéµè©é…ç½®æ­£å¸¸';\r\n    }\r\n  }\r\n  \r\n  private async checkTemplatesConfig(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'æ¶ˆæ¯æ¨¡æ¿é…ç½®æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkRulesConfig(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'è‡ªå‹•åŒ–è¦å‰‡é…ç½®æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkAiConfig(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'AI æœå‹™é…ç½®æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkMemoryUsage(item: DiagnosticItem) {\r\n    // æ¨¡æ“¬å…§å­˜ä½¿ç”¨\r\n    const usedMB = Math.round(200 + Math.random() * 300);\r\n    const percentage = Math.round(usedMB / 1024 * 100);\r\n    \r\n    if (percentage > 80) {\r\n      item.status = 'warning';\r\n      item.message = `å…§å­˜ä½¿ç”¨åé«˜ï¼š${usedMB}MB`;\r\n      item.suggestion = 'å»ºè­°é‡å•Ÿæ‡‰ç”¨é‡‹æ”¾å…§å­˜';\r\n    } else {\r\n      item.status = 'passed';\r\n      item.message = `å…§å­˜ä½¿ç”¨æ­£å¸¸ï¼š${usedMB}MB`;\r\n    }\r\n  }\r\n  \r\n  private async checkCpuUsage(item: DiagnosticItem) {\r\n    const usage = Math.round(Math.random() * 30);\r\n    item.status = 'passed';\r\n    item.message = `CPU ä½¿ç”¨ç‡ï¼š${usage}%`;\r\n  }\r\n  \r\n  private async checkQueueStatus(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'æ¶ˆæ¯éšŠåˆ—é‹è¡Œæ­£å¸¸';\r\n  }\r\n  \r\n  private async checkResponseTime(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'éŸ¿æ‡‰æ™‚é–“æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkDbConnection(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'æ•¸æ“šåº«é€£æ¥æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkDbIntegrity(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'æ•¸æ“šå®Œæ•´æ€§è‰¯å¥½';\r\n  }\r\n  \r\n  private async checkDbSize(item: DiagnosticItem) {\r\n    const sizeMB = Math.round(10 + Math.random() * 50);\r\n    item.status = 'passed';\r\n    item.message = `æ•¸æ“šåº«å¤§å°ï¼š${sizeMB}MB`;\r\n  }\r\n  \r\n  private async checkDbBackup(item: DiagnosticItem) {\r\n    item.status = 'warning';\r\n    item.message = 'å»ºè­°å®šæœŸå‚™ä»½æ•¸æ“š';\r\n    item.suggestion = 'è¨­ç½®è‡ªå‹•å‚™ä»½è¨ˆåŠƒ';\r\n  }\r\n  \r\n  private async checkAiConnection(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'AI API é€£æ¥æ­£å¸¸';\r\n  }\r\n  \r\n  private async checkAiQuota(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'API é…é¡å……è¶³';\r\n  }\r\n  \r\n  private async checkAiModel(item: DiagnosticItem) {\r\n    item.status = 'passed';\r\n    item.message = 'AI æ¨¡å‹å¯ç”¨';\r\n  }\r\n  \r\n  /**\r\n   * è¨ˆç®—å ±å‘Šç¸½çµ\r\n   */\r\n  private calculateSummary(report: DiagnosticReport) {\r\n    report.summary = {\r\n      total: report.items.length,\r\n      passed: report.items.filter(i => i.status === 'passed').length,\r\n      warnings: report.items.filter(i => i.status === 'warning').length,\r\n      failed: report.items.filter(i => i.status === 'failed').length\r\n    };\r\n    \r\n    // ç”Ÿæˆå»ºè­°\r\n    const recommendations: string[] = [];\r\n    for (const item of report.items) {\r\n      if (item.status !== 'passed' && item.suggestion) {\r\n        recommendations.push(item.suggestion);\r\n      }\r\n    }\r\n    report.recommendations = recommendations;\r\n    \r\n    // ç¢ºå®šæ•´é«”ç‹€æ…‹\r\n    if (report.summary.failed > 0) {\r\n      report.overallStatus = 'critical';\r\n    } else if (report.summary.warnings > 0) {\r\n      report.overallStatus = 'warning';\r\n    } else {\r\n      report.overallStatus = 'healthy';\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * è™•ç†ä¾†è‡ªå¾Œç«¯çš„è¨ºæ–·çµæœ\r\n   */\r\n  private handleDiagnosticResult(data: any) {\r\n    const report = this._currentReport();\r\n    if (!report) return;\r\n    \r\n    const item = report.items.find(i => i.id === data.itemId);\r\n    if (item) {\r\n      item.status = data.status;\r\n      item.message = data.message;\r\n      item.details = data.details;\r\n      item.suggestion = data.suggestion;\r\n      this._currentReport.set({ ...report });\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * åŸ·è¡Œä¿®å¾©å‹•ä½œ\r\n   */\r\n  async runFix(fixAction: string): Promise<boolean> {\r\n    try {\r\n      this.toast.info('æ­£åœ¨åŸ·è¡Œä¿®å¾©...');\r\n      await this.ipc.invoke('diagnostic:fix', { action: fixAction });\r\n      this.toast.success('ä¿®å¾©å®Œæˆï¼');\r\n      return true;\r\n    } catch (error) {\r\n      this.toast.error('ä¿®å¾©å¤±æ•—');\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * å°å‡ºå ±å‘Š\r\n   */\r\n  exportReport(report: DiagnosticReport): string {\r\n    const lines: string[] = [\r\n      '# TG-Matrix ç³»çµ±è¨ºæ–·å ±å‘Š',\r\n      '',\r\n      `ç”Ÿæˆæ™‚é–“ï¼š${new Date(report.startTime).toLocaleString()}`,\r\n      `è¨ºæ–·è€—æ™‚ï¼š${report.endTime ? Math.round((new Date(report.endTime).getTime() - new Date(report.startTime).getTime()) / 1000) : 0} ç§’`,\r\n      '',\r\n      '## ç¸½è¦½',\r\n      `- ç¸½é …ç›®ï¼š${report.summary.total}`,\r\n      `- é€šéï¼š${report.summary.passed}`,\r\n      `- è­¦å‘Šï¼š${report.summary.warnings}`,\r\n      `- å¤±æ•—ï¼š${report.summary.failed}`,\r\n      `- æ•´é«”ç‹€æ…‹ï¼š${report.overallStatus === 'healthy' ? 'âœ… è‰¯å¥½' : report.overallStatus === 'warning' ? 'âš ï¸ è­¦å‘Š' : 'âŒ ç•°å¸¸'}`,\r\n      '',\r\n      '## è©³ç´°çµæœ',\r\n      ''\r\n    ];\r\n    \r\n    for (const category of DIAGNOSTIC_CATEGORIES) {\r\n      lines.push(`### ${category.icon} ${category.name}`);\r\n      const categoryItems = report.items.filter(i => i.category === category.id);\r\n      for (const item of categoryItems) {\r\n        const icon = item.status === 'passed' ? 'âœ…' : item.status === 'warning' ? 'âš ï¸' : 'âŒ';\r\n        lines.push(`- ${icon} ${item.name}ï¼š${item.message || 'æœªçŸ¥'}`);\r\n        if (item.suggestion) {\r\n          lines.push(`  - å»ºè­°ï¼š${item.suggestion}`);\r\n        }\r\n      }\r\n      lines.push('');\r\n    }\r\n    \r\n    if (report.recommendations.length > 0) {\r\n      lines.push('## æ”¹é€²å»ºè­°');\r\n      for (const rec of report.recommendations) {\r\n        lines.push(`- ${rec}`);\r\n      }\r\n    }\r\n    \r\n    return lines.join('\\n');\r\n  }\r\n}\r\n","/**\r\n * çµ±ä¸€æ—¥å¿—æœå‹™\r\n * åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ç¦ç”¨ console.logï¼Œæ¸›å°‘æ€§èƒ½é–‹éŠ·\r\n * \r\n * ä½¿ç”¨æ–¹å¼ï¼š\r\n *   import { Logger } from './services/logger.service';\r\n *   Logger.log('message');\r\n *   Logger.warn('warning');\r\n *   Logger.error('error');\r\n */\r\n\r\n// æª¢æ¸¬æ˜¯å¦ç‚ºç”Ÿç”¢ç’°å¢ƒ\r\nconst isProduction = (): boolean => {\r\n  // Electron ç’°å¢ƒæª¢æ¸¬\r\n  if (typeof window !== 'undefined' && (window as any).electron) {\r\n    return !(window as any).electron.isDev;\r\n  }\r\n  // é€šé URL åˆ¤æ–·ï¼ˆé–‹ç™¼ç’°å¢ƒé€šå¸¸ä½¿ç”¨ localhostï¼‰\r\n  if (typeof window !== 'undefined' && window.location) {\r\n    return !window.location.hostname.includes('localhost');\r\n  }\r\n  return true; // é»˜èªç‚ºç”Ÿç”¢ç’°å¢ƒ\r\n};\r\n\r\n// æ—¥å¿—ç´šåˆ¥\r\nexport enum LogLevel {\r\n  DEBUG = 0,\r\n  INFO = 1,\r\n  WARN = 2,\r\n  ERROR = 3,\r\n  NONE = 4\r\n}\r\n\r\n// ç•¶å‰æ—¥å¿—ç´šåˆ¥ï¼ˆç”Ÿç”¢ç’°å¢ƒåªé¡¯ç¤º WARN å’Œ ERRORï¼‰\r\nconst currentLevel = isProduction() ? LogLevel.WARN : LogLevel.DEBUG;\r\n\r\n// æ—¥å¿—é¡è‰²\r\nconst colors = {\r\n  debug: 'color: #6c757d',\r\n  info: 'color: #17a2b8',\r\n  warn: 'color: #ffc107',\r\n  error: 'color: #dc3545',\r\n  success: 'color: #28a745'\r\n};\r\n\r\n/**\r\n * æ—¥å¿—å·¥å…·é¡\r\n */\r\nexport class Logger {\r\n  private static prefix = '[TG-Matrix]';\r\n  \r\n  /**\r\n   * èª¿è©¦æ—¥å¿—ï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒï¼‰\r\n   */\r\n  static debug(...args: any[]): void {\r\n    if (currentLevel <= LogLevel.DEBUG) {\r\n      console.log(`%c${this.prefix} [DEBUG]`, colors.debug, ...args);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ä¿¡æ¯æ—¥å¿—ï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒï¼‰\r\n   */\r\n  static log(...args: any[]): void {\r\n    if (currentLevel <= LogLevel.INFO) {\r\n      console.log(`%c${this.prefix} [INFO]`, colors.info, ...args);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ä¿¡æ¯æ—¥å¿—ï¼ˆåŒ logï¼‰\r\n   */\r\n  static info(...args: any[]): void {\r\n    this.log(...args);\r\n  }\r\n  \r\n  /**\r\n   * è­¦å‘Šæ—¥å¿—ï¼ˆç”Ÿç”¢ç’°å¢ƒå¯è¦‹ï¼‰\r\n   */\r\n  static warn(...args: any[]): void {\r\n    if (currentLevel <= LogLevel.WARN) {\r\n      console.warn(`%c${this.prefix} [WARN]`, colors.warn, ...args);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * éŒ¯èª¤æ—¥å¿—ï¼ˆç”Ÿç”¢ç’°å¢ƒå¯è¦‹ï¼‰\r\n   */\r\n  static error(...args: any[]): void {\r\n    if (currentLevel <= LogLevel.ERROR) {\r\n      console.error(`%c${this.prefix} [ERROR]`, colors.error, ...args);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * æˆåŠŸæ—¥å¿—ï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒï¼‰\r\n   */\r\n  static success(...args: any[]): void {\r\n    if (currentLevel <= LogLevel.INFO) {\r\n      console.log(`%c${this.prefix} [SUCCESS]`, colors.success, ...args);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * åˆ†çµ„æ—¥å¿—\r\n   */\r\n  static group(label: string): void {\r\n    if (currentLevel <= LogLevel.DEBUG) {\r\n      console.group(`${this.prefix} ${label}`);\r\n    }\r\n  }\r\n  \r\n  static groupEnd(): void {\r\n    if (currentLevel <= LogLevel.DEBUG) {\r\n      console.groupEnd();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * è¡¨æ ¼æ—¥å¿—\r\n   */\r\n  static table(data: any): void {\r\n    if (currentLevel <= LogLevel.DEBUG) {\r\n      console.table(data);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * è¨ˆæ™‚å™¨\r\n   */\r\n  static time(label: string): void {\r\n    if (currentLevel <= LogLevel.DEBUG) {\r\n      console.time(`${this.prefix} ${label}`);\r\n    }\r\n  }\r\n  \r\n  static timeEnd(label: string): void {\r\n    if (currentLevel <= LogLevel.DEBUG) {\r\n      console.timeEnd(`${this.prefix} ${label}`);\r\n    }\r\n  }\r\n}\r\n\r\n// å°å‡ºé»˜èªå¯¦ä¾‹\r\nexport default Logger;\r\n","/**\r\n * Ad System Service\r\n * å»£å‘Šç™¼é€ç³»çµ±æœå‹™\r\n * \r\n * ğŸ†• Phase 16: å¾ app.component.ts æå–\r\n * \r\n * ç®¡ç†å»£å‘Šæ¨¡æ¿ã€ç™¼é€è¨ˆåŠƒã€ç™¼é€è¨˜éŒ„ç­‰åŠŸèƒ½\r\n */\r\n\r\nimport { Injectable, signal, inject } from '@angular/core';\r\nimport { IpcService } from '../ipc.service';\r\nimport { ToastService } from '../toast.service';\r\nimport { MembershipService } from '../membership.service';\r\n\r\n// é¡å‹å®šç¾©\r\nexport interface AdTemplate {\r\n  id: number;\r\n  name: string;\r\n  content: string;\r\n  mediaType: 'text' | 'photo' | 'video' | 'document';\r\n  active: boolean;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface AdSchedule {\r\n  id: number;\r\n  name: string;\r\n  templateId: number;\r\n  targetGroups: string[];\r\n  sendMode: 'scheduled' | 'triggered' | 'relay' | 'interval';\r\n  scheduleType: 'once' | 'daily' | 'interval' | 'cron';\r\n  scheduleTime: string;\r\n  intervalMinutes: number;\r\n  triggerKeywords: string[];\r\n  accountStrategy: 'rotate' | 'random' | 'sequential';\r\n  assignedAccounts: string[];\r\n  active: boolean;\r\n  lastRun?: string;\r\n  nextRun?: string;\r\n}\r\n\r\nexport interface AdSendLog {\r\n  id: number;\r\n  scheduleId: number;\r\n  templateId: number;\r\n  targetGroup: string;\r\n  accountPhone: string;\r\n  status: 'pending' | 'sending' | 'sent' | 'failed';\r\n  sentAt?: string;\r\n  error?: string;\r\n}\r\n\r\nexport interface AdOverviewStats {\r\n  totalSent: number;\r\n  successRate: number;\r\n  todaySent: number;\r\n  activeSchedules: number;\r\n}\r\n\r\nexport interface NewAdTemplate {\r\n  name: string;\r\n  content: string;\r\n  mediaType: 'text' | 'photo' | 'video' | 'document';\r\n}\r\n\r\nexport interface NewAdSchedule {\r\n  name: string;\r\n  templateId: number;\r\n  targetGroups: string[];\r\n  sendMode: 'scheduled' | 'triggered' | 'relay' | 'interval';\r\n  scheduleType: 'once' | 'daily' | 'interval' | 'cron';\r\n  scheduleTime: string;\r\n  intervalMinutes: number;\r\n  triggerKeywords: string[];\r\n  accountStrategy: 'rotate' | 'random' | 'sequential';\r\n  assignedAccounts: string[];\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AdSystemService {\r\n  private ipcService = inject(IpcService);\r\n  private toastService = inject(ToastService);\r\n  private membershipService = inject(MembershipService);\r\n  \r\n  // ç‹€æ…‹\r\n  readonly templates = signal<AdTemplate[]>([]);\r\n  readonly schedules = signal<AdSchedule[]>([]);\r\n  readonly sendLogs = signal<AdSendLog[]>([]);\r\n  readonly overviewStats = signal<AdOverviewStats>({\r\n    totalSent: 0,\r\n    successRate: 0,\r\n    todaySent: 0,\r\n    activeSchedules: 0\r\n  });\r\n  \r\n  // è¡¨å–®ç‹€æ…‹\r\n  readonly showTemplateForm = signal(false);\r\n  readonly showScheduleForm = signal(false);\r\n  readonly newTemplate = signal<NewAdTemplate>({ name: '', content: '', mediaType: 'text' });\r\n  readonly newSchedule = signal<NewAdSchedule>({\r\n    name: '',\r\n    templateId: 0,\r\n    targetGroups: [],\r\n    sendMode: 'scheduled',\r\n    scheduleType: 'once',\r\n    scheduleTime: '',\r\n    intervalMinutes: 60,\r\n    triggerKeywords: [],\r\n    accountStrategy: 'rotate',\r\n    assignedAccounts: []\r\n  });\r\n  \r\n  // Spintax é è¦½\r\n  readonly isPreviewingSpintax = signal(false);\r\n  readonly spintaxPreview = signal<string[]>([]);\r\n  \r\n  // ==================== è¼‰å…¥æ–¹æ³• ====================\r\n  \r\n  loadTemplates(): void {\r\n    this.ipcService.send('get-ad-templates', { activeOnly: false });\r\n  }\r\n  \r\n  loadSchedules(): void {\r\n    this.ipcService.send('get-ad-schedules', { activeOnly: false });\r\n  }\r\n  \r\n  loadSendLogs(limit = 100): void {\r\n    this.ipcService.send('get-ad-send-logs', { limit });\r\n  }\r\n  \r\n  loadOverviewStats(days = 7): void {\r\n    this.ipcService.send('get-ad-overview-stats', { days });\r\n  }\r\n  \r\n  loadAll(): void {\r\n    this.loadTemplates();\r\n    this.loadSchedules();\r\n    this.loadOverviewStats();\r\n  }\r\n  \r\n  // ==================== æ¨¡æ¿æ“ä½œ ====================\r\n  \r\n  createTemplate(): boolean {\r\n    // æª¢æŸ¥æ¬Šé™\r\n    if (!this.membershipService.hasFeature('adBroadcast')) {\r\n      this.toastService.warning('ğŸ¥ˆ å»£å‘Šç™¼é€åŠŸèƒ½éœ€è¦ ç™½éŠ€ç²¾è‹± æˆ–ä»¥ä¸Šæœƒå“¡ï¼Œå‡ç´šè§£é–æ›´å¤šåŠŸèƒ½');\r\n      window.dispatchEvent(new CustomEvent('open-membership-dialog'));\r\n      return false;\r\n    }\r\n    \r\n    const form = this.newTemplate();\r\n    if (!form.name.trim()) {\r\n      this.toastService.warning('è«‹è¼¸å…¥æ¨¡æ¿åç¨±');\r\n      return false;\r\n    }\r\n    if (!form.content.trim()) {\r\n      this.toastService.warning('è«‹è¼¸å…¥æ¨¡æ¿å…§å®¹');\r\n      return false;\r\n    }\r\n    \r\n    this.ipcService.send('create-ad-template', {\r\n      name: form.name,\r\n      content: form.content,\r\n      mediaType: form.mediaType\r\n    });\r\n    \r\n    this.resetTemplateForm();\r\n    return true;\r\n  }\r\n  \r\n  deleteTemplate(templateId: number): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å»£å‘Šæ¨¡æ¿å—ï¼Ÿ')) return;\r\n    this.ipcService.send('delete-ad-template', { templateId });\r\n  }\r\n  \r\n  toggleTemplateStatus(templateId: number): void {\r\n    this.ipcService.send('toggle-ad-template-status', { templateId });\r\n  }\r\n  \r\n  resetTemplateForm(): void {\r\n    this.newTemplate.set({ name: '', content: '', mediaType: 'text' });\r\n    this.showTemplateForm.set(false);\r\n  }\r\n  \r\n  // ==================== è¨ˆåŠƒæ“ä½œ ====================\r\n  \r\n  createSchedule(): boolean {\r\n    // æª¢æŸ¥æ¬Šé™\r\n    if (!this.membershipService.hasFeature('adBroadcast')) {\r\n      this.toastService.warning('ğŸ¥ˆ å»£å‘Šç™¼é€åŠŸèƒ½éœ€è¦ ç™½éŠ€ç²¾è‹± æˆ–ä»¥ä¸Šæœƒå“¡ï¼Œå‡ç´šè§£é–æ›´å¤šåŠŸèƒ½');\r\n      window.dispatchEvent(new CustomEvent('open-membership-dialog'));\r\n      return false;\r\n    }\r\n    \r\n    const form = this.newSchedule();\r\n    if (!form.name.trim()) {\r\n      this.toastService.warning('è«‹è¼¸å…¥è¨ˆåŠƒåç¨±');\r\n      return false;\r\n    }\r\n    if (!form.templateId) {\r\n      this.toastService.warning('è«‹é¸æ“‡å»£å‘Šæ¨¡æ¿');\r\n      return false;\r\n    }\r\n    if (form.targetGroups.length === 0) {\r\n      this.toastService.warning('è«‹é¸æ“‡ç›®æ¨™ç¾¤çµ„');\r\n      return false;\r\n    }\r\n    if (form.assignedAccounts.length === 0) {\r\n      this.toastService.warning('è«‹é¸æ“‡ç™¼é€å¸³è™Ÿ');\r\n      return false;\r\n    }\r\n    \r\n    this.ipcService.send('create-ad-schedule', form);\r\n    this.resetScheduleForm();\r\n    return true;\r\n  }\r\n  \r\n  deleteSchedule(scheduleId: number): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å»£å‘Šè¨ˆåŠƒå—ï¼Ÿ')) return;\r\n    this.ipcService.send('delete-ad-schedule', { scheduleId });\r\n  }\r\n  \r\n  toggleScheduleStatus(scheduleId: number): void {\r\n    this.ipcService.send('toggle-ad-schedule-status', { scheduleId });\r\n  }\r\n  \r\n  runScheduleNow(scheduleId: number): void {\r\n    if (!confirm('ç¢ºå®šè¦ç«‹å³åŸ·è¡Œæ­¤è¨ˆåŠƒå—ï¼Ÿ')) return;\r\n    this.ipcService.send('run-ad-schedule-now', { scheduleId });\r\n    this.toastService.info('æ­£åœ¨åŸ·è¡Œ...');\r\n  }\r\n  \r\n  resetScheduleForm(): void {\r\n    this.newSchedule.set({\r\n      name: '',\r\n      templateId: 0,\r\n      targetGroups: [],\r\n      sendMode: 'scheduled',\r\n      scheduleType: 'once',\r\n      scheduleTime: '',\r\n      intervalMinutes: 60,\r\n      triggerKeywords: [],\r\n      accountStrategy: 'rotate',\r\n      assignedAccounts: []\r\n    });\r\n    this.showScheduleForm.set(false);\r\n  }\r\n  \r\n  // ==================== Spintax é è¦½ ====================\r\n  \r\n  previewSpintax(content: string): void {\r\n    if (!content.trim()) {\r\n      this.spintaxPreview.set([]);\r\n      return;\r\n    }\r\n    this.isPreviewingSpintax.set(true);\r\n    this.ipcService.send('validate-spintax', { content });\r\n  }\r\n  \r\n  // ==================== è¡¨å–®æ›´æ–°è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  updateTemplateName(value: string): void {\r\n    this.newTemplate.update(t => ({ ...t, name: value }));\r\n  }\r\n  \r\n  updateTemplateContent(value: string): void {\r\n    this.newTemplate.update(t => ({ ...t, content: value }));\r\n  }\r\n  \r\n  updateTemplateMediaType(value: string): void {\r\n    this.newTemplate.update(t => ({ ...t, mediaType: value as any }));\r\n  }\r\n  \r\n  updateScheduleName(value: string): void {\r\n    this.newSchedule.update(s => ({ ...s, name: value }));\r\n  }\r\n  \r\n  updateScheduleTemplateId(value: number): void {\r\n    this.newSchedule.update(s => ({ ...s, templateId: value }));\r\n  }\r\n  \r\n  updateScheduleSendMode(value: string): void {\r\n    this.newSchedule.update(s => ({ ...s, sendMode: value as any }));\r\n  }\r\n  \r\n  updateScheduleType(value: string): void {\r\n    this.newSchedule.update(s => ({ ...s, scheduleType: value as any }));\r\n  }\r\n  \r\n  updateScheduleTime(value: string): void {\r\n    this.newSchedule.update(s => ({ ...s, scheduleTime: value }));\r\n  }\r\n  \r\n  updateScheduleInterval(value: number): void {\r\n    this.newSchedule.update(s => ({ ...s, intervalMinutes: value }));\r\n  }\r\n  \r\n  updateScheduleStrategy(value: string): void {\r\n    this.newSchedule.update(s => ({ ...s, accountStrategy: value as any }));\r\n  }\r\n  \r\n  // ==================== æ¨™ç±¤è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  getSendModeLabel(mode: string): string {\r\n    const labels: Record<string, string> = {\r\n      'scheduled': 'å®šæ™‚ç™¼é€',\r\n      'triggered': 'é—œéµè©è§¸ç™¼',\r\n      'relay': 'æ¥åŠ›ç™¼é€',\r\n      'interval': 'é–“éš”å¾ªç’°'\r\n    };\r\n    return labels[mode] || mode;\r\n  }\r\n  \r\n  getScheduleTypeLabel(type: string): string {\r\n    const labels: Record<string, string> = {\r\n      'once': 'ä¸€æ¬¡æ€§',\r\n      'daily': 'æ¯æ—¥',\r\n      'interval': 'é–“éš”',\r\n      'cron': 'Cron'\r\n    };\r\n    return labels[type] || type;\r\n  }\r\n  \r\n  getAccountStrategyLabel(strategy: string): string {\r\n    const labels: Record<string, string> = {\r\n      'rotate': 'è¼ªæ›',\r\n      'random': 'éš¨æ©Ÿ',\r\n      'sequential': 'é †åº'\r\n    };\r\n    return labels[strategy] || strategy;\r\n  }\r\n  \r\n  // ==================== IPC å›èª¿è™•ç† ====================\r\n  \r\n  handleTemplatesResponse(data: any): void {\r\n    if (data.success && data.templates) {\r\n      this.templates.set(data.templates);\r\n    }\r\n  }\r\n  \r\n  handleSchedulesResponse(data: any): void {\r\n    if (data.success && data.schedules) {\r\n      this.schedules.set(data.schedules);\r\n    }\r\n  }\r\n  \r\n  handleSendLogsResponse(data: any): void {\r\n    if (data.success && data.logs) {\r\n      this.sendLogs.set(data.logs);\r\n    }\r\n  }\r\n  \r\n  handleOverviewStatsResponse(data: any): void {\r\n    if (data.success) {\r\n      this.overviewStats.set(data);\r\n    }\r\n  }\r\n  \r\n  handleSpintaxResponse(data: any): void {\r\n    this.isPreviewingSpintax.set(false);\r\n    if (data.success && data.variants) {\r\n      this.spintaxPreview.set(data.variants.slice(0, 5));\r\n    }\r\n  }\r\n  \r\n  handleCreateTemplateResponse(data: any): void {\r\n    if (data.success) {\r\n      this.toastService.success('å»£å‘Šæ¨¡æ¿å‰µå»ºæˆåŠŸ');\r\n      this.loadTemplates();\r\n    } else {\r\n      this.toastService.error(data.error || 'å‰µå»ºå¤±æ•—');\r\n    }\r\n  }\r\n  \r\n  handleCreateScheduleResponse(data: any): void {\r\n    if (data.success) {\r\n      this.toastService.success('å»£å‘Šè¨ˆåŠƒå‰µå»ºæˆåŠŸ');\r\n      this.loadSchedules();\r\n    } else {\r\n      this.toastService.error(data.error || 'å‰µå»ºå¤±æ•—');\r\n    }\r\n  }\r\n}\r\n","/**\r\n * User Tracking Service\r\n * ç”¨æˆ¶è¿½è¹¤ç³»çµ±æœå‹™\r\n * \r\n * ğŸ†• Phase 16: å¾ app.component.ts æå–\r\n * \r\n * ç®¡ç†ç”¨æˆ¶è¿½è¹¤ã€åƒ¹å€¼è©•ç´šã€ç¾¤çµ„åˆ†æç­‰åŠŸèƒ½\r\n */\r\n\r\nimport { Injectable, signal, inject } from '@angular/core';\r\nimport { IpcService } from '../ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// é¡å‹å®šç¾©\r\nexport interface TrackedUser {\r\n  userId: string;\r\n  username?: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  notes?: string;\r\n  valueLevel: 'vip' | 'high' | 'medium' | 'low';\r\n  status: 'pending' | 'tracking' | 'completed' | 'failed';\r\n  groupCount: number;\r\n  source: 'manual' | 'auto' | 'lead';\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface HighValueGroup {\r\n  groupId: string;\r\n  title: string;\r\n  memberCount: number;\r\n  trackedUserCount: number;\r\n  avgValueScore: number;\r\n}\r\n\r\nexport interface TrackingStats {\r\n  totalTracked: number;\r\n  vipCount: number;\r\n  highCount: number;\r\n  mediumCount: number;\r\n  lowCount: number;\r\n  pendingCount: number;\r\n  completedCount: number;\r\n}\r\n\r\nexport interface NewTrackedUser {\r\n  userId: string;\r\n  username: string;\r\n  notes: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserTrackingService {\r\n  private ipcService = inject(IpcService);\r\n  private toastService = inject(ToastService);\r\n  \r\n  // ç‹€æ…‹\r\n  readonly trackedUsers = signal<TrackedUser[]>([]);\r\n  readonly highValueGroups = signal<HighValueGroup[]>([]);\r\n  readonly trackingStats = signal<TrackingStats>({\r\n    totalTracked: 0,\r\n    vipCount: 0,\r\n    highCount: 0,\r\n    mediumCount: 0,\r\n    lowCount: 0,\r\n    pendingCount: 0,\r\n    completedCount: 0\r\n  });\r\n  readonly selectedUser = signal<TrackedUser | null>(null);\r\n  readonly userGroups = signal<any[]>([]);\r\n  \r\n  // UI ç‹€æ…‹\r\n  readonly showAddUserForm = signal(false);\r\n  readonly isTrackingUser = signal(false);\r\n  readonly userValueFilter = signal<string>('');\r\n  readonly newTrackedUser = signal<NewTrackedUser>({ userId: '', username: '', notes: '' });\r\n  \r\n  // ==================== è¼‰å…¥æ–¹æ³• ====================\r\n  \r\n  loadTrackedUsers(limit = 100): void {\r\n    this.ipcService.send('get-tracked-users', { \r\n      limit,\r\n      valueLevel: this.userValueFilter() || undefined\r\n    });\r\n  }\r\n  \r\n  loadTrackingStats(): void {\r\n    this.ipcService.send('get-tracking-stats', {});\r\n  }\r\n  \r\n  loadHighValueGroups(limit = 50): void {\r\n    this.ipcService.send('get-high-value-groups', { limit });\r\n  }\r\n  \r\n  loadAll(): void {\r\n    this.loadTrackedUsers();\r\n    this.loadTrackingStats();\r\n    this.loadHighValueGroups();\r\n  }\r\n  \r\n  // ==================== ç”¨æˆ¶æ“ä½œ ====================\r\n  \r\n  addUserToTrack(): boolean {\r\n    const form = this.newTrackedUser();\r\n    if (!form.userId.trim()) {\r\n      this.toastService.warning('è«‹è¼¸å…¥ç”¨æˆ¶ ID');\r\n      return false;\r\n    }\r\n    \r\n    this.ipcService.send('add-user-to-track', {\r\n      userId: form.userId.trim(),\r\n      username: form.username.trim() || undefined,\r\n      notes: form.notes.trim() || undefined,\r\n      source: 'manual'\r\n    });\r\n    \r\n    this.resetForm();\r\n    return true;\r\n  }\r\n  \r\n  addLeadToTracking(leadId: number): void {\r\n    this.ipcService.send('add-user-from-lead', { leadId });\r\n  }\r\n  \r\n  removeTrackedUser(userId: string): void {\r\n    if (!confirm('ç¢ºå®šè¦ç§»é™¤æ­¤ç”¨æˆ¶è¿½è¹¤å—ï¼Ÿ')) return;\r\n    this.ipcService.send('remove-tracked-user', { userId });\r\n  }\r\n  \r\n  trackUserGroups(userId: string, accountPhone: string): void {\r\n    this.isTrackingUser.set(true);\r\n    this.ipcService.send('track-user-groups', { userId, accountPhone });\r\n  }\r\n  \r\n  viewUserGroups(user: TrackedUser): void {\r\n    this.selectedUser.set(user);\r\n    this.ipcService.send('get-user-groups', { userId: user.userId });\r\n  }\r\n  \r\n  updateUserValueLevel(userId: string, valueLevel: string): void {\r\n    this.ipcService.send('update-user-value-level', { userId, valueLevel });\r\n  }\r\n  \r\n  resetForm(): void {\r\n    this.newTrackedUser.set({ userId: '', username: '', notes: '' });\r\n    this.showAddUserForm.set(false);\r\n  }\r\n  \r\n  // ==================== è¡¨å–®æ›´æ–°è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  updateUserId(value: string): void {\r\n    this.newTrackedUser.update(u => ({ ...u, userId: value }));\r\n  }\r\n  \r\n  updateUsername(value: string): void {\r\n    this.newTrackedUser.update(u => ({ ...u, username: value }));\r\n  }\r\n  \r\n  updateNotes(value: string): void {\r\n    this.newTrackedUser.update(u => ({ ...u, notes: value }));\r\n  }\r\n  \r\n  // ==================== æ¨™ç±¤è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  getValueLevelLabel(level: string): string {\r\n    const labels: Record<string, string> = {\r\n      'vip': 'VIP',\r\n      'high': 'é«˜åƒ¹å€¼',\r\n      'medium': 'ä¸­ç­‰',\r\n      'low': 'ä½'\r\n    };\r\n    return labels[level] || level;\r\n  }\r\n  \r\n  getValueLevelColor(level: string): string {\r\n    const colors: Record<string, string> = {\r\n      'vip': 'bg-purple-500/20 text-purple-400 border-purple-500/30',\r\n      'high': 'bg-orange-500/20 text-orange-400 border-orange-500/30',\r\n      'medium': 'bg-cyan-500/20 text-cyan-400 border-cyan-500/30',\r\n      'low': 'bg-slate-500/20 text-slate-400 border-slate-500/30'\r\n    };\r\n    return colors[level] || 'bg-slate-500/20 text-slate-400';\r\n  }\r\n  \r\n  getTrackingStatusLabel(status: string): string {\r\n    const labels: Record<string, string> = {\r\n      'pending': 'å¾…è¿½è¹¤',\r\n      'tracking': 'è¿½è¹¤ä¸­',\r\n      'completed': 'å·²å®Œæˆ',\r\n      'failed': 'å¤±æ•—'\r\n    };\r\n    return labels[status] || status;\r\n  }\r\n  \r\n  getTrackingStatusColor(status: string): string {\r\n    const colors: Record<string, string> = {\r\n      'pending': 'bg-yellow-500/20 text-yellow-400',\r\n      'tracking': 'bg-blue-500/20 text-blue-400',\r\n      'completed': 'bg-green-500/20 text-green-400',\r\n      'failed': 'bg-red-500/20 text-red-400'\r\n    };\r\n    return colors[status] || 'bg-slate-500/20 text-slate-400';\r\n  }\r\n  \r\n  // ==================== IPC å›èª¿è™•ç† ====================\r\n  \r\n  handleTrackedUsersResponse(data: any): void {\r\n    if (data.success) {\r\n      this.trackedUsers.set(data.users || []);\r\n    }\r\n  }\r\n  \r\n  handleTrackingStatsResponse(data: any): void {\r\n    if (data.success) {\r\n      this.trackingStats.set(data);\r\n    }\r\n  }\r\n  \r\n  handleHighValueGroupsResponse(data: any): void {\r\n    if (data.success) {\r\n      this.highValueGroups.set(data.groups || []);\r\n    }\r\n  }\r\n  \r\n  handleUserGroupsResponse(data: any): void {\r\n    if (data.success) {\r\n      this.userGroups.set(data.groups || []);\r\n    }\r\n  }\r\n  \r\n  handleTrackingComplete(): void {\r\n    this.isTrackingUser.set(false);\r\n    this.loadTrackedUsers();\r\n    this.toastService.success('ç”¨æˆ¶ç¾¤çµ„è¿½è¹¤å®Œæˆ');\r\n  }\r\n  \r\n  handleAddUserResponse(data: any): void {\r\n    if (data.success) {\r\n      this.toastService.success('ç”¨æˆ¶æ·»åŠ æˆåŠŸ');\r\n      this.loadTrackedUsers();\r\n    } else {\r\n      this.toastService.error(data.error || 'æ·»åŠ å¤±æ•—');\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Member Management Service\r\n * æˆå“¡ç®¡ç†æœå‹™\r\n * \r\n * ğŸ†• Phase 17: å¾ app.component.ts æå–\r\n * \r\n * ç®¡ç†ç¾¤çµ„æˆå“¡æå–ã€ç¯©é¸ã€å°å‡ºç­‰åŠŸèƒ½\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { IpcService } from '../ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// é¡å‹å®šç¾©\r\nexport interface ExtractedMember {\r\n  id: string;\r\n  telegramId: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  username?: string;\r\n  phone?: string;\r\n  isPremium: boolean;\r\n  isBot: boolean;\r\n  isScam: boolean;\r\n  isDeleted: boolean;\r\n  lastOnline?: Date;\r\n  photo?: string;\r\n  valueLevel?: 'high' | 'medium' | 'low';\r\n}\r\n\r\nexport interface MemberExtractionConfig {\r\n  limit: number;\r\n  customLimit: number;\r\n  backgroundMode: boolean;\r\n  userTypes: {\r\n    chinese: boolean;\r\n    overseas: boolean;\r\n  };\r\n  activityFilters: {\r\n    onlineNow: boolean;\r\n    within3Days: boolean;\r\n    within7Days: boolean;\r\n    within30Days: boolean;\r\n    longOffline: boolean;\r\n  };\r\n  accountFeatures: {\r\n    premium: boolean;\r\n    hasUsername: boolean;\r\n    hasPhoto: boolean;\r\n    newAccount: boolean;\r\n    activeAccount: boolean;\r\n    verified: boolean;\r\n  };\r\n  excludeFilters: {\r\n    bots: boolean;\r\n    scam: boolean;\r\n    deleted: boolean;\r\n  };\r\n}\r\n\r\nexport interface MemberListProgress {\r\n  extracted: number;\r\n  total: number;\r\n  status: string;\r\n}\r\n\r\nexport interface GroupResource {\r\n  id: number;\r\n  telegram_id: string;\r\n  username?: string;\r\n  title: string;\r\n  member_count: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MemberManagementService {\r\n  private ipcService = inject(IpcService);\r\n  private toastService = inject(ToastService);\r\n  \r\n  // æˆå“¡åˆ—è¡¨ç‹€æ…‹\r\n  readonly members = signal<ExtractedMember[]>([]);\r\n  readonly selectedMemberIds = signal<string[]>([]);\r\n  readonly currentResource = signal<GroupResource | null>(null);\r\n  readonly isLoading = signal(false);\r\n  readonly progress = signal<MemberListProgress>({ extracted: 0, total: 0, status: '' });\r\n  \r\n  // æå–è¨­ç½®\r\n  readonly extractionConfig = signal<MemberExtractionConfig>(this.getDefaultConfig());\r\n  readonly extractionStarted = signal(false);\r\n  readonly extractionPaused = signal(false);\r\n  \r\n  // å°è©±æ¡†ç‹€æ…‹\r\n  readonly showMemberListDialog = signal(false);\r\n  readonly showBatchExtractDialog = signal(false);\r\n  \r\n  // ç¯©é¸å™¨\r\n  readonly memberFilter = signal<string>('all');\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  readonly filteredMembers = computed(() => {\r\n    const members = this.members();\r\n    const filter = this.memberFilter();\r\n    \r\n    switch (filter) {\r\n      case 'chinese':\r\n        return members.filter(m => this.isChineseMember(m));\r\n      case 'online':\r\n        return members.filter(m => this.isOnlineMember(m));\r\n      case 'premium':\r\n        return members.filter(m => m.isPremium);\r\n      case 'high-value':\r\n        return members.filter(m => m.valueLevel === 'high');\r\n      default:\r\n        return members;\r\n    }\r\n  });\r\n  \r\n  readonly selectedCount = computed(() => this.selectedMemberIds().length);\r\n  readonly chineseMemberCount = computed(() => this.members().filter(m => this.isChineseMember(m)).length);\r\n  readonly onlineMemberCount = computed(() => this.members().filter(m => this.isOnlineMember(m)).length);\r\n  readonly premiumMemberCount = computed(() => this.members().filter(m => m.isPremium).length);\r\n  readonly isAllSelected = computed(() => {\r\n    const filtered = this.filteredMembers();\r\n    const selected = this.selectedMemberIds();\r\n    return filtered.length > 0 && filtered.every(m => selected.includes(m.id));\r\n  });\r\n  \r\n  // ==================== å°è©±æ¡†æ“ä½œ ====================\r\n  \r\n  openMemberListDialog(resource: GroupResource): void {\r\n    this.currentResource.set(resource);\r\n    this.members.set([]);\r\n    this.isLoading.set(false);\r\n    this.progress.set({ extracted: 0, total: resource.member_count || 0, status: '' });\r\n    this.selectedMemberIds.set([]);\r\n    this.extractionStarted.set(false);\r\n    this.memberFilter.set('all');\r\n    this.extractionConfig.set(this.getDefaultConfig());\r\n    this.showMemberListDialog.set(true);\r\n  }\r\n  \r\n  closeMemberListDialog(): void {\r\n    this.showMemberListDialog.set(false);\r\n    this.currentResource.set(null);\r\n    this.members.set([]);\r\n  }\r\n  \r\n  openBatchExtractDialog(): void {\r\n    this.showBatchExtractDialog.set(true);\r\n  }\r\n  \r\n  closeBatchExtractDialog(): void {\r\n    this.showBatchExtractDialog.set(false);\r\n  }\r\n  \r\n  // ==================== æˆå“¡æå–æ“ä½œ ====================\r\n  \r\n  loadMembers(resource?: GroupResource): void {\r\n    const target = resource || this.currentResource();\r\n    if (!target || !target.telegram_id) {\r\n      this.toastService.error('ç„¡æ•ˆçš„ç¾¤çµ„ä¿¡æ¯');\r\n      return;\r\n    }\r\n    \r\n    this.isLoading.set(true);\r\n    this.progress.update(p => ({ ...p, status: 'æ­£åœ¨æå–æˆå“¡...' }));\r\n    \r\n    this.ipcService.send('extract-members', {\r\n      resourceId: target.id,\r\n      telegramId: target.telegram_id,\r\n      username: target.username,\r\n      limit: 200,\r\n      offset: 0\r\n    });\r\n  }\r\n  \r\n  loadMore(): void {\r\n    const resource = this.currentResource();\r\n    const currentCount = this.members().length;\r\n    \r\n    if (!resource) return;\r\n    \r\n    this.isLoading.set(true);\r\n    this.progress.update(p => ({ ...p, status: 'æ­£åœ¨æå–æ›´å¤šæˆå“¡...' }));\r\n    \r\n    this.ipcService.send('extract-members', {\r\n      resourceId: resource.id,\r\n      telegramId: resource.telegram_id,\r\n      username: resource.username,\r\n      limit: 200,\r\n      offset: currentCount\r\n    });\r\n  }\r\n  \r\n  startExtraction(): void {\r\n    const resource = this.currentResource();\r\n    const config = this.extractionConfig();\r\n    \r\n    if (!resource) {\r\n      this.toastService.error('ç„¡æ•ˆçš„ç¾¤çµ„ä¿¡æ¯');\r\n      return;\r\n    }\r\n    \r\n    this.extractionStarted.set(true);\r\n    this.isLoading.set(true);\r\n    this.progress.set({ extracted: 0, total: resource.member_count || 0, status: 'é–‹å§‹æå–...' });\r\n    \r\n    this.ipcService.send('start-member-extraction', {\r\n      resourceId: resource.id,\r\n      telegramId: resource.telegram_id,\r\n      username: resource.username,\r\n      config\r\n    });\r\n  }\r\n  \r\n  pauseExtraction(): void {\r\n    this.extractionPaused.set(true);\r\n    this.ipcService.send('pause-member-extraction', {});\r\n  }\r\n  \r\n  resumeExtraction(): void {\r\n    this.extractionPaused.set(false);\r\n    this.ipcService.send('resume-member-extraction', {});\r\n  }\r\n  \r\n  stopExtraction(): void {\r\n    this.extractionStarted.set(false);\r\n    this.extractionPaused.set(false);\r\n    this.isLoading.set(false);\r\n    this.ipcService.send('stop-member-extraction', {});\r\n  }\r\n  \r\n  // ==================== æˆå“¡é¸æ“‡æ“ä½œ ====================\r\n  \r\n  toggleMemberSelection(memberId: string): void {\r\n    const current = this.selectedMemberIds();\r\n    if (current.includes(memberId)) {\r\n      this.selectedMemberIds.set(current.filter(id => id !== memberId));\r\n    } else {\r\n      this.selectedMemberIds.set([...current, memberId]);\r\n    }\r\n  }\r\n  \r\n  selectAll(): void {\r\n    const filtered = this.filteredMembers();\r\n    this.selectedMemberIds.set(filtered.map(m => m.id));\r\n  }\r\n  \r\n  clearSelection(): void {\r\n    this.selectedMemberIds.set([]);\r\n  }\r\n  \r\n  toggleSelectAll(): void {\r\n    if (this.isAllSelected()) {\r\n      this.clearSelection();\r\n    } else {\r\n      this.selectAll();\r\n    }\r\n  }\r\n  \r\n  selectHighValue(): void {\r\n    const highValue = this.members().filter(m => m.valueLevel === 'high');\r\n    this.selectedMemberIds.set(highValue.map(m => m.id));\r\n    this.toastService.info(`å·²é¸æ“‡ ${highValue.length} å€‹é«˜åƒ¹å€¼æˆå“¡`);\r\n  }\r\n  \r\n  selectOnline(): void {\r\n    const online = this.members().filter(m => this.isOnlineMember(m));\r\n    this.selectedMemberIds.set(online.map(m => m.id));\r\n    this.toastService.info(`å·²é¸æ“‡ ${online.length} å€‹åœ¨ç·šæˆå“¡`);\r\n  }\r\n  \r\n  // ==================== è¨­ç½®æ“ä½œ ====================\r\n  \r\n  setFilter(filter: string): void {\r\n    this.memberFilter.set(filter);\r\n  }\r\n  \r\n  setExtractLimit(limit: number): void {\r\n    this.extractionConfig.update(c => ({ ...c, limit }));\r\n  }\r\n  \r\n  setCustomLimit(customLimit: number): void {\r\n    this.extractionConfig.update(c => ({ ...c, customLimit }));\r\n  }\r\n  \r\n  toggleBackgroundMode(): void {\r\n    this.extractionConfig.update(c => ({ ...c, backgroundMode: !c.backgroundMode }));\r\n  }\r\n  \r\n  toggleUserType(type: 'chinese' | 'overseas'): void {\r\n    this.extractionConfig.update(c => ({\r\n      ...c,\r\n      userTypes: { ...c.userTypes, [type]: !c.userTypes[type] }\r\n    }));\r\n  }\r\n  \r\n  toggleActivityFilter(filter: keyof MemberExtractionConfig['activityFilters']): void {\r\n    this.extractionConfig.update(c => ({\r\n      ...c,\r\n      activityFilters: { ...c.activityFilters, [filter]: !c.activityFilters[filter] }\r\n    }));\r\n  }\r\n  \r\n  toggleAccountFeature(feature: keyof MemberExtractionConfig['accountFeatures']): void {\r\n    this.extractionConfig.update(c => ({\r\n      ...c,\r\n      accountFeatures: { ...c.accountFeatures, [feature]: !c.accountFeatures[feature] }\r\n    }));\r\n  }\r\n  \r\n  toggleExcludeFilter(filter: keyof MemberExtractionConfig['excludeFilters']): void {\r\n    this.extractionConfig.update(c => ({\r\n      ...c,\r\n      excludeFilters: { ...c.excludeFilters, [filter]: !c.excludeFilters[filter] }\r\n    }));\r\n  }\r\n  \r\n  // ==================== å°å‡ºæ“ä½œ ====================\r\n  \r\n  exportToCSV(): void {\r\n    const members = this.members();\r\n    if (members.length === 0) {\r\n      this.toastService.warning('æ²’æœ‰å¯å°å‡ºçš„æˆå“¡');\r\n      return;\r\n    }\r\n    \r\n    const csv = this.generateCSV(members);\r\n    this.downloadCSV(csv, `members_${Date.now()}.csv`);\r\n    this.toastService.success(`å·²å°å‡º ${members.length} å€‹æˆå“¡`);\r\n  }\r\n  \r\n  exportSelectedToCSV(): void {\r\n    const selectedIds = this.selectedMemberIds();\r\n    const selected = this.members().filter(m => selectedIds.includes(m.id));\r\n    \r\n    if (selected.length === 0) {\r\n      this.toastService.warning('è«‹å…ˆé¸æ“‡è¦å°å‡ºçš„æˆå“¡');\r\n      return;\r\n    }\r\n    \r\n    const csv = this.generateCSV(selected);\r\n    this.downloadCSV(csv, `selected_members_${Date.now()}.csv`);\r\n    this.toastService.success(`å·²å°å‡º ${selected.length} å€‹æˆå“¡`);\r\n  }\r\n  \r\n  // ==================== è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  isChineseMember(member: ExtractedMember): boolean {\r\n    const name = `${member.firstName || ''} ${member.lastName || ''}`;\r\n    return /[\\u4e00-\\u9fff]/.test(name);\r\n  }\r\n  \r\n  isOnlineMember(member: ExtractedMember): boolean {\r\n    if (!member.lastOnline) return false;\r\n    const now = new Date();\r\n    const diff = now.getTime() - new Date(member.lastOnline).getTime();\r\n    return diff < 5 * 60 * 1000; // 5åˆ†é˜å…§\r\n  }\r\n  \r\n  calculateValueLevel(member: ExtractedMember): 'high' | 'medium' | 'low' {\r\n    let score = 0;\r\n    \r\n    if (member.isPremium) score += 3;\r\n    if (member.username) score += 2;\r\n    if (member.photo) score += 1;\r\n    if (this.isOnlineMember(member)) score += 2;\r\n    if (!member.isBot && !member.isScam && !member.isDeleted) score += 1;\r\n    \r\n    if (score >= 6) return 'high';\r\n    if (score >= 3) return 'medium';\r\n    return 'low';\r\n  }\r\n  \r\n  formatMemberCount(count: number): string {\r\n    if (count >= 1000000) return (count / 1000000).toFixed(1) + 'M';\r\n    if (count >= 1000) return (count / 1000).toFixed(1) + 'K';\r\n    return count.toString();\r\n  }\r\n  \r\n  getExtractPercent(): number {\r\n    const progress = this.progress();\r\n    if (progress.total === 0) return 0;\r\n    return Math.round((progress.extracted / progress.total) * 100);\r\n  }\r\n  \r\n  private getDefaultConfig(): MemberExtractionConfig {\r\n    return {\r\n      limit: 500,\r\n      customLimit: 1000,\r\n      backgroundMode: false,\r\n      userTypes: { chinese: false, overseas: false },\r\n      activityFilters: {\r\n        onlineNow: false,\r\n        within3Days: false,\r\n        within7Days: false,\r\n        within30Days: false,\r\n        longOffline: false\r\n      },\r\n      accountFeatures: {\r\n        premium: false,\r\n        hasUsername: false,\r\n        hasPhoto: false,\r\n        newAccount: false,\r\n        activeAccount: false,\r\n        verified: false\r\n      },\r\n      excludeFilters: {\r\n        bots: true,\r\n        scam: true,\r\n        deleted: true\r\n      }\r\n    };\r\n  }\r\n  \r\n  private generateCSV(members: ExtractedMember[]): string {\r\n    const headers = ['ID', 'Username', 'First Name', 'Last Name', 'Premium', 'Value Level'];\r\n    const rows = members.map(m => [\r\n      m.telegramId,\r\n      m.username || '',\r\n      m.firstName || '',\r\n      m.lastName || '',\r\n      m.isPremium ? 'Yes' : 'No',\r\n      m.valueLevel || ''\r\n    ]);\r\n    \r\n    return [headers.join(','), ...rows.map(r => r.join(','))].join('\\n');\r\n  }\r\n  \r\n  private downloadCSV(content: string, filename: string): void {\r\n    const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    link.href = URL.createObjectURL(blob);\r\n    link.download = filename;\r\n    link.click();\r\n  }\r\n  \r\n  // ==================== IPC å›èª¿è™•ç† ====================\r\n  \r\n  handleMembersResponse(data: any): void {\r\n    this.isLoading.set(false);\r\n    if (data.success && data.members) {\r\n      const current = this.members();\r\n      const newMembers = data.members.map((m: any) => ({\r\n        ...m,\r\n        valueLevel: this.calculateValueLevel(m)\r\n      }));\r\n      \r\n      if (data.offset === 0) {\r\n        this.members.set(newMembers);\r\n      } else {\r\n        this.members.set([...current, ...newMembers]);\r\n      }\r\n      \r\n      this.progress.update(p => ({\r\n        ...p,\r\n        extracted: this.members().length,\r\n        status: `å·²æå– ${this.members().length} å€‹æˆå“¡`\r\n      }));\r\n    } else {\r\n      this.toastService.error(data.error || 'æå–æˆå“¡å¤±æ•—');\r\n    }\r\n  }\r\n  \r\n  handleExtractionProgress(data: any): void {\r\n    this.progress.set({\r\n      extracted: data.extracted || 0,\r\n      total: data.total || 0,\r\n      status: data.status || ''\r\n    });\r\n  }\r\n  \r\n  handleExtractionComplete(data: any): void {\r\n    this.isLoading.set(false);\r\n    this.extractionStarted.set(false);\r\n    if (data.success) {\r\n      this.toastService.success(`æˆå“¡æå–å®Œæˆï¼Œå…± ${data.count} å€‹`);\r\n    }\r\n  }\r\n  \r\n  handleExtractionError(data: any): void {\r\n    this.isLoading.set(false);\r\n    this.toastService.error(data.error || 'æå–éç¨‹ç™¼ç”ŸéŒ¯èª¤');\r\n  }\r\n}\r\n","/**\r\n * Queue Management Service\r\n * æ¶ˆæ¯éšŠåˆ—ç®¡ç†æœå‹™\r\n * \r\n * ğŸ†• Phase 17: å¾ app.component.ts æå–\r\n * \r\n * ç®¡ç†æ¶ˆæ¯ç™¼é€éšŠåˆ—ã€ç‹€æ…‹ç›£æ§ã€å„ªå…ˆç´šèª¿æ•´ç­‰åŠŸèƒ½\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { IpcService } from '../ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// é¡å‹å®šç¾©\r\nexport interface QueueMessage {\r\n  id: string;\r\n  phone: string;\r\n  targetId: string;\r\n  targetType: 'user' | 'group' | 'channel';\r\n  content: string;\r\n  mediaType?: string;\r\n  priority: 'high' | 'normal' | 'low';\r\n  status: 'pending' | 'sending' | 'sent' | 'failed' | 'paused';\r\n  retryCount: number;\r\n  createdAt: string;\r\n  sentAt?: string;\r\n  error?: string;\r\n}\r\n\r\nexport interface QueueStatus {\r\n  phone: string;\r\n  pending: number;\r\n  sending: number;\r\n  sent: number;\r\n  failed: number;\r\n  paused: boolean;\r\n  lastActivity?: string;\r\n}\r\n\r\nexport interface QueueStats {\r\n  totalPending: number;\r\n  totalSending: number;\r\n  totalSent: number;\r\n  totalFailed: number;\r\n  activeQueues: number;\r\n  pausedQueues: number;\r\n}\r\n\r\nexport interface AccountQueueStatus {\r\n  phone: string;\r\n  status: QueueStatus;\r\n  messages: QueueMessage[];\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class QueueManagementService {\r\n  private ipcService = inject(IpcService);\r\n  private toastService = inject(ToastService);\r\n  \r\n  // éšŠåˆ—ç‹€æ…‹\r\n  readonly queueStatuses = signal<Map<string, QueueStatus>>(new Map());\r\n  readonly currentQueueMessages = signal<QueueMessage[]>([]);\r\n  readonly selectedPhone = signal<string | null>(null);\r\n  readonly queueLengthHistory = signal<any[]>([]);\r\n  \r\n  // UI ç‹€æ…‹\r\n  readonly showQueueDetails = signal(false);\r\n  readonly isRefreshing = signal(false);\r\n  \r\n  // ç¯€æµæ§åˆ¶\r\n  private refreshTimeout: any = null;\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  readonly totalStats = computed<QueueStats>(() => {\r\n    const statuses = Array.from(this.queueStatuses().values());\r\n    return {\r\n      totalPending: statuses.reduce((sum, s) => sum + s.pending, 0),\r\n      totalSending: statuses.reduce((sum, s) => sum + s.sending, 0),\r\n      totalSent: statuses.reduce((sum, s) => sum + s.sent, 0),\r\n      totalFailed: statuses.reduce((sum, s) => sum + s.failed, 0),\r\n      activeQueues: statuses.filter(s => !s.paused && s.pending > 0).length,\r\n      pausedQueues: statuses.filter(s => s.paused).length\r\n    };\r\n  });\r\n  \r\n  readonly accountQueueStatuses = computed<AccountQueueStatus[]>(() => {\r\n    return Array.from(this.queueStatuses().entries()).map(([phone, status]) => ({\r\n      phone,\r\n      status,\r\n      messages: this.currentQueueMessages().filter(m => m.phone === phone)\r\n    }));\r\n  });\r\n  \r\n  // ==================== éšŠåˆ—æ“ä½œ ====================\r\n  \r\n  refreshStatus(phone?: string): void {\r\n    this.isRefreshing.set(true);\r\n    this.ipcService.send('get-queue-status', { phone });\r\n  }\r\n  \r\n  refreshStatusThrottled(): void {\r\n    if (this.refreshTimeout) {\r\n      clearTimeout(this.refreshTimeout);\r\n    }\r\n    this.refreshTimeout = setTimeout(() => {\r\n      this.refreshStatus();\r\n    }, 500);\r\n  }\r\n  \r\n  getMessages(phone?: string, status?: string, limit = 100): void {\r\n    this.ipcService.send('get-queue-messages', { phone, status, limit });\r\n  }\r\n  \r\n  clearPendingQueue(): void {\r\n    if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å¾…ç™¼é€æ¶ˆæ¯å—ï¼Ÿ')) return;\r\n    this.ipcService.send('clear-pending-queue', {});\r\n    this.toastService.info('æ­£åœ¨æ¸…é™¤å¾…ç™¼é€éšŠåˆ—...');\r\n  }\r\n  \r\n  clearQueue(phone: string, status?: string): void {\r\n    if (!confirm(`ç¢ºå®šè¦æ¸…é™¤ ${phone} çš„éšŠåˆ—å—ï¼Ÿ`)) return;\r\n    this.ipcService.send('clear-queue', { phone, status });\r\n  }\r\n  \r\n  pauseQueue(phone: string): void {\r\n    this.ipcService.send('pause-queue', { phone });\r\n    this.toastService.info(`æš«åœ ${phone} çš„ç™¼é€éšŠåˆ—`);\r\n  }\r\n  \r\n  resumeQueue(phone: string): void {\r\n    this.ipcService.send('resume-queue', { phone });\r\n    this.toastService.info(`æ¢å¾© ${phone} çš„ç™¼é€éšŠåˆ—`);\r\n  }\r\n  \r\n  pauseAllQueues(): void {\r\n    const statuses = this.queueStatuses();\r\n    statuses.forEach((_, phone) => {\r\n      this.ipcService.send('pause-queue', { phone });\r\n    });\r\n    this.toastService.info('å·²æš«åœæ‰€æœ‰ç™¼é€éšŠåˆ—');\r\n  }\r\n  \r\n  resumeAllQueues(): void {\r\n    const statuses = this.queueStatuses();\r\n    statuses.forEach((_, phone) => {\r\n      this.ipcService.send('resume-queue', { phone });\r\n    });\r\n    this.toastService.info('å·²æ¢å¾©æ‰€æœ‰ç™¼é€éšŠåˆ—');\r\n  }\r\n  \r\n  deleteMessage(phone: string, messageId: string): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ¶ˆæ¯å—ï¼Ÿ')) return;\r\n    this.ipcService.send('delete-queue-message', { phone, messageId });\r\n  }\r\n  \r\n  updateMessagePriority(phone: string, messageId: string, priority: string): void {\r\n    this.ipcService.send('update-queue-priority', { phone, messageId, priority });\r\n  }\r\n  \r\n  retryFailedMessages(phone?: string): void {\r\n    this.ipcService.send('retry-failed-messages', { phone });\r\n    this.toastService.info('æ­£åœ¨é‡è©¦å¤±æ•—çš„æ¶ˆæ¯...');\r\n  }\r\n  \r\n  // ==================== å°è©±æ¡†æ“ä½œ ====================\r\n  \r\n  viewDetails(phone: string): void {\r\n    this.selectedPhone.set(phone);\r\n    this.getMessages(phone);\r\n    this.showQueueDetails.set(true);\r\n  }\r\n  \r\n  closeDetails(): void {\r\n    this.showQueueDetails.set(false);\r\n    this.selectedPhone.set(null);\r\n    this.currentQueueMessages.set([]);\r\n  }\r\n  \r\n  // ==================== æ­·å²æ•¸æ“š ====================\r\n  \r\n  loadHistory(days = 7): void {\r\n    this.ipcService.send('get-queue-length-history', { days });\r\n  }\r\n  \r\n  // ==================== è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  getStatusForAccount(phone: string): QueueStatus | null {\r\n    return this.queueStatuses().get(phone) || null;\r\n  }\r\n  \r\n  getStatusLabel(status: string): string {\r\n    const labels: Record<string, string> = {\r\n      'pending': 'å¾…ç™¼é€',\r\n      'sending': 'ç™¼é€ä¸­',\r\n      'sent': 'å·²ç™¼é€',\r\n      'failed': 'å¤±æ•—',\r\n      'paused': 'å·²æš«åœ'\r\n    };\r\n    return labels[status] || status;\r\n  }\r\n  \r\n  getStatusColor(status: string): string {\r\n    const colors: Record<string, string> = {\r\n      'pending': 'bg-amber-500/20 text-amber-400',\r\n      'sending': 'bg-cyan-500/20 text-cyan-400 animate-pulse',\r\n      'sent': 'bg-emerald-500/20 text-emerald-400',\r\n      'failed': 'bg-red-500/20 text-red-400',\r\n      'paused': 'bg-slate-500/20 text-slate-400'\r\n    };\r\n    return colors[status] || 'bg-slate-500/20 text-slate-400';\r\n  }\r\n  \r\n  getPriorityLabel(priority: string): string {\r\n    const labels: Record<string, string> = {\r\n      'high': 'é«˜å„ªå…ˆ',\r\n      'normal': 'æ™®é€š',\r\n      'low': 'ä½å„ªå…ˆ'\r\n    };\r\n    return labels[priority] || priority;\r\n  }\r\n  \r\n  getPriorityColor(priority: string): string {\r\n    const colors: Record<string, string> = {\r\n      'high': 'bg-red-500/20 text-red-400',\r\n      'normal': 'bg-cyan-500/20 text-cyan-400',\r\n      'low': 'bg-slate-500/20 text-slate-400'\r\n    };\r\n    return colors[priority] || 'bg-slate-500/20 text-slate-400';\r\n  }\r\n  \r\n  // ==================== IPC å›èª¿è™•ç† ====================\r\n  \r\n  handleQueueStatusResponse(data: any): void {\r\n    this.isRefreshing.set(false);\r\n    if (data.success && data.statuses) {\r\n      const statusMap = new Map<string, QueueStatus>();\r\n      for (const status of data.statuses) {\r\n        statusMap.set(status.phone, status);\r\n      }\r\n      this.queueStatuses.set(statusMap);\r\n    }\r\n  }\r\n  \r\n  handleQueueMessagesResponse(data: any): void {\r\n    if (data.success && data.messages) {\r\n      this.currentQueueMessages.set(data.messages);\r\n    }\r\n  }\r\n  \r\n  handleQueueHistoryResponse(data: any): void {\r\n    if (data.success && data.history) {\r\n      this.queueLengthHistory.set(data.history);\r\n    }\r\n  }\r\n  \r\n  handleQueueUpdate(data: any): void {\r\n    // å¯¦æ™‚æ›´æ–°å–®å€‹éšŠåˆ—ç‹€æ…‹\r\n    if (data.phone && data.status) {\r\n      const statuses = new Map(this.queueStatuses());\r\n      statuses.set(data.phone, data.status);\r\n      this.queueStatuses.set(statuses);\r\n    }\r\n  }\r\n  \r\n  handleMessageSent(data: any): void {\r\n    // æ›´æ–°ç™¼é€æˆåŠŸçš„æ¶ˆæ¯\r\n    if (data.messageId) {\r\n      this.currentQueueMessages.update(messages =>\r\n        messages.map(m =>\r\n          m.id === data.messageId\r\n            ? { ...m, status: 'sent' as const, sentAt: new Date().toISOString() }\r\n            : m\r\n        )\r\n      );\r\n    }\r\n  }\r\n  \r\n  handleMessageFailed(data: any): void {\r\n    // æ›´æ–°ç™¼é€å¤±æ•—çš„æ¶ˆæ¯\r\n    if (data.messageId) {\r\n      this.currentQueueMessages.update(messages =>\r\n        messages.map(m =>\r\n          m.id === data.messageId\r\n            ? { ...m, status: 'failed' as const, error: data.error }\r\n            : m\r\n        )\r\n      );\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Campaign Management Service\r\n * ç‡ŸéŠ·æ´»å‹•ç®¡ç†æœå‹™\r\n * \r\n * ğŸ†• Phase 18: å¾ app.component.ts æå–\r\n * \r\n * ç®¡ç†ç‡ŸéŠ·æ´»å‹•çš„å‰µå»ºã€å•Ÿå‹•ã€æš«åœã€åˆªé™¤ç­‰åŠŸèƒ½\r\n */\r\n\r\nimport { Injectable, signal, inject, computed } from '@angular/core';\r\nimport { IpcService } from '../ipc.service';\r\nimport { ToastService } from '../toast.service';\r\nimport { MembershipService } from '../membership.service';\r\n\r\n// é¡å‹å®šç¾©\r\nexport interface Campaign {\r\n  id: string | number;\r\n  name: string;\r\n  description: string;\r\n  status: 'draft' | 'scheduled' | 'running' | 'paused' | 'completed' | 'failed';\r\n  phases: string[];\r\n  keywords: string[];\r\n  targetGroups: string[];\r\n  assignedAccounts: string[];\r\n  actions: CampaignAction[];\r\n  trigger: CampaignTrigger;\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n  stats?: CampaignStats;\r\n}\r\n\r\nexport interface CampaignAction {\r\n  type: string;\r\n  templateId?: number;\r\n  minDelaySeconds: number;\r\n  maxDelaySeconds: number;\r\n}\r\n\r\nexport interface CampaignTrigger {\r\n  sourceGroupIds: number[];\r\n  keywordSetIds: number[];\r\n}\r\n\r\nexport interface CampaignStats {\r\n  totalSent: number;\r\n  successCount: number;\r\n  failureCount: number;\r\n  conversionRate: number;\r\n}\r\n\r\nexport interface CampaignFormData {\r\n  name: string;\r\n  description: string;\r\n  phases: string[];\r\n  keywords: string[];\r\n  targetGroups: string[];\r\n  assignedAccounts: string[];\r\n}\r\n\r\nexport interface NewCampaignForm {\r\n  name: string;\r\n  trigger: CampaignTrigger;\r\n  action: {\r\n    templateId: number;\r\n    minDelaySeconds: number;\r\n    maxDelaySeconds: number;\r\n  };\r\n}\r\n\r\nexport interface UnifiedOverview {\r\n  success: boolean;\r\n  totalLeads: number;\r\n  totalConversions: number;\r\n  conversionRate: number;\r\n  dailyStats: any[];\r\n}\r\n\r\nexport interface FunnelAnalysis {\r\n  success: boolean;\r\n  stages: FunnelStage[];\r\n}\r\n\r\nexport interface FunnelStage {\r\n  name: string;\r\n  count: number;\r\n  percentage: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CampaignManagementService {\r\n  private ipcService = inject(IpcService);\r\n  private toastService = inject(ToastService);\r\n  private membershipService = inject(MembershipService);\r\n  \r\n  // ç‹€æ…‹\r\n  readonly campaigns = signal<Campaign[]>([]);\r\n  readonly selectedCampaign = signal<Campaign | null>(null);\r\n  readonly unifiedOverview = signal<UnifiedOverview | null>(null);\r\n  readonly funnelAnalysis = signal<FunnelAnalysis | null>(null);\r\n  \r\n  // è¡¨å–®ç‹€æ…‹\r\n  readonly showCampaignForm = signal(false);\r\n  readonly campaignFormData = signal<CampaignFormData>({\r\n    name: '',\r\n    description: '',\r\n    phases: ['discovery', 'monitoring', 'outreach'],\r\n    keywords: [],\r\n    targetGroups: [],\r\n    assignedAccounts: []\r\n  });\r\n  readonly newCampaign = signal<NewCampaignForm>(this.getEmptyCampaignForm());\r\n  readonly campaignKeywordInput = signal('');\r\n  readonly isSubmittingCampaign = signal(false);\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  readonly activeCampaigns = computed(() => \r\n    this.campaigns().filter(c => c.status === 'running')\r\n  );\r\n  \r\n  readonly pausedCampaigns = computed(() => \r\n    this.campaigns().filter(c => c.status === 'paused')\r\n  );\r\n  \r\n  readonly completedCampaigns = computed(() => \r\n    this.campaigns().filter(c => c.status === 'completed')\r\n  );\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ==================== åŠ è¼‰æ–¹æ³• ====================\r\n  \r\n  loadCampaigns(): void {\r\n    this.ipcService.send('get-campaigns', { limit: 50 });\r\n  }\r\n  \r\n  loadUnifiedOverview(): void {\r\n    this.ipcService.send('get-unified-overview', { days: 7 });\r\n  }\r\n  \r\n  loadFunnelAnalysis(): void {\r\n    this.ipcService.send('get-funnel-analysis', {});\r\n  }\r\n  \r\n  loadCampaignData(): void {\r\n    this.loadCampaigns();\r\n    this.loadUnifiedOverview();\r\n    this.loadFunnelAnalysis();\r\n  }\r\n  \r\n  // ==================== æ´»å‹•æ“ä½œ ====================\r\n  \r\n  createCampaignFromForm(): void {\r\n    // æ£€æŸ¥è¥é”€æ´»åŠ¨æƒé™\r\n    if (!this.membershipService.hasFeature('aiSalesFunnel')) {\r\n      this.toastService.warning(`ğŸ’ ç‡ŸéŠ·æ´»å‹•åŠŸèƒ½éœ€è¦ é‘½çŸ³ç‹ç‰Œ æˆ–ä»¥ä¸Šæœƒå“¡ï¼Œå‡ç´šè§£é–æ›´å¤šåŠŸèƒ½`);\r\n      window.dispatchEvent(new CustomEvent('open-membership-dialog'));\r\n      return;\r\n    }\r\n    \r\n    const form = this.campaignFormData();\r\n    if (!form.name.trim()) {\r\n      this.toastService.warning('è«‹è¼¸å…¥æ´»å‹•åç¨±');\r\n      return;\r\n    }\r\n    if (form.assignedAccounts.length === 0) {\r\n      this.toastService.warning('è«‹é¸æ“‡å¸³è™Ÿ');\r\n      return;\r\n    }\r\n    \r\n    this.ipcService.send('create-campaign', {\r\n      name: form.name,\r\n      description: form.description,\r\n      phases: form.phases,\r\n      keywords: form.keywords,\r\n      targetGroups: form.targetGroups,\r\n      assignedAccounts: form.assignedAccounts\r\n    });\r\n    \r\n    this.resetCampaignForm();\r\n  }\r\n  \r\n  addCampaign(): void {\r\n    // é˜²æ­¢é‡è¤‡æäº¤\r\n    if (this.isSubmittingCampaign()) {\r\n      this.toastService.warning('æ­£åœ¨å‰µå»ºæ´»å‹•ï¼Œè«‹ç¨å€™...', 2000);\r\n      return;\r\n    }\r\n    \r\n    const form = this.newCampaign();\r\n    const errors: string[] = [];\r\n    \r\n    if (!form.name?.trim()) {\r\n      errors.push('æ´»åŠ¨åç§°');\r\n    }\r\n    if (!form.action.templateId || form.action.templateId === 0) {\r\n      errors.push('æ¶ˆæ¯æ¨¡æ¿');\r\n    }\r\n    if (form.trigger.sourceGroupIds.length === 0) {\r\n      errors.push('è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ¥æºç¾¤ç»„');\r\n    }\r\n    if (form.trigger.keywordSetIds.length === 0) {\r\n      errors.push('è‡³å°‘é€‰æ‹©ä¸€ä¸ªå…³é”®è¯é›†');\r\n    }\r\n    \r\n    if (errors.length > 0) {\r\n      this.toastService.error(`è¯·å®Œå–„ä»¥ä¸‹å†…å®¹: ${errors.join(', ')}`);\r\n      return;\r\n    }\r\n    \r\n    // æª¢æŸ¥æœ¬åœ°æ˜¯å¦å·²æœ‰åŒåæ´»å‹•\r\n    const campaignName = form.name.trim();\r\n    const existingCampaign = this.campaigns().find(c => c.name === campaignName);\r\n    if (existingCampaign) {\r\n      this.toastService.warning(`æ´»å‹• \"${campaignName}\" å·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨ä¸åŒçš„åç¨±`, 4000);\r\n      return;\r\n    }\r\n    \r\n    // è¨­ç½®æäº¤ç‹€æ…‹\r\n    this.isSubmittingCampaign.set(true);\r\n    \r\n    // ç«‹å³æ¸…ç©ºè¡¨å–®ï¼Œé˜²æ­¢é‡è¤‡æäº¤\r\n    this.newCampaign.set(this.getEmptyCampaignForm());\r\n    \r\n    // ç™¼é€å‰µå»ºè«‹æ±‚\r\n    this.ipcService.send('add-campaign', { ...form });\r\n    \r\n    // 3 ç§’å¾Œé‡ç½®æäº¤ç‹€æ…‹ï¼ˆå¦‚æœå¾Œç«¯æ²’æœ‰éŸ¿æ‡‰ï¼‰\r\n    setTimeout(() => {\r\n      this.isSubmittingCampaign.set(false);\r\n    }, 3000);\r\n  }\r\n  \r\n  startCampaign(campaignId: string): void {\r\n    if (!confirm('ç¢ºå®šè¦å•Ÿå‹•æ­¤æ´»å‹•å—ï¼Ÿ')) return;\r\n    this.ipcService.send('start-campaign', { campaignId });\r\n  }\r\n  \r\n  pauseCampaign(campaignId: string): void {\r\n    this.ipcService.send('pause-campaign', { campaignId });\r\n  }\r\n  \r\n  resumeCampaign(campaignId: string): void {\r\n    this.ipcService.send('resume-campaign', { campaignId });\r\n  }\r\n  \r\n  stopCampaign(campaignId: string): void {\r\n    if (!confirm('ç¢ºå®šè¦åœæ­¢æ­¤æ´»å‹•å—ï¼Ÿ')) return;\r\n    this.ipcService.send('stop-campaign', { campaignId });\r\n  }\r\n  \r\n  deleteCampaign(campaignId: string): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ´»å‹•å—ï¼Ÿ')) return;\r\n    this.ipcService.send('delete-campaign', { campaignId });\r\n  }\r\n  \r\n  toggleCampaignStatus(id: number): void {\r\n    this.ipcService.send('toggle-campaign-status', { id });\r\n  }\r\n  \r\n  viewCampaignDetails(campaign: Campaign): void {\r\n    this.selectedCampaign.set(campaign);\r\n    this.ipcService.send('get-campaign-logs', { campaignId: campaign.id });\r\n  }\r\n  \r\n  // ==================== è¡¨å–®æ“ä½œ ====================\r\n  \r\n  toggleCampaignPhase(phase: string): void {\r\n    this.campaignFormData.update(c => {\r\n      const phases = [...c.phases];\r\n      const idx = phases.indexOf(phase);\r\n      if (idx >= 0) {\r\n        phases.splice(idx, 1);\r\n      } else {\r\n        phases.push(phase);\r\n      }\r\n      return { ...c, phases };\r\n    });\r\n  }\r\n  \r\n  addCampaignKeyword(): void {\r\n    const keyword = this.campaignKeywordInput().trim();\r\n    if (!keyword) return;\r\n    \r\n    this.campaignFormData.update(c => ({\r\n      ...c,\r\n      keywords: [...c.keywords, keyword]\r\n    }));\r\n    this.campaignKeywordInput.set('');\r\n  }\r\n  \r\n  removeCampaignKeyword(keyword: string): void {\r\n    this.campaignFormData.update(c => ({\r\n      ...c,\r\n      keywords: c.keywords.filter(k => k !== keyword)\r\n    }));\r\n  }\r\n  \r\n  toggleCampaignAccount(phone: string): void {\r\n    this.campaignFormData.update(c => {\r\n      const accounts = [...c.assignedAccounts];\r\n      const idx = accounts.indexOf(phone);\r\n      if (idx >= 0) {\r\n        accounts.splice(idx, 1);\r\n      } else {\r\n        accounts.push(phone);\r\n      }\r\n      return { ...c, assignedAccounts: accounts };\r\n    });\r\n  }\r\n  \r\n  toggleNewCampaignSourceGroup(groupId: number): void {\r\n    this.newCampaign.update(c => {\r\n      const ids = [...c.trigger.sourceGroupIds];\r\n      const idx = ids.indexOf(groupId);\r\n      if (idx >= 0) {\r\n        ids.splice(idx, 1);\r\n      } else {\r\n        ids.push(groupId);\r\n      }\r\n      return { ...c, trigger: { ...c.trigger, sourceGroupIds: ids } };\r\n    });\r\n  }\r\n  \r\n  toggleNewCampaignKeywordSet(setId: number): void {\r\n    this.newCampaign.update(c => {\r\n      const ids = [...c.trigger.keywordSetIds];\r\n      const idx = ids.indexOf(setId);\r\n      if (idx >= 0) {\r\n        ids.splice(idx, 1);\r\n      } else {\r\n        ids.push(setId);\r\n      }\r\n      return { ...c, trigger: { ...c.trigger, keywordSetIds: ids } };\r\n    });\r\n  }\r\n  \r\n  updateCampaignFormName(value: string): void {\r\n    this.campaignFormData.update(c => ({ ...c, name: value }));\r\n  }\r\n  \r\n  updateCampaignFormDesc(value: string): void {\r\n    this.campaignFormData.update(c => ({ ...c, description: value }));\r\n  }\r\n  \r\n  updateNewCampaignName(value: string): void {\r\n    this.newCampaign.update(c => ({ ...c, name: value }));\r\n  }\r\n  \r\n  updateNewCampaignTemplateId(value: number): void {\r\n    this.newCampaign.update(c => ({ \r\n      ...c, \r\n      action: { ...c.action, templateId: value } \r\n    }));\r\n  }\r\n  \r\n  // ==================== è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  getEmptyCampaignForm(): NewCampaignForm {\r\n    return {\r\n      name: '',\r\n      trigger: { sourceGroupIds: [], keywordSetIds: [] },\r\n      action: { templateId: 0, minDelaySeconds: 30, maxDelaySeconds: 120 }\r\n    };\r\n  }\r\n  \r\n  resetCampaignForm(): void {\r\n    this.campaignFormData.set({\r\n      name: '',\r\n      description: '',\r\n      phases: ['discovery', 'monitoring', 'outreach'],\r\n      keywords: [],\r\n      targetGroups: [],\r\n      assignedAccounts: []\r\n    });\r\n    this.showCampaignForm.set(false);\r\n  }\r\n  \r\n  getCampaignStatusLabel(status: string): string {\r\n    const labels: Record<string, string> = {\r\n      'draft': 'è‰ç¨¿',\r\n      'scheduled': 'å·²æ’ç¨‹',\r\n      'running': 'é‹è¡Œä¸­',\r\n      'paused': 'å·²æš«åœ',\r\n      'completed': 'å·²å®Œæˆ',\r\n      'failed': 'å¤±æ•—'\r\n    };\r\n    return labels[status] || status;\r\n  }\r\n  \r\n  getCampaignStatusColor(status: string): string {\r\n    const colors: Record<string, string> = {\r\n      'draft': 'bg-slate-500/20 text-slate-400',\r\n      'scheduled': 'bg-blue-500/20 text-blue-400',\r\n      'running': 'bg-green-500/20 text-green-400',\r\n      'paused': 'bg-yellow-500/20 text-yellow-400',\r\n      'completed': 'bg-cyan-500/20 text-cyan-400',\r\n      'failed': 'bg-red-500/20 text-red-400'\r\n    };\r\n    return colors[status] || 'bg-slate-500/20 text-slate-400';\r\n  }\r\n  \r\n  getPhaseLabel(phase: string): string {\r\n    const labels: Record<string, string> = {\r\n      'discovery': 'è³‡æºç™¼ç¾',\r\n      'monitoring': 'ç›£æ§ç²å®¢',\r\n      'outreach': 'å»£å‘Šè§¸é”',\r\n      'tracking': 'ç”¨æˆ¶è¿½è¹¤',\r\n      'conversion': 'è½‰åŒ–æˆäº¤'\r\n    };\r\n    return labels[phase] || phase;\r\n  }\r\n  \r\n  getCampaignName(id?: number): string {\r\n    if (!id) return 'N/A';\r\n    return this.campaigns().find(c => c.id === id)?.name || 'Unknown Campaign';\r\n  }\r\n  \r\n  getCampaignById(id: number | undefined): Campaign | undefined {\r\n    if (id === undefined) return undefined;\r\n    return this.campaigns().find(c => c.id === id);\r\n  }\r\n  \r\n  // ==================== IPC äº‹ä»¶è™•ç† ====================\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipcService.on('campaigns-result', (data: any) => this.handleCampaigns(data));\r\n    this.ipcService.on('campaign-created', (data: any) => this.handleCampaignCreated(data));\r\n    this.ipcService.on('campaign-deleted', (data: any) => this.handleCampaignDeleted(data));\r\n    this.ipcService.on('unified-overview-result', (data: any) => this.handleUnifiedOverview(data));\r\n    this.ipcService.on('funnel-analysis-result', (data: any) => this.handleFunnelAnalysis(data));\r\n    this.ipcService.on('campaign-added', (data: any) => this.handleCampaignAdded(data));\r\n    this.ipcService.on('campaign-status-toggled', (data: any) => this.handleCampaignStatusToggled(data));\r\n  }\r\n  \r\n  private handleCampaigns(data: any): void {\r\n    if (data.success) {\r\n      this.campaigns.set(data.campaigns || []);\r\n    }\r\n  }\r\n  \r\n  private handleCampaignCreated(data: any): void {\r\n    if (data.success) {\r\n      this.toastService.success('ç‡ŸéŠ·æ´»å‹•å·²å‰µå»º');\r\n      this.loadCampaigns();\r\n    } else {\r\n      this.toastService.error(`å‰µå»ºå¤±æ•—: ${data.error}`);\r\n    }\r\n  }\r\n  \r\n  private handleCampaignDeleted(data: any): void {\r\n    if (data.success) {\r\n      this.toastService.success('ç‡ŸéŠ·æ´»å‹•å·²åˆªé™¤');\r\n      this.loadCampaigns();\r\n    }\r\n  }\r\n  \r\n  private handleUnifiedOverview(data: any): void {\r\n    if (data.success) {\r\n      this.unifiedOverview.set(data);\r\n    }\r\n  }\r\n  \r\n  private handleFunnelAnalysis(data: any): void {\r\n    if (data.success) {\r\n      this.funnelAnalysis.set(data);\r\n    }\r\n  }\r\n  \r\n  private handleCampaignAdded(data: any): void {\r\n    this.isSubmittingCampaign.set(false);\r\n    if (data.success) {\r\n      this.toastService.success('æ´»å‹•å‰µå»ºæˆåŠŸ');\r\n      this.loadCampaigns();\r\n    } else {\r\n      this.toastService.error(`å‰µå»ºå¤±æ•—: ${data.error}`);\r\n    }\r\n  }\r\n  \r\n  private handleCampaignStatusToggled(data: any): void {\r\n    if (data.success) {\r\n      this.loadCampaigns();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Template Management Service\r\n * æ¶ˆæ¯æ¨¡æ¿ç®¡ç†æœå‹™\r\n * \r\n * ğŸ†• Phase 18: å¾ app.component.ts æå–\r\n * \r\n * ç®¡ç†èŠå¤©æ¨¡æ¿ã€æ¶ˆæ¯ç¯„æœ¬çš„å‰µå»ºã€ç·¨è¼¯ã€åˆªé™¤ç­‰åŠŸèƒ½\r\n */\r\n\r\nimport { Injectable, signal, inject, computed } from '@angular/core';\r\nimport { IpcService } from '../ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// é¡å‹å®šç¾©\r\nexport interface MessageTemplate {\r\n  id: number;\r\n  name: string;\r\n  prompt: string;\r\n  content?: string;\r\n  active: boolean;\r\n  usageCount?: number;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\nexport interface NewTemplateForm {\r\n  name: string;\r\n  prompt: string;\r\n}\r\n\r\nexport interface TemplateVariable {\r\n  name: string;\r\n  placeholder: string;\r\n  description: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TemplateManagementService {\r\n  private ipcService = inject(IpcService);\r\n  private toastService = inject(ToastService);\r\n  \r\n  // ç‹€æ…‹\r\n  readonly messageTemplates = signal<MessageTemplate[]>([]);\r\n  readonly selectedTemplate = signal<MessageTemplate | null>(null);\r\n  \r\n  // è¡¨å–®ç‹€æ…‹\r\n  readonly showTemplateCreator = signal(false);\r\n  readonly newTemplate = signal<NewTemplateForm>({ name: '', prompt: '' });\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  readonly activeTemplates = computed(() => \r\n    this.messageTemplates().filter(t => t.active)\r\n  );\r\n  \r\n  readonly templateCount = computed(() => this.messageTemplates().length);\r\n  \r\n  // å¯ç”¨è®Šé‡åˆ—è¡¨\r\n  readonly availableVariables: TemplateVariable[] = [\r\n    { name: 'name', placeholder: '{name}', description: 'ç”¨æˆ¶åç¨±' },\r\n    { name: 'username', placeholder: '{username}', description: 'ç”¨æˆ¶ @username' },\r\n    { name: 'group_name', placeholder: '{group_name}', description: 'ç¾¤çµ„åç¨±' },\r\n    { name: 'keyword', placeholder: '{keyword}', description: 'è§¸ç™¼é—œéµè©' },\r\n    { name: 'date', placeholder: '{date}', description: 'ç•¶å‰æ—¥æœŸ' },\r\n    { name: 'time', placeholder: '{time}', description: 'ç•¶å‰æ™‚é–“' }\r\n  ];\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ==================== åŠ è¼‰æ–¹æ³• ====================\r\n  \r\n  loadTemplates(): void {\r\n    this.ipcService.send('get-templates', {});\r\n  }\r\n  \r\n  // ==================== æ¨¡æ¿æ“ä½œ ====================\r\n  \r\n  addTemplate(): void {\r\n    const form = this.newTemplate();\r\n    if (form.name.trim() && form.prompt.trim()) {\r\n      this.ipcService.send('add-template', { \r\n        name: form.name, \r\n        prompt: form.prompt \r\n      });\r\n      this.newTemplate.set({ name: '', prompt: '' });\r\n      this.toastService.success('æ¨¡æ¿æ·»åŠ æˆåŠŸ');\r\n    } else {\r\n      this.toastService.error('è¯·å¡«å†™æ¨¡æ¿åç§°å’Œæ¶ˆæ¯å†…å®¹');\r\n    }\r\n  }\r\n  \r\n  addTemplateQuick(name: string, prompt: string): void {\r\n    if (name?.trim() && prompt?.trim()) {\r\n      // Check if template with same name already exists\r\n      const exists = this.messageTemplates().some(t => t.name === name.trim());\r\n      if (exists) {\r\n        this.toastService.warning('æ¨¡æ¿åç¨±å·²å­˜åœ¨ï¼Œç„¡æ³•å‰µå»ºé‡è¤‡æ¨¡æ¿', 3000);\r\n        return;\r\n      }\r\n      this.ipcService.send('add-template', { \r\n        name: name.trim(), \r\n        prompt: prompt.trim() \r\n      });\r\n      this.newTemplate.set({ name: '', prompt: '' });\r\n      this.toastService.success('æ¨¡æ¿æ·»åŠ æˆåŠŸ');\r\n      // è‡ªå‹•é—œé–‰å‰µå»ºé¢æ¿ï¼ˆå¦‚æœå·²æœ‰æ¨¡æ¿ï¼‰\r\n      if (this.messageTemplates().length > 0) {\r\n        this.showTemplateCreator.set(false);\r\n      }\r\n    } else {\r\n      this.toastService.error('è¯·å¡«å†™æ¨¡æ¿åç§°å’Œæ¶ˆæ¯å†…å®¹');\r\n    }\r\n  }\r\n  \r\n  toggleTemplateStatus(templateId: number): void {\r\n    this.ipcService.send('toggle-template-status', { id: templateId });\r\n  }\r\n  \r\n  removeTemplate(templateId: number, campaigns: any[] = []): void {\r\n    const template = this.messageTemplates().find(t => t.id === templateId);\r\n    if (!template) return;\r\n    \r\n    // æª¢æŸ¥æ˜¯å¦æœ‰æ´»å‹•æ­£åœ¨ä½¿ç”¨æ­¤æ¨¡æ¿\r\n    const usingCampaigns = campaigns.filter(c => \r\n      c.actions?.some((a: any) => a.templateId === templateId)\r\n    );\r\n    \r\n    if (usingCampaigns.length > 0) {\r\n      const campaignNames = usingCampaigns.map(c => c.name).join(', ');\r\n      if (!confirm(`æ¨¡æ¿ \"${template.name}\" æ­£åœ¨è¢«ä»¥ä¸‹æ´»å‹•ä½¿ç”¨ï¼š${campaignNames}\\n\\nåˆªé™¤æ¨¡æ¿å¾Œï¼Œé€™äº›æ´»å‹•å°‡ç„¡æ³•æ­£å¸¸å·¥ä½œã€‚\\n\\nç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ`)) {\r\n        return;\r\n      }\r\n    } else {\r\n      if (!confirm(`ç¢ºå®šè¦åˆªé™¤æ¨¡æ¿ \"${template.name}\" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤éŠ·ã€‚`)) {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    this.ipcService.send('remove-template', { id: templateId });\r\n    this.toastService.success('æ¨¡æ¿å·²åˆªé™¤');\r\n  }\r\n  \r\n  selectTemplate(template: MessageTemplate): void {\r\n    this.selectedTemplate.set(template);\r\n  }\r\n  \r\n  clearSelection(): void {\r\n    this.selectedTemplate.set(null);\r\n  }\r\n  \r\n  // ==================== è¡¨å–®æ“ä½œ ====================\r\n  \r\n  updateTemplateName(value: string): void {\r\n    this.newTemplate.update(t => ({ ...t, name: value }));\r\n  }\r\n  \r\n  updateTemplatePrompt(value: string): void {\r\n    this.newTemplate.update(t => ({ ...t, prompt: value }));\r\n  }\r\n  \r\n  insertTemplateVariable(textarea: HTMLTextAreaElement, variable: string): void {\r\n    const start = textarea.selectionStart;\r\n    const end = textarea.selectionEnd;\r\n    const text = textarea.value;\r\n    const newText = text.substring(0, start) + variable + text.substring(end);\r\n    textarea.value = newText;\r\n    this.updateTemplatePrompt(newText);\r\n    // Set cursor position after the inserted variable\r\n    setTimeout(() => {\r\n      textarea.focus();\r\n      textarea.selectionStart = textarea.selectionEnd = start + variable.length;\r\n    }, 0);\r\n  }\r\n  \r\n  openTemplateCreator(): void {\r\n    this.showTemplateCreator.set(true);\r\n    this.newTemplate.set({ name: '', prompt: '' });\r\n  }\r\n  \r\n  closeTemplateCreator(): void {\r\n    this.showTemplateCreator.set(false);\r\n  }\r\n  \r\n  // ==================== è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  getTemplateName(id?: number): string {\r\n    if (!id) return 'N/A';\r\n    return this.messageTemplates().find(t => t.id === id)?.name || 'Unknown Template';\r\n  }\r\n  \r\n  getTemplateById(id: number): MessageTemplate | undefined {\r\n    return this.messageTemplates().find(t => t.id === id);\r\n  }\r\n  \r\n  // ==================== IPC äº‹ä»¶è™•ç† ====================\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipcService.on('templates-result', (data: any) => this.handleTemplates(data));\r\n    this.ipcService.on('template-added', (data: any) => this.handleTemplateAdded(data));\r\n    this.ipcService.on('template-removed', (data: any) => this.handleTemplateRemoved(data));\r\n    this.ipcService.on('template-status-toggled', (data: any) => this.handleTemplateStatusToggled(data));\r\n  }\r\n  \r\n  private handleTemplates(data: any): void {\r\n    if (data.success || data.templates) {\r\n      this.messageTemplates.set(data.templates || []);\r\n    }\r\n  }\r\n  \r\n  private handleTemplateAdded(data: any): void {\r\n    if (data.success) {\r\n      this.loadTemplates();\r\n    } else {\r\n      this.toastService.error(`æ·»åŠ å¤±æ•—: ${data.error}`);\r\n    }\r\n  }\r\n  \r\n  private handleTemplateRemoved(data: any): void {\r\n    if (data.success) {\r\n      this.loadTemplates();\r\n    }\r\n  }\r\n  \r\n  private handleTemplateStatusToggled(data: any): void {\r\n    if (data.success) {\r\n      this.loadTemplates();\r\n    }\r\n  }\r\n}\r\n","/**\n * Navigation Service\n * å°èˆªæœå‹™ - çµ±ä¸€ç®¡ç†è¦–åœ–åˆ‡æ›å’Œè·¯ç”±\n * \n * ğŸ†• Phase 19: ç‚º Angular Router é·ç§»åšæº–å‚™\n * \n * åŠŸèƒ½ï¼š\n * - çµ±ä¸€çš„è¦–åœ–åˆ‡æ› API\n * - æœƒå“¡æ¬Šé™æª¢æŸ¥\n * - å°èˆªæ­·å²ç®¡ç†\n * - èˆ‡ Angular Router å…¼å®¹\n */\n\nimport { Injectable, signal, inject, computed } from '@angular/core';\nimport { Router, NavigationEnd } from '@angular/router';\nimport { filter } from 'rxjs/operators';\nimport { MembershipService } from '../membership.service';\nimport { ToastService } from '../toast.service';\n\n// è¦–åœ–é¡å‹å®šç¾©\nexport type ViewType = \n  | 'dashboard' \n  | 'accounts' \n  | 'add-account' \n  | 'api-credentials'\n  | 'resources' \n  | 'member-database' \n  | 'resource-center' \n  | 'search-discovery'\n  | 'ai-assistant'\n  | 'automation'\n  | 'leads'\n  | 'lead-nurturing'\n  | 'nurturing-analytics'\n  | 'ads'\n  | 'user-tracking'\n  | 'campaigns'\n  | 'multi-role'\n  | 'ai-team'\n  | 'ai-center'\n  | 'settings'\n  | 'analytics'\n  | 'analytics-center'\n  | 'profile'\n  | 'membership-center'\n  | 'monitoring-accounts'\n  | 'monitoring-groups'\n  | 'keyword-sets'\n  | 'chat-templates'\n  | 'trigger-rules'\n  | 'collected-users';\n\n// è¦–åœ–é…ç½®\ninterface ViewConfig {\n  path: string;\n  title: string;\n  icon: string;\n  requiredFeature?: string;\n  membershipLevel?: string;\n  membershipMessage?: string;\n}\n\n// è¦–åœ–åˆ°è·¯ç”±è·¯å¾‘çš„æ˜ å°„\nconst VIEW_CONFIG: Record<ViewType, ViewConfig> = {\n  'dashboard': { path: '/dashboard', title: 'å„€è¡¨æ¿', icon: 'ğŸ ' },\n  'accounts': { path: '/accounts', title: 'å¸³è™Ÿç®¡ç†', icon: 'ğŸ‘¥' },\n  'add-account': { path: '/accounts/add', title: 'æ·»åŠ å¸³è™Ÿ', icon: 'â•' },\n  'api-credentials': { path: '/accounts/api', title: 'API æ†‘è­‰', icon: 'ğŸ”‘' },\n  'resources': { path: '/resources', title: 'è³‡æºç®¡ç†', icon: 'ğŸ“¦' },\n  'member-database': { path: '/member-database', title: 'æˆå“¡è³‡æ–™åº«', icon: 'ğŸ“Š' },\n  'resource-center': { path: '/resource-center', title: 'è³‡æºä¸­å¿ƒ', icon: 'ğŸ¢' },\n  'search-discovery': { path: '/search-discovery', title: 'è³‡æºç™¼ç¾', icon: 'ğŸ”' },\n  'ai-assistant': { \n    path: '/ai-assistant', \n    title: 'AI ç­–ç•¥è¦åŠƒ', \n    icon: 'ğŸ¤–',\n    requiredFeature: 'strategyPlanning',\n    membershipLevel: 'diamond',\n    membershipMessage: 'ğŸ’ AIç­–ç•¥è¦åŠƒéœ€è¦ é‘½çŸ³ç‹ç‰Œ æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'automation': { path: '/automation', title: 'è‡ªå‹•åŒ–ä¸­å¿ƒ', icon: 'âš™ï¸' },\n  'leads': { path: '/leads', title: 'æ½›åœ¨å®¢æˆ¶', icon: 'ğŸ¯' },\n  'lead-nurturing': { path: '/lead-nurturing', title: 'ç·šç´¢åŸ¹è‚²', icon: 'ğŸŒ±' },\n  'nurturing-analytics': { path: '/nurturing-analytics', title: 'åŸ¹è‚²åˆ†æ', icon: 'ğŸ“ˆ' },\n  'ads': { \n    path: '/ads', \n    title: 'å»£å‘Šç™¼é€', \n    icon: 'ğŸ“¢',\n    requiredFeature: 'adBroadcast',\n    membershipLevel: 'silver',\n    membershipMessage: 'ğŸ¥ˆ å»£å‘Šç™¼é€åŠŸèƒ½éœ€è¦ ç™½éŠ€ç²¾è‹± æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'user-tracking': { \n    path: '/user-tracking', \n    title: 'ç”¨æˆ¶è¿½è¹¤', \n    icon: 'ğŸ‘¤',\n    requiredFeature: 'advancedAnalytics',\n    membershipLevel: 'diamond',\n    membershipMessage: 'ğŸ’ ç”¨æˆ¶è¿½è¹¤åŠŸèƒ½éœ€è¦ é‘½çŸ³ç‹ç‰Œ æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'campaigns': { \n    path: '/campaigns', \n    title: 'ç‡ŸéŠ·æ´»å‹•', \n    icon: 'ğŸš€',\n    requiredFeature: 'aiSalesFunnel',\n    membershipLevel: 'diamond',\n    membershipMessage: 'ğŸ’ ç‡ŸéŠ·æ´»å‹•åŠŸèƒ½éœ€è¦ é‘½çŸ³ç‹ç‰Œ æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'multi-role': { \n    path: '/multi-role', \n    title: 'å¤šè§’è‰²å”ä½œ', \n    icon: 'ğŸ­',\n    requiredFeature: 'multiRole',\n    membershipLevel: 'diamond',\n    membershipMessage: 'ğŸ’ å¤šè§’è‰²å”ä½œåŠŸèƒ½éœ€è¦ é‘½çŸ³ç‹ç‰Œ æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'ai-team': { \n    path: '/ai-team', \n    title: 'AI åœ˜éšŠéŠ·å”®', \n    icon: 'ğŸ¤',\n    requiredFeature: 'autoExecution',\n    membershipLevel: 'diamond',\n    membershipMessage: 'ğŸ’ AIåœ˜éšŠéŠ·å”®éœ€è¦ é‘½çŸ³ç‹ç‰Œ æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'ai-center': { path: '/ai-center', title: 'AI ä¸­å¿ƒ', icon: 'ğŸ§ ' },\n  'settings': { path: '/settings', title: 'è¨­å®š', icon: 'âš™ï¸' },\n  'analytics': { \n    path: '/analytics', \n    title: 'æ•¸æ“šæ´å¯Ÿ', \n    icon: 'ğŸ“Š',\n    requiredFeature: 'dataInsightsBasic',\n    membershipLevel: 'gold',\n    membershipMessage: 'ğŸ¥‡ æ•¸æ“šæ´å¯ŸåŠŸèƒ½éœ€è¦ é»ƒé‡‘å¤§å¸« æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'analytics-center': { \n    path: '/analytics-center', \n    title: 'æ•¸æ“šåˆ†æä¸­å¿ƒ', \n    icon: 'ğŸ“‰',\n    requiredFeature: 'dataInsightsBasic',\n    membershipLevel: 'gold',\n    membershipMessage: 'ğŸ¥‡ æ•¸æ“šåˆ†æåŠŸèƒ½éœ€è¦ é»ƒé‡‘å¤§å¸« æˆ–ä»¥ä¸Šæœƒå“¡'\n  },\n  'profile': { path: '/profile', title: 'å€‹äººè³‡æ–™', icon: 'ğŸ‘¤' },\n  'membership-center': { path: '/membership', title: 'æœƒå“¡ä¸­å¿ƒ', icon: 'â­' },\n  'monitoring-accounts': { path: '/monitoring/accounts', title: 'ç›£æ§å¸³è™Ÿ', icon: 'ğŸ‘ï¸' },\n  'monitoring-groups': { path: '/monitoring/groups', title: 'ç›£æ§ç¾¤çµ„', icon: 'ğŸ‘ï¸' },\n  'keyword-sets': { path: '/monitoring/keywords', title: 'é—œéµè©é›†', icon: 'ğŸ”¤' },\n  'chat-templates': { path: '/monitoring/templates', title: 'èŠå¤©æ¨¡æ¿', icon: 'ğŸ’¬' },\n  'trigger-rules': { path: '/monitoring/triggers', title: 'è§¸ç™¼è¦å‰‡', icon: 'âš¡' },\n  'collected-users': { path: '/monitoring/users', title: 'æ”¶é›†ç”¨æˆ¶', icon: 'ğŸ‘¥' }\n};\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NavigationService {\n  private membershipService = inject(MembershipService);\n  private toastService = inject(ToastService);\n  \n  // ç•¶å‰è¦–åœ–ï¼ˆä¿æŒèˆ‡ç¾æœ‰ä»£ç¢¼å…¼å®¹ï¼‰\n  readonly currentView = signal<ViewType>('dashboard');\n  \n  // å°èˆªæ­·å²\n  private _history: ViewType[] = ['dashboard'];\n  readonly history = signal<ViewType[]>(['dashboard']);\n  \n  // è¨ˆç®—å±¬æ€§\n  readonly currentViewConfig = computed(() => VIEW_CONFIG[this.currentView()]);\n  readonly canGoBack = computed(() => this._history.length > 1);\n  \n  // äº‹ä»¶å›èª¿ï¼ˆç”¨æ–¼èˆ‡ç¾æœ‰ä»£ç¢¼é›†æˆï¼‰\n  private onNavigateCallbacks: ((view: ViewType) => void)[] = [];\n  \n  /**\n   * å°èˆªåˆ°æŒ‡å®šè¦–åœ–\n   * @param view ç›®æ¨™è¦–åœ–\n   * @param options å°èˆªé¸é …\n   * @returns æ˜¯å¦æˆåŠŸå°èˆª\n   */\n  navigate(view: ViewType, options?: { skipHistory?: boolean; skipPermissionCheck?: boolean }): boolean {\n    // æ¬Šé™æª¢æŸ¥\n    if (!options?.skipPermissionCheck) {\n      const config = VIEW_CONFIG[view];\n      if (config?.requiredFeature && !this.membershipService.hasFeature(config.requiredFeature as any)) {\n        this.toastService.warning(config.membershipMessage || 'æ­¤åŠŸèƒ½éœ€è¦å‡ç´šæœƒå“¡');\n        window.dispatchEvent(new CustomEvent('open-membership-dialog'));\n        return false;\n      }\n    }\n    \n    // æ›´æ–°ç•¶å‰è¦–åœ–\n    const previousView = this.currentView();\n    this.currentView.set(view);\n    \n    // æ›´æ–°æ­·å²\n    if (!options?.skipHistory && view !== previousView) {\n      this._history.push(view);\n      if (this._history.length > 50) {\n        this._history = this._history.slice(-50);\n      }\n      this.history.set([...this._history]);\n    }\n    \n    // è§¸ç™¼å›èª¿\n    this.onNavigateCallbacks.forEach(cb => cb(view));\n    \n    return true;\n  }\n  \n  /**\n   * è¿”å›ä¸Šä¸€å€‹è¦–åœ–\n   */\n  goBack(): boolean {\n    if (this._history.length > 1) {\n      this._history.pop();\n      const previousView = this._history[this._history.length - 1];\n      this.currentView.set(previousView);\n      this.history.set([...this._history]);\n      return true;\n    }\n    return false;\n  }\n  \n  /**\n   * è¿”å›é¦–é \n   */\n  goHome(): void {\n    this.navigate('dashboard');\n  }\n  \n  /**\n   * è¨»å†Šå°èˆªå›èª¿\n   */\n  onNavigate(callback: (view: ViewType) => void): () => void {\n    this.onNavigateCallbacks.push(callback);\n    return () => {\n      const index = this.onNavigateCallbacks.indexOf(callback);\n      if (index > -1) {\n        this.onNavigateCallbacks.splice(index, 1);\n      }\n    };\n  }\n  \n  /**\n   * ç²å–è¦–åœ–é…ç½®\n   */\n  getViewConfig(view: ViewType): ViewConfig | undefined {\n    return VIEW_CONFIG[view];\n  }\n  \n  /**\n   * ç²å–æ‰€æœ‰è¦–åœ–é…ç½®\n   */\n  getAllViewConfigs(): Record<ViewType, ViewConfig> {\n    return VIEW_CONFIG;\n  }\n  \n  /**\n   * æª¢æŸ¥è¦–åœ–æ˜¯å¦å¯ç”¨ï¼ˆæ¬Šé™æª¢æŸ¥ï¼‰\n   */\n  isViewAvailable(view: ViewType): boolean {\n    const config = VIEW_CONFIG[view];\n    if (!config?.requiredFeature) return true;\n    return this.membershipService.hasFeature(config.requiredFeature as any);\n  }\n  \n  /**\n   * ç²å–è¦–åœ–çš„è·¯ç”±è·¯å¾‘\n   */\n  getViewPath(view: ViewType): string {\n    return VIEW_CONFIG[view]?.path || '/dashboard';\n  }\n  \n  /**\n   * å¾è·¯ç”±è·¯å¾‘ç²å–è¦–åœ–åç¨±\n   */\n  getViewFromPath(path: string): ViewType | undefined {\n    for (const [view, config] of Object.entries(VIEW_CONFIG)) {\n      if (config.path === path) {\n        return view as ViewType;\n      }\n    }\n    return undefined;\n  }\n}\n","/**\r\n * Lead Management Service\r\n * ç·šç´¢ç®¡ç†æœå‹™\r\n * \r\n * ğŸ†• Phase 19: å¾ app.component.ts æå–\r\n * \r\n * ç®¡ç†æ½›åœ¨å®¢æˆ¶çš„æ•ç²ã€åˆ†é¡ã€è·Ÿé€²ç­‰åŠŸèƒ½\r\n */\r\n\r\nimport { Injectable, signal, inject, computed } from '@angular/core';\r\nimport { IpcService } from '../ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// é¡å‹å®šç¾©\r\nexport type LeadStage = 'New' | 'Contacted' | 'Replied' | 'Follow-up' | 'Closed-Won' | 'Closed-Lost';\r\n\r\nexport interface Lead {\r\n  id: number;\r\n  username: string;\r\n  userId?: number;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  phone?: string;\r\n  sourceGroup: string;\r\n  sourceGroupId?: number;\r\n  keyword: string;\r\n  message: string;\r\n  stage: LeadStage;\r\n  score?: number;\r\n  tags?: string[];\r\n  notes?: string;\r\n  assignedTo?: string;\r\n  lastContact?: string;\r\n  nextFollowUp?: string;\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n  interactions?: LeadInteraction[];\r\n}\r\n\r\nexport interface LeadInteraction {\r\n  id: number;\r\n  leadId: number;\r\n  type: 'message_sent' | 'message_received' | 'note_added' | 'stage_changed' | 'call';\r\n  content: string;\r\n  accountPhone?: string;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface LeadFilter {\r\n  stage?: LeadStage;\r\n  search?: string;\r\n  sourceGroup?: string;\r\n  dateRange?: { start: string; end: string };\r\n  assignedTo?: string;\r\n  minScore?: number;\r\n}\r\n\r\nexport interface LeadStats {\r\n  total: number;\r\n  byStage: Record<LeadStage, number>;\r\n  todayNew: number;\r\n  todayContacted: number;\r\n  conversionRate: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LeadManagementService {\r\n  private ipcService = inject(IpcService);\r\n  private toastService = inject(ToastService);\r\n  \r\n  // ç‹€æ…‹\r\n  readonly leads = signal<Lead[]>([]);\r\n  readonly selectedLead = signal<Lead | null>(null);\r\n  readonly leadStats = signal<LeadStats>({\r\n    total: 0,\r\n    byStage: { 'New': 0, 'Contacted': 0, 'Replied': 0, 'Follow-up': 0, 'Closed-Won': 0, 'Closed-Lost': 0 },\r\n    todayNew: 0,\r\n    todayContacted: 0,\r\n    conversionRate: 0\r\n  });\r\n  \r\n  // ç¯©é¸å’Œè¦–åœ–\r\n  readonly filter = signal<LeadFilter>({});\r\n  readonly viewMode = signal<'kanban' | 'list'>('kanban');\r\n  readonly isLoading = signal(false);\r\n  \r\n  // æ‰¹é‡æ“ä½œ\r\n  readonly selectedLeadIds = signal<Set<number>>(new Set());\r\n  readonly showBatchActions = signal(false);\r\n  \r\n  // è©³æƒ…é¢æ¿\r\n  readonly showLeadDetails = signal(false);\r\n  readonly detailsTab = signal<'sendMessage' | 'history' | 'profile'>('sendMessage');\r\n  \r\n  // åˆªé™¤ç¢ºèª\r\n  readonly showDeleteConfirm = signal(false);\r\n  readonly leadsToDelete = signal<Lead[]>([]);\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  readonly filteredLeads = computed(() => {\r\n    let result = this.leads();\r\n    const f = this.filter();\r\n    \r\n    if (f.stage) {\r\n      result = result.filter(l => l.stage === f.stage);\r\n    }\r\n    \r\n    if (f.search) {\r\n      const search = f.search.toLowerCase();\r\n      result = result.filter(l => \r\n        l.username.toLowerCase().includes(search) ||\r\n        l.firstName?.toLowerCase().includes(search) ||\r\n        l.lastName?.toLowerCase().includes(search) ||\r\n        l.message.toLowerCase().includes(search)\r\n      );\r\n    }\r\n    \r\n    if (f.sourceGroup) {\r\n      result = result.filter(l => l.sourceGroup === f.sourceGroup);\r\n    }\r\n    \r\n    if (f.minScore !== undefined) {\r\n      result = result.filter(l => (l.score || 0) >= f.minScore!);\r\n    }\r\n    \r\n    return result;\r\n  });\r\n  \r\n  readonly leadsByStage = computed(() => {\r\n    const stages: LeadStage[] = ['New', 'Contacted', 'Replied', 'Follow-up', 'Closed-Won', 'Closed-Lost'];\r\n    const result: Record<LeadStage, Lead[]> = {} as any;\r\n    \r\n    stages.forEach(stage => {\r\n      result[stage] = this.filteredLeads().filter(l => l.stage === stage);\r\n    });\r\n    \r\n    return result;\r\n  });\r\n  \r\n  readonly selectedCount = computed(() => this.selectedLeadIds().size);\r\n  \r\n  readonly stageLabels: Record<LeadStage, string> = {\r\n    'New': 'æ–°ç·šç´¢',\r\n    'Contacted': 'å·²è¯ç¹«',\r\n    'Replied': 'å·²å›è¦†',\r\n    'Follow-up': 'éœ€è·Ÿé€²',\r\n    'Closed-Won': 'å·²æˆäº¤',\r\n    'Closed-Lost': 'å·²æµå¤±'\r\n  };\r\n  \r\n  readonly stageColors: Record<LeadStage, string> = {\r\n    'New': 'bg-blue-500/20 text-blue-400 border-blue-500/30',\r\n    'Contacted': 'bg-amber-500/20 text-amber-400 border-amber-500/30',\r\n    'Replied': 'bg-purple-500/20 text-purple-400 border-purple-500/30',\r\n    'Follow-up': 'bg-orange-500/20 text-orange-400 border-orange-500/30',\r\n    'Closed-Won': 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30',\r\n    'Closed-Lost': 'bg-red-500/20 text-red-400 border-red-500/30'\r\n  };\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ==================== åŠ è¼‰æ–¹æ³• ====================\r\n  \r\n  loadLeads(limit = 100): void {\r\n    this.isLoading.set(true);\r\n    this.ipcService.send('get-leads', { limit });\r\n  }\r\n  \r\n  loadLeadStats(): void {\r\n    this.ipcService.send('get-lead-stats', {});\r\n  }\r\n  \r\n  loadLeadDetails(leadId: number): void {\r\n    this.ipcService.send('get-lead-details', { leadId });\r\n  }\r\n  \r\n  refreshData(): void {\r\n    this.loadLeads();\r\n    this.loadLeadStats();\r\n  }\r\n  \r\n  // ==================== ç·šç´¢æ“ä½œ ====================\r\n  \r\n  selectLead(lead: Lead): void {\r\n    this.selectedLead.set(lead);\r\n    this.showLeadDetails.set(true);\r\n    this.loadLeadDetails(lead.id);\r\n  }\r\n  \r\n  closeLeadDetails(): void {\r\n    this.showLeadDetails.set(false);\r\n    this.selectedLead.set(null);\r\n  }\r\n  \r\n  updateLeadStage(leadId: number, newStage: LeadStage): void {\r\n    this.ipcService.send('update-lead-stage', { leadId, stage: newStage });\r\n    \r\n    // æœ¬åœ°æ›´æ–°\r\n    this.leads.update(leads => \r\n      leads.map(l => l.id === leadId ? { ...l, stage: newStage } : l)\r\n    );\r\n    \r\n    if (this.selectedLead()?.id === leadId) {\r\n      this.selectedLead.update(l => l ? { ...l, stage: newStage } : null);\r\n    }\r\n  }\r\n  \r\n  addNote(leadId: number, note: string): void {\r\n    if (!note.trim()) return;\r\n    this.ipcService.send('add-lead-note', { leadId, note });\r\n  }\r\n  \r\n  assignLead(leadId: number, assignTo: string): void {\r\n    this.ipcService.send('assign-lead', { leadId, assignTo });\r\n    \r\n    // æœ¬åœ°æ›´æ–°\r\n    this.leads.update(leads => \r\n      leads.map(l => l.id === leadId ? { ...l, assignedTo: assignTo } : l)\r\n    );\r\n  }\r\n  \r\n  addToBlacklist(leadId: number): void {\r\n    if (!confirm('ç¢ºå®šè¦å°‡æ­¤ç”¨æˆ¶åŠ å…¥é»‘åå–®å—ï¼Ÿ')) return;\r\n    this.ipcService.send('add-to-blacklist', { leadId });\r\n    this.toastService.success('å·²åŠ å…¥é»‘åå–®');\r\n  }\r\n  \r\n  // ==================== æ‰¹é‡æ“ä½œ ====================\r\n  \r\n  toggleLeadSelection(leadId: number): void {\r\n    this.selectedLeadIds.update(ids => {\r\n      const newIds = new Set(ids);\r\n      if (newIds.has(leadId)) {\r\n        newIds.delete(leadId);\r\n      } else {\r\n        newIds.add(leadId);\r\n      }\r\n      return newIds;\r\n    });\r\n  }\r\n  \r\n  selectAllLeads(): void {\r\n    const allIds = new Set(this.filteredLeads().map(l => l.id));\r\n    this.selectedLeadIds.set(allIds);\r\n  }\r\n  \r\n  clearSelection(): void {\r\n    this.selectedLeadIds.set(new Set());\r\n  }\r\n  \r\n  batchUpdateStage(newStage: LeadStage): void {\r\n    const ids = Array.from(this.selectedLeadIds());\r\n    if (ids.length === 0) return;\r\n    \r\n    this.ipcService.send('batch-update-lead-stage', { leadIds: ids, stage: newStage });\r\n    \r\n    // æœ¬åœ°æ›´æ–°\r\n    this.leads.update(leads => \r\n      leads.map(l => ids.includes(l.id) ? { ...l, stage: newStage } : l)\r\n    );\r\n    \r\n    this.clearSelection();\r\n    this.toastService.success(`å·²æ›´æ–° ${ids.length} å€‹ç·šç´¢çš„ç‹€æ…‹`);\r\n  }\r\n  \r\n  confirmDeleteLeads(): void {\r\n    const ids = Array.from(this.selectedLeadIds());\r\n    if (ids.length === 0) return;\r\n    \r\n    const leadsToDelete = this.leads().filter(l => ids.includes(l.id));\r\n    this.leadsToDelete.set(leadsToDelete);\r\n    this.showDeleteConfirm.set(true);\r\n  }\r\n  \r\n  cancelDeleteLeads(): void {\r\n    this.showDeleteConfirm.set(false);\r\n    this.leadsToDelete.set([]);\r\n  }\r\n  \r\n  executeDeleteLeads(): void {\r\n    const ids = this.leadsToDelete().map(l => l.id);\r\n    \r\n    this.ipcService.send('batch-delete-leads', { leadIds: ids });\r\n    \r\n    // æœ¬åœ°æ›´æ–°\r\n    this.leads.update(leads => leads.filter(l => !ids.includes(l.id)));\r\n    \r\n    this.clearSelection();\r\n    this.showDeleteConfirm.set(false);\r\n    this.leadsToDelete.set([]);\r\n    this.toastService.success(`å·²åˆªé™¤ ${ids.length} å€‹ç·šç´¢`);\r\n  }\r\n  \r\n  // ==================== ç¯©é¸å’Œè¦–åœ– ====================\r\n  \r\n  setFilter(filter: Partial<LeadFilter>): void {\r\n    this.filter.update(f => ({ ...f, ...filter }));\r\n  }\r\n  \r\n  clearFilter(): void {\r\n    this.filter.set({});\r\n  }\r\n  \r\n  setViewMode(mode: 'kanban' | 'list'): void {\r\n    this.viewMode.set(mode);\r\n  }\r\n  \r\n  setDetailsTab(tab: 'sendMessage' | 'history' | 'profile'): void {\r\n    this.detailsTab.set(tab);\r\n  }\r\n  \r\n  // ==================== å°å‡º ====================\r\n  \r\n  exportToExcel(): void {\r\n    const leads = this.filteredLeads();\r\n    if (leads.length === 0) {\r\n      this.toastService.warning('æ²’æœ‰å¯å°å‡ºçš„ç·šç´¢');\r\n      return;\r\n    }\r\n    \r\n    this.ipcService.send('export-leads-to-excel', { \r\n      leadIds: leads.map(l => l.id) \r\n    });\r\n    this.toastService.info('æ­£åœ¨å°å‡º...');\r\n  }\r\n  \r\n  // ==================== è¼”åŠ©æ–¹æ³• ====================\r\n  \r\n  getStageLabel(stage: LeadStage): string {\r\n    return this.stageLabels[stage] || stage;\r\n  }\r\n  \r\n  getStageColor(stage: LeadStage): string {\r\n    return this.stageColors[stage] || 'bg-slate-500/20 text-slate-400';\r\n  }\r\n  \r\n  getLeadDisplayName(lead: Lead): string {\r\n    if (lead.firstName || lead.lastName) {\r\n      return `${lead.firstName || ''} ${lead.lastName || ''}`.trim();\r\n    }\r\n    return lead.username || 'Unknown';\r\n  }\r\n  \r\n  // ==================== IPC äº‹ä»¶è™•ç† ====================\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipcService.on('leads-result', (data: any) => this.handleLeads(data));\r\n    this.ipcService.on('lead-stats-result', (data: any) => this.handleLeadStats(data));\r\n    this.ipcService.on('lead-details-result', (data: any) => this.handleLeadDetails(data));\r\n    this.ipcService.on('lead-captured', (data: any) => this.handleLeadCaptured(data));\r\n    this.ipcService.on('lead-stage-updated', (data: any) => this.handleLeadStageUpdated(data));\r\n    this.ipcService.on('leads-exported', (data: any) => this.handleLeadsExported(data));\r\n  }\r\n  \r\n  private handleLeads(data: any): void {\r\n    this.isLoading.set(false);\r\n    if (data.success || data.leads) {\r\n      this.leads.set(data.leads || []);\r\n    }\r\n  }\r\n  \r\n  private handleLeadStats(data: any): void {\r\n    if (data.success) {\r\n      this.leadStats.set(data.stats);\r\n    }\r\n  }\r\n  \r\n  private handleLeadDetails(data: any): void {\r\n    if (data.success && data.lead) {\r\n      this.selectedLead.set(data.lead);\r\n    }\r\n  }\r\n  \r\n  private handleLeadCaptured(data: any): void {\r\n    if (data.lead) {\r\n      this.leads.update(leads => [data.lead, ...leads]);\r\n      this.toastService.success(`æ•ç²æ–°ç·šç´¢: ${data.lead.username}`);\r\n    }\r\n  }\r\n  \r\n  private handleLeadStageUpdated(data: any): void {\r\n    if (data.success) {\r\n      this.loadLeadStats();\r\n    }\r\n  }\r\n  \r\n  private handleLeadsExported(data: any): void {\r\n    if (data.success) {\r\n      this.toastService.success(`å°å‡ºæˆåŠŸ: ${data.filePath}`);\r\n    } else {\r\n      this.toastService.error(`å°å‡ºå¤±æ•—: ${data.error}`);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * ç¾¤çµ„ç®¡ç†æœå‹™\r\n * Group Management Service\r\n * \r\n * ğŸ†• Phase 21: å¾ app.component.ts æå–ç¾¤çµ„ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport interface TelegramGroup {\r\n  id: number;\r\n  telegram_id?: number;\r\n  title: string;\r\n  username?: string;\r\n  member_count?: number;\r\n  is_public?: boolean;\r\n  is_channel?: boolean;\r\n  joined?: boolean;\r\n  monitored?: boolean;\r\n  last_activity?: string;\r\n}\r\n\r\nexport interface JoinQueueItem {\r\n  resourceId: number;\r\n  title: string;\r\n  status: 'pending' | 'joining' | 'joined' | 'failed';\r\n  error?: string;\r\n}\r\n\r\nexport interface JoinMonitorDialogState {\r\n  isOpen: boolean;\r\n  resource: any | null;\r\n  selectedAccount: string;\r\n  enableMonitoring: boolean;\r\n  selectedKeywordSets: number[];\r\n}\r\n\r\nexport interface BatchJoinDialogState {\r\n  isOpen: boolean;\r\n  selectedResources: any[];\r\n  selectedAccount: string;\r\n  enableMonitoring: boolean;\r\n  selectedKeywordSets: number[];\r\n}\r\n\r\nexport interface PostJoinDialogState {\r\n  isOpen: boolean;\r\n  resource: any | null;\r\n  phone: string;\r\n  keywordSetCount: number;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GroupManagementService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _groups = signal<TelegramGroup[]>([]);\r\n  private _joinQueue = signal<JoinQueueItem[]>([]);\r\n  private _selectedGroupIds = signal<Set<number>>(new Set());\r\n  private _isJoining = signal(false);\r\n  \r\n  groups = this._groups.asReadonly();\r\n  joinQueue = this._joinQueue.asReadonly();\r\n  selectedGroupIds = this._selectedGroupIds.asReadonly();\r\n  isJoining = this._isJoining.asReadonly();\r\n  \r\n  // å°è©±æ¡†ç‹€æ…‹\r\n  private _joinMonitorDialog = signal<JoinMonitorDialogState>({\r\n    isOpen: false,\r\n    resource: null,\r\n    selectedAccount: '',\r\n    enableMonitoring: false,\r\n    selectedKeywordSets: []\r\n  });\r\n  \r\n  private _batchJoinDialog = signal<BatchJoinDialogState>({\r\n    isOpen: false,\r\n    selectedResources: [],\r\n    selectedAccount: '',\r\n    enableMonitoring: false,\r\n    selectedKeywordSets: []\r\n  });\r\n  \r\n  private _postJoinDialog = signal<PostJoinDialogState>({\r\n    isOpen: false,\r\n    resource: null,\r\n    phone: '',\r\n    keywordSetCount: 0\r\n  });\r\n  \r\n  joinMonitorDialog = this._joinMonitorDialog.asReadonly();\r\n  batchJoinDialog = this._batchJoinDialog.asReadonly();\r\n  postJoinDialog = this._postJoinDialog.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  \r\n  selectedGroups = computed(() => {\r\n    const ids = this._selectedGroupIds();\r\n    return this._groups().filter(g => ids.has(g.id));\r\n  });\r\n  \r\n  selectedGroupCount = computed(() => this._selectedGroupIds().size);\r\n  \r\n  joinQueuePending = computed(() => \r\n    this._joinQueue().filter(item => item.status === 'pending')\r\n  );\r\n  \r\n  joinQueueProgress = computed(() => {\r\n    const queue = this._joinQueue();\r\n    if (queue.length === 0) return 0;\r\n    const completed = queue.filter(item => \r\n      item.status === 'joined' || item.status === 'failed'\r\n    ).length;\r\n    return Math.round((completed / queue.length) * 100);\r\n  });\r\n  \r\n  // ========== ç¾¤çµ„æ“ä½œ ==========\r\n  \r\n  setGroups(groups: TelegramGroup[]): void {\r\n    this._groups.set(groups);\r\n  }\r\n  \r\n  updateGroup(group: TelegramGroup): void {\r\n    this._groups.update(list => \r\n      list.map(g => g.id === group.id ? { ...g, ...group } : g)\r\n    );\r\n  }\r\n  \r\n  addGroup(group: TelegramGroup): void {\r\n    this._groups.update(list => [...list, group]);\r\n  }\r\n  \r\n  removeGroup(groupId: number): void {\r\n    this._groups.update(list => list.filter(g => g.id !== groupId));\r\n  }\r\n  \r\n  // ========== é¸æ“‡æ“ä½œ ==========\r\n  \r\n  toggleGroupSelection(groupId: number): void {\r\n    this._selectedGroupIds.update(ids => {\r\n      const newIds = new Set(ids);\r\n      if (newIds.has(groupId)) {\r\n        newIds.delete(groupId);\r\n      } else {\r\n        newIds.add(groupId);\r\n      }\r\n      return newIds;\r\n    });\r\n  }\r\n  \r\n  selectAllGroups(): void {\r\n    const allIds = new Set(this._groups().map(g => g.id));\r\n    this._selectedGroupIds.set(allIds);\r\n  }\r\n  \r\n  deselectAllGroups(): void {\r\n    this._selectedGroupIds.set(new Set());\r\n  }\r\n  \r\n  // ========== åŠ å…¥ç¾¤çµ„æ“ä½œ ==========\r\n  \r\n  openJoinMonitorDialog(resource: any): void {\r\n    this._joinMonitorDialog.set({\r\n      isOpen: true,\r\n      resource,\r\n      selectedAccount: '',\r\n      enableMonitoring: false,\r\n      selectedKeywordSets: []\r\n    });\r\n  }\r\n  \r\n  closeJoinMonitorDialog(): void {\r\n    this._joinMonitorDialog.update(s => ({ ...s, isOpen: false }));\r\n  }\r\n  \r\n  updateJoinMonitorDialog(updates: Partial<JoinMonitorDialogState>): void {\r\n    this._joinMonitorDialog.update(s => ({ ...s, ...updates }));\r\n  }\r\n  \r\n  executeJoinAndMonitor(): void {\r\n    const dialog = this._joinMonitorDialog();\r\n    if (!dialog.resource || !dialog.selectedAccount) {\r\n      this.toast.error('è«‹é¸æ“‡å¸³è™Ÿ');\r\n      return;\r\n    }\r\n    \r\n    this._isJoining.set(true);\r\n    \r\n    this.ipc.send('join-group', {\r\n      resourceId: dialog.resource.id,\r\n      phone: dialog.selectedAccount,\r\n      enableMonitoring: dialog.enableMonitoring,\r\n      keywordSetIds: dialog.selectedKeywordSets\r\n    });\r\n    \r\n    this.closeJoinMonitorDialog();\r\n  }\r\n  \r\n  // ========== æ‰¹é‡åŠ å…¥æ“ä½œ ==========\r\n  \r\n  openBatchJoinDialog(resources: any[]): void {\r\n    this._batchJoinDialog.set({\r\n      isOpen: true,\r\n      selectedResources: resources,\r\n      selectedAccount: '',\r\n      enableMonitoring: false,\r\n      selectedKeywordSets: []\r\n    });\r\n  }\r\n  \r\n  closeBatchJoinDialog(): void {\r\n    this._batchJoinDialog.update(s => ({ ...s, isOpen: false }));\r\n  }\r\n  \r\n  updateBatchJoinDialog(updates: Partial<BatchJoinDialogState>): void {\r\n    this._batchJoinDialog.update(s => ({ ...s, ...updates }));\r\n  }\r\n  \r\n  executeBatchJoin(): void {\r\n    const dialog = this._batchJoinDialog();\r\n    if (dialog.selectedResources.length === 0 || !dialog.selectedAccount) {\r\n      this.toast.error('è«‹é¸æ“‡ç¾¤çµ„å’Œå¸³è™Ÿ');\r\n      return;\r\n    }\r\n    \r\n    this._isJoining.set(true);\r\n    \r\n    // æ·»åŠ åˆ°åŠ å…¥éšŠåˆ—\r\n    const queueItems: JoinQueueItem[] = dialog.selectedResources.map(r => ({\r\n      resourceId: r.id,\r\n      title: r.title,\r\n      status: 'pending' as const\r\n    }));\r\n    \r\n    this._joinQueue.set(queueItems);\r\n    \r\n    // ç™¼é€æ‰¹é‡åŠ å…¥è«‹æ±‚\r\n    this.ipc.send('batch-join-groups', {\r\n      resourceIds: dialog.selectedResources.map(r => r.id),\r\n      phone: dialog.selectedAccount,\r\n      enableMonitoring: dialog.enableMonitoring,\r\n      keywordSetIds: dialog.selectedKeywordSets\r\n    });\r\n    \r\n    this.closeBatchJoinDialog();\r\n  }\r\n  \r\n  // ========== åŠ å…¥å¾Œæ“ä½œ ==========\r\n  \r\n  openPostJoinDialog(resource: any, phone: string, keywordSetCount: number): void {\r\n    this._postJoinDialog.set({\r\n      isOpen: true,\r\n      resource,\r\n      phone,\r\n      keywordSetCount\r\n    });\r\n  }\r\n  \r\n  closePostJoinDialog(): void {\r\n    this._postJoinDialog.update(s => ({ ...s, isOpen: false }));\r\n  }\r\n  \r\n  postJoinExtractMembers(): void {\r\n    const dialog = this._postJoinDialog();\r\n    if (!dialog.resource) return;\r\n    \r\n    this.ipc.send('extract-members', {\r\n      resourceId: dialog.resource.id,\r\n      phone: dialog.phone\r\n    });\r\n    \r\n    this.closePostJoinDialog();\r\n    this.toast.info('é–‹å§‹æå–æˆå“¡...');\r\n  }\r\n  \r\n  postJoinSendMessage(): void {\r\n    const dialog = this._postJoinDialog();\r\n    if (!dialog.resource) return;\r\n    \r\n    // è§¸ç™¼ç™¼é€æ¶ˆæ¯å°è©±æ¡†\r\n    this.closePostJoinDialog();\r\n    // é€™è£¡éœ€è¦èˆ‡ MessageService å”ä½œ\r\n  }\r\n  \r\n  // ========== é›¢é–‹ç¾¤çµ„æ“ä½œ ==========\r\n  \r\n  leaveGroup(resource: any, phone: string): void {\r\n    if (!confirm(`ç¢ºå®šè¦é›¢é–‹ç¾¤çµ„ ${resource.title} å—ï¼Ÿ`)) {\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('leave-group', {\r\n      resourceId: resource.id,\r\n      phone\r\n    });\r\n    \r\n    this.toast.info('æ­£åœ¨é›¢é–‹ç¾¤çµ„...');\r\n  }\r\n  \r\n  stopMonitoring(resource: any): void {\r\n    this.ipc.send('stop-monitoring', {\r\n      resourceId: resource.id\r\n    });\r\n    \r\n    this.toast.info('å·²åœæ­¢ç›£æ§');\r\n  }\r\n  \r\n  // ========== éšŠåˆ—æ“ä½œ ==========\r\n  \r\n  clearJoinQueue(): void {\r\n    this._joinQueue.set([]);\r\n  }\r\n  \r\n  updateQueueItemStatus(resourceId: number, status: JoinQueueItem['status'], error?: string): void {\r\n    this._joinQueue.update(queue => \r\n      queue.map(item => \r\n        item.resourceId === resourceId \r\n          ? { ...item, status, error }\r\n          : item\r\n      )\r\n    );\r\n    \r\n    // æª¢æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ\r\n    const queue = this._joinQueue();\r\n    const allDone = queue.every(item => \r\n      item.status === 'joined' || item.status === 'failed'\r\n    );\r\n    \r\n    if (allDone) {\r\n      this._isJoining.set(false);\r\n      const joined = queue.filter(item => item.status === 'joined').length;\r\n      const failed = queue.filter(item => item.status === 'failed').length;\r\n      \r\n      if (failed > 0) {\r\n        this.toast.warning(`å®Œæˆï¼š${joined} æˆåŠŸï¼Œ${failed} å¤±æ•—`);\r\n      } else {\r\n        this.toast.success(`æˆåŠŸåŠ å…¥ ${joined} å€‹ç¾¤çµ„`);\r\n      }\r\n    }\r\n  }\r\n  \r\n  // ========== IPC äº‹ä»¶è™•ç† ==========\r\n  \r\n  handleJoinResult(data: { \r\n    resourceId: number; \r\n    success: boolean; \r\n    error?: string;\r\n    phone?: string;\r\n    keywordSetCount?: number;\r\n  }): void {\r\n    this._isJoining.set(false);\r\n    \r\n    if (data.success) {\r\n      this.toast.success('æˆåŠŸåŠ å…¥ç¾¤çµ„');\r\n      \r\n      // æ›´æ–°ç¾¤çµ„ç‹€æ…‹\r\n      this.updateGroup({ id: data.resourceId, joined: true } as TelegramGroup);\r\n      \r\n      // é¡¯ç¤ºåŠ å…¥å¾Œé¸é …\r\n      if (data.phone && data.keywordSetCount !== undefined) {\r\n        const group = this._groups().find(g => g.id === data.resourceId);\r\n        if (group) {\r\n          this.openPostJoinDialog(group, data.phone, data.keywordSetCount);\r\n        }\r\n      }\r\n    } else {\r\n      this.toast.error(`åŠ å…¥ç¾¤çµ„å¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n    }\r\n  }\r\n  \r\n  handleBatchJoinProgress(data: { \r\n    resourceId: number; \r\n    success: boolean; \r\n    error?: string \r\n  }): void {\r\n    this.updateQueueItemStatus(\r\n      data.resourceId,\r\n      data.success ? 'joined' : 'failed',\r\n      data.error\r\n    );\r\n  }\r\n  \r\n  handleLeaveResult(data: { resourceId: number; success: boolean; error?: string }): void {\r\n    if (data.success) {\r\n      this.updateGroup({ id: data.resourceId, joined: false } as TelegramGroup);\r\n      this.toast.success('å·²é›¢é–‹ç¾¤çµ„');\r\n    } else {\r\n      this.toast.error(`é›¢é–‹ç¾¤çµ„å¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * æ¶ˆæ¯éšŠåˆ—æœå‹™\r\n * Message Queue Service\r\n * \r\n * ğŸ†• Phase 21: å¾ app.component.ts æå–æ¶ˆæ¯ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport type MessageStatus = 'pending' | 'sending' | 'sent' | 'failed' | 'cancelled';\r\nexport type MessagePriority = 'low' | 'normal' | 'high' | 'urgent';\r\n\r\nexport interface QueuedMessage {\r\n  id: string;\r\n  phone: string;\r\n  targetId: string | number;\r\n  targetType: 'user' | 'group' | 'channel';\r\n  targetTitle: string;\r\n  content: string;\r\n  status: MessageStatus;\r\n  priority: MessagePriority;\r\n  createdAt: string;\r\n  sentAt?: string;\r\n  error?: string;\r\n  retryCount?: number;\r\n}\r\n\r\nexport interface QueueStatus {\r\n  phone: string;\r\n  pending: number;\r\n  sending: number;\r\n  sent: number;\r\n  failed: number;\r\n  paused: boolean;\r\n}\r\n\r\nexport interface SingleMessageDialogState {\r\n  isOpen: boolean;\r\n  target: any | null;\r\n  targetType: 'user' | 'group' | 'channel';\r\n  message: string;\r\n  selectedAccount: string;\r\n}\r\n\r\nexport interface BatchMessageDialogState {\r\n  isOpen: boolean;\r\n  targets: any[];\r\n  targetType: 'user' | 'group' | 'channel';\r\n  message: string;\r\n  selectedAccount: string;\r\n  delay: number;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MessageQueueService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _queueStatuses = signal<Map<string, QueueStatus>>(new Map());\r\n  private _messages = signal<QueuedMessage[]>([]);\r\n  private _selectedPhone = signal<string | null>(null);\r\n  \r\n  queueStatuses = this._queueStatuses.asReadonly();\r\n  messages = this._messages.asReadonly();\r\n  selectedPhone = this._selectedPhone.asReadonly();\r\n  \r\n  // å°è©±æ¡†ç‹€æ…‹\r\n  private _singleMessageDialog = signal<SingleMessageDialogState>({\r\n    isOpen: false,\r\n    target: null,\r\n    targetType: 'user',\r\n    message: '',\r\n    selectedAccount: ''\r\n  });\r\n  \r\n  private _batchMessageDialog = signal<BatchMessageDialogState>({\r\n    isOpen: false,\r\n    targets: [],\r\n    targetType: 'user',\r\n    message: '',\r\n    selectedAccount: '',\r\n    delay: 5\r\n  });\r\n  \r\n  singleMessageDialog = this._singleMessageDialog.asReadonly();\r\n  batchMessageDialog = this._batchMessageDialog.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  \r\n  totalPending = computed(() => {\r\n    let total = 0;\r\n    this._queueStatuses().forEach(status => {\r\n      total += status.pending;\r\n    });\r\n    return total;\r\n  });\r\n  \r\n  totalSent = computed(() => {\r\n    let total = 0;\r\n    this._queueStatuses().forEach(status => {\r\n      total += status.sent;\r\n    });\r\n    return total;\r\n  });\r\n  \r\n  totalFailed = computed(() => {\r\n    let total = 0;\r\n    this._queueStatuses().forEach(status => {\r\n      total += status.failed;\r\n    });\r\n    return total;\r\n  });\r\n  \r\n  selectedQueueStatus = computed(() => {\r\n    const phone = this._selectedPhone();\r\n    if (!phone) return null;\r\n    return this._queueStatuses().get(phone) || null;\r\n  });\r\n  \r\n  selectedQueueMessages = computed(() => {\r\n    const phone = this._selectedPhone();\r\n    if (!phone) return [];\r\n    return this._messages().filter(m => m.phone === phone);\r\n  });\r\n  \r\n  // ========== éšŠåˆ—æ“ä½œ ==========\r\n  \r\n  refreshQueueStatus(phone?: string): void {\r\n    this.ipc.send('get-queue-status', { phone });\r\n  }\r\n  \r\n  setQueueStatuses(statuses: QueueStatus[]): void {\r\n    const map = new Map<string, QueueStatus>();\r\n    for (const status of statuses) {\r\n      map.set(status.phone, status);\r\n    }\r\n    this._queueStatuses.set(map);\r\n  }\r\n  \r\n  updateQueueStatus(status: QueueStatus): void {\r\n    this._queueStatuses.update(map => {\r\n      const newMap = new Map(map);\r\n      newMap.set(status.phone, status);\r\n      return newMap;\r\n    });\r\n  }\r\n  \r\n  selectQueue(phone: string): void {\r\n    this._selectedPhone.set(phone);\r\n    this.loadQueueMessages(phone);\r\n  }\r\n  \r\n  loadQueueMessages(phone: string, status?: MessageStatus, limit = 100): void {\r\n    this.ipc.send('get-queue-messages', { phone, status, limit });\r\n  }\r\n  \r\n  setMessages(messages: QueuedMessage[]): void {\r\n    this._messages.set(messages);\r\n  }\r\n  \r\n  // ========== æ¶ˆæ¯æ“ä½œ ==========\r\n  \r\n  retryMessage(messageId: string): void {\r\n    this.ipc.send('retry-message', { messageId });\r\n    this.toast.info('æ­£åœ¨é‡è©¦ç™¼é€...');\r\n  }\r\n  \r\n  cancelMessage(messageId: string): void {\r\n    this.ipc.send('cancel-message', { messageId });\r\n    this.toast.info('å·²å–æ¶ˆæ¶ˆæ¯');\r\n  }\r\n  \r\n  deleteMessage(phone: string, messageId: string): void {\r\n    this.ipc.send('delete-queue-message', { phone, messageId });\r\n  }\r\n  \r\n  updateMessagePriority(phone: string, messageId: string, priority: MessagePriority): void {\r\n    this.ipc.send('update-message-priority', { phone, messageId, priority });\r\n  }\r\n  \r\n  // ========== éšŠåˆ—æ§åˆ¶ ==========\r\n  \r\n  pauseQueue(phone: string): void {\r\n    this.ipc.send('pause-queue', { phone });\r\n    this.toast.info('éšŠåˆ—å·²æš«åœ');\r\n  }\r\n  \r\n  resumeQueue(phone: string): void {\r\n    this.ipc.send('resume-queue', { phone });\r\n    this.toast.info('éšŠåˆ—å·²æ¢å¾©');\r\n  }\r\n  \r\n  clearQueue(phone: string, status?: MessageStatus): void {\r\n    if (!confirm(`ç¢ºå®šè¦æ¸…ç©º ${phone} çš„${status || 'æ‰€æœ‰'}æ¶ˆæ¯å—ï¼Ÿ`)) {\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('clear-queue', { phone, status });\r\n    this.toast.info('æ­£åœ¨æ¸…ç©ºéšŠåˆ—...');\r\n  }\r\n  \r\n  clearPendingQueue(): void {\r\n    if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å¾…ç™¼é€çš„æ¶ˆæ¯å—ï¼Ÿ')) {\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('clear-all-pending');\r\n    this.toast.info('æ­£åœ¨æ¸…ç©ºå¾…ç™¼é€æ¶ˆæ¯...');\r\n  }\r\n  \r\n  // ========== å–®æ¢æ¶ˆæ¯å°è©±æ¡† ==========\r\n  \r\n  openSingleMessageDialog(target: any, targetType: 'user' | 'group' | 'channel'): void {\r\n    this._singleMessageDialog.set({\r\n      isOpen: true,\r\n      target,\r\n      targetType,\r\n      message: '',\r\n      selectedAccount: ''\r\n    });\r\n  }\r\n  \r\n  closeSingleMessageDialog(): void {\r\n    this._singleMessageDialog.update(s => ({ ...s, isOpen: false }));\r\n  }\r\n  \r\n  updateSingleMessageDialog(updates: Partial<SingleMessageDialogState>): void {\r\n    this._singleMessageDialog.update(s => ({ ...s, ...updates }));\r\n  }\r\n  \r\n  executeSingleMessage(): void {\r\n    const dialog = this._singleMessageDialog();\r\n    if (!dialog.target || !dialog.selectedAccount || !dialog.message.trim()) {\r\n      this.toast.error('è«‹å¡«å¯«å®Œæ•´ä¿¡æ¯');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('send-message', {\r\n      phone: dialog.selectedAccount,\r\n      targetId: dialog.target.id || dialog.target.telegram_id,\r\n      targetType: dialog.targetType,\r\n      content: dialog.message.trim()\r\n    });\r\n    \r\n    this.closeSingleMessageDialog();\r\n    this.toast.success('æ¶ˆæ¯å·²åŠ å…¥ç™¼é€éšŠåˆ—');\r\n  }\r\n  \r\n  // ========== æ‰¹é‡æ¶ˆæ¯å°è©±æ¡† ==========\r\n  \r\n  openBatchMessageDialog(targets: any[], targetType: 'user' | 'group' | 'channel'): void {\r\n    this._batchMessageDialog.set({\r\n      isOpen: true,\r\n      targets,\r\n      targetType,\r\n      message: '',\r\n      selectedAccount: '',\r\n      delay: 5\r\n    });\r\n  }\r\n  \r\n  closeBatchMessageDialog(): void {\r\n    this._batchMessageDialog.update(s => ({ ...s, isOpen: false }));\r\n  }\r\n  \r\n  updateBatchMessageDialog(updates: Partial<BatchMessageDialogState>): void {\r\n    this._batchMessageDialog.update(s => ({ ...s, ...updates }));\r\n  }\r\n  \r\n  executeBatchMessage(): void {\r\n    const dialog = this._batchMessageDialog();\r\n    if (dialog.targets.length === 0 || !dialog.selectedAccount || !dialog.message.trim()) {\r\n      this.toast.error('è«‹å¡«å¯«å®Œæ•´ä¿¡æ¯');\r\n      return;\r\n    }\r\n    \r\n    this.ipc.send('batch-send-message', {\r\n      phone: dialog.selectedAccount,\r\n      targets: dialog.targets.map(t => ({\r\n        id: t.id || t.telegram_id,\r\n        type: dialog.targetType\r\n      })),\r\n      content: dialog.message.trim(),\r\n      delay: dialog.delay\r\n    });\r\n    \r\n    this.closeBatchMessageDialog();\r\n    this.toast.success(`${dialog.targets.length} æ¢æ¶ˆæ¯å·²åŠ å…¥ç™¼é€éšŠåˆ—`);\r\n  }\r\n  \r\n  // ========== ç§ä¿¡æ“ä½œ ==========\r\n  \r\n  sendPrivateMessage(member: any, selectedAccount: string): void {\r\n    this.openSingleMessageDialog(member, 'user');\r\n    this.updateSingleMessageDialog({ selectedAccount });\r\n  }\r\n  \r\n  batchSendPrivateMessage(members: any[]): void {\r\n    this.openBatchMessageDialog(members, 'user');\r\n  }\r\n  \r\n  // ========== ç¾¤çµ„æ¶ˆæ¯æ“ä½œ ==========\r\n  \r\n  sendGroupMessage(group: any, selectedAccount: string): void {\r\n    this.openSingleMessageDialog(group, 'group');\r\n    this.updateSingleMessageDialog({ selectedAccount });\r\n  }\r\n  \r\n  batchSendGroupMessage(groups: any[]): void {\r\n    this.openBatchMessageDialog(groups, 'group');\r\n  }\r\n  \r\n  // ========== IPC äº‹ä»¶è™•ç† ==========\r\n  \r\n  handleQueueStatusUpdate(statuses: QueueStatus[]): void {\r\n    this.setQueueStatuses(statuses);\r\n  }\r\n  \r\n  handleMessagesLoaded(messages: QueuedMessage[]): void {\r\n    this.setMessages(messages);\r\n  }\r\n  \r\n  handleMessageSent(data: { messageId: string; success: boolean; error?: string }): void {\r\n    this._messages.update(list => \r\n      list.map(m => \r\n        m.id === data.messageId\r\n          ? { \r\n              ...m, \r\n              status: data.success ? 'sent' as const : 'failed' as const,\r\n              error: data.error,\r\n              sentAt: data.success ? new Date().toISOString() : undefined\r\n            }\r\n          : m\r\n      )\r\n    );\r\n  }\r\n  \r\n  handleQueueCleared(data: { phone: string; count: number }): void {\r\n    this.toast.success(`å·²æ¸…ç©º ${data.count} æ¢æ¶ˆæ¯`);\r\n    this.refreshQueueStatus(data.phone);\r\n  }\r\n}\r\n","/**\n * æ‡‰ç”¨å¤–è§€æœå‹™\n * App Facade Service\n * \n * ğŸ†• Phase 22: çµ±ä¸€å§”è¨—å…¥å£\n * \n * æä¾›çµ±ä¸€çš„æœå‹™èª¿ç”¨å…¥å£ï¼Œæ¸›å°‘ app.component.ts çš„æ–¹æ³•æ•¸é‡\n * éµå¾ª Facade è¨­è¨ˆæ¨¡å¼ï¼Œå°è£è¤‡é›œçš„æœå‹™äº¤äº’\n */\n\nimport { Injectable, inject, signal, computed } from '@angular/core';\n\n// æ ¸å¿ƒæœå‹™\nimport { ElectronIpcService } from '../electron-ipc.service';\nimport { ToastService } from '../toast.service';\nimport { MembershipService } from '../membership.service';\nimport { I18nService } from '../i18n.service';\n\n// å°ˆç”¨æœå‹™\nimport { AccountManagementService } from './account-management.service';\nimport { NavigationService } from './navigation.service';\nimport { NavBridgeService, LegacyView } from './nav-bridge.service';\nimport { CampaignManagementService } from './campaign-management.service';\nimport { TemplateManagementService } from './template-management.service';\nimport { MonitoringManagementService } from './monitoring-management.service';\nimport { LeadManagementService } from './lead-management.service';\nimport { GroupManagementService } from './group-management.service';\nimport { MessageQueueService } from './message-queue.service';\n\n// ============ é¡å‹å®šç¾© ============\n\nexport type ViewType = \n  | 'dashboard' | 'accounts' | 'settings' | 'leads' \n  | 'ai-center' | 'automation' | 'multi-role' | 'analytics'\n  | 'resource-discovery' | 'monitoring';\n\nexport interface SystemStatus {\n  accounts: { total: number; online: number; offline: number };\n  monitoring: { active: boolean; groups: number };\n  queue: { pending: number; sent: number; failed: number };\n  ai: { enabled: boolean; provider: string };\n}\n\n// ============ æœå‹™å¯¦ç¾ ============\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AppFacadeService {\n  // æ³¨å…¥æœå‹™\n  private nav = inject(NavBridgeService);\n  private ipc = inject(ElectronIpcService);\n  private toast = inject(ToastService);\n  private membership = inject(MembershipService);\n  private i18n = inject(I18nService);\n  \n  // å°ˆç”¨æœå‹™\n  readonly accounts = inject(AccountManagementService);\n  readonly navigation = inject(NavigationService);\n  readonly campaigns = inject(CampaignManagementService);\n  readonly templates = inject(TemplateManagementService);\n  readonly monitoring = inject(MonitoringManagementService);\n  readonly leads = inject(LeadManagementService);\n  readonly groups = inject(GroupManagementService);\n  readonly messages = inject(MessageQueueService);\n  \n  // ========== æ‡‰ç”¨ç‹€æ…‹ ==========\n  \n  private _isInitialized = signal(false);\n  private _isLoading = signal(false);\n  private _systemStatus = signal<SystemStatus | null>(null);\n  private _currentView = signal<ViewType>('dashboard');\n  \n  isInitialized = this._isInitialized.asReadonly();\n  isLoading = this._isLoading.asReadonly();\n  systemStatus = this._systemStatus.asReadonly();\n  currentView = this._currentView.asReadonly();\n  \n  // ========== è¨ˆç®—å±¬æ€§ ==========\n  \n  hasOnlineAccounts = computed(() => {\n    const status = this._systemStatus();\n    return (status?.accounts?.online ?? 0) > 0;\n  });\n  \n  isMonitoringActive = computed(() => {\n    const status = this._systemStatus();\n    return status?.monitoring?.active ?? false;\n  });\n  \n  pendingMessages = computed(() => {\n    const status = this._systemStatus();\n    return status?.queue?.pending ?? 0;\n  });\n  \n  constructor() {\n    this.setupNavSync();\n    this.setupIpcListeners();\n  }\n  \n  // ========== å°èˆªåŒæ­¥ ==========\n  \n  private setupNavSync(): void {\n    // ä½¿ç”¨ NavBridgeService çš„ currentView åŒæ­¥\n    // æ³¨æ„ï¼šç”±æ–¼ä½¿ç”¨ @switch è¦–åœ–åˆ‡æ›ï¼Œå°èˆªå·²ç”± AppComponent ç®¡ç†\n  }\n  \n  // ========== IPC ç›£è½ ==========\n  \n  private setupIpcListeners(): void {\n    // å¸³è™Ÿç›¸é—œ\n    this.ipc.on('accounts-loaded', (accounts: any[]) => {\n      this.accounts.setAccounts(accounts);\n    });\n    \n    this.ipc.on('account-status-changed', (data: any) => {\n      this.accounts.updateAccount(data);\n    });\n    \n    this.ipc.on('login-code-required', (data: any) => {\n      this.accounts.handleCodeRequired(data);\n    });\n    \n    this.ipc.on('login-2fa-required', (data: any) => {\n      this.accounts.handle2FARequired(data);\n    });\n    \n    this.ipc.on('login-success', (data: any) => {\n      this.accounts.handleLoginSuccess(data);\n    });\n    \n    this.ipc.on('login-failed', (data: any) => {\n      this.accounts.handleLoginFailed(data);\n    });\n    \n    // ç¾¤çµ„ç›¸é—œ\n    this.ipc.on('join-group-result', (data: any) => {\n      this.groups.handleJoinResult(data);\n    });\n    \n    this.ipc.on('batch-join-progress', (data: any) => {\n      this.groups.handleBatchJoinProgress(data);\n    });\n    \n    // æ¶ˆæ¯éšŠåˆ—ç›¸é—œ\n    this.ipc.on('queue-status-update', (data: any) => {\n      this.messages.handleQueueStatusUpdate(data);\n    });\n    \n    this.ipc.on('message-sent', (data: any) => {\n      this.messages.handleMessageSent(data);\n    });\n    \n    // ç³»çµ±ç‹€æ…‹\n    this.ipc.on('system-status', (status: SystemStatus) => {\n      this._systemStatus.set(status);\n    });\n  }\n  \n  // ========== å°èˆªæ“ä½œ ==========\n  \n  /**\n   * å°èˆªåˆ°æŒ‡å®šè¦–åœ–\n   */\n  navigateTo(view: ViewType): void {\n    this.nav.navigateTo(view as LegacyView);\n  }\n  \n  /**\n   * å°èˆªå›ä¸Šä¸€é \n   */\n  goBack(): void {\n    this.navigation.goBack();\n  }\n  \n  /**\n   * å°èˆªåˆ°é¦–é \n   */\n  goHome(): void {\n    this.navigateTo('dashboard');\n  }\n  \n  // ========== å¸³è™Ÿæ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  loginAccount(accountId: number): void {\n    this.accounts.loginAccount(accountId);\n  }\n  \n  logoutAccount(accountId: number): void {\n    this.accounts.logoutAccount(accountId);\n  }\n  \n  submitLoginCode(): void {\n    this.accounts.submitLoginCode();\n  }\n  \n  submitLogin2FA(): void {\n    this.accounts.submitLogin2FA();\n  }\n  \n  cancelLogin(): void {\n    this.accounts.cancelLogin();\n  }\n  \n  // ========== ç¾¤çµ„æ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  openJoinMonitorDialog(resource: any): void {\n    this.groups.openJoinMonitorDialog(resource);\n  }\n  \n  executeJoinAndMonitor(): void {\n    this.groups.executeJoinAndMonitor();\n  }\n  \n  openBatchJoinDialog(resources: any[]): void {\n    this.groups.openBatchJoinDialog(resources);\n  }\n  \n  leaveGroup(resource: any, phone: string): void {\n    this.groups.leaveGroup(resource, phone);\n  }\n  \n  // ========== æ¶ˆæ¯æ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  openSingleMessageDialog(target: any, type: 'user' | 'group' | 'channel'): void {\n    this.messages.openSingleMessageDialog(target, type);\n  }\n  \n  openBatchMessageDialog(targets: any[], type: 'user' | 'group' | 'channel'): void {\n    this.messages.openBatchMessageDialog(targets, type);\n  }\n  \n  pauseQueue(phone: string): void {\n    this.messages.pauseQueue(phone);\n  }\n  \n  resumeQueue(phone: string): void {\n    this.messages.resumeQueue(phone);\n  }\n  \n  // ========== ç›£æ§æ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  startMonitoring(): void {\n    this.ipc.send('start-monitoring');\n    this.toast.info('æ­£åœ¨å•Ÿå‹•ç›£æ§...');\n  }\n  \n  stopMonitoring(): void {\n    this.ipc.send('stop-monitoring');\n    this.toast.info('æ­£åœ¨åœæ­¢ç›£æ§...');\n  }\n  \n  // ========== ç‡ŸéŠ·æ´»å‹•ï¼ˆå§”è¨—ï¼‰ ==========\n  \n  loadCampaigns(): void {\n    this.campaigns.loadCampaigns();\n  }\n  \n  createCampaign(): void {\n    this.campaigns.createCampaignFromForm();\n  }\n  \n  startCampaign(campaignId: string): void {\n    this.campaigns.startCampaign(campaignId);\n  }\n  \n  // ========== ç·šç´¢ç®¡ç†ï¼ˆå§”è¨—ï¼‰ ==========\n  \n  loadLeads(): void {\n    this.leads.loadLeads();\n  }\n  \n  selectLead(lead: any): void {\n    this.leads.selectLead(lead);\n  }\n  \n  // ========== ç³»çµ±æ“ä½œ ==========\n  \n  /**\n   * åˆå§‹åŒ–æ‡‰ç”¨\n   */\n  async initialize(): Promise<void> {\n    if (this._isInitialized()) return;\n    \n    this._isLoading.set(true);\n    \n    try {\n      // åŠ è¼‰å¸³è™Ÿ\n      this.ipc.send('get-accounts');\n      \n      // åŠ è¼‰ç³»çµ±ç‹€æ…‹\n      this.ipc.send('get-system-status');\n      \n      // åŠ è¼‰é…ç½®\n      this.ipc.send('get-config');\n      \n      this._isInitialized.set(true);\n    } catch (error) {\n      console.error('[AppFacade] Initialization failed:', error);\n      this.toast.error('æ‡‰ç”¨åˆå§‹åŒ–å¤±æ•—');\n    } finally {\n      this._isLoading.set(false);\n    }\n  }\n  \n  /**\n   * åˆ·æ–°ç³»çµ±ç‹€æ…‹\n   */\n  refreshSystemStatus(): void {\n    this.ipc.send('get-system-status');\n  }\n  \n  /**\n   * é‡æ–°åŠ è¼‰æ‰€æœ‰æ•¸æ“š\n   */\n  reloadAll(): void {\n    this.ipc.send('get-accounts');\n    this.ipc.send('get-system-status');\n    this.campaigns.loadCampaigns();\n    this.templates.loadTemplates();\n    this.leads.loadLeads();\n    this.messages.refreshQueueStatus();\n  }\n  \n  // ========== å·¥å…·æ–¹æ³• ==========\n  \n  /**\n   * ç¿»è­¯\n   */\n  t(key: string, params?: Record<string, string | number>): string {\n    return this.i18n.t(key, params);\n  }\n  \n  /**\n   * æª¢æŸ¥åŠŸèƒ½æ¬Šé™\n   */\n  hasFeature(feature: string): boolean {\n    return this.membership.hasFeature(feature as any);\n  }\n  \n  /**\n   * é¡¯ç¤ºæˆåŠŸæç¤º\n   */\n  showSuccess(message: string): void {\n    this.toast.success(message);\n  }\n  \n  /**\n   * é¡¯ç¤ºéŒ¯èª¤æç¤º\n   */\n  showError(message: string): void {\n    this.toast.error(message);\n  }\n  \n  /**\n   * é¡¯ç¤ºä¿¡æ¯æç¤º\n   */\n  showInfo(message: string): void {\n    this.toast.info(message);\n  }\n  \n  // ========== æ•¸æ“šåŠ è¼‰æ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  /**\n   * åŠ è¼‰è³‡æºåˆ—è¡¨\n   */\n  loadResources(): void {\n    this.ipc.send('get-resources');\n  }\n  \n  /**\n   * åŠ è¼‰ AI è¨­ç½®\n   */\n  loadAiSettings(): void {\n    this.ipc.send('get-ai-settings');\n  }\n  \n  /**\n   * åŠ è¼‰æˆå“¡åˆ—è¡¨\n   */\n  loadMemberList(resourceId: number): void {\n    this.ipc.send('get-member-list', { resourceId });\n  }\n  \n  /**\n   * åŠ è¼‰æ—¥èªŒæ–‡ä»¶\n   */\n  loadLogFiles(): void {\n    this.ipc.send('get-log-files');\n  }\n  \n  /**\n   * åŠ è¼‰æ—¥èªŒçµ±è¨ˆ\n   */\n  loadLogStats(): void {\n    this.ipc.send('get-log-stats');\n  }\n  \n  /**\n   * åŠ è¼‰èª¿åº¦å™¨ç‹€æ…‹\n   */\n  loadSchedulerStatus(): void {\n    this.ipc.send('get-scheduler-status');\n  }\n  \n  /**\n   * åŠ è¼‰é ç†±è©³æƒ…\n   */\n  loadWarmupDetails(accountId: number): void {\n    this.ipc.send('get-warmup-details', { accountId });\n  }\n  \n  // ========== è³‡æºæ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  /**\n   * æœç´¢é »é“/ç¾¤çµ„\n   */\n  searchChannels(query: string, options?: { limit?: number; type?: string }): void {\n    this.ipc.send('search-channels', { query, ...options });\n  }\n  \n  /**\n   * æå–æˆå“¡\n   */\n  extractMembers(resourceId: number, phone: string, options?: { limit?: number }): void {\n    this.ipc.send('extract-members', { resourceId, phone, ...options });\n    this.toast.info('é–‹å§‹æå–æˆå“¡...');\n  }\n  \n  /**\n   * é‚€è«‹æˆå“¡åˆ°ç¾¤çµ„\n   */\n  inviteMembers(resourceId: number, userIds: number[], phone: string): void {\n    this.ipc.send('invite-members', { resourceId, userIds, phone });\n    this.toast.info(`æ­£åœ¨é‚€è«‹ ${userIds.length} ä½æˆå“¡...`);\n  }\n  \n  // ========== AI æ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  /**\n   * ç”Ÿæˆ AI å›å¾©\n   */\n  generateAiResponse(prompt: string, context?: any): void {\n    this.ipc.send('generate-ai-response', { prompt, context });\n  }\n  \n  /**\n   * ä¿å­˜ AI è¨­ç½®\n   */\n  saveAiSettings(settings: any): void {\n    this.ipc.send('save-ai-settings', settings);\n    this.toast.success('AI è¨­ç½®å·²ä¿å­˜');\n  }\n  \n  /**\n   * æ¸¬è©¦ AI é€£æ¥\n   */\n  testAiConnection(): void {\n    this.ipc.send('test-ai-connection');\n    this.toast.info('æ­£åœ¨æ¸¬è©¦ AI é€£æ¥...');\n  }\n  \n  // ========== è‡ªå‹•åŒ–æ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  /**\n   * å•Ÿå‹•è‡ªå‹•åŒ–æ´»å‹•\n   */\n  startAutomation(campaignId: string): void {\n    this.campaigns.startCampaign(campaignId);\n  }\n  \n  /**\n   * æš«åœè‡ªå‹•åŒ–æ´»å‹•\n   */\n  pauseAutomation(campaignId: string): void {\n    this.ipc.send('pause-campaign', { campaignId });\n    this.toast.info('æ­£åœ¨æš«åœæ´»å‹•...');\n  }\n  \n  /**\n   * åœæ­¢è‡ªå‹•åŒ–æ´»å‹•\n   */\n  stopAutomation(campaignId: string): void {\n    this.ipc.send('stop-campaign', { campaignId });\n    this.toast.info('æ­£åœ¨åœæ­¢æ´»å‹•...');\n  }\n  \n  // ========== å‚™ä»½æ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  /**\n   * å‰µå»ºå‚™ä»½\n   */\n  createBackup(): void {\n    this.ipc.send('create-backup');\n    this.toast.info('æ­£åœ¨å‰µå»ºå‚™ä»½...');\n  }\n  \n  /**\n   * æ¢å¾©å‚™ä»½\n   */\n  restoreBackup(backupId: string): void {\n    if (confirm('ç¢ºå®šè¦æ¢å¾©æ­¤å‚™ä»½å—ï¼Ÿç•¶å‰æ•¸æ“šå°‡è¢«è¦†è“‹ã€‚')) {\n      this.ipc.send('restore-backup', { backupId });\n      this.toast.info('æ­£åœ¨æ¢å¾©å‚™ä»½...');\n    }\n  }\n  \n  /**\n   * ç²å–å‚™ä»½åˆ—è¡¨\n   */\n  getBackups(): void {\n    this.ipc.send('get-backups');\n  }\n  \n  // ========== å°å‡ºæ“ä½œï¼ˆå§”è¨—ï¼‰ ==========\n  \n  /**\n   * å°å‡ºç·šç´¢\n   */\n  exportLeads(format: 'csv' | 'xlsx' | 'json' = 'csv'): void {\n    this.ipc.send('export-leads', { format });\n    this.toast.info('æ­£åœ¨å°å‡ºç·šç´¢...');\n  }\n  \n  /**\n   * å°å‡ºæˆå“¡\n   */\n  exportMembers(resourceId: number, format: 'csv' | 'xlsx' | 'json' = 'csv'): void {\n    this.ipc.send('export-members', { resourceId, format });\n    this.toast.info('æ­£åœ¨å°å‡ºæˆå“¡...');\n  }\n  \n  /**\n   * å°å‡ºçµ±è¨ˆå ±å‘Š\n   */\n  exportReport(type: 'daily' | 'weekly' | 'monthly' = 'daily'): void {\n    this.ipc.send('export-report', { type });\n    this.toast.info('æ­£åœ¨ç”Ÿæˆå ±å‘Š...');\n  }\n}\n","/**\r\n * RAG çŸ¥è­˜åº«æœå‹™\r\n * RAG Knowledge Service\r\n * \r\n * ğŸ†• Phase 26: å¾ app.component.ts æå– RAG ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport interface RagStats {\r\n  totalDocuments: number;\r\n  totalChunks: number;\r\n  lastIndexed: string | null;\r\n  indexSize: string;\r\n  categories: Record<string, number>;\r\n}\r\n\r\nexport interface RagDocument {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  category: string;\r\n  source: string;\r\n  createdAt: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface RagSearchResult {\r\n  id: string;\r\n  content: string;\r\n  score: number;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface RagFeedback {\r\n  queryId: string;\r\n  resultId: string;\r\n  helpful: boolean;\r\n  comment?: string;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RagService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _isInitialized = signal(false);\r\n  private _isLoading = signal(false);\r\n  private _isIndexing = signal(false);\r\n  private _stats = signal<RagStats>({\r\n    totalDocuments: 0,\r\n    totalChunks: 0,\r\n    lastIndexed: null,\r\n    indexSize: '0 KB',\r\n    categories: {}\r\n  });\r\n  private _searchResults = signal<RagSearchResult[]>([]);\r\n  private _searchQuery = signal('');\r\n  \r\n  isInitialized = this._isInitialized.asReadonly();\r\n  isLoading = this._isLoading.asReadonly();\r\n  isIndexing = this._isIndexing.asReadonly();\r\n  stats = this._stats.asReadonly();\r\n  searchResults = this._searchResults.asReadonly();\r\n  searchQuery = this._searchQuery.asReadonly();\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ========== IPC ç›£è½ ==========\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('rag-initialized', (data: { success: boolean }) => {\r\n      this._isInitialized.set(data.success);\r\n      this._isLoading.set(false);\r\n      if (data.success) {\r\n        this.toast.success('RAG ç³»çµ±åˆå§‹åŒ–æˆåŠŸ');\r\n        this.refreshStats();\r\n      }\r\n    });\r\n    \r\n    this.ipc.on('rag-stats', (data: RagStats) => {\r\n      this._stats.set(data);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('rag-search-results', (data: { results: RagSearchResult[] }) => {\r\n      this._searchResults.set(data.results);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('rag-indexing-started', () => {\r\n      this._isIndexing.set(true);\r\n      this.toast.info('é–‹å§‹ç´¢å¼•çŸ¥è­˜åº«...');\r\n    });\r\n    \r\n    this.ipc.on('rag-indexing-completed', (data: { count: number }) => {\r\n      this._isIndexing.set(false);\r\n      this.toast.success(`ç´¢å¼•å®Œæˆï¼Œå…±è™•ç† ${data.count} å€‹æ–‡æª”`);\r\n      this.refreshStats();\r\n    });\r\n    \r\n    this.ipc.on('rag-indexing-error', (data: { error: string }) => {\r\n      this._isIndexing.set(false);\r\n      this.toast.error(`ç´¢å¼•å¤±æ•—: ${data.error}`);\r\n    });\r\n    \r\n    this.ipc.on('rag-knowledge-added', () => {\r\n      this.toast.success('çŸ¥è­˜å·²æ·»åŠ ');\r\n      this.refreshStats();\r\n    });\r\n    \r\n    this.ipc.on('rag-cleanup-completed', (data: { removed: number }) => {\r\n      this.toast.success(`å·²æ¸…ç† ${data.removed} å€‹éæ™‚çŸ¥è­˜`);\r\n      this.refreshStats();\r\n    });\r\n  }\r\n  \r\n  // ========== åˆå§‹åŒ–æ“ä½œ ==========\r\n  \r\n  initRagSystem(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('init-rag-system');\r\n  }\r\n  \r\n  // ========== ç´¢å¼•æ“ä½œ ==========\r\n  \r\n  triggerLearning(): void {\r\n    this.ipc.send('rag-trigger-learning');\r\n  }\r\n  \r\n  reindexConversations(): void {\r\n    this.ipc.send('rag-reindex-conversations');\r\n  }\r\n  \r\n  reindexHighValueConversations(): void {\r\n    this.ipc.send('rag-reindex-high-value');\r\n  }\r\n  \r\n  // ========== æœç´¢æ“ä½œ ==========\r\n  \r\n  search(query: string): void {\r\n    if (!query.trim()) {\r\n      this._searchResults.set([]);\r\n      return;\r\n    }\r\n    \r\n    this._searchQuery.set(query);\r\n    this._isLoading.set(true);\r\n    this.ipc.send('rag-search', { query });\r\n  }\r\n  \r\n  clearSearchResults(): void {\r\n    this._searchResults.set([]);\r\n    this._searchQuery.set('');\r\n  }\r\n  \r\n  // ========== çŸ¥è­˜ç®¡ç† ==========\r\n  \r\n  addKnowledge(content: string, category: string, metadata?: Record<string, any>): void {\r\n    this.ipc.send('rag-add-knowledge', {\r\n      content,\r\n      category,\r\n      metadata\r\n    });\r\n  }\r\n  \r\n  deleteKnowledge(id: string): void {\r\n    this.ipc.send('rag-delete-knowledge', { id });\r\n  }\r\n  \r\n  // ========== åé¥‹æ“ä½œ ==========\r\n  \r\n  sendFeedback(feedback: RagFeedback): void {\r\n    this.ipc.send('rag-feedback', feedback);\r\n    this.toast.success('æ„Ÿè¬æ‚¨çš„åé¥‹ï¼');\r\n  }\r\n  \r\n  // ========== æ¸…ç†æ“ä½œ ==========\r\n  \r\n  cleanupKnowledge(): void {\r\n    this.ipc.send('rag-cleanup');\r\n  }\r\n  \r\n  // ========== çµ±è¨ˆæ“ä½œ ==========\r\n  \r\n  refreshStats(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-rag-stats');\r\n  }\r\n}\r\n","/**\r\n * å‘é‡è¨˜æ†¶æœå‹™\r\n * Vector Memory Service\r\n * \r\n * ğŸ†• Phase 26: å¾ app.component.ts æå–å‘é‡è¨˜æ†¶ç›¸é—œæ–¹æ³•\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// ============ é¡å‹å®šç¾© ============\r\n\r\nexport interface VectorMemoryStats {\r\n  totalMemories: number;\r\n  totalUsers: number;\r\n  averagePerUser: number;\r\n  storageSize: string;\r\n  oldestMemory: string | null;\r\n  newestMemory: string | null;\r\n}\r\n\r\nexport interface VectorMemory {\r\n  id: string;\r\n  userId: string;\r\n  content: string;\r\n  embedding?: number[];\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  accessCount: number;\r\n  importance: number;\r\n  category?: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface MemorySearchResult {\r\n  memory: VectorMemory;\r\n  score: number;\r\n}\r\n\r\nexport interface MemoryUser {\r\n  userId: string;\r\n  username?: string;\r\n  memoryCount: number;\r\n  lastActivity: string;\r\n}\r\n\r\n// ============ æœå‹™å¯¦ç¾ ============\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class VectorMemoryService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ========== ç‹€æ…‹ ==========\r\n  \r\n  private _stats = signal<VectorMemoryStats>({\r\n    totalMemories: 0,\r\n    totalUsers: 0,\r\n    averagePerUser: 0,\r\n    storageSize: '0 KB',\r\n    oldestMemory: null,\r\n    newestMemory: null\r\n  });\r\n  private _memories = signal<VectorMemory[]>([]);\r\n  private _searchResults = signal<MemorySearchResult[]>([]);\r\n  private _users = signal<MemoryUser[]>([]);\r\n  private _isLoading = signal(false);\r\n  private _selectedUserId = signal<string | null>(null);\r\n  \r\n  stats = this._stats.asReadonly();\r\n  memories = this._memories.asReadonly();\r\n  searchResults = this._searchResults.asReadonly();\r\n  users = this._users.asReadonly();\r\n  isLoading = this._isLoading.asReadonly();\r\n  selectedUserId = this._selectedUserId.asReadonly();\r\n  \r\n  // ========== è¨ˆç®—å±¬æ€§ ==========\r\n  \r\n  userMemories = computed(() => {\r\n    const userId = this._selectedUserId();\r\n    if (!userId) return [];\r\n    return this._memories().filter(m => m.userId === userId);\r\n  });\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  // ========== IPC ç›£è¯ ==========\r\n  \r\n  private setupIpcListeners(): void {\r\n    this.ipc.on('vector-memory-stats', (data: VectorMemoryStats) => {\r\n      this._stats.set(data);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('vector-memories-loaded', (data: VectorMemory[]) => {\r\n      this._memories.set(data);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('vector-memory-search-results', (data: { results: MemorySearchResult[] }) => {\r\n      this._searchResults.set(data.results);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('memory-users-loaded', (data: MemoryUser[]) => {\r\n      this._users.set(data);\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    this.ipc.on('vector-memory-added', (data: VectorMemory) => {\r\n      this._memories.update(list => [...list, data]);\r\n      this.toast.success('è¨˜æ†¶å·²æ·»åŠ ');\r\n    });\r\n    \r\n    this.ipc.on('vector-memory-deleted', (data: { id: string }) => {\r\n      this._memories.update(list => list.filter(m => m.id !== data.id));\r\n      this.toast.success('è¨˜æ†¶å·²åˆªé™¤');\r\n    });\r\n    \r\n    this.ipc.on('cleanup-completed', (data: { removed: number }) => {\r\n      this.toast.success(`å·²æ¸…ç† ${data.removed} å€‹éæœŸè¨˜æ†¶`);\r\n      this.refreshStats();\r\n    });\r\n    \r\n    this.ipc.on('merge-completed', (data: { merged: number }) => {\r\n      this.toast.success(`å·²åˆä½µ ${data.merged} å€‹ç›¸ä¼¼è¨˜æ†¶`);\r\n      this.refreshStats();\r\n    });\r\n  }\r\n  \r\n  // ========== æœç´¢æ“ä½œ ==========\r\n  \r\n  search(query: string, userId?: string): void {\r\n    if (!query.trim()) {\r\n      this._searchResults.set([]);\r\n      return;\r\n    }\r\n    \r\n    this._isLoading.set(true);\r\n    this.ipc.send('search-vector-memory', { query, userId });\r\n  }\r\n  \r\n  clearSearchResults(): void {\r\n    this._searchResults.set([]);\r\n  }\r\n  \r\n  // ========== è¨˜æ†¶æ“ä½œ ==========\r\n  \r\n  addMemory(userId: string, content: string, metadata?: Record<string, any>): void {\r\n    this.ipc.send('add-vector-memory', {\r\n      userId,\r\n      content,\r\n      metadata\r\n    });\r\n  }\r\n  \r\n  deleteMemory(id: string): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¨˜æ†¶å—ï¼Ÿ')) return;\r\n    this.ipc.send('delete-vector-memory', { id });\r\n  }\r\n  \r\n  loadUserMemories(userId: string): void {\r\n    this._selectedUserId.set(userId);\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-user-memories', { userId });\r\n  }\r\n  \r\n  // ========== ç”¨æˆ¶æ“ä½œ ==========\r\n  \r\n  loadUserList(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-memory-users');\r\n  }\r\n  \r\n  selectUser(userId: string | null): void {\r\n    this._selectedUserId.set(userId);\r\n    if (userId) {\r\n      this.loadUserMemories(userId);\r\n    }\r\n  }\r\n  \r\n  // ========== ç¶­è­·æ“ä½œ ==========\r\n  \r\n  cleanupOldMemories(daysOld: number = 90): void {\r\n    if (!confirm(`ç¢ºå®šè¦æ¸…ç† ${daysOld} å¤©å‰çš„èˆŠè¨˜æ†¶å—ï¼Ÿ`)) return;\r\n    this.ipc.send('cleanup-old-memories', { daysOld });\r\n  }\r\n  \r\n  mergeSimilarMemories(threshold: number = 0.9): void {\r\n    if (!confirm('ç¢ºå®šè¦åˆä½µç›¸ä¼¼è¨˜æ†¶å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚')) return;\r\n    this.ipc.send('merge-similar-memories', { threshold });\r\n  }\r\n  \r\n  // ========== çµ±è¨ˆæ“ä½œ ==========\r\n  \r\n  refreshStats(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-vector-memory-stats');\r\n  }\r\n  \r\n  loadAllMemories(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-all-memories');\r\n  }\r\n}\r\n","/**\r\n * ä»»å‹™æ¨¡æ¿æœå‹™\r\n * Task Template Service\r\n * \r\n * ğŸ†• å„ªåŒ– 1-2: ä»»å‹™æ¨¡æ¿ç³»çµ±\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - ä¿å­˜æˆåŠŸçš„ä»»å‹™é…ç½®ç‚ºæ¨¡æ¿\r\n * - å¿«é€Ÿå¾©ç”¨æ¨¡æ¿å‰µå»ºæ–°ä»»å‹™\r\n * - æ¨è–¦é«˜æˆåŠŸç‡æ¨¡æ¿\r\n */\r\n\r\nimport { Injectable, signal, computed } from '@angular/core';\r\nimport { GoalType, ExecutionMode } from '../models/marketing-task.models';\r\n\r\n// æ¨¡æ¿æ¥å£\r\nexport interface TaskTemplate {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  \r\n  // é…ç½®\r\n  goalType: GoalType;\r\n  executionMode: ExecutionMode;\r\n  audienceSource: string;\r\n  intentScoreMin: number;\r\n  \r\n  // è§’è‰²é…ç½®\r\n  roles?: string[];\r\n  \r\n  // AI é…ç½®\r\n  aiHostingEnabled?: boolean;\r\n  autoGreeting?: boolean;\r\n  autoReply?: boolean;\r\n  \r\n  // çµ±è¨ˆï¼ˆç”¨æ–¼æ¨è–¦ï¼‰\r\n  usageCount: number;\r\n  successCount: number;\r\n  totalContacted: number;\r\n  totalConverted: number;\r\n  \r\n  // å…ƒæ•¸æ“š\r\n  isSystem: boolean;  // æ˜¯å¦ç³»çµ±é è¨­\r\n  isFavorite: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// ç³»çµ±é è¨­æ¨¡æ¿\r\nconst SYSTEM_TEMPLATES: TaskTemplate[] = [\r\n  {\r\n    id: 'sys-high-intent',\r\n    name: 'é«˜æ„å‘å®¢æˆ¶è½‰åŒ–',\r\n    description: 'é‡å°æ„å‘åˆ†æ•¸ â‰¥80 çš„é«˜è³ªé‡æ½›åœ¨å®¢æˆ¶',\r\n    goalType: 'conversion',\r\n    executionMode: 'hybrid',\r\n    audienceSource: 'tags',\r\n    intentScoreMin: 80,\r\n    roles: ['expert', 'satisfied_customer'],\r\n    aiHostingEnabled: true,\r\n    autoGreeting: true,\r\n    autoReply: true,\r\n    usageCount: 0,\r\n    successCount: 0,\r\n    totalContacted: 0,\r\n    totalConverted: 0,\r\n    isSystem: true,\r\n    isFavorite: false,\r\n    createdAt: '2024-01-01T00:00:00Z',\r\n    updatedAt: '2024-01-01T00:00:00Z'\r\n  },\r\n  {\r\n    id: 'sys-win-back',\r\n    name: 'æ²‰é»˜å®¢æˆ¶å–šé†’',\r\n    description: '7å¤©å…§ç„¡äº’å‹•çš„è€å®¢æˆ¶æŒ½å›ç­–ç•¥',\r\n    goalType: 'retention',\r\n    executionMode: 'hybrid',\r\n    audienceSource: 'recent',\r\n    intentScoreMin: 30,\r\n    roles: ['callback', 'support', 'manager'],\r\n    aiHostingEnabled: true,\r\n    autoGreeting: true,\r\n    autoReply: true,\r\n    usageCount: 0,\r\n    successCount: 0,\r\n    totalContacted: 0,\r\n    totalConverted: 0,\r\n    isSystem: true,\r\n    isFavorite: false,\r\n    createdAt: '2024-01-01T00:00:00Z',\r\n    updatedAt: '2024-01-01T00:00:00Z'\r\n  },\r\n  {\r\n    id: 'sys-community',\r\n    name: 'ç¤¾ç¾¤æ´»èºå¼•çˆ†',\r\n    description: 'åœ¨ç¾¤çµ„ä¸­è£½é€ è©±é¡Œï¼Œæå‡æ´»èºåº¦',\r\n    goalType: 'engagement',\r\n    executionMode: 'scriptless',\r\n    audienceSource: 'group',\r\n    intentScoreMin: 0,\r\n    roles: ['newbie', 'satisfied_customer', 'expert'],\r\n    aiHostingEnabled: true,\r\n    autoGreeting: false,\r\n    autoReply: true,\r\n    usageCount: 0,\r\n    successCount: 0,\r\n    totalContacted: 0,\r\n    totalConverted: 0,\r\n    isSystem: true,\r\n    isFavorite: false,\r\n    createdAt: '2024-01-01T00:00:00Z',\r\n    updatedAt: '2024-01-01T00:00:00Z'\r\n  },\r\n  {\r\n    id: 'sys-support',\r\n    name: 'å”®å¾Œæœå‹™éŸ¿æ‡‰',\r\n    description: 'å¿«é€ŸéŸ¿æ‡‰å®¢æˆ¶å•é¡Œï¼Œæå‡æ»¿æ„åº¦',\r\n    goalType: 'support',\r\n    executionMode: 'scripted',\r\n    audienceSource: 'recent',\r\n    intentScoreMin: 0,\r\n    roles: ['support', 'expert'],\r\n    aiHostingEnabled: true,\r\n    autoGreeting: false,\r\n    autoReply: true,\r\n    usageCount: 0,\r\n    successCount: 0,\r\n    totalContacted: 0,\r\n    totalConverted: 0,\r\n    isSystem: true,\r\n    isFavorite: false,\r\n    createdAt: '2024-01-01T00:00:00Z',\r\n    updatedAt: '2024-01-01T00:00:00Z'\r\n  }\r\n];\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TaskTemplateService {\r\n  \r\n  // ç‹€æ…‹\r\n  private _templates = signal<TaskTemplate[]>([]);\r\n  templates = this._templates.asReadonly();\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  userTemplates = computed(() => this._templates().filter(t => !t.isSystem));\r\n  systemTemplates = computed(() => SYSTEM_TEMPLATES);\r\n  favoriteTemplates = computed(() => this._templates().filter(t => t.isFavorite));\r\n  \r\n  // æŒ‰æˆåŠŸç‡æ’åºçš„æ¨è–¦æ¨¡æ¿\r\n  recommendedTemplates = computed(() => {\r\n    const all = [...this._templates(), ...SYSTEM_TEMPLATES];\r\n    return all\r\n      .filter(t => t.usageCount >= 3) // è‡³å°‘ä½¿ç”¨é3æ¬¡\r\n      .sort((a, b) => {\r\n        const rateA = a.totalContacted > 0 ? a.totalConverted / a.totalContacted : 0;\r\n        const rateB = b.totalContacted > 0 ? b.totalConverted / b.totalContacted : 0;\r\n        return rateB - rateA;\r\n      })\r\n      .slice(0, 5);\r\n  });\r\n  \r\n  // æŒ‰ç›®æ¨™é¡å‹åˆ†çµ„\r\n  templatesByGoal = computed(() => {\r\n    const all = [...this._templates(), ...SYSTEM_TEMPLATES];\r\n    return all.reduce((acc, t) => {\r\n      if (!acc[t.goalType]) acc[t.goalType] = [];\r\n      acc[t.goalType].push(t);\r\n      return acc;\r\n    }, {} as Record<GoalType, TaskTemplate[]>);\r\n  });\r\n  \r\n  constructor() {\r\n    this.loadTemplates();\r\n  }\r\n  \r\n  /**\r\n   * å¾æœ¬åœ°å­˜å„²åŠ è¼‰æ¨¡æ¿\r\n   */\r\n  private loadTemplates(): void {\r\n    try {\r\n      const saved = localStorage.getItem('task_templates');\r\n      if (saved) {\r\n        this._templates.set(JSON.parse(saved));\r\n      }\r\n    } catch (error) {\r\n      console.error('åŠ è¼‰æ¨¡æ¿å¤±æ•—:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ä¿å­˜æ¨¡æ¿åˆ°æœ¬åœ°å­˜å„²\r\n   */\r\n  private saveTemplates(): void {\r\n    localStorage.setItem('task_templates', JSON.stringify(this._templates()));\r\n  }\r\n  \r\n  /**\r\n   * å‰µå»ºæ–°æ¨¡æ¿\r\n   */\r\n  createTemplate(template: Omit<TaskTemplate, 'id' | 'usageCount' | 'successCount' | 'totalContacted' | 'totalConverted' | 'isSystem' | 'createdAt' | 'updatedAt'>): TaskTemplate {\r\n    const newTemplate: TaskTemplate = {\r\n      ...template,\r\n      id: `tpl-${Date.now()}`,\r\n      usageCount: 0,\r\n      successCount: 0,\r\n      totalContacted: 0,\r\n      totalConverted: 0,\r\n      isSystem: false,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n    \r\n    this._templates.update(templates => [...templates, newTemplate]);\r\n    this.saveTemplates();\r\n    \r\n    return newTemplate;\r\n  }\r\n  \r\n  /**\r\n   * å¾ç¾æœ‰ä»»å‹™å‰µå»ºæ¨¡æ¿\r\n   */\r\n  createFromTask(task: any, name: string, description?: string): TaskTemplate {\r\n    return this.createTemplate({\r\n      name,\r\n      description,\r\n      goalType: task.goalType,\r\n      executionMode: task.executionMode,\r\n      audienceSource: task.targetCriteria?.sources?.[0] || 'recent',\r\n      intentScoreMin: task.targetCriteria?.intentScoreMin || 50,\r\n      roles: task.roleConfig?.map((r: any) => r.roleType),\r\n      aiHostingEnabled: true,\r\n      autoGreeting: true,\r\n      autoReply: true,\r\n      isFavorite: false\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æ›´æ–°æ¨¡æ¿\r\n   */\r\n  updateTemplate(id: string, updates: Partial<TaskTemplate>): void {\r\n    this._templates.update(templates => \r\n      templates.map(t => \r\n        t.id === id \r\n          ? { ...t, ...updates, updatedAt: new Date().toISOString() }\r\n          : t\r\n      )\r\n    );\r\n    this.saveTemplates();\r\n  }\r\n  \r\n  /**\r\n   * åˆªé™¤æ¨¡æ¿\r\n   */\r\n  deleteTemplate(id: string): void {\r\n    this._templates.update(templates => templates.filter(t => t.id !== id));\r\n    this.saveTemplates();\r\n  }\r\n  \r\n  /**\r\n   * åˆ‡æ›æ”¶è—\r\n   */\r\n  toggleFavorite(id: string): void {\r\n    this._templates.update(templates =>\r\n      templates.map(t =>\r\n        t.id === id ? { ...t, isFavorite: !t.isFavorite } : t\r\n      )\r\n    );\r\n    this.saveTemplates();\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„æ¨¡æ¿ä½¿ç”¨\r\n   */\r\n  recordUsage(id: string): void {\r\n    this._templates.update(templates =>\r\n      templates.map(t =>\r\n        t.id === id ? { ...t, usageCount: t.usageCount + 1 } : t\r\n      )\r\n    );\r\n    this.saveTemplates();\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„ä»»å‹™çµæœ\r\n   */\r\n  recordResult(id: string, contacted: number, converted: number, success: boolean): void {\r\n    this._templates.update(templates =>\r\n      templates.map(t =>\r\n        t.id === id \r\n          ? { \r\n              ...t, \r\n              totalContacted: t.totalContacted + contacted,\r\n              totalConverted: t.totalConverted + converted,\r\n              successCount: success ? t.successCount + 1 : t.successCount\r\n            }\r\n          : t\r\n      )\r\n    );\r\n    this.saveTemplates();\r\n  }\r\n  \r\n  /**\r\n   * ç²å–æ¨¡æ¿\r\n   */\r\n  getTemplate(id: string): TaskTemplate | undefined {\r\n    // å…ˆå¾ç”¨æˆ¶æ¨¡æ¿æ‰¾\r\n    const userTemplate = this._templates().find(t => t.id === id);\r\n    if (userTemplate) return userTemplate;\r\n    \r\n    // å†å¾ç³»çµ±æ¨¡æ¿æ‰¾\r\n    return SYSTEM_TEMPLATES.find(t => t.id === id);\r\n  }\r\n  \r\n  /**\r\n   * ç²å–æ¨¡æ¿æˆåŠŸç‡\r\n   */\r\n  getSuccessRate(template: TaskTemplate): number {\r\n    if (template.totalContacted === 0) return 0;\r\n    return Math.round((template.totalConverted / template.totalContacted) * 100);\r\n  }\r\n  \r\n  /**\r\n   * æœç´¢æ¨¡æ¿\r\n   */\r\n  searchTemplates(query: string): TaskTemplate[] {\r\n    const lowerQuery = query.toLowerCase();\r\n    const all = [...this._templates(), ...SYSTEM_TEMPLATES];\r\n    return all.filter(t => \r\n      t.name.toLowerCase().includes(lowerQuery) ||\r\n      t.description?.toLowerCase().includes(lowerQuery)\r\n    );\r\n  }\r\n}\r\n","/**\r\n * æ™ºèƒ½æ¨è–¦æœå‹™\r\n * Smart Recommendation Service\r\n * \r\n * ğŸ†• å„ªåŒ– 1-3: æ™ºèƒ½æ¨è–¦\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - åŸºæ–¼æ­·å²æ•¸æ“šæ¨è–¦æœ€å„ªé…ç½®\r\n * - åˆ†ææˆåŠŸä»»å‹™çš„å…±æ€§\r\n * - æä¾›å€‹æ€§åŒ–å»ºè­°\r\n */\r\n\r\nimport { Injectable, inject, signal, computed } from '@angular/core';\r\nimport { MarketingTaskService } from './marketing-task.service';\r\nimport { TaskTemplateService } from './task-template.service';\r\nimport { GoalType, ExecutionMode, GOAL_TYPE_CONFIG } from '../models/marketing-task.models';\r\n\r\n// æ¨è–¦é …ç›®\r\nexport interface Recommendation {\r\n  id: string;\r\n  type: 'goal' | 'mode' | 'roles' | 'audience' | 'timing';\r\n  title: string;\r\n  description: string;\r\n  confidence: number;  // 0-100\r\n  reason: string;\r\n  action?: {\r\n    label: string;\r\n    data: any;\r\n  };\r\n}\r\n\r\n// ä»»å‹™åˆ†æçµæœ\r\nexport interface TaskAnalysis {\r\n  totalTasks: number;\r\n  successfulTasks: number;\r\n  avgConversionRate: number;\r\n  \r\n  // æŒ‰ç›®æ¨™é¡å‹\r\n  byGoal: Record<GoalType, {\r\n    count: number;\r\n    avgConversionRate: number;\r\n    bestExecutionMode: ExecutionMode;\r\n    bestRoles: string[];\r\n  }>;\r\n  \r\n  // æœ€ä½³æ™‚æ®µ\r\n  bestHours: number[];\r\n  \r\n  // æœ€æˆåŠŸçš„é…ç½®\r\n  topConfigs: {\r\n    goalType: GoalType;\r\n    executionMode: ExecutionMode;\r\n    roles: string[];\r\n    conversionRate: number;\r\n    sampleSize: number;\r\n  }[];\r\n}\r\n\r\n// æ™ºèƒ½å»ºè­°\r\nexport interface SmartSuggestion {\r\n  goalType: GoalType;\r\n  executionMode: ExecutionMode;\r\n  suggestedRoles: string[];\r\n  intentThreshold: number;\r\n  audienceSource: string;\r\n  reason: string;\r\n  expectedConversionRate: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SmartRecommendationService {\r\n  private taskService = inject(MarketingTaskService);\r\n  private templateService = inject(TaskTemplateService);\r\n  \r\n  // åˆ†æçµæœç·©å­˜\r\n  private _analysis = signal<TaskAnalysis | null>(null);\r\n  analysis = this._analysis.asReadonly();\r\n  \r\n  // ä¸Šæ¬¡åˆ†ææ™‚é–“\r\n  private lastAnalysisTime = 0;\r\n  private readonly CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é˜ç·©å­˜\r\n  \r\n  constructor() {\r\n    // åˆå§‹åˆ†æ\r\n    this.analyzeHistory();\r\n  }\r\n  \r\n  /**\r\n   * åˆ†ææ­·å²ä»»å‹™æ•¸æ“š\r\n   */\r\n  async analyzeHistory(): Promise<TaskAnalysis> {\r\n    const now = Date.now();\r\n    \r\n    // ä½¿ç”¨ç·©å­˜\r\n    if (this._analysis() && now - this.lastAnalysisTime < this.CACHE_DURATION) {\r\n      return this._analysis()!;\r\n    }\r\n    \r\n    const tasks = this.taskService.tasks();\r\n    const completedTasks = tasks.filter(t => t.status === 'completed');\r\n    \r\n    // åˆå§‹åŒ–åˆ†æçµæœ\r\n    const analysis: TaskAnalysis = {\r\n      totalTasks: tasks.length,\r\n      successfulTasks: completedTasks.filter(t => t.stats.converted > 0).length,\r\n      avgConversionRate: 0,\r\n      byGoal: {} as any,\r\n      bestHours: [],\r\n      topConfigs: []\r\n    };\r\n    \r\n    // è¨ˆç®—ç¸½é«”è½‰åŒ–ç‡\r\n    const totalContacted = completedTasks.reduce((sum, t) => sum + t.stats.contacted, 0);\r\n    const totalConverted = completedTasks.reduce((sum, t) => sum + t.stats.converted, 0);\r\n    analysis.avgConversionRate = totalContacted > 0 ? (totalConverted / totalContacted) * 100 : 0;\r\n    \r\n    // æŒ‰ç›®æ¨™é¡å‹åˆ†æ\r\n    const goalTypes: GoalType[] = ['conversion', 'retention', 'engagement', 'support'];\r\n    for (const goal of goalTypes) {\r\n      const goalTasks = completedTasks.filter(t => t.goalType === goal);\r\n      const contacted = goalTasks.reduce((sum, t) => sum + t.stats.contacted, 0);\r\n      const converted = goalTasks.reduce((sum, t) => sum + t.stats.converted, 0);\r\n      \r\n      // æ‰¾å‡ºæœ€ä½³åŸ·è¡Œæ¨¡å¼\r\n      const modeStats = new Map<ExecutionMode, { contacted: number; converted: number }>();\r\n      goalTasks.forEach(t => {\r\n        const current = modeStats.get(t.executionMode) || { contacted: 0, converted: 0 };\r\n        modeStats.set(t.executionMode, {\r\n          contacted: current.contacted + t.stats.contacted,\r\n          converted: current.converted + t.stats.converted\r\n        });\r\n      });\r\n      \r\n      let bestMode: ExecutionMode = 'hybrid';\r\n      let bestModeRate = 0;\r\n      modeStats.forEach((stats, mode) => {\r\n        const rate = stats.contacted > 0 ? stats.converted / stats.contacted : 0;\r\n        if (rate > bestModeRate) {\r\n          bestModeRate = rate;\r\n          bestMode = mode;\r\n        }\r\n      });\r\n      \r\n      // æ‰¾å‡ºæœ€ä½³è§’è‰²çµ„åˆ\r\n      const roleCounts = new Map<string, number>();\r\n      goalTasks.forEach(t => {\r\n        t.roleConfig?.forEach(r => {\r\n          const current = roleCounts.get(r.roleType) || 0;\r\n          roleCounts.set(r.roleType, current + (t.stats.converted > 0 ? 1 : 0));\r\n        });\r\n      });\r\n      \r\n      const bestRoles = Array.from(roleCounts.entries())\r\n        .sort((a, b) => b[1] - a[1])\r\n        .slice(0, 3)\r\n        .map(([role]) => role);\r\n      \r\n      analysis.byGoal[goal] = {\r\n        count: goalTasks.length,\r\n        avgConversionRate: contacted > 0 ? (converted / contacted) * 100 : 0,\r\n        bestExecutionMode: bestMode,\r\n        bestRoles: bestRoles.length > 0 ? bestRoles : GOAL_TYPE_CONFIG[goal].suggestedRoles\r\n      };\r\n    }\r\n    \r\n    // åˆ†ææœ€ä½³æ™‚æ®µï¼ˆåŸºæ–¼ä»»å‹™å‰µå»ºæ™‚é–“ï¼‰\r\n    const hourCounts = new Array(24).fill(0);\r\n    const hourSuccess = new Array(24).fill(0);\r\n    completedTasks.forEach(t => {\r\n      const hour = new Date(t.createdAt).getHours();\r\n      hourCounts[hour]++;\r\n      if (t.stats.converted > 0) {\r\n        hourSuccess[hour]++;\r\n      }\r\n    });\r\n    \r\n    const hourRates = hourCounts.map((count, i) => ({\r\n      hour: i,\r\n      rate: count > 0 ? hourSuccess[i] / count : 0\r\n    }));\r\n    \r\n    analysis.bestHours = hourRates\r\n      .sort((a, b) => b.rate - a.rate)\r\n      .slice(0, 3)\r\n      .map(h => h.hour);\r\n    \r\n    // æ‰¾å‡ºæœ€æˆåŠŸçš„é…ç½®\r\n    const configMap = new Map<string, { goalType: GoalType; executionMode: ExecutionMode; roles: string[]; contacted: number; converted: number; count: number }>();\r\n    \r\n    completedTasks.forEach(t => {\r\n      const roles = t.roleConfig?.map(r => r.roleType).sort().join(',') || '';\r\n      const key = `${t.goalType}|${t.executionMode}|${roles}`;\r\n      \r\n      const current = configMap.get(key) || {\r\n        goalType: t.goalType,\r\n        executionMode: t.executionMode,\r\n        roles: t.roleConfig?.map(r => r.roleType) || [],\r\n        contacted: 0,\r\n        converted: 0,\r\n        count: 0\r\n      };\r\n      \r\n      configMap.set(key, {\r\n        ...current,\r\n        contacted: current.contacted + t.stats.contacted,\r\n        converted: current.converted + t.stats.converted,\r\n        count: current.count + 1\r\n      });\r\n    });\r\n    \r\n    analysis.topConfigs = Array.from(configMap.values())\r\n      .filter(c => c.count >= 2) // è‡³å°‘ä½¿ç”¨2æ¬¡\r\n      .map(c => ({\r\n        goalType: c.goalType,\r\n        executionMode: c.executionMode,\r\n        roles: c.roles,\r\n        conversionRate: c.contacted > 0 ? (c.converted / c.contacted) * 100 : 0,\r\n        sampleSize: c.count\r\n      }))\r\n      .sort((a, b) => b.conversionRate - a.conversionRate)\r\n      .slice(0, 5);\r\n    \r\n    this._analysis.set(analysis);\r\n    this.lastAnalysisTime = now;\r\n    \r\n    return analysis;\r\n  }\r\n  \r\n  /**\r\n   * ç²å–æ¨è–¦åˆ—è¡¨\r\n   */\r\n  getRecommendations(): Recommendation[] {\r\n    const recommendations: Recommendation[] = [];\r\n    const analysis = this._analysis();\r\n    \r\n    if (!analysis || analysis.totalTasks < 3) {\r\n      // æ–°ç”¨æˆ¶æ¨è–¦\r\n      recommendations.push({\r\n        id: 'new-user-conversion',\r\n        type: 'goal',\r\n        title: 'é–‹å§‹æ‚¨çš„ç¬¬ä¸€å€‹è½‰åŒ–ä»»å‹™',\r\n        description: 'ã€Œä¿ƒé€²é¦–å–®ã€æ˜¯æœ€å¸¸ç”¨çš„ç‡ŸéŠ·ç›®æ¨™',\r\n        confidence: 80,\r\n        reason: 'åŸºæ–¼ç³»çµ±é»˜èªæ¨è–¦',\r\n        action: {\r\n          label: 'å‰µå»ºä»»å‹™',\r\n          data: { goalType: 'conversion' }\r\n        }\r\n      });\r\n      return recommendations;\r\n    }\r\n    \r\n    // åŸºæ–¼æœ€ä½³é…ç½®æ¨è–¦\r\n    if (analysis.topConfigs.length > 0) {\r\n      const best = analysis.topConfigs[0];\r\n      recommendations.push({\r\n        id: 'best-config',\r\n        type: 'goal',\r\n        title: `ä½¿ç”¨æ‚¨çš„æœ€ä½³é…ç½®`,\r\n        description: `${GOAL_TYPE_CONFIG[best.goalType].label} + ${this.getModeLabel(best.executionMode)}`,\r\n        confidence: Math.min(90, 50 + best.sampleSize * 10),\r\n        reason: `æ­·å²è½‰åŒ–ç‡ ${best.conversionRate.toFixed(1)}%ï¼ˆ${best.sampleSize} æ¬¡ä»»å‹™ï¼‰`,\r\n        action: {\r\n          label: 'ä½¿ç”¨æ­¤é…ç½®',\r\n          data: best\r\n        }\r\n      });\r\n    }\r\n    \r\n    // åŸºæ–¼ç›®æ¨™é¡å‹æ¨è–¦\r\n    const goalEntries = Object.entries(analysis.byGoal) as [GoalType, typeof analysis.byGoal[GoalType]][];\r\n    const bestGoal = goalEntries\r\n      .filter(([_, data]) => data.count >= 2)\r\n      .sort((a, b) => b[1].avgConversionRate - a[1].avgConversionRate)[0];\r\n    \r\n    if (bestGoal) {\r\n      const [goalType, data] = bestGoal;\r\n      recommendations.push({\r\n        id: 'best-goal',\r\n        type: 'goal',\r\n        title: `${GOAL_TYPE_CONFIG[goalType].label} è¡¨ç¾æœ€ä½³`,\r\n        description: `å¹³å‡è½‰åŒ–ç‡ ${data.avgConversionRate.toFixed(1)}%`,\r\n        confidence: Math.min(85, 40 + data.count * 5),\r\n        reason: `åŸºæ–¼ ${data.count} æ¬¡æ­·å²ä»»å‹™åˆ†æ`\r\n      });\r\n    }\r\n    \r\n    // æœ€ä½³æ™‚æ®µæ¨è–¦\r\n    if (analysis.bestHours.length > 0) {\r\n      const hours = analysis.bestHours.map(h => `${h}:00`).join('ã€');\r\n      recommendations.push({\r\n        id: 'best-timing',\r\n        type: 'timing',\r\n        title: 'æœ€ä½³å•Ÿå‹•æ™‚æ®µ',\r\n        description: hours,\r\n        confidence: 70,\r\n        reason: 'é€™äº›æ™‚æ®µçš„ä»»å‹™æˆåŠŸç‡è¼ƒé«˜'\r\n      });\r\n    }\r\n    \r\n    return recommendations;\r\n  }\r\n  \r\n  /**\r\n   * ç‚ºç‰¹å®šç›®æ¨™ç²å–æ™ºèƒ½å»ºè­°\r\n   */\r\n  getSuggestionForGoal(goalType: GoalType): SmartSuggestion {\r\n    const analysis = this._analysis();\r\n    const goalData = analysis?.byGoal[goalType];\r\n    const defaultConfig = GOAL_TYPE_CONFIG[goalType];\r\n    \r\n    if (!goalData || goalData.count < 2) {\r\n      // ä½¿ç”¨é»˜èªå»ºè­°\r\n      return {\r\n        goalType,\r\n        executionMode: defaultConfig.suggestedMode,\r\n        suggestedRoles: defaultConfig.suggestedRoles,\r\n        intentThreshold: 70,\r\n        audienceSource: 'recent',\r\n        reason: 'åŸºæ–¼ç³»çµ±é»˜èªæ¨è–¦',\r\n        expectedConversionRate: 15\r\n      };\r\n    }\r\n    \r\n    return {\r\n      goalType,\r\n      executionMode: goalData.bestExecutionMode,\r\n      suggestedRoles: goalData.bestRoles,\r\n      intentThreshold: 60,\r\n      audienceSource: 'tags',\r\n      reason: `åŸºæ–¼ ${goalData.count} æ¬¡æ­·å²ä»»å‹™åˆ†æ`,\r\n      expectedConversionRate: Math.round(goalData.avgConversionRate)\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ä¸‹ä¸€å€‹æœ€å„ªç›®æ¨™å»ºè­°\r\n   */\r\n  getNextBestAction(): { goalType: GoalType; reason: string } | null {\r\n    const tasks = this.taskService.tasks();\r\n    const activeTasks = tasks.filter(t => t.status === 'running');\r\n    \r\n    // å¦‚æœæ²’æœ‰æ´»èºä»»å‹™ï¼Œå»ºè­°é–‹å§‹\r\n    if (activeTasks.length === 0) {\r\n      const analysis = this._analysis();\r\n      if (analysis && analysis.topConfigs.length > 0) {\r\n        const best = analysis.topConfigs[0];\r\n        return {\r\n          goalType: best.goalType,\r\n          reason: `æ‚¨çš„ã€Œ${GOAL_TYPE_CONFIG[best.goalType].label}ã€ä»»å‹™æ­·å²è¡¨ç¾æœ€ä½³`\r\n        };\r\n      }\r\n      return {\r\n        goalType: 'conversion',\r\n        reason: 'é–‹å§‹ä¸€å€‹æ–°çš„è½‰åŒ–ä»»å‹™'\r\n      };\r\n    }\r\n    \r\n    // æª¢æŸ¥æ˜¯å¦æœ‰ç¼ºå¤±çš„ç›®æ¨™é¡å‹\r\n    const activeGoals = new Set(activeTasks.map(t => t.goalType));\r\n    const missingGoals: GoalType[] = ['conversion', 'retention', 'engagement', 'support']\r\n      .filter(g => !activeGoals.has(g as GoalType)) as GoalType[];\r\n    \r\n    if (missingGoals.length > 0) {\r\n      // æ¨è–¦æ­·å²è¡¨ç¾æœ€å¥½çš„ç¼ºå¤±ç›®æ¨™\r\n      const analysis = this._analysis();\r\n      if (analysis) {\r\n        const bestMissing = missingGoals\r\n          .filter(g => analysis.byGoal[g]?.count > 0)\r\n          .sort((a, b) => analysis.byGoal[b].avgConversionRate - analysis.byGoal[a].avgConversionRate)[0];\r\n        \r\n        if (bestMissing) {\r\n          return {\r\n            goalType: bestMissing,\r\n            reason: `è£œå……ä¸€å€‹ã€Œ${GOAL_TYPE_CONFIG[bestMissing].label}ã€ä»»å‹™ä»¥è¦†è“‹æ›´å¤šå ´æ™¯`\r\n          };\r\n        }\r\n      }\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  // è¼”åŠ©æ–¹æ³•\r\n  private getModeLabel(mode: ExecutionMode): string {\r\n    const labels: Record<ExecutionMode, string> = {\r\n      'scripted': 'åŠ‡æœ¬æ¨¡å¼',\r\n      'hybrid': 'æ··åˆæ¨¡å¼',\r\n      'scriptless': 'ç„¡åŠ‡æœ¬æ¨¡å¼'\r\n    };\r\n    return labels[mode];\r\n  }\r\n}\r\n","/**\r\n * åŸ·è¡Œæ—¥èªŒæœå‹™\r\n * Execution Log Service\r\n * \r\n * ğŸ†• å‰ç«¯å„ªåŒ–: å¯¦æ™‚åŸ·è¡Œæ—¥èªŒ\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - æ”¶é›†å’Œç®¡ç†ä»»å‹™åŸ·è¡Œæ—¥èªŒ\r\n * - å¯¦æ™‚æ›´æ–°\r\n * - æ—¥èªŒéæ¿¾å’Œæœç´¢\r\n * - æ—¥èªŒå°å‡º\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\n\r\n// æ—¥èªŒç´šåˆ¥\r\nexport type ExecutionLogLevel = 'debug' | 'info' | 'success' | 'warning' | 'error';\r\n\r\n// æ—¥èªŒæ¢ç›®\r\nexport interface ExecutionLog {\r\n  id: string;\r\n  taskId: string;\r\n  taskName?: string;\r\n  level: ExecutionLogLevel;\r\n  category: string;\r\n  message: string;\r\n  details?: any;\r\n  timestamp: string;\r\n}\r\n\r\n// æ—¥èªŒéæ¿¾å™¨\r\nexport interface LogFilter {\r\n  taskId?: string;\r\n  level?: ExecutionLogLevel;\r\n  category?: string;\r\n  search?: string;\r\n  startTime?: string;\r\n  endTime?: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExecutionLogService {\r\n  private ipc = inject(ElectronIpcService);\r\n  \r\n  // æ—¥èªŒå­˜å„²\r\n  private _logs = signal<ExecutionLog[]>([]);\r\n  logs = this._logs.asReadonly();\r\n  \r\n  // æ˜¯å¦å¯¦æ™‚æ›´æ–°\r\n  private _isLive = signal(true);\r\n  isLive = this._isLive.asReadonly();\r\n  \r\n  // éæ¿¾å™¨\r\n  private _filter = signal<LogFilter>({});\r\n  filter = this._filter.asReadonly();\r\n  \r\n  // æœ€å¤§æ—¥èªŒæ•¸é‡\r\n  private readonly MAX_LOGS = 1000;\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  filteredLogs = computed(() => {\r\n    const logs = this._logs();\r\n    const filter = this._filter();\r\n    \r\n    return logs.filter(log => {\r\n      if (filter.taskId && log.taskId !== filter.taskId) return false;\r\n      if (filter.level && log.level !== filter.level) return false;\r\n      if (filter.category && log.category !== filter.category) return false;\r\n      if (filter.search) {\r\n        const search = filter.search.toLowerCase();\r\n        if (!log.message.toLowerCase().includes(search) &&\r\n            !log.category.toLowerCase().includes(search)) {\r\n          return false;\r\n        }\r\n      }\r\n      if (filter.startTime && log.timestamp < filter.startTime) return false;\r\n      if (filter.endTime && log.timestamp > filter.endTime) return false;\r\n      \r\n      return true;\r\n    });\r\n  });\r\n  \r\n  // æŒ‰ä»»å‹™åˆ†çµ„\r\n  logsByTask = computed(() => {\r\n    const logs = this._logs();\r\n    const grouped = new Map<string, ExecutionLog[]>();\r\n    \r\n    logs.forEach(log => {\r\n      if (!grouped.has(log.taskId)) {\r\n        grouped.set(log.taskId, []);\r\n      }\r\n      grouped.get(log.taskId)!.push(log);\r\n    });\r\n    \r\n    return grouped;\r\n  });\r\n  \r\n  // çµ±è¨ˆ\r\n  stats = computed(() => {\r\n    const logs = this._logs();\r\n    return {\r\n      total: logs.length,\r\n      debug: logs.filter(l => l.level === 'debug').length,\r\n      info: logs.filter(l => l.level === 'info').length,\r\n      success: logs.filter(l => l.level === 'success').length,\r\n      warning: logs.filter(l => l.level === 'warning').length,\r\n      error: logs.filter(l => l.level === 'error').length\r\n    };\r\n  });\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½® IPC ç›£è½å™¨\r\n   */\r\n  private setupIpcListeners(): void {\r\n    // ç›£è½å¾Œç«¯æ—¥èªŒ\r\n    this.ipc.on('execution-log', (log: ExecutionLog) => {\r\n      if (this._isLive()) {\r\n        this.addLog(log);\r\n      }\r\n    });\r\n    \r\n    // æ‰¹é‡æ—¥èªŒ\r\n    this.ipc.on('execution-logs-batch', (logs: ExecutionLog[]) => {\r\n      if (this._isLive()) {\r\n        logs.forEach(log => this.addLog(log));\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æ·»åŠ æ—¥èªŒ\r\n   */\r\n  addLog(log: Omit<ExecutionLog, 'id' | 'timestamp'>): void {\r\n    const newLog: ExecutionLog = {\r\n      ...log,\r\n      id: `log-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n    \r\n    this._logs.update(logs => {\r\n      const updated = [newLog, ...logs];\r\n      // é™åˆ¶æ—¥èªŒæ•¸é‡\r\n      if (updated.length > this.MAX_LOGS) {\r\n        return updated.slice(0, this.MAX_LOGS);\r\n      }\r\n      return updated;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„èª¿è©¦æ—¥èªŒ\r\n   */\r\n  debug(taskId: string, category: string, message: string, details?: any): void {\r\n    this.addLog({ taskId, level: 'debug', category, message, details });\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„ä¿¡æ¯æ—¥èªŒ\r\n   */\r\n  info(taskId: string, category: string, message: string, details?: any): void {\r\n    this.addLog({ taskId, level: 'info', category, message, details });\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„æˆåŠŸæ—¥èªŒ\r\n   */\r\n  success(taskId: string, category: string, message: string, details?: any): void {\r\n    this.addLog({ taskId, level: 'success', category, message, details });\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„è­¦å‘Šæ—¥èªŒ\r\n   */\r\n  warning(taskId: string, category: string, message: string, details?: any): void {\r\n    this.addLog({ taskId, level: 'warning', category, message, details });\r\n  }\r\n  \r\n  /**\r\n   * è¨˜éŒ„éŒ¯èª¤æ—¥èªŒ\r\n   */\r\n  error(taskId: string, category: string, message: string, details?: any): void {\r\n    this.addLog({ taskId, level: 'error', category, message, details });\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®éæ¿¾å™¨\r\n   */\r\n  setFilter(filter: LogFilter): void {\r\n    this._filter.set(filter);\r\n  }\r\n  \r\n  /**\r\n   * æ›´æ–°éæ¿¾å™¨\r\n   */\r\n  updateFilter(updates: Partial<LogFilter>): void {\r\n    this._filter.update(f => ({ ...f, ...updates }));\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤éæ¿¾å™¨\r\n   */\r\n  clearFilter(): void {\r\n    this._filter.set({});\r\n  }\r\n  \r\n  /**\r\n   * åˆ‡æ›å¯¦æ™‚æ›´æ–°\r\n   */\r\n  toggleLive(): void {\r\n    this._isLive.update(v => !v);\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®å¯¦æ™‚æ›´æ–°\r\n   */\r\n  setLive(live: boolean): void {\r\n    this._isLive.set(live);\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤æ—¥èªŒ\r\n   */\r\n  clearLogs(): void {\r\n    this._logs.set([]);\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤ç‰¹å®šä»»å‹™çš„æ—¥èªŒ\r\n   */\r\n  clearTaskLogs(taskId: string): void {\r\n    this._logs.update(logs => logs.filter(l => l.taskId !== taskId));\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ç‰¹å®šä»»å‹™çš„æ—¥èªŒ\r\n   */\r\n  getTaskLogs(taskId: string): ExecutionLog[] {\r\n    return this._logs().filter(l => l.taskId === taskId);\r\n  }\r\n  \r\n  /**\r\n   * å°å‡ºæ—¥èªŒ\r\n   */\r\n  exportLogs(format: 'json' | 'csv' = 'json'): void {\r\n    const logs = this.filteredLogs();\r\n    \r\n    let content: string;\r\n    let filename: string;\r\n    let mimeType: string;\r\n    \r\n    if (format === 'json') {\r\n      content = JSON.stringify(logs, null, 2);\r\n      filename = `execution-logs-${new Date().toISOString().split('T')[0]}.json`;\r\n      mimeType = 'application/json';\r\n    } else {\r\n      // CSV æ ¼å¼\r\n      const headers = ['æ™‚é–“', 'ä»»å‹™ID', 'ç´šåˆ¥', 'é¡åˆ¥', 'æ¶ˆæ¯'];\r\n      const rows = logs.map(l => [\r\n        l.timestamp,\r\n        l.taskId,\r\n        l.level,\r\n        l.category,\r\n        `\"${l.message.replace(/\"/g, '\"\"')}\"`\r\n      ].join(','));\r\n      \r\n      content = [headers.join(','), ...rows].join('\\n');\r\n      filename = `execution-logs-${new Date().toISOString().split('T')[0]}.csv`;\r\n      mimeType = 'text/csv';\r\n    }\r\n    \r\n    const blob = new Blob([content], { type: mimeType });\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    a.click();\r\n    \r\n    URL.revokeObjectURL(url);\r\n  }\r\n}\r\n","/**\r\n * API å®¢æˆ¶ç«¯æœå‹™\r\n * API Client Service\r\n * \r\n * ğŸ†• æ•¸æ“šå„ªåŒ–: å¾Œç«¯ API å°æ¥å±¤å®Œå–„\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - çµ±ä¸€ HTTP è«‹æ±‚è™•ç†\r\n * - è«‹æ±‚æ””æˆªå’ŒéŸ¿æ‡‰è™•ç†\r\n * - éŒ¯èª¤çµ±ä¸€è™•ç†\r\n * - è«‹æ±‚ç·©å­˜\r\n * - é‡è©¦æ©Ÿåˆ¶\r\n */\r\n\r\nimport { Injectable, inject, signal } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// API éŸ¿æ‡‰é¡å‹\r\nexport interface ApiResponse<T> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: {\r\n    code: string;\r\n    message: string;\r\n    details?: any;\r\n  };\r\n  meta?: {\r\n    page?: number;\r\n    pageSize?: number;\r\n    total?: number;\r\n    timestamp?: string;\r\n  };\r\n}\r\n\r\n// è«‹æ±‚é…ç½®\r\nexport interface RequestConfig {\r\n  timeout?: number;\r\n  retries?: number;\r\n  retryDelay?: number;\r\n  cache?: boolean;\r\n  cacheDuration?: number;\r\n  showError?: boolean;\r\n  showLoading?: boolean;\r\n}\r\n\r\n// ç·©å­˜é …\r\ninterface CacheItem<T> {\r\n  data: T;\r\n  timestamp: number;\r\n  duration: number;\r\n}\r\n\r\n// é»˜èªé…ç½®\r\nconst DEFAULT_CONFIG: RequestConfig = {\r\n  timeout: 30000,\r\n  retries: 3,\r\n  retryDelay: 1000,\r\n  cache: false,\r\n  cacheDuration: 60000,\r\n  showError: true,\r\n  showLoading: false\r\n};\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ApiClientService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ç‹€æ…‹\r\n  private _isLoading = signal(false);\r\n  isLoading = this._isLoading.asReadonly();\r\n  \r\n  private _pendingRequests = signal(0);\r\n  pendingRequests = this._pendingRequests.asReadonly();\r\n  \r\n  // ç·©å­˜\r\n  private cache = new Map<string, CacheItem<any>>();\r\n  \r\n  // è«‹æ±‚éšŠåˆ—ï¼ˆç”¨æ–¼å»é‡ï¼‰\r\n  private pendingPromises = new Map<string, Promise<any>>();\r\n  \r\n  /**\r\n   * ç™¼é€ API è«‹æ±‚ï¼ˆé€šé IPCï¼‰\r\n   */\r\n  async request<T>(\r\n    channel: string,\r\n    data?: any,\r\n    config: RequestConfig = {}\r\n  ): Promise<ApiResponse<T>> {\r\n    const cfg = { ...DEFAULT_CONFIG, ...config };\r\n    const cacheKey = `${channel}:${JSON.stringify(data)}`;\r\n    \r\n    // æª¢æŸ¥ç·©å­˜\r\n    if (cfg.cache) {\r\n      const cached = this.getFromCache<T>(cacheKey);\r\n      if (cached) {\r\n        return { success: true, data: cached };\r\n      }\r\n    }\r\n    \r\n    // å»é‡ï¼šå¦‚æœæœ‰ç›¸åŒçš„è«‹æ±‚æ­£åœ¨é€²è¡Œï¼Œè¿”å›åŒä¸€å€‹ Promise\r\n    if (this.pendingPromises.has(cacheKey)) {\r\n      return this.pendingPromises.get(cacheKey)!;\r\n    }\r\n    \r\n    // å‰µå»ºè«‹æ±‚\r\n    const requestPromise = this.executeRequest<T>(channel, data, cfg, cacheKey);\r\n    this.pendingPromises.set(cacheKey, requestPromise);\r\n    \r\n    try {\r\n      const result = await requestPromise;\r\n      return result;\r\n    } finally {\r\n      this.pendingPromises.delete(cacheKey);\r\n    }\r\n  }\r\n  \r\n  private async executeRequest<T>(\r\n    channel: string,\r\n    data: any,\r\n    config: RequestConfig,\r\n    cacheKey: string\r\n  ): Promise<ApiResponse<T>> {\r\n    this._pendingRequests.update(n => n + 1);\r\n    if (config.showLoading) {\r\n      this._isLoading.set(true);\r\n    }\r\n    \r\n    let lastError: any;\r\n    \r\n    for (let attempt = 0; attempt <= config.retries!; attempt++) {\r\n      try {\r\n        const result = await this.sendIpcRequest<T>(channel, data, config.timeout!);\r\n        \r\n        // æˆåŠŸæ™‚ç·©å­˜çµæœ\r\n        if (result.success && config.cache) {\r\n          this.setCache(cacheKey, result.data, config.cacheDuration!);\r\n        }\r\n        \r\n        return result;\r\n      } catch (error: any) {\r\n        lastError = error;\r\n        \r\n        // æœ€å¾Œä¸€æ¬¡å˜—è©¦ä¸ç­‰å¾…\r\n        if (attempt < config.retries!) {\r\n          await this.delay(config.retryDelay! * (attempt + 1));\r\n        }\r\n      }\r\n    }\r\n    \r\n    // æ‰€æœ‰é‡è©¦éƒ½å¤±æ•—\r\n    const errorResponse: ApiResponse<T> = {\r\n      success: false,\r\n      error: {\r\n        code: 'REQUEST_FAILED',\r\n        message: lastError?.message || 'è«‹æ±‚å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦',\r\n        details: lastError\r\n      }\r\n    };\r\n    \r\n    if (config.showError) {\r\n      this.toast.error(errorResponse.error!.message);\r\n    }\r\n    \r\n    return errorResponse;\r\n  }\r\n  \r\n  private sendIpcRequest<T>(\r\n    channel: string,\r\n    data: any,\r\n    timeout: number\r\n  ): Promise<ApiResponse<T>> {\r\n    return new Promise((resolve, reject) => {\r\n      const timeoutId = setTimeout(() => {\r\n        reject(new Error('è«‹æ±‚è¶…æ™‚'));\r\n      }, timeout);\r\n      \r\n      this.ipc.invoke(channel, data)\r\n        .then((result: any) => {\r\n          clearTimeout(timeoutId);\r\n          \r\n          // æ¨™æº–åŒ–éŸ¿æ‡‰\r\n          if (typeof result === 'object' && 'success' in result) {\r\n            resolve(result as ApiResponse<T>);\r\n          } else {\r\n            resolve({ success: true, data: result as T });\r\n          }\r\n        })\r\n        .catch((error: any) => {\r\n          clearTimeout(timeoutId);\r\n          reject(error);\r\n        })\r\n        .finally(() => {\r\n          this._pendingRequests.update(n => Math.max(0, n - 1));\r\n          if (this._pendingRequests() === 0) {\r\n            this._isLoading.set(false);\r\n          }\r\n        });\r\n    });\r\n  }\r\n  \r\n  // ============ ç·©å­˜ç®¡ç† ============\r\n  \r\n  private getFromCache<T>(key: string): T | null {\r\n    const item = this.cache.get(key);\r\n    if (!item) return null;\r\n    \r\n    const now = Date.now();\r\n    if (now - item.timestamp > item.duration) {\r\n      this.cache.delete(key);\r\n      return null;\r\n    }\r\n    \r\n    return item.data as T;\r\n  }\r\n  \r\n  private setCache<T>(key: string, data: T, duration: number): void {\r\n    this.cache.set(key, {\r\n      data,\r\n      timestamp: Date.now(),\r\n      duration\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤ç·©å­˜\r\n   */\r\n  clearCache(pattern?: string): void {\r\n    if (!pattern) {\r\n      this.cache.clear();\r\n      return;\r\n    }\r\n    \r\n    const regex = new RegExp(pattern);\r\n    for (const key of this.cache.keys()) {\r\n      if (regex.test(key)) {\r\n        this.cache.delete(key);\r\n      }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * é åŠ è¼‰æ•¸æ“š\r\n   */\r\n  async preload<T>(channel: string, data?: any): Promise<void> {\r\n    await this.request<T>(channel, data, { cache: true, showError: false });\r\n  }\r\n  \r\n  // ============ ä¾¿æ·æ–¹æ³• ============\r\n  \r\n  /**\r\n   * GET é¢¨æ ¼è«‹æ±‚\r\n   */\r\n  async get<T>(channel: string, params?: any, config?: RequestConfig): Promise<ApiResponse<T>> {\r\n    return this.request<T>(channel, { action: 'get', ...params }, {\r\n      cache: true,\r\n      ...config\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * POST é¢¨æ ¼è«‹æ±‚\r\n   */\r\n  async post<T>(channel: string, data?: any, config?: RequestConfig): Promise<ApiResponse<T>> {\r\n    return this.request<T>(channel, { action: 'create', ...data }, {\r\n      cache: false,\r\n      ...config\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * PUT é¢¨æ ¼è«‹æ±‚\r\n   */\r\n  async put<T>(channel: string, data?: any, config?: RequestConfig): Promise<ApiResponse<T>> {\r\n    return this.request<T>(channel, { action: 'update', ...data }, {\r\n      cache: false,\r\n      ...config\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * DELETE é¢¨æ ¼è«‹æ±‚\r\n   */\r\n  async delete<T>(channel: string, params?: any, config?: RequestConfig): Promise<ApiResponse<T>> {\r\n    return this.request<T>(channel, { action: 'delete', ...params }, {\r\n      cache: false,\r\n      ...config\r\n    });\r\n  }\r\n  \r\n  // ============ å·¥å…·æ–¹æ³• ============\r\n  \r\n  private delay(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n}\r\n","/**\r\n * å¯¦æ™‚æ•¸æ“šæœå‹™\r\n * Realtime Service\r\n * \r\n * ğŸ†• æ•¸æ“šå„ªåŒ–: WebSocket å¯¦æ™‚æ›´æ–°\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - WebSocket é€£æ¥ç®¡ç†\r\n * - å¯¦æ™‚æ•¸æ“šè¨‚é–±\r\n * - è‡ªå‹•é‡é€£\r\n * - å¿ƒè·³æª¢æ¸¬\r\n */\r\n\r\nimport { Injectable, inject, signal, computed, OnDestroy } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// é€£æ¥ç‹€æ…‹\r\nexport type RealtimeConnectionState = 'disconnected' | 'connecting' | 'connected' | 'reconnecting';\r\n\r\n// è¨‚é–±é¡å‹\r\nexport type SubscriptionType = \r\n  | 'task:status'      // ä»»å‹™ç‹€æ…‹æ›´æ–°\r\n  | 'task:stats'       // ä»»å‹™çµ±è¨ˆæ›´æ–°\r\n  | 'task:log'         // ä»»å‹™æ—¥èªŒ\r\n  | 'message:new'      // æ–°æ¶ˆæ¯\r\n  | 'message:status'   // æ¶ˆæ¯ç‹€æ…‹\r\n  | 'contact:update'   // è¯ç¹«äººæ›´æ–°\r\n  | 'system:status';   // ç³»çµ±ç‹€æ…‹\r\n\r\n// è¨‚é–±é¸é …\r\nexport interface SubscriptionOptions {\r\n  filter?: Record<string, any>;\r\n  throttle?: number;\r\n}\r\n\r\n// è¨‚é–±å›èª¿\r\nexport type SubscriptionCallback<T = any> = (data: T) => void;\r\n\r\n// è¨‚é–±è¨˜éŒ„\r\ninterface Subscription {\r\n  id: string;\r\n  type: SubscriptionType;\r\n  callback: SubscriptionCallback;\r\n  options?: SubscriptionOptions;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RealtimeService implements OnDestroy {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // é€£æ¥ç‹€æ…‹\r\n  private _state = signal<RealtimeConnectionState>('disconnected');\r\n  state = this._state.asReadonly();\r\n  \r\n  isConnected = computed(() => this._state() === 'connected');\r\n  \r\n  // é‡é€£è¨ˆæ•¸\r\n  private _reconnectAttempts = signal(0);\r\n  reconnectAttempts = this._reconnectAttempts.asReadonly();\r\n  \r\n  // æœ€å¾Œå¿ƒè·³æ™‚é–“\r\n  private _lastHeartbeat = signal<Date | null>(null);\r\n  lastHeartbeat = this._lastHeartbeat.asReadonly();\r\n  \r\n  // è¨‚é–±åˆ—è¡¨\r\n  private subscriptions = new Map<string, Subscription>();\r\n  \r\n  // å®šæ™‚å™¨\r\n  private heartbeatInterval?: ReturnType<typeof setInterval>;\r\n  private reconnectTimeout?: ReturnType<typeof setTimeout>;\r\n  \r\n  // é…ç½®\r\n  private readonly HEARTBEAT_INTERVAL = 30000; // 30ç§’\r\n  private readonly RECONNECT_DELAY = 5000;     // 5ç§’\r\n  private readonly MAX_RECONNECT_ATTEMPTS = 10;\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n    this.connect();\r\n  }\r\n  \r\n  ngOnDestroy(): void {\r\n    this.disconnect();\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½® IPC ç›£è¯å™¨\r\n   */\r\n  private setupIpcListeners(): void {\r\n    // æ¥æ”¶å¯¦æ™‚æ•¸æ“š\r\n    this.ipc.on('realtime:data', (payload: { type: SubscriptionType; data: any }) => {\r\n      this.handleRealtimeData(payload.type, payload.data);\r\n    });\r\n    \r\n    // é€£æ¥ç‹€æ…‹è®ŠåŒ–\r\n    this.ipc.on('realtime:state', (state: RealtimeConnectionState) => {\r\n      this._state.set(state);\r\n      \r\n      if (state === 'connected') {\r\n        this._reconnectAttempts.set(0);\r\n        this.startHeartbeat();\r\n        this.resubscribeAll();\r\n      } else if (state === 'disconnected') {\r\n        this.stopHeartbeat();\r\n        this.scheduleReconnect();\r\n      }\r\n    });\r\n    \r\n    // å¿ƒè·³éŸ¿æ‡‰\r\n    this.ipc.on('realtime:heartbeat', () => {\r\n      this._lastHeartbeat.set(new Date());\r\n    });\r\n    \r\n    // éŒ¯èª¤è™•ç†\r\n    this.ipc.on('realtime:error', (error: { code: string; message: string }) => {\r\n      console.error('Realtime error:', error);\r\n      if (error.code === 'AUTH_FAILED') {\r\n        this.toast.error('å¯¦æ™‚é€£æ¥èªè­‰å¤±æ•—');\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * é€£æ¥\r\n   */\r\n  connect(): void {\r\n    if (this._state() === 'connecting' || this._state() === 'connected') {\r\n      return;\r\n    }\r\n    \r\n    this._state.set('connecting');\r\n    this.ipc.send('realtime:connect', {});\r\n  }\r\n  \r\n  /**\r\n   * æ–·é–‹é€£æ¥\r\n   */\r\n  disconnect(): void {\r\n    this.stopHeartbeat();\r\n    this.clearReconnectTimeout();\r\n    this.ipc.send('realtime:disconnect', {});\r\n    this._state.set('disconnected');\r\n  }\r\n  \r\n  /**\r\n   * è¨‚é–±æ•¸æ“š\r\n   */\r\n  subscribe<T>(\r\n    type: SubscriptionType,\r\n    callback: SubscriptionCallback<T>,\r\n    options?: SubscriptionOptions\r\n  ): string {\r\n    const id = `sub-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    \r\n    const subscription: Subscription = {\r\n      id,\r\n      type,\r\n      callback: callback as SubscriptionCallback,\r\n      options\r\n    };\r\n    \r\n    this.subscriptions.set(id, subscription);\r\n    \r\n    // å¦‚æœå·²é€£æ¥ï¼Œç«‹å³ç™¼é€è¨‚é–±è«‹æ±‚\r\n    if (this.isConnected()) {\r\n      this.sendSubscription(subscription);\r\n    }\r\n    \r\n    return id;\r\n  }\r\n  \r\n  /**\r\n   * å–æ¶ˆè¨‚é–±\r\n   */\r\n  unsubscribe(subscriptionId: string): void {\r\n    const subscription = this.subscriptions.get(subscriptionId);\r\n    if (!subscription) return;\r\n    \r\n    this.subscriptions.delete(subscriptionId);\r\n    \r\n    if (this.isConnected()) {\r\n      this.ipc.send('realtime:unsubscribe', { \r\n        id: subscriptionId,\r\n        type: subscription.type \r\n      });\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * å–æ¶ˆæ‰€æœ‰è¨‚é–±\r\n   */\r\n  unsubscribeAll(): void {\r\n    for (const id of this.subscriptions.keys()) {\r\n      this.unsubscribe(id);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ç™¼é€è¨‚é–±è«‹æ±‚\r\n   */\r\n  private sendSubscription(subscription: Subscription): void {\r\n    this.ipc.send('realtime:subscribe', {\r\n      id: subscription.id,\r\n      type: subscription.type,\r\n      filter: subscription.options?.filter\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * é‡æ–°è¨‚é–±æ‰€æœ‰\r\n   */\r\n  private resubscribeAll(): void {\r\n    for (const subscription of this.subscriptions.values()) {\r\n      this.sendSubscription(subscription);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * è™•ç†å¯¦æ™‚æ•¸æ“š\r\n   */\r\n  private handleRealtimeData(type: SubscriptionType, data: any): void {\r\n    for (const subscription of this.subscriptions.values()) {\r\n      if (subscription.type === type) {\r\n        // æ‡‰ç”¨éæ¿¾å™¨\r\n        if (subscription.options?.filter) {\r\n          const filter = subscription.options.filter;\r\n          let matches = true;\r\n          \r\n          for (const [key, value] of Object.entries(filter)) {\r\n            if (data[key] !== value) {\r\n              matches = false;\r\n              break;\r\n            }\r\n          }\r\n          \r\n          if (!matches) continue;\r\n        }\r\n        \r\n        // èª¿ç”¨å›èª¿\r\n        try {\r\n          subscription.callback(data);\r\n        } catch (error) {\r\n          console.error('Subscription callback error:', error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * é–‹å§‹å¿ƒè·³\r\n   */\r\n  private startHeartbeat(): void {\r\n    this.stopHeartbeat();\r\n    \r\n    this.heartbeatInterval = setInterval(() => {\r\n      if (this.isConnected()) {\r\n        this.ipc.send('realtime:heartbeat', {});\r\n      }\r\n    }, this.HEARTBEAT_INTERVAL);\r\n  }\r\n  \r\n  /**\r\n   * åœæ­¢å¿ƒè·³\r\n   */\r\n  private stopHeartbeat(): void {\r\n    if (this.heartbeatInterval) {\r\n      clearInterval(this.heartbeatInterval);\r\n      this.heartbeatInterval = undefined;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * å®‰æ’é‡é€£\r\n   */\r\n  private scheduleReconnect(): void {\r\n    if (this._reconnectAttempts() >= this.MAX_RECONNECT_ATTEMPTS) {\r\n      this.toast.error('ç„¡æ³•å»ºç«‹å¯¦æ™‚é€£æ¥ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡');\r\n      return;\r\n    }\r\n    \r\n    this.clearReconnectTimeout();\r\n    \r\n    const delay = this.RECONNECT_DELAY * Math.pow(1.5, this._reconnectAttempts());\r\n    \r\n    this.reconnectTimeout = setTimeout(() => {\r\n      this._reconnectAttempts.update(n => n + 1);\r\n      this._state.set('reconnecting');\r\n      this.connect();\r\n    }, delay);\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤é‡é€£å®šæ™‚å™¨\r\n   */\r\n  private clearReconnectTimeout(): void {\r\n    if (this.reconnectTimeout) {\r\n      clearTimeout(this.reconnectTimeout);\r\n      this.reconnectTimeout = undefined;\r\n    }\r\n  }\r\n  \r\n  // ============ ä¾¿æ·è¨‚é–±æ–¹æ³• ============\r\n  \r\n  /**\r\n   * è¨‚é–±ä»»å‹™ç‹€æ…‹\r\n   */\r\n  subscribeTaskStatus(taskId: string, callback: SubscriptionCallback): string {\r\n    return this.subscribe('task:status', callback, { filter: { taskId } });\r\n  }\r\n  \r\n  /**\r\n   * è¨‚é–±ä»»å‹™çµ±è¨ˆ\r\n   */\r\n  subscribeTaskStats(taskId: string, callback: SubscriptionCallback): string {\r\n    return this.subscribe('task:stats', callback, { filter: { taskId } });\r\n  }\r\n  \r\n  /**\r\n   * è¨‚é–±ä»»å‹™æ—¥èªŒ\r\n   */\r\n  subscribeTaskLogs(taskId: string, callback: SubscriptionCallback): string {\r\n    return this.subscribe('task:log', callback, { filter: { taskId } });\r\n  }\r\n  \r\n  /**\r\n   * è¨‚é–±æ‰€æœ‰ä»»å‹™æ—¥èªŒ\r\n   */\r\n  subscribeAllTaskLogs(callback: SubscriptionCallback): string {\r\n    return this.subscribe('task:log', callback);\r\n  }\r\n  \r\n  /**\r\n   * è¨‚é–±æ–°æ¶ˆæ¯\r\n   */\r\n  subscribeNewMessages(callback: SubscriptionCallback): string {\r\n    return this.subscribe('message:new', callback);\r\n  }\r\n  \r\n  /**\r\n   * è¨‚é–±ç³»çµ±ç‹€æ…‹\r\n   */\r\n  subscribeSystemStatus(callback: SubscriptionCallback): string {\r\n    return this.subscribe('system:status', callback);\r\n  }\r\n}\r\n","/**\r\n * AI è©±è¡“ç”Ÿæˆæœå‹™\r\n * AI Copywriting Service\r\n * \r\n * ğŸ†• AIå„ªåŒ–: æ™ºèƒ½è©±è¡“ç”Ÿæˆ\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - é–‹å ´ç™½ç”Ÿæˆ\r\n * - å›è¦†å»ºè­°\r\n * - è©±è¡“å„ªåŒ–\r\n * - å¤šé¢¨æ ¼æ”¯æŒ\r\n */\r\n\r\nimport { Injectable, inject, signal, computed } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { AICenterService } from '../ai-center/ai-center.service';\r\n\r\n// ç”Ÿæˆé¡å‹\r\nexport type CopywritingType = \r\n  | 'greeting'         // é–‹å ´ç™½\r\n  | 'reply'            // å›è¦†\r\n  | 'follow_up'        // è·Ÿé€²\r\n  | 'objection'        // ç•°è­°è™•ç†\r\n  | 'closing'          // ä¿ƒæˆæˆäº¤\r\n  | 'retention';       // æŒ½å›\r\n\r\n// è©±è¡“é¢¨æ ¼\r\nexport type CopywritingStyle = \r\n  | 'professional'     // å°ˆæ¥­æ­£å¼\r\n  | 'friendly'         // è¦ªåˆ‡å‹å¥½\r\n  | 'casual'           // è¼•é¬†éš¨æ„\r\n  | 'urgent'           // ç·Šè¿«æ„Ÿ\r\n  | 'empathetic';      // åŒç†å¿ƒ\r\n\r\n// ç”Ÿæˆè«‹æ±‚\r\nexport interface CopywritingRequest {\r\n  type: CopywritingType;\r\n  style?: CopywritingStyle;\r\n  context?: {\r\n    productName?: string;\r\n    customerName?: string;\r\n    previousMessages?: string[];\r\n    objection?: string;\r\n    goal?: string;\r\n  };\r\n  options?: {\r\n    count?: number;        // ç”Ÿæˆæ•¸é‡\r\n    maxLength?: number;    // æœ€å¤§é•·åº¦\r\n    includeEmoji?: boolean;\r\n    language?: 'zh-TW' | 'zh-CN' | 'en';\r\n  };\r\n}\r\n\r\n// ç”Ÿæˆçµæœ\r\nexport interface CopywritingResult {\r\n  id: string;\r\n  text: string;\r\n  type: CopywritingType;\r\n  style: CopywritingStyle;\r\n  score: number;          // è³ªé‡è©•åˆ†\r\n  tags: string[];\r\n  createdAt: string;\r\n}\r\n\r\n// æ¨¡æ¿\r\nexport interface CopywritingTemplate {\r\n  id: string;\r\n  name: string;\r\n  type: CopywritingType;\r\n  style: CopywritingStyle;\r\n  template: string;\r\n  variables: string[];\r\n  examples: string[];\r\n  isSystem: boolean;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AICopywritingService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private aiService = inject(AICenterService);\r\n  \r\n  // ç‹€æ…‹\r\n  private _isGenerating = signal(false);\r\n  isGenerating = this._isGenerating.asReadonly();\r\n  \r\n  private _recentResults = signal<CopywritingResult[]>([]);\r\n  recentResults = this._recentResults.asReadonly();\r\n  \r\n  private _savedTemplates = signal<CopywritingTemplate[]>([]);\r\n  savedTemplates = this._savedTemplates.asReadonly();\r\n  \r\n  // ç³»çµ±æ¨¡æ¿\r\n  private systemTemplates: CopywritingTemplate[] = [\r\n    {\r\n      id: 'sys-greeting-1',\r\n      name: 'å‹å¥½å•å€™',\r\n      type: 'greeting',\r\n      style: 'friendly',\r\n      template: 'å—¨ {customerName}ï¼æˆ‘æ˜¯{productName}çš„{role}ã€‚çœ‹åˆ°æ‚¨å°æˆ‘å€‘ç”¢å“æœ‰èˆˆè¶£ï¼Œæƒ³äº†è§£æ›´å¤šå—ï¼ŸğŸ˜Š',\r\n      variables: ['customerName', 'productName', 'role'],\r\n      examples: ['å—¨ ç‹å…ˆç”Ÿï¼æˆ‘æ˜¯æ™ºèƒ½è¡ŒéŠ·åŠ©æ‰‹çš„ç”¢å“é¡§å•ã€‚çœ‹åˆ°æ‚¨å°æˆ‘å€‘ç”¢å“æœ‰èˆˆè¶£ï¼Œæƒ³äº†è§£æ›´å¤šå—ï¼ŸğŸ˜Š'],\r\n      isSystem: true\r\n    },\r\n    {\r\n      id: 'sys-greeting-2',\r\n      name: 'å°ˆæ¥­é–‹å ´',\r\n      type: 'greeting',\r\n      style: 'professional',\r\n      template: 'æ‚¨å¥½ï¼Œ{customerName}ã€‚æˆ‘æ˜¯{company}çš„{role}ï¼Œå¾ˆé«˜èˆˆç‚ºæ‚¨æœå‹™ã€‚è«‹å•æœ‰ä»€éº¼å¯ä»¥å¹«åŠ©æ‚¨çš„å—ï¼Ÿ',\r\n      variables: ['customerName', 'company', 'role'],\r\n      examples: ['æ‚¨å¥½ï¼Œå¼µç¶“ç†ã€‚æˆ‘æ˜¯ABCå…¬å¸çš„æ¥­å‹™é¡§å•ï¼Œå¾ˆé«˜èˆˆç‚ºæ‚¨æœå‹™ã€‚è«‹å•æœ‰ä»€éº¼å¯ä»¥å¹«åŠ©æ‚¨çš„å—ï¼Ÿ'],\r\n      isSystem: true\r\n    },\r\n    {\r\n      id: 'sys-objection-1',\r\n      name: 'åƒ¹æ ¼ç•°è­°',\r\n      type: 'objection',\r\n      style: 'empathetic',\r\n      template: 'å®Œå…¨ç†è§£æ‚¨çš„è€ƒæ…®ï¼å¾ˆå¤šå®¢æˆ¶ä¸€é–‹å§‹ä¹Ÿæœ‰åŒæ¨£çš„æƒ³æ³•ã€‚ä¸éå¯¦éš›ä½¿ç”¨å¾Œï¼Œä»–å€‘ç™¼ç¾{benefit}ï¼ŒæŠ•è³‡å›å ±å…¶å¯¦å¾ˆå¯è§€ã€‚è¦ä¸æˆ‘åˆ†äº«å¹¾å€‹æˆåŠŸæ¡ˆä¾‹çµ¦æ‚¨çœ‹çœ‹ï¼Ÿ',\r\n      variables: ['benefit'],\r\n      examples: ['å®Œå…¨ç†è§£æ‚¨çš„è€ƒæ…®ï¼å¾ˆå¤šå®¢æˆ¶ä¸€é–‹å§‹ä¹Ÿæœ‰åŒæ¨£çš„æƒ³æ³•ã€‚ä¸éå¯¦éš›ä½¿ç”¨å¾Œï¼Œä»–å€‘ç™¼ç¾æ•ˆç‡æå‡äº†3å€ï¼ŒæŠ•è³‡å›å ±å…¶å¯¦å¾ˆå¯è§€ã€‚è¦ä¸æˆ‘åˆ†äº«å¹¾å€‹æˆåŠŸæ¡ˆä¾‹çµ¦æ‚¨çœ‹çœ‹ï¼Ÿ'],\r\n      isSystem: true\r\n    },\r\n    {\r\n      id: 'sys-closing-1',\r\n      name: 'é™æ™‚å„ªæƒ ',\r\n      type: 'closing',\r\n      style: 'urgent',\r\n      template: 'å°äº†ï¼Œç¾åœ¨æ­£å¥½æœ‰{promotion}æ´»å‹•ï¼Œ{deadline}æˆªæ­¢ï¼é€™å€‹æ™‚å€™å…¥æ‰‹çœŸçš„å¾ˆåˆ’ç®—ã€‚éœ€è¦æˆ‘å¹«æ‚¨é–å®šåé¡å—ï¼Ÿ',\r\n      variables: ['promotion', 'deadline'],\r\n      examples: ['å°äº†ï¼Œç¾åœ¨æ­£å¥½æœ‰å¹´çµ‚ç‰¹æƒ æ´»å‹•ï¼Œæœ¬æœˆåº•æˆªæ­¢ï¼é€™å€‹æ™‚å€™å…¥æ‰‹çœŸçš„å¾ˆåˆ’ç®—ã€‚éœ€è¦æˆ‘å¹«æ‚¨é–å®šåé¡å—ï¼Ÿ'],\r\n      isSystem: true\r\n    },\r\n    {\r\n      id: 'sys-followup-1',\r\n      name: 'æº«æŸ”è·Ÿé€²',\r\n      type: 'follow_up',\r\n      style: 'friendly',\r\n      template: 'å—¨ {customerName}ï¼Œå¥½ä¹…ä¸è¦‹ï¼ä¸Šæ¬¡èŠåˆ°{topic}ï¼Œä¸çŸ¥é“æ‚¨å¾Œä¾†è€ƒæ…®å¾—æ€éº¼æ¨£äº†ï¼Ÿæœ‰ä»»ä½•å•é¡Œéƒ½å¯ä»¥éš¨æ™‚å•æˆ‘å“¦ï½',\r\n      variables: ['customerName', 'topic'],\r\n      examples: ['å—¨ æå°å§ï¼Œå¥½ä¹…ä¸è¦‹ï¼ä¸Šæ¬¡èŠåˆ°å‡ç´šæ–¹æ¡ˆï¼Œä¸çŸ¥é“æ‚¨å¾Œä¾†è€ƒæ…®å¾—æ€éº¼æ¨£äº†ï¼Ÿæœ‰ä»»ä½•å•é¡Œéƒ½å¯ä»¥éš¨æ™‚å•æˆ‘å“¦ï½'],\r\n      isSystem: true\r\n    },\r\n    {\r\n      id: 'sys-retention-1',\r\n      name: 'æŒ½å›æµå¤±',\r\n      type: 'retention',\r\n      style: 'empathetic',\r\n      template: '{customerName}ï¼Œå¥½ä¹…æ²’çœ‹åˆ°æ‚¨äº†ï¼Œæœ‰é»æƒ³å¿µå‘¢ï¼æ˜¯ä¸æ˜¯æœ€è¿‘å¤ªå¿™äº†ï¼Ÿæˆ‘å€‘æœ€è¿‘æ¨å‡ºäº†{newFeature}ï¼Œè¦ºå¾—ç‰¹åˆ¥é©åˆæ‚¨ï¼Œè¦ä¸è¦ä¾†çœ‹çœ‹ï¼Ÿ',\r\n      variables: ['customerName', 'newFeature'],\r\n      examples: ['ç‹å…ˆç”Ÿï¼Œå¥½ä¹…æ²’çœ‹åˆ°æ‚¨äº†ï¼Œæœ‰é»æƒ³å¿µå‘¢ï¼æ˜¯ä¸æ˜¯æœ€è¿‘å¤ªå¿™äº†ï¼Ÿæˆ‘å€‘æœ€è¿‘æ¨å‡ºäº†æ™ºèƒ½å ±è¡¨åŠŸèƒ½ï¼Œè¦ºå¾—ç‰¹åˆ¥é©åˆæ‚¨ï¼Œè¦ä¸è¦ä¾†çœ‹çœ‹ï¼Ÿ'],\r\n      isSystem: true\r\n    }\r\n  ];\r\n  \r\n  constructor() {\r\n    this.loadSavedTemplates();\r\n  }\r\n  \r\n  /**\r\n   * ç”Ÿæˆè©±è¡“\r\n   */\r\n  async generate(request: CopywritingRequest): Promise<CopywritingResult[]> {\r\n    this._isGenerating.set(true);\r\n    \r\n    try {\r\n      const count = request.options?.count || 3;\r\n      const results: CopywritingResult[] = [];\r\n      \r\n      // æ§‹å»º prompt\r\n      const prompt = this.buildPrompt(request);\r\n      \r\n      // èª¿ç”¨ AI ç”Ÿæˆ\r\n      const response = await this.ipc.invoke('ai-generate-text', {\r\n        prompt,\r\n        maxTokens: request.options?.maxLength || 200,\r\n        count\r\n      });\r\n      \r\n      if (response.success && response.texts) {\r\n        for (const text of response.texts) {\r\n          const result: CopywritingResult = {\r\n            id: `copy-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n            text: this.postProcess(text, request),\r\n            type: request.type,\r\n            style: request.style || 'friendly',\r\n            score: this.evaluateQuality(text, request),\r\n            tags: this.extractTags(request),\r\n            createdAt: new Date().toISOString()\r\n          };\r\n          results.push(result);\r\n        }\r\n        \r\n        // ä¿å­˜åˆ°æœ€è¿‘çµæœ\r\n        this._recentResults.update(r => [...results, ...r].slice(0, 50));\r\n      } else {\r\n        // ä½¿ç”¨æ¨¡æ¿ä½œç‚ºå›é€€\r\n        const templates = this.getTemplatesForType(request.type);\r\n        for (const template of templates.slice(0, count)) {\r\n          const result: CopywritingResult = {\r\n            id: `copy-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n            text: this.applyTemplate(template, request.context || {}),\r\n            type: request.type,\r\n            style: template.style,\r\n            score: 70,\r\n            tags: ['æ¨¡æ¿'],\r\n            createdAt: new Date().toISOString()\r\n          };\r\n          results.push(result);\r\n        }\r\n      }\r\n      \r\n      return results;\r\n    } finally {\r\n      this._isGenerating.set(false);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * å„ªåŒ–ç¾æœ‰è©±è¡“\r\n   */\r\n  async optimize(text: string, style: CopywritingStyle): Promise<string> {\r\n    this._isGenerating.set(true);\r\n    \r\n    try {\r\n      const prompt = `è«‹å°‡ä»¥ä¸‹è©±è¡“å„ªåŒ–ç‚º${this.getStyleDescription(style)}é¢¨æ ¼ï¼Œä¿æŒåŸæ„ä½†æ›´æœ‰å¸å¼•åŠ›ï¼š\r\n\r\nåŸæ–‡ï¼š${text}\r\n\r\nå„ªåŒ–å¾Œï¼š`;\r\n      \r\n      const response = await this.ipc.invoke('ai-generate-text', {\r\n        prompt,\r\n        maxTokens: 300,\r\n        count: 1\r\n      });\r\n      \r\n      if (response.success && response.texts?.[0]) {\r\n        return response.texts[0];\r\n      }\r\n      \r\n      return text;\r\n    } finally {\r\n      this._isGenerating.set(false);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ç”Ÿæˆå›è¦†å»ºè­°\r\n   */\r\n  async suggestReply(\r\n    customerMessage: string,\r\n    context?: {\r\n      previousMessages?: string[];\r\n      customerInfo?: any;\r\n      productInfo?: any;\r\n    }\r\n  ): Promise<CopywritingResult[]> {\r\n    return this.generate({\r\n      type: 'reply',\r\n      style: 'friendly',\r\n      context: {\r\n        previousMessages: [customerMessage, ...(context?.previousMessages || [])]\r\n      },\r\n      options: {\r\n        count: 3\r\n      }\r\n    });\r\n  }\r\n  \r\n  // ============ æ¨¡æ¿ç®¡ç† ============\r\n  \r\n  /**\r\n   * ç²å–æ‰€æœ‰æ¨¡æ¿\r\n   */\r\n  getAllTemplates(): CopywritingTemplate[] {\r\n    return [...this.systemTemplates, ...this._savedTemplates()];\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ç‰¹å®šé¡å‹çš„æ¨¡æ¿\r\n   */\r\n  getTemplatesForType(type: CopywritingType): CopywritingTemplate[] {\r\n    return this.getAllTemplates().filter(t => t.type === type);\r\n  }\r\n  \r\n  /**\r\n   * ä¿å­˜è‡ªå®šç¾©æ¨¡æ¿\r\n   */\r\n  saveTemplate(template: Omit<CopywritingTemplate, 'id' | 'isSystem'>): void {\r\n    const newTemplate: CopywritingTemplate = {\r\n      ...template,\r\n      id: `tpl-${Date.now()}`,\r\n      isSystem: false\r\n    };\r\n    \r\n    this._savedTemplates.update(t => [...t, newTemplate]);\r\n    this.persistTemplates();\r\n  }\r\n  \r\n  /**\r\n   * åˆªé™¤æ¨¡æ¿\r\n   */\r\n  deleteTemplate(id: string): void {\r\n    this._savedTemplates.update(t => t.filter(x => x.id !== id));\r\n    this.persistTemplates();\r\n  }\r\n  \r\n  /**\r\n   * æ‡‰ç”¨æ¨¡æ¿\r\n   */\r\n  applyTemplate(template: CopywritingTemplate, variables: Record<string, any>): string {\r\n    let result = template.template;\r\n    \r\n    for (const [key, value] of Object.entries(variables)) {\r\n      result = result.replace(new RegExp(`{${key}}`, 'g'), value || '');\r\n    }\r\n    \r\n    // æ¸…ç†æœªæ›¿æ›çš„è®Šé‡\r\n    result = result.replace(/\\{[^}]+\\}/g, '');\r\n    \r\n    return result.trim();\r\n  }\r\n  \r\n  // ============ ç§æœ‰æ–¹æ³• ============\r\n  \r\n  private buildPrompt(request: CopywritingRequest): string {\r\n    const typePrompts: Record<CopywritingType, string> = {\r\n      greeting: 'ç”Ÿæˆé–‹å ´ç™½/å•å€™èª',\r\n      reply: 'ç”Ÿæˆå›è¦†æ¶ˆæ¯',\r\n      follow_up: 'ç”Ÿæˆè·Ÿé€²æ¶ˆæ¯',\r\n      objection: 'ç”Ÿæˆç•°è­°è™•ç†è©±è¡“',\r\n      closing: 'ç”Ÿæˆä¿ƒæˆæˆäº¤è©±è¡“',\r\n      retention: 'ç”ŸæˆæŒ½å›å®¢æˆ¶è©±è¡“'\r\n    };\r\n    \r\n    const styleDesc = request.style ? `é¢¨æ ¼è¦æ±‚ï¼š${this.getStyleDescription(request.style)}` : '';\r\n    \r\n    let prompt = `ä½œç‚ºå°ˆæ¥­çš„éŠ·å”®è©±è¡“å°ˆå®¶ï¼Œè«‹${typePrompts[request.type]}ã€‚\r\n\r\n${styleDesc}\r\n\r\n`;\r\n    \r\n    if (request.context?.productName) {\r\n      prompt += `ç”¢å“/æœå‹™ï¼š${request.context.productName}\\n`;\r\n    }\r\n    \r\n    if (request.context?.customerName) {\r\n      prompt += `å®¢æˆ¶ç¨±å‘¼ï¼š${request.context.customerName}\\n`;\r\n    }\r\n    \r\n    if (request.context?.previousMessages?.length) {\r\n      prompt += `\\nå°è©±ä¸Šä¸‹æ–‡ï¼š\\n${request.context.previousMessages.join('\\n')}\\n`;\r\n    }\r\n    \r\n    if (request.context?.objection) {\r\n      prompt += `\\nå®¢æˆ¶ç•°è­°ï¼š${request.context.objection}\\n`;\r\n    }\r\n    \r\n    if (request.context?.goal) {\r\n      prompt += `\\nç›®æ¨™ï¼š${request.context.goal}\\n`;\r\n    }\r\n    \r\n    prompt += `\\nè¦æ±‚ï¼š\r\n1. è‡ªç„¶å£èªåŒ–ï¼Œä¸è¦å¤ªç”Ÿç¡¬\r\n2. ç°¡æ½”æœ‰åŠ›ï¼Œä¸è¦å¤ªé•·\r\n3. æœ‰è¦ªå’ŒåŠ›ï¼Œè®“å®¢æˆ¶æ„Ÿåˆ°èˆ’é©\r\n${request.options?.includeEmoji ? '4. é©ç•¶ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ' : ''}\r\n\r\nè«‹ç›´æ¥çµ¦å‡ºè©±è¡“ï¼Œä¸éœ€è¦è§£é‡‹ï¼š`;\r\n    \r\n    return prompt;\r\n  }\r\n  \r\n  private getStyleDescription(style: CopywritingStyle): string {\r\n    const descriptions: Record<CopywritingStyle, string> = {\r\n      professional: 'å°ˆæ¥­æ­£å¼ï¼Œç”¨è©ç²¾æº–ï¼Œçµ¦äººä¿¡è³´æ„Ÿ',\r\n      friendly: 'è¦ªåˆ‡å‹å¥½ï¼Œåƒæœ‹å‹èŠå¤©ä¸€æ¨£è‡ªç„¶',\r\n      casual: 'è¼•é¬†éš¨æ„ï¼Œå£èªåŒ–ï¼Œä¸æ‹˜è¬¹',\r\n      urgent: 'å¸¶æœ‰é©åº¦ç·Šè¿«æ„Ÿï¼Œä¿ƒé€²æ±ºç­–',\r\n      empathetic: 'å¯Œæœ‰åŒç†å¿ƒï¼Œç†è§£å®¢æˆ¶è™•å¢ƒ'\r\n    };\r\n    return descriptions[style];\r\n  }\r\n  \r\n  private postProcess(text: string, request: CopywritingRequest): string {\r\n    let result = text.trim();\r\n    \r\n    // ç§»é™¤å¯èƒ½çš„å¼•è™Ÿ\r\n    if (result.startsWith('\"') && result.endsWith('\"')) {\r\n      result = result.slice(1, -1);\r\n    }\r\n    \r\n    // è™•ç†è®Šé‡æ›¿æ›\r\n    if (request.context?.customerName) {\r\n      result = result.replace(/\\{customerName\\}/g, request.context.customerName);\r\n    }\r\n    if (request.context?.productName) {\r\n      result = result.replace(/\\{productName\\}/g, request.context.productName);\r\n    }\r\n    \r\n    return result;\r\n  }\r\n  \r\n  private evaluateQuality(text: string, request: CopywritingRequest): number {\r\n    let score = 70;\r\n    \r\n    // é•·åº¦é©ä¸­\r\n    if (text.length >= 20 && text.length <= 200) score += 10;\r\n    \r\n    // åŒ…å«è¡¨æƒ…ï¼ˆå¦‚æœè¦æ±‚ï¼‰\r\n    if (request.options?.includeEmoji && /[\\u{1F300}-\\u{1F9FF}]/u.test(text)) {\r\n      score += 5;\r\n    }\r\n    \r\n    // æœ‰å•å¥ï¼ˆäº’å‹•æ€§ï¼‰\r\n    if (text.includes('ï¼Ÿ') || text.includes('?')) score += 5;\r\n    \r\n    // ä½¿ç”¨å®¢æˆ¶åç¨±ï¼ˆå€‹æ€§åŒ–ï¼‰\r\n    if (request.context?.customerName && text.includes(request.context.customerName)) {\r\n      score += 5;\r\n    }\r\n    \r\n    return Math.min(100, score);\r\n  }\r\n  \r\n  private extractTags(request: CopywritingRequest): string[] {\r\n    const tags: string[] = [request.type];\r\n    \r\n    if (request.style) tags.push(request.style);\r\n    if (request.options?.includeEmoji) tags.push('emoji');\r\n    if (request.context?.productName) tags.push('ç”¢å“ç›¸é—œ');\r\n    \r\n    return tags;\r\n  }\r\n  \r\n  private loadSavedTemplates(): void {\r\n    try {\r\n      const saved = localStorage.getItem('copywriting_templates');\r\n      if (saved) {\r\n        this._savedTemplates.set(JSON.parse(saved));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load templates:', e);\r\n    }\r\n  }\r\n  \r\n  private persistTemplates(): void {\r\n    localStorage.setItem('copywriting_templates', JSON.stringify(this._savedTemplates()));\r\n  }\r\n}\r\n","/**\r\n * æ–°æ‰‹å¼•å°æœå‹™\r\n * Onboarding Service\r\n * \r\n * ğŸ†• é«”é©—å„ªåŒ–: æ–°æ‰‹å¼•å°ç³»çµ±\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - æ­¥é©Ÿå¼å¼•å°æµç¨‹\r\n * - é«˜äº®ç›®æ¨™å…ƒç´ \r\n * - é€²åº¦è¿½è¹¤\r\n * - å¯è·³éå’Œé‡æ–°é–‹å§‹\r\n */\r\n\r\nimport { Injectable, signal, computed } from '@angular/core';\r\n\r\n// å¼•å°æ­¥é©Ÿ\r\nexport interface OnboardingStep {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  target?: string;           // CSS é¸æ“‡å™¨\r\n  position?: 'top' | 'bottom' | 'left' | 'right' | 'center';\r\n  action?: string;           // éœ€è¦ç”¨æˆ¶åŸ·è¡Œçš„å‹•ä½œ\r\n  actionLabel?: string;\r\n  skipable?: boolean;\r\n  beforeShow?: () => void;\r\n  afterComplete?: () => void;\r\n}\r\n\r\n// å¼•å°æµç¨‹\r\nexport interface OnboardingTour {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  steps: OnboardingStep[];\r\n  trigger?: 'first_visit' | 'manual' | 'feature_unlock';\r\n  version?: number;          // ç‰ˆæœ¬è™Ÿï¼Œç”¨æ–¼é‡æ–°è§¸ç™¼\r\n}\r\n\r\n// ç”¨æˆ¶é€²åº¦\r\nexport interface OnboardingProgress {\r\n  tourId: string;\r\n  currentStep: number;\r\n  completed: boolean;\r\n  skipped: boolean;\r\n  completedAt?: string;\r\n  version?: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OnboardingService {\r\n  \r\n  // ç‹€æ…‹\r\n  private _isActive = signal(false);\r\n  isActive = this._isActive.asReadonly();\r\n  \r\n  private _currentTour = signal<OnboardingTour | null>(null);\r\n  currentTour = this._currentTour.asReadonly();\r\n  \r\n  private _currentStepIndex = signal(0);\r\n  currentStepIndex = this._currentStepIndex.asReadonly();\r\n  \r\n  private _progress = signal<Map<string, OnboardingProgress>>(new Map());\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  currentStep = computed(() => {\r\n    const tour = this._currentTour();\r\n    const index = this._currentStepIndex();\r\n    return tour?.steps[index] || null;\r\n  });\r\n  \r\n  totalSteps = computed(() => this._currentTour()?.steps.length || 0);\r\n  \r\n  progressPercent = computed(() => {\r\n    const total = this.totalSteps();\r\n    if (total === 0) return 0;\r\n    return Math.round((this._currentStepIndex() / total) * 100);\r\n  });\r\n  \r\n  // é è¨­å¼•å°æµç¨‹\r\n  private tours: OnboardingTour[] = [\r\n    {\r\n      id: 'welcome',\r\n      name: 'æ­¡è¿ä½¿ç”¨',\r\n      description: 'å¿«é€Ÿäº†è§£ç³»çµ±çš„æ ¸å¿ƒåŠŸèƒ½',\r\n      trigger: 'first_visit',\r\n      version: 1,\r\n      steps: [\r\n        {\r\n          id: 'welcome-intro',\r\n          title: 'æ­¡è¿ä½¿ç”¨æ™ºèƒ½ç‡ŸéŠ·ç³»çµ±ï¼ ğŸ‰',\r\n          description: 'é€™æ˜¯æ‚¨çš„æ™ºèƒ½ç‡ŸéŠ·åŠ©æ‰‹ï¼Œè®“æˆ‘å€‘èŠ±2åˆ†é˜å¿«é€Ÿäº†è§£æ ¸å¿ƒåŠŸèƒ½ã€‚',\r\n          position: 'center',\r\n          skipable: true\r\n        },\r\n        {\r\n          id: 'welcome-accounts',\r\n          title: '1. æ·»åŠ å¸³è™Ÿ',\r\n          description: 'é¦–å…ˆï¼Œæ‚¨éœ€è¦æ·»åŠ  Telegram å¸³è™Ÿã€‚é»æ“Šé€™è£¡é–‹å§‹æ·»åŠ æ‚¨çš„ç¬¬ä¸€å€‹å¸³è™Ÿã€‚',\r\n          target: '[data-tour=\"accounts\"]',\r\n          position: 'bottom',\r\n          actionLabel: 'äº†è§£äº†'\r\n        },\r\n        {\r\n          id: 'welcome-marketing',\r\n          title: '2. ç‡ŸéŠ·ä»»å‹™ä¸­å¿ƒ',\r\n          description: 'é€™æ˜¯æ‚¨çš„ç‡ŸéŠ·ä»»å‹™æŒ‡æ®ä¸­å¿ƒã€‚é¸æ“‡ç›®æ¨™ã€é…ç½® AIï¼Œä¸€éµå•Ÿå‹•ç‡ŸéŠ·ä»»å‹™ã€‚',\r\n          target: '[data-tour=\"marketing-hub\"]',\r\n          position: 'bottom',\r\n          actionLabel: 'ä¸‹ä¸€æ­¥'\r\n        },\r\n        {\r\n          id: 'welcome-roles',\r\n          title: '3. è§’è‰²è³‡æºåº«',\r\n          description: 'é€™è£¡ç®¡ç† AI è§’è‰²å’ŒåŠ‡æœ¬ã€‚ç³»çµ±é è¨­äº†50+å°ˆæ¥­è§’è‰²ï¼Œæ‚¨ä¹Ÿå¯ä»¥è‡ªå®šç¾©ã€‚',\r\n          target: '[data-tour=\"role-library\"]',\r\n          position: 'bottom',\r\n          actionLabel: 'ä¸‹ä¸€æ­¥'\r\n        },\r\n        {\r\n          id: 'welcome-ai',\r\n          title: '4. æ™ºèƒ½å¼•æ“',\r\n          description: 'é…ç½® AI æ¨¡å‹ã€çŸ¥è­˜åº«å’Œäººæ ¼é¢¨æ ¼ã€‚å»ºè­°å…ˆå®Œæˆé€™è£¡çš„é…ç½®ã€‚',\r\n          target: '[data-tour=\"ai-engine\"]',\r\n          position: 'bottom',\r\n          actionLabel: 'ä¸‹ä¸€æ­¥'\r\n        },\r\n        {\r\n          id: 'welcome-done',\r\n          title: 'æº–å‚™å°±ç·’ï¼ ğŸš€',\r\n          description: 'æ‚¨å·²äº†è§£åŸºæœ¬åŠŸèƒ½ã€‚å»ºè­°å…ˆæ·»åŠ å¸³è™Ÿï¼Œç„¶å¾Œå˜—è©¦å‰µå»ºæ‚¨çš„ç¬¬ä¸€å€‹ç‡ŸéŠ·ä»»å‹™ã€‚\\n\\néš¨æ™‚å¯ä»¥åœ¨è¨­ç½®ä¸­é‡æ–°æŸ¥çœ‹å¼•å°ã€‚',\r\n          position: 'center',\r\n          actionLabel: 'é–‹å§‹ä½¿ç”¨'\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      id: 'create-task',\r\n      name: 'å‰µå»ºç‡ŸéŠ·ä»»å‹™',\r\n      description: 'å­¸ç¿’å¦‚ä½•å‰µå»ºå’Œé…ç½®ç‡ŸéŠ·ä»»å‹™',\r\n      trigger: 'manual',\r\n      version: 1,\r\n      steps: [\r\n        {\r\n          id: 'task-goal',\r\n          title: 'é¸æ“‡ç‡ŸéŠ·ç›®æ¨™',\r\n          description: 'é¦–å…ˆé¸æ“‡æ‚¨è¦é”æˆçš„ç›®æ¨™ã€‚ä¸åŒç›®æ¨™æœƒæœ‰ä¸åŒçš„ AI ç­–ç•¥ã€‚',\r\n          target: '.goal-selector',\r\n          position: 'bottom'\r\n        },\r\n        {\r\n          id: 'task-audience',\r\n          title: 'é¸æ“‡ç›®æ¨™å®¢ç¾¤',\r\n          description: 'æŒ‡å®šé€™æ¬¡ä»»å‹™è¦è§¸é”çš„å®¢æˆ¶ã€‚å¯ä»¥æŒ‰æ¨™ç±¤ã€ç¾¤çµ„æˆ–æ„å‘åˆ†æ•¸ç¯©é¸ã€‚',\r\n          target: '.audience-selector',\r\n          position: 'bottom'\r\n        },\r\n        {\r\n          id: 'task-config',\r\n          title: 'ç¢ºèª AI é…ç½®',\r\n          description: 'AI æœƒæ ¹æ“šç›®æ¨™è‡ªå‹•æ¨è–¦é…ç½®ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹å‹•èª¿æ•´ã€‚',\r\n          target: '.config-panel',\r\n          position: 'left'\r\n        },\r\n        {\r\n          id: 'task-launch',\r\n          title: 'å•Ÿå‹•ä»»å‹™',\r\n          description: 'ç¢ºèªç„¡èª¤å¾Œï¼Œé»æ“Šå•Ÿå‹•æŒ‰éˆ•ã€‚AI æœƒé–‹å§‹è‡ªå‹•åŸ·è¡Œç‡ŸéŠ·ä»»å‹™ã€‚',\r\n          target: '.launch-button',\r\n          position: 'top'\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      id: 'ai-config',\r\n      name: 'é…ç½® AI å¼•æ“',\r\n      description: 'å­¸ç¿’å¦‚ä½•é…ç½® AI æ¨¡å‹å’ŒçŸ¥è­˜åº«',\r\n      trigger: 'manual',\r\n      version: 1,\r\n      steps: [\r\n        {\r\n          id: 'ai-model',\r\n          title: 'é¸æ“‡ AI æ¨¡å‹',\r\n          description: 'é¸æ“‡è¦ä½¿ç”¨çš„ AI æ¨¡å‹ã€‚GPT-4 æ•ˆæœæœ€å¥½ï¼ŒGPT-3.5 æˆæœ¬æœ€ä½ã€‚',\r\n          target: '[data-tour=\"ai-model\"]',\r\n          position: 'bottom'\r\n        },\r\n        {\r\n          id: 'ai-apikey',\r\n          title: 'é…ç½® API Key',\r\n          description: 'è¼¸å…¥æ‚¨çš„ OpenAI æˆ–å…¶ä»– AI æœå‹™çš„ API Keyã€‚',\r\n          target: '[data-tour=\"api-key\"]',\r\n          position: 'bottom'\r\n        },\r\n        {\r\n          id: 'ai-knowledge',\r\n          title: 'æ·»åŠ çŸ¥è­˜åº«',\r\n          description: 'ä¸Šå‚³ç”¢å“è³‡æ–™ã€FAQ ç­‰æ–‡æª”ï¼ŒAI æœƒå­¸ç¿’é€™äº›çŸ¥è­˜ä¾†å›ç­”å®¢æˆ¶å•é¡Œã€‚',\r\n          target: '[data-tour=\"knowledge-base\"]',\r\n          position: 'right'\r\n        },\r\n        {\r\n          id: 'ai-persona',\r\n          title: 'è¨­ç½® AI äººæ ¼',\r\n          description: 'èª¿æ•´ AI çš„èªªè©±é¢¨æ ¼å’Œäººæ ¼ç‰¹é»ï¼Œè®“å›è¦†æ›´è‡ªç„¶ã€‚',\r\n          target: '[data-tour=\"ai-persona\"]',\r\n          position: 'bottom'\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n  \r\n  constructor() {\r\n    this.loadProgress();\r\n    this.checkAutoStart();\r\n  }\r\n  \r\n  // ============ å¼•å°æ§åˆ¶ ============\r\n  \r\n  /**\r\n   * é–‹å§‹å¼•å°\r\n   */\r\n  startTour(tourId: string): void {\r\n    const tour = this.tours.find(t => t.id === tourId);\r\n    if (!tour) return;\r\n    \r\n    this._currentTour.set(tour);\r\n    this._currentStepIndex.set(0);\r\n    this._isActive.set(true);\r\n    \r\n    const step = tour.steps[0];\r\n    step.beforeShow?.();\r\n    \r\n    this.highlightTarget(step.target);\r\n  }\r\n  \r\n  /**\r\n   * ä¸‹ä¸€æ­¥\r\n   */\r\n  nextStep(): void {\r\n    const tour = this._currentTour();\r\n    if (!tour) return;\r\n    \r\n    const currentStep = this.currentStep();\r\n    currentStep?.afterComplete?.();\r\n    \r\n    const nextIndex = this._currentStepIndex() + 1;\r\n    \r\n    if (nextIndex >= tour.steps.length) {\r\n      this.completeTour();\r\n    } else {\r\n      this._currentStepIndex.set(nextIndex);\r\n      const step = tour.steps[nextIndex];\r\n      step.beforeShow?.();\r\n      this.highlightTarget(step.target);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ä¸Šä¸€æ­¥\r\n   */\r\n  prevStep(): void {\r\n    const prevIndex = this._currentStepIndex() - 1;\r\n    if (prevIndex < 0) return;\r\n    \r\n    this._currentStepIndex.set(prevIndex);\r\n    const step = this._currentTour()?.steps[prevIndex];\r\n    if (step) {\r\n      step.beforeShow?.();\r\n      this.highlightTarget(step.target);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * è·³åˆ°æŒ‡å®šæ­¥é©Ÿ\r\n   */\r\n  goToStep(index: number): void {\r\n    const tour = this._currentTour();\r\n    if (!tour || index < 0 || index >= tour.steps.length) return;\r\n    \r\n    this._currentStepIndex.set(index);\r\n    const step = tour.steps[index];\r\n    step.beforeShow?.();\r\n    this.highlightTarget(step.target);\r\n  }\r\n  \r\n  /**\r\n   * è·³éå¼•å°\r\n   */\r\n  skipTour(): void {\r\n    const tour = this._currentTour();\r\n    if (!tour) return;\r\n    \r\n    this.updateProgress(tour.id, {\r\n      tourId: tour.id,\r\n      currentStep: this._currentStepIndex(),\r\n      completed: false,\r\n      skipped: true,\r\n      version: tour.version\r\n    });\r\n    \r\n    this.closeTour();\r\n  }\r\n  \r\n  /**\r\n   * å®Œæˆå¼•å°\r\n   */\r\n  completeTour(): void {\r\n    const tour = this._currentTour();\r\n    if (!tour) return;\r\n    \r\n    this.updateProgress(tour.id, {\r\n      tourId: tour.id,\r\n      currentStep: tour.steps.length,\r\n      completed: true,\r\n      skipped: false,\r\n      completedAt: new Date().toISOString(),\r\n      version: tour.version\r\n    });\r\n    \r\n    this.closeTour();\r\n  }\r\n  \r\n  /**\r\n   * é—œé–‰å¼•å°\r\n   */\r\n  closeTour(): void {\r\n    this.clearHighlight();\r\n    this._isActive.set(false);\r\n    this._currentTour.set(null);\r\n    this._currentStepIndex.set(0);\r\n  }\r\n  \r\n  // ============ é€²åº¦ç®¡ç† ============\r\n  \r\n  /**\r\n   * æª¢æŸ¥æ˜¯å¦å·²å®Œæˆ\r\n   */\r\n  isCompleted(tourId: string): boolean {\r\n    const progress = this._progress().get(tourId);\r\n    return progress?.completed || false;\r\n  }\r\n  \r\n  /**\r\n   * é‡ç½®å¼•å°\r\n   */\r\n  resetTour(tourId: string): void {\r\n    this._progress.update(p => {\r\n      const newMap = new Map(p);\r\n      newMap.delete(tourId);\r\n      return newMap;\r\n    });\r\n    this.saveProgress();\r\n  }\r\n  \r\n  /**\r\n   * é‡ç½®æ‰€æœ‰å¼•å°\r\n   */\r\n  resetAll(): void {\r\n    this._progress.set(new Map());\r\n    this.saveProgress();\r\n  }\r\n  \r\n  /**\r\n   * ç²å–å¯ç”¨çš„å¼•å°åˆ—è¡¨\r\n   */\r\n  getAvailableTours(): OnboardingTour[] {\r\n    return this.tours;\r\n  }\r\n  \r\n  // ============ ç§æœ‰æ–¹æ³• ============\r\n  \r\n  private checkAutoStart(): void {\r\n    // æª¢æŸ¥æ˜¯å¦éœ€è¦è‡ªå‹•å•Ÿå‹•å¼•å°\r\n    for (const tour of this.tours) {\r\n      if (tour.trigger !== 'first_visit') continue;\r\n      \r\n      const progress = this._progress().get(tour.id);\r\n      \r\n      // å¦‚æœæœªå®Œæˆä¸”æœªè·³éï¼Œæˆ–è€…ç‰ˆæœ¬æ›´æ–°äº†\r\n      if (!progress || (progress.version !== tour.version && !progress.completed)) {\r\n        setTimeout(() => this.startTour(tour.id), 1000);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  \r\n  private updateProgress(tourId: string, progress: OnboardingProgress): void {\r\n    this._progress.update(p => {\r\n      const newMap = new Map(p);\r\n      newMap.set(tourId, progress);\r\n      return newMap;\r\n    });\r\n    this.saveProgress();\r\n  }\r\n  \r\n  private highlightTarget(selector?: string): void {\r\n    this.clearHighlight();\r\n    \r\n    if (!selector) return;\r\n    \r\n    const element = document.querySelector(selector);\r\n    if (element) {\r\n      element.classList.add('onboarding-highlight');\r\n      element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n    }\r\n  }\r\n  \r\n  private clearHighlight(): void {\r\n    document.querySelectorAll('.onboarding-highlight').forEach(el => {\r\n      el.classList.remove('onboarding-highlight');\r\n    });\r\n  }\r\n  \r\n  private loadProgress(): void {\r\n    try {\r\n      const saved = localStorage.getItem('onboarding_progress');\r\n      if (saved) {\r\n        const data = JSON.parse(saved);\r\n        this._progress.set(new Map(Object.entries(data)));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load onboarding progress:', e);\r\n    }\r\n  }\r\n  \r\n  private saveProgress(): void {\r\n    const data = Object.fromEntries(this._progress());\r\n    localStorage.setItem('onboarding_progress', JSON.stringify(data));\r\n  }\r\n}\r\n","/**\r\n * ä¸»é¡Œæœå‹™\r\n * Theme Service\r\n * \r\n * ğŸ†• é«”é©—å„ªåŒ–: ä¸»é¡Œåˆ‡æ›åŠŸèƒ½\r\n * \r\n * åŠŸèƒ½ï¼š\r\n * - æš—è‰²/äº®è‰²ä¸»é¡Œåˆ‡æ›\r\n * - è‡ªå®šç¾©ä¸»é¡Œè‰²\r\n * - è·Ÿéš¨ç³»çµ±è¨­ç½®\r\n * - ä¸»é¡ŒæŒä¹…åŒ–\r\n */\r\n\r\nimport { Injectable, signal, computed, effect } from '@angular/core';\r\n\r\n// ä¸»é¡Œæ¨¡å¼\r\nexport type ThemeMode = 'dark' | 'light' | 'system';\r\n\r\n// ä¸»é¡Œé…è‰²\r\nexport interface ThemeColors {\r\n  primary: string;\r\n  secondary: string;\r\n  accent: string;\r\n  background: string;\r\n  surface: string;\r\n  text: string;\r\n  textMuted: string;\r\n  border: string;\r\n  success: string;\r\n  warning: string;\r\n  error: string;\r\n}\r\n\r\n// é è¨­ä¸»é¡Œ\r\nexport interface ThemePreset {\r\n  id: string;\r\n  name: string;\r\n  mode: 'dark' | 'light';\r\n  colors: Partial<ThemeColors>;\r\n}\r\n\r\n// é»˜èªæš—è‰²ä¸»é¡Œ\r\nconst DARK_THEME: ThemeColors = {\r\n  primary: '#8b5cf6',      // purple-500\r\n  secondary: '#06b6d4',    // cyan-500\r\n  accent: '#ec4899',       // pink-500\r\n  background: '#0f172a',   // slate-900\r\n  surface: '#1e293b',      // slate-800\r\n  text: '#f8fafc',         // slate-50\r\n  textMuted: '#94a3b8',    // slate-400\r\n  border: '#334155',       // slate-700\r\n  success: '#10b981',      // emerald-500\r\n  warning: '#f59e0b',      // amber-500\r\n  error: '#ef4444'         // red-500\r\n};\r\n\r\n// é»˜èªäº®è‰²ä¸»é¡Œ\r\nconst LIGHT_THEME: ThemeColors = {\r\n  primary: '#7c3aed',      // violet-600\r\n  secondary: '#0891b2',    // cyan-600\r\n  accent: '#db2777',       // pink-600\r\n  background: '#ffffff',   // white\r\n  surface: '#f8fafc',      // slate-50\r\n  text: '#0f172a',         // slate-900\r\n  textMuted: '#64748b',    // slate-500\r\n  border: '#e2e8f0',       // slate-200\r\n  success: '#059669',      // emerald-600\r\n  warning: '#d97706',      // amber-600\r\n  error: '#dc2626'         // red-600\r\n};\r\n\r\n// é è¨­ä¸»é¡Œ\r\nconst THEME_PRESETS: ThemePreset[] = [\r\n  {\r\n    id: 'default-dark',\r\n    name: 'é»˜èªæš—è‰²',\r\n    mode: 'dark',\r\n    colors: {}\r\n  },\r\n  {\r\n    id: 'default-light',\r\n    name: 'é»˜èªäº®è‰²',\r\n    mode: 'light',\r\n    colors: {}\r\n  },\r\n  {\r\n    id: 'midnight',\r\n    name: 'åˆå¤œè—',\r\n    mode: 'dark',\r\n    colors: {\r\n      primary: '#3b82f6',\r\n      secondary: '#8b5cf6',\r\n      background: '#0c1222',\r\n      surface: '#162032'\r\n    }\r\n  },\r\n  {\r\n    id: 'forest',\r\n    name: 'æ£®æ—ç¶ ',\r\n    mode: 'dark',\r\n    colors: {\r\n      primary: '#10b981',\r\n      secondary: '#14b8a6',\r\n      accent: '#22c55e',\r\n      background: '#0a1410',\r\n      surface: '#132820'\r\n    }\r\n  },\r\n  {\r\n    id: 'sunset',\r\n    name: 'æ—¥è½æ©™',\r\n    mode: 'dark',\r\n    colors: {\r\n      primary: '#f97316',\r\n      secondary: '#fb923c',\r\n      accent: '#ef4444',\r\n      background: '#1c1210',\r\n      surface: '#2a1f1a'\r\n    }\r\n  },\r\n  {\r\n    id: 'ocean',\r\n    name: 'æµ·æ´‹',\r\n    mode: 'light',\r\n    colors: {\r\n      primary: '#0ea5e9',\r\n      secondary: '#06b6d4',\r\n      background: '#f0f9ff',\r\n      surface: '#e0f2fe'\r\n    }\r\n  }\r\n];\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ThemeService {\r\n  \r\n  // ç‹€æ…‹\r\n  private _mode = signal<ThemeMode>('dark');\r\n  mode = this._mode.asReadonly();\r\n  \r\n  private _activePreset = signal<string>('default-dark');\r\n  activePreset = this._activePreset.asReadonly();\r\n  \r\n  private _customColors = signal<Partial<ThemeColors>>({});\r\n  customColors = this._customColors.asReadonly();\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  isDark = computed(() => {\r\n    const mode = this._mode();\r\n    if (mode === 'system') {\r\n      return this.getSystemPreference() === 'dark';\r\n    }\r\n    return mode === 'dark';\r\n  });\r\n  \r\n  currentColors = computed<ThemeColors>(() => {\r\n    const baseColors = this.isDark() ? DARK_THEME : LIGHT_THEME;\r\n    const presetColors = this.getPresetColors();\r\n    const customColors = this._customColors();\r\n    \r\n    return {\r\n      ...baseColors,\r\n      ...presetColors,\r\n      ...customColors\r\n    };\r\n  });\r\n  \r\n  presets = computed(() => THEME_PRESETS);\r\n  \r\n  constructor() {\r\n    this.loadSettings();\r\n    this.setupSystemListener();\r\n    \r\n    // ç•¶ä¸»é¡Œè®ŠåŒ–æ™‚æ‡‰ç”¨åˆ° DOM\r\n    effect(() => {\r\n      this.applyTheme();\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®ä¸»é¡Œæ¨¡å¼\r\n   */\r\n  setMode(mode: ThemeMode): void {\r\n    this._mode.set(mode);\r\n    this.saveSettings();\r\n  }\r\n  \r\n  /**\r\n   * åˆ‡æ›æš—è‰²/äº®è‰²\r\n   */\r\n  toggle(): void {\r\n    const current = this._mode();\r\n    if (current === 'system') {\r\n      this._mode.set(this.isDark() ? 'light' : 'dark');\r\n    } else {\r\n      this._mode.set(current === 'dark' ? 'light' : 'dark');\r\n    }\r\n    this.saveSettings();\r\n  }\r\n  \r\n  /**\r\n   * æ‡‰ç”¨é è¨­ä¸»é¡Œ\r\n   */\r\n  applyPreset(presetId: string): void {\r\n    const preset = THEME_PRESETS.find(p => p.id === presetId);\r\n    if (!preset) return;\r\n    \r\n    this._activePreset.set(presetId);\r\n    this._mode.set(preset.mode);\r\n    this._customColors.set({});\r\n    this.saveSettings();\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®è‡ªå®šç¾©é¡è‰²\r\n   */\r\n  setCustomColor(key: keyof ThemeColors, value: string): void {\r\n    this._customColors.update(colors => ({\r\n      ...colors,\r\n      [key]: value\r\n    }));\r\n    this.saveSettings();\r\n  }\r\n  \r\n  /**\r\n   * é‡ç½®è‡ªå®šç¾©é¡è‰²\r\n   */\r\n  resetCustomColors(): void {\r\n    this._customColors.set({});\r\n    this.saveSettings();\r\n  }\r\n  \r\n  /**\r\n   * ç²å– CSS è®Šé‡\r\n   */\r\n  getCssVariables(): string {\r\n    const colors = this.currentColors();\r\n    return Object.entries(colors)\r\n      .map(([key, value]) => `--theme-${this.camelToKebab(key)}: ${value};`)\r\n      .join('\\n');\r\n  }\r\n  \r\n  // ============ ç§æœ‰æ–¹æ³• ============\r\n  \r\n  private getPresetColors(): Partial<ThemeColors> {\r\n    const preset = THEME_PRESETS.find(p => p.id === this._activePreset());\r\n    return preset?.colors || {};\r\n  }\r\n  \r\n  private getSystemPreference(): 'dark' | 'light' {\r\n    if (window.matchMedia?.('(prefers-color-scheme: dark)').matches) {\r\n      return 'dark';\r\n    }\r\n    return 'light';\r\n  }\r\n  \r\n  private setupSystemListener(): void {\r\n    window.matchMedia?.('(prefers-color-scheme: dark)')\r\n      .addEventListener('change', () => {\r\n        if (this._mode() === 'system') {\r\n          this.applyTheme();\r\n        }\r\n      });\r\n  }\r\n  \r\n  private applyTheme(): void {\r\n    const root = document.documentElement;\r\n    const colors = this.currentColors();\r\n    \r\n    // è¨­ç½®æš—è‰²/äº®è‰²é¡\r\n    if (this.isDark()) {\r\n      root.classList.add('dark');\r\n      root.classList.remove('light');\r\n    } else {\r\n      root.classList.add('light');\r\n      root.classList.remove('dark');\r\n    }\r\n    \r\n    // è¨­ç½® CSS è®Šé‡\r\n    for (const [key, value] of Object.entries(colors)) {\r\n      root.style.setProperty(`--theme-${this.camelToKebab(key)}`, value);\r\n    }\r\n    \r\n    // è¨­ç½® meta ä¸»é¡Œè‰²\r\n    const metaTheme = document.querySelector('meta[name=\"theme-color\"]');\r\n    if (metaTheme) {\r\n      metaTheme.setAttribute('content', colors.background);\r\n    }\r\n  }\r\n  \r\n  private camelToKebab(str: string): string {\r\n    return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\r\n  }\r\n  \r\n  private loadSettings(): void {\r\n    try {\r\n      const saved = localStorage.getItem('theme_settings');\r\n      if (saved) {\r\n        const settings = JSON.parse(saved);\r\n        this._mode.set(settings.mode || 'dark');\r\n        this._activePreset.set(settings.preset || 'default-dark');\r\n        this._customColors.set(settings.customColors || {});\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load theme settings:', e);\r\n    }\r\n  }\r\n  \r\n  private saveSettings(): void {\r\n    localStorage.setItem('theme_settings', JSON.stringify({\r\n      mode: this._mode(),\r\n      preset: this._activePreset(),\r\n      customColors: this._customColors()\r\n    }));\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEM,IAAO,gBAAP,MAAO,eAAa;EAH1B,cAAA;AAIU,SAAA,QAAQ,OAAO,YAAY;AAK3B,SAAA,iBAAiB,OAAmC,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAChE,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAGtC,SAAA,kBAAkB,OAA6B;MACrD,MAAM;MACN,OAAO;MACP,UAAU;MACV,aAAa;OACd,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACD,SAAA,iBAAiB,KAAK,gBAAgB,WAAU;AAGxC,SAAA,sBAAsB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAClC,SAAA,wBAAwB,OAAoC,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,wBAAA,CAAA,IAAA,CAAA,CAAA;AACxE,SAAA,qBAAqB,KAAK,oBAAoB,WAAU;AACxD,SAAA,uBAAuB,KAAK,sBAAsB,WAAU;AAGpD,SAAA,uBAAuB,OAA4B;MACzD,MAAM;MACN,MAAM;OACP,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AACD,SAAA,sBAAsB,KAAK,qBAAqB,WAAU;AAGlD,SAAA,qBAAqB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AACzC,SAAA,oBAAoB,KAAK,mBAAmB,WAAU;AAG9C,SAAA,0BAA0B,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,0BAAA,CAAA,IAAA,CAAA,CAAA;AACtC,SAAA,oBAAoB,OAAc,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAC5C,SAAA,yBAAyB,KAAK,wBAAwB,WAAU;AAChE,SAAA,mBAAmB,KAAK,kBAAkB,WAAU;AAG5C,SAAA,yBAAyB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,yBAAA,CAAA,IAAA,CAAA,CAAA;AACrC,SAAA,sBAAsB,OAAc,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAC9C,SAAA,wBAAwB,KAAK,uBAAuB,WAAU;AAC9D,SAAA,qBAAqB,KAAK,oBAAoB,WAAU;AAGhD,SAAA,8BAA8B,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,8BAAA,CAAA,IAAA,CAAA,CAAA;AAC1C,SAAA,yBAAyB,OAAY,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,yBAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,6BAA6B,KAAK,4BAA4B,WAAU;AACxE,SAAA,wBAAwB,KAAK,uBAAuB,WAAU;AAGtD,SAAA,yBAAyB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,yBAAA,CAAA,IAAA,CAAA,CAAA;AACrC,SAAA,uBAAuB,OAAY,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AAC/C,SAAA,wBAAwB,KAAK,uBAAuB,WAAU;AAC9D,SAAA,sBAAsB,KAAK,qBAAqB,WAAU;AAGlD,SAAA,sBAAsB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAClC,SAAA,oBAAoB,OAAY,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAC5C,SAAA,qBAAqB,KAAK,oBAAoB,WAAU;AACxD,SAAA,mBAAmB,KAAK,kBAAkB,WAAU;AAG5C,SAAA,eAAe,OAAiC,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AACpD,SAAA,oBAAoB,OAAO,IAAE,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAC7B,SAAA,oBAAoB,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AACtD,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,mBAAmB,KAAK,kBAAkB,WAAU;AACpD,SAAA,mBAAmB,KAAK,kBAAkB,WAAU;;;EAIpD,QAAQ,QAA2B;AACjC,SAAK,eAAe,IAAI,MAAM;EAChC;EAEA,qBAAkB;AAChB,UAAM,SAAS,KAAK,eAAc;AAClC,QAAI,QAAQ,UAAU;AACpB,aAAO,SAAQ;IACjB;AACA,SAAK,eAAe,IAAI,IAAI;EAC9B;EAEA,gBAAa;AACX,UAAM,SAAS,KAAK,eAAc;AAClC,QAAI,QAAQ,WAAW;AACrB,aAAO,UAAS;IAClB;AACA,SAAK,eAAe,IAAI,IAAI;EAC9B;;EAIA,aAAa,OAAe,cAAc,OAAK;AAC7C,SAAK,gBAAgB,IAAI;MACvB,MAAM;MACN;MACA,UAAU;MACV;KACD;EACH;EAEA,eAAe,UAAkB,SAAgB;AAC/C,SAAK,gBAAgB,OAAO,OAAM,iCAC7B,IAD6B;MAEhC;MACA;MACA;EACJ;EAEA,eAAY;AACV,SAAK,gBAAgB,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAM,MAAK,EAAG;EAC1D;;EAIA,YAAY,QAA4B;AACtC,SAAK,sBAAsB,IAAI,MAAM;AACrC,SAAK,oBAAoB,IAAI,IAAI;AAEjC,UAAM,WAAW,OAAO,YAAY;AACpC,eAAW,MAAK;AACd,WAAK,oBAAoB,IAAI,KAAK;AAClC,WAAK,sBAAsB,IAAI,IAAI;IACrC,GAAG,QAAQ;EACb;EAEA,cAAW;AACT,SAAK,oBAAoB,IAAI,KAAK;AAClC,SAAK,sBAAsB,IAAI,IAAI;EACrC;;EAIA,kBAAkB,MAA0B,MAAY,OAAc;AACpE,SAAK,qBAAqB,IAAI;MAC5B,MAAM;MACN;MACA;MACA;KACD;EACH;EAEA,oBAAiB;AACf,SAAK,qBAAqB,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAM,MAAK,EAAG;EAC/D;;EAIA,cAAW;AACT,SAAK,mBAAmB,IAAI,IAAI;EAClC;EAEA,eAAY;AACV,SAAK,mBAAmB,IAAI,KAAK;EACnC;;EAIA,cAAc,SAAc;AAC1B,SAAK,kBAAkB,IAAI,OAAO;AAClC,SAAK,wBAAwB,IAAI,IAAI;EACvC;EAEA,iBAAc;AACZ,SAAK,wBAAwB,IAAI,KAAK;AACtC,SAAK,kBAAkB,IAAI,CAAA,CAAE;EAC/B;;EAIA,gBAAgB,SAAc;AAC5B,SAAK,oBAAoB,IAAI,OAAO;AACpC,SAAK,uBAAuB,IAAI,IAAI;EACtC;EAEA,mBAAgB;AACd,SAAK,uBAAuB,IAAI,KAAK;AACrC,SAAK,oBAAoB,IAAI,CAAA,CAAE;EACjC;;EAIA,qBAAqBA,QAAU;AAC7B,SAAK,uBAAuB,IAAIA,MAAK;AACrC,SAAK,4BAA4B,IAAI,IAAI;EAC3C;EAEA,wBAAqB;AACnB,SAAK,4BAA4B,IAAI,KAAK;AAC1C,SAAK,uBAAuB,IAAI,IAAI;EACtC;;EAIA,gBAAgB,UAAa;AAC3B,SAAK,qBAAqB,IAAI,QAAQ;AACtC,SAAK,uBAAuB,IAAI,IAAI;EACtC;EAEA,mBAAgB;AACd,SAAK,uBAAuB,IAAI,KAAK;AACrC,SAAK,qBAAqB,IAAI,IAAI;EACpC;;EAIA,aAAa,UAAa;AACxB,SAAK,kBAAkB,IAAI,QAAQ;AACnC,SAAK,oBAAoB,IAAI,IAAI;EACnC;EAEA,gBAAa;AACX,SAAK,oBAAoB,IAAI,KAAK;AAClC,SAAK,kBAAkB,IAAI,IAAI;EACjC;;;;;;EAQA,OAAO,QAAyB;AAC9B,SAAK,kBAAkB,IAAI,OAAO,gBAAgB,EAAE;AACpD,SAAK,kBAAkB,IAAI,IAAI;AAC/B,SAAK,aAAa,IAAI,MAAM;EAC9B;;;;EAKA,iBAAiB,OAAa;AAC5B,SAAK,kBAAkB,IAAI,KAAK;AAEhC,SAAK,kBAAkB,IAAI,IAAI;EACjC;;;;EAKA,eAAY;AACV,UAAM,SAAS,KAAK,aAAY;AAChC,UAAM,QAAQ,KAAK,kBAAiB;AAEpC,QAAI,CAAC;AAAQ;AAGb,QAAI,OAAO,WAAW;AACpB,YAAM,QAAQ,OAAO,UAAU,KAAK;AACpC,UAAI,OAAO;AACT,aAAK,kBAAkB,IAAI,KAAK;AAChC;MACF;IACF;AAGA,QAAI,CAAC,MAAM,KAAI,GAAI;AACjB,WAAK,kBAAkB,IAAI,gCAAO;AAClC;IACF;AAGA,QAAI,OAAO,WAAW;AACpB,aAAO,UAAU,MAAM,KAAI,CAAE;IAC/B;AAGA,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,kBAAkB,IAAI,EAAE;AAC7B,SAAK,kBAAkB,IAAI,IAAI;EACjC;;;;EAKA,cAAW;AACT,UAAM,SAAS,KAAK,aAAY;AAChC,QAAI,QAAQ,UAAU;AACpB,aAAO,SAAQ;IACjB;AACA,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,kBAAkB,IAAI,EAAE;AAC7B,SAAK,kBAAkB,IAAI,IAAI;EACjC;;;uCAhSW,gBAAa;IAAA;EAAA;;4EAAb,gBAAa,SAAb,eAAa,WAAA,YAFZ,OAAM,CAAA;EAAA;;;sEAEP,eAAa,CAAA;UAHzB;WAAW;MACV,YAAY;KACb;;;;;AC1DD,IAAI;AAAA,CACH,SAAUC,wBAAuB;AAChC,EAAAA,uBAAsBA,uBAAsB,OAAO,IAAI,CAAC,IAAI;AAC5D,EAAAA,uBAAsBA,uBAAsB,YAAY,IAAI,CAAC,IAAI;AACjE,EAAAA,uBAAsBA,uBAAsB,UAAU,IAAI,CAAC,IAAI;AAC/D,EAAAA,uBAAsBA,uBAAsB,OAAO,IAAI,CAAC,IAAI;AAC5D,EAAAA,uBAAsBA,uBAAsB,SAAS,IAAI,CAAC,IAAI;AAC9D,EAAAA,uBAAsBA,uBAAsB,WAAW,IAAI,CAAC,IAAI;AAChE,EAAAA,uBAAsBA,uBAAsB,OAAO,IAAI,CAAC,IAAI;AAC5D,EAAAA,uBAAsBA,uBAAsB,SAAS,IAAI,CAAC,IAAI;AAC9D,EAAAA,uBAAsBA,uBAAsB,WAAW,IAAI,CAAC,IAAI;AAChE,EAAAA,uBAAsBA,uBAAsB,cAAc,IAAI,CAAC,IAAI;AACnE,EAAAA,uBAAsBA,uBAAsB,YAAY,IAAI,EAAE,IAAI;AAClE,EAAAA,uBAAsBA,uBAAsB,OAAO,IAAI,EAAE,IAAI;AAC7D,EAAAA,uBAAsBA,uBAAsB,SAAS,IAAI,EAAE,IAAI;AACjE,GAAG,0BAA0B,wBAAwB,CAAC,EAAE;AACxD,IAAM,aAAa;AACnB,SAAS,QAAQ,MAAM,aAAa;AAClC,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B;AAAA,IACA;AAAA,IACA,SAAS,CAAC;AAAA,EACZ;AACF;AACA,SAAS,QAAQ,SAAS,SAAS,MAAM;AACvC,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B;AAAA,IACA;AAAA,EACF;AACF;AACA,SAAS,MAAM,OAAO,UAAU,MAAM;AACpC,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B;AAAA,IACA;AAAA,EACF;AACF;AACA,SAAS,SAAS,OAAO,UAAU,MAAM;AACvC,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B;AAAA,IACA;AAAA,EACF;AACF;AACA,SAAS,MAAM,QAAQ;AACrB,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B,QAAQ;AAAA,IACR,QAAQ;AAAA,EACV;AACF;AAeA,SAAS,WAAW,iBAAiB,OAAO,UAAU,MAAM;AAC1D,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B,MAAM;AAAA,IACN,WAAW;AAAA,IACX;AAAA,EACF;AACF;AAQA,SAAS,aAAa,UAAU,MAAM;AACpC,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B;AAAA,EACF;AACF;AAQA,SAAS,MAAM,UAAUC,YAAW,UAAU,MAAM;AAClD,SAAO;AAAA,IACL,MAAM,sBAAsB;AAAA,IAC5B;AAAA,IACA,WAAAA;AAAA,IACA;AAAA,EACF;AACF;AASA,IAAM,sBAAN,MAA0B;AAAA,EACxB,aAAa,CAAC;AAAA,EACd,cAAc,CAAC;AAAA,EACf,gBAAgB,CAAC;AAAA,EACjB,qBAAqB,CAAC;AAAA,EACtB,sBAAsB,CAAC;AAAA,EACvB,WAAW;AAAA,EACX,aAAa;AAAA,EACb,YAAY;AAAA,EACZ,YAAY;AAAA,EACZ,eAAe;AAAA,EACf;AAAA,EACA,YAAY,WAAW,GAAG,QAAQ,GAAG;AACnC,SAAK,YAAY,WAAW;AAAA,EAC9B;AAAA,EACA,YAAY;AACV,QAAI,CAAC,KAAK,WAAW;AACnB,WAAK,YAAY;AACjB,WAAK,WAAW,QAAQ,QAAM,GAAG,CAAC;AAClC,WAAK,aAAa,CAAC;AAAA,IACrB;AAAA,EACF;AAAA,EACA,QAAQ,IAAI;AACV,SAAK,oBAAoB,KAAK,EAAE;AAChC,SAAK,YAAY,KAAK,EAAE;AAAA,EAC1B;AAAA,EACA,OAAO,IAAI;AACT,SAAK,mBAAmB,KAAK,EAAE;AAC/B,SAAK,WAAW,KAAK,EAAE;AAAA,EACzB;AAAA,EACA,UAAU,IAAI;AACZ,SAAK,cAAc,KAAK,EAAE;AAAA,EAC5B;AAAA,EACA,aAAa;AACX,WAAO,KAAK;AAAA,EACd;AAAA,EACA,OAAO;AAAA,EAAC;AAAA,EACR,OAAO;AACL,QAAI,CAAC,KAAK,WAAW,GAAG;AACtB,WAAK,SAAS;AACd,WAAK,iBAAiB;AAAA,IACxB;AACA,SAAK,WAAW;AAAA,EAClB;AAAA,EACA,mBAAmB;AACjB,mBAAe,MAAM,KAAK,UAAU,CAAC;AAAA,EACvC;AAAA,EACA,WAAW;AACT,SAAK,YAAY,QAAQ,QAAM,GAAG,CAAC;AACnC,SAAK,cAAc,CAAC;AAAA,EACtB;AAAA,EACA,QAAQ;AAAA,EAAC;AAAA,EACT,UAAU;AAAA,EAAC;AAAA,EACX,SAAS;AACP,SAAK,UAAU;AAAA,EACjB;AAAA,EACA,UAAU;AACR,QAAI,CAAC,KAAK,YAAY;AACpB,WAAK,aAAa;AAClB,UAAI,CAAC,KAAK,WAAW,GAAG;AACtB,aAAK,SAAS;AAAA,MAChB;AACA,WAAK,OAAO;AACZ,WAAK,cAAc,QAAQ,QAAM,GAAG,CAAC;AACrC,WAAK,gBAAgB,CAAC;AAAA,IACxB;AAAA,EACF;AAAA,EACA,QAAQ;AACN,SAAK,WAAW;AAChB,SAAK,YAAY;AACjB,SAAK,cAAc,KAAK;AACxB,SAAK,aAAa,KAAK;AAAA,EACzB;AAAA,EACA,YAAY,UAAU;AACpB,SAAK,YAAY,KAAK,YAAY,WAAW,KAAK,YAAY;AAAA,EAChE;AAAA,EACA,cAAc;AACZ,WAAO,KAAK,YAAY,KAAK,YAAY,KAAK,YAAY;AAAA,EAC5D;AAAA,EACA,gBAAgB,WAAW;AACzB,UAAM,UAAU,aAAa,UAAU,KAAK,cAAc,KAAK;AAC/D,YAAQ,QAAQ,QAAM,GAAG,CAAC;AAC1B,YAAQ,SAAS;AAAA,EACnB;AACF;AAEA,IAAM,uBAAN,MAA2B;AAAA,EACzB,aAAa,CAAC;AAAA,EACd,cAAc,CAAC;AAAA,EACf,YAAY;AAAA,EACZ,WAAW;AAAA,EACX,aAAa;AAAA,EACb,gBAAgB,CAAC;AAAA,EACjB,eAAe;AAAA,EACf,YAAY;AAAA,EACZ;AAAA,EACA,YAAY,UAAU;AACpB,SAAK,UAAU;AACf,QAAI,YAAY;AAChB,QAAI,eAAe;AACnB,QAAI,aAAa;AACjB,UAAM,QAAQ,KAAK,QAAQ;AAC3B,QAAI,SAAS,GAAG;AACd,qBAAe,MAAM,KAAK,UAAU,CAAC;AAAA,IACvC,OAAO;AACL,WAAK,QAAQ,QAAQ,YAAU;AAC7B,eAAO,OAAO,MAAM;AAClB,cAAI,EAAE,aAAa,OAAO;AACxB,iBAAK,UAAU;AAAA,UACjB;AAAA,QACF,CAAC;AACD,eAAO,UAAU,MAAM;AACrB,cAAI,EAAE,gBAAgB,OAAO;AAC3B,iBAAK,WAAW;AAAA,UAClB;AAAA,QACF,CAAC;AACD,eAAO,QAAQ,MAAM;AACnB,cAAI,EAAE,cAAc,OAAO;AACzB,iBAAK,SAAS;AAAA,UAChB;AAAA,QACF,CAAC;AAAA,MACH,CAAC;AAAA,IACH;AACA,SAAK,YAAY,KAAK,QAAQ,OAAO,CAAC,MAAM,WAAW,KAAK,IAAI,MAAM,OAAO,SAAS,GAAG,CAAC;AAAA,EAC5F;AAAA,EACA,YAAY;AACV,QAAI,CAAC,KAAK,WAAW;AACnB,WAAK,YAAY;AACjB,WAAK,WAAW,QAAQ,QAAM,GAAG,CAAC;AAClC,WAAK,aAAa,CAAC;AAAA,IACrB;AAAA,EACF;AAAA,EACA,OAAO;AACL,SAAK,QAAQ,QAAQ,YAAU,OAAO,KAAK,CAAC;AAAA,EAC9C;AAAA,EACA,QAAQ,IAAI;AACV,SAAK,YAAY,KAAK,EAAE;AAAA,EAC1B;AAAA,EACA,WAAW;AACT,QAAI,CAAC,KAAK,WAAW,GAAG;AACtB,WAAK,WAAW;AAChB,WAAK,YAAY,QAAQ,QAAM,GAAG,CAAC;AACnC,WAAK,cAAc,CAAC;AAAA,IACtB;AAAA,EACF;AAAA,EACA,OAAO,IAAI;AACT,SAAK,WAAW,KAAK,EAAE;AAAA,EACzB;AAAA,EACA,UAAU,IAAI;AACZ,SAAK,cAAc,KAAK,EAAE;AAAA,EAC5B;AAAA,EACA,aAAa;AACX,WAAO,KAAK;AAAA,EACd;AAAA,EACA,OAAO;AACL,QAAI,CAAC,KAAK,cAAc;AACtB,WAAK,KAAK;AAAA,IACZ;AACA,SAAK,SAAS;AACd,SAAK,QAAQ,QAAQ,YAAU,OAAO,KAAK,CAAC;AAAA,EAC9C;AAAA,EACA,QAAQ;AACN,SAAK,QAAQ,QAAQ,YAAU,OAAO,MAAM,CAAC;AAAA,EAC/C;AAAA,EACA,UAAU;AACR,SAAK,QAAQ,QAAQ,YAAU,OAAO,QAAQ,CAAC;AAAA,EACjD;AAAA,EACA,SAAS;AACP,SAAK,UAAU;AACf,SAAK,QAAQ,QAAQ,YAAU,OAAO,OAAO,CAAC;AAAA,EAChD;AAAA,EACA,UAAU;AACR,SAAK,WAAW;AAAA,EAClB;AAAA,EACA,aAAa;AACX,QAAI,CAAC,KAAK,YAAY;AACpB,WAAK,aAAa;AAClB,WAAK,UAAU;AACf,WAAK,QAAQ,QAAQ,YAAU,OAAO,QAAQ,CAAC;AAC/C,WAAK,cAAc,QAAQ,QAAM,GAAG,CAAC;AACrC,WAAK,gBAAgB,CAAC;AAAA,IACxB;AAAA,EACF;AAAA,EACA,QAAQ;AACN,SAAK,QAAQ,QAAQ,YAAU,OAAO,MAAM,CAAC;AAC7C,SAAK,aAAa;AAClB,SAAK,YAAY;AACjB,SAAK,WAAW;AAAA,EAClB;AAAA,EACA,YAAY,GAAG;AACb,UAAM,iBAAiB,IAAI,KAAK;AAChC,SAAK,QAAQ,QAAQ,YAAU;AAC7B,YAAM,WAAW,OAAO,YAAY,KAAK,IAAI,GAAG,iBAAiB,OAAO,SAAS,IAAI;AACrF,aAAO,YAAY,QAAQ;AAAA,IAC7B,CAAC;AAAA,EACH;AAAA,EACA,cAAc;AACZ,UAAM,gBAAgB,KAAK,QAAQ,OAAO,CAAC,cAAc,WAAW;AAClE,YAAM,qBAAqB,iBAAiB,QAAQ,OAAO,YAAY,aAAa;AACpF,aAAO,qBAAqB,SAAS;AAAA,IACvC,GAAG,IAAI;AACP,WAAO,iBAAiB,OAAO,cAAc,YAAY,IAAI;AAAA,EAC/D;AAAA,EACA,gBAAgB;AACd,SAAK,QAAQ,QAAQ,YAAU;AAC7B,UAAI,OAAO,eAAe;AACxB,eAAO,cAAc;AAAA,MACvB;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EACA,gBAAgB,WAAW;AACzB,UAAM,UAAU,aAAa,UAAU,KAAK,cAAc,KAAK;AAC/D,YAAQ,QAAQ,QAAM,GAAG,CAAC;AAC1B,YAAQ,SAAS;AAAA,EACnB;AACF;AAEA,IAAM,kBAAa;;;ACpUnB,IAAM,mBAAN,MAAM,kBAAiB;AAAA,EACrB,OAAO,YAAO,SAAS,yBAAyB,mBAAmB;AACjE,WAAO,KAAK,qBAAqB,mBAAkB;AAAA,EACrD;AAAA,EACA,OAAO,aAAuB,gBAAG,6BAAmB;AAAA,IAClD,OAAO;AAAA,IACP,SAAS,OAAO,MAAM,OAAO,uBAAuB,GAAG;AAAA,IACvD,YAAY;AAAA,EACd,CAAC;AACH;AAAA,CACC,MAAM;AACL,GAAC,OAAO,cAAc,eAAe,cAAiB,iBAAkB,kBAAkB,CAAC;AAAA,IACzF,MAAM;AAAA,IACN,MAAM,CAAC;AAAA,MACL,YAAY;AAAA,MACZ,YAAY,MAAM,OAAO,uBAAuB;AAAA,IAClD,CAAC;AAAA,EACH,CAAC,GAAG,MAAM,IAAI;AAChB,GAAG;AACH,IAAM,mBAAN,MAAuB;AAAC;AACxB,IAAM,0BAAN,MAAM,iCAAgC,iBAAiB;AAAA,EACrD,sBAAsB,OAAO,uBAAuB;AAAA,IAClD,UAAU;AAAA,EACZ,CAAC;AAAA,EACD,mBAAmB;AAAA,EACnB;AAAA,EACA,YAAY,cAAc,KAAK;AAC7B,UAAM;AACN,UAAM,WAAW;AAAA,MACf,IAAI;AAAA,MACJ,eAAe,kBAAkB;AAAA,MACjC,QAAQ,CAAC;AAAA,MACT,MAAM;AAAA,QACJ,WAAW,CAAC;AAAA,MACd;AAAA,IACF;AACA,SAAK,YAAY,aAAa,eAAe,IAAI,MAAM,QAAQ;AAC/D,QAAI,KAAK,wBAAwB,QAAQ,CAAC,oBAAoB,KAAK,SAAS,GAAG;AAC7E,YAAM,IAAI,aAAc,OAAO,OAAO,cAAc,eAAe,cAAc,4OAAiP;AAAA,IACpU;AAAA,EACF;AAAA,EACA,MAAMC,YAAW;AACf,UAAM,KAAK,KAAK;AAChB,SAAK;AACL,UAAM,QAAQ,MAAM,QAAQA,UAAS,IAAI,SAASA,UAAS,IAAIA;AAC/D,0BAAsB,KAAK,WAAW,MAAM,IAAI,YAAY,CAAC,KAAK,CAAC;AACnE,WAAO,IAAI,wBAAwB,IAAI,KAAK,SAAS;AAAA,EACvD;AAAA,EACA,OAAO,YAAO,SAAS,gCAAgC,mBAAmB;AACxE,WAAO,KAAK,qBAAqB,0BAA4B,mBAAY,gBAAgB,GAAM,mBAAS,QAAQ,CAAC;AAAA,EACnH;AAAA,EACA,OAAO,aAAuB,gBAAG,6BAAmB;AAAA,IAClD,OAAO;AAAA,IACP,SAAS,yBAAwB;AAAA,IACjC,YAAY;AAAA,EACd,CAAC;AACH;AAAA,CACC,MAAM;AACL,GAAC,OAAO,cAAc,eAAe,cAAiB,iBAAkB,yBAAyB,CAAC;AAAA,IAChG,MAAM;AAAA,IACN,MAAM,CAAC;AAAA,MACL,YAAY;AAAA,IACd,CAAC;AAAA,EACH,CAAC,GAAG,MAAM,CAAC;AAAA,IACT,MAAS;AAAA,EACX,GAAG;AAAA,IACD,MAAM;AAAA,IACN,YAAY,CAAC;AAAA,MACX,MAAM;AAAA,MACN,MAAM,CAAC,QAAQ;AAAA,IACjB,CAAC;AAAA,EACH,CAAC,GAAG,IAAI;AACV,GAAG;AACH,IAAM,0BAAN,cAAsC,iBAAiB;AAAA,EACrD;AAAA,EACA;AAAA,EACA,YAAY,KAAK,WAAW;AAC1B,UAAM;AACN,SAAK,MAAM;AACX,SAAK,YAAY;AAAA,EACnB;AAAA,EACA,OAAO,SAAS,SAAS;AACvB,WAAO,IAAI,wBAAwB,KAAK,KAAK,SAAS,WAAW,CAAC,GAAG,KAAK,SAAS;AAAA,EACrF;AACF;AACA,IAAM,0BAAN,MAA8B;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA,eAAe;AAAA,EACf,WAAW;AAAA,EACX,YAAY,IAAI,SAAS,SAAS,WAAW;AAC3C,SAAK,KAAK;AACV,SAAK,UAAU;AACf,SAAK,YAAY;AACjB,SAAK,SAAS,UAAU,OAAO;AAAA,EACjC;AAAA,EACA,QAAQ,WAAW,UAAU;AAC3B,WAAO,KAAK,UAAU,OAAO,KAAK,SAAS,KAAK,KAAK,EAAE,IAAI,SAAS,IAAI,QAAQ;AAAA,EAClF;AAAA,EACA,SAAS,YAAY,MAAM;AACzB,0BAAsB,KAAK,WAAW,KAAK,SAAS,KAAK,IAAI,SAAS,IAAI;AAAA,EAC5E;AAAA,EACA,OAAO,IAAI;AACT,SAAK,QAAQ,QAAQ,EAAE;AAAA,EACzB;AAAA,EACA,QAAQ,IAAI;AACV,SAAK,QAAQ,SAAS,EAAE;AAAA,EAC1B;AAAA,EACA,UAAU,IAAI;AACZ,SAAK,QAAQ,WAAW,EAAE;AAAA,EAC5B;AAAA,EACA,OAAO;AACL,SAAK,SAAS,MAAM;AAAA,EACtB;AAAA,EACA,aAAa;AACX,WAAO,KAAK;AAAA,EACd;AAAA,EACA,OAAO;AACL,SAAK,SAAS,MAAM;AACpB,SAAK,WAAW;AAAA,EAClB;AAAA,EACA,QAAQ;AACN,SAAK,SAAS,OAAO;AAAA,EACvB;AAAA,EACA,UAAU;AACR,SAAK,SAAS,SAAS;AAAA,EACzB;AAAA,EACA,SAAS;AACP,SAAK,SAAS,QAAQ;AAAA,EACxB;AAAA,EACA,UAAU;AACR,SAAK,SAAS,SAAS;AAAA,EACzB;AAAA,EACA,QAAQ;AACN,SAAK,SAAS,OAAO;AACrB,SAAK,WAAW;AAAA,EAClB;AAAA,EACA,YAAY,GAAG;AACb,SAAK,SAAS,eAAe,CAAC;AAAA,EAChC;AAAA,EACA,cAAc;AACZ,WAAO,wBAAwB,KAAK,SAAS,GAAG,QAAQ,QAAQ,KAAK,EAAE,GAAG,YAAY,KAAK;AAAA,EAC7F;AAAA,EACA,YAAY;AACd;AACA,SAAS,sBAAsB,UAAU,SAAS,IAAI,SAAS,MAAM;AACnE,WAAS,YAAY,SAAS,KAAK,EAAE,IAAI,OAAO,IAAI,IAAI;AAC1D;AACA,SAAS,wBAAwB,UAAU;AACzC,QAAM,OAAO,SAAS;AACtB,MAAI,SAAS,GAAG;AACd,WAAO;AAAA,EACT,WAAW,SAAS,GAAG;AACrB,WAAO,SAAS;AAAA,EAClB;AACA,SAAO;AACT;AACA,SAAS,oBAAoB,UAAU;AACrC,QAAM,OAAO,SAAS;AACtB,SAAO,SAAS,KAAK,SAAS;AAChC;;;ACtJO,IAAM,gBAAgB,QAAQ,mBAAmB;EACtD,WAAW,WAAW;;IAEpB,MAAM,kBAAkB;MACtB,MAAM;QACJ,UAAU;QACV,KAAK;QACL,MAAM;QACN,OAAO;QACP,SAAS;OACV;OACA,EAAE,UAAU,KAAI,CAAE;;IAGrB,MAAM,UAAU;MACd,QAAQ,kBAAkB,MAAM,EAAE,SAAS,EAAC,CAAE,CAAC;OAC9C,EAAE,UAAU,KAAI,CAAE;;IAGrB,MAAM,UAAU;MACd,QAAQ,iBAAiB,MAAM,EAAE,SAAS,EAAC,CAAE,CAAC;OAC7C,EAAE,UAAU,KAAI,CAAE;GACtB;CACF;AAMM,IAAM,iBAAiB,QAAQ,mBAAmB;EACvD,WAAW,UAAU;IACnB,MAAM,kBAAkB;MACtB,MAAM;QACJ,UAAU;QACV,KAAK;QACL,MAAM;QACN,OAAO;OACR;OACA,EAAE,UAAU,KAAI,CAAE;IAErB,MAAM;MACJ,MAAM,UAAU;QACd,QAAQ,kBAAkB,MAAM;UAC9B,WAAW;UACX,SAAS;SACV,CAAC;SACD,EAAE,UAAU,KAAI,CAAE;MAErB,MAAM,UAAU;QACd,MAAM;UACJ,WAAW;UACX,SAAS;SACV;QACD,QAAQ,kBAAkB,MAAM;UAC9B,WAAW;UACX,SAAS;SACV,CAAC;SACD,EAAE,UAAU,KAAI,CAAE;KACtB;GACF;CACF;AAMM,IAAM,iBAAiB,QAAQ,mBAAmB;EACvD,WAAW,WAAW;IACpB,MAAM,kBAAkB;MACtB,MAAM;QACJ,UAAU;QACV,KAAK;QACL,MAAM;QACN,OAAO;OACR;OACA,EAAE,UAAU,KAAI,CAAE;IAErB,MAAM,UAAU;MACd,QAAQ,kBAAkB,MAAM;QAC9B,WAAW;QACX,SAAS;OACV,CAAC;OACD,EAAE,UAAU,KAAI,CAAE;IAErB,MAAM,UAAU;MACd,MAAM;QACJ,WAAW;QACX,SAAS;OACV;MACD,QAAQ,kBAAkB,MAAM;QAC9B,WAAW;QACX,SAAS;OACV,CAAC;OACD,EAAE,UAAU,KAAI,CAAE;GACtB;CACF;AAMM,IAAM,mBAAmB,QAAQ,mBAAmB;EACzD,WAAW,WAAW;IACpB,MAAM,kBAAkB;MACtB,MAAM;QACJ,UAAU;QACV,KAAK;QACL,MAAM;QACN,OAAO;OACR;OACA,EAAE,UAAU,KAAI,CAAE;IAErB,MAAM,UAAU;MACd,QAAQ,kBAAkB,MAAM;QAC9B,WAAW;QACX,SAAS;OACV,CAAC;OACD,EAAE,UAAU,KAAI,CAAE;IAErB,MAAM,UAAU;MACd,MAAM;QACJ,WAAW;QACX,SAAS;OACV;MACD,QAAQ,kBAAkB,MAAM;QAC9B,WAAW;QACX,SAAS;OACV,CAAC;OACD,EAAE,UAAU,KAAI,CAAE;GACtB;CACF;AAMM,IAAM,wBAAwB,QAAQ,mBAAmB;EAC9D,WAAW,WAAW;;IAEpB,MAAM,EAAE,UAAU,WAAU,CAAE;IAE9B,MAAM,kBAAkB;MACtB,MAAM;QACJ,UAAU;QACV,KAAK;QACL,MAAM;QACN,OAAO;QACP,QAAQ;OACT;OACA,EAAE,UAAU,KAAI,CAAE;;IAGrB,MAAM;MACJ,MAAM,UAAU;QACd,MAAM,EAAE,SAAS,GAAG,WAAW,WAAU,CAAE;QAC3C,QAAQ,kBAAkB,MAAM;UAC9B,SAAS;UACT,WAAW;SACZ,CAAC;SACD,EAAE,UAAU,KAAI,CAAE;MAErB,MAAM,UAAU;QACd,MAAM,EAAE,SAAS,GAAG,WAAW,cAAa,CAAE;QAC9C,QAAQ,wBAAwB,MAAM;UACpC,SAAS;UACT,WAAW;SACZ,CAAC;SACD,EAAE,UAAU,KAAI,CAAE;KACtB;;IAGD,MAAM,UAAU,aAAY,GAAI,EAAE,UAAU,KAAI,CAAE;GACnD;CACF;AAKM,IAAM,cAAc,QAAQ,mBAAmB,CAAA,CAAE;;;ACxKjD,IAAM,oBAAuC;EAClD;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,SAAS;;EAEX;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,SAAS;;EAEX;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,SAAS;;EAEX;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,SAAS;;EAEX;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,SAAS;;EAEX;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,SAAS;;;AAMN,IAAM,gBAAiE;EAC5E,WAAW;EACX,QAAQ;EACR,SAAS;EACT,SAAS;EACT,WAAW;EACX,QAAQ;;AAQJ,IAAO,yBAAP,MAAO,wBAAsB;EAejC,cAAA;AAbQ,SAAA,iBAAiB,OAAsB,WAAS,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAExD,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAG9C,SAAA,gBAAgB,SAAS,MAAK;AAC5B,YAAM,OAAO,KAAK,eAAc;AAChC,aAAO,kBAAkB,KAAK,SAAO,IAAI,OAAO,IAAI,KAAK,kBAAkB,CAAC;IAC9E,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAGQ,SAAA,UAAU;AAIjB,SAAK,gBAAe;EACtB;;;;EAKA,iBAAiB,MAAmB;AAClC,SAAK,eAAe,IAAI,IAAI;AAC5B,SAAK,cAAa;EACpB;;;;EAKA,eAAY;AACV,WAAO,cAAc,KAAK,eAAc,CAAE;EAC5C;;;;EAKA,gBAAa;AACX,UAAM,UAAU,KAAK,eAAc;AACnC,UAAM,eAAe,kBAAkB,UAAU,SAAO,IAAI,OAAO,OAAO;AAC1E,UAAM,aAAa,eAAe,KAAK,kBAAkB;AACzD,SAAK,iBAAiB,kBAAkB,SAAS,EAAE,EAAE;EACvD;;;;EAKA,iBAAc;AACZ,SAAK,iBAAiB,SAAS;EACjC;;;;EAKA,sBAAmB;AACjB,WAAO,KAAK,eAAc,MAAO;EACnC;;EAIQ,kBAAe;AACrB,QAAI;AACF,YAAM,QAAQ,aAAa,QAAQ,mBAAmB;AACtD,UAAI,SAAS,kBAAkB,KAAK,SAAO,IAAI,OAAO,KAAK,GAAG;AAC5D,aAAK,eAAe,IAAI,KAAsB;MAChD;IACF,SAAS,GAAG;IAEZ;EACF;EAEQ,gBAAa;AACnB,QAAI;AACF,mBAAa,QAAQ,qBAAqB,KAAK,eAAc,CAAE;IACjE,SAAS,GAAG;IAEZ;EACF;;;uCA9EW,yBAAsB;IAAA;EAAA;;4EAAtB,yBAAsB,SAAtB,wBAAsB,WAAA,YAFrB,OAAM,CAAA;EAAA;;;sEAEP,wBAAsB,CAAA;UAHlC;WAAW;MACV,YAAY;KACb;;;;;ACxCM,IAAM,mBAAgC;EAC3C,OAAO;EACP,UAAU;EACV,kBAAkB;EAClB,eAAe;EACf,aAAa;EACb,aAAa;EACb,mBAAmB;EACnB,cAAc;EACd,UAAU;EACV,aAAa;EACb,iBAAiB;EACjB,UAAU;;AAQN,IAAO,kBAAP,MAAO,iBAAe;EAiC1B,cAAA;AAhCQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAC3B,SAAA,OAAO,OAAO,WAAW;AAIzB,SAAA,YAAY,OAAoB,kBAAgB,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAChD,SAAA,eAAe,OAAuB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AACxC,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,WAAW,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAE/B,SAAA,WAAW,KAAK,UAAU,WAAU;AACpC,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,UAAU,KAAK,SAAS,WAAU;AAIlC,SAAA,QAAQ,SAAS,MAAM,KAAK,UAAS,EAAG,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AAC7C,SAAA,WAAW,SAAS,MAAM,KAAK,UAAS,EAAG,UAAQ,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AACnD,SAAA,mBAAmB,SAAS,MAAM,KAAK,UAAS,EAAG,kBAAgB,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAEnE,SAAA,oBAAoB,SAAS,MAAK;AAChC,YAAM,QAAQ,KAAK,aAAY;AAC/B,aAAO,CAAC,EAAE,MAAM,gBAAgB,MAAM;IACxC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,yBAAyB,SAAS,MAAK;AACrC,YAAM,QAAQ,KAAK,aAAY;AAC/B,aAAO,CAAC,EAAE,MAAM,iBAAiB,MAAM;IACzC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,yBAAA,CAAA,IAAA,CAAA,CAAA;AAGC,SAAK,kBAAiB;AACtB,SAAK,aAAY;EACnB;;EAIQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,mBAAmB,CAAC,SAAqB;AACnD,WAAK,UAAU,IAAI,kCAAK,mBAAqB,KAAM;AACnD,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,kBAAkB,MAAK;AACjC,WAAK,SAAS,IAAI,KAAK;AACvB,WAAK,MAAM,QAAQ,gCAAO;IAC5B,CAAC;AAED,SAAK,IAAI,GAAG,sBAAsB,CAAC,SAAwB;AACzD,WAAK,aAAa,IAAI,IAAI;IAC5B,CAAC;EACH;;EAIA,eAAY;AACV,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,cAAc;AAC5B,SAAK,IAAI,KAAK,iBAAiB;EACjC;EAEA,eAAY;AACV,SAAK,IAAI,KAAK,iBAAiB,KAAK,UAAS,CAAE;EACjD;EAEA,cAA2C,KAAQ,OAAqB;AACtE,SAAK,UAAU,OAAO,OAAM,iCAAK,IAAL,EAAQ,CAAC,GAAG,GAAG,MAAK,EAAG;AACnD,SAAK,SAAS,IAAI,IAAI;EACxB;EAEA,gBAAa;AACX,QAAI,QAAQ,oEAAa,GAAG;AAC1B,WAAK,UAAU,IAAI,gBAAgB;AACnC,WAAK,SAAS,IAAI,IAAI;AACtB,WAAK,aAAY;IACnB;EACF;;EAIA,SAAS,OAAkC;AACzC,SAAK,cAAc,SAAS,KAAK;AACjC,SAAK,WAAW,KAAK;EACvB;EAEA,cAAW;AACT,UAAM,UAAU,KAAK,UAAS,EAAG;AACjC,UAAM,OAAO,YAAY,SAAS,UAAU;AAC5C,SAAK,SAAS,IAAI;EACpB;EAEQ,WAAW,OAAkC;AACnD,UAAM,OAAO,SAAS;AAEtB,QAAI,UAAU,UAAU;AACtB,YAAM,cAAc,OAAO,WAAW,8BAA8B,EAAE;AACtE,WAAK,aAAa,cAAc,cAAc,SAAS,OAAO;IAChE,OAAO;AACL,WAAK,aAAa,cAAc,KAAK;IACvC;EACF;;EAIA,YAAY,UAAkC;AAC5C,SAAK,cAAc,YAAY,QAAQ;AACvC,SAAK,KAAK,UAAU,QAAQ;EAC9B;;EAIA,gBAAa;AACX,UAAM,UAAU,KAAK,UAAS,EAAG;AACjC,SAAK,cAAc,oBAAoB,CAAC,OAAO;EACjD;EAEA,oBAAoB,WAAkB;AACpC,SAAK,cAAc,oBAAoB,SAAS;EAClD;;EAIA,gBAAgB,aAAoC;AAClD,SAAK,aAAa,OAAO,OAAM,kCAAK,IAAM,YAAc;AACxD,SAAK,IAAI,KAAK,oBAAoB,KAAK,aAAY,CAAE;AACrD,SAAK,MAAM,QAAQ,oCAAW;EAChC;EAEA,uBAAoB;AAClB,UAAM,MAAM,KAAK,aAAY,EAAG;AAChC,QAAI,CAAC,KAAK;AACR,WAAK,MAAM,MAAM,yCAAqB;AACtC;IACF;AAEA,SAAK,IAAI,KAAK,0BAA0B,EAAE,QAAQ,IAAG,CAAE;AACvD,SAAK,MAAM,KAAK,iDAAmB;EACrC;EAEA,uBAAoB;AAClB,UAAM,MAAM,KAAK,aAAY,EAAG;AAChC,QAAI,CAAC,KAAK;AACR,WAAK,MAAM,MAAM,yCAAqB;AACtC;IACF;AAEA,SAAK,IAAI,KAAK,0BAA0B,EAAE,QAAQ,IAAG,CAAE;AACvD,SAAK,MAAM,KAAK,iDAAmB;EACrC;EAEA,0BAAuB;AACrB,UAAM,QAAQ,KAAK,aAAY;AAC/B,QAAI,CAAC,MAAM,iBAAiB,CAAC,MAAM,iBAAiB;AAClD,WAAK,MAAM,MAAM,oDAAsB;AACvC;IACF;AAEA,SAAK,IAAI,KAAK,6BAA6B;MACzC,OAAO,MAAM;MACb,SAAS,MAAM;KAChB;AACD,SAAK,MAAM,KAAK,mDAAqB;EACvC;;EAIA,iBAAc;AACZ,UAAM,OAAO;MACX,UAAU,KAAK,UAAS;MACxB,aAAY,oBAAI,KAAI,GAAG,YAAW;;AAGpC,UAAM,OAAO,IAAI,KAAK,CAAC,KAAK,UAAU,MAAM,MAAM,CAAC,CAAC,GAAG,EAAE,MAAM,mBAAkB,CAAE;AACnF,UAAM,MAAM,IAAI,gBAAgB,IAAI;AAEpC,UAAM,IAAI,SAAS,cAAc,GAAG;AACpC,MAAE,OAAO;AACT,MAAE,WAAW,gBAAe,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,CAAC;AAClE,MAAE,MAAK;AAEP,QAAI,gBAAgB,GAAG;AACvB,SAAK,MAAM,QAAQ,gCAAO;EAC5B;EAEA,eAAe,MAAU;AACvB,UAAM,SAAS,IAAI,WAAU;AAE7B,WAAO,SAAS,CAAC,MAAK;AACpB,UAAI;AACF,cAAM,OAAO,KAAK,MAAM,EAAE,QAAQ,MAAgB;AAClD,YAAI,KAAK,UAAU;AACjB,eAAK,UAAU,IAAI,kCAAK,mBAAqB,KAAK,SAAU;AAC5D,eAAK,SAAS,IAAI,IAAI;AACtB,eAAK,aAAY;AACjB,eAAK,MAAM,QAAQ,gCAAO;QAC5B,OAAO;AACL,eAAK,MAAM,MAAM,4CAAS;QAC5B;MACF,SAAS,OAAO;AACd,aAAK,MAAM,MAAM,kDAAU;MAC7B;IACF;AAEA,WAAO,WAAW,IAAI;EACxB;;;uCA/MW,kBAAe;IAAA;EAAA;;4EAAf,kBAAe,SAAf,iBAAe,WAAA,YAFd,OAAM,CAAA;EAAA;;;sEAEP,iBAAe,CAAA;UAH3B;WAAW;MACV,YAAY;KACb;;;;;ACbM,IAAM,sBAAkC;EAC7C,UAAU;EACV,OAAO;EACP,aAAa;EACb,WAAW;EACX,cAAc;EACd,cAAc;EACd,WAAW;;AAQP,IAAO,gBAAP,MAAO,eAAa;;EAkCxB,cAAA;AAjCQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,YAAY,OAAmB,qBAAmB,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAClD,SAAA,kBAAkB,OAA2B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,YAAY,OAAsB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACpC,SAAA,gBAAgB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAC5B,SAAA,eAAe,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAC3B,SAAA,gBAAgB,OAAsB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAEhD,SAAA,WAAW,KAAK,UAAU,WAAU;AACpC,SAAA,iBAAiB,KAAK,gBAAgB,WAAU;AAChD,SAAA,WAAW,KAAK,UAAU,WAAU;AACpC,SAAA,eAAe,KAAK,cAAc,WAAU;AAC5C,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,eAAe,KAAK,cAAc,WAAU;AAI5C,SAAA,kBAAkB,SAAS,MACzB,KAAK,gBAAe,GAAI,YAAY,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAGxC,SAAA,cAAc,SAAS,OACpB,KAAK,gBAAe,GAAI,SAAS,UAAU,KAAK,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAGpD,SAAA,WAAW,SAAS,MAAM,KAAK,UAAS,EAAG,UAAQ,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAKjD,SAAK,kBAAiB;AACtB,SAAK,aAAY;EACnB;EAEQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,sBAAsB,CAAC,SAAoB;AACrD,WAAK,UAAU,IAAI,kCAAK,sBAAwB,KAAM;IACxD,CAAC;AAED,SAAK,IAAI,GAAG,eAAe,CAAC,SAA8C;AACxE,WAAK,cAAc,IAAI,KAAK;AAC5B,WAAK,WAAW,aAAa,KAAK,SAAS,KAAK,MAAM;IACxD,CAAC;AAED,SAAK,IAAI,GAAG,qBAAqB,CAAC,SAA2B;AAC3D,WAAK,cAAc,IAAI,KAAK;AAC5B,WAAK,MAAM,MAAM,gCAAY,KAAK,KAAK,EAAE;IAC3C,CAAC;AAED,SAAK,IAAI,GAAG,wBAAwB,CAAC,SAAgC;AACnE,WAAK,aAAa,IAAI,KAAK,SAAS;IACtC,CAAC;AAED,SAAK,IAAI,GAAG,wBAAwB,CAAC,aAA2B;AAC9D,WAAK,UAAU,IAAI,QAAQ;IAC7B,CAAC;AAED,SAAK,IAAI,GAAG,wBAAwB,CAAC,SAAuB;AAC1D,WAAK,cAAc,IAAI,IAAI;IAC7B,CAAC;EACH;;EAIA,eAAY;AACV,SAAK,IAAI,KAAK,iBAAiB;EACjC;EAEA,eAAY;AACV,SAAK,IAAI,KAAK,oBAAoB,KAAK,UAAS,CAAE;AAClD,SAAK,MAAM,QAAQ,mCAAU;EAC/B;EAEA,cAA0C,KAAQ,OAAoB;AACpE,SAAK,UAAU,OAAO,OAAM,iCAAK,IAAL,EAAQ,CAAC,GAAG,GAAG,MAAK,EAAG;EACrD;EAEA,YAAY,UAAoB;AAC9B,SAAK,cAAc,YAAY,QAAQ;AAGvC,UAAM,gBAA4C;MAChD,UAAU;MACV,UAAU;MACV,UAAU;MACV,SAAS;;AAGX,SAAK,cAAc,SAAS,cAAc,QAAQ,CAAC;EACrD;;EAIA,YAAY,SAAe;AACzB,QAAI,CAAC,QAAQ,KAAI,KAAM,KAAK,cAAa;AAAI;AAG7C,SAAK,WAAW,QAAQ,QAAQ,KAAI,CAAE;AAGtC,SAAK,cAAc,IAAI,IAAI;AAE3B,SAAK,IAAI,KAAK,wBAAwB;MACpC,QAAQ,QAAQ,KAAI;MACpB,UAAU,KAAK,UAAS;MACxB,SAAS,KAAK,gBAAe,EAAG,MAAM,GAAG;MACzC,WAAW,KAAK,UAAS,EAAG;KAC7B;EACH;EAEQ,WAAW,MAAuC,SAAiB,QAAe;AACxF,UAAM,UAAuB;MAC3B,IAAI,OAAO,WAAU;MACrB;MACA;MACA,YAAW,oBAAI,KAAI,GAAG,YAAW;MACjC;;AAGF,SAAK,gBAAgB,OAAO,aAAU;AACpC,UAAI,CAAC,SAAS;AAEZ,eAAO;UACL,IAAI,OAAO,WAAU;UACrB,OAAO,QAAQ,MAAM,GAAG,EAAE,KAAK,QAAQ,SAAS,KAAK,QAAQ;UAC7D,UAAU,CAAC,OAAO;UAClB,YAAW,oBAAI,KAAI,GAAG,YAAW;UACjC,YAAW,oBAAI,KAAI,GAAG,YAAW;;MAErC;AAEA,aAAO,iCACF,UADE;QAEL,UAAU,CAAC,GAAG,QAAQ,UAAU,OAAO;QACvC,YAAW,oBAAI,KAAI,GAAG,YAAW;;IAErC,CAAC;EACH;;EAIA,aAAU;AAER,UAAM,UAAU,KAAK,gBAAe;AACpC,QAAI,WAAW,QAAQ,SAAS,SAAS,GAAG;AAC1C,WAAK,YAAY,OAAO;IAC1B;AAEA,SAAK,gBAAgB,IAAI,IAAI;EAC/B;EAEA,YAAY,WAAiB;AAC3B,UAAM,UAAU,KAAK,UAAS,EAAG,KAAK,OAAK,EAAE,OAAO,SAAS;AAC7D,QAAI,SAAS;AACX,WAAK,gBAAgB,IAAI,OAAO;IAClC;EACF;EAEA,YAAY,SAAoB;AAC9B,SAAK,IAAI,KAAK,qBAAqB,OAAO;AAE1C,SAAK,UAAU,OAAO,cAAW;AAC/B,YAAM,QAAQ,SAAS,UAAU,OAAK,EAAE,OAAO,QAAQ,EAAE;AACzD,UAAI,SAAS,GAAG;AACd,iBAAS,KAAK,IAAI;AAClB,eAAO,CAAC,GAAG,QAAQ;MACrB;AACA,aAAO,CAAC,SAAS,GAAG,QAAQ;IAC9B,CAAC;EACH;EAEA,cAAc,WAAiB;AAC7B,QAAI,QAAQ,8DAAY,GAAG;AACzB,WAAK,IAAI,KAAK,uBAAuB,EAAE,UAAS,CAAE;AAClD,WAAK,UAAU,OAAO,cACpB,SAAS,OAAO,OAAK,EAAE,OAAO,SAAS,CAAC;AAG1C,UAAI,KAAK,gBAAe,GAAI,OAAO,WAAW;AAC5C,aAAK,gBAAgB,IAAI,IAAI;MAC/B;AAEA,WAAK,MAAM,QAAQ,gCAAO;IAC5B;EACF;EAEA,eAAY;AACV,QAAI,QAAQ,gFAAe,GAAG;AAC5B,WAAK,IAAI,KAAK,oBAAoB;AAClC,WAAK,UAAU,IAAI,CAAA,CAAE;AACrB,WAAK,gBAAgB,IAAI,IAAI;AAC7B,WAAK,MAAM,QAAQ,4CAAS;IAC9B;EACF;;EAIA,mBAAgB;AACd,SAAK,IAAI,KAAK,mBAAmB;EACnC;EAEA,eAAe,KAA0C;AACvD,SAAK,IAAI,KAAK,oBAAoB,GAAG;AACrC,SAAK,MAAM,KAAK,yCAAW;EAC7B;EAEA,kBAAkB,OAAa;AAC7B,QAAI,QAAQ,8DAAY,GAAG;AACzB,WAAK,IAAI,KAAK,uBAAuB,EAAE,MAAK,CAAE;AAC9C,WAAK,cAAc,OAAO,UACxB,KAAK,OAAO,OAAK,EAAE,OAAO,KAAK,CAAC;AAElC,WAAK,MAAM,QAAQ,gCAAO;IAC5B;EACF;;EAIA,iBAAc;AACZ,SAAK,IAAI,KAAK,sBAAsB,KAAK,UAAS,CAAE;AACpD,SAAK,MAAM,KAAK,6CAAe;EACjC;;EAIA,iBAAiB,SAAa;AAC5B,UAAM,SAAS,mHACb,UAAU,6BAAS,KAAK,UAAU,OAAO,CAAC,KAAK,EACjD;AAEA,SAAK,YAAY,MAAM;EACzB;EAEA,cAAc,iBAAyB,SAAa;AAClD,UAAM,SAAS;;0BAEb,eAAe;EACnB,UAAU,6BAAS,KAAK,UAAU,OAAO,CAAC,KAAK,EAAE;;;AAI/C,SAAK,YAAY,MAAM;EACzB;EAEA,wBAAqB;AACnB,UAAM,WAAW,KAAK,gBAAe;AACrC,QAAI,SAAS,SAAS,GAAG;AACvB,WAAK,MAAM,QAAQ,gFAAe;AAClC;IACF;AAEA,UAAM,eAAe,SAClB,IAAI,OAAK,GAAG,EAAE,SAAS,SAAS,iBAAO,IAAI,SAAI,EAAE,OAAO,EAAE,EAC1D,KAAK,IAAI;AAEZ,UAAM,SAAS;;EAAoB,YAAY;AAC/C,SAAK,YAAY,MAAM;EACzB;;;uCAtQW,gBAAa;IAAA;EAAA;;4EAAb,gBAAa,SAAb,eAAa,WAAA,YAFZ,OAAM,CAAA;EAAA;;;sEAEP,eAAa,CAAA;UAHzB;WAAW;MACV,YAAY;KACb;;;;;ACNK,IAAO,kBAAP,MAAO,iBAAe;EA8F1B,cAAA;AA7FQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,aAAa,OAAmB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAClC,SAAA,eAAe,OAAoB,oBAAI,IAAG,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAC5C,SAAA,UAAU,OAAuB,EAAE,MAAM,OAAO,QAAQ,MAAK,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AAC/D,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,iBAAiB,OAAmB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AACtC,SAAA,eAAe,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAEnC,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,SAAS,KAAK,QAAQ,WAAU;AAChC,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,cAAc,KAAK,aAAa,WAAU;AAI1C,SAAA,oBAAoB,SAAS,MAAK;AAChC,YAAM,YAAY,KAAK,WAAU;AACjC,YAAM,SAAS,KAAK,QAAO;AAE3B,aAAO,UAAU,OAAO,OAAI;AAC1B,YAAI,OAAO,QAAQ,OAAO,SAAS,SAAS,EAAE,SAAS,OAAO,MAAM;AAClE,iBAAO;QACT;AAEA,YAAI,OAAO,UAAU,OAAO,WAAW,SAAS,EAAE,WAAW,OAAO,QAAQ;AAC1E,iBAAO;QACT;AAEA,YAAI,OAAO,QAAQ;AACjB,gBAAM,SAAS,OAAO,OAAO,YAAW;AACxC,gBAAM,aAAa,EAAE,OAAO,YAAW,EAAG,SAAS,MAAM;AACzD,gBAAM,gBAAgB,EAAE,UAAU,YAAW,EAAG,SAAS,MAAM;AAC/D,cAAI,CAAC,cAAc,CAAC;AAAe,mBAAO;QAC5C;AAEA,YAAI,OAAO,eAAe,QAAW;AACnC,cAAI,OAAO,cAAc,CAAC,EAAE;AAAc,mBAAO;AACjD,cAAI,CAAC,OAAO,cAAc,EAAE;AAAc,mBAAO;QACnD;AAEA,YAAI,OAAO,aAAa,UAAa,EAAE,cAAc,OAAO,UAAU;AACpE,iBAAO;QACT;AAEA,eAAO;MACT,CAAC;IACH,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,QAAQ,SAAS,MAAoB;AACnC,YAAM,YAAY,KAAK,WAAU;AAEjC,YAAM,SAAuC;QAC3C,SAAS;QAAG,WAAW;QAAG,QAAQ;QAAG,OAAO;;AAG9C,YAAM,WAA2C;QAC/C,cAAc;QAAG,UAAU;QAAG,aAAa;QAAG,QAAQ;;AAGxD,UAAI,eAAe;AAEnB,iBAAW,KAAK,WAAW;AACzB,YAAI,OAAO,EAAE,IAAI,MAAM;AAAW,iBAAO,EAAE,IAAI;AAC/C,YAAI,SAAS,EAAE,MAAM,MAAM;AAAW,mBAAS,EAAE,MAAM;AACvD,wBAAgB,EAAE,gBAAgB;MACpC;AAEA,aAAO;QACL,OAAO,UAAU;QACjB;QACA;QACA;;IAEJ,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,oBAAoB,SAAS,MAAK;AAChC,YAAM,MAAM,KAAK,aAAY;AAC7B,aAAO,KAAK,WAAU,EAAG,OAAO,OAAK,IAAI,IAAI,EAAE,EAAE,CAAC;IACpD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,gBAAgB,SAAS,MAAM,KAAK,aAAY,EAAG,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAEvD,SAAA,SAAS,SAAS,MAAM,KAAK,WAAU,EAAG,OAAO,OAAK,EAAE,SAAS,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AACzE,SAAA,WAAW,SAAS,MAAM,KAAK,WAAU,EAAG,OAAO,OAAK,EAAE,SAAS,SAAS,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAC7E,SAAA,kBAAkB,SAAS,MAAM,KAAK,WAAU,EAAG,OAAO,OAAK,EAAE,WAAW,QAAQ,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACrF,SAAA,qBAAqB,SAAS,MAAM,KAAK,WAAU,EAAG,OAAO,OAAK,EAAE,WAAW,WAAW,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAGzF,SAAK,kBAAiB;EACxB;;EAIQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,oBAAoB,CAAC,SAAoB;AACnD,WAAK,WAAW,IAAI,IAAI;AACxB,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,oBAAoB,CAAC,SAAkB;AACjD,WAAK,WAAW,OAAO,UACrB,KAAK,IAAI,OAAK,EAAE,OAAO,KAAK,KAAK,kCAAK,IAAM,QAAS,CAAC,CAAC;IAE3D,CAAC;AAED,SAAK,IAAI,GAAG,kBAAkB,CAAC,SAAoB;AACjD,WAAK,eAAe,IAAI,IAAI;AAC5B,WAAK,aAAa,IAAI,KAAK;IAC7B,CAAC;AAED,SAAK,IAAI,GAAG,gBAAgB,CAAC,SAA2B;AACtD,WAAK,aAAa,IAAI,KAAK;AAC3B,WAAK,MAAM,MAAM,6BAAS,KAAK,KAAK,EAAE;IACxC,CAAC;EACH;;EAIA,gBAAa;AACX,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,eAAe;EAC/B;EAEA,mBAAgB;AACd,SAAK,IAAI,KAAK,mBAAmB;AACjC,SAAK,MAAM,KAAK,yCAAW;EAC7B;EAEA,YAAY,IAAU;AACpB,WAAO,KAAK,WAAU,EAAG,KAAK,OAAK,EAAE,OAAO,EAAE;EAChD;EAEA,eAAe,IAAY,SAA0B;AACnD,SAAK,WAAW,OAAO,UACrB,KAAK,IAAI,OAAK,EAAE,OAAO,KAAK,kCAAK,IAAM,WAAY,CAAC,CAAC;AAGvD,SAAK,IAAI,KAAK,mBAAmB,EAAE,IAAI,QAAO,CAAE;EAClD;EAEA,eAAe,IAAU;AACvB,QAAI,CAAC,QAAQ,8DAAY;AAAG;AAE5B,SAAK,WAAW,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,OAAO,EAAE,CAAC;AAC5D,SAAK,aAAa,OAAO,SAAM;AAC7B,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,aAAO,OAAO,EAAE;AAChB,aAAO;IACT,CAAC;AAED,SAAK,IAAI,KAAK,mBAAmB,EAAE,GAAE,CAAE;AACvC,SAAK,MAAM,QAAQ,gCAAO;EAC5B;;EAIA,gBAAgB,IAAU;AACxB,SAAK,aAAa,OAAO,SAAM;AAC7B,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,UAAI,OAAO,IAAI,EAAE,GAAG;AAClB,eAAO,OAAO,EAAE;MAClB,OAAO;AACL,eAAO,IAAI,EAAE;MACf;AACA,aAAO;IACT,CAAC;EACH;EAEA,YAAS;AACP,UAAM,MAAM,IAAI,IAAI,KAAK,kBAAiB,EAAG,IAAI,OAAK,EAAE,EAAE,CAAC;AAC3D,SAAK,aAAa,IAAI,GAAG;EAC3B;EAEA,cAAW;AACT,SAAK,aAAa,IAAI,oBAAI,IAAG,CAAE;EACjC;EAEA,WAAW,IAAU;AACnB,WAAO,KAAK,aAAY,EAAG,IAAI,EAAE;EACnC;;EAIA,UAAU,QAA+B;AACvC,SAAK,QAAQ,OAAO,OAAM,kCAAK,IAAM,OAAS;EAChD;EAEA,cAAW;AACT,SAAK,QAAQ,IAAI,EAAE,MAAM,OAAO,QAAQ,MAAK,CAAE;EACjD;EAEA,UAAU,QAAc;AACtB,SAAK,QAAQ,OAAO,OAAM,iCAAK,IAAL,EAAQ,OAAM,EAAG;EAC7C;;EAIA,OAAOC,QAAkB;AACvB,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,eAAe,IAAI,CAAA,CAAE;AAE1B,SAAK,IAAI,KAAK,oBAAoBA,MAAK;AACvC,SAAK,MAAM,KAAK,6BAAS;EAC3B;EAEA,qBAAkB;AAChB,SAAK,eAAe,IAAI,CAAA,CAAE;EAC5B;EAEA,2BAA2B,UAAkB;AAC3C,SAAK,WAAW,OAAO,UAAO;AAC5B,UAAI,KAAK,KAAK,OAAK,EAAE,gBAAgB,SAAS,WAAW,GAAG;AAC1D,eAAO;MACT;AACA,aAAO,CAAC,GAAG,MAAM,QAAQ;IAC3B,CAAC;EACH;;EAIA,UAAU,OAAa;AACrB,UAAM,WAAW,KAAK,kBAAiB;AACvC,QAAI,SAAS,WAAW,GAAG;AACzB,WAAK,MAAM,QAAQ,sCAAQ;AAC3B;IACF;AAEA,SAAK,IAAI,KAAK,wBAAwB;MACpC,aAAa,SAAS,IAAI,OAAK,EAAE,EAAE;MACnC;KACD;AAED,SAAK,MAAM,KAAK,4BAAQ,SAAS,MAAM,wBAAS;EAClD;EAEA,WAAW,OAAa;AACtB,UAAM,WAAW,KAAK,kBAAiB;AACvC,QAAI,SAAS,WAAW,GAAG;AACzB,WAAK,MAAM,QAAQ,sCAAQ;AAC3B;IACF;AAEA,QAAI,CAAC,QAAQ,kCAAS,SAAS,MAAM,iCAAQ;AAAG;AAEhD,SAAK,IAAI,KAAK,yBAAyB;MACrC,aAAa,SAAS,IAAI,OAAK,EAAE,EAAE;MACnC;KACD;AAED,SAAK,MAAM,KAAK,4BAAQ,SAAS,MAAM,wBAAS;EAClD;EAEA,cAAW;AACT,UAAM,WAAW,KAAK,kBAAiB;AACvC,QAAI,SAAS,WAAW,GAAG;AACzB,WAAK,MAAM,QAAQ,sCAAQ;AAC3B;IACF;AAEA,QAAI,CAAC,QAAQ,kCAAS,SAAS,MAAM,iCAAQ;AAAG;AAEhD,UAAM,MAAM,SAAS,IAAI,OAAK,EAAE,EAAE;AAClC,SAAK,WAAW,OAAO,UAAQ,KAAK,OAAO,OAAK,CAAC,IAAI,SAAS,EAAE,EAAE,CAAC,CAAC;AACpE,SAAK,aAAa,IAAI,oBAAI,IAAG,CAAE;AAE/B,SAAK,IAAI,KAAK,0BAA0B,EAAE,aAAa,IAAG,CAAE;AAC5D,SAAK,MAAM,QAAQ,sBAAO,SAAS,MAAM,qBAAM;EACjD;;EAIA,OAAO,YAAoB,KAAW;AACpC,SAAK,WAAW,OAAO,UACrB,KAAK,IAAI,OAAI;AACX,UAAI,EAAE,OAAO,YAAY;AACvB,cAAM,OAAO,EAAE,QAAQ,CAAA;AACvB,YAAI,CAAC,KAAK,SAAS,GAAG,GAAG;AACvB,iBAAO,iCAAK,IAAL,EAAQ,MAAM,CAAC,GAAG,MAAM,GAAG,EAAC;QACrC;MACF;AACA,aAAO;IACT,CAAC,CAAC;AAGJ,SAAK,IAAI,KAAK,oBAAoB,EAAE,YAAY,IAAG,CAAE;EACvD;EAEA,UAAU,YAAoB,KAAW;AACvC,SAAK,WAAW,OAAO,UACrB,KAAK,IAAI,OAAI;AACX,UAAI,EAAE,OAAO,cAAc,EAAE,MAAM;AACjC,eAAO,iCAAK,IAAL,EAAQ,MAAM,EAAE,KAAK,OAAO,OAAK,MAAM,GAAG,EAAC;MACpD;AACA,aAAO;IACT,CAAC,CAAC;AAGJ,SAAK,IAAI,KAAK,uBAAuB,EAAE,YAAY,IAAG,CAAE;EAC1D;;;uCAjTW,kBAAe;IAAA;EAAA;;4EAAf,kBAAe,SAAf,iBAAe,WAAA,YAFd,OAAM,CAAA;EAAA;;;sEAEP,iBAAe,CAAA;UAH3B;WAAW;MACV,YAAY;KACb;;;;;ACNK,IAAO,gBAAP,MAAO,eAAa;EAgBxB,cAAA;AAfQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,QAAQ,OAAoB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AAC9B,SAAA,cAAc,OAAyB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAC3C,SAAA,aAAa,OAAyB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACxC,SAAA,eAAe,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAEnC,SAAA,OAAO,KAAK,MAAM,WAAU;AAC5B,SAAA,aAAa,KAAK,YAAY,WAAU;AACxC,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,cAAc,KAAK,aAAa,WAAU;AAGxC,SAAK,kBAAiB;AACtB,SAAK,cAAa;EACpB;;EAIQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,kBAAkB,CAAC,QAAkB;AAC/C,WAAK,YAAY,IAAI,GAAG;AACxB,WAAK,MAAM,OAAO,UAAQ,CAAC,KAAK,GAAG,IAAI,CAAC;AACxC,WAAK,aAAa,IAAI,IAAI;IAC5B,CAAC;AAED,SAAK,IAAI,GAAG,mBAAmB,CAAC,SAA6C;AAC3E,WAAK,MAAM,OAAO,UAChB,KAAK,IAAI,OAAK,EAAE,OAAO,KAAK,QAAQ,iCAAK,IAAL,EAAQ,UAAU,KAAK,SAAQ,KAAK,CAAC,CAAC;AAG5E,UAAI,KAAK,YAAW,GAAI,OAAO,KAAK,OAAO;AACzC,aAAK,YAAY,OAAO,OAAK,IAAI,iCAAK,IAAL,EAAQ,UAAU,KAAK,SAAQ,KAAK,CAAC;MACxE;IACF,CAAC;AAED,SAAK,IAAI,GAAG,oBAAoB,CAAC,SAA6C;AAC5E,WAAK,MAAM,OAAO,UAChB,KAAK,IAAI,OAAK,EAAE,OAAO,KAAK,QAAQ,iCAC/B,IAD+B;QAElC,QAAQ;QACR,UAAU;QACV,UAAU,KAAK;QACf,cAAa,oBAAI,KAAI,GAAG,YAAW;WACjC,CAAC,CAAC;AAGR,WAAK,YAAY,IAAI,IAAI;AACzB,WAAK,aAAa,IAAI,KAAK;AAC3B,WAAK,MAAM,QAAQ,gCAAO;IAC5B,CAAC;AAED,SAAK,IAAI,GAAG,iBAAiB,CAAC,SAA0C;AACtE,WAAK,MAAM,OAAO,UAChB,KAAK,IAAI,OAAK,EAAE,OAAO,KAAK,QAAQ,iCAC/B,IAD+B;QAElC,QAAQ;QACR,OAAO,KAAK;WACV,CAAC,CAAC;AAGR,WAAK,YAAY,IAAI,IAAI;AACzB,WAAK,aAAa,IAAI,KAAK;AAC3B,WAAK,MAAM,MAAM,6BAAS,KAAK,KAAK,EAAE;IACxC,CAAC;EACH;;;;;EAOA,YAAY,SAAuB,OAAO,SAAgC;AACxE,SAAK,YAAY;MACf;MACA,MAAM;MACN,gBAAgB;OACb,QACJ;EACH;;;;EAKA,cAAc,YAAoB,SAAuB,OAAO,SAAgC;AAC9F,SAAK,YAAY;MACf;MACA,MAAM;MACN,SAAS,EAAE,WAAU;MACrB,gBAAgB;OACb,QACJ;EACH;;;;EAKA,gBAAgB,SAAuB,OAAO,SAAgC;AAC5E,SAAK,YAAY;MACf;MACA,MAAM;MACN,gBAAgB;OACb,QACJ;EACH;;;;EAKA,eAAe,SAAuB,QAAQ,SAAgC;AAC5E,SAAK,YAAY;MACf;MACA,MAAM;OACH,QACJ;EACH;;;;EAKA,gBAAgB,SAAuB,QAAQ,SAAgC;AAC7E,SAAK,YAAY;MACf;MACA,MAAM;OACH,QACJ;EACH;;;;EAKA,aAAa,MAAsC,SAAuB,OAAK;AAC7E,SAAK,YAAY;MACf;MACA,MAAM;MACN,SAAS,EAAE,YAAY,KAAI;KAC5B;EACH;;;;EAKQ,YAAY,SAAsB;AACxC,QAAI,KAAK,aAAY,GAAI;AACvB,WAAK,MAAM,QAAQ,0EAAc;AACjC;IACF;AAEA,SAAK,IAAI,KAAK,gBAAgB,OAAO;AACrC,SAAK,MAAM,KAAK,6BAAS;EAC3B;;;;;EAOA,eAAY;AACV,UAAM,MAAM,KAAK,YAAW;AAC5B,QAAI,CAAC;AAAK;AAEV,SAAK,IAAI,KAAK,iBAAiB,EAAE,OAAO,IAAI,GAAE,CAAE;AAChD,SAAK,YAAY,IAAI,IAAI;AACzB,SAAK,aAAa,IAAI,KAAK;AAC3B,SAAK,MAAM,KAAK,gCAAO;EACzB;;;;EAKA,eAAe,KAAc;AAC3B,QAAI,CAAC,IAAI,UAAU;AACjB,WAAK,MAAM,MAAM,4CAAS;AAC1B;IACF;AAEA,SAAK,IAAI,KAAK,aAAa,EAAE,MAAM,IAAI,SAAQ,CAAE;EACnD;;;;EAKA,iBAAiB,KAAc;AAC7B,QAAI,CAAC,IAAI,UAAU;AACjB,WAAK,MAAM,MAAM,4CAAS;AAC1B;IACF;AAEA,SAAK,IAAI,KAAK,eAAe,EAAE,MAAM,IAAI,SAAQ,CAAE;EACrD;;;;EAKA,eAAY;AACV,QAAI,CAAC,QAAQ,oEAAa;AAAG;AAE7B,SAAK,MAAM,IAAI,CAAA,CAAE;AACjB,SAAK,MAAM,QAAQ,4CAAS;EAC9B;;;;EAKA,UAAU,OAAa;AACrB,SAAK,MAAM,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,OAAO,KAAK,CAAC;EAC5D;;;;;EAOA,gBAAa;AACX,QAAI;AACF,YAAM,QAAQ,aAAa,QAAQ,kBAAkB;AACrD,UAAI,OAAO;AACT,aAAK,WAAW,IAAI,KAAK,MAAM,KAAK,CAAC;MACvC;IACF,SAAS,GAAG;IAEZ;EACF;;;;EAKA,aAAa,UAAoC;AAC/C,UAAM,cAA8B,iCAC/B,WAD+B;MAElC,IAAI,OAAO,WAAU;;AAGvB,SAAK,WAAW,OAAO,eAAa,CAAC,GAAG,WAAW,WAAW,CAAC;AAC/D,SAAK,uBAAsB;AAC3B,SAAK,MAAM,QAAQ,gCAAO;EAC5B;;;;EAKA,eAAe,YAAkB;AAC/B,QAAI,CAAC,QAAQ,8DAAY;AAAG;AAE5B,SAAK,WAAW,OAAO,eACrB,UAAU,OAAO,OAAK,EAAE,OAAO,UAAU,CAAC;AAE5C,SAAK,uBAAsB;AAC3B,SAAK,MAAM,QAAQ,gCAAO;EAC5B;;;;EAKA,YAAY,YAAkB;AAC5B,UAAM,WAAW,KAAK,WAAU,EAAG,KAAK,OAAK,EAAE,OAAO,UAAU;AAChE,QAAI,CAAC,UAAU;AACb,WAAK,MAAM,MAAM,gCAAO;AACxB;IACF;AAEA,SAAK,YAAY;MACf,QAAQ,SAAS,QAAQ,UAAU;MACnC,MAAM,SAAS;OACZ,SAAS,QACb;EACH;EAEQ,yBAAsB;AAC5B,QAAI;AACF,mBAAa,QAAQ,oBAAoB,KAAK,UAAU,KAAK,WAAU,CAAE,CAAC;IAC5E,SAAS,GAAG;IAEZ;EACF;;;;;EAOA,cAAc,QAAoB;AAChC,UAAM,QAAsC;MAC1C,OAAO;MACP,QAAQ;MACR,QAAQ;MACR,OAAO;;AAET,WAAO,MAAM,MAAM,KAAK;EAC1B;;;;EAKA,cAAc,QAAoB;AAChC,UAAM,QAAsC;MAC1C,OAAO;MACP,QAAQ;MACR,QAAQ;MACR,OAAO;;AAET,WAAO,MAAM,MAAM,KAAK,OAAO,YAAW;EAC5C;;;;EAKA,YAAY,MAAgB;AAC1B,UAAM,QAAoC;MACxC,SAAS;MACT,WAAW;MACX,aAAa;MACb,YAAY;MACZ,aAAa;MACb,UAAU;;AAEZ,WAAO,MAAM,IAAI,KAAK;EACxB;;;uCAjUW,gBAAa;IAAA;EAAA;;4EAAb,gBAAa,SAAb,eAAa,WAAA,YAFZ,OAAM,CAAA;EAAA;;;sEAEP,eAAa,CAAA;UAHzB;WAAW;MACV,YAAY;KACb;;;;;ACjBK,IAAO,gBAAP,MAAO,eAAa;EAuBxB,cAAA;AAtBQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,WAAW,OAAiB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAC9B,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,cAAc,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAC1B,SAAA,eAAe,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAC3B,SAAA,YAAY,OAAuB;MACzC,YAAY;MACZ,UAAU;MACV,YAAY;MACZ,cAAc;OACf,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,UAAU,KAAK,SAAS,WAAU;AAClC,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,aAAa,KAAK,YAAY,WAAU;AACxC,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,WAAW,KAAK,UAAU,WAAU;AAGlC,SAAK,kBAAiB;EACxB;;EAIQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,kBAAkB,CAAC,SAAkB;AAC/C,WAAK,SAAS,IAAI,IAAI;AACtB,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,kBAAkB,CAAC,SAAgB;AAC7C,WAAK,SAAS,OAAO,UAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;AAC5C,WAAK,YAAY,IAAI,KAAK;AAC1B,WAAK,MAAM,QAAQ,4CAAS;IAC9B,CAAC;AAED,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAA2B;AAC7D,WAAK,YAAY,IAAI,KAAK;AAC1B,WAAK,MAAM,MAAM,yCAAW,KAAK,KAAK,EAAE;IAC1C,CAAC;AAED,SAAK,IAAI,GAAG,mBAAmB,MAAK;AAClC,WAAK,aAAa,IAAI,KAAK;AAC3B,WAAK,MAAM,QAAQ,yFAAmB;AACtC,iBAAW,MAAM,OAAO,SAAS,OAAM,GAAI,GAAI;IACjD,CAAC;AAED,SAAK,IAAI,GAAG,wBAAwB,CAAC,SAA2B;AAC9D,WAAK,aAAa,IAAI,KAAK;AAC3B,WAAK,MAAM,MAAM,yCAAW,KAAK,KAAK,EAAE;IAC1C,CAAC;AAED,SAAK,IAAI,GAAG,kBAAkB,CAAC,SAAwB;AACrD,WAAK,SAAS,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,OAAO,KAAK,EAAE,CAAC;AAC/D,WAAK,MAAM,QAAQ,gCAAO;IAC5B,CAAC;AAED,SAAK,IAAI,GAAG,0BAA0B,CAAC,SAAwB;AAC7D,WAAK,UAAU,IAAI,IAAI;IACzB,CAAC;EACH;;EAIA,cAAW;AACT,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,aAAa;EAC7B;EAEA,aAAa,aAAoB;AAC/B,SAAK,YAAY,IAAI,IAAI;AACzB,SAAK,IAAI,KAAK,iBAAiB,EAAE,YAAW,CAAE;EAChD;EAEA,cAAc,IAAU;AACtB,QAAI,CAAC,QAAQ,oHAAqB,GAAG;AACnC;IACF;AAEA,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,IAAI,KAAK,kBAAkB,EAAE,GAAE,CAAE;EACxC;EAEA,aAAa,IAAU;AACrB,QAAI,CAAC,QAAQ,8DAAY,GAAG;AAC1B;IACF;AAEA,SAAK,IAAI,KAAK,iBAAiB,EAAE,GAAE,CAAE;EACvC;;EAIA,eAAY;AACV,SAAK,IAAI,KAAK,qBAAqB;EACrC;EAEA,eAAe,UAAiC;AAC9C,SAAK,UAAU,OAAO,OAAM,kCAAK,IAAM,SAAW;AAClD,SAAK,IAAI,KAAK,wBAAwB,KAAK,UAAS,CAAE;AACtD,SAAK,MAAM,QAAQ,4CAAS;EAC9B;EAEA,mBAAgB;AACd,SAAK,eAAe,EAAE,YAAY,CAAC,KAAK,UAAS,EAAG,WAAU,CAAE;EAClE;;EAIA,WAAW,OAAa;AACtB,QAAI,QAAQ;AAAM,aAAO,GAAG,KAAK;AACjC,QAAI,QAAQ,OAAO;AAAM,aAAO,IAAI,QAAQ,MAAM,QAAQ,CAAC,CAAC;AAC5D,QAAI,QAAQ,OAAO,OAAO;AAAM,aAAO,IAAI,SAAS,OAAO,OAAO,QAAQ,CAAC,CAAC;AAC5E,WAAO,IAAI,SAAS,OAAO,OAAO,OAAO,QAAQ,CAAC,CAAC;EACrD;EAEA,aAAa,WAAiB;AAC5B,UAAM,UAAU,IAAI,KAAK,SAAS;AAClC,UAAM,MAAM,oBAAI,KAAI;AACpB,UAAM,SAAS,IAAI,QAAO,IAAK,QAAQ,QAAO;AAC9C,UAAM,WAAW,KAAK,MAAM,UAAU,MAAO,KAAK,KAAK,GAAG;AAE1D,QAAI,aAAa;AAAG,aAAO;AAC3B,QAAI,aAAa;AAAG,aAAO;AAC3B,QAAI,WAAW;AAAG,aAAO,GAAG,QAAQ;AACpC,QAAI,WAAW;AAAI,aAAO,GAAG,KAAK,MAAM,WAAW,CAAC,CAAC;AACrD,WAAO,GAAG,KAAK,MAAM,WAAW,EAAE,CAAC;EACrC;;;uCApIW,gBAAa;IAAA;EAAA;;4EAAb,gBAAa,SAAb,eAAa,WAAA,YAFZ,OAAM,CAAA;EAAA;;;sEAEP,eAAa,CAAA;UAHzB;WAAW;MACV,YAAY;KACb;;;;;ACcK,IAAO,mBAAP,MAAO,kBAAgB;EA2C3B,cAAA;AA1CQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,UAAU,OAAwB;MACxC,WAAW;MACX,QAAQ;MACR,YAAY;MACZ,aAAa;MACb,OAAO,CAAA;OACR,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AACO,SAAA,QAAQ,OAAuB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AACjC,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAEjC,SAAA,SAAS,KAAK,QAAQ,WAAU;AAChC,SAAA,OAAO,KAAK,MAAM,WAAU;AAC5B,SAAA,YAAY,KAAK,WAAW,WAAU;AAItC,SAAA,YAAY,SAAS,MAAM,KAAK,QAAO,EAAG,WAAS,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACnD,SAAA,QAAQ,SAAS,MAAM,KAAK,QAAO,EAAG,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AAC3C,SAAA,cAAc,SAAS,MAAM,KAAK,QAAO,EAAG,MAAM,OAAO,OAAK,EAAE,WAAW,SAAS,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AACrF,SAAA,YAAY,SAAS,MAAM,KAAK,QAAO,EAAG,MAAM,OAAO,OAAK,EAAE,WAAW,MAAM,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAChF,SAAA,aAAa,SAAS,MAAM,KAAK,QAAO,EAAG,MAAM,OAAO,OAAK,EAAE,WAAW,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAElF,SAAA,kBAAkB,SAAS,MAAK;AAC9B,YAAM,UAAU,KAAK,QAAO,EAAG;AAC/B,YAAM,QAAQ,KAAK,MAAM,UAAU,IAAI;AACvC,YAAM,UAAU,KAAK,MAAO,UAAU,OAAQ,EAAE;AAChD,YAAM,OAAO,UAAU;AAEvB,UAAI,QAAQ,GAAG;AACb,eAAO,GAAG,KAAK,KAAK,OAAO;MAC7B;AACA,UAAI,UAAU,GAAG;AACf,eAAO,GAAG,OAAO,KAAK,IAAI;MAC5B;AACA,aAAO,GAAG,IAAI;IAChB,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAGC,SAAK,kBAAiB;EACxB;;EAIQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,oBAAoB,CAAC,SAAyB;AACxD,WAAK,QAAQ,IAAI,IAAI;AACrB,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,qBAAqB,MAAK;AACpC,WAAK,QAAQ,OAAO,OAAM,iCAAK,IAAL,EAAQ,WAAW,KAAI,EAAG;AACpD,WAAK,MAAM,QAAQ,sCAAQ;IAC7B,CAAC;AAED,SAAK,IAAI,GAAG,qBAAqB,MAAK;AACpC,WAAK,QAAQ,OAAO,OAAM,iCAAK,IAAL,EAAQ,WAAW,MAAK,EAAG;AACrD,WAAK,MAAM,KAAK,sCAAQ;IAC1B,CAAC;AAED,SAAK,IAAI,GAAG,0BAA0B,CAAC,SAA8B;AACnE,WAAK,QAAQ,OAAO,OAAM,iCACrB,IADqB;QAExB,OAAO,EAAE,MAAM,IAAI,OACjB,EAAE,SAAS,KAAK,WAAW,iCAAK,IAAL,EAAQ,QAAQ,UAAkB,KAAK,CAAC;QAErE;IACJ,CAAC;AAED,SAAK,IAAI,GAAG,4BAA4B,CAAC,SAAgD;AACvF,WAAK,QAAQ,OAAO,OAAM,iCACrB,IADqB;QAExB,OAAO,EAAE,MAAM,IAAI,OACjB,EAAE,SAAS,KAAK,WAAW,iCACtB,IADsB;UAEzB,QAAQ;UACR,UAAS,oBAAI,KAAI,GAAG,YAAW;UAC/B,UAAU,EAAE,WAAW;aACrB,CAAC;QAEP;IACJ,CAAC;AAED,SAAK,IAAI,GAAG,wBAAwB,CAAC,SAA6C;AAChF,WAAK,QAAQ,OAAO,OAAM,iCACrB,IADqB;QAExB,OAAO,EAAE,MAAM,IAAI,OACjB,EAAE,SAAS,KAAK,WAAW,iCACtB,IADsB;UAEzB,QAAQ;UACR,cAAc,KAAK;aACjB,CAAC;QAEP;AACF,WAAK,MAAM,MAAM,gBAAM,KAAK,QAAQ,2BAAO;IAC7C,CAAC;AAED,SAAK,IAAI,GAAG,kBAAkB,CAAC,SAAwB;AACrD,WAAK,MAAM,IAAI,IAAI;IACrB,CAAC;EACH;;EAIA,aAAU;AACR,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,sBAAsB;EACtC;EAEA,QAAK;AACH,SAAK,IAAI,KAAK,iBAAiB;EACjC;EAEA,OAAI;AACF,SAAK,IAAI,KAAK,gBAAgB;EAChC;EAEA,UAAO;AACL,SAAK,IAAI,KAAK,mBAAmB;AACjC,SAAK,MAAM,KAAK,+CAAY;EAC9B;;EAIA,QAAQ,UAAgB;AACtB,SAAK,IAAI,KAAK,sBAAsB,EAAE,SAAQ,CAAE;AAChD,SAAK,MAAM,KAAK,yCAAW,QAAQ,EAAE;EACvC;EAEA,WAAW,UAAgB;AACzB,SAAK,IAAI,KAAK,yBAAyB,EAAE,SAAQ,CAAE;AACnD,SAAK,QAAQ,OAAO,OAAM,iCACrB,IADqB;MAExB,OAAO,EAAE,MAAM,IAAI,OACjB,EAAE,SAAS,WAAW,iCAAK,IAAL,EAAQ,SAAS,MAAM,QAAQ,OAAe,KAAK,CAAC;MAE5E;EACJ;EAEA,YAAY,UAAgB;AAC1B,SAAK,IAAI,KAAK,0BAA0B,EAAE,SAAQ,CAAE;AACpD,SAAK,QAAQ,OAAO,OAAM,iCACrB,IADqB;MAExB,OAAO,EAAE,MAAM,IAAI,OACjB,EAAE,SAAS,WAAW,iCAAK,IAAL,EAAQ,SAAS,OAAO,QAAQ,WAAmB,KAAK,CAAC;MAEjF;EACJ;EAEA,mBAAmB,UAAkB,UAAgB;AACnD,SAAK,IAAI,KAAK,wBAAwB,EAAE,UAAU,SAAQ,CAAE;AAC5D,SAAK,QAAQ,OAAO,OAAM,iCACrB,IADqB;MAExB,OAAO,EAAE,MAAM,IAAI,OACjB,EAAE,SAAS,WAAW,iCAAK,IAAL,EAAQ,SAAQ,KAAK,CAAC;MAE9C;AACF,SAAK,MAAM,QAAQ,4CAAS;EAC9B;;EAIA,SAAS,QAAgB,KAAG;AAC1B,SAAK,IAAI,KAAK,sBAAsB,EAAE,MAAK,CAAE;EAC/C;EAEA,YAAS;AACP,QAAI,CAAC,QAAQ,gFAAe;AAAG;AAC/B,SAAK,IAAI,KAAK,sBAAsB;AACpC,SAAK,MAAM,IAAI,CAAA,CAAE;AACjB,SAAK,MAAM,QAAQ,4CAAS;EAC9B;;EAIA,mBAAmB,QAA+B;AAChD,YAAQ,QAAQ;MACd,KAAK;AAAW,eAAO;MACvB,KAAK;AAAQ,eAAO;MACpB,KAAK;AAAS,eAAO;MACrB,KAAK;AAAY,eAAO;MACxB;AAAS,eAAO;IAClB;EACF;EAEA,kBAAkB,QAA+B;AAC/C,YAAQ,QAAQ;MACd,KAAK;AAAW,eAAO;MACvB,KAAK;AAAQ,eAAO;MACpB,KAAK;AAAS,eAAO;MACrB,KAAK;AAAY,eAAO;MACxB;AAAS,eAAO;IAClB;EACF;EAEA,eAAe,SAAe;AAC5B,QAAI,UAAU;AAAI,aAAO,GAAG,OAAO;AACnC,QAAI,UAAU;AAAM,aAAO,GAAG,KAAK,MAAM,UAAU,EAAE,CAAC;AACtD,QAAI,UAAU;AAAO,aAAO,GAAG,KAAK,MAAM,UAAU,IAAI,CAAC;AACzD,WAAO,GAAG,KAAK,MAAM,UAAU,KAAK,CAAC;EACvC;;;uCA7MW,mBAAgB;IAAA;EAAA;;4EAAhB,mBAAgB,SAAhB,kBAAgB,WAAA,YAFf,OAAM,CAAA;EAAA;;;sEAEP,kBAAgB,CAAA;UAH5B;WAAW;MACV,YAAY;KACb;;;;;AC0BK,IAAO,kBAAP,MAAO,iBAAe;EAH5B,cAAA;AAMU,SAAA,0BAA0B,OAAwB,cAAY,GAAA,YAAA,CAAA,EAAA,WAAA,0BAAA,CAAA,IAAA,CAAA,CAAA;AAC9D,SAAA,4BAA4B,OAAO,uDAAa,GAAA,YAAA,CAAA,EAAA,WAAA,4BAAA,CAAA,IAAA,CAAA,CAAA;AAChD,SAAA,6BAA6B,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,6BAAA,CAAA,IAAA,CAAA,CAAA;AAE7C,SAAA,yBAAyB,KAAK,wBAAwB,WAAU;AAChE,SAAA,2BAA2B,KAAK,0BAA0B,WAAU;AACpE,SAAA,4BAA4B,KAAK,2BAA2B,WAAU;AAEtE,SAAA,cAAc,SAAS,MAAM,KAAK,wBAAuB,MAAO,aAAW,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAGnE,SAAA,eAAe,OAAgB,aAAW,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAC1C,SAAA,gBAAgB,OAAuB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAC3C,SAAA,oBAAoB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAExC,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,eAAe,KAAK,cAAc,WAAU;AAC5C,SAAA,mBAAmB,KAAK,kBAAkB,WAAU;AAG5C,SAAA,YAAY,OAA0B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACxC,SAAA,qBAAqB,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAEvD,SAAA,WAAW,KAAK,UAAU,WAAU;AACpC,SAAA,oBAAoB,KAAK,mBAAmB,WAAU;AAEtD,SAAA,kBAAkB,SAAS,MAAK;AAC9B,YAAM,KAAK,KAAK,mBAAkB;AAClC,aAAO,KAAK,KAAK,UAAS,EAAG,KAAK,OAAK,EAAE,OAAO,EAAE,IAAI;IACxD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,iBAAiB,SAAS,MACxB,KAAK,UAAS,EAAG,OAAO,OAAK,EAAE,WAAW,QAAQ,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAGrD,SAAA,eAAe,SAAS,MAAK;AAC3B,YAAM,WAAW,KAAK,UAAS;AAC/B,aAAO;QACL,OAAO,SAAS;QAChB,QAAQ,SAAS,OAAO,OAAK,EAAE,WAAW,QAAQ,EAAE;QACpD,SAAS,SAAS,OAAO,OAAK,EAAE,WAAW,SAAS,EAAE;QACtD,OAAO,SAAS,OAAO,OAAK,EAAE,WAAW,WAAW,EAAE,WAAW,QAAQ,EAAE;;IAE/E,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAGO,SAAA,UAAU,OAAyB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AACrC,SAAA,eAAe,OAAqB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AACtC,SAAA,aAAa,OAA0B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzC,SAAA,gBAAgB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAEpC,SAAA,SAAS,KAAK,QAAQ,WAAU;AAChC,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,eAAe,KAAK,cAAc,WAAU;AAE5C,SAAA,kBAAkB,SAAS,MAAK;AAC9B,YAAM,SAAS,KAAK,QAAO;AAC3B,YAAM,cAAc,KAAK,aAAY;AACrC,aAAO;QACL,aAAa,OAAO;QACpB,cAAc,OAAO,OAAO,OAAK,EAAE,QAAQ,EAAE;QAC7C,eAAe,YAAY,OAAO,CAAC,KAAK,OAAO,OAAO,GAAG,UAAU,UAAU,IAAI,CAAC;QAClF,mBAAmB,YAAY,OAAO,QAAM,GAAG,SAAS,EAAE;;IAE9D,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAGO,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,kBAAkB,OAAO,IAAE,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAEnC,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,iBAAiB,KAAK,gBAAgB,WAAU;AAGvC,SAAA,aAA0B;MACjC;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;UACL,EAAE,IAAI,aAAa,MAAM,gBAAM,MAAM,YAAI;UACzC,EAAE,IAAI,oBAAoB,MAAM,4BAAQ,MAAM,YAAI;;;MAGtD;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;UACL,EAAE,IAAI,YAAY,MAAM,4BAAQ,MAAM,YAAI;UAC1C,EAAE,IAAI,eAAe,MAAM,4BAAQ,MAAM,SAAG;UAC5C,EAAE,IAAI,mBAAmB,MAAM,oBAAU,MAAM,YAAI;;;MAGvD;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;UACL,EAAE,IAAI,cAAc,MAAM,kCAAS,MAAM,SAAG;UAC5C,EAAE,IAAI,uBAAuB,MAAM,4BAAQ,MAAM,kBAAK;UACtD,EAAE,IAAI,qBAAqB,MAAM,4BAAQ,MAAM,YAAI;UACnD,EAAE,IAAI,gBAAgB,MAAM,4BAAQ,MAAM,YAAI;UAC9C,EAAE,IAAI,kBAAkB,MAAM,4BAAQ,MAAM,YAAI;UAChD,EAAE,IAAI,iBAAiB,MAAM,4BAAQ,MAAM,YAAI;UAC/C,EAAE,IAAI,mBAAmB,MAAM,4BAAQ,MAAM,YAAI;;;MAGrD;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;UACL,EAAE,IAAI,oBAAoB,MAAM,4BAAQ,MAAM,YAAI;UAClD,EAAE,IAAI,mBAAmB,MAAM,kCAAS,MAAM,YAAI;UAClD,EAAE,IAAI,mBAAmB,MAAM,4BAAQ,MAAM,YAAI;;;MAGrD;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;UACL,EAAE,IAAI,kBAAkB,MAAM,4BAAQ,MAAM,YAAI;UAChD,EAAE,IAAI,uBAAuB,MAAM,4BAAQ,MAAM,YAAI;;;MAGzD;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;UACL,EAAE,IAAI,aAAa,MAAM,mBAAS,MAAM,eAAI;UAC5C,EAAE,IAAI,gBAAgB,MAAM,mBAAS,MAAM,YAAI;UAC/C,EAAE,IAAI,WAAW,MAAM,mBAAS,MAAM,YAAI;UAC1C,EAAE,IAAI,cAAc,MAAM,kCAAS,MAAM,YAAI;;;MAGjD;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;UACL,EAAE,IAAI,YAAY,MAAM,4BAAQ,MAAM,YAAI;UAC1C,EAAE,IAAI,WAAW,MAAM,4BAAQ,MAAM,YAAI;UACzC,EAAE,IAAI,qBAAqB,MAAM,4BAAQ,MAAM,YAAI;;;;;;EAOzD,mBAAmBC,QAAwB,SAAgB;AACzD,SAAK,wBAAwB,IAAIA,MAAK;AACtC,QAAI,SAAS;AACX,WAAK,0BAA0B,IAAI,OAAO;IAC5C;EACF;EAEA,sBAAsB,UAAgB;AACpC,SAAK,2BAA2B,IAAI,QAAQ;EAC9C;EAEA,WAAW,MAAa;AACtB,SAAK,cAAc,IAAI,KAAK,aAAY,CAAE;AAC1C,SAAK,aAAa,IAAI,IAAI;EAC5B;EAEA,SAAM;AACJ,UAAM,OAAO,KAAK,cAAa;AAC/B,QAAI,MAAM;AACR,WAAK,aAAa,IAAI,IAAI;AAC1B,WAAK,cAAc,IAAI,IAAI;IAC7B;EACF;EAEA,gBAAa;AACX,SAAK,kBAAkB,OAAO,OAAK,CAAC,CAAC;EACvC;EAEA,oBAAoB,WAAkB;AACpC,SAAK,kBAAkB,IAAI,SAAS;EACtC;EAEA,YAAY,UAA2B;AACrC,SAAK,UAAU,IAAI,QAAQ;EAC7B;EAEA,cAAc,SAAwB;AACpC,SAAK,UAAU,OAAO,UACpB,KAAK,IAAI,OAAK,EAAE,OAAO,QAAQ,KAAK,UAAU,CAAC,CAAC;EAEpD;EAEA,WAAW,SAAwB;AACjC,SAAK,UAAU,OAAO,UAAQ,CAAC,GAAG,MAAM,OAAO,CAAC;EAClD;EAEA,cAAc,WAAiB;AAC7B,SAAK,UAAU,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,OAAO,SAAS,CAAC;EACpE;EAEA,cAAc,WAAwB;AACpC,SAAK,mBAAmB,IAAI,SAAS;EACvC;EAEA,UAAU,QAAwB;AAChC,SAAK,QAAQ,IAAI,MAAM;EACzB;EAEA,eAAe,MAAkB;AAC/B,SAAK,aAAa,IAAI,IAAI;EAC5B;EAEA,aAAa,WAA4B;AACvC,SAAK,WAAW,IAAI,SAAS;EAC/B;EAEA,cAAc,QAAe;AAC3B,SAAK,cAAc,IAAI,MAAM;EAC/B;EAEA,WAAW,SAAkB,SAAgB;AAC3C,SAAK,WAAW,IAAI,OAAO;AAC3B,QAAI,YAAY,QAAW;AACzB,WAAK,gBAAgB,IAAI,OAAO;IAClC;EACF;;EAIA,iBAAiB,MAAa;AAC5B,WAAO,KAAK,WAAW,KAAK,OAAK,EAAE,MAAM,KAAK,OAAK,EAAE,OAAO,IAAI,CAAC;EACnE;EAEA,YAAY,MAAa;AACvB,eAAW,UAAU,KAAK,YAAY;AACpC,YAAM,QAAQ,OAAO,MAAM,KAAK,OAAK,EAAE,OAAO,IAAI;AAClD,UAAI;AAAO,eAAO;IACpB;AACA,WAAO;EACT;EAEA,gBAAa;AACX,UAAM,OAAO,KAAK,aAAY;AAC9B,UAAM,SAAS,KAAK,iBAAiB,IAAI;AACzC,UAAM,WAAW,KAAK,YAAY,IAAI;AAEtC,QAAI,UAAU,UAAU;AACtB,aAAO,EAAE,QAAQ,MAAM,SAAQ;IACjC;AACA,WAAO;EACT;;;uCAhQW,kBAAe;IAAA;EAAA;;4EAAf,kBAAe,SAAf,iBAAe,WAAA,YAFd,OAAM,CAAA;EAAA;;;sEAEP,iBAAe,CAAA;UAH3B;WAAW;MACV,YAAY;KACb;;;;;ACXK,IAAO,2BAAP,MAAO,0BAAwB;EAHrC,cAAA;AAIU,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAG3B,SAAA,eAAe,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAC3B,SAAA,qBAAqB,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAC/C,SAAA,eAAe,OAAoB;MACzC,aAAa;MACb,OAAO;MACP,UAAU;MACV,eAAe;MACf,OAAO;OACR,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AACO,SAAA,WAAW,OAA6B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAC1C,SAAA,kBAAkB,OAA6B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,iBAAiB,OAAiB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AACpC,SAAA,SAAS,OAAsB;MACrC,iBAAiB;MACjB,QAAQ;MACR,UAAU;MACV,OAAO;MACP,iBAAiB;OAClB,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAGO,SAAA,cAAc,oBAAI,IAAG;AACZ,SAAA,kBAAkB,IAAI,KAAK;AAG5C,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,oBAAoB,KAAK,mBAAmB,WAAU;AACtD,SAAA,cAAc,KAAK,aAAa,WAAU;AAC1C,SAAA,UAAU,KAAK,SAAS,WAAU;AAClC,SAAA,iBAAiB,KAAK,gBAAgB,WAAU;AAChD,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,QAAQ,KAAK,OAAO,WAAU;AAG9B,SAAA,cAAc,SAAS,MAAM,KAAK,aAAY,EAAG,aAAW,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAC5D,SAAA,iBAAiB,SAAS,MAAM,KAAK,aAAY,EAAG,UAAQ,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAE5D,SAAA,eAAe,SAAS,MACtB,KAAK,SAAQ,EAAG,OAAO,OAAK,EAAE,SAAS,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAGjD,SAAA,iBAAiB,SAAS,MACxB,KAAK,SAAQ,EAAG,OAAO,OAAK,EAAE,SAAS,SAAS,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAGnD,SAAA,cAAc,SAAS,MACrB,KAAK,SAAQ,EAAG,OAAO,OAAK,EAAE,SAAS,MAAM,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;;;EAKhD,MAAM,WAAW,UAA2B;AAE1C,UAAM,UAAU,KAAK,kBAAkB,QAAQ;AAC/C,QAAI,CAAC,SAAS;AACZ,WAAK,MAAM,MAAM,wDAAW;AAC5B,aAAO;IACT;AAEA,SAAK,mBAAmB,IAAI,QAAQ,EAAE;AAEtC,WAAO,IAAI,QAAQ,CAAC,YAAW;AAC7B,WAAK,IAAI,KAAK,2BAA2B;QACvC,WAAW,QAAQ;QACnB,OAAO,QAAQ;OAChB;AAGD,iBAAW,MAAK;AACd,aAAK,aAAa,IAAI,IAAI;AAC1B,gBAAQ,IAAI;MACd,GAAG,GAAI;IACT,CAAC;EACH;EAEQ,kBAAkB,UAA2B;AACnD,UAAM,SAAS,SAAS,OAAO,OAAK,EAAE,WAAW,QAAQ;AACzD,QAAI,OAAO,WAAW;AAAG,aAAO;AAGhC,UAAM,WAAmC;MACvC,YAAY;MACZ,YAAY;MACZ,UAAU;MACV,MAAM;MACN,UAAU;MACV,cAAc;;AAGhB,WAAO,OAAO,KAAK,CAAC,GAAG,OACpB,SAAS,EAAE,IAAI,KAAK,OAAO,SAAS,EAAE,IAAI,KAAK,GAAG,EACnD,CAAC;EACL;;EAIA,MAAM,OAAOC,QAAe,UAA0B,CAAC,UAAU,GAAC;AAChE,QAAI,CAACA,OAAM,KAAI,GAAI;AACjB,WAAK,MAAM,QAAQ,kDAAU;AAC7B,aAAO,CAAA;IACT;AAGA,UAAM,WAAW,KAAK,iBAAiBA,QAAO,OAAO;AACrD,UAAM,SAAS,KAAK,aAAa,QAAQ;AACzC,QAAI,QAAQ;AACV,WAAK,SAAS,IAAI,OAAO,OAAO;AAChC,aAAO,OAAO;IAChB;AAGA,SAAK,aAAa,IAAI;MACpB,aAAa;MACb,OAAAA;MACA,UAAU;MACV,eAAe,QAAQ,CAAC;MACxB,OAAO;KACR;AAED,SAAK,SAAS,IAAI,CAAA,CAAE;AAGpB,SAAK,aAAaA,MAAK;AAGvB,SAAK,IAAI,KAAK,oBAAoB;MAChC,OAAAA;MACA;MACA,WAAW,KAAK,mBAAkB;KACnC;AAED,WAAO,CAAA;EACT;EAEA,oBAAoB,MAAkF;AAEpG,SAAK,SAAS,OAAO,cAAW;AAC9B,YAAM,aAAa,CAAC,GAAG,QAAQ;AAC/B,iBAAW,UAAU,KAAK,SAAS;AACjC,YAAI,CAAC,WAAW,KAAK,OAAK,EAAE,OAAO,OAAO,EAAE,GAAG;AAC7C,qBAAW,KAAK,MAAM;QACxB;MACF;AACA,aAAO;IACT,CAAC;AAGD,SAAK,aAAa,OAAO,CAAAC,WAAU,iCAC9BA,SAD8B;MAEjC,UAAU,KAAK,aAAa,MAAMA,OAAM,WAAW;MACnD,eAAe,KAAK;MACpB;AAEF,QAAI,KAAK,YAAY;AACnB,WAAK,eAAc;IACrB;EACF;EAEA,kBAAkB,OAAa;AAC7B,SAAK,aAAa,OAAO,CAAAA,WAAU,iCAC9BA,SAD8B;MAEjC,aAAa;MACb;MACA;AACF,SAAK,MAAM,MAAM,6BAAS,KAAK,EAAE;EACnC;EAEQ,iBAAc;AACpB,UAAMA,SAAQ,KAAK,aAAY;AAC/B,UAAM,UAAU,KAAK,SAAQ;AAG7B,UAAM,WAAW,KAAK,iBAAiBA,OAAM,OAAO,CAAC,UAAU,CAAC;AAChE,SAAK,YAAY,IAAI,UAAU;MAC7B,OAAOA,OAAM;MACb,QAAQ;MACR;MACA,WAAW,KAAK,IAAG;MACnB,YAAY,QAAQ;KACrB;AAGD,SAAK,aAAa,OAAO,OAAM,iCAC1B,IAD0B;MAE7B,aAAa;MACb,UAAU;MACV;AAGF,SAAK,YAAW;AAEhB,SAAK,MAAM,QAAQ,gBAAM,QAAQ,MAAM,qBAAM;EAC/C;EAEA,eAAY;AACV,SAAK,IAAI,KAAK,eAAe;AAC7B,SAAK,aAAa,OAAO,CAAAA,WAAU,iCAC9BA,SAD8B;MAEjC,aAAa;MACb,UAAU;MACV;EACJ;EAEA,eAAY;AACV,SAAK,SAAS,IAAI,CAAA,CAAE;AACpB,SAAK,aAAa,OAAO,CAAAA,WAAU,iCAC9BA,SAD8B;MAEjC,OAAO;MACP,UAAU;MACV,OAAO;MACP;EACJ;;EAIA,MAAM,aAAa,UAA4B;AAC7C,QAAI,KAAK,gBAAe,EAAG,KAAK,OAAK,EAAE,OAAO,SAAS,EAAE,GAAG;AAC1D,WAAK,MAAM,KAAK,sCAAQ;AACxB,aAAO;IACT;AAEA,UAAM,QAAQ,iCAAK,WAAL,EAAe,UAAS,oBAAI,KAAI,GAAG,YAAW,EAAE;AAC9D,SAAK,gBAAgB,OAAO,UAAQ,CAAC,GAAG,MAAM,KAAK,CAAC;AAEpD,SAAK,IAAI,KAAK,iBAAiB,EAAE,UAAU,MAAK,CAAE;AAClD,SAAK,MAAM,QAAQ,gCAAO;AAE1B,WAAO;EACT;EAEA,eAAe,YAAkB;AAC/B,SAAK,gBAAgB,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,OAAO,UAAU,CAAC;AACzE,SAAK,IAAI,KAAK,mBAAmB,EAAE,WAAU,CAAE;EACjD;EAEA,MAAM,UAAU,UAA4B;AAC1C,QAAI,SAAS,SAAS,WAAW,SAAS,SAAS,WAAW;AAC5D,WAAK,MAAM,MAAM,wDAAW;AAC5B,aAAO;IACT;AAEA,SAAK,IAAI,KAAK,cAAc;MAC1B,UAAU,SAAS;MACnB,YAAY,SAAS;MACrB,WAAW,KAAK,mBAAkB;KACnC;AAED,SAAK,MAAM,KAAK,4BAAQ,SAAS,KAAK,KAAK;AAC3C,WAAO;EACT;EAEA,MAAM,eAAe,UAA8B,QAAgB,KAAG;AACpE,QAAI,SAAS,SAAS,SAAS;AAC7B,WAAK,MAAM,MAAM,wDAAW;AAC5B;IACF;AAEA,SAAK,IAAI,KAAK,mBAAmB;MAC/B,SAAS,SAAS;MAClB,YAAY,SAAS;MACrB;MACA,WAAW,KAAK,mBAAkB;KACnC;AAED,SAAK,MAAM,KAAK,yCAAW;EAC7B;;EAIQ,iBAAiBD,QAAe,SAAuB;AAC7D,UAAM,kBAAkBA,OAAM,YAAW,EAAG,KAAI;AAChD,UAAM,gBAAgB,CAAC,GAAG,OAAO,EAAE,KAAI,EAAG,KAAK,GAAG;AAClD,WAAO,GAAG,eAAe,IAAI,aAAa;EAC5C;EAEQ,aAAa,UAAgB;AACnC,UAAM,SAAS,KAAK,YAAY,IAAI,QAAQ;AAC5C,QAAI,CAAC;AAAQ,aAAO;AAEpB,QAAI,KAAK,IAAG,IAAK,OAAO,YAAY,KAAK,iBAAiB;AACxD,WAAK,YAAY,OAAO,QAAQ;AAChC,aAAO;IACT;AAEA,WAAO;EACT;EAEQ,aAAaA,QAAa;AAChC,SAAK,eAAe,OAAO,aAAU;AACnC,YAAM,WAAW,QAAQ,OAAO,OAAK,MAAMA,MAAK;AAChD,aAAO,CAACA,QAAO,GAAG,QAAQ,EAAE,MAAM,GAAG,EAAE;IACzC,CAAC;EACH;EAEA,eAAY;AACV,SAAK,eAAe,IAAI,CAAA,CAAE;EAC5B;EAEQ,cAAW;AACjB,UAAM,UAAU,KAAK,SAAQ;AAC7B,UAAM,QAAQ,KAAK,gBAAe;AAElC,SAAK,OAAO,IAAI;MACd,iBAAiB,MAAM;MACvB,QAAQ,MAAM,OAAO,OAAK,EAAE,SAAS,OAAO,EAAE;MAC9C,UAAU,MAAM,OAAO,OAAK,EAAE,SAAS,SAAS,EAAE;MAClD,OAAO,MAAM,OAAO,OAAK,EAAE,SAAS,MAAM,EAAE;MAC5C,iBAAiB,QAAQ;KAC1B;EACH;EAEA,eAAY;AACV,SAAK,IAAI,KAAK,oBAAoB;EACpC;EAEA,SAAS,OAAoB;AAC3B,SAAK,OAAO,IAAI,KAAK;EACvB;EAEA,cAAc,WAAiB;AAC7B,SAAK,mBAAmB,IAAI,SAAS;AACrC,SAAK,aAAa,IAAI,KAAK;EAC7B;;;uCAvUW,2BAAwB;IAAA;EAAA;;4EAAxB,2BAAwB,SAAxB,0BAAwB,WAAA,YAFvB,OAAM,CAAA;EAAA;;;sEAEP,0BAAwB,CAAA;UAHpC;WAAW;MACV,YAAY;KACb;;;;;ACxCK,IAAO,qBAAP,MAAO,oBAAkB;EAD/B,cAAA;AAEU,SAAA,sBAAsB,OAAO,mBAAmB;;EAExD,YAAY,OAAU;AACpB,YAAQ,MAAM,wBAAwB,KAAK;AAE3C,SAAK,oBAAoB,OAAO,KAAK;EACvC;;;uCAPW,qBAAkB;IAAA;EAAA;;4EAAlB,qBAAkB,SAAlB,oBAAkB,UAAA,CAAA;EAAA;;;sEAAlB,oBAAkB,CAAA;UAD9B;;;AAuDK,IAAO,sBAAP,MAAO,qBAAmB;EAHhC,cAAA;AAIU,SAAA,QAAQ,OAAO,YAAY;AAG3B,SAAA,UAAU,OAAmB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AACvC,SAAA,SAAS,KAAK,QAAQ,WAAU;AAGxB,SAAA,aAAa,OAAwB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,YAAY,KAAK,WAAW,WAAU;AAG9B,SAAA,SAAS,OAAmB;MAClC,OAAO;MACP,QAAQ;QACN,SAAS;QACT,MAAM;QACN,YAAY;QACZ,YAAY;QACZ,UAAU;QACV,UAAU;QACV,IAAI;QACJ,SAAS;;MAEX,YAAY;QACV,MAAM;QACN,SAAS;QACT,OAAO;QACP,UAAU;;MAEZ,UAAU;OACX,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AACD,SAAA,QAAQ,KAAK,OAAO,WAAU;AAydtB,SAAA,YAAY,OAAgB,OAAO,cAAc,cAAc,UAAU,SAAS,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACrF,SAAA,WAAW,KAAK,UAAU,WAAU;;;;;EArd7C,OACE,OACA,SACA,SAAwD;AAGxD,UAAM,WAAW,KAAK,WAAW,OAAO,OAAO;AAG/C,QAAI,SAAS,UAAU;AACrB,eAAS,WAAW,QAAQ;IAC9B;AAGA,SAAK,SAAS,QAAQ;AAGtB,SAAK,QAAQ,OAAO,UAAQ,CAAC,UAAU,GAAG,KAAK,MAAM,GAAG,EAAE,CAAC,CAAC;AAC5D,SAAK,WAAW,IAAI,QAAQ;AAC5B,SAAK,YAAY,QAAQ;AAGzB,QAAI,CAAC,SAAS,QAAQ;AACpB,WAAK,UAAU,QAAQ;IACzB;AAGA,YAAQ,MAAM,IAAI,SAAS,KAAK,YAAW,CAAE,KAAK,SAAS,OAAO,IAAI;MACpE,OAAO;MACP;KACD;AAED,WAAO;EACT;;;;EAKQ,WAAW,OAAY,SAAa;AAC1C,UAAM,KAAK,OAAO,KAAK,IAAG,CAAE,IAAI,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AACvE,UAAM,aAAY,oBAAI,KAAI,GAAG,YAAW;AAGxC,QAAI,OAAO,UAAU,UAAU;AAC7B,aAAO;QACL;QACA,MAAM,KAAK,gBAAgB,KAAK;QAChC,UAAU;QACV,SAAS;QACT,aAAa,KAAK,cAAc,KAAK;QACrC,YAAY,KAAK,cAAc,KAAK;QACpC;QACA;;IAEJ;AAGA,QAAI,iBAAiB,OAAO;AAC1B,YAAM,OAAO,KAAK,gBAAgB,MAAM,OAAO;AAC/C,aAAO;QACL;QACA;QACA,UAAU;QACV,SAAS,MAAM;QACf,aAAa,KAAK,cAAc,MAAM,SAAS,IAAI;QACnD,YAAY,KAAK,cAAc,MAAM,SAAS,IAAI;QAClD,OAAO,MAAM;QACb;QACA;;IAEJ;AAGA,QAAI,OAAO,UAAU,UAAU;AAC7B,YAAM,UAAU,MAAM,WAAW,MAAM,SAAS,KAAK,UAAU,KAAK;AACpE,YAAM,OAAO,MAAM,QAAQ,KAAK,gBAAgB,OAAO;AACvD,aAAO;QACL;QACA;QACA,UAAU,MAAM,YAAY;QAC5B,MAAM,MAAM;QACZ;QACA,aAAa,MAAM,eAAe,KAAK,cAAc,SAAS,IAAI;QAClE,YAAY,MAAM,cAAc,KAAK,cAAc,SAAS,IAAI;QAChE,SAAS,MAAM,WAAW;QAC1B;QACA;;IAEJ;AAGA,WAAO;MACL;MACA,MAAM;MACN,UAAU;MACV,SAAS,OAAO,KAAK;MACrB,aAAa;MACb;MACA;;EAEJ;;;;EAKQ,gBAAgB,SAAe;AACrC,UAAM,MAAM,QAAQ,YAAW;AAE/B,QAAI,IAAI,SAAS,SAAS,KAAK,IAAI,SAAS,OAAO,KAAK,IAAI,SAAS,SAAS,KAAK,IAAI,SAAS,YAAY,GAAG;AAC7G,aAAO;IACT;AACA,QAAI,IAAI,SAAS,MAAM,KAAK,IAAI,SAAS,OAAO,KAAK,IAAI,SAAS,OAAO,KAAK,IAAI,SAAS,cAAc,KAAK,IAAI,SAAS,KAAK,GAAG;AACjI,aAAO;IACT;AACA,QAAI,IAAI,SAAS,YAAY,KAAK,IAAI,SAAS,WAAW,KAAK,IAAI,SAAS,KAAK,KAAK,IAAI,SAAS,eAAe,GAAG;AACnH,aAAO;IACT;AACA,QAAI,IAAI,SAAS,YAAY,KAAK,IAAI,SAAS,SAAS,KAAK,IAAI,SAAS,UAAU,KAAK,IAAI,SAAS,QAAQ,GAAG;AAC/G,aAAO;IACT;AACA,QAAI,IAAI,SAAS,UAAU,KAAK,IAAI,SAAS,UAAU,KAAK,IAAI,SAAS,OAAO,KAAK,IAAI,SAAS,MAAM,KAAK,IAAI,SAAS,MAAM,GAAG;AACjI,aAAO;IACT;AACA,QAAI,IAAI,SAAS,UAAU,KAAK,IAAI,SAAS,QAAQ,KAAK,IAAI,SAAS,KAAK,KAAK,IAAI,SAAS,OAAO,GAAG;AACtG,aAAO;IACT;AACA,QAAI,IAAI,SAAS,IAAI,KAAK,IAAI,SAAS,QAAQ,KAAK,IAAI,SAAS,QAAQ,KAAK,IAAI,SAAS,QAAQ,KAAK,IAAI,SAAS,OAAO,GAAG;AAC7H,aAAO;IACT;AAEA,WAAO;EACT;;;;EAKQ,cAAc,SAAiB,MAAgB;AACrD,UAAM,WAAsC;MAC1C,SAAS;MACT,MAAM;MACN,YAAY;MACZ,YAAY;MACZ,UAAU;MACV,UAAU;MACV,IAAI;MACJ,SAAS;;AAGX,QAAI,MAAM;AACR,aAAO,SAAS,IAAI;IACtB;AAGA,QAAI,QAAQ,SAAS,YAAY,GAAG;AAClC,YAAM,QAAQ,QAAQ,MAAM,kBAAkB;AAC9C,YAAM,UAAU,QAAQ,SAAS,MAAM,CAAC,CAAC,IAAI;AAC7C,aAAO,gEAAc,OAAO;IAC9B;AAEA,QAAI,QAAQ,SAAS,yBAAyB,GAAG;AAC/C,aAAO;IACT;AAEA,QAAI,QAAQ,SAAS,iBAAiB,GAAG;AACvC,aAAO;IACT;AAEA,WAAO,SAAS,KAAK,gBAAgB,OAAO,CAAC;EAC/C;;;;EAKQ,cAAc,SAAiB,MAAgB;AACrD,UAAM,cAAyC;MAC7C,SAAS;MACT,MAAM;MACN,YAAY;MACZ,YAAY;MACZ,UAAU;MACV,UAAU;MACV,IAAI;MACJ,SAAS;;AAIX,QAAI,QAAQ,SAAS,YAAY,GAAG;AAClC,aAAO;IACT;AAEA,QAAI,QAAQ,SAAS,SAAS,GAAG;AAC/B,aAAO;IACT;AAEA,WAAO,YAAY,QAAQ,KAAK,gBAAgB,OAAO,CAAC;EAC1D;;;;EAKQ,SAAS,OAAe;AAC9B,QAAI;AAEF,YAAM,UAAU,aAAa,QAAQ,sBAAsB,KAAK;AAChE,YAAM,OAAO,KAAK,MAAM,OAAO;AAG/B,WAAK,QAAQ,iCACR,QADQ;QAEX,WAAU,oBAAI,KAAI,GAAG,YAAW;QACjC;AAGD,YAAM,cAAc,KAAK,MAAM,GAAG,GAAG;AAErC,mBAAa,QAAQ,wBAAwB,KAAK,UAAU,WAAW,CAAC;IAC1E,SAAS,GAAG;AACV,cAAQ,MAAM,wBAAwB,CAAC;IACzC;EACF;;;;EAKQ,YAAY,OAAe;AACjC,SAAK,OAAO,OAAO,YAAU;MAC3B,OAAO,MAAM,QAAQ;MACrB,QAAQ,iCACH,MAAM,SADH;QAEN,CAAC,MAAM,IAAI,IAAI,MAAM,OAAO,MAAM,IAAI,KAAK,KAAK;;MAElD,YAAY,iCACP,MAAM,aADC;QAEV,CAAC,MAAM,QAAQ,IAAI,MAAM,WAAW,MAAM,QAAQ,KAAK,KAAK;;MAE9D,UAAU,MAAM,WAAW;MAC3B;EACJ;;;;EAKQ,UAAU,OAAe;AAC/B,YAAQ,MAAM,UAAU;MACtB,KAAK;AACH,aAAK,MAAM,KAAK,MAAM,WAAW;AACjC;MACF,KAAK;AACH,aAAK,MAAM,QAAQ,MAAM,WAAW;AACpC;MACF,KAAK;MACL,KAAK;AACH,aAAK,MAAM,MAAM,MAAM,WAAW;AAClC;IACJ;EACF;;;;EAKA,aAAa,QAAQ,KAAG;AACtB,QAAI;AACF,YAAM,UAAU,aAAa,QAAQ,sBAAsB,KAAK;AAChE,YAAM,OAAO,KAAK,MAAM,OAAO;AAC/B,aAAO,KAAK,MAAM,GAAG,KAAK;IAC5B,QAAQ;AACN,aAAO,CAAA;IACT;EACF;;;;EAKA,iBAAc;AACZ,iBAAa,WAAW,sBAAsB;AAC9C,SAAK,QAAQ,IAAI,CAAA,CAAE;AACnB,SAAK,OAAO,IAAI;MACd,OAAO;MACP,QAAQ;QACN,SAAS;QAAG,MAAM;QAAG,YAAY;QAAG,YAAY;QAChD,UAAU;QAAG,UAAU;QAAG,IAAI;QAAG,SAAS;;MAE5C,YAAY,EAAE,MAAM,GAAG,SAAS,GAAG,OAAO,GAAG,UAAU,EAAC;MACxD,UAAU;KACX;EACH;;;;EAKA,MAAM,KACJ,IACA,SACA,SAA4C;AAE5C,QAAI;AACF,aAAO,MAAM,GAAE;IACjB,SAAS,OAAO;AACd,WAAK,OAAO,OAAO,SAAS,OAAO;AACnC,aAAO,SAAS;IAClB;EACF;;;;EAKA,eAAe,WAAiB;AAC9B,WAAO;MACL,QAAQ,CAAC,OAAY,QAAiB,YAAkC;AACtE,eAAO,KAAK,OAAO,OAAO,EAAE,WAAW,OAAM,GAAI,OAAO;MAC1D;MACA,MAAM,CAAI,IAAsB,QAAiB,aAAgB;AAC/D,eAAO,KAAK,KAAK,IAAI,EAAE,WAAW,OAAM,GAAI,EAAE,SAAQ,CAAE;MAC1D;;EAEJ;;;;;;;;EAUA,MAAM,UACJ,IACA,UAOI,CAAA,GAAE;AAEN,UAAM,EACJ,aAAa,GACb,QAAQ,KACR,UAAU,GACV,UAAU,CAAC,MAAM,KAAK,YAAY,CAAC,GACnC,SACA,QAAO,IACL;AAEJ,QAAI;AAEJ,aAAS,UAAU,GAAG,WAAW,YAAY,WAAW;AACtD,UAAI;AACF,eAAO,MAAM,GAAE;MACjB,SAAS,OAAY;AACnB,oBAAY;AAGZ,YAAI,UAAU,cAAc,QAAQ,KAAK,GAAG;AAC1C,gBAAM,WAAW,QAAQ,KAAK,IAAI,SAAS,UAAU,CAAC;AAGtD,cAAI,SAAS;AACX,oBAAQ,OAAO,OAAO;UACxB,OAAO;AACL,oBAAQ,KAAK,iBAAiB,OAAO,IAAI,UAAU,OAAO,QAAQ,SAAS,MAAM,OAAO;UAC1F;AAGA,gBAAM,IAAI,QAAQ,aAAW,WAAW,SAAS,QAAQ,CAAC;QAC5D,OAAO;AAEL;QACF;MACF;IACF;AAGA,SAAK,OAAO,WAAW,OAAO;AAC9B,UAAM;EACR;;;;EAKQ,YAAY,OAAU;AAC5B,UAAM,WAAW,OAAO,WAAW,OAAO,KAAK,GAAG,YAAW;AAG7D,QAAI,QAAQ,SAAS,SAAS,KAC1B,QAAQ,SAAS,OAAO,KACxB,QAAQ,SAAS,SAAS,KAC1B,QAAQ,SAAS,oBAAoB,KACrC,QAAQ,SAAS,YAAY,GAAG;AAClC,aAAO;IACT;AAGA,QAAI,QAAQ,SAAS,KAAK,KACtB,QAAQ,SAAS,KAAK,KACtB,QAAQ,SAAS,KAAK,KACtB,QAAQ,SAAS,KAAK,GAAG;AAC3B,aAAO;IACT;AAGA,UAAM,SAAS,OAAO,UAAU,OAAO,UAAU;AACjD,QAAI,UAAU,UAAU,OAAO,SAAS,KAAK;AAC3C,aAAO;IACT;AAGA,QAAI,QAAQ,SAAS,YAAY,GAAG;AAClC,aAAO;IACT;AAEA,WAAO;EACT;;;;;EAMA,MAAM,QACJ,KACA,UAAuB,CAAA,GACvB,SAKI,CAAA,GAAE;AAEN,UAAM,EAAE,QAAQ,MAAM,aAAa,GAAG,SAAS,SAAS,MAAK,IAAK;AAElE,UAAM,UAAU,YAAW;AACzB,YAAM,WAAW,MAAM,MAAM,KAAK,iCAC7B,UAD6B;QAEhC,SAAS;UACP,gBAAgB;WACb,QAAQ;QAEd;AAED,UAAI,CAAC,SAAS,IAAI;AAChB,cAAM,YAAY,MAAM,SAAS,KAAI,EAAG,MAAM,OAAO,CAAA,EAAG;AACxD,cAAM,QAAQ,IAAI,MAAM,UAAU,SAAS,UAAU,WAAW,QAAQ,SAAS,MAAM,EAAE;AACxF,cAAc,SAAS,SAAS;AAChC,cAAc,OAAO;AACtB,cAAM;MACR;AAEA,aAAO,SAAS,KAAI;IACtB;AAEA,QAAI,OAAO;AACT,aAAO,KAAK,UAAU,SAAS,EAAE,YAAY,QAAO,CAAE;IACxD,OAAO;AACL,UAAI;AACF,eAAO,MAAM,QAAO;MACtB,SAAS,OAAO;AACd,YAAI,CAAC,QAAQ;AACX,eAAK,OAAO,OAAO,OAAO;QAC5B;AACA,cAAM;MACR;IACF;EACF;;;;;EAYA,wBAAqB;AACnB,QAAI,OAAO,WAAW;AAAa;AAEnC,WAAO,iBAAiB,UAAU,MAAK;AACrC,WAAK,UAAU,IAAI,IAAI;AACvB,WAAK,MAAM,QAAQ,4CAAS;IAC9B,CAAC;AAED,WAAO,iBAAiB,WAAW,MAAK;AACtC,WAAK,UAAU,IAAI,KAAK;AACxB,WAAK,MAAM,QAAQ,wGAAmB;IACxC,CAAC;EACH;;;;EAKA,eAAY;AACV,WAAO,KAAK,UAAS;EACvB;;;;EAKA,MAAM,YACJ,SACA,WACA,iBAAiB,oDAAU;AAE3B,UAAM,iBAAiB,IAAI,QAAe,CAAC,GAAG,WAAU;AACtD,iBAAW,MAAK;AACd,eAAO,IAAI,MAAM,cAAc,CAAC;MAClC,GAAG,SAAS;IACd,CAAC;AAED,WAAO,QAAQ,KAAK,CAAC,SAAS,cAAc,CAAC;EAC/C;;;uCApiBW,sBAAmB;IAAA;EAAA;;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;EAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;;;ACzBK,IAAO,2BAAP,MAAO,0BAAwB;EAgCnC,cAAA;AA/BQ,SAAA,SAAS,OAAO,MAAM;AACtB,SAAA,QAAQ,OAAO,YAAY;AAG3B,SAAA,aAAa,OAAO,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAChC,SAAA,YAAY,KAAK,WAAW,WAAU;AAE9B,SAAA,iBAAiB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AACrC,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAEtC,SAAA,aAAa,OAA8B,oBAAI,IAAG,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAC5D,SAAA,YAAY,SAAS,MAAM,MAAM,KAAK,KAAK,WAAU,EAAG,OAAM,CAAE,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAGjE,SAAA,sBAAsB,SAAS,MAAK;AAClC,YAAM,YAAY,KAAK,UAAS;AAChC,YAAM,UAAU,oBAAI,IAAG;AAEvB,iBAAW,YAAY,WAAW;AAChC,YAAI,CAAC,QAAQ,IAAI,SAAS,QAAQ,GAAG;AACnC,kBAAQ,IAAI,SAAS,UAAU,CAAA,CAAE;QACnC;AACA,gBAAQ,IAAI,SAAS,QAAQ,EAAG,KAAK,QAAQ;MAC/C;AAEA,aAAO;IACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAMC,SAAK,iBAAiB,KAAK,cAAc,KAAK,IAAI;AAClD,SAAK,yBAAwB;AAC7B,SAAK,eAAc;EACrB;EAEA,cAAW;AACT,SAAK,cAAa;EACpB;;;;EAKQ,2BAAwB;AAE9B,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAM,KAAK,OAAO,SAAS,CAAC,YAAY,CAAC;KAClD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAM,KAAK,OAAO,SAAS,CAAC,WAAW,CAAC;KACjD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAM,KAAK,OAAO,SAAS,CAAC,gBAAgB,CAAC;KACtD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAM,KAAK,OAAO,SAAS,CAAC,eAAe,CAAC;KACrD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAM,KAAK,OAAO,SAAS,CAAC,YAAY,CAAC;KAClD;AAGD,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAK;AAEX,eAAO,cAAc,IAAI,YAAY,mBAAmB,CAAC;MAC3D;KACD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ;MACR,QAAQ,MAAK;AACX,eAAO,cAAc,IAAI,YAAY,iBAAiB,CAAC;MACzD;KACD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ;MACR,QAAQ,MAAK;AACX,eAAO,cAAc,IAAI,YAAY,eAAe,CAAC;MACvD;KACD;AAGD,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAM,KAAK,WAAU;KAC9B;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ;MACR,QAAQ,MAAK;AACX,YAAI,KAAK,eAAc,GAAI;AACzB,eAAK,SAAQ;QACf,OAAO;AACL,iBAAO,cAAc,IAAI,YAAY,iBAAiB,CAAC;QACzD;MACF;KACD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAK;AACX,eAAO,cAAc,IAAI,YAAY,kBAAkB,CAAC;MAC1D;KACD;AAGD,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAK;AACX,eAAO,cAAc,IAAI,YAAY,eAAe,CAAC;MACvD;KACD;AAED,SAAK,SAAS;MACZ,IAAI;MACJ,KAAK;MACL,aAAa;MACb,UAAU;MACV,QAAQ,MAAM,KAAK,OAAO,SAAS,CAAC,WAAW,CAAC;KACjD;EACH;;;;EAKA,SAAS,UAAkB;AACzB,SAAK,WAAW,OAAO,SAAM;AAC3B,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,aAAO,IAAI,SAAS,IAAI,iCAAK,WAAL,EAAe,SAAS,SAAS,WAAW,KAAI,EAAE;AAC1E,aAAO;IACT,CAAC;EACH;;;;EAKA,WAAW,IAAU;AACnB,SAAK,WAAW,OAAO,SAAM;AAC3B,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,aAAO,OAAO,EAAE;AAChB,aAAO;IACT,CAAC;EACH;;;;EAKA,WAAW,IAAY,SAAgB;AACrC,SAAK,WAAW,OAAO,SAAM;AAC3B,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,YAAM,WAAW,OAAO,IAAI,EAAE;AAC9B,UAAI,UAAU;AACZ,eAAO,IAAI,IAAI,iCAAK,WAAL,EAAe,QAAO,EAAE;MACzC;AACA,aAAO;IACT,CAAC;EACH;;;;EAKA,iBAAiB,SAAgB;AAC/B,SAAK,WAAW,IAAI,OAAO;EAC7B;;;;EAKA,WAAQ;AACN,SAAK,eAAe,IAAI,IAAI;EAC9B;;;;EAKA,WAAQ;AACN,SAAK,eAAe,IAAI,KAAK;EAC/B;;;;EAKA,aAAU;AACR,SAAK,eAAe,OAAO,OAAK,CAAC,CAAC;EACpC;;;;EAKQ,iBAAc;AACpB,aAAS,iBAAiB,WAAW,KAAK,cAAc;EAC1D;;;;EAKQ,gBAAa;AACnB,aAAS,oBAAoB,WAAW,KAAK,cAAc;EAC7D;;;;EAKQ,cAAc,OAAoB;AACxC,QAAI,CAAC,KAAK,WAAU;AAAI;AAGxB,UAAM,gBAAgB,KAAK,eAAc;AAGzC,UAAM,QAAQ,KAAK,cAAc,KAAK;AACtC,UAAM,YAAY,KAAK,cAAc,KAAK;AAG1C,eAAW,YAAY,KAAK,WAAU,EAAG,OAAM,GAAI;AACjD,UAAI,CAAC,SAAS;AAAS;AAGvB,UAAI,iBAAiB,CAAC,SAAS;AAAQ;AAEvC,UAAI,KAAK,cAAc,WAAW,SAAS,GAAG,GAAG;AAC/C,cAAM,eAAc;AACpB,cAAM,gBAAe;AAErB,YAAI;AACF,mBAAS,OAAM;QACjB,SAAS,OAAO;AACd,kBAAQ,MAAM,2BAA2B,SAAS,EAAE,IAAI,KAAK;QAC/D;AACA;MACF;IACF;EACF;;;;EAKQ,iBAAc;AACpB,UAAM,gBAAgB,SAAS;AAC/B,QAAI,CAAC;AAAe,aAAO;AAE3B,UAAM,UAAU,cAAc,QAAQ,YAAW;AACjD,WACE,YAAY,WACZ,YAAY,cACZ,YAAY,YACX,cAA8B;EAEnC;;;;EAKQ,cAAc,OAAoB;AACxC,WAAO;MACL,KAAK,MAAM,IAAI,YAAW;MAC1B,MAAM,MAAM;MACZ,OAAO,MAAM;MACb,KAAK,MAAM;MACX,MAAM,MAAM;;EAEhB;;;;EAKQ,cAAc,OAAe;AACnC,UAAM,QAAkB,CAAA;AAExB,QAAI,MAAM,QAAQ,MAAM;AAAM,YAAM,KAAK,MAAM;AAC/C,QAAI,MAAM;AAAO,YAAM,KAAK,OAAO;AACnC,QAAI,MAAM;AAAK,YAAM,KAAK,KAAK;AAE/B,UAAM,KAAK,MAAM,GAAG;AAEpB,WAAO,MAAM,KAAK,GAAG;EACvB;;;;EAKQ,cAAc,SAAiB,aAAmB;AAExD,QAAI,YAAY,SAAS,GAAG,GAAG;AAE7B,aAAO;IACT;AAGA,UAAM,aAAa,YAAY,YAAW,EACvC,QAAQ,QAAQ,OAAO,EACvB,QAAQ,YAAY,OAAO;AAE9B,WAAO,YAAY;EACrB;;;;EAKA,iBAAiB,UAA0B;AACzC,UAAM,SAA2C;MAC/C,YAAY;MACZ,SAAS;MACT,MAAM;MACN,OAAO;;AAET,WAAO,OAAO,QAAQ;EACxB;;;;EAKA,UAAU,KAAW;AACnB,WAAO,IACJ,QAAQ,QAAQ,QAAG,EACnB,QAAQ,SAAS,QAAG,EACpB,QAAQ,OAAO,QAAG,EAClB,QAAQ,QAAQ,QAAG,EACnB,QAAQ,UAAU,KAAK,EACvB,YAAW;EAChB;;;uCArXW,2BAAwB;IAAA;EAAA;;4EAAxB,2BAAwB,SAAxB,0BAAwB,WAAA,YAFvB,OAAM,CAAA;EAAA;;;sEAEP,0BAAwB,CAAA;UAHpC;WAAW;MACV,YAAY;KACb;;;;;ACsDK,IAAO,2BAAP,MAAO,0BAAwB;;EAqDnC,cAAA;AApDQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAC3B,SAAA,kBAAkB,OAAO,sBAAsB;AAK/C,SAAA,gBAAgB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AACpC,SAAA,eAAe,KAAK,cAAc,WAAU;AAGpC,SAAA,YAAY,OAAkC,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAC1D,SAAA,WAAW,KAAK,UAAU,WAAU;AAG5B,SAAA,SAAS,OAAwB;MACvC,OAAO;MACP,MAAM;MACN,WAAW;MACX,SAAS;OACV,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AACD,SAAA,QAAQ,KAAK,OAAO,WAAU;AAGtB,SAAA,WAAW,OAA4B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,UAAU,KAAK,SAAS,WAAU;AAG1B,SAAA,cAAc,OAAgC,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAC1D,SAAA,aAAa,KAAK,YAAY,WAAU;AAKxC,SAAA,oBAAoB,IAAI,QAAO;AAG/B,SAAA,uBAAuB,IAAI,QAAO;AAGlC,SAAA,sBAAsB,IAAI,QAAO;AAIjC,SAAA,iBAAiB,SAAS,MAAM,KAAK,OAAM,EAAG,WAAS,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAEvD,SAAA,aAAa,SAAS,MAAK;AACzB,aAAO,CAAC,KAAK,cAAa,KAAM,KAAK,OAAM,EAAG,YAAY;IAC5D,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAWO,SAAA,uBAA+B;AAC/B,SAAA,sBAAuD,EAAE,MAAM,GAAG,OAAO,EAAC;AAPhF,SAAK,eAAc;AACnB,SAAK,UAAS;AACd,SAAK,YAAW;EAClB;EAMQ,iBAAc;AAEpB,SAAK,IAAI,GAAG,+BAA+B,CAAC,SAAa;AACvD,UAAI,MAAM;AAER,YAAI,aAAa,KAAK,UAAU;AAChC,YAAI,KAAK,WAAW,YAAY;AAC9B,uBAAa,KAAK,WAAW;QAC/B,WAAW,KAAK,WAAW,YAAY;AACrC,uBAAa;AACb,eAAK,uBAAuB,KAAK,IAAG;AACpC,eAAK,sBAAsB,EAAE,MAAM,KAAK,IAAG,GAAI,OAAO,EAAC;QACzD,WAAW,KAAK,WAAW,WAAW;AACpC,uBAAa,KAAK,WAAW;QAC/B,WAAW,KAAK,WAAW,aAAa;AACtC,uBAAa;QACf,WAAW,KAAK,WAAW,cAAc;AACvC,uBAAa,6BAAS,KAAK,aAAa,CAAC,IAAI,KAAK,SAAS,GAAG;QAChE;AAGA,cAAM,MAAM,KAAK,IAAG;AACpB,cAAM,UAAU,KAAK,aAAa;AAClC,cAAM,QAAQ,KAAK,SAAS;AAC5B,cAAM,iBAAiB,KAAK,uBAAuB,KAAK,OAAO,MAAM,KAAK,wBAAwB,GAAI,IAAI;AAE1G,YAAI,QAAQ;AACZ,YAAI,mBAAmB;AAEvB,YAAI,UAAU,KAAK,iBAAiB,GAAG;AACrC,kBAAQ,KAAK,MAAO,UAAU,iBAAkB,EAAE,IAAI;AACtD,gBAAM,YAAY,QAAQ;AAC1B,cAAI,QAAQ,KAAK,YAAY,GAAG;AAC9B,+BAAmB,KAAK,KAAK,YAAY,KAAK;UAChD;QACF;AAGA,YAAI,KAAK,WAAW,gBAAgB,mBAAmB,GAAG;AACxD,gBAAM,OAAO,KAAK,MAAM,mBAAmB,EAAE;AAC7C,gBAAM,OAAO,mBAAmB;AAChC,gBAAM,UAAU,OAAO,IAAI,GAAG,IAAI,SAAI,IAAI,WAAM,GAAG,IAAI;AACvD,uBAAa,6BAAS,OAAO,IAAI,KAAK,8BAAU,OAAO;QACzD;AAEA,cAAM,WAA+B;UACnC,SAAS,OAAO,KAAK,cAAc,KAAK,OAAO;UAC/C;UACA;UACA,QAAQ;UACR,SAAS,QAAQ,IAAI,KAAK,MAAO,UAAU,QAAS,GAAG,IAAI;UAC3D;UACA;UACA;UACA,WAAW,KAAK,aAAa;;AAE/B,aAAK,UAAU,IAAI,QAAQ;AAC3B,aAAK,oBAAoB,KAAK,QAAQ;MACxC;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,qBAAqB,CAAC,SAAa;AAC7C,WAAK,cAAc,IAAI,KAAK;AAC5B,WAAK,UAAU,IAAI,IAAI;AAEvB,UAAI,KAAK,WAAW,KAAK,SAAS;AAChC,cAAM,SAAS,KAAK,wBAAwB,IAAI;AAChD,aAAK,YAAY,IAAI,MAAM;AAC3B,aAAK,qBAAqB,KAAK,MAAM;AAGrC,YAAI,KAAK,WAAW;AAClB,eAAK,MAAM,KAAK,uDAAa,KAAK,MAAM,KAAK,WAAW,EAAE,CAAC,2BAAO;QACpE;AAGA,aAAK,OAAO,OAAO,OAAM,iCACpB,IADoB;UAEvB,MAAM,EAAE,OAAO,OAAO;UACtB,WAAW,KAAK,IAAI,GAAG,EAAE,YAAY,OAAO,KAAK;UACjD;AAGF,aAAK,qBAAqB,MAAM;MAClC,WAAW,KAAK,OAAO;AAErB,cAAM,aAAa,KAAK,mBAAmB,KAAK,YAAY,KAAK,aAAa;AAC9E,YAAI,YAAY;AACd,eAAK,MAAM,QAAQ,GAAG,KAAK,KAAK;;YAAU,UAAU,EAAE;QACxD,OAAO;AACL,eAAK,MAAM,MAAM,iCAAQ,KAAK,KAAK,EAAE;QACvC;MACF;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,oBAAoB,CAAC,SAAa;AAC5C,UAAI,MAAM;AACR,aAAK,OAAO,IAAI;UACd,OAAO,KAAK,SAAS;UACrB,MAAM,KAAK,QAAQ;UACnB,WAAW,KAAK,aAAa;UAC7B,SAAS,KAAK,WAAW;SAC1B;MACH;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,mCAAmC,CAAC,SAAa;AAC3D,UAAI,KAAK,SAAS;AAChB,aAAK,MAAM,QAAQ,oDAAY,KAAK,aAAa,cAAI,MAAM,KAAK,SAAS,qBAAM;MACjF,OAAO;AACL,aAAK,MAAM,MAAM,oDAAY,KAAK,SAAS,0BAAM,EAAE;MACrD;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,iCAAiC,CAAC,SAAa;AACzD,UAAI,KAAK,SAAS;AAChB,gBAAQ,IAAI,gDAAgD,KAAK,MAAM;MACzE;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,oBAAoB,CAAC,SAAa;AAC5C,UAAI,KAAK,WAAW,KAAK,SAAS;AAEhC,cAAM,OAAO,IAAI,KAAK,CAAC,KAAK,OAAO,GAAG;UACpC,MAAM,KAAK,WAAW,SAAS,qBAAqB;SACrD;AACD,cAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,cAAM,IAAI,SAAS,cAAc,GAAG;AACpC,UAAE,OAAO;AACT,UAAE,WAAW,KAAK;AAClB,UAAE,MAAK;AACP,YAAI,gBAAgB,GAAG;AACvB,aAAK,MAAM,QAAQ,oCAAW,KAAK,QAAQ,EAAE;MAC/C,WAAW,KAAK,OAAO;AACrB,aAAK,MAAM,MAAM,6BAAS,KAAK,KAAK,EAAE;MACxC;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,wBAAwB,CAAC,SAAa;AAChD,UAAI,KAAK,SAAS;AAChB,aAAK,MAAM,QAAQ,iDAAc,KAAK,MAAM,6BAAS,KAAK,OAAO,SAAI;MACvE,OAAO;AACL,aAAK,MAAM,MAAM,6BAAS,KAAK,KAAK,EAAE;MACxC;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,kBAAkB,CAAC,SAAa;AAC1C,UAAI,KAAK,SAAS;AAChB,aAAK,MAAM,QAAQ,gBAAM,KAAK,WAAW,QAAQ,iBAAO,cAAI,qBAAM,KAAK,GAAG,WAAM,KAAK,KAAK,qBAAM;MAClG;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAAa;AAC/C,UAAI,KAAK,SAAS;AAChB,aAAK,MAAM,QAAQ,gDAAa,KAAK,KAAK,qBAAM;MAClD;IACF,CAAC;EACH;;;;;EAOA,MAAM,eACJE,QACA,QAA8B;AAE9B,QAAI,KAAK,cAAa,GAAI;AACxB,WAAK,MAAM,QAAQ,wDAAW;AAC9B,aAAO;IACT;AAEA,QAAI,KAAK,OAAM,EAAG,aAAa,GAAG;AAChC,WAAK,MAAM,MAAM,4CAAS;AAC1B,aAAO;IACT;AAEA,SAAK,cAAc,IAAI,IAAI;AAC3B,SAAK,UAAU,IAAI;MACjB,SAASA,OAAM;MACf,SAAS;MACT,OAAO,OAAO,UAAU,KAAKA,OAAM,cAAc,OAAO;MACxD,QAAQ;MACR,SAAS;KACV;AAGD,QAAI,SAAS;AACb,QAAIA,OAAM,KAAK;AACb,YAAM,QAAQA,OAAM,IAAI,MAAM,iBAAiB;AAC/C,UAAI,OAAO;AACT,iBAAS,MAAM,CAAC;MAClB;IACF;AAGA,SAAK,IAAI,KAAK,mBAAmB;MAC/B,QAAQ,UAAUA,OAAM;MACxB,UAAU;MACV,YAAYA,OAAM;MAClB,WAAWA,OAAM;MACjB,OAAO,OAAO,UAAU,KAAK,SAAY,OAAO;MAChD,SAAS;QACP,MAAM,CAAC,OAAO,QAAQ;QACtB,SAAS,OAAO,QAAQ,iBAAiB;QACzC,QAAQ,OAAO,QAAQ,iBAAiB;QACxC,SAAS,OAAO,QAAQ;QACxB,aAAa,OAAO,QAAQ;QAC5B,WAAW,OAAO,QAAQ;QAC1B,eAAe,OAAO,QAAQ;;MAEhC,UAAU,OAAO,SAAS;MAC1B,gBAAgB,OAAO,SAAS;KACjC;AAED,SAAK,MAAM,KAAK,sCAAWA,OAAM,IAAI,wBAAS;AAG9C,SAAK,aAAa;MAChB,IAAI,GAAG,KAAK,IAAG,CAAE;MACjB,SAASA,OAAM;MACf,WAAWA,OAAM;MACjB,UAAUA,OAAM;MAChB,OAAO;MACP;MACA,WAAW,oBAAI,KAAI;MACnB,mBAAmB,OAAO,SAAS;KACpC;AAED,WAAO;EACT;;;;EAKQ,wBAAwB,MAAS;AACvC,UAAM,UAAU,KAAK,WAAW,CAAA;AAGhC,QAAI,SAAS,GAAG,WAAW,GAAG,UAAU,GAAG,cAAc,GAAG,UAAU,GAAG,OAAO;AAEhF,eAAW,KAAK,SAAS;AACvB,UAAI,EAAE,kBAAkB,YAAY,EAAE,iBAAiB;AAAU;eACxD,EAAE,kBAAkB,cAAc,EAAE,iBAAiB;AAAY;AAC1E,UAAI,EAAE,cAAc,EAAE;AAAW;AACjC,UAAI,EAAE;AAAU;AAChB,UAAI,EAAE,cAAc,EAAE;AAAW;AACjC,UAAI,EAAE,UAAU,EAAE;AAAO;IAC3B;AAEA,UAAM,SAA2B;MAC/B,SAAS;MACT,SAAS,OAAO,KAAK,cAAc,KAAK,OAAO;MAC/C,WAAW,KAAK,aAAa;MAC7B,OAAO,QAAQ;MACf,OAAO;QACL,OAAO,QAAQ;QACf;QACA;QACA;QACA;QACA;QACA;;MAEF,SAAS,QAAQ,IAAI,CAAC,OAAY;QAChC,YAAY,OAAO,EAAE,eAAe,EAAE,EAAE;QACxC,UAAU,EAAE;QACZ,WAAW,EAAE,cAAc,EAAE;QAC7B,UAAU,EAAE,aAAa,EAAE;QAC3B,aAAa,EAAE,gBAAgB,EAAE,eAAe,EAAE,cAAc,EAAE,YAAY;QAC9E,OAAO,EAAE;QACT,OAAO,EAAE,UAAU,EAAE,SAAS;QAC9B,WAAW,EAAE,cAAc,EAAE,aAAa;QAC1C,YAAY,EAAE,eAAe,EAAE,cAAc;QAC7C,cAAc,EAAE,iBAAiB,EAAE,gBAAgB;QACnD,UAAU,EAAE,aAAa,EAAE;QAC3B,WAAW,EAAE,cAAc,EAAE;QAC7B,eAAe,EAAE,kBAAkB,EAAE;QACrC,YAAY,EAAE,eAAe,EAAE;QAC/B;MACF,UAAU,KAAK,YAAY;MAC3B,WAAW,oBAAI,KAAI;;AAIrB,SAAK,SAAS,OAAO,OAAI;AACvB,YAAM,SAAS,EAAE,CAAC;AAClB,UAAI,UAAU,OAAO,YAAY,OAAO,SAAS;AAC/C,eAAO,CAAC,iCAAK,SAAL,EAAa,OAAO,OAAO,MAAK,IAAI,GAAG,EAAE,MAAM,CAAC,CAAC;MAC3D;AACA,aAAO;IACT,CAAC;AAGD,SAAK,kBAAkB,KAAK;MAC1B,QAAQ;MACR,OAAO,OAAO;MACd,WAAW,OAAO;KACnB;AAED,SAAK,MAAM,QAAQ,mCAAU,OAAO,KAAK,qBAAM;AAE/C,WAAO;EACT;;;;EAKA,MAAM,qBAAqB,QAAwB;AACjD,QAAI,CAAC,OAAO,QAAQ;AAAQ;AAG5B,SAAK,IAAI,KAAK,6BAA6B;MACzC,SAAS,OAAO;MAChB,YAAY;MACZ,YAAY,OAAO;MACnB,UAAU,OAAO;KAClB;AAGD,eAAW,MAAK;AACd,WAAK,gBAAgB,aAAY;AACjC,WAAK,gBAAgB,UAAS;IAChC,GAAG,GAAG;AAEN,SAAK,MAAM,QAAQ,0BAAS,OAAO,KAAK,+DAAa;EACvD;;;;EAKA,iBAAc;AACZ,SAAK,IAAI,KAAK,mBAAmB,CAAA,CAAE;AACnC,SAAK,cAAc,IAAI,KAAK;AAC5B,SAAK,UAAU,IAAI,IAAI;AACvB,SAAK,MAAM,KAAK,gCAAO;EACzB;;;;;EAOA,0BACEA,QACA,QAA8B;AAE9B,QAAI,SAAS;AACb,QAAIA,OAAM,KAAK;AACb,YAAM,QAAQA,OAAM,IAAI,MAAM,iBAAiB;AAC/C,UAAI,OAAO;AACT,iBAAS,MAAM,CAAC;MAClB;IACF;AAEA,SAAK,IAAI,KAAK,+BAA+B;MAC3C,QAAQ,UAAUA,OAAM,cAAcA,OAAM;MAC5C,YAAYA,OAAM;MAClB,OAAO,OAAO,UAAU,KAAK,SAAY,OAAO;MAChD,SAAS;QACP,MAAM,CAAC,OAAO,QAAQ;QACtB,cAAc,OAAO,QAAQ;;KAEhC;AAED,SAAK,MAAM,QAAQ,4GAAqB;EAC1C;;;;EAKA,qBAAkB;AAChB,SAAK,IAAI,KAAK,wBAAwB,CAAA,CAAE;EAC1C;;;;;EAOA,qBAAkB;AAChB,SAAK,IAAI,KAAK,wBAAwB,CAAA,CAAE;EAC1C;;;;EAKA,qBAAqB,QAAe;AAClC,SAAK,IAAI,KAAK,0BAA0B,EAAE,OAAM,CAAE;AAClD,SAAK,MAAM,KAAK,SAAS,qDAAa,4CAAS;EACjD;;;;;EAOA,cAAc,SAAyB,OAAO,SAAa;AACzD,SAAK,IAAI,KAAK,kBAAkB,EAAE,QAAQ,QAAO,CAAE;AACnD,SAAK,MAAM,KAAK,4BAAQ,OAAO,YAAW,CAAE,8BAAU;EACxD;;;;EAKA,qBAAkB;AAChB,SAAK,IAAI,KAAK,uBAAuB,CAAA,CAAE;AACvC,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;;EAKA,YAAY,SAAmB,KAAW;AACxC,SAAK,IAAI,KAAK,qBAAqB,EAAE,SAAS,KAAK,QAAQ,MAAK,CAAE;EACpE;;;;EAKA,eAAe,SAAmB,KAAW;AAC3C,SAAK,IAAI,KAAK,qBAAqB,EAAE,SAAS,KAAK,QAAQ,SAAQ,CAAE;EACvE;;;;EAKA,aAAU;AACR,SAAK,IAAI,KAAK,gBAAgB,CAAA,CAAE;EAClC;;;;EAKA,gBAAgB,QAAc;AAC5B,SAAK,IAAI,KAAK,qBAAqB,EAAE,OAAM,CAAE;EAC/C;;;;EAKA,cAAc,SAAiB;AAC7B,SAAK,IAAI,KAAK,kBAAkB,EAAE,QAAO,CAAE;EAC7C;;;;EAKA,kBAAkB,QAAe;AAC/B,SAAK,IAAI,KAAK,sBAAsB,EAAE,OAAM,CAAE;AAC9C,SAAK,MAAM,KAAK,qDAAa;EAC/B;;;;;EAOA,YAAS;AACP,SAAK,IAAI,KAAK,wBAAwB,CAAA,CAAE;EAC1C;;;;EAKA,aAAU;AACR,SAAK,IAAI,KAAK,0BAA0B,CAAA,CAAE;AAC1C,SAAK,UAAS;EAChB;;;;;EAOQ,cAAW;AAEjB,QAAI;AACF,YAAM,QAAQ,aAAa,QAAQ,oBAAoB;AACvD,UAAI,OAAO;AACT,cAAM,OAAO,KAAK,MAAM,KAAK;AAC7B,aAAK,SAAS,IAAI,KAAK,MAAM,GAAG,EAAE,CAAC;MACrC;IACF,SAAS,GAAG;AACV,cAAQ,MAAM,sCAAsC,CAAC;IACvD;EACF;;;;EAKQ,aAAa,QAAyB;AAC5C,SAAK,SAAS,OAAO,OAAI;AACvB,YAAM,UAAU,CAAC,QAAQ,GAAG,EAAE,MAAM,GAAG,EAAE,CAAC;AAE1C,UAAI;AACF,qBAAa,QAAQ,sBAAsB,KAAK,UAAU,OAAO,CAAC;MACpE,SAAS,GAAG;AACV,gBAAQ,MAAM,sCAAsC,CAAC;MACvD;AACA,aAAO;IACT,CAAC;EACH;;;;EAKA,eAAY;AACV,SAAK,SAAS,IAAI,CAAA,CAAE;AACpB,iBAAa,WAAW,oBAAoB;EAC9C;;;;;EAOQ,mBAAmB,WAAoB,cAAkB;AAC/D,QAAI,CAAC;AAAW,aAAO;AAEvB,UAAM,cAAsC;MAC1C,mBAAmB;MACnB,mBAAmB;MACnB,wBAAwB;MACxB,mBAAmB;MACnB,kBAAkB;MAClB,cAAc;MACd,mBAAmB;;AAGrB,QAAI,aAAa,YAAY,SAAS;AAGtC,QAAI,cAAc;AAChB,UAAI,aAAa,YAAY,aAAa,WAAW,GAAG;AACtD,qBAAa,sBAAO,aAAa,QAAQ;MAC3C;AACA,UAAI,aAAa,YAAY;AAC3B,qBAAa,aAAa;MAC5B;IACF;AAEA,WAAO,cAAc;EACvB;;;;EAKQ,qBAAqB,QAAwB;AACnD,UAAM,cAAwB,CAAA;AAG9B,QAAI,OAAO,UAAU,GAAG;AACtB,kBAAY,KAAK,4IAAyB;IAC5C,WAAW,OAAO,QAAQ,IAAI;AAC5B,kBAAY,KAAK,gIAAuB;IAC1C;AAGA,UAAM,aAAa,OAAO,OAAO,SAAS,OAAO,MAAM,SAAS,OAAO,QAAQ;AAC/E,QAAI,aAAa,OAAO,OAAO,QAAQ,IAAI;AACzC,kBAAY,KAAK,sLAAgC;IACnD;AAGA,QAAI,YAAY,SAAS,KAAK,OAAO,QAAQ,GAAG;AAE9C,cAAQ,IAAI,0CAA0C,WAAW;IACnE;EACF;;;;;EAOA,cAAcA,QAA4B,QAA8B;AACtE,UAAM,QAAQ,OAAO,UAAU,KAAKA,OAAM,cAAc,OAAO;AAC/D,WAAO,KAAK,IAAI,OAAOA,OAAM,aAAa,KAAK,OAAM,EAAG,SAAS;EACnE;;;uCA3oBW,2BAAwB;IAAA;EAAA;;4EAAxB,2BAAwB,SAAxB,0BAAwB,WAAA,YAFvB,OAAM,CAAA;EAAA;;;sEAEP,0BAAwB,CAAA;UAHpC;WAAW;MACV,YAAY;KACb;;;;;AC5CD,IAAM,wBAA8C;EAClD;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,OAAO;MACL,EAAE,IAAI,aAAa,UAAU,WAAW,MAAM,uCAAQ;MACtD,EAAE,IAAI,cAAc,UAAU,WAAW,MAAM,uCAAQ;MACvD,EAAE,IAAI,eAAe,UAAU,WAAW,MAAM,6BAAa;MAC7D,EAAE,IAAI,kBAAkB,UAAU,WAAW,MAAM,uCAAQ;MAC3D,EAAE,IAAI,cAAc,UAAU,WAAW,MAAM,uCAAQ;;;EAG3D;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,OAAO;MACL,EAAE,IAAI,gBAAgB,UAAU,WAAW,MAAM,4BAAiB;MAClE,EAAE,IAAI,aAAa,UAAU,WAAW,MAAM,uCAAQ;MACtD,EAAE,IAAI,eAAe,UAAU,WAAW,MAAM,uCAAQ;MACxD,EAAE,IAAI,UAAU,UAAU,WAAW,MAAM,uCAAQ;;;EAGvD;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,OAAO;MACL,EAAE,IAAI,WAAW,UAAU,UAAU,MAAM,+BAAU;MACrD,EAAE,IAAI,gBAAgB,UAAU,UAAU,MAAM,uCAAQ;MACxD,EAAE,IAAI,iBAAiB,UAAU,UAAU,MAAM,uCAAQ;MACzD,EAAE,IAAI,aAAa,UAAU,UAAU,MAAM,6CAAS;MACtD,EAAE,IAAI,UAAU,UAAU,UAAU,MAAM,8BAAS;;;EAGvD;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,OAAO;MACL,EAAE,IAAI,eAAe,UAAU,eAAe,MAAM,uCAAQ;MAC5D,EAAE,IAAI,YAAY,UAAU,eAAe,MAAM,yBAAS;MAC1D,EAAE,IAAI,cAAc,UAAU,eAAe,MAAM,uCAAQ;MAC3D,EAAE,IAAI,iBAAiB,UAAU,eAAe,MAAM,uCAAQ;;;EAGlE;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,OAAO;MACL,EAAE,IAAI,iBAAiB,UAAU,YAAY,MAAM,iCAAO;MAC1D,EAAE,IAAI,gBAAgB,UAAU,YAAY,MAAM,iCAAO;MACzD,EAAE,IAAI,WAAW,UAAU,YAAY,MAAM,2BAAM;MACnD,EAAE,IAAI,aAAa,UAAU,YAAY,MAAM,2BAAM;;;EAGzD;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,OAAO;MACL,EAAE,IAAI,iBAAiB,UAAU,MAAM,MAAM,sBAAW;MACxD,EAAE,IAAI,YAAY,UAAU,MAAM,MAAM,+BAAU;MAClD,EAAE,IAAI,YAAY,UAAU,MAAM,MAAM,iCAAO;;;;AAQ/C,IAAO,0BAAP,MAAO,yBAAuB;EAuBlC,cAAA;AAtBQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAG3B,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,iBAAiB,OAAgC,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AACrD,SAAA,YAAY,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACpB,SAAA,eAAe,OAAe,IAAE,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAGxC,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,WAAW,KAAK,UAAU,WAAU;AACpC,SAAA,cAAc,KAAK,aAAa,WAAU;AAGlC,SAAA,WAAW,OAA2B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAChD,SAAA,UAAU,KAAK,SAAS,WAAU;AAGlC,SAAA,aAAa;AAGX,SAAK,YAAW;AAChB,SAAK,kBAAiB;EACxB;;;;EAKQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,qBAAqB,CAAC,SAAa;AAC7C,WAAK,uBAAuB,IAAI;IAClC,CAAC;EACH;;;;EAKQ,cAAW;AACjB,QAAI;AACF,YAAM,aAAa,aAAa,QAAQ,8BAA8B;AACtE,UAAI,YAAY;AACd,aAAK,SAAS,IAAI,KAAK,MAAM,UAAU,CAAC;MAC1C;IACF,SAAS,GAAG;AACV,cAAQ,MAAM,sCAAsC,CAAC;IACvD;EACF;;;;EAKQ,cAAW;AACjB,QAAI;AACF,mBAAa,QAAQ,gCACnB,KAAK,UAAU,KAAK,SAAQ,EAAG,MAAM,GAAG,EAAE,CAAC,CAAC;IAChD,SAAS,GAAG;AACV,cAAQ,MAAM,sCAAsC,CAAC;IACvD;EACF;;;;EAKA,MAAM,oBAAiB;AACrB,QAAI,KAAK,WAAU,GAAI;AACrB,WAAK,MAAM,QAAQ,+CAAY;AAC/B,aAAO,KAAK,eAAc;IAC5B;AAEA,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,UAAU,IAAI,CAAC;AAGpB,UAAM,SAA2B;MAC/B,IAAI,QAAQ,KAAK,IAAG,CAAE;MACtB,YAAW,oBAAI,KAAI,GAAG,YAAW;MACjC,OAAO,KAAK,gBAAe;MAC3B,SAAS,EAAE,OAAO,GAAG,QAAQ,GAAG,UAAU,GAAG,QAAQ,EAAC;MACtD,eAAe;MACf,iBAAiB,CAAA;;AAGnB,SAAK,eAAe,IAAI,MAAM;AAC9B,WAAO,QAAQ,QAAQ,OAAO,MAAM;AAGpC,aAAS,IAAI,GAAG,IAAI,OAAO,MAAM,QAAQ,KAAK;AAC5C,YAAM,OAAO,OAAO,MAAM,CAAC;AAC3B,WAAK,SAAS;AACd,WAAK,aAAa,IAAI,KAAK,IAAI;AAC/B,WAAK,eAAe,IAAI,mBAAK,OAAQ;AAErC,UAAI;AACF,cAAM,KAAK,kBAAkB,IAAI;MACnC,SAAS,OAAO;AACd,aAAK,SAAS;AACd,aAAK,UAAU;AACf,aAAK,UAAU,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;MACtE;AAGA,WAAK,UAAU,IAAI,KAAK,OAAQ,IAAI,KAAK,OAAO,MAAM,SAAU,GAAG,CAAC;AACpE,WAAK,eAAe,IAAI,mBAAK,OAAQ;AAGrC,YAAM,IAAI,QAAQ,aAAW,WAAW,SAAS,GAAG,CAAC;IACvD;AAGA,SAAK,iBAAiB,MAAM;AAC5B,WAAO,WAAU,oBAAI,KAAI,GAAG,YAAW;AAGvC,SAAK,SAAS,OAAO,OAAK,CAAC,QAAQ,GAAG,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC;AACpD,SAAK,YAAW;AAEhB,SAAK,eAAe,IAAI,MAAM;AAC9B,SAAK,WAAW,IAAI,KAAK;AACzB,SAAK,aAAa,IAAI,EAAE;AAGxB,QAAI,OAAO,kBAAkB,WAAW;AACtC,WAAK,MAAM,QAAQ,sDAAY;IACjC,WAAW,OAAO,kBAAkB,WAAW;AAC7C,WAAK,MAAM,QAAQ,6BAAS,OAAO,QAAQ,QAAQ,qBAAM;IAC3D,OAAO;AACL,WAAK,MAAM,MAAM,uBAAQ,OAAO,QAAQ,MAAM,6CAAU;IAC1D;AAEA,WAAO;EACT;;;;EAKQ,kBAAe;AACrB,UAAM,QAA0B,CAAA;AAChC,eAAW,YAAY,uBAAuB;AAC5C,iBAAW,QAAQ,SAAS,OAAO;AACjC,cAAM,KAAK,iCACN,OADM;UAET,QAAQ;UACT;MACH;IACF;AACA,WAAO;EACT;;;;EAKQ,MAAM,kBAAkB,MAAoB;AAElD,UAAM,IAAI,QAAQ,aAAW,WAAW,SAAS,MAAM,KAAK,OAAM,IAAK,GAAG,CAAC;AAE3E,YAAQ,KAAK,IAAI;MACf,KAAK;AACH,cAAM,KAAK,kBAAkB,IAAI;AACjC;MACF,KAAK;AACH,cAAM,KAAK,mBAAmB,IAAI;AAClC;MACF,KAAK;AACH,cAAM,KAAK,oBAAoB,IAAI;AACnC;MACF,KAAK;AACH,cAAM,KAAK,eAAe,IAAI;AAC9B;MACF,KAAK;AACH,cAAM,KAAK,mBAAmB,IAAI;AAClC;MACF,KAAK;AACH,cAAM,KAAK,wBAAwB,IAAI;AACvC;MACF,KAAK;AACH,cAAM,KAAK,iBAAiB,IAAI;AAChC;MACF,KAAK;AACH,cAAM,KAAK,oBAAoB,IAAI;AACnC;MACF,KAAK;AACH,cAAM,KAAK,gBAAgB,IAAI;AAC/B;MACF,KAAK;AACH,cAAM,KAAK,oBAAoB,IAAI;AACnC;MACF,KAAK;AACH,cAAM,KAAK,oBAAoB,IAAI;AACnC;MACF,KAAK;AACH,cAAM,KAAK,qBAAqB,IAAI;AACpC;MACF,KAAK;AACH,cAAM,KAAK,iBAAiB,IAAI;AAChC;MACF,KAAK;AACH,cAAM,KAAK,cAAc,IAAI;AAC7B;MACF,KAAK;AACH,cAAM,KAAK,iBAAiB,IAAI;AAChC;MACF,KAAK;AACH,cAAM,KAAK,cAAc,IAAI;AAC7B;MACF,KAAK;AACH,cAAM,KAAK,iBAAiB,IAAI;AAChC;MACF,KAAK;AACH,cAAM,KAAK,kBAAkB,IAAI;AACjC;MACF,KAAK;AACH,cAAM,KAAK,kBAAkB,IAAI;AACjC;MACF,KAAK;AACH,cAAM,KAAK,iBAAiB,IAAI;AAChC;MACF,KAAK;AACH,cAAM,KAAK,YAAY,IAAI;AAC3B;MACF,KAAK;AACH,cAAM,KAAK,cAAc,IAAI;AAC7B;MACF,KAAK;AACH,cAAM,KAAK,kBAAkB,IAAI;AACjC;MACF,KAAK;AACH,cAAM,KAAK,aAAa,IAAI;AAC5B;MACF,KAAK;AACH,cAAM,KAAK,aAAa,IAAI;AAC5B;MACF;AACE,aAAK,SAAS;AACd,aAAK,UAAU;IACnB;EACF;;EAIQ,MAAM,kBAAkB,MAAoB;AAElD,QAAI;AACF,YAAM,WAAW,MAAM,KAAK,IAAI,OAAO,cAAc;AACrD,YAAM,QAAQ,UAAU,UAAU;AAElC,UAAI,UAAU,GAAG;AACf,aAAK,SAAS;AACd,aAAK,UAAU;AACf,aAAK,aAAa;AAClB,aAAK,UAAU;MACjB,OAAO;AACL,aAAK,SAAS;AACd,aAAK,UAAU,sBAAO,KAAK;MAC7B;IACF,QAAQ;AACN,WAAK,SAAS;AACd,WAAK,UAAU;IACjB;EACF;EAEQ,MAAM,mBAAmB,MAAoB;AACnD,QAAI;AACF,YAAM,WAAW,MAAM,KAAK,IAAI,OAAO,cAAc;AACrD,YAAM,SAAS,UAAU,OAAO,CAAC,MAAW,EAAE,WAAW,QAAQ,GAAG,UAAU;AAC9E,YAAM,QAAQ,UAAU,UAAU;AAElC,UAAI,UAAU,GAAG;AACf,aAAK,SAAS;AACd,aAAK,UAAU;MACjB,WAAW,WAAW,GAAG;AACvB,aAAK,SAAS;AACd,aAAK,UAAU;AACf,aAAK,aAAa;MACpB,WAAW,SAAS,OAAO;AACzB,aAAK,SAAS;AACd,aAAK,UAAU,GAAG,MAAM,IAAI,KAAK;AACjC,aAAK,aAAa;MACpB,OAAO;AACL,aAAK,SAAS;AACd,aAAK,UAAU,gBAAM,KAAK;MAC5B;IACF,QAAQ;AACN,WAAK,SAAS;AACd,WAAK,UAAU;IACjB;EACF;EAEQ,MAAM,oBAAoB,MAAoB;AAEpD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,eAAe,MAAoB;AAC/C,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,mBAAmB,MAAoB;AACnD,SAAK,SAAS;AACd,SAAK,UAAU;AACf,SAAK,UAAU;EACjB;EAEQ,MAAM,wBAAwB,MAAoB;AACxD,QAAI;AACF,YAAM,QAAQ,KAAK,IAAG;AACtB,YAAM,KAAK,IAAI,OAAO,0BAA0B;AAChD,YAAM,UAAU,KAAK,IAAG,IAAK;AAE7B,WAAK,SAAS;AACd,WAAK,UAAU,6BAAS,OAAO;IACjC,QAAQ;AACN,WAAK,SAAS;AACd,WAAK,UAAU;IACjB;EACF;EAEQ,MAAM,iBAAiB,MAAoB;AACjD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,oBAAoB,MAAoB;AACpD,UAAM,UAAU,KAAK,MAAM,KAAK,KAAK,OAAM,IAAK,GAAG;AAEnD,QAAI,UAAU,KAAK;AACjB,WAAK,SAAS;AACd,WAAK,UAAU,iCAAQ,OAAO;AAC9B,WAAK,aAAa;IACpB,OAAO;AACL,WAAK,SAAS;AACd,WAAK,UAAU,iCAAQ,OAAO;IAChC;EACF;EAEQ,MAAM,gBAAgB,MAAoB;AAChD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,oBAAoB,MAAoB;AACpD,QAAI;AACF,YAAM,cAAc,MAAM,KAAK,IAAI,OAAO,qBAAqB;AAE/D,UAAI,CAAC,aAAa,SAAS,CAAC,aAAa,SAAS;AAChD,aAAK,SAAS;AACd,aAAK,UAAU;AACf,aAAK,aAAa;AAClB,aAAK,UAAU;MACjB,OAAO;AACL,aAAK,SAAS;AACd,aAAK,UAAU;MACjB;IACF,QAAQ;AACN,WAAK,SAAS;AACd,WAAK,UAAU;IACjB;EACF;EAEQ,MAAM,oBAAoB,MAAoB;AACpD,QAAI;AACF,YAAM,WAAW,MAAM,KAAK,IAAI,OAAO,kBAAkB;AACzD,YAAM,QAAQ,UAAU,UAAU;AAElC,UAAI,UAAU,GAAG;AACf,aAAK,SAAS;AACd,aAAK,UAAU;AACf,aAAK,aAAa;MACpB,OAAO;AACL,aAAK,SAAS;AACd,aAAK,UAAU,sBAAO,KAAK;MAC7B;IACF,QAAQ;AACN,WAAK,SAAS;AACd,WAAK,UAAU;IACjB;EACF;EAEQ,MAAM,qBAAqB,MAAoB;AACrD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,iBAAiB,MAAoB;AACjD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,cAAc,MAAoB;AAC9C,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,iBAAiB,MAAoB;AAEjD,UAAM,SAAS,KAAK,MAAM,MAAM,KAAK,OAAM,IAAK,GAAG;AACnD,UAAM,aAAa,KAAK,MAAM,SAAS,OAAO,GAAG;AAEjD,QAAI,aAAa,IAAI;AACnB,WAAK,SAAS;AACd,WAAK,UAAU,6CAAU,MAAM;AAC/B,WAAK,aAAa;IACpB,OAAO;AACL,WAAK,SAAS;AACd,WAAK,UAAU,6CAAU,MAAM;IACjC;EACF;EAEQ,MAAM,cAAc,MAAoB;AAC9C,UAAM,QAAQ,KAAK,MAAM,KAAK,OAAM,IAAK,EAAE;AAC3C,SAAK,SAAS;AACd,SAAK,UAAU,+BAAW,KAAK;EACjC;EAEQ,MAAM,iBAAiB,MAAoB;AACjD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,kBAAkB,MAAoB;AAClD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,kBAAkB,MAAoB;AAClD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,iBAAiB,MAAoB;AACjD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,YAAY,MAAoB;AAC5C,UAAM,SAAS,KAAK,MAAM,KAAK,KAAK,OAAM,IAAK,EAAE;AACjD,SAAK,SAAS;AACd,SAAK,UAAU,uCAAS,MAAM;EAChC;EAEQ,MAAM,cAAc,MAAoB;AAC9C,SAAK,SAAS;AACd,SAAK,UAAU;AACf,SAAK,aAAa;EACpB;EAEQ,MAAM,kBAAkB,MAAoB;AAClD,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,aAAa,MAAoB;AAC7C,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;EAEQ,MAAM,aAAa,MAAoB;AAC7C,SAAK,SAAS;AACd,SAAK,UAAU;EACjB;;;;EAKQ,iBAAiB,QAAwB;AAC/C,WAAO,UAAU;MACf,OAAO,OAAO,MAAM;MACpB,QAAQ,OAAO,MAAM,OAAO,OAAK,EAAE,WAAW,QAAQ,EAAE;MACxD,UAAU,OAAO,MAAM,OAAO,OAAK,EAAE,WAAW,SAAS,EAAE;MAC3D,QAAQ,OAAO,MAAM,OAAO,OAAK,EAAE,WAAW,QAAQ,EAAE;;AAI1D,UAAM,kBAA4B,CAAA;AAClC,eAAW,QAAQ,OAAO,OAAO;AAC/B,UAAI,KAAK,WAAW,YAAY,KAAK,YAAY;AAC/C,wBAAgB,KAAK,KAAK,UAAU;MACtC;IACF;AACA,WAAO,kBAAkB;AAGzB,QAAI,OAAO,QAAQ,SAAS,GAAG;AAC7B,aAAO,gBAAgB;IACzB,WAAW,OAAO,QAAQ,WAAW,GAAG;AACtC,aAAO,gBAAgB;IACzB,OAAO;AACL,aAAO,gBAAgB;IACzB;EACF;;;;EAKQ,uBAAuB,MAAS;AACtC,UAAM,SAAS,KAAK,eAAc;AAClC,QAAI,CAAC;AAAQ;AAEb,UAAM,OAAO,OAAO,MAAM,KAAK,OAAK,EAAE,OAAO,KAAK,MAAM;AACxD,QAAI,MAAM;AACR,WAAK,SAAS,KAAK;AACnB,WAAK,UAAU,KAAK;AACpB,WAAK,UAAU,KAAK;AACpB,WAAK,aAAa,KAAK;AACvB,WAAK,eAAe,IAAI,mBAAK,OAAQ;IACvC;EACF;;;;EAKA,MAAM,OAAO,WAAiB;AAC5B,QAAI;AACF,WAAK,MAAM,KAAK,yCAAW;AAC3B,YAAM,KAAK,IAAI,OAAO,kBAAkB,EAAE,QAAQ,UAAS,CAAE;AAC7D,WAAK,MAAM,QAAQ,gCAAO;AAC1B,aAAO;IACT,SAAS,OAAO;AACd,WAAK,MAAM,MAAM,0BAAM;AACvB,aAAO;IACT;EACF;;;;EAKA,aAAa,QAAwB;AACnC,UAAM,QAAkB;MACtB;MACA;MACA,iCAAQ,IAAI,KAAK,OAAO,SAAS,EAAE,eAAc,CAAE;MACnD,iCAAQ,OAAO,UAAU,KAAK,OAAO,IAAI,KAAK,OAAO,OAAO,EAAE,QAAO,IAAK,IAAI,KAAK,OAAO,SAAS,EAAE,QAAO,KAAM,GAAI,IAAI,CAAC;MAC3H;MACA;MACA,6BAAS,OAAO,QAAQ,KAAK;MAC7B,uBAAQ,OAAO,QAAQ,MAAM;MAC7B,uBAAQ,OAAO,QAAQ,QAAQ;MAC/B,uBAAQ,OAAO,QAAQ,MAAM;MAC7B,mCAAU,OAAO,kBAAkB,YAAY,wBAAS,OAAO,kBAAkB,YAAY,8BAAU,qBAAM;MAC7G;MACA;MACA;;AAGF,eAAW,YAAY,uBAAuB;AAC5C,YAAM,KAAK,OAAO,SAAS,IAAI,IAAI,SAAS,IAAI,EAAE;AAClD,YAAM,gBAAgB,OAAO,MAAM,OAAO,OAAK,EAAE,aAAa,SAAS,EAAE;AACzE,iBAAW,QAAQ,eAAe;AAChC,cAAM,OAAO,KAAK,WAAW,WAAW,WAAM,KAAK,WAAW,YAAY,iBAAO;AACjF,cAAM,KAAK,KAAK,IAAI,IAAI,KAAK,IAAI,SAAI,KAAK,WAAW,cAAI,EAAE;AAC3D,YAAI,KAAK,YAAY;AACnB,gBAAM,KAAK,yBAAU,KAAK,UAAU,EAAE;QACxC;MACF;AACA,YAAM,KAAK,EAAE;IACf;AAEA,QAAI,OAAO,gBAAgB,SAAS,GAAG;AACrC,YAAM,KAAK,6BAAS;AACpB,iBAAW,OAAO,OAAO,iBAAiB;AACxC,cAAM,KAAK,KAAK,GAAG,EAAE;MACvB;IACF;AAEA,WAAO,MAAM,KAAK,IAAI;EACxB;;;uCAzjBW,0BAAuB;IAAA;EAAA;;4EAAvB,0BAAuB,SAAvB,yBAAuB,WAAA,YAFtB,OAAM,CAAA;EAAA;;;sEAEP,yBAAuB,CAAA;UAHnC;WAAW;MACV,YAAY;KACb;;;;;ACnHD,IAAM,eAAe,MAAc;AAEjC,MAAI,OAAO,WAAW,eAAgB,OAAe,UAAU;AAC7D,WAAO,CAAE,OAAe,SAAS;EACnC;AAEA,MAAI,OAAO,WAAW,eAAe,OAAO,UAAU;AACpD,WAAO,CAAC,OAAO,SAAS,SAAS,SAAS,WAAW;EACvD;AACA,SAAO;AACT;AAGA,IAAY;CAAZ,SAAYC,WAAQ;AAClB,EAAAA,UAAAA,UAAA,OAAA,IAAA,CAAA,IAAA;AACA,EAAAA,UAAAA,UAAA,MAAA,IAAA,CAAA,IAAA;AACA,EAAAA,UAAAA,UAAA,MAAA,IAAA,CAAA,IAAA;AACA,EAAAA,UAAAA,UAAA,OAAA,IAAA,CAAA,IAAA;AACA,EAAAA,UAAAA,UAAA,MAAA,IAAA,CAAA,IAAA;AACF,GANY,aAAA,WAAQ,CAAA,EAAA;AASpB,IAAM,eAAe,aAAY,IAAK,SAAS,OAAO,SAAS;AAG/D,IAAM,SAAS;EACb,OAAO;EACP,MAAM;EACN,MAAM;EACN,OAAO;EACP,SAAS;;AAML,IAAO,SAAP,MAAa;;AACF,SAAA,SAAS;EAAc;;;;EAKtC,OAAO,SAAS,MAAW;AACzB,QAAI,gBAAgB,SAAS,OAAO;AAClC,cAAQ,IAAI,KAAK,KAAK,MAAM,YAAY,OAAO,OAAO,GAAG,IAAI;IAC/D;EACF;;;;EAKA,OAAO,OAAO,MAAW;AACvB,QAAI,gBAAgB,SAAS,MAAM;AACjC,cAAQ,IAAI,KAAK,KAAK,MAAM,WAAW,OAAO,MAAM,GAAG,IAAI;IAC7D;EACF;;;;EAKA,OAAO,QAAQ,MAAW;AACxB,SAAK,IAAI,GAAG,IAAI;EAClB;;;;EAKA,OAAO,QAAQ,MAAW;AACxB,QAAI,gBAAgB,SAAS,MAAM;AACjC,cAAQ,KAAK,KAAK,KAAK,MAAM,WAAW,OAAO,MAAM,GAAG,IAAI;IAC9D;EACF;;;;EAKA,OAAO,SAAS,MAAW;AACzB,QAAI,gBAAgB,SAAS,OAAO;AAClC,cAAQ,MAAM,KAAK,KAAK,MAAM,YAAY,OAAO,OAAO,GAAG,IAAI;IACjE;EACF;;;;EAKA,OAAO,WAAW,MAAW;AAC3B,QAAI,gBAAgB,SAAS,MAAM;AACjC,cAAQ,IAAI,KAAK,KAAK,MAAM,cAAc,OAAO,SAAS,GAAG,IAAI;IACnE;EACF;;;;EAKA,OAAO,MAAM,OAAa;AACxB,QAAI,gBAAgB,SAAS,OAAO;AAClC,cAAQ,MAAM,GAAG,KAAK,MAAM,IAAI,KAAK,EAAE;IACzC;EACF;EAEA,OAAO,WAAQ;AACb,QAAI,gBAAgB,SAAS,OAAO;AAClC,cAAQ,SAAQ;IAClB;EACF;;;;EAKA,OAAO,MAAM,MAAS;AACpB,QAAI,gBAAgB,SAAS,OAAO;AAClC,cAAQ,MAAM,IAAI;IACpB;EACF;;;;EAKA,OAAO,KAAK,OAAa;AACvB,QAAI,gBAAgB,SAAS,OAAO;AAClC,cAAQ,KAAK,GAAG,KAAK,MAAM,IAAI,KAAK,EAAE;IACxC;EACF;EAEA,OAAO,QAAQ,OAAa;AAC1B,QAAI,gBAAgB,SAAS,OAAO;AAClC,cAAQ,QAAQ,GAAG,KAAK,MAAM,IAAI,KAAK,EAAE;IAC3C;EACF;;;;AC3DI,IAAO,kBAAP,MAAO,iBAAe;EAH5B,cAAA;AAIU,SAAA,aAAa,OAAO,kBAAU;AAC9B,SAAA,eAAe,OAAO,YAAY;AAClC,SAAA,oBAAoB,OAAO,iBAAiB;AAG3C,SAAA,YAAY,OAAqB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACnC,SAAA,YAAY,OAAqB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACnC,SAAA,WAAW,OAAoB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AACjC,SAAA,gBAAgB,OAAwB;MAC/C,WAAW;MACX,aAAa;MACb,WAAW;MACX,iBAAiB;OAClB,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAGQ,SAAA,mBAAmB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAC/B,SAAA,mBAAmB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAC/B,SAAA,cAAc,OAAsB,EAAE,MAAM,IAAI,SAAS,IAAI,WAAW,OAAM,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAChF,SAAA,cAAc,OAAsB;MAC3C,MAAM;MACN,YAAY;MACZ,cAAc,CAAA;MACd,UAAU;MACV,cAAc;MACd,cAAc;MACd,iBAAiB;MACjB,iBAAiB,CAAA;MACjB,iBAAiB;MACjB,kBAAkB,CAAA;OACnB,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAGQ,SAAA,sBAAsB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAClC,SAAA,iBAAiB,OAAiB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;;;EAI7C,gBAAa;AACX,SAAK,WAAW,KAAK,oBAAoB,EAAE,YAAY,MAAK,CAAE;EAChE;EAEA,gBAAa;AACX,SAAK,WAAW,KAAK,oBAAoB,EAAE,YAAY,MAAK,CAAE;EAChE;EAEA,aAAa,QAAQ,KAAG;AACtB,SAAK,WAAW,KAAK,oBAAoB,EAAE,MAAK,CAAE;EACpD;EAEA,kBAAkB,OAAO,GAAC;AACxB,SAAK,WAAW,KAAK,yBAAyB,EAAE,KAAI,CAAE;EACxD;EAEA,UAAO;AACL,SAAK,cAAa;AAClB,SAAK,cAAa;AAClB,SAAK,kBAAiB;EACxB;;EAIA,iBAAc;AAEZ,QAAI,CAAC,KAAK,kBAAkB,WAAW,aAAa,GAAG;AACrD,WAAK,aAAa,QAAQ,0KAAiC;AAC3D,aAAO,cAAc,IAAI,YAAY,wBAAwB,CAAC;AAC9D,aAAO;IACT;AAEA,UAAM,OAAO,KAAK,YAAW;AAC7B,QAAI,CAAC,KAAK,KAAK,KAAI,GAAI;AACrB,WAAK,aAAa,QAAQ,4CAAS;AACnC,aAAO;IACT;AACA,QAAI,CAAC,KAAK,QAAQ,KAAI,GAAI;AACxB,WAAK,aAAa,QAAQ,4CAAS;AACnC,aAAO;IACT;AAEA,SAAK,WAAW,KAAK,sBAAsB;MACzC,MAAM,KAAK;MACX,SAAS,KAAK;MACd,WAAW,KAAK;KACjB;AAED,SAAK,kBAAiB;AACtB,WAAO;EACT;EAEA,eAAe,YAAkB;AAC/B,QAAI,CAAC,QAAQ,0EAAc;AAAG;AAC9B,SAAK,WAAW,KAAK,sBAAsB,EAAE,WAAU,CAAE;EAC3D;EAEA,qBAAqB,YAAkB;AACrC,SAAK,WAAW,KAAK,6BAA6B,EAAE,WAAU,CAAE;EAClE;EAEA,oBAAiB;AACf,SAAK,YAAY,IAAI,EAAE,MAAM,IAAI,SAAS,IAAI,WAAW,OAAM,CAAE;AACjE,SAAK,iBAAiB,IAAI,KAAK;EACjC;;EAIA,iBAAc;AAEZ,QAAI,CAAC,KAAK,kBAAkB,WAAW,aAAa,GAAG;AACrD,WAAK,aAAa,QAAQ,0KAAiC;AAC3D,aAAO,cAAc,IAAI,YAAY,wBAAwB,CAAC;AAC9D,aAAO;IACT;AAEA,UAAM,OAAO,KAAK,YAAW;AAC7B,QAAI,CAAC,KAAK,KAAK,KAAI,GAAI;AACrB,WAAK,aAAa,QAAQ,4CAAS;AACnC,aAAO;IACT;AACA,QAAI,CAAC,KAAK,YAAY;AACpB,WAAK,aAAa,QAAQ,4CAAS;AACnC,aAAO;IACT;AACA,QAAI,KAAK,aAAa,WAAW,GAAG;AAClC,WAAK,aAAa,QAAQ,4CAAS;AACnC,aAAO;IACT;AACA,QAAI,KAAK,iBAAiB,WAAW,GAAG;AACtC,WAAK,aAAa,QAAQ,4CAAS;AACnC,aAAO;IACT;AAEA,SAAK,WAAW,KAAK,sBAAsB,IAAI;AAC/C,SAAK,kBAAiB;AACtB,WAAO;EACT;EAEA,eAAe,YAAkB;AAC/B,QAAI,CAAC,QAAQ,0EAAc;AAAG;AAC9B,SAAK,WAAW,KAAK,sBAAsB,EAAE,WAAU,CAAE;EAC3D;EAEA,qBAAqB,YAAkB;AACrC,SAAK,WAAW,KAAK,6BAA6B,EAAE,WAAU,CAAE;EAClE;EAEA,eAAe,YAAkB;AAC/B,QAAI,CAAC,QAAQ,0EAAc;AAAG;AAC9B,SAAK,WAAW,KAAK,uBAAuB,EAAE,WAAU,CAAE;AAC1D,SAAK,aAAa,KAAK,6BAAS;EAClC;EAEA,oBAAiB;AACf,SAAK,YAAY,IAAI;MACnB,MAAM;MACN,YAAY;MACZ,cAAc,CAAA;MACd,UAAU;MACV,cAAc;MACd,cAAc;MACd,iBAAiB;MACjB,iBAAiB,CAAA;MACjB,iBAAiB;MACjB,kBAAkB,CAAA;KACnB;AACD,SAAK,iBAAiB,IAAI,KAAK;EACjC;;EAIA,eAAe,SAAe;AAC5B,QAAI,CAAC,QAAQ,KAAI,GAAI;AACnB,WAAK,eAAe,IAAI,CAAA,CAAE;AAC1B;IACF;AACA,SAAK,oBAAoB,IAAI,IAAI;AACjC,SAAK,WAAW,KAAK,oBAAoB,EAAE,QAAO,CAAE;EACtD;;EAIA,mBAAmB,OAAa;AAC9B,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAM,MAAK,EAAG;EACtD;EAEA,sBAAsB,OAAa;AACjC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,SAAS,MAAK,EAAG;EACzD;EAEA,wBAAwB,OAAa;AACnC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,WAAW,MAAY,EAAG;EAClE;EAEA,mBAAmB,OAAa;AAC9B,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAM,MAAK,EAAG;EACtD;EAEA,yBAAyB,OAAa;AACpC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,YAAY,MAAK,EAAG;EAC5D;EAEA,uBAAuB,OAAa;AAClC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,UAAU,MAAY,EAAG;EACjE;EAEA,mBAAmB,OAAa;AAC9B,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,cAAc,MAAY,EAAG;EACrE;EAEA,mBAAmB,OAAa;AAC9B,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,cAAc,MAAK,EAAG;EAC9D;EAEA,uBAAuB,OAAa;AAClC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,iBAAiB,MAAK,EAAG;EACjE;EAEA,uBAAuB,OAAa;AAClC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,iBAAiB,MAAY,EAAG;EACxE;;EAIA,iBAAiB,MAAY;AAC3B,UAAM,SAAiC;MACrC,aAAa;MACb,aAAa;MACb,SAAS;MACT,YAAY;;AAEd,WAAO,OAAO,IAAI,KAAK;EACzB;EAEA,qBAAqB,MAAY;AAC/B,UAAM,SAAiC;MACrC,QAAQ;MACR,SAAS;MACT,YAAY;MACZ,QAAQ;;AAEV,WAAO,OAAO,IAAI,KAAK;EACzB;EAEA,wBAAwB,UAAgB;AACtC,UAAM,SAAiC;MACrC,UAAU;MACV,UAAU;MACV,cAAc;;AAEhB,WAAO,OAAO,QAAQ,KAAK;EAC7B;;EAIA,wBAAwB,MAAS;AAC/B,QAAI,KAAK,WAAW,KAAK,WAAW;AAClC,WAAK,UAAU,IAAI,KAAK,SAAS;IACnC;EACF;EAEA,wBAAwB,MAAS;AAC/B,QAAI,KAAK,WAAW,KAAK,WAAW;AAClC,WAAK,UAAU,IAAI,KAAK,SAAS;IACnC;EACF;EAEA,uBAAuB,MAAS;AAC9B,QAAI,KAAK,WAAW,KAAK,MAAM;AAC7B,WAAK,SAAS,IAAI,KAAK,IAAI;IAC7B;EACF;EAEA,4BAA4B,MAAS;AACnC,QAAI,KAAK,SAAS;AAChB,WAAK,cAAc,IAAI,IAAI;IAC7B;EACF;EAEA,sBAAsB,MAAS;AAC7B,SAAK,oBAAoB,IAAI,KAAK;AAClC,QAAI,KAAK,WAAW,KAAK,UAAU;AACjC,WAAK,eAAe,IAAI,KAAK,SAAS,MAAM,GAAG,CAAC,CAAC;IACnD;EACF;EAEA,6BAA6B,MAAS;AACpC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,kDAAU;AACpC,WAAK,cAAa;IACpB,OAAO;AACL,WAAK,aAAa,MAAM,KAAK,SAAS,0BAAM;IAC9C;EACF;EAEA,6BAA6B,MAAS;AACpC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,kDAAU;AACpC,WAAK,cAAa;IACpB,OAAO;AACL,WAAK,aAAa,MAAM,KAAK,SAAS,0BAAM;IAC9C;EACF;;;uCA9SW,kBAAe;IAAA;EAAA;;4EAAf,kBAAe,SAAf,iBAAe,WAAA,YAFd,OAAM,CAAA;EAAA;;;sEAEP,iBAAe,CAAA;UAH3B;WAAW;MACV,YAAY;KACb;;;;;ACzBK,IAAO,sBAAP,MAAO,qBAAmB;EAHhC,cAAA;AAIU,SAAA,aAAa,OAAO,kBAAU;AAC9B,SAAA,eAAe,OAAO,YAAY;AAGjC,SAAA,eAAe,OAAsB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AACvC,SAAA,kBAAkB,OAAyB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAC7C,SAAA,gBAAgB,OAAsB;MAC7C,cAAc;MACd,UAAU;MACV,WAAW;MACX,aAAa;MACb,UAAU;MACV,cAAc;MACd,gBAAgB;OACjB,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AACQ,SAAA,eAAe,OAA2B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAC9C,SAAA,aAAa,OAAc,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAG7B,SAAA,kBAAkB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAC9B,SAAA,iBAAiB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAC7B,SAAA,kBAAkB,OAAe,IAAE,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACnC,SAAA,iBAAiB,OAAuB,EAAE,QAAQ,IAAI,UAAU,IAAI,OAAO,GAAE,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;;;EAIxF,iBAAiB,QAAQ,KAAG;AAC1B,SAAK,WAAW,KAAK,qBAAqB;MACxC;MACA,YAAY,KAAK,gBAAe,KAAM;KACvC;EACH;EAEA,oBAAiB;AACf,SAAK,WAAW,KAAK,sBAAsB,CAAA,CAAE;EAC/C;EAEA,oBAAoB,QAAQ,IAAE;AAC5B,SAAK,WAAW,KAAK,yBAAyB,EAAE,MAAK,CAAE;EACzD;EAEA,UAAO;AACL,SAAK,iBAAgB;AACrB,SAAK,kBAAiB;AACtB,SAAK,oBAAmB;EAC1B;;EAIA,iBAAc;AACZ,UAAM,OAAO,KAAK,eAAc;AAChC,QAAI,CAAC,KAAK,OAAO,KAAI,GAAI;AACvB,WAAK,aAAa,QAAQ,mCAAU;AACpC,aAAO;IACT;AAEA,SAAK,WAAW,KAAK,qBAAqB;MACxC,QAAQ,KAAK,OAAO,KAAI;MACxB,UAAU,KAAK,SAAS,KAAI,KAAM;MAClC,OAAO,KAAK,MAAM,KAAI,KAAM;MAC5B,QAAQ;KACT;AAED,SAAK,UAAS;AACd,WAAO;EACT;EAEA,kBAAkB,QAAc;AAC9B,SAAK,WAAW,KAAK,sBAAsB,EAAE,OAAM,CAAE;EACvD;EAEA,kBAAkB,QAAc;AAC9B,QAAI,CAAC,QAAQ,0EAAc;AAAG;AAC9B,SAAK,WAAW,KAAK,uBAAuB,EAAE,OAAM,CAAE;EACxD;EAEA,gBAAgB,QAAgB,cAAoB;AAClD,SAAK,eAAe,IAAI,IAAI;AAC5B,SAAK,WAAW,KAAK,qBAAqB,EAAE,QAAQ,aAAY,CAAE;EACpE;EAEA,eAAe,MAAiB;AAC9B,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,WAAW,KAAK,mBAAmB,EAAE,QAAQ,KAAK,OAAM,CAAE;EACjE;EAEA,qBAAqB,QAAgB,YAAkB;AACrD,SAAK,WAAW,KAAK,2BAA2B,EAAE,QAAQ,WAAU,CAAE;EACxE;EAEA,YAAS;AACP,SAAK,eAAe,IAAI,EAAE,QAAQ,IAAI,UAAU,IAAI,OAAO,GAAE,CAAE;AAC/D,SAAK,gBAAgB,IAAI,KAAK;EAChC;;EAIA,aAAa,OAAa;AACxB,SAAK,eAAe,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,MAAK,EAAG;EAC3D;EAEA,eAAe,OAAa;AAC1B,SAAK,eAAe,OAAO,OAAM,iCAAK,IAAL,EAAQ,UAAU,MAAK,EAAG;EAC7D;EAEA,YAAY,OAAa;AACvB,SAAK,eAAe,OAAO,OAAM,iCAAK,IAAL,EAAQ,OAAO,MAAK,EAAG;EAC1D;;EAIA,mBAAmB,OAAa;AAC9B,UAAM,SAAiC;MACrC,OAAO;MACP,QAAQ;MACR,UAAU;MACV,OAAO;;AAET,WAAO,OAAO,KAAK,KAAK;EAC1B;EAEA,mBAAmB,OAAa;AAC9B,UAAMC,UAAiC;MACrC,OAAO;MACP,QAAQ;MACR,UAAU;MACV,OAAO;;AAET,WAAOA,QAAO,KAAK,KAAK;EAC1B;EAEA,uBAAuB,QAAc;AACnC,UAAM,SAAiC;MACrC,WAAW;MACX,YAAY;MACZ,aAAa;MACb,UAAU;;AAEZ,WAAO,OAAO,MAAM,KAAK;EAC3B;EAEA,uBAAuB,QAAc;AACnC,UAAMA,UAAiC;MACrC,WAAW;MACX,YAAY;MACZ,aAAa;MACb,UAAU;;AAEZ,WAAOA,QAAO,MAAM,KAAK;EAC3B;;EAIA,2BAA2B,MAAS;AAClC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,IAAI,KAAK,SAAS,CAAA,CAAE;IACxC;EACF;EAEA,4BAA4B,MAAS;AACnC,QAAI,KAAK,SAAS;AAChB,WAAK,cAAc,IAAI,IAAI;IAC7B;EACF;EAEA,8BAA8B,MAAS;AACrC,QAAI,KAAK,SAAS;AAChB,WAAK,gBAAgB,IAAI,KAAK,UAAU,CAAA,CAAE;IAC5C;EACF;EAEA,yBAAyB,MAAS;AAChC,QAAI,KAAK,SAAS;AAChB,WAAK,WAAW,IAAI,KAAK,UAAU,CAAA,CAAE;IACvC;EACF;EAEA,yBAAsB;AACpB,SAAK,eAAe,IAAI,KAAK;AAC7B,SAAK,iBAAgB;AACrB,SAAK,aAAa,QAAQ,kDAAU;EACtC;EAEA,sBAAsB,MAAS;AAC7B,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,sCAAQ;AAClC,WAAK,iBAAgB;IACvB,OAAO;AACL,WAAK,aAAa,MAAM,KAAK,SAAS,0BAAM;IAC9C;EACF;;;uCA/LW,sBAAmB;IAAA;EAAA;;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;EAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;;;ACuBK,IAAO,0BAAP,MAAO,yBAAuB;EAHpC,cAAA;AAIU,SAAA,aAAa,OAAO,kBAAU;AAC9B,SAAA,eAAe,OAAO,YAAY;AAGjC,SAAA,UAAU,OAA0B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AACtC,SAAA,oBAAoB,OAAiB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AACvC,SAAA,kBAAkB,OAA6B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACnD,SAAA,YAAY,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACxB,SAAA,WAAW,OAA2B,EAAE,WAAW,GAAG,OAAO,GAAG,QAAQ,GAAE,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAG5E,SAAA,mBAAmB,OAA+B,KAAK,iBAAgB,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AACzE,SAAA,oBAAoB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAChC,SAAA,mBAAmB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAG/B,SAAA,uBAAuB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AACnC,SAAA,yBAAyB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,yBAAA,CAAA,IAAA,CAAA,CAAA;AAGrC,SAAA,eAAe,OAAe,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAGnC,SAAA,kBAAkB,SAAS,MAAK;AACvC,YAAM,UAAU,KAAK,QAAO;AAC5B,YAAM,SAAS,KAAK,aAAY;AAEhC,cAAQ,QAAQ;QACd,KAAK;AACH,iBAAO,QAAQ,OAAO,OAAK,KAAK,gBAAgB,CAAC,CAAC;QACpD,KAAK;AACH,iBAAO,QAAQ,OAAO,OAAK,KAAK,eAAe,CAAC,CAAC;QACnD,KAAK;AACH,iBAAO,QAAQ,OAAO,OAAK,EAAE,SAAS;QACxC,KAAK;AACH,iBAAO,QAAQ,OAAO,OAAK,EAAE,eAAe,MAAM;QACpD;AACE,iBAAO;MACX;IACF,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAEQ,SAAA,gBAAgB,SAAS,MAAM,KAAK,kBAAiB,EAAG,QAAM,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAC9D,SAAA,qBAAqB,SAAS,MAAM,KAAK,QAAO,EAAG,OAAO,OAAK,KAAK,gBAAgB,CAAC,CAAC,EAAE,QAAM,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAC9F,SAAA,oBAAoB,SAAS,MAAM,KAAK,QAAO,EAAG,OAAO,OAAK,KAAK,eAAe,CAAC,CAAC,EAAE,QAAM,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAC5F,SAAA,qBAAqB,SAAS,MAAM,KAAK,QAAO,EAAG,OAAO,OAAK,EAAE,SAAS,EAAE,QAAM,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAClF,SAAA,gBAAgB,SAAS,MAAK;AACrC,YAAM,WAAW,KAAK,gBAAe;AACrC,YAAM,WAAW,KAAK,kBAAiB;AACvC,aAAO,SAAS,SAAS,KAAK,SAAS,MAAM,OAAK,SAAS,SAAS,EAAE,EAAE,CAAC;IAC3E,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;;;EAID,qBAAqB,UAAuB;AAC1C,SAAK,gBAAgB,IAAI,QAAQ;AACjC,SAAK,QAAQ,IAAI,CAAA,CAAE;AACnB,SAAK,UAAU,IAAI,KAAK;AACxB,SAAK,SAAS,IAAI,EAAE,WAAW,GAAG,OAAO,SAAS,gBAAgB,GAAG,QAAQ,GAAE,CAAE;AACjF,SAAK,kBAAkB,IAAI,CAAA,CAAE;AAC7B,SAAK,kBAAkB,IAAI,KAAK;AAChC,SAAK,aAAa,IAAI,KAAK;AAC3B,SAAK,iBAAiB,IAAI,KAAK,iBAAgB,CAAE;AACjD,SAAK,qBAAqB,IAAI,IAAI;EACpC;EAEA,wBAAqB;AACnB,SAAK,qBAAqB,IAAI,KAAK;AACnC,SAAK,gBAAgB,IAAI,IAAI;AAC7B,SAAK,QAAQ,IAAI,CAAA,CAAE;EACrB;EAEA,yBAAsB;AACpB,SAAK,uBAAuB,IAAI,IAAI;EACtC;EAEA,0BAAuB;AACrB,SAAK,uBAAuB,IAAI,KAAK;EACvC;;EAIA,YAAY,UAAwB;AAClC,UAAM,SAAS,YAAY,KAAK,gBAAe;AAC/C,QAAI,CAAC,UAAU,CAAC,OAAO,aAAa;AAClC,WAAK,aAAa,MAAM,4CAAS;AACjC;IACF;AAEA,SAAK,UAAU,IAAI,IAAI;AACvB,SAAK,SAAS,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,0CAAW,EAAG;AAEzD,SAAK,WAAW,KAAK,mBAAmB;MACtC,YAAY,OAAO;MACnB,YAAY,OAAO;MACnB,UAAU,OAAO;MACjB,OAAO;MACP,QAAQ;KACT;EACH;EAEA,WAAQ;AACN,UAAM,WAAW,KAAK,gBAAe;AACrC,UAAM,eAAe,KAAK,QAAO,EAAG;AAEpC,QAAI,CAAC;AAAU;AAEf,SAAK,UAAU,IAAI,IAAI;AACvB,SAAK,SAAS,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,sDAAa,EAAG;AAE3D,SAAK,WAAW,KAAK,mBAAmB;MACtC,YAAY,SAAS;MACrB,YAAY,SAAS;MACrB,UAAU,SAAS;MACnB,OAAO;MACP,QAAQ;KACT;EACH;EAEA,kBAAe;AACb,UAAM,WAAW,KAAK,gBAAe;AACrC,UAAM,SAAS,KAAK,iBAAgB;AAEpC,QAAI,CAAC,UAAU;AACb,WAAK,aAAa,MAAM,4CAAS;AACjC;IACF;AAEA,SAAK,kBAAkB,IAAI,IAAI;AAC/B,SAAK,UAAU,IAAI,IAAI;AACvB,SAAK,SAAS,IAAI,EAAE,WAAW,GAAG,OAAO,SAAS,gBAAgB,GAAG,QAAQ,8BAAS,CAAE;AAExF,SAAK,WAAW,KAAK,2BAA2B;MAC9C,YAAY,SAAS;MACrB,YAAY,SAAS;MACrB,UAAU,SAAS;MACnB;KACD;EACH;EAEA,kBAAe;AACb,SAAK,iBAAiB,IAAI,IAAI;AAC9B,SAAK,WAAW,KAAK,2BAA2B,CAAA,CAAE;EACpD;EAEA,mBAAgB;AACd,SAAK,iBAAiB,IAAI,KAAK;AAC/B,SAAK,WAAW,KAAK,4BAA4B,CAAA,CAAE;EACrD;EAEA,iBAAc;AACZ,SAAK,kBAAkB,IAAI,KAAK;AAChC,SAAK,iBAAiB,IAAI,KAAK;AAC/B,SAAK,UAAU,IAAI,KAAK;AACxB,SAAK,WAAW,KAAK,0BAA0B,CAAA,CAAE;EACnD;;EAIA,sBAAsB,UAAgB;AACpC,UAAM,UAAU,KAAK,kBAAiB;AACtC,QAAI,QAAQ,SAAS,QAAQ,GAAG;AAC9B,WAAK,kBAAkB,IAAI,QAAQ,OAAO,QAAM,OAAO,QAAQ,CAAC;IAClE,OAAO;AACL,WAAK,kBAAkB,IAAI,CAAC,GAAG,SAAS,QAAQ,CAAC;IACnD;EACF;EAEA,YAAS;AACP,UAAM,WAAW,KAAK,gBAAe;AACrC,SAAK,kBAAkB,IAAI,SAAS,IAAI,OAAK,EAAE,EAAE,CAAC;EACpD;EAEA,iBAAc;AACZ,SAAK,kBAAkB,IAAI,CAAA,CAAE;EAC/B;EAEA,kBAAe;AACb,QAAI,KAAK,cAAa,GAAI;AACxB,WAAK,eAAc;IACrB,OAAO;AACL,WAAK,UAAS;IAChB;EACF;EAEA,kBAAe;AACb,UAAM,YAAY,KAAK,QAAO,EAAG,OAAO,OAAK,EAAE,eAAe,MAAM;AACpE,SAAK,kBAAkB,IAAI,UAAU,IAAI,OAAK,EAAE,EAAE,CAAC;AACnD,SAAK,aAAa,KAAK,sBAAO,UAAU,MAAM,uCAAS;EACzD;EAEA,eAAY;AACV,UAAM,SAAS,KAAK,QAAO,EAAG,OAAO,OAAK,KAAK,eAAe,CAAC,CAAC;AAChE,SAAK,kBAAkB,IAAI,OAAO,IAAI,OAAK,EAAE,EAAE,CAAC;AAChD,SAAK,aAAa,KAAK,sBAAO,OAAO,MAAM,iCAAQ;EACrD;;EAIA,UAAU,QAAc;AACtB,SAAK,aAAa,IAAI,MAAM;EAC9B;EAEA,gBAAgB,OAAa;AAC3B,SAAK,iBAAiB,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAK,EAAG;EACrD;EAEA,eAAe,aAAmB;AAChC,SAAK,iBAAiB,OAAO,OAAM,iCAAK,IAAL,EAAQ,YAAW,EAAG;EAC3D;EAEA,uBAAoB;AAClB,SAAK,iBAAiB,OAAO,OAAM,iCAAK,IAAL,EAAQ,gBAAgB,CAAC,EAAE,eAAc,EAAG;EACjF;EAEA,eAAe,MAA4B;AACzC,SAAK,iBAAiB,OAAO,OAAM,iCAC9B,IAD8B;MAEjC,WAAW,iCAAK,EAAE,YAAP,EAAkB,CAAC,IAAI,GAAG,CAAC,EAAE,UAAU,IAAI,EAAC;MACvD;EACJ;EAEA,qBAAqB,QAAuD;AAC1E,SAAK,iBAAiB,OAAO,OAAM,iCAC9B,IAD8B;MAEjC,iBAAiB,iCAAK,EAAE,kBAAP,EAAwB,CAAC,MAAM,GAAG,CAAC,EAAE,gBAAgB,MAAM,EAAC;MAC7E;EACJ;EAEA,qBAAqB,SAAwD;AAC3E,SAAK,iBAAiB,OAAO,OAAM,iCAC9B,IAD8B;MAEjC,iBAAiB,iCAAK,EAAE,kBAAP,EAAwB,CAAC,OAAO,GAAG,CAAC,EAAE,gBAAgB,OAAO,EAAC;MAC/E;EACJ;EAEA,oBAAoB,QAAsD;AACxE,SAAK,iBAAiB,OAAO,OAAM,iCAC9B,IAD8B;MAEjC,gBAAgB,iCAAK,EAAE,iBAAP,EAAuB,CAAC,MAAM,GAAG,CAAC,EAAE,eAAe,MAAM,EAAC;MAC1E;EACJ;;EAIA,cAAW;AACT,UAAM,UAAU,KAAK,QAAO;AAC5B,QAAI,QAAQ,WAAW,GAAG;AACxB,WAAK,aAAa,QAAQ,kDAAU;AACpC;IACF;AAEA,UAAM,MAAM,KAAK,YAAY,OAAO;AACpC,SAAK,YAAY,KAAK,WAAW,KAAK,IAAG,CAAE,MAAM;AACjD,SAAK,aAAa,QAAQ,sBAAO,QAAQ,MAAM,qBAAM;EACvD;EAEA,sBAAmB;AACjB,UAAM,cAAc,KAAK,kBAAiB;AAC1C,UAAM,WAAW,KAAK,QAAO,EAAG,OAAO,OAAK,YAAY,SAAS,EAAE,EAAE,CAAC;AAEtE,QAAI,SAAS,WAAW,GAAG;AACzB,WAAK,aAAa,QAAQ,8DAAY;AACtC;IACF;AAEA,UAAM,MAAM,KAAK,YAAY,QAAQ;AACrC,SAAK,YAAY,KAAK,oBAAoB,KAAK,IAAG,CAAE,MAAM;AAC1D,SAAK,aAAa,QAAQ,sBAAO,SAAS,MAAM,qBAAM;EACxD;;EAIA,gBAAgB,QAAuB;AACrC,UAAM,OAAO,GAAG,OAAO,aAAa,EAAE,IAAI,OAAO,YAAY,EAAE;AAC/D,WAAO,kBAAkB,KAAK,IAAI;EACpC;EAEA,eAAe,QAAuB;AACpC,QAAI,CAAC,OAAO;AAAY,aAAO;AAC/B,UAAM,MAAM,oBAAI,KAAI;AACpB,UAAM,OAAO,IAAI,QAAO,IAAK,IAAI,KAAK,OAAO,UAAU,EAAE,QAAO;AAChE,WAAO,OAAO,IAAI,KAAK;EACzB;EAEA,oBAAoB,QAAuB;AACzC,QAAI,QAAQ;AAEZ,QAAI,OAAO;AAAW,eAAS;AAC/B,QAAI,OAAO;AAAU,eAAS;AAC9B,QAAI,OAAO;AAAO,eAAS;AAC3B,QAAI,KAAK,eAAe,MAAM;AAAG,eAAS;AAC1C,QAAI,CAAC,OAAO,SAAS,CAAC,OAAO,UAAU,CAAC,OAAO;AAAW,eAAS;AAEnE,QAAI,SAAS;AAAG,aAAO;AACvB,QAAI,SAAS;AAAG,aAAO;AACvB,WAAO;EACT;EAEA,kBAAkB,OAAa;AAC7B,QAAI,SAAS;AAAS,cAAQ,QAAQ,KAAS,QAAQ,CAAC,IAAI;AAC5D,QAAI,SAAS;AAAM,cAAQ,QAAQ,KAAM,QAAQ,CAAC,IAAI;AACtD,WAAO,MAAM,SAAQ;EACvB;EAEA,oBAAiB;AACf,UAAM,WAAW,KAAK,SAAQ;AAC9B,QAAI,SAAS,UAAU;AAAG,aAAO;AACjC,WAAO,KAAK,MAAO,SAAS,YAAY,SAAS,QAAS,GAAG;EAC/D;EAEQ,mBAAgB;AACtB,WAAO;MACL,OAAO;MACP,aAAa;MACb,gBAAgB;MAChB,WAAW,EAAE,SAAS,OAAO,UAAU,MAAK;MAC5C,iBAAiB;QACf,WAAW;QACX,aAAa;QACb,aAAa;QACb,cAAc;QACd,aAAa;;MAEf,iBAAiB;QACf,SAAS;QACT,aAAa;QACb,UAAU;QACV,YAAY;QACZ,eAAe;QACf,UAAU;;MAEZ,gBAAgB;QACd,MAAM;QACN,MAAM;QACN,SAAS;;;EAGf;EAEQ,YAAY,SAA0B;AAC5C,UAAM,UAAU,CAAC,MAAM,YAAY,cAAc,aAAa,WAAW,aAAa;AACtF,UAAM,OAAO,QAAQ,IAAI,OAAK;MAC5B,EAAE;MACF,EAAE,YAAY;MACd,EAAE,aAAa;MACf,EAAE,YAAY;MACd,EAAE,YAAY,QAAQ;MACtB,EAAE,cAAc;KACjB;AAED,WAAO,CAAC,QAAQ,KAAK,GAAG,GAAG,GAAG,KAAK,IAAI,OAAK,EAAE,KAAK,GAAG,CAAC,CAAC,EAAE,KAAK,IAAI;EACrE;EAEQ,YAAY,SAAiB,UAAgB;AACnD,UAAM,OAAO,IAAI,KAAK,CAAC,OAAO,GAAG,EAAE,MAAM,0BAAyB,CAAE;AACpE,UAAM,OAAO,SAAS,cAAc,GAAG;AACvC,SAAK,OAAO,IAAI,gBAAgB,IAAI;AACpC,SAAK,WAAW;AAChB,SAAK,MAAK;EACZ;;EAIA,sBAAsB,MAAS;AAC7B,SAAK,UAAU,IAAI,KAAK;AACxB,QAAI,KAAK,WAAW,KAAK,SAAS;AAChC,YAAM,UAAU,KAAK,QAAO;AAC5B,YAAM,aAAa,KAAK,QAAQ,IAAI,CAAC,MAAY,iCAC5C,IAD4C;QAE/C,YAAY,KAAK,oBAAoB,CAAC;QACtC;AAEF,UAAI,KAAK,WAAW,GAAG;AACrB,aAAK,QAAQ,IAAI,UAAU;MAC7B,OAAO;AACL,aAAK,QAAQ,IAAI,CAAC,GAAG,SAAS,GAAG,UAAU,CAAC;MAC9C;AAEA,WAAK,SAAS,OAAO,OAAM,iCACtB,IADsB;QAEzB,WAAW,KAAK,QAAO,EAAG;QAC1B,QAAQ,sBAAO,KAAK,QAAO,EAAG,MAAM;QACpC;IACJ,OAAO;AACL,WAAK,aAAa,MAAM,KAAK,SAAS,sCAAQ;IAChD;EACF;EAEA,yBAAyB,MAAS;AAChC,SAAK,SAAS,IAAI;MAChB,WAAW,KAAK,aAAa;MAC7B,OAAO,KAAK,SAAS;MACrB,QAAQ,KAAK,UAAU;KACxB;EACH;EAEA,yBAAyB,MAAS;AAChC,SAAK,UAAU,IAAI,KAAK;AACxB,SAAK,kBAAkB,IAAI,KAAK;AAChC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,oDAAY,KAAK,KAAK,SAAI;IACtD;EACF;EAEA,sBAAsB,MAAS;AAC7B,SAAK,UAAU,IAAI,KAAK;AACxB,SAAK,aAAa,MAAM,KAAK,SAAS,kDAAU;EAClD;;;uCAxZW,0BAAuB;IAAA;EAAA;;4EAAvB,0BAAuB,SAAvB,yBAAuB,WAAA,YAFtB,OAAM,CAAA;EAAA;;;sEAEP,yBAAuB,CAAA;UAHnC;WAAW;MACV,YAAY;KACb;;;;;ACnBK,IAAO,yBAAP,MAAO,wBAAsB;EAHnC,cAAA;AAIU,SAAA,aAAa,OAAO,kBAAU;AAC9B,SAAA,eAAe,OAAO,YAAY;AAGjC,SAAA,gBAAgB,OAAiC,oBAAI,IAAG,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAC1D,SAAA,uBAAuB,OAAuB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AAChD,SAAA,gBAAgB,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAC1C,SAAA,qBAAqB,OAAc,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAGrC,SAAA,mBAAmB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAC/B,SAAA,eAAe,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAG5B,SAAA,iBAAsB;AAGrB,SAAA,aAAa,SAAqB,MAAK;AAC9C,YAAM,WAAW,MAAM,KAAK,KAAK,cAAa,EAAG,OAAM,CAAE;AACzD,aAAO;QACL,cAAc,SAAS,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,SAAS,CAAC;QAC5D,cAAc,SAAS,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,SAAS,CAAC;QAC5D,WAAW,SAAS,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,MAAM,CAAC;QACtD,aAAa,SAAS,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,QAAQ,CAAC;QAC1D,cAAc,SAAS,OAAO,OAAK,CAAC,EAAE,UAAU,EAAE,UAAU,CAAC,EAAE;QAC/D,cAAc,SAAS,OAAO,OAAK,EAAE,MAAM,EAAE;;IAEjD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAEQ,SAAA,uBAAuB,SAA+B,MAAK;AAClE,aAAO,MAAM,KAAK,KAAK,cAAa,EAAG,QAAO,CAAE,EAAE,IAAI,CAAC,CAAC,OAAO,MAAM,OAAO;QAC1E;QACA;QACA,UAAU,KAAK,qBAAoB,EAAG,OAAO,OAAK,EAAE,UAAU,KAAK;QACnE;IACJ,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;;;EAID,cAAc,OAAc;AAC1B,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,WAAW,KAAK,oBAAoB,EAAE,MAAK,CAAE;EACpD;EAEA,yBAAsB;AACpB,QAAI,KAAK,gBAAgB;AACvB,mBAAa,KAAK,cAAc;IAClC;AACA,SAAK,iBAAiB,WAAW,MAAK;AACpC,WAAK,cAAa;IACpB,GAAG,GAAG;EACR;EAEA,YAAY,OAAgB,QAAiB,QAAQ,KAAG;AACtD,SAAK,WAAW,KAAK,sBAAsB,EAAE,OAAO,QAAQ,MAAK,CAAE;EACrE;EAEA,oBAAiB;AACf,QAAI,CAAC,QAAQ,sFAAgB;AAAG;AAChC,SAAK,WAAW,KAAK,uBAAuB,CAAA,CAAE;AAC9C,SAAK,aAAa,KAAK,2DAAc;EACvC;EAEA,WAAW,OAAe,QAAe;AACvC,QAAI,CAAC,QAAQ,kCAAS,KAAK,iCAAQ;AAAG;AACtC,SAAK,WAAW,KAAK,eAAe,EAAE,OAAO,OAAM,CAAE;EACvD;EAEA,WAAW,OAAa;AACtB,SAAK,WAAW,KAAK,eAAe,EAAE,MAAK,CAAE;AAC7C,SAAK,aAAa,KAAK,gBAAM,KAAK,iCAAQ;EAC5C;EAEA,YAAY,OAAa;AACvB,SAAK,WAAW,KAAK,gBAAgB,EAAE,MAAK,CAAE;AAC9C,SAAK,aAAa,KAAK,gBAAM,KAAK,iCAAQ;EAC5C;EAEA,iBAAc;AACZ,UAAM,WAAW,KAAK,cAAa;AACnC,aAAS,QAAQ,CAAC,GAAG,UAAS;AAC5B,WAAK,WAAW,KAAK,eAAe,EAAE,MAAK,CAAE;IAC/C,CAAC;AACD,SAAK,aAAa,KAAK,wDAAW;EACpC;EAEA,kBAAe;AACb,UAAM,WAAW,KAAK,cAAa;AACnC,aAAS,QAAQ,CAAC,GAAG,UAAS;AAC5B,WAAK,WAAW,KAAK,gBAAgB,EAAE,MAAK,CAAE;IAChD,CAAC;AACD,SAAK,aAAa,KAAK,wDAAW;EACpC;EAEA,cAAc,OAAe,WAAiB;AAC5C,QAAI,CAAC,QAAQ,8DAAY;AAAG;AAC5B,SAAK,WAAW,KAAK,wBAAwB,EAAE,OAAO,UAAS,CAAE;EACnE;EAEA,sBAAsB,OAAe,WAAmB,UAAgB;AACtE,SAAK,WAAW,KAAK,yBAAyB,EAAE,OAAO,WAAW,SAAQ,CAAE;EAC9E;EAEA,oBAAoB,OAAc;AAChC,SAAK,WAAW,KAAK,yBAAyB,EAAE,MAAK,CAAE;AACvD,SAAK,aAAa,KAAK,2DAAc;EACvC;;EAIA,YAAY,OAAa;AACvB,SAAK,cAAc,IAAI,KAAK;AAC5B,SAAK,YAAY,KAAK;AACtB,SAAK,iBAAiB,IAAI,IAAI;EAChC;EAEA,eAAY;AACV,SAAK,iBAAiB,IAAI,KAAK;AAC/B,SAAK,cAAc,IAAI,IAAI;AAC3B,SAAK,qBAAqB,IAAI,CAAA,CAAE;EAClC;;EAIA,YAAY,OAAO,GAAC;AAClB,SAAK,WAAW,KAAK,4BAA4B,EAAE,KAAI,CAAE;EAC3D;;EAIA,oBAAoB,OAAa;AAC/B,WAAO,KAAK,cAAa,EAAG,IAAI,KAAK,KAAK;EAC5C;EAEA,eAAe,QAAc;AAC3B,UAAM,SAAiC;MACrC,WAAW;MACX,WAAW;MACX,QAAQ;MACR,UAAU;MACV,UAAU;;AAEZ,WAAO,OAAO,MAAM,KAAK;EAC3B;EAEA,eAAe,QAAc;AAC3B,UAAMC,UAAiC;MACrC,WAAW;MACX,WAAW;MACX,QAAQ;MACR,UAAU;MACV,UAAU;;AAEZ,WAAOA,QAAO,MAAM,KAAK;EAC3B;EAEA,iBAAiB,UAAgB;AAC/B,UAAM,SAAiC;MACrC,QAAQ;MACR,UAAU;MACV,OAAO;;AAET,WAAO,OAAO,QAAQ,KAAK;EAC7B;EAEA,iBAAiB,UAAgB;AAC/B,UAAMA,UAAiC;MACrC,QAAQ;MACR,UAAU;MACV,OAAO;;AAET,WAAOA,QAAO,QAAQ,KAAK;EAC7B;;EAIA,0BAA0B,MAAS;AACjC,SAAK,aAAa,IAAI,KAAK;AAC3B,QAAI,KAAK,WAAW,KAAK,UAAU;AACjC,YAAM,YAAY,oBAAI,IAAG;AACzB,iBAAW,UAAU,KAAK,UAAU;AAClC,kBAAU,IAAI,OAAO,OAAO,MAAM;MACpC;AACA,WAAK,cAAc,IAAI,SAAS;IAClC;EACF;EAEA,4BAA4B,MAAS;AACnC,QAAI,KAAK,WAAW,KAAK,UAAU;AACjC,WAAK,qBAAqB,IAAI,KAAK,QAAQ;IAC7C;EACF;EAEA,2BAA2B,MAAS;AAClC,QAAI,KAAK,WAAW,KAAK,SAAS;AAChC,WAAK,mBAAmB,IAAI,KAAK,OAAO;IAC1C;EACF;EAEA,kBAAkB,MAAS;AAEzB,QAAI,KAAK,SAAS,KAAK,QAAQ;AAC7B,YAAM,WAAW,IAAI,IAAI,KAAK,cAAa,CAAE;AAC7C,eAAS,IAAI,KAAK,OAAO,KAAK,MAAM;AACpC,WAAK,cAAc,IAAI,QAAQ;IACjC;EACF;EAEA,kBAAkB,MAAS;AAEzB,QAAI,KAAK,WAAW;AAClB,WAAK,qBAAqB,OAAO,cAC/B,SAAS,IAAI,OACX,EAAE,OAAO,KAAK,YACV,iCAAK,IAAL,EAAQ,QAAQ,QAAiB,SAAQ,oBAAI,KAAI,GAAG,YAAW,EAAE,KACjE,CAAC,CACN;IAEL;EACF;EAEA,oBAAoB,MAAS;AAE3B,QAAI,KAAK,WAAW;AAClB,WAAK,qBAAqB,OAAO,cAC/B,SAAS,IAAI,OACX,EAAE,OAAO,KAAK,YACV,iCAAK,IAAL,EAAQ,QAAQ,UAAmB,OAAO,KAAK,MAAK,KACpD,CAAC,CACN;IAEL;EACF;;;uCAzOW,yBAAsB;IAAA;EAAA;;4EAAtB,yBAAsB,SAAtB,wBAAsB,WAAA,YAFrB,OAAM,CAAA;EAAA;;;sEAEP,wBAAsB,CAAA;UAHlC;WAAW;MACV,YAAY;KACb;;;;;ACmCK,IAAO,4BAAP,MAAO,2BAAyB;EAsCpC,cAAA;AArCQ,SAAA,aAAa,OAAO,kBAAU;AAC9B,SAAA,eAAe,OAAO,YAAY;AAClC,SAAA,oBAAoB,OAAO,iBAAiB;AAG3C,SAAA,YAAY,OAAmB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACjC,SAAA,mBAAmB,OAAwB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAC/C,SAAA,kBAAkB,OAA+B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACrD,SAAA,iBAAiB,OAA8B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAGnD,SAAA,mBAAmB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAC/B,SAAA,mBAAmB,OAAyB;MACnD,MAAM;MACN,aAAa;MACb,QAAQ,CAAC,aAAa,cAAc,UAAU;MAC9C,UAAU,CAAA;MACV,cAAc,CAAA;MACd,kBAAkB,CAAA;OACnB,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AACQ,SAAA,cAAc,OAAwB,KAAK,qBAAoB,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AACjE,SAAA,uBAAuB,OAAO,IAAE,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AAChC,SAAA,uBAAuB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AAGnC,SAAA,kBAAkB,SAAS,MAClC,KAAK,UAAS,EAAG,OAAO,OAAK,EAAE,WAAW,SAAS,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAG7C,SAAA,kBAAkB,SAAS,MAClC,KAAK,UAAS,EAAG,OAAO,OAAK,EAAE,WAAW,QAAQ,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAG5C,SAAA,qBAAqB,SAAS,MACrC,KAAK,UAAS,EAAG,OAAO,OAAK,EAAE,WAAW,WAAW,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAItD,SAAK,kBAAiB;EACxB;;EAIA,gBAAa;AACX,SAAK,WAAW,KAAK,iBAAiB,EAAE,OAAO,GAAE,CAAE;EACrD;EAEA,sBAAmB;AACjB,SAAK,WAAW,KAAK,wBAAwB,EAAE,MAAM,EAAC,CAAE;EAC1D;EAEA,qBAAkB;AAChB,SAAK,WAAW,KAAK,uBAAuB,CAAA,CAAE;EAChD;EAEA,mBAAgB;AACd,SAAK,cAAa;AAClB,SAAK,oBAAmB;AACxB,SAAK,mBAAkB;EACzB;;EAIA,yBAAsB;AAEpB,QAAI,CAAC,KAAK,kBAAkB,WAAW,eAAe,GAAG;AACvD,WAAK,aAAa,QAAQ,0KAAiC;AAC3D,aAAO,cAAc,IAAI,YAAY,wBAAwB,CAAC;AAC9D;IACF;AAEA,UAAM,OAAO,KAAK,iBAAgB;AAClC,QAAI,CAAC,KAAK,KAAK,KAAI,GAAI;AACrB,WAAK,aAAa,QAAQ,4CAAS;AACnC;IACF;AACA,QAAI,KAAK,iBAAiB,WAAW,GAAG;AACtC,WAAK,aAAa,QAAQ,gCAAO;AACjC;IACF;AAEA,SAAK,WAAW,KAAK,mBAAmB;MACtC,MAAM,KAAK;MACX,aAAa,KAAK;MAClB,QAAQ,KAAK;MACb,UAAU,KAAK;MACf,cAAc,KAAK;MACnB,kBAAkB,KAAK;KACxB;AAED,SAAK,kBAAiB;EACxB;EAEA,cAAW;AAET,QAAI,KAAK,qBAAoB,GAAI;AAC/B,WAAK,aAAa,QAAQ,mEAAiB,GAAI;AAC/C;IACF;AAEA,UAAM,OAAO,KAAK,YAAW;AAC7B,UAAM,SAAmB,CAAA;AAEzB,QAAI,CAAC,KAAK,MAAM,KAAI,GAAI;AACtB,aAAO,KAAK,0BAAM;IACpB;AACA,QAAI,CAAC,KAAK,OAAO,cAAc,KAAK,OAAO,eAAe,GAAG;AAC3D,aAAO,KAAK,0BAAM;IACpB;AACA,QAAI,KAAK,QAAQ,eAAe,WAAW,GAAG;AAC5C,aAAO,KAAK,8DAAY;IAC1B;AACA,QAAI,KAAK,QAAQ,cAAc,WAAW,GAAG;AAC3C,aAAO,KAAK,8DAAY;IAC1B;AAEA,QAAI,OAAO,SAAS,GAAG;AACrB,WAAK,aAAa,MAAM,+CAAY,OAAO,KAAK,IAAI,CAAC,EAAE;AACvD;IACF;AAGA,UAAM,eAAe,KAAK,KAAK,KAAI;AACnC,UAAM,mBAAmB,KAAK,UAAS,EAAG,KAAK,OAAK,EAAE,SAAS,YAAY;AAC3E,QAAI,kBAAkB;AACpB,WAAK,aAAa,QAAQ,iBAAO,YAAY,8EAAkB,GAAI;AACnE;IACF;AAGA,SAAK,qBAAqB,IAAI,IAAI;AAGlC,SAAK,YAAY,IAAI,KAAK,qBAAoB,CAAE;AAGhD,SAAK,WAAW,KAAK,gBAAgB,mBAAK,KAAM;AAGhD,eAAW,MAAK;AACd,WAAK,qBAAqB,IAAI,KAAK;IACrC,GAAG,GAAI;EACT;EAEA,cAAc,YAAkB;AAC9B,QAAI,CAAC,QAAQ,8DAAY;AAAG;AAC5B,SAAK,WAAW,KAAK,kBAAkB,EAAE,WAAU,CAAE;EACvD;EAEA,cAAc,YAAkB;AAC9B,SAAK,WAAW,KAAK,kBAAkB,EAAE,WAAU,CAAE;EACvD;EAEA,eAAe,YAAkB;AAC/B,SAAK,WAAW,KAAK,mBAAmB,EAAE,WAAU,CAAE;EACxD;EAEA,aAAa,YAAkB;AAC7B,QAAI,CAAC,QAAQ,8DAAY;AAAG;AAC5B,SAAK,WAAW,KAAK,iBAAiB,EAAE,WAAU,CAAE;EACtD;EAEA,eAAe,YAAkB;AAC/B,QAAI,CAAC,QAAQ,8DAAY;AAAG;AAC5B,SAAK,WAAW,KAAK,mBAAmB,EAAE,WAAU,CAAE;EACxD;EAEA,qBAAqB,IAAU;AAC7B,SAAK,WAAW,KAAK,0BAA0B,EAAE,GAAE,CAAE;EACvD;EAEA,oBAAoB,UAAkB;AACpC,SAAK,iBAAiB,IAAI,QAAQ;AAClC,SAAK,WAAW,KAAK,qBAAqB,EAAE,YAAY,SAAS,GAAE,CAAE;EACvE;;EAIA,oBAAoB,OAAa;AAC/B,SAAK,iBAAiB,OAAO,OAAI;AAC/B,YAAM,SAAS,CAAC,GAAG,EAAE,MAAM;AAC3B,YAAM,MAAM,OAAO,QAAQ,KAAK;AAChC,UAAI,OAAO,GAAG;AACZ,eAAO,OAAO,KAAK,CAAC;MACtB,OAAO;AACL,eAAO,KAAK,KAAK;MACnB;AACA,aAAO,iCAAK,IAAL,EAAQ,OAAM;IACvB,CAAC;EACH;EAEA,qBAAkB;AAChB,UAAM,UAAU,KAAK,qBAAoB,EAAG,KAAI;AAChD,QAAI,CAAC;AAAS;AAEd,SAAK,iBAAiB,OAAO,OAAM,iCAC9B,IAD8B;MAEjC,UAAU,CAAC,GAAG,EAAE,UAAU,OAAO;MACjC;AACF,SAAK,qBAAqB,IAAI,EAAE;EAClC;EAEA,sBAAsB,SAAe;AACnC,SAAK,iBAAiB,OAAO,OAAM,iCAC9B,IAD8B;MAEjC,UAAU,EAAE,SAAS,OAAO,OAAK,MAAM,OAAO;MAC9C;EACJ;EAEA,sBAAsB,OAAa;AACjC,SAAK,iBAAiB,OAAO,OAAI;AAC/B,YAAM,WAAW,CAAC,GAAG,EAAE,gBAAgB;AACvC,YAAM,MAAM,SAAS,QAAQ,KAAK;AAClC,UAAI,OAAO,GAAG;AACZ,iBAAS,OAAO,KAAK,CAAC;MACxB,OAAO;AACL,iBAAS,KAAK,KAAK;MACrB;AACA,aAAO,iCAAK,IAAL,EAAQ,kBAAkB,SAAQ;IAC3C,CAAC;EACH;EAEA,6BAA6B,SAAe;AAC1C,SAAK,YAAY,OAAO,OAAI;AAC1B,YAAM,MAAM,CAAC,GAAG,EAAE,QAAQ,cAAc;AACxC,YAAM,MAAM,IAAI,QAAQ,OAAO;AAC/B,UAAI,OAAO,GAAG;AACZ,YAAI,OAAO,KAAK,CAAC;MACnB,OAAO;AACL,YAAI,KAAK,OAAO;MAClB;AACA,aAAO,iCAAK,IAAL,EAAQ,SAAS,iCAAK,EAAE,UAAP,EAAgB,gBAAgB,IAAG,GAAE;IAC/D,CAAC;EACH;EAEA,4BAA4B,OAAa;AACvC,SAAK,YAAY,OAAO,OAAI;AAC1B,YAAM,MAAM,CAAC,GAAG,EAAE,QAAQ,aAAa;AACvC,YAAM,MAAM,IAAI,QAAQ,KAAK;AAC7B,UAAI,OAAO,GAAG;AACZ,YAAI,OAAO,KAAK,CAAC;MACnB,OAAO;AACL,YAAI,KAAK,KAAK;MAChB;AACA,aAAO,iCAAK,IAAL,EAAQ,SAAS,iCAAK,EAAE,UAAP,EAAgB,eAAe,IAAG,GAAE;IAC9D,CAAC;EACH;EAEA,uBAAuB,OAAa;AAClC,SAAK,iBAAiB,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAM,MAAK,EAAG;EAC3D;EAEA,uBAAuB,OAAa;AAClC,SAAK,iBAAiB,OAAO,OAAM,iCAAK,IAAL,EAAQ,aAAa,MAAK,EAAG;EAClE;EAEA,sBAAsB,OAAa;AACjC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAM,MAAK,EAAG;EACtD;EAEA,4BAA4B,OAAa;AACvC,SAAK,YAAY,OAAO,OAAM,iCACzB,IADyB;MAE5B,QAAQ,iCAAK,EAAE,SAAP,EAAe,YAAY,MAAK;MACxC;EACJ;;EAIA,uBAAoB;AAClB,WAAO;MACL,MAAM;MACN,SAAS,EAAE,gBAAgB,CAAA,GAAI,eAAe,CAAA,EAAE;MAChD,QAAQ,EAAE,YAAY,GAAG,iBAAiB,IAAI,iBAAiB,IAAG;;EAEtE;EAEA,oBAAiB;AACf,SAAK,iBAAiB,IAAI;MACxB,MAAM;MACN,aAAa;MACb,QAAQ,CAAC,aAAa,cAAc,UAAU;MAC9C,UAAU,CAAA;MACV,cAAc,CAAA;MACd,kBAAkB,CAAA;KACnB;AACD,SAAK,iBAAiB,IAAI,KAAK;EACjC;EAEA,uBAAuB,QAAc;AACnC,UAAM,SAAiC;MACrC,SAAS;MACT,aAAa;MACb,WAAW;MACX,UAAU;MACV,aAAa;MACb,UAAU;;AAEZ,WAAO,OAAO,MAAM,KAAK;EAC3B;EAEA,uBAAuB,QAAc;AACnC,UAAMC,UAAiC;MACrC,SAAS;MACT,aAAa;MACb,WAAW;MACX,UAAU;MACV,aAAa;MACb,UAAU;;AAEZ,WAAOA,QAAO,MAAM,KAAK;EAC3B;EAEA,cAAc,OAAa;AACzB,UAAM,SAAiC;MACrC,aAAa;MACb,cAAc;MACd,YAAY;MACZ,YAAY;MACZ,cAAc;;AAEhB,WAAO,OAAO,KAAK,KAAK;EAC1B;EAEA,gBAAgB,IAAW;AACzB,QAAI,CAAC;AAAI,aAAO;AAChB,WAAO,KAAK,UAAS,EAAG,KAAK,OAAK,EAAE,OAAO,EAAE,GAAG,QAAQ;EAC1D;EAEA,gBAAgB,IAAsB;AACpC,QAAI,OAAO;AAAW,aAAO;AAC7B,WAAO,KAAK,UAAS,EAAG,KAAK,OAAK,EAAE,OAAO,EAAE;EAC/C;;EAIQ,oBAAiB;AACvB,SAAK,WAAW,GAAG,oBAAoB,CAAC,SAAc,KAAK,gBAAgB,IAAI,CAAC;AAChF,SAAK,WAAW,GAAG,oBAAoB,CAAC,SAAc,KAAK,sBAAsB,IAAI,CAAC;AACtF,SAAK,WAAW,GAAG,oBAAoB,CAAC,SAAc,KAAK,sBAAsB,IAAI,CAAC;AACtF,SAAK,WAAW,GAAG,2BAA2B,CAAC,SAAc,KAAK,sBAAsB,IAAI,CAAC;AAC7F,SAAK,WAAW,GAAG,0BAA0B,CAAC,SAAc,KAAK,qBAAqB,IAAI,CAAC;AAC3F,SAAK,WAAW,GAAG,kBAAkB,CAAC,SAAc,KAAK,oBAAoB,IAAI,CAAC;AAClF,SAAK,WAAW,GAAG,2BAA2B,CAAC,SAAc,KAAK,4BAA4B,IAAI,CAAC;EACrG;EAEQ,gBAAgB,MAAS;AAC/B,QAAI,KAAK,SAAS;AAChB,WAAK,UAAU,IAAI,KAAK,aAAa,CAAA,CAAE;IACzC;EACF;EAEQ,sBAAsB,MAAS;AACrC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,4CAAS;AACnC,WAAK,cAAa;IACpB,OAAO;AACL,WAAK,aAAa,MAAM,6BAAS,KAAK,KAAK,EAAE;IAC/C;EACF;EAEQ,sBAAsB,MAAS;AACrC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,4CAAS;AACnC,WAAK,cAAa;IACpB;EACF;EAEQ,sBAAsB,MAAS;AACrC,QAAI,KAAK,SAAS;AAChB,WAAK,gBAAgB,IAAI,IAAI;IAC/B;EACF;EAEQ,qBAAqB,MAAS;AACpC,QAAI,KAAK,SAAS;AAChB,WAAK,eAAe,IAAI,IAAI;IAC9B;EACF;EAEQ,oBAAoB,MAAS;AACnC,SAAK,qBAAqB,IAAI,KAAK;AACnC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,sCAAQ;AAClC,WAAK,cAAa;IACpB,OAAO;AACL,WAAK,aAAa,MAAM,6BAAS,KAAK,KAAK,EAAE;IAC/C;EACF;EAEQ,4BAA4B,MAAS;AAC3C,QAAI,KAAK,SAAS;AAChB,WAAK,cAAa;IACpB;EACF;;;uCA3YW,4BAAyB;IAAA;EAAA;;4EAAzB,4BAAyB,SAAzB,2BAAyB,WAAA,YAFxB,OAAM,CAAA;EAAA;;;sEAEP,2BAAyB,CAAA;UAHrC;WAAW;MACV,YAAY;KACb;;;;;ACnDK,IAAO,4BAAP,MAAO,2BAAyB;EA6BpC,cAAA;AA5BQ,SAAA,aAAa,OAAO,kBAAU;AAC9B,SAAA,eAAe,OAAO,YAAY;AAGjC,SAAA,mBAAmB,OAA0B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAC/C,SAAA,mBAAmB,OAA+B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAGtD,SAAA,sBAAsB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAClC,SAAA,cAAc,OAAwB,EAAE,MAAM,IAAI,QAAQ,GAAE,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAG9D,SAAA,kBAAkB,SAAS,MAClC,KAAK,iBAAgB,EAAG,OAAO,OAAK,EAAE,MAAM,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAGtC,SAAA,gBAAgB,SAAS,MAAM,KAAK,iBAAgB,EAAG,QAAM,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAG7D,SAAA,qBAAyC;MAChD,EAAE,MAAM,QAAQ,aAAa,UAAU,aAAa,2BAAM;MAC1D,EAAE,MAAM,YAAY,aAAa,cAAc,aAAa,yBAAc;MAC1E,EAAE,MAAM,cAAc,aAAa,gBAAgB,aAAa,2BAAM;MACtE,EAAE,MAAM,WAAW,aAAa,aAAa,aAAa,iCAAO;MACjE,EAAE,MAAM,QAAQ,aAAa,UAAU,aAAa,2BAAM;MAC1D,EAAE,MAAM,QAAQ,aAAa,UAAU,aAAa,2BAAM;;AAI1D,SAAK,kBAAiB;EACxB;;EAIA,gBAAa;AACX,SAAK,WAAW,KAAK,iBAAiB,CAAA,CAAE;EAC1C;;EAIA,cAAW;AACT,UAAM,OAAO,KAAK,YAAW;AAC7B,QAAI,KAAK,KAAK,KAAI,KAAM,KAAK,OAAO,KAAI,GAAI;AAC1C,WAAK,WAAW,KAAK,gBAAgB;QACnC,MAAM,KAAK;QACX,QAAQ,KAAK;OACd;AACD,WAAK,YAAY,IAAI,EAAE,MAAM,IAAI,QAAQ,GAAE,CAAE;AAC7C,WAAK,aAAa,QAAQ,sCAAQ;IACpC,OAAO;AACL,WAAK,aAAa,MAAM,0EAAc;IACxC;EACF;EAEA,iBAAiB,MAAc,QAAc;AAC3C,QAAI,MAAM,KAAI,KAAM,QAAQ,KAAI,GAAI;AAElC,YAAM,SAAS,KAAK,iBAAgB,EAAG,KAAK,OAAK,EAAE,SAAS,KAAK,KAAI,CAAE;AACvE,UAAI,QAAQ;AACV,aAAK,aAAa,QAAQ,oGAAoB,GAAI;AAClD;MACF;AACA,WAAK,WAAW,KAAK,gBAAgB;QACnC,MAAM,KAAK,KAAI;QACf,QAAQ,OAAO,KAAI;OACpB;AACD,WAAK,YAAY,IAAI,EAAE,MAAM,IAAI,QAAQ,GAAE,CAAE;AAC7C,WAAK,aAAa,QAAQ,sCAAQ;AAElC,UAAI,KAAK,iBAAgB,EAAG,SAAS,GAAG;AACtC,aAAK,oBAAoB,IAAI,KAAK;MACpC;IACF,OAAO;AACL,WAAK,aAAa,MAAM,0EAAc;IACxC;EACF;EAEA,qBAAqB,YAAkB;AACrC,SAAK,WAAW,KAAK,0BAA0B,EAAE,IAAI,WAAU,CAAE;EACnE;EAEA,eAAe,YAAoB,YAAmB,CAAA,GAAE;AACtD,UAAM,WAAW,KAAK,iBAAgB,EAAG,KAAK,OAAK,EAAE,OAAO,UAAU;AACtE,QAAI,CAAC;AAAU;AAGf,UAAM,iBAAiB,UAAU,OAAO,OACtC,EAAE,SAAS,KAAK,CAAC,MAAW,EAAE,eAAe,UAAU,CAAC;AAG1D,QAAI,eAAe,SAAS,GAAG;AAC7B,YAAM,gBAAgB,eAAe,IAAI,OAAK,EAAE,IAAI,EAAE,KAAK,IAAI;AAC/D,UAAI,CAAC,QAAQ,iBAAO,SAAS,IAAI,iEAAe,aAAa;;;;2CAAmC,GAAG;AACjG;MACF;IACF,OAAO;AACL,UAAI,CAAC,QAAQ,+CAAY,SAAS,IAAI,gEAAc,GAAG;AACrD;MACF;IACF;AAEA,SAAK,WAAW,KAAK,mBAAmB,EAAE,IAAI,WAAU,CAAE;AAC1D,SAAK,aAAa,QAAQ,gCAAO;EACnC;EAEA,eAAe,UAAyB;AACtC,SAAK,iBAAiB,IAAI,QAAQ;EACpC;EAEA,iBAAc;AACZ,SAAK,iBAAiB,IAAI,IAAI;EAChC;;EAIA,mBAAmB,OAAa;AAC9B,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,MAAM,MAAK,EAAG;EACtD;EAEA,qBAAqB,OAAa;AAChC,SAAK,YAAY,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,MAAK,EAAG;EACxD;EAEA,uBAAuB,UAA+B,UAAgB;AACpE,UAAM,QAAQ,SAAS;AACvB,UAAM,MAAM,SAAS;AACrB,UAAM,OAAO,SAAS;AACtB,UAAM,UAAU,KAAK,UAAU,GAAG,KAAK,IAAI,WAAW,KAAK,UAAU,GAAG;AACxE,aAAS,QAAQ;AACjB,SAAK,qBAAqB,OAAO;AAEjC,eAAW,MAAK;AACd,eAAS,MAAK;AACd,eAAS,iBAAiB,SAAS,eAAe,QAAQ,SAAS;IACrE,GAAG,CAAC;EACN;EAEA,sBAAmB;AACjB,SAAK,oBAAoB,IAAI,IAAI;AACjC,SAAK,YAAY,IAAI,EAAE,MAAM,IAAI,QAAQ,GAAE,CAAE;EAC/C;EAEA,uBAAoB;AAClB,SAAK,oBAAoB,IAAI,KAAK;EACpC;;EAIA,gBAAgB,IAAW;AACzB,QAAI,CAAC;AAAI,aAAO;AAChB,WAAO,KAAK,iBAAgB,EAAG,KAAK,OAAK,EAAE,OAAO,EAAE,GAAG,QAAQ;EACjE;EAEA,gBAAgB,IAAU;AACxB,WAAO,KAAK,iBAAgB,EAAG,KAAK,OAAK,EAAE,OAAO,EAAE;EACtD;;EAIQ,oBAAiB;AACvB,SAAK,WAAW,GAAG,oBAAoB,CAAC,SAAc,KAAK,gBAAgB,IAAI,CAAC;AAChF,SAAK,WAAW,GAAG,kBAAkB,CAAC,SAAc,KAAK,oBAAoB,IAAI,CAAC;AAClF,SAAK,WAAW,GAAG,oBAAoB,CAAC,SAAc,KAAK,sBAAsB,IAAI,CAAC;AACtF,SAAK,WAAW,GAAG,2BAA2B,CAAC,SAAc,KAAK,4BAA4B,IAAI,CAAC;EACrG;EAEQ,gBAAgB,MAAS;AAC/B,QAAI,KAAK,WAAW,KAAK,WAAW;AAClC,WAAK,iBAAiB,IAAI,KAAK,aAAa,CAAA,CAAE;IAChD;EACF;EAEQ,oBAAoB,MAAS;AACnC,QAAI,KAAK,SAAS;AAChB,WAAK,cAAa;IACpB,OAAO;AACL,WAAK,aAAa,MAAM,6BAAS,KAAK,KAAK,EAAE;IAC/C;EACF;EAEQ,sBAAsB,MAAS;AACrC,QAAI,KAAK,SAAS;AAChB,WAAK,cAAa;IACpB;EACF;EAEQ,4BAA4B,MAAS;AAC3C,QAAI,KAAK,SAAS;AAChB,WAAK,cAAa;IACpB;EACF;;;uCA/LW,4BAAyB;IAAA;EAAA;;4EAAzB,4BAAyB,SAAzB,2BAAyB,WAAA,YAFxB,OAAM,CAAA;EAAA;;;sEAEP,2BAAyB,CAAA;UAHrC;WAAW;MACV,YAAY;KACb;;;;;ACyBD,IAAM,cAA4C;EAChD,aAAa,EAAE,MAAM,cAAc,OAAO,sBAAO,MAAM,YAAI;EAC3D,YAAY,EAAE,MAAM,aAAa,OAAO,4BAAQ,MAAM,YAAI;EAC1D,eAAe,EAAE,MAAM,iBAAiB,OAAO,4BAAQ,MAAM,SAAG;EAChE,mBAAmB,EAAE,MAAM,iBAAiB,OAAO,oBAAU,MAAM,YAAI;EACvE,aAAa,EAAE,MAAM,cAAc,OAAO,4BAAQ,MAAM,YAAI;EAC5D,mBAAmB,EAAE,MAAM,oBAAoB,OAAO,kCAAS,MAAM,YAAI;EACzE,mBAAmB,EAAE,MAAM,oBAAoB,OAAO,4BAAQ,MAAM,YAAI;EACxE,oBAAoB,EAAE,MAAM,qBAAqB,OAAO,4BAAQ,MAAM,YAAI;EAC1E,gBAAgB;IACd,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,cAAc,EAAE,MAAM,eAAe,OAAO,kCAAS,MAAM,eAAI;EAC/D,SAAS,EAAE,MAAM,UAAU,OAAO,4BAAQ,MAAM,YAAI;EACpD,kBAAkB,EAAE,MAAM,mBAAmB,OAAO,4BAAQ,MAAM,YAAI;EACtE,uBAAuB,EAAE,MAAM,wBAAwB,OAAO,4BAAQ,MAAM,YAAI;EAChF,OAAO;IACL,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,iBAAiB;IACf,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,aAAa;IACX,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,cAAc;IACZ,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,WAAW;IACT,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,aAAa,EAAE,MAAM,cAAc,OAAO,mBAAS,MAAM,YAAI;EAC7D,YAAY,EAAE,MAAM,aAAa,OAAO,gBAAM,MAAM,eAAI;EACxD,aAAa;IACX,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,oBAAoB;IAClB,MAAM;IACN,OAAO;IACP,MAAM;IACN,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;;EAErB,WAAW,EAAE,MAAM,YAAY,OAAO,4BAAQ,MAAM,YAAI;EACxD,qBAAqB,EAAE,MAAM,eAAe,OAAO,4BAAQ,MAAM,SAAG;EACpE,uBAAuB,EAAE,MAAM,wBAAwB,OAAO,4BAAQ,MAAM,kBAAK;EACjF,qBAAqB,EAAE,MAAM,sBAAsB,OAAO,4BAAQ,MAAM,kBAAK;EAC7E,gBAAgB,EAAE,MAAM,wBAAwB,OAAO,4BAAQ,MAAM,YAAI;EACzE,kBAAkB,EAAE,MAAM,yBAAyB,OAAO,4BAAQ,MAAM,YAAI;EAC5E,iBAAiB,EAAE,MAAM,wBAAwB,OAAO,4BAAQ,MAAM,SAAG;EACzE,mBAAmB,EAAE,MAAM,qBAAqB,OAAO,4BAAQ,MAAM,YAAI;;AAMrE,IAAO,oBAAP,MAAO,mBAAiB;EAH9B,cAAA;AAIU,SAAA,oBAAoB,OAAO,iBAAiB;AAC5C,SAAA,eAAe,OAAO,YAAY;AAGjC,SAAA,cAAc,OAAiB,aAAW,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAG3C,SAAA,WAAuB,CAAC,WAAW;AAClC,SAAA,UAAU,OAAmB,CAAC,WAAW,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AAG1C,SAAA,oBAAoB,SAAS,MAAM,YAAY,KAAK,YAAW,CAAE,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAClE,SAAA,YAAY,SAAS,MAAM,KAAK,SAAS,SAAS,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAGpD,SAAA,sBAAoD,CAAA;;;;;;;;EAQ5D,SAAS,MAAgB,SAAkE;AAEzF,QAAI,CAAC,SAAS,qBAAqB;AACjC,YAAM,SAAS,YAAY,IAAI;AAC/B,UAAI,QAAQ,mBAAmB,CAAC,KAAK,kBAAkB,WAAW,OAAO,eAAsB,GAAG;AAChG,aAAK,aAAa,QAAQ,OAAO,qBAAqB,wDAAW;AACjE,eAAO,cAAc,IAAI,YAAY,wBAAwB,CAAC;AAC9D,eAAO;MACT;IACF;AAGA,UAAM,eAAe,KAAK,YAAW;AACrC,SAAK,YAAY,IAAI,IAAI;AAGzB,QAAI,CAAC,SAAS,eAAe,SAAS,cAAc;AAClD,WAAK,SAAS,KAAK,IAAI;AACvB,UAAI,KAAK,SAAS,SAAS,IAAI;AAC7B,aAAK,WAAW,KAAK,SAAS,MAAM,GAAG;MACzC;AACA,WAAK,QAAQ,IAAI,CAAC,GAAG,KAAK,QAAQ,CAAC;IACrC;AAGA,SAAK,oBAAoB,QAAQ,QAAM,GAAG,IAAI,CAAC;AAE/C,WAAO;EACT;;;;EAKA,SAAM;AACJ,QAAI,KAAK,SAAS,SAAS,GAAG;AAC5B,WAAK,SAAS,IAAG;AACjB,YAAM,eAAe,KAAK,SAAS,KAAK,SAAS,SAAS,CAAC;AAC3D,WAAK,YAAY,IAAI,YAAY;AACjC,WAAK,QAAQ,IAAI,CAAC,GAAG,KAAK,QAAQ,CAAC;AACnC,aAAO;IACT;AACA,WAAO;EACT;;;;EAKA,SAAM;AACJ,SAAK,SAAS,WAAW;EAC3B;;;;EAKA,WAAW,UAAkC;AAC3C,SAAK,oBAAoB,KAAK,QAAQ;AACtC,WAAO,MAAK;AACV,YAAM,QAAQ,KAAK,oBAAoB,QAAQ,QAAQ;AACvD,UAAI,QAAQ,IAAI;AACd,aAAK,oBAAoB,OAAO,OAAO,CAAC;MAC1C;IACF;EACF;;;;EAKA,cAAc,MAAc;AAC1B,WAAO,YAAY,IAAI;EACzB;;;;EAKA,oBAAiB;AACf,WAAO;EACT;;;;EAKA,gBAAgB,MAAc;AAC5B,UAAM,SAAS,YAAY,IAAI;AAC/B,QAAI,CAAC,QAAQ;AAAiB,aAAO;AACrC,WAAO,KAAK,kBAAkB,WAAW,OAAO,eAAsB;EACxE;;;;EAKA,YAAY,MAAc;AACxB,WAAO,YAAY,IAAI,GAAG,QAAQ;EACpC;;;;EAKA,gBAAgB,MAAY;AAC1B,eAAW,CAAC,MAAM,MAAM,KAAK,OAAO,QAAQ,WAAW,GAAG;AACxD,UAAI,OAAO,SAAS,MAAM;AACxB,eAAO;MACT;IACF;AACA,WAAO;EACT;;;uCAhIW,oBAAiB;IAAA;EAAA;;4EAAjB,oBAAiB,SAAjB,mBAAiB,WAAA,YAFhB,OAAM,CAAA;EAAA;;;sEAEP,mBAAiB,CAAA;UAH7B;WAAW;MACV,YAAY;KACb;;;;;ACtFK,IAAO,wBAAP,MAAO,uBAAqB;EA6FhC,cAAA;AA5FQ,SAAA,aAAa,OAAO,kBAAU;AAC9B,SAAA,eAAe,OAAO,YAAY;AAGjC,SAAA,QAAQ,OAAe,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,eAAe,OAAoB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AACvC,SAAA,YAAY,OAAkB;MACrC,OAAO;MACP,SAAS,EAAE,OAAO,GAAG,aAAa,GAAG,WAAW,GAAG,aAAa,GAAG,cAAc,GAAG,eAAe,EAAC;MACpG,UAAU;MACV,gBAAgB;MAChB,gBAAgB;OACjB,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAGQ,SAAA,SAAS,OAAmB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAC9B,SAAA,WAAW,OAA0B,UAAQ,GAAA,YAAA,CAAA,EAAA,WAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AAC7C,SAAA,YAAY,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAGxB,SAAA,kBAAkB,OAAoB,oBAAI,IAAG,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAC/C,SAAA,mBAAmB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAG/B,SAAA,kBAAkB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAC9B,SAAA,aAAa,OAA8C,eAAa,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAGxE,SAAA,oBAAoB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAChC,SAAA,gBAAgB,OAAe,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAGjC,SAAA,gBAAgB,SAAS,MAAK;AACrC,UAAI,SAAS,KAAK,MAAK;AACvB,YAAM,IAAI,KAAK,OAAM;AAErB,UAAI,EAAE,OAAO;AACX,iBAAS,OAAO,OAAO,OAAK,EAAE,UAAU,EAAE,KAAK;MACjD;AAEA,UAAI,EAAE,QAAQ;AACZ,cAAM,SAAS,EAAE,OAAO,YAAW;AACnC,iBAAS,OAAO,OAAO,OACrB,EAAE,SAAS,YAAW,EAAG,SAAS,MAAM,KACxC,EAAE,WAAW,YAAW,EAAG,SAAS,MAAM,KAC1C,EAAE,UAAU,YAAW,EAAG,SAAS,MAAM,KACzC,EAAE,QAAQ,YAAW,EAAG,SAAS,MAAM,CAAC;MAE5C;AAEA,UAAI,EAAE,aAAa;AACjB,iBAAS,OAAO,OAAO,OAAK,EAAE,gBAAgB,EAAE,WAAW;MAC7D;AAEA,UAAI,EAAE,aAAa,QAAW;AAC5B,iBAAS,OAAO,OAAO,QAAM,EAAE,SAAS,MAAM,EAAE,QAAS;MAC3D;AAEA,aAAO;IACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAEQ,SAAA,eAAe,SAAS,MAAK;AACpC,YAAM,SAAsB,CAAC,OAAO,aAAa,WAAW,aAAa,cAAc,aAAa;AACpG,YAAM,SAAoC,CAAA;AAE1C,aAAO,QAAQ,WAAQ;AACrB,eAAO,KAAK,IAAI,KAAK,cAAa,EAAG,OAAO,OAAK,EAAE,UAAU,KAAK;MACpE,CAAC;AAED,aAAO;IACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAEQ,SAAA,gBAAgB,SAAS,MAAM,KAAK,gBAAe,EAAG,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAE1D,SAAA,cAAyC;MAChD,OAAO;MACP,aAAa;MACb,WAAW;MACX,aAAa;MACb,cAAc;MACd,eAAe;;AAGR,SAAA,cAAyC;MAChD,OAAO;MACP,aAAa;MACb,WAAW;MACX,aAAa;MACb,cAAc;MACd,eAAe;;AAIf,SAAK,kBAAiB;EACxB;;EAIA,UAAU,QAAQ,KAAG;AACnB,SAAK,UAAU,IAAI,IAAI;AACvB,SAAK,WAAW,KAAK,aAAa,EAAE,MAAK,CAAE;EAC7C;EAEA,gBAAa;AACX,SAAK,WAAW,KAAK,kBAAkB,CAAA,CAAE;EAC3C;EAEA,gBAAgB,QAAc;AAC5B,SAAK,WAAW,KAAK,oBAAoB,EAAE,OAAM,CAAE;EACrD;EAEA,cAAW;AACT,SAAK,UAAS;AACd,SAAK,cAAa;EACpB;;EAIA,WAAW,MAAU;AACnB,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,gBAAgB,IAAI,IAAI;AAC7B,SAAK,gBAAgB,KAAK,EAAE;EAC9B;EAEA,mBAAgB;AACd,SAAK,gBAAgB,IAAI,KAAK;AAC9B,SAAK,aAAa,IAAI,IAAI;EAC5B;EAEA,gBAAgB,QAAgB,UAAmB;AACjD,SAAK,WAAW,KAAK,qBAAqB,EAAE,QAAQ,OAAO,SAAQ,CAAE;AAGrE,SAAK,MAAM,OAAO,WAChB,MAAM,IAAI,OAAK,EAAE,OAAO,SAAS,iCAAK,IAAL,EAAQ,OAAO,SAAQ,KAAK,CAAC,CAAC;AAGjE,QAAI,KAAK,aAAY,GAAI,OAAO,QAAQ;AACtC,WAAK,aAAa,OAAO,OAAK,IAAI,iCAAK,IAAL,EAAQ,OAAO,SAAQ,KAAK,IAAI;IACpE;EACF;EAEA,QAAQ,QAAgB,MAAY;AAClC,QAAI,CAAC,KAAK,KAAI;AAAI;AAClB,SAAK,WAAW,KAAK,iBAAiB,EAAE,QAAQ,KAAI,CAAE;EACxD;EAEA,WAAW,QAAgB,UAAgB;AACzC,SAAK,WAAW,KAAK,eAAe,EAAE,QAAQ,SAAQ,CAAE;AAGxD,SAAK,MAAM,OAAO,WAChB,MAAM,IAAI,OAAK,EAAE,OAAO,SAAS,iCAAK,IAAL,EAAQ,YAAY,SAAQ,KAAK,CAAC,CAAC;EAExE;EAEA,eAAe,QAAc;AAC3B,QAAI,CAAC,QAAQ,sFAAgB;AAAG;AAChC,SAAK,WAAW,KAAK,oBAAoB,EAAE,OAAM,CAAE;AACnD,SAAK,aAAa,QAAQ,sCAAQ;EACpC;;EAIA,oBAAoB,QAAc;AAChC,SAAK,gBAAgB,OAAO,SAAM;AAChC,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,UAAI,OAAO,IAAI,MAAM,GAAG;AACtB,eAAO,OAAO,MAAM;MACtB,OAAO;AACL,eAAO,IAAI,MAAM;MACnB;AACA,aAAO;IACT,CAAC;EACH;EAEA,iBAAc;AACZ,UAAM,SAAS,IAAI,IAAI,KAAK,cAAa,EAAG,IAAI,OAAK,EAAE,EAAE,CAAC;AAC1D,SAAK,gBAAgB,IAAI,MAAM;EACjC;EAEA,iBAAc;AACZ,SAAK,gBAAgB,IAAI,oBAAI,IAAG,CAAE;EACpC;EAEA,iBAAiB,UAAmB;AAClC,UAAM,MAAM,MAAM,KAAK,KAAK,gBAAe,CAAE;AAC7C,QAAI,IAAI,WAAW;AAAG;AAEtB,SAAK,WAAW,KAAK,2BAA2B,EAAE,SAAS,KAAK,OAAO,SAAQ,CAAE;AAGjF,SAAK,MAAM,OAAO,WAChB,MAAM,IAAI,OAAK,IAAI,SAAS,EAAE,EAAE,IAAI,iCAAK,IAAL,EAAQ,OAAO,SAAQ,KAAK,CAAC,CAAC;AAGpE,SAAK,eAAc;AACnB,SAAK,aAAa,QAAQ,sBAAO,IAAI,MAAM,uCAAS;EACtD;EAEA,qBAAkB;AAChB,UAAM,MAAM,MAAM,KAAK,KAAK,gBAAe,CAAE;AAC7C,QAAI,IAAI,WAAW;AAAG;AAEtB,UAAM,gBAAgB,KAAK,MAAK,EAAG,OAAO,OAAK,IAAI,SAAS,EAAE,EAAE,CAAC;AACjE,SAAK,cAAc,IAAI,aAAa;AACpC,SAAK,kBAAkB,IAAI,IAAI;EACjC;EAEA,oBAAiB;AACf,SAAK,kBAAkB,IAAI,KAAK;AAChC,SAAK,cAAc,IAAI,CAAA,CAAE;EAC3B;EAEA,qBAAkB;AAChB,UAAM,MAAM,KAAK,cAAa,EAAG,IAAI,OAAK,EAAE,EAAE;AAE9C,SAAK,WAAW,KAAK,sBAAsB,EAAE,SAAS,IAAG,CAAE;AAG3D,SAAK,MAAM,OAAO,WAAS,MAAM,OAAO,OAAK,CAAC,IAAI,SAAS,EAAE,EAAE,CAAC,CAAC;AAEjE,SAAK,eAAc;AACnB,SAAK,kBAAkB,IAAI,KAAK;AAChC,SAAK,cAAc,IAAI,CAAA,CAAE;AACzB,SAAK,aAAa,QAAQ,sBAAO,IAAI,MAAM,qBAAM;EACnD;;EAIA,UAAU,QAA2B;AACnC,SAAK,OAAO,OAAO,OAAM,kCAAK,IAAM,OAAS;EAC/C;EAEA,cAAW;AACT,SAAK,OAAO,IAAI,CAAA,CAAE;EACpB;EAEA,YAAY,MAAuB;AACjC,SAAK,SAAS,IAAI,IAAI;EACxB;EAEA,cAAc,KAA0C;AACtD,SAAK,WAAW,IAAI,GAAG;EACzB;;EAIA,gBAAa;AACX,UAAM,QAAQ,KAAK,cAAa;AAChC,QAAI,MAAM,WAAW,GAAG;AACtB,WAAK,aAAa,QAAQ,kDAAU;AACpC;IACF;AAEA,SAAK,WAAW,KAAK,yBAAyB;MAC5C,SAAS,MAAM,IAAI,OAAK,EAAE,EAAE;KAC7B;AACD,SAAK,aAAa,KAAK,6BAAS;EAClC;;EAIA,cAAc,OAAgB;AAC5B,WAAO,KAAK,YAAY,KAAK,KAAK;EACpC;EAEA,cAAc,OAAgB;AAC5B,WAAO,KAAK,YAAY,KAAK,KAAK;EACpC;EAEA,mBAAmB,MAAU;AAC3B,QAAI,KAAK,aAAa,KAAK,UAAU;AACnC,aAAO,GAAG,KAAK,aAAa,EAAE,IAAI,KAAK,YAAY,EAAE,GAAG,KAAI;IAC9D;AACA,WAAO,KAAK,YAAY;EAC1B;;EAIQ,oBAAiB;AACvB,SAAK,WAAW,GAAG,gBAAgB,CAAC,SAAc,KAAK,YAAY,IAAI,CAAC;AACxE,SAAK,WAAW,GAAG,qBAAqB,CAAC,SAAc,KAAK,gBAAgB,IAAI,CAAC;AACjF,SAAK,WAAW,GAAG,uBAAuB,CAAC,SAAc,KAAK,kBAAkB,IAAI,CAAC;AACrF,SAAK,WAAW,GAAG,iBAAiB,CAAC,SAAc,KAAK,mBAAmB,IAAI,CAAC;AAChF,SAAK,WAAW,GAAG,sBAAsB,CAAC,SAAc,KAAK,uBAAuB,IAAI,CAAC;AACzF,SAAK,WAAW,GAAG,kBAAkB,CAAC,SAAc,KAAK,oBAAoB,IAAI,CAAC;EACpF;EAEQ,YAAY,MAAS;AAC3B,SAAK,UAAU,IAAI,KAAK;AACxB,QAAI,KAAK,WAAW,KAAK,OAAO;AAC9B,WAAK,MAAM,IAAI,KAAK,SAAS,CAAA,CAAE;IACjC;EACF;EAEQ,gBAAgB,MAAS;AAC/B,QAAI,KAAK,SAAS;AAChB,WAAK,UAAU,IAAI,KAAK,KAAK;IAC/B;EACF;EAEQ,kBAAkB,MAAS;AACjC,QAAI,KAAK,WAAW,KAAK,MAAM;AAC7B,WAAK,aAAa,IAAI,KAAK,IAAI;IACjC;EACF;EAEQ,mBAAmB,MAAS;AAClC,QAAI,KAAK,MAAM;AACb,WAAK,MAAM,OAAO,WAAS,CAAC,KAAK,MAAM,GAAG,KAAK,CAAC;AAChD,WAAK,aAAa,QAAQ,mCAAU,KAAK,KAAK,QAAQ,EAAE;IAC1D;EACF;EAEQ,uBAAuB,MAAS;AACtC,QAAI,KAAK,SAAS;AAChB,WAAK,cAAa;IACpB;EACF;EAEQ,oBAAoB,MAAS;AACnC,QAAI,KAAK,SAAS;AAChB,WAAK,aAAa,QAAQ,6BAAS,KAAK,QAAQ,EAAE;IACpD,OAAO;AACL,WAAK,aAAa,MAAM,6BAAS,KAAK,KAAK,EAAE;IAC/C;EACF;;;uCAxUW,wBAAqB;IAAA;EAAA;;4EAArB,wBAAqB,SAArB,uBAAqB,WAAA,YAFpB,OAAM,CAAA;EAAA;;;sEAEP,uBAAqB,CAAA;UAHjC;WAAW;MACV,YAAY;KACb;;;;;ACNK,IAAO,yBAAP,MAAO,wBAAsB;EAHnC,cAAA;AAIU,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,UAAU,OAAwB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AACpC,SAAA,aAAa,OAAwB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACvC,SAAA,oBAAoB,OAAoB,oBAAI,IAAG,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAEjC,SAAA,SAAS,KAAK,QAAQ,WAAU;AAChC,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,mBAAmB,KAAK,kBAAkB,WAAU;AACpD,SAAA,YAAY,KAAK,WAAW,WAAU;AAG9B,SAAA,qBAAqB,OAA+B;MAC1D,QAAQ;MACR,UAAU;MACV,iBAAiB;MACjB,kBAAkB;MAClB,qBAAqB,CAAA;OACtB,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAEO,SAAA,mBAAmB,OAA6B;MACtD,QAAQ;MACR,mBAAmB,CAAA;MACnB,iBAAiB;MACjB,kBAAkB;MAClB,qBAAqB,CAAA;OACtB,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAEO,SAAA,kBAAkB,OAA4B;MACpD,QAAQ;MACR,UAAU;MACV,OAAO;MACP,iBAAiB;OAClB,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,oBAAoB,KAAK,mBAAmB,WAAU;AACtD,SAAA,kBAAkB,KAAK,iBAAiB,WAAU;AAClD,SAAA,iBAAiB,KAAK,gBAAgB,WAAU;AAIhD,SAAA,iBAAiB,SAAS,MAAK;AAC7B,YAAM,MAAM,KAAK,kBAAiB;AAClC,aAAO,KAAK,QAAO,EAAG,OAAO,OAAK,IAAI,IAAI,EAAE,EAAE,CAAC;IACjD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,qBAAqB,SAAS,MAAM,KAAK,kBAAiB,EAAG,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAEjE,SAAA,mBAAmB,SAAS,MAC1B,KAAK,WAAU,EAAG,OAAO,UAAQ,KAAK,WAAW,SAAS,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AAG7D,SAAA,oBAAoB,SAAS,MAAK;AAChC,YAAM,QAAQ,KAAK,WAAU;AAC7B,UAAI,MAAM,WAAW;AAAG,eAAO;AAC/B,YAAM,YAAY,MAAM,OAAO,UAC7B,KAAK,WAAW,YAAY,KAAK,WAAW,QAAQ,EACpD;AACF,aAAO,KAAK,MAAO,YAAY,MAAM,SAAU,GAAG;IACpD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;;;EAID,UAAU,QAAuB;AAC/B,SAAK,QAAQ,IAAI,MAAM;EACzB;EAEA,YAAYC,QAAoB;AAC9B,SAAK,QAAQ,OAAO,UAClB,KAAK,IAAI,OAAK,EAAE,OAAOA,OAAM,KAAK,kCAAK,IAAMA,UAAU,CAAC,CAAC;EAE7D;EAEA,SAASA,QAAoB;AAC3B,SAAK,QAAQ,OAAO,UAAQ,CAAC,GAAG,MAAMA,MAAK,CAAC;EAC9C;EAEA,YAAY,SAAe;AACzB,SAAK,QAAQ,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,OAAO,OAAO,CAAC;EAChE;;EAIA,qBAAqB,SAAe;AAClC,SAAK,kBAAkB,OAAO,SAAM;AAClC,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,UAAI,OAAO,IAAI,OAAO,GAAG;AACvB,eAAO,OAAO,OAAO;MACvB,OAAO;AACL,eAAO,IAAI,OAAO;MACpB;AACA,aAAO;IACT,CAAC;EACH;EAEA,kBAAe;AACb,UAAM,SAAS,IAAI,IAAI,KAAK,QAAO,EAAG,IAAI,OAAK,EAAE,EAAE,CAAC;AACpD,SAAK,kBAAkB,IAAI,MAAM;EACnC;EAEA,oBAAiB;AACf,SAAK,kBAAkB,IAAI,oBAAI,IAAG,CAAE;EACtC;;EAIA,sBAAsB,UAAa;AACjC,SAAK,mBAAmB,IAAI;MAC1B,QAAQ;MACR;MACA,iBAAiB;MACjB,kBAAkB;MAClB,qBAAqB,CAAA;KACtB;EACH;EAEA,yBAAsB;AACpB,SAAK,mBAAmB,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,MAAK,EAAG;EAC/D;EAEA,wBAAwB,SAAwC;AAC9D,SAAK,mBAAmB,OAAO,OAAM,kCAAK,IAAM,QAAU;EAC5D;EAEA,wBAAqB;AACnB,UAAM,SAAS,KAAK,mBAAkB;AACtC,QAAI,CAAC,OAAO,YAAY,CAAC,OAAO,iBAAiB;AAC/C,WAAK,MAAM,MAAM,gCAAO;AACxB;IACF;AAEA,SAAK,WAAW,IAAI,IAAI;AAExB,SAAK,IAAI,KAAK,cAAc;MAC1B,YAAY,OAAO,SAAS;MAC5B,OAAO,OAAO;MACd,kBAAkB,OAAO;MACzB,eAAe,OAAO;KACvB;AAED,SAAK,uBAAsB;EAC7B;;EAIA,oBAAoB,WAAgB;AAClC,SAAK,iBAAiB,IAAI;MACxB,QAAQ;MACR,mBAAmB;MACnB,iBAAiB;MACjB,kBAAkB;MAClB,qBAAqB,CAAA;KACtB;EACH;EAEA,uBAAoB;AAClB,SAAK,iBAAiB,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,MAAK,EAAG;EAC7D;EAEA,sBAAsB,SAAsC;AAC1D,SAAK,iBAAiB,OAAO,OAAM,kCAAK,IAAM,QAAU;EAC1D;EAEA,mBAAgB;AACd,UAAM,SAAS,KAAK,iBAAgB;AACpC,QAAI,OAAO,kBAAkB,WAAW,KAAK,CAAC,OAAO,iBAAiB;AACpE,WAAK,MAAM,MAAM,kDAAU;AAC3B;IACF;AAEA,SAAK,WAAW,IAAI,IAAI;AAGxB,UAAM,aAA8B,OAAO,kBAAkB,IAAI,QAAM;MACrE,YAAY,EAAE;MACd,OAAO,EAAE;MACT,QAAQ;MACR;AAEF,SAAK,WAAW,IAAI,UAAU;AAG9B,SAAK,IAAI,KAAK,qBAAqB;MACjC,aAAa,OAAO,kBAAkB,IAAI,OAAK,EAAE,EAAE;MACnD,OAAO,OAAO;MACd,kBAAkB,OAAO;MACzB,eAAe,OAAO;KACvB;AAED,SAAK,qBAAoB;EAC3B;;EAIA,mBAAmB,UAAe,OAAe,iBAAuB;AACtE,SAAK,gBAAgB,IAAI;MACvB,QAAQ;MACR;MACA;MACA;KACD;EACH;EAEA,sBAAmB;AACjB,SAAK,gBAAgB,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,MAAK,EAAG;EAC5D;EAEA,yBAAsB;AACpB,UAAM,SAAS,KAAK,gBAAe;AACnC,QAAI,CAAC,OAAO;AAAU;AAEtB,SAAK,IAAI,KAAK,mBAAmB;MAC/B,YAAY,OAAO,SAAS;MAC5B,OAAO,OAAO;KACf;AAED,SAAK,oBAAmB;AACxB,SAAK,MAAM,KAAK,yCAAW;EAC7B;EAEA,sBAAmB;AACjB,UAAM,SAAS,KAAK,gBAAe;AACnC,QAAI,CAAC,OAAO;AAAU;AAGtB,SAAK,oBAAmB;EAE1B;;EAIA,WAAW,UAAe,OAAa;AACrC,QAAI,CAAC,QAAQ,8CAAW,SAAS,KAAK,eAAK,GAAG;AAC5C;IACF;AAEA,SAAK,IAAI,KAAK,eAAe;MAC3B,YAAY,SAAS;MACrB;KACD;AAED,SAAK,MAAM,KAAK,yCAAW;EAC7B;EAEA,eAAe,UAAa;AAC1B,SAAK,IAAI,KAAK,mBAAmB;MAC/B,YAAY,SAAS;KACtB;AAED,SAAK,MAAM,KAAK,gCAAO;EACzB;;EAIA,iBAAc;AACZ,SAAK,WAAW,IAAI,CAAA,CAAE;EACxB;EAEA,sBAAsB,YAAoB,QAAiC,OAAc;AACvF,SAAK,WAAW,OAAO,CAAAC,WACrBA,OAAM,IAAI,UACR,KAAK,eAAe,aAChB,iCAAK,OAAL,EAAW,QAAQ,MAAK,KACxB,IAAI,CACT;AAIH,UAAM,QAAQ,KAAK,WAAU;AAC7B,UAAM,UAAU,MAAM,MAAM,UAC1B,KAAK,WAAW,YAAY,KAAK,WAAW,QAAQ;AAGtD,QAAI,SAAS;AACX,WAAK,WAAW,IAAI,KAAK;AACzB,YAAM,SAAS,MAAM,OAAO,UAAQ,KAAK,WAAW,QAAQ,EAAE;AAC9D,YAAM,SAAS,MAAM,OAAO,UAAQ,KAAK,WAAW,QAAQ,EAAE;AAE9D,UAAI,SAAS,GAAG;AACd,aAAK,MAAM,QAAQ,qBAAM,MAAM,sBAAO,MAAM,eAAK;MACnD,OAAO;AACL,aAAK,MAAM,QAAQ,4BAAQ,MAAM,qBAAM;MACzC;IACF;EACF;;EAIA,iBAAiB,MAMhB;AACC,SAAK,WAAW,IAAI,KAAK;AAEzB,QAAI,KAAK,SAAS;AAChB,WAAK,MAAM,QAAQ,sCAAQ;AAG3B,WAAK,YAAY,EAAE,IAAI,KAAK,YAAY,QAAQ,KAAI,CAAmB;AAGvE,UAAI,KAAK,SAAS,KAAK,oBAAoB,QAAW;AACpD,cAAMD,SAAQ,KAAK,QAAO,EAAG,KAAK,OAAK,EAAE,OAAO,KAAK,UAAU;AAC/D,YAAIA,QAAO;AACT,eAAK,mBAAmBA,QAAO,KAAK,OAAO,KAAK,eAAe;QACjE;MACF;IACF,OAAO;AACL,WAAK,MAAM,MAAM,yCAAW,KAAK,SAAS,0BAAM,EAAE;IACpD;EACF;EAEA,wBAAwB,MAIvB;AACC,SAAK,sBACH,KAAK,YACL,KAAK,UAAU,WAAW,UAC1B,KAAK,KAAK;EAEd;EAEA,kBAAkB,MAA8D;AAC9E,QAAI,KAAK,SAAS;AAChB,WAAK,YAAY,EAAE,IAAI,KAAK,YAAY,QAAQ,MAAK,CAAmB;AACxE,WAAK,MAAM,QAAQ,gCAAO;IAC5B,OAAO;AACL,WAAK,MAAM,MAAM,yCAAW,KAAK,SAAS,0BAAM,EAAE;IACpD;EACF;;;uCAnVW,yBAAsB;IAAA;EAAA;;4EAAtB,yBAAsB,SAAtB,wBAAsB,WAAA,YAFrB,OAAM,CAAA;EAAA;;;sEAEP,wBAAsB,CAAA;UAHlC;WAAW;MACV,YAAY;KACb;;;;;ACEK,IAAO,sBAAP,MAAO,qBAAmB;EAHhC,cAAA;AAIU,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,iBAAiB,OAAiC,oBAAI,IAAG,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAC3D,SAAA,YAAY,OAAwB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACtC,SAAA,iBAAiB,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAEnD,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,WAAW,KAAK,UAAU,WAAU;AACpC,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAGtC,SAAA,uBAAuB,OAAiC;MAC9D,QAAQ;MACR,QAAQ;MACR,YAAY;MACZ,SAAS;MACT,iBAAiB;OAClB,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AAEO,SAAA,sBAAsB,OAAgC;MAC5D,QAAQ;MACR,SAAS,CAAA;MACT,YAAY;MACZ,SAAS;MACT,iBAAiB;MACjB,OAAO;OACR,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,sBAAsB,KAAK,qBAAqB,WAAU;AAC1D,SAAA,qBAAqB,KAAK,oBAAoB,WAAU;AAIxD,SAAA,eAAe,SAAS,MAAK;AAC3B,UAAI,QAAQ;AACZ,WAAK,eAAc,EAAG,QAAQ,YAAS;AACrC,iBAAS,OAAO;MAClB,CAAC;AACD,aAAO;IACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,YAAY,SAAS,MAAK;AACxB,UAAI,QAAQ;AACZ,WAAK,eAAc,EAAG,QAAQ,YAAS;AACrC,iBAAS,OAAO;MAClB,CAAC;AACD,aAAO;IACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,cAAc,SAAS,MAAK;AAC1B,UAAI,QAAQ;AACZ,WAAK,eAAc,EAAG,QAAQ,YAAS;AACrC,iBAAS,OAAO;MAClB,CAAC;AACD,aAAO;IACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,sBAAsB,SAAS,MAAK;AAClC,YAAM,QAAQ,KAAK,eAAc;AACjC,UAAI,CAAC;AAAO,eAAO;AACnB,aAAO,KAAK,eAAc,EAAG,IAAI,KAAK,KAAK;IAC7C,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,sBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,wBAAwB,SAAS,MAAK;AACpC,YAAM,QAAQ,KAAK,eAAc;AACjC,UAAI,CAAC;AAAO,eAAO,CAAA;AACnB,aAAO,KAAK,UAAS,EAAG,OAAO,OAAK,EAAE,UAAU,KAAK;IACvD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,wBAAA,CAAA,IAAA,CAAA,CAAA;;;EAID,mBAAmB,OAAc;AAC/B,SAAK,IAAI,KAAK,oBAAoB,EAAE,MAAK,CAAE;EAC7C;EAEA,iBAAiB,UAAuB;AACtC,UAAM,MAAM,oBAAI,IAAG;AACnB,eAAW,UAAU,UAAU;AAC7B,UAAI,IAAI,OAAO,OAAO,MAAM;IAC9B;AACA,SAAK,eAAe,IAAI,GAAG;EAC7B;EAEA,kBAAkB,QAAmB;AACnC,SAAK,eAAe,OAAO,SAAM;AAC/B,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,aAAO,IAAI,OAAO,OAAO,MAAM;AAC/B,aAAO;IACT,CAAC;EACH;EAEA,YAAY,OAAa;AACvB,SAAK,eAAe,IAAI,KAAK;AAC7B,SAAK,kBAAkB,KAAK;EAC9B;EAEA,kBAAkB,OAAe,QAAwB,QAAQ,KAAG;AAClE,SAAK,IAAI,KAAK,sBAAsB,EAAE,OAAO,QAAQ,MAAK,CAAE;EAC9D;EAEA,YAAY,UAAyB;AACnC,SAAK,UAAU,IAAI,QAAQ;EAC7B;;EAIA,aAAa,WAAiB;AAC5B,SAAK,IAAI,KAAK,iBAAiB,EAAE,UAAS,CAAE;AAC5C,SAAK,MAAM,KAAK,yCAAW;EAC7B;EAEA,cAAc,WAAiB;AAC7B,SAAK,IAAI,KAAK,kBAAkB,EAAE,UAAS,CAAE;AAC7C,SAAK,MAAM,KAAK,gCAAO;EACzB;EAEA,cAAc,OAAe,WAAiB;AAC5C,SAAK,IAAI,KAAK,wBAAwB,EAAE,OAAO,UAAS,CAAE;EAC5D;EAEA,sBAAsB,OAAe,WAAmB,UAAyB;AAC/E,SAAK,IAAI,KAAK,2BAA2B,EAAE,OAAO,WAAW,SAAQ,CAAE;EACzE;;EAIA,WAAW,OAAa;AACtB,SAAK,IAAI,KAAK,eAAe,EAAE,MAAK,CAAE;AACtC,SAAK,MAAM,KAAK,gCAAO;EACzB;EAEA,YAAY,OAAa;AACvB,SAAK,IAAI,KAAK,gBAAgB,EAAE,MAAK,CAAE;AACvC,SAAK,MAAM,KAAK,gCAAO;EACzB;EAEA,WAAW,OAAe,QAAsB;AAC9C,QAAI,CAAC,QAAQ,kCAAS,KAAK,UAAK,UAAU,cAAI,0BAAM,GAAG;AACrD;IACF;AAEA,SAAK,IAAI,KAAK,eAAe,EAAE,OAAO,OAAM,CAAE;AAC9C,SAAK,MAAM,KAAK,yCAAW;EAC7B;EAEA,oBAAiB;AACf,QAAI,CAAC,QAAQ,4FAAiB,GAAG;AAC/B;IACF;AAEA,SAAK,IAAI,KAAK,mBAAmB;AACjC,SAAK,MAAM,KAAK,2DAAc;EAChC;;EAIA,wBAAwB,QAAa,YAAwC;AAC3E,SAAK,qBAAqB,IAAI;MAC5B,QAAQ;MACR;MACA;MACA,SAAS;MACT,iBAAiB;KAClB;EACH;EAEA,2BAAwB;AACtB,SAAK,qBAAqB,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,MAAK,EAAG;EACjE;EAEA,0BAA0B,SAA0C;AAClE,SAAK,qBAAqB,OAAO,OAAM,kCAAK,IAAM,QAAU;EAC9D;EAEA,uBAAoB;AAClB,UAAM,SAAS,KAAK,qBAAoB;AACxC,QAAI,CAAC,OAAO,UAAU,CAAC,OAAO,mBAAmB,CAAC,OAAO,QAAQ,KAAI,GAAI;AACvE,WAAK,MAAM,MAAM,4CAAS;AAC1B;IACF;AAEA,SAAK,IAAI,KAAK,gBAAgB;MAC5B,OAAO,OAAO;MACd,UAAU,OAAO,OAAO,MAAM,OAAO,OAAO;MAC5C,YAAY,OAAO;MACnB,SAAS,OAAO,QAAQ,KAAI;KAC7B;AAED,SAAK,yBAAwB;AAC7B,SAAK,MAAM,QAAQ,wDAAW;EAChC;;EAIA,uBAAuB,SAAgB,YAAwC;AAC7E,SAAK,oBAAoB,IAAI;MAC3B,QAAQ;MACR;MACA;MACA,SAAS;MACT,iBAAiB;MACjB,OAAO;KACR;EACH;EAEA,0BAAuB;AACrB,SAAK,oBAAoB,OAAO,OAAM,iCAAK,IAAL,EAAQ,QAAQ,MAAK,EAAG;EAChE;EAEA,yBAAyB,SAAyC;AAChE,SAAK,oBAAoB,OAAO,OAAM,kCAAK,IAAM,QAAU;EAC7D;EAEA,sBAAmB;AACjB,UAAM,SAAS,KAAK,oBAAmB;AACvC,QAAI,OAAO,QAAQ,WAAW,KAAK,CAAC,OAAO,mBAAmB,CAAC,OAAO,QAAQ,KAAI,GAAI;AACpF,WAAK,MAAM,MAAM,4CAAS;AAC1B;IACF;AAEA,SAAK,IAAI,KAAK,sBAAsB;MAClC,OAAO,OAAO;MACd,SAAS,OAAO,QAAQ,IAAI,QAAM;QAChC,IAAI,EAAE,MAAM,EAAE;QACd,MAAM,OAAO;QACb;MACF,SAAS,OAAO,QAAQ,KAAI;MAC5B,OAAO,OAAO;KACf;AAED,SAAK,wBAAuB;AAC5B,SAAK,MAAM,QAAQ,GAAG,OAAO,QAAQ,MAAM,+DAAa;EAC1D;;EAIA,mBAAmB,QAAa,iBAAuB;AACrD,SAAK,wBAAwB,QAAQ,MAAM;AAC3C,SAAK,0BAA0B,EAAE,gBAAe,CAAE;EACpD;EAEA,wBAAwB,SAAc;AACpC,SAAK,uBAAuB,SAAS,MAAM;EAC7C;;EAIA,iBAAiBE,QAAY,iBAAuB;AAClD,SAAK,wBAAwBA,QAAO,OAAO;AAC3C,SAAK,0BAA0B,EAAE,gBAAe,CAAE;EACpD;EAEA,sBAAsB,QAAa;AACjC,SAAK,uBAAuB,QAAQ,OAAO;EAC7C;;EAIA,wBAAwB,UAAuB;AAC7C,SAAK,iBAAiB,QAAQ;EAChC;EAEA,qBAAqB,UAAyB;AAC5C,SAAK,YAAY,QAAQ;EAC3B;EAEA,kBAAkB,MAA6D;AAC7E,SAAK,UAAU,OAAO,UACpB,KAAK,IAAI,OACP,EAAE,OAAO,KAAK,YACV,iCACK,IADL;MAEE,QAAQ,KAAK,UAAU,SAAkB;MACzC,OAAO,KAAK;MACZ,QAAQ,KAAK,WAAU,oBAAI,KAAI,GAAG,YAAW,IAAK;SAEpD,CAAC,CACN;EAEL;EAEA,mBAAmB,MAAsC;AACvD,SAAK,MAAM,QAAQ,sBAAO,KAAK,KAAK,qBAAM;AAC1C,SAAK,mBAAmB,KAAK,KAAK;EACpC;;;uCAhSW,sBAAmB;IAAA;EAAA;;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;EAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;;;ACbK,IAAO,mBAAP,MAAO,kBAAgB;EA+C3B,cAAA;AA7CQ,SAAA,MAAM,OAAO,gBAAgB;AAC7B,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAC3B,SAAA,aAAa,OAAO,iBAAiB;AACrC,SAAA,OAAO,OAAO,WAAW;AAGxB,SAAA,WAAW,OAAO,wBAAwB;AAC1C,SAAA,aAAa,OAAO,iBAAiB;AACrC,SAAA,YAAY,OAAO,yBAAyB;AAC5C,SAAA,YAAY,OAAO,yBAAyB;AAC5C,SAAA,aAAa,OAAO,2BAA2B;AAC/C,SAAA,QAAQ,OAAO,qBAAqB;AACpC,SAAA,SAAS,OAAO,sBAAsB;AACtC,SAAA,WAAW,OAAO,mBAAmB;AAItC,SAAA,iBAAiB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAC7B,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,gBAAgB,OAA4B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAChD,SAAA,eAAe,OAAiB,aAAW,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAEnD,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,eAAe,KAAK,cAAc,WAAU;AAC5C,SAAA,cAAc,KAAK,aAAa,WAAU;AAI1C,SAAA,oBAAoB,SAAS,MAAK;AAChC,YAAM,SAAS,KAAK,cAAa;AACjC,cAAQ,QAAQ,UAAU,UAAU,KAAK;IAC3C,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,qBAAqB,SAAS,MAAK;AACjC,YAAM,SAAS,KAAK,cAAa;AACjC,aAAO,QAAQ,YAAY,UAAU;IACvC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,kBAAkB,SAAS,MAAK;AAC9B,YAAM,SAAS,KAAK,cAAa;AACjC,aAAO,QAAQ,OAAO,WAAW;IACnC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAGC,SAAK,aAAY;AACjB,SAAK,kBAAiB;EACxB;;EAIQ,eAAY;EAGpB;;EAIQ,oBAAiB;AAEvB,SAAK,IAAI,GAAG,mBAAmB,CAAC,aAAmB;AACjD,WAAK,SAAS,YAAY,QAAQ;IACpC,CAAC;AAED,SAAK,IAAI,GAAG,0BAA0B,CAAC,SAAa;AAClD,WAAK,SAAS,cAAc,IAAI;IAClC,CAAC;AAED,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAAa;AAC/C,WAAK,SAAS,mBAAmB,IAAI;IACvC,CAAC;AAED,SAAK,IAAI,GAAG,sBAAsB,CAAC,SAAa;AAC9C,WAAK,SAAS,kBAAkB,IAAI;IACtC,CAAC;AAED,SAAK,IAAI,GAAG,iBAAiB,CAAC,SAAa;AACzC,WAAK,SAAS,mBAAmB,IAAI;IACvC,CAAC;AAED,SAAK,IAAI,GAAG,gBAAgB,CAAC,SAAa;AACxC,WAAK,SAAS,kBAAkB,IAAI;IACtC,CAAC;AAGD,SAAK,IAAI,GAAG,qBAAqB,CAAC,SAAa;AAC7C,WAAK,OAAO,iBAAiB,IAAI;IACnC,CAAC;AAED,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAAa;AAC/C,WAAK,OAAO,wBAAwB,IAAI;IAC1C,CAAC;AAGD,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAAa;AAC/C,WAAK,SAAS,wBAAwB,IAAI;IAC5C,CAAC;AAED,SAAK,IAAI,GAAG,gBAAgB,CAAC,SAAa;AACxC,WAAK,SAAS,kBAAkB,IAAI;IACtC,CAAC;AAGD,SAAK,IAAI,GAAG,iBAAiB,CAAC,WAAwB;AACpD,WAAK,cAAc,IAAI,MAAM;IAC/B,CAAC;EACH;;;;;EAOA,WAAW,MAAc;AACvB,SAAK,IAAI,WAAW,IAAkB;EACxC;;;;EAKA,SAAM;AACJ,SAAK,WAAW,OAAM;EACxB;;;;EAKA,SAAM;AACJ,SAAK,WAAW,WAAW;EAC7B;;EAIA,aAAa,WAAiB;AAC5B,SAAK,SAAS,aAAa,SAAS;EACtC;EAEA,cAAc,WAAiB;AAC7B,SAAK,SAAS,cAAc,SAAS;EACvC;EAEA,kBAAe;AACb,SAAK,SAAS,gBAAe;EAC/B;EAEA,iBAAc;AACZ,SAAK,SAAS,eAAc;EAC9B;EAEA,cAAW;AACT,SAAK,SAAS,YAAW;EAC3B;;EAIA,sBAAsB,UAAa;AACjC,SAAK,OAAO,sBAAsB,QAAQ;EAC5C;EAEA,wBAAqB;AACnB,SAAK,OAAO,sBAAqB;EACnC;EAEA,oBAAoB,WAAgB;AAClC,SAAK,OAAO,oBAAoB,SAAS;EAC3C;EAEA,WAAW,UAAe,OAAa;AACrC,SAAK,OAAO,WAAW,UAAU,KAAK;EACxC;;EAIA,wBAAwB,QAAa,MAAkC;AACrE,SAAK,SAAS,wBAAwB,QAAQ,IAAI;EACpD;EAEA,uBAAuB,SAAgB,MAAkC;AACvE,SAAK,SAAS,uBAAuB,SAAS,IAAI;EACpD;EAEA,WAAW,OAAa;AACtB,SAAK,SAAS,WAAW,KAAK;EAChC;EAEA,YAAY,OAAa;AACvB,SAAK,SAAS,YAAY,KAAK;EACjC;;EAIA,kBAAe;AACb,SAAK,IAAI,KAAK,kBAAkB;AAChC,SAAK,MAAM,KAAK,yCAAW;EAC7B;EAEA,iBAAc;AACZ,SAAK,IAAI,KAAK,iBAAiB;AAC/B,SAAK,MAAM,KAAK,yCAAW;EAC7B;;EAIA,gBAAa;AACX,SAAK,UAAU,cAAa;EAC9B;EAEA,iBAAc;AACZ,SAAK,UAAU,uBAAsB;EACvC;EAEA,cAAc,YAAkB;AAC9B,SAAK,UAAU,cAAc,UAAU;EACzC;;EAIA,YAAS;AACP,SAAK,MAAM,UAAS;EACtB;EAEA,WAAW,MAAS;AAClB,SAAK,MAAM,WAAW,IAAI;EAC5B;;;;;EAOA,MAAM,aAAU;AACd,QAAI,KAAK,eAAc;AAAI;AAE3B,SAAK,WAAW,IAAI,IAAI;AAExB,QAAI;AAEF,WAAK,IAAI,KAAK,cAAc;AAG5B,WAAK,IAAI,KAAK,mBAAmB;AAGjC,WAAK,IAAI,KAAK,YAAY;AAE1B,WAAK,eAAe,IAAI,IAAI;IAC9B,SAAS,OAAO;AACd,cAAQ,MAAM,sCAAsC,KAAK;AACzD,WAAK,MAAM,MAAM,4CAAS;IAC5B;AACE,WAAK,WAAW,IAAI,KAAK;IAC3B;EACF;;;;EAKA,sBAAmB;AACjB,SAAK,IAAI,KAAK,mBAAmB;EACnC;;;;EAKA,YAAS;AACP,SAAK,IAAI,KAAK,cAAc;AAC5B,SAAK,IAAI,KAAK,mBAAmB;AACjC,SAAK,UAAU,cAAa;AAC5B,SAAK,UAAU,cAAa;AAC5B,SAAK,MAAM,UAAS;AACpB,SAAK,SAAS,mBAAkB;EAClC;;;;;EAOA,EAAE,KAAa,QAAwC;AACrD,WAAO,KAAK,KAAK,EAAE,KAAK,MAAM;EAChC;;;;EAKA,WAAW,SAAe;AACxB,WAAO,KAAK,WAAW,WAAW,OAAc;EAClD;;;;EAKA,YAAY,SAAe;AACzB,SAAK,MAAM,QAAQ,OAAO;EAC5B;;;;EAKA,UAAU,SAAe;AACvB,SAAK,MAAM,MAAM,OAAO;EAC1B;;;;EAKA,SAAS,SAAe;AACtB,SAAK,MAAM,KAAK,OAAO;EACzB;;;;;EAOA,gBAAa;AACX,SAAK,IAAI,KAAK,eAAe;EAC/B;;;;EAKA,iBAAc;AACZ,SAAK,IAAI,KAAK,iBAAiB;EACjC;;;;EAKA,eAAe,YAAkB;AAC/B,SAAK,IAAI,KAAK,mBAAmB,EAAE,WAAU,CAAE;EACjD;;;;EAKA,eAAY;AACV,SAAK,IAAI,KAAK,eAAe;EAC/B;;;;EAKA,eAAY;AACV,SAAK,IAAI,KAAK,eAAe;EAC/B;;;;EAKA,sBAAmB;AACjB,SAAK,IAAI,KAAK,sBAAsB;EACtC;;;;EAKA,kBAAkB,WAAiB;AACjC,SAAK,IAAI,KAAK,sBAAsB,EAAE,UAAS,CAAE;EACnD;;;;;EAOA,eAAeC,QAAe,SAA2C;AACvE,SAAK,IAAI,KAAK,mBAAmB,iBAAE,OAAAA,UAAU,QAAS;EACxD;;;;EAKA,eAAe,YAAoB,OAAe,SAA4B;AAC5E,SAAK,IAAI,KAAK,mBAAmB,iBAAE,YAAY,SAAU,QAAS;AAClE,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;;EAKA,cAAc,YAAoB,SAAmB,OAAa;AAChE,SAAK,IAAI,KAAK,kBAAkB,EAAE,YAAY,SAAS,MAAK,CAAE;AAC9D,SAAK,MAAM,KAAK,4BAAQ,QAAQ,MAAM,wBAAS;EACjD;;;;;EAOA,mBAAmB,QAAgB,SAAa;AAC9C,SAAK,IAAI,KAAK,wBAAwB,EAAE,QAAQ,QAAO,CAAE;EAC3D;;;;EAKA,eAAe,UAAa;AAC1B,SAAK,IAAI,KAAK,oBAAoB,QAAQ;AAC1C,SAAK,MAAM,QAAQ,mCAAU;EAC/B;;;;EAKA,mBAAgB;AACd,SAAK,IAAI,KAAK,oBAAoB;AAClC,SAAK,MAAM,KAAK,6CAAe;EACjC;;;;;EAOA,gBAAgB,YAAkB;AAChC,SAAK,UAAU,cAAc,UAAU;EACzC;;;;EAKA,gBAAgB,YAAkB;AAChC,SAAK,IAAI,KAAK,kBAAkB,EAAE,WAAU,CAAE;AAC9C,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;;EAKA,eAAe,YAAkB;AAC/B,SAAK,IAAI,KAAK,iBAAiB,EAAE,WAAU,CAAE;AAC7C,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;;;EAOA,eAAY;AACV,SAAK,IAAI,KAAK,eAAe;AAC7B,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;;EAKA,cAAc,UAAgB;AAC5B,QAAI,QAAQ,oHAAqB,GAAG;AAClC,WAAK,IAAI,KAAK,kBAAkB,EAAE,SAAQ,CAAE;AAC5C,WAAK,MAAM,KAAK,yCAAW;IAC7B;EACF;;;;EAKA,aAAU;AACR,SAAK,IAAI,KAAK,aAAa;EAC7B;;;;;EAOA,YAAY,SAAkC,OAAK;AACjD,SAAK,IAAI,KAAK,gBAAgB,EAAE,OAAM,CAAE;AACxC,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;;EAKA,cAAc,YAAoB,SAAkC,OAAK;AACvE,SAAK,IAAI,KAAK,kBAAkB,EAAE,YAAY,OAAM,CAAE;AACtD,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;;EAKA,aAAa,OAAuC,SAAO;AACzD,SAAK,IAAI,KAAK,iBAAiB,EAAE,KAAI,CAAE;AACvC,SAAK,MAAM,KAAK,yCAAW;EAC7B;;;uCA1eW,mBAAgB;IAAA;EAAA;;4EAAhB,mBAAgB,SAAhB,kBAAgB,WAAA,YAFf,OAAM,CAAA;EAAA;;;sEAEP,kBAAgB,CAAA;UAH5B;WAAW;MACV,YAAY;KACb;;;;;ACGK,IAAO,aAAP,MAAO,YAAU;EA0BrB,cAAA;AAzBQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,iBAAiB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAC7B,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,cAAc,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAC1B,SAAA,SAAS,OAAiB;MAChC,gBAAgB;MAChB,aAAa;MACb,aAAa;MACb,WAAW;MACX,YAAY,CAAA;OACb,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AACO,SAAA,iBAAiB,OAA0B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAC7C,SAAA,eAAe,OAAO,IAAE,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAEhC,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,aAAa,KAAK,YAAY,WAAU;AACxC,SAAA,QAAQ,KAAK,OAAO,WAAU;AAC9B,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,cAAc,KAAK,aAAa,WAAU;AAGxC,SAAK,kBAAiB;EACxB;;EAIQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,mBAAmB,CAAC,SAA8B;AAC5D,WAAK,eAAe,IAAI,KAAK,OAAO;AACpC,WAAK,WAAW,IAAI,KAAK;AACzB,UAAI,KAAK,SAAS;AAChB,aAAK,MAAM,QAAQ,gDAAa;AAChC,aAAK,aAAY;MACnB;IACF,CAAC;AAED,SAAK,IAAI,GAAG,aAAa,CAAC,SAAkB;AAC1C,WAAK,OAAO,IAAI,IAAI;AACpB,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,sBAAsB,CAAC,SAAwC;AACzE,WAAK,eAAe,IAAI,KAAK,OAAO;AACpC,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,wBAAwB,MAAK;AACvC,WAAK,YAAY,IAAI,IAAI;AACzB,WAAK,MAAM,KAAK,+CAAY;IAC9B,CAAC;AAED,SAAK,IAAI,GAAG,0BAA0B,CAAC,SAA2B;AAChE,WAAK,YAAY,IAAI,KAAK;AAC1B,WAAK,MAAM,QAAQ,oDAAY,KAAK,KAAK,qBAAM;AAC/C,WAAK,aAAY;IACnB,CAAC;AAED,SAAK,IAAI,GAAG,sBAAsB,CAAC,SAA2B;AAC5D,WAAK,YAAY,IAAI,KAAK;AAC1B,WAAK,MAAM,MAAM,6BAAS,KAAK,KAAK,EAAE;IACxC,CAAC;AAED,SAAK,IAAI,GAAG,uBAAuB,MAAK;AACtC,WAAK,MAAM,QAAQ,gCAAO;AAC1B,WAAK,aAAY;IACnB,CAAC;AAED,SAAK,IAAI,GAAG,yBAAyB,CAAC,SAA6B;AACjE,WAAK,MAAM,QAAQ,sBAAO,KAAK,OAAO,iCAAQ;AAC9C,WAAK,aAAY;IACnB,CAAC;EACH;;EAIA,gBAAa;AACX,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,iBAAiB;EACjC;;EAIA,kBAAe;AACb,SAAK,IAAI,KAAK,sBAAsB;EACtC;EAEA,uBAAoB;AAClB,SAAK,IAAI,KAAK,2BAA2B;EAC3C;EAEA,gCAA6B;AAC3B,SAAK,IAAI,KAAK,wBAAwB;EACxC;;EAIA,OAAOC,QAAa;AAClB,QAAI,CAACA,OAAM,KAAI,GAAI;AACjB,WAAK,eAAe,IAAI,CAAA,CAAE;AAC1B;IACF;AAEA,SAAK,aAAa,IAAIA,MAAK;AAC3B,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,cAAc,EAAE,OAAAA,OAAK,CAAE;EACvC;EAEA,qBAAkB;AAChB,SAAK,eAAe,IAAI,CAAA,CAAE;AAC1B,SAAK,aAAa,IAAI,EAAE;EAC1B;;EAIA,aAAa,SAAiB,UAAkB,UAA8B;AAC5E,SAAK,IAAI,KAAK,qBAAqB;MACjC;MACA;MACA;KACD;EACH;EAEA,gBAAgB,IAAU;AACxB,SAAK,IAAI,KAAK,wBAAwB,EAAE,GAAE,CAAE;EAC9C;;EAIA,aAAa,UAAqB;AAChC,SAAK,IAAI,KAAK,gBAAgB,QAAQ;AACtC,SAAK,MAAM,QAAQ,4CAAS;EAC9B;;EAIA,mBAAgB;AACd,SAAK,IAAI,KAAK,aAAa;EAC7B;;EAIA,eAAY;AACV,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,eAAe;EAC/B;;;uCAtJW,aAAU;IAAA;EAAA;;4EAAV,aAAU,SAAV,YAAU,WAAA,YAFT,OAAM,CAAA;EAAA;;;sEAEP,YAAU,CAAA;UAHtB;WAAW;MACV,YAAY;KACb;;;;;ACGK,IAAO,sBAAP,MAAO,qBAAmB;EAmC9B,cAAA;AAlCQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAI3B,SAAA,SAAS,OAA0B;MACzC,eAAe;MACf,YAAY;MACZ,gBAAgB;MAChB,aAAa;MACb,cAAc;MACd,cAAc;OACf,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AACO,SAAA,YAAY,OAAuB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACrC,SAAA,iBAAiB,OAA6B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AAChD,SAAA,SAAS,OAAqB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAChC,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,kBAAkB,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAEpD,SAAA,QAAQ,KAAK,OAAO,WAAU;AAC9B,SAAA,WAAW,KAAK,UAAU,WAAU;AACpC,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAC9C,SAAA,QAAQ,KAAK,OAAO,WAAU;AAC9B,SAAA,YAAY,KAAK,WAAW,WAAU;AACtC,SAAA,iBAAiB,KAAK,gBAAgB,WAAU;AAIhD,SAAA,eAAe,SAAS,MAAK;AAC3B,YAAM,SAAS,KAAK,gBAAe;AACnC,UAAI,CAAC;AAAQ,eAAO,CAAA;AACpB,aAAO,KAAK,UAAS,EAAG,OAAO,OAAK,EAAE,WAAW,MAAM;IACzD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAGC,SAAK,kBAAiB;EACxB;;EAIQ,oBAAiB;AACvB,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAA2B;AAC7D,WAAK,OAAO,IAAI,IAAI;AACpB,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,0BAA0B,CAAC,SAAwB;AAC7D,WAAK,UAAU,IAAI,IAAI;AACvB,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,gCAAgC,CAAC,SAA2C;AACtF,WAAK,eAAe,IAAI,KAAK,OAAO;AACpC,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAAsB;AACxD,WAAK,OAAO,IAAI,IAAI;AACpB,WAAK,WAAW,IAAI,KAAK;IAC3B,CAAC;AAED,SAAK,IAAI,GAAG,uBAAuB,CAAC,SAAsB;AACxD,WAAK,UAAU,OAAO,UAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;AAC7C,WAAK,MAAM,QAAQ,gCAAO;IAC5B,CAAC;AAED,SAAK,IAAI,GAAG,yBAAyB,CAAC,SAAwB;AAC5D,WAAK,UAAU,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,OAAO,KAAK,EAAE,CAAC;AAChE,WAAK,MAAM,QAAQ,gCAAO;IAC5B,CAAC;AAED,SAAK,IAAI,GAAG,qBAAqB,CAAC,SAA6B;AAC7D,WAAK,MAAM,QAAQ,sBAAO,KAAK,OAAO,iCAAQ;AAC9C,WAAK,aAAY;IACnB,CAAC;AAED,SAAK,IAAI,GAAG,mBAAmB,CAAC,SAA4B;AAC1D,WAAK,MAAM,QAAQ,sBAAO,KAAK,MAAM,iCAAQ;AAC7C,WAAK,aAAY;IACnB,CAAC;EACH;;EAIA,OAAOC,QAAe,QAAe;AACnC,QAAI,CAACA,OAAM,KAAI,GAAI;AACjB,WAAK,eAAe,IAAI,CAAA,CAAE;AAC1B;IACF;AAEA,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,wBAAwB,EAAE,OAAAA,QAAO,OAAM,CAAE;EACzD;EAEA,qBAAkB;AAChB,SAAK,eAAe,IAAI,CAAA,CAAE;EAC5B;;EAIA,UAAU,QAAgB,SAAiB,UAA8B;AACvE,SAAK,IAAI,KAAK,qBAAqB;MACjC;MACA;MACA;KACD;EACH;EAEA,aAAa,IAAU;AACrB,QAAI,CAAC,QAAQ,8DAAY;AAAG;AAC5B,SAAK,IAAI,KAAK,wBAAwB,EAAE,GAAE,CAAE;EAC9C;EAEA,iBAAiB,QAAc;AAC7B,SAAK,gBAAgB,IAAI,MAAM;AAC/B,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,qBAAqB,EAAE,OAAM,CAAE;EAC/C;;EAIA,eAAY;AACV,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,kBAAkB;EAClC;EAEA,WAAW,QAAqB;AAC9B,SAAK,gBAAgB,IAAI,MAAM;AAC/B,QAAI,QAAQ;AACV,WAAK,iBAAiB,MAAM;IAC9B;EACF;;EAIA,mBAAmB,UAAkB,IAAE;AACrC,QAAI,CAAC,QAAQ,kCAAS,OAAO,mDAAW;AAAG;AAC3C,SAAK,IAAI,KAAK,wBAAwB,EAAE,QAAO,CAAE;EACnD;EAEA,qBAAqB,YAAoB,KAAG;AAC1C,QAAI,CAAC,QAAQ,oHAAqB;AAAG;AACrC,SAAK,IAAI,KAAK,0BAA0B,EAAE,UAAS,CAAE;EACvD;;EAIA,eAAY;AACV,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,yBAAyB;EACzC;EAEA,kBAAe;AACb,SAAK,WAAW,IAAI,IAAI;AACxB,SAAK,IAAI,KAAK,kBAAkB;EAClC;;;uCA5JW,sBAAmB;IAAA;EAAA;;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;EAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;;;ACFD,IAAM,mBAAmC;EACvC;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,UAAU;IACV,eAAe;IACf,gBAAgB;IAChB,gBAAgB;IAChB,OAAO,CAAC,UAAU,oBAAoB;IACtC,kBAAkB;IAClB,cAAc;IACd,WAAW;IACX,YAAY;IACZ,cAAc;IACd,gBAAgB;IAChB,gBAAgB;IAChB,UAAU;IACV,YAAY;IACZ,WAAW;IACX,WAAW;;EAEb;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,UAAU;IACV,eAAe;IACf,gBAAgB;IAChB,gBAAgB;IAChB,OAAO,CAAC,YAAY,WAAW,SAAS;IACxC,kBAAkB;IAClB,cAAc;IACd,WAAW;IACX,YAAY;IACZ,cAAc;IACd,gBAAgB;IAChB,gBAAgB;IAChB,UAAU;IACV,YAAY;IACZ,WAAW;IACX,WAAW;;EAEb;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,UAAU;IACV,eAAe;IACf,gBAAgB;IAChB,gBAAgB;IAChB,OAAO,CAAC,UAAU,sBAAsB,QAAQ;IAChD,kBAAkB;IAClB,cAAc;IACd,WAAW;IACX,YAAY;IACZ,cAAc;IACd,gBAAgB;IAChB,gBAAgB;IAChB,UAAU;IACV,YAAY;IACZ,WAAW;IACX,WAAW;;EAEb;IACE,IAAI;IACJ,MAAM;IACN,aAAa;IACb,UAAU;IACV,eAAe;IACf,gBAAgB;IAChB,gBAAgB;IAChB,OAAO,CAAC,WAAW,QAAQ;IAC3B,kBAAkB;IAClB,cAAc;IACd,WAAW;IACX,YAAY;IACZ,cAAc;IACd,gBAAgB;IAChB,gBAAgB;IAChB,UAAU;IACV,YAAY;IACZ,WAAW;IACX,WAAW;;;AAOT,IAAO,sBAAP,MAAO,qBAAmB;EAkC9B,cAAA;AA/BQ,SAAA,aAAa,OAAuB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAC9C,SAAA,YAAY,KAAK,WAAW,WAAU;AAGtC,SAAA,gBAAgB,SAAS,MAAM,KAAK,WAAU,EAAG,OAAO,OAAK,CAAC,EAAE,QAAQ,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AACzE,SAAA,kBAAkB,SAAS,MAAM,kBAAgB,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,oBAAoB,SAAS,MAAM,KAAK,WAAU,EAAG,OAAO,OAAK,EAAE,UAAU,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AAG9E,SAAA,uBAAuB,SAAS,MAAK;AACnC,YAAM,MAAM,CAAC,GAAG,KAAK,WAAU,GAAI,GAAG,gBAAgB;AACtD,aAAO,IACJ,OAAO,OAAK,EAAE,cAAc,CAAC,EAC7B,KAAK,CAAC,GAAG,MAAK;AACb,cAAM,QAAQ,EAAE,iBAAiB,IAAI,EAAE,iBAAiB,EAAE,iBAAiB;AAC3E,cAAM,QAAQ,EAAE,iBAAiB,IAAI,EAAE,iBAAiB,EAAE,iBAAiB;AAC3E,eAAO,QAAQ;MACjB,CAAC,EACA,MAAM,GAAG,CAAC;IACf,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,uBAAA,CAAA,IAAA,CAAA,CAAA;AAGD,SAAA,kBAAkB,SAAS,MAAK;AAC9B,YAAM,MAAM,CAAC,GAAG,KAAK,WAAU,GAAI,GAAG,gBAAgB;AACtD,aAAO,IAAI,OAAO,CAAC,KAAK,MAAK;AAC3B,YAAI,CAAC,IAAI,EAAE,QAAQ;AAAG,cAAI,EAAE,QAAQ,IAAI,CAAA;AACxC,YAAI,EAAE,QAAQ,EAAE,KAAK,CAAC;AACtB,eAAO;MACT,GAAG,CAAA,CAAsC;IAC3C,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAGC,SAAK,cAAa;EACpB;;;;EAKQ,gBAAa;AACnB,QAAI;AACF,YAAM,QAAQ,aAAa,QAAQ,gBAAgB;AACnD,UAAI,OAAO;AACT,aAAK,WAAW,IAAI,KAAK,MAAM,KAAK,CAAC;MACvC;IACF,SAAS,OAAO;AACd,cAAQ,MAAM,yCAAW,KAAK;IAChC;EACF;;;;EAKQ,gBAAa;AACnB,iBAAa,QAAQ,kBAAkB,KAAK,UAAU,KAAK,WAAU,CAAE,CAAC;EAC1E;;;;EAKA,eAAe,UAAiJ;AAC9J,UAAM,cAA4B,iCAC7B,WAD6B;MAEhC,IAAI,OAAO,KAAK,IAAG,CAAE;MACrB,YAAY;MACZ,cAAc;MACd,gBAAgB;MAChB,gBAAgB;MAChB,UAAU;MACV,YAAW,oBAAI,KAAI,GAAG,YAAW;MACjC,YAAW,oBAAI,KAAI,GAAG,YAAW;;AAGnC,SAAK,WAAW,OAAO,eAAa,CAAC,GAAG,WAAW,WAAW,CAAC;AAC/D,SAAK,cAAa;AAElB,WAAO;EACT;;;;EAKA,eAAe,MAAW,MAAc,aAAoB;AAC1D,WAAO,KAAK,eAAe;MACzB;MACA;MACA,UAAU,KAAK;MACf,eAAe,KAAK;MACpB,gBAAgB,KAAK,gBAAgB,UAAU,CAAC,KAAK;MACrD,gBAAgB,KAAK,gBAAgB,kBAAkB;MACvD,OAAO,KAAK,YAAY,IAAI,CAAC,MAAW,EAAE,QAAQ;MAClD,kBAAkB;MAClB,cAAc;MACd,WAAW;MACX,YAAY;KACb;EACH;;;;EAKA,eAAe,IAAY,SAA8B;AACvD,SAAK,WAAW,OAAO,eACrB,UAAU,IAAI,OACZ,EAAE,OAAO,KACL,gDAAK,IAAM,UAAX,EAAoB,YAAW,oBAAI,KAAI,GAAG,YAAW,EAAE,KACvD,CAAC,CACN;AAEH,SAAK,cAAa;EACpB;;;;EAKA,eAAe,IAAU;AACvB,SAAK,WAAW,OAAO,eAAa,UAAU,OAAO,OAAK,EAAE,OAAO,EAAE,CAAC;AACtE,SAAK,cAAa;EACpB;;;;EAKA,eAAe,IAAU;AACvB,SAAK,WAAW,OAAO,eACrB,UAAU,IAAI,OACZ,EAAE,OAAO,KAAK,iCAAK,IAAL,EAAQ,YAAY,CAAC,EAAE,WAAU,KAAK,CAAC,CACtD;AAEH,SAAK,cAAa;EACpB;;;;EAKA,YAAY,IAAU;AACpB,SAAK,WAAW,OAAO,eACrB,UAAU,IAAI,OACZ,EAAE,OAAO,KAAK,iCAAK,IAAL,EAAQ,YAAY,EAAE,aAAa,EAAC,KAAK,CAAC,CACzD;AAEH,SAAK,cAAa;EACpB;;;;EAKA,aAAa,IAAY,WAAmB,WAAmB,SAAgB;AAC7E,SAAK,WAAW,OAAO,eACrB,UAAU,IAAI,OACZ,EAAE,OAAO,KACL,iCACK,IADL;MAEE,gBAAgB,EAAE,iBAAiB;MACnC,gBAAgB,EAAE,iBAAiB;MACnC,cAAc,UAAU,EAAE,eAAe,IAAI,EAAE;SAEjD,CAAC,CACN;AAEH,SAAK,cAAa;EACpB;;;;EAKA,YAAY,IAAU;AAEpB,UAAM,eAAe,KAAK,WAAU,EAAG,KAAK,OAAK,EAAE,OAAO,EAAE;AAC5D,QAAI;AAAc,aAAO;AAGzB,WAAO,iBAAiB,KAAK,OAAK,EAAE,OAAO,EAAE;EAC/C;;;;EAKA,eAAe,UAAsB;AACnC,QAAI,SAAS,mBAAmB;AAAG,aAAO;AAC1C,WAAO,KAAK,MAAO,SAAS,iBAAiB,SAAS,iBAAkB,GAAG;EAC7E;;;;EAKA,gBAAgBC,QAAa;AAC3B,UAAM,aAAaA,OAAM,YAAW;AACpC,UAAM,MAAM,CAAC,GAAG,KAAK,WAAU,GAAI,GAAG,gBAAgB;AACtD,WAAO,IAAI,OAAO,OAChB,EAAE,KAAK,YAAW,EAAG,SAAS,UAAU,KACxC,EAAE,aAAa,YAAW,EAAG,SAAS,UAAU,CAAC;EAErD;;;uCAnMW,sBAAmB;IAAA;EAAA;;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;EAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;;;AClEK,IAAO,6BAAP,MAAO,4BAA0B;EAYrC,cAAA;AAXQ,SAAA,cAAc,OAAO,oBAAoB;AACzC,SAAA,kBAAkB,OAAO,mBAAmB;AAG5C,SAAA,YAAY,OAA4B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AACpD,SAAA,WAAW,KAAK,UAAU,WAAU;AAG5B,SAAA,mBAAmB;AACV,SAAA,iBAAiB,IAAI,KAAK;AAIzC,SAAK,eAAc;EACrB;;;;EAKA,MAAM,iBAAc;AAClB,UAAM,MAAM,KAAK,IAAG;AAGpB,QAAI,KAAK,UAAS,KAAM,MAAM,KAAK,mBAAmB,KAAK,gBAAgB;AACzE,aAAO,KAAK,UAAS;IACvB;AAEA,UAAM,QAAQ,KAAK,YAAY,MAAK;AACpC,UAAM,iBAAiB,MAAM,OAAO,OAAK,EAAE,WAAW,WAAW;AAGjE,UAAM,WAAyB;MAC7B,YAAY,MAAM;MAClB,iBAAiB,eAAe,OAAO,OAAK,EAAE,MAAM,YAAY,CAAC,EAAE;MACnE,mBAAmB;MACnB,QAAQ,CAAA;MACR,WAAW,CAAA;MACX,YAAY,CAAA;;AAId,UAAM,iBAAiB,eAAe,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,MAAM,WAAW,CAAC;AACnF,UAAM,iBAAiB,eAAe,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,MAAM,WAAW,CAAC;AACnF,aAAS,oBAAoB,iBAAiB,IAAK,iBAAiB,iBAAkB,MAAM;AAG5F,UAAM,YAAwB,CAAC,cAAc,aAAa,cAAc,SAAS;AACjF,eAAW,QAAQ,WAAW;AAC5B,YAAM,YAAY,eAAe,OAAO,OAAK,EAAE,aAAa,IAAI;AAChE,YAAM,YAAY,UAAU,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,MAAM,WAAW,CAAC;AACzE,YAAM,YAAY,UAAU,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,MAAM,WAAW,CAAC;AAGzE,YAAM,YAAY,oBAAI,IAAG;AACzB,gBAAU,QAAQ,OAAI;AACpB,cAAM,UAAU,UAAU,IAAI,EAAE,aAAa,KAAK,EAAE,WAAW,GAAG,WAAW,EAAC;AAC9E,kBAAU,IAAI,EAAE,eAAe;UAC7B,WAAW,QAAQ,YAAY,EAAE,MAAM;UACvC,WAAW,QAAQ,YAAY,EAAE,MAAM;SACxC;MACH,CAAC;AAED,UAAI,WAA0B;AAC9B,UAAI,eAAe;AACnB,gBAAU,QAAQ,CAAC,OAAO,SAAQ;AAChC,cAAM,OAAO,MAAM,YAAY,IAAI,MAAM,YAAY,MAAM,YAAY;AACvE,YAAI,OAAO,cAAc;AACvB,yBAAe;AACf,qBAAW;QACb;MACF,CAAC;AAGD,YAAM,aAAa,oBAAI,IAAG;AAC1B,gBAAU,QAAQ,OAAI;AACpB,UAAE,YAAY,QAAQ,OAAI;AACxB,gBAAM,UAAU,WAAW,IAAI,EAAE,QAAQ,KAAK;AAC9C,qBAAW,IAAI,EAAE,UAAU,WAAW,EAAE,MAAM,YAAY,IAAI,IAAI,EAAE;QACtE,CAAC;MACH,CAAC;AAED,YAAM,YAAY,MAAM,KAAK,WAAW,QAAO,CAAE,EAC9C,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,EAC1B,MAAM,GAAG,CAAC,EACV,IAAI,CAAC,CAAC,IAAI,MAAM,IAAI;AAEvB,eAAS,OAAO,IAAI,IAAI;QACtB,OAAO,UAAU;QACjB,mBAAmB,YAAY,IAAK,YAAY,YAAa,MAAM;QACnE,mBAAmB;QACnB,WAAW,UAAU,SAAS,IAAI,YAAY,iBAAiB,IAAI,EAAE;;IAEzE;AAGA,UAAM,aAAa,IAAI,MAAM,EAAE,EAAE,KAAK,CAAC;AACvC,UAAM,cAAc,IAAI,MAAM,EAAE,EAAE,KAAK,CAAC;AACxC,mBAAe,QAAQ,OAAI;AACzB,YAAM,OAAO,IAAI,KAAK,EAAE,SAAS,EAAE,SAAQ;AAC3C,iBAAW,IAAI;AACf,UAAI,EAAE,MAAM,YAAY,GAAG;AACzB,oBAAY,IAAI;MAClB;IACF,CAAC;AAED,UAAM,YAAY,WAAW,IAAI,CAAC,OAAO,OAAO;MAC9C,MAAM;MACN,MAAM,QAAQ,IAAI,YAAY,CAAC,IAAI,QAAQ;MAC3C;AAEF,aAAS,YAAY,UAClB,KAAK,CAAC,GAAG,MAAM,EAAE,OAAO,EAAE,IAAI,EAC9B,MAAM,GAAG,CAAC,EACV,IAAI,OAAK,EAAE,IAAI;AAGlB,UAAM,YAAY,oBAAI,IAAG;AAEzB,mBAAe,QAAQ,OAAI;AACzB,YAAM,QAAQ,EAAE,YAAY,IAAI,OAAK,EAAE,QAAQ,EAAE,KAAI,EAAG,KAAK,GAAG,KAAK;AACrE,YAAM,MAAM,GAAG,EAAE,QAAQ,IAAI,EAAE,aAAa,IAAI,KAAK;AAErD,YAAM,UAAU,UAAU,IAAI,GAAG,KAAK;QACpC,UAAU,EAAE;QACZ,eAAe,EAAE;QACjB,OAAO,EAAE,YAAY,IAAI,OAAK,EAAE,QAAQ,KAAK,CAAA;QAC7C,WAAW;QACX,WAAW;QACX,OAAO;;AAGT,gBAAU,IAAI,KAAK,iCACd,UADc;QAEjB,WAAW,QAAQ,YAAY,EAAE,MAAM;QACvC,WAAW,QAAQ,YAAY,EAAE,MAAM;QACvC,OAAO,QAAQ,QAAQ;QACxB;IACH,CAAC;AAED,aAAS,aAAa,MAAM,KAAK,UAAU,OAAM,CAAE,EAChD,OAAO,OAAK,EAAE,SAAS,CAAC,EACxB,IAAI,QAAM;MACT,UAAU,EAAE;MACZ,eAAe,EAAE;MACjB,OAAO,EAAE;MACT,gBAAgB,EAAE,YAAY,IAAK,EAAE,YAAY,EAAE,YAAa,MAAM;MACtE,YAAY,EAAE;MACd,EACD,KAAK,CAAC,GAAG,MAAM,EAAE,iBAAiB,EAAE,cAAc,EAClD,MAAM,GAAG,CAAC;AAEb,SAAK,UAAU,IAAI,QAAQ;AAC3B,SAAK,mBAAmB;AAExB,WAAO;EACT;;;;EAKA,qBAAkB;AAChB,UAAM,kBAAoC,CAAA;AAC1C,UAAM,WAAW,KAAK,UAAS;AAE/B,QAAI,CAAC,YAAY,SAAS,aAAa,GAAG;AAExC,sBAAgB,KAAK;QACnB,IAAI;QACJ,MAAM;QACN,OAAO;QACP,aAAa;QACb,YAAY;QACZ,QAAQ;QACR,QAAQ;UACN,OAAO;UACP,MAAM,EAAE,UAAU,aAAY;;OAEjC;AACD,aAAO;IACT;AAGA,QAAI,SAAS,WAAW,SAAS,GAAG;AAClC,YAAM,OAAO,SAAS,WAAW,CAAC;AAClC,sBAAgB,KAAK;QACnB,IAAI;QACJ,MAAM;QACN,OAAO;QACP,aAAa,GAAG,iBAAiB,KAAK,QAAQ,EAAE,KAAK,MAAM,KAAK,aAAa,KAAK,aAAa,CAAC;QAChG,YAAY,KAAK,IAAI,IAAI,KAAK,KAAK,aAAa,EAAE;QAClD,QAAQ,kCAAS,KAAK,eAAe,QAAQ,CAAC,CAAC,UAAK,KAAK,UAAU;QACnE,QAAQ;UACN,OAAO;UACP,MAAM;;OAET;IACH;AAGA,UAAM,cAAc,OAAO,QAAQ,SAAS,MAAM;AAClD,UAAM,WAAW,YACd,OAAO,CAAC,CAAC,GAAG,IAAI,MAAM,KAAK,SAAS,CAAC,EACrC,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,CAAC,EAAE,iBAAiB,EAAE,CAAC;AAEpE,QAAI,UAAU;AACZ,YAAM,CAAC,UAAU,IAAI,IAAI;AACzB,sBAAgB,KAAK;QACnB,IAAI;QACJ,MAAM;QACN,OAAO,GAAG,iBAAiB,QAAQ,EAAE,KAAK;QAC1C,aAAa,kCAAS,KAAK,kBAAkB,QAAQ,CAAC,CAAC;QACvD,YAAY,KAAK,IAAI,IAAI,KAAK,KAAK,QAAQ,CAAC;QAC5C,QAAQ,gBAAM,KAAK,KAAK;OACzB;IACH;AAGA,QAAI,SAAS,UAAU,SAAS,GAAG;AACjC,YAAM,QAAQ,SAAS,UAAU,IAAI,OAAK,GAAG,CAAC,KAAK,EAAE,KAAK,QAAG;AAC7D,sBAAgB,KAAK;QACnB,IAAI;QACJ,MAAM;QACN,OAAO;QACP,aAAa;QACb,YAAY;QACZ,QAAQ;OACT;IACH;AAEA,WAAO;EACT;;;;EAKA,qBAAqB,UAAkB;AACrC,UAAM,WAAW,KAAK,UAAS;AAC/B,UAAM,WAAW,UAAU,OAAO,QAAQ;AAC1C,UAAM,gBAAgB,iBAAiB,QAAQ;AAE/C,QAAI,CAAC,YAAY,SAAS,QAAQ,GAAG;AAEnC,aAAO;QACL;QACA,eAAe,cAAc;QAC7B,gBAAgB,cAAc;QAC9B,iBAAiB;QACjB,gBAAgB;QAChB,QAAQ;QACR,wBAAwB;;IAE5B;AAEA,WAAO;MACL;MACA,eAAe,SAAS;MACxB,gBAAgB,SAAS;MACzB,iBAAiB;MACjB,gBAAgB;MAChB,QAAQ,gBAAM,SAAS,KAAK;MAC5B,wBAAwB,KAAK,MAAM,SAAS,iBAAiB;;EAEjE;;;;EAKA,oBAAiB;AACf,UAAM,QAAQ,KAAK,YAAY,MAAK;AACpC,UAAM,cAAc,MAAM,OAAO,OAAK,EAAE,WAAW,SAAS;AAG5D,QAAI,YAAY,WAAW,GAAG;AAC5B,YAAM,WAAW,KAAK,UAAS;AAC/B,UAAI,YAAY,SAAS,WAAW,SAAS,GAAG;AAC9C,cAAM,OAAO,SAAS,WAAW,CAAC;AAClC,eAAO;UACL,UAAU,KAAK;UACf,QAAQ,qBAAM,iBAAiB,KAAK,QAAQ,EAAE,KAAK;;MAEvD;AACA,aAAO;QACL,UAAU;QACV,QAAQ;;IAEZ;AAGA,UAAM,cAAc,IAAI,IAAI,YAAY,IAAI,OAAK,EAAE,QAAQ,CAAC;AAC5D,UAAM,eAA2B,CAAC,cAAc,aAAa,cAAc,SAAS,EACjF,OAAO,OAAK,CAAC,YAAY,IAAI,CAAa,CAAC;AAE9C,QAAI,aAAa,SAAS,GAAG;AAE3B,YAAM,WAAW,KAAK,UAAS;AAC/B,UAAI,UAAU;AACZ,cAAM,cAAc,aACjB,OAAO,OAAK,SAAS,OAAO,CAAC,GAAG,QAAQ,CAAC,EACzC,KAAK,CAAC,GAAG,MAAM,SAAS,OAAO,CAAC,EAAE,oBAAoB,SAAS,OAAO,CAAC,EAAE,iBAAiB,EAAE,CAAC;AAEhG,YAAI,aAAa;AACf,iBAAO;YACL,UAAU;YACV,QAAQ,iCAAQ,iBAAiB,WAAW,EAAE,KAAK;;QAEvD;MACF;IACF;AAEA,WAAO;EACT;;EAGQ,aAAa,MAAmB;AACtC,UAAM,SAAwC;MAC5C,YAAY;MACZ,UAAU;MACV,cAAc;;AAEhB,WAAO,OAAO,IAAI;EACpB;;;uCAjUW,6BAA0B;IAAA;EAAA;;4EAA1B,6BAA0B,SAA1B,4BAA0B,WAAA,YAFzB,OAAM,CAAA;EAAA;;;sEAEP,4BAA0B,CAAA;UAHtC;WAAW;MACV,YAAY;KACb;;;;;AC3BK,IAAO,sBAAP,MAAO,qBAAmB;EAqE9B,cAAA;AApEQ,SAAA,MAAM,OAAO,kBAAkB;AAG/B,SAAA,QAAQ,OAAuB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AACzC,SAAA,OAAO,KAAK,MAAM,WAAU;AAGpB,SAAA,UAAU,OAAO,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AAC7B,SAAA,SAAS,KAAK,QAAQ,WAAU;AAGxB,SAAA,UAAU,OAAkB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AACtC,SAAA,SAAS,KAAK,QAAQ,WAAU;AAGf,SAAA,WAAW;AAG5B,SAAA,eAAe,SAAS,MAAK;AAC3B,YAAM,OAAO,KAAK,MAAK;AACvB,YAAM,SAAS,KAAK,QAAO;AAE3B,aAAO,KAAK,OAAO,SAAM;AACvB,YAAI,OAAO,UAAU,IAAI,WAAW,OAAO;AAAQ,iBAAO;AAC1D,YAAI,OAAO,SAAS,IAAI,UAAU,OAAO;AAAO,iBAAO;AACvD,YAAI,OAAO,YAAY,IAAI,aAAa,OAAO;AAAU,iBAAO;AAChE,YAAI,OAAO,QAAQ;AACjB,gBAAM,SAAS,OAAO,OAAO,YAAW;AACxC,cAAI,CAAC,IAAI,QAAQ,YAAW,EAAG,SAAS,MAAM,KAC1C,CAAC,IAAI,SAAS,YAAW,EAAG,SAAS,MAAM,GAAG;AAChD,mBAAO;UACT;QACF;AACA,YAAI,OAAO,aAAa,IAAI,YAAY,OAAO;AAAW,iBAAO;AACjE,YAAI,OAAO,WAAW,IAAI,YAAY,OAAO;AAAS,iBAAO;AAE7D,eAAO;MACT,CAAC;IACH,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AAGD,SAAA,aAAa,SAAS,MAAK;AACzB,YAAM,OAAO,KAAK,MAAK;AACvB,YAAM,UAAU,oBAAI,IAAG;AAEvB,WAAK,QAAQ,SAAM;AACjB,YAAI,CAAC,QAAQ,IAAI,IAAI,MAAM,GAAG;AAC5B,kBAAQ,IAAI,IAAI,QAAQ,CAAA,CAAE;QAC5B;AACA,gBAAQ,IAAI,IAAI,MAAM,EAAG,KAAK,GAAG;MACnC,CAAC;AAED,aAAO;IACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAGD,SAAA,QAAQ,SAAS,MAAK;AACpB,YAAM,OAAO,KAAK,MAAK;AACvB,aAAO;QACL,OAAO,KAAK;QACZ,OAAO,KAAK,OAAO,OAAK,EAAE,UAAU,OAAO,EAAE;QAC7C,MAAM,KAAK,OAAO,OAAK,EAAE,UAAU,MAAM,EAAE;QAC3C,SAAS,KAAK,OAAO,OAAK,EAAE,UAAU,SAAS,EAAE;QACjD,SAAS,KAAK,OAAO,OAAK,EAAE,UAAU,SAAS,EAAE;QACjD,OAAO,KAAK,OAAO,OAAK,EAAE,UAAU,OAAO,EAAE;;IAEjD,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AAGC,SAAK,kBAAiB;EACxB;;;;EAKQ,oBAAiB;AAEvB,SAAK,IAAI,GAAG,iBAAiB,CAAC,QAAqB;AACjD,UAAI,KAAK,QAAO,GAAI;AAClB,aAAK,OAAO,GAAG;MACjB;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,wBAAwB,CAAC,SAAwB;AAC3D,UAAI,KAAK,QAAO,GAAI;AAClB,aAAK,QAAQ,SAAO,KAAK,OAAO,GAAG,CAAC;MACtC;IACF,CAAC;EACH;;;;EAKA,OAAO,KAA2C;AAChD,UAAM,SAAuB,iCACxB,MADwB;MAE3B,IAAI,OAAO,KAAK,IAAG,CAAE,IAAI,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;MAChE,YAAW,oBAAI,KAAI,GAAG,YAAW;;AAGnC,SAAK,MAAM,OAAO,UAAO;AACvB,YAAM,UAAU,CAAC,QAAQ,GAAG,IAAI;AAEhC,UAAI,QAAQ,SAAS,KAAK,UAAU;AAClC,eAAO,QAAQ,MAAM,GAAG,KAAK,QAAQ;MACvC;AACA,aAAO;IACT,CAAC;EACH;;;;EAKA,MAAM,QAAgB,UAAkB,SAAiB,SAAa;AACpE,SAAK,OAAO,EAAE,QAAQ,OAAO,SAAS,UAAU,SAAS,QAAO,CAAE;EACpE;;;;EAKA,KAAK,QAAgB,UAAkB,SAAiB,SAAa;AACnE,SAAK,OAAO,EAAE,QAAQ,OAAO,QAAQ,UAAU,SAAS,QAAO,CAAE;EACnE;;;;EAKA,QAAQ,QAAgB,UAAkB,SAAiB,SAAa;AACtE,SAAK,OAAO,EAAE,QAAQ,OAAO,WAAW,UAAU,SAAS,QAAO,CAAE;EACtE;;;;EAKA,QAAQ,QAAgB,UAAkB,SAAiB,SAAa;AACtE,SAAK,OAAO,EAAE,QAAQ,OAAO,WAAW,UAAU,SAAS,QAAO,CAAE;EACtE;;;;EAKA,MAAM,QAAgB,UAAkB,SAAiB,SAAa;AACpE,SAAK,OAAO,EAAE,QAAQ,OAAO,SAAS,UAAU,SAAS,QAAO,CAAE;EACpE;;;;EAKA,UAAU,QAAiB;AACzB,SAAK,QAAQ,IAAI,MAAM;EACzB;;;;EAKA,aAAa,SAA2B;AACtC,SAAK,QAAQ,OAAO,OAAM,kCAAK,IAAM,QAAU;EACjD;;;;EAKA,cAAW;AACT,SAAK,QAAQ,IAAI,CAAA,CAAE;EACrB;;;;EAKA,aAAU;AACR,SAAK,QAAQ,OAAO,OAAK,CAAC,CAAC;EAC7B;;;;EAKA,QAAQ,MAAa;AACnB,SAAK,QAAQ,IAAI,IAAI;EACvB;;;;EAKA,YAAS;AACP,SAAK,MAAM,IAAI,CAAA,CAAE;EACnB;;;;EAKA,cAAc,QAAc;AAC1B,SAAK,MAAM,OAAO,UAAQ,KAAK,OAAO,OAAK,EAAE,WAAW,MAAM,CAAC;EACjE;;;;EAKA,YAAY,QAAc;AACxB,WAAO,KAAK,MAAK,EAAG,OAAO,OAAK,EAAE,WAAW,MAAM;EACrD;;;;EAKA,WAAW,SAAyB,QAAM;AACxC,UAAM,OAAO,KAAK,aAAY;AAE9B,QAAI;AACJ,QAAI;AACJ,QAAI;AAEJ,QAAI,WAAW,QAAQ;AACrB,gBAAU,KAAK,UAAU,MAAM,MAAM,CAAC;AACtC,iBAAW,mBAAkB,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,CAAC;AACnE,iBAAW;IACb,OAAO;AAEL,YAAM,UAAU,CAAC,gBAAM,kBAAQ,gBAAM,gBAAM,cAAI;AAC/C,YAAM,OAAO,KAAK,IAAI,OAAK;QACzB,EAAE;QACF,EAAE;QACF,EAAE;QACF,EAAE;QACF,IAAI,EAAE,QAAQ,QAAQ,MAAM,IAAI,CAAC;QACjC,KAAK,GAAG,CAAC;AAEX,gBAAU,CAAC,QAAQ,KAAK,GAAG,GAAG,GAAG,IAAI,EAAE,KAAK,IAAI;AAChD,iBAAW,mBAAkB,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,CAAC;AACnE,iBAAW;IACb;AAEA,UAAM,OAAO,IAAI,KAAK,CAAC,OAAO,GAAG,EAAE,MAAM,SAAQ,CAAE;AACnD,UAAM,MAAM,IAAI,gBAAgB,IAAI;AAEpC,UAAM,IAAI,SAAS,cAAc,GAAG;AACpC,MAAE,OAAO;AACT,MAAE,WAAW;AACb,MAAE,MAAK;AAEP,QAAI,gBAAgB,GAAG;EACzB;;;uCAlPW,sBAAmB;IAAA;EAAA;;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;EAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;;;ACWD,IAAM,iBAAgC;EACpC,SAAS;EACT,SAAS;EACT,YAAY;EACZ,OAAO;EACP,eAAe;EACf,WAAW;EACX,aAAa;;AAMT,IAAO,mBAAP,MAAO,kBAAgB;EAH7B,cAAA;AAIU,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAG3B,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACjC,SAAA,YAAY,KAAK,WAAW,WAAU;AAE9B,SAAA,mBAAmB,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;AACnC,SAAA,kBAAkB,KAAK,iBAAiB,WAAU;AAG1C,SAAA,QAAQ,oBAAI,IAAG;AAGf,SAAA,kBAAkB,oBAAI,IAAG;;;;;EAKjC,MAAM,QACJ,SACA,MACA,SAAwB,CAAA,GAAE;AAE1B,UAAM,MAAM,kCAAK,iBAAmB;AACpC,UAAM,WAAW,GAAG,OAAO,IAAI,KAAK,UAAU,IAAI,CAAC;AAGnD,QAAI,IAAI,OAAO;AACb,YAAM,SAAS,KAAK,aAAgB,QAAQ;AAC5C,UAAI,QAAQ;AACV,eAAO,EAAE,SAAS,MAAM,MAAM,OAAM;MACtC;IACF;AAGA,QAAI,KAAK,gBAAgB,IAAI,QAAQ,GAAG;AACtC,aAAO,KAAK,gBAAgB,IAAI,QAAQ;IAC1C;AAGA,UAAM,iBAAiB,KAAK,eAAkB,SAAS,MAAM,KAAK,QAAQ;AAC1E,SAAK,gBAAgB,IAAI,UAAU,cAAc;AAEjD,QAAI;AACF,YAAM,SAAS,MAAM;AACrB,aAAO;IACT;AACE,WAAK,gBAAgB,OAAO,QAAQ;IACtC;EACF;EAEQ,MAAM,eACZ,SACA,MACA,QACA,UAAgB;AAEhB,SAAK,iBAAiB,OAAO,OAAK,IAAI,CAAC;AACvC,QAAI,OAAO,aAAa;AACtB,WAAK,WAAW,IAAI,IAAI;IAC1B;AAEA,QAAI;AAEJ,aAAS,UAAU,GAAG,WAAW,OAAO,SAAU,WAAW;AAC3D,UAAI;AACF,cAAM,SAAS,MAAM,KAAK,eAAkB,SAAS,MAAM,OAAO,OAAQ;AAG1E,YAAI,OAAO,WAAW,OAAO,OAAO;AAClC,eAAK,SAAS,UAAU,OAAO,MAAM,OAAO,aAAc;QAC5D;AAEA,eAAO;MACT,SAAS,OAAY;AACnB,oBAAY;AAGZ,YAAI,UAAU,OAAO,SAAU;AAC7B,gBAAM,KAAK,MAAM,OAAO,cAAe,UAAU,EAAE;QACrD;MACF;IACF;AAGA,UAAM,gBAAgC;MACpC,SAAS;MACT,OAAO;QACL,MAAM;QACN,SAAS,WAAW,WAAW;QAC/B,SAAS;;;AAIb,QAAI,OAAO,WAAW;AACpB,WAAK,MAAM,MAAM,cAAc,MAAO,OAAO;IAC/C;AAEA,WAAO;EACT;EAEQ,eACN,SACA,MACA,SAAe;AAEf,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAU;AACrC,YAAM,YAAY,WAAW,MAAK;AAChC,eAAO,IAAI,MAAM,0BAAM,CAAC;MAC1B,GAAG,OAAO;AAEV,WAAK,IAAI,OAAO,SAAS,IAAI,EAC1B,KAAK,CAAC,WAAe;AACpB,qBAAa,SAAS;AAGtB,YAAI,OAAO,WAAW,YAAY,aAAa,QAAQ;AACrD,kBAAQ,MAAwB;QAClC,OAAO;AACL,kBAAQ,EAAE,SAAS,MAAM,MAAM,OAAW,CAAE;QAC9C;MACF,CAAC,EACA,MAAM,CAAC,UAAc;AACpB,qBAAa,SAAS;AACtB,eAAO,KAAK;MACd,CAAC,EACA,QAAQ,MAAK;AACZ,aAAK,iBAAiB,OAAO,OAAK,KAAK,IAAI,GAAG,IAAI,CAAC,CAAC;AACpD,YAAI,KAAK,iBAAgB,MAAO,GAAG;AACjC,eAAK,WAAW,IAAI,KAAK;QAC3B;MACF,CAAC;IACL,CAAC;EACH;;EAIQ,aAAgB,KAAW;AACjC,UAAM,OAAO,KAAK,MAAM,IAAI,GAAG;AAC/B,QAAI,CAAC;AAAM,aAAO;AAElB,UAAM,MAAM,KAAK,IAAG;AACpB,QAAI,MAAM,KAAK,YAAY,KAAK,UAAU;AACxC,WAAK,MAAM,OAAO,GAAG;AACrB,aAAO;IACT;AAEA,WAAO,KAAK;EACd;EAEQ,SAAY,KAAa,MAAS,UAAgB;AACxD,SAAK,MAAM,IAAI,KAAK;MAClB;MACA,WAAW,KAAK,IAAG;MACnB;KACD;EACH;;;;EAKA,WAAW,SAAgB;AACzB,QAAI,CAAC,SAAS;AACZ,WAAK,MAAM,MAAK;AAChB;IACF;AAEA,UAAM,QAAQ,IAAI,OAAO,OAAO;AAChC,eAAW,OAAO,KAAK,MAAM,KAAI,GAAI;AACnC,UAAI,MAAM,KAAK,GAAG,GAAG;AACnB,aAAK,MAAM,OAAO,GAAG;MACvB;IACF;EACF;;;;EAKA,MAAM,QAAW,SAAiB,MAAU;AAC1C,UAAM,KAAK,QAAW,SAAS,MAAM,EAAE,OAAO,MAAM,WAAW,MAAK,CAAE;EACxE;;;;;EAOA,MAAM,IAAO,SAAiB,QAAc,QAAsB;AAChE,WAAO,KAAK,QAAW,SAAS,iBAAE,QAAQ,SAAU,SAAU;MAC5D,OAAO;OACJ,OACJ;EACH;;;;EAKA,MAAM,KAAQ,SAAiB,MAAY,QAAsB;AAC/D,WAAO,KAAK,QAAW,SAAS,iBAAE,QAAQ,YAAa,OAAQ;MAC7D,OAAO;OACJ,OACJ;EACH;;;;EAKA,MAAM,IAAO,SAAiB,MAAY,QAAsB;AAC9D,WAAO,KAAK,QAAW,SAAS,iBAAE,QAAQ,YAAa,OAAQ;MAC7D,OAAO;OACJ,OACJ;EACH;;;;EAKA,MAAM,OAAU,SAAiB,QAAc,QAAsB;AACnE,WAAO,KAAK,QAAW,SAAS,iBAAE,QAAQ,YAAa,SAAU;MAC/D,OAAO;OACJ,OACJ;EACH;;EAIQ,MAAM,IAAU;AACtB,WAAO,IAAI,QAAQ,aAAW,WAAW,SAAS,EAAE,CAAC;EACvD;;;uCAtOW,mBAAgB;IAAA;EAAA;;4EAAhB,mBAAgB,SAAhB,kBAAgB,WAAA,YAFf,OAAM,CAAA;EAAA;;;sEAEP,kBAAgB,CAAA;UAH5B;WAAW;MACV,YAAY;KACb;;;;;AChBK,IAAO,kBAAP,MAAO,iBAAe;EA8B1B,cAAA;AA7BQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,QAAQ,OAAO,YAAY;AAG3B,SAAA,SAAS,OAAgC,gBAAc,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAC/D,SAAA,QAAQ,KAAK,OAAO,WAAU;AAE9B,SAAA,cAAc,SAAS,MAAM,KAAK,OAAM,MAAO,aAAW,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAGlD,SAAA,qBAAqB,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,qBAAA,CAAA,IAAA,CAAA,CAAA;AACrC,SAAA,oBAAoB,KAAK,mBAAmB,WAAU;AAG9C,SAAA,iBAAiB,OAAoB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AACjD,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAGtC,SAAA,gBAAgB,oBAAI,IAAG;AAOd,SAAA,qBAAqB;AACrB,SAAA,kBAAkB;AAClB,SAAA,yBAAyB;AAGxC,SAAK,kBAAiB;AACtB,SAAK,QAAO;EACd;EAEA,cAAW;AACT,SAAK,WAAU;EACjB;;;;EAKQ,oBAAiB;AAEvB,SAAK,IAAI,GAAG,iBAAiB,CAAC,YAAkD;AAC9E,WAAK,mBAAmB,QAAQ,MAAM,QAAQ,IAAI;IACpD,CAAC;AAGD,SAAK,IAAI,GAAG,kBAAkB,CAACC,WAAkC;AAC/D,WAAK,OAAO,IAAIA,MAAK;AAErB,UAAIA,WAAU,aAAa;AACzB,aAAK,mBAAmB,IAAI,CAAC;AAC7B,aAAK,eAAc;AACnB,aAAK,eAAc;MACrB,WAAWA,WAAU,gBAAgB;AACnC,aAAK,cAAa;AAClB,aAAK,kBAAiB;MACxB;IACF,CAAC;AAGD,SAAK,IAAI,GAAG,sBAAsB,MAAK;AACrC,WAAK,eAAe,IAAI,oBAAI,KAAI,CAAE;IACpC,CAAC;AAGD,SAAK,IAAI,GAAG,kBAAkB,CAAC,UAA4C;AACzE,cAAQ,MAAM,mBAAmB,KAAK;AACtC,UAAI,MAAM,SAAS,eAAe;AAChC,aAAK,MAAM,MAAM,kDAAU;MAC7B;IACF,CAAC;EACH;;;;EAKA,UAAO;AACL,QAAI,KAAK,OAAM,MAAO,gBAAgB,KAAK,OAAM,MAAO,aAAa;AACnE;IACF;AAEA,SAAK,OAAO,IAAI,YAAY;AAC5B,SAAK,IAAI,KAAK,oBAAoB,CAAA,CAAE;EACtC;;;;EAKA,aAAU;AACR,SAAK,cAAa;AAClB,SAAK,sBAAqB;AAC1B,SAAK,IAAI,KAAK,uBAAuB,CAAA,CAAE;AACvC,SAAK,OAAO,IAAI,cAAc;EAChC;;;;EAKA,UACE,MACA,UACA,SAA6B;AAE7B,UAAM,KAAK,OAAO,KAAK,IAAG,CAAE,IAAI,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAEvE,UAAM,eAA6B;MACjC;MACA;MACA;MACA;;AAGF,SAAK,cAAc,IAAI,IAAI,YAAY;AAGvC,QAAI,KAAK,YAAW,GAAI;AACtB,WAAK,iBAAiB,YAAY;IACpC;AAEA,WAAO;EACT;;;;EAKA,YAAY,gBAAsB;AAChC,UAAM,eAAe,KAAK,cAAc,IAAI,cAAc;AAC1D,QAAI,CAAC;AAAc;AAEnB,SAAK,cAAc,OAAO,cAAc;AAExC,QAAI,KAAK,YAAW,GAAI;AACtB,WAAK,IAAI,KAAK,wBAAwB;QACpC,IAAI;QACJ,MAAM,aAAa;OACpB;IACH;EACF;;;;EAKA,iBAAc;AACZ,eAAW,MAAM,KAAK,cAAc,KAAI,GAAI;AAC1C,WAAK,YAAY,EAAE;IACrB;EACF;;;;EAKQ,iBAAiB,cAA0B;AACjD,SAAK,IAAI,KAAK,sBAAsB;MAClC,IAAI,aAAa;MACjB,MAAM,aAAa;MACnB,QAAQ,aAAa,SAAS;KAC/B;EACH;;;;EAKQ,iBAAc;AACpB,eAAW,gBAAgB,KAAK,cAAc,OAAM,GAAI;AACtD,WAAK,iBAAiB,YAAY;IACpC;EACF;;;;EAKQ,mBAAmB,MAAwB,MAAS;AAC1D,eAAW,gBAAgB,KAAK,cAAc,OAAM,GAAI;AACtD,UAAI,aAAa,SAAS,MAAM;AAE9B,YAAI,aAAa,SAAS,QAAQ;AAChC,gBAAM,SAAS,aAAa,QAAQ;AACpC,cAAI,UAAU;AAEd,qBAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,MAAM,GAAG;AACjD,gBAAI,KAAK,GAAG,MAAM,OAAO;AACvB,wBAAU;AACV;YACF;UACF;AAEA,cAAI,CAAC;AAAS;QAChB;AAGA,YAAI;AACF,uBAAa,SAAS,IAAI;QAC5B,SAAS,OAAO;AACd,kBAAQ,MAAM,gCAAgC,KAAK;QACrD;MACF;IACF;EACF;;;;EAKQ,iBAAc;AACpB,SAAK,cAAa;AAElB,SAAK,oBAAoB,YAAY,MAAK;AACxC,UAAI,KAAK,YAAW,GAAI;AACtB,aAAK,IAAI,KAAK,sBAAsB,CAAA,CAAE;MACxC;IACF,GAAG,KAAK,kBAAkB;EAC5B;;;;EAKQ,gBAAa;AACnB,QAAI,KAAK,mBAAmB;AAC1B,oBAAc,KAAK,iBAAiB;AACpC,WAAK,oBAAoB;IAC3B;EACF;;;;EAKQ,oBAAiB;AACvB,QAAI,KAAK,mBAAkB,KAAM,KAAK,wBAAwB;AAC5D,WAAK,MAAM,MAAM,sFAAgB;AACjC;IACF;AAEA,SAAK,sBAAqB;AAE1B,UAAM,QAAQ,KAAK,kBAAkB,KAAK,IAAI,KAAK,KAAK,mBAAkB,CAAE;AAE5E,SAAK,mBAAmB,WAAW,MAAK;AACtC,WAAK,mBAAmB,OAAO,OAAK,IAAI,CAAC;AACzC,WAAK,OAAO,IAAI,cAAc;AAC9B,WAAK,QAAO;IACd,GAAG,KAAK;EACV;;;;EAKQ,wBAAqB;AAC3B,QAAI,KAAK,kBAAkB;AACzB,mBAAa,KAAK,gBAAgB;AAClC,WAAK,mBAAmB;IAC1B;EACF;;;;;EAOA,oBAAoB,QAAgB,UAA8B;AAChE,WAAO,KAAK,UAAU,eAAe,UAAU,EAAE,QAAQ,EAAE,OAAM,EAAE,CAAE;EACvE;;;;EAKA,mBAAmB,QAAgB,UAA8B;AAC/D,WAAO,KAAK,UAAU,cAAc,UAAU,EAAE,QAAQ,EAAE,OAAM,EAAE,CAAE;EACtE;;;;EAKA,kBAAkB,QAAgB,UAA8B;AAC9D,WAAO,KAAK,UAAU,YAAY,UAAU,EAAE,QAAQ,EAAE,OAAM,EAAE,CAAE;EACpE;;;;EAKA,qBAAqB,UAA8B;AACjD,WAAO,KAAK,UAAU,YAAY,QAAQ;EAC5C;;;;EAKA,qBAAqB,UAA8B;AACjD,WAAO,KAAK,UAAU,eAAe,QAAQ;EAC/C;;;;EAKA,sBAAsB,UAA8B;AAClD,WAAO,KAAK,UAAU,iBAAiB,QAAQ;EACjD;;;uCAzSW,kBAAe;IAAA;EAAA;;4EAAf,kBAAe,SAAf,iBAAe,WAAA,YAFd,OAAM,CAAA;EAAA;;;sEAEP,iBAAe,CAAA;UAH3B;WAAW;MACV,YAAY;KACb;;;;;AC8BK,IAAO,uBAAP,MAAO,sBAAoB;EA8E/B,cAAA;AA7EQ,SAAA,MAAM,OAAO,kBAAkB;AAC/B,SAAA,YAAY,OAAO,eAAe;AAGlC,SAAA,gBAAgB,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AACpC,SAAA,eAAe,KAAK,cAAc,WAAU;AAEpC,SAAA,iBAAiB,OAA4B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AACvD,SAAA,gBAAgB,KAAK,eAAe,WAAU;AAEtC,SAAA,kBAAkB,OAA8B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAC1D,SAAA,iBAAiB,KAAK,gBAAgB,WAAU;AAGxC,SAAA,kBAAyC;MAC/C;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,UAAU;QACV,WAAW,CAAC,gBAAgB,eAAe,MAAM;QACjD,UAAU,CAAC,gPAA2C;QACtD,UAAU;;MAEZ;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,UAAU;QACV,WAAW,CAAC,gBAAgB,WAAW,MAAM;QAC7C,UAAU,CAAC,yOAA2C;QACtD,UAAU;;MAEZ;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,UAAU;QACV,WAAW,CAAC,SAAS;QACrB,UAAU,CAAC,iaAAwE;QACnF,UAAU;;MAEZ;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,UAAU;QACV,WAAW,CAAC,aAAa,UAAU;QACnC,UAAU,CAAC,0QAA8C;QACzD,UAAU;;MAEZ;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,UAAU;QACV,WAAW,CAAC,gBAAgB,OAAO;QACnC,UAAU,CAAC,6RAAkD;QAC7D,UAAU;;MAEZ;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,UAAU;QACV,WAAW,CAAC,gBAAgB,YAAY;QACxC,UAAU,CAAC,kVAA0D;QACrE,UAAU;;;AAKZ,SAAK,mBAAkB;EACzB;;;;EAKA,MAAM,SAAS,SAA2B;AACxC,SAAK,cAAc,IAAI,IAAI;AAE3B,QAAI;AACF,YAAM,QAAQ,QAAQ,SAAS,SAAS;AACxC,YAAM,UAA+B,CAAA;AAGrC,YAAM,SAAS,KAAK,YAAY,OAAO;AAGvC,YAAM,WAAW,MAAM,KAAK,IAAI,OAAO,oBAAoB;QACzD;QACA,WAAW,QAAQ,SAAS,aAAa;QACzC;OACD;AAED,UAAI,SAAS,WAAW,SAAS,OAAO;AACtC,mBAAW,QAAQ,SAAS,OAAO;AACjC,gBAAM,SAA4B;YAChC,IAAI,QAAQ,KAAK,IAAG,CAAE,IAAI,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;YACjE,MAAM,KAAK,YAAY,MAAM,OAAO;YACpC,MAAM,QAAQ;YACd,OAAO,QAAQ,SAAS;YACxB,OAAO,KAAK,gBAAgB,MAAM,OAAO;YACzC,MAAM,KAAK,YAAY,OAAO;YAC9B,YAAW,oBAAI,KAAI,GAAG,YAAW;;AAEnC,kBAAQ,KAAK,MAAM;QACrB;AAGA,aAAK,eAAe,OAAO,OAAK,CAAC,GAAG,SAAS,GAAG,CAAC,EAAE,MAAM,GAAG,EAAE,CAAC;MACjE,OAAO;AAEL,cAAM,YAAY,KAAK,oBAAoB,QAAQ,IAAI;AACvD,mBAAW,YAAY,UAAU,MAAM,GAAG,KAAK,GAAG;AAChD,gBAAM,SAA4B;YAChC,IAAI,QAAQ,KAAK,IAAG,CAAE,IAAI,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;YACjE,MAAM,KAAK,cAAc,UAAU,QAAQ,WAAW,CAAA,CAAE;YACxD,MAAM,QAAQ;YACd,OAAO,SAAS;YAChB,OAAO;YACP,MAAM,CAAC,cAAI;YACX,YAAW,oBAAI,KAAI,GAAG,YAAW;;AAEnC,kBAAQ,KAAK,MAAM;QACrB;MACF;AAEA,aAAO;IACT;AACE,WAAK,cAAc,IAAI,KAAK;IAC9B;EACF;;;;EAKA,MAAM,SAAS,MAAcC,QAAuB;AAClD,SAAK,cAAc,IAAI,IAAI;AAE3B,QAAI;AACF,YAAM,SAAS,yDAAY,KAAK,oBAAoBA,MAAK,CAAC;;oBAE3D,IAAI;;;AAIH,YAAM,WAAW,MAAM,KAAK,IAAI,OAAO,oBAAoB;QACzD;QACA,WAAW;QACX,OAAO;OACR;AAED,UAAI,SAAS,WAAW,SAAS,QAAQ,CAAC,GAAG;AAC3C,eAAO,SAAS,MAAM,CAAC;MACzB;AAEA,aAAO;IACT;AACE,WAAK,cAAc,IAAI,KAAK;IAC9B;EACF;;;;EAKA,MAAM,aACJ,iBACA,SAIC;AAED,WAAO,KAAK,SAAS;MACnB,MAAM;MACN,OAAO;MACP,SAAS;QACP,kBAAkB,CAAC,iBAAiB,GAAI,SAAS,oBAAoB,CAAA,CAAG;;MAE1E,SAAS;QACP,OAAO;;KAEV;EACH;;;;;EAOA,kBAAe;AACb,WAAO,CAAC,GAAG,KAAK,iBAAiB,GAAG,KAAK,gBAAe,CAAE;EAC5D;;;;EAKA,oBAAoB,MAAqB;AACvC,WAAO,KAAK,gBAAe,EAAG,OAAO,OAAK,EAAE,SAAS,IAAI;EAC3D;;;;EAKA,aAAa,UAAsD;AACjE,UAAM,cAAmC,iCACpC,WADoC;MAEvC,IAAI,OAAO,KAAK,IAAG,CAAE;MACrB,UAAU;;AAGZ,SAAK,gBAAgB,OAAO,OAAK,CAAC,GAAG,GAAG,WAAW,CAAC;AACpD,SAAK,iBAAgB;EACvB;;;;EAKA,eAAe,IAAU;AACvB,SAAK,gBAAgB,OAAO,OAAK,EAAE,OAAO,OAAK,EAAE,OAAO,EAAE,CAAC;AAC3D,SAAK,iBAAgB;EACvB;;;;EAKA,cAAc,UAA+B,WAA8B;AACzE,QAAI,SAAS,SAAS;AAEtB,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,SAAS,GAAG;AACpD,eAAS,OAAO,QAAQ,IAAI,OAAO,IAAI,GAAG,KAAK,GAAG,GAAG,SAAS,EAAE;IAClE;AAGA,aAAS,OAAO,QAAQ,cAAc,EAAE;AAExC,WAAO,OAAO,KAAI;EACpB;;EAIQ,YAAY,SAA2B;AAC7C,UAAM,cAA+C;MACnD,UAAU;MACV,OAAO;MACP,WAAW;MACX,WAAW;MACX,SAAS;MACT,WAAW;;AAGb,UAAM,YAAY,QAAQ,QAAQ,iCAAQ,KAAK,oBAAoB,QAAQ,KAAK,CAAC,KAAK;AAEtF,QAAI,SAAS,iFAAgB,YAAY,QAAQ,IAAI,CAAC;;EAExD,SAAS;;;AAIP,QAAI,QAAQ,SAAS,aAAa;AAChC,gBAAU,kCAAS,QAAQ,QAAQ,WAAW;;IAChD;AAEA,QAAI,QAAQ,SAAS,cAAc;AACjC,gBAAU,iCAAQ,QAAQ,QAAQ,YAAY;;IAChD;AAEA,QAAI,QAAQ,SAAS,kBAAkB,QAAQ;AAC7C,gBAAU;;EAAa,QAAQ,QAAQ,iBAAiB,KAAK,IAAI,CAAC;;IACpE;AAEA,QAAI,QAAQ,SAAS,WAAW;AAC9B,gBAAU;gCAAU,QAAQ,QAAQ,SAAS;;IAC/C;AAEA,QAAI,QAAQ,SAAS,MAAM;AACzB,gBAAU;oBAAQ,QAAQ,QAAQ,IAAI;;IACxC;AAEA,cAAU;;;;;EAIZ,QAAQ,SAAS,eAAe,wDAAgB,EAAE;;;AAIhD,WAAO;EACT;EAEQ,oBAAoBA,QAAuB;AACjD,UAAM,eAAiD;MACrD,cAAc;MACd,UAAU;MACV,QAAQ;MACR,QAAQ;MACR,YAAY;;AAEd,WAAO,aAAaA,MAAK;EAC3B;EAEQ,YAAY,MAAc,SAA2B;AAC3D,QAAI,SAAS,KAAK,KAAI;AAGtB,QAAI,OAAO,WAAW,GAAG,KAAK,OAAO,SAAS,GAAG,GAAG;AAClD,eAAS,OAAO,MAAM,GAAG,EAAE;IAC7B;AAGA,QAAI,QAAQ,SAAS,cAAc;AACjC,eAAS,OAAO,QAAQ,qBAAqB,QAAQ,QAAQ,YAAY;IAC3E;AACA,QAAI,QAAQ,SAAS,aAAa;AAChC,eAAS,OAAO,QAAQ,oBAAoB,QAAQ,QAAQ,WAAW;IACzE;AAEA,WAAO;EACT;EAEQ,gBAAgB,MAAc,SAA2B;AAC/D,QAAI,QAAQ;AAGZ,QAAI,KAAK,UAAU,MAAM,KAAK,UAAU;AAAK,eAAS;AAGtD,QAAI,QAAQ,SAAS,gBAAgB,yBAAyB,KAAK,IAAI,GAAG;AACxE,eAAS;IACX;AAGA,QAAI,KAAK,SAAS,QAAG,KAAK,KAAK,SAAS,GAAG;AAAG,eAAS;AAGvD,QAAI,QAAQ,SAAS,gBAAgB,KAAK,SAAS,QAAQ,QAAQ,YAAY,GAAG;AAChF,eAAS;IACX;AAEA,WAAO,KAAK,IAAI,KAAK,KAAK;EAC5B;EAEQ,YAAY,SAA2B;AAC7C,UAAM,OAAiB,CAAC,QAAQ,IAAI;AAEpC,QAAI,QAAQ;AAAO,WAAK,KAAK,QAAQ,KAAK;AAC1C,QAAI,QAAQ,SAAS;AAAc,WAAK,KAAK,OAAO;AACpD,QAAI,QAAQ,SAAS;AAAa,WAAK,KAAK,0BAAM;AAElD,WAAO;EACT;EAEQ,qBAAkB;AACxB,QAAI;AACF,YAAM,QAAQ,aAAa,QAAQ,uBAAuB;AAC1D,UAAI,OAAO;AACT,aAAK,gBAAgB,IAAI,KAAK,MAAM,KAAK,CAAC;MAC5C;IACF,SAAS,GAAG;AACV,cAAQ,MAAM,6BAA6B,CAAC;IAC9C;EACF;EAEQ,mBAAgB;AACtB,iBAAa,QAAQ,yBAAyB,KAAK,UAAU,KAAK,gBAAe,CAAE,CAAC;EACtF;;;uCArXW,uBAAoB;IAAA;EAAA;;4EAApB,uBAAoB,SAApB,sBAAoB,WAAA,YAFnB,OAAM,CAAA;EAAA;;;sEAEP,sBAAoB,CAAA;UAHhC;WAAW;MACV,YAAY;KACb;;;;;AC1BK,IAAO,oBAAP,MAAO,mBAAiB;EAkK5B,cAAA;AA/JQ,SAAA,YAAY,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAChC,SAAA,WAAW,KAAK,UAAU,WAAU;AAE5B,SAAA,eAAe,OAA8B,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,eAAA,CAAA,IAAA,CAAA,CAAA;AACzD,SAAA,cAAc,KAAK,aAAa,WAAU;AAElC,SAAA,oBAAoB,OAAO,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,oBAAA,CAAA,IAAA,CAAA,CAAA;AACpC,SAAA,mBAAmB,KAAK,kBAAkB,WAAU;AAE5C,SAAA,YAAY,OAAwC,oBAAI,IAAG,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;AAGrE,SAAA,cAAc,SAAS,MAAK;AAC1B,YAAM,OAAO,KAAK,aAAY;AAC9B,YAAM,QAAQ,KAAK,kBAAiB;AACpC,aAAO,MAAM,MAAM,KAAK,KAAK;IAC/B,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,aAAa,SAAS,MAAM,KAAK,aAAY,GAAI,MAAM,UAAU,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AAElE,SAAA,kBAAkB,SAAS,MAAK;AAC9B,YAAM,QAAQ,KAAK,WAAU;AAC7B,UAAI,UAAU;AAAG,eAAO;AACxB,aAAO,KAAK,MAAO,KAAK,kBAAiB,IAAK,QAAS,GAAG;IAC5D,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,kBAAA,CAAA,IAAA,CAAA,CAAA;AAGO,SAAA,QAA0B;MAChC;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,SAAS;QACT,SAAS;QACT,OAAO;UACL;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,UAAU;YACV,UAAU;;UAEZ;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;YACV,aAAa;;UAEf;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;YACV,aAAa;;UAEf;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;YACV,aAAa;;UAEf;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;YACV,aAAa;;UAEf;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,UAAU;YACV,aAAa;;;;MAInB;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,SAAS;QACT,SAAS;QACT,OAAO;UACL;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;UAEZ;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;UAEZ;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;UAEZ;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;;;MAIhB;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,SAAS;QACT,SAAS;QACT,OAAO;UACL;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;UAEZ;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;UAEZ;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;UAEZ;YACE,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,UAAU;;;;;AAOhB,SAAK,aAAY;AACjB,SAAK,eAAc;EACrB;;;;;EAOA,UAAU,QAAc;AACtB,UAAM,OAAO,KAAK,MAAM,KAAK,OAAK,EAAE,OAAO,MAAM;AACjD,QAAI,CAAC;AAAM;AAEX,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,kBAAkB,IAAI,CAAC;AAC5B,SAAK,UAAU,IAAI,IAAI;AAEvB,UAAM,OAAO,KAAK,MAAM,CAAC;AACzB,SAAK,aAAY;AAEjB,SAAK,gBAAgB,KAAK,MAAM;EAClC;;;;EAKA,WAAQ;AACN,UAAM,OAAO,KAAK,aAAY;AAC9B,QAAI,CAAC;AAAM;AAEX,UAAM,cAAc,KAAK,YAAW;AACpC,iBAAa,gBAAe;AAE5B,UAAM,YAAY,KAAK,kBAAiB,IAAK;AAE7C,QAAI,aAAa,KAAK,MAAM,QAAQ;AAClC,WAAK,aAAY;IACnB,OAAO;AACL,WAAK,kBAAkB,IAAI,SAAS;AACpC,YAAM,OAAO,KAAK,MAAM,SAAS;AACjC,WAAK,aAAY;AACjB,WAAK,gBAAgB,KAAK,MAAM;IAClC;EACF;;;;EAKA,WAAQ;AACN,UAAM,YAAY,KAAK,kBAAiB,IAAK;AAC7C,QAAI,YAAY;AAAG;AAEnB,SAAK,kBAAkB,IAAI,SAAS;AACpC,UAAM,OAAO,KAAK,aAAY,GAAI,MAAM,SAAS;AACjD,QAAI,MAAM;AACR,WAAK,aAAY;AACjB,WAAK,gBAAgB,KAAK,MAAM;IAClC;EACF;;;;EAKA,SAAS,OAAa;AACpB,UAAM,OAAO,KAAK,aAAY;AAC9B,QAAI,CAAC,QAAQ,QAAQ,KAAK,SAAS,KAAK,MAAM;AAAQ;AAEtD,SAAK,kBAAkB,IAAI,KAAK;AAChC,UAAM,OAAO,KAAK,MAAM,KAAK;AAC7B,SAAK,aAAY;AACjB,SAAK,gBAAgB,KAAK,MAAM;EAClC;;;;EAKA,WAAQ;AACN,UAAM,OAAO,KAAK,aAAY;AAC9B,QAAI,CAAC;AAAM;AAEX,SAAK,eAAe,KAAK,IAAI;MAC3B,QAAQ,KAAK;MACb,aAAa,KAAK,kBAAiB;MACnC,WAAW;MACX,SAAS;MACT,SAAS,KAAK;KACf;AAED,SAAK,UAAS;EAChB;;;;EAKA,eAAY;AACV,UAAM,OAAO,KAAK,aAAY;AAC9B,QAAI,CAAC;AAAM;AAEX,SAAK,eAAe,KAAK,IAAI;MAC3B,QAAQ,KAAK;MACb,aAAa,KAAK,MAAM;MACxB,WAAW;MACX,SAAS;MACT,cAAa,oBAAI,KAAI,GAAG,YAAW;MACnC,SAAS,KAAK;KACf;AAED,SAAK,UAAS;EAChB;;;;EAKA,YAAS;AACP,SAAK,eAAc;AACnB,SAAK,UAAU,IAAI,KAAK;AACxB,SAAK,aAAa,IAAI,IAAI;AAC1B,SAAK,kBAAkB,IAAI,CAAC;EAC9B;;;;;EAOA,YAAY,QAAc;AACxB,UAAM,WAAW,KAAK,UAAS,EAAG,IAAI,MAAM;AAC5C,WAAO,UAAU,aAAa;EAChC;;;;EAKA,UAAU,QAAc;AACtB,SAAK,UAAU,OAAO,OAAI;AACxB,YAAM,SAAS,IAAI,IAAI,CAAC;AACxB,aAAO,OAAO,MAAM;AACpB,aAAO;IACT,CAAC;AACD,SAAK,aAAY;EACnB;;;;EAKA,WAAQ;AACN,SAAK,UAAU,IAAI,oBAAI,IAAG,CAAE;AAC5B,SAAK,aAAY;EACnB;;;;EAKA,oBAAiB;AACf,WAAO,KAAK;EACd;;EAIQ,iBAAc;AAEpB,eAAW,QAAQ,KAAK,OAAO;AAC7B,UAAI,KAAK,YAAY;AAAe;AAEpC,YAAM,WAAW,KAAK,UAAS,EAAG,IAAI,KAAK,EAAE;AAG7C,UAAI,CAAC,YAAa,SAAS,YAAY,KAAK,WAAW,CAAC,SAAS,WAAY;AAC3E,mBAAW,MAAM,KAAK,UAAU,KAAK,EAAE,GAAG,GAAI;AAC9C;MACF;IACF;EACF;EAEQ,eAAe,QAAgB,UAA4B;AACjE,SAAK,UAAU,OAAO,OAAI;AACxB,YAAM,SAAS,IAAI,IAAI,CAAC;AACxB,aAAO,IAAI,QAAQ,QAAQ;AAC3B,aAAO;IACT,CAAC;AACD,SAAK,aAAY;EACnB;EAEQ,gBAAgB,UAAiB;AACvC,SAAK,eAAc;AAEnB,QAAI,CAAC;AAAU;AAEf,UAAM,UAAU,SAAS,cAAc,QAAQ;AAC/C,QAAI,SAAS;AACX,cAAQ,UAAU,IAAI,sBAAsB;AAC5C,cAAQ,eAAe,EAAE,UAAU,UAAU,OAAO,SAAQ,CAAE;IAChE;EACF;EAEQ,iBAAc;AACpB,aAAS,iBAAiB,uBAAuB,EAAE,QAAQ,QAAK;AAC9D,SAAG,UAAU,OAAO,sBAAsB;IAC5C,CAAC;EACH;EAEQ,eAAY;AAClB,QAAI;AACF,YAAM,QAAQ,aAAa,QAAQ,qBAAqB;AACxD,UAAI,OAAO;AACT,cAAM,OAAO,KAAK,MAAM,KAAK;AAC7B,aAAK,UAAU,IAAI,IAAI,IAAI,OAAO,QAAQ,IAAI,CAAC,CAAC;MAClD;IACF,SAAS,GAAG;AACV,cAAQ,MAAM,uCAAuC,CAAC;IACxD;EACF;EAEQ,eAAY;AAClB,UAAM,OAAO,OAAO,YAAY,KAAK,UAAS,CAAE;AAChD,iBAAa,QAAQ,uBAAuB,KAAK,UAAU,IAAI,CAAC;EAClE;;;uCA3XW,oBAAiB;IAAA;EAAA;;4EAAjB,oBAAiB,SAAjB,mBAAiB,WAAA,YAFhB,OAAM,CAAA;EAAA;;;sEAEP,mBAAiB,CAAA;UAH7B;WAAW;MACV,YAAY;KACb;;;;;ACTD,IAAM,aAA0B;EAC9B,SAAS;;EACT,WAAW;;EACX,QAAQ;;EACR,YAAY;;EACZ,SAAS;;EACT,MAAM;;EACN,WAAW;;EACX,QAAQ;;EACR,SAAS;;EACT,SAAS;;EACT,OAAO;;;AAIT,IAAM,cAA2B;EAC/B,SAAS;;EACT,WAAW;;EACX,QAAQ;;EACR,YAAY;;EACZ,SAAS;;EACT,MAAM;;EACN,WAAW;;EACX,QAAQ;;EACR,SAAS;;EACT,SAAS;;EACT,OAAO;;;AAIT,IAAM,gBAA+B;EACnC;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,QAAQ,CAAA;;EAEV;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,QAAQ,CAAA;;EAEV;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,QAAQ;MACN,SAAS;MACT,WAAW;MACX,YAAY;MACZ,SAAS;;;EAGb;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,QAAQ;MACN,SAAS;MACT,WAAW;MACX,QAAQ;MACR,YAAY;MACZ,SAAS;;;EAGb;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,QAAQ;MACN,SAAS;MACT,WAAW;MACX,QAAQ;MACR,YAAY;MACZ,SAAS;;;EAGb;IACE,IAAI;IACJ,MAAM;IACN,MAAM;IACN,QAAQ;MACN,SAAS;MACT,WAAW;MACX,YAAY;MACZ,SAAS;;;;AAQT,IAAO,eAAP,MAAO,cAAY;EAmCvB,cAAA;AAhCQ,SAAA,QAAQ,OAAkB,QAAM,GAAA,YAAA,CAAA,EAAA,WAAA,QAAA,CAAA,IAAA,CAAA,CAAA;AACxC,SAAA,OAAO,KAAK,MAAM,WAAU;AAEpB,SAAA,gBAAgB,OAAe,gBAAc,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AACrD,SAAA,eAAe,KAAK,cAAc,WAAU;AAEpC,SAAA,gBAAgB,OAA6B,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AACvD,SAAA,eAAe,KAAK,cAAc,WAAU;AAG5C,SAAA,SAAS,SAAS,MAAK;AACrB,YAAM,OAAO,KAAK,MAAK;AACvB,UAAI,SAAS,UAAU;AACrB,eAAO,KAAK,oBAAmB,MAAO;MACxC;AACA,aAAO,SAAS;IAClB,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,gBAAgB,SAAsB,MAAK;AACzC,YAAM,aAAa,KAAK,OAAM,IAAK,aAAa;AAChD,YAAM,eAAe,KAAK,gBAAe;AACzC,YAAM,eAAe,KAAK,cAAa;AAEvC,aAAO,iDACF,aACA,eACA;IAEP,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;AAED,SAAA,UAAU,SAAS,MAAM,eAAa,GAAA,YAAA,CAAA,EAAA,WAAA,UAAA,CAAA,IAAA,CAAA,CAAA;AAGpC,SAAK,aAAY;AACjB,SAAK,oBAAmB;AAGxB,WAAO,MAAK;AACV,WAAK,WAAU;IACjB,CAAC;EACH;;;;EAKA,QAAQ,MAAe;AACrB,SAAK,MAAM,IAAI,IAAI;AACnB,SAAK,aAAY;EACnB;;;;EAKA,SAAM;AACJ,UAAM,UAAU,KAAK,MAAK;AAC1B,QAAI,YAAY,UAAU;AACxB,WAAK,MAAM,IAAI,KAAK,OAAM,IAAK,UAAU,MAAM;IACjD,OAAO;AACL,WAAK,MAAM,IAAI,YAAY,SAAS,UAAU,MAAM;IACtD;AACA,SAAK,aAAY;EACnB;;;;EAKA,YAAY,UAAgB;AAC1B,UAAM,SAAS,cAAc,KAAK,OAAK,EAAE,OAAO,QAAQ;AACxD,QAAI,CAAC;AAAQ;AAEb,SAAK,cAAc,IAAI,QAAQ;AAC/B,SAAK,MAAM,IAAI,OAAO,IAAI;AAC1B,SAAK,cAAc,IAAI,CAAA,CAAE;AACzB,SAAK,aAAY;EACnB;;;;EAKA,eAAe,KAAwB,OAAa;AAClD,SAAK,cAAc,OAAO,CAAAC,YAAW,iCAChCA,UADgC;MAEnC,CAAC,GAAG,GAAG;MACP;AACF,SAAK,aAAY;EACnB;;;;EAKA,oBAAiB;AACf,SAAK,cAAc,IAAI,CAAA,CAAE;AACzB,SAAK,aAAY;EACnB;;;;EAKA,kBAAe;AACb,UAAMA,UAAS,KAAK,cAAa;AACjC,WAAO,OAAO,QAAQA,OAAM,EACzB,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,WAAW,KAAK,aAAa,GAAG,CAAC,KAAK,KAAK,GAAG,EACpE,KAAK,IAAI;EACd;;EAIQ,kBAAe;AACrB,UAAM,SAAS,cAAc,KAAK,OAAK,EAAE,OAAO,KAAK,cAAa,CAAE;AACpE,WAAO,QAAQ,UAAU,CAAA;EAC3B;EAEQ,sBAAmB;AACzB,QAAI,OAAO,aAAa,8BAA8B,EAAE,SAAS;AAC/D,aAAO;IACT;AACA,WAAO;EACT;EAEQ,sBAAmB;AACzB,WAAO,aAAa,8BAA8B,EAC/C,iBAAiB,UAAU,MAAK;AAC/B,UAAI,KAAK,MAAK,MAAO,UAAU;AAC7B,aAAK,WAAU;MACjB;IACF,CAAC;EACL;EAEQ,aAAU;AAChB,UAAM,OAAO,SAAS;AACtB,UAAMA,UAAS,KAAK,cAAa;AAGjC,QAAI,KAAK,OAAM,GAAI;AACjB,WAAK,UAAU,IAAI,MAAM;AACzB,WAAK,UAAU,OAAO,OAAO;IAC/B,OAAO;AACL,WAAK,UAAU,IAAI,OAAO;AAC1B,WAAK,UAAU,OAAO,MAAM;IAC9B;AAGA,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQA,OAAM,GAAG;AACjD,WAAK,MAAM,YAAY,WAAW,KAAK,aAAa,GAAG,CAAC,IAAI,KAAK;IACnE;AAGA,UAAM,YAAY,SAAS,cAAc,0BAA0B;AACnE,QAAI,WAAW;AACb,gBAAU,aAAa,WAAWA,QAAO,UAAU;IACrD;EACF;EAEQ,aAAa,KAAW;AAC9B,WAAO,IAAI,QAAQ,mBAAmB,OAAO,EAAE,YAAW;EAC5D;EAEQ,eAAY;AAClB,QAAI;AACF,YAAM,QAAQ,aAAa,QAAQ,gBAAgB;AACnD,UAAI,OAAO;AACT,cAAM,WAAW,KAAK,MAAM,KAAK;AACjC,aAAK,MAAM,IAAI,SAAS,QAAQ,MAAM;AACtC,aAAK,cAAc,IAAI,SAAS,UAAU,cAAc;AACxD,aAAK,cAAc,IAAI,SAAS,gBAAgB,CAAA,CAAE;MACpD;IACF,SAAS,GAAG;AACV,cAAQ,MAAM,kCAAkC,CAAC;IACnD;EACF;EAEQ,eAAY;AAClB,iBAAa,QAAQ,kBAAkB,KAAK,UAAU;MACpD,MAAM,KAAK,MAAK;MAChB,QAAQ,KAAK,cAAa;MAC1B,cAAc,KAAK,cAAa;KACjC,CAAC;EACJ;;;uCApLW,eAAY;IAAA;EAAA;;4EAAZ,eAAY,SAAZ,cAAY,WAAA,YAFX,OAAM,CAAA;EAAA;;;sEAEP,cAAY,CAAA;UAHxB;WAAW;MACV,YAAY;KACb;;;","names":["group","AnimationMetadataType","animation","animation","query","state","query","state","group","LogLevel","colors","colors","colors","group","queue","group","query","query","query","query","state","style","colors"],"x_google_ignoreList":[1,2]}