{
  "version": 3,
  "sources": ["src/models/marketing-task.models.ts", "src/services/marketing-task.service.ts", "src/ai-center/ai-center.models.ts", "src/ai-center/ai-center.service.ts", "src/services/marketing-state.service.ts"],
  "sourcesContent": ["/**\r\n * çµ±ä¸€ç‡ŸéŠ·ä»»å‹™æ•¸æ“šæ¨¡å‹\r\n * Unified Marketing Task Data Models\r\n * \r\n * ğŸ†• Phase 2-1: çµ±ä¸€æ•¸æ“šæ¨¡å‹\r\n * \r\n * æ•´åˆå¤šè§’è‰²å”ä½œå’ŒAIä¸­å¿ƒçš„åŠŸèƒ½ï¼Œæä¾›çµ±ä¸€çš„ä»»å‹™ç®¡ç†\r\n * \r\n * æ•¸æ“šé—œä¿‚ï¼š\r\n * - MarketingTask æ˜¯æ ¸å¿ƒå¯¦é«”ï¼Œä»£è¡¨ä¸€å€‹ç‡ŸéŠ·ä»»å‹™\r\n * - MarketingTask å¯ä»¥å¼•ç”¨ CollaborationGroupï¼ˆå¤šè§’è‰²å”ä½œç¾¤çµ„ï¼‰\r\n * - MarketingTask å¯ä»¥å¼•ç”¨ RoleDefinitionï¼ˆè§’è‰²è³‡æºåº«ï¼‰\r\n * - MarketingTask å¯ä»¥å¼•ç”¨ ScriptTemplateï¼ˆåŠ‡æœ¬æ¨¡æ¿ï¼‰\r\n */\r\n\r\n// ğŸ†• å°å…¥å¤šè§’è‰²æ¨¡å‹é¡å‹ï¼ˆç”¨æ–¼é¡å‹å…¼å®¹ï¼‰\r\nimport type { RoleType, CollaborationGroup as LegacyCollaborationGroup } from '../multi-role/multi-role.models';\r\n\r\n// ä»»å‹™ç›®æ¨™é¡å‹\r\nexport type GoalType = \r\n  | 'conversion'    // ä¿ƒé€²æˆäº¤\r\n  | 'retention'     // æŒ½å›æµå¤±\r\n  | 'engagement'    // ç¤¾ç¾¤æ´»èº\r\n  | 'support';      // å”®å¾Œæœå‹™\r\n\r\n// åŸ·è¡Œæ¨¡å¼\r\nexport type ExecutionMode = \r\n  | 'scripted'      // åŠ‡æœ¬æ¨¡å¼ï¼šæŒ‰é è¨­æµç¨‹åŸ·è¡Œ\r\n  | 'hybrid'        // æ··åˆæ¨¡å¼ï¼šé—œéµç¯€é»é è¨­ + AIå³èˆˆ\r\n  | 'scriptless';   // ç„¡åŠ‡æœ¬æ¨¡å¼ï¼šAIå®Œå…¨è‡ªä¸»\r\n\r\n// ä»»å‹™ç‹€æ…‹\r\nexport type TaskStatus = \r\n  | 'draft'         // è‰ç¨¿\r\n  | 'scheduled'     // å·²è¨ˆåŠƒ\r\n  | 'running'       // åŸ·è¡Œä¸­\r\n  | 'paused'        // å·²æš«åœ\r\n  | 'completed'     // å·²å®Œæˆ\r\n  | 'failed';       // å¤±æ•—\r\n\r\n// ç›®æ¨™ç”¨æˆ¶ç‹€æ…‹\r\nexport type TargetStatus = \r\n  | 'pending'       // å¾…è™•ç†\r\n  | 'contacted'     // å·²æ¥è§¸\r\n  | 'replied'       // å·²å›è¦†\r\n  | 'converted'     // å·²è½‰åŒ–\r\n  | 'failed';       // å¤±æ•—\r\n\r\n// çµæœé¡å‹\r\nexport type TaskOutcome = \r\n  | 'converted'     // æˆåŠŸè½‰åŒ–\r\n  | 'rejected'      // è¢«æ‹’çµ•\r\n  | 'no_response'   // ç„¡å›æ‡‰\r\n  | 'pending';      // å¾…å®š\r\n\r\n// è§’è‰²é¡å‹ï¼ˆçµ±ä¸€å®šç¾©ï¼‰\r\nexport type UnifiedRoleType = \r\n  | 'expert'              // ç”¢å“å°ˆå®¶\r\n  | 'satisfied_customer'  // æ»¿æ„è€å®¢æˆ¶\r\n  | 'support'             // å®¢æœåŠ©ç†\r\n  | 'manager'             // ç¶“ç†\r\n  | 'newbie'              // å¥½å¥‡æ–°äºº\r\n  | 'hesitant'            // çŒ¶è±«è€…\r\n  | 'sales'               // éŠ·å”®\r\n  | 'callback'            // å›è¨ªå°ˆå“¡\r\n  | 'custom';             // è‡ªå®šç¾©\r\n\r\n// ============ æ ¸å¿ƒæ•¸æ“šçµæ§‹ ============\r\n\r\n/**\r\n * çµ±ä¸€ç‡ŸéŠ·ä»»å‹™\r\n */\r\nexport interface MarketingTask {\r\n  id: string;\r\n  \r\n  // åŸºæœ¬ä¿¡æ¯\r\n  name: string;\r\n  description?: string;\r\n  goalType: GoalType;\r\n  \r\n  // AI é…ç½®\r\n  aiConfigId?: string;\r\n  executionMode: ExecutionMode;\r\n  \r\n  // ç‹€æ…‹\r\n  status: TaskStatus;\r\n  currentStage?: string;\r\n  \r\n  // ç›®æ¨™é…ç½®\r\n  targetCount: number;\r\n  targetCriteria?: TargetCriteria;\r\n  \r\n  // è§’è‰²é…ç½®\r\n  roleConfig?: RoleConfig[];\r\n  scriptId?: string;\r\n  \r\n  // åŸ·è¡Œé…ç½®\r\n  scheduleConfig?: ScheduleConfig;\r\n  triggerConditions?: TriggerConditions;\r\n  \r\n  // çµ±è¨ˆæŒ‡æ¨™\r\n  stats: TaskStats;\r\n  \r\n  // æ™‚é–“æˆ³\r\n  createdAt: string;\r\n  startedAt?: string;\r\n  completedAt?: string;\r\n  updatedAt: string;\r\n  \r\n  // å‰µå»ºè€…\r\n  createdBy?: string;\r\n  \r\n  // ============ ğŸ†• Phase 2-1: æ•´åˆèˆŠæ¨¡å‹ ============\r\n  \r\n  // é—œè¯çš„å”ä½œç¾¤çµ„ IDï¼ˆå¦‚æœä½¿ç”¨å¤šè§’è‰²å”ä½œï¼‰\r\n  collaborationGroupId?: string;\r\n  \r\n  // é—œè¯çš„åŠ‡æœ¬æ¨¡æ¿ IDï¼ˆä¾†è‡ªè§’è‰²è³‡æºåº«ï¼‰\r\n  scriptTemplateId?: string;\r\n  \r\n  // AI é…ç½®å¿«ç…§ï¼ˆå¾æ™ºèƒ½å¼•æ“è¤‡è£½çš„é…ç½®ï¼‰\r\n  aiSnapshot?: {\r\n    modelId: string;\r\n    knowledgeBaseId?: string;\r\n    personaId?: string;\r\n    temperature?: number;\r\n  };\r\n  \r\n  // èˆŠæ•¸æ“šé·ç§»æ¨™è¨˜\r\n  legacySource?: 'collaboration_group' | 'ai_auto_chat' | 'campaign';\r\n  legacyId?: string;\r\n}\r\n\r\n/**\r\n * ä»»å‹™çµ±è¨ˆ\r\n */\r\nexport interface TaskStats {\r\n  totalContacts: number;    // ç¸½ç›®æ¨™æ•¸\r\n  contacted: number;        // å·²æ¥è§¸\r\n  replied: number;          // å·²å›è¦†\r\n  converted: number;        // å·²è½‰åŒ–\r\n  messagesSent: number;     // ç™¼é€æ¶ˆæ¯æ•¸\r\n  aiCost: number;           // AI æˆæœ¬\r\n  \r\n  // è¨ˆç®—å€¼\r\n  contactRate: number;      // æ¥è§¸ç‡\r\n  replyRate: number;        // å›è¦†ç‡\r\n  conversionRate: number;   // è½‰åŒ–ç‡\r\n}\r\n\r\n/**\r\n * ç›®æ¨™ç”¨æˆ¶ç¯©é¸æ¢ä»¶\r\n */\r\nexport interface TargetCriteria {\r\n  intentScoreMin?: number;\r\n  intentScoreMax?: number;\r\n  tags?: string[];\r\n  sources?: string[];\r\n  excludeContacted?: boolean;\r\n  maxAge?: number;  // æœ€è¿‘Nå¤©å…§\r\n}\r\n\r\n/**\r\n * è§’è‰²é…ç½®\r\n */\r\nexport interface RoleConfig {\r\n  roleType: UnifiedRoleType;\r\n  roleName: string;\r\n  accountId?: number;\r\n  accountPhone?: string;\r\n  personaPrompt?: string;\r\n  speakingStyle?: string;\r\n  entryTiming?: string;  // ä½•æ™‚ä»‹å…¥\r\n}\r\n\r\n/**\r\n * è¨ˆåŠƒä»»å‹™é…ç½®\r\n */\r\nexport interface ScheduleConfig {\r\n  type: 'immediate' | 'scheduled' | 'recurring';\r\n  startTime?: string;\r\n  endTime?: string;\r\n  dailyStartHour?: number;\r\n  dailyEndHour?: number;\r\n  timezone?: string;\r\n}\r\n\r\n/**\r\n * è§¸ç™¼æ¢ä»¶\r\n */\r\nexport interface TriggerConditions {\r\n  intentScoreThreshold?: number;\r\n  minConversationRounds?: number;\r\n  requirePriceInquiry?: boolean;\r\n  keywords?: string[];\r\n}\r\n\r\n/**\r\n * ä»»å‹™ç›®æ¨™ç”¨æˆ¶\r\n */\r\nexport interface TaskTarget {\r\n  id: string;\r\n  taskId: string;\r\n  \r\n  // ç”¨æˆ¶ä¿¡æ¯\r\n  telegramId: string;\r\n  username?: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  \r\n  // ç‹€æ…‹è¿½è¹¤\r\n  status: TargetStatus;\r\n  intentScore: number;\r\n  \r\n  // åŸ·è¡Œä¿¡æ¯\r\n  assignedRole?: string;\r\n  lastMessageAt?: string;\r\n  messageCount: number;\r\n  \r\n  // çµæœ\r\n  outcome?: TaskOutcome;\r\n  outcomeNotes?: string;\r\n  \r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n/**\r\n * ä»»å‹™åŸ·è¡Œæ—¥èªŒ\r\n */\r\nexport interface TaskLog {\r\n  id: string;\r\n  taskId: string;\r\n  targetId?: string;\r\n  \r\n  // æ—¥èªŒé¡å‹\r\n  logType: 'status_change' | 'message_sent' | 'ai_decision' | 'role_switch' | 'error';\r\n  \r\n  // æ—¥èªŒå…§å®¹\r\n  action: string;\r\n  details?: Record<string, any>;\r\n  \r\n  // åŸ·è¡Œè€…\r\n  actorType: 'ai' | 'role' | 'system' | 'human';\r\n  actorId?: string;\r\n  \r\n  createdAt: string;\r\n}\r\n\r\n/**\r\n * ä»»å‹™è§’è‰²åˆ†é…\r\n */\r\nexport interface TaskRole {\r\n  id: string;\r\n  taskId: string;\r\n  \r\n  // è§’è‰²ä¿¡æ¯\r\n  roleType: UnifiedRoleType;\r\n  roleName: string;\r\n  \r\n  // å¸³è™Ÿç¶å®š\r\n  accountId?: number;\r\n  accountPhone?: string;\r\n  \r\n  // AI é…ç½®\r\n  personaPrompt?: string;\r\n  speakingStyle?: string;\r\n  \r\n  // åŸ·è¡Œçµ±è¨ˆ\r\n  messagesSent: number;\r\n  lastActiveAt?: string;\r\n  \r\n  createdAt: string;\r\n}\r\n\r\n// ============ é è¨­ç›®æ¨™é¡å‹é…ç½® ============\r\n\r\nexport const GOAL_TYPE_CONFIG: Record<GoalType, {\r\n  icon: string;\r\n  label: string;\r\n  description: string;\r\n  suggestedRoles: UnifiedRoleType[];\r\n  suggestedMode: ExecutionMode;\r\n}> = {\r\n  conversion: {\r\n    icon: 'ğŸ’°',\r\n    label: 'ä¿ƒé€²é¦–å–®',\r\n    description: 'æŠŠçŒ¶è±«ä¸æ±ºçš„æ½›åœ¨å®¢æˆ¶è½‰åŒ–ç‚ºä»˜è²»ç”¨æˆ¶',\r\n    suggestedRoles: ['expert', 'satisfied_customer', 'sales'],\r\n    suggestedMode: 'hybrid'\r\n  },\r\n  retention: {\r\n    icon: 'ğŸ’',\r\n    label: 'æŒ½å›æµå¤±',\r\n    description: 'æŒ½å›å·²æµå¤±çš„è€å®¢æˆ¶ï¼Œè®“ä»–å€‘é‡æ–°è³¼è²·',\r\n    suggestedRoles: ['callback', 'support', 'manager'],\r\n    suggestedMode: 'hybrid'\r\n  },\r\n  engagement: {\r\n    icon: 'ğŸ‰',\r\n    label: 'ç¤¾ç¾¤æ´»èº',\r\n    description: 'è®“ç¤¾ç¾¤æ›´æ´»èºï¼Œå¢åŠ ç”¨æˆ¶äº’å‹•å’Œç²˜æ€§',\r\n    suggestedRoles: ['newbie', 'satisfied_customer', 'expert'],\r\n    suggestedMode: 'scriptless'\r\n  },\r\n  support: {\r\n    icon: 'ğŸ”§',\r\n    label: 'å”®å¾Œæœå‹™',\r\n    description: 'é«˜æ•ˆè™•ç†å®¢æˆ¶å”®å¾Œå•é¡Œï¼Œæå‡æ»¿æ„åº¦',\r\n    suggestedRoles: ['support', 'expert', 'manager'],\r\n    suggestedMode: 'scripted'\r\n  }\r\n};\r\n\r\n// ============ è¼”åŠ©å‡½æ•¸ ============\r\n\r\n/**\r\n * è¨ˆç®—ä»»å‹™çµ±è¨ˆ\r\n */\r\nexport function calculateTaskStats(task: MarketingTask): TaskStats {\r\n  const stats = task.stats;\r\n  return {\r\n    ...stats,\r\n    contactRate: stats.totalContacts > 0 \r\n      ? Math.round((stats.contacted / stats.totalContacts) * 100) \r\n      : 0,\r\n    replyRate: stats.contacted > 0 \r\n      ? Math.round((stats.replied / stats.contacted) * 100) \r\n      : 0,\r\n    conversionRate: stats.contacted > 0 \r\n      ? Math.round((stats.converted / stats.contacted) * 100) \r\n      : 0\r\n  };\r\n}\r\n\r\n/**\r\n * å‰µå»ºé»˜èªä»»å‹™\r\n */\r\nexport function createDefaultTask(goalType: GoalType = 'conversion'): Partial<MarketingTask> {\r\n  const config = GOAL_TYPE_CONFIG[goalType];\r\n  \r\n  return {\r\n    goalType,\r\n    executionMode: config.suggestedMode,\r\n    status: 'draft',\r\n    targetCount: 0,\r\n    stats: {\r\n      totalContacts: 0,\r\n      contacted: 0,\r\n      replied: 0,\r\n      converted: 0,\r\n      messagesSent: 0,\r\n      aiCost: 0,\r\n      contactRate: 0,\r\n      replyRate: 0,\r\n      conversionRate: 0\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * å¾èˆŠçš„ CollaborationGroup è½‰æ›\r\n */\r\nexport function fromCollaborationGroup(group: any): Partial<MarketingTask> {\r\n  return {\r\n    name: group.groupTitle || 'å”ä½œä»»å‹™',\r\n    goalType: mapPurposeToGoal(group.purpose),\r\n    executionMode: 'scripted',\r\n    status: mapCollabStatusToTaskStatus(group.status),\r\n    targetCount: 1,\r\n    stats: {\r\n      totalContacts: 1,\r\n      contacted: group.customerMessages > 0 ? 1 : 0,\r\n      replied: group.customerMessages > 0 ? 1 : 0,\r\n      converted: group.outcome === 'converted' ? 1 : 0,\r\n      messagesSent: group.messagesSent || 0,\r\n      aiCost: 0,\r\n      contactRate: 100,\r\n      replyRate: group.customerMessages > 0 ? 100 : 0,\r\n      conversionRate: group.outcome === 'converted' ? 100 : 0\r\n    }\r\n  };\r\n}\r\n\r\nfunction mapPurposeToGoal(purpose: string): GoalType {\r\n  const mapping: Record<string, GoalType> = {\r\n    'conversion': 'conversion',\r\n    'support': 'support',\r\n    'community': 'engagement',\r\n    'engagement': 'engagement'\r\n  };\r\n  return mapping[purpose] || 'conversion';\r\n}\r\n\r\nfunction mapCollabStatusToTaskStatus(status: string): TaskStatus {\r\n  const mapping: Record<string, TaskStatus> = {\r\n    'creating': 'draft',\r\n    'inviting': 'running',\r\n    'running': 'running',\r\n    'paused': 'paused',\r\n    'completed': 'completed',\r\n    'failed': 'failed'\r\n  };\r\n  return mapping[status] || 'draft';\r\n}\r\n", "/**\r\n * çµ±ä¸€ç‡ŸéŠ·ä»»å‹™æœå‹™\r\n * Unified Marketing Task Service\r\n * \r\n * æ•´åˆå¤šè§’è‰²å”ä½œå’ŒAIä¸­å¿ƒçš„åŠŸèƒ½ï¼Œæä¾›çµ±ä¸€çš„ä»»å‹™ç®¡ç†API\r\n * \r\n * è¨­è¨ˆåŸå‰‡ï¼š\r\n * - å–®ä¸€æ•¸æ“šæºï¼ˆSingle Source of Truthï¼‰\r\n * - çµ±ä¸€çš„ç‹€æ…‹æ©Ÿç®¡ç†\r\n * - çµ±ä¸€çš„çµ±è¨ˆå£å¾‘\r\n */\r\n\r\nimport { Injectable, inject, signal, computed } from '@angular/core';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\nimport {\r\n  MarketingTask,\r\n  TaskTarget,\r\n  TaskStats,\r\n  TaskStatus,\r\n  GoalType,\r\n  ExecutionMode,\r\n  RoleConfig,\r\n  GOAL_TYPE_CONFIG,\r\n  createDefaultTask,\r\n  calculateTaskStats\r\n} from '../models/marketing-task.models';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MarketingTaskService {\r\n  private ipc = inject(ElectronIpcService);\r\n  private toast = inject(ToastService);\r\n  \r\n  // ============ ç‹€æ…‹ç®¡ç† ============\r\n  \r\n  // ä»»å‹™åˆ—è¡¨\r\n  private _tasks = signal<MarketingTask[]>([]);\r\n  tasks = this._tasks.asReadonly();\r\n  \r\n  // ç•¶å‰ä»»å‹™\r\n  private _currentTask = signal<MarketingTask | null>(null);\r\n  currentTask = this._currentTask.asReadonly();\r\n  \r\n  // åŠ è¼‰ç‹€æ…‹\r\n  private _isLoading = signal(false);\r\n  isLoading = this._isLoading.asReadonly();\r\n  \r\n  // ============ è¨ˆç®—å±¬æ€§ ============\r\n  \r\n  // æ´»èºä»»å‹™æ•¸\r\n  activeTasks = computed(() => \r\n    this._tasks().filter(t => t.status === 'running' || t.status === 'scheduled')\r\n  );\r\n  \r\n  // ä»Šæ—¥çµ±è¨ˆ\r\n  todayStats = computed(() => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const todayTasks = this._tasks().filter(t => \r\n      t.createdAt.startsWith(today) || t.startedAt?.startsWith(today)\r\n    );\r\n    \r\n    return {\r\n      totalTasks: todayTasks.length,\r\n      contacted: todayTasks.reduce((sum, t) => sum + t.stats.contacted, 0),\r\n      converted: todayTasks.reduce((sum, t) => sum + t.stats.converted, 0),\r\n      messagesSent: todayTasks.reduce((sum, t) => sum + t.stats.messagesSent, 0),\r\n      aiCost: todayTasks.reduce((sum, t) => sum + t.stats.aiCost, 0)\r\n    };\r\n  });\r\n  \r\n  // æŒ‰ç›®æ¨™é¡å‹åˆ†çµ„\r\n  tasksByGoal = computed(() => {\r\n    const grouped: Record<GoalType, MarketingTask[]> = {\r\n      conversion: [],\r\n      retention: [],\r\n      engagement: [],\r\n      support: []\r\n    };\r\n    \r\n    this._tasks().forEach(t => {\r\n      grouped[t.goalType]?.push(t);\r\n    });\r\n    \r\n    return grouped;\r\n  });\r\n  \r\n  // ç¸½é«”è½‰åŒ–ç‡\r\n  overallConversionRate = computed(() => {\r\n    const allTasks = this._tasks().filter(t => t.stats.contacted > 0);\r\n    if (allTasks.length === 0) return 0;\r\n    \r\n    const totalContacted = allTasks.reduce((sum, t) => sum + t.stats.contacted, 0);\r\n    const totalConverted = allTasks.reduce((sum, t) => sum + t.stats.converted, 0);\r\n    \r\n    return totalContacted > 0 ? Math.round((totalConverted / totalContacted) * 100) : 0;\r\n  });\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n    this.loadTasks();\r\n  }\r\n  \r\n  private setupIpcListeners(): void {\r\n    // ç›£è½ä»»å‹™åˆ—è¡¨æ›´æ–°\r\n    this.ipc.on('marketing-tasks-loaded', (data: any) => {\r\n      if (data.success && data.tasks) {\r\n        this._tasks.set(data.tasks.map(this.normalizeTask));\r\n      }\r\n      this._isLoading.set(false);\r\n    });\r\n    \r\n    // ç›£è½ä»»å‹™å‰µå»ºçµæœ\r\n    this.ipc.on('marketing-task-created', (data: any) => {\r\n      if (data.success && data.task) {\r\n        this._tasks.update(tasks => [...tasks, this.normalizeTask(data.task)]);\r\n        this.toast.success(`ä»»å‹™ã€Œ${data.task.name}ã€å‰µå»ºæˆåŠŸ`);\r\n      } else {\r\n        this.toast.error(`å‰µå»ºå¤±æ•—: ${data.error}`);\r\n      }\r\n    });\r\n    \r\n    // ç›£è¯ä»»å‹™ç‹€æ…‹æ›´æ–°\r\n    this.ipc.on('marketing-task-updated', (data: any) => {\r\n      if (data.success && data.task) {\r\n        this._tasks.update(tasks => \r\n          tasks.map(t => t.id === data.task.id ? this.normalizeTask(data.task) : t)\r\n        );\r\n      }\r\n    });\r\n    \r\n    // ç›£è½ä»»å‹™çµ±è¨ˆæ›´æ–°ï¼ˆå¯¦æ™‚ï¼‰\r\n    this.ipc.on('marketing-task-stats', (data: any) => {\r\n      if (data.taskId && data.stats) {\r\n        this._tasks.update(tasks => \r\n          tasks.map(t => t.id === data.taskId \r\n            ? { ...t, stats: { ...t.stats, ...data.stats } } \r\n            : t\r\n          )\r\n        );\r\n      }\r\n    });\r\n    \r\n    // ç›£è½ä»»å‹™åˆªé™¤\r\n    this.ipc.on('marketing-task-deleted', (data: any) => {\r\n      if (data.success && data.taskId) {\r\n        this._tasks.update(tasks => tasks.filter(t => t.id !== data.taskId));\r\n        this.toast.success('ä»»å‹™å·²åˆªé™¤');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // ============ CRUD æ“ä½œ ============\r\n  \r\n  /**\r\n   * åŠ è¼‰æ‰€æœ‰ä»»å‹™\r\n   */\r\n  loadTasks(): void {\r\n    this._isLoading.set(true);\r\n    this.ipc.send('get-marketing-tasks', {});\r\n  }\r\n  \r\n  /**\r\n   * å‰µå»ºæ–°ä»»å‹™\r\n   */\r\n  async createTask(params: {\r\n    name: string;\r\n    goalType: GoalType;\r\n    executionMode?: ExecutionMode;\r\n    description?: string;\r\n    targetCriteria?: any;\r\n    roleConfig?: RoleConfig[];\r\n    scheduleConfig?: any;\r\n  }): Promise<string | null> {\r\n    const task = {\r\n      ...createDefaultTask(params.goalType),\r\n      ...params,\r\n      createdAt: new Date().toISOString()\r\n    };\r\n    \r\n    return new Promise((resolve) => {\r\n      const cleanup = this.ipc.on('marketing-task-created', (data: any) => {\r\n        cleanup();\r\n        resolve(data.success ? data.task?.id : null);\r\n      });\r\n      \r\n      this.ipc.send('create-marketing-task', task);\r\n      \r\n      // è¶…æ™‚è™•ç†\r\n      setTimeout(() => {\r\n        cleanup();\r\n        resolve(null);\r\n      }, 10000);\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å¿«é€Ÿå‰µå»ºä»»å‹™ï¼ˆåŸºæ–¼ç›®æ¨™é¡å‹ï¼‰\r\n   */\r\n  async quickCreate(goalType: GoalType, targetUsers?: any[]): Promise<string | null> {\r\n    const config = GOAL_TYPE_CONFIG[goalType];\r\n    \r\n    return this.createTask({\r\n      name: `${config.label} - ${new Date().toLocaleDateString()}`,\r\n      goalType,\r\n      executionMode: config.suggestedMode,\r\n      description: config.description,\r\n      roleConfig: config.suggestedRoles.map(roleType => ({\r\n        roleType,\r\n        roleName: roleType\r\n      }))\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æ›´æ–°ä»»å‹™\r\n   */\r\n  updateTask(taskId: string, updates: Partial<MarketingTask>): void {\r\n    this.ipc.send('update-marketing-task', { id: taskId, ...updates });\r\n  }\r\n  \r\n  /**\r\n   * åˆªé™¤ä»»å‹™\r\n   */\r\n  deleteTask(taskId: string): void {\r\n    this.ipc.send('delete-marketing-task', { id: taskId });\r\n  }\r\n  \r\n  // ============ ç‹€æ…‹æ§åˆ¶ ============\r\n  \r\n  /**\r\n   * å•Ÿå‹•ä»»å‹™\r\n   */\r\n  startTask(taskId: string): void {\r\n    this.updateTask(taskId, { \r\n      status: 'running',\r\n      startedAt: new Date().toISOString()\r\n    });\r\n    this.ipc.send('start-marketing-task', { id: taskId });\r\n  }\r\n  \r\n  /**\r\n   * æš«åœä»»å‹™\r\n   */\r\n  pauseTask(taskId: string): void {\r\n    this.updateTask(taskId, { status: 'paused' });\r\n    this.ipc.send('pause-marketing-task', { id: taskId });\r\n  }\r\n  \r\n  /**\r\n   * æ¢å¾©ä»»å‹™\r\n   */\r\n  resumeTask(taskId: string): void {\r\n    this.updateTask(taskId, { status: 'running' });\r\n    this.ipc.send('resume-marketing-task', { id: taskId });\r\n  }\r\n  \r\n  /**\r\n   * å®Œæˆä»»å‹™\r\n   */\r\n  completeTask(taskId: string): void {\r\n    this.updateTask(taskId, { \r\n      status: 'completed',\r\n      completedAt: new Date().toISOString()\r\n    });\r\n    this.ipc.send('complete-marketing-task', { id: taskId });\r\n  }\r\n  \r\n  // ============ ğŸ†• å„ªåŒ– 3-1: æ‰¹é‡æ“ä½œ ============\r\n  \r\n  /**\r\n   * æ‰¹é‡å•Ÿå‹•ä»»å‹™\r\n   */\r\n  batchStartTasks(taskIds: string[]): void {\r\n    taskIds.forEach(id => this.startTask(id));\r\n  }\r\n  \r\n  /**\r\n   * æ‰¹é‡æš«åœä»»å‹™\r\n   */\r\n  batchPauseTasks(taskIds: string[]): void {\r\n    taskIds.forEach(id => this.pauseTask(id));\r\n  }\r\n  \r\n  /**\r\n   * æ‰¹é‡æ¢å¾©ä»»å‹™\r\n   */\r\n  batchResumeTasks(taskIds: string[]): void {\r\n    taskIds.forEach(id => this.resumeTask(id));\r\n  }\r\n  \r\n  /**\r\n   * æ‰¹é‡å®Œæˆä»»å‹™\r\n   */\r\n  batchCompleteTasks(taskIds: string[]): void {\r\n    taskIds.forEach(id => this.completeTask(id));\r\n  }\r\n  \r\n  /**\r\n   * æ‰¹é‡åˆªé™¤ä»»å‹™\r\n   */\r\n  batchDeleteTasks(taskIds: string[]): void {\r\n    taskIds.forEach(id => this.deleteTask(id));\r\n  }\r\n  \r\n  /**\r\n   * æ‰¹é‡è¤‡è£½ä»»å‹™\r\n   */\r\n  async batchDuplicateTasks(taskIds: string[]): Promise<string[]> {\r\n    const newIds: string[] = [];\r\n    \r\n    for (const taskId of taskIds) {\r\n      const original = this._tasks().find(t => t.id === taskId);\r\n      if (!original) continue;\r\n      \r\n      const newId = await this.createTask({\r\n        name: `${original.name} (è¤‡è£½)`,\r\n        description: original.description,\r\n        goalType: original.goalType,\r\n        executionMode: original.executionMode,\r\n        roleConfig: original.roleConfig,\r\n        targetCriteria: original.targetCriteria,\r\n        scheduleConfig: original.scheduleConfig\r\n      });\r\n      \r\n      if (newId) newIds.push(newId);\r\n    }\r\n    \r\n    return newIds;\r\n  }\r\n  \r\n  /**\r\n   * ç²å–å¯æ‰¹é‡æ“ä½œçš„ä»»å‹™\r\n   */\r\n  getBatchOperationTasks(status?: string): MarketingTask[] {\r\n    if (!status) return this._tasks();\r\n    return this._tasks().filter(t => t.status === status);\r\n  }\r\n  \r\n  // ============ ç›®æ¨™ç”¨æˆ¶ç®¡ç† ============\r\n  \r\n  /**\r\n   * æ·»åŠ ç›®æ¨™ç”¨æˆ¶\r\n   */\r\n  addTargets(taskId: string, targets: TaskTarget[]): void {\r\n    this.ipc.send('add-marketing-task-targets', { taskId, targets });\r\n  }\r\n  \r\n  /**\r\n   * æ›´æ–°ç›®æ¨™ç‹€æ…‹\r\n   */\r\n  updateTargetStatus(taskId: string, targetId: string, status: string, outcome?: string): void {\r\n    this.ipc.send('update-marketing-task-target', { \r\n      taskId, \r\n      targetId, \r\n      status,\r\n      outcome \r\n    });\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ä»»å‹™ç›®æ¨™ç”¨æˆ¶\r\n   */\r\n  async getTaskTargets(taskId: string): Promise<TaskTarget[]> {\r\n    return new Promise((resolve) => {\r\n      const cleanup = this.ipc.on('marketing-task-targets-loaded', (data: any) => {\r\n        cleanup();\r\n        resolve(data.success ? data.targets : []);\r\n      });\r\n      \r\n      this.ipc.send('get-marketing-task-targets', { taskId });\r\n      \r\n      setTimeout(() => {\r\n        cleanup();\r\n        resolve([]);\r\n      }, 5000);\r\n    });\r\n  }\r\n  \r\n  // ============ è§’è‰²ç®¡ç† ============\r\n  \r\n  /**\r\n   * åˆ†é…è§’è‰²åˆ°ä»»å‹™\r\n   */\r\n  assignRole(taskId: string, roleConfig: RoleConfig): void {\r\n    this.ipc.send('assign-marketing-task-role', { taskId, ...roleConfig });\r\n  }\r\n  \r\n  /**\r\n   * æ™ºèƒ½åŒ¹é…è§’è‰²å¸³è™Ÿ\r\n   */\r\n  async autoAssignRoles(taskId: string): Promise<boolean> {\r\n    return new Promise((resolve) => {\r\n      const cleanup = this.ipc.on('marketing-task-roles-assigned', (data: any) => {\r\n        cleanup();\r\n        if (data.success) {\r\n          this.toast.success(`å·²è‡ªå‹•åˆ†é… ${data.assignedCount} å€‹è§’è‰²`);\r\n        }\r\n        resolve(data.success);\r\n      });\r\n      \r\n      this.ipc.send('auto-assign-marketing-task-roles', { taskId });\r\n      \r\n      setTimeout(() => {\r\n        cleanup();\r\n        resolve(false);\r\n      }, 10000);\r\n    });\r\n  }\r\n  \r\n  // ============ çµ±è¨ˆæŸ¥è©¢ ============\r\n  \r\n  /**\r\n   * ç²å–ä»»å‹™è©³ç´°çµ±è¨ˆ\r\n   */\r\n  async getTaskStats(taskId: string): Promise<TaskStats | null> {\r\n    return new Promise((resolve) => {\r\n      const cleanup = this.ipc.on('marketing-task-stats-loaded', (data: any) => {\r\n        cleanup();\r\n        resolve(data.success ? data.stats : null);\r\n      });\r\n      \r\n      this.ipc.send('get-marketing-task-stats', { taskId });\r\n      \r\n      setTimeout(() => {\r\n        cleanup();\r\n        resolve(null);\r\n      }, 5000);\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ç¸½é«”çµ±è¨ˆ\r\n   */\r\n  getOverallStats(): {\r\n    totalTasks: number;\r\n    activeTasks: number;\r\n    totalContacted: number;\r\n    totalConverted: number;\r\n    conversionRate: number;\r\n    totalMessagesSent: number;\r\n    totalAiCost: number;\r\n  } {\r\n    const tasks = this._tasks();\r\n    \r\n    return {\r\n      totalTasks: tasks.length,\r\n      activeTasks: this.activeTasks().length,\r\n      totalContacted: tasks.reduce((sum, t) => sum + t.stats.contacted, 0),\r\n      totalConverted: tasks.reduce((sum, t) => sum + t.stats.converted, 0),\r\n      conversionRate: this.overallConversionRate(),\r\n      totalMessagesSent: tasks.reduce((sum, t) => sum + t.stats.messagesSent, 0),\r\n      totalAiCost: tasks.reduce((sum, t) => sum + t.stats.aiCost, 0)\r\n    };\r\n  }\r\n  \r\n  // ============ è¼”åŠ©æ–¹æ³• ============\r\n  \r\n  /**\r\n   * æ¨™æº–åŒ–ä»»å‹™æ•¸æ“š\r\n   */\r\n  private normalizeTask(raw: any): MarketingTask {\r\n    return {\r\n      id: String(raw.id),\r\n      name: raw.name || 'æœªå‘½åä»»å‹™',\r\n      description: raw.description,\r\n      goalType: raw.goal_type || raw.goalType || 'conversion',\r\n      aiConfigId: raw.ai_config_id || raw.aiConfigId,\r\n      executionMode: raw.execution_mode || raw.executionMode || 'hybrid',\r\n      status: raw.status || 'draft',\r\n      currentStage: raw.current_stage || raw.currentStage,\r\n      targetCount: raw.target_count || raw.targetCount || 0,\r\n      targetCriteria: raw.target_criteria ? JSON.parse(raw.target_criteria) : raw.targetCriteria,\r\n      roleConfig: raw.role_config ? JSON.parse(raw.role_config) : raw.roleConfig,\r\n      scriptId: raw.script_id || raw.scriptId,\r\n      scheduleConfig: raw.schedule_config ? JSON.parse(raw.schedule_config) : raw.scheduleConfig,\r\n      triggerConditions: raw.trigger_conditions ? JSON.parse(raw.trigger_conditions) : raw.triggerConditions,\r\n      stats: {\r\n        totalContacts: raw.stats_total_contacts || raw.stats?.totalContacts || 0,\r\n        contacted: raw.stats_contacted || raw.stats?.contacted || 0,\r\n        replied: raw.stats_replied || raw.stats?.replied || 0,\r\n        converted: raw.stats_converted || raw.stats?.converted || 0,\r\n        messagesSent: raw.stats_messages_sent || raw.stats?.messagesSent || 0,\r\n        aiCost: raw.stats_ai_cost || raw.stats?.aiCost || 0,\r\n        contactRate: 0,\r\n        replyRate: 0,\r\n        conversionRate: 0\r\n      },\r\n      createdAt: raw.created_at || raw.createdAt || new Date().toISOString(),\r\n      startedAt: raw.started_at || raw.startedAt,\r\n      completedAt: raw.completed_at || raw.completedAt,\r\n      updatedAt: raw.updated_at || raw.updatedAt || new Date().toISOString(),\r\n      createdBy: raw.created_by || raw.createdBy\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®ç•¶å‰æŸ¥çœ‹çš„ä»»å‹™\r\n   */\r\n  setCurrentTask(task: MarketingTask | null): void {\r\n    this._currentTask.set(task);\r\n  }\r\n  \r\n  /**\r\n   * æ ¹æ“šIDç²å–ä»»å‹™\r\n   */\r\n  getTaskById(taskId: string): MarketingTask | undefined {\r\n    return this._tasks().find(t => t.id === taskId);\r\n  }\r\n}\r\n", "/**\r\n * AI ä¸­å¿ƒæ•¸æ“šæ¨¡å‹\r\n * AI Center Data Models\r\n */\r\n\r\n// AI æ¨¡å‹æä¾›å•†\r\nexport type AIProvider = 'openai' | 'claude' | 'gemini' | 'custom';\r\n\r\n// AI æ¨¡å‹é…ç½®\r\nexport interface AIModelConfig {\r\n  id: string;\r\n  provider: AIProvider;\r\n  modelName: string;\r\n  apiKey: string;\r\n  apiEndpoint?: string;\r\n  isConnected: boolean;\r\n  lastTestedAt?: string;\r\n  usageToday: number;\r\n  costToday: number;\r\n}\r\n\r\n// å°è©±é¢¨æ ¼\r\nexport type ConversationStyle = 'professional' | 'friendly' | 'casual' | 'enthusiastic' | 'direct';\r\n\r\n// AI å°è©±ç­–ç•¥\r\nexport interface ConversationStrategy {\r\n  style: ConversationStyle;\r\n  responseLength: 'short' | 'medium' | 'long';\r\n  useEmoji: boolean;\r\n  emojiFrequency: 'none' | 'low' | 'medium' | 'high';\r\n  language: string;\r\n  customPromptPrefix?: string;\r\n}\r\n\r\n// çŸ¥è­˜åº«é …ç›®\r\nexport interface KnowledgeItem {\r\n  id: string;\r\n  category: 'product' | 'faq' | 'sales' | 'objection' | 'custom';\r\n  title: string;\r\n  content: string;\r\n  keywords: string[];\r\n  priority: number;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// çŸ¥è­˜åº«\r\nexport interface KnowledgeBase {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  items: KnowledgeItem[];\r\n  isDefault: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// æ„åœ–é¡å‹\r\nexport type IntentType = \r\n  | 'purchase_intent' \r\n  | 'price_inquiry' \r\n  | 'product_question' \r\n  | 'complaint' \r\n  | 'general_chat'\r\n  | 'negative_sentiment'\r\n  | 'high_value'\r\n  | 'urgent';\r\n\r\n// æ™ºèƒ½è¦å‰‡\r\nexport interface SmartRule {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  triggerIntent: IntentType;\r\n  triggerConditions: {\r\n    intentScore?: number;\r\n    keywordMatch?: string[];\r\n    conversationRounds?: number;\r\n    customCondition?: string;\r\n  };\r\n  actions: {\r\n    notifyHuman: boolean;\r\n    autoReply: boolean;\r\n    replyTemplate?: string;\r\n    addTag?: string;\r\n    changeStage?: string;\r\n    sendOffer?: boolean;\r\n  };\r\n  isActive: boolean;\r\n  priority: number;\r\n}\r\n\r\n// AI ä¸­å¿ƒé…ç½®\r\nexport interface AICenterConfig {\r\n  // æ¨¡å‹é…ç½®\r\n  models: AIModelConfig[];\r\n  defaultModelId: string;\r\n  modelUsage: {\r\n    intentRecognition: string;\r\n    dailyChat: string;\r\n    multiRoleScript: string;\r\n  };\r\n  \r\n  // å°è©±ç­–ç•¥\r\n  conversationStrategy: ConversationStrategy;\r\n  \r\n  // çŸ¥è­˜åº«\r\n  knowledgeBases: KnowledgeBase[];\r\n  activeKnowledgeBaseId: string;\r\n  \r\n  // æ™ºèƒ½è¦å‰‡\r\n  smartRules: SmartRule[];\r\n  \r\n  // å…¨å±€è¨­ç½®\r\n  settings: {\r\n    autoLearnFromConversations: boolean;\r\n    maxDailyBudget: number;\r\n    fallbackToHuman: boolean;\r\n    fallbackTimeout: number; // ç§’\r\n    debugMode: boolean;\r\n  };\r\n}\r\n\r\n// AI ä½¿ç”¨çµ±è¨ˆ\r\nexport interface AIUsageStats {\r\n  today: {\r\n    conversations: number;\r\n    messages: number;\r\n    intentsRecognized: number;\r\n    conversions: number;\r\n    cost: number;\r\n    avgResponseTime: number;\r\n  };\r\n  weekly: {\r\n    conversations: number;\r\n    messages: number;\r\n    intentsRecognized: number;\r\n    conversions: number;\r\n    cost: number;\r\n    conversionRate: number;\r\n  };\r\n  byModel: {\r\n    modelId: string;\r\n    modelName: string;\r\n    usage: number;\r\n    cost: number;\r\n  }[];\r\n}\r\n\r\n// é»˜èª AI é…ç½®\r\nexport const DEFAULT_AI_CONFIG: AICenterConfig = {\r\n  models: [],\r\n  defaultModelId: '',\r\n  modelUsage: {\r\n    intentRecognition: '',\r\n    dailyChat: '',\r\n    multiRoleScript: ''\r\n  },\r\n  conversationStrategy: {\r\n    style: 'friendly',\r\n    responseLength: 'medium',\r\n    useEmoji: true,\r\n    emojiFrequency: 'low',\r\n    language: 'zh-TW'\r\n  },\r\n  knowledgeBases: [],\r\n  activeKnowledgeBaseId: '',\r\n  smartRules: [],\r\n  settings: {\r\n    autoLearnFromConversations: false,\r\n    maxDailyBudget: 50,\r\n    fallbackToHuman: true,\r\n    fallbackTimeout: 300,\r\n    debugMode: false\r\n  }\r\n};\r\n", "/**\r\n * AI ä¸­å¿ƒæœå‹™\r\n * AI Center Service - çµ±ä¸€ç®¡ç†æ‰€æœ‰ AI åŠŸèƒ½\r\n * \r\n * æ›´æ–°ï¼šæ”¯æŒæŒä¹…åŒ–å­˜å„²å’Œæœ¬åœ° AI\r\n */\r\n\r\nimport { Injectable, signal, computed, inject } from '@angular/core';\r\nimport { \r\n  AICenterConfig, \r\n  AIModelConfig, \r\n  KnowledgeBase, \r\n  KnowledgeItem,\r\n  SmartRule, \r\n  AIUsageStats,\r\n  DEFAULT_AI_CONFIG,\r\n  AIProvider,\r\n  IntentType,\r\n  ConversationStrategy\r\n} from './ai-center.models';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\nimport { ToastService } from '../toast.service';\r\n\r\n// æ“´å±• AIModelConfig ä»¥æ”¯æŒæœ¬åœ° AI\r\nexport interface ExtendedAIModelConfig extends AIModelConfig {\r\n  isLocal?: boolean;\r\n  displayName?: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AICenterService {\r\n  private ipcService = inject(ElectronIpcService);\r\n  private toastService = inject(ToastService);\r\n  \r\n  // é…ç½®ç‹€æ…‹\r\n  private config = signal<AICenterConfig>(DEFAULT_AI_CONFIG);\r\n  \r\n  // æ¨¡å‹åŠ è¼‰ç‹€æ…‹\r\n  private _isLoading = signal(false);\r\n  isLoading = this._isLoading.asReadonly();\r\n  \r\n  // çµ±è¨ˆæ•¸æ“š\r\n  private usageStats = signal<AIUsageStats>({\r\n    today: {\r\n      conversations: 0,\r\n      messages: 0,\r\n      intentsRecognized: 0,\r\n      conversions: 0,\r\n      cost: 0,\r\n      avgResponseTime: 0\r\n    },\r\n    weekly: {\r\n      conversations: 0,\r\n      messages: 0,\r\n      intentsRecognized: 0,\r\n      conversions: 0,\r\n      cost: 0,\r\n      conversionRate: 0\r\n    },\r\n    byModel: []\r\n  });\r\n  \r\n  // è¨ˆç®—å±¬æ€§\r\n  models = computed(() => this.config().models);\r\n  defaultModel = computed(() => \r\n    this.config().models.find(m => m.id === this.config().defaultModelId)\r\n  );\r\n  // ğŸ”§ FIX: æš´éœ²çŸ¥è­˜åº«åˆ—è¡¨ä¾›çµ„ä»¶ä½¿ç”¨\r\n  knowledgeBases = computed(() => this.config().knowledgeBases);\r\n  activeKnowledgeBaseId = computed(() => this.config().activeKnowledgeBaseId);\r\n  activeKnowledgeBase = computed(() => \r\n    this.config().knowledgeBases.find(kb => kb.id === this.config().activeKnowledgeBaseId)\r\n  );\r\n  activeRules = computed(() => \r\n    this.config().smartRules.filter(r => r.isActive)\r\n  );\r\n  stats = computed(() => this.usageStats());\r\n  strategy = computed(() => this.config().conversationStrategy);\r\n  settings = computed(() => this.config().settings);\r\n  \r\n  // é€£æ¥ç‹€æ…‹\r\n  isConnected = computed(() => \r\n    this.config().models.some(m => m.isConnected)\r\n  );\r\n  \r\n  // ğŸ”§ æ­£åœ¨æ¸¬è©¦çš„æ¨¡å‹ ID åˆ—è¡¨\r\n  private _testingModelIds = signal<Set<string>>(new Set());\r\n  testingModelIds = computed(() => this._testingModelIds());\r\n  \r\n  // æœ¬åœ° AI æ¨¡å‹\r\n  localModels = computed(() => \r\n    this.config().models.filter(m => (m as ExtendedAIModelConfig).isLocal)\r\n  );\r\n  \r\n  // é›²ç«¯ AI æ¨¡å‹\r\n  cloudModels = computed(() => \r\n    this.config().models.filter(m => !(m as ExtendedAIModelConfig).isLocal)\r\n  );\r\n  \r\n  // æ¨¡å‹ç”¨é€”åˆ†é…\r\n  modelUsage = computed(() => this.config().modelUsage);\r\n  \r\n  constructor() {\r\n    this.setupIpcListeners();\r\n    // å»¶é²åŠ è¼‰æ¨¡å‹é…ç½®å’Œç”¨é€”åˆ†é…\r\n    setTimeout(() => {\r\n      this.loadModelsFromBackend();\r\n      this.loadModelUsageFromBackend();\r\n    }, 100);\r\n  }\r\n  \r\n  private setupIpcListeners(): void {\r\n    // ç›£è½æ¨¡å‹åˆ—è¡¨æ›´æ–°\r\n    this.ipcService.on('ai-models-list', (data: any) => {\r\n      if (data.success && data.models) {\r\n        const models: AIModelConfig[] = data.models.map((m: any) => ({\r\n          id: String(m.id),\r\n          provider: m.provider as AIProvider,\r\n          modelName: m.modelName,\r\n          apiKey: m.apiKey || '',\r\n          apiEndpoint: m.apiEndpoint,\r\n          isConnected: m.isConnected,\r\n          lastTestedAt: m.lastTestedAt,\r\n          usageToday: 0,\r\n          costToday: 0,\r\n          // æ“´å±•å±¬æ€§\r\n          isLocal: m.isLocal,\r\n          displayName: m.displayName\r\n        }));\r\n        \r\n        this.config.update(c => ({\r\n          ...c,\r\n          models,\r\n          defaultModelId: models.find(m => (m as any).isDefault)?.id || c.defaultModelId\r\n        }));\r\n        \r\n        this._isLoading.set(false);\r\n      }\r\n    });\r\n    \r\n    // ç›£è¯æ¨¡å‹ä¿å­˜çµæœ\r\n    this.ipcService.on('ai-model-saved', (data: any) => {\r\n      if (data.success) {\r\n        this.toastService.success(`AI æ¨¡å‹å·²ä¿å­˜: ${data.modelName || data.provider}`);\r\n      } else {\r\n        this.toastService.error(`ä¿å­˜å¤±æ•—: ${data.error}`);\r\n      }\r\n    });\r\n    \r\n    // ç›£è½æ¨¡å‹æ¸¬è©¦çµæœ\r\n    this.ipcService.on('ai-model-tested', (data: any) => {\r\n      console.log('[AI] æ¸¬è©¦çµæœ:', data);\r\n      \r\n      // ğŸ”§ ç§»é™¤æ¸¬è©¦ä¸­ç‹€æ…‹\r\n      if (data.modelId) {\r\n        this._testingModelIds.update(set => {\r\n          const newSet = new Set(set);\r\n          newSet.delete(String(data.modelId));\r\n          return newSet;\r\n        });\r\n      }\r\n      \r\n      if (data.isConnected) {\r\n        // ğŸ”§ P0+P2 å„ªåŒ–ï¼šé¡¯ç¤ºå»¶é²æ™‚é–“ã€å›è¦†é è¦½å’Œå¯ç”¨æ¨¡å‹\r\n        const latency = data.latencyMs ? `å»¶é²: ${data.latencyMs}ms` : '';\r\n        const preview = data.responsePreview ? `\\nå›è¦†: \"${data.responsePreview.substring(0, 50)}${data.responsePreview.length > 50 ? '...' : ''}\"` : '';\r\n        const models = data.availableModels?.length > 0 ? `\\nå¯ç”¨æ¨¡å‹: ${data.availableModels.slice(0, 3).join(', ')}${data.availableModels.length > 3 ? '...' : ''}` : '';\r\n        this.toastService.success(`âœ“ AI æ¨¡å‹ ${data.modelName || ''} é€£æ¥æˆåŠŸï¼\\n${latency}${preview}${models}`);\r\n      } else {\r\n        this.toastService.error(`é€£æ¥å¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n      // æ›´æ–°æœ¬åœ°ç‹€æ…‹\r\n      if (data.modelId) {\r\n        this.updateModel(String(data.modelId), { \r\n          isConnected: data.isConnected,\r\n          // ğŸ”§ P0 å„ªåŒ–ï¼šå­˜å„²æœ€å¾Œæ¸¬è©¦æ™‚é–“\r\n          lastTestedAt: new Date().toISOString()\r\n        });\r\n      }\r\n    });\r\n    \r\n    // ç›£è½æ¨¡å‹ç”¨é€”åˆ†é…åŠ è¼‰\r\n    this.ipcService.on('model-usage-loaded', (data: any) => {\r\n      console.log('[AI] æ¨¡å‹ç”¨é€”åˆ†é…å·²åŠ è¼‰:', data);\r\n      if (data.success && data.usage) {\r\n        this.config.update(c => ({\r\n          ...c,\r\n          modelUsage: {\r\n            intentRecognition: data.usage.intentRecognition || '',\r\n            dailyChat: data.usage.dailyChat || '',\r\n            multiRoleScript: data.usage.multiRoleScript || ''\r\n          }\r\n        }));\r\n      }\r\n    });\r\n    \r\n    // ç›£è¯æ¨¡å‹ç”¨é€”åˆ†é…ä¿å­˜çµæœ\r\n    this.ipcService.on('model-usage-saved', (data: any) => {\r\n      if (data.success) {\r\n        console.log('[AI] æ¨¡å‹ç”¨é€”åˆ†é…å·²ä¿å­˜');\r\n      } else {\r\n        this.toastService.error(`ä¿å­˜å¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• ç›£è½çŸ¥è­˜åº«å‰µå»ºçµæœ\r\n    this.ipcService.on('knowledge-base-added', (data: any) => {\r\n      console.log('[AI] çŸ¥è­˜åº«å‰µå»ºçµæœ:', data);\r\n      if (data.success) {\r\n        this.toastService.success(`çŸ¥è­˜åº«ã€Œ${data.name}ã€å‰µå»ºæˆåŠŸ`);\r\n        // åˆ·æ–°çŸ¥è­˜åº«åˆ—è¡¨ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰\r\n      } else {\r\n        this.toastService.error(`å‰µå»ºå¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• ç›£è½çŸ¥è­˜åº«æ¢ç›®æ·»åŠ çµæœ\r\n    this.ipcService.on('knowledge-item-added', (data: any) => {\r\n      console.log('[AI] çŸ¥è­˜æ¢ç›®æ·»åŠ çµæœ:', data);\r\n      if (data.success) {\r\n        this.toastService.success(`çŸ¥è­˜æ¢ç›®ã€Œ${data.title}ã€å·²æ·»åŠ `);\r\n      } else {\r\n        this.toastService.error(`æ·»åŠ å¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• ç›£è½ AI ç”ŸæˆçŸ¥è­˜åº«çµæœ\r\n    this.ipcService.on('ai-knowledge-generated', (data: any) => {\r\n      console.log('[AI] AI ç”ŸæˆçŸ¥è­˜åº«çµæœ:', data);\r\n      if (data.success && data.items) {\r\n        this.handleGeneratedKnowledge(data.kbId, data.items);\r\n        this.toastService.success(`âœ¨ AI å·²ç”Ÿæˆ ${data.items.length} æ¢çŸ¥è­˜`);\r\n      } else {\r\n        this.toastService.error(`ç”Ÿæˆå¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• ç›£è½è¡Œæ¥­æ¨¡æ¿æ‡‰ç”¨çµæœ\r\n    this.ipcService.on('industry-template-applied', (data: any) => {\r\n      console.log('[AI] è¡Œæ¥­æ¨¡æ¿æ‡‰ç”¨çµæœ:', data);\r\n      if (data.success && data.items) {\r\n        this.handleGeneratedKnowledge(data.kbId, data.items);\r\n        this.toastService.success(`ğŸ“š å·²æ‡‰ç”¨ã€Œ${data.templateName}ã€æ¨¡æ¿ï¼Œæ·»åŠ  ${data.items.length} æ¢çŸ¥è­˜`);\r\n      } else {\r\n        this.toastService.error(`æ‡‰ç”¨å¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n    });\r\n    \r\n    // ğŸ†• ç›£è½å¾èŠå¤©å­¸ç¿’çµæœ\r\n    this.ipcService.on('chat-learning-complete', (data: any) => {\r\n      console.log('[AI] èŠå¤©å­¸ç¿’çµæœ:', data);\r\n      if (data.success && data.items) {\r\n        this.handleGeneratedKnowledge(data.kbId, data.items);\r\n        this.toastService.success(`ğŸ’¬ å¾èŠå¤©è¨˜éŒ„å­¸ç¿’äº† ${data.items.length} æ¢çŸ¥è­˜`);\r\n      } else if (data.success && (!data.items || data.items.length === 0)) {\r\n        this.toastService.info('æœªç™¼ç¾å¯å­¸ç¿’çš„å„ªè³ªå›è¦†');\r\n      } else {\r\n        this.toastService.error(`å­¸ç¿’å¤±æ•—: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`);\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å¾å¾Œç«¯åŠ è¼‰å·²ä¿å­˜çš„æ¨¡å‹é…ç½®\r\n   */\r\n  loadModelsFromBackend(): void {\r\n    this._isLoading.set(true);\r\n    this.ipcService.send('get-ai-models', {});\r\n  }\r\n  \r\n  // ========== æ¨¡å‹ç®¡ç† ==========\r\n  \r\n  /**\r\n   * æ·»åŠ æ–°æ¨¡å‹ï¼ˆæŒä¹…åŒ–åˆ°å¾Œç«¯ï¼‰\r\n   */\r\n  addModel(model: Omit<AIModelConfig, 'id' | 'isConnected' | 'usageToday' | 'costToday'> & { isLocal?: boolean; displayName?: string; isDefault?: boolean }): string {\r\n    const id = `model_${Date.now()}`;\r\n    const newModel: AIModelConfig = {\r\n      ...model,\r\n      id,\r\n      isConnected: false,\r\n      usageToday: 0,\r\n      costToday: 0\r\n    };\r\n    \r\n    // å…ˆæ›´æ–°æœ¬åœ°ç‹€æ…‹\r\n    this.config.update(c => ({\r\n      ...c,\r\n      models: [...c.models, newModel]\r\n    }));\r\n    \r\n    // æŒä¹…åŒ–åˆ°å¾Œç«¯\r\n    this.ipcService.send('save-ai-model', {\r\n      provider: model.provider,\r\n      modelName: model.modelName,\r\n      displayName: model.displayName || model.modelName,\r\n      apiKey: model.apiKey,\r\n      apiEndpoint: model.apiEndpoint,\r\n      isLocal: model.isLocal || false,\r\n      isDefault: model.isDefault || false\r\n    });\r\n    \r\n    return id;\r\n  }\r\n  \r\n  /**\r\n   * æ·»åŠ æœ¬åœ° AI æ¨¡å‹\r\n   */\r\n  addLocalModel(config: {\r\n    modelName: string;\r\n    displayName?: string;\r\n    apiEndpoint: string;\r\n    isDefault?: boolean;\r\n  }): string {\r\n    return this.addModel({\r\n      provider: 'custom' as AIProvider,\r\n      modelName: config.modelName,\r\n      displayName: config.displayName || config.modelName,\r\n      apiKey: '', // æœ¬åœ° AI ä¸éœ€è¦ API Key\r\n      apiEndpoint: config.apiEndpoint,\r\n      isLocal: true,\r\n      isDefault: config.isDefault\r\n    });\r\n  }\r\n  \r\n  updateModel(id: string, updates: Partial<AIModelConfig>) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      models: c.models.map(m => m.id === id ? { ...m, ...updates } : m)\r\n    }));\r\n    \r\n    // å¦‚æœæ˜¯æ•¸æ“šåº« IDï¼ŒåŒæ­¥åˆ°å¾Œç«¯\r\n    if (!isNaN(Number(id))) {\r\n      this.ipcService.send('update-ai-model', {\r\n        id: Number(id),\r\n        ...updates\r\n      });\r\n    }\r\n  }\r\n  \r\n  removeModel(id: string) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      models: c.models.filter(m => m.id !== id),\r\n      defaultModelId: c.defaultModelId === id ? '' : c.defaultModelId\r\n    }));\r\n    \r\n    // å¦‚æœæ˜¯æ•¸æ“šåº« IDï¼Œå¾å¾Œç«¯åˆªé™¤\r\n    if (!isNaN(Number(id))) {\r\n      this.ipcService.send('delete-ai-model', { id: Number(id) });\r\n    }\r\n  }\r\n  \r\n  setDefaultModel(id: string) {\r\n    this.config.update(c => ({ ...c, defaultModelId: id }));\r\n    \r\n    // åŒæ­¥åˆ°å¾Œç«¯\r\n    if (!isNaN(Number(id))) {\r\n      this.ipcService.send('set-default-ai-model', { id: Number(id) });\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * æ›´æ–°æ¨¡å‹ç”¨é€”åˆ†é…ï¼ˆæœ¬åœ°ç‹€æ…‹ï¼‰\r\n   */\r\n  updateModelUsage(updates: Partial<{ intentRecognition: string; dailyChat: string; multiRoleScript: string }>) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      modelUsage: { ...c.modelUsage, ...updates }\r\n    }));\r\n  }\r\n  \r\n  /**\r\n   * ä¿å­˜æ¨¡å‹ç”¨é€”åˆ†é…åˆ°å¾Œç«¯\r\n   */\r\n  async saveModelUsageToBackend(): Promise<void> {\r\n    const usage = this.config().modelUsage;\r\n    console.log('[AI] ä¿å­˜æ¨¡å‹ç”¨é€”åˆ†é…:', usage);\r\n    this.ipcService.send('save-model-usage', usage);\r\n  }\r\n  \r\n  /**\r\n   * å¾å¾Œç«¯åŠ è¼‰æ¨¡å‹ç”¨é€”åˆ†é…\r\n   */\r\n  loadModelUsageFromBackend(): void {\r\n    console.log('[AI] åŠ è¼‰æ¨¡å‹ç”¨é€”åˆ†é…...');\r\n    this.ipcService.send('get-model-usage', {});\r\n  }\r\n  \r\n  /**\r\n   * æ¸¬è©¦æ¨¡å‹é€£æ¥ï¼ˆé€šéå¾Œç«¯æ¸¬è©¦ï¼‰\r\n   */\r\n  async testModelConnection(id: string): Promise<boolean> {\r\n    const model = this.config().models.find(m => m.id === id);\r\n    if (!model) return false;\r\n    \r\n    // ğŸ”§ æª¢æŸ¥æ˜¯å¦å·²åœ¨æ¸¬è©¦ä¸­\r\n    if (this._testingModelIds().has(id)) {\r\n      console.log('[AI] æ¨¡å‹å·²åœ¨æ¸¬è©¦ä¸­ï¼Œè·³é:', id);\r\n      return false;\r\n    }\r\n    \r\n    // ğŸ”§ æ·»åŠ åˆ°æ¸¬è©¦ä¸­åˆ—è¡¨\r\n    this._testingModelIds.update(set => {\r\n      const newSet = new Set(set);\r\n      newSet.add(id);\r\n      return newSet;\r\n    });\r\n    \r\n    const extModel = model as ExtendedAIModelConfig;\r\n    \r\n    // é€šéå¾Œç«¯æ¸¬è©¦é€£æ¥\r\n    this.ipcService.send('test-ai-model', {\r\n      id: !isNaN(Number(id)) ? Number(id) : undefined,\r\n      provider: model.provider,\r\n      modelName: model.modelName,\r\n      apiKey: model.apiKey,\r\n      apiEndpoint: model.apiEndpoint,\r\n      isLocal: extModel.isLocal\r\n    });\r\n    \r\n    // ğŸ”§ 60 ç§’è¶…æ™‚ä¿è­·ï¼ˆè‡ªå‹•ç§»é™¤æ¸¬è©¦ä¸­ç‹€æ…‹ï¼‰\r\n    setTimeout(() => {\r\n      this._testingModelIds.update(set => {\r\n        const newSet = new Set(set);\r\n        newSet.delete(id);\r\n        return newSet;\r\n      });\r\n    }, 60000);\r\n    \r\n    // è¿”å› true è¡¨ç¤ºæ¸¬è©¦è«‹æ±‚å·²ç™¼é€ï¼Œå¯¦éš›çµæœé€šéäº‹ä»¶è¿”å›\r\n    return true;\r\n  }\r\n  \r\n  /**\r\n   * æ¸¬è©¦æœ¬åœ° AI é€£æ¥\r\n   */\r\n  async testLocalAIConnection(endpoint: string, modelName: string): Promise<boolean> {\r\n    this.ipcService.send('test-ai-model', {\r\n      provider: 'ollama',\r\n      modelName: modelName,\r\n      apiEndpoint: endpoint,\r\n      isLocal: true\r\n    });\r\n    return true;\r\n  }\r\n  \r\n  // ========== çŸ¥è­˜åº«ç®¡ç† ==========\r\n  \r\n  addKnowledgeBase(name: string, description: string = ''): string {\r\n    const id = `kb_${Date.now()}`;\r\n    const newKB: KnowledgeBase = {\r\n      id,\r\n      name,\r\n      description,\r\n      items: [],\r\n      isDefault: this.config().knowledgeBases.length === 0,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n    \r\n    this.config.update(c => ({\r\n      ...c,\r\n      knowledgeBases: [...c.knowledgeBases, newKB],\r\n      activeKnowledgeBaseId: c.activeKnowledgeBaseId || id\r\n    }));\r\n    \r\n    // ğŸ†• åŒæ­¥åˆ°å¾Œç«¯æ•¸æ“šåº«ï¼ˆToast ç”±äº‹ä»¶ç›£è½å™¨è™•ç†ï¼Œé¿å…é‡è¤‡ï¼‰\r\n    this.ipcService.send('add-knowledge-base', {\r\n      id,\r\n      name,\r\n      description,\r\n      category: 'general'\r\n    });\r\n    \r\n    // ğŸ”§ FIX: ç§»é™¤é€™è£¡çš„ Toastï¼Œç”± knowledge-base-added äº‹ä»¶çµ±ä¸€è™•ç†\r\n    \r\n    return id;\r\n  }\r\n  \r\n  updateKnowledgeBase(id: string, updates: Partial<KnowledgeBase>) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      knowledgeBases: c.knowledgeBases.map(kb => \r\n        kb.id === id ? { ...kb, ...updates, updatedAt: new Date().toISOString() } : kb\r\n      )\r\n    }));\r\n  }\r\n  \r\n  deleteKnowledgeBase(id: string) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      knowledgeBases: c.knowledgeBases.filter(kb => kb.id !== id),\r\n      activeKnowledgeBaseId: c.activeKnowledgeBaseId === id \r\n        ? (c.knowledgeBases.find(kb => kb.id !== id)?.id || '')\r\n        : c.activeKnowledgeBaseId\r\n    }));\r\n  }\r\n  \r\n  setActiveKnowledgeBase(id: string) {\r\n    this.config.update(c => ({ ...c, activeKnowledgeBaseId: id }));\r\n  }\r\n  \r\n  // ğŸ†• æ·»åŠ çŸ¥è­˜æ¢ç›®\r\n  addKnowledgeItem(kbId: string, item: { title: string; content: string; category?: string }) {\r\n    const itemId = `item_${Date.now()}`;\r\n    const now = new Date().toISOString();\r\n    const newItem: KnowledgeItem = {\r\n      id: itemId,\r\n      title: item.title,\r\n      content: item.content,\r\n      category: (item.category || 'custom') as 'product' | 'faq' | 'sales' | 'objection' | 'custom',\r\n      keywords: [],\r\n      priority: 1,\r\n      isActive: true,\r\n      createdAt: now,\r\n      updatedAt: now\r\n    };\r\n    \r\n    // æ›´æ–°æœ¬åœ°ç‹€æ…‹\r\n    this.config.update(c => ({\r\n      ...c,\r\n      knowledgeBases: c.knowledgeBases.map(kb => \r\n        kb.id === kbId \r\n          ? { ...kb, items: [...kb.items, newItem], updatedAt: new Date().toISOString() }\r\n          : kb\r\n      )\r\n    }));\r\n    \r\n    // åŒæ­¥åˆ°å¾Œç«¯\r\n    this.ipcService.send('add-knowledge-item', {\r\n      kbId,\r\n      id: itemId,\r\n      title: item.title,\r\n      content: item.content,\r\n      category: item.category || 'general'\r\n    });\r\n    \r\n    return itemId;\r\n  }\r\n  \r\n  // ğŸ†• åˆªé™¤çŸ¥è­˜æ¢ç›®\r\n  deleteKnowledgeItem(kbId: string, itemId: string) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      knowledgeBases: c.knowledgeBases.map(kb => \r\n        kb.id === kbId \r\n          ? { ...kb, items: kb.items.filter(i => i.id !== itemId), updatedAt: new Date().toISOString() }\r\n          : kb\r\n      )\r\n    }));\r\n    \r\n    // åŒæ­¥åˆ°å¾Œç«¯\r\n    this.ipcService.send('delete-knowledge-item', {\r\n      kbId,\r\n      itemId\r\n    });\r\n  }\r\n  \r\n  // ğŸ†• AI è‡ªå‹•ç”ŸæˆçŸ¥è­˜åº«\r\n  generateKnowledgeBase(kbId: string, businessDescription: string) {\r\n    // ç™¼é€åˆ°å¾Œç«¯é€²è¡Œ AI ç”Ÿæˆ\r\n    this.ipcService.send('ai-generate-knowledge', {\r\n      kbId,\r\n      businessDescription\r\n    });\r\n  }\r\n  \r\n  // ğŸ†• è™•ç† AI ç”Ÿæˆçš„çŸ¥è­˜æ¢ç›®\r\n  handleGeneratedKnowledge(kbId: string, items: Array<{ title: string; content: string; category: string }>) {\r\n    const now = new Date().toISOString();\r\n    \r\n    const newItems: KnowledgeItem[] = items.map((item, index) => ({\r\n      id: `item_${Date.now()}_${index}`,\r\n      title: item.title,\r\n      content: item.content,\r\n      category: (item.category || 'custom') as 'product' | 'faq' | 'sales' | 'objection' | 'custom',\r\n      keywords: [],\r\n      priority: 1,\r\n      isActive: true,\r\n      createdAt: now,\r\n      updatedAt: now\r\n    }));\r\n    \r\n    // æ›´æ–°æœ¬åœ°ç‹€æ…‹\r\n    this.config.update(c => ({\r\n      ...c,\r\n      knowledgeBases: c.knowledgeBases.map(kb => \r\n        kb.id === kbId \r\n          ? { ...kb, items: [...kb.items, ...newItems], updatedAt: now }\r\n          : kb\r\n      )\r\n    }));\r\n  }\r\n  \r\n  // ğŸ†• æ‡‰ç”¨è¡Œæ¥­æ¨¡æ¿\r\n  applyIndustryTemplate(kbId: string, templateId: string) {\r\n    this.ipcService.send('apply-industry-template', {\r\n      kbId,\r\n      templateId\r\n    });\r\n  }\r\n  \r\n  // ğŸ†• å¾èŠå¤©è¨˜éŒ„å­¸ç¿’\r\n  learnFromChatHistory(kbId: string) {\r\n    this.ipcService.send('learn-from-chat-history', {\r\n      kbId,\r\n      days: 7  // æœ€è¿‘ 7 å¤©\r\n    });\r\n  }\r\n  \r\n  // ========== æ™ºèƒ½è¦å‰‡ç®¡ç† ==========\r\n  \r\n  addSmartRule(rule: Omit<SmartRule, 'id'>): string {\r\n    const id = `rule_${Date.now()}`;\r\n    const newRule: SmartRule = { ...rule, id };\r\n    \r\n    this.config.update(c => ({\r\n      ...c,\r\n      smartRules: [...c.smartRules, newRule]\r\n    }));\r\n    \r\n    return id;\r\n  }\r\n  \r\n  updateSmartRule(id: string, updates: Partial<SmartRule>) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      smartRules: c.smartRules.map(r => r.id === id ? { ...r, ...updates } : r)\r\n    }));\r\n  }\r\n  \r\n  deleteSmartRule(id: string) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      smartRules: c.smartRules.filter(r => r.id !== id)\r\n    }));\r\n  }\r\n  \r\n  toggleSmartRule(id: string) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      smartRules: c.smartRules.map(r => \r\n        r.id === id ? { ...r, isActive: !r.isActive } : r\r\n      )\r\n    }));\r\n  }\r\n  \r\n  // ========== å°è©±ç­–ç•¥ç®¡ç† ==========\r\n  \r\n  updateConversationStrategy(updates: Partial<ConversationStrategy>) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      conversationStrategy: { ...c.conversationStrategy, ...updates }\r\n    }));\r\n  }\r\n  \r\n  /**\r\n   * ğŸ”§ ä¿å­˜å°è©±ç­–ç•¥åˆ°å¾Œç«¯\r\n   */\r\n  async saveConversationStrategyToBackend(strategy: {\r\n    style: string;\r\n    responseLength: string;\r\n    useEmoji: boolean;\r\n    customPersona: string;\r\n  }): Promise<void> {\r\n    console.log('[AI] ä¿å­˜å°è©±ç­–ç•¥:', strategy);\r\n    \r\n    // ç™¼é€åˆ°å¾Œç«¯\r\n    this.ipcService.send('save-conversation-strategy', strategy);\r\n    \r\n    // åŒæ™‚æ›´æ–°æœ¬åœ°ç‹€æ…‹\r\n    this.updateConversationStrategy({\r\n      style: strategy.style as any,\r\n      responseLength: strategy.responseLength as any,\r\n      useEmoji: strategy.useEmoji,\r\n      customPromptPrefix: strategy.customPersona  // ğŸ”§ FIX: ä½¿ç”¨æ­£ç¢ºçš„å±¬æ€§å\r\n    });\r\n    \r\n    this.toastService.success('å°è©±ç­–ç•¥å·²ä¿å­˜');\r\n  }\r\n  \r\n  /**\r\n   * ğŸ”§ å¾å¾Œç«¯è¼‰å…¥å°è©±ç­–ç•¥\r\n   */\r\n  loadConversationStrategyFromBackend(): void {\r\n    console.log('[AI] è¼‰å…¥å°è©±ç­–ç•¥...');\r\n    this.ipcService.send('get-conversation-strategy', {});\r\n  }\r\n  \r\n  // ========== è¨­ç½®ç®¡ç† ==========\r\n  \r\n  updateSettings(updates: Partial<AICenterConfig['settings']>) {\r\n    this.config.update(c => ({\r\n      ...c,\r\n      settings: { ...c.settings, ...updates }\r\n    }));\r\n  }\r\n  \r\n  // ========== AI æ ¸å¿ƒåŠŸèƒ½ï¼ˆä¾›å…¶ä»–æ¨¡å¡Šèª¿ç”¨ï¼‰==========\r\n  \r\n  /**\r\n   * è­˜åˆ¥ç”¨æˆ¶æ„åœ–\r\n   */\r\n  async recognizeIntent(message: string, context?: string[]): Promise<{\r\n    intent: IntentType;\r\n    confidence: number;\r\n    keywords: string[];\r\n  }> {\r\n    // TODO: èª¿ç”¨å¯¦éš› AI API\r\n    // æš«æ™‚è¿”å›æ¨¡æ“¬çµæœ\r\n    const keywords = this.extractKeywords(message);\r\n    \r\n    let intent: IntentType = 'general_chat';\r\n    let confidence = 0.5;\r\n    \r\n    if (message.includes('åƒ¹æ ¼') || message.includes('å¤šå°‘éŒ¢') || message.includes('è²»ç”¨')) {\r\n      intent = 'price_inquiry';\r\n      confidence = 0.9;\r\n    } else if (message.includes('è³¼è²·') || message.includes('ä¸‹å–®') || message.includes('æ€éº¼è²·')) {\r\n      intent = 'purchase_intent';\r\n      confidence = 0.95;\r\n    } else if (message.includes('?') || message.includes('ï¼Ÿ') || message.includes('ä»€éº¼')) {\r\n      intent = 'product_question';\r\n      confidence = 0.7;\r\n    }\r\n    \r\n    // æ›´æ–°çµ±è¨ˆ\r\n    this.usageStats.update(s => ({\r\n      ...s,\r\n      today: { ...s.today, intentsRecognized: s.today.intentsRecognized + 1 }\r\n    }));\r\n    \r\n    return { intent, confidence, keywords };\r\n  }\r\n  \r\n  /**\r\n   * ç”Ÿæˆ AI å›è¦†\r\n   */\r\n  async generateReply(\r\n    message: string, \r\n    context: string[] = [],\r\n    options?: {\r\n      useKnowledgeBase?: boolean;\r\n      rolePrompt?: string;\r\n      maxTokens?: number;\r\n    }\r\n  ): Promise<string> {\r\n    const strategy = this.config().conversationStrategy;\r\n    const kb = this.activeKnowledgeBase();\r\n    \r\n    // TODO: èª¿ç”¨å¯¦éš› AI API\r\n    // æš«æ™‚è¿”å›æ¨¡æ“¬çµæœ\r\n    let reply = `æ„Ÿè¬æ‚¨çš„è¨Šæ¯ï¼`;\r\n    \r\n    if (options?.rolePrompt) {\r\n      reply = `[${options.rolePrompt}] ${reply}`;\r\n    }\r\n    \r\n    if (strategy.useEmoji) {\r\n      reply += ' ğŸ˜Š';\r\n    }\r\n    \r\n    // æ›´æ–°çµ±è¨ˆ\r\n    this.usageStats.update(s => ({\r\n      ...s,\r\n      today: { \r\n        ...s.today, \r\n        messages: s.today.messages + 1,\r\n        cost: s.today.cost + 0.01 \r\n      }\r\n    }));\r\n    \r\n    return reply;\r\n  }\r\n  \r\n  /**\r\n   * æª¢æŸ¥æ™ºèƒ½è¦å‰‡ä¸¦åŸ·è¡Œå‹•ä½œ\r\n   */\r\n  async checkAndExecuteRules(\r\n    intent: IntentType,\r\n    confidence: number,\r\n    conversationRounds: number\r\n  ): Promise<SmartRule | null> {\r\n    const activeRules = this.activeRules()\r\n      .sort((a, b) => b.priority - a.priority);\r\n    \r\n    for (const rule of activeRules) {\r\n      if (rule.triggerIntent !== intent) continue;\r\n      \r\n      const conditions = rule.triggerConditions;\r\n      \r\n      if (conditions.intentScore && confidence < conditions.intentScore) continue;\r\n      if (conditions.conversationRounds && conversationRounds < conditions.conversationRounds) continue;\r\n      \r\n      // è¦å‰‡åŒ¹é…\r\n      return rule;\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  // ========== è¼”åŠ©æ–¹æ³• ==========\r\n  \r\n  private extractKeywords(text: string): string[] {\r\n    // ç°¡å–®çš„é—œéµè©æå–\r\n    const words = text.split(/[\\s,ï¼Œã€‚ï¼ï¼Ÿ!?]+/).filter(w => w.length > 1);\r\n    return words.slice(0, 5);\r\n  }\r\n  \r\n  // ========== å°å…¥/å°å‡º ==========\r\n  \r\n  exportConfig(): string {\r\n    return JSON.stringify(this.config(), null, 2);\r\n  }\r\n  \r\n  importConfig(jsonStr: string) {\r\n    try {\r\n      const config = JSON.parse(jsonStr) as AICenterConfig;\r\n      this.config.set(config);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  // ========== é‡ç½® ==========\r\n  \r\n  resetToDefault() {\r\n    this.config.set(DEFAULT_AI_CONFIG);\r\n  }\r\n}\r\n", "/**\r\n * çµ±ä¸€ç‡ŸéŠ·ç‹€æ…‹æœå‹™\r\n * Unified Marketing State Service\r\n * \r\n * ğŸ†• P2-1: çµ±ä¸€ç‹€æ…‹ç®¡ç†\r\n * \r\n * è·è²¬ï¼š\r\n * - ä½œç‚ºå¤šè§’è‰²å”ä½œå’ŒAIä¸­å¿ƒçš„ç‹€æ…‹å”èª¿ä¸­å¿ƒ\r\n * - æä¾›çµ±ä¸€çš„ä»»å‹™åŸ·è¡Œç‹€æ…‹\r\n * - èšåˆå¤šå€‹æœå‹™çš„çµ±è¨ˆæ•¸æ“š\r\n * - è™•ç†è·¨æœå‹™çš„äº‹ä»¶åŒæ­¥\r\n */\r\n\r\nimport { Injectable, inject, signal, computed, OnDestroy } from '@angular/core';\r\nimport { MarketingTaskService } from './marketing-task.service';\r\nimport { AICenterService } from '../ai-center/ai-center.service';\r\nimport { ElectronIpcService } from '../electron-ipc.service';\r\n\r\n// çµ±ä¸€ç‹€æ…‹é¡å‹\r\nexport interface UnifiedMarketingState {\r\n  // ä»»å‹™ç‹€æ…‹\r\n  activeTasks: number;\r\n  totalTasks: number;\r\n  todayContacted: number;\r\n  todayConverted: number;\r\n  \r\n  // AI ç‹€æ…‹\r\n  aiConnected: boolean;\r\n  aiHostingEnabled: boolean;\r\n  todayAiCost: number;\r\n  todayConversations: number;\r\n  \r\n  // å”ä½œç‹€æ…‹\r\n  activeCollaborations: number;\r\n  collaborationSuccessRate: number;\r\n  \r\n  // ç³»çµ±ç‹€æ…‹\r\n  isProcessing: boolean;\r\n  lastSyncTime: string;\r\n}\r\n\r\n// èšåˆçµ±è¨ˆ\r\nexport interface AggregatedStats {\r\n  totalContacted: number;\r\n  totalConverted: number;\r\n  totalMessagesSent: number;\r\n  totalAiCost: number;\r\n  overallConversionRate: number;\r\n  \r\n  // æŒ‰æ—¥æœŸçµ±è¨ˆ\r\n  daily: {\r\n    date: string;\r\n    contacted: number;\r\n    converted: number;\r\n    messages: number;\r\n    cost: number;\r\n  }[];\r\n  \r\n  // æŒ‰ç›®æ¨™é¡å‹çµ±è¨ˆ\r\n  byGoalType: Record<string, {\r\n    count: number;\r\n    contacted: number;\r\n    converted: number;\r\n  }>;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MarketingStateService implements OnDestroy {\r\n  private taskService = inject(MarketingTaskService);\r\n  private aiService = inject(AICenterService);\r\n  private ipc = inject(ElectronIpcService);\r\n  \r\n  // ============ çµ±ä¸€ç‹€æ…‹ä¿¡è™Ÿ ============\r\n  \r\n  // AI æ‰˜ç®¡ç‹€æ…‹ï¼ˆè·¨çµ„ä»¶å…±äº«ï¼‰\r\n  private _aiHostingEnabled = signal(false);\r\n  aiHostingEnabled = this._aiHostingEnabled.asReadonly();\r\n  \r\n  // è™•ç†ä¸­ç‹€æ…‹\r\n  private _isProcessing = signal(false);\r\n  isProcessing = this._isProcessing.asReadonly();\r\n  \r\n  // æœ€å¾ŒåŒæ­¥æ™‚é–“\r\n  private _lastSyncTime = signal(new Date().toISOString());\r\n  lastSyncTime = this._lastSyncTime.asReadonly();\r\n  \r\n  // ğŸ†• Phase 4-1: çµ±ä¸€è¨­ç½®ï¼ˆä¸€è™•é…ç½®ï¼Œè™•è™•ç”Ÿæ•ˆï¼‰\r\n  private _intentThreshold = signal(70);\r\n  intentThreshold = this._intentThreshold.asReadonly();\r\n  \r\n  private _maxConcurrentTasks = signal(5);\r\n  maxConcurrentTasks = this._maxConcurrentTasks.asReadonly();\r\n  \r\n  private _preferredExecutionMode = signal<'scripted' | 'hybrid' | 'scriptless'>('hybrid');\r\n  preferredExecutionMode = this._preferredExecutionMode.asReadonly();\r\n  \r\n  // ============ è¨ˆç®—å±¬æ€§ï¼ˆèšåˆå¤šå€‹æœå‹™çš„æ•¸æ“šï¼‰ ============\r\n  \r\n  /**\r\n   * çµ±ä¸€ç‡ŸéŠ·ç‹€æ…‹\r\n   */\r\n  unifiedState = computed<UnifiedMarketingState>(() => {\r\n    const taskStats = this.taskService.getOverallStats();\r\n    const aiStats = this.aiService.stats();\r\n    const todayStats = this.taskService.todayStats();\r\n    \r\n    return {\r\n      // ä»»å‹™ç‹€æ…‹\r\n      activeTasks: taskStats.activeTasks,\r\n      totalTasks: taskStats.totalTasks,\r\n      todayContacted: todayStats.contacted,\r\n      todayConverted: todayStats.converted,\r\n      \r\n      // AI ç‹€æ…‹\r\n      aiConnected: this.aiService.isConnected(),\r\n      aiHostingEnabled: this._aiHostingEnabled(),\r\n      todayAiCost: aiStats.today.cost,\r\n      todayConversations: aiStats.today.conversations,\r\n      \r\n      // å”ä½œç‹€æ…‹\r\n      activeCollaborations: taskStats.activeTasks,\r\n      collaborationSuccessRate: taskStats.conversionRate,\r\n      \r\n      // ç³»çµ±ç‹€æ…‹\r\n      isProcessing: this._isProcessing(),\r\n      lastSyncTime: this._lastSyncTime()\r\n    };\r\n  });\r\n  \r\n  /**\r\n   * èšåˆçµ±è¨ˆæ•¸æ“š\r\n   */\r\n  aggregatedStats = computed<AggregatedStats>(() => {\r\n    const taskStats = this.taskService.getOverallStats();\r\n    const tasksByGoal = this.taskService.tasksByGoal();\r\n    const tasks = this.taskService.tasks();\r\n    \r\n    // æŒ‰ç›®æ¨™é¡å‹çµ±è¨ˆ\r\n    const byGoalType: Record<string, { count: number; contacted: number; converted: number }> = {};\r\n    \r\n    Object.entries(tasksByGoal).forEach(([goalType, goalTasks]) => {\r\n      byGoalType[goalType] = {\r\n        count: goalTasks.length,\r\n        contacted: goalTasks.reduce((sum, t) => sum + t.stats.contacted, 0),\r\n        converted: goalTasks.reduce((sum, t) => sum + t.stats.converted, 0)\r\n      };\r\n    });\r\n    \r\n    // æŒ‰æ—¥æœŸçµ±è¨ˆï¼ˆæœ€è¿‘7å¤©ï¼‰\r\n    const daily: AggregatedStats['daily'] = [];\r\n    for (let i = 6; i >= 0; i--) {\r\n      const date = new Date();\r\n      date.setDate(date.getDate() - i);\r\n      const dateStr = date.toISOString().split('T')[0];\r\n      \r\n      const dayTasks = tasks.filter(t => \r\n        t.createdAt.startsWith(dateStr) || t.startedAt?.startsWith(dateStr)\r\n      );\r\n      \r\n      daily.push({\r\n        date: dateStr,\r\n        contacted: dayTasks.reduce((sum, t) => sum + t.stats.contacted, 0),\r\n        converted: dayTasks.reduce((sum, t) => sum + t.stats.converted, 0),\r\n        messages: dayTasks.reduce((sum, t) => sum + t.stats.messagesSent, 0),\r\n        cost: dayTasks.reduce((sum, t) => sum + t.stats.aiCost, 0)\r\n      });\r\n    }\r\n    \r\n    return {\r\n      totalContacted: taskStats.totalContacted,\r\n      totalConverted: taskStats.totalConverted,\r\n      totalMessagesSent: taskStats.totalMessagesSent,\r\n      totalAiCost: taskStats.totalAiCost,\r\n      overallConversionRate: taskStats.conversionRate,\r\n      daily,\r\n      byGoalType\r\n    };\r\n  });\r\n  \r\n  /**\r\n   * æ˜¯å¦æœ‰æ´»èºä»»å‹™\r\n   */\r\n  hasActiveTasks = computed(() => this.taskService.activeTasks().length > 0);\r\n  \r\n  /**\r\n   * ä»Šæ—¥çµ±è¨ˆæ‘˜è¦\r\n   */\r\n  todaySummary = computed(() => {\r\n    const today = this.taskService.todayStats();\r\n    const aiStats = this.aiService.stats().today;\r\n    \r\n    return {\r\n      contacted: today.contacted,\r\n      converted: today.converted,\r\n      messagesSent: today.messagesSent,\r\n      conversations: aiStats.conversations,\r\n      aiCost: aiStats.cost,\r\n      conversionRate: today.contacted > 0 \r\n        ? Math.round((today.converted / today.contacted) * 100) \r\n        : 0\r\n    };\r\n  });\r\n  \r\n  // ============ IPC è¨‚é–± ============\r\n  \r\n  private cleanups: (() => void)[] = [];\r\n  \r\n  constructor() {\r\n    this.initialize();\r\n  }\r\n  \r\n  private initialize(): void {\r\n    // å¾ localStorage æ¢å¾©ç‹€æ…‹\r\n    this.loadPersistedState();\r\n    \r\n    // ç›£è½ AI æ‰˜ç®¡ç‹€æ…‹è®ŠåŒ–\r\n    this.cleanups.push(\r\n      this.ipc.on('ai-hosting-changed', (data: { enabled: boolean }) => {\r\n        this._aiHostingEnabled.set(data.enabled);\r\n      })\r\n    );\r\n    \r\n    // ç›£è½ä»»å‹™ç‹€æ…‹è®ŠåŒ–\r\n    this.cleanups.push(\r\n      this.ipc.on('marketing-task-started', () => {\r\n        this._isProcessing.set(true);\r\n        this._lastSyncTime.set(new Date().toISOString());\r\n      })\r\n    );\r\n    \r\n    this.cleanups.push(\r\n      this.ipc.on('marketing-task-completed', () => {\r\n        this._isProcessing.set(false);\r\n        this._lastSyncTime.set(new Date().toISOString());\r\n      })\r\n    );\r\n    \r\n    this.cleanups.push(\r\n      this.ipc.on('marketing-task-paused', () => {\r\n        this._isProcessing.set(false);\r\n      })\r\n    );\r\n  }\r\n  \r\n  private loadPersistedState(): void {\r\n    const hosting = localStorage.getItem('ai_hosting_enabled');\r\n    if (hosting !== null) {\r\n      this._aiHostingEnabled.set(hosting === 'true');\r\n    }\r\n    \r\n    // ğŸ†• Phase 4-1: åŠ è¼‰çµ±ä¸€è¨­ç½®\r\n    const threshold = localStorage.getItem('intent_threshold');\r\n    if (threshold) {\r\n      this._intentThreshold.set(parseInt(threshold));\r\n    }\r\n    \r\n    const maxTasks = localStorage.getItem('max_concurrent_tasks');\r\n    if (maxTasks) {\r\n      this._maxConcurrentTasks.set(parseInt(maxTasks));\r\n    }\r\n    \r\n    const mode = localStorage.getItem('preferred_execution_mode');\r\n    if (mode && ['scripted', 'hybrid', 'scriptless'].includes(mode)) {\r\n      this._preferredExecutionMode.set(mode as 'scripted' | 'hybrid' | 'scriptless');\r\n    }\r\n  }\r\n  \r\n  ngOnDestroy(): void {\r\n    this.cleanups.forEach(cleanup => cleanup());\r\n  }\r\n  \r\n  // ============ ç‹€æ…‹æ“ä½œæ–¹æ³• ============\r\n  \r\n  /**\r\n   * è¨­ç½® AI æ‰˜ç®¡ç‹€æ…‹\r\n   */\r\n  setAiHostingEnabled(enabled: boolean): void {\r\n    this._aiHostingEnabled.set(enabled);\r\n    localStorage.setItem('ai_hosting_enabled', String(enabled));\r\n    this.ipc.send('set-ai-hosting', { enabled });\r\n  }\r\n  \r\n  // ğŸ†• Phase 4-1: çµ±ä¸€è¨­ç½®æ–¹æ³•\r\n  \r\n  /**\r\n   * è¨­ç½®æ„å‘é–¾å€¼\r\n   */\r\n  setIntentThreshold(threshold: number): void {\r\n    this._intentThreshold.set(threshold);\r\n    localStorage.setItem('intent_threshold', String(threshold));\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®æœ€å¤§åŒæ™‚ä»»å‹™æ•¸\r\n   */\r\n  setMaxConcurrentTasks(count: number): void {\r\n    this._maxConcurrentTasks.set(count);\r\n    localStorage.setItem('max_concurrent_tasks', String(count));\r\n  }\r\n  \r\n  /**\r\n   * è¨­ç½®åå¥½åŸ·è¡Œæ¨¡å¼\r\n   */\r\n  setPreferredExecutionMode(mode: 'scripted' | 'hybrid' | 'scriptless'): void {\r\n    this._preferredExecutionMode.set(mode);\r\n    localStorage.setItem('preferred_execution_mode', mode);\r\n  }\r\n  \r\n  /**\r\n   * ä¿å­˜æ‰€æœ‰è¨­ç½®åˆ°å¾Œç«¯\r\n   */\r\n  saveSettingsToBackend(): void {\r\n    this.ipc.send('save-marketing-settings', {\r\n      intentThreshold: this._intentThreshold(),\r\n      maxConcurrentTasks: this._maxConcurrentTasks(),\r\n      preferredExecutionMode: this._preferredExecutionMode(),\r\n      aiHostingEnabled: this._aiHostingEnabled()\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æ‰‹å‹•è§¸ç™¼ç‹€æ…‹åŒæ­¥\r\n   */\r\n  syncState(): void {\r\n    this.taskService.loadTasks();\r\n    this._lastSyncTime.set(new Date().toISOString());\r\n  }\r\n  \r\n  /**\r\n   * ç²å–å¿«ç…§çµ±è¨ˆ\r\n   */\r\n  getSnapshot(): UnifiedMarketingState {\r\n    return this.unifiedState();\r\n  }\r\n  \r\n  /**\r\n   * å¿«é€Ÿå•Ÿå‹•ä»»å‹™ï¼ˆä»£ç†åˆ° MarketingTaskServiceï¼‰\r\n   */\r\n  async quickStartTask(goalType: string): Promise<string | null> {\r\n    return this.taskService.quickCreate(goalType as any);\r\n  }\r\n  \r\n  /**\r\n   * æª¢æŸ¥æ˜¯å¦å¯ä»¥å•Ÿå‹•æ–°ä»»å‹™\r\n   */\r\n  canStartNewTask(): boolean {\r\n    const maxConcurrent = parseInt(localStorage.getItem('max_concurrent_tasks') || '5');\r\n    return this.taskService.activeTasks().length < maxConcurrent;\r\n  }\r\n  \r\n  /**\r\n   * ç²å–æ¨è–¦çš„ä¸‹ä¸€æ­¥æ“ä½œ\r\n   */\r\n  getRecommendedAction(): { type: string; description: string; action: () => void } | null {\r\n    const state = this.unifiedState();\r\n    \r\n    // æ²’æœ‰é…ç½® AI\r\n    if (!state.aiConnected) {\r\n      return {\r\n        type: 'setup',\r\n        description: 'è«‹å…ˆé…ç½® AI æ¨¡å‹',\r\n        action: () => this.ipc.send('navigate-to', { path: '/ai-center' })\r\n      };\r\n    }\r\n    \r\n    // æ²’æœ‰æ´»èºä»»å‹™\r\n    if (state.activeTasks === 0) {\r\n      return {\r\n        type: 'start',\r\n        description: 'å‰µå»ºæ‚¨çš„ç¬¬ä¸€å€‹ç‡ŸéŠ·ä»»å‹™',\r\n        action: () => this.ipc.send('navigate-to', { path: '/smart-marketing' })\r\n      };\r\n    }\r\n    \r\n    // è½‰åŒ–ç‡ä½\r\n    if (state.collaborationSuccessRate < 10 && state.totalTasks > 5) {\r\n      return {\r\n        type: 'optimize',\r\n        description: 'è½‰åŒ–ç‡åä½ï¼Œå»ºè­°å„ªåŒ– AI äººæ ¼è¨­ç½®',\r\n        action: () => this.ipc.send('navigate-to', { path: '/ai-center', query: { tab: 'persona' } })\r\n      };\r\n    }\r\n    \r\n    return null;\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
