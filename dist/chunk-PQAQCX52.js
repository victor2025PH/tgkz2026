import{a as H}from"./chunk-HZNL35Y2.js";import{r as ue,y as z}from"./chunk-BDXALK3H.js";import{c as pe}from"./chunk-E5JAB72H.js";import"./chunk-A22KDSKM.js";import"./chunk-LAYKK35A.js";import"./chunk-M2VKGXCG.js";import{b as U}from"./chunk-5UHDXNYI.js";import{a as de,b as q}from"./chunk-7LTHB4NI.js";import"./chunk-SIDS6FGB.js";import{a as Q}from"./chunk-5HHK7KPZ.js";import{a as se,b as W,c as K,f as N,k as G,l as L,m as j,t as O}from"./chunk-FZJM4IRN.js";import{b as ce}from"./chunk-CIOQN4KY.js";import"./chunk-B2KG2WNU.js";import"./chunk-TMNXXRHZ.js";import{f as re,h as le}from"./chunk-K5SU4RX2.js";import{Aa as s,Ab as V,Bb as o,Cb as g,Db as b,Eb as R,Fb as $,Ib as T,Jb as F,Kb as k,Na as P,Qb as ae,R as w,W as p,X as m,Zb as E,ac as Z,cb as _,db as C,fb as oe,ga as x,gb as D,hb as A,ia as ne,ib as f,jb as n,kb as t,lb as y,pb as v,rb as u,tb as c,uc as B,wa as ie,zb as S}from"./chunk-PDD6YQ47.js";var _e=(l,i)=>i.id;function Ce(l,i){if(l&1){let e=v();n(0,"button",42),u("click",function(){p(e);let r=c();return m(r.deleteSelected())}),o(1),t()}if(l&2){let e=c();s(),b(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",e.selectedIds().length,") ")}}function fe(l,i){l&1&&(n(0,"div",40),y(1,"span",43),n(2,"span"),o(3,"\u8F09\u5165\u4E2D..."),t()())}function ve(l,i){if(l&1){let e=v();n(0,"div",41)(1,"span",44),o(2,"\u{1F4DA}"),t(),n(3,"h3"),o(4,"\u66AB\u7121\u77E5\u8B58"),t(),n(5,"p"),o(6,"\u9EDE\u64CA\u300C\u6DFB\u52A0\u77E5\u8B58\u300D\u958B\u59CB\u69CB\u5EFA\u77E5\u8B58\u5EAB"),t(),n(7,"button",45),u("click",function(){p(e);let r=c();return m(r.addKnowledge())}),o(8,"\u2795 \u6DFB\u52A0\u77E5\u8B58"),t()()}}function be(l,i){if(l&1){let e=v();n(0,"div",48)(1,"div",49)(2,"input",50),u("change",function(){let r=p(e).$implicit,d=c(2);return m(d.toggleSelect(r.id))}),t()(),n(3,"div",51)(4,"span",52),o(5),t()(),n(6,"div",53),o(7),t(),n(8,"div",54),o(9),t(),n(10,"div",55)(11,"span",56),o(12),t()(),n(13,"div",57),o(14),t(),n(15,"div",58)(16,"button",59),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.editKnowledge(r))}),o(17," \u270F\uFE0F "),t(),n(18,"button",60),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.deleteKnowledge(r))}),o(19," \u{1F5D1}\uFE0F "),t()()()}if(l&2){let e=i.$implicit,a=c(2);S("selected",a.isSelected(e.id)),s(2),f("checked",a.isSelected(e.id)),s(2),V("type-"+e.type),s(),R(" ",a.getTypeIcon(e.type)," ",a.getTypeName(e.type)," "),s(),f("title",e.question),s(),b(" ",a.truncateText(e.question,60)," "),s(),f("title",e.answer),s(),b(" ",a.truncateText(e.answer,80)," "),s(2),S("high",e.successScore>=.7)("low",e.successScore<.4),s(),b(" ",(e.successScore*10).toFixed(1)," "),s(2),b(" ",e.useCount,"\u6B21 ")}}function he(l,i){if(l&1){let e=v();n(0,"div",47)(1,"button",61),u("click",function(){p(e);let r=c(2);return m(r.goToPage(r.currentPage()-1))}),o(2," \u2190 \u4E0A\u4E00\u9801 "),t(),n(3,"span",62),o(4),t(),n(5,"button",61),u("click",function(){p(e);let r=c(2);return m(r.goToPage(r.currentPage()+1))}),o(6," \u4E0B\u4E00\u9801 \u2192 "),t()()}if(l&2){let e=c(2);s(),f("disabled",e.currentPage()===1),s(3),$(" \u7B2C ",e.currentPage()," / ",e.totalPages()," \u9801 \uFF08\u5171 ",e.filteredKnowledge().length," \u689D\uFF09 "),s(),f("disabled",e.currentPage()===e.totalPages())}}function Se(l,i){if(l&1&&(D(0,be,20,17,"div",46,_e),_(2,he,7,5,"div",47)),l&2){let e=c();A(e.paginatedKnowledge()),s(2),C(e.totalPages()>1?2:-1)}}var J=class l{constructor(){this.ragService=w(H);this.dialogService=w(z);this.toastService=w(q);this.ipc=w(Q);this.isLoading=x(!1);this.knowledge=x([]);this.selectedIds=x([]);this.currentPage=x(1);this.pageSize=20;this.searchQuery="";this.typeFilter="all";this.sortOption="createdAt";this.filteredKnowledge=E(()=>{let i=[...this.knowledge()];if(this.searchQuery.trim()){let e=this.searchQuery.toLowerCase();i=i.filter(a=>a.question.toLowerCase().includes(e)||a.answer.toLowerCase().includes(e))}return this.typeFilter!=="all"&&(i=i.filter(e=>e.type===this.typeFilter)),i.sort((e,a)=>{switch(this.sortOption){case"createdAt":return new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime();case"useCount":return a.useCount-e.useCount;case"successScore":return a.successScore-e.successScore;case"type":return e.type.localeCompare(a.type);default:return 0}}),i});this.paginatedKnowledge=E(()=>{let i=(this.currentPage()-1)*this.pageSize;return this.filteredKnowledge().slice(i,i+this.pageSize)});this.totalPages=E(()=>Math.ceil(this.filteredKnowledge().length/this.pageSize));this.totalKnowledge=E(()=>this.knowledge().length);this.typeStats=E(()=>{let i={product:0,qa:0,script:0,faq:0,objection:0,greeting:0,closing:0};return this.knowledge().forEach(e=>{let a=e.type;i[a]!==void 0&&i[a]++}),i});this.avgScore=E(()=>{let i=this.knowledge();return i.length===0?0:i.reduce((e,a)=>e+a.successScore,0)/i.length})}ngOnInit(){this.loadKnowledge()}async loadKnowledge(){this.isLoading.set(!0);try{let i=await this.ipc.invoke("rag-get-all-knowledge",{});i?.success&&i.knowledge&&this.knowledge.set(i.knowledge.map(e=>({id:e.id,type:e.knowledge_type||e.type||"qa",question:e.question||"",answer:e.answer||"",context:e.context||"",successScore:e.success_score||e.successScore||.5,useCount:e.use_count||e.useCount||0,feedbackPositive:e.feedback_positive||0,feedbackNegative:e.feedback_negative||0,isActive:e.is_active!==!1,createdAt:e.created_at||e.createdAt||new Date().toISOString(),updatedAt:e.updated_at||e.updatedAt})))}catch(i){console.error("Failed to load knowledge:",i),this.toastService.error("\u8F09\u5165\u77E5\u8B58\u5931\u6557")}finally{this.isLoading.set(!1)}}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(i){return this.selectedIds().includes(i)}toggleSelect(i){let e=this.selectedIds();e.includes(i)?this.selectedIds.set(e.filter(a=>a!==i)):this.selectedIds.set([...e,i])}addKnowledge(){this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:"\u8ACB\u8F38\u5165\u554F\u984C\uFF1A",placeholder:"\u4F8B\u5982\uFF1A\u8CBB\u7387\u662F\u591A\u5C11\uFF1F",confirmText:"\u4E0B\u4E00\u6B65",onConfirm:i=>{i&&this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:`\u554F\u984C: "${i}"

\u8ACB\u8F38\u5165\u7B54\u6848\uFF1A`,placeholder:"\u5C08\u696D\u7684\u56DE\u7B54...",confirmText:"\u6DFB\u52A0",onConfirm:async e=>{if(e)try{await this.ipc.invoke("rag-add-knowledge",{type:"qa",question:i,answer:e}),this.toastService.success("\u6DFB\u52A0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u6DFB\u52A0\u5931\u6557")}}})}})}editKnowledge(i){this.dialogService.prompt({title:"\u7DE8\u8F2F\u77E5\u8B58",message:`\u554F\u984C: "${i.question}"

\u8ACB\u4FEE\u6539\u7B54\u6848\uFF1A`,placeholder:i.answer,defaultValue:i.answer,confirmText:"\u4FDD\u5B58",onConfirm:async e=>{if(e&&e!==i.answer)try{await this.ipc.invoke("rag-update-knowledge",{id:i.id,answer:e}),this.toastService.success("\u66F4\u65B0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u66F4\u65B0\u5931\u6557")}}})}async deleteKnowledge(i){try{await this.ipc.invoke("rag-delete-knowledge",{id:i.id}),this.knowledge.set(this.knowledge().filter(e=>e.id!==i.id)),this.toastService.success("\u5DF2\u522A\u9664")}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}async deleteSelected(){let i=this.selectedIds();if(i.length!==0)try{await this.ipc.invoke("rag-delete-knowledge-batch",{ids:i}),this.knowledge.set(this.knowledge().filter(e=>!i.includes(e.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${i.length} \u689D`)}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}goToPage(i){i>=1&&i<=this.totalPages()&&this.currentPage.set(i)}truncateText(i,e){return i?i.length>e?i.slice(0,e)+"...":i:""}getTypeIcon(i){return{product:"\u{1F4E6}",qa:"\u{1F4AC}",script:"\u{1F4DC}",faq:"\u2753",objection:"\u{1F6E1}\uFE0F",greeting:"\u{1F44B}",closing:"\u{1F3AF}"}[i]||"\u{1F4DD}"}getTypeName(i){return{product:"\u7522\u54C1",qa:"\u554F\u7B54",script:"\u8A71\u8853",faq:"FAQ",objection:"\u7570\u8B70",greeting:"\u958B\u5834",closing:"\u6210\u4EA4"}[i]||i}static{this.\u0275fac=function(e){return new(e||l)}}static{this.\u0275cmp=P({type:l,selectors:[["app-knowledge-manage"]],decls:97,vars:10,consts:[[1,"knowledge-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","add",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","product"],[1,"stat-card","qa"],[1,"stat-card","script"],[1,"stat-card","score"],[1,"filter-bar"],[1,"filter-left"],[1,"search-box"],["type","text","placeholder","\u641C\u7D22\u77E5\u8B58...",3,"ngModelChange","input","ngModel"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","product"],["value","qa"],["value","script"],["value","faq"],["value","objection"],["value","greeting"],["value","closing"],["value","createdAt"],["value","useCount"],["value","successScore"],["value","type"],[1,"filter-right"],[1,"batch-btn","delete"],[1,"knowledge-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"add-btn",3,"click"],[1,"knowledge-row",3,"selected"],[1,"pagination"],[1,"knowledge-row"],[1,"item-checkbox"],["type","checkbox",3,"change","checked"],[1,"item-type"],[1,"type-tag"],[1,"item-question",3,"title"],[1,"item-answer",3,"title"],[1,"item-score"],[1,"score-badge"],[1,"item-usage"],[1,"item-actions"],["title","\u7DE8\u8F2F",1,"btn-icon","edit",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),o(5,"\u{1F4DD}"),t(),o(6," \u77E5\u8B58\u7BA1\u7406 "),t(),n(7,"p",5),o(8,"\u67E5\u770B\u548C\u7BA1\u7406\u5DF2\u5C0E\u5165\u7684\u6240\u6709\u77E5\u8B58\uFF0C\u652F\u6301\u7DE8\u8F2F\u548C\u522A\u9664"),t()(),n(9,"div",6)(10,"button",7),u("click",function(){return a.addKnowledge()}),o(11," \u2795 \u6DFB\u52A0\u77E5\u8B58 "),t(),n(12,"button",8),u("click",function(){return a.loadKnowledge()}),o(13," \u{1F504} \u5237\u65B0 "),t()()(),n(14,"div",9)(15,"div",10)(16,"div",11),o(17,"\u{1F4DA}"),t(),n(18,"div",12)(19,"span",13),o(20),t(),n(21,"span",14),o(22,"\u77E5\u8B58\u7E3D\u6578"),t()()(),n(23,"div",15)(24,"div",11),o(25,"\u{1F4E6}"),t(),n(26,"div",12)(27,"span",13),o(28),t(),n(29,"span",14),o(30,"\u7522\u54C1\u4FE1\u606F"),t()()(),n(31,"div",16)(32,"div",11),o(33,"\u{1F4AC}"),t(),n(34,"div",12)(35,"span",13),o(36),t(),n(37,"span",14),o(38,"\u554F\u7B54"),t()()(),n(39,"div",17)(40,"div",11),o(41,"\u{1F4DC}"),t(),n(42,"div",12)(43,"span",13),o(44),t(),n(45,"span",14),o(46,"\u8A71\u8853"),t()()(),n(47,"div",18)(48,"div",11),o(49,"\u2B50"),t(),n(50,"div",12)(51,"span",13),o(52),t(),n(53,"span",14),o(54,"\u5E73\u5747\u8A55\u5206"),t()()()(),n(55,"div",19)(56,"div",20)(57,"div",21)(58,"input",22),k("ngModelChange",function(d){return F(a.searchQuery,d)||(a.searchQuery=d),d}),u("input",function(){return a.applyFilters()}),t()(),n(59,"div",23)(60,"label"),o(61,"\u985E\u578B\uFF1A"),t(),n(62,"select",24),k("ngModelChange",function(d){return F(a.typeFilter,d)||(a.typeFilter=d),d}),u("change",function(){return a.applyFilters()}),n(63,"option",25),o(64,"\u5168\u90E8"),t(),n(65,"option",26),o(66,"\u{1F4E6} \u7522\u54C1"),t(),n(67,"option",27),o(68,"\u{1F4AC} \u554F\u7B54"),t(),n(69,"option",28),o(70,"\u{1F4DC} \u8A71\u8853"),t(),n(71,"option",29),o(72,"\u2753 FAQ"),t(),n(73,"option",30),o(74,"\u{1F6E1}\uFE0F \u7570\u8B70\u8655\u7406"),t(),n(75,"option",31),o(76,"\u{1F44B} \u958B\u5834\u767D"),t(),n(77,"option",32),o(78,"\u{1F3AF} \u6210\u4EA4"),t()()(),n(79,"div",23)(80,"label"),o(81,"\u6392\u5E8F\uFF1A"),t(),n(82,"select",24),k("ngModelChange",function(d){return F(a.sortOption,d)||(a.sortOption=d),d}),u("change",function(){return a.applyFilters()}),n(83,"option",33),o(84,"\u{1F550} \u6642\u9593"),t(),n(85,"option",34),o(86,"\u{1F4CA} \u4F7F\u7528\u6B21\u6578"),t(),n(87,"option",35),o(88,"\u2B50 \u8A55\u5206"),t(),n(89,"option",36),o(90,"\u{1F4C2} \u985E\u578B"),t()()()(),n(91,"div",37),_(92,Ce,2,1,"button",38),t()(),n(93,"div",39),_(94,fe,4,0,"div",40)(95,ve,9,0,"div",41)(96,Se,3,1),t()()),e&2&&(s(20),g(a.totalKnowledge()),s(8),g(a.typeStats().product),s(8),g(a.typeStats().qa),s(8),g(a.typeStats().script),s(8),g(a.avgScore().toFixed(1)),s(6),T("ngModel",a.searchQuery),s(4),T("ngModel",a.typeFilter),s(20),T("ngModel",a.sortOption),s(10),C(a.selectedIds().length>0?92:-1),s(2),C(a.isLoading()?94:a.filteredKnowledge().length===0?95:96))},dependencies:[B,O,L,j,W,G,K,N],styles:[".knowledge-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.add[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08)}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.stat-card.qa[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.script[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.score[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 14px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;width:200px}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;cursor:pointer}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.knowledge-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.knowledge-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 100px 1fr 1.5fr 60px 60px 80px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.knowledge-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.knowledge-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.knowledge-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.item-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.type-tag[_ngcontent-%COMP%]{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:500;white-space:nowrap}.type-tag.type-product[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.type-tag.type-qa[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.type-tag.type-script[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.type-tag.type-faq[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.type-tag.type-objection[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.type-tag.type-greeting[_ngcontent-%COMP%]{background:#06b6d433;color:#22d3ee}.type-tag.type-closing[_ngcontent-%COMP%]{background:#ec489933;color:#f472b6}.item-question[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0}.item-answer[_ngcontent-%COMP%]{font-size:13px;color:#888}.score-badge[_ngcontent-%COMP%]{padding:3px 8px;border-radius:10px;font-size:12px;background:#64748b33;color:#94a3b8}.score-badge.high[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.score-badge.low[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.item-usage[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.item-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}.btn-icon.edit[_ngcontent-%COMP%]{background:#3b82f633}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0 0 20px}.add-btn[_ngcontent-%COMP%]{padding:12px 24px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:10px;color:#fff;font-size:14px;cursor:pointer}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 80px 1fr 60px 60px}.item-answer[_ngcontent-%COMP%]{display:none}}@media(max-width:768px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 1fr 60px 60px}.item-type[_ngcontent-%COMP%]{display:none}}"]})}};var we=(l,i)=>i.id;function Ee(l,i){if(l&1){let e=v();n(0,"button",38),u("click",function(){p(e);let r=c();return m(r.deleteSelected())}),o(1),t(),n(2,"button",39),u("click",function(){p(e);let r=c();return m(r.batchResolve())}),o(3," \u2705 \u6279\u91CF\u63A1\u7528 "),t()}if(l&2){let e=c();s(),b(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",e.selectedIds().length,") ")}}function ye(l,i){l&1&&(n(0,"div",36),y(1,"span",40),n(2,"span"),o(3,"\u8F09\u5165\u4E2D..."),t()())}function De(l,i){l&1&&(n(0,"div",37)(1,"span",41),o(2,"\u2728"),t(),n(3,"h3"),o(4,"\u6C92\u6709\u5F85\u8655\u7406\u7684\u77E5\u8B58\u7F3A\u53E3"),t(),n(5,"p"),o(6,"\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01"),t()())}function Ae(l,i){if(l&1&&(n(0,"div",52)(1,"span",61),o(2,"\u{1F4A1} AI:"),t(),o(3),t()),l&2){let e=c().$implicit,a=c(2);s(3),b(" ",a.truncateText(e.suggestedAnswer,100)," ")}}function Me(l,i){l&1&&(n(0,"span",55),o(1,"\u{1F525}"),t())}function Te(l,i){if(l&1){let e=v();n(0,"button",62),u("click",function(){p(e);let r=c().$implicit,d=c(2);return m(d.generateAnswer(r))}),o(1," \u{1F916} "),t()}}function Fe(l,i){if(l&1){let e=v();n(0,"div",44)(1,"div",45)(2,"input",46),u("change",function(){let r=p(e).$implicit,d=c(2);return m(d.toggleSelect(r.id))}),t()(),n(3,"div",47),o(4),t(),n(5,"div",48)(6,"span",49),o(7),t()(),n(8,"div",50)(9,"div",51),o(10),t(),_(11,Ae,4,1,"div",52),t(),n(12,"div",53)(13,"span",54),o(14),t(),_(15,Me,2,0,"span",55),t(),n(16,"div",56),o(17),t(),n(18,"div",57),_(19,Te,2,0,"button",58),n(20,"button",59),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.resolveGap(r))}),o(21," \u2705 "),t(),n(22,"button",60),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.deleteGap(r))}),o(23," \u{1F5D1}\uFE0F "),t()()()}if(l&2){let e=i.$implicit,a=i.$index,r=c(2);S("selected",r.isSelected(e.id)),s(2),f("checked",r.isSelected(e.id)),s(2),g((r.currentPage()-1)*r.pageSize+a+1),s(2),V("cat-"+(e.category||"other")),s(),b(" ",r.getCategoryIcon(e.category)," "),s(2),f("title",e.query),s(),b(" ",r.truncateText(e.query,80)," "),s(),C(e.suggestedAnswer?11:-1),s(2),S("hot",e.hitCount>=5),s(),b(" ",e.hitCount,"\u6B21 "),s(),C(e.hitCount>=5?15:-1),s(2),b(" ",r.formatTime(e.createdAt)," "),s(2),C(e.suggestedAnswer?-1:19)}}function ke(l,i){if(l&1){let e=v();n(0,"div",43)(1,"button",63),u("click",function(){p(e);let r=c(2);return m(r.goToPage(r.currentPage()-1))}),o(2," \u2190 \u4E0A\u4E00\u9801 "),t(),n(3,"span",64),o(4),t(),n(5,"button",63),u("click",function(){p(e);let r=c(2);return m(r.goToPage(r.currentPage()+1))}),o(6," \u4E0B\u4E00\u9801 \u2192 "),t()()}if(l&2){let e=c(2);s(),f("disabled",e.currentPage()===1),s(3),$(" \u7B2C ",e.currentPage()," / ",e.totalPages()," \u9801 \uFF08\u5171 ",e.filteredGaps().length," \u689D\uFF09 "),s(),f("disabled",e.currentPage()===e.totalPages())}}function Ie(l,i){if(l&1&&(D(0,Fe,24,16,"div",42,we),_(2,ke,7,5,"div",43)),l&2){let e=c();A(e.paginatedGaps()),s(2),C(e.totalPages()>1?2:-1)}}var Y=class l{constructor(){this.ragService=w(H);this.dialogService=w(z);this.toastService=w(q);this.isLoading=x(!1);this.gaps=x([]);this.selectedIds=x([]);this.currentPage=x(1);this.pageSize=20;this.categoryFilter="all";this.sortOption="hitCount";this.filteredGaps=E(()=>{let i=[...this.gaps()];return this.categoryFilter!=="all"&&(i=i.filter(e=>(e.category||"other")===this.categoryFilter)),i.sort((e,a)=>{switch(this.sortOption){case"hitCount":return a.hitCount-e.hitCount;case"createdAt":return new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime();case"category":return(e.category||"z").localeCompare(a.category||"z");default:return 0}}),i});this.paginatedGaps=E(()=>{let i=(this.currentPage()-1)*this.pageSize;return this.filteredGaps().slice(i,i+this.pageSize)});this.totalPages=E(()=>Math.ceil(this.filteredGaps().length/this.pageSize));this.totalGaps=E(()=>this.gaps().length);this.hotGapsCount=E(()=>this.gaps().filter(i=>i.hitCount>=5).length);this.categoryStats=E(()=>{let i={price:0,process:0,product:0,support:0,other:0};return this.gaps().forEach(e=>{let a=e.category||"other";i[a]!==void 0&&i[a]++}),i})}ngOnInit(){this.loadGaps()}async loadGaps(){this.isLoading.set(!0);try{await this.ragService.getKnowledgeGaps(),this.gaps.set(this.ragService.knowledgeGaps())}finally{this.isLoading.set(!1)}}refreshGaps(){this.loadGaps(),this.toastService.success("\u5DF2\u5237\u65B0")}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(i){return this.selectedIds().includes(i)}toggleSelect(i){let e=this.selectedIds();e.includes(i)?this.selectedIds.set(e.filter(a=>a!==i)):this.selectedIds.set([...e,i])}isAllSelected(){let i=this.paginatedGaps();return i.length>0&&i.every(e=>this.selectedIds().includes(e.id))}isPartialSelected(){let i=this.paginatedGaps(),e=i.filter(a=>this.selectedIds().includes(a.id));return e.length>0&&e.length<i.length}toggleSelectAll(){let i=this.paginatedGaps();if(this.isAllSelected()){let e=i.map(a=>a.id);this.selectedIds.set(this.selectedIds().filter(a=>!e.includes(a)))}else{let e=[...new Set([...this.selectedIds(),...i.map(a=>a.id)])];this.selectedIds.set(e)}}generateAnswer(i){this.ragService.suggestGapAnswer(i.id,i.query),this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...")}resolveGap(i){let e=i.suggestedAnswer||"";this.dialogService.prompt({title:"\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",message:`\u554F\u984C: "${this.truncateText(i.query,60)}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,placeholder:e||"\u5C08\u696D\u7684\u56DE\u7B54...",defaultValue:e,confirmText:"\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",onConfirm:a=>{a&&(this.ragService.resolveGap(i.id,"faq",i.query,a),this.toastService.success("\u5DF2\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB"),this.loadGaps())}})}deleteGap(i){this.ragService.deleteGap(i.id),this.gaps.set(this.gaps().filter(e=>e.id!==i.id)),this.toastService.success("\u5DF2\u522A\u9664")}deleteSelected(){let i=this.selectedIds();i.length!==0&&(this.ragService.deleteGapsBatch(i),this.gaps.set(this.gaps().filter(e=>!i.includes(e.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${i.length} \u689D`))}batchResolve(){let i=this.paginatedGaps().filter(e=>this.selectedIds().includes(e.id)&&e.suggestedAnswer);if(i.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u6709 AI \u5EFA\u8B70\u7684\u7F3A\u53E3");return}i.forEach(e=>{this.ragService.resolveGap(e.id,"faq",e.query,e.suggestedAnswer)}),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u6279\u91CF\u63A1\u7528 ${i.length} \u689D`),this.loadGaps()}cleanupAllInvalid(){this.ragService.cleanupDuplicateGaps(),this.toastService.info("\u6B63\u5728\u6DF1\u5EA6\u6E05\u7406..."),setTimeout(()=>this.loadGaps(),1500)}goToPage(i){i>=1&&i<=this.totalPages()&&(this.currentPage.set(i),this.selectedIds.set([]))}truncateText(i,e){return i?i.length>e?i.slice(0,e)+"...":i:""}getCategoryIcon(i){return{price:"\u{1F4B0}",process:"\u{1F4CB}",product:"\u{1F4E6}",support:"\u{1F6E0}\uFE0F",other:"\u2753"}[i||"other"]||"\u2753"}formatTime(i){if(!i)return"";let e=new Date(i),r=new Date().getTime()-e.getTime();return r<6e4?"\u525B\u525B":r<36e5?`${Math.floor(r/6e4)} \u5206\u9418\u524D`:r<864e5?`${Math.floor(r/36e5)} \u5C0F\u6642\u524D`:r<6048e5?`${Math.floor(r/864e5)} \u5929\u524D`:e.toLocaleDateString("zh-TW")}static{this.\u0275fac=function(e){return new(e||l)}}static{this.\u0275cmp=P({type:l,selectors:[["app-knowledge-gaps"]],decls:93,vars:11,consts:[[1,"gaps-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","cleanup",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","hot"],[1,"stat-card","price"],[1,"stat-card","process"],[1,"stat-card","product"],[1,"filter-bar"],[1,"filter-left"],[1,"select-all"],["type","checkbox",3,"change","checked","indeterminate"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","price"],["value","process"],["value","product"],["value","support"],["value","other"],["value","hitCount"],["value","createdAt"],["value","category"],[1,"filter-right"],[1,"gaps-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"batch-btn","resolve",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"gap-row",3,"selected"],[1,"pagination"],[1,"gap-row"],[1,"gap-checkbox"],["type","checkbox",3,"change","checked"],[1,"gap-index"],[1,"gap-category"],[1,"category-tag"],[1,"gap-content"],[1,"gap-query",3,"title"],[1,"gap-answer"],[1,"gap-hits"],[1,"hits-badge"],[1,"hot-tag"],[1,"gap-time"],[1,"gap-actions"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate"],["title","\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",1,"btn-icon","resolve",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"answer-label"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),o(5,"\u2753"),t(),o(6," \u77E5\u8B58\u7F3A\u53E3\u7BA1\u7406 "),t(),n(7,"p",5),o(8,"\u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u7B54\u6848\u7684\u554F\u984C\uFF0C\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C\u53EF\u63D0\u5347 AI \u56DE\u8986\u8CEA\u91CF"),t()(),n(9,"div",6)(10,"button",7),u("click",function(){return a.cleanupAllInvalid()}),o(11," \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 "),t(),n(12,"button",8),u("click",function(){return a.refreshGaps()}),o(13," \u{1F504} \u5237\u65B0 "),t()()(),n(14,"div",9)(15,"div",10)(16,"div",11),o(17,"\u{1F4CB}"),t(),n(18,"div",12)(19,"span",13),o(20),t(),n(21,"span",14),o(22,"\u5F85\u8655\u7406"),t()()(),n(23,"div",15)(24,"div",11),o(25,"\u{1F525}"),t(),n(26,"div",12)(27,"span",13),o(28),t(),n(29,"span",14),o(30,"\u71B1\u9580\u554F\u984C"),t()()(),n(31,"div",16)(32,"div",11),o(33,"\u{1F4B0}"),t(),n(34,"div",12)(35,"span",13),o(36),t(),n(37,"span",14),o(38,"\u50F9\u683C\u76F8\u95DC"),t()()(),n(39,"div",17)(40,"div",11),o(41,"\u{1F4CB}"),t(),n(42,"div",12)(43,"span",13),o(44),t(),n(45,"span",14),o(46,"\u6D41\u7A0B\u76F8\u95DC"),t()()(),n(47,"div",18)(48,"div",11),o(49,"\u{1F4E6}"),t(),n(50,"div",12)(51,"span",13),o(52),t(),n(53,"span",14),o(54,"\u7522\u54C1\u76F8\u95DC"),t()()()(),n(55,"div",19)(56,"div",20)(57,"label",21)(58,"input",22),u("change",function(){return a.toggleSelectAll()}),t(),n(59,"span"),o(60,"\u5168\u9078"),t()(),n(61,"div",23)(62,"label"),o(63,"\u5206\u985E\uFF1A"),t(),n(64,"select",24),k("ngModelChange",function(d){return F(a.categoryFilter,d)||(a.categoryFilter=d),d}),u("change",function(){return a.applyFilters()}),n(65,"option",25),o(66,"\u5168\u90E8"),t(),n(67,"option",26),o(68,"\u{1F4B0} \u50F9\u683C"),t(),n(69,"option",27),o(70,"\u{1F4CB} \u6D41\u7A0B"),t(),n(71,"option",28),o(72,"\u{1F4E6} \u7522\u54C1"),t(),n(73,"option",29),o(74,"\u{1F6E0}\uFE0F \u552E\u5F8C"),t(),n(75,"option",30),o(76,"\u2753 \u5176\u4ED6"),t()()(),n(77,"div",23)(78,"label"),o(79,"\u6392\u5E8F\uFF1A"),t(),n(80,"select",24),k("ngModelChange",function(d){return F(a.sortOption,d)||(a.sortOption=d),d}),u("change",function(){return a.applyFilters()}),n(81,"option",31),o(82,"\u{1F525} \u71B1\u5EA6"),t(),n(83,"option",32),o(84,"\u{1F550} \u6642\u9593"),t(),n(85,"option",33),o(86,"\u{1F4C2} \u5206\u985E"),t()()()(),n(87,"div",34),_(88,Ee,4,1),t()(),n(89,"div",35),_(90,ye,4,0,"div",36)(91,De,7,0,"div",37)(92,Ie,3,1),t()()),e&2&&(s(20),g(a.totalGaps()),s(8),g(a.hotGapsCount()),s(8),g(a.categoryStats().price),s(8),g(a.categoryStats().process),s(8),g(a.categoryStats().product),s(6),f("checked",a.isAllSelected())("indeterminate",a.isPartialSelected()),s(6),T("ngModel",a.categoryFilter),s(16),T("ngModel",a.sortOption),s(8),C(a.selectedIds().length>0?88:-1),s(2),C(a.isLoading()?90:a.filteredGaps().length===0?91:92))},dependencies:[B,O,L,j,G,K,N],styles:[".gaps-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.cleanup[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08);transition:all .2s}.stat-card[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#ffffff26}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.hot[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.stat-card.price[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.process[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.select-all[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;color:#aaa}.select-all[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;cursor:pointer}.filter-right[_ngcontent-%COMP%]{display:flex;gap:10px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.batch-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.batch-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.gaps-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.gap-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 40px 50px 1fr 80px 80px 100px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.gap-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.gap-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.gap-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.gap-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7;cursor:pointer}.gap-index[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-category[_ngcontent-%COMP%]{text-align:center}.category-tag[_ngcontent-%COMP%]{font-size:18px}.gap-content[_ngcontent-%COMP%]{min-width:0}.gap-query[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;line-height:1.4;margin-bottom:4px}.gap-answer[_ngcontent-%COMP%]{font-size:12px;color:#888;padding:6px 10px;background:#a855f71a;border-radius:6px;margin-top:6px}.answer-label[_ngcontent-%COMP%]{color:#a855f7;margin-right:4px}.gap-hits[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;justify-content:center}.hits-badge[_ngcontent-%COMP%]{padding:3px 8px;background:#64748b33;border-radius:10px;font-size:12px;color:#94a3b8}.hits-badge.hot[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.hot-tag[_ngcontent-%COMP%]{font-size:14px}.gap-time[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}.btn-icon.generate[_ngcontent-%COMP%]{background:#a855f733}.btn-icon.resolve[_ngcontent-%COMP%]{background:#10b98133}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media(max-width:900px){.gap-row[_ngcontent-%COMP%]{grid-template-columns:40px 40px 1fr 60px 80px}.gap-category[_ngcontent-%COMP%], .gap-time[_ngcontent-%COMP%]{display:none}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media(max-width:600px){.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.filter-left[_ngcontent-%COMP%], .filter-right[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}};var Pe=()=>["short","medium","long"],I=(l,i)=>i.id,Be=(l,i)=>i.phone,Oe=(l,i)=>i.name;function Ve(l,i){l&1&&(n(0,"span",7),y(1,"span",21),o(2," AI \u5DF2\u9023\u63A5 "),t())}function Ke(l,i){l&1&&(n(0,"span",8),o(1," \u672A\u914D\u7F6E AI "),t())}function Ne(l,i){if(l&1){let e=v();n(0,"button",22),u("click",function(){let r=p(e).$implicit,d=c();return m(d.selectTab(r.id))}),n(1,"span",23),o(2),t(),n(3,"span"),o(4),t()()}if(l&2){let e=i.$implicit,a=c();S("bg-gradient-to-r",a.activeTab()===e.id)("from-purple-500",a.activeTab()===e.id)("to-pink-500",a.activeTab()===e.id)("text-white",a.activeTab()===e.id)("shadow-lg",a.activeTab()===e.id)("text-slate-400",a.activeTab()!==e.id)("hover:text-white",a.activeTab()!==e.id)("hover:bg-slate-700/50",a.activeTab()!==e.id),s(2),g(e.icon),s(2),g(e.label)}}function Ge(l,i){if(l&1){let e=v();n(0,"div",30)(1,"div")(2,"label",56),o(3,"\u804A\u5929\u6A21\u5F0F"),t(),n(4,"div",57)(5,"button",58),u("click",function(){p(e);let r=c(2);return m(r.setAutoChatMode("full"))}),n(6,"div",59),o(7,"\u{1F680}"),t(),n(8,"div",60),o(9,"\u5168\u81EA\u52D5"),t(),n(10,"div",61),o(11,"AI \u81EA\u52D5\u767C\u9001\u56DE\u8986"),t()(),n(12,"button",58),u("click",function(){p(e);let r=c(2);return m(r.setAutoChatMode("semi"))}),n(13,"div",59),o(14,"\u{1F465}"),t(),n(15,"div",60),o(16,"\u534A\u81EA\u52D5"),t(),n(17,"div",61),o(18,"\u751F\u6210\u5EFA\u8B70\u5F8C\u78BA\u8A8D\u767C\u9001"),t()(),n(19,"button",58),u("click",function(){p(e);let r=c(2);return m(r.setAutoChatMode("assist"))}),n(20,"div",59),o(21,"\u{1F4A1}"),t(),n(22,"div",60),o(23,"\u8F14\u52A9\u6A21\u5F0F"),t(),n(24,"div",61),o(25,"\u50C5\u63D0\u4F9B\u5EFA\u8B70\u4E0D\u767C\u9001"),t()()()(),n(26,"div",62)(27,"div",63)(28,"div",50)(29,"span",64),o(30,"\u{1F44B}"),t(),n(31,"div")(32,"div",60),o(33,"\u81EA\u52D5\u554F\u5019"),t(),n(34,"div",61),o(35,"\u65B0 Lead \u81EA\u52D5\u767C\u9001\u554F\u5019"),t()()(),n(36,"input",65),u("change",function(){p(e);let r=c(2);return m(r.toggleAutoGreeting())}),t()(),n(37,"div",63)(38,"div",50)(39,"span",64),o(40,"\u{1F4AC}"),t(),n(41,"div")(42,"div",60),o(43,"\u81EA\u52D5\u56DE\u8986"),t(),n(44,"div",61),o(45,"\u7528\u6236\u79C1\u4FE1\u81EA\u52D5\u56DE\u8986"),t()()(),n(46,"input",65),u("change",function(){p(e);let r=c(2);return m(r.toggleAutoReply())}),t()()()()}if(l&2){let e=c(2);s(5),S("bg-emerald-500/20",e.autoChatMode()==="full")("border-emerald-500",e.autoChatMode()==="full")("bg-slate-700/50",e.autoChatMode()!=="full")("border-slate-600",e.autoChatMode()!=="full"),s(7),S("bg-cyan-500/20",e.autoChatMode()==="semi")("border-cyan-500",e.autoChatMode()==="semi")("bg-slate-700/50",e.autoChatMode()!=="semi")("border-slate-600",e.autoChatMode()!=="semi"),s(7),S("bg-amber-500/20",e.autoChatMode()==="assist")("border-amber-500",e.autoChatMode()==="assist")("bg-slate-700/50",e.autoChatMode()!=="assist")("border-slate-600",e.autoChatMode()!=="assist"),s(17),f("checked",e.autoGreetingEnabled()),s(10),f("checked",e.autoReplyEnabled())}}function Le(l,i){if(l&1&&y(0,"img",67),l&2){let e=c().$implicit;f("src",e.avatar,ie)}}function je(l,i){if(l&1&&(n(0,"span",68),o(1),t()),l&2){let e=c().$implicit;s(),g((e.username==null?null:e.username.charAt(0))||"?")}}function qe(l,i){if(l&1&&(n(0,"div",47)(1,"div",50)(2,"div",66),_(3,Le,1,1,"img",67)(4,je,2,1,"span",68),t(),n(5,"div")(6,"div",60),o(7),t(),n(8,"div",61),o(9),t()()(),n(10,"span",69),y(11,"span",21),o(12," \u5728\u7DDA "),t()()),l&2){let e=i.$implicit;s(3),C(e.avatar?3:4),s(4),g(e.username||e.phone),s(2),R("\u4ECA\u65E5: ",e.sentToday||0,"/",e.dailyLimit||50," \u689D")}}function ze(l,i){l&1&&(n(0,"div",48)(1,"div",70),o(2,"\u{1F4E4}"),t(),n(3,"p"),o(4,"\u6C92\u6709\u53EF\u7528\u7684\u767C\u9001\u5E33\u865F"),t(),n(5,"p",71),o(6,"\u8ACB\u5728\u5E33\u865F\u7BA1\u7406\u4E2D\u6DFB\u52A0\u4E26\u8A2D\u7F6E\u70BA\u300C\u767C\u9001\u300D\u89D2\u8272"),t()())}function Re(l,i){if(l&1&&(n(0,"div",52)(1,"div",72),o(2),t(),n(3,"div",73)(4,"div",60),o(5),t(),n(6,"div",45),o(7),t()(),n(8,"span",74),y(9,"span",21),o(10," \u5DF2\u9023\u63A5 "),t()()),l&2){let e=c(2);s(2),b(" ",e.getProviderIcon(e.aiService.defaultModel().provider)," "),s(3),g(e.aiService.defaultModel().modelName),s(2),g(e.getProviderName(e.aiService.defaultModel().provider))}}function $e(l,i){l&1&&(n(0,"div",53)(1,"div",50)(2,"span",5),o(3,"\u26A0\uFE0F"),t(),n(4,"div")(5,"div",75),o(6,"\u672A\u914D\u7F6E AI \u6A21\u578B"),t(),n(7,"div",45),o(8,"\u8ACB\u5148\u6DFB\u52A0 AI \u6A21\u578B\u624D\u80FD\u4F7F\u7528\u81EA\u52D5\u804A\u5929\u529F\u80FD"),t()()()())}function We(l,i){if(l&1){let e=v();n(0,"div",18)(1,"div",24)(2,"div",2)(3,"div",3)(4,"div",25),o(5," \u{1F916} "),t(),n(6,"div")(7,"h3",26),o(8,"AI \u81EA\u52D5\u804A\u5929"),t(),n(9,"p",27),o(10,"\u958B\u555F\u5F8C\uFF0CAI \u5C07\u81EA\u52D5\u554F\u5019\u65B0 Lead \u4E26\u56DE\u8986\u79C1\u4FE1"),t()()(),n(11,"button",28),u("click",function(){p(e);let r=c();return m(r.toggleAutoChat())}),y(12,"span",29),t()(),_(13,Ge,47,26,"div",30),t(),n(14,"div",31)(15,"div",2)(16,"div",3)(17,"div",32),o(18," \u{1F680} "),t(),n(19,"div")(20,"h3",33),o(21," \u667A\u80FD\u71DF\u92B7\u4E2D\u5FC3 "),n(22,"span",34),o(23,"\u6574\u5408"),t()(),n(24,"p",27),o(25,"\u4E00\u9375\u555F\u52D5\u71DF\u92B7\u4EFB\u52D9 - AI \u81EA\u52D5\u914D\u7F6E\u89D2\u8272\u548C\u7B56\u7565"),t()()(),n(26,"button",35),u("click",function(){p(e);let r=c();return m(r.goToSmartMarketing())}),n(27,"span"),o(28,"\u{1F680}"),t(),o(29," \u524D\u5F80\u4F7F\u7528 "),t()(),n(30,"div",36)(31,"div",37)(32,"div",38)(33,"div",39),o(34,"\u{1F4B0}"),t(),n(35,"div",40),o(36,"\u4FC3\u9032\u9996\u55AE"),t()(),n(37,"div",38)(38,"div",39),o(39,"\u{1F49D}"),t(),n(40,"div",40),o(41,"\u633D\u56DE\u6D41\u5931"),t()(),n(42,"div",38)(43,"div",39),o(44,"\u{1F389}"),t(),n(45,"div",40),o(46,"\u793E\u7FA4\u6D3B\u8E8D"),t()(),n(47,"div",38)(48,"div",39),o(49,"\u{1F527}"),t(),n(50,"div",40),o(51,"\u552E\u5F8C\u670D\u52D9"),t()()(),n(52,"p",41),o(53," \u{1F4A1} \u9078\u64C7\u76EE\u6A19 \u2192 AI \u81EA\u52D5\u914D\u7F6E \u2192 \u4E00\u9375\u555F\u52D5\uFF0C\u5DF2\u6574\u5408\u591A\u89D2\u8272\u5354\u4F5C\u548C AI \u81EA\u4E3B\u529F\u80FD "),t()()(),n(54,"div",42)(55,"div",43)(56,"span",5),o(57,"\u{1F4E4}"),t(),n(58,"div")(59,"h3",44),o(60,"\u767C\u9001\u5E33\u865F"),t(),n(61,"p",45),o(62,"\u9078\u64C7\u7528\u65BC\u767C\u9001\u6D88\u606F\u7684\u5E33\u865F"),t()()(),n(63,"div",46),D(64,qe,13,4,"div",47,Be,!1,ze,7,0,"div",48),t()(),n(67,"div",42)(68,"div",49)(69,"div",50)(70,"span",5),o(71,"\u{1F9E0}"),t(),n(72,"div")(73,"h3",44),o(74,"AI \u6A21\u578B"),t(),n(75,"p",45),o(76,"\u7576\u524D\u4F7F\u7528\u7684 AI \u6A21\u578B"),t()()(),n(77,"button",51),u("click",function(){p(e);let r=c();return m(r.activeTab.set("models"))}),o(78," \u914D\u7F6E\u6A21\u578B \u2192 "),t()(),_(79,Re,11,3,"div",52)(80,$e,9,0,"div",53),t(),n(81,"div",54)(82,"button",55),u("click",function(){p(e);let r=c();return m(r.saveQuickSettings())}),o(83," \u{1F4BE} \u4FDD\u5B58\u8A2D\u7F6E "),t()()()}if(l&2){let e=c();s(11),S("bg-emerald-500",e.autoChatEnabled())("bg-slate-600",!e.autoChatEnabled()),s(),S("translate-x-8",e.autoChatEnabled()),s(),C(e.autoChatEnabled()?13:-1),s(51),A(e.senderAccounts()),s(15),C(e.aiService.defaultModel()?79:80)}}function Qe(l,i){l&1&&(n(0,"span",69),y(1,"span",21),o(2," \u5DF2\u9023\u63A5 "),t())}function Ue(l,i){l&1&&(n(0,"span",97),o(1,"\u672A\u6E2C\u8A66"),t())}function He(l,i){l&1&&(y(0,"span",101),o(1," \u6E2C\u8A66\u4E2D... "))}function Je(l,i){l&1&&o(0," \u6E2C\u8A66 ")}function Ye(l,i){if(l&1){let e=v();n(0,"div",81)(1,"div",3)(2,"div",95)(3,"span",5),o(4,"\u{1F999}"),t()(),n(5,"div")(6,"div",60),o(7),t(),n(8,"div",96),o(9),t()()(),n(10,"div",50),_(11,Qe,3,0,"span",69)(12,Ue,2,0,"span",97),n(13,"button",98),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.testModel(r))}),_(14,He,2,0)(15,Je,1,0),t(),n(16,"button",99),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.setAsDefault(r))}),o(17),t(),n(18,"button",100),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.deleteModel(r))}),o(19," \u2715 "),t()()()}if(l&2){let e,a,r=i.$implicit,d=c(2);s(7),g(r.displayName||r.modelName),s(2),g(r.apiEndpoint),s(2),C(r.isConnected?11:12),s(2),f("disabled",d.aiService.testingModelIds().has(r.id)),s(),C(d.aiService.testingModelIds().has(r.id)?14:15),s(2),V(((e=d.aiService.defaultModel())==null?null:e.id)===r.id?"bg-emerald-500 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"),s(),b(" ",((a=d.aiService.defaultModel())==null?null:a.id)===r.id?"\u9ED8\u8A8D":"\u8A2D\u70BA\u9ED8\u8A8D"," ")}}function Xe(l,i){if(l&1){let e=v();n(0,"div",82)(1,"p",102),o(2,"\u4F7F\u7528\u672C\u5730 Ollama \u53EF\u514D\u8CBB\u7121\u9650\u8ABF\u7528 AI"),t(),n(3,"button",103),u("click",function(){p(e);let r=c(2);return m(r.showAddLocalModel.set(!0))}),o(4," \u{1F999} \u5FEB\u901F\u914D\u7F6E\u672C\u5730 AI "),t()()}}function Ze(l,i){l&1&&(n(0,"span",69),y(1,"span",21),o(2," \u5DF2\u9023\u63A5 "),t())}function et(l,i){l&1&&(n(0,"span",105),o(1,"\u672A\u9023\u63A5"),t())}function tt(l,i){l&1&&(y(0,"span",101),o(1," \u6E2C\u8A66\u4E2D... "))}function nt(l,i){l&1&&o(0," \u6E2C\u8A66 ")}function it(l,i){if(l&1){let e=v();n(0,"div",84)(1,"div",3)(2,"div",104)(3,"span",5),o(4),t()(),n(5,"div")(6,"div",60),o(7),t(),n(8,"div",45),o(9),t()()(),n(10,"div",50),_(11,Ze,3,0,"span",69)(12,et,2,0,"span",105),n(13,"button",98),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.testModel(r))}),_(14,tt,2,0)(15,nt,1,0),t(),n(16,"button",99),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.setAsDefault(r))}),o(17),t(),n(18,"button",100),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.deleteModel(r))}),o(19," \u2715 "),t()()()}if(l&2){let e,a,r=i.$implicit,d=c(2);s(2),S("bg-emerald-500/20",r.provider==="openai")("bg-purple-500/20",r.provider==="claude")("bg-blue-500/20",r.provider==="gemini"),s(2),g(d.getProviderIcon(r.provider)),s(3),g(r.displayName||r.modelName),s(2),g(d.getProviderName(r.provider)),s(2),C(r.isConnected?11:12),s(2),f("disabled",d.aiService.testingModelIds().has(r.id)),s(),C(d.aiService.testingModelIds().has(r.id)?14:15),s(2),V(((e=d.aiService.defaultModel())==null?null:e.id)===r.id?"bg-purple-500 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"),s(),b(" ",((a=d.aiService.defaultModel())==null?null:a.id)===r.id?"\u9ED8\u8A8D":"\u8A2D\u70BA\u9ED8\u8A8D"," ")}}function ot(l,i){if(l&1){let e=v();n(0,"div",82)(1,"p",102),o(2,"\u6DFB\u52A0 OpenAI\u3001Claude \u6216 Gemini \u7B49\u96F2\u7AEF\u6A21\u578B"),t(),n(3,"button",106),u("click",function(){p(e);let r=c(2);return m(r.showAddModel.set(!0))}),o(4," + \u6DFB\u52A0\u96F2\u7AEF\u6A21\u578B "),t()()}}function at(l,i){l&1&&(n(0,"span",108)(1,"span",115),o(2,"\u27F3"),t(),o(3," \u4FDD\u5B58\u4E2D... "),t())}function rt(l,i){l&1&&(n(0,"span",108),o(1," \u2713 \u5DF2\u4FDD\u5B58 "),t())}function lt(l,i){if(l&1&&(n(0,"option",113),o(1),t()),l&2){let e=i.$implicit,a=c(3);f("value",e.id)("selected",e.id===a.aiService.modelUsage().intentRecognition),s(),b(" ",e.displayName||e.modelName," ")}}function st(l,i){if(l&1&&(n(0,"option",113),o(1),t()),l&2){let e=i.$implicit,a=c(3);f("value",e.id)("selected",e.id===a.aiService.modelUsage().dailyChat),s(),b(" ",e.displayName||e.modelName," ")}}function dt(l,i){if(l&1&&(n(0,"option",113),o(1),t()),l&2){let e=i.$implicit,a=c(3);f("value",e.id)("selected",e.id===a.aiService.modelUsage().multiRoleScript),s(),b(" ",e.displayName||e.modelName," ")}}function ct(l,i){if(l&1){let e=v();n(0,"div",85)(1,"div",49)(2,"h4",107),o(3,"\u6A21\u578B\u7528\u9014\u5206\u914D"),t(),_(4,at,4,0,"span",108)(5,rt,2,0,"span",108),t(),n(6,"div",109)(7,"div")(8,"label",110),o(9,"\u610F\u5716\u8B58\u5225"),t(),n(10,"select",111),u("change",function(r){p(e);let d=c(2);return m(d.onModelUsageChange("intentRecognition",r))}),n(11,"option",112),o(12,"\u9078\u64C7\u6A21\u578B"),t(),D(13,lt,2,3,"option",113,I),t()(),n(15,"div")(16,"label",110),o(17,"\u65E5\u5E38\u5C0D\u8A71"),t(),n(18,"select",111),u("change",function(r){p(e);let d=c(2);return m(d.onModelUsageChange("dailyChat",r))}),n(19,"option",112),o(20,"\u9078\u64C7\u6A21\u578B"),t(),D(21,st,2,3,"option",113,I),t()(),n(23,"div")(24,"label",110),o(25,"\u591A\u89D2\u8272\u5287\u672C"),t(),n(26,"select",111),u("change",function(r){p(e);let d=c(2);return m(d.onModelUsageChange("multiRoleScript",r))}),n(27,"option",112),o(28,"\u9078\u64C7\u6A21\u578B"),t(),D(29,dt,2,3,"option",113,I),t()()(),n(31,"p",114),o(32,"\u{1F4A1} \u9078\u64C7\u5F8C\u81EA\u52D5\u4FDD\u5B58\uFF0C\u4E0D\u540C\u7528\u9014\u53EF\u4EE5\u4F7F\u7528\u4E0D\u540C\u7684 AI \u6A21\u578B"),t()()}if(l&2){let e=c(2);s(4),C(e.isSavingUsage()?4:e.usageSaved()?5:-1),s(6),f("value",e.aiService.modelUsage().intentRecognition),s(3),A(e.aiService.models()),s(5),f("value",e.aiService.modelUsage().dailyChat),s(3),A(e.aiService.models()),s(5),f("value",e.aiService.modelUsage().multiRoleScript),s(3),A(e.aiService.models())}}function ut(l,i){l&1&&(y(0,"span",122),o(1," \u6E2C\u8A66\u4E2D... "))}function pt(l,i){l&1&&o(0," \u{1F517} \u6E2C\u8A66\u9023\u63A5 ")}function mt(l,i){if(l&1){let e=v();n(0,"button",123),u("click",function(){p(e);let r=c(3);return m(r.testTtsVoice())}),o(1," \u{1F50A} \u8A66\u807D\u8A9E\u97F3 "),t()}}function gt(l,i){if(l&1&&(n(0,"span",124),o(1),t()),l&2){let e=c(4);s(),b("\xB7 \u5EF6\u9072: ",e.ttsLatency(),"ms")}}function xt(l,i){if(l&1&&(n(0,"div",121),y(1,"span",21),o(2," TTS \u670D\u52D9\u5DF2\u9023\u63A5 "),_(3,gt,2,1,"span",124),t()),l&2){let e=c(3);s(3),C(e.ttsLatency()>0?3:-1)}}function _t(l,i){if(l&1){let e=v();n(0,"div",93)(1,"div")(2,"label",56),o(3,"TTS \u670D\u52D9\u7AEF\u9EDE"),t(),n(4,"input",116),k("ngModelChange",function(r){p(e);let d=c(2);return F(d.ttsEndpoint,r)||(d.ttsEndpoint=r),m(r)}),t(),n(5,"p",117),o(6,"\u652F\u6301 GPT-SoVITS\u3001VITS \u7B49\u672C\u5730\u8A9E\u97F3\u670D\u52D9"),t()(),n(7,"div",118)(8,"button",119),u("click",function(){p(e);let r=c(2);return m(r.testTtsConnection())}),_(9,ut,2,0)(10,pt,1,0),t(),_(11,mt,2,0,"button",120),t(),_(12,xt,4,1,"div",121),t()}if(l&2){let e=c(2);s(4),T("ngModel",e.ttsEndpoint),s(4),f("disabled",e.isTestingTts()),s(),C(e.isTestingTts()?9:10),s(2),C(e.ttsConnected()?11:-1),s(),C(e.ttsConnected()?12:-1)}}function Ct(l,i){l&1&&(n(0,"div",94)(1,"p",125),o(2,"\u958B\u555F\u5F8C\u53EF\u914D\u7F6E GPT-SoVITS \u7B49\u8A9E\u97F3\u670D\u52D9\uFF0C\u8B93 AI \u64C1\u6709\u8A9E\u97F3\u80FD\u529B"),t()())}function ft(l,i){if(l&1){let e=v();n(0,"div",18)(1,"div",76)(2,"div",49)(3,"h3",77)(4,"span"),o(5,"\u{1F999}"),t(),o(6," \u672C\u5730 AI "),n(7,"span",78),o(8,"\u63A8\u85A6 - \u514D\u8CBB\u7121\u9650"),t()(),n(9,"button",79),u("click",function(){p(e);let r=c();return m(r.showAddLocalModel.set(!0))}),o(10," + \u6DFB\u52A0\u672C\u5730 AI "),t()(),n(11,"div",80),D(12,Ye,20,8,"div",81,I,!1,Xe,5,0,"div",82),t()(),n(15,"div",42)(16,"div",49)(17,"h3",77)(18,"span"),o(19,"\u2601\uFE0F"),t(),o(20," \u96F2\u7AEF AI "),t(),n(21,"button",83),u("click",function(){p(e);let r=c();return m(r.showAddModel.set(!0))}),o(22," + \u6DFB\u52A0\u96F2\u7AEF\u6A21\u578B "),t()(),n(23,"div",80),D(24,it,20,15,"div",84,I,!1,ot,5,0,"div",82),t(),_(27,ct,33,4,"div",85),t(),n(28,"div",86)(29,"div",49)(30,"h3",77)(31,"span"),o(32,"\u{1F50A}"),t(),o(33," \u8A9E\u97F3\u8F38\u51FA (TTS) "),n(34,"span",87),o(35,"\u53EF\u9078"),t()(),n(36,"label",88)(37,"input",89),k("ngModelChange",function(r){p(e);let d=c();return F(d.ttsEnabled,r)||(d.ttsEnabled=r),m(r)}),u("change",function(){p(e);let r=c();return m(r.saveTtsSettings())}),t(),y(38,"div",90),n(39,"span",91),o(40),t()()(),n(41,"p",92),o(42,"\u555F\u7528\u5F8C\uFF0CAI \u56DE\u8986\u5C07\u81EA\u52D5\u8F49\u63DB\u70BA\u8A9E\u97F3\u64AD\u653E"),t(),_(43,_t,13,5,"div",93)(44,Ct,3,0,"div",94),t()()}if(l&2){let e=c();s(12),A(e.localModels()),s(12),A(e.cloudModels()),s(3),C(e.aiService.models().length>0?27:-1),s(10),T("ngModel",e.ttsEnabled),s(3),g(e.ttsEnabled?"\u5DF2\u555F\u7528":"\u5DF2\u95DC\u9589"),s(3),C(e.ttsEnabled?43:44)}}function vt(l,i){if(l&1){let e=v();n(0,"button",156),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.selectPersonaTemplate(r.id))}),n(1,"div",70),o(2),t(),n(3,"div",157),o(4),t(),n(5,"div",158),o(6),t()()}if(l&2){let e=i.$implicit,a=c(2);S("border-purple-500",a.selectedPersonaTemplate()===e.id)("bg-purple-500/10",a.selectedPersonaTemplate()===e.id)("border-transparent",a.selectedPersonaTemplate()!==e.id)("bg-slate-700/50",a.selectedPersonaTemplate()!==e.id)("hover:bg-slate-700",a.selectedPersonaTemplate()!==e.id),s(2),g(e.icon),s(),S("text-purple-400",a.selectedPersonaTemplate()===e.id)("text-white",a.selectedPersonaTemplate()!==e.id),s(),b(" ",e.name," "),s(2),g(e.description)}}function bt(l,i){if(l&1){let e=v();n(0,"button",159),u("click",function(){let r=p(e).$implicit,d=c(2);return d.setStyle(r.id),m(d.markStrategyDirty())}),n(1,"div",59),o(2),t(),n(3,"div",160),o(4),t()()}if(l&2){let e=i.$implicit,a=c(2);S("border-purple-500",a.currentStyle()===e.id)("bg-purple-500/10",a.currentStyle()===e.id)("border-transparent",a.currentStyle()!==e.id)("bg-slate-700/50",a.currentStyle()!==e.id),s(2),g(e.icon),s(),S("text-purple-400",a.currentStyle()===e.id)("text-white",a.currentStyle()!==e.id),s(),b(" ",e.label," ")}}function ht(l,i){if(l&1){let e=v();n(0,"button",161),u("click",function(){let r=p(e).$implicit,d=c(2);return d.setResponseLength(r),m(d.markStrategyDirty())}),o(1),t()}if(l&2){let e=i.$implicit,a=c(2);S("bg-purple-500",a.responseLength()===e)("text-white",a.responseLength()===e)("bg-slate-700",a.responseLength()!==e)("text-slate-300",a.responseLength()!==e),s(),b(" ",e==="short"?"\u7C21\u77ED":e==="medium"?"\u9069\u4E2D":"\u8A73\u7D30"," ")}}function St(l,i){if(l&1){let e=v();n(0,"label",142)(1,"div",50)(2,"span",64),o(3),t(),n(4,"div")(5,"div",151),o(6),t(),n(7,"div",61),o(8),t()()(),n(9,"input",162),u("change",function(){let r=p(e).$implicit,d=c(2);return m(d.toggleRule(r.id))}),t()()}if(l&2){let e=i.$implicit;s(3),g(e.icon),s(3),g(e.name),s(2),g(e.description),s(),f("checked",e.isActive)}}function wt(l,i){l&1&&o(0," \u{1F4A1} \u4FEE\u6539\u5F8C\u8ACB\u8A18\u5F97\u4FDD\u5B58 ")}function Et(l,i){l&1&&o(0," \u2713 \u6240\u6709\u66F4\u6539\u5DF2\u4FDD\u5B58 ")}function yt(l,i){l&1&&(n(0,"span",115),o(1,"\u27F3"),t(),o(2," \u4FDD\u5B58\u4E2D... "))}function Dt(l,i){l&1&&o(0," \u{1F4BE} \u4FDD\u5B58\u4EBA\u683C\u8A2D\u5B9A ")}function At(l,i){if(l&1){let e=v();n(0,"div",18)(1,"div",42)(2,"div",126)(3,"h3",77)(4,"span"),o(5,"\u{1F3AD}"),t(),o(6," \u9078\u64C7 AI \u4EBA\u683C "),t(),n(7,"button",127),o(8," + \u81EA\u5B9A\u7FA9\u4EBA\u683C "),t()(),n(9,"div",128),D(10,vt,7,17,"button",129,I),t()(),n(12,"div",42)(13,"h3",130)(14,"span"),o(15,"\u{1F4AC}"),t(),o(16," \u5C0D\u8A71\u98A8\u683C "),t(),n(17,"div",131)(18,"div",93)(19,"div",132),D(20,bt,5,14,"button",133,I),t(),n(22,"div")(23,"label",56),o(24,"\u56DE\u8986\u9577\u5EA6"),t(),n(25,"div",134),D(26,ht,2,9,"button",135,oe),t()(),n(28,"label",136),u("click",function(){p(e);let r=c();return r.toggleEmoji(),m(r.markStrategyDirty())}),n(29,"div")(30,"div",137),o(31,"\u4F7F\u7528 Emoji \u8868\u60C5"),t(),n(32,"div",61),o(33,"\u5728\u56DE\u8986\u4E2D\u6DFB\u52A0\u8868\u60C5"),t()(),y(34,"input",138),t()(),n(35,"div")(36,"label",56),o(37,"\u81EA\u5B9A\u7FA9\u4EBA\u8A2D\u63D0\u793A\u8A5E"),t(),n(38,"textarea",139),u("input",function(r){p(e);let d=c();return m(d.onPersonaInput(r))}),o(39,"                    "),t(),n(40,"p",140),o(41,"\u{1F4A1} \u63D0\u793A\uFF1A\u9078\u64C7\u4EBA\u683C\u6A21\u677F\u6703\u81EA\u52D5\u586B\u5145\u6B64\u9805"),t()()()(),n(42,"div",42)(43,"div",126)(44,"h3",77)(45,"span"),o(46,"\u26A1"),t(),o(47," \u667A\u80FD\u884C\u70BA "),n(48,"span",141),o(49,"\u6839\u64DA\u60C5\u6CC1\u81EA\u52D5\u89F8\u767C\u76F8\u61C9\u52D5\u4F5C"),t()()(),n(50,"div",80),D(51,St,10,4,"label",142,I),t(),n(53,"button",143),o(54," + \u6DFB\u52A0\u81EA\u5B9A\u7FA9\u884C\u70BA\u898F\u5247 "),t()(),n(55,"div",144)(56,"h3",145)(57,"span"),o(58,"\u{1F4AC}"),t(),o(59," AI \u56DE\u8986\u9810\u89BD "),t(),n(60,"div",146)(61,"div",147)(62,"span",12),o(63,"\u7528\u6236:"),t(),n(64,"p",148),o(65,"\u4F60\u5011\u7684\u670D\u52D9\u591A\u5C11\u9322\uFF1F"),t()(),n(66,"div",149)(67,"span",150),o(68),t(),n(69,"p",151),o(70),t()()(),n(71,"button",152),u("click",function(){p(e);let r=c();return m(r.regeneratePreview())}),o(72," \u{1F504} \u91CD\u65B0\u751F\u6210\u9810\u89BD "),t()(),n(73,"div",153)(74,"div",45),_(75,wt,1,0)(76,Et,1,0),t(),n(77,"div",118)(78,"button",154),u("click",function(){p(e);let r=c();return m(r.resetStrategy())}),o(79," \u91CD\u7F6E "),t(),n(80,"button",155),u("click",function(){p(e);let r=c();return m(r.savePersonaSettings())}),_(81,yt,3,0)(82,Dt,1,0),t()()()()}if(l&2){let e=c();s(10),A(e.personaTemplates),s(10),A(e.conversationStyles),s(6),A(ae(7,Pe)),s(8),f("checked",e.useEmoji()),s(4),f("value",e.customPersona()),s(13),A(e.defaultRules),s(17),b("AI (",e.getPersonaName(),"):"),s(2),g(e.getPreviewResponse()),s(5),C(e.strategyDirty()?75:76),s(5),f("disabled",!e.strategyDirty()||e.isSavingStrategy()),s(),C(e.isSavingStrategy()?81:82)}}function Mt(l,i){l&1&&(n(0,"span",173),o(1,"\u904B\u884C\u4E2D"),t())}function Tt(l,i){l&1&&(n(0,"span",174),o(1,"\u5DF2\u95DC\u9589"),t())}function Ft(l,i){if(l&1){let e=v();n(0,"div",18)(1,"div",128)(2,"div",163)(3,"div",164),o(4),t(),n(5,"div",45),o(6,"\u4ECA\u65E5\u5C0D\u8A71"),t()(),n(7,"div",163)(8,"div",165),o(9),t(),n(10,"div",45),o(11,"\u610F\u5716\u8B58\u5225"),t()(),n(12,"div",163)(13,"div",166),o(14),t(),n(15,"div",45),o(16,"\u8F49\u5316"),t()(),n(17,"div",163)(18,"div",167),o(19),t(),n(20,"div",45),o(21,"\u6210\u672C"),t()()(),n(22,"div",42)(23,"h3",168),o(24,"\u672C\u9031\u6982\u89BD"),t(),n(25,"div",131)(26,"div")(27,"div",169),o(28),t(),n(29,"div",170),o(30,"\u7E3D\u5C0D\u8A71"),t()(),n(31,"div")(32,"div",171),o(33),t(),n(34,"div",170),o(35,"\u8F49\u5316\u7387"),t()()()(),n(36,"div",172)(37,"div",49)(38,"div",50)(39,"span",5),o(40,"\u{1F9E0}"),t(),n(41,"h3",44),o(42,"AI \u667A\u80FD\u7CFB\u7D71\u72C0\u614B"),t(),_(43,Mt,2,0,"span",173)(44,Tt,2,0,"span",174),t(),n(45,"button",175),u("click",function(){p(e);let r=c();return m(r.goToSmartMarketing())}),n(46,"span"),o(47,"\u{1F4CA}"),t(),o(48," \u67E5\u770B\u8A73\u7D30\u7D71\u8A08 "),t()(),n(49,"div",109)(50,"div",176)(51,"div",177)(52,"span",23),o(53,"\u{1F4AD}"),t(),n(54,"span",107),o(55,"\u5C0D\u8A71\u8A18\u61B6"),t()(),n(56,"div",178),o(57),t(),n(58,"div",61),o(59,"\u689D\u8A18\u61B6"),t()(),n(60,"div",176)(61,"div",177)(62,"span",23),o(63,"\u{1F3F7}\uFE0F"),t(),n(64,"span",107),o(65,"\u5BA2\u6236\u6A19\u7C64"),t()(),n(66,"div",179),o(67),t(),n(68,"div",61),o(69,"\u500B\u6A19\u7C64"),t()(),n(70,"div",176)(71,"div",177)(72,"span",23),o(73,"\u{1F60A}"),t(),n(74,"span",107),o(75,"\u60C5\u7DD2\u5206\u6790"),t()(),n(76,"div",180),o(77),t(),n(78,"div",61),o(79,"\u6B21\u5206\u6790"),t()(),n(80,"div",176)(81,"div",177)(82,"span",23),o(83,"\u{1F504}"),t(),n(84,"span",107),o(85,"\u81EA\u52D5\u5316\u6D41\u7A0B"),t()(),n(86,"div",181),o(87),t(),n(88,"div",61),o(89,"\u6B21\u57F7\u884C"),t()(),n(90,"div",176)(91,"div",177)(92,"span",23),o(93,"\u23F0"),t(),n(94,"span",107),o(95,"\u5F85\u8DDF\u9032"),t()(),n(96,"div",182),o(97),t(),n(98,"div",61),o(99,"\u500B\u4EFB\u52D9"),t()(),n(100,"div",176)(101,"div",177)(102,"span",23),o(103,"\u{1F4DA}"),t(),n(104,"span",107),o(105,"\u77E5\u8B58\u5EAB"),t()(),n(106,"div",183),o(107),t(),n(108,"div",61),o(109,"\u689D\u5B78\u7FD2"),t()()(),n(110,"div",184)(111,"button",185),u("click",function(){p(e);let r=c();return m(r.refreshSmartSystemStats())}),o(112," \u{1F504} \u5237\u65B0\u7D71\u8A08 "),t()()()()}if(l&2){let e=c();s(4),g(e.aiService.stats().today.conversations),s(5),g(e.aiService.stats().today.intentsRecognized),s(5),g(e.aiService.stats().today.conversions),s(5),b("\xA5",e.aiService.stats().today.cost.toFixed(2)),s(9),b(" ",e.aiService.stats().weekly.conversations," "),s(5),b(" ",(e.aiService.stats().weekly.conversionRate*100).toFixed(1),"% "),s(10),C(e.autonomousModeEnabled()?43:44),s(14),g(e.smartSystemStats().memories),s(10),g(e.smartSystemStats().tags),s(10),g(e.smartSystemStats().emotions),s(10),g(e.smartSystemStats().workflows),s(10),g(e.smartSystemStats().followups),s(10),g(e.smartSystemStats().knowledge)}}function kt(l,i){if(l&1){let e=v();n(0,"div",172)(1,"h3",145)(2,"span"),o(3,"\u{1F9E0}"),t(),o(4," \u77E5\u8BC6\u5927\u8111\u603B\u89C8"),t(),n(5,"div",109)(6,"div",176)(7,"div",188),o(8,"\u77E5\u8B58\u5EAB"),t(),n(9,"div",183),o(10),t(),n(11,"div",12),o(12,"\u689D\u5B78\u7FD2"),t()(),n(13,"div",176)(14,"div",188),o(15,"\u5C0D\u8A71\u8A18\u61B6"),t(),n(16,"div",178),o(17),t(),n(18,"div",12),o(19,"\u689D\u8A18\u61B6"),t()(),n(20,"div",176)(21,"div",188),o(22,"\u5BA2\u6236\u6A19\u7C64"),t(),n(23,"div",179),o(24),t(),n(25,"div",12),o(26,"\u500B\u6A19\u7C64"),t()()(),n(27,"button",189),u("click",function(){p(e);let r=c(2);return m(r.refreshSmartSystemStats())}),o(28,"\u{1F504} \u5237\u65B0\u7D71\u8A08"),t()()}if(l&2){let e=c(2);s(10),g(e.smartSystemStats().knowledge),s(7),g(e.smartSystemStats().memories),s(7),g(e.smartSystemStats().tags)}}function It(l,i){l&1&&y(0,"app-knowledge-manage")}function Pt(l,i){l&1&&y(0,"app-knowledge-gaps")}function Bt(l,i){if(l&1){let e=v();n(0,"div",19)(1,"div",186)(2,"button",187),u("click",function(){p(e);let r=c();return m(r.selectKnowledgeSubTab("overview"))}),o(3," \u{1F4CA} \u603B\u89C8 "),t(),n(4,"button",187),u("click",function(){p(e);let r=c();return m(r.selectKnowledgeSubTab("manage"))}),o(5," \u{1F4DD} \u77E5\u8BC6\u7BA1\u7406 "),t(),n(6,"button",187),u("click",function(){p(e);let r=c();return m(r.selectKnowledgeSubTab("gaps"))}),o(7," \u2753 \u77E5\u8BC6\u7F3A\u53E3 "),t()(),_(8,kt,29,3,"div",172)(9,It,1,0,"app-knowledge-manage")(10,Pt,1,0,"app-knowledge-gaps"),t()}if(l&2){let e,a=c();s(2),S("bg-pink-500/30",a.knowledgeSubTab()==="overview")("text-white",a.knowledgeSubTab()==="overview")("text-slate-400",a.knowledgeSubTab()!=="overview")("hover:bg-slate-700/50",a.knowledgeSubTab()!=="overview"),s(2),S("bg-pink-500/30",a.knowledgeSubTab()==="manage")("text-white",a.knowledgeSubTab()==="manage")("text-slate-400",a.knowledgeSubTab()!=="manage")("hover:bg-slate-700/50",a.knowledgeSubTab()!=="manage"),s(2),S("bg-pink-500/30",a.knowledgeSubTab()==="gaps")("text-white",a.knowledgeSubTab()==="gaps")("text-slate-400",a.knowledgeSubTab()!=="gaps")("hover:bg-slate-700/50",a.knowledgeSubTab()!=="gaps"),s(2),C((e=a.knowledgeSubTab())==="overview"?8:e==="manage"?9:e==="gaps"?10:-1)}}function Ot(l,i){if(l&1){let e=v();n(0,"button",201),u("click",function(){let r=p(e).$implicit,d=c(2);return m(d.newModelProvider.set(r.id))}),n(1,"div",59),o(2),t(),n(3,"div",202),o(4),t()()}if(l&2){let e=i.$implicit,a=c(2);S("border-purple-500",a.newModelProvider()===e.id)("bg-purple-500/10",a.newModelProvider()===e.id)("border-transparent",a.newModelProvider()!==e.id)("bg-slate-700",a.newModelProvider()!==e.id),s(2),g(e.icon),s(),S("text-purple-400",a.newModelProvider()===e.id)("text-slate-300",a.newModelProvider()!==e.id),s(),b(" ",e.name," ")}}function Vt(l,i){if(l&1&&(n(0,"option",195),o(1),t()),l&2){let e=i.$implicit;f("value",e.name),s(),g(e.displayName)}}function Kt(l,i){if(l&1){let e=v();n(0,"div",20)(1,"div",190)(2,"h3",191),o(3,"\u6DFB\u52A0\u96F2\u7AEF AI \u6A21\u578B"),t(),n(4,"div",93)(5,"div")(6,"label",56),o(7,"\u9078\u64C7\u4F9B\u61C9\u5546"),t(),n(8,"div",192),D(9,Ot,5,14,"button",193,I),t()(),n(11,"div")(12,"label",56),o(13,"\u9078\u64C7\u6A21\u578B *"),t(),n(14,"select",194),k("ngModelChange",function(r){p(e);let d=c();return F(d.newModelName,r)||(d.newModelName=r),m(r)}),n(15,"option",112),o(16,"\u8ACB\u9078\u64C7\u6A21\u578B"),t(),D(17,Vt,2,2,"option",195,Oe),t(),n(19,"p",117),o(20,"\u{1F4A1} \u6A21\u578B\u540D\u7A31\u5C07\u81EA\u52D5\u683C\u5F0F\u5316\uFF0C\u7121\u9700\u64D4\u5FC3\u5927\u5C0F\u5BEB"),t()(),n(21,"div")(22,"label",56),o(23,"API Key *"),t(),n(24,"input",196),k("ngModelChange",function(r){p(e);let d=c();return F(d.newModelApiKey,r)||(d.newModelApiKey=r),m(r)}),t()(),n(25,"div")(26,"label",56),o(27,"\u986F\u793A\u540D\u7A31 (\u53EF\u9078)"),t(),n(28,"input",197),k("ngModelChange",function(r){p(e);let d=c();return F(d.newModelDisplayName,r)||(d.newModelDisplayName=r),m(r)}),t()()(),n(29,"div",198)(30,"button",199),u("click",function(){p(e);let r=c();return m(r.showAddModel.set(!1))}),o(31," \u53D6\u6D88 "),t(),n(32,"button",200),u("click",function(){p(e);let r=c();return m(r.saveNewModel())}),o(33," \u6DFB\u52A0 "),t()()()()}if(l&2){let e=c();s(9),A(e.providers),s(5),T("ngModel",e.newModelName),s(3),A(e.currentPresetModels()),s(7),T("ngModel",e.newModelApiKey),s(4),T("ngModel",e.newModelDisplayName)}}function Nt(l,i){l&1&&(n(0,"span",115),o(1,"\u27F3"),t(),o(2," \u6B63\u5728\u6E2C\u8A66\u9023\u63A5... "))}function Gt(l,i){l&1&&o(0," \u{1F517} \u6E2C\u8A66\u9023\u63A5 ")}function Lt(l,i){if(l&1){let e=v();n(0,"div",20)(1,"div",203)(2,"h3",204),o(3," \u{1F999} \u6DFB\u52A0\u672C\u5730 AI "),t(),n(4,"p",205),o(5,"\u914D\u7F6E Ollama \u6216\u5176\u4ED6\u672C\u5730 AI \u670D\u52D9"),t(),n(6,"div",93)(7,"div")(8,"label",56),o(9,"API \u7AEF\u9EDE *"),t(),n(10,"input",206),k("ngModelChange",function(r){p(e);let d=c();return F(d.localModelEndpoint,r)||(d.localModelEndpoint=r),m(r)}),t(),n(11,"p",117),o(12," \u{1F4A1} \u4F7F\u7528 Tailscale Funnel \u53EF\u5BE6\u73FE\u9060\u7A0B\u8A2A\u554F\u672C\u5730 Ollama "),t()(),n(13,"div")(14,"label",56),o(15,"\u6A21\u578B\u540D\u7A31 *"),t(),n(16,"input",207),k("ngModelChange",function(r){p(e);let d=c();return F(d.localModelName,r)||(d.localModelName=r),m(r)}),t(),n(17,"p",117),o(18," \u5728 Ollama \u4E2D\u904B\u884C "),n(19,"code",208),o(20,"ollama list"),t(),o(21," \u67E5\u770B\u53EF\u7528\u6A21\u578B "),t()(),n(22,"div")(23,"label",56),o(24,"\u986F\u793A\u540D\u7A31 (\u53EF\u9078)"),t(),n(25,"input",209),k("ngModelChange",function(r){p(e);let d=c();return F(d.localModelDisplayName,r)||(d.localModelDisplayName=r),m(r)}),t()(),n(26,"button",210),u("click",function(){p(e);let r=c();return m(r.testLocalConnection())}),_(27,Nt,3,0)(28,Gt,1,0),t()(),n(29,"div",198)(30,"button",199),u("click",function(){p(e);let r=c();return m(r.showAddLocalModel.set(!1))}),o(31," \u53D6\u6D88 "),t(),n(32,"button",211),u("click",function(){p(e);let r=c();return m(r.saveLocalModel())}),o(33," \u4FDD\u5B58 "),t()()()()}if(l&2){let e=c();s(10),T("ngModel",e.localModelEndpoint),s(6),T("ngModel",e.localModelName),s(9),T("ngModel",e.localModelDisplayName),s(),f("disabled",e.isTestingLocal()),s(),C(e.isTestingLocal()?27:28)}}var X=class l{constructor(){this.aiService=w(pe);this.dialogService=w(z);this.toastService=w(q);this.ipcService=w(Q);this.navBridge=w(U);this.initialTab=Z(void 0);this.initialKnowledgeSub=Z(void 0);this.activeTab=x("models");this.knowledgeSubTab=x("overview");this.showAddModel=x(!1);this.autoChatEnabled=x(!1);this.autoChatMode=x("full");this.autoGreetingEnabled=x(!0);this.autoReplyEnabled=x(!0);this.senderAccounts=x([]);this.autonomousModeEnabled=x(!1);this.smartSystemStats=x({memories:0,tags:0,emotions:0,workflows:0,followups:0,knowledge:0});this.newModelProvider=x("openai");this.newModelName="";this.newModelApiKey="";this.newModelEndpoint="";this.newModelDisplayName="";this.showAddLocalModel=x(!1);this.localModelEndpoint="https://ms-defysomwqybz.tail05a567.ts.net/api/chat";this.localModelName="huihui_ai/qwen2.5-abliterate";this.localModelDisplayName="\u6211\u7684\u672C\u5730 AI";this.isTestingLocal=x(!1);this.ttsEnabled=!1;this.ttsEndpoint="http://localhost:9881";this.ttsConnected=x(!1);this.isTestingTts=x(!1);this.ttsLatency=x(0);this.isSavingUsage=x(!1);this.usageSaved=x(!1);this.usageSaveTimeout=null;this.strategyDirty=x(!1);this.strategySaved=x(!1);this.isSavingStrategy=x(!1);this.customPersona=x("");this.originalStrategy=null;this.router=w(le);this.tabs=[{id:"quick",icon:"\u{1F680}",label:"\u5F15\u64CE\u6982\u89BD"},{id:"models",icon:"\u{1F916}",label:"\u6A21\u578B\u914D\u7F6E"},{id:"persona",icon:"\u{1F3AD}",label:"\u4EBA\u683C\u98A8\u683C"},{id:"knowledge",icon:"\u{1F9E0}",label:"\u77E5\u8BC6\u5927\u8111"},{id:"stats",icon:"\u{1F4CA}",label:"\u4F7F\u7528\u7D71\u8A08"}];this.providers=[{id:"openai",name:"OpenAI",icon:"\u{1F7E2}"},{id:"claude",name:"Claude",icon:"\u{1F7E3}"},{id:"gemini",name:"Gemini",icon:"\u{1F535}"}];this.presetModels={openai:[{name:"gpt-4o",displayName:"GPT-4o (\u63A8\u85A6)"},{name:"gpt-4o-mini",displayName:"GPT-4o Mini (\u7D93\u6FDF)"},{name:"gpt-4-turbo",displayName:"GPT-4 Turbo"},{name:"gpt-3.5-turbo",displayName:"GPT-3.5 Turbo (\u5FEB\u901F)"}],claude:[{name:"claude-3-5-sonnet-latest",displayName:"Claude 3.5 Sonnet (\u63A8\u85A6)"},{name:"claude-3-opus-latest",displayName:"Claude 3 Opus (\u5F37\u5927)"},{name:"claude-3-haiku-20240307",displayName:"Claude 3 Haiku (\u5FEB\u901F)"}],gemini:[{name:"gemini-1.5-flash-latest",displayName:"Gemini 1.5 Flash (\u63A8\u85A6)"},{name:"gemini-1.5-pro-latest",displayName:"Gemini 1.5 Pro (\u5F37\u5927)"},{name:"gemini-2.0-flash-exp",displayName:"Gemini 2.0 Flash (\u5BE6\u9A57)"}]};this.currentPresetModels=E(()=>this.presetModels[this.newModelProvider()]||[]);this.localModels=this.aiService.localModels;this.cloudModels=this.aiService.cloudModels;this.conversationStyles=[{id:"professional",icon:"\u{1F454}",label:"\u5C08\u696D\u6B63\u5F0F"},{id:"friendly",icon:"\u{1F60A}",label:"\u53CB\u597D\u89AA\u5207"},{id:"casual",icon:"\u{1F60E}",label:"\u8F15\u9B06\u5E7D\u9ED8"},{id:"direct",icon:"\u{1F3AF}",label:"\u76F4\u63A5\u7C21\u6F54"}];this.industryTemplates=[{id:"payment",name:"\u{1F4B3} \u8DE8\u5883\u652F\u4ED8",description:"U\u514C\u63DB\u3001\u4EE3\u6536\u4EE3\u4ED8\u3001\u532F\u6B3E\u670D\u52D9"},{id:"ecommerce",name:"\u{1F6D2} \u96FB\u5546\u96F6\u552E",description:"\u5546\u54C1\u92B7\u552E\u3001\u8A02\u55AE\u67E5\u8A62\u3001\u552E\u5F8C\u670D\u52D9"},{id:"education",name:"\u{1F4D6} \u5728\u7DDA\u6559\u80B2",description:"\u8AB2\u7A0B\u8AEE\u8A62\u3001\u5B78\u7FD2\u8F14\u5C0E\u3001\u5831\u540D\u6D41\u7A0B"},{id:"realestate",name:"\u{1F3E0} \u623F\u7522\u4E2D\u4ECB",description:"\u623F\u6E90\u63A8\u85A6\u3001\u770B\u623F\u9810\u7D04\u3001\u4EA4\u6613\u6D41\u7A0B"},{id:"finance",name:"\u{1F4B0} \u91D1\u878D\u7406\u8CA1",description:"\u6295\u8CC7\u8AEE\u8A62\u3001\u98A8\u96AA\u8A55\u4F30\u3001\u7522\u54C1\u4ECB\u7D39"},{id:"healthcare",name:"\u{1F3E5} \u91AB\u7642\u5065\u5EB7",description:"\u9810\u7D04\u639B\u865F\u3001\u5065\u5EB7\u8AEE\u8A62\u3001\u7528\u85E5\u6307\u5C0E"},{id:"travel",name:"\u2708\uFE0F \u65C5\u904A\u670D\u52D9",description:"\u884C\u7A0B\u898F\u5283\u3001\u8A02\u7968\u9152\u5E97\u3001\u5C0E\u904A\u670D\u52D9"},{id:"legal",name:"\u2696\uFE0F \u6CD5\u5F8B\u8AEE\u8A62",description:"\u6CD5\u5F8B\u554F\u7B54\u3001\u6848\u4EF6\u8AEE\u8A62\u3001\u6587\u66F8\u670D\u52D9"}];this.knowledgeStats=E(()=>{let i=this.knowledgeBases(),e=i.reduce((M,h)=>M+h.items.length,0),a={};i.forEach(M=>{M.items.forEach(h=>{a[h.category]=(a[h.category]||0)+1})});let r=Object.entries(a).sort(([,M],[,h])=>h-M)[0]?.[0]||"-",d={product:"\u7522\u54C1",faq:"\u554F\u7B54",sales:"\u8A71\u8853",objection:"\u7570\u8B70",custom:"\u5176\u4ED6"};return{totalItems:e,usedCount:Math.floor(e*.7),hitRate:e>0?68:0,topCategory:d[r]||r}});this.defaultRules=[{id:"purchase",icon:"\u{1F6D2}",name:"\u8CFC\u8CB7\u610F\u5411\u660E\u78BA \u2192 \u901A\u77E5\u4EBA\u5DE5",description:"\u7576\u8B58\u5225\u5230\u8CFC\u8CB7\u610F\u5411\u6642\u7ACB\u5373\u901A\u77E5",isActive:!0},{id:"no-response",icon:"\u23F0",name:"\u9023\u7E8C3\u6B21\u4E0D\u56DE\u8986 \u2192 \u66AB\u505C",description:"\u66AB\u505C\u5C0D\u8A71\uFF0C3\u5929\u5F8C\u518D\u8DDF\u9032",isActive:!0},{id:"negative",icon:"\u{1F614}",name:"\u8CA0\u9762\u60C5\u7DD2 \u2192 \u8F49\u4EBA\u5DE5",description:"\u6AA2\u6E2C\u5230\u8CA0\u9762\u60C5\u7DD2\u6642\u8F49\u4EBA\u5DE5\u8655\u7406",isActive:!0},{id:"price",icon:"\u{1F4B0}",name:"\u50F9\u683C\u654F\u611F \u2192 \u63A8\u9001\u512A\u60E0",description:"\u8A62\u554F\u50F9\u683C\u6642\u63A8\u9001\u512A\u60E0\u65B9\u6848",isActive:!1}];this.personaTemplates=[{id:"friendly",icon:"\u{1F60A}",name:"\u53CB\u597D\u52A9\u624B",description:"\u89AA\u5207\u3001\u8010\u5FC3\u3001\u6A02\u65BC\u52A9\u4EBA",prompt:"\u4F60\u662F\u4E00\u4F4D\u53CB\u597D\u7684\u5BA2\u670D\u52A9\u624B\uFF0C\u8AAA\u8A71\u89AA\u5207\u6EAB\u6696\uFF0C\u6A02\u65BC\u5E6B\u52A9\u5BA2\u6236\u89E3\u6C7A\u554F\u984C\u3002"},{id:"professional",icon:"\u{1F454}",name:"\u5C08\u696D\u9867\u554F",description:"\u5C08\u696D\u3001\u56B4\u8B39\u3001\u503C\u5F97\u4FE1\u8CF4",prompt:"\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684\u92B7\u552E\u9867\u554F\uFF0C\u5177\u6709\u8C50\u5BCC\u7684\u884C\u696D\u7D93\u9A57\uFF0C\u56DE\u7B54\u554F\u984C\u5C08\u696D\u56B4\u8B39\u3002"},{id:"enthusiastic",icon:"\u{1F389}",name:"\u71B1\u60C5\u92B7\u552E",description:"\u7A4D\u6975\u3001\u71B1\u60C5\u3001\u5584\u65BC\u63A8\u85A6",prompt:"\u4F60\u662F\u4E00\u4F4D\u5145\u6EFF\u71B1\u60C5\u7684\u92B7\u552E\u4EE3\u8868\uFF0C\u5584\u65BC\u767C\u73FE\u5BA2\u6236\u9700\u6C42\u4E26\u7A4D\u6975\u63A8\u85A6\u5408\u9069\u7684\u7522\u54C1\u3002"},{id:"efficient",icon:"\u26A1",name:"\u9AD8\u6548\u7C21\u6F54",description:"\u76F4\u63A5\u3001\u7C21\u6F54\u3001\u6548\u7387\u512A\u5148",prompt:"\u4F60\u662F\u4E00\u4F4D\u9AD8\u6548\u7684\u5BA2\u670D\uFF0C\u56DE\u7B54\u554F\u984C\u76F4\u63A5\u660E\u4E86\uFF0C\u4E0D\u7E5E\u5F4E\u5B50\uFF0C\u7BC0\u7701\u5BA2\u6236\u6642\u9593\u3002"}];this.selectedPersonaTemplate=x("friendly");this.previewResponse=x("\u60A8\u597D\u5440\uFF01\u611F\u8B1D\u60A8\u7684\u8AEE\u8A62 \u{1F60A} \u6211\u5011\u7684\u670D\u52D9\u50F9\u683C\u6839\u64DA\u60A8\u7684\u5177\u9AD4\u9700\u6C42\u800C\u5B9A\uFF0C\u8ACB\u554F\u60A8\u4E3B\u8981\u60F3\u4E86\u89E3\u54EA\u65B9\u9762\u7684\u670D\u52D9\u5462\uFF1F");this.knowledgeBases=E(()=>this.aiService.knowledgeBases());this.activeKbId=E(()=>this.aiService.activeKnowledgeBaseId());this.currentStyle=E(()=>this.aiService.strategy().style);this.responseLength=E(()=>this.aiService.strategy().responseLength);this.useEmoji=E(()=>this.aiService.strategy().useEmoji);ne(()=>{let i=this.initialTab(),e=this.initialKnowledgeSub();i&&(this.activeTab.set(i),i==="knowledge"&&e&&this.knowledgeSubTab.set(e))})}static{this.VIEW_TAB_MAP={"ai-center":"quick","ai-engine":"quick","ai-models":"models","ai-persona":"persona","ai-brain":"quick","knowledge-brain":"knowledge","knowledge-manage":"knowledge","knowledge-gaps":"knowledge"}}getProviderIcon(i){return this.providers.find(e=>e.id===i)?.icon||"\u{1F916}"}getProviderName(i){return this.providers.find(e=>e.id===i)?.name||i}testModel(i){this.aiService.testModelConnection(i.id)}editModel(i){}saveNewModel(){!this.newModelName||!this.newModelApiKey||(this.aiService.addModel({provider:this.newModelProvider(),modelName:this.newModelName,apiKey:this.newModelApiKey,apiEndpoint:this.newModelEndpoint||void 0,displayName:this.newModelDisplayName||this.newModelName}),this.showAddModel.set(!1),this.newModelName="",this.newModelApiKey="",this.newModelEndpoint="",this.newModelDisplayName="")}saveLocalModel(){if(!this.localModelEndpoint||!this.localModelName){alert("\u8ACB\u586B\u5BEB API \u7AEF\u9EDE\u548C\u6A21\u578B\u540D\u7A31");return}this.aiService.addLocalModel({modelName:this.localModelName,displayName:this.localModelDisplayName||this.localModelName,apiEndpoint:this.localModelEndpoint,isDefault:this.aiService.models().length===0}),this.showAddLocalModel.set(!1),this.localModelDisplayName="\u6211\u7684\u672C\u5730 AI"}async testLocalConnection(){if(!this.localModelEndpoint||!this.localModelName){alert("\u8ACB\u5148\u586B\u5BEB API \u7AEF\u9EDE\u548C\u6A21\u578B\u540D\u7A31");return}this.isTestingLocal.set(!0),await this.aiService.testLocalAIConnection(this.localModelEndpoint,this.localModelName),setTimeout(()=>this.isTestingLocal.set(!1),3e3)}saveTtsSettings(){this.ipcService.send("save-ai-settings",{ttsEndpoint:this.ttsEndpoint,ttsEnabled:this.ttsEnabled}),this.toastService.success("TTS \u8A2D\u7F6E\u5DF2\u4FDD\u5B58")}async testTtsConnection(){if(!this.ttsEndpoint){this.toastService.error("\u8ACB\u5148\u586B\u5BEB TTS \u670D\u52D9\u7AEF\u9EDE");return}this.isTestingTts.set(!0);let i=Date.now(),e=a=>{this.isTestingTts.set(!1),a.success?(this.ttsConnected.set(!0),this.ttsLatency.set(Date.now()-i),this.toastService.success("\u2713 TTS \u670D\u52D9\u9023\u63A5\u6210\u529F\uFF01")):(this.ttsConnected.set(!1),this.toastService.error(`TTS \u9023\u63A5\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`))};this.ipcService.once("tts-test-result",e),this.ipcService.send("test-tts-service",{endpoint:this.ttsEndpoint}),setTimeout(()=>{this.isTestingTts()&&(this.isTestingTts.set(!1),this.toastService.error("TTS \u6E2C\u8A66\u8D85\u6642"))},15e3)}testTtsVoice(){let i=e=>{e.success&&e.audio?new Audio(`data:audio/wav;base64,${e.audio}`).play().catch(r=>{this.toastService.error(`\u64AD\u653E\u5931\u6557: ${r.message}`)}):this.toastService.error(`\u8A9E\u97F3\u751F\u6210\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)};this.ipcService.once("tts-result",i),this.ipcService.send("text-to-speech",{endpoint:this.ttsEndpoint,text:"\u4F60\u597D\uFF0C\u9019\u662F\u4E00\u6BB5\u8A9E\u97F3\u6E2C\u8A66\u3002",voice:""}),this.toastService.info("\u6B63\u5728\u751F\u6210\u8A66\u807D\u8A9E\u97F3...")}onModelUsageChange(i,e){let r=e.target.value;this.aiService.updateModelUsage({[i]:r}),this.isSavingUsage.set(!0),this.usageSaved.set(!1),this.usageSaveTimeout&&clearTimeout(this.usageSaveTimeout),this.usageSaveTimeout=setTimeout(async()=>{await this.aiService.saveModelUsageToBackend(),this.isSavingUsage.set(!1),this.usageSaved.set(!0),setTimeout(()=>this.usageSaved.set(!1),3e3)},300)}deleteModel(i){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u578B\u300C${i.displayName||i.modelName}\u300D\u55CE\uFF1F`)&&this.aiService.removeModel(i.id)}setAsDefault(i){this.aiService.setDefaultModel(i.id)}addKnowledgeBase(){this.dialogService.prompt({title:"\u65B0\u5EFA\u77E5\u8B58\u5EAB",message:"\u8ACB\u8F38\u5165\u77E5\u8B58\u5EAB\u540D\u7A31\uFF0C\u7528\u65BC\u7D44\u7E54\u548C\u7BA1\u7406 AI \u56DE\u8986\u7684\u696D\u52D9\u77E5\u8B58\u3002",placeholder:"\u4F8B\u5982\uFF1A\u7522\u54C1\u77E5\u8B58\u5EAB\u3001\u5E38\u898B\u554F\u7B54",confirmText:"\u5275\u5EFA",cancelText:"\u53D6\u6D88",validator:i=>i.trim()?i.length>50?"\u540D\u7A31\u4E0D\u80FD\u8D85\u904E 50 \u500B\u5B57\u7B26":null:"\u8ACB\u8F38\u5165\u540D\u7A31",onConfirm:i=>{this.aiService.addKnowledgeBase(i)}})}setActiveKb(i){this.aiService.setActiveKnowledgeBase(i)}editKb(i){this.dialogService.prompt({title:"\u7DE8\u8F2F\u77E5\u8B58\u5EAB",message:"\u4FEE\u6539\u77E5\u8B58\u5EAB\u540D\u7A31",placeholder:"\u8ACB\u8F38\u5165\u65B0\u540D\u7A31",defaultValue:i.name,confirmText:"\u4FDD\u5B58",cancelText:"\u53D6\u6D88",validator:e=>e.trim()?e.length>50?"\u540D\u7A31\u4E0D\u80FD\u8D85\u904E 50 \u500B\u5B57\u7B26":null:"\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A",onConfirm:e=>{this.aiService.updateKnowledgeBase(i.id,{name:e}),this.toastService.success(`\u77E5\u8B58\u5EAB\u5DF2\u66F4\u65B0\u70BA\u300C${e}\u300D`)}})}deleteKb(i){this.dialogService.confirm({title:"\u78BA\u8A8D\u522A\u9664",message:`\u78BA\u5B9A\u8981\u522A\u9664\u77E5\u8B58\u5EAB\u300C${i.name}\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,confirmText:"\u522A\u9664",cancelText:"\u53D6\u6D88",type:"danger",onConfirm:()=>{this.aiService.deleteKnowledgeBase(i.id),this.toastService.success(`\u77E5\u8B58\u5EAB\u300C${i.name}\u300D\u5DF2\u522A\u9664`)}})}deleteKnowledgeItem(i,e){this.dialogService.confirm({title:"\u78BA\u8A8D\u522A\u9664",message:"\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u77E5\u8B58\u689D\u76EE\u55CE\uFF1F",confirmText:"\u522A\u9664",cancelText:"\u53D6\u6D88",type:"danger",onConfirm:()=>{this.aiService.deleteKnowledgeItem(i,e),this.toastService.success("\u77E5\u8B58\u689D\u76EE\u5DF2\u522A\u9664")}})}addQuickContent(i){let a={product:{title:"\u6DFB\u52A0\u7522\u54C1\u77E5\u8B58",placeholder:"\u4F8B\u5982\uFF1A\u6211\u5011\u7684\u7522\u54C1\u652F\u6301 24 \u5C0F\u6642\u5BA2\u670D...",icon:"\u{1F4E6}"},faq:{title:"\u6DFB\u52A0\u5E38\u898B\u554F\u7B54",placeholder:"\u4F8B\u5982\uFF1AQ: \u5982\u4F55\u4ED8\u6B3E\uFF1FA: \u652F\u6301\u5FAE\u4FE1\u3001\u652F\u4ED8\u5BF6...",icon:"\u2753"},sales:{title:"\u6DFB\u52A0\u92B7\u552E\u8A71\u8853",placeholder:"\u4F8B\u5982\uFF1A\u7576\u5BA2\u6236\u8AAA\u592A\u8CB4\u6642\uFF0C\u53EF\u4EE5\u56DE\u8986...",icon:"\u{1F3AF}"},objection:{title:"\u6DFB\u52A0\u7570\u8B70\u8655\u7406",placeholder:"\u4F8B\u5982\uFF1A\u5BA2\u6236\u64D4\u5FC3\u8CEA\u91CF\u6642\uFF0C\u5F37\u8ABF\u552E\u5F8C\u4FDD\u969C...",icon:"\u{1F4AC}"}}[i],r=this.activeKbId();if(!r){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.prompt({title:`${a.icon} ${a.title}`,message:"\u8F38\u5165\u77E5\u8B58\u5167\u5BB9\uFF0CAI \u5C07\u5728\u56DE\u8986\u6642\u53C3\u8003\u9019\u4E9B\u4FE1\u606F\u3002",placeholder:a.placeholder,inputType:"textarea",confirmText:"\u6DFB\u52A0",cancelText:"\u53D6\u6D88",validator:d=>d.trim()?d.length>2e3?"\u5167\u5BB9\u4E0D\u80FD\u8D85\u904E 2000 \u500B\u5B57\u7B26":null:"\u8ACB\u8F38\u5165\u5167\u5BB9",onConfirm:d=>{this.aiService.addKnowledgeItem(r,{title:`${a.icon} ${i.toUpperCase()}`,content:d,category:i}),this.toastService.success("\u77E5\u8B58\u5167\u5BB9\u5DF2\u6DFB\u52A0")}})}openAIGenerateDialog(){let i=this.activeKbId();if(!i){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.prompt({title:"\u{1F916} AI \u81EA\u52D5\u751F\u6210\u77E5\u8B58\u5EAB",message:"\u8ACB\u7C21\u55AE\u63CF\u8FF0\u60A8\u7684\u696D\u52D9\uFF081-3 \u53E5\u8A71\uFF09\uFF0CAI \u5C07\u81EA\u52D5\u751F\u6210\u7522\u54C1\u77E5\u8B58\u3001\u5E38\u898B\u554F\u7B54\u3001\u92B7\u552E\u8A71\u8853\u7B49\u5167\u5BB9\u3002",placeholder:"\u4F8B\u5982\uFF1A\u6211\u5011\u662F\u505A\u8DE8\u5883\u652F\u4ED8\u7684\uFF0C\u4E3B\u8981\u670D\u52D9\u662F U \u514C\u63DB\u548C\u4EE3\u6536\u4EE3\u4ED8\uFF0C\u652F\u6301\u5FAE\u4FE1\u3001\u652F\u4ED8\u5BF6\u6536\u6B3E",inputType:"textarea",confirmText:"\u958B\u59CB\u751F\u6210",cancelText:"\u53D6\u6D88",validator:e=>e.trim()?e.length<10?"\u63CF\u8FF0\u592A\u77ED\uFF0C\u8ACB\u63D0\u4F9B\u66F4\u591A\u4FE1\u606F":e.length>500?"\u63CF\u8FF0\u4E0D\u80FD\u8D85\u904E 500 \u500B\u5B57\u7B26":null:"\u8ACB\u8F38\u5165\u696D\u52D9\u63CF\u8FF0",onConfirm:e=>{this.generateKnowledgeWithAI(i,e)}})}async generateKnowledgeWithAI(i,e){this.toastService.info("\u{1F916} AI \u6B63\u5728\u751F\u6210\u77E5\u8B58\u5EAB\uFF0C\u8ACB\u7A0D\u5019..."),this.aiService.generateKnowledgeBase(i,e)}openBatchImportDialog(){let i=this.activeKbId();if(!i){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.prompt({title:"\u{1F4CB} \u6279\u91CF\u5C0E\u5165\u77E5\u8B58",message:`\u8ACB\u8CBC\u4E0A\u60A8\u7684\u77E5\u8B58\u5167\u5BB9\uFF0C\u652F\u6301\u4EE5\u4E0B\u683C\u5F0F\uFF1A
\u2022 \u6BCF\u884C\u4E00\u689D\u77E5\u8B58
\u2022 Q: \u554F\u984C / A: \u7B54\u6848 \u683C\u5F0F
\u2022 \u3010\u7522\u54C1\u77E5\u8B58\u3011\u3010\u5E38\u898B\u554F\u7B54\u3011\u7B49\u5206\u985E\u6A19\u7C64`,placeholder:`\u793A\u4F8B\uFF1A
\u3010\u7522\u54C1\u77E5\u8B58\u3011
\u6211\u5011\u7684\u670D\u52D9\u652F\u6301 24 \u5C0F\u6642\u5728\u7DDA\u5BA2\u670D
\u6700\u4F4E\u514C\u63DB\u91D1\u984D 100U\uFF0C\u6700\u9AD8\u7121\u9650\u5236

\u3010\u5E38\u898B\u554F\u7B54\u3011
Q: \u591A\u4E45\u5230\u8CEC\uFF1F
A: \u901A\u5E38 5-30 \u5206\u9418\u5230\u8CEC

Q: \u652F\u6301\u54EA\u4E9B\u4ED8\u6B3E\u65B9\u5F0F\uFF1F
A: \u652F\u6301\u5FAE\u4FE1\u3001\u652F\u4ED8\u5BF6\u3001\u9280\u884C\u5361`,inputType:"textarea",confirmText:"\u5C0E\u5165",cancelText:"\u53D6\u6D88",validator:e=>e.trim()?e.length<10?"\u5167\u5BB9\u592A\u77ED":null:"\u8ACB\u8F38\u5165\u8981\u5C0E\u5165\u7684\u5167\u5BB9",onConfirm:e=>{this.importBatchKnowledge(i,e)}})}importBatchKnowledge(i,e){let a=this.parseBatchContent(e);if(a.length===0){this.toastService.error("\u7121\u6CD5\u8B58\u5225\u77E5\u8B58\u5167\u5BB9\uFF0C\u8ACB\u6AA2\u67E5\u683C\u5F0F");return}a.forEach(r=>{this.aiService.addKnowledgeItem(i,r)}),this.toastService.success(`\u6210\u529F\u5C0E\u5165 ${a.length} \u689D\u77E5\u8B58`)}parseBatchContent(i){let e=[],a=i.split(`
`).map(M=>M.trim()).filter(M=>M),r="custom",d="";for(let M=0;M<a.length;M++){let h=a[M];if(h.match(/|/)){r="product";continue}else if(h.match(/||FAQ/i)){r="faq";continue}else if(h.match(/|/)){r="sales";continue}else if(h.match(/|/)){r="objection";continue}if(h.match(/^Q[:]/i)){d=h.replace(/^Q[:]\s*/i,"");continue}else if(h.match(/^A[:]/i)&&d){let xe=h.replace(/^A[:]\s*/i,"");e.push({title:`Q: ${d}`,content:`A: ${xe}`,category:"faq"}),d="";continue}h.length>5&&!h.startsWith("#")&&!h.startsWith("//")&&e.push({title:h.substring(0,30)+(h.length>30?"...":""),content:h,category:r})}return e}openTemplateSelector(){let i=this.activeKbId();if(!i){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}let e=this.industryTemplates.map(a=>`${a.name}
  ${a.description}`).join(`

`);this.dialogService.prompt({title:"\u{1F4DA} \u9078\u64C7\u884C\u696D\u6A21\u677F",message:`\u9078\u64C7\u4E00\u500B\u884C\u696D\u6A21\u677F\uFF0C\u7CFB\u7D71\u5C07\u81EA\u52D5\u751F\u6210\u5C0D\u61C9\u7684\u77E5\u8B58\u5EAB\u5167\u5BB9\uFF1A

\u53EF\u9078\u6A21\u677F\uFF1A
${this.industryTemplates.map(a=>a.name).join("\u3001")}`,placeholder:"\u8F38\u5165\u6A21\u677F\u540D\u7A31\uFF0C\u5982\uFF1A\u8DE8\u5883\u652F\u4ED8\u3001\u96FB\u5546\u96F6\u552E",confirmText:"\u4F7F\u7528\u6A21\u677F",cancelText:"\u53D6\u6D88",validator:a=>this.industryTemplates.find(d=>d.name.includes(a)||d.id===a.toLowerCase())?null:"\u8ACB\u8F38\u5165\u6709\u6548\u7684\u6A21\u677F\u540D\u7A31",onConfirm:a=>{let r=this.industryTemplates.find(d=>d.name.includes(a)||d.id===a.toLowerCase());r&&this.applyIndustryTemplate(i,r.id)}})}applyIndustryTemplate(i,e){this.toastService.info("\u6B63\u5728\u61C9\u7528\u884C\u696D\u6A21\u677F..."),this.aiService.applyIndustryTemplate(i,e)}learnFromChatHistory(){let i=this.activeKbId();if(!i){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.confirm({title:"\u{1F4AC} \u5F9E\u804A\u5929\u8A18\u9304\u5B78\u7FD2",message:`\u7CFB\u7D71\u5C07\u5206\u6790\u8FD1 7 \u5929\u7684\u804A\u5929\u8A18\u9304\uFF0C\u81EA\u52D5\u63D0\u53D6\u512A\u8CEA\u56DE\u8986\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB\u3002

\u6B64\u904E\u7A0B\u53EF\u80FD\u9700\u8981\u5E7E\u5206\u9418\uFF0C\u662F\u5426\u7E7C\u7E8C\uFF1F`,confirmText:"\u958B\u59CB\u5B78\u7FD2",cancelText:"\u53D6\u6D88",onConfirm:()=>{this.toastService.info("\u6B63\u5728\u5206\u6790\u804A\u5929\u8A18\u9304..."),this.aiService.learnFromChatHistory(i)}})}exportKnowledgeBase(){let i=this.knowledgeBases().find(a=>a.id===this.activeKbId());if(!i){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u77E5\u8B58\u5EAB");return}if(i.items.length===0){this.toastService.warning("\u77E5\u8B58\u5EAB\u70BA\u7A7A\uFF0C\u7121\u6CD5\u5C0E\u51FA");return}let e=this.generateExportContent(i);navigator.clipboard.writeText(e).then(()=>{this.toastService.success(`\u5DF2\u8907\u88FD ${i.items.length} \u689D\u77E5\u8B58\u5230\u526A\u8CBC\u677F`)}).catch(()=>{this.dialogService.prompt({title:"\u{1F4E4} \u5C0E\u51FA\u77E5\u8B58\u5EAB",message:"\u8ACB\u8907\u88FD\u4EE5\u4E0B\u5167\u5BB9\uFF1A",defaultValue:e,inputType:"textarea",confirmText:"\u95DC\u9589",cancelText:""})})}generateExportContent(i){let e=[`# \u77E5\u8B58\u5EAB: ${i.name}`,`# \u5C0E\u51FA\u6642\u9593: ${new Date().toLocaleString()}`,`# \u689D\u76EE\u6578\u91CF: ${i.items.length}`,""],a=["product","faq","sales","objection","custom"],r={product:"\u3010\u7522\u54C1\u77E5\u8B58\u3011",faq:"\u3010\u5E38\u898B\u554F\u7B54\u3011",sales:"\u3010\u92B7\u552E\u8A71\u8853\u3011",objection:"\u3010\u7570\u8B70\u8655\u7406\u3011",custom:"\u3010\u5176\u4ED6\u3011"};return a.forEach(d=>{let M=i.items.filter(h=>h.category===d);M.length>0&&(e.push(r[d]||`\u3010${d}\u3011`),M.forEach(h=>{d==="faq"&&e.push(h.title),e.push(h.content),e.push("")}))}),e.join(`
`)}setStyle(i){this.aiService.updateConversationStrategy({style:i})}setResponseLength(i){this.aiService.updateConversationStrategy({responseLength:i})}toggleEmoji(){this.aiService.updateConversationStrategy({useEmoji:!this.useEmoji()})}onPersonaInput(i){let e=i.target;this.customPersona.set(e.value),this.markStrategyDirty()}markStrategyDirty(){this.strategyDirty.set(!0),this.strategySaved.set(!1),this.saveStrategyToLocalStorage()}saveStrategyToLocalStorage(){let i={style:this.currentStyle(),responseLength:this.responseLength(),useEmoji:this.useEmoji(),customPersona:this.customPersona()};localStorage.setItem("ai_strategy_draft",JSON.stringify(i))}loadStrategyFromLocalStorage(){let i=localStorage.getItem("ai_strategy_draft");if(i)try{let a=JSON.parse(i);a.customPersona&&this.customPersona.set(a.customPersona),this.strategyDirty.set(!0)}catch(a){console.error("\u8F09\u5165\u7B56\u7565\u8349\u7A3F\u5931\u6557:",a)}let e=localStorage.getItem("ai_strategy_saved");if(e)try{let a=JSON.parse(e);this.originalStrategy=a,a.customPersona&&!i&&this.customPersona.set(a.customPersona),this.aiService.updateConversationStrategy(a)}catch(a){console.error("\u8F09\u5165\u7B56\u7565\u8A2D\u5B9A\u5931\u6557:",a)}}async saveStrategySettings(){this.isSavingStrategy.set(!0);let i={style:this.currentStyle(),responseLength:this.responseLength(),useEmoji:this.useEmoji(),customPersona:this.customPersona()};try{await this.aiService.saveConversationStrategyToBackend(i),localStorage.setItem("ai_strategy_saved",JSON.stringify(i)),localStorage.removeItem("ai_strategy_draft"),this.strategyDirty.set(!1),this.strategySaved.set(!0),this.originalStrategy=i,setTimeout(()=>this.strategySaved.set(!1),3e3)}catch(e){console.error("\u4FDD\u5B58\u7B56\u7565\u5931\u6557:",e),alert("\u4FDD\u5B58\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}finally{this.isSavingStrategy.set(!1)}}resetStrategy(){this.originalStrategy?(this.aiService.updateConversationStrategy(this.originalStrategy),this.customPersona.set(this.originalStrategy.customPersona||"")):(this.aiService.updateConversationStrategy({style:"friendly",responseLength:"medium",useEmoji:!0}),this.customPersona.set("")),localStorage.removeItem("ai_strategy_draft"),this.strategyDirty.set(!1)}toggleAutoChat(){this.autoChatEnabled.update(i=>!i),this.saveQuickSettings(!1)}toggleAutonomousMode(){let i=!this.autonomousModeEnabled();this.autonomousModeEnabled.set(i),localStorage.setItem("ai_autonomous_mode",String(i)),window.electronAPI?.send&&window.electronAPI.send("set-autonomous-mode",{enabled:i}),this.toastService.success(i?"\u{1F9E0} AI \u81EA\u4E3B\u6A21\u5F0F\u5DF2\u555F\u7528":"AI \u81EA\u4E3B\u6A21\u5F0F\u5DF2\u95DC\u9589"),i&&this.refreshSmartSystemStats()}goToSmartMarketing(){window.electronAPI?.send&&window.electronAPI.send("navigate-to",{path:"/smart-marketing"}),window.location.hash="#/smart-marketing"}refreshSmartSystemStats(){window.electronAPI?.send&&window.electronAPI.send("get-smart-system-stats",{});let i=e=>{let a=e.detail||{};this.smartSystemStats.set({memories:a.memories||0,tags:a.tags||0,emotions:a.emotions||0,workflows:a.workflows||0,followups:a.followups||0,knowledge:a.knowledge||0})};window.addEventListener("smart-system-stats",i,{once:!0}),this.toastService.success("\u6B63\u5728\u5237\u65B0\u7D71\u8A08...")}setAutoChatMode(i){this.autoChatMode.set(i),this.saveQuickSettings(!1)}toggleAutoGreeting(){this.autoGreetingEnabled.update(i=>!i),this.saveQuickSettings(!1)}toggleAutoReply(){this.autoReplyEnabled.update(i=>!i),this.saveQuickSettings(!1)}saveQuickSettings(i=!0){let e={auto_chat_enabled:this.autoChatEnabled()?1:0,auto_chat_mode:this.autoChatMode(),auto_greeting:this.autoGreetingEnabled()?1:0,auto_reply:this.autoReplyEnabled()?1:0};localStorage.setItem("ai_auto_chat_enabled",String(this.autoChatEnabled())),localStorage.setItem("ai_auto_chat_mode",this.autoChatMode()),localStorage.setItem("ai_auto_greeting",String(this.autoGreetingEnabled())),localStorage.setItem("ai_auto_reply",String(this.autoReplyEnabled())),window.dispatchEvent(new CustomEvent("save-ai-settings",{detail:e})),i&&alert("\u8A2D\u7F6E\u5DF2\u4FDD\u5B58\uFF01")}loadQuickSettings(){let i=localStorage.getItem("ai_auto_chat_enabled"),e=localStorage.getItem("ai_auto_chat_mode"),a=localStorage.getItem("ai_auto_greeting"),r=localStorage.getItem("ai_auto_reply"),d=localStorage.getItem("ai_autonomous_mode");i!==null&&this.autoChatEnabled.set(i==="true"),e&&this.autoChatMode.set(e),a!==null&&this.autoGreetingEnabled.set(a==="true"),r!==null&&this.autoReplyEnabled.set(r==="true"),d!==null&&this.autonomousModeEnabled.set(d==="true")}selectTab(i){this.activeTab.set(i),i==="knowledge"?this.router.navigate(["/ai-engine/overview"],{replaceUrl:!0}):i==="quick"?this.router.navigate(["/ai-engine"],{replaceUrl:!0}):this.router.navigate(["/ai-engine"],{queryParams:{tab:i},replaceUrl:!0})}selectKnowledgeSubTab(i){this.knowledgeSubTab.set(i);let e=i==="overview"?"/ai-engine/overview":i==="manage"?"/ai-engine/knowledge":"/ai-engine/gaps";this.router.navigate([e],{replaceUrl:!0})}ngOnInit(){this.loadQuickSettings(),this.loadSenderAccounts(),this.loadStrategyFromLocalStorage();let i=this.initialTab();if(i){this.activeTab.set(i);let r=this.initialKnowledgeSub();i==="knowledge"&&r&&this.knowledgeSubTab.set(r);return}let e=this.navBridge.currentView(),a=l.VIEW_TAB_MAP[e];a&&(this.activeTab.set(a),a==="knowledge"&&(e==="knowledge-manage"?this.knowledgeSubTab.set("manage"):e==="knowledge-gaps"?this.knowledgeSubTab.set("gaps"):this.knowledgeSubTab.set("overview")))}loadSenderAccounts(){window.dispatchEvent(new CustomEvent("get-sender-accounts")),window.addEventListener("sender-accounts-loaded",(i=>{let e=i.detail||[];this.senderAccounts.set(e)}),{once:!0})}selectPersonaTemplate(i){this.selectedPersonaTemplate.set(i);let e=this.personaTemplates.find(a=>a.id===i);e&&(this.customPersona.set(e.prompt),this.markStrategyDirty(),this.updatePreviewForPersona(i))}updatePreviewForPersona(i){let e={friendly:"\u60A8\u597D\u5440\uFF01\u611F\u8B1D\u60A8\u7684\u8AEE\u8A62 \u{1F60A} \u6211\u5011\u7684\u670D\u52D9\u50F9\u683C\u6839\u64DA\u60A8\u7684\u5177\u9AD4\u9700\u6C42\u800C\u5B9A\uFF0C\u8ACB\u554F\u60A8\u4E3B\u8981\u60F3\u4E86\u89E3\u54EA\u65B9\u9762\u7684\u670D\u52D9\u5462\uFF1F",professional:"\u611F\u8B1D\u60A8\u7684\u5782\u8A62\u3002\u6211\u5011\u63D0\u4F9B\u591A\u7A2E\u670D\u52D9\u65B9\u6848\uFF0C\u50F9\u683C\u5340\u9593\u5F9E\u57FA\u790E\u7248\u5230\u4F01\u696D\u7248\u4E0D\u7B49\u3002\u8ACB\u554F\u60A8\u7684\u5177\u9AD4\u9700\u6C42\u662F\u4EC0\u9EBC\uFF1F\u6211\u53EF\u4EE5\u70BA\u60A8\u63A8\u85A6\u6700\u5408\u9069\u7684\u65B9\u6848\u3002",enthusiastic:"\u592A\u597D\u4E86\uFF01\u611F\u8B1D\u60A8\u5C0D\u6211\u5011\u670D\u52D9\u7684\u95DC\u6CE8\uFF01\u{1F389} \u6211\u5011\u6709\u8D85\u503C\u7684\u512A\u60E0\u5957\u9910\u7B49\u8457\u60A8\uFF01\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0C\u6211\u53EF\u4EE5\u70BA\u60A8\u91CF\u8EAB\u5B9A\u5236\u6700\u5212\u7B97\u7684\u65B9\u6848\uFF01",efficient:"\u60A8\u597D\u3002\u50F9\u683C\u8996\u9700\u6C42\u800C\u5B9A\u3002\u8ACB\u8AAA\u660E\u5177\u9AD4\u9700\u6C42\uFF0C\u6211\u70BA\u60A8\u5831\u50F9\u3002"};this.previewResponse.set(e[i]||e.friendly)}toggleRule(i){let e=this.defaultRules.find(a=>a.id===i);e&&(e.isActive=!e.isActive,this.markStrategyDirty())}getPersonaName(){return this.personaTemplates.find(e=>e.id===this.selectedPersonaTemplate())?.name||"\u53CB\u597D\u52A9\u624B"}getPreviewResponse(){return this.previewResponse()}regeneratePreview(){this.toastService.info("\u6B63\u5728\u751F\u6210\u9810\u89BD...");let i=["\u60A8\u597D\uFF01\u611F\u8B1D\u8AEE\u8A62\uFF0C\u6211\u5011\u7684\u50F9\u683C\u975E\u5E38\u6709\u7AF6\u722D\u529B\uFF0C\u5177\u9AD4\u8981\u770B\u60A8\u7684\u9700\u6C42\u54E6\uFF5E","\u89AA\uFF0C\u6211\u5011\u7684\u670D\u52D9\u6027\u50F9\u6BD4\u8D85\u9AD8\uFF01\u60A8\u60F3\u4E86\u89E3\u54EA\u500B\u5957\u9910\u5462\uFF1F","\u611F\u8B1D\u60A8\u7684\u95DC\u6CE8\uFF01\u6211\u5011\u6709\u591A\u7A2E\u50F9\u4F4D\u53EF\u9078\uFF0C\u6211\u5E6B\u60A8\u8A73\u7D30\u4ECB\u7D39\u4E00\u4E0B\uFF1F"],e=i[Math.floor(Math.random()*i.length)];this.previewResponse.set(e)}async savePersonaSettings(){await this.saveStrategySettings();let i=this.defaultRules.map(e=>({id:e.id,isActive:e.isActive}));localStorage.setItem("ai_rules_state",JSON.stringify(i)),this.toastService.success("AI \u4EBA\u683C\u8A2D\u5B9A\u5DF2\u4FDD\u5B58")}static{this.\u0275fac=function(e){return new(e||l)}}static{this.\u0275cmp=P({type:l,selectors:[["app-ai-center"]],inputs:{initialTab:[1,"initialTab"],initialKnowledgeSub:[1,"initialKnowledgeSub"]},decls:39,vars:7,consts:[[1,"ai-center","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-2","px-3","py-1","bg-emerald-500/20","text-emerald-400","rounded-full","text-sm"],[1,"px-3","py-1","bg-yellow-500/20","text-yellow-400","rounded-full","text-sm"],[1,"flex","items-center","gap-6","px-4","py-2","bg-slate-800/80","rounded-xl","border","border-slate-700/50"],[1,"text-center"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-xs","text-slate-500"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-purple-400"],[1,"flex","gap-1","mt-4","bg-slate-800/50","p-1","rounded-xl","w-fit"],[1,"px-5","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"bg-gradient-to-r","from-purple-500","to-pink-500","text-white","shadow-lg","text-slate-400","hover:text-white","hover:bg-slate-700/50"],[1,"flex-1","overflow-y-auto","p-4"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"max-w-5xl","mx-auto","space-y-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"w-2","h-2","bg-emerald-500","rounded-full"],[1,"px-5","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"click"],[1,"text-lg"],[1,"bg-gradient-to-br","from-purple-500/20","to-pink-500/20","rounded-2xl","border","border-purple-500/30","p-6"],[1,"w-14","h-14","rounded-xl","bg-purple-500/30","flex","items-center","justify-center","text-3xl"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","text-sm"],[1,"relative","w-16","h-8","rounded-full","transition-all",3,"click"],[1,"absolute","top-1","left-1","w-6","h-6","bg-white","rounded-full","shadow","transition-transform"],[1,"mt-6","pt-6","border-t","border-purple-500/30","space-y-4"],[1,"bg-gradient-to-br","from-cyan-500/20","to-purple-500/20","rounded-2xl","border","border-cyan-500/30","p-6"],[1,"w-14","h-14","rounded-xl","bg-gradient-to-br","from-cyan-500/30","to-purple-500/30","flex","items-center","justify-center","text-3xl"],[1,"text-xl","font-bold","text-white","flex","items-center","gap-2"],[1,"px-2","py-0.5","text-xs","bg-purple-500/30","text-purple-400","rounded-full"],[1,"px-6","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-all","shadow-lg","flex","items-center","gap-2",3,"click"],[1,"mt-6","pt-6","border-t","border-cyan-500/30"],[1,"grid","grid-cols-4","gap-3","text-center"],[1,"p-3","bg-slate-800/50","rounded-xl"],[1,"text-xl","mb-1"],[1,"text-xs","font-medium","text-white"],[1,"text-xs","text-cyan-400","mt-4","text-center"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-6"],[1,"flex","items-center","gap-3","mb-4"],[1,"font-semibold","text-white"],[1,"text-sm","text-slate-400"],[1,"space-y-2"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg"],[1,"text-center","py-8","text-slate-400"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","text-sm",3,"click"],[1,"flex","items-center","gap-4","p-4","bg-emerald-500/10","border","border-emerald-500/30","rounded-xl"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"flex","justify-end"],[1,"px-6","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:from-purple-400","hover:to-pink-400","transition-all","shadow-lg",3,"click"],[1,"text-sm","text-slate-400","block","mb-2"],[1,"grid","grid-cols-3","gap-3"],[1,"p-4","rounded-xl","border","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400"],[1,"grid","grid-cols-2","gap-4"],[1,"flex","items-center","justify-between","p-4","bg-slate-700/50","rounded-xl"],[1,"text-xl"],["type","checkbox",1,"w-5","h-5","rounded","bg-slate-600","border-slate-500",3,"change","checked"],[1,"w-10","h-10","rounded-full","bg-cyan-500/20","flex","items-center","justify-center","overflow-hidden"],["alt","Avatar",1,"w-full","h-full","object-cover",3,"src"],[1,"text-cyan-400"],[1,"flex","items-center","gap-1","text-emerald-400","text-sm"],[1,"text-3xl","mb-2"],[1,"text-sm","text-slate-500"],[1,"w-12","h-12","rounded-xl","bg-emerald-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1"],[1,"flex","items-center","gap-1","text-emerald-400"],[1,"font-medium","text-amber-400"],[1,"bg-gradient-to-br","from-emerald-500/10","to-cyan-500/10","rounded-xl","border","border-emerald-500/30","p-6"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded-full"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30","transition-colors",3,"click"],[1,"space-y-3"],[1,"flex","items-center","justify-between","p-4","bg-slate-800/50","rounded-xl"],[1,"text-center","py-6","text-slate-400"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"flex","items-center","justify-between","p-4","bg-slate-700/50","rounded-xl","hover:bg-slate-700","transition-colors"],[1,"mt-6","pt-6","border-t","border-slate-700/50"],[1,"bg-gradient-to-br","from-purple-500/10","to-pink-500/10","rounded-xl","border","border-purple-500/30","p-6"],[1,"px-2","py-0.5","bg-purple-500/20","text-purple-400","text-xs","rounded-full"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","change","ngModel"],[1,"w-11","h-6","bg-slate-600","peer-focus:outline-none","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-purple-500"],[1,"ms-3","text-sm","font-medium","text-slate-300"],[1,"text-sm","text-slate-400","mb-4"],[1,"space-y-4"],[1,"text-center","py-4","text-slate-400"],[1,"w-12","h-12","rounded-xl","bg-emerald-500/20","flex","items-center","justify-center"],[1,"text-xs","text-slate-400","truncate","max-w-xs"],[1,"text-amber-400","text-sm"],[1,"px-3","py-1","bg-slate-600","text-slate-300","rounded-lg","text-sm","hover:bg-slate-500","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-1",3,"click","disabled"],[1,"px-3","py-1","text-sm","rounded-lg","transition-colors",3,"click"],[1,"text-red-400","hover:text-red-300","p-1",3,"click"],[1,"inline-block","w-3","h-3","border-2","border-slate-400","border-t-transparent","rounded-full","animate-spin"],[1,"text-sm","mb-3"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30",3,"click"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center"],[1,"text-slate-500","text-sm"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30",3,"click"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-emerald-400","flex","items-center","gap-1"],[1,"grid","grid-cols-3","gap-4"],[1,"text-xs","text-slate-400","block","mb-2"],[1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"change","value"],["value",""],[3,"value","selected"],[1,"text-xs","text-slate-500","mt-3"],[1,"animate-spin"],["type","text","placeholder","http://localhost:9881",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1"],[1,"flex","gap-3"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors","disabled:opacity-50","flex","items-center","gap-2",3,"click","disabled"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30","transition-colors","flex","items-center","gap-2"],[1,"flex","items-center","gap-2","text-emerald-400","text-sm"],[1,"inline-block","w-4","h-4","border-2","border-purple-400","border-t-transparent","rounded-full","animate-spin"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-slate-500"],[1,"text-sm"],[1,"flex","items-center","justify-between","mb-6"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors"],[1,"grid","grid-cols-4","gap-4"],[1,"p-5","rounded-xl","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700/50","hover:bg-slate-700"],[1,"font-semibold","text-white","mb-6","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-6"],[1,"grid","grid-cols-2","gap-3"],[1,"p-4","rounded-xl","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700/50"],[1,"flex","gap-2"],[1,"flex-1","py-2","px-4","rounded-lg","text-sm","transition-colors",3,"bg-purple-500","text-white","bg-slate-700","text-slate-300"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","cursor-pointer",3,"click"],[1,"text-white","text-sm"],["type","checkbox",1,"w-5","h-5","rounded","text-purple-500","bg-slate-700","border-slate-600","pointer-events-none",3,"checked"],["rows","6","placeholder","\u4F8B\u5982\uFF1A\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684\u92B7\u552E\u9867\u554F\uFF0C\u5177\u67095\u5E74\u884C\u696D\u7D93\u9A57\uFF0C\u64C5\u9577\u89E3\u7B54\u5BA2\u6236\u7591\u554F...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none",3,"input","value"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-xs","text-slate-500","font-normal"],[1,"flex","items-center","justify-between","p-4","bg-slate-700/50","rounded-xl","cursor-pointer","hover:bg-slate-700","transition-colors"],[1,"mt-4","w-full","py-3","border","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","hover:border-purple-500","transition-colors"],[1,"bg-gradient-to-r","from-purple-900/30","to-blue-900/30","rounded-xl","border","border-purple-500/30","p-6"],[1,"font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"bg-slate-900/50","rounded-xl","p-4"],[1,"mb-3"],[1,"text-slate-300"],[1,"border-t","border-slate-700","pt-3"],[1,"text-xs","text-purple-400"],[1,"text-white"],[1,"mt-3","px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"flex","justify-between","items-center","bg-slate-800/80","rounded-xl","p-4","border","border-slate-700/50","sticky","bottom-4"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-lg","transition-all","shadow-lg","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"p-5","rounded-xl","text-center","transition-all","border-2",3,"click"],[1,"font-medium"],[1,"text-xs","text-slate-400","mt-1"],[1,"p-4","rounded-xl","text-center","transition-all","border-2",3,"click"],[1,"text-sm","font-medium"],[1,"flex-1","py-2","px-4","rounded-lg","text-sm","transition-colors",3,"click"],["type","checkbox",1,"w-5","h-5","rounded","text-purple-500","bg-slate-700","border-slate-600","cursor-pointer",3,"change","checked"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"text-3xl","font-bold","text-cyan-400"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"text-3xl","font-bold","text-purple-400"],[1,"text-3xl","font-bold","text-orange-400"],[1,"font-semibold","text-white","mb-4"],[1,"text-4xl","font-bold","text-white","mb-1"],[1,"text-slate-400"],[1,"text-4xl","font-bold","text-emerald-400","mb-1"],[1,"bg-gradient-to-br","from-cyan-500/10","to-purple-500/10","rounded-xl","border","border-cyan-500/30","p-6"],[1,"px-2","py-0.5","text-xs","bg-emerald-500/30","text-emerald-400","rounded-full"],[1,"px-2","py-0.5","text-xs","bg-slate-500/30","text-slate-400","rounded-full"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","text-sm","flex","items-center","gap-2",3,"click"],[1,"bg-slate-800/50","rounded-lg","p-4"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-2xl","font-bold","text-amber-400"],[1,"text-2xl","font-bold","text-blue-400"],[1,"mt-4","pt-4","border-t","border-slate-700/50"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors",3,"click"],[1,"flex","gap-1","bg-slate-800/50","p-1","rounded-xl","w-fit"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],[1,"text-sm","text-slate-400","mb-1"],[1,"mt-4","px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm",3,"click"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-md","p-6","shadow-xl","border","border-slate-700"],[1,"text-xl","font-bold","text-white","mb-6"],[1,"grid","grid-cols-3","gap-2"],[1,"p-3","rounded-lg","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700"],[1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"ngModelChange","ngModel"],[3,"value"],["type","password","placeholder","sk-...",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],["type","text","placeholder","\u5982 \u6211\u7684 GPT-4",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-2.5","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors",3,"click"],[1,"p-3","rounded-lg","text-center","transition-all","border-2",3,"click"],[1,"text-xs"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-lg","p-6","shadow-xl","border","border-emerald-500/30"],[1,"text-xl","font-bold","text-white","mb-2","flex","items-center","gap-2"],[1,"text-slate-400","text-sm","mb-6"],["type","text","placeholder","https://your-ollama.ts.net/api/chat",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],["type","text","placeholder","qwen2.5, llama3.2, mistral",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"text-emerald-400"],["type","text","placeholder","\u6211\u7684\u672C\u5730 AI",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"w-full","py-2.5","bg-cyan-500/20","text-cyan-400","rounded-lg","hover:bg-cyan-500/30","transition-colors","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"flex-1","py-2.5","bg-emerald-500","text-white","rounded-lg","hover:bg-emerald-400","transition-colors",3,"click"]],template:function(e,a){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),o(6,"\u2699\uFE0F"),t(),o(7," \u667A\u80FD\u5F15\u64CE\u8A2D\u7F6E "),t(),n(8,"div",6),_(9,Ve,3,0,"span",7)(10,Ke,2,0,"span",8),t()(),n(11,"div",3)(12,"div",9)(13,"div",10)(14,"div",11),o(15),t(),n(16,"div",12),o(17,"\u4ECA\u65E5\u5C0D\u8A71"),t()(),n(18,"div",10)(19,"div",13),o(20),t(),n(21,"div",12),o(22,"\u8F49\u5316\u7387"),t()(),n(23,"div",10)(24,"div",14),o(25),t(),n(26,"div",12),o(27,"\u4ECA\u65E5\u6210\u672C"),t()()()()(),n(28,"div",15),D(29,Ne,5,18,"button",16,I),t()(),n(31,"div",17),_(32,We,84,9,"div",18)(33,ft,45,6,"div",18)(34,At,83,8,"div",18)(35,Ft,113,13,"div",18)(36,Bt,11,25,"div",19),t(),_(37,Kt,34,3,"div",20),_(38,Lt,34,5,"div",20),t()),e&2){let r;s(9),C(a.aiService.isConnected()?9:10),s(6),g(a.aiService.stats().today.conversations),s(5),b("",(a.aiService.stats().weekly.conversionRate*100).toFixed(1),"%"),s(5),b("\xA5",a.aiService.stats().today.cost.toFixed(2)),s(4),A(a.tabs),s(3),C((r=a.activeTab())==="quick"?32:r==="models"?33:r==="persona"?34:r==="stats"?35:r==="knowledge"?36:-1),s(5),C(a.showAddModel()?37:-1),s(),C(a.showAddLocalModel()?38:-1)}},dependencies:[B,O,L,j,W,se,G,K,N,J,Y],encapsulation:2})}};var ge=class l{constructor(){this.i18n=w(ce);this.nav=w(U);this.route=w(re);this.membershipService=w(de);this.aiService=w(ue);this.routeDataSub=null;this.queryParamsSub=null;this.initialTab=x(void 0);this.initialKnowledgeSub=x(void 0);this.activeTab=x("config")}setPanelFromRoute(){let i=this.route.snapshot.data.enginePanel,e=this.route.snapshot.queryParams.tab;i==="overview"?(this.initialTab.set("knowledge"),this.initialKnowledgeSub.set("overview")):i==="knowledge"?(this.initialTab.set("knowledge"),this.initialKnowledgeSub.set("manage")):i==="gaps"?(this.initialTab.set("knowledge"),this.initialKnowledgeSub.set("gaps")):e&&["quick","models","persona","stats","knowledge"].includes(e)?(this.initialTab.set(e),this.initialKnowledgeSub.set(e==="knowledge"?"overview":void 0)):(this.initialTab.set(void 0),this.initialKnowledgeSub.set(void 0))}ngOnInit(){this.setPanelFromRoute(),this.routeDataSub=this.route.data.subscribe(()=>this.setPanelFromRoute()),this.queryParamsSub=this.route.queryParams.subscribe(()=>this.setPanelFromRoute()),this.aiService.loadSettings()}ngOnDestroy(){this.routeDataSub?.unsubscribe(),this.queryParamsSub?.unsubscribe()}t(i,e){return this.i18n.t(i,e)}navigateTo(i){this.nav.navigateTo(i)}setActiveTab(i){this.activeTab.set(i)}static{this.\u0275fac=function(e){return new(e||l)}}static{this.\u0275cmp=P({type:l,selectors:[["app-ai-center-view"]],decls:1,vars:2,consts:[[3,"tabChange","navigate","initialTab","initialKnowledgeSub"]],template:function(e,a){e&1&&(n(0,"app-ai-center",0),u("tabChange",function(d){return a.setActiveTab(d)})("navigate",function(d){return a.navigateTo(d)}),t()),e&2&&f("initialTab",a.initialTab())("initialKnowledgeSub",a.initialKnowledgeSub())},dependencies:[B,O,X],encapsulation:2,changeDetection:0})}};export{ge as AiCenterViewComponent};
