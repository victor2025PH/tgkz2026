import{a as z}from"./chunk-24SFQVZB.js";import"./chunk-FF535MQ4.js";import{b as D,c as I,f as U,t as A}from"./chunk-BCTLVZY2.js";import{b as B}from"./chunk-6FHZTSI7.js";import{o as T}from"./chunk-35776WZA.js";import{Ab as k,Eb as w,Fb as b,Gb as y,La as F,O as E,T as p,U as u,Ya as g,Za as _,ab as h,bb as P,cb as S,da as f,db as i,eb as t,fb as M,jb as C,nb as x,pb as d,vb as V,xa as n,xb as l,yb as m,zb as v}from"./chunk-MB4RORS3.js";var O=(o,r)=>r.id;function N(o,r){if(o&1){let e=C();i(0,"button",7),x("click",function(){let s=p(e).$implicit,c=d();return u(c.activeTab.set(s.id))}),i(1,"span",8),l(2),t(),i(3,"span",9),l(4),t()()}if(o&2){let e=r.$implicit,a=d();V("active",a.activeTab()===e.id),n(2),m(e.icon),n(2),m(a.t(e.label))}}function K(o,r){o&1&&M(0,"span",17)}function L(o,r){o&1&&(i(0,"span",18),l(1,"\u2705 \u5DF2\u4FDD\u5B58"),t())}function j(o,r){if(o&1){let e=C();i(0,"div",6)(1,"h2"),l(2),t(),i(3,"div",10)(4,"label"),l(5),t(),M(6,"input",11),i(7,"span",12),l(8,"\u90F5\u7BB1\u7121\u6CD5\u66F4\u6539"),t()(),i(9,"div",10)(10,"label"),l(11),t(),i(12,"input",13),y("ngModelChange",function(s){p(e);let c=d();return b(c.profileForm.username,s)||(c.profileForm.username=s),u(s)}),t()(),i(13,"div",10)(14,"label"),l(15),t(),i(16,"input",14),y("ngModelChange",function(s){p(e);let c=d();return b(c.profileForm.display_name,s)||(c.profileForm.display_name=s),u(s)}),t()(),i(17,"div",10)(18,"label"),l(19),t(),i(20,"input",15),y("ngModelChange",function(s){p(e);let c=d();return b(c.profileForm.avatar_url,s)||(c.profileForm.avatar_url=s),u(s)}),t()(),i(21,"button",16),x("click",function(){p(e);let s=d();return u(s.saveProfile())}),g(22,K,1,0,"span",17),l(23),t(),g(24,L,2,0,"span",18),t()}if(o&2){let e,a=d();n(2),m(a.t("userSettings.profile")),n(3),m(a.t("auth.email")),n(),S("value",((e=a.user())==null?null:e.email)||""),n(5),m(a.t("auth.username")),n(),w("ngModel",a.profileForm.username),S("placeholder",a.t("auth.usernamePlaceholder")),n(3),m(a.t("userSettings.displayName")),n(),w("ngModel",a.profileForm.display_name),n(3),m(a.t("userSettings.avatarUrl")),n(),w("ngModel",a.profileForm.avatar_url),n(),S("disabled",a.isSaving()),n(),_(a.isSaving()?22:-1),n(),v(" ",a.t("userSettings.updateProfile")," "),n(),_(a.saveSuccess()?24:-1)}}function G(o,r){if(o&1&&(i(0,"div",26),l(1),t()),o&2){let e=d(3);n(),m(e.passwordError())}}function R(o,r){o&1&&M(0,"span",17)}function q(o,r){if(o&1){let e=C();i(0,"div",22)(1,"div",10)(2,"label"),l(3),t(),i(4,"input",24),y("ngModelChange",function(s){p(e);let c=d(2);return b(c.passwordForm.currentPassword,s)||(c.passwordForm.currentPassword=s),u(s)}),t()(),i(5,"div",10)(6,"label"),l(7),t(),i(8,"input",25),y("ngModelChange",function(s){p(e);let c=d(2);return b(c.passwordForm.newPassword,s)||(c.passwordForm.newPassword=s),u(s)}),t()(),i(9,"div",10)(10,"label"),l(11),t(),i(12,"input",25),y("ngModelChange",function(s){p(e);let c=d(2);return b(c.passwordForm.confirmPassword,s)||(c.passwordForm.confirmPassword=s),u(s)}),t()(),g(13,G,2,1,"div",26),i(14,"button",16),x("click",function(){p(e);let s=d(2);return u(s.changePassword())}),g(15,R,1,0,"span",17),l(16," \u78BA\u8A8D\u4FEE\u6539 "),t()()}if(o&2){let e=d(2);n(3),m(e.t("auth.currentPassword")),n(),w("ngModel",e.passwordForm.currentPassword),n(3),m(e.t("auth.newPassword")),n(),w("ngModel",e.passwordForm.newPassword),n(3),m(e.t("auth.confirmNewPassword")),n(),w("ngModel",e.passwordForm.confirmPassword),n(),_(e.passwordError()?13:-1),n(),S("disabled",e.isChangingPassword()),n(),_(e.isChangingPassword()?15:-1)}}function H(o,r){if(o&1){let e=C();i(0,"div",6)(1,"h2"),l(2),t(),i(3,"div",19)(4,"div",20)(5,"h3"),l(6),t(),i(7,"p"),l(8,"\u5B9A\u671F\u66F4\u63DB\u5BC6\u78BC\u4EE5\u4FDD\u8B77\u5E33\u6236\u5B89\u5168"),t()(),i(9,"button",21),x("click",function(){p(e);let s=d();return u(s.showPasswordForm.set(!s.showPasswordForm()))}),l(10),t()(),g(11,q,17,9,"div",22),i(12,"div",19)(13,"div",20)(14,"h3"),l(15,"\u5169\u6B65\u9A57\u8B49"),t(),i(16,"p"),l(17,"\u589E\u52A0\u5E33\u6236\u5B89\u5168\u6027"),t()(),i(18,"span",23),l(19,"\u5373\u5C07\u63A8\u51FA"),t()()()}if(o&2){let e=d();n(2),m(e.t("userSettings.security")),n(4),m(e.t("auth.changePassword")),n(4),v(" ",e.showPasswordForm()?"\u53D6\u6D88":"\u4FEE\u6539"," "),n(),_(e.showPasswordForm()?11:-1)}}function J(o,r){o&1&&(i(0,"div",28),l(1,"\u8F09\u5165\u4E2D..."),t())}function Q(o,r){o&1&&(i(0,"span",36),l(1,"\u7576\u524D\u8A2D\u5099"),t())}function X(o,r){if(o&1){let e=C();i(0,"button",38),x("click",function(){p(e);let s=d().$implicit,c=d(3);return u(c.revokeSession(s.id))}),l(1),t()}if(o&2){let e=d(4);n(),v(" ",e.t("userSettings.revokeSession")," ")}}function Y(o,r){if(o&1&&(i(0,"div",32)(1,"div",33),l(2),t(),i(3,"div",34)(4,"strong"),l(5),t(),i(6,"span",35),l(7),t(),g(8,Q,2,0,"span",36),t(),g(9,X,2,1,"button",37),t()),o&2){let e=r.$implicit,a=d(3);V("current",e.is_current),n(2),v(" ",a.getDeviceIcon(e.device_type)," "),n(3),m(e.device_name||"\u672A\u77E5\u8A2D\u5099"),n(2),k(" ",e.ip_address," \xB7 \u6700\u5F8C\u6D3B\u52D5: ",a.formatDate(e.last_activity_at)," "),n(),_(e.is_current?8:-1),n(),_(e.is_current?-1:9)}}function Z(o,r){if(o&1){let e=C();i(0,"button",39),x("click",function(){p(e);let s=d(3);return u(s.revokeAllSessions())}),l(1),t()}if(o&2){let e=d(3);n(),v(" ",e.t("userSettings.revokeAllSessions")," ")}}function $(o,r){if(o&1&&(i(0,"div",29),h(1,Y,10,8,"div",30,O),t(),g(3,Z,2,1,"button",31)),o&2){let e=d(2);n(),P(e.sessions()),n(2),_(e.sessions().length>1?3:-1)}}function ee(o,r){if(o&1&&(i(0,"div",6)(1,"h2"),l(2),t(),i(3,"p",27),l(4,"\u7BA1\u7406\u60A8\u5728\u5404\u8A2D\u5099\u4E0A\u7684\u767B\u5165\u72C0\u614B"),t(),g(5,J,2,0,"div",28)(6,$,4,1),t()),o&2){let e=d();n(2),m(e.t("auth.sessions")),n(3),_(e.isLoadingSessions()?5:6)}}function te(o,r){if(o&1){let e=C();i(0,"div",41)(1,"div",43)(2,"strong"),l(3),t(),i(4,"code"),l(5),t(),i(6,"span",44),l(7),t()(),i(8,"button",38),x("click",function(){let s=p(e).$implicit,c=d(2);return u(c.deleteApiKey(s.id))}),l(9),t()()}if(o&2){let e=r.$implicit,a=d(2);n(3),m(e.name),n(2),v("",e.prefix,"...****"),n(2),k(" ",a.t("userSettings.lastUsed"),": ",e.last_used_at?a.formatDate(e.last_used_at):a.t("userSettings.neverUsed")," "),n(2),v(" ",a.t("userSettings.deleteApiKey")," ")}}function ne(o,r){o&1&&(i(0,"p",42),l(1,"\u66AB\u7121 API \u91D1\u9470"),t())}function ie(o,r){if(o&1){let e=C();i(0,"div",6)(1,"h2"),l(2),t(),i(3,"p",27),l(4,"\u7528\u65BC\u7A0B\u5E8F\u5316\u8A2A\u554F TG-Matrix API"),t(),i(5,"div",40),h(6,te,10,5,"div",41,O,!1,ne,2,0,"p",42),t(),i(9,"button",21),x("click",function(){p(e);let s=d();return u(s.createApiKey())}),l(10),t()()}if(o&2){let e=d();n(2),m(e.t("userSettings.apiKeys")),n(4),P(e.apiKeys()),n(4),v(" + ",e.t("userSettings.createApiKey")," ")}}var W=class o{constructor(){this.authService=E(z);this.i18n=E(B);this.tabs=[{id:"profile",icon:"\u{1F464}",label:"userSettings.profile"},{id:"security",icon:"\u{1F512}",label:"userSettings.security"},{id:"sessions",icon:"\u{1F4F1}",label:"auth.sessions"},{id:"apiKeys",icon:"\u{1F511}",label:"userSettings.apiKeys"}];this.activeTab=f("profile");this.user=this.authService.user;this.profileForm={username:"",display_name:"",avatar_url:""};this.isSaving=f(!1);this.saveSuccess=f(!1);this.showPasswordForm=f(!1);this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""};this.isChangingPassword=f(!1);this.passwordError=f(null);this.sessions=f([]);this.isLoadingSessions=f(!1);this.apiKeys=f([])}t(r){return this.i18n.t(r)}ngOnInit(){let r=this.user();r&&(this.profileForm={username:r.username||"",display_name:r.display_name||"",avatar_url:r.avatar_url||""}),this.loadSessions()}async saveProfile(){this.isSaving.set(!0),this.saveSuccess.set(!1);try{(await this.authService.updateProfile(this.profileForm)).success&&(this.saveSuccess.set(!0),setTimeout(()=>this.saveSuccess.set(!1),3e3))}finally{this.isSaving.set(!1)}}async changePassword(){if(this.passwordForm.newPassword!==this.passwordForm.confirmPassword){this.passwordError.set("\u65B0\u5BC6\u78BC\u4E0D\u5339\u914D");return}this.isChangingPassword.set(!0),this.passwordError.set(null);try{let r=await this.authService.changePassword(this.passwordForm.currentPassword,this.passwordForm.newPassword);r.success?(this.showPasswordForm.set(!1),this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""}):this.passwordError.set(r.error||"\u4FEE\u6539\u5931\u6557")}finally{this.isChangingPassword.set(!1)}}async loadSessions(){this.isLoadingSessions.set(!0);try{let r=await this.authService.getSessions();this.sessions.set(r)}finally{this.isLoadingSessions.set(!1)}}async revokeSession(r){await this.authService.revokeSession(r)&&this.sessions.update(a=>a.filter(s=>s.id!==r))}async revokeAllSessions(){if(!confirm("\u78BA\u5B9A\u8981\u767B\u51FA\u6240\u6709\u5176\u4ED6\u8A2D\u5099\u55CE\uFF1F\u9019\u5C07\u8981\u6C42\u5728\u9019\u4E9B\u8A2D\u5099\u4E0A\u91CD\u65B0\u767B\u5165\u3002"))return;let r=await this.authService.revokeAllOtherSessions();r>0&&(await this.loadSessions(),alert(`\u5DF2\u6210\u529F\u767B\u51FA ${r} \u500B\u8A2D\u5099`))}createApiKey(){}deleteApiKey(r){}getDeviceIcon(r){return{desktop:"\u{1F4BB}",web:"\u{1F310}",mobile:"\u{1F4F1}",tablet:"\u{1F4F1}"}[r]||"\u{1F4BB}"}formatDate(r){return r?new Date(r).toLocaleDateString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"\u672A\u77E5"}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=F({type:o,selectors:[["app-user-settings-view"]],decls:13,vars:5,consts:[[1,"user-settings-page"],[1,"page-header"],[1,"settings-container"],[1,"settings-nav"],[1,"nav-item",3,"active"],[1,"settings-content"],[1,"settings-section"],[1,"nav-item",3,"click"],[1,"nav-icon"],[1,"nav-label"],[1,"form-group"],["type","email","disabled","",1,"input-disabled",3,"value"],[1,"hint"],["type","text",3,"ngModelChange","ngModel","placeholder"],["type","text","placeholder","\u60A8\u7684\u986F\u793A\u540D\u7A31",3,"ngModelChange","ngModel"],["type","url","placeholder","https://...",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"click","disabled"],[1,"loading-spinner"],[1,"success-message"],[1,"security-item"],[1,"item-info"],[1,"btn-secondary",3,"click"],[1,"password-form"],[1,"badge"],["type","password","autocomplete","current-password",3,"ngModelChange","ngModel"],["type","password","autocomplete","new-password",3,"ngModelChange","ngModel"],[1,"error-message"],[1,"section-desc"],[1,"loading-state"],[1,"sessions-list"],[1,"session-item",3,"current"],[1,"btn-danger"],[1,"session-item"],[1,"session-icon"],[1,"session-info"],[1,"session-meta"],[1,"current-badge"],[1,"btn-danger-small"],[1,"btn-danger-small",3,"click"],[1,"btn-danger",3,"click"],[1,"api-keys-list"],[1,"api-key-item"],[1,"empty-state"],[1,"key-info"],[1,"key-meta"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"header",1)(2,"h1"),l(3),t()(),i(4,"div",2)(5,"nav",3),h(6,N,5,4,"button",4,O),t(),i(8,"div",5),g(9,j,25,14,"div",6),g(10,H,20,4,"div",6),g(11,ee,7,2,"div",6),g(12,ie,11,3,"div",6),t()()()),e&2&&(n(3),m(a.t("userSettings.title")),n(3),P(a.tabs),n(3),_(a.activeTab()==="profile"?9:-1),n(),_(a.activeTab()==="security"?10:-1),n(),_(a.activeTab()==="sessions"?11:-1),n(),_(a.activeTab()==="apiKeys"?12:-1))},dependencies:[T,A,D,I,U],styles:[".user-settings-page[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin-bottom:1.5rem}.settings-container[_ngcontent-%COMP%]{display:flex;gap:2rem;background:var(--bg-secondary, #1a1a1a);border-radius:12px;overflow:hidden}.settings-nav[_ngcontent-%COMP%]{width:240px;padding:1rem;background:var(--bg-tertiary, #151515);border-right:1px solid var(--border-color, #333)}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;width:100%;padding:.75rem 1rem;background:transparent;border:none;border-radius:8px;color:var(--text-secondary, #888);font-size:.875rem;cursor:pointer;transition:all .2s ease;text-align:left}.nav-item[_ngcontent-%COMP%]:hover{background:#ffffff0d;color:var(--text-primary, #fff)}.nav-item.active[_ngcontent-%COMP%]{background:var(--primary, #3b82f6);color:#fff}.nav-icon[_ngcontent-%COMP%]{font-size:1.25rem}.settings-content[_ngcontent-%COMP%]{flex:1;padding:2rem}.settings-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:.5rem}.section-desc[_ngcontent-%COMP%]{color:var(--text-secondary, #888);margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:500;color:var(--text-secondary, #aaa);margin-bottom:.5rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:.75rem 1rem;background:var(--bg-primary, #0f0f0f);border:1px solid var(--border-color, #333);border-radius:8px;color:var(--text-primary, #fff);font-size:.875rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #3b82f6)}.input-disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.hint[_ngcontent-%COMP%]{display:block;font-size:.75rem;color:var(--text-muted, #666);margin-top:.25rem}.btn-primary[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:var(--primary, #3b82f6);border:none;border-radius:8px;color:#fff;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary-hover, #2563eb)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:transparent;border:1px solid var(--border-color, #333);border-radius:6px;color:var(--text-primary, #fff);font-size:.875rem;cursor:pointer;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:var(--border-hover, #444)}.btn-danger-small[_ngcontent-%COMP%]{padding:.375rem .75rem;background:transparent;border:1px solid rgba(239,68,68,.5);border-radius:6px;color:#f87171;font-size:.75rem;cursor:pointer;transition:all .2s ease}.btn-danger-small[_ngcontent-%COMP%]:hover{background:#ef44441a}.btn-danger[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:8px;color:#f87171;font-size:.875rem;cursor:pointer;margin-top:1rem}.btn-danger[_ngcontent-%COMP%]:hover{background:#ef444433}.security-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem;background:var(--bg-primary, #0f0f0f);border-radius:8px;margin-bottom:1rem}.item-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;margin-bottom:.25rem}.item-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #888)}.password-form[_ngcontent-%COMP%]{padding:1rem;background:var(--bg-primary, #0f0f0f);border-radius:8px;margin-bottom:1rem}.sessions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1rem}.session-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-primary, #0f0f0f);border-radius:8px;border:1px solid transparent}.session-item.current[_ngcontent-%COMP%]{border-color:var(--primary, #3b82f6)}.session-icon[_ngcontent-%COMP%]{font-size:1.5rem}.session-info[_ngcontent-%COMP%]{flex:1}.session-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-size:.875rem}.session-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #888)}.current-badge[_ngcontent-%COMP%]{display:inline-block;padding:.125rem .5rem;background:var(--primary, #3b82f6);border-radius:4px;font-size:.625rem;color:#fff;margin-left:.5rem}.api-keys-list[_ngcontent-%COMP%]{margin-bottom:1rem}.api-key-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem;background:var(--bg-primary, #0f0f0f);border-radius:8px;margin-bottom:.75rem}.key-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.key-info[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace;font-size:.875rem;color:var(--text-secondary, #888)}.key-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #666)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--text-secondary, #888)}.loading-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.success-message[_ngcontent-%COMP%]{margin-left:1rem;color:#4ade80;font-size:.875rem}.error-message[_ngcontent-%COMP%]{padding:.5rem;background:#ef44441a;border-radius:4px;color:#f87171;font-size:.875rem;margin-bottom:1rem}.badge[_ngcontent-%COMP%]{padding:.25rem .75rem;background:var(--bg-tertiary, #252525);border-radius:4px;font-size:.75rem;color:var(--text-secondary, #888)}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--text-secondary, #888)}@media(max-width:768px){.settings-container[_ngcontent-%COMP%]{flex-direction:column}.settings-nav[_ngcontent-%COMP%]{width:100%;flex-direction:row;overflow-x:auto;border-right:none;border-bottom:1px solid var(--border-color, #333)}}"],changeDetection:0})}};export{W as UserSettingsViewComponent};
