import{a as se}from"./chunk-WTAJGCAW.js";import{c as V,e as G,f as H,h as J}from"./chunk-PHWS6WVI.js";import"./chunk-GQQBGSXN.js";import"./chunk-V2IXOMTS.js";import{a as re}from"./chunk-3V3KVMT4.js";import{b as ae}from"./chunk-CXXWQ5XE.js";import"./chunk-BBG7G54H.js";import{a as K,b as Y,c as X,d as Z,e as ee,f as te,g as ne,p as oe,t as ie}from"./chunk-36YFMG3E.js";import{$a as f,Aa as r,Ab as Q,Eb as I,Fb as D,Gb as E,M as U,Na as $,Nb as W,R as L,Vb as k,W as S,X as P,Y as z,Z as F,_a as h,a as R,b as N,eb as b,fb as o,ga as p,gb as a,hb as y,lb as O,nb as _,pb as m,qc as B,vb as T,wa as j,xb as l,yb as d,zb as C}from"./chunk-YLSLTE5F.js";var A={COOKIE_NAME:"csrf_token",HEADER_NAME:"X-CSRF-Token",STORAGE_KEY:"tgm_csrf_token"},v={MAX_ATTEMPTS:5,LOCKOUT_DURATION:300,ATTEMPT_WINDOW:900,STORAGE_KEY:"tgm_login_attempts"},q=class i{constructor(){this._csrfToken=p("");this.csrfToken=k(()=>this._csrfToken());this._isLocked=p(!1);this._lockoutRemaining=p(0);this._attemptCount=p(0);this.isLocked=k(()=>this._isLocked());this.lockoutRemaining=k(()=>this._lockoutRemaining());this.attemptCount=k(()=>this._attemptCount());this.attemptsLeft=k(()=>Math.max(0,v.MAX_ATTEMPTS-this._attemptCount()));this.refreshCsrfToken()}refreshCsrfToken(){let t=this.getCookie(A.COOKIE_NAME);t&&this._csrfToken.set(t)}getCsrfToken(){return this._csrfToken()}getCsrfHeaders(){let t=this.getCsrfToken();return t?{[A.HEADER_NAME]:t}:{}}async secureFetch(t,e={}){let n=new Headers(e.headers),s=this.getCsrfToken();s&&n.set(A.HEADER_NAME,s),n.has("Content-Type")||n.set("Content-Type","application/json");let c=await fetch(t,N(R({},e),{headers:n,credentials:"include"}));return this.refreshCsrfToken(),c}canAttemptLogin(){let t=this.getLockoutData(),e=Date.now();if(t.lockedUntil>e){let s=Math.ceil((t.lockedUntil-e)/1e3);return this._isLocked.set(!0),this._lockoutRemaining.set(s),{allowed:!1,message:`\u767B\u5165\u5617\u8A66\u6B21\u6578\u904E\u591A\uFF0C\u8ACB ${this.formatDuration(s)} \u5F8C\u518D\u8A66`,waitSeconds:s}}this._isLocked.set(!1),this._lockoutRemaining.set(0);let n=this.getRecentAttempts(t.attempts);if(this._attemptCount.set(n.length),n.length>=v.MAX_ATTEMPTS){let s=e+v.LOCKOUT_DURATION*1e3;this.setLockout(s,t.attempts);let c=v.LOCKOUT_DURATION;return this._isLocked.set(!0),this._lockoutRemaining.set(c),{allowed:!1,message:`\u767B\u5165\u5617\u8A66\u6B21\u6578\u904E\u591A\uFF0C\u8ACB ${this.formatDuration(c)} \u5F8C\u518D\u8A66`,waitSeconds:c}}return{allowed:!0}}recordLoginAttempt(t,e){let n=this.getLockoutData();n.attempts.push({timestamp:Date.now(),success:t,email:e}),n.attempts=this.getRecentAttempts(n.attempts),t&&(n.lockedUntil=0,n.attempts=[]),this.saveLockoutData(n),this._attemptCount.set(n.attempts.filter(s=>!s.success).length)}clearLoginLimit(){localStorage.removeItem(v.STORAGE_KEY),this._isLocked.set(!1),this._lockoutRemaining.set(0),this._attemptCount.set(0)}getRecentAttempts(t){let e=Date.now()-v.ATTEMPT_WINDOW*1e3;return t.filter(n=>n.timestamp>e&&!n.success)}getLockoutData(){try{let t=localStorage.getItem(v.STORAGE_KEY);if(t)return JSON.parse(t)}catch(t){console.error("Failed to parse lockout data:",t)}return{lockedUntil:0,attempts:[]}}saveLockoutData(t){localStorage.setItem(v.STORAGE_KEY,JSON.stringify(t))}setLockout(t,e){this.saveLockoutData({lockedUntil:t,attempts:e})}sanitizeHtml(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}isUrlSafe(t){return!t||t.toLowerCase().startsWith("javascript:")||t.toLowerCase().startsWith("data:")&&!t.toLowerCase().startsWith("data:image/")?!1:!!(t.startsWith("/")||t.startsWith("http://")||t.startsWith("https://"))}escapeHtml(t){let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,n=>e[n])}getCookie(t){let e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]+)"));return e?decodeURIComponent(e[2]):null}formatDuration(t){return t<60?`${t} \u79D2`:`${Math.ceil(t/60)} \u5206\u9418`}startLockoutCountdown(t){let e=setInterval(()=>{let n=this._lockoutRemaining();if(n<=0){clearInterval(e),this._isLocked.set(!1),t?.(0);return}this._lockoutRemaining.update(s=>s-1),t?.(n-1)},1e3);return()=>clearInterval(e)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=U({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ce=i=>({seconds:i});function me(i,t){if(i&1&&(o(0,"div",1)(1,"div",30)(2,"div",31),z(),o(3,"svg",32),y(4,"circle",33)(5,"path",34),a()(),F(),o(6,"h3",35),l(7),a(),o(8,"p",36),l(9),a(),o(10,"p",37),l(11),a()()()),i&2){let e=m();r(7),d(e.t("auth.loginSuccess")),r(2),Q("",e.t("auth.welcomeBackUser"),"\uFF0C",e.successUserName()),r(2),d(e.t("auth.redirecting"))}}function pe(i,t){if(i&1&&(o(0,"div",4)(1,"span",38),l(2,"\u{1F512}"),a(),o(3,"div",39)(4,"span",40),l(5),a(),o(6,"span",41),l(7),a()()()),i&2){let e=m();r(5),d(e.t("auth.accountLocked")),r(2),d(e.t("auth.waitSeconds",W(2,ce,e.lockoutRemaining())))}}function ue(i,t){if(i&1&&(o(0,"div",5)(1,"span",42),l(2,"\u26A0\uFE0F"),a(),o(3,"span"),l(4),a()()),i&2){let e=m();r(4),d(e.error())}}function he(i,t){if(i&1&&(y(0,"span",43),o(1,"span"),l(2),a()),i&2){let e=m();r(2),d(e.t("auth.loggingIn"))}}function fe(i,t){if(i&1&&(o(0,"span"),l(1),a()),i&2){let e=m();r(),d(e.t("auth.login"))}}function _e(i,t){if(i&1&&(o(0,"div",44),y(1,"span",43),o(2,"span"),l(3),a()()),i&2){let e=m(2);r(3),d(e.t("auth.generatingQR"))}}function Ce(i,t){if(i&1){let e=O();o(0,"div",49)(1,"span",55),l(2),a(),o(3,"button",56),_("click",function(){S(e);let s=m(3);return P(s.refreshQRCode())}),l(4),a()()}if(i&2){let e=m(3);r(2),d(e.t("auth.qrExpired")),r(2),d(e.t("auth.clickToRefresh"))}}function ke(i,t){if(i&1&&(o(0,"div",53)(1,"p",57),l(2,"\u6383\u78BC\u7121\u6548\uFF1F\u5728 Bot \u4E2D\u8F38\u5165\u9A57\u8B49\u78BC\uFF1A"),a(),o(3,"div",58),l(4),a()()),i&2){let e=m(3);r(4),d(e.verifyCode())}}function be(i,t){if(i&1&&(o(0,"div",54)(1,"span",59),l(2),a(),o(3,"span",60),l(4),a()()),i&2){let e=m(3);r(),T("connected",e.wsConnected()),r(),C(" ",e.wsConnected()?"\u{1F7E2} "+e.t("auth.realtimeConnected"):"\u{1F534} "+e.t("auth.reconnecting")," "),r(2),C("",e.qrCountdown(),"s")}}function ve(i,t){if(i&1&&(o(0,"div",45)(1,"div",47),y(2,"img",48),h(3,Ce,5,2,"div",49),a(),o(4,"div",50)(5,"p",51)(6,"span",52),l(7,"1"),a(),l(8),a(),o(9,"p",51)(10,"span",52),l(11,"2"),a(),l(12),a(),o(13,"p",51)(14,"span",52),l(15,"3"),a(),l(16),a()(),h(17,ke,5,1,"div",53),h(18,be,5,4,"div",54),a()),i&2){let e=m(2);r(2),b("src",e.qrCodeUrl(),j)("alt",e.t("auth.telegramLoginQR")),r(),f(e.qrCodeExpired()?3:-1),r(5),C(" ",e.t("auth.openTelegram")),r(4),C(" ",e.t("auth.scanQRCode")),r(4),C(" ",e.t("auth.confirmLogin")),r(),f(e.verifyCode()?17:-1),r(),f(e.qrCodeExpired()?-1:18)}}function xe(i,t){if(i&1){let e=O();o(0,"button",61),_("click",function(){S(e);let s=m(2);return P(s.generateQRCode())}),o(1,"span",62),l(2,"\u{1F4F7}"),a(),o(3,"span"),l(4),a()()}if(i&2){let e=m(2);r(4),d(e.t("auth.generateQRCode"))}}function we(i,t){if(i&1&&(o(0,"div",25),h(1,_e,4,1,"div",44)(2,ve,19,8,"div",45)(3,xe,5,1,"button",46),a()),i&2){let e=m();r(),f(e.qrCodeLoading()?1:e.qrCodeUrl()?2:3)}}function Le(i,t){if(i&1&&(y(0,"span",65),o(1,"span"),l(2),a()),i&2){let e=m(2);r(2),d(e.t("auth.waitingConfirm"))}}function ye(i,t){if(i&1&&(o(0,"span",66),l(1,"\u{1F4F1}"),a(),o(2,"span"),l(3),a()),i&2){let e=m(2);r(3),d(e.t("auth.openTelegramApp"))}}function Me(i,t){if(i&1){let e=O();o(0,"div",64)(1,"div",67),l(2),a(),o(3,"div",68),l(4),a(),o(5,"button",69),_("click",function(){S(e);let s=m(2);return P(s.cancelDeepLink())}),l(6),a()()}if(i&2){let e=m(2);r(2),C(" ",e.t("auth.clickConfirmInTelegram")," "),r(2),C(" ",e.t("auth.remainingTime",W(3,ce,e.deepLinkCountdown()))," "),r(2),d(e.t("auth.cancel"))}}function Se(i,t){if(i&1){let e=O();o(0,"div",26)(1,"button",63),_("click",function(){S(e);let s=m();return P(s.openDeepLink())}),h(2,Le,3,1)(3,ye,4,1),a(),h(4,Me,7,5,"div",64),a()}if(i&2){let e=m();r(),b("disabled",e.telegramLoading()),r(),f(e.deepLinkLoading()?2:3),r(2),f(e.deepLinkLoading()?4:-1)}}function Pe(i,t){if(i&1&&(y(0,"span",65),o(1,"span"),l(2),a()),i&2){let e=m(2);r(2),d(e.t("auth.loadingTelegram"))}}function Oe(i,t){if(i&1&&(o(0,"span",66),l(1,"\u{1F4AC}"),a(),o(2,"span"),l(3),a()),i&2){let e=m(2);r(3),d(e.t("auth.useTelegramWidget"))}}function Te(i,t){if(i&1){let e=O();o(0,"div",27)(1,"button",70),_("click",function(){S(e);let s=m();return P(s.initTelegramWidget())}),h(2,Pe,3,1)(3,Oe,4,1),a(),o(4,"p",71),l(5),a()()}if(i&2){let e=m();r(),b("disabled",e.telegramLoading()),r(),f(e.telegramLoading()&&!e.deepLinkLoading()?2:3),r(3),d(e.t("auth.widgetHint"))}}var le=class i{constructor(){this.authService=L(se);this.router=L(G);this.route=L(V);this.i18n=L(ae);this.security=L(q);this.ipcService=L(re);this.email="";this.password="";this.rememberMe=!1;this.showPassword=p(!1);this.isLoading=p(!1);this.telegramLoading=p(!1);this.telegramWidgetReady=p(!1);this.error=p(null);this.deepLinkLoading=p(!1);this.deepLinkCountdown=p(300);this.deepLinkToken="";this.deepLinkPollInterval=null;this.deepLinkCountdownInterval=null;this.loginMethod=p("qrcode");this.qrCodeLoading=p(!1);this.qrCodeUrl=p(null);this.qrCodeExpired=p(!1);this.qrCountdown=p(300);this.wsConnected=p(!1);this.verifyCode=p(null);this.qrToken="";this.qrWebSocket=null;this.qrCountdownInterval=null;this.loginSuccess=p(!1);this.successUserName=p("");this.isLocked=k(()=>this.security.isLocked());this.lockoutRemaining=k(()=>this.security.lockoutRemaining());this.attemptsLeft=k(()=>this.security.attemptsLeft());this.telegramBotUsername="";this.telegramBotId="";this.lockoutCleanup=null;this.deepLinkWebSocket=null}ngOnInit(){this.checkLoginLimit();let t=this.loadLoginPreference();t?(this.loginMethod.set(t),t==="qrcode"&&this.generateQRCode()):this.isMobileDevice()?this.loginMethod.set("deeplink"):this.generateQRCode()}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}ngOnDestroy(){this.lockoutCleanup?.(),this.cancelDeepLink(),this.cleanupQRCode()}checkLoginLimit(){let t=this.security.canAttemptLogin();t.allowed||(this.error.set(t.message||""),this.lockoutCleanup=this.security.startLockoutCountdown(e=>{e<=0&&this.error.set(null)}))}t(t){return this.i18n.t(t)}async onSubmit(){if(!this.email||!this.password)return;let t=this.security.canAttemptLogin();if(!t.allowed){this.error.set(t.message||"");return}this.isLoading.set(!0),this.error.set(null);try{let e=await this.authService.login({email:this.email,password:this.password,remember:this.rememberMe});if(e.success){this.security.recordLoginAttempt(!0,this.email);let n=this.route.snapshot.queryParams.returnUrl||"/";this.router.navigateByUrl(n)}else{this.security.recordLoginAttempt(!1,this.email);let n=this.security.attemptsLeft(),s=e.error||this.t("auth.loginFailed");n>0&&n<=3&&(s+=` (\u5269\u9918 ${n} \u6B21\u5617\u8A66\u6A5F\u6703)`),this.error.set(s),this.checkLoginLimit()}}catch(e){this.security.recordLoginAttempt(!1,this.email),this.error.set(e.message||this.t("auth.loginFailed")),this.checkLoginLimit()}finally{this.isLoading.set(!1)}}async socialLogin(t){t==="telegram"?await this.initTelegramWidget():t==="google"&&await this.googleLogin()}async googleLogin(){this.isLoading.set(!0),this.error.set(null);try{let e=await(await fetch("/api/v1/oauth/google/config")).json();if(!e.success||!e.data?.enabled){this.error.set(this.t("auth.googleNotAvailable"));return}this.openGoogleLoginPopup()}catch(t){console.error("Google login error:",t),this.error.set(this.t("auth.googleNotAvailable"))}finally{this.isLoading.set(!1)}}openGoogleLoginPopup(){let e=`${window.location.origin}/api/v1/oauth/google/callback`,n=`/api/v1/oauth/google/authorize?callback=${encodeURIComponent(e)}`,s=550,c=600,g=window.screenX+(window.outerWidth-s)/2,u=window.screenY+(window.outerHeight-c)/2,x=window.open(n,"GoogleAuth",`width=${s},height=${c},left=${g},top=${u},toolbar=no,menubar=no,scrollbars=yes`),w=async M=>{M.data&&M.data.type==="google_auth"?(window.removeEventListener("message",w),x?.close(),await this.handleGoogleAuth(M.data.auth)):M.data&&M.data.type==="google_auth_error"&&(window.removeEventListener("message",w),x?.close(),this.error.set(M.data.error||"Google \u767B\u5165\u5931\u6557"),this.isLoading.set(!1))};window.addEventListener("message",w);let de=setInterval(()=>{x?.closed&&(clearInterval(de),window.removeEventListener("message",w),this.isLoading.set(!1))},500)}async handleGoogleAuth(t){this.isLoading.set(!0);try{if(t.access_token&&t.user){localStorage.setItem("tgm_access_token",t.access_token),t.refresh_token&&localStorage.setItem("tgm_refresh_token",t.refresh_token),localStorage.setItem("tgm_user",JSON.stringify(t.user)),this.ipcService.setAuthToken(t.access_token);let e=this.route.snapshot.queryParams.returnUrl||"/";window.location.href=e}else this.error.set("Google \u767B\u5165\u5931\u6557\uFF1A\u7121\u6548\u7684\u8A8D\u8B49\u6578\u64DA")}catch(e){this.error.set(e.message||"Google \u767B\u5165\u5931\u6557")}finally{this.isLoading.set(!1)}}async openDeepLink(){this.error.set(null),this.deepLinkLoading.set(!0),this.telegramLoading.set(!0);try{let e=await(await fetch("/api/v1/auth/login-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"deep_link"})})).json();if(!e.success||!e.data){this.error.set(e.error||"\u7121\u6CD5\u751F\u6210\u767B\u5165\u9023\u7D50"),this.deepLinkLoading.set(!1),this.telegramLoading.set(!1);return}let{token:n,deep_link_url:s,expires_in:c}=e.data;this.deepLinkToken=n,this.deepLinkCountdown.set(c||300),console.log("[DeepLink] Token generated:",n.substring(0,8)+"..."),this.connectDeepLinkWebSocket(n),console.log("[DeepLink] Opening:",s),window.open(s,"_blank"),this.deepLinkCountdownInterval=setInterval(()=>{let g=this.deepLinkCountdown();g<=0?(this.cancelDeepLink(),this.error.set("\u767B\u5165\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66")):this.deepLinkCountdown.set(g-1)},1e3),this.startPollingLoginStatus()}catch(t){console.error("[DeepLink] Error:",t),this.error.set(t.message||"\u767B\u5165\u5931\u6557"),this.deepLinkLoading.set(!1),this.telegramLoading.set(!1)}}connectDeepLinkWebSocket(t){this.deepLinkWebSocket&&this.deepLinkWebSocket.close();let e=window.location.protocol==="https:"?"wss:":"ws:",n=window.location.host,s=`${e}//${n}/ws/login-token/${t}`;console.log("[DeepLink WS] Connecting to:",s);try{this.deepLinkWebSocket=new WebSocket(s),this.deepLinkWebSocket.onopen=()=>{console.log("[DeepLink WS] \u2705 Connected")},this.deepLinkWebSocket.onmessage=c=>{try{let g=JSON.parse(c.data);console.log("[DeepLink WS] Message received:",g),g.type==="login_success"||g.event==="login_confirmed"?(console.log("[DeepLink WS] \u{1F389} Login confirmed via WebSocket!"),this.handleLoginSuccess(g.data)):g.status==="confirmed"&&g.data?.access_token&&(console.log("[DeepLink WS] \u{1F389} Login confirmed (direct)!"),this.handleLoginSuccess(g.data))}catch(g){console.error("[DeepLink WS] Parse error:",g)}},this.deepLinkWebSocket.onclose=()=>{console.log("[DeepLink WS] Disconnected")},this.deepLinkWebSocket.onerror=c=>{console.warn("[DeepLink WS] Error (will fallback to polling):",c)}}catch(c){console.warn("[DeepLink WS] Failed to create WebSocket:",c)}}cancelDeepLink(){this.deepLinkWebSocket&&(this.deepLinkWebSocket.close(),this.deepLinkWebSocket=null),this.deepLinkPollInterval&&(clearInterval(this.deepLinkPollInterval),this.deepLinkPollInterval=null),this.deepLinkCountdownInterval&&(clearInterval(this.deepLinkCountdownInterval),this.deepLinkCountdownInterval=null),this.deepLinkLoading.set(!1),this.telegramLoading.set(!1),this.deepLinkToken=""}startPollingLoginStatus(){this.deepLinkPollInterval&&clearInterval(this.deepLinkPollInterval);let t=async()=>{if(this.deepLinkToken)try{console.log("[DeepLink Poll] Checking status...");let n=await(await fetch(`/api/v1/auth/login-token/${this.deepLinkToken}`)).json();if(console.log("[DeepLink Poll] Response:",n),!n.success){console.warn("[DeepLink Poll] Error:",n.error);return}let{status:s,access_token:c,refresh_token:g,user:u}=n.data||{};console.log("[DeepLink Poll] Status:",s,"Has Token:",!!c),s==="confirmed"&&c?(console.log("[DeepLink Poll] \u{1F389} Login confirmed via polling!"),this.handleLoginSuccess({access_token:c,refresh_token:g,user:u})):s==="expired"&&(this.cancelDeepLink(),this.error.set("\u767B\u5165\u9023\u7D50\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u8A66"))}catch(e){console.error("[DeepLink Poll] Error:",e)}};setTimeout(()=>{this.deepLinkToken&&(t(),this.deepLinkPollInterval=setInterval(t,2e3))},3e3)}switchLoginMethod(t){this.loginMethod()==="qrcode"&&t!=="qrcode"&&this.cleanupQRCode(),this.loginMethod()==="deeplink"&&t!=="deeplink"&&this.cancelDeepLink(),this.loginMethod.set(t),this.error.set(null),t==="qrcode"&&!this.qrCodeUrl()&&this.generateQRCode()}async generateQRCode(){this.qrCodeLoading.set(!0),this.qrCodeExpired.set(!1),this.error.set(null);try{let e=await(await fetch("/api/v1/auth/login-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"qr_code"})})).json();if(!e.success||!e.data){this.error.set(e.error||"\u7121\u6CD5\u751F\u6210\u4E8C\u7DAD\u78BC"),this.qrCodeLoading.set(!1);return}let{token:n,deep_link_url:s,expires_in:c,qr_image:g,qr_fallback_url:u,verify_code:x}=e.data;this.qrToken=n,this.qrCountdown.set(c||300),this.verifyCode.set(x||null);let w=g||u||this.generateQRCodeImage(s);this.qrCodeUrl.set(w),this.connectWebSocket(n),this.startQRCountdown()}catch(t){console.error("[QRCode] Error:",t),this.error.set(t.message||"\u751F\u6210\u4E8C\u7DAD\u78BC\u5931\u6557")}finally{this.qrCodeLoading.set(!1)}}generateQRCodeImage(t){return`https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(t)}&bgcolor=ffffff&color=000000&margin=10`}refreshQRCode(){this.cleanupQRCode(),this.generateQRCode()}cleanupQRCode(){this.qrWebSocket&&(this.qrWebSocket.close(),this.qrWebSocket=null),this.qrCountdownInterval&&(clearInterval(this.qrCountdownInterval),this.qrCountdownInterval=null),this.qrToken="",this.qrCodeUrl.set(null),this.qrCodeExpired.set(!1),this.wsConnected.set(!1)}startQRCountdown(){this.qrCountdownInterval&&clearInterval(this.qrCountdownInterval),this.qrCountdownInterval=setInterval(()=>{let t=this.qrCountdown();t<=0?(this.qrCodeExpired.set(!0),clearInterval(this.qrCountdownInterval),this.qrCountdownInterval=null):this.qrCountdown.set(t-1)},1e3)}connectWebSocket(t){this.qrWebSocket&&this.qrWebSocket.close();let e=window.location.protocol==="https:"?"wss:":"ws:",n=window.location.host,s=`${e}//${n}/ws/login-token/${t}`;console.log("[WebSocket] Connecting to:",s);try{this.qrWebSocket=new WebSocket(s),this.qrWebSocket.onopen=()=>{console.log("[WebSocket] Connected"),this.wsConnected.set(!0)},this.qrWebSocket.onmessage=g=>{try{let u=JSON.parse(g.data);console.log("[WebSocket] Message:",u),u.type==="login_success"||u.event==="login_confirmed"?this.handleLoginSuccess(u.data):u.type==="login_token_update"?u.status==="confirmed"&&this.qrWebSocket?.send(JSON.stringify({type:"check_status"})):u.status==="confirmed"&&u.data?.access_token&&this.handleLoginSuccess(u.data)}catch(u){console.error("[WebSocket] Parse error:",u)}},this.qrWebSocket.onclose=()=>{console.log("[WebSocket] Disconnected"),this.wsConnected.set(!1),!this.qrCodeExpired()&&this.qrToken&&setTimeout(()=>{this.qrToken&&!this.qrCodeExpired()&&(console.log("[WebSocket] Reconnecting..."),this.connectWebSocket(this.qrToken))},3e3)},this.qrWebSocket.onerror=g=>{console.error("[WebSocket] Error:",g),this.wsConnected.set(!1)};let c=setInterval(()=>{this.qrWebSocket?.readyState===WebSocket.OPEN?this.qrWebSocket.send(JSON.stringify({type:"ping"})):clearInterval(c)},15e3)}catch(c){console.error("[WebSocket] Create error:",c),this.wsConnected.set(!1)}}handleLoginSuccess(t){if(console.log("[Login] Success - Full data:",JSON.stringify(t)),console.log("[Login] access_token exists:",!!t?.access_token),!t?.access_token){console.error("[Login] \u274C No access_token in data!"),this.error.set("\u767B\u5165\u5931\u6557\uFF1A\u672A\u6536\u5230\u8A8D\u8B49\u4EE4\u724C");return}this.cleanupQRCode(),this.cancelDeepLink(),this.authService.setSession({access_token:t.access_token,refresh_token:t.refresh_token,user:t.user,session_id:t.session_id}),this.ipcService.setAuthToken(t.access_token),console.log("[Login] \u2705 Session set via AuthService"),console.log("[Login] isAuthenticated:",this.authService.isAuthenticated()),this.successUserName.set(t?.user?.display_name||t?.user?.username||"User"),this.loginSuccess.set(!0),this.saveLoginPreference();let e=this.route.snapshot.queryParams.returnUrl||"/dashboard";console.log("[Login] Will navigate to:",e,"in 1.5 seconds"),setTimeout(()=>{console.log("[Login] Navigating now..."),console.log("[Login] Final check - isAuthenticated:",this.authService.isAuthenticated()),console.log("[Login] Final check - accessToken:",!!this.authService.accessToken()),this.router.navigateByUrl(e).then(()=>{console.log("[Login] \u2705 Navigation complete")}).catch(n=>{console.error("[Login] Navigation error:",n),window.location.href=e})},1500)}saveLoginPreference(){try{localStorage.setItem("tgm_login_method",this.loginMethod())}catch{console.debug("Could not save login preference")}}loadLoginPreference(){try{let t=localStorage.getItem("tgm_login_method");if(t==="qrcode"||t==="deeplink"||t==="widget")return t}catch{console.debug("Could not load login preference")}return null}async initTelegramWidget(){this.telegramLoading.set(!0),this.error.set(null);try{let t=await this.authService.getTelegramConfig();if(!t.enabled||!t.bot_id){this.error.set(this.t("auth.telegramNotConfigured"));return}this.telegramBotUsername=t.bot_username||"",this.telegramBotId=t.bot_id,window.onTelegramAuth=e=>{console.log("Telegram auth callback:",e),this.handleTelegramAuth(e)};try{await this.loadTelegramWidget()}catch(e){console.warn("Widget failed, falling back to OAuth:",e),this.openTelegramOAuth()}}catch(t){console.error("Telegram login error:",t),this.error.set(t.message||"Telegram \u767B\u5165\u5931\u6557")}finally{this.telegramLoading.set(!1)}}loadTelegramWidget(){return new Promise((t,e)=>{let n=window.open("","telegram-widget","width=550,height=470,scrollbars=yes");if(!n){e(new Error("Popup blocked"));return}n.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Telegram \u767B\u5165</title>
          <style>
            body { 
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              display: flex; 
              flex-direction: column;
              justify-content: center; 
              align-items: center; 
              height: 100vh; 
              margin: 0;
              background: linear-gradient(135deg, #0f172a, #1e293b);
              color: white;
            }
            h2 { margin-bottom: 30px; }
            #telegram-login { min-height: 50px; }
            .hint { color: #94a3b8; font-size: 14px; margin-top: 20px; text-align: center; }
          </style>
        </head>
        <body>
          <h2>\u4F7F\u7528 Telegram \u767B\u5165</h2>
          <div id="telegram-login"></div>
          <p class="hint">\u5982\u679C\u60A8\u5DF2\u5728\u700F\u89BD\u5668\u767B\u5165 Telegram\uFF0C\u5C07\u986F\u793A\u4E00\u9375\u767B\u5165\u6309\u9215</p>
          <script>
            window.onTelegramAuth = function(user) {
              window.opener.onTelegramAuth(user);
              window.close();
            };
          <\/script>
          <script async src="https://telegram.org/js/telegram-widget.js?22"
            data-telegram-login="${this.telegramBotUsername}"
            data-size="large"
            data-radius="8"
            data-onauth="onTelegramAuth(user)"
            data-request-access="write">
          <\/script>
        </body>
        </html>
      `),n.document.close();let s=setInterval(()=>{n.closed&&(clearInterval(s),t())},500);setTimeout(()=>{clearInterval(s),t()},3e4)})}openTelegramOAuth(){let t=`${window.location.origin}/auth/telegram-callback`,e=`https://oauth.telegram.org/auth?bot_id=${this.telegramBotId}&origin=${encodeURIComponent(window.location.origin)}&request_access=write&return_to=${encodeURIComponent(t)}`;console.log("Opening Telegram OAuth:",e);let n=550,s=470,c=(window.innerWidth-n)/2,g=(window.innerHeight-s)/2,u=window.open(e,"telegram-oauth",`width=${n},height=${s},left=${c},top=${g},scrollbars=yes`);if(u){let x=setInterval(()=>{try{u.closed&&(clearInterval(x),this.telegramLoading.set(!1))}catch{}},500)}}async handleTelegramAuth(t){this.telegramLoading.set(!0),this.error.set(null),console.log("[TelegramAuth] Processing auth data:",t);try{let e={success:!1},n=0,s=3;for(;n<s;)try{e=await this.authService.telegramLogin(t);break}catch(c){if(n++,console.warn(`[TelegramAuth] Retry ${n}/${s}:`,c.message),n>=s)throw c;await new Promise(g=>setTimeout(g,1e3*n))}if(e.success){console.log("[TelegramAuth] Login successful, redirecting...");let c=this.route.snapshot.queryParams.returnUrl||"/dashboard";window.location.href=c}else console.error("[TelegramAuth] Login failed:",e.error),this.error.set(e.error||this.t("auth.telegramLoginFailed"))}catch(e){console.error("[TelegramAuth] Exception:",e),this.error.set(e.message||this.t("auth.telegramLoginFailed"))}finally{this.telegramLoading.set(!1)}}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=$({type:i,selectors:[["app-login"]],decls:62,vars:35,consts:[[1,"login-page"],[1,"success-overlay"],[1,"page-title"],[1,"page-subtitle"],[1,"lockout-alert"],[1,"error-alert"],[1,"login-form",3,"ngSubmit"],[1,"form-group"],["for","email"],[1,"input-wrapper"],[1,"input-icon"],["type","email","id","email","name","email","required","","autocomplete","email",3,"ngModelChange","ngModel","placeholder","disabled"],["for","password"],["id","password","name","password","required","","autocomplete","current-password",3,"ngModelChange","type","ngModel","placeholder","disabled"],["type","button",1,"toggle-password",3,"click"],[1,"form-options"],[1,"checkbox-label"],["type","checkbox","name","rememberMe",3,"ngModelChange","ngModel"],["routerLink","/auth/forgot-password",1,"forgot-link"],["type","submit",1,"submit-btn",3,"disabled"],[1,"divider"],[1,"telegram-login-section"],[1,"login-method-tabs"],[1,"method-tab",3,"click"],[1,"tab-icon"],[1,"qr-login-panel"],[1,"deeplink-panel"],[1,"widget-panel"],[1,"register-link"],["routerLink","/auth/register"],[1,"success-content"],[1,"success-icon"],["viewBox","0 0 52 52",1,"checkmark"],["cx","26","cy","26","r","25","fill","none",1,"checkmark-circle"],["fill","none","d","M14.1 27.2l7.1 7.2 16.7-16.8",1,"checkmark-check"],[1,"success-title"],[1,"success-user"],[1,"success-hint"],[1,"lockout-icon"],[1,"lockout-content"],[1,"lockout-title"],[1,"lockout-time"],[1,"error-icon"],[1,"loading-spinner"],[1,"qr-loading"],[1,"qr-container"],[1,"generate-qr-btn"],[1,"qr-code-wrapper"],[1,"qr-code-img",3,"src","alt"],[1,"qr-expired-overlay"],[1,"qr-instructions"],[1,"step"],[1,"step-num"],[1,"verify-code-section"],[1,"qr-countdown"],[1,"expired-text"],[1,"refresh-btn",3,"click"],[1,"verify-hint"],[1,"verify-code"],[1,"ws-status"],[1,"countdown-text"],[1,"generate-qr-btn",3,"click"],[1,"btn-icon"],[1,"social-btn","telegram","full-width","primary-telegram",3,"click","disabled"],[1,"deep-link-status"],[1,"loading-spinner","small"],[1,"social-icon"],[1,"status-text"],[1,"countdown"],[1,"cancel-btn",3,"click"],[1,"social-btn","telegram","full-width","secondary-telegram",3,"click","disabled"],[1,"widget-hint"]],template:function(e,n){e&1&&(o(0,"div",0),h(1,me,12,4,"div",1),o(2,"h2",2),l(3),a(),o(4,"p",3),l(5),a(),h(6,pe,8,4,"div",4),h(7,ue,5,1,"div",5),o(8,"form",6),_("ngSubmit",function(){return n.onSubmit()}),o(9,"div",7)(10,"label",8),l(11),a(),o(12,"div",9)(13,"span",10),l(14,"\u{1F4E7}"),a(),o(15,"input",11),E("ngModelChange",function(c){return D(n.email,c)||(n.email=c),c}),a()()(),o(16,"div",7)(17,"label",12),l(18),a(),o(19,"div",9)(20,"span",10),l(21,"\u{1F512}"),a(),o(22,"input",13),E("ngModelChange",function(c){return D(n.password,c)||(n.password=c),c}),a(),o(23,"button",14),_("click",function(){return n.showPassword.set(!n.showPassword())}),l(24),a()()(),o(25,"div",15)(26,"label",16)(27,"input",17),E("ngModelChange",function(c){return D(n.rememberMe,c)||(n.rememberMe=c),c}),a(),o(28,"span"),l(29),a()(),o(30,"a",18),l(31),a()(),o(32,"button",19),h(33,he,3,1)(34,fe,2,1,"span"),a()(),o(35,"div",20)(36,"span"),l(37),a()(),o(38,"div",21)(39,"div",22)(40,"button",23),_("click",function(){return n.switchLoginMethod("qrcode")}),o(41,"span",24),l(42,"\u{1F4F7}"),a(),o(43,"span"),l(44),a()(),o(45,"button",23),_("click",function(){return n.switchLoginMethod("deeplink")}),o(46,"span",24),l(47,"\u{1F4F1}"),a(),o(48,"span"),l(49),a()(),o(50,"button",23),_("click",function(){return n.switchLoginMethod("widget")}),o(51,"span",24),l(52,"\u{1F4AC}"),a(),o(53,"span"),l(54),a()()(),h(55,we,4,1,"div",25),h(56,Se,5,3,"div",26),h(57,Te,6,3,"div",27),a(),o(58,"p",28),l(59),o(60,"a",29),l(61),a()()()),e&2&&(r(),f(n.loginSuccess()?1:-1),r(2),d(n.t("auth.welcomeBack")),r(2),d(n.t("auth.loginSubtitle")),r(),f(n.isLocked()?6:-1),r(),f(n.error()&&!n.isLocked()?7:-1),r(4),d(n.t("auth.email")),r(4),I("ngModel",n.email),b("placeholder",n.t("auth.emailPlaceholder"))("disabled",n.isLoading()),r(3),d(n.t("auth.password")),r(4),b("type",n.showPassword()?"text":"password"),I("ngModel",n.password),b("placeholder",n.t("auth.passwordPlaceholder"))("disabled",n.isLoading()),r(2),C(" ",n.showPassword()?"\u{1F648}":"\u{1F441}\uFE0F"," "),r(3),I("ngModel",n.rememberMe),r(2),d(n.t("auth.rememberMe")),r(2),C(" ",n.t("auth.forgotPassword")," "),r(),b("disabled",n.isLoading()||!n.email||!n.password||n.isLocked()),r(),f(n.isLoading()?33:34),r(4),d(n.t("auth.or")),r(3),T("active",n.loginMethod()==="qrcode"),r(4),d(n.t("auth.qrCodeLogin")),r(),T("active",n.loginMethod()==="deeplink"),r(4),d(n.t("auth.appLogin")),r(),T("active",n.loginMethod()==="widget"),r(4),d(n.t("auth.webLogin")),r(),f(n.loginMethod()==="qrcode"?55:-1),r(),f(n.loginMethod()==="deeplink"?56:-1),r(),f(n.loginMethod()==="widget"?57:-1),r(2),C(" ",n.t("auth.noAccount")," "),r(2),d(n.t("auth.registerNow")))},dependencies:[B,ie,ne,Y,K,X,Z,oe,te,ee,J,H],styles:['.login-page[_ngcontent-%COMP%]{color:var(--text-primary, #fff)}.page-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin-bottom:.5rem}.page-subtitle[_ngcontent-%COMP%]{color:var(--text-secondary, #888);margin-bottom:2rem}.error-alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.875rem 1rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:8px;color:#f87171;margin-bottom:1.5rem;font-size:.875rem}.lockout-alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem 1.25rem;background:#fb923c1a;border:1px solid rgba(251,146,60,.3);border-radius:8px;color:#fb923c;margin-bottom:1.5rem}.lockout-icon[_ngcontent-%COMP%]{font-size:1.5rem}.lockout-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.lockout-title[_ngcontent-%COMP%]{font-weight:600;font-size:.9rem}.lockout-time[_ngcontent-%COMP%]{font-size:.8rem;opacity:.8}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary, #aaa)}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;font-size:1rem;opacity:.5}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem .875rem 2.75rem;background:var(--bg-secondary, #1a1a1a);border:1px solid var(--border-color, #333);border-radius:8px;color:var(--text-primary, #fff);font-size:1rem;transition:all .2s ease}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #3b82f6);box-shadow:0 0 0 3px #3b82f61a}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted, #666)}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:1rem;background:none;border:none;cursor:pointer;font-size:1rem;opacity:.5;transition:opacity .2s}.toggle-password[_ngcontent-%COMP%]:hover{opacity:1}.form-options[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:.875rem}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;color:var(--text-secondary, #aaa)}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:16px;height:16px;accent-color:var(--primary, #3b82f6)}.forgot-link[_ngcontent-%COMP%]{color:var(--primary, #3b82f6);text-decoration:none;transition:color .2s}.forgot-link[_ngcontent-%COMP%]:hover{color:var(--primary-hover, #60a5fa);text-decoration:underline}.submit-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.875rem 1.5rem;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border:none;border-radius:8px;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease;margin-top:.5rem}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.loading-spinner[_ngcontent-%COMP%]{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:1.5rem 0;color:var(--text-muted, #666);font-size:.875rem}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:var(--border-color, #333)}.divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 1rem}.social-login[_ngcontent-%COMP%]{display:flex;gap:1rem}.social-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1rem;background:var(--bg-secondary, #1a1a1a);border:1px solid var(--border-color, #333);border-radius:8px;color:var(--text-primary, #fff);font-size:.875rem;cursor:pointer;transition:all .2s ease}.social-btn[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary, #252525);border-color:var(--border-hover, #444)}.social-btn.google[_ngcontent-%COMP%]   .social-icon[_ngcontent-%COMP%]{color:#ea4335;font-weight:700}.social-btn.telegram[_ngcontent-%COMP%]   .social-icon[_ngcontent-%COMP%]{color:#08c}.social-btn.full-width[_ngcontent-%COMP%]{width:100%;flex:none}.social-btn.telegram[_ngcontent-%COMP%]{background:linear-gradient(135deg,#08c,#0077b5);border-color:#08c}.social-btn.telegram[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#09d,#08c)}.social-btn.primary-telegram[_ngcontent-%COMP%]{background:linear-gradient(135deg,#08c,#06a);border-color:#08c;font-weight:600}.social-btn.primary-telegram[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#09d,#07b);transform:translateY(-1px);box-shadow:0 4px 12px #0088cc4d}.social-btn.secondary-telegram[_ngcontent-%COMP%]{background:transparent;border:1px solid #0088cc;color:#08c}.social-btn.secondary-telegram[_ngcontent-%COMP%]:hover{background:#0088cc1a}.deep-link-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.75rem;padding:1rem;background:#0088cc1a;border:1px solid rgba(0,136,204,.3);border-radius:8px;margin:.75rem 0}.deep-link-status[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{color:#08c;font-size:.875rem;text-align:center}.deep-link-status[_ngcontent-%COMP%]   .countdown[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #888)}.deep-link-status[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{padding:.375rem 1rem;background:transparent;border:1px solid #888;border-radius:4px;color:#888;font-size:.75rem;cursor:pointer;transition:all .2s ease}.deep-link-status[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#fff;color:#fff}.social-login[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.telegram-widget-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:48px;width:100%}.telegram-widget-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{border-radius:8px!important}#telegram-login-widget[_ngcontent-%COMP%]{display:flex;justify-content:center}.loading-spinner.small[_ngcontent-%COMP%]{width:14px;height:14px;border-width:2px}.register-link[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;color:var(--text-secondary, #888);font-size:.875rem}.register-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #3b82f6);text-decoration:none;font-weight:500}.register-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.telegram-login-section[_ngcontent-%COMP%]{margin-top:.5rem}.login-method-tabs[_ngcontent-%COMP%]{display:flex;gap:.25rem;background:var(--bg-secondary, #1a1a1a);padding:.25rem;border-radius:8px;margin-bottom:1rem}.method-tab[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;gap:.25rem;padding:.5rem;background:transparent;border:none;border-radius:6px;color:var(--text-secondary, #888);font-size:.75rem;cursor:pointer;transition:all .2s ease}.method-tab[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary, #252525);color:var(--text-primary, #fff)}.method-tab.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#08c,#06a);color:#fff}.tab-icon[_ngcontent-%COMP%]{font-size:1.25rem}.qr-login-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:1.5rem;background:var(--bg-secondary, #1a1a1a);border-radius:12px;border:1px solid var(--border-color, #333)}.qr-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;padding:2rem;color:var(--text-secondary, #888)}.qr-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;width:100%}.qr-code-wrapper[_ngcontent-%COMP%]{position:relative;padding:1rem;background:#fff;border-radius:12px;box-shadow:0 4px 20px #08c3}.qr-code-img[_ngcontent-%COMP%]{width:180px;height:180px;display:block}.qr-expired-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000d9;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.75rem}.expired-text[_ngcontent-%COMP%]{color:#f87171;font-size:.875rem}.refresh-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#08c,#06a);border:none;border-radius:6px;color:#fff;font-size:.875rem;cursor:pointer;transition:transform .2s ease}.refresh-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.qr-instructions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;width:100%}.qr-instructions[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;color:var(--text-secondary, #888);font-size:.875rem;margin:0}.step-num[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem;background:linear-gradient(135deg,#08c,#06a)}.verify-code-section[_ngcontent-%COMP%]{margin-top:1.25rem;padding-top:1.25rem;border-top:1px dashed var(--border-color, #333);text-align:center}.verify-hint[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-muted, #666);margin-bottom:.75rem}.verify-code[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:2rem;font-weight:700;letter-spacing:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#0ea5e926,#8b5cf626);border:2px solid rgba(14,165,233,.3);color:#0ea5e9;display:inline-block;border-radius:50%;color:#fff;font-size:.75rem;font-weight:600}.qr-countdown[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:.5rem 0;border-top:1px solid var(--border-color, #333);margin-top:.5rem}.ws-status[_ngcontent-%COMP%]{font-size:.75rem;color:#f87171}.ws-status.connected[_ngcontent-%COMP%]{color:#4ade80}.countdown-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #888)}.generate-qr-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem 2rem;background:linear-gradient(135deg,#08c,#06a);border:none;border-radius:8px;color:#fff;font-size:1rem;cursor:pointer;transition:all .2s ease}.generate-qr-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0088cc4d}.btn-icon[_ngcontent-%COMP%]{font-size:1.25rem}.deeplink-panel[_ngcontent-%COMP%], .widget-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.widget-hint[_ngcontent-%COMP%]{text-align:center;font-size:.75rem;color:var(--text-secondary, #888);margin:0}.success-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000e6;display:flex;align-items:center;justify-content:center;z-index:9999;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.success-content[_ngcontent-%COMP%]{text-align:center;animation:_ngcontent-%COMP%_scaleIn .4s ease-out}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}.success-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 1.5rem}.checkmark[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;display:block;stroke-width:2;stroke:#4ade80;stroke-miterlimit:10;animation:_ngcontent-%COMP%_fill .4s ease-in-out .4s forwards,_ngcontent-%COMP%_scale .3s ease-in-out .9s both}.checkmark-circle[_ngcontent-%COMP%]{stroke-dasharray:166;stroke-dashoffset:166;stroke-width:2;stroke-miterlimit:10;stroke:#4ade80;fill:none;animation:_ngcontent-%COMP%_stroke .6s cubic-bezier(.65,0,.45,1) forwards}.checkmark-check[_ngcontent-%COMP%]{transform-origin:50% 50%;stroke-dasharray:48;stroke-dashoffset:48;animation:_ngcontent-%COMP%_stroke .3s cubic-bezier(.65,0,.45,1) .8s forwards}@keyframes _ngcontent-%COMP%_stroke{to{stroke-dashoffset:0}}@keyframes _ngcontent-%COMP%_scale{0%,to{transform:none}50%{transform:scale3d(1.1,1.1,1)}}@keyframes _ngcontent-%COMP%_fill{to{box-shadow:inset 0 0 0 40px #4ade801a}}.success-title[_ngcontent-%COMP%]{color:#4ade80;font-size:1.5rem;font-weight:600;margin:0 0 .5rem}.success-user[_ngcontent-%COMP%]{color:#fff;font-size:1rem;margin:0 0 .5rem}.success-hint[_ngcontent-%COMP%]{color:var(--text-secondary, #888);font-size:.875rem;margin:0;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}'],changeDetection:0})}};export{le as LoginComponent};
