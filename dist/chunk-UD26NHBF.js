import{a as z,b as ne}from"./chunk-EWAJLSAV.js";import{h as Ke}from"./chunk-FGECJ42T.js";import{a as $e}from"./chunk-O6TR47GC.js";import{b as He}from"./chunk-QCWWCRCA.js";import{a as O}from"./chunk-MKTJUSEE.js";import{a as de,b as ee,c as te,f as ie,h as Le,i as Ge,k as ue,l as ce,m as me,n as je,o as Ne,t as W}from"./chunk-3FNGYHNZ.js";import{b as Oe}from"./chunk-ET36GW2V.js";import{l as Ue,m as fe,o as K}from"./chunk-HDSZBSQ2.js";import{a as H,b as We}from"./chunk-CCGO3GAA.js";import{$a as re,Ab as j,Eb as M,Fb as I,Gb as V,J as Re,La as G,Mb as _e,Nb as $,O as D,Ob as X,Pb as ke,T as c,U as m,V as Y,Vb as N,W as ge,Wa as Be,Xb as J,Ya as x,Yb as Fe,Za as _,_a as Pe,a as R,ab as T,b as P,bb as A,cb as k,da as w,db as n,eb as i,fa as Z,fb as F,gb as g,hb as f,ib as xe,jb as y,kb as ae,nb as p,ob as L,pb as d,ta as Ae,ub as se,vb as S,xa as s,xb as o,yb as C,zb as v}from"./chunk-XBIFDY2N.js";var q=class a{constructor(){this.state=w({isOpen:!1,type:"info",title:"",message:"",confirmText:"\u78BA\u5B9A",cancelText:"\u53D6\u6D88",affectedItems:[],requireConfirmText:!1,confirmTextRequired:""})}confirm(t){return new Promise(e=>{this.state.set({isOpen:!0,type:t.type||"info",title:t.title,message:t.message,confirmText:t.confirmText||"\u78BA\u5B9A",cancelText:t.cancelText||"\u53D6\u6D88",affectedItems:t.affectedItems||[],requireConfirmText:t.requireConfirmText||!1,confirmTextRequired:t.confirmTextRequired||"DELETE",resolve:e})})}danger(t,e,r){return this.confirm({type:"danger",title:t,message:e,confirmText:"\u522A\u9664",affectedItems:r})}warning(t,e){return this.confirm({type:"warning",title:t,message:e,confirmText:"\u78BA\u5B9A"})}info(t,e){return this.confirm({type:"info",title:t,message:e})}onConfirm(){let t=this.state();t.resolve&&t.resolve(!0),this.close()}onCancel(){let t=this.state();t.resolve&&t.resolve(!1),this.close()}close(){this.state.update(t=>P(R({},t),{isOpen:!1}))}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275prov=Re({token:a,factory:a.\u0275fac,providedIn:"root"})}};var Me=(a,t)=>t.value;function Xe(a,t){a&1&&(g(0,"div",27)(1,"span",29),o(2,"\u23F3"),f(),g(3,"span",30),o(4,"\u52A0\u8F09\u7D71\u8A08\u6578\u64DA..."),f()())}function Ye(a,t){if(a&1&&(g(0,"div",37),o(1),$(2,"date"),$(3,"date"),f()),a&2){let e=d(4);s(),j(" \u{1F4C5} \u6D88\u606F\u7BC4\u570D\uFF1A",ke(2,2,e.stats().dateRange.first,"yyyy-MM-dd")," ~ ",ke(3,5,e.stats().dateRange.last,"yyyy-MM-dd")," ")}}function Ze(a,t){if(a&1&&(g(0,"div",31)(1,"div",32)(2,"div",33),o(3),$(4,"number"),f(),g(5,"div",34),o(6,"\u76E3\u63A7\u6D88\u606F"),f()(),g(7,"div",32)(8,"div",35),o(9),$(10,"number"),f(),g(11,"div",34),o(12,"\u552F\u4E00\u767C\u8A00\u8005"),f()(),g(13,"div",32)(14,"div",36),o(15),$(16,"number"),f(),g(17,"div",34),o(18,"\u5DF2\u6536\u96C6"),f()()(),x(19,Ye,4,8,"div",37)),a&2){let e=d(3);s(3),C(X(4,4,e.stats().totalMessages)),s(6),C(X(10,6,e.stats().uniqueSenders)),s(6),C(X(16,8,e.stats().collectedUsers)),s(4),_(e.stats().dateRange.first?19:-1)}}function et(a,t){a&1&&(g(0,"div",28)(1,"p",38),o(2,"\u26A0\uFE0F \u66AB\u7121\u76E3\u63A7\u6578\u64DA"),f(),g(3,"p",39),o(4,"\u8ACB\u5148\u958B\u555F\u7FA4\u7D44\u76E3\u63A7\u4E00\u6BB5\u6642\u9593"),f()())}function tt(a,t){if(a&1&&(g(0,"div",13)(1,"div",22)(2,"div",23),o(3),f(),g(4,"div",24)(5,"h3",25),o(6),f(),g(7,"p",26),o(8),f()()(),x(9,Xe,5,0,"div",27)(10,Ze,20,10)(11,et,5,0,"div",28),f()),a&2){let e=d(2);s(3),v(" ",e.group().name[0]," "),s(3),C(e.group().name),s(2),C(e.group().url||"\u79C1\u5BC6\u7FA4\u7D44"),s(),_(e.isLoadingStats()?9:e.stats()?10:11)}}function it(a,t){if(a&1){let e=y();g(0,"button",54),L("click",function(){let l=c(e).$implicit,u=d(3);return m(u.setLimit(l.value))}),o(1),f()}if(a&2){let e=t.$implicit,r=d(3);S("border-orange-500",r.config().limit===e.value)("bg-orange-500/20",r.config().limit===e.value)("text-orange-400",r.config().limit===e.value)("border-slate-700",r.config().limit!==e.value)("bg-slate-800/50",r.config().limit!==e.value)("text-slate-400",r.config().limit!==e.value),s(),v(" ",e.label," ")}}function nt(a,t){if(a&1){let e=y();g(0,"button",54),L("click",function(){let l=c(e).$implicit,u=d(3);return m(u.setTimeRange(l.value))}),o(1),f()}if(a&2){let e=t.$implicit,r=d(3);S("border-cyan-500",r.config().timeRange===e.value)("bg-cyan-500/20",r.config().timeRange===e.value)("text-cyan-400",r.config().timeRange===e.value)("border-slate-700",r.config().timeRange!==e.value)("bg-slate-800/50",r.config().timeRange!==e.value)("text-slate-400",r.config().timeRange!==e.value),s(),v(" ",e.label," ")}}function ot(a,t){if(a&1){let e=y();g(0,"button",54),L("click",function(){let l=c(e).$implicit,u=d(3);return m(u.setMinMessages(l.value))}),o(1),f()}if(a&2){let e=t.$implicit,r=d(3);S("border-purple-500",r.config().minMessages===e.value)("bg-purple-500/20",r.config().minMessages===e.value)("text-purple-400",r.config().minMessages===e.value)("border-slate-700",r.config().minMessages!==e.value)("bg-slate-800/50",r.config().minMessages!==e.value)("text-slate-400",r.config().minMessages!==e.value),s(),v(" ",e.label," ")}}function rt(a,t){if(a&1){let e=y();g(0,"div",53)(1,"div",55)(2,"label",56)(3,"input",57),L("change",function(){c(e);let l=d(3);return m(l.toggleOption("skipDuplicates"))}),f(),g(4,"div")(5,"p",58),o(6,"\u53BB\u91CD"),f(),g(7,"p",34),o(8,"\u8DF3\u904E\u5DF2\u6536\u96C6\u7528\u6236"),f()()(),g(9,"label",56)(10,"input",57),L("change",function(){c(e);let l=d(3);return m(l.toggleOption("excludeBots"))}),f(),g(11,"div")(12,"p",58),o(13,"\u6392\u9664\u6A5F\u5668\u4EBA"),f(),g(14,"p",34),o(15,"\u904E\u6FFE Bot \u5E33\u865F"),f()()(),g(16,"label",56)(17,"input",57),L("change",function(){c(e);let l=d(3);return m(l.toggleOption("requireUsername"))}),f(),g(18,"div")(19,"p",58),o(20,"\u9700\u6709\u7528\u6236\u540D"),f(),g(21,"p",34),o(22,"\u50C5\u6536\u96C6\u6709 @username"),f()()(),g(23,"label",56)(24,"input",57),L("change",function(){c(e);let l=d(3);return m(l.toggleOption("autoSync"))}),f(),g(25,"div")(26,"p",58),o(27,"\u81EA\u52D5\u540C\u6B65"),f(),g(28,"p",34),o(29,"\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3"),f()()()()()}if(a&2){let e=d(3);s(3),ae("checked",e.config().options.skipDuplicates),s(7),ae("checked",e.config().options.excludeBots),s(7),ae("checked",e.config().options.requireUsername),s(7),ae("checked",e.config().options.autoSync)}}function lt(a,t){if(a&1){let e=y();g(0,"div")(1,"label",40),o(2," \u26A1 \u5FEB\u901F\u6A21\u677F "),f(),g(3,"div",31)(4,"button",41),L("click",function(){c(e);let l=d(2);return m(l.selectTemplate("quick"))}),g(5,"div",42),o(6,"\u26A1"),f(),g(7,"p",43),o(8,"\u5FEB\u901F\u6536\u96C6"),f(),g(9,"p",39),o(10,"100\u4EBA \xB7 7\u5929\u5167"),f()(),g(11,"button",41),L("click",function(){c(e);let l=d(2);return m(l.selectTemplate("precise"))}),g(12,"div",42),o(13,"\u{1F3AF}"),f(),g(14,"p",43),o(15,"\u7CBE\u6E96\u6536\u96C6"),f(),g(16,"p",39),o(17,"\u767C\u8A00\u22653\u6B21"),f()(),g(18,"button",41),L("click",function(){c(e);let l=d(2);return m(l.selectTemplate("deep"))}),g(19,"div",42),o(20,"\u{1F50D}"),f(),g(21,"p",43),o(22,"\u6DF1\u5EA6\u6536\u96C6"),f(),g(23,"p",39),o(24,"\u5168\u90E8\u6B77\u53F2"),f()()()(),g(25,"div")(26,"label",40),o(27," \u{1F522} \u6536\u96C6\u6578\u91CF "),f(),g(28,"div",44),T(29,it,2,13,"button",45,Me),f()(),g(31,"div")(32,"label",40),o(33," \u{1F4C5} \u6642\u9593\u7BC4\u570D "),f(),g(34,"div",44),T(35,nt,2,13,"button",46,Me),f()(),g(37,"div")(38,"label",40),o(39," \u{1F525} \u6D3B\u8E8D\u5EA6\u7BE9\u9078\uFF08\u6700\u5C11\u767C\u8A00\u6B21\u6578\uFF09 "),f(),g(40,"div",44),T(41,ot,2,13,"button",47,Me),f()(),g(43,"div",48)(44,"button",49),L("click",function(){c(e);let l=d(2);return m(l.showAdvanced.set(!l.showAdvanced()))}),g(45,"span",50),o(46,"\u2699\uFE0F \u9032\u968E\u9078\u9805"),f(),Y(),g(47,"svg",51),xe(48,"path",52),f()(),x(49,rt,30,4,"div",53),f()}if(a&2){let e=d(2);s(4),S("border-orange-500",e.selectedTemplate()==="quick")("bg-orange-500/20",e.selectedTemplate()==="quick")("border-slate-700",e.selectedTemplate()!=="quick")("bg-slate-800/50",e.selectedTemplate()!=="quick"),s(7),S("border-emerald-500",e.selectedTemplate()==="precise")("bg-emerald-500/20",e.selectedTemplate()==="precise")("border-slate-700",e.selectedTemplate()!=="precise")("bg-slate-800/50",e.selectedTemplate()!=="precise"),s(7),S("border-blue-500",e.selectedTemplate()==="deep")("bg-blue-500/20",e.selectedTemplate()==="deep")("border-slate-700",e.selectedTemplate()!=="deep")("bg-slate-800/50",e.selectedTemplate()!=="deep"),s(11),A(e.limitOptions),s(6),A(e.timeRangeOptions),s(6),A(e.activityOptions),s(6),S("rotate-180",e.showAdvanced()),s(2),_(e.showAdvanced()?49:-1)}}function at(a,t){if(a&1&&(g(0,"div",14)(1,"div",59)(2,"span",60)(3,"span",61),o(4,"\u23F3"),f(),o(5," \u6B63\u5728\u6536\u96C6\u7528\u6236... "),f(),g(6,"span",62),o(7),f()(),g(8,"div",63),xe(9,"div",64),f(),g(10,"div",65),o(11),f()()),a&2){let e=d(2);s(7),j(" ",e.collectionProgress().current," / ",e.collectionProgress().total," "),s(2),se("width",e.getProgressPercent(),"%"),s(2),C(e.collectionProgress().status)}}function st(a,t){if(a&1&&(g(0,"div",15)(1,"div",59)(2,"span",66)(3,"span"),o(4,"\u2705"),f(),o(5," \u6536\u96C6\u5B8C\u6210\uFF01 "),f(),g(6,"span",67),o(7),f()(),g(8,"div",68)(9,"div",69)(10,"div",70),o(11),f(),g(12,"div",34),o(13,"\u65B0\u589E"),f()(),g(14,"div",69)(15,"div",71),o(16),f(),g(17,"div",34),o(18,"\u66F4\u65B0"),f()(),g(19,"div",69)(20,"div",72),o(21),f(),g(22,"div",34),o(23,"\u8DF3\u904E"),f()(),g(24,"div",69)(25,"div",73),o(26),f(),g(27,"div",34),o(28,"\u9AD8\u6D3B\u8E8D"),f()()(),g(29,"div",62)(30,"div",74)(31,"span",75),o(32,"\u{1F525}"),f(),g(33,"span"),o(34),f()(),g(35,"div",74)(36,"span",76),o(37,"\u2713"),f(),g(38,"span"),o(39),f()(),g(40,"div",77)(41,"span",78),o(42,"\u25CB"),f(),g(43,"span"),o(44),f()()()()),a&2){let e=d(2);s(7),v(" ",e.collectionResult().collected," \u4EBA "),s(4),C(e.collectionResult().newUsers),s(5),C(e.collectionResult().updated),s(5),C(e.collectionResult().skipped),s(5),C(e.collectionResult().quality.highActivity),s(8),v("\u9AD8\u6D3B\u8E8D (\u226510\u6B21)\uFF1A",e.collectionResult().quality.highActivity," \u4EBA"),s(5),v("\u4E2D\u6D3B\u8E8D (3-9\u6B21)\uFF1A",e.collectionResult().quality.mediumActivity," \u4EBA"),s(5),v("\u4F4E\u6D3B\u8E8D (<3\u6B21)\uFF1A",e.collectionResult().quality.lowActivity," \u4EBA")}}function dt(a,t){if(a&1&&(g(0,"div",17)(1,"span",30),o(2," \u{1F4A1} \u9810\u8A08\u6536\u96C6\uFF1A "),g(3,"span",79),o(4),f(),o(5," \u4EBA "),f()()),a&2){let e=d(2);s(4),C(e.estimatedCount())}}function ut(a,t){a&1&&(g(0,"span",61),o(1,"\u23F3"),f(),g(2,"span"),o(3,"\u6536\u96C6\u4E2D..."),f())}function ct(a,t){a&1&&(g(0,"span"),o(1,"\u{1F504}"),f(),g(2,"span"),o(3,"\u958B\u59CB\u6536\u96C6"),f())}function mt(a,t){if(a&1){let e=y();g(0,"button",80),L("click",function(){c(e);let l=d(2);return m(l.startCollection())}),x(1,ut,4,0)(2,ct,4,0),f()}if(a&2){let e=d(2);ae("disabled",!e.canStart()),s(),_(e.isCollecting()?1:2)}}function pt(a,t){if(a&1){let e=y();g(0,"button",81),L("click",function(){c(e);let l=d(2);return m(l.viewCollectedUsers())}),g(1,"span"),o(2,"\u{1F465}"),f(),g(3,"span"),o(4,"\u67E5\u770B\u5DF2\u6536\u96C6\u7528\u6236"),f()()}}function gt(a,t){if(a&1){let e=y();g(0,"div",1),L("click",function(l){c(e);let u=d();return m(u.onBackdropClick(l))}),g(1,"div",2),L("click",function(l){return c(e),m(l.stopPropagation())}),g(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),o(6," \u{1F504} "),f(),g(7,"div")(8,"h2",7),o(9,"\u5F9E\u6B77\u53F2\u6D88\u606F\u6536\u96C6\u7528\u6236"),f(),g(10,"p",8),o(11,"\u6536\u96C6\u76E3\u63A7\u671F\u9593\u7684\u767C\u8A00\u7528\u6236"),f()()(),g(12,"button",9),L("click",function(){c(e);let l=d();return m(l.close())}),Y(),g(13,"svg",10),xe(14,"path",11),f()()()(),ge(),g(15,"div",12),x(16,tt,12,4,"div",13),x(17,lt,50,27),x(18,at,12,5,"div",14),x(19,st,45,8,"div",15),f(),g(20,"div",16),x(21,dt,6,1,"div",17),g(22,"div",18)(23,"button",19),L("click",function(){c(e);let l=d();return m(l.close())}),o(24),f(),x(25,mt,3,2,"button",20)(26,pt,5,0,"button",21),f()()()()}if(a&2){let e=d();s(16),_(e.group()?16:-1),s(),_(e.stats()&&e.stats().totalMessages>0?17:-1),s(),_(e.isCollecting()?18:-1),s(),_(e.collectionResult()?19:-1),s(2),_(e.stats()&&e.stats().totalMessages>0&&!e.isCollecting()&&!e.collectionResult()?21:-1),s(3),v(" ",e.collectionResult()?"\u95DC\u9589":"\u53D6\u6D88"," "),s(),_(e.collectionResult()?26:25)}}var Ce=class a{constructor(){this.ipcService=D(O);this.toastService=D(H);this.isOpen=Fe(!1);this.group=Fe(null);this.closeDialog=J();this.collectionComplete=J();this.viewUsersEvent=J();this.isLoadingStats=w(!1);this.openEffect=Z(()=>{this.isOpen()&&this.group()&&this.loadStats()});this.stats=w(null);this.selectedTemplate=w("precise");this.showAdvanced=w(!1);this.isCollecting=w(!1);this.collectionProgress=w({current:0,total:0,status:""});this.collectionResult=w(null);this.config=w({limit:200,timeRange:"30d",minMessages:1,options:{skipDuplicates:!0,excludeBots:!0,requireUsername:!1,excludeAdmins:!1,autoSync:!0}});this.limitOptions=[{value:50,label:"50 \u4EBA"},{value:100,label:"100 \u4EBA"},{value:200,label:"200 \u4EBA"},{value:500,label:"500 \u4EBA"},{value:-1,label:"\u5168\u90E8"}];this.timeRangeOptions=[{value:"7d",label:"\u6700\u8FD1 7 \u5929"},{value:"30d",label:"\u6700\u8FD1 30 \u5929"},{value:"90d",label:"\u6700\u8FD1 90 \u5929"},{value:"all",label:"\u5168\u90E8\u6B77\u53F2"}];this.activityOptions=[{value:1,label:"\u5168\u90E8"},{value:3,label:"\u2265 3 \u6B21"},{value:5,label:"\u2265 5 \u6B21"},{value:10,label:"\u2265 10 \u6B21"}];this.listeners=[];this.estimatedCount=N(()=>{let t=this.stats(),e=this.config();if(!t)return 0;let r=t.uniqueSenders;return e.minMessages>=10?r=Math.round(r*.15):e.minMessages>=5?r=Math.round(r*.3):e.minMessages>=3&&(r=Math.round(r*.5)),e.timeRange==="7d"?r=Math.round(r*.3):e.timeRange==="30d"?r=Math.round(r*.6):e.timeRange==="90d"&&(r=Math.round(r*.85)),e.limit>0&&(r=Math.min(r,e.limit)),Math.max(1,r)});this.canStart=N(()=>{let t=this.stats();return t&&t.totalMessages>0&&!this.isCollecting()})}ngOnInit(){this.setupListeners()}ngOnDestroy(){this.listeners.forEach(t=>t())}setupListeners(){let t=this.ipcService.on("history-collection-stats",l=>{this.isLoadingStats.set(!1),l.success&&l.stats?this.stats.set(l.stats):this.stats.set(null)});this.listeners.push(t);let e=this.ipcService.on("history-collection-progress",l=>{this.collectionProgress.set({current:l.current,total:l.total,status:l.status})});this.listeners.push(e);let r=this.ipcService.on("history-collection-result",l=>{this.isCollecting.set(!1),l.success&&l.result?(this.collectionResult.set(l.result),this.collectionComplete.emit(l.result),this.toastService.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${l.result.collected} \u4F4D\u7528\u6236`)):this.toastService.error(l.error||"\u6536\u96C6\u5931\u6557")});this.listeners.push(r)}loadStats(){let t=this.group();t&&(this.isLoadingStats.set(!0),this.stats.set(null),this.collectionResult.set(null),this.ipcService.send("get-history-collection-stats",{groupId:t.id,telegramId:t.telegramId}))}selectTemplate(t){switch(this.selectedTemplate.set(t),t){case"quick":this.config.update(e=>P(R({},e),{limit:100,timeRange:"7d",minMessages:1}));break;case"precise":this.config.update(e=>P(R({},e),{limit:200,timeRange:"30d",minMessages:3}));break;case"deep":this.config.update(e=>P(R({},e),{limit:-1,timeRange:"all",minMessages:1}));break}}setLimit(t){this.config.update(e=>P(R({},e),{limit:t}))}setTimeRange(t){this.config.update(e=>P(R({},e),{timeRange:t}))}setMinMessages(t){this.config.update(e=>P(R({},e),{minMessages:t}))}toggleOption(t){this.config.update(e=>P(R({},e),{options:P(R({},e.options),{[t]:!e.options[t]})}))}getProgressPercent(){let t=this.collectionProgress();return t.total===0?0:Math.min(100,Math.round(t.current/t.total*100))}startCollection(){let t=this.group();if(!t||!this.canStart())return;this.isCollecting.set(!0),this.collectionResult.set(null),this.collectionProgress.set({current:0,total:0,status:"\u6B63\u5728\u521D\u59CB\u5316..."});let e=this.config();this.ipcService.send("collect-users-from-history-advanced",{groupId:t.id,telegramId:t.telegramId,config:{limit:e.limit,timeRange:e.timeRange,minMessages:e.minMessages,skipDuplicates:e.options.skipDuplicates,excludeBots:e.options.excludeBots,requireUsername:e.options.requireUsername,excludeAdmins:e.options.excludeAdmins,autoSync:e.options.autoSync}})}viewCollectedUsers(){this.viewUsersEvent.emit(),this.close()}close(){this.closeDialog.emit()}onBackdropClick(t){t.target===t.currentTarget&&this.close()}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-history-collection-dialog"]],inputs:{isOpen:[1,"isOpen"],group:[1,"group"]},outputs:{closeDialog:"closeDialog",collectionComplete:"collectionComplete",viewUsersEvent:"viewUsersEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[70]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[70]","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col",3,"click"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-orange-500/10","to-amber-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-orange-500","to-amber-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","space-y-5"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"p-4","bg-orange-500/10","rounded-xl","border","border-orange-500/30"],[1,"p-4","bg-emerald-500/10","rounded-xl","border","border-emerald-500/30"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"flex","items-center","justify-between","mb-4","text-sm"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-colors","font-medium",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-orange-500","to-amber-500","hover:from-orange-600","hover:to-amber-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-orange-500/20","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-emerald-500/20","flex","items-center","justify-center","gap-2"],[1,"flex","items-center","gap-3","mb-4"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-orange-500/20","to-amber-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1","min-w-0"],[1,"font-medium","text-white","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"flex","items-center","justify-center","py-4"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-lg","text-center"],[1,"animate-spin","text-xl","mr-2"],[1,"text-slate-400"],[1,"grid","grid-cols-3","gap-3"],[1,"p-3","bg-slate-700/30","rounded-lg","text-center"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xs","text-slate-500"],[1,"text-xl","font-bold","text-emerald-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"mt-3","text-xs","text-slate-500","text-center"],[1,"text-sm","text-amber-400"],[1,"text-xs","text-slate-400","mt-1"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"p-4","rounded-xl","border","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"flex","flex-wrap","gap-2"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-orange-500","bg-orange-500/20","text-orange-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-cyan-500","bg-cyan-500/20","text-cyan-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-purple-500","bg-purple-500/20","text-purple-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"border","border-slate-700/50","rounded-xl","overflow-hidden"],[1,"w-full","p-4","bg-slate-800/30","flex","items-center","justify-between","hover:bg-slate-800/50","transition-colors",3,"click"],[1,"text-sm","font-medium","text-slate-300"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-400","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-4","space-y-3","border-t","border-slate-700/50"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"click"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","gap-3","p-3","bg-slate-700/30","rounded-lg","cursor-pointer","hover:bg-slate-700/50"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600","text-orange-500","focus:ring-orange-500",3,"change","checked"],[1,"text-sm","text-white"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","text-orange-400","flex","items-center","gap-2"],[1,"animate-spin"],[1,"text-xs","text-slate-400"],[1,"w-full","bg-slate-700","rounded-full","h-2","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-orange-500","to-amber-500","rounded-full","transition-all","duration-300"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-sm","text-emerald-400","flex","items-center","gap-2"],[1,"text-lg","font-bold","text-emerald-400"],[1,"grid","grid-cols-4","gap-2","mb-3"],[1,"p-2","bg-slate-700/30","rounded-lg","text-center"],[1,"text-sm","font-bold","text-green-400"],[1,"text-sm","font-bold","text-blue-400"],[1,"text-sm","font-bold","text-slate-400"],[1,"text-sm","font-bold","text-orange-400"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-orange-400"],[1,"text-emerald-400"],[1,"flex","items-center","gap-2"],[1,"text-slate-500"],[1,"text-orange-400","font-medium"],[1,"flex-1","py-3","bg-gradient-to-r","from-orange-500","to-amber-500","hover:from-orange-600","hover:to-amber-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-orange-500/20","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-emerald-500/20","flex","items-center","justify-center","gap-2",3,"click"]],template:function(e,r){e&1&&x(0,gt,27,7,"div",0),e&2&&_(r.isOpen()?0:-1)},dependencies:[K,W,fe,Ue],encapsulation:2})}};var ze=(a,t)=>t.id;function xt(a,t){a&1&&(n(0,"span",42),o(1," \u983B\u9053 "),i())}function _t(a,t){a&1&&(n(0,"span",43),o(1," \u8D85\u7D1A\u7FA4 "),i())}function ft(a,t){if(a&1&&(n(0,"span",49)(1,"span"),o(2,"\u{1F525}"),i(),n(3,"span"),o(4),i()()),a&2){let e=d().$implicit;s(4),C(e.stats.matchesToday)}}function Ct(a,t){if(a&1&&(n(0,"span",53),o(1),i()),a&2){let e=t.$implicit,r=d(3);k("title",r.stateService.getKeywordSetName(e)),s(),v(" \u{1F511} ",r.stateService.getKeywordSetName(e)," ")}}function vt(a,t){if(a&1&&(n(0,"span",54),o(1),i()),a&2){let e=d(2).$implicit;s(),v(" +",e.linkedKeywordSets.length-2," ")}}function bt(a,t){if(a&1&&(T(0,Ct,2,2,"span",53,re),x(2,vt,2,1,"span",54)),a&2){let e=d().$implicit;A(e.linkedKeywordSets.slice(0,2)),s(2),_(e.linkedKeywordSets.length>2?2:-1)}}function ht(a,t){a&1&&(n(0,"span",52),o(1," \u26A0\uFE0F \u672A\u7D81\u5B9A\u8A5E\u96C6 "),i())}function St(a,t){if(a&1){let e=y();n(0,"div",36),p("click",function(){let l=c(e).$implicit,u=d();return m(u.openGroupDetail(l))}),n(1,"div",37)(2,"div",38),o(3),i(),n(4,"div",39)(5,"div",40)(6,"span",41),o(7),i(),x(8,xt,2,0,"span",42)(9,_t,2,0,"span",43),i(),n(10,"div",44),o(11),i()()(),n(12,"div",45)(13,"div",40)(14,"span",46)(15,"span",47),o(16,"\u{1F465}"),i(),n(17,"span",48),o(18),$(19,"number"),i()(),x(20,ft,5,1,"span",49),i(),n(21,"span",50),o(22," \u67E5\u770B\u8A73\u60C5 \u2192 "),i()(),n(23,"div",51),x(24,bt,3,1)(25,ht,2,0,"span",52),i()()}if(a&2){let e=t.$implicit;s(2),S("bg-gradient-to-br",!0)("from-emerald-500/30",e.resourceType!=="channel")("to-teal-500/30",e.resourceType!=="channel")("text-emerald-400",e.resourceType!=="channel")("border-emerald-500/20",e.resourceType!=="channel")("from-blue-500/30",e.resourceType==="channel")("to-indigo-500/30",e.resourceType==="channel")("text-blue-400",e.resourceType==="channel")("border-blue-500/20",e.resourceType==="channel"),s(),v(" ",e.resourceType==="channel"?"\u{1F4E2}":e.name[0]," "),s(3),k("title",e.name),s(),v(" ",e.name," "),s(),_(e.resourceType==="channel"?8:e.resourceType==="supergroup"?9:-1),s(2),k("title",e.url),s(),v(" ",e.url," "),s(7),C(X(19,27,e.memberCount)),s(2),_(e.stats!=null&&e.stats.matchesToday&&e.stats.matchesToday>0?20:-1),s(4),_(e.linkedKeywordSets.length>0?24:25)}}function Et(a,t){if(a&1){let e=y();n(0,"div",33)(1,"div",55)(2,"span",56),o(3,"\u{1F465}"),i()(),n(4,"h3",57),o(5,"\u9084\u6C92\u6709\u76E3\u63A7\u7FA4\u7D44"),i(),n(6,"p",58),o(7,"\u8ACB\u5728\u8CC7\u6E90\u4E2D\u5FC3\u641C\u7D22\u4E26\u6DFB\u52A0\u7FA4\u7D44"),i(),n(8,"button",59),p("click",function(){c(e);let l=d();return m(l.navigateToResourceCenter())}),o(9," + \u6DFB\u52A0\u7B2C\u4E00\u500B\u7FA4\u7D44 "),i()()}}function yt(a,t){a&1&&(n(0,"span",103),o(1,"\u76E3\u807D"),i())}function wt(a,t){a&1&&(n(0,"span",104),o(1,"\u767C\u9001"),i())}function Dt(a,t){if(a&1&&(n(0,"div",76)(1,"div",99),o(2),i(),n(3,"div",100)(4,"div",101),o(5),i(),n(6,"div",28),o(7),i()(),n(8,"div",102),x(9,yt,2,0,"span",103),x(10,wt,2,0,"span",104),i()()),a&2){let e=d(3);s(2),v(" ",e.getAccountInitial(e.selectedGroup().accountPhone)," "),s(3),C(e.getAccountName(e.selectedGroup().accountPhone)),s(2),C(e.selectedGroup().accountPhone),s(2),_(e.isListenerAccount(e.selectedGroup().accountPhone)?9:-1),s(),_(e.isSenderAccount(e.selectedGroup().accountPhone)?10:-1)}}function Tt(a,t){a&1&&(n(0,"div",77)(1,"p"),o(2,"\u5C1A\u672A\u5206\u914D\u76E3\u63A7\u5E33\u865F"),i()())}function At(a,t){if(a&1&&(n(0,"span",87),o(1),i()),a&2){let e=d(3);s(),v(" \u53EF\u6536\u96C6 ~",e.estimatedNewUsers()," \u4EBA ")}}function kt(a,t){if(a&1){let e=y();n(0,"button",105),p("click",function(){c(e);let l=d(3);return m(l.viewCollectedUsers())}),n(1,"span"),o(2,"\u{1F441}\uFE0F"),i(),n(3,"span"),o(4),i()()}if(a&2){let e=d(3);s(4),v("\u67E5\u770B\u5DF2\u6536\u96C6 (",e.collectedUsersCount(),")")}}function Ft(a,t){a&1&&(n(0,"div",91)(1,"p",106)(2,"span",107),o(3,"\u{1F4A1}"),i(),n(4,"span"),o(5,"\u958B\u555F\u7FA4\u7D44\u76E3\u63A7\u5F8C\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u6D88\u606F\u3002\u7D2F\u7A4D\u4E00\u5B9A\u6D88\u606F\u5F8C\u5373\u53EF\u6536\u96C6\u767C\u8A00\u7528\u6236\u3002"),i()()())}function Mt(a,t){if(a&1&&(n(0,"div",92)(1,"p",108),o(2),$(3,"number"),i()()),a&2){let e=d(3);s(2),v(" \u5F9E ",X(3,1,e.monitoredMessagesCount())," \u689D\u6D88\u606F\u4E2D\u63D0\u53D6\u6D3B\u8E8D\u7528\u6236\uFF0C\u7121\u9700\u7BA1\u7406\u54E1\u6B0A\u9650 ")}}function It(a,t){a&1&&(n(0,"div",93)(1,"p",109)(2,"span"),o(3,"\u26A0\uFE0F"),i(),n(4,"span"),o(5,"\u9700\u8981\u5206\u914D\u76E3\u63A7\u5E33\u865F\u624D\u80FD\u6536\u96C6\u7528\u6236"),i()()())}function Vt(a,t){if(a&1){let e=y();n(0,"div",110)(1,"span",111),o(2),i(),n(3,"button",112),p("click",function(){let l=c(e).$implicit,u=d(4);return m(u.unbindKeywordSet(l))}),o(4," \u89E3\u7D81 "),i()()}if(a&2){let e=t.$implicit,r=d(4);s(2),C(r.stateService.getKeywordSetName(e))}}function Rt(a,t){if(a&1&&(n(0,"div",94),T(1,Vt,5,1,"div",110,re),i()),a&2){let e=d(3);s(),A(e.selectedGroup().linkedKeywordSets)}}function Bt(a,t){a&1&&(n(0,"p",95),o(1,"\u5C1A\u672A\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6"),i())}function Pt(a,t){if(a&1){let e=y();n(0,"button",116),p("click",function(){let l=c(e).$implicit,u=d(4);return m(u.bindKeywordSet(l.id))}),o(1),i()}if(a&2){let e=t.$implicit;s(),v(" + ",e.name," ")}}function Ut(a,t){if(a&1&&(n(0,"div",96)(1,"p",113),o(2,"\u9EDE\u64CA\u7D81\u5B9A\u8A5E\u96C6\uFF1A"),i(),n(3,"div",114),T(4,Pt,2,1,"button",115,ze),i()()),a&2){let e=d(3);s(4),A(e.availableKeywordSets())}}function Lt(a,t){if(a&1&&(n(0,"div",97)(1,"div",117)(2,"span",118)(3,"span",119),o(4,"\u23F3"),i(),o(5," \u6B63\u5728\u63D0\u53D6\u6210\u54E1... "),i(),n(6,"span",14),o(7),i()(),n(8,"div",120),F(9,"div",121),i(),n(10,"div",122),o(11),i()()),a&2){let e=d(3);s(7),j(" ",e.extractionProgress().extracted," / ",e.extractionProgress().total," "),s(2),se("width",e.getExtractionPercent(),"%"),s(2),C(e.extractionProgress().status)}}function Gt(a,t){if(a&1&&(n(0,"div",98)(1,"div",123)(2,"span",118)(3,"span"),o(4,"\u2705"),i(),o(5," \u63D0\u53D6\u5B8C\u6210 "),i(),n(6,"span",124),o(7),i()(),n(8,"div",125)(9,"span",126),o(10),i(),n(11,"span",126),o(12),i(),n(13,"span",126),o(14),i()()()),a&2){let e=d(3);s(7),v("",e.extractionResult().count," \u4EBA"),s(3),v("\u{1F7E2} ",e.extractionResult().online," \u5728\u7DDA"),s(2),v("\u23F0 ",e.extractionResult().recently," \u6700\u8FD1"),s(2),v("\u{1F48E} ",e.extractionResult().premium," Premium")}}function jt(a,t){if(a&1){let e=y();n(0,"div",67)(1,"div",68)(2,"div",69),o(3),i(),n(4,"div",70)(5,"h4",71),o(6),i(),n(7,"p",72),o(8),i()()(),n(9,"div",73)(10,"div",74)(11,"div",17),o(12),$(13,"number"),i(),n(14,"div",28),o(15,"\u6210\u54E1\u6578"),i()(),n(16,"div",74)(17,"div",20),o(18),i(),n(19,"div",28),o(20,"\u4ECA\u65E5\u5339\u914D"),i()()()(),n(21,"div",67)(22,"h4",75)(23,"span"),o(24,"\u{1F4F1}"),i(),o(25," \u76E3\u63A7\u5E33\u865F "),i(),x(26,Dt,11,5,"div",76)(27,Tt,3,0,"div",77),i(),n(28,"div",78)(29,"h4",79)(30,"span",40)(31,"span"),o(32,"\u{1F504}"),i(),o(33," \u5F9E\u6B77\u53F2\u6D88\u606F\u6536\u96C6\u7528\u6236 "),i(),n(34,"span",28),o(35,"\u66FF\u4EE3\u6210\u54E1\u63D0\u53D6"),i()(),n(36,"div",80)(37,"div",81)(38,"div",82),o(39),$(40,"number"),i(),n(41,"div",83),o(42,"\u76E3\u63A7\u6D88\u606F"),i()(),n(43,"div",81)(44,"div",84),o(45),i(),n(46,"div",83),o(47,"\u5DF2\u6536\u96C6"),i()(),n(48,"div",81)(49,"div",85),o(50),i(),n(51,"div",83),o(52,"\u53EF\u6536\u96C6"),i()()(),n(53,"button",86),p("click",function(){c(e);let l=d(2);return m(l.openHistoryCollectionDialog())}),n(54,"span",47),o(55,"\u{1F504}"),i(),n(56,"span"),o(57,"\u958B\u59CB\u6536\u96C6\u7528\u6236"),i(),x(58,At,2,1,"span",87),i(),n(59,"div",88),x(60,kt,5,1,"button",89),n(61,"button",90),p("click",function(){c(e);let l=d(2);return m(l.refreshCollectedStats())}),n(62,"span"),o(63,"\u{1F504}"),i(),n(64,"span"),o(65,"\u5237\u65B0"),i()()(),x(66,Ft,6,0,"div",91)(67,Mt,4,3,"div",92),x(68,It,6,0,"div",93),i(),n(69,"div",67)(70,"h4",75)(71,"span"),o(72,"\u{1F511}"),i(),o(73," \u7D81\u5B9A\u7684\u95DC\u9375\u8A5E\u96C6 "),i(),x(74,Rt,3,0,"div",94)(75,Bt,2,0,"p",95),x(76,Ut,6,0,"div",96),i(),x(77,Lt,12,5,"div",97),x(78,Gt,15,4,"div",98)}if(a&2){let e,r=d(2);s(3),v(" ",r.selectedGroup().name[0]," "),s(3),C(r.selectedGroup().name),s(2),C(r.selectedGroup().url),s(4),C(X(13,21,r.selectedGroup().memberCount)),s(6),C(((e=r.selectedGroup().stats)==null?null:e.matchesToday)||0),s(8),_(r.selectedGroup().accountPhone?26:27),s(13),C(X(40,23,r.monitoredMessagesCount())),s(6),C(r.collectedUsersCount()),s(5),C(r.estimatedNewUsers()),s(3),k("disabled",r.monitoredMessagesCount()===0),s(5),_(r.monitoredMessagesCount()>0?58:-1),s(2),_(r.collectedUsersCount()>0?60:-1),s(),k("disabled",r.isLoadingStats()),s(),S("animate-spin",r.isLoadingStats()),s(4),_(r.monitoredMessagesCount()===0?66:67),s(2),_(r.selectedGroup().accountPhone?-1:68),s(6),_(r.selectedGroup().linkedKeywordSets.length>0?74:75),s(2),_(r.availableKeywordSets().length>0?76:-1),s(),_(r.extractionProgress().isExtracting&&r.extractionProgress().groupId===r.selectedGroup().id?77:-1),s(),_(r.extractionResult().completed&&r.extractionResult().groupId===r.selectedGroup().id?78:-1)}}function Nt(a,t){a&1&&(n(0,"span",132),o(1,"\u23F3"),i(),o(2," \u63D0\u53D6\u4E2D... "))}function Kt(a,t){a&1&&(n(0,"span"),o(1,"\u{1F465}"),i(),o(2," \u63D0\u53D6\u6210\u54E1 "))}function Wt(a,t){if(a&1){let e=y();n(0,"div",66)(1,"div",127)(2,"button",128),p("click",function(){c(e);let l=d(2);return m(l.extractMembers())}),x(3,Nt,3,0)(4,Kt,3,0),i(),n(5,"button",129),p("click",function(){c(e);let l=d(2);return m(l.copyGroupLink())}),n(6,"span"),o(7,"\u{1F4CB}"),i(),o(8," \u8907\u88FD\u93C8\u63A5 "),i(),n(9,"button",130),p("click",function(){c(e);let l=d(2);return m(l.openInTelegram())}),n(10,"span"),o(11,"\u{1F517}"),i(),o(12," \u5728 Telegram \u6253\u958B "),i(),n(13,"button",131),p("click",function(){c(e);let l=d(2);return m(l.removeGroup())}),n(14,"span"),o(15,"\u{1F5D1}\uFE0F"),i(),o(16," \u79FB\u9664\u76E3\u63A7 "),i()()()}if(a&2){let e=d(2);s(2),k("disabled",e.extractionProgress().isExtracting),s(),_(e.extractionProgress().isExtracting&&e.extractionProgress().groupId===e.selectedGroup().id?3:4)}}function Ot(a,t){if(a&1){let e=y();n(0,"div",34)(1,"div",60),p("click",function(){c(e);let l=d();return m(l.closeDetailDialog())}),i(),n(2,"div",61)(3,"div",62)(4,"h3",63)(5,"span"),o(6,"\u{1F4CB}"),i(),o(7," \u7FA4\u7D44\u8A73\u60C5 "),i(),n(8,"button",64),p("click",function(){c(e);let l=d();return m(l.closeDetailDialog())}),o(9," \u2715 "),i()(),n(10,"div",65),x(11,jt,79,25),i(),x(12,Wt,17,2,"div",66),i()()}if(a&2){let e=d();s(11),_(e.selectedGroup()?11:-1),s(),_(e.selectedGroup()?12:-1)}}var ve=class a{constructor(){this.stateService=D(z);this.ipcService=D(O);this.toastService=D(H);this.confirmDialog=D(q);this.configAction=J();this.extractMembersEvent=J();this.selectedGroup=w(null);this.showDetailDialog=w(!1);this.isRefreshingMemberCounts=w(!1);this.refreshMemberCountProgress=w({current:0,total:0});this.extractionProgress=w({isExtracting:!1,groupId:"",extracted:0,total:0,status:""});this.extractionResult=w({completed:!1,groupId:"",count:0,online:0,recently:0,premium:0});this.collectedUsersCount=w(0);this.monitoredMessagesCount=w(0);this.isCollectingFromHistory=w(!1);this.showHistoryCollectionDialog=w(!1);this.historyCollectionGroup=w(null);this.isLoadingStats=w(!1);this.estimatedNewUsers=N(()=>{let t=this.monitoredMessagesCount(),e=this.collectedUsersCount();return Math.max(0,Math.round(t/5)-e)});this.availableKeywordSets=N(()=>{let t=this.selectedGroup();return t?this.stateService.keywordSets().filter(e=>!t.linkedKeywordSets.includes(e.id)):[]});this.listeners=[]}ngOnInit(){this.stateService.loadAll(),this.setupListeners()}setupListeners(){let t=this.ipcService.on("bind-keyword-set-result",E=>{if(E.success&&E.currentKeywordSetIds){this.stateService.updateGroupKeywordSets(String(E.groupId),E.currentKeywordSetIds.map(U=>String(U)));let B=this.selectedGroup();B&&String(B.id)===String(E.groupId)&&this.selectedGroup.update(U=>U?P(R({},U),{linkedKeywordSets:E.currentKeywordSetIds.map(Q=>String(Q))}):null)}});this.listeners.push(t);let e=this.ipcService.on("unbind-keyword-set-result",E=>{if(E.success&&E.currentKeywordSetIds){this.stateService.updateGroupKeywordSets(String(E.groupId),E.currentKeywordSetIds.map(U=>String(U)));let B=this.selectedGroup();B&&String(B.id)===String(E.groupId)&&this.selectedGroup.update(U=>U?P(R({},U),{linkedKeywordSets:E.currentKeywordSetIds.map(Q=>String(Q))}):null)}});this.listeners.push(e);let r=this.ipcService.on("members-extraction-progress",E=>{let B=this.selectedGroup();B&&String(B.id)===String(E.resourceId)&&this.extractionProgress.set({isExtracting:!0,groupId:String(E.resourceId),extracted:E.extracted,total:E.total,status:E.status})});this.listeners.push(r);let l=this.ipcService.on("members-extracted",E=>{let B=this.selectedGroup();if(E.success&&E.members&&B&&String(B.id)===String(E.resourceId)){let U=0,Q=0,Te=0;for(let pe of E.members)pe.online_status==="online"?U++:pe.online_status==="recently"&&Q++,pe.is_premium&&Te++;this.extractionProgress.set({isExtracting:!1,groupId:"",extracted:0,total:0,status:""}),this.extractionResult.set({completed:!0,groupId:String(E.resourceId),count:E.members.length,online:U,recently:Q,premium:Te}),setTimeout(()=>{this.extractionResult().groupId===String(E.resourceId)&&this.clearExtractionResult()},1e4)}else E.error&&this.extractionProgress.set({isExtracting:!1,groupId:"",extracted:0,total:0,status:""})});this.listeners.push(l);let u=this.ipcService.on("group-collected-stats",E=>{let B=this.selectedGroup();B&&String(B.id)===String(E.groupId)&&(this.collectedUsersCount.set(E.collectedUsers||0),this.monitoredMessagesCount.set(E.monitoredMessages||0))});this.listeners.push(u);let b=this.ipcService.on("batch-refresh-member-counts-progress",E=>{this.refreshMemberCountProgress.set({current:E.current,total:E.total}),E.memberCount>0&&this.stateService.updateGroupMemberCount(E.groupId,E.memberCount)});this.listeners.push(b);let h=this.ipcService.on("batch-refresh-member-counts-complete",E=>{this.isRefreshingMemberCounts.set(!1),this.refreshMemberCountProgress.set({current:0,total:0}),E.success?(this.toastService.success(`\u2705 \u6210\u54E1\u6578\u5237\u65B0\u5B8C\u6210\uFF1A${E.updated} \u500B\u6210\u529F\uFF0C${E.failed} \u500B\u5931\u6557`),this.stateService.refresh()):this.toastService.error("\u6210\u54E1\u6578\u5237\u65B0\u5931\u6557")});this.listeners.push(h)}getAccountInitial(t){let e=this.stateService.accounts().find(r=>r.phone===t);return e?.username?e.username[0].toUpperCase():t?t.slice(-2):"?"}getAccountName(t){let e=this.stateService.accounts().find(r=>r.phone===t);return e?.username||e?.firstName||t||"\u672A\u77E5\u5E33\u865F"}isListenerAccount(t){return this.stateService.accounts().find(r=>r.phone===t)?.isListener??!1}isSenderAccount(t){return this.stateService.accounts().find(r=>r.phone===t)?.isSender??!1}refreshData(){this.stateService.refresh(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u7FA4\u7D44\u5217\u8868...")}refreshAllMemberCounts(){let t=this.stateService.groups();if(t.length===0){this.toastService.warning("\u6C92\u6709\u7FA4\u7D44\u9700\u8981\u5237\u65B0");return}this.isRefreshingMemberCounts.set(!0),this.refreshMemberCountProgress.set({current:0,total:t.length}),this.ipcService.send("batch-refresh-member-counts",{groups:t.map(e=>({id:e.id,url:e.url,accountPhone:e.accountPhone}))}),this.toastService.info(`\u{1F504} \u958B\u59CB\u5237\u65B0 ${t.length} \u500B\u7FA4\u7D44\u7684\u6210\u54E1\u6578...`)}selectGroup(t){this.selectedGroup.set(t)}openGroupDetail(t){this.selectedGroup.set(t),this.showDetailDialog.set(!0),this.loadCollectedStats(t)}closeDetailDialog(){this.showDetailDialog.set(!1)}loadCollectedStats(t){this.collectedUsersCount.set(0),this.monitoredMessagesCount.set(0),this.ipcService.send("get-group-collected-stats",{groupId:t.id,telegramId:t.telegramId})}viewCollectedUsers(){let t=this.selectedGroup();t&&(this.closeDetailDialog(),this.toastService.info(`\u{1F4CB} \u8DF3\u8F49\u5230\u300C${t.name}\u300D\u7684\u5DF2\u6536\u96C6\u7528\u6236...`),this.ipcService.send("navigate-to-collected-users",{groupId:t.id,groupName:t.name,telegramId:t.telegramId}))}collectFromHistory(){let t=this.selectedGroup();if(!t)return;this.isCollectingFromHistory.set(!0),this.toastService.info("\u{1F504} \u6B63\u5728\u5F9E\u6B77\u53F2\u6D88\u606F\u4E2D\u6536\u96C6\u7528\u6236..."),this.ipcService.send("collect-users-from-history",{groupId:t.id,telegramId:t.telegramId,limit:500});let e=this.ipcService.on("collect-from-history-result",r=>{String(r.groupId)===String(t.id)&&(this.isCollectingFromHistory.set(!1),e(),r.success?(this.toastService.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${r.collected} \u4F4D\u7528\u6236\uFF0C\u65B0\u589E ${r.newUsers||0} \u4F4D`),this.loadCollectedStats(t)):this.toastService.error(r.error||"\u6536\u96C6\u5931\u6557"))});this.listeners.push(e)}openHistoryCollectionDialog(){let t=this.selectedGroup();t&&(this.historyCollectionGroup.set({id:t.id,name:t.name,telegramId:t.telegramId,url:t.url,accountPhone:t.accountPhone}),this.showHistoryCollectionDialog.set(!0),setTimeout(()=>{this.ipcService.send("get-history-collection-stats",{groupId:t.id,telegramId:t.telegramId})},100))}closeHistoryCollectionDialog(){this.showHistoryCollectionDialog.set(!1)}onHistoryCollectionComplete(t){let e=this.selectedGroup();e&&this.loadCollectedStats(e)}refreshCollectedStats(){let t=this.selectedGroup();t&&(this.isLoadingStats.set(!0),this.loadCollectedStats(t),setTimeout(()=>{this.isLoadingStats.set(!1)},5e3))}navigateToResourceCenter(){this.configAction.emit("goto-resource-center"),this.toastService.info("\u8ACB\u5728\u300C\u8CC7\u6E90\u4E2D\u5FC3\u300D\u641C\u7D22\u4E26\u6DFB\u52A0\u7FA4\u7D44")}handleConfigAction(t){this.configAction.emit(t)}bindKeywordSet(t){let e=this.selectedGroup();if(!e){console.log("[Groups] bindKeywordSet: No group selected");return}let r={groupId:parseInt(e.id),keywordSetId:parseInt(t)};console.log("[Groups] ========== bindKeywordSet =========="),console.log("[Groups] Sending bind-keyword-set with payload:",r),this.ipcService.send("bind-keyword-set",r);let l=[...e.linkedKeywordSets,t];this.selectedGroup.update(u=>u?P(R({},u),{linkedKeywordSets:l}):null),this.stateService.updateGroupKeywordSets(e.id,l),console.log("[Groups] Updated linkedKeywordSets:",l),this.toastService.success(`\u2705 \u8A5E\u96C6\u5DF2\u7D81\u5B9A\u5230 ${e.name}`)}unbindKeywordSet(t){let e=this.selectedGroup();if(!e)return;this.ipcService.send("unbind-keyword-set",{groupId:parseInt(e.id),keywordSetId:parseInt(t)});let r=e.linkedKeywordSets.filter(l=>l!==t);this.selectedGroup.update(l=>l?P(R({},l),{linkedKeywordSets:r}):null),this.stateService.updateGroupKeywordSets(e.id,r),this.toastService.info(`\u5DF2\u5F9E ${e.name} \u89E3\u7D81\u8A5E\u96C6`)}extractMembers(){let t=this.selectedGroup();t&&this.extractMembersEvent.emit(t)}executeExtraction(t){let e=this.selectedGroup();if(!e)return;this.extractionProgress.set({isExtracting:!0,groupId:e.id,extracted:0,total:t.limit===-1?e.memberCount||0:t.limit,status:"\u6B63\u5728\u9023\u63A5..."}),this.clearExtractionResult();let r="",l="";if(e.telegramId)r=e.telegramId,console.log("[Groups] Using telegramId for extraction:",r);else if(e.url){let u=e.url.match(/t\.me\/([^+/][^/]*?)(?:\?|$)/);u?(l=u[1],r=l,console.log("[Groups] Using username for extraction:",l)):console.log("[Groups] URL is invite link, need telegramId:",e.url)}if(!r){this.toastService.error("\u7121\u6CD5\u63D0\u53D6\u6210\u54E1\uFF1A\u8A72\u7FA4\u7D44\u7F3A\u5C11\u6709\u6548\u7684 ID\u3002\u8ACB\u5148\u624B\u52D5\u6253\u958B\u7FA4\u7D44\u4EE5\u7372\u53D6\u5176 ID\u3002"),this.extractionProgress.set({isExtracting:!1,groupId:"",extracted:0,total:0,status:""});return}this.ipcService.send("extract-members",{chatId:r,telegramId:e.telegramId,username:l,resourceId:e.id,groupName:e.name,limit:t.limit===-1?void 0:t.limit,filters:{bots:!t.filters.excludeBots,onlineStatus:t.filters.onlineStatus||"all",offline:t.filters.onlineStatus==="offline",online:t.filters.onlineStatus==="online",chinese:t.filters.hasChinese,hasUsername:t.filters.hasUsername,isPremium:t.filters.isPremium,excludeAdmins:t.filters.excludeAdmins},autoSave:t.advanced.autoSaveToResources,skipDuplicates:t.advanced.skipDuplicates}),this.toastService.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${e.name} \u7684\u6210\u54E1...`)}getExtractionPercent(){let t=this.extractionProgress();return t.total===0?0:Math.min(100,Math.round(t.extracted/t.total*100))}clearExtractionResult(){this.extractionResult.set({completed:!1,groupId:"",count:0,online:0,recently:0,premium:0})}copyGroupLink(){let t=this.selectedGroup();t&&(navigator.clipboard.writeText(t.url||""),this.toastService.success("\u{1F4CB} \u5DF2\u8907\u88FD\u7FA4\u7D44\u93C8\u63A5"))}openInTelegram(){let t=this.selectedGroup();t?.url&&window.open(t.url,"_blank")}async removeGroup(){let t=this.selectedGroup();if(!t)return;await this.confirmDialog.danger("\u79FB\u9664\u76E3\u63A7\u7FA4\u7D44",`\u78BA\u5B9A\u8981\u79FB\u9664\u76E3\u63A7\u7FA4\u7D44\u300C${t.name}\u300D\u55CE\uFF1F
\u79FB\u9664\u5F8C\u5C07\u505C\u6B62\u76E3\u63A7\u6B64\u7FA4\u7D44\u7684\u6D88\u606F\u3002`,[t.name||t.url||""])&&(this.ipcService.send("remove-group",{id:parseInt(t.id)}),this.selectedGroup.set(null),this.showDetailDialog.set(!1),this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u79FB\u9664 ${t.name}`),setTimeout(()=>this.stateService.refresh(),500))}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-monitoring-groups"]],outputs:{configAction:"configAction",extractMembersEvent:"extractMembersEvent"},decls:83,vars:17,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-emerald-500","to-teal-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400","rounded-lg","transition-colors","flex","items-center","gap-2","border","border-purple-500/30","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"bg-gradient-to-br","from-emerald-500/10","to-teal-500/5","rounded-xl","border","border-emerald-500/20","p-4","hover:border-emerald-500/40","transition-colors"],[1,"w-12","h-12","bg-emerald-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-400"],[1,"bg-gradient-to-br","from-cyan-500/10","to-blue-500/5","rounded-xl","border","border-cyan-500/20","p-4","hover:border-cyan-500/40","transition-colors"],[1,"w-12","h-12","bg-cyan-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"bg-gradient-to-br","from-orange-500/10","to-amber-500/5","rounded-xl","border","border-orange-500/20","p-4","hover:border-orange-500/40","transition-colors"],[1,"w-12","h-12","bg-orange-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-orange-400"],[1,"bg-gradient-to-br","from-purple-500/10","to-pink-500/5","rounded-xl","border","border-purple-500/20","p-4","hover:border-purple-500/40","transition-colors"],[1,"w-12","h-12","bg-purple-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-purple-400"],[1,"flex-1","overflow-hidden"],[1,"h-full","bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"text-xs","text-slate-500"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex-1","overflow-y-auto","p-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/60","rounded-xl","hover:bg-slate-700/80","transition-all","cursor-pointer","group","border","border-slate-700/50","hover:border-cyan-500/40","hover:shadow-lg","hover:shadow-cyan-500/10","overflow-hidden"],[1,"col-span-full","text-center","py-16","text-slate-400"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4"],[3,"closeDialog","collectionComplete","viewUsersEvent","isOpen","group"],[1,"p-4","bg-slate-800/60","rounded-xl","hover:bg-slate-700/80","transition-all","cursor-pointer","group","border","border-slate-700/50","hover:border-cyan-500/40","hover:shadow-lg","hover:shadow-cyan-500/10","overflow-hidden",3,"click"],[1,"flex","items-start","gap-3","mb-3"],[1,"w-11","h-11","rounded-xl","flex","items-center","justify-center","text-xl","font-bold","flex-shrink-0","border"],[1,"flex-1","min-w-0","overflow-hidden"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white","truncate","text-sm","leading-tight",3,"title"],[1,"px-1.5","py-0.5","bg-blue-500/20","text-blue-400","text-[10px]","rounded","flex-shrink-0"],[1,"px-1.5","py-0.5","bg-purple-500/20","text-purple-400","text-[10px]","rounded","flex-shrink-0"],[1,"text-xs","text-slate-500","truncate","mt-0.5",3,"title"],[1,"flex","items-center","justify-between","text-xs","mb-3","px-1"],[1,"text-slate-400","flex","items-center","gap-1"],[1,"text-base"],[1,"font-medium"],[1,"text-orange-400","flex","items-center","gap-1"],[1,"text-cyan-400","text-xs","opacity-0","group-hover:opacity-100","transition-opacity","whitespace-nowrap"],[1,"flex","flex-wrap","gap-1.5","overflow-hidden","max-h-[52px]"],[1,"px-2","py-1","bg-amber-500/20","text-amber-400","text-xs","rounded-md"],[1,"px-2","py-1","bg-purple-500/20","text-purple-400","text-xs","rounded-md","truncate","max-w-[120px]",3,"title"],[1,"px-2","py-1","bg-slate-600/50","text-slate-400","text-xs","rounded-md"],[1,"w-20","h-20","mx-auto","mb-4","rounded-2xl","bg-slate-800/50","flex","items-center","justify-center"],[1,"text-4xl"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-sm","mb-6","text-slate-500"],[1,"px-5","py-2.5","bg-cyan-500/20","text-cyan-400","rounded-xl","hover:bg-cyan-500/30","transition-colors","border","border-cyan-500/30",3,"click"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm",3,"click"],[1,"relative","w-full","max-w-lg","max-h-[85vh]","bg-slate-900","rounded-2xl","border","border-slate-700/50","shadow-2xl","shadow-black/50","overflow-hidden","flex","flex-col","animate-in","fade-in","zoom-in-95","duration-200"],[1,"flex","items-center","justify-between","p-5","border-b","border-slate-700/50"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"w-8","h-8","flex","items-center","justify-center","rounded-lg","hover:bg-slate-700/50","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto","p-5","space-y-4"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"bg-slate-800/50","rounded-xl","p-4","border","border-slate-700/50"],[1,"flex","items-center","gap-4","mb-4"],[1,"w-16","h-16","rounded-xl","bg-gradient-to-br","from-emerald-500/20","to-teal-500/20","flex","items-center","justify-center","text-3xl","font-bold","text-emerald-400"],[1,"flex-1","min-w-0"],[1,"text-xl","font-medium","text-white","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"grid","grid-cols-2","gap-4"],[1,"text-center","p-3","bg-slate-700/30","rounded-lg"],[1,"text-sm","font-medium","text-slate-300","mb-3","flex","items-center","gap-2"],[1,"flex","items-center","gap-3","p-3","bg-slate-700/30","rounded-lg"],[1,"text-center","py-4","text-slate-500","text-sm","bg-slate-700/30","rounded-lg"],[1,"bg-gradient-to-br","from-orange-500/10","to-amber-500/5","rounded-xl","p-4","border","border-orange-500/30"],[1,"text-sm","font-medium","text-orange-400","mb-3","flex","items-center","justify-between"],[1,"grid","grid-cols-3","gap-2","mb-4"],[1,"p-2","bg-slate-800/50","rounded-lg","text-center"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-[10px]","text-slate-500"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-purple-400"],[1,"w-full","px-4","py-3","bg-gradient-to-r","from-orange-500","to-amber-500","hover:from-orange-600","hover:to-amber-600","text-white","rounded-xl","text-sm","font-medium","transition-all","flex","items-center","justify-center","gap-2","shadow-lg","shadow-orange-500/20","disabled:opacity-50","disabled:cursor-not-allowed","disabled:from-slate-600","disabled:to-slate-700",3,"click","disabled"],[1,"px-2","py-0.5","bg-white/20","rounded-full","text-xs"],[1,"flex","gap-2","mt-3"],[1,"flex-1","px-3","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-xs","transition-colors","flex","items-center","justify-center","gap-1.5"],[1,"px-3","py-2","bg-slate-700/50","hover:bg-slate-700","text-slate-400","rounded-lg","text-xs","transition-colors","flex","items-center","justify-center","gap-1.5","disabled:opacity-50",3,"click","disabled"],[1,"mt-3","p-3","bg-slate-800/50","rounded-lg"],[1,"mt-3","p-2","bg-slate-800/30","rounded-lg"],[1,"mt-3","p-3","bg-amber-500/10","rounded-lg","border","border-amber-500/20"],[1,"space-y-2"],[1,"text-sm","text-slate-500","text-center","py-2"],[1,"mt-3","pt-3","border-t","border-slate-600/50"],[1,"p-4","bg-emerald-500/10","rounded-xl","border","border-emerald-500/30"],[1,"p-4","bg-emerald-500/20","rounded-xl","border","border-emerald-500/30"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold"],[1,"flex-1"],[1,"text-sm","text-white","font-medium"],[1,"flex","gap-1"],[1,"px-2","py-1","bg-blue-500/20","text-blue-400","rounded","text-xs"],[1,"px-2","py-1","bg-green-500/20","text-green-400","rounded","text-xs"],[1,"flex-1","px-3","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-xs","transition-colors","flex","items-center","justify-center","gap-1.5",3,"click"],[1,"text-xs","text-slate-400","flex","items-start","gap-2"],[1,"text-amber-400"],[1,"text-[10px]","text-slate-500","text-center"],[1,"text-xs","text-amber-400","flex","items-center","gap-2"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/30","rounded-lg"],[1,"text-sm","text-white"],[1,"px-2","py-1","hover:bg-red-500/20","rounded","text-red-400","text-xs","transition-colors",3,"click"],[1,"text-xs","text-slate-500","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1.5","bg-purple-500/10","hover:bg-purple-500/20","text-purple-400","rounded-lg","text-xs","transition-colors"],[1,"px-3","py-1.5","bg-purple-500/10","hover:bg-purple-500/20","text-purple-400","rounded-lg","text-xs","transition-colors",3,"click"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-emerald-400","flex","items-center","gap-2"],[1,"animate-pulse"],[1,"w-full","bg-slate-700","rounded-full","h-2","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-teal-500","rounded-full","transition-all","duration-300"],[1,"text-xs","text-slate-500","mt-2"],[1,"flex","items-center","justify-between"],[1,"text-emerald-300","font-medium","text-lg"],[1,"flex","items-center","gap-3","mt-2","text-sm"],[1,"text-slate-400"],[1,"grid","grid-cols-2","gap-3"],[1,"px-4","py-3","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"px-4","py-3","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"px-4","py-3","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"animate-spin"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),o(5,"\u{1F465}"),i()(),n(6,"div")(7,"h1",5),o(8,"\u76E3\u63A7\u7FA4\u7D44\u7BA1\u7406"),i(),n(9,"p",6),o(10,"\u7BA1\u7406\u6B63\u5728\u76E3\u63A7\u7684 Telegram \u7FA4\u7D44"),i()()(),n(11,"div",2)(12,"app-config-progress",7),p("action",function(u){return r.handleConfigAction(u)}),i(),n(13,"button",8),p("click",function(){return r.refreshAllMemberCounts()}),n(14,"span"),o(15,"\u{1F465}"),i(),n(16,"span"),o(17),i()(),n(18,"button",9),p("click",function(){return r.refreshData()}),n(19,"span"),o(20,"\u{1F504}"),i(),n(21,"span"),o(22,"\u5237\u65B0"),i()()()(),n(23,"div",10)(24,"div",11)(25,"div",2)(26,"div",12)(27,"span",4),o(28,"\u{1F4AC}"),i()(),n(29,"div")(30,"div",13),o(31),i(),n(32,"div",14),o(33,"\u76E3\u63A7\u7FA4\u7D44"),i()()()(),n(34,"div",15)(35,"div",2)(36,"div",16)(37,"span",4),o(38,"\u{1F465}"),i()(),n(39,"div")(40,"div",17),o(41),$(42,"number"),i(),n(43,"div",14),o(44,"\u7E3D\u6210\u54E1"),i()()()(),n(45,"div",18)(46,"div",2)(47,"div",19)(48,"span",4),o(49,"\u{1F525}"),i()(),n(50,"div")(51,"div",20),o(52),i(),n(53,"div",14),o(54,"\u4ECA\u65E5\u5339\u914D"),i()()()(),n(55,"div",21)(56,"div",2)(57,"div",22)(58,"span",4),o(59,"\u{1F517}"),i()(),n(60,"div")(61,"div",23),o(62),i(),n(63,"div",14),o(64,"\u5DF2\u7D81\u5B9A\u8A5E\u96C6"),i()()()()(),n(65,"div",24)(66,"div",25)(67,"div",26)(68,"h3",27)(69,"span"),o(70,"\u{1F465}"),i(),o(71," \u76E3\u63A7\u7FA4\u7D44 "),n(72,"span",28),o(73),i()(),n(74,"button",29),p("click",function(){return r.navigateToResourceCenter()}),o(75," + \u6DFB\u52A0\u7FA4\u7D44 "),i()(),n(76,"div",30)(77,"div",31),T(78,St,26,29,"div",32,ze,!1,Et,10,0,"div",33),i()()()()(),x(81,Ot,13,2,"div",34),n(82,"app-history-collection-dialog",35),p("closeDialog",function(){return r.closeHistoryCollectionDialog()})("collectionComplete",function(u){return r.onHistoryCollectionComplete(u)})("viewUsersEvent",function(){return r.viewCollectedUsers()}),i()),e&2&&(s(13),k("disabled",r.isRefreshingMemberCounts()),s(),S("animate-spin",r.isRefreshingMemberCounts()),s(3),C(r.isRefreshingMemberCounts()?"\u5237\u65B0\u4E2D...":"\u5237\u65B0\u6210\u54E1\u6578"),s(2),S("animate-spin",r.stateService.isLoading()),s(12),C(r.stateService.groups().length),s(10),C(X(42,15,r.stateService.totalMembers())),s(11),C(r.stateService.todayMatches()),s(10),C(r.stateService.groupsWithKeywords().length),s(11),v("(",r.stateService.groups().length,")"),s(5),A(r.stateService.groups()),s(3),_(r.showDetailDialog()?81:-1),s(),k("isOpen",r.showHistoryCollectionDialog())("group",r.historyCollectionGroup()))},dependencies:[K,W,ne,Ce,fe],encapsulation:2})}};var he=(a,t)=>t.id;function Ht(a,t){if(a&1&&(n(0,"span",28),o(1),i()),a&2){let e=d();s(),v(" \u{1F525} \u7E3D\u5339\u914D ",e.stateService.totalKeywordMatches()," ")}}function $t(a,t){if(a&1&&(n(0,"div",40)(1,"span"),o(2,"\u{1F511}"),i(),n(3,"span"),o(4),i(),n(5,"span",41),o(6),i()()),a&2){let e=t.$implicit;S("bg-purple-500/20",e.isActive)("text-purple-400",e.isActive)("border-purple-500/30",e.isActive)("bg-slate-700/50",!e.isActive)("text-slate-400",!e.isActive)("border-slate-600/30",!e.isActive),s(4),C(e.name),s(2),v("(",e.keywords.length,")")}}function zt(a,t){if(a&1&&(n(0,"div",30)(1,"div",36)(2,"span",14),o(3,"\u{1F3AF} \u62D6\u62FD\u7D81\u5B9A\uFF1A"),i(),n(4,"span",37),o(5,"\u{1F4A1} \u62D6\u62FD\u8A5E\u96C6\u5230\u7FA4\u7D44\u53EF\u5FEB\u901F\u7D81\u5B9A"),i()(),n(6,"div",38),T(7,$t,7,14,"div",39,he),i()()),a&2){let e=d();s(7),A(e.stateService.keywordSets())}}function qt(a,t){if(a&1&&(n(0,"span",47),o(1),i()),a&2){let e=d().$implicit;s(),v(" \u{1F525} ",e.totalMatches," ")}}function Qt(a,t){if(a&1&&(n(0,"span",49),o(1),i()),a&2){let e=t.$implicit;s(),v(" ",e.text," ")}}function Jt(a,t){if(a&1&&(n(0,"span",50),o(1),i()),a&2){let e=d().$implicit;s(),v(" +",e.keywords.length-3," ")}}function Xt(a,t){if(a&1){let e=y();n(0,"div",42),p("click",function(){let l=c(e).$implicit,u=d();return m(u.selectSet(l))}),n(1,"div",43),o(2),i(),n(3,"div",44)(4,"div",45)(5,"span",46),o(6),i(),x(7,qt,2,1,"span",47),i(),n(8,"div",48),T(9,Qt,2,1,"span",49,he),x(11,Jt,2,1,"span",50),i()(),n(12,"div",51)(13,"label",52),p("click",function(l){return c(e),m(l.stopPropagation())}),n(14,"input",53),p("change",function(){let l=c(e).$implicit,u=d();return m(u.toggleSetActive(l))}),i(),n(15,"div",54),F(16,"div",55),i()(),Y(),n(17,"svg",56),F(18,"path",57),i()()()}if(a&2){let e,r,l=t.$implicit,u=d();S("border-cyan-500/50",((e=u.selectedSet())==null?null:e.id)===l.id)("bg-slate-700",((r=u.selectedSet())==null?null:r.id)===l.id),s(),S("bg-orange-500/20",l.isActive)("text-orange-400",l.isActive)("bg-slate-600",!l.isActive)("text-slate-500",!l.isActive),s(),v(" ",l.name.substring(0,3)," "),s(4),C(l.name),s(),_(l.totalMatches&&l.totalMatches>0?7:-1),s(2),A(l.keywords.slice(0,3)),s(2),_(l.keywords.length>3?11:-1),s(3),k("checked",l.isActive),s(),S("bg-emerald-500",l.isActive)("bg-slate-600",!l.isActive),s(),S("left-4",l.isActive)("left-0",!l.isActive)}}function Yt(a,t){a&1&&F(0,"span",62)}function Zt(a,t){if(a&1){let e=y();n(0,"button",83),p("click",function(){c(e);let l=d(2);return m(l.clearAllKeywords())}),o(1," \u6E05\u7A7A\u5168\u90E8 "),i()}}function ei(a,t){a&1&&(n(0,"div",77)(1,"p"),o(2,"\u9084\u6C92\u6709\u95DC\u9375\u8A5E"),i()())}function ti(a,t){a&1&&(n(0,"span",87),o(1,"\u65B0"),i())}function ii(a,t){if(a&1){let e=y();n(0,"div",84)(1,"div",85)(2,"span",86),o(3),i(),x(4,ti,2,0,"span",87),i(),n(5,"button",88),p("click",function(){let l=c(e).$implicit,u=d(3);return m(u.removeKeyword(l))}),o(6," \u2715 "),i()()}if(a&2){let e=t.$implicit;s(3),C(e.text),s(),_(e.isNew?4:-1)}}function ni(a,t){if(a&1&&(n(0,"div",78),T(1,ii,7,2,"div",84,he),i()),a&2){let e=d(2);s(),A(e.editingSet.keywords)}}function oi(a,t){a&1&&(F(0,"span",89),n(1,"span"),o(2,"\u4FDD\u5B58\u4E2D..."),i())}function ri(a,t){if(a&1&&(n(0,"span"),o(1),i()),a&2){let e=d(2);s(),C(e.isCreating()?"\u5275\u5EFA":"\u4FDD\u5B58")}}function li(a,t){if(a&1){let e=y();n(0,"button",90),p("click",function(){c(e);let l=d(2);return m(l.deleteSet())}),o(1," \u522A\u9664 "),i()}if(a&2){let e=d(2);k("disabled",e.isSaving())}}function ai(a,t){if(a&1){let e=y();n(0,"div",58),p("click",function(){c(e);let l=d();return m(l.closeEditor())}),n(1,"div",59),p("click",function(l){return c(e),m(l.stopPropagation())}),n(2,"div",60)(3,"h3",61),o(4),x(5,Yt,1,0,"span",62),i(),n(6,"button",63),p("click",function(){c(e);let l=d();return m(l.closeEditor())}),o(7," \u2715 "),i()(),n(8,"div",64)(9,"div")(10,"label",65),o(11,"\u8A5E\u96C6\u540D\u7A31"),i(),n(12,"input",66),V("ngModelChange",function(l){c(e);let u=d();return I(u.editingSet.name,l)||(u.editingSet.name=l),m(l)}),p("ngModelChange",function(){c(e);let l=d();return m(l.markAsChanged())}),i()(),n(13,"div")(14,"label",65),o(15,"\u5339\u914D\u6A21\u5F0F"),i(),n(16,"select",67),V("ngModelChange",function(l){c(e);let u=d();return I(u.editingSet.matchMode,l)||(u.editingSet.matchMode=l),m(l)}),p("ngModelChange",function(){c(e);let l=d();return m(l.markAsChanged())}),n(17,"option",68),o(18,"\u6A21\u7CCA\u5339\u914D"),i(),n(19,"option",69),o(20,"\u7CBE\u78BA\u5339\u914D"),i(),n(21,"option",70),o(22,"\u6B63\u5247\u8868\u9054\u5F0F"),i()()(),n(23,"div")(24,"label",65),o(25,"\u6DFB\u52A0\u95DC\u9375\u8A5E"),i(),n(26,"div",71)(27,"input",72),V("ngModelChange",function(l){c(e);let u=d();return I(u.newKeyword,l)||(u.newKeyword=l),m(l)}),p("keyup.enter",function(){c(e);let l=d();return m(l.addKeyword())}),i(),n(28,"button",73),p("click",function(){c(e);let l=d();return m(l.addKeyword())}),o(29," + \u6DFB\u52A0 "),i()()(),n(30,"div")(31,"div",74)(32,"span",75),o(33),i(),x(34,Zt,2,0,"button",76),i(),x(35,ei,3,0,"div",77)(36,ni,3,0,"div",78),i()(),n(37,"div",79)(38,"button",80),p("click",function(){c(e);let l=d();return m(l.saveSet())}),x(39,oi,3,0)(40,ri,2,1,"span"),i(),x(41,li,2,1,"button",81),n(42,"button",82),p("click",function(){c(e);let l=d();return m(l.closeEditor())}),o(43," \u53D6\u6D88 "),i()()()()}if(a&2){let e=d();s(4),v(" ",e.isCreating()?"\u65B0\u5EFA\u95DC\u9375\u8A5E\u96C6":"\u7DE8\u8F2F\u95DC\u9375\u8A5E\u96C6"," "),s(),_(e.hasUnsavedChanges()?5:-1),s(7),M("ngModel",e.editingSet.name),s(4),M("ngModel",e.editingSet.matchMode),s(11),M("ngModel",e.newKeyword),s(),k("disabled",!e.newKeyword.trim()),s(5),v(" \u95DC\u9375\u8A5E\u5217\u8868 (",e.editingSet.keywords.length,") "),s(),_(e.editingSet.keywords.length>0?34:-1),s(),_(e.editingSet.keywords.length===0?35:36),s(3),k("disabled",e.isSaving()),s(),_(e.isSaving()?39:40),s(2),_(e.isCreating()?-1:41),s(),k("disabled",e.isSaving())}}var be=class a{constructor(){this.stateService=D(z);this.ipcService=D(O);this.toastService=D(H);this.confirmDialog=D(q);this.configAction=J();this.selectedSet=w(null);this.isEditing=w(!1);this.isCreating=w(!1);this.isSaving=w(!1);this.hasUnsavedChanges=w(!1);this.editingSet=this.createEmptySet();this.originalSet=null;this.newKeyword="";this.listeners=[]}ngOnInit(){this.stateService.loadAll(),this.setupListeners()}ngOnDestroy(){this.listeners.forEach(t=>t())}setupListeners(){let t=this.ipcService.on("save-keyword-set-result",r=>{this.isSaving.set(!1),r.success?(this.toastService.success(this.isCreating()?"\u2705 \u8A5E\u96C6\u5275\u5EFA\u6210\u529F":"\u2705 \u8A5E\u96C6\u4FDD\u5B58\u6210\u529F"),this.hasUnsavedChanges.set(!1),this.stateService.refresh(),this.isEditing.set(!1),this.newKeyword=""):this.toastService.error(`\u274C \u4FDD\u5B58\u5931\u6557: ${r.error||"\u672A\u77E5\u932F\u8AA4"}`)});this.listeners.push(t);let e=this.ipcService.on("delete-keyword-set-result",r=>{r.success?(this.toastService.success("\u{1F5D1}\uFE0F \u8A5E\u96C6\u5DF2\u522A\u9664"),this.selectedSet.set(null),this.hasUnsavedChanges.set(!1),this.stateService.refresh(),this.isEditing.set(!1),this.newKeyword=""):this.toastService.error(`\u274C \u522A\u9664\u5931\u6557: ${r.error||"\u672A\u77E5\u932F\u8AA4"}`)});this.listeners.push(e)}refreshData(){this.stateService.refresh(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u95DC\u9375\u8A5E\u96C6...")}handleConfigAction(t){this.configAction.emit(t)}createEmptySet(){return{id:"",name:"",keywords:[],matchMode:"fuzzy",isActive:!0,totalMatches:0}}selectSet(t){this.selectedSet.set(t),this.editingSet=P(R({},t),{keywords:[...t.keywords]}),this.originalSet=JSON.parse(JSON.stringify(t)),this.isCreating.set(!1),this.isEditing.set(!0),this.hasUnsavedChanges.set(!1)}createNewSet(){this.selectedSet.set(null),this.editingSet=this.createEmptySet(),this.originalSet=null,this.isCreating.set(!0),this.isEditing.set(!0),this.hasUnsavedChanges.set(!1)}async closeEditor(){this.hasUnsavedChanges()&&!await this.confirmDialog.warning("\u672A\u4FDD\u5B58\u7684\u8B8A\u66F4","\u60A8\u6709\u672A\u4FDD\u5B58\u7684\u8B8A\u66F4\uFF0C\u78BA\u5B9A\u8981\u95DC\u9589\u55CE\uFF1F")||(this.isEditing.set(!1),this.newKeyword="",this.hasUnsavedChanges.set(!1))}markAsChanged(){this.hasUnsavedChanges.set(!0)}toggleSetActive(t){let e=!t.isActive;this.ipcService.send("save-keyword-set",{id:parseInt(t.id),name:t.name,keywords:t.keywords.map(r=>({text:r.text})),isActive:e,matchMode:t.matchMode}),this.toastService.success(e?`\u2705 \u5DF2\u555F\u7528 ${t.name}`:`\u23F8\uFE0F \u5DF2\u505C\u7528 ${t.name}`)}addKeyword(){let t=this.newKeyword.trim();if(t){if(this.editingSet.keywords.some(e=>e.text===t)){this.toastService.error("\u95DC\u9375\u8A5E\u5DF2\u5B58\u5728");return}this.editingSet.keywords=[...this.editingSet.keywords,{id:`new-${Date.now()}`,text:t,matchCount:0,isNew:!0}],this.newKeyword="",this.markAsChanged()}}removeKeyword(t){this.editingSet.keywords=this.editingSet.keywords.filter(e=>e.id!==t.id),this.markAsChanged()}async clearAllKeywords(){await this.confirmDialog.warning("\u6E05\u7A7A\u95DC\u9375\u8A5E","\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u95DC\u9375\u8A5E\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002")&&(this.editingSet.keywords=[],this.markAsChanged())}saveSet(){if(console.log("[KeywordSets] saveSet called, isCreating:",this.isCreating()),console.log("[KeywordSets] editingSet:",this.editingSet),!this.editingSet.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u8A5E\u96C6\u540D\u7A31");return}if(this.isSaving())return;let t={id:this.isCreating()?null:parseInt(this.editingSet.id),name:this.editingSet.name.trim(),keywords:this.editingSet.keywords.map(e=>({text:e.text})),isActive:this.editingSet.isActive,matchMode:this.editingSet.matchMode};console.log("[KeywordSets] Sending save-keyword-set:",t),this.isSaving.set(!0),this.ipcService.send("save-keyword-set",t),this.toastService.info("\u23F3 \u6B63\u5728\u4FDD\u5B58...")}async deleteSet(){if(!this.selectedSet())return;let t=this.selectedSet();await this.confirmDialog.danger("\u522A\u9664\u95DC\u9375\u8A5E\u96C6",`\u78BA\u5B9A\u8981\u522A\u9664\u8A5E\u96C6\u300C${t.name}\u300D\u55CE\uFF1F
\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,[`${t.name} (${t.keywords.length} \u500B\u95DC\u9375\u8A5E)`])&&this.ipcService.send("delete-keyword-set",{id:parseInt(t.id)})}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-keyword-sets"]],outputs:{configAction:"configAction"},decls:82,vars:10,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-purple-500","to-pink-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-purple-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-purple-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-cyan-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-cyan-400"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"w-10","h-10","bg-orange-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-orange-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"flex-1","overflow-hidden"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","h-full","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"px-2","py-0.5","bg-red-500/20","text-red-400","text-xs","rounded-full"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"px-4","pt-3","pb-2","border-b","border-slate-700/30"],[1,"flex-1","overflow-y-auto","p-4"],[1,"grid","grid-cols-1","md:grid-cols-2","xl:grid-cols-3","gap-4"],[1,"flex","items-start","gap-3","p-4","bg-slate-700/50","rounded-xl","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"border-cyan-500/50","bg-slate-700"],[1,"flex","items-center","justify-center","gap-2","p-6","bg-slate-700/30","hover:bg-slate-700/50","border-2","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","transition-all","min-h-[100px]",3,"click"],[1,"fixed","inset-0","bg-black/50","z-50","flex","justify-end"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-xs","text-slate-400"],[1,"flex","flex-wrap","gap-2"],["draggable","true",1,"px-3","py-1.5","rounded-lg","text-sm","cursor-grab","active:cursor-grabbing","transition-all","flex","items-center","gap-2",2,"border-width","1px",3,"bg-purple-500/20","text-purple-400","border-purple-500/30","bg-slate-700/50","text-slate-400","border-slate-600/30"],["draggable","true",1,"px-3","py-1.5","rounded-lg","text-sm","cursor-grab","active:cursor-grabbing","transition-all","flex","items-center","gap-2",2,"border-width","1px"],[1,"text-xs","opacity-70"],[1,"flex","items-start","gap-3","p-4","bg-slate-700/50","rounded-xl","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"click"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center","font-bold","shrink-0"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-1"],[1,"font-medium","text-white","truncate"],[1,"px-1.5","py-0.5","bg-red-500/20","text-red-400","text-xs","rounded-full","shrink-0"],[1,"flex","flex-wrap","gap-1"],[1,"px-1.5","py-0.5","bg-slate-600","text-slate-300","text-xs","rounded"],[1,"px-1.5","py-0.5","bg-slate-600/50","text-slate-400","text-xs","rounded"],[1,"flex","items-center","gap-2","shrink-0"],[1,"relative","inline-flex","cursor-pointer",3,"click"],["type","checkbox",1,"sr-only",3,"change","checked"],[1,"w-9","h-5","rounded-full","transition-all"],[1,"absolute","w-4","h-4","bg-white","rounded-full","top-0.5","transition-all"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500","group-hover:text-cyan-400","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"fixed","inset-0","bg-black/50","z-50","flex","justify-end",3,"click"],[1,"w-[500px]","bg-slate-900","h-full","flex","flex-col",3,"click"],[1,"p-4","border-b","border-slate-700","flex","items-center","justify-between"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],["title","\u6709\u672A\u4FDD\u5B58\u7684\u8B8A\u66F4",1,"w-2","h-2","bg-orange-500","rounded-full"],[1,"p-2","hover:bg-slate-700","rounded-lg","text-slate-400",3,"click"],[1,"flex-1","overflow-y-auto","p-4","space-y-4"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u652F\u4ED8\u76F8\u95DC",1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:border-purple-500",3,"ngModelChange","ngModel"],["value","fuzzy"],["value","exact"],["value","regex"],[1,"flex","gap-2"],["type","text","placeholder","\u8F38\u5165\u95DC\u9375\u8A5E\uFF0C\u6309 Enter \u6DFB\u52A0",1,"flex-1","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","focus:border-purple-500",3,"ngModelChange","keyup.enter","ngModel"],[1,"px-4","py-2.5","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-slate-300"],[1,"text-xs","text-red-400","hover:underline"],[1,"p-6","text-center","text-slate-500","bg-slate-800/30","rounded-xl","border","border-dashed","border-slate-700"],[1,"space-y-2","max-h-64","overflow-y-auto"],[1,"p-4","border-t","border-slate-700","flex","items-center","gap-3"],[1,"flex-1","px-4","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","hover:from-purple-600","hover:to-pink-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"px-4","py-2.5","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors","disabled:opacity-50",3,"disabled"],[1,"px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-xs","text-red-400","hover:underline",3,"click"],[1,"flex","items-center","justify-between","p-3","bg-slate-800/50","rounded-lg","border","border-slate-700/50","group","hover:border-purple-500/30"],[1,"flex","items-center","gap-2"],[1,"text-white"],[1,"text-xs","bg-emerald-500/20","text-emerald-400","px-2","py-0.5","rounded"],[1,"opacity-0","group-hover:opacity-100","p-1","hover:bg-red-500/20","rounded","text-red-400","transition-all",3,"click"],[1,"w-4","h-4","border-2","border-white/30","border-t-white","rounded-full","animate-spin"],[1,"px-4","py-2.5","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),o(5,"\u{1F511}"),i()(),n(6,"div")(7,"h1",5),o(8,"\u95DC\u9375\u8A5E\u96C6\u7BA1\u7406"),i(),n(9,"p",6),o(10,"\u7BA1\u7406\u7528\u65BC\u76E3\u63A7\u5339\u914D\u7684\u95DC\u9375\u8A5E\u96C6"),i()()(),n(11,"div",2)(12,"app-config-progress",7),p("action",function(u){return r.handleConfigAction(u)}),i(),n(13,"button",8),p("click",function(){return r.refreshData()}),n(14,"span"),o(15,"\u{1F504}"),i(),n(16,"span"),o(17,"\u5237\u65B0"),i()()()(),n(18,"div",9)(19,"div",10)(20,"div",2)(21,"div",11)(22,"span",12),o(23,"\u{1F511}"),i()(),n(24,"div")(25,"div",13),o(26),i(),n(27,"div",14),o(28,"\u8A5E\u96C6\u6578"),i()()()(),n(29,"div",10)(30,"div",2)(31,"div",15)(32,"span",16),o(33,"\u{1F524}"),i()(),n(34,"div")(35,"div",17),o(36),i(),n(37,"div",14),o(38,"\u7E3D\u95DC\u9375\u8A5E"),i()()()(),n(39,"div",10)(40,"div",2)(41,"div",18)(42,"span",19),o(43,"\u{1F525}"),i()(),n(44,"div")(45,"div",20),o(46),i(),n(47,"div",14),o(48,"\u7E3D\u5339\u914D"),i()()()(),n(49,"div",10)(50,"div",2)(51,"div",21)(52,"span",22),o(53,"\u2713"),i()(),n(54,"div")(55,"div",23),o(56),i(),n(57,"div",14),o(58,"\u5DF2\u555F\u7528"),i()()()()(),n(59,"div",24)(60,"div",25)(61,"div",26)(62,"h3",27)(63,"span"),o(64,"\u{1F511}"),i(),o(65," \u95DC\u9375\u8A5E\u96C6 "),n(66,"span",14),o(67),i(),x(68,Ht,2,1,"span",28),i(),n(69,"button",29),p("click",function(){return r.createNewSet()}),o(70," + \u65B0\u5EFA\u8A5E\u96C6 "),i()(),x(71,zt,9,0,"div",30),n(72,"div",31)(73,"div",32),T(74,Xt,19,25,"div",33,he),n(76,"button",34),p("click",function(){return r.createNewSet()}),n(77,"span",4),o(78,"+"),i(),n(79,"span"),o(80,"\u65B0\u5EFA\u8A5E\u96C6"),i()()()()()(),x(81,ai,44,13,"div",35),i()),e&2&&(s(14),S("animate-spin",r.stateService.isLoading()),s(12),C(r.stateService.keywordSets().length),s(10),C(r.stateService.totalKeywords()),s(10),C(r.stateService.totalKeywordMatches()),s(10),C(r.stateService.activeKeywordSets().length),s(11),v("(",r.stateService.keywordSets().length,")"),s(),_(r.stateService.totalKeywordMatches()>0?68:-1),s(3),_(r.stateService.keywordSets().length>0?71:-1),s(3),A(r.stateService.keywordSets()),s(7),_(r.isEditing()?81:-1))},dependencies:[K,W,ce,me,ee,ue,te,ie,ne],encapsulation:2})}};var si=()=>[1,2,3,4],Ee=(a,t)=>t.id;function di(a,t){if(a&1&&(n(0,"div",25)(1,"div",39)(2,"span",4),o(3,"\u{1F916}"),i(),n(4,"div",40)(5,"p",41),o(6),i(),n(7,"p",42),o(8," \u672A\u5339\u914D\u7279\u5B9A\u898F\u5247\u7684\u95DC\u9375\u8A5E\u5C07\u4F7F\u7528 AI \u81EA\u52D5\u56DE\u8986\u3002 \u5982\u9700\u91DD\u5C0D\u7279\u5B9A\u95DC\u9375\u8A5E\u4F7F\u7528\u4E0D\u540C\u97FF\u61C9\u65B9\u5F0F\uFF0C\u8ACB\u5275\u5EFA\u89F8\u767C\u898F\u5247\u3002 "),i()()()()),a&2){let e=d();s(6),v("AI \u81EA\u52D5\u804A\u5929\u5DF2\u555F\u7528\uFF08",e.aiChatMode()==="full"?"\u5168\u81EA\u52D5":"\u534A\u81EA\u52D5","\u6A21\u5F0F\uFF09")}}function ui(a,t){a&1&&(n(0,"span",49),o(1,"\u6D3B\u8E8D"),i())}function ci(a,t){a&1&&(n(0,"span",50),o(1,"\u5DF2\u505C\u7528"),i())}function mi(a,t){if(a&1){let e=y();n(0,"div",44)(1,"div",45)(2,"div",2)(3,"div",46)(4,"span",47),o(5),i()(),n(6,"div")(7,"div",30)(8,"span",48),o(9),i(),x(10,ui,2,0,"span",49)(11,ci,2,0,"span",50),n(12,"span",51),o(13),i()(),n(14,"p",52),o(15),i()()(),n(16,"div",30)(17,"button",53),p("click",function(){let l=c(e).$implicit,u=d(2);return m(u.openTestDialog(l))}),o(18," \u{1F9EA} \u6E2C\u8A66 "),i(),n(19,"button",54),p("click",function(){let l=c(e).$implicit,u=d(2);return m(u.editRule(l))}),o(20," \u7DE8\u8F2F "),i(),n(21,"button",55),p("click",function(){let l=c(e).$implicit,u=d(2);return m(u.toggleRule(l))}),o(22),i(),n(23,"button",56),p("click",function(){let l=c(e).$implicit,u=d(2);return m(u.deleteRule(l))}),o(24," \u522A\u9664 "),i()()(),n(25,"div",57)(26,"div",58)(27,"div",59)(28,"div",60),o(29,"\u76E3\u63A7\u4F86\u6E90"),i(),n(30,"div",61),o(31),i()(),n(32,"div",62),o(33,"\u2192"),i(),n(34,"div",59)(35,"div",60),o(36,"\u95DC\u9375\u8A5E\u96C6"),i(),n(37,"div",61),o(38),i()(),n(39,"div",62),o(40,"\u2192"),i(),n(41,"div",59)(42,"div",60),o(43,"\u97FF\u61C9\u65B9\u5F0F"),i(),n(44,"div",61),o(45),i()()(),n(46,"div",63)(47,"div",64)(48,"span"),o(49),i(),n(50,"span"),o(51),i(),n(52,"span"),o(53),i()(),n(54,"span"),o(55),i()()()()}if(a&2){let e=t.$implicit,r=d(2);S("border-slate-600/50",e.isActive)("border-slate-700/50",!e.isActive)("opacity-60",!e.isActive),s(3),S("bg-emerald-500/20",e.isActive)("bg-slate-600/50",!e.isActive),s(2),C(r.getResponseIcon(e.responseType)),s(4),C(e.name),s(),_(e.isActive?10:11),s(2),S("bg-red-500/20",e.priority===3)("text-red-400",e.priority===3)("bg-amber-500/20",e.priority===2)("text-amber-400",e.priority===2)("bg-slate-500/20",e.priority===1)("text-slate-400",e.priority===1),s(),v(" ",r.getPriorityLabel(e.priority)," "),s(2),C(e.description||"\u7121\u63CF\u8FF0"),s(6),S("bg-amber-500/20",e.isActive)("text-amber-400",e.isActive)("hover:bg-amber-500/30",e.isActive)("bg-emerald-500/20",!e.isActive)("text-emerald-400",!e.isActive)("hover:bg-emerald-500/30",!e.isActive),s(),v(" ",e.isActive?"\u66AB\u505C":"\u555F\u7528"," "),s(9),v(" ",e.sourceType==="all"?"\u5168\u90E8\u7FA4\u7D44":e.sourceGroupIds.length+" \u500B\u7FA4\u7D44"," "),s(7),v(" ",r.getKeywordSetNames(e.keywordSetIds)," "),s(7),v(" ",r.getResponseDetail(e)," "),s(4),v("\u89F8\u767C: ",e.triggerCount||0," \u6B21"),s(2),v("\u6210\u529F: ",e.successCount||0," \u6B21"),s(2),v("\u6210\u529F\u7387: ",r.getSuccessRate(e),"%"),s(2),C(e.lastTriggered?"\u6700\u8FD1: "+r.formatTime(e.lastTriggered):"\u5C1A\u672A\u89F8\u767C")}}function pi(a,t){if(a&1&&(n(0,"div",36),T(1,mi,56,47,"div",43,Ee),i()),a&2){let e=d();s(),A(e.filteredRules())}}function gi(a,t){a&1&&(n(0,"p",69),o(1," \u{1F4A1} AI \u81EA\u52D5\u804A\u5929\u5DF2\u958B\u555F\uFF0C\u5C07\u4F5C\u70BA\u9ED8\u8A8D\u97FF\u61C9\u65B9\u5F0F "),i())}function xi(a,t){if(a&1){let e=y();n(0,"div",37)(1,"div",65)(2,"span",66),o(3,"\u26A1"),i()(),n(4,"h3",67),o(5,"\u9084\u6C92\u6709\u89F8\u767C\u898F\u5247"),i(),n(6,"p",68),o(7," \u89F8\u767C\u898F\u5247\u5B9A\u7FA9\u4E86\u7576\u95DC\u9375\u8A5E\u5339\u914D\u5F8C\u7CFB\u7D71\u7684\u97FF\u61C9\u65B9\u5F0F\u3002"),F(8,"br"),o(9," \u60A8\u53EF\u4EE5\u70BA\u4E0D\u540C\u7684\u95DC\u9375\u8A5E\u8A2D\u7F6E\u4E0D\u540C\u7684\u97FF\u61C9\u52D5\u4F5C\u3002 "),i(),x(10,gi,2,0,"p",69),n(11,"button",70),p("click",function(){c(e);let l=d();return m(l.openCreateWizard())}),n(12,"span"),o(13,"\u{1F680}"),i(),o(14," \u5275\u5EFA\u7B2C\u4E00\u500B\u898F\u5247 "),i()()}if(a&2){let e=d();s(10),_(e.aiChatEnabled()?10:-1)}}function _i(a,t){if(a&1&&F(0,"div",91),a&2){let e=d().$implicit,r=d(2);S("bg-amber-500",r.wizardStep()>e)("bg-slate-700",r.wizardStep()<=e)}}function fi(a,t){if(a&1&&(n(0,"div",81)(1,"div",89),o(2),i(),x(3,_i,1,4,"div",90),i()),a&2){let e=t.$implicit,r=d(2);s(),S("bg-amber-500",r.wizardStep()>=e)("text-white",r.wizardStep()>=e)("bg-slate-700",r.wizardStep()<e)("text-slate-400",r.wizardStep()<e),s(),v(" ",e," "),s(),_(e<4?3:-1)}}function Ci(a,t){if(a&1){let e=y();n(0,"div",36)(1,"div")(2,"label",92),o(3,"\u898F\u5247\u540D\u7A31 *"),i(),n(4,"input",93),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.name,l)||(u.formData.name=l),m(l)}),i()(),n(5,"div")(6,"label",92),o(7,"\u898F\u5247\u63CF\u8FF0"),i(),n(8,"textarea",94),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.description,l)||(u.formData.description=l),m(l)}),i()(),n(9,"div")(10,"label",92),o(11,"\u512A\u5148\u7D1A"),i(),n(12,"div",85)(13,"button",95),p("click",function(){c(e);let l=d(2);return m(l.formData.priority=3)}),o(14," \u9AD8\u512A\u5148 "),i(),n(15,"button",95),p("click",function(){c(e);let l=d(2);return m(l.formData.priority=2)}),o(16," \u4E2D\u512A\u5148 "),i(),n(17,"button",95),p("click",function(){c(e);let l=d(2);return m(l.formData.priority=1)}),o(18," \u4F4E\u512A\u5148 "),i()()()()}if(a&2){let e=d(2);s(4),M("ngModel",e.formData.name),s(4),M("ngModel",e.formData.description),s(5),S("bg-red-500/20",e.formData.priority===3)("border-red-500/50",e.formData.priority===3)("text-red-400",e.formData.priority===3)("bg-slate-700",e.formData.priority!==3)("border-slate-600",e.formData.priority!==3)("text-slate-300",e.formData.priority!==3),s(2),S("bg-amber-500/20",e.formData.priority===2)("border-amber-500/50",e.formData.priority===2)("text-amber-400",e.formData.priority===2)("bg-slate-700",e.formData.priority!==2)("border-slate-600",e.formData.priority!==2)("text-slate-300",e.formData.priority!==2),s(2),S("bg-slate-500/20",e.formData.priority===1)("border-slate-500/50",e.formData.priority===1)("text-slate-400",e.formData.priority===1)("bg-slate-700",e.formData.priority!==1)("border-slate-600",e.formData.priority!==1)("text-slate-300",e.formData.priority!==1)}}function vi(a,t){if(a&1){let e=y();n(0,"label",103)(1,"input",107),p("change",function(){let l=c(e).$implicit,u=d(4);return m(u.toggleGroupSelection(l.id))}),i(),n(2,"span",106),o(3),i()()}if(a&2){let e=t.$implicit,r=d(4);s(),k("checked",r.isGroupSelected(e.id)),s(2),C(e.name)}}function bi(a,t){if(a&1&&(n(0,"div",101),T(1,vi,4,2,"label",103,Ee),i()),a&2){let e=d(3);s(),A(e.stateService.groups())}}function hi(a,t){if(a&1){let e=y();n(0,"label",103)(1,"input",107),p("change",function(){let l=c(e).$implicit,u=d(3);return m(u.toggleKeywordSetSelection(l.id))}),i(),n(2,"span",106),o(3),i(),n(4,"span",108),o(5),i()()}if(a&2){let e=t.$implicit,r=d(3);s(),k("checked",r.isKeywordSetSelected(e.id)),s(2),C(e.name),s(2),v("(",(e.keywords==null?null:e.keywords.length)||0," \u500B\u95DC\u9375\u8A5E)")}}function Si(a,t){a&1&&(n(0,"p",104),o(1," \u66AB\u7121\u95DC\u9375\u8A5E\u96C6\uFF0C\u8ACB\u5148\u5275\u5EFA "),i())}function Ei(a,t){if(a&1){let e=y();n(0,"div",36)(1,"div")(2,"label",92),o(3,"\u76E3\u63A7\u4F86\u6E90"),i(),n(4,"div",96)(5,"label",97)(6,"input",98),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.sourceType,l)||(u.formData.sourceType=l),m(l)}),i(),n(7,"span",99),o(8),i()(),n(9,"label",97)(10,"input",100),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.sourceType,l)||(u.formData.sourceType=l),m(l)}),i(),n(11,"span",99),o(12,"\u6307\u5B9A\u7FA4\u7D44"),i()()(),x(13,bi,3,0,"div",101),i(),n(14,"div")(15,"label",92),o(16,"\u95DC\u9375\u8A5E\u96C6 *"),i(),n(17,"div",102),T(18,hi,6,3,"label",103,Ee),x(20,Si,2,0,"p",104),i()(),n(21,"div")(22,"label",92),o(23,"\u9644\u52A0\u689D\u4EF6"),i(),n(24,"div",96)(25,"label",97)(26,"input",105),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.conditions.oncePerUser,l)||(u.formData.conditions.oncePerUser=l),m(l)}),i(),n(27,"span",106),o(28,"\u6BCF\u7528\u6236\u53EA\u89F8\u767C\u4E00\u6B21"),i()(),n(29,"label",97)(30,"input",105),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.conditions.excludeAdmin,l)||(u.formData.conditions.excludeAdmin=l),m(l)}),i(),n(31,"span",106),o(32,"\u6392\u9664\u7FA4\u7BA1\u7406\u54E1"),i()()()()()}if(a&2){let e=d(2);s(6),M("ngModel",e.formData.sourceType),s(2),v("\u5168\u90E8\u76E3\u63A7\u7FA4\u7D44\uFF08",e.stateService.groups().length," \u500B\uFF09"),s(2),M("ngModel",e.formData.sourceType),s(3),_(e.formData.sourceType==="specific"?13:-1),s(5),A(e.stateService.keywordSets()),s(2),_(e.stateService.keywordSets().length===0?20:-1),s(6),M("ngModel",e.formData.conditions.oncePerUser),s(4),M("ngModel",e.formData.conditions.excludeAdmin)}}function yi(a,t){if(a&1){let e=y();n(0,"div",111)(1,"button",113),p("click",function(l){c(e);let u=d(3);return u.formData.responseConfig.aiMode="full",m(l.stopPropagation())}),o(2," \u5168\u81EA\u52D5 "),i(),n(3,"button",113),p("click",function(l){c(e);let u=d(3);return u.formData.responseConfig.aiMode="semi",m(l.stopPropagation())}),o(4," \u534A\u81EA\u52D5\uFF08\u9700\u78BA\u8A8D\uFF09 "),i()()}if(a&2){let e=d(3);s(),S("bg-emerald-500/20",e.formData.responseConfig.aiMode==="full")("text-emerald-400",e.formData.responseConfig.aiMode==="full")("bg-slate-600",e.formData.responseConfig.aiMode!=="full")("text-slate-300",e.formData.responseConfig.aiMode!=="full"),s(2),S("bg-amber-500/20",e.formData.responseConfig.aiMode==="semi")("text-amber-400",e.formData.responseConfig.aiMode==="semi")("bg-slate-600",e.formData.responseConfig.aiMode!=="semi")("text-slate-300",e.formData.responseConfig.aiMode!=="semi")}}function wi(a,t){if(a&1&&(n(0,"option",115),o(1),i()),a&2){let e=t.$implicit;k("ngValue",e.id),s(),C(e.name)}}function Di(a,t){if(a&1){let e=y();n(0,"div",112)(1,"select",114),V("ngModelChange",function(l){c(e);let u=d(3);return I(u.formData.responseConfig.templateId,l)||(u.formData.responseConfig.templateId=l),m(l)}),p("click",function(l){return c(e),m(l.stopPropagation())}),n(2,"option",115),o(3,"\u9078\u64C7\u6A21\u677F..."),i(),T(4,wi,2,2,"option",115,Ee),i()()}if(a&2){let e=d(3);s(),M("ngModel",e.formData.responseConfig.templateId),s(),k("ngValue",void 0),s(2),A(e.stateService.chatTemplates())}}function Ti(a,t){if(a&1){let e=y();n(0,"div",36)(1,"label",92),o(2,"\u97FF\u61C9\u65B9\u5F0F *"),i(),n(3,"div",109)(4,"div",110),p("click",function(){c(e);let l=d(2);return m(l.formData.responseType="ai_chat")}),n(5,"div",39)(6,"span",4),o(7,"\u{1F916}"),i(),n(8,"div",40)(9,"div",48),o(10,"AI \u667A\u80FD\u5C0D\u8A71"),i(),n(11,"p",75),o(12,"\u8B93 AI \u6839\u64DA\u4E0A\u4E0B\u6587\u667A\u80FD\u56DE\u8986\uFF0C\u66F4\u81EA\u7136\u66F4\u500B\u6027\u5316"),i(),x(13,yi,5,16,"div",111),i()()(),n(14,"div",110),p("click",function(){c(e);let l=d(2);return m(l.formData.responseType="template")}),n(15,"div",39)(16,"span",4),o(17,"\u{1F4DD}"),i(),n(18,"div",40)(19,"div",48),o(20,"\u4F7F\u7528\u56FA\u5B9A\u6A21\u677F"),i(),n(21,"p",75),o(22,"\u767C\u9001\u9810\u8A2D\u7684\u804A\u5929\u6A21\u677F\uFF0C\u6548\u679C\u7A69\u5B9A\u53EF\u63A7"),i(),x(23,Di,6,2,"div",112),i()()(),n(24,"div",110),p("click",function(){c(e);let l=d(2);return m(l.formData.responseType="record_only")}),n(25,"div",39)(26,"span",4),o(27,"\u{1F4CB}"),i(),n(28,"div",40)(29,"div",48),o(30,"\u50C5\u8A18\u9304"),i(),n(31,"p",75),o(32,"\u53EA\u5C07\u7528\u6236\u52A0\u5165 Lead \u5EAB\uFF0C\u4E0D\u81EA\u52D5\u767C\u9001\u4EFB\u4F55\u6D88\u606F"),i()()()()()()}if(a&2){let e=d(2);s(4),S("bg-amber-500/10",e.formData.responseType==="ai_chat")("border-amber-500/50",e.formData.responseType==="ai_chat")("bg-slate-700",e.formData.responseType!=="ai_chat")("border-slate-600",e.formData.responseType!=="ai_chat"),s(9),_(e.formData.responseType==="ai_chat"?13:-1),s(),S("bg-amber-500/10",e.formData.responseType==="template")("border-amber-500/50",e.formData.responseType==="template")("bg-slate-700",e.formData.responseType!=="template")("border-slate-600",e.formData.responseType!=="template"),s(9),_(e.formData.responseType==="template"?23:-1),s(),S("bg-amber-500/10",e.formData.responseType==="record_only")("border-amber-500/50",e.formData.responseType==="record_only")("bg-slate-700",e.formData.responseType!=="record_only")("border-slate-600",e.formData.responseType!=="record_only")}}function Ai(a,t){if(a&1){let e=y();n(0,"div")(1,"h4",117),o(2,"\u2699\uFE0F \u767C\u9001\u8A2D\u7F6E"),i(),n(3,"div",109)(4,"div")(5,"label",121),o(6,"\u767C\u9001\u5EF6\u9072\uFF08\u79D2\uFF09"),i(),n(7,"div",2)(8,"input",122),V("ngModelChange",function(l){c(e);let u=d(3);return I(u.formData.delayMin,l)||(u.formData.delayMin=l),m(l)}),i(),n(9,"span",123),o(10,"-"),i(),n(11,"input",124),V("ngModelChange",function(l){c(e);let u=d(3);return I(u.formData.delayMax,l)||(u.formData.delayMax=l),m(l)}),i(),n(12,"span",125),o(13,"\u79D2"),i()()(),n(14,"div")(15,"label",121),o(16,"\u6BCF\u5E33\u865F\u6BCF\u65E5\u9650\u5236"),i(),n(17,"input",126),V("ngModelChange",function(l){c(e);let u=d(3);return I(u.formData.dailyLimit,l)||(u.formData.dailyLimit=l),m(l)}),i(),n(18,"span",127),o(19,"\u689D\u6D88\u606F"),i()()()()}if(a&2){let e=d(3);s(8),M("ngModel",e.formData.delayMin),s(3),M("ngModel",e.formData.delayMax),s(6),M("ngModel",e.formData.dailyLimit)}}function ki(a,t){if(a&1){let e=y();n(0,"div",36)(1,"div",116)(2,"h4",117),o(3,"\u{1F4CB} \u898F\u5247\u6458\u8981"),i(),n(4,"div",118)(5,"div",119)(6,"div",15),o(7,"\u76E3\u63A7\u4F86\u6E90"),i(),n(8,"div",120),o(9),i()(),n(10,"div",62),o(11,"\u2192"),i(),n(12,"div",119)(13,"div",15),o(14,"\u95DC\u9375\u8A5E\u96C6"),i(),n(15,"div",120),o(16),i()(),n(17,"div",62),o(18,"\u2192"),i(),n(19,"div",119)(20,"div",15),o(21,"\u97FF\u61C9\u65B9\u5F0F"),i(),n(22,"div",120),o(23),i()()()(),x(24,Ai,20,3,"div"),n(25,"div")(26,"h4",117),o(27,"\u{1F4CC} \u9644\u52A0\u52D5\u4F5C"),i(),n(28,"div",96)(29,"label",97)(30,"input",105),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.autoAddLead,l)||(u.formData.autoAddLead=l),m(l)}),i(),n(31,"span",106),o(32,"\u81EA\u52D5\u52A0\u5165 Lead \u5EAB"),i()(),n(33,"label",97)(34,"input",105),V("ngModelChange",function(l){c(e);let u=d(2);return I(u.formData.notifyMe,l)||(u.formData.notifyMe=l),m(l)}),i(),n(35,"span",106),o(36,"\u767C\u9001\u901A\u77E5\u7D66\u6211"),i()()()()()}if(a&2){let e=d(2);s(9),v(" ",e.formData.sourceType==="all"?"\u5168\u90E8\u7FA4\u7D44":e.formData.sourceGroupIds.length+" \u500B\u7FA4\u7D44"," "),s(7),v("",e.formData.keywordSetIds.length," \u500B\u8A5E\u96C6"),s(7),C(e.getResponseLabel(e.formData.responseType)),s(),_(e.formData.responseType!=="record_only"?24:-1),s(6),M("ngModel",e.formData.autoAddLead),s(4),M("ngModel",e.formData.notifyMe)}}function Fi(a,t){if(a&1){let e=y();n(0,"button",128),p("click",function(){c(e);let l=d(2);return m(l.nextStep())}),o(1," \u4E0B\u4E00\u6B65 \u2192 "),i()}if(a&2){let e=d(2);k("disabled",!e.canProceed())}}function Mi(a,t){if(a&1){let e=y();n(0,"button",129),p("click",function(){c(e);let l=d(2);return m(l.saveRule())}),n(1,"span"),o(2,"\u{1F680}"),i(),o(3),i()}if(a&2){let e=d(2);k("disabled",!e.canSave()),s(3),v(" ",e.editingRule()?"\u4FDD\u5B58\u4FEE\u6539":"\u7ACB\u5373\u555F\u7528"," ")}}function Ii(a,t){if(a&1){let e=y();n(0,"div",71),p("click",function(){c(e);let l=d();return m(l.closeWizard())}),n(1,"div",72),p("click",function(l){return c(e),m(l.stopPropagation())}),n(2,"div",73)(3,"div")(4,"h2",74),o(5),i(),n(6,"p",75),o(7),i()(),n(8,"button",76),p("click",function(){c(e);let l=d();return m(l.closeWizard())}),Y(),n(9,"svg",77),F(10,"path",78),i()()(),ge(),n(11,"div",79)(12,"div",80),T(13,fi,4,10,"div",81,re),i()(),n(15,"div",82),x(16,Ci,19,38,"div",36)(17,Ei,33,7,"div",36)(18,Ti,33,26,"div",36)(19,ki,37,6,"div",36),i(),n(20,"div",83)(21,"button",84),p("click",function(){c(e);let l=d();return m(l.prevStep())}),o(22," \u2190 \u4E0A\u4E00\u6B65 "),i(),n(23,"div",85)(24,"button",86),p("click",function(){c(e);let l=d();return m(l.closeWizard())}),o(25," \u53D6\u6D88 "),i(),x(26,Fi,2,1,"button",87)(27,Mi,4,2,"button",88),i()()()()}if(a&2){let e,r=d();s(5),C(r.editingRule()?"\u7DE8\u8F2F\u898F\u5247":"\u5275\u5EFA\u89F8\u767C\u898F\u5247"),s(2),j("Step ",r.wizardStep(),"/4: ",r.getStepTitle()),s(6),A(_e(6,si)),s(3),_((e=r.wizardStep())===1?16:e===2?17:e===3?18:e===4?19:-1),s(5),k("disabled",r.wizardStep()===1),s(5),_(r.wizardStep()<4?26:27)}}function Vi(a,t){a&1&&(n(0,"span",140)(1,"span",17),o(2,"\u2713"),i()(),n(3,"span",41),o(4,"\u95DC\u9375\u8A5E\u5339\u914D\u6210\u529F"),i())}function Ri(a,t){a&1&&(n(0,"span",141)(1,"span",142),o(2,"\u2717"),i()(),n(3,"span",143),o(4,"\u672A\u5339\u914D\u4EFB\u4F55\u95DC\u9375\u8A5E"),i())}function Bi(a,t){a&1&&(n(0,"span",17),o(1,"\u5168\u90E8\u6EFF\u8DB3 \u2713"),i())}function Pi(a,t){a&1&&(n(0,"span",13),o(1,"\u90E8\u5206\u689D\u4EF6\u53EF\u80FD\u4E0D\u6EFF\u8DB3"),i())}function Ui(a,t){if(a&1&&(n(0,"div",146)(1,"div",60),o(2,"\u97FF\u61C9\u9810\u89BD"),i(),n(3,"div",147),o(4),i()()),a&2){let e=d(4);s(4),C(e.testResult().responsePreview)}}function Li(a,t){if(a&1&&(n(0,"div",144)(1,"span",145),o(2,"\u5339\u914D\u7684\u95DC\u9375\u8A5E\uFF1A"),i(),n(3,"span",13),o(4),i()(),n(5,"div",144)(6,"span",145),o(7,"\u984D\u5916\u689D\u4EF6\uFF1A"),i(),x(8,Bi,2,0,"span",17)(9,Pi,2,0,"span",13),i(),x(10,Ui,5,1,"div",146)),a&2){let e=d(3);s(4),C(e.testResult().matchedKeywords.join(", ")),s(4),_(e.testResult().conditionsMet?8:9),s(2),_(e.testResult().responsePreview?10:-1)}}function Gi(a,t){if(a&1&&(n(0,"div",137)(1,"div",30),x(2,Vi,5,0)(3,Ri,5,0),i(),x(4,Li,11,3),i()),a&2){let e=d(2);s(2),_(e.testResult().matched?2:3),s(2),_(e.testResult().matched?4:-1)}}function ji(a,t){a&1&&(n(0,"span",148),o(1,"\u23F3"),i(),o(2," \u6E2C\u8A66\u4E2D... "))}function Ni(a,t){a&1&&(n(0,"span"),o(1,"\u{1F680}"),i(),o(2," \u57F7\u884C\u6E2C\u8A66 "))}function Ki(a,t){if(a&1){let e=y();n(0,"div",71),p("click",function(){c(e);let l=d();return m(l.closeTestDialog())}),n(1,"div",130),p("click",function(l){return c(e),m(l.stopPropagation())}),n(2,"div",131)(3,"div",2)(4,"div",132)(5,"span",133),o(6,"\u{1F9EA}"),i()(),n(7,"div")(8,"h3",134),o(9,"\u6E2C\u8A66\u898F\u5247"),i(),n(10,"p",6),o(11),i()()()(),n(12,"div",135)(13,"div")(14,"label",92),o(15,"\u6A21\u64EC\u6D88\u606F\u5167\u5BB9"),i(),n(16,"textarea",136),V("ngModelChange",function(l){c(e);let u=d();return I(u.testMessage,l)||(u.testMessage=l),m(l)}),o(17,"              "),i()(),x(18,Gi,5,2,"div",137),i(),n(19,"div",138)(20,"button",86),p("click",function(){c(e);let l=d();return m(l.closeTestDialog())}),o(21," \u95DC\u9589 "),i(),n(22,"button",139),p("click",function(){c(e);let l=d();return m(l.runTest())}),x(23,ji,3,0)(24,Ni,3,0),i()()()()}if(a&2){let e,r=d();s(11),C((e=r.testingRule())==null?null:e.name),s(5),M("ngModel",r.testMessage),s(2),_(r.testResult()?18:-1),s(4),k("disabled",!r.testMessage.trim()||r.isTestingRule()),s(),_(r.isTestingRule()?23:24)}}var Se=class a{constructor(){this.stateService=D(z);this.ipcService=D(O);this.toastService=D(H);this.confirmService=D(q);this.rules=w([]);this.isLoading=w(!1);this.filterStatus="all";this.stateEffect=Z(()=>{let t=this.stateService.triggerRules();t.length>0&&this.rules().length===0&&(console.log("[TriggerRules] Syncing from StateService:",t.length,"rules"),this.rules.set(t),this.isLoading.set(!1))});this.showWizard=w(!1);this.wizardStep=w(1);this.editingRule=w(null);this.formData=this.getEmptyFormData();this.aiChatEnabled=w(!1);this.aiChatMode=w("semi");this.showTestDialog=w(!1);this.testingRule=w(null);this.testMessage="";this.testResult=w(null);this.isTestingRule=w(!1);this.activeRules=N(()=>this.rules().filter(t=>t.isActive));this.totalTriggerCount=N(()=>this.rules().reduce((t,e)=>t+(e.triggerCount||0),0));this.averageSuccessRate=N(()=>{let t=this.rules().filter(r=>(r.triggerCount||0)>0);if(t.length===0)return 0;let e=t.reduce((r,l)=>{let u=l.triggerCount?(l.successCount||0)/l.triggerCount*100:0;return r+u},0);return Math.round(e/t.length)});this.filteredRules=N(()=>{let t=this.rules();return this.filterStatus==="active"?t.filter(e=>e.isActive):this.filterStatus==="inactive"?t.filter(e=>!e.isActive):t});this.listeners=[];this.retryCount=0;this.MAX_RETRIES=3}ngOnInit(){this.setupListeners();let t=this.stateService.triggerRules();t.length>0?(console.log("[TriggerRules] Using existing StateService data:",t.length,"rules"),this.rules.set(t)):this.stateService.loadAll(),this.loadRules(),this.loadAISettings()}ngOnDestroy(){this.listeners.forEach(t=>t())}setupListeners(){let t=this.ipcService.on("trigger-rules-result",b=>{console.log("[TriggerRules] Received trigger-rules-result:",b),this.isLoading.set(!1),this.retryCount=0,b.success?this.rules.set(b.rules||[]):b.error&&(console.error("[TriggerRules] Error loading rules:",b.error),this.toastService.error("\u52A0\u8F09\u898F\u5247\u5931\u6557: "+b.error))});this.listeners.push(t);let e=this.ipcService.on("save-trigger-rule-result",b=>{console.log("[TriggerRules] Received save-trigger-rule-result:",b),b.success?(this.toastService.success(b.message||"\u898F\u5247\u5DF2\u4FDD\u5B58"),this.closeWizard()):this.toastService.error(b.error||"\u4FDD\u5B58\u5931\u6557")});this.listeners.push(e);let r=this.ipcService.on("delete-trigger-rule-result",b=>{b.success&&this.toastService.success("\u898F\u5247\u5DF2\u522A\u9664")});this.listeners.push(r);let l=this.ipcService.on("toggle-trigger-rule-result",b=>{b.success});this.listeners.push(l);let u=this.ipcService.on("ai-settings-loaded",b=>{if(b){let h=b.auto_chat_enabled===1||b.autoChatEnabled===!0;this.aiChatEnabled.set(h),this.aiChatMode.set(b.auto_chat_mode||b.autoChatMode||"semi")}});this.listeners.push(u)}loadRules(){this.isLoading.set(!0),console.log("[TriggerRules] Sending get-trigger-rules request"),this.ipcService.send("get-trigger-rules",{}),setTimeout(()=>{this.isLoading()&&this.rules().length===0&&this.retryCount<this.MAX_RETRIES?(this.retryCount++,console.log(`[TriggerRules] Retrying... (${this.retryCount}/${this.MAX_RETRIES})`),this.ipcService.send("get-trigger-rules",{})):this.isLoading()&&this.isLoading.set(!1)},3e3)}loadAISettings(){this.ipcService.send("get-ai-settings",{})}refreshData(){this.retryCount=0,this.loadRules(),this.stateService.loadAll()}handleConfigAction(t){}openCreateWizard(){this.editingRule.set(null),this.formData=this.getEmptyFormData(),this.wizardStep.set(1),this.showWizard.set(!0)}editRule(t){this.editingRule.set(t),this.formData=R({},t),this.wizardStep.set(1),this.showWizard.set(!0)}closeWizard(){this.showWizard.set(!1),this.editingRule.set(null),this.formData=this.getEmptyFormData()}getEmptyFormData(){return{name:"",description:"",priority:2,isActive:!0,sourceType:"all",sourceGroupIds:[],keywordSetIds:[],conditions:{oncePerUser:!1,excludeAdmin:!1},responseType:"ai_chat",responseConfig:{aiMode:"full"},senderType:"auto",senderAccountIds:[],delayMin:30,delayMax:120,dailyLimit:50,autoAddLead:!0,notifyMe:!1}}getStepTitle(){return{1:"\u57FA\u672C\u4FE1\u606F",2:"\u89F8\u767C\u689D\u4EF6",3:"\u97FF\u61C9\u52D5\u4F5C",4:"\u78BA\u8A8D\u8A2D\u7F6E"}[this.wizardStep()]||""}prevStep(){this.wizardStep()>1&&this.wizardStep.update(t=>t-1)}nextStep(){this.wizardStep()<4&&this.canProceed()&&this.wizardStep.update(t=>t+1)}canProceed(){switch(this.wizardStep()){case 1:return this.formData.name.trim().length>0;case 2:return this.formData.keywordSetIds.length>0;case 3:return this.formData.responseType==="template"?!!this.formData.responseConfig.templateId:!0;default:return!0}}canSave(){return this.formData.name.trim().length>0&&this.formData.keywordSetIds.length>0}isGroupSelected(t){return this.formData.sourceGroupIds.some(e=>String(e)===String(t))}isKeywordSetSelected(t){return this.formData.keywordSetIds.some(e=>String(e)===String(t))}toggleGroupSelection(t){let e=this.formData.sourceGroupIds.findIndex(r=>String(r)===String(t));e===-1?this.formData.sourceGroupIds.push(t):this.formData.sourceGroupIds.splice(e,1)}toggleKeywordSetSelection(t){let e=this.formData.keywordSetIds.findIndex(r=>String(r)===String(t));e===-1?this.formData.keywordSetIds.push(t):this.formData.keywordSetIds.splice(e,1)}saveRule(){let t=P(R({},this.formData),{id:this.editingRule()?.id});this.ipcService.send("save-trigger-rule",t)}async toggleRule(t){this.ipcService.send("toggle-trigger-rule",{id:t.id,isActive:!t.isActive})}async deleteRule(t){await this.confirmService.confirm({title:"\u522A\u9664\u898F\u5247",message:`\u78BA\u5B9A\u8981\u522A\u9664\u898F\u5247\u300C${t.name}\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,confirmText:"\u522A\u9664",cancelText:"\u53D6\u6D88",type:"danger"})&&this.ipcService.send("delete-trigger-rule",{id:t.id})}getResponseIcon(t){return{ai_chat:"\u{1F916}",template:"\u{1F4DD}",script:"\u{1F4D6}",record_only:"\u{1F4CB}"}[t]||"\u26A1"}getResponseLabel(t){return{ai_chat:"AI \u667A\u80FD\u5C0D\u8A71",template:"\u56FA\u5B9A\u6A21\u677F",script:"\u57F7\u884C\u5287\u672C",record_only:"\u50C5\u8A18\u9304"}[t]||t}getResponseDetail(t){let e=this.getResponseLabel(t.responseType);if(t.responseType==="template"&&t.responseConfig?.templateId){let r=this.getTemplateName(t.responseConfig.templateId);return`${e}: ${r}`}if(t.responseType==="ai_chat"&&t.responseConfig?.aiMode){let r=t.responseConfig.aiMode==="full"?"\u5168\u81EA\u52D5":"\u534A\u81EA\u52D5";return`${e} (${r})`}return e}getTemplateName(t){return t?this.stateService.chatTemplates().find(l=>String(l.id)===String(t))?.name||`\u6A21\u677F #${t}`:"\u672A\u9078\u64C7"}getPriorityLabel(t){return{3:"\u9AD8\u512A\u5148",2:"\u4E2D\u512A\u5148",1:"\u4F4E\u512A\u5148"}[t]||"\u4E2D\u512A\u5148"}getKeywordSetNames(t){if(!t||t.length===0)return"\u672A\u9078\u64C7";let e=this.stateService.keywordSets(),r=t.map(l=>{let u=String(l);return e.find(h=>String(h.id)===u)?.name||`#${l}`});return r.length>2?`${r.slice(0,2).join(", ")} \u7B49 ${r.length} \u500B`:r.join(", ")}getSuccessRate(t){return!t.triggerCount||t.triggerCount===0?0:Math.round((t.successCount||0)/t.triggerCount*100)}formatTime(t){if(!t)return"";let e=new Date(t),l=new Date().getTime()-e.getTime();return l<6e4?"\u525B\u525B":l<36e5?`${Math.floor(l/6e4)} \u5206\u9418\u524D`:l<864e5?`${Math.floor(l/36e5)} \u5C0F\u6642\u524D`:e.toLocaleDateString()}openTestDialog(t){this.testingRule.set(t),this.testMessage="",this.testResult.set(null),this.showTestDialog.set(!0)}closeTestDialog(){this.showTestDialog.set(!1),this.testingRule.set(null),this.testMessage="",this.testResult.set(null)}runTest(){let t=this.testingRule();if(!t||!this.testMessage.trim())return;this.isTestingRule.set(!0);let r=this.stateService.keywordSets().filter(E=>t.keywordSetIds.includes(E.id)||t.keywordSetIds.includes(String(E.id))),l=[],u=this.testMessage.toLowerCase();for(let E of r)for(let B of E.keywords||[]){let U=B.keyword?.toLowerCase()||B.text?.toLowerCase()||"";if(!U)continue;let Q=!1;if(B.isRegex||!1)try{Q=new RegExp(U,"i").test(this.testMessage)}catch{Q=u.includes(U)}else Q=u.includes(U);Q&&l.push(B.keyword||B.text)}let b=this.checkConditions(t),h="";if(l.length>0)if(t.responseType==="template"&&t.responseConfig?.templateId){let B=this.stateService.chatTemplates().find(U=>String(U.id)===String(t.responseConfig.templateId));B&&(h=this.generatePreview(B.content||"",l[0]))}else t.responseType==="ai_chat"?h="[AI \u5C07\u6839\u64DA\u6D88\u606F\u5167\u5BB9\u667A\u80FD\u751F\u6210\u56DE\u5FA9]":t.responseType==="record_only"?h="[\u50C5\u8A18\u9304\uFF0C\u4E0D\u767C\u9001\u4EFB\u4F55\u6D88\u606F]":t.responseType==="script"&&(h="[\u5C07\u57F7\u884C\u914D\u7F6E\u7684\u5287\u672C\u8173\u672C]");setTimeout(()=>{this.testResult.set({matched:l.length>0,matchedKeywords:[...new Set(l)],conditionsMet:b,responsePreview:h}),this.isTestingRule.set(!1)},500)}checkConditions(t){let e=t.conditions||{};if(e.timeRange){let l=new Date().getHours(),[u,b]=[parseInt(e.timeRange.start?.split(":")[0]||"0"),parseInt(e.timeRange.end?.split(":")[0]||"24")];if(l<u||l>=b)return!1}return!0}generatePreview(t,e){let r=t;return r=r.replace(/\{\{?username\}?\}/g,"@TestUser"),r=r.replace(/\{\{?firstName\}?\}/g,"Test"),r=r.replace(/\{\{?keyword\}?\}/g,e),r=r.replace(/\{\{?groupName\}?\}/g,"\u6E2C\u8A66\u7FA4\u7D44"),r=r.replace(/\{\{?[^}]+\}?\}/g,""),r.trim()}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-trigger-rules"]],decls:87,vars:12,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-amber-500","to-orange-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-amber-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-amber-400"],[1,"text-2xl","font-bold","text-amber-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"w-10","h-10","bg-cyan-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-cyan-400"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"w-10","h-10","bg-purple-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-purple-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"mb-4","p-4","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10","rounded-xl","border","border-emerald-500/30"],[1,"flex-1","overflow-hidden"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","h-full","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-slate-700","border","border-slate-600","rounded-lg","text-sm","text-white",3,"ngModelChange","ngModel"],["value","all"],["value","active"],["value","inactive"],[1,"flex-1","overflow-y-auto","p-4"],[1,"space-y-4"],[1,"flex","flex-col","items-center","justify-center","h-full","text-center","py-12"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50"],[1,"flex","items-start","gap-3"],[1,"flex-1"],[1,"text-emerald-400","font-medium"],[1,"text-slate-400","text-sm","mt-1"],[1,"bg-slate-700/50","rounded-xl","border","transition-all","hover:border-amber-500/30",3,"border-slate-600/50","border-slate-700/50","opacity-60"],[1,"bg-slate-700/50","rounded-xl","border","transition-all","hover:border-amber-500/30"],[1,"p-4","flex","items-center","justify-between"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center"],[1,"text-lg"],[1,"font-medium","text-white"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded-full"],[1,"px-2","py-0.5","bg-slate-600","text-slate-400","text-xs","rounded-full"],[1,"px-2","py-0.5","text-xs","rounded-full"],[1,"text-sm","text-slate-400","mt-0.5"],["title","\u6E2C\u8A66\u898F\u5247",1,"px-3","py-1.5","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-slate-600","hover:bg-slate-500","text-white","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-3","py-1.5","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","hover:bg-red-500/30","text-red-400","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-4","pb-4"],[1,"flex","items-center","gap-4","p-3","bg-slate-800/50","rounded-lg"],[1,"flex-1","text-center"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-sm","text-slate-300"],[1,"text-slate-600"],[1,"flex","items-center","justify-between","mt-3","text-xs","text-slate-500"],[1,"flex","items-center","gap-4"],[1,"w-20","h-20","bg-slate-700/50","rounded-full","flex","items-center","justify-center","mb-4"],[1,"text-4xl"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-slate-400","mb-6","max-w-md"],[1,"text-emerald-400","text-sm","mb-4"],[1,"px-6","py-3","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-xl","transition-colors","flex","items-center","gap-2",3,"click"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","shadow-2xl",3,"click"],[1,"p-6","border-b","border-slate-700","flex","items-center","justify-between"],[1,"text-xl","font-bold","text-white"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-4","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"p-6","overflow-y-auto",2,"max-height","calc(90vh - 250px)"],[1,"p-6","border-t","border-slate-700","flex","items-center","justify-between"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"px-6","py-2","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"disabled"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm","font-medium","transition-colors"],[1,"w-16","h-0.5","mx-2",3,"bg-amber-500","bg-slate-700"],[1,"w-16","h-0.5","mx-2"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1AUSDT \u4EA4\u6613\u8AEE\u8A62",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","focus:border-amber-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","3","placeholder","\u63CF\u8FF0\u9019\u500B\u898F\u5247\u7684\u7528\u9014...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","focus:border-amber-500","focus:outline-none","resize-none",3,"ngModelChange","ngModel"],[1,"flex-1","px-4","py-3","rounded-lg","border","transition-colors",3,"click"],[1,"space-y-2"],[1,"flex","items-center","gap-3","p-3","bg-slate-700","rounded-lg","cursor-pointer","hover:bg-slate-600","transition-colors"],["type","radio","name","sourceType","value","all",1,"w-4","h-4","text-amber-500",3,"ngModelChange","ngModel"],[1,"text-slate-300"],["type","radio","name","sourceType","value","specific",1,"w-4","h-4","text-amber-500",3,"ngModelChange","ngModel"],[1,"mt-3","p-3","bg-slate-700/50","rounded-lg","max-h-40","overflow-y-auto"],[1,"p-3","bg-slate-700/50","rounded-lg","max-h-48","overflow-y-auto"],[1,"flex","items-center","gap-2","p-2","hover:bg-slate-600/50","rounded","cursor-pointer"],[1,"text-slate-500","text-sm","text-center","py-4"],["type","checkbox",1,"w-4","h-4","text-amber-500",3,"ngModelChange","ngModel"],[1,"text-slate-300","text-sm"],["type","checkbox",1,"w-4","h-4","text-amber-500",3,"change","checked"],[1,"text-slate-500","text-xs"],[1,"space-y-3"],[1,"p-4","rounded-lg","border","cursor-pointer","transition-colors",3,"click"],[1,"mt-3","flex","gap-2"],[1,"mt-3"],[1,"px-3","py-1.5","rounded","text-sm",3,"click"],[1,"w-full","px-3","py-2","bg-slate-600","border","border-slate-500","rounded","text-sm","text-white",3,"ngModelChange","click","ngModel"],[3,"ngValue"],[1,"p-4","bg-slate-700/50","rounded-lg"],[1,"font-medium","text-white","mb-3"],[1,"flex","items-center","justify-between","p-3","bg-slate-800/50","rounded-lg"],[1,"text-center","flex-1"],[1,"text-sm","text-slate-300","mt-1"],[1,"block","text-sm","text-slate-400","mb-2"],["type","number","min","0","max","300",1,"w-24","px-3","py-2","bg-slate-700","border","border-slate-600","rounded","text-white","text-center",3,"ngModelChange","ngModel"],[1,"text-slate-500"],["type","number","min","0","max","600",1,"w-24","px-3","py-2","bg-slate-700","border","border-slate-600","rounded","text-white","text-center",3,"ngModelChange","ngModel"],[1,"text-slate-500","text-sm"],["type","number","min","1","max","500",1,"w-32","px-3","py-2","bg-slate-700","border","border-slate-600","rounded","text-white",3,"ngModelChange","ngModel"],[1,"text-slate-500","text-sm","ml-2"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-6","py-2","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-lg","shadow-2xl","border","border-slate-700/50",3,"click"],[1,"p-6","border-b","border-slate-700/50"],[1,"w-10","h-10","bg-blue-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-xl"],[1,"text-lg","font-bold","text-white"],[1,"p-6","space-y-4"],["rows","3","placeholder","\u8F38\u5165\u8981\u6E2C\u8A66\u7684\u6D88\u606F\u5167\u5BB9\uFF0C\u4F8B\u5982\uFF1A\u6211\u60F3\u4E86\u89E3\u66F4\u591A\u95DC\u65BC\u6295\u8CC7\u7684\u4FE1\u606F...",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-400","focus:border-blue-500",3,"ngModelChange","ngModel"],[1,"bg-slate-700/50","rounded-lg","p-4","space-y-3"],[1,"p-6","border-t","border-slate-700/50","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-blue-500","hover:bg-blue-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"w-6","h-6","bg-emerald-500/20","rounded-full","flex","items-center","justify-center"],[1,"w-6","h-6","bg-red-500/20","rounded-full","flex","items-center","justify-center"],[1,"text-red-400"],[1,"text-red-400","font-medium"],[1,"text-sm"],[1,"text-slate-400"],[1,"mt-3","p-3","bg-slate-800","rounded-lg"],[1,"text-sm","text-slate-300","whitespace-pre-wrap"],[1,"animate-spin"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),o(5,"\u26A1"),i()(),n(6,"div")(7,"h1",5),o(8,"\u89F8\u767C\u898F\u5247"),i(),n(9,"p",6),o(10,"\u5B9A\u7FA9\u95DC\u9375\u8A5E\u5339\u914D\u5F8C\u7684\u97FF\u61C9\u52D5\u4F5C"),i()()(),n(11,"div",2)(12,"app-config-progress",7),p("action",function(u){return r.handleConfigAction(u)}),i(),n(13,"button",8),p("click",function(){return r.refreshData()}),n(14,"span"),o(15,"\u{1F504}"),i(),n(16,"span"),o(17,"\u5237\u65B0"),i()(),n(18,"button",9),p("click",function(){return r.openCreateWizard()}),n(19,"span"),o(20,"+"),i(),n(21,"span"),o(22,"\u5275\u5EFA\u898F\u5247"),i()()()(),n(23,"div",10)(24,"div",11)(25,"div",2)(26,"div",12)(27,"span",13),o(28,"\u26A1"),i()(),n(29,"div")(30,"div",14),o(31),i(),n(32,"div",15),o(33,"\u7E3D\u898F\u5247\u6578"),i()()()(),n(34,"div",11)(35,"div",2)(36,"div",16)(37,"span",17),o(38,"\u2713"),i()(),n(39,"div")(40,"div",18),o(41),i(),n(42,"div",15),o(43,"\u6D3B\u8E8D\u898F\u5247"),i()()()(),n(44,"div",11)(45,"div",2)(46,"div",19)(47,"span",20),o(48,"\u{1F3AF}"),i()(),n(49,"div")(50,"div",21),o(51),i(),n(52,"div",15),o(53,"\u7E3D\u89F8\u767C\u6B21\u6578"),i()()()(),n(54,"div",11)(55,"div",2)(56,"div",22)(57,"span",23),o(58,"\u{1F4CA}"),i()(),n(59,"div")(60,"div",24),o(61),i(),n(62,"div",15),o(63,"\u5E73\u5747\u6210\u529F\u7387"),i()()()()(),x(64,di,9,1,"div",25),n(65,"div",26)(66,"div",27)(67,"div",28)(68,"h3",29)(69,"span"),o(70,"\u26A1"),i(),o(71," \u89F8\u767C\u898F\u5247\u5217\u8868 "),n(72,"span",15),o(73),i()(),n(74,"div",30)(75,"select",31),V("ngModelChange",function(u){return I(r.filterStatus,u)||(r.filterStatus=u),u}),n(76,"option",32),o(77,"\u5168\u90E8\u72C0\u614B"),i(),n(78,"option",33),o(79,"\u6D3B\u8E8D\u4E2D"),i(),n(80,"option",34),o(81,"\u5DF2\u505C\u7528"),i()()()(),n(82,"div",35),x(83,pi,3,0,"div",36)(84,xi,15,1,"div",37),i()()()(),x(85,Ii,28,7,"div",38),x(86,Ki,25,5,"div",38)),e&2&&(s(14),S("animate-spin",r.isLoading()),s(17),C(r.rules().length),s(10),C(r.activeRules().length),s(10),C(r.totalTriggerCount()),s(10),v("",r.averageSuccessRate(),"%"),s(3),_(r.aiChatEnabled()?64:-1),s(9),v("(",r.rules().length,")"),s(2),M("ngModel",r.filterStatus),s(8),_(r.filteredRules().length>0?83:84),s(2),_(r.showWizard()?85:-1),s(),_(r.showTestDialog()?86:-1))},dependencies:[K,W,ce,me,ee,Le,de,ue,Ge,te,Ne,je,ie,ne],encapsulation:2})}};var qe=(a,t)=>t.key,Wi=(a,t)=>t.id,Oi=(a,t)=>t.name;function Hi(a,t){if(a&1){let e=y();n(0,"button",19),p("click",function(){let l=c(e).$implicit,u=d();return m(u.filterType=l.key)}),o(1),i()}if(a&2){let e=t.$implicit,r=d();S("bg-pink-500/20",r.filterType===e.key)("text-pink-400",r.filterType===e.key)("bg-slate-700/50",r.filterType!==e.key)("text-slate-400",r.filterType!==e.key),s(),j(" ",e.value.icon," ",e.value.label," ")}}function $i(a,t){if(a&1){let e=y();n(0,"div",16)(1,"p"),o(2),i(),n(3,"button",20),p("click",function(){c(e);let l=d();return m(l.createNewTemplate())}),o(4," + \u5275\u5EFA\u7B2C\u4E00\u500B\u6A21\u677F "),i()()}if(a&2){let e=d();s(2),C(e.searchQuery||e.filterType!=="all"?"\u6C92\u6709\u7B26\u5408\u7684\u6A21\u677F":"\u9084\u6C92\u6709\u6A21\u677F")}}function zi(a,t){if(a&1&&(n(0,"span"),o(1),i()),a&2){let e=d().$implicit,r=d(2);s(),v("\u23F0 ",r.formatDate(e.lastUsed))}}function qi(a,t){if(a&1){let e=y();n(0,"div",22),p("click",function(){let l=c(e).$implicit,u=d(2);return m(u.selectTemplate(l))}),n(1,"div",23)(2,"div",4)(3,"span"),o(4),i(),n(5,"span",24),o(6),i()(),n(7,"span",25),o(8),i()(),n(9,"p",26),o(10),i(),n(11,"div",27)(12,"span"),o(13),i(),x(14,zi,2,1,"span"),i()()}if(a&2){let e,r,l,u,b,h=t.$implicit,E=d(2);S("bg-pink-500/20",((e=E.selectedTemplate())==null?null:e.id)===h.id)("border-pink-500/50",((r=E.selectedTemplate())==null?null:r.id)===h.id)("bg-slate-800/50",((l=E.selectedTemplate())==null?null:l.id)!==h.id)("hover:bg-slate-700/50",((u=E.selectedTemplate())==null?null:u.id)!==h.id)("border",!0)("border-slate-700/50",((b=E.selectedTemplate())==null?null:b.id)!==h.id),s(4),C(E.getTypeConfig(h.templateType).icon),s(2),C(h.name),s(),S("bg-emerald-500/20",h.isActive)("text-emerald-400",h.isActive)("bg-slate-600/50",!h.isActive)("text-slate-400",!h.isActive),s(),v(" ",h.isActive?"\u555F\u7528":"\u505C\u7528"," "),s(2),C(h.content),s(3),v("\u{1F4CA} ",h.usageCount," \u6B21\u4F7F\u7528"),s(),_(h.lastUsed?14:-1)}}function Qi(a,t){if(a&1&&T(0,qi,15,26,"div",21,Wi),a&2){let e=d();A(e.filteredTemplates())}}function Ji(a,t){if(a&1){let e=y();n(0,"div",18)(1,"div",28)(2,"div",29)(3,"span",30),o(4,"\u{1F4AC}"),i()(),n(5,"h3",31),o(6,"\u9078\u64C7\u6216\u5275\u5EFA\u804A\u5929\u6A21\u677F"),i(),n(7,"p",32),o(8,"\u5F9E\u5DE6\u5074\u9078\u64C7\u4E00\u500B\u6A21\u677F\u67E5\u770B\u8A73\u60C5\uFF0C\u6216\u5275\u5EFA\u65B0\u6A21\u677F"),i(),n(9,"button",33),p("click",function(){c(e);let l=d();return m(l.createNewTemplate())}),o(10," + \u5275\u5EFA\u65B0\u6A21\u677F "),i()()()}}function Xi(a,t){if(a&1&&(n(0,"option",39),o(1),i()),a&2){let e=t.$implicit;k("value",e.key),s(),j("",e.value.icon," ",e.value.label)}}function Yi(a,t){if(a&1){let e=y();n(0,"button",62),p("click",function(){c(e);let l=d(2);return m(l.deleteTemplate())}),o(1," \u522A\u9664 "),i()}}function Zi(a,t){if(a&1){let e=y();n(0,"div",63),p("click",function(){let l=c(e).$implicit,u=d(2);return m(u.insertVariable(l.name))}),n(1,"div",35)(2,"code",64),o(3),i(),n(4,"span",65),o(5,"\u9EDE\u64CA\u63D2\u5165"),i()(),n(6,"p",66),o(7),i()()}if(a&2){let e=t.$implicit;s(3),C("{{"+e.name+"}}"),s(4),C(e.description)}}function en(a,t){if(a&1&&(n(0,"div",55)(1,"h4",51)(2,"span"),o(3,"\u{1F4CA}"),i(),o(4," \u4F7F\u7528\u7D71\u8A08 "),i(),n(5,"div",67)(6,"div",28)(7,"div",68),o(8),i(),n(9,"div",7),o(10,"\u7E3D\u4F7F\u7528\u6B21\u6578"),i()(),n(11,"div",28)(12,"div",69),o(13),i(),n(14,"div",7),o(15,"\u8B8A\u91CF\u6578\u91CF"),i()(),n(16,"div",28)(17,"div",70),o(18),i(),n(19,"div",7),o(20,"\u6700\u5F8C\u4F7F\u7528"),i()()()()),a&2){let e=d(2);s(8),C(e.editingTemplate.usageCount),s(5),C(e.editingTemplate.variables.length),s(5),v(" ",e.editingTemplate.lastUsed?e.formatDate(e.editingTemplate.lastUsed):"\u5F9E\u672A\u4F7F\u7528"," ")}}function tn(a,t){if(a&1){let e=y();n(0,"div",34)(1,"div",35)(2,"div",36)(3,"input",37),V("ngModelChange",function(l){c(e);let u=d();return I(u.editingTemplate.name,l)||(u.editingTemplate.name=l),m(l)}),i(),n(4,"select",38),V("ngModelChange",function(l){c(e);let u=d();return I(u.editingTemplate.templateType,l)||(u.editingTemplate.templateType=l),m(l)}),T(5,Xi,2,3,"option",39,qe),i()(),n(7,"div",40)(8,"label",41)(9,"input",42),V("ngModelChange",function(l){c(e);let u=d();return I(u.editingTemplate.isActive,l)||(u.editingTemplate.isActive=l),m(l)}),i(),n(10,"span",43),o(11,"\u555F\u7528"),i()(),n(12,"button",44),p("click",function(){c(e);let l=d();return m(l.saveTemplate())}),o(13),i(),x(14,Yi,2,0,"button",45),i()()(),n(15,"div",46)(16,"div",47)(17,"label",48),o(18,"\u6A21\u677F\u5167\u5BB9"),i(),n(19,"textarea",49),V("ngModelChange",function(l){c(e);let u=d();return I(u.editingTemplate.content,l)||(u.editingTemplate.content=l),m(l)}),o(20,"              "),i()(),n(21,"div",50)(22,"h4",51)(23,"span"),o(24,"\u{1F4DD}"),i(),o(25," \u53EF\u7528\u8B8A\u91CF "),i(),n(26,"div",52),T(27,Zi,8,2,"div",53,Oi),i()(),n(29,"div",47)(30,"h4",54)(31,"span"),o(32,"\u{1F441}\uFE0F"),i(),o(33," \u9810\u89BD "),i(),n(34,"div",55)(35,"div",56)(36,"div",57),o(37," \u{1F916} "),i(),n(38,"div",58)(39,"div",59)(40,"p",60),o(41),i()(),n(42,"div",61),o(43,"\u525B\u525B"),i()()()()(),x(44,en,21,3,"div",55),i()}if(a&2){let e=d();s(3),M("ngModel",e.editingTemplate.name),s(),M("ngModel",e.editingTemplate.templateType),s(),A(e.templateTypeEntries),s(4),M("ngModel",e.editingTemplate.isActive),s(4),v(" ",e.isCreating()?"\u5275\u5EFA":"\u4FDD\u5B58"," "),s(),_(e.isCreating()?-1:14),s(5),M("ngModel",e.editingTemplate.content),Be("placeholder","\u8F38\u5165\u6A21\u677F\u5167\u5BB9\uFF0C\u4F7F\u7528 {{\u8B8A\u91CF\u540D}} \u63D2\u5165\u8B8A\u91CF"),s(8),A(e.availableVariables),s(14),C(e.previewContent()),s(3),_(e.isCreating()?-1:44)}}var Ve={greeting:{label:"\u554F\u5019\u8A9E",icon:"\u{1F44B}",color:"emerald"},follow_up:{label:"\u8DDF\u9032\u6D88\u606F",icon:"\u{1F4E9}",color:"blue"},promotion:{label:"\u63A8\u5EE3\u6D88\u606F",icon:"\u{1F4E2}",color:"amber"},custom:{label:"\u81EA\u5B9A\u7FA9",icon:"\u270F\uFE0F",color:"purple"}},ye=class a{constructor(){this.ipcService=D(O);this.toastService=D(H);this.confirmDialog=D(q);this.stateService=D(z);this.templates=w([]);this.selectedTemplate=w(null);this.isCreating=w(!1);this.isLoading=w(!1);this.stateEffect=Z(()=>{let t=this.stateService.chatTemplates();t.length>0&&this.templates().length===0&&(console.log("[ChatTemplates] Syncing from StateService:",t.length,"templates"),this.updateTemplates(t))});this.editingTemplate=this.createEmptyTemplate();this.searchQuery="";this.filterType="all";this.templateTypeEntries=Object.entries(Ve).map(([t,e])=>({key:t,value:e}));this.availableVariables=[{name:"username",description:"\u5C0D\u65B9\u7528\u6236\u540D"},{name:"firstName",description:"\u5C0D\u65B9\u540D\u5B57"},{name:"groupName",description:"\u7FA4\u7D44\u540D\u7A31"},{name:"keyword",description:"\u5339\u914D\u7684\u95DC\u9375\u8A5E"},{name:"date",description:"\u7576\u524D\u65E5\u671F"},{name:"time",description:"\u7576\u524D\u6642\u9593"}];this.filteredTemplates=N(()=>{let t=this.templates();if(this.filterType!=="all"&&(t=t.filter(e=>e.templateType===this.filterType)),this.searchQuery){let e=this.searchQuery.toLowerCase();t=t.filter(r=>r.name.toLowerCase().includes(e)||r.content.toLowerCase().includes(e))}return t});this.previewContent=N(()=>{let t=this.editingTemplate.content||"\u5728\u9019\u88E1\u8F38\u5165\u6A21\u677F\u5167\u5BB9...";return t=t.replace(/\{\{username\}\}/g,"John_Doe"),t=t.replace(/\{\{firstName\}\}/g,"John"),t=t.replace(/\{\{groupName\}\}/g,"\u52A0\u5BC6\u8CA8\u5E63\u4EA4\u6D41\u7FA4"),t=t.replace(/\{\{keyword\}\}/g,"\u6295\u8CC7"),t=t.replace(/\{\{date\}\}/g,new Date().toLocaleDateString()),t=t.replace(/\{\{time\}\}/g,new Date().toLocaleTimeString()),t});this.listeners=[];this.retryCount=0;this.MAX_RETRIES=3}ngOnInit(){this.setupListeners();let t=this.stateService.chatTemplates();t.length>0?(console.log("[ChatTemplates] Using existing StateService data:",t.length,"templates"),this.updateTemplates(t)):this.stateService.loadAll(),this.loadTemplates()}ngOnDestroy(){this.listeners.forEach(t=>t())}setupListeners(){let t=this.ipcService.on("get-chat-templates-result",b=>{console.log("[ChatTemplates] Received get-chat-templates-result:",b),this.isLoading.set(!1),this.retryCount=0,b.templates?this.updateTemplates(b.templates):b.error&&(console.error("[ChatTemplates] Error loading templates:",b.error),this.toastService.error("\u52A0\u8F09\u6A21\u677F\u5931\u6557: "+b.error))});this.listeners.push(t);let e=this.ipcService.on("initial-state",b=>{b.chatTemplates&&(console.log("[ChatTemplates] Received from initial-state:",b.chatTemplates.length,"templates"),this.updateTemplates(b.chatTemplates))});this.listeners.push(e);let r=this.ipcService.on("initial-state-config",b=>{b.chatTemplates&&(console.log("[ChatTemplates] Received from initial-state-config:",b.chatTemplates.length,"templates"),this.updateTemplates(b.chatTemplates))});this.listeners.push(r);let l=this.ipcService.on("save-chat-template-result",b=>{b.success?(this.toastService.success(this.isCreating()?"\u6A21\u677F\u5275\u5EFA\u6210\u529F":"\u6A21\u677F\u4FDD\u5B58\u6210\u529F"),this.loadTemplates(),this.isCreating.set(!1)):this.toastService.error(b.error||"\u4FDD\u5B58\u5931\u6557")});this.listeners.push(l);let u=this.ipcService.on("delete-chat-template-result",b=>{b.success&&(this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664"),this.selectedTemplate.set(null),this.loadTemplates())});this.listeners.push(u)}loadTemplates(){this.isLoading.set(!0),console.log("[ChatTemplates] Sending get-chat-templates request"),this.ipcService.send("get-chat-templates"),setTimeout(()=>{this.isLoading()&&this.templates().length===0&&this.retryCount<this.MAX_RETRIES?(this.retryCount++,console.log(`[ChatTemplates] Retrying... (${this.retryCount}/${this.MAX_RETRIES})`),this.ipcService.send("get-chat-templates")):this.isLoading()&&this.isLoading.set(!1)},3e3)}updateTemplates(t){let e=t.map(l=>{let u=[];if(l.variables)if(typeof l.variables=="string")try{u=JSON.parse(l.variables)}catch{u=[]}else Array.isArray(l.variables)&&(u=l.variables);return{id:String(l.id),name:l.name,content:l.content||"",templateType:l.template_type||l.templateType||"custom",variables:u,usageCount:l.usage_count||l.usageCount||0,lastUsed:l.last_used||l.lastUsed,isActive:l.is_active!==!1&&l.isActive!==!1,createdAt:l.created_at||l.createdAt,updatedAt:l.updated_at||l.updatedAt}});this.templates.set(e),this.isLoading.set(!1);let r=this.selectedTemplate();if(r){let l=e.find(u=>u.id===r.id);l&&(this.selectedTemplate.set(l),this.editingTemplate=R({},l))}}createEmptyTemplate(){return{id:"",name:"",content:"",templateType:"custom",variables:[],usageCount:0,isActive:!0}}getTypeConfig(t){return Ve[t]||Ve.custom}formatDate(t){try{return new Date(t).toLocaleDateString()}catch{return t}}createNewTemplate(){this.selectedTemplate.set(null),this.isCreating.set(!0),this.editingTemplate=this.createEmptyTemplate()}selectTemplate(t){this.selectedTemplate.set(t),this.isCreating.set(!1),this.editingTemplate=R({},t)}insertVariable(t){this.editingTemplate.content+=`{{${t}}}`}saveTemplate(){if(console.log("[ChatTemplates] saveTemplate called, isCreating:",this.isCreating()),console.log("[ChatTemplates] editingTemplate:",this.editingTemplate),!this.editingTemplate.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31");return}if(!this.editingTemplate.content.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9");return}let t=[],e=/\{\{(\w+)\}\}/g,r;for(;(r=e.exec(this.editingTemplate.content))!==null;)t.includes(r[1])||t.push(r[1]);let l={id:this.isCreating()?null:parseInt(this.editingTemplate.id),name:this.editingTemplate.name,content:this.editingTemplate.content,category:this.editingTemplate.templateType,variables:t,isActive:this.editingTemplate.isActive};console.log("[ChatTemplates] Sending save-chat-template:",l),this.ipcService.send("save-chat-template",l),this.toastService.info("\u6B63\u5728\u4FDD\u5B58...")}async deleteTemplate(){if(!this.selectedTemplate())return;let t=this.selectedTemplate();await this.confirmDialog.danger("\u522A\u9664\u804A\u5929\u6A21\u677F",`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F\u300C${t.name}\u300D\u55CE\uFF1F
\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,[t.name])&&this.ipcService.send("delete-chat-template",{id:parseInt(t.id)})}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-chat-templates"]],decls:28,vars:12,consts:[[1,"h-full","flex","bg-slate-900"],[1,"w-80","flex-shrink-0","border-r","border-slate-700/50","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-2"],[1,"text-xl"],[1,"font-bold","text-white"],[1,"text-xs","text-slate-500"],[1,"w-8","h-8","bg-pink-500/20","hover:bg-pink-500/30","text-pink-400","rounded-lg","flex","items-center","justify-center","transition-colors",3,"click"],[1,"flex","flex-wrap","gap-2","mb-3"],[1,"px-2","py-1","rounded-lg","text-xs","transition-colors",3,"click"],[1,"px-2","py-1","rounded-lg","text-xs","transition-colors","flex","items-center","gap-1",3,"bg-pink-500/20","text-pink-400","bg-slate-700/50","text-slate-400"],[1,"relative"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-500"],["type","text","placeholder","\u641C\u7D22\u6A21\u677F...",1,"w-full","pl-10","pr-4","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","focus:border-pink-500","text-sm",3,"ngModelChange","ngModel"],[1,"flex-1","overflow-y-auto","p-2"],[1,"p-4","text-center","text-slate-500"],[1,"flex-1","flex","flex-col"],[1,"flex-1","flex","items-center","justify-center"],[1,"px-2","py-1","rounded-lg","text-xs","transition-colors","flex","items-center","gap-1",3,"click"],[1,"mt-2","text-pink-400","hover:underline","text-sm",3,"click"],[1,"p-3","rounded-xl","mb-2","cursor-pointer","transition-all",3,"bg-pink-500/20","border-pink-500/50","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-700/50"],[1,"p-3","rounded-xl","mb-2","cursor-pointer","transition-all",3,"click"],[1,"flex","items-center","justify-between","mb-2"],[1,"font-medium","text-white"],[1,"text-xs","px-2","py-0.5","rounded-full"],[1,"text-xs","text-slate-400","line-clamp-2","mb-2"],[1,"flex","items-center","gap-3","text-xs","text-slate-500"],[1,"text-center"],[1,"w-24","h-24","bg-slate-800","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-5xl"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-slate-400","mb-4"],[1,"px-4","py-2","bg-gradient-to-r","from-pink-500","to-rose-500","text-white","rounded-lg",3,"click"],[1,"p-6","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex-1","flex","items-center","gap-4"],["type","text","placeholder","\u6A21\u677F\u540D\u7A31",1,"text-xl","font-bold","text-white","bg-transparent","border-none","focus:ring-0","p-0",3,"ngModelChange","ngModel"],[1,"px-3","py-1.5","bg-slate-800","border","border-slate-700","rounded-lg","text-sm","text-white",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-pink-500","focus:ring-pink-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-400"],[1,"px-4","py-2","bg-gradient-to-r","from-pink-500","to-rose-500","hover:from-pink-600","hover:to-rose-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors"],[1,"flex-1","overflow-y-auto","p-6"],[1,"mb-6"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],["rows","8",1,"w-full","px-4","py-3","bg-slate-800","border","border-slate-700","rounded-xl","text-white","placeholder-slate-500","focus:border-pink-500","resize-none",3,"ngModelChange","ngModel"],[1,"mb-6","p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"text-sm","font-medium","text-slate-300","mb-3","flex","items-center","gap-2"],[1,"grid","grid-cols-2","lg:grid-cols-3","gap-2"],[1,"p-2","bg-slate-700/50","hover:bg-slate-600/50","rounded-lg","cursor-pointer","transition-colors","group"],[1,"text-sm","font-medium","text-slate-300","mb-2","flex","items-center","gap-2"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"flex","gap-3"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-pink-500","to-rose-500","flex","items-center","justify-center","text-white"],[1,"flex-1"],[1,"bg-slate-700/50","rounded-2xl","rounded-tl-md","p-3","max-w-md"],[1,"text-white","whitespace-pre-wrap"],[1,"text-xs","text-slate-500","mt-1"],[1,"px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors",3,"click"],[1,"p-2","bg-slate-700/50","hover:bg-slate-600/50","rounded-lg","cursor-pointer","transition-colors","group",3,"click"],[1,"text-pink-400","text-sm"],[1,"text-xs","text-slate-500","opacity-0","group-hover:opacity-100"],[1,"text-xs","text-slate-400","mt-1"],[1,"grid","grid-cols-3","gap-4"],[1,"text-2xl","font-bold","text-pink-400"],[1,"text-2xl","font-bold","text-blue-400"],[1,"text-sm","font-medium","text-slate-300"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),o(6,"\u{1F4AC}"),i(),n(7,"h2",6),o(8,"\u804A\u5929\u6A21\u677F"),i(),n(9,"span",7),o(10),i()(),n(11,"button",8),p("click",function(){return r.createNewTemplate()}),o(12," + "),i()(),n(13,"div",9)(14,"button",10),p("click",function(){return r.filterType="all"}),o(15," \u5168\u90E8 "),i(),T(16,Hi,2,10,"button",11,qe),i(),n(18,"div",12)(19,"span",13),o(20,"\u{1F50D}"),i(),n(21,"input",14),V("ngModelChange",function(u){return I(r.searchQuery,u)||(r.searchQuery=u),u}),i()()(),n(22,"div",15),x(23,$i,5,1,"div",16)(24,Qi,2,0),i()(),n(25,"div",17),x(26,Ji,11,0,"div",18)(27,tn,45,9),i()()),e&2&&(s(10),v("(",r.templates().length,")"),s(4),S("bg-pink-500/20",r.filterType==="all")("text-pink-400",r.filterType==="all")("bg-slate-700/50",r.filterType!=="all")("text-slate-400",r.filterType!=="all"),s(2),A(r.templateTypeEntries),s(5),M("ngModel",r.searchQuery),s(2),_(r.filteredTemplates().length===0?23:24),s(3),_(!r.selectedTemplate()&&!r.isCreating()?26:27))},dependencies:[K,W,ce,me,ee,de,ue,te,ie],encapsulation:2})}};var nn=(a,t)=>t.id;function on(a,t){if(a&1&&F(0,"img",34),a&2){let e=d().$implicit;k("src",e.avatar,Ae)("alt",e.username)}}function rn(a,t){if(a&1&&(n(0,"div",35),o(1),i()),a&2){let e=d().$implicit;s(),v(" ",(e.username||e.phone||"?")[0].toUpperCase()," ")}}function ln(a,t){a&1&&(n(0,"span",38),o(1,"\u76E3\u807D"),i())}function an(a,t){a&1&&(n(0,"span",39),o(1,"\u767C\u9001"),i())}function sn(a,t){if(a&1){let e=y();n(0,"div",33),p("click",function(){let l=c(e).$implicit,u=d();return m(u.selectAccount(l))}),n(1,"div",2),x(2,on,1,2,"img",34)(3,rn,2,1,"div",35),n(4,"div")(5,"div",36),o(6),i(),n(7,"div",14),o(8),i(),n(9,"div",37),x(10,ln,2,0,"span",38),x(11,an,2,0,"span",39),i()()(),n(12,"div",2)(13,"div",40),F(14,"span",41),n(15,"span",42),o(16),i()(),Y(),n(17,"svg",43),F(18,"path",44),i()()()}if(a&2){let e,r,l=t.$implicit,u=d();S("border-cyan-500/50",((e=u.selectedAccount())==null?null:e.id)===l.id)("bg-slate-700",((r=u.selectedAccount())==null?null:r.id)===l.id),s(2),_(l.avatar?2:3),s(4),v(" ",l.username||l.phone," "),s(2),C(l.phone),s(2),_(l.isListener?10:-1),s(),_(l.isSender?11:-1),s(3),S("bg-emerald-500",l.status==="connected")("bg-red-500",l.status==="error")("bg-slate-500",l.status==="disconnected"),s(2),v(" ",l.status==="connected"?"\u5DF2\u9023\u63A5":l.status==="error"?"\u932F\u8AA4":"\u672A\u9023\u63A5"," ")}}function dn(a,t){if(a&1){let e=y();n(0,"div",31)(1,"div",45),o(2,"\u{1F464}"),i(),n(3,"h3",46),o(4,"\u66AB\u7121\u76E3\u63A7\u5E33\u865F"),i(),n(5,"p",47),o(6,"\u8ACB\u5728\u5E33\u6236\u7BA1\u7406\u4E2D\u6DFB\u52A0\u5E33\u865F\u4E26\u8A2D\u70BA\u76E3\u807D\u89D2\u8272"),i(),n(7,"button",48),p("click",function(){c(e);let l=d();return m(l.navigateToAccountManagement())}),o(8," + \u6DFB\u52A0\u5E33\u865F "),i()()}}function un(a,t){if(a&1&&F(0,"img",52),a&2){let e=d(2);k("src",e.selectedAccount().avatar,Ae)}}function cn(a,t){if(a&1&&(n(0,"div",53),o(1),i()),a&2){let e=d(2);s(),v(" ",(e.selectedAccount().username||e.selectedAccount().phone||"?")[0].toUpperCase()," ")}}function mn(a,t){if(a&1){let e=y();n(0,"div",32)(1,"div",49)(2,"h3",27)(3,"span"),o(4,"\u{1F4CB}"),i(),o(5," \u5E33\u865F\u8A73\u60C5 "),i()(),n(6,"div",50)(7,"div",51),x(8,un,1,1,"img",52)(9,cn,2,1,"div",53),n(10,"h4",54),o(11),i(),n(12,"p",6),o(13),i(),n(14,"div",55),F(15,"span",41),n(16,"span",56),o(17),i()()(),n(18,"div",57)(19,"div",58)(20,"div",59),o(21),i(),n(22,"div",14),o(23,"\u4ECA\u65E5\u767C\u9001"),i()(),n(24,"div",58)(25,"div",60),o(26),i(),n(27,"div",14),o(28,"\u767C\u9001\u914D\u984D"),i()(),n(29,"div",58)(30,"div",61),o(31),i(),n(32,"div",14),o(33,"\u5065\u5EB7\u5EA6"),i()(),n(34,"div",58)(35,"div",62),o(36),i(),n(37,"div",14),o(38,"\u672C\u9031\u56DE\u8986"),i()()(),n(39,"div",63)(40,"h4",64),o(41,"\u89D2\u8272\u8A2D\u7F6E"),i(),n(42,"div",65)(43,"div",66)(44,"div",40)(45,"span",16),o(46,"\u{1F441}\uFE0F"),i(),n(47,"span",67),o(48,"\u76E3\u807D\u89D2\u8272"),i()(),n(49,"label",68)(50,"input",69),p("change",function(){c(e);let l=d();return m(l.toggleListener())}),i(),n(51,"div",70),F(52,"div",71),i()()(),n(53,"div",66)(54,"div",40)(55,"span",19),o(56,"\u{1F4E4}"),i(),n(57,"span",67),o(58,"\u767C\u9001\u89D2\u8272"),i()(),n(59,"label",68)(60,"input",69),p("change",function(){c(e);let l=d();return m(l.toggleSender())}),i(),n(61,"div",70),F(62,"div",71),i()()()()(),n(63,"div",72)(64,"button",73),p("click",function(){c(e);let l=d();return m(l.viewAccountDetails())}),n(65,"span"),o(66,"\u{1F4CB}"),i(),o(67," \u67E5\u770B\u5B8C\u6574\u8A73\u60C5 "),i()()()()}if(a&2){let e,r,l=d();s(8),_(l.selectedAccount().avatar?8:9),s(3),C(l.selectedAccount().username||l.selectedAccount().phone),s(2),C(l.selectedAccount().phone),s(2),S("bg-emerald-500",l.selectedAccount().status==="connected")("bg-red-500",l.selectedAccount().status==="error")("bg-slate-500",l.selectedAccount().status==="disconnected"),s(),S("text-emerald-400",l.selectedAccount().status==="connected")("text-red-400",l.selectedAccount().status==="error")("text-slate-400",l.selectedAccount().status==="disconnected"),s(),v(" ",l.selectedAccount().status==="connected"?"\u5DF2\u9023\u63A5":l.selectedAccount().status==="error"?"\u9023\u63A5\u932F\u8AA4":"\u672A\u9023\u63A5"," "),s(4),C(((e=l.selectedAccount().stats)==null?null:e.sentToday)||0),s(5),j("",l.selectedAccount().dailySendCount||0,"/",l.selectedAccount().dailySendLimit||50),s(5),v("",l.selectedAccount().healthScore||100,"%"),s(5),C(((r=l.selectedAccount().stats)==null?null:r.repliesWeek)||0),s(14),k("checked",l.selectedAccount().isListener),s(),S("bg-blue-500",l.selectedAccount().isListener)("bg-slate-600",!l.selectedAccount().isListener),s(),S("left-4",l.selectedAccount().isListener)("left-0",!l.selectedAccount().isListener),s(8),k("checked",l.selectedAccount().isSender),s(),S("bg-green-500",l.selectedAccount().isSender)("bg-slate-600",!l.selectedAccount().isSender),s(),S("left-4",l.selectedAccount().isSender)("left-0",!l.selectedAccount().isSender)}}var we=class a{constructor(){this.stateService=D(z);this.ipcService=D(O);this.toastService=D(H);this.configAction=J();this.selectedAccount=w(null)}ngOnInit(){this.stateService.loadAll()}refreshData(){this.stateService.refresh(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u5E33\u865F\u5217\u8868...")}selectAccount(t){this.selectedAccount.set(t)}navigateToAccountManagement(){this.configAction.emit("goto-account-management"),this.toastService.info("\u8ACB\u5728\u300C\u5E33\u6236\u7BA1\u7406\u300D\u4E2D\u6DFB\u52A0\u5E33\u865F")}handleConfigAction(t){this.configAction.emit(t)}toggleListener(){let t=this.selectedAccount();if(!t)return;let e=t.isListener?t.isSender?"Sender":"":"Listener";this.ipcService.send("update-account",{accountId:t.id,phone:t.phone,role:e}),this.selectedAccount.update(r=>r?P(R({},r),{isListener:!r.isListener}):null),this.toastService.success(t.isListener?`\u5DF2\u53D6\u6D88 ${t.username||t.phone} \u7684\u76E3\u807D\u89D2\u8272`:`\u5DF2\u5C07 ${t.username||t.phone} \u8A2D\u70BA\u76E3\u807D\u5E33\u865F`)}toggleSender(){let t=this.selectedAccount();if(!t)return;let e=t.isSender?t.isListener?"Listener":"":"Sender";this.ipcService.send("update-account",{accountId:t.id,phone:t.phone,role:e}),this.selectedAccount.update(r=>r?P(R({},r),{isSender:!r.isSender}):null),this.toastService.success(t.isSender?`\u5DF2\u53D6\u6D88 ${t.username||t.phone} \u7684\u767C\u9001\u89D2\u8272`:`\u5DF2\u5C07 ${t.username||t.phone} \u8A2D\u70BA\u767C\u9001\u5E33\u865F`)}viewAccountDetails(){this.configAction.emit("goto-account-management")}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-monitoring-accounts"]],outputs:{configAction:"configAction"},decls:75,vars:9,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-cyan-500","to-blue-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-blue-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-blue-400"],[1,"text-2xl","font-bold","text-blue-400"],[1,"w-10","h-10","bg-green-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-green-400"],[1,"text-2xl","font-bold","text-green-400"],[1,"w-10","h-10","bg-purple-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-purple-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"flex-1","overflow-hidden","flex","gap-6"],[1,"flex-1","bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex-1","overflow-y-auto","p-4","space-y-3"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"border-cyan-500/50","bg-slate-700"],[1,"text-center","py-12","text-slate-400"],[1,"w-96","bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","flex","flex-col"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"click"],[1,"w-10","h-10","rounded-full","object-cover",3,"src","alt"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold"],[1,"text-sm","font-medium","text-white"],[1,"flex","items-center","gap-2","text-xs","mt-1"],[1,"px-1.5","py-0.5","bg-blue-500/20","text-blue-400","rounded"],[1,"px-1.5","py-0.5","bg-green-500/20","text-green-400","rounded"],[1,"flex","items-center","gap-2"],[1,"w-2","h-2","rounded-full"],[1,"text-xs","text-slate-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500","group-hover:text-cyan-400","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-5xl","mb-4"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-sm","mb-4"],[1,"px-4","py-2","bg-cyan-500/20","text-cyan-400","rounded-lg","hover:bg-cyan-500/30","transition-colors",3,"click"],[1,"p-4","border-b","border-slate-700/50"],[1,"flex-1","overflow-y-auto","p-4","space-y-4"],[1,"bg-slate-700/30","rounded-xl","p-4","text-center"],[1,"w-20","h-20","rounded-full","mx-auto","mb-3","object-cover",3,"src"],[1,"w-20","h-20","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","text-2xl","font-bold","mx-auto","mb-3"],[1,"text-lg","font-medium","text-white"],[1,"flex","items-center","justify-center","gap-2","mt-2"],[1,"text-sm"],[1,"grid","grid-cols-2","gap-3"],[1,"bg-slate-700/30","rounded-lg","p-3","text-center"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-white"],[1,"text-xl","font-bold","text-emerald-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"bg-slate-700/30","rounded-xl","p-4"],[1,"text-sm","font-medium","text-slate-300","mb-3"],[1,"space-y-3"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-white"],[1,"relative","inline-flex","cursor-pointer"],["type","checkbox",1,"sr-only",3,"change","checked"],[1,"w-9","h-5","rounded-full","transition-all"],[1,"absolute","w-4","h-4","bg-white","rounded-full","top-0.5","transition-all"],[1,"space-y-2"],[1,"w-full","px-4","py-2.5","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors","flex","items-center","justify-center","gap-2",3,"click"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),o(5,"\u{1F916}"),i()(),n(6,"div")(7,"h1",5),o(8,"\u76E3\u63A7\u5E33\u865F\u7BA1\u7406"),i(),n(9,"p",6),o(10,"\u7BA1\u7406\u7528\u65BC\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u7684 Telegram \u5E33\u865F"),i()()(),n(11,"div",2)(12,"app-config-progress",7),p("action",function(u){return r.handleConfigAction(u)}),i(),n(13,"button",8),p("click",function(){return r.refreshData()}),n(14,"span"),o(15,"\u{1F504}"),i(),n(16,"span"),o(17,"\u5237\u65B0"),i()()()(),n(18,"div",9)(19,"div",10)(20,"div",2)(21,"div",11)(22,"span",12),o(23,"\u2713"),i()(),n(24,"div")(25,"div",13),o(26),i(),n(27,"div",14),o(28,"\u5DF2\u9023\u63A5"),i()()()(),n(29,"div",10)(30,"div",2)(31,"div",15)(32,"span",16),o(33,"\u{1F441}\uFE0F"),i()(),n(34,"div")(35,"div",17),o(36),i(),n(37,"div",14),o(38,"\u76E3\u807D\u5E33\u865F"),i()()()(),n(39,"div",10)(40,"div",2)(41,"div",18)(42,"span",19),o(43,"\u{1F4E4}"),i()(),n(44,"div")(45,"div",20),o(46),i(),n(47,"div",14),o(48,"\u767C\u9001\u5E33\u865F"),i()()()(),n(49,"div",10)(50,"div",2)(51,"div",21)(52,"span",22),o(53,"\u{1F4CA}"),i()(),n(54,"div")(55,"div",23),o(56),i(),n(57,"div",14),o(58,"\u7E3D\u5E33\u865F"),i()()()()(),n(59,"div",24)(60,"div",25)(61,"div",26)(62,"h3",27)(63,"span"),o(64,"\u{1F916}"),i(),o(65," \u76E3\u63A7\u5E33\u865F "),n(66,"span",14),o(67),i()(),n(68,"button",28),p("click",function(){return r.navigateToAccountManagement()}),o(69," + \u6DFB\u52A0\u5E33\u865F "),i()(),n(70,"div",29),T(71,sn,19,16,"div",30,nn,!1,dn,9,0,"div",31),i()(),x(74,mn,68,39,"div",32),i()()),e&2&&(s(14),S("animate-spin",r.stateService.isLoading()),s(12),C(r.stateService.connectedAccounts().length),s(10),C(r.stateService.listenerAccounts().length),s(10),C(r.stateService.senderAccounts().length),s(10),C(r.stateService.accounts().length),s(11),v("(",r.stateService.accounts().length,")"),s(4),A(r.stateService.accounts()),s(3),_(r.selectedAccount()?74:-1))},dependencies:[K,W,ne],encapsulation:2})}};var pn=()=>["S","A","B","C","D"],gn=(a,t)=>t.telegram_id;function xn(a,t){if(a&1){let e=y();n(0,"button",44),p("click",function(){let l=c(e).$implicit,u=d();return m(u.toggleValueLevel(l))}),o(1),i()}if(a&2){let e=t.$implicit,r=d();S("bg-violet-500/20",r.selectedValueLevels.includes(e))("text-violet-400",r.selectedValueLevels.includes(e))("bg-slate-700",!r.selectedValueLevels.includes(e))("text-slate-400",!r.selectedValueLevels.includes(e)),s(),v(" ",e," ")}}function _n(a,t){a&1&&(n(0,"div",40),F(1,"div",45),i())}function fn(a,t){a&1&&(n(0,"div",41)(1,"span",46),o(2,"\u{1F4ED}"),i(),n(3,"p"),o(4,"\u66AB\u7121\u6536\u96C6\u7684\u7528\u6236"),i(),n(5,"p",47),o(6,"\u958B\u555F\u7FA4\u7D44\u76E3\u63A7\u5F8C\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u6536\u96C6\u767C\u8A00\u8005"),i()())}function Cn(a,t){a&1&&o(0," \u{1F6AB} ")}function vn(a,t){a&1&&o(0," \u26D4 ")}function bn(a,t){a&1&&o(0," \u{1F464} ")}function hn(a,t){if(a&1&&o(0),a&2){let e=d().$implicit;v(" ",(e.first_name||e.username||"?")[0].toUpperCase()," ")}}function Sn(a,t){if(a&1&&(n(0,"span",13),o(1),i()),a&2){let e=d().$implicit;s(),v("@",e.username)}}function En(a,t){a&1&&(n(0,"span",53),o(1,"\u{1F48E}"),i())}function yn(a,t){a&1&&(n(0,"span",53),o(1,"\u2713"),i())}function wn(a,t){if(a&1){let e=y();n(0,"div",49),p("click",function(){let l=c(e).$implicit,u=d(2);return m(u.selectUser(l))}),n(1,"div",2)(2,"div",50),x(3,Cn,1,0)(4,vn,1,0)(5,bn,1,0)(6,hn,1,1),i(),n(7,"div",51)(8,"div",28)(9,"span",52),o(10),i(),x(11,Sn,2,1,"span",13),x(12,En,2,0,"span",53),x(13,yn,2,0,"span",53),i(),n(14,"div",54)(15,"span"),o(16),i(),n(17,"span"),o(18),i()()(),n(19,"div",55)(20,"div",56),o(21),i(),n(22,"div",57),o(23),i()()()()}if(a&2){let e,r,l,u,b,h=t.$implicit,E=d(2);S("bg-violet-500/10",((e=E.selectedUser())==null?null:e.telegram_id)===h.telegram_id)("border-violet-500/50",((r=E.selectedUser())==null?null:r.telegram_id)===h.telegram_id)("bg-slate-800/50",((l=E.selectedUser())==null?null:l.telegram_id)!==h.telegram_id)("border-slate-700/50",((u=E.selectedUser())==null?null:u.telegram_id)!==h.telegram_id)("hover:bg-slate-700/50",((b=E.selectedUser())==null?null:b.telegram_id)!==h.telegram_id),s(2),S("bg-emerald-500/20",h.ad_risk_score<.4)("bg-amber-500/20",h.ad_risk_score>=.4&&h.ad_risk_score<.7)("bg-red-500/20",h.ad_risk_score>=.7),s(),_(h.is_ad_account?3:h.is_blacklisted?4:h.has_photo?6:5),s(7),v(" ",h.first_name||h.username||"ID:"+h.telegram_id," "),s(),_(h.username?11:-1),s(),_(h.is_premium?12:-1),s(),_(h.is_verified?13:-1),s(3),v("\u{1F4CA} ",h.message_count," \u689D\u6D88\u606F"),s(2),v("\u{1F465} ",h.groups_count," \u500B\u7FA4"),s(2),S("text-emerald-400",h.ad_risk_score<.4)("text-amber-400",h.ad_risk_score>=.4&&h.ad_risk_score<.7)("text-red-400",h.ad_risk_score>=.7),s(),v(" ",(h.ad_risk_score*100).toFixed(0),"% "),s(),S("bg-violet-500/20",h.value_level==="S")("text-violet-400",h.value_level==="S")("bg-blue-500/20",h.value_level==="A")("text-blue-400",h.value_level==="A")("bg-emerald-500/20",h.value_level==="B")("text-emerald-400",h.value_level==="B")("bg-slate-500/20",h.value_level==="C"||h.value_level==="D")("text-slate-400",h.value_level==="C"||h.value_level==="D"),s(),v(" ",h.value_level,"\u7D1A ")}}function Dn(a,t){if(a&1&&(n(0,"div",42),T(1,wn,24,47,"div",48,gn),i()),a&2){let e=d();s(),A(e.filteredUsers())}}function Tn(a,t){if(a&1&&(n(0,"div",60)(1,"span",61),o(2,"\u7528\u6236\u540D"),i(),n(3,"span",24),o(4),i()()),a&2){let e=d(2);s(4),v("@",e.selectedUser().username)}}function An(a,t){if(a&1&&(n(0,"div",77)(1,"span",18),o(2,"\u26A0\uFE0F"),i(),n(3,"span",78),o(4),i()()),a&2){let e=t.$implicit;s(4),C(e.description)}}function kn(a,t){if(a&1&&(n(0,"div",68)(1,"h4",75),o(2,"\u98A8\u96AA\u56E0\u7D20"),i(),n(3,"div",76),T(4,An,5,1,"div",77,Pe),i()()),a&2){let e=d(2);s(4),A(e.selectedUser().risk_factors.factors)}}function Fn(a,t){if(a&1){let e=y();n(0,"button",79),p("click",function(){c(e);let l=d(2);return m(l.markAsAd(!0))}),o(1," \u{1F6AB} \u6A19\u8A18\u70BA\u5EE3\u544A\u865F "),i()}}function Mn(a,t){if(a&1){let e=y();n(0,"button",80),p("click",function(){c(e);let l=d(2);return m(l.markAsAd(!1))}),o(1," \u2713 \u53D6\u6D88\u5EE3\u544A\u6A19\u8A18 "),i()}}function In(a,t){if(a&1){let e=y();n(0,"button",81),p("click",function(){c(e);let l=d(2);return m(l.blacklistUser(!0))}),o(1," \u26D4 \u52A0\u5165\u9ED1\u540D\u55AE "),i()}}function Vn(a,t){if(a&1){let e=y();n(0,"button",81),p("click",function(){c(e);let l=d(2);return m(l.blacklistUser(!1))}),o(1," \u21A9\uFE0F \u79FB\u51FA\u9ED1\u540D\u55AE "),i()}}function Rn(a,t){if(a&1){let e=y();n(0,"button",82),p("click",function(){c(e);let l=d(2);return m(l.openInTelegram())}),o(1," \u{1F4AC} \u5728 Telegram \u67E5\u770B "),i()}}function Bn(a,t){if(a&1){let e=y();n(0,"div",43)(1,"h3",58)(2,"span"),o(3,"\u{1F4CB}"),i(),o(4," \u7528\u6236\u8A73\u60C5 "),i(),n(5,"div",59)(6,"div",60)(7,"span",61),o(8,"Telegram ID"),i(),n(9,"span",62),o(10),i()(),x(11,Tn,5,1,"div",60),n(12,"div",60)(13,"span",61),o(14,"\u59D3\u540D"),i(),n(15,"span",63),o(16),i()()(),n(17,"div",64)(18,"div",65)(19,"span",6),o(20,"\u5EE3\u544A\u98A8\u96AA"),i(),n(21,"span",56),o(22),i()(),n(23,"div",66),F(24,"div",67),i()(),x(25,kn,6,0,"div",68),n(26,"div",69),x(27,Fn,2,0,"button",70)(28,Mn,2,0,"button",71),x(29,In,2,0,"button",72)(30,Vn,2,0,"button",72),n(31,"button",73),p("click",function(){c(e);let l=d();return m(l.recalculateRisk())}),o(32," \u{1F504} \u91CD\u65B0\u8A08\u7B97\u98A8\u96AA "),i(),x(33,Rn,2,0,"button",74),i()()}if(a&2){let e,r=d();s(10),C(r.selectedUser().telegram_id),s(),_(r.selectedUser().username?11:-1),s(5),j("",r.selectedUser().first_name," ",r.selectedUser().last_name),s(5),S("text-emerald-400",r.selectedUser().ad_risk_score<.4)("text-amber-400",r.selectedUser().ad_risk_score>=.4&&r.selectedUser().ad_risk_score<.7)("text-red-400",r.selectedUser().ad_risk_score>=.7),s(),v(" ",(r.selectedUser().ad_risk_score*100).toFixed(1),"% "),s(2),se("width",r.selectedUser().ad_risk_score*100,"%"),S("bg-emerald-500",r.selectedUser().ad_risk_score<.4)("bg-amber-500",r.selectedUser().ad_risk_score>=.4&&r.selectedUser().ad_risk_score<.7)("bg-red-500",r.selectedUser().ad_risk_score>=.7),s(),_(!((e=r.selectedUser().risk_factors)==null||e.factors==null)&&e.factors.length?25:-1),s(2),_(r.selectedUser().is_ad_account?28:27),s(2),_(r.selectedUser().is_blacklisted?30:29),s(4),_(r.selectedUser().username?33:-1)}}var De=class a{constructor(){this.ipcService=D(O);this.toastService=D(H);this.confirmDialog=D(q);this.users=w([]);this.stats=w(null);this.selectedUser=w(null);this.isLoading=w(!1);this.filterRisk="all";this.selectedValueLevels=[];this.filterHasUsername=!1;this.filterExcludeAds=!0;this.searchQuery="";this.listeners=[];this.filteredUsers=N(()=>{let t=this.users();if(this.filterRisk==="low"?t=t.filter(e=>e.ad_risk_score<.4):this.filterRisk==="medium"?t=t.filter(e=>e.ad_risk_score>=.4&&e.ad_risk_score<.7):this.filterRisk==="high"&&(t=t.filter(e=>e.ad_risk_score>=.7)),this.selectedValueLevels.length>0&&(t=t.filter(e=>this.selectedValueLevels.includes(e.value_level))),this.filterHasUsername&&(t=t.filter(e=>e.username)),this.filterExcludeAds&&(t=t.filter(e=>!e.is_ad_account)),this.searchQuery){let e=this.searchQuery.toLowerCase();t=t.filter(r=>r.username?.toLowerCase().includes(e)||r.first_name?.toLowerCase().includes(e)||r.telegram_id.includes(e))}return t})}ngOnInit(){this.setupListeners(),this.loadData()}ngOnDestroy(){this.listeners.forEach(t=>t())}setupListeners(){let t=this.ipcService.on("collected-users-result",b=>{this.isLoading.set(!1),b.success&&this.users.set(b.users||[])});this.listeners.push(t);let e=this.ipcService.on("collected-users-stats-result",b=>{b.success&&this.stats.set(b.stats)});this.listeners.push(e);let r=this.ipcService.on("mark-user-as-ad-result",b=>{b.success&&(this.toastService.success(b.isAd?"\u5DF2\u6A19\u8A18\u70BA\u5EE3\u544A\u865F":"\u5DF2\u53D6\u6D88\u5EE3\u544A\u6A19\u8A18"),this.loadData())});this.listeners.push(r);let l=this.ipcService.on("blacklist-user-result",b=>{b.success&&(this.toastService.success(b.blacklisted?"\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE":"\u5DF2\u79FB\u51FA\u9ED1\u540D\u55AE"),this.loadData())});this.listeners.push(l);let u=this.ipcService.on("recalculate-risk-result",b=>{b.success&&(this.toastService.success(`\u98A8\u96AA\u8A55\u5206\u5DF2\u66F4\u65B0: ${(b.riskScore*100).toFixed(1)}%`),this.loadData())});this.listeners.push(u)}loadData(){this.isLoading.set(!0),this.ipcService.send("get-collected-users",{filters:{exclude_blacklist:!1,order_by:"last_seen_at DESC"},limit:500}),this.ipcService.send("get-collected-users-stats",{})}refreshData(){this.loadData()}onSearchChange(){}toggleValueLevel(t){let e=this.selectedValueLevels.indexOf(t);e>=0?this.selectedValueLevels.splice(e,1):this.selectedValueLevels.push(t)}selectUser(t){this.selectedUser.set(t)}markAsAd(t){let e=this.selectedUser();e&&this.ipcService.send("mark-user-as-ad",{telegramId:e.telegram_id,isAd:t})}blacklistUser(t){let e=this.selectedUser();e&&this.ipcService.send("blacklist-user",{telegramId:e.telegram_id,blacklist:t})}recalculateRisk(){let t=this.selectedUser();t&&this.ipcService.send("recalculate-user-risk",{telegramId:t.telegram_id})}openInTelegram(){let t=this.selectedUser();t?.username&&window.open(`https://t.me/${t.username}`,"_blank")}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-collected-users"]],decls:107,vars:45,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-violet-500","to-purple-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-5","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-violet-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-violet-400"],[1,"text-2xl","font-bold","text-violet-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"w-10","h-10","bg-amber-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-amber-400"],[1,"text-2xl","font-bold","text-amber-400"],[1,"w-10","h-10","bg-red-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-red-400"],[1,"text-2xl","font-bold","text-red-400"],[1,"w-10","h-10","bg-cyan-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-cyan-400"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"bg-slate-800/30","rounded-xl","border","border-slate-700/50","p-4","mb-4"],[1,"flex","flex-wrap","items-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"flex","gap-1"],[1,"px-3","py-1","rounded","text-xs","transition-colors",3,"click"],[1,"w-7","h-7","rounded","text-xs","font-bold","transition-colors",3,"bg-violet-500/20","text-violet-400","bg-slate-700","text-slate-400"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-violet-500",3,"ngModelChange","ngModel"],[1,"flex-1"],[1,"relative"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-500"],["type","text","placeholder","\u641C\u7D22\u7528\u6236\u540D...",1,"pl-10","pr-4","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","text-sm","w-48",3,"ngModelChange","ngModel"],[1,"flex-1","overflow-hidden","flex","gap-4"],[1,"flex-1","overflow-y-auto"],[1,"flex","items-center","justify-center","h-40"],[1,"flex","flex-col","items-center","justify-center","h-40","text-slate-500"],[1,"grid","gap-2"],[1,"w-96","bg-slate-800/30","rounded-xl","border","border-slate-700/50","p-4","overflow-y-auto"],[1,"w-7","h-7","rounded","text-xs","font-bold","transition-colors",3,"click"],[1,"animate-spin","w-8","h-8","border-4","border-violet-500","border-t-transparent","rounded-full"],[1,"text-4xl","mb-2"],[1,"text-sm"],[1,"p-4","rounded-xl","cursor-pointer","transition-all","border",3,"bg-violet-500/10","border-violet-500/50","bg-slate-800/50","border-slate-700/50","hover:bg-slate-700/50"],[1,"p-4","rounded-xl","cursor-pointer","transition-all","border",3,"click"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","text-lg"],[1,"flex-1","min-w-0"],[1,"font-medium","text-white","truncate"],[1,"text-xs"],[1,"flex","items-center","gap-3","text-xs","text-slate-400","mt-1"],[1,"text-right"],[1,"text-lg","font-bold"],[1,"text-xs","px-2","py-0.5","rounded"],[1,"text-lg","font-bold","text-white","mb-4","flex","items-center","gap-2"],[1,"space-y-3","mb-6"],[1,"flex","justify-between"],[1,"text-slate-400"],[1,"text-white","font-mono"],[1,"text-white"],[1,"bg-slate-700/30","rounded-lg","p-3","mb-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"w-full","h-2","bg-slate-600","rounded-full","overflow-hidden"],[1,"h-full","transition-all"],[1,"mb-4"],[1,"space-y-2"],[1,"w-full","px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors"],[1,"w-full","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","transition-colors"],[1,"w-full","px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors"],[1,"w-full","px-4","py-2","bg-violet-500/20","hover:bg-violet-500/30","text-violet-400","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","rounded-lg","transition-colors"],[1,"text-sm","font-medium","text-slate-300","mb-2"],[1,"space-y-1"],[1,"flex","items-center","gap-2","text-xs"],[1,"text-slate-300"],[1,"w-full","px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","rounded-lg","transition-colors",3,"click"]],template:function(e,r){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),o(5,"\u{1F465}"),i()(),n(6,"div")(7,"h1",5),o(8,"\u6536\u96C6\u7528\u6236"),i(),n(9,"p",6),o(10,"\u5F9E\u7FA4\u7D44\u81EA\u52D5\u6536\u96C6\u7684\u6D3B\u8E8D\u7528\u6236\uFF0C\u667A\u80FD\u8B58\u5225\u5EE3\u544A\u865F"),i()()(),n(11,"div",2)(12,"button",7),p("click",function(){return r.refreshData()}),n(13,"span"),o(14,"\u{1F504}"),i(),n(15,"span"),o(16,"\u5237\u65B0"),i()()()(),n(17,"div",8)(18,"div",9)(19,"div",2)(20,"div",10)(21,"span",11),o(22,"\u{1F465}"),i()(),n(23,"div")(24,"div",12),o(25),i(),n(26,"div",13),o(27,"\u7E3D\u6536\u96C6"),i()()()(),n(28,"div",9)(29,"div",2)(30,"div",14)(31,"span",15),o(32,"\u2713"),i()(),n(33,"div")(34,"div",16),o(35),i(),n(36,"div",13),o(37,"\u4F4E\u98A8\u96AA"),i()()()(),n(38,"div",9)(39,"div",2)(40,"div",17)(41,"span",18),o(42,"\u26A0"),i()(),n(43,"div")(44,"div",19),o(45),i(),n(46,"div",13),o(47,"\u4E2D\u98A8\u96AA"),i()()()(),n(48,"div",9)(49,"div",2)(50,"div",20)(51,"span",21),o(52,"\u{1F6AB}"),i()(),n(53,"div")(54,"div",22),o(55),i(),n(56,"div",13),o(57,"\u5EE3\u544A\u865F"),i()()()(),n(58,"div",9)(59,"div",2)(60,"div",23)(61,"span",24),o(62,"\u{1F48E}"),i()(),n(63,"div")(64,"div",25),o(65),i(),n(66,"div",13),o(67,"Premium"),i()()()()(),n(68,"div",26)(69,"div",27)(70,"div",28)(71,"span",6),o(72,"\u98A8\u96AA\u7B49\u7D1A:"),i(),n(73,"div",29)(74,"button",30),p("click",function(){return r.filterRisk="all"}),o(75," \u5168\u90E8 "),i(),n(76,"button",30),p("click",function(){return r.filterRisk="low"}),o(77," \u{1F7E2} \u5B89\u5168 "),i(),n(78,"button",30),p("click",function(){return r.filterRisk="medium"}),o(79," \u{1F7E1} \u53EF\u7591 "),i(),n(80,"button",30),p("click",function(){return r.filterRisk="high"}),o(81," \u{1F534} \u9AD8\u5371 "),i()()(),n(82,"div",28)(83,"span",6),o(84,"\u50F9\u503C:"),i(),n(85,"div",29),T(86,xn,2,9,"button",31,re),i()(),n(88,"label",32)(89,"input",33),V("ngModelChange",function(u){return I(r.filterHasUsername,u)||(r.filterHasUsername=u),u}),i(),n(90,"span",6),o(91,"\u6709\u7528\u6236\u540D"),i()(),n(92,"label",32)(93,"input",33),V("ngModelChange",function(u){return I(r.filterExcludeAds,u)||(r.filterExcludeAds=u),u}),i(),n(94,"span",6),o(95,"\u6392\u9664\u5EE3\u544A\u865F"),i()(),F(96,"div",34),n(97,"div",35)(98,"span",36),o(99,"\u{1F50D}"),i(),n(100,"input",37),V("ngModelChange",function(u){return I(r.searchQuery,u)||(r.searchQuery=u),u}),p("ngModelChange",function(){return r.onSearchChange()}),i()()()(),n(101,"div",38)(102,"div",39),x(103,_n,2,0,"div",40)(104,fn,7,0,"div",41)(105,Dn,3,0,"div",42),i(),x(106,Bn,34,23,"div",43),i()()),e&2){let l,u,b,h,E;s(13),S("animate-spin",r.isLoading()),s(12),C(((l=r.stats())==null?null:l.total)||0),s(10),C(((u=r.stats())==null||u.by_risk==null?null:u.by_risk.low)||0),s(10),C(((b=r.stats())==null||b.by_risk==null?null:b.by_risk.medium)||0),s(10),C(((h=r.stats())==null?null:h.ad_accounts)||0),s(10),C(((E=r.stats())==null?null:E.premium)||0),s(9),S("bg-violet-500/20",r.filterRisk==="all")("text-violet-400",r.filterRisk==="all")("bg-slate-700",r.filterRisk!=="all")("text-slate-400",r.filterRisk!=="all"),s(2),S("bg-emerald-500/20",r.filterRisk==="low")("text-emerald-400",r.filterRisk==="low")("bg-slate-700",r.filterRisk!=="low")("text-slate-400",r.filterRisk!=="low"),s(2),S("bg-amber-500/20",r.filterRisk==="medium")("text-amber-400",r.filterRisk==="medium")("bg-slate-700",r.filterRisk!=="medium")("text-slate-400",r.filterRisk!=="medium"),s(2),S("bg-red-500/20",r.filterRisk==="high")("text-red-400",r.filterRisk==="high")("bg-slate-700",r.filterRisk!=="high")("text-slate-400",r.filterRisk!=="high"),s(6),A(_e(44,pn)),s(3),M("ngModel",r.filterHasUsername),s(4),M("ngModel",r.filterExcludeAds),s(7),M("ngModel",r.searchQuery),s(3),_(r.isLoading()?103:r.filteredUsers().length===0?104:105),s(3),_(r.selectedUser()?106:-1)}},dependencies:[K,W,ee,de,te,ie],encapsulation:2})}};var Pn=(a,t)=>t.id;function Un(a,t){if(a&1){let e=y();n(0,"button",5),p("click",function(){let l=c(e).$implicit,u=d();return m(u.switchTab(l.id))}),o(1),i()}if(a&2){let e=t.$implicit,r=d();S("bg-gradient-to-r",r.activeTab()===e.id)("from-cyan-500",r.activeTab()===e.id)("to-blue-500",r.activeTab()===e.id)("text-white",r.activeTab()===e.id)("text-slate-400",r.activeTab()!==e.id)("bg-slate-800/50",r.activeTab()!==e.id),s(),j(" ",e.icon," ",e.label," ")}}function Ln(a,t){a&1&&F(0,"app-monitoring-accounts")}function Gn(a,t){if(a&1){let e=y();n(0,"app-monitoring-groups",6),p("extractMembersEvent",function(l){c(e);let u=d();return m(u.openMemberExtractionDialog(l))}),i()}}function jn(a,t){a&1&&F(0,"app-keyword-sets")}function Nn(a,t){a&1&&F(0,"app-trigger-rules")}function Kn(a,t){a&1&&F(0,"app-chat-templates")}function Wn(a,t){a&1&&F(0,"app-collected-users")}var On={monitoring:"groups","monitoring-accounts":"accounts","monitoring-groups":"groups","keyword-sets":"keywords","chat-templates":"templates","trigger-rules":"rules","collected-users":"collected"},Hn={accounts:"monitoring-accounts",groups:"monitoring-groups",keywords:"keyword-sets",templates:"chat-templates",rules:"trigger-rules",collected:"collected-users"},Qe=class a{constructor(){this.i18n=D(Oe);this.nav=D(He);this.ipc=D(O);this.toast=D(H);this.dialog=D(Ke);this.membershipService=D(We);this.accountService=D($e);this.monitoringState=D(z);this.tabs=[{id:"accounts",icon:"\u{1F464}",label:"\u76E3\u63A7\u5E33\u865F"},{id:"groups",icon:"\u{1F465}",label:"\u76E3\u63A7\u7FA4\u7D44"},{id:"keywords",icon:"\u{1F511}",label:"\u95DC\u9375\u8A5E\u96C6"},{id:"rules",icon:"\u26A1",label:"\u89F8\u767C\u898F\u5247"},{id:"templates",icon:"\u{1F4AC}",label:"\u6D88\u606F\u6A21\u677F"},{id:"collected",icon:"\u{1F4E5}",label:"\u6536\u96C6\u7528\u6236"}];this.activeTab=w("groups");this.ipcCleanup=[];this.viewSyncEffect=Z(()=>{let t=this.nav.currentView(),e=On[t];e&&e!==this.activeTab()&&(console.log(`[MonitoringView] \u8996\u5716\u5207\u63DB: ${t} \u2192 Tab: ${e}`),this.activeTab.set(e))})}ngOnInit(){this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(t=>t())}setupIpcListeners(){let t=this.ipc.on("monitoring-group-added",()=>{this.toast.success("\u7FA4\u7D44\u5DF2\u6DFB\u52A0")}),e=this.ipc.on("keyword-set-added",()=>{this.toast.success("\u95DC\u9375\u8A5E\u96C6\u5DF2\u6DFB\u52A0")});this.ipcCleanup.push(t,e)}selectAccount(t){console.log("Selected account:",t)}selectGroup(t){console.log("Selected group:",t)}selectKeywordSet(t){console.log("Selected keyword set:",t)}selectRule(t){console.log("Selected rule:",t)}selectTemplate(t){console.log("Selected template:",t)}addGroup(){this.dialog.openJoinMonitor({})}addKeywordSet(){this.ipc.send("open-add-keyword-set-dialog")}addRule(){this.ipc.send("open-add-rule-dialog")}addTemplate(){this.ipc.send("open-add-template-dialog")}switchTab(t){this.activeTab.set(t);let e=Hn[t];e&&this.nav.currentView()!==e&&this.nav.navigateTo(e)}t(t,e){return this.i18n.t(t,e)}openMemberExtractionDialog(t){console.log("[MonitoringView] Opening member extraction dialog for:",t),this.dialog.openMemberExtraction(t)}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=G({type:a,selectors:[["app-monitoring-view"]],decls:13,vars:1,consts:[[1,"page-content"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-4xl","font-bold",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-2"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","text-slate-400","bg-slate-800/50"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],[3,"extractMembersEvent"]],template:function(e,r){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),o(3,"\u76E3\u63A7\u4E2D\u5FC3"),i(),n(4,"div",3),T(5,Un,2,14,"button",4,Pn),i()(),x(7,Ln,1,0,"app-monitoring-accounts")(8,Gn,1,0,"app-monitoring-groups")(9,jn,1,0,"app-keyword-sets")(10,Nn,1,0,"app-trigger-rules")(11,Kn,1,0,"app-chat-templates")(12,Wn,1,0,"app-collected-users"),i()),e&2){let l;s(5),A(r.tabs),s(2),_((l=r.activeTab())==="accounts"?7:l==="groups"?8:l==="keywords"?9:l==="rules"?10:l==="templates"?11:l==="collected"?12:-1)}},dependencies:[K,W,ve,be,Se,ye,we,De],encapsulation:2,changeDetection:0})}};export{q as a,Qe as b};
