import{a as R}from"./chunk-JKWWU3OM.js";import{e as W}from"./chunk-PHWS6WVI.js";import{c as F,f as z,k as T,l as N,m as $,t as j}from"./chunk-36YFMG3E.js";import{Aa as l,Eb as E,Fb as w,Gb as A,Ia as D,Na as P,Sa as g,Y as b,Ya as O,Z as M,eb as m,fb as n,ga as y,gb as i,hb as x,lc as I,mc as k,nb as _,pb as f,qc as B,ub as v,xb as o,yb as s,zb as S}from"./chunk-YLSLTE5F.js";function H(r,a){if(r&1&&(b(),x(0,"circle",33)),r&2){let e=a.$implicit,t=a.index,c=f(2);O("stroke",e.color)("stroke-dasharray",c.getStrokeDasharray(e.percent))("stroke-dashoffset",c.getStrokeDashoffset(t))}}function V(r,a){if(r&1&&(n(0,"div",34),x(1,"span",35),n(2,"span",36),o(3),i(),n(4,"span",37),o(5),i(),n(6,"span",38),o(7),i()()),r&2){let e=a.$implicit,t=f(2);l(),v("background",e.color),l(2),s(e.name),l(2),S("",e.percent.toFixed(1),"%"),l(2),s(t.formatAmount(e.amount))}}function q(r,a){if(r&1&&(n(0,"div",24)(1,"div",25),b(),n(2,"svg",26),g(3,H,1,3,"circle",27),i(),M(),n(4,"div",28)(5,"div",29),o(6),i(),n(7,"div",30),o(8,"\u7E3D\u6D88\u8CBB"),i()()(),n(9,"div",31),g(10,V,8,5,"div",32),i()()),r&2){let e,t=f();l(3),m("ngForOf",t.categoryData()),l(3),s((e=t.summary())==null?null:e.total_display),l(4),m("ngForOf",t.categoryData())}}function G(r,a){r&1&&(n(0,"div",39)(1,"span"),o(2,"\u66AB\u7121\u6D88\u8CBB\u6578\u64DA"),i()())}function J(r,a){if(r&1&&(n(0,"div",43),x(1,"div",44),n(2,"div",45),o(3),i()()),r&2){let e=a.$implicit,t=f(2);m("title",e.date+": "+t.formatAmount(e.amount)),l(),v("height",t.getBarHeight(e.amount)+"%"),l(2),s(t.formatDayLabel(e.date))}}function K(r,a){if(r&1&&(n(0,"div",40)(1,"div",41),g(2,J,4,4,"div",42),i()()),r&2){let e=f();l(2),m("ngForOf",e.dailyData())}}function Q(r,a){r&1&&(n(0,"div",39)(1,"span"),o(2,"\u66AB\u7121\u6D88\u8CBB\u8DA8\u52E2\u6578\u64DA"),i()())}function U(r,a){if(r&1&&(n(0,"div",46)(1,"div",47)(2,"span",48),o(3),i(),n(4,"span",49),o(5),i()(),n(6,"div",50)(7,"div",51)(8,"span",52),o(9),i(),n(10,"span",53),o(11,"\u6D88\u8CBB\u91D1\u984D"),i()(),n(12,"div",51)(13,"span",52),o(14),i(),n(15,"span",53),o(16,"\u4EA4\u6613\u6B21\u6578"),i()(),n(17,"div",51)(18,"span",52),o(19),i(),n(20,"span",53),o(21,"\u5E73\u5747\u55AE\u7B46"),i()()(),n(22,"div",54),x(23,"div",55),i()()),r&2){let e=a.$implicit,t=f();l(3),s(t.getCategoryIcon(e.name)),l(2),s(e.name),l(4),s(t.formatAmount(e.amount)),l(5),s(e.count),l(5),s(t.formatAmount(e.count>0?e.amount/e.count:0)),l(4),v("width",e.percent+"%")("background",e.color)}}function X(r,a){r&1&&(n(0,"div",56)(1,"span"),o(2,"\u66AB\u7121\u6D88\u8CBB\u8A18\u9304"),i()())}function Y(r,a){r&1&&(n(0,"div",57),x(1,"div",58),i())}var L=class r{constructor(a,e){this.walletService=a;this.router=e;this.selectedPeriod="30";this.loading=y(!0);this.summary=y(null);this.categoryData=y([]);this.dailyData=y([]);this.categoryColors={membership:"#667eea",ip_proxy:"#22c55e",quota_pack:"#f59e0b",other:"#8b5cf6"};this.categoryNames={membership:"\u6703\u54E1\u670D\u52D9",ip_proxy:"\u975C\u614B IP",quota_pack:"\u914D\u984D\u5305",other:"\u5176\u4ED6"}}ngOnInit(){this.loadData()}async loadData(){this.loading.set(!0);try{let a=parseInt(this.selectedPeriod),e=await this.walletService.getConsumeSummary(a);if(e){this.summary.set(e);let c=[],d=e.by_category||{},p=e.total_amount||0;for(let[u,h]of Object.entries(d)){let C=h;c.push({name:this.categoryNames[u]||u,amount:C.total||0,count:C.count||0,percent:p>0?C.total/p*100:0,color:this.categoryColors[u]||"#999"})}c.sort((u,h)=>h.amount-u.amount),this.categoryData.set(c)}let t=await this.walletService.getConsumeAnalysis();if(t?.by_date){let c=t.by_date.map(p=>({date:p.date,amount:p.amount}));c.sort((p,u)=>p.date.localeCompare(u.date));let d=c.slice(-parseInt(this.selectedPeriod));this.dailyData.set(d)}}catch(a){console.error("Load analytics error:",a)}finally{this.loading.set(!1)}}onPeriodChange(){this.loadData()}formatAmount(a){return"$"+(a/100).toFixed(2)}formatDayLabel(a){if(!a)return"";let e=new Date(a);return`${e.getMonth()+1}/${e.getDate()}`}getCategoryIcon(a){return{\u6703\u54E1\u670D\u52D9:"\u{1F451}","\u975C\u614B IP":"\u{1F310}",\u914D\u984D\u5305:"\u{1F4CA}",\u5176\u4ED6:"\u{1F4E6}"}[a]||"\u{1F4CB}"}getBarHeight(a){let e=this.dailyData();if(e.length===0)return 0;let t=Math.max(...e.map(c=>c.amount));return t===0?0:a/t*100}getStrokeDasharray(a){let e=2*Math.PI*40;return`${a/100*e} ${e}`}getStrokeDashoffset(a){let e=2*Math.PI*40,t=0,c=this.categoryData();for(let d=0;d<a;d++)t+=c[d].percent/100*e;return-t}async exportData(){try{await this.walletService.exportTransactions()}catch(a){console.error("Export error:",a),alert("\u5C0E\u51FA\u5931\u6557")}}goBack(){this.router.navigate(["/wallet"])}static{this.\u0275fac=function(e){return new(e||r)(D(R),D(W))}}static{this.\u0275cmp=P({type:r,selectors:[["app-wallet-analytics"]],decls:59,vars:11,consts:[[1,"analytics-view"],[1,"view-header"],[1,"header-left"],[1,"back-btn",3,"click"],[1,"period-select",3,"ngModelChange","change","ngModel"],["value","7"],["value","30"],["value","90"],[1,"summary-cards"],[1,"summary-card"],[1,"card-icon"],[1,"card-content"],[1,"card-label"],[1,"card-value"],[1,"section"],["class","pie-chart-container",4,"ngIf"],["class","empty-chart",4,"ngIf"],["class","bar-chart",4,"ngIf"],[1,"category-list"],["class","category-item",4,"ngFor","ngForOf"],["class","empty-list",4,"ngIf"],[1,"export-section"],[1,"export-btn",3,"click"],["class","loading-overlay",4,"ngIf"],[1,"pie-chart-container"],[1,"pie-chart"],["viewBox","0 0 100 100"],["cx","50","cy","50","r","40","fill","transparent","stroke-width","20","transform","rotate(-90 50 50)",4,"ngFor","ngForOf"],[1,"pie-center"],[1,"pie-total"],[1,"pie-label"],[1,"pie-legend"],["class","legend-item",4,"ngFor","ngForOf"],["cx","50","cy","50","r","40","fill","transparent","stroke-width","20","transform","rotate(-90 50 50)"],[1,"legend-item"],[1,"legend-dot"],[1,"legend-name"],[1,"legend-percent"],[1,"legend-amount"],[1,"empty-chart"],[1,"bar-chart"],[1,"bar-container"],["class","bar-item",3,"title",4,"ngFor","ngForOf"],[1,"bar-item",3,"title"],[1,"bar"],[1,"bar-label"],[1,"category-item"],[1,"category-header"],[1,"category-icon"],[1,"category-name"],[1,"category-stats"],[1,"stat"],[1,"stat-value"],[1,"stat-label"],[1,"category-bar"],[1,"bar-fill"],[1,"empty-list"],[1,"loading-overlay"],[1,"spinner"]],template:function(e,t){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),_("click",function(){return t.goBack()}),o(4,"\u2190"),i(),n(5,"h1"),o(6,"\u6D88\u8CBB\u5206\u6790"),i()(),n(7,"select",4),A("ngModelChange",function(d){return w(t.selectedPeriod,d)||(t.selectedPeriod=d),d}),_("change",function(){return t.onPeriodChange()}),n(8,"option",5),o(9,"\u8FD1 7 \u5929"),i(),n(10,"option",6),o(11,"\u8FD1 30 \u5929"),i(),n(12,"option",7),o(13,"\u8FD1 90 \u5929"),i()()(),n(14,"div",8)(15,"div",9)(16,"div",10),o(17,"\u{1F4B0}"),i(),n(18,"div",11)(19,"div",12),o(20,"\u7E3D\u6D88\u8CBB"),i(),n(21,"div",13),o(22),i()()(),n(23,"div",9)(24,"div",10),o(25,"\u{1F4CA}"),i(),n(26,"div",11)(27,"div",12),o(28,"\u4EA4\u6613\u6B21\u6578"),i(),n(29,"div",13),o(30),i()()(),n(31,"div",9)(32,"div",10),o(33,"\u{1F4C5}"),i(),n(34,"div",11)(35,"div",12),o(36,"\u4ECA\u65E5\u6D88\u8CBB"),i(),n(37,"div",13),o(38),i()()()(),n(39,"div",14)(40,"h2"),o(41,"\u6309\u985E\u5225\u5206\u6790"),i(),g(42,q,11,3,"div",15)(43,G,3,0,"div",16),i(),n(44,"div",14)(45,"h2"),o(46,"\u6D88\u8CBB\u8DA8\u52E2"),i(),g(47,K,3,1,"div",17)(48,Q,3,0,"div",16),i(),n(49,"div",14)(50,"h2"),o(51,"\u6D88\u8CBB\u660E\u7D30"),i(),n(52,"div",18),g(53,U,24,9,"div",19),i(),g(54,X,3,0,"div",20),i(),n(55,"div",21)(56,"button",22),_("click",function(){return t.exportData()}),o(57," \u{1F4E5} \u5C0E\u51FA\u5831\u8868 "),i()(),g(58,Y,2,0,"div",23),i()),e&2){let c,d,p;l(7),E("ngModel",t.selectedPeriod),l(15),s(((c=t.summary())==null?null:c.total_display)||"$0.00"),l(8),s(((d=t.summary())==null?null:d.total_count)||0),l(8),s(t.formatAmount(((p=t.summary())==null?null:p.today_consumed)||0)),l(4),m("ngIf",t.categoryData().length>0),l(),m("ngIf",t.categoryData().length===0&&!t.loading()),l(4),m("ngIf",t.dailyData().length>0),l(),m("ngIf",t.dailyData().length===0&&!t.loading()),l(5),m("ngForOf",t.categoryData()),l(),m("ngIf",t.categoryData().length===0&&!t.loading()),l(4),m("ngIf",t.loading())}},dependencies:[B,I,k,j,N,$,T,F,z],styles:[".analytics-view[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);padding:20px 20px 100px;color:#fff}.view-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.back-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;background:#ffffff1a;border:none;color:#fff;font-size:20px;cursor:pointer}h1[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin:0}.period-select[_ngcontent-%COMP%]{padding:10px 16px;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:10px;color:#fff;font-size:14px}.period-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:#1a1a2e}.summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px}.summary-card[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:16px;display:flex;align-items:center;gap:12px}.card-icon[_ngcontent-%COMP%]{font-size:28px}.card-label[_ngcontent-%COMP%]{font-size:12px;opacity:.6;margin-bottom:4px}.card-value[_ngcontent-%COMP%]{font-size:18px;font-weight:600}.section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px;margin-bottom:20px}.section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin:0 0 20px}.pie-chart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:24px}.pie-chart[_ngcontent-%COMP%]{position:relative;width:200px;height:200px}.pie-chart[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%}.pie-center[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}.pie-total[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#667eea}.pie-label[_ngcontent-%COMP%]{font-size:12px;opacity:.6}.pie-legend[_ngcontent-%COMP%]{width:100%}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.05)}.legend-dot[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%}.legend-name[_ngcontent-%COMP%]{flex:1;font-size:14px}.legend-percent[_ngcontent-%COMP%]{font-size:13px;opacity:.7;width:50px;text-align:right}.legend-amount[_ngcontent-%COMP%]{font-size:14px;font-weight:500;width:80px;text-align:right}.bar-chart[_ngcontent-%COMP%]{height:160px;overflow-x:auto}.bar-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;height:100%;gap:8px;min-width:max-content;padding:0 4px}.bar-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:32px;height:100%}.bar[_ngcontent-%COMP%]{width:100%;background:linear-gradient(180deg,#667eea,#764ba2);border-radius:4px 4px 0 0;min-height:4px;transition:height .3s}.bar-label[_ngcontent-%COMP%]{font-size:10px;opacity:.5;margin-top:6px;white-space:nowrap}.category-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.category-item[_ngcontent-%COMP%]{background:#ffffff08;border-radius:12px;padding:16px}.category-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:12px}.category-icon[_ngcontent-%COMP%]{font-size:20px}.category-name[_ngcontent-%COMP%]{font-size:15px;font-weight:500}.category-stats[_ngcontent-%COMP%]{display:flex;gap:24px;margin-bottom:12px}.stat[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:16px;font-weight:600}.stat-label[_ngcontent-%COMP%]{font-size:11px;opacity:.5}.category-bar[_ngcontent-%COMP%]{height:6px;background:#ffffff1a;border-radius:3px;overflow:hidden}.bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:3px;transition:width .3s}.empty-chart[_ngcontent-%COMP%], .empty-list[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;opacity:.5}.export-section[_ngcontent-%COMP%]{text-align:center;margin-top:24px}.export-btn[_ngcontent-%COMP%]{padding:14px 32px;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:12px;color:#fff;font-size:15px;cursor:pointer;transition:all .2s}.export-btn[_ngcontent-%COMP%]:hover{background:#ffffff26}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:100}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(255,255,255,.2);border-top-color:#667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};export{L as a};
