{
  "version": 3,
  "sources": ["src/core/auth-events.service.ts"],
  "sourcesContent": ["/**\r\n * èªè­‰äº‹ä»¶æœå‹™\r\n * \r\n * ğŸ†• çµ±ä¸€èªè­‰äº‹ä»¶ç¸½ç·š\r\n * è§£æ±ºå¤šå€‹ AuthService ç‹€æ…‹ä¸åŒæ­¥çš„å•é¡Œ\r\n * \r\n * è¨­è¨ˆåŸå‰‡ï¼š\r\n * 1. å–®ä¸€äº‹ä»¶æº - æ‰€æœ‰èªè­‰äº‹ä»¶é€šéæ­¤æœå‹™å»£æ’­\r\n * 2. è§£è€¦ä¾è³´ - é¿å…æœå‹™é–“å¾ªç’°ä¾è³´\r\n * 3. äº‹ä»¶é©…å‹• - ä½¿ç”¨ RxJS Subject å»£æ’­äº‹ä»¶\r\n */\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { Subject, Observable } from 'rxjs';\r\n\r\n// èªè­‰äº‹ä»¶é¡å‹\r\nexport type AuthEventType = \r\n  | 'login'           // ç™»å…¥æˆåŠŸ\r\n  | 'logout'          // ç™»å‡º\r\n  | 'session_expired' // æœƒè©±éæœŸ\r\n  | 'token_refresh'   // Token åˆ·æ–°\r\n  | 'user_update';    // ç”¨æˆ¶ä¿¡æ¯æ›´æ–°\r\n\r\n// èªè­‰äº‹ä»¶æ•¸æ“š\r\nexport interface AuthEvent {\r\n  type: AuthEventType;\r\n  payload?: any;\r\n  timestamp: number;\r\n}\r\n\r\n// Token å­˜å„²éµ - é›†ä¸­ç®¡ç†\r\nexport const AUTH_STORAGE_KEYS = {\r\n  ACCESS_TOKEN: 'tgm_access_token',\r\n  REFRESH_TOKEN: 'tgm_refresh_token',\r\n  AUTH_TOKEN: 'tgm_auth_token',  // èˆŠç‰ˆå…¼å®¹\r\n  USER: 'tgm_user',\r\n  SESSION_ID: 'tgm_session_id',\r\n  REMEMBER_ME: 'tgm_remember_me'  // ğŸ†• è¨˜ä½ç™»å…¥ç‹€æ…‹\r\n} as const;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthEventsService {\r\n  // èªè­‰äº‹ä»¶ä¸»é¡Œ\r\n  private _authEvents = new Subject<AuthEvent>();\r\n  \r\n  // å…¬é–‹çš„äº‹ä»¶æµ\r\n  readonly authEvents$: Observable<AuthEvent> = this._authEvents.asObservable();\r\n  \r\n  /**\r\n   * å»£æ’­ç™»å…¥äº‹ä»¶\r\n   */\r\n  emitLogin(payload?: any): void {\r\n    this._authEvents.next({\r\n      type: 'login',\r\n      payload,\r\n      timestamp: Date.now()\r\n    });\r\n    console.log('[AuthEvents] Login event emitted');\r\n  }\r\n  \r\n  /**\r\n   * å»£æ’­ç™»å‡ºäº‹ä»¶\r\n   */\r\n  emitLogout(): void {\r\n    this._authEvents.next({\r\n      type: 'logout',\r\n      timestamp: Date.now()\r\n    });\r\n    console.log('[AuthEvents] Logout event emitted');\r\n  }\r\n  \r\n  /**\r\n   * å»£æ’­æœƒè©±éæœŸäº‹ä»¶\r\n   */\r\n  emitSessionExpired(): void {\r\n    this._authEvents.next({\r\n      type: 'session_expired',\r\n      timestamp: Date.now()\r\n    });\r\n    console.log('[AuthEvents] Session expired event emitted');\r\n  }\r\n  \r\n  /**\r\n   * å»£æ’­ Token åˆ·æ–°äº‹ä»¶\r\n   */\r\n  emitTokenRefresh(newToken: string): void {\r\n    this._authEvents.next({\r\n      type: 'token_refresh',\r\n      payload: { token: newToken },\r\n      timestamp: Date.now()\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * å»£æ’­ç”¨æˆ¶ä¿¡æ¯æ›´æ–°äº‹ä»¶\r\n   */\r\n  emitUserUpdate(user: any): void {\r\n    this._authEvents.next({\r\n      type: 'user_update',\r\n      payload: { user },\r\n      timestamp: Date.now()\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * æ¸…é™¤æ‰€æœ‰èªè­‰ç›¸é—œçš„ localStorage\r\n   * é›†ä¸­å¼ç®¡ç†ï¼Œç¢ºä¿å¾¹åº•æ¸…é™¤\r\n   */\r\n  clearAllAuthStorage(): void {\r\n    console.log('[AuthEvents] Clearing all auth storage');\r\n    Object.values(AUTH_STORAGE_KEYS).forEach(key => {\r\n      localStorage.removeItem(key);\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * ç²å–ç•¶å‰ Tokenï¼ˆå¾ localStorageï¼‰\r\n   */\r\n  getStoredToken(): string | null {\r\n    return localStorage.getItem(AUTH_STORAGE_KEYS.ACCESS_TOKEN) \r\n        || localStorage.getItem(AUTH_STORAGE_KEYS.AUTH_TOKEN);\r\n  }\r\n  \r\n  /**\r\n   * ç²å–å­˜å„²çš„ç”¨æˆ¶ä¿¡æ¯\r\n   */\r\n  getStoredUser(): any | null {\r\n    try {\r\n      const userJson = localStorage.getItem(AUTH_STORAGE_KEYS.USER);\r\n      return userJson ? JSON.parse(userJson) : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;AA+BO,IAAM,oBAAoB;EAC/B,cAAc;EACd,eAAe;EACf,YAAY;;EACZ,MAAM;EACN,YAAY;EACZ,aAAa;;;AAMT,IAAO,oBAAP,MAAO,mBAAiB;EAH9B,cAAA;AAKU,SAAA,cAAc,IAAI,QAAO;AAGxB,SAAA,cAAqC,KAAK,YAAY,aAAY;;;;;EAK3E,UAAU,SAAa;AACrB,SAAK,YAAY,KAAK;MACpB,MAAM;MACN;MACA,WAAW,KAAK,IAAG;KACpB;AACD,YAAQ,IAAI,kCAAkC;EAChD;;;;EAKA,aAAU;AACR,SAAK,YAAY,KAAK;MACpB,MAAM;MACN,WAAW,KAAK,IAAG;KACpB;AACD,YAAQ,IAAI,mCAAmC;EACjD;;;;EAKA,qBAAkB;AAChB,SAAK,YAAY,KAAK;MACpB,MAAM;MACN,WAAW,KAAK,IAAG;KACpB;AACD,YAAQ,IAAI,4CAA4C;EAC1D;;;;EAKA,iBAAiB,UAAgB;AAC/B,SAAK,YAAY,KAAK;MACpB,MAAM;MACN,SAAS,EAAE,OAAO,SAAQ;MAC1B,WAAW,KAAK,IAAG;KACpB;EACH;;;;EAKA,eAAe,MAAS;AACtB,SAAK,YAAY,KAAK;MACpB,MAAM;MACN,SAAS,EAAE,KAAI;MACf,WAAW,KAAK,IAAG;KACpB;EACH;;;;;EAMA,sBAAmB;AACjB,YAAQ,IAAI,wCAAwC;AACpD,WAAO,OAAO,iBAAiB,EAAE,QAAQ,SAAM;AAC7C,mBAAa,WAAW,GAAG;IAC7B,CAAC;EACH;;;;EAKA,iBAAc;AACZ,WAAO,aAAa,QAAQ,kBAAkB,YAAY,KACnD,aAAa,QAAQ,kBAAkB,UAAU;EAC1D;;;;EAKA,gBAAa;AACX,QAAI;AACF,YAAM,WAAW,aAAa,QAAQ,kBAAkB,IAAI;AAC5D,aAAO,WAAW,KAAK,MAAM,QAAQ,IAAI;IAC3C,QAAQ;AACN,aAAO;IACT;EACF;;;uCA5FW,oBAAiB;IAAA;EAAA;;4EAAjB,oBAAiB,SAAjB,mBAAiB,WAAA,YAFhB,OAAM,CAAA;EAAA;;;sEAEP,mBAAiB,CAAA;UAH7B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
