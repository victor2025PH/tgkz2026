import{e as I,g as y}from"./chunk-FF535MQ4.js";import{b as D}from"./chunk-6FHZTSI7.js";import{o as T}from"./chunk-35776WZA.js";import{La as O,Nb as L,O as f,T as h,U as x,V as S,W as M,Ya as m,Za as g,a as E,b,da as u,gb as e,hb as i,ib as p,jb as _,kb as P,ob as C,pb as c,ta as k,xa as a,xb as o,yb as s,zb as v}from"./chunk-MB4RORS3.js";var z=r=>({seconds:r});function V(r,n){if(r&1&&(e(0,"div",4),p(1,"div",12),e(2,"p"),o(3),i()()),r&2){let t=c();a(3),s(t.t("scanLogin.verifying"))}}function j(r,n){if(r&1&&(e(0,"p",21),o(1),i()),r&2){let t=c(2);a(),v(" ",t.t("scanLogin.expiresIn",L(1,z,t.countdown()))," ")}}function N(r,n){if(r&1){let t=_();e(0,"div",5)(1,"div",13),o(2,"\u{1F4F1}"),i(),e(3,"h2"),o(4),i(),e(5,"p",14),o(6),i(),p(7,"div",15),e(8,"div",16)(9,"span"),o(10),i()(),e(11,"a",17),C("click",function(){h(t);let l=c();return x(l.onTelegramClick())}),e(12,"span",18),S(),e(13,"svg",19),p(14,"path",20),i()(),M(),e(15,"span"),o(16),i()(),m(17,j,2,3,"p",21),e(18,"div",22)(19,"div",23)(20,"span",24),o(21,"1"),i(),e(22,"span"),o(23),i()(),e(24,"div",23)(25,"span",24),o(26,"2"),i(),e(27,"span"),o(28),i()(),e(29,"div",23)(30,"span",24),o(31,"3"),i(),e(32,"span"),o(33),i()()()()}if(r&2){let t=c();a(4),s(t.t("scanLogin.confirmTitle")),a(2),s(t.t("scanLogin.authDesc")),a(4),s(t.t("scanLogin.or")),a(),P("href",t.tokenStatus().deepLinkUrl,k),a(5),s(t.t("scanLogin.openTelegramManual")),a(),g(t.countdown()>0?17:-1),a(6),s(t.t("scanLogin.stepAuth")),a(5),s(t.t("scanLogin.stepConfirm")),a(5),s(t.t("scanLogin.stepDone"))}}function F(r,n){if(r&1&&(e(0,"div",6),p(1,"div",12),e(2,"h2"),o(3),i(),e(4,"p"),o(5),i()()),r&2){let t=c();a(3),s(t.t("scanLogin.sendingTitle")),a(2),s(t.t("scanLogin.sendingDesc"))}}function G(r,n){if(r&1&&(e(0,"div",7)(1,"div",25),o(2,"\u23F3"),i(),e(3,"h2"),o(4),i(),e(5,"p"),o(6),i(),p(7,"div",26),i()),r&2){let t=c();a(4),s(t.t("scanLogin.waitingTitle")),a(2),s(t.t("scanLogin.waitingDesc"))}}function R(r,n){if(r&1&&(e(0,"div",8)(1,"div",27),o(2,"\u2705"),i(),e(3,"h2"),o(4),i(),e(5,"p"),o(6),i()()),r&2){let t=c();a(4),s(t.t("scanLogin.successTitle")),a(2),s(t.t("scanLogin.successDesc"))}}function W(r,n){if(r&1){let t=_();e(0,"div",9)(1,"div",28),o(2,"\u23F0"),i(),e(3,"h2"),o(4),i(),e(5,"p"),o(6),i(),e(7,"button",29),C("click",function(){h(t);let l=c();return x(l.goToLogin())}),o(8),i()()}if(r&2){let t=c();a(4),s(t.t("scanLogin.expiredTitle")),a(2),s(t.t("scanLogin.expiredDesc")),a(2),v(" ",t.t("scanLogin.backToLogin")," ")}}function $(r,n){if(r&1){let t=_();e(0,"div",10)(1,"div",28),o(2,"\u274C"),i(),e(3,"h2"),o(4),i(),e(5,"p"),o(6),i(),e(7,"button",29),C("click",function(){h(t);let l=c();return x(l.goToLogin())}),o(8),i()()}if(r&2){let t=c();a(4),s(t.t("scanLogin.errorTitle")),a(2),s(t.tokenStatus().message||t.t("scanLogin.errorDesc")),a(2),v(" ",t.t("scanLogin.backToLogin")," ")}}var U=class r{constructor(){this.route=f(I);this.router=f(y);this.i18n=f(D);this.tokenStatus=u({status:"loading"});this.countdown=u(0);this.waitingConfirm=u(!1);this.telegramUser=u(null);this.token="";this.botUsername="";this.countdownInterval=null;this.pollInterval=null;this.widgetLoaded=!1}ngOnInit(){if(this.token=this.route.snapshot.queryParams.token||"",!this.token){this.tokenStatus.set({status:"error",message:this.t("scanLogin.noToken")});return}window.onTelegramAuth=this.handleTelegramAuth.bind(this),this.verifyToken()}ngAfterViewInit(){}handleTelegramAuth(n){console.log("Telegram auth received:",n),this.telegramUser.set(n),this.tokenStatus.update(t=>b(E({},t),{status:"sending"})),this.sendConfirmationToUser(n)}async sendConfirmationToUser(n){try{let d=await(await fetch(`/api/v1/auth/login-token/${this.token}/send-confirmation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegram_id:n.id,telegram_username:n.username,telegram_first_name:n.first_name,telegram_last_name:n.last_name,auth_date:n.auth_date,hash:n.hash})})).json();d.success?(this.tokenStatus.update(l=>b(E({},l),{status:"valid"})),this.waitingConfirm.set(!0),this.startPolling()):this.tokenStatus.set({status:"error",message:d.error||this.t("scanLogin.sendFailed")})}catch(t){console.error("Send confirmation error:",t),this.tokenStatus.set({status:"error",message:this.t("scanLogin.networkError")})}}loadTelegramWidget(){if(this.widgetLoaded||!this.botUsername)return;let n=document.getElementById("telegram-login-widget");if(!n)return;n.innerHTML="";let t=document.createElement("script");t.async=!0,t.src="https://telegram.org/js/telegram-widget.js?22",t.setAttribute("data-telegram-login",this.botUsername),t.setAttribute("data-size","large"),t.setAttribute("data-radius","10"),t.setAttribute("data-onauth","onTelegramAuth(user)"),t.setAttribute("data-request-access","write"),n.appendChild(t),this.widgetLoaded=!0}ngOnDestroy(){this.countdownInterval&&clearInterval(this.countdownInterval),this.pollInterval&&clearInterval(this.pollInterval)}t(n,t){return this.i18n.t(n,t)}async verifyToken(){try{let t=await(await fetch(`/api/v1/auth/login-token/${this.token}`)).json();if(!t.success){this.tokenStatus.set({status:"error",message:t.error||this.t("scanLogin.tokenInvalid")});return}let{status:d,expires_in:l,deep_link_url:A,bot_username:w}=t.data;if(d==="expired"){this.tokenStatus.set({status:"expired"});return}if(d==="confirmed"){this.tokenStatus.set({status:"confirmed"});return}this.botUsername=w||"tgzkw_bot",this.tokenStatus.set({status:"valid",deepLinkUrl:A,botUsername:w,expiresIn:l||300}),this.countdown.set(l||300),this.startCountdown(),setTimeout(()=>{this.loadTelegramWidget()},100)}catch(n){console.error("Token verification error:",n),this.tokenStatus.set({status:"error",message:this.t("scanLogin.networkError")})}}onTelegramClick(){this.waitingConfirm.set(!0),this.startPolling()}startCountdown(){this.countdownInterval=setInterval(()=>{let n=this.countdown();n<=0?(clearInterval(this.countdownInterval),this.tokenStatus.set({status:"expired"})):this.countdown.set(n-1)},1e3)}startPolling(){this.pollInterval=setInterval(async()=>{try{let t=await(await fetch(`/api/v1/auth/login-token/${this.token}`)).json();t.success&&t.data&&(t.data.status==="confirmed"?(clearInterval(this.pollInterval),this.waitingConfirm.set(!1),this.tokenStatus.set({status:"confirmed"})):t.data.status==="expired"&&(clearInterval(this.pollInterval),this.waitingConfirm.set(!1),this.tokenStatus.set({status:"expired"})))}catch(n){console.error("Polling error:",n)}},2e3)}goToLogin(){window.location.href="https://tgw.usdt2026.cc/auth/login"}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=O({type:r,selectors:[["app-scan-login"]],decls:17,vars:7,consts:[[1,"scan-login-page"],[1,"scan-card"],[1,"logo"],[1,"logo-icon"],[1,"status-section","loading"],[1,"status-section","valid"],[1,"status-section","sending"],[1,"status-section","waiting"],[1,"status-section","confirmed"],[1,"status-section","expired"],[1,"status-section","error"],[1,"footer"],[1,"spinner"],[1,"info-icon"],[1,"description"],["id","telegram-login-widget",1,"telegram-widget-container"],[1,"divider"],[1,"telegram-btn","secondary",3,"click","href"],[1,"btn-icon"],["viewBox","0 0 24 24","fill","currentColor","width","24","height","24"],["d","M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"],[1,"countdown"],[1,"steps"],[1,"step"],[1,"step-num"],[1,"pulse-icon"],[1,"spinner","small"],[1,"success-icon"],[1,"error-icon"],[1,"retry-btn",3,"click"]],template:function(t,d){t&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),o(4,"\u{1F510}"),i(),e(5,"h1"),o(6,"TG-Matrix"),i()(),m(7,V,4,1,"div",4),m(8,N,34,9,"div",5),m(9,F,6,2,"div",6),m(10,G,8,2,"div",7),m(11,R,7,2,"div",8),m(12,W,9,3,"div",9),m(13,$,9,3,"div",10),e(14,"div",11)(15,"p"),o(16,"\xA9 2026 TG-Matrix. All rights reserved."),i()()()()),t&2&&(a(7),g(d.tokenStatus().status==="loading"?7:-1),a(),g(d.tokenStatus().status==="valid"?8:-1),a(),g(d.tokenStatus().status==="sending"?9:-1),a(),g(d.waitingConfirm()?10:-1),a(),g(d.tokenStatus().status==="confirmed"?11:-1),a(),g(d.tokenStatus().status==="expired"?12:-1),a(),g(d.tokenStatus().status==="error"?13:-1))},dependencies:[T],styles:['.scan-login-page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a,#1e293b);padding:1rem}.scan-card[_ngcontent-%COMP%]{background:#1e293be6;border-radius:20px;padding:2rem;max-width:400px;width:100%;text-align:center;box-shadow:0 20px 60px #0000004d;border:1px solid rgba(255,255,255,.1)}.logo[_ngcontent-%COMP%]{margin-bottom:2rem}.logo-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:.5rem}.logo[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff;margin:0}.status-section[_ngcontent-%COMP%]{padding:1rem 0}.info-icon[_ngcontent-%COMP%], .success-icon[_ngcontent-%COMP%], .error-icon[_ngcontent-%COMP%], .pulse-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.pulse-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}h2[_ngcontent-%COMP%]{color:#fff;font-size:1.25rem;margin:0 0 .5rem}.description[_ngcontent-%COMP%]{color:#94a3b8;font-size:.9rem;margin:0 0 1.5rem}.telegram-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.75rem;padding:1rem 2rem;background:linear-gradient(135deg,#08c,#06a);border:none;border-radius:12px;color:#fff;font-size:1.1rem;font-weight:600;text-decoration:none;cursor:pointer;transition:all .3s ease;width:100%;box-shadow:0 4px 15px #08c6}.telegram-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #0088cc80}.telegram-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.telegram-btn.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid #0088cc;box-shadow:none}.telegram-btn.secondary[_ngcontent-%COMP%]:hover{background:#0088cc1a;box-shadow:none}.telegram-widget-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1.5rem 0;min-height:48px}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:1.5rem 0;color:#64748b;font-size:.85rem}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:#ffffff1a}.divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 1rem}.status-section.sending[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#60a5fa}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center}.btn-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}.countdown[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem;margin:1rem 0 0}.steps[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.1)}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem 0;color:#94a3b8;font-size:.9rem}.step-num[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem;background:linear-gradient(135deg,#08c,#06a);border-radius:50%;color:#fff;font-size:.75rem;font-weight:600}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(255,255,255,.1);border-top-color:#08c;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:1rem auto}.spinner.small[_ngcontent-%COMP%]{width:24px;height:24px;border-width:2px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.retry-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.75rem 1.5rem;background:transparent;border:1px solid #64748b;border-radius:8px;color:#94a3b8;font-size:.9rem;cursor:pointer;transition:all .2s ease;margin-top:1rem}.retry-btn[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:#fff;color:#fff}.footer[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.05)}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#475569;font-size:.75rem;margin:0}.status-section.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#94a3b8}.status-section.waiting[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fbbf24}.status-section.confirmed[_ngcontent-%COMP%]   .success-icon[_ngcontent-%COMP%], .status-section.confirmed[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#4ade80}.status-section.expired[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%], .status-section.error[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%], .status-section.expired[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .status-section.error[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#f87171}']})}};export{U as ScanLoginComponent};
