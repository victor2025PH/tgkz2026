import{a as zn}from"./chunk-6DNRJUNI.js";import{a as La}from"./chunk-HZNL35Y2.js";import{a as Va}from"./chunk-KL2FHZTF.js";import{a as qe}from"./chunk-CNTWOESV.js";import{a as ge,b as ot,c as la,d as Qo,e as Dt,f as Vn,g as mn,h as ya,i as ba,j as Sa,k as xa,l as wa,m as Ea,n as Ta,p as Aa,q as Da,r as Ma,s as Ia,t as ka,u as Pa,v as Na,w as Ra,x as Fa,y as Wn}from"./chunk-BDXALK3H.js";import"./chunk-E5JAB72H.js";import{a as Ca}from"./chunk-A22KDSKM.js";import{a as va}from"./chunk-LAYKK35A.js";import"./chunk-M2VKGXCG.js";import{a as ha,b as fa,c as _a}from"./chunk-5UHDXNYI.js";import{a as mt,b as Ne}from"./chunk-7LTHB4NI.js";import{a as Yo}from"./chunk-SIDS6FGB.js";import{a as Ie}from"./chunk-5HHK7KPZ.js";import{a as On,b as Le,c as Ve,f as Be,h as Gn,i as ma,k as Un,l as Gt,m as Ut,n as qn,o as $n,s as pa,t as Te}from"./chunk-FZJM4IRN.js";import{a as ga,b as et}from"./chunk-CIOQN4KY.js";import{a as Hn,b as Kn}from"./chunk-B2KG2WNU.js";import"./chunk-TMNXXRHZ.js";import{a as sa,b as ra,d as aa,e as ca,g as da,h as Bn,j as ua}from"./chunk-K5SU4RX2.js";import{$ as In,$a as Zr,$b as Q,Aa as h,Ab as Ae,B as Hr,Bb as m,Cb as R,Db as k,Ea as Qr,Eb as be,F as Kr,Fb as jr,Ga as Yr,Ib as _e,J as fe,Jb as ve,Kb as Ce,Lb as ea,M as ye,Mb as ta,Na as Y,Nb as Ot,Pb as na,Q as it,Qa as Xr,R as O,Rb as zo,Sb as Me,Ta as an,Tb as He,Ub as At,Vb as Nn,W as b,X as S,Y as j,Yb as ia,Z as ce,Za as ln,Zb as G,_a as kn,a as M,ab as cn,ac as se,b as N,bb as Wo,bc as Jo,c as Lt,ca as Vt,cb as T,cc as Rn,da as je,db as A,eb as Bt,fb as ht,g as Mn,ga as v,gb as X,h as qr,hb as Z,ia as Ho,ib as K,jb as p,kb as g,lb as q,mb as x,na as Wr,nb as w,o as Uo,ob as Ee,pb as F,qb as Fe,rb as D,rc as Fn,sa as Ko,sb as U,sc as Ln,tb as _,tc as oa,ub as Pn,uc as de,v as qo,vb as dn,w as $r,wa as zr,wb as un,x as $o,ya as Jr,yb as me,za as Tt,zb as V}from"./chunk-PDD6YQ47.js";function Ba(n){return new fe(3e3,!1)}function hd(){return new fe(3100,!1)}function fd(){return new fe(3101,!1)}function _d(n){return new fe(3001,!1)}function vd(n){return new fe(3003,!1)}function Cd(n){return new fe(3004,!1)}function Ga(n,e){return new fe(3005,!1)}function Ua(){return new fe(3006,!1)}function qa(){return new fe(3007,!1)}function $a(n,e){return new fe(3008,!1)}function Ha(n){return new fe(3002,!1)}function Ka(n,e,t,i,o){return new fe(3010,!1)}function Wa(){return new fe(3011,!1)}function za(){return new fe(3012,!1)}function Ja(){return new fe(3200,!1)}function Qa(){return new fe(3202,!1)}function Ya(){return new fe(3013,!1)}function Xa(n){return new fe(3014,!1)}function Za(n){return new fe(3015,!1)}function ja(n){return new fe(3016,!1)}function el(n,e){return new fe(3404,!1)}function yd(n){return new fe(3502,!1)}function tl(n){return new fe(3503,!1)}function nl(){return new fe(3300,!1)}function il(n){return new fe(3504,!1)}function ol(n){return new fe(3301,!1)}function sl(n,e){return new fe(3302,!1)}function rl(n){return new fe(3303,!1)}function al(n,e){return new fe(3400,!1)}function ll(n){return new fe(3401,!1)}function cl(n){return new fe(3402,!1)}function dl(n,e){return new fe(3505,!1)}function ft(n){switch(n.length){case 0:return new Dt;case 1:return n[0];default:return new Vn(n)}}function es(n,e,t=new Map,i=new Map){let o=[],s=[],r=-1,l=null;if(e.forEach(d=>{let u=d.get("offset"),f=u==r,C=f&&l||new Map;d.forEach((y,E)=>{let I=E,P=y;if(E!=="offset")switch(I=n.normalizePropertyName(I,o),P){case mn:P=t.get(E);break;case ot:P=i.get(E);break;default:P=n.normalizeStyleValue(E,I,P,o);break}C.set(I,P)}),f||s.push(C),l=C,r=u}),o.length)throw yd(o);return s}function Jn(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&Xo(t,"start",n)));break;case"done":n.onDone(()=>i(t&&Xo(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&Xo(t,"destroy",n)));break}}function Xo(n,e,t){let i=t.totalTime,o=!!t.disabled,s=Qn(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,i??n.totalTime,o),r=n._data;return r!=null&&(s._data=r),s}function Qn(n,e,t,i,o="",s=0,r){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:o,totalTime:s,disabled:!!r}}function Ke(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function ts(n){let e=n.indexOf(":"),t=n.substring(1,e),i=n.slice(e+1);return[t,i]}var bd=typeof document>"u"?null:document.documentElement;function Yn(n){let e=n.parentNode||n.host||null;return e===bd?null:e}function Sd(n){return n.substring(1,6)=="ebkit"}var Mt=null,Oa=!1;function ul(n){Mt||(Mt=xd()||{},Oa=Mt.style?"WebkitAppearance"in Mt.style:!1);let e=!0;return Mt.style&&!Sd(n)&&(e=n in Mt.style,!e&&Oa&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Mt.style)),e}function xd(){return typeof document<"u"?document.body:null}function ns(n,e){for(;e;){if(e===n)return!0;e=Yn(e)}return!1}function is(n,e,t){if(t)return Array.from(n.querySelectorAll(e));let i=n.querySelector(e);return i?[i]:[]}var wd=1e3,os="{{",Ed="}}",ss="ng-enter",Xn="ng-leave",pn="ng-trigger",gn=".ng-trigger",rs="ng-animating",Zn=".ng-animating";function pt(n){if(typeof n=="number")return n;let e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Zo(parseFloat(e[1]),e[2])}function Zo(n,e){switch(e){case"s":return n*wd;default:return n}}function hn(n,e,t){return n.hasOwnProperty("duration")?n:Ad(n,e,t)}var Td=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function Ad(n,e,t){let i,o=0,s="";if(typeof n=="string"){let r=n.match(Td);if(r===null)return e.push(Ba(n)),{duration:0,delay:0,easing:""};i=Zo(parseFloat(r[1]),r[2]);let l=r[3];l!=null&&(o=Zo(parseFloat(l),r[4]));let d=r[5];d&&(s=d)}else i=n;if(!t){let r=!1,l=e.length;i<0&&(e.push(hd()),r=!0),o<0&&(e.push(fd()),r=!0),r&&e.splice(l,0,Ba(n))}return{duration:i,delay:o,easing:s}}function ml(n){return n.length?n[0]instanceof Map?n:n.map(e=>new Map(Object.entries(e))):[]}function st(n,e,t){e.forEach((i,o)=>{let s=jn(o);t&&!t.has(o)&&t.set(o,n.style[s]),n.style[s]=i})}function bt(n,e){e.forEach((t,i)=>{let o=jn(i);n.style[o]=""})}function qt(n){return Array.isArray(n)?n.length==1?n[0]:la(n):n}function pl(n,e,t){let i=e.params||{},o=as(n);o.length&&o.forEach(s=>{i.hasOwnProperty(s)||t.push(_d(s))})}var jo=new RegExp(`${os}\\s*(.+?)\\s*${Ed}`,"g");function as(n){let e=[];if(typeof n=="string"){let t;for(;t=jo.exec(n);)e.push(t[1]);jo.lastIndex=0}return e}function $t(n,e,t){let i=`${n}`,o=i.replace(jo,(s,r)=>{let l=e[r];return l==null&&(t.push(vd(r)),l=""),l.toString()});return o==i?n:o}var Dd=/-+([a-z0-9])/g;function jn(n){return n.replace(Dd,(...e)=>e[1].toUpperCase())}function gl(n,e){return n===0||e===0}function hl(n,e,t){if(t.size&&e.length){let i=e[0],o=[];if(t.forEach((s,r)=>{i.has(r)||o.push(r),i.set(r,s)}),o.length)for(let s=1;s<e.length;s++){let r=e[s];o.forEach(l=>r.set(l,ei(n,l)))}}return e}function We(n,e,t){switch(e.type){case ge.Trigger:return n.visitTrigger(e,t);case ge.State:return n.visitState(e,t);case ge.Transition:return n.visitTransition(e,t);case ge.Sequence:return n.visitSequence(e,t);case ge.Group:return n.visitGroup(e,t);case ge.Animate:return n.visitAnimate(e,t);case ge.Keyframes:return n.visitKeyframes(e,t);case ge.Style:return n.visitStyle(e,t);case ge.Reference:return n.visitReference(e,t);case ge.AnimateChild:return n.visitAnimateChild(e,t);case ge.AnimateRef:return n.visitAnimateRef(e,t);case ge.Query:return n.visitQuery(e,t);case ge.Stagger:return n.visitStagger(e,t);default:throw Cd(e.type)}}function ei(n,e){return window.getComputedStyle(n)[e]}var ws=(()=>{class n{validateStyleProperty(t){return ul(t)}containsElement(t,i){return ns(t,i)}getParentElement(t){return Yn(t)}query(t,i,o){return is(t,i,o)}computeStyle(t,i,o){return o||""}animate(t,i,o,s,r,l=[],d){return new Dt(o,s)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ye({token:n,factory:n.\u0275fac})}return n})(),kt=class{static NOOP=new ws},Pt=class{};var Md=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),si=class extends Pt{normalizePropertyName(e,t){return jn(e)}normalizeStyleValue(e,t,i,o){let s="",r=i.toString().trim();if(Md.has(t)&&i!==0&&i!=="0")if(typeof i=="number")s="px";else{let l=i.match(/^[+-]?[\d\.]+([a-z]*)$/);l&&l[1].length==0&&o.push(Ga(e,i))}return r+s}};var ri="*";function Id(n,e){let t=[];return typeof n=="string"?n.split(/\s*,\s*/).forEach(i=>kd(i,t,e)):t.push(n),t}function kd(n,e,t){if(n[0]==":"){let d=Pd(n,t);if(typeof d=="function"){e.push(d);return}n=d}let i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(i==null||i.length<4)return t.push(Za(n)),e;let o=i[1],s=i[2],r=i[3];e.push(fl(o,r));let l=o==ri&&r==ri;s[0]=="<"&&!l&&e.push(fl(r,o))}function Pd(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(ja(n)),"* => *"}}var ti=new Set(["true","1"]),ni=new Set(["false","0"]);function fl(n,e){let t=ti.has(n)||ni.has(n),i=ti.has(e)||ni.has(e);return(o,s)=>{let r=n==ri||n==o,l=e==ri||e==s;return!r&&t&&typeof o=="boolean"&&(r=o?ti.has(n):ni.has(n)),!l&&i&&typeof s=="boolean"&&(l=s?ti.has(e):ni.has(e)),r&&l}}var Tl=":self",Nd=new RegExp(`s*${Tl}s*,?`,"g");function Al(n,e,t,i){return new ps(n).build(e,t,i)}var _l="",ps=class{_driver;constructor(e){this._driver=e}build(e,t,i){let o=new gs(t);return this._resetContextStyleTimingState(o),We(this,qt(e),o)}_resetContextStyleTimingState(e){e.currentQuerySelector=_l,e.collectedStyles=new Map,e.collectedStyles.set(_l,new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,o=t.depCount=0,s=[],r=[];return e.name.charAt(0)=="@"&&t.errors.push(Ua()),e.definitions.forEach(l=>{if(this._resetContextStyleTimingState(t),l.type==ge.State){let d=l,u=d.name;u.toString().split(/\s*,\s*/).forEach(f=>{d.name=f,s.push(this.visitState(d,t))}),d.name=u}else if(l.type==ge.Transition){let d=this.visitTransition(l,t);i+=d.queryCount,o+=d.depCount,r.push(d)}else t.errors.push(qa())}),{type:ge.Trigger,name:e.name,states:s,transitions:r,queryCount:i,depCount:o,options:null}}visitState(e,t){let i=this.visitStyle(e.styles,t),o=e.options&&e.options.params||null;if(i.containsDynamicStyles){let s=new Set,r=o||{};i.styles.forEach(l=>{l instanceof Map&&l.forEach(d=>{as(d).forEach(u=>{r.hasOwnProperty(u)||s.add(u)})})}),s.size&&t.errors.push($a(e.name,[...s.values()]))}return{type:ge.State,name:e.name,style:i,options:o?{params:o}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let i=We(this,qt(e.animation),t),o=Id(e.expr,t.errors);return{type:ge.Transition,matchers:o,animation:i,queryCount:t.queryCount,depCount:t.depCount,options:It(e.options)}}visitSequence(e,t){return{type:ge.Sequence,steps:e.steps.map(i=>We(this,i,t)),options:It(e.options)}}visitGroup(e,t){let i=t.currentTime,o=0,s=e.steps.map(r=>{t.currentTime=i;let l=We(this,r,t);return o=Math.max(o,t.currentTime),l});return t.currentTime=o,{type:ge.Group,steps:s,options:It(e.options)}}visitAnimate(e,t){let i=Vd(e.timings,t.errors);t.currentAnimateTimings=i;let o,s=e.styles?e.styles:Qo({});if(s.type==ge.Keyframes)o=this.visitKeyframes(s,t);else{let r=e.styles,l=!1;if(!r){l=!0;let u={};i.easing&&(u.easing=i.easing),r=Qo(u)}t.currentTime+=i.duration+i.delay;let d=this.visitStyle(r,t);d.isEmptyStep=l,o=d}return t.currentAnimateTimings=null,{type:ge.Animate,timings:i,style:o,options:null}}visitStyle(e,t){let i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){let i=[],o=Array.isArray(e.styles)?e.styles:[e.styles];for(let l of o)typeof l=="string"?l===ot?i.push(l):t.errors.push(Ha(l)):i.push(new Map(Object.entries(l)));let s=!1,r=null;return i.forEach(l=>{if(l instanceof Map&&(l.has("easing")&&(r=l.get("easing"),l.delete("easing")),!s)){for(let d of l.values())if(d.toString().indexOf(os)>=0){s=!0;break}}}),{type:ge.Style,styles:i,easing:r,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){let i=t.currentAnimateTimings,o=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(r=>{typeof r!="string"&&r.forEach((l,d)=>{let u=t.collectedStyles.get(t.currentQuerySelector),f=u.get(d),C=!0;f&&(s!=o&&s>=f.startTime&&o<=f.endTime&&(t.errors.push(Ka(d,f.startTime,f.endTime,s,o)),C=!1),s=f.startTime),C&&u.set(d,{startTime:s,endTime:o}),t.options&&pl(l,t.options,t.errors)})})}visitKeyframes(e,t){let i={type:ge.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(Wa()),i;let o=1,s=0,r=[],l=!1,d=!1,u=0,f=e.steps.map(L=>{let H=this._makeStyleAst(L,t),$=H.offset!=null?H.offset:Ld(H.styles),J=0;return $!=null&&(s++,J=H.offset=$),d=d||J<0||J>1,l=l||J<u,u=J,r.push(J),H});d&&t.errors.push(za()),l&&t.errors.push(Ja());let C=e.steps.length,y=0;s>0&&s<C?t.errors.push(Qa()):s==0&&(y=o/(C-1));let E=C-1,I=t.currentTime,P=t.currentAnimateTimings,B=P.duration;return f.forEach((L,H)=>{let $=y>0?H==E?1:y*H:r[H],J=$*B;t.currentTime=I+P.delay+J,P.duration=J,this._validateStyleAst(L,t),L.offset=$,i.styles.push(L)}),i}visitReference(e,t){return{type:ge.Reference,animation:We(this,qt(e.animation),t),options:It(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:ge.AnimateChild,options:It(e.options)}}visitAnimateRef(e,t){return{type:ge.AnimateRef,animation:this.visitReference(e.animation,t),options:It(e.options)}}visitQuery(e,t){let i=t.currentQuerySelector,o=e.options||{};t.queryCount++,t.currentQuery=e;let[s,r]=Rd(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,Ke(t.collectedStyles,t.currentQuerySelector,new Map);let l=We(this,qt(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:ge.Query,selector:s,limit:o.limit||0,optional:!!o.optional,includeSelf:r,animation:l,originalSelector:e.selector,options:It(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(Ya());let i=e.timings==="full"?{duration:0,delay:0,easing:"full"}:hn(e.timings,t.errors,!0);return{type:ge.Stagger,animation:We(this,qt(e.animation),t),timings:i,options:null}}};function Rd(n){let e=!!n.split(/\s*,\s*/).find(t=>t==Tl);return e&&(n=n.replace(Nd,"")),n=n.replace(/@\*/g,gn).replace(/@\w+/g,t=>gn+"-"+t.slice(1)).replace(/:animating/g,Zn),[n,e]}function Fd(n){return n?M({},n):null}var gs=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(e){this.errors=e}};function Ld(n){if(typeof n=="string")return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){let i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){let t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function Vd(n,e){if(n.hasOwnProperty("duration"))return n;if(typeof n=="number"){let s=hn(n,e).duration;return ls(s,0,"")}let t=n;if(t.split(/\s+/).some(s=>s.charAt(0)=="{"&&s.charAt(1)=="{")){let s=ls(0,0,"");return s.dynamic=!0,s.strValue=t,s}let o=hn(t,e);return ls(o.duration,o.delay,o.easing)}function It(n){return n?(n=M({},n),n.params&&(n.params=Fd(n.params))):n={},n}function ls(n,e,t){return{duration:n,delay:e,easing:t}}function Es(n,e,t,i,o,s,r=null,l=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:o,delay:s,totalTime:o+s,easing:r,subTimeline:l}}var _n=class{_map=new Map;get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},Bd=1,Od=":enter",Gd=new RegExp(Od,"g"),Ud=":leave",qd=new RegExp(Ud,"g");function Dl(n,e,t,i,o,s=new Map,r=new Map,l,d,u=[]){return new hs().buildKeyframes(n,e,t,i,o,s,r,l,d,u)}var hs=class{buildKeyframes(e,t,i,o,s,r,l,d,u,f=[]){u=u||new _n;let C=new fs(e,t,u,o,s,f,[]);C.options=d;let y=d.delay?pt(d.delay):0;C.currentTimeline.delayNextStep(y),C.currentTimeline.setStyles([r],null,C.errors,d),We(this,i,C);let E=C.timelines.filter(I=>I.containsAnimation());if(E.length&&l.size){let I;for(let P=E.length-1;P>=0;P--){let B=E[P];if(B.element===t){I=B;break}}I&&!I.allowOnlyTimelineStyles()&&I.setStyles([l],null,C.errors,d)}return E.length?E.map(I=>I.buildKeyframes()):[Es(t,[],[],[],0,y,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let i=t.subInstructions.get(t.element);if(i){let o=t.createSubContext(e.options),s=t.currentTimeline.currentTime,r=this._visitSubInstructions(i,o,o.options);s!=r&&t.transformIntoNewTimeline(r)}t.previousNode=e}visitAnimateRef(e,t){let i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(let o of e){let s=o?.delay;if(s){let r=typeof s=="number"?s:pt($t(s,o?.params??{},t.errors));i.delayNextStep(r)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime,r=i.duration!=null?pt(i.duration):null,l=i.delay!=null?pt(i.delay):null;return r!==0&&e.forEach(d=>{let u=t.appendInstructionToTimeline(d,r,l);s=Math.max(s,u.duration+u.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),We(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let i=t.subContextCount,o=t,s=e.options;if(s&&(s.params||s.delay)&&(o=t.createSubContext(s),o.transformIntoNewTimeline(),s.delay!=null)){o.previousNode.type==ge.Style&&(o.currentTimeline.snapshotCurrentStyles(),o.previousNode=ai);let r=pt(s.delay);o.delayNextStep(r)}e.steps.length&&(e.steps.forEach(r=>We(this,r,o)),o.currentTimeline.applyStylesToKeyframe(),o.subContextCount>i&&o.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let i=[],o=t.currentTimeline.currentTime,s=e.options&&e.options.delay?pt(e.options.delay):0;e.steps.forEach(r=>{let l=t.createSubContext(e.options);s&&l.delayNextStep(s),We(this,r,l),o=Math.max(o,l.currentTimeline.currentTime),i.push(l.currentTimeline)}),i.forEach(r=>t.currentTimeline.mergeTimelineCollectedStyles(r)),t.transformIntoNewTimeline(o),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let i=e.strValue,o=t.params?$t(i,t.params,t.errors):i;return hn(o,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let i=t.currentAnimateTimings=this._visitTiming(e.timings,t),o=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),o.snapshotCurrentStyles());let s=e.style;s.type==ge.Keyframes?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),o.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let i=t.currentTimeline,o=t.currentAnimateTimings;!o&&i.hasCurrentStyleProperties()&&i.forwardFrame();let s=o&&o.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let i=t.currentAnimateTimings,o=t.currentTimeline.duration,s=i.duration,l=t.createSubContext().currentTimeline;l.easing=i.easing,e.styles.forEach(d=>{let u=d.offset||0;l.forwardTime(u*s),l.setStyles(d.styles,d.easing,t.errors,t.options),l.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(l),t.transformIntoNewTimeline(o+s),t.previousNode=e}visitQuery(e,t){let i=t.currentTimeline.currentTime,o=e.options||{},s=o.delay?pt(o.delay):0;s&&(t.previousNode.type===ge.Style||i==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=ai);let r=i,l=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!o.optional,t.errors);t.currentQueryTotal=l.length;let d=null;l.forEach((u,f)=>{t.currentQueryIndex=f;let C=t.createSubContext(e.options,u);s&&C.delayNextStep(s),u===t.element&&(d=C.currentTimeline),We(this,e.animation,C),C.currentTimeline.applyStylesToKeyframe();let y=C.currentTimeline.currentTime;r=Math.max(r,y)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(r),d&&(t.currentTimeline.mergeTimelineCollectedStyles(d),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let i=t.parentContext,o=t.currentTimeline,s=e.timings,r=Math.abs(s.duration),l=r*(t.currentQueryTotal-1),d=r*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":d=l-d;break;case"full":d=i.currentStaggerTime;break}let f=t.currentTimeline;d&&f.delayNextStep(d);let C=f.currentTime;We(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=o.currentTime-C+(o.startTime-i.currentTimeline.startTime)}},ai={},fs=class n{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=ai;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(e,t,i,o,s,r,l,d){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=o,this._leaveClassName=s,this.errors=r,this.timelines=l,this.currentTimeline=d||new li(this._driver,t,0),l.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let i=e,o=this.options;i.duration!=null&&(o.duration=pt(i.duration)),i.delay!=null&&(o.delay=pt(i.delay));let s=i.params;if(s){let r=o.params;r||(r=this.options.params={}),Object.keys(s).forEach(l=>{(!t||!r.hasOwnProperty(l))&&(r[l]=$t(s[l],r,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let i=e.params={};Object.keys(t).forEach(o=>{i[o]=t[o]})}}return e}createSubContext(e=null,t,i){let o=t||this.element,s=new n(this._driver,o,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(o,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=ai,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){let o={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new _s(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,o,e.stretchStartingKeyframe);return this.timelines.push(s),o}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,o,s,r){let l=[];if(o&&l.push(this.element),e.length>0){e=e.replace(Gd,"."+this._enterClassName),e=e.replace(qd,"."+this._leaveClassName);let d=i!=1,u=this._driver.query(this.element,e,d);i!==0&&(u=i<0?u.slice(u.length+i,u.length):u.slice(0,i)),l.push(...u)}return!s&&l.length==0&&r.push(Xa(t)),l}},li=class n{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(e,t,i,o){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=o,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new n(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=Bd,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||ot),this._currentKeyframe.set(t,ot);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,o){t&&this._previousKeyframe.set("easing",t);let s=o&&o.params||{},r=$d(e,this._globalTimelineStyles);for(let[l,d]of r){let u=$t(d,s,i);this._pendingStyles.set(l,u),this._localTimelineStyles.has(l)||this._backFill.set(l,this._globalTimelineStyles.get(l)??ot),this._updateStyle(l,u)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{let o=this._styleSummary.get(i);(!o||t.time>o.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,i=this._keyframes.size===1&&this.duration===0,o=[];this._keyframes.forEach((l,d)=>{let u=new Map([...this._backFill,...l]);u.forEach((f,C)=>{f===mn?e.add(C):f===ot&&t.add(C)}),i||u.set("offset",d/this.duration),o.push(u)});let s=[...e.values()],r=[...t.values()];if(i){let l=o[0],d=new Map(l);l.set("offset",0),d.set("offset",1),o=[l,d]}return Es(this.element,o,s,r,this.duration,this.startTime,this.easing,!1)}},_s=class extends li{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(e,t,i,o,s,r,l=!1){super(e,t,r.delay),this.keyframes=i,this.preStyleProps=o,this.postStyleProps=s,this._stretchStartingKeyframe=l,this.timings={duration:r.duration,delay:r.delay,easing:r.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:o}=this.timings;if(this._stretchStartingKeyframe&&t){let s=[],r=i+t,l=t/r,d=new Map(e[0]);d.set("offset",0),s.push(d);let u=new Map(e[0]);u.set("offset",vl(l)),s.push(u);let f=e.length-1;for(let C=1;C<=f;C++){let y=new Map(e[C]),E=y.get("offset"),I=t+E*i;y.set("offset",vl(I/r)),s.push(y)}i=r,t=0,o="",e=s}return Es(this.element,e,this.preStyleProps,this.postStyleProps,i,t,o,!0)}};function vl(n,e=3){let t=Math.pow(10,e-1);return Math.round(n*t)/t}function $d(n,e){let t=new Map,i;return n.forEach(o=>{if(o==="*"){i??=e.keys();for(let s of i)t.set(s,ot)}else for(let[s,r]of o)t.set(s,r)}),t}function Cl(n,e,t,i,o,s,r,l,d,u,f,C,y){return{type:0,element:n,triggerName:e,isRemovalTransition:o,fromState:t,fromStyles:s,toState:i,toStyles:r,timelines:l,queriedElements:d,preStyleProps:u,postStyleProps:f,totalTime:C,errors:y}}var cs={},ci=class{_triggerName;ast;_stateStyles;constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,o){return Hd(this.ast.matchers,e,t,i,o)}buildStyles(e,t,i){let o=this._stateStyles.get("*");return e!==void 0&&(o=this._stateStyles.get(e?.toString())||o),o?o.buildStyles(t,i):new Map}build(e,t,i,o,s,r,l,d,u,f){let C=[],y=this.ast.options&&this.ast.options.params||cs,E=l&&l.params||cs,I=this.buildStyles(i,E,C),P=d&&d.params||cs,B=this.buildStyles(o,P,C),L=new Set,H=new Map,$=new Map,J=o==="void",te={params:Ml(P,y),delay:this.ast.options?.delay},re=f?[]:Dl(e,t,this.ast.animation,s,r,I,B,te,u,C),ne=0;return re.forEach(pe=>{ne=Math.max(pe.duration+pe.delay,ne)}),C.length?Cl(t,this._triggerName,i,o,J,I,B,[],[],H,$,ne,C):(re.forEach(pe=>{let ie=pe.element,ue=Ke(H,ie,new Set);pe.preStyleProps.forEach(Oe=>ue.add(Oe));let ke=Ke($,ie,new Set);pe.postStyleProps.forEach(Oe=>ke.add(Oe)),ie!==t&&L.add(ie)}),Cl(t,this._triggerName,i,o,J,I,B,re,[...L.values()],H,$,ne))}};function Hd(n,e,t,i,o){return n.some(s=>s(e,t,i,o))}function Ml(n,e){let t=M({},e);return Object.entries(n).forEach(([i,o])=>{o!=null&&(t[i]=o)}),t}var vs=class{styles;defaultParams;normalizer;constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){let i=new Map,o=Ml(e,this.defaultParams);return this.styles.styles.forEach(s=>{typeof s!="string"&&s.forEach((r,l)=>{r&&(r=$t(r,o,t));let d=this.normalizer.normalizePropertyName(l,t);r=this.normalizer.normalizeStyleValue(l,d,r,t),i.set(l,r)})}),i}};function Kd(n,e,t){return new Cs(n,e,t)}var Cs=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,t.states.forEach(o=>{let s=o.options&&o.options.params||{};this.states.set(o.name,new vs(o.style,s,i))}),yl(this.states,"true","1"),yl(this.states,"false","0"),t.transitions.forEach(o=>{this.transitionFactories.push(new ci(e,o,this.states))}),this.fallbackTransition=Wd(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,o){return this.transitionFactories.find(r=>r.match(e,t,i,o))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}};function Wd(n,e,t){let i=[(r,l)=>!0],o={type:ge.Sequence,steps:[],options:null},s={type:ge.Transition,animation:o,matchers:i,options:null,queryCount:0,depCount:0};return new ci(n,s,e)}function yl(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}var zd=new _n,ys=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i}register(e,t){let i=[],o=[],s=Al(this._driver,t,i,o);if(i.length)throw tl(i);this._animations.set(e,s)}_buildPlayer(e,t,i){let o=e.element,s=es(this._normalizer,e.keyframes,t,i);return this._driver.animate(o,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){let o=[],s=this._animations.get(e),r,l=new Map;if(s?(r=Dl(this._driver,t,s,ss,Xn,new Map,new Map,i,zd,o),r.forEach(f=>{let C=Ke(l,f.element,new Map);f.postStyleProps.forEach(y=>C.set(y,null))})):(o.push(nl()),r=[]),o.length)throw il(o);l.forEach((f,C)=>{f.forEach((y,E)=>{f.set(E,this._driver.computeStyle(C,E,ot))})});let d=r.map(f=>{let C=l.get(f.element);return this._buildPlayer(f,new Map,C)}),u=ft(d);return this._playersById.set(e,u),u.onDestroy(()=>this.destroy(e)),this.players.push(u),u}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw ol(e);return t}listen(e,t,i,o){let s=Qn(t,"","","");return Jn(this._getPlayer(e),i,s,o),()=>{}}command(e,t,i,o){if(i=="register"){this.register(e,o[0]);return}if(i=="create"){let r=o[0]||{};this.create(e,t,r);return}let s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(o[0]));break;case"destroy":this.destroy(e);break}}},bl="ng-animate-queued",Jd=".ng-animate-queued",ds="ng-animate-disabled",Qd=".ng-animate-disabled",Yd="ng-star-inserted",Xd=".ng-star-inserted",Zd=[],Il={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},jd={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},rt="__ng_removed",vn=class{namespaceId;value;options;get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let i=e&&e.hasOwnProperty("value"),o=i?e.value:e;if(this.value=tu(o),i){let s=e,{value:r}=s,l=Lt(s,["value"]);this.options=l}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let i=this.options.params;Object.keys(t).forEach(o=>{i[o]==null&&(i[o]=t[o])})}}},fn="void",us=new vn(fn),bs=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this._hostClassName="ng-tns-"+e,tt(t,this._hostClassName)}listen(e,t,i,o){if(!this._triggers.has(t))throw sl(i,t);if(i==null||i.length==0)throw rl(t);if(!nu(i))throw al(i,t);let s=Ke(this._elementListeners,e,[]),r={name:t,phase:i,callback:o};s.push(r);let l=Ke(this._engine.statesByElement,e,new Map);return l.has(t)||(tt(e,pn),tt(e,pn+"-"+t),l.set(t,us)),()=>{this._engine.afterFlush(()=>{let d=s.indexOf(r);d>=0&&s.splice(d,1),this._triggers.has(t)||l.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw ll(e);return t}trigger(e,t,i,o=!0){let s=this._getTrigger(t),r=new Cn(this.id,t,e),l=this._engine.statesByElement.get(e);l||(tt(e,pn),tt(e,pn+"-"+t),this._engine.statesByElement.set(e,l=new Map));let d=l.get(t),u=new vn(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&d&&u.absorbOptions(d.options),l.set(t,u),d||(d=us),!(u.value===fn)&&d.value===u.value){if(!su(d.params,u.params)){let P=[],B=s.matchStyles(d.value,d.params,P),L=s.matchStyles(u.value,u.params,P);P.length?this._engine.reportError(P):this._engine.afterFlush(()=>{bt(e,B),st(e,L)})}return}let y=Ke(this._engine.playersByElement,e,[]);y.forEach(P=>{P.namespaceId==this.id&&P.triggerName==t&&P.queued&&P.destroy()});let E=s.matchTransition(d.value,u.value,e,u.params),I=!1;if(!E){if(!o)return;E=s.fallbackTransition,I=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:E,fromState:d,toState:u,player:r,isFallbackTransition:I}),I||(tt(e,bl),r.onStart(()=>{Ht(e,bl)})),r.onDone(()=>{let P=this.players.indexOf(r);P>=0&&this.players.splice(P,1);let B=this._engine.playersByElement.get(e);if(B){let L=B.indexOf(r);L>=0&&B.splice(L,1)}}),this.players.push(r),y.push(r),r}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(o=>o.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let i=this._engine.driver.query(e,gn,!0);i.forEach(o=>{if(o[rt])return;let s=this._engine.fetchNamespacesByElement(o);s.size?s.forEach(r=>r.triggerLeaveAnimation(o,t,!1,!0)):this.clearElementCache(o)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(o=>this.clearElementCache(o)))}triggerLeaveAnimation(e,t,i,o){let s=this._engine.statesByElement.get(e),r=new Map;if(s){let l=[];if(s.forEach((d,u)=>{if(r.set(u,d.value),this._triggers.has(u)){let f=this.trigger(e,u,fn,o);f&&l.push(f)}}),l.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,r),i&&ft(l).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){let o=new Set;t.forEach(s=>{let r=s.name;if(o.has(r))return;o.add(r);let d=this._triggers.get(r).fallbackTransition,u=i.get(r)||us,f=new vn(fn),C=new Cn(this.id,r,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:r,transition:d,fromState:u,toState:f,player:C,isFallbackTransition:!0})})}}removeNode(e,t){let i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let o=!1;if(i.totalAnimations){let s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)o=!0;else{let r=e;for(;r=r.parentNode;)if(i.statesByElement.get(r)){o=!0;break}}}if(this.prepareLeaveAnimationListeners(e),o)i.markElementAsRemoved(this.id,e,!1,t);else{let s=e[rt];(!s||s===Il)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){tt(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(i=>{let o=i.player;if(o.destroyed)return;let s=i.element,r=this._elementListeners.get(s);r&&r.forEach(l=>{if(l.name==i.triggerName){let d=Qn(s,i.triggerName,i.fromState.value,i.toState.value);d._data=e,Jn(i.player,l.phase,d,l.callback)}}),o.markedForDestroy?this._engine.afterFlush(()=>{o.destroy()}):t.push(i)}),this._queue=[],t.sort((i,o)=>{let s=i.transition.ast.depCount,r=o.transition.ast.depCount;return s==0||r==0?s-r:this._engine.driver.containsElement(i.element,o.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},Ss=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(e,t)=>{};_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){let i=new bs(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){let i=this._namespaceList,o=this.namespacesByHostElement;if(i.length-1>=0){let r=!1,l=this.driver.getParentElement(t);for(;l;){let d=o.get(l);if(d){let u=i.indexOf(d);i.splice(u+1,0,e),r=!0;break}l=this.driver.getParentElement(l)}r||i.unshift(e)}else i.push(e);return o.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let o=this._namespaceLookup[e];o&&o.register(t,i)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let i=this._fetchNamespace(e);this.namespacesByHostElement.delete(i.hostElement);let o=this._namespaceList.indexOf(i);o>=0&&this._namespaceList.splice(o,1),i.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,i=this.statesByElement.get(e);if(i){for(let o of i.values())if(o.namespaceId){let s=this._fetchNamespace(o.namespaceId);s&&t.add(s)}}return t}trigger(e,t,i,o){if(ii(t)){let s=this._fetchNamespace(e);if(s)return s.trigger(t,i,o),!0}return!1}insertNode(e,t,i,o){if(!ii(t))return;let s=t[rt];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;let r=this.collectedLeaveElements.indexOf(t);r>=0&&this.collectedLeaveElements.splice(r,1)}if(e){let r=this._fetchNamespace(e);r&&r.insertNode(t,i)}o&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),tt(e,ds)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Ht(e,ds))}removeNode(e,t,i){if(ii(t)){let o=e?this._fetchNamespace(e):null;o?o.removeNode(t,i):this.markElementAsRemoved(e,t,!1,i);let s=this.namespacesByHostElement.get(t);s&&s.id!==e&&s.removeNode(t,i)}else this._onRemovalComplete(t,i)}markElementAsRemoved(e,t,i,o,s){this.collectedLeaveElements.push(t),t[rt]={namespaceId:e,setForRemoval:o,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,o,s){return ii(t)?this._fetchNamespace(e).listen(t,i,o,s):()=>{}}_buildInstruction(e,t,i,o,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,o,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,gn,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,Zn,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return ft(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[rt];if(t&&t.setForRemoval){if(e[rt]=Il,t.namespaceId){this.destroyInnerAnimations(e);let i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(ds)&&this.markElementAsDisabled(e,!1),this.driver.query(e,Qd,!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,o)=>this._balanceNamespaceList(i,o)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++){let o=this.collectedEnterElements[i];tt(o,Yd)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let i=[];try{t=this._flushAnimations(i,e)}finally{for(let o=0;o<i.length;o++)i[o]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++){let o=this.collectedLeaveElements[i];this.processLeaveNode(o)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){let i=this._whenQuietFns;this._whenQuietFns=[],t.length?ft(t).onDone(()=>{i.forEach(o=>o())}):i.forEach(o=>o())}}reportError(e){throw cl(e)}_flushAnimations(e,t){let i=new _n,o=[],s=new Map,r=[],l=new Map,d=new Map,u=new Map,f=new Set;this.disabledNodes.forEach(z=>{f.add(z);let ee=this.driver.query(z,Jd,!0);for(let oe=0;oe<ee.length;oe++)f.add(ee[oe])});let C=this.bodyNode,y=Array.from(this.statesByElement.keys()),E=wl(y,this.collectedEnterElements),I=new Map,P=0;E.forEach((z,ee)=>{let oe=ss+P++;I.set(ee,oe),z.forEach(he=>tt(he,oe))});let B=[],L=new Set,H=new Set;for(let z=0;z<this.collectedLeaveElements.length;z++){let ee=this.collectedLeaveElements[z],oe=ee[rt];oe&&oe.setForRemoval&&(B.push(ee),L.add(ee),oe.hasAnimation?this.driver.query(ee,Xd,!0).forEach(he=>L.add(he)):H.add(ee))}let $=new Map,J=wl(y,Array.from(L));J.forEach((z,ee)=>{let oe=Xn+P++;$.set(ee,oe),z.forEach(he=>tt(he,oe))}),e.push(()=>{E.forEach((z,ee)=>{let oe=I.get(ee);z.forEach(he=>Ht(he,oe))}),J.forEach((z,ee)=>{let oe=$.get(ee);z.forEach(he=>Ht(he,oe))}),B.forEach(z=>{this.processLeaveNode(z)})});let te=[],re=[];for(let z=this._namespaceList.length-1;z>=0;z--)this._namespaceList[z].drainQueuedTransitions(t).forEach(oe=>{let he=oe.player,Re=oe.element;if(te.push(he),this.collectedEnterElements.length){let Ge=Re[rt];if(Ge&&Ge.setForMove){if(Ge.previousTriggersValues&&Ge.previousTriggersValues.has(oe.triggerName)){let Et=Ge.previousTriggersValues.get(oe.triggerName),Ze=this.statesByElement.get(oe.element);if(Ze&&Ze.has(oe.triggerName)){let Dn=Ze.get(oe.triggerName);Dn.value=Et,Ze.set(oe.triggerName,Dn)}}he.destroy();return}}let ut=!C||!this.driver.containsElement(C,Re),Ye=$.get(Re),yt=I.get(Re),De=this._buildInstruction(oe,i,yt,Ye,ut);if(De.errors&&De.errors.length){re.push(De);return}if(ut){he.onStart(()=>bt(Re,De.fromStyles)),he.onDestroy(()=>st(Re,De.toStyles)),o.push(he);return}if(oe.isFallbackTransition){he.onStart(()=>bt(Re,De.fromStyles)),he.onDestroy(()=>st(Re,De.toStyles)),o.push(he);return}let Ur=[];De.timelines.forEach(Ge=>{Ge.stretchStartingKeyframe=!0,this.disabledNodes.has(Ge.element)||Ur.push(Ge)}),De.timelines=Ur,i.append(Re,De.timelines);let gd={instruction:De,player:he,element:Re};r.push(gd),De.queriedElements.forEach(Ge=>Ke(l,Ge,[]).push(he)),De.preStyleProps.forEach((Ge,Et)=>{if(Ge.size){let Ze=d.get(Et);Ze||d.set(Et,Ze=new Set),Ge.forEach((Dn,Go)=>Ze.add(Go))}}),De.postStyleProps.forEach((Ge,Et)=>{let Ze=u.get(Et);Ze||u.set(Et,Ze=new Set),Ge.forEach((Dn,Go)=>Ze.add(Go))})});if(re.length){let z=[];re.forEach(ee=>{z.push(dl(ee.triggerName,ee.errors))}),te.forEach(ee=>ee.destroy()),this.reportError(z)}let ne=new Map,pe=new Map;r.forEach(z=>{let ee=z.element;i.has(ee)&&(pe.set(ee,ee),this._beforeAnimationBuild(z.player.namespaceId,z.instruction,ne))}),o.forEach(z=>{let ee=z.element;this._getPreviousPlayers(ee,!1,z.namespaceId,z.triggerName,null).forEach(he=>{Ke(ne,ee,[]).push(he),he.destroy()})});let ie=B.filter(z=>El(z,d,u)),ue=new Map;xl(ue,this.driver,H,u,ot).forEach(z=>{El(z,d,u)&&ie.push(z)});let Oe=new Map;E.forEach((z,ee)=>{xl(Oe,this.driver,new Set(z),d,mn)}),ie.forEach(z=>{let ee=ue.get(z),oe=Oe.get(z);ue.set(z,new Map([...ee?.entries()??[],...oe?.entries()??[]]))});let we=[],Qe=[],rn={};r.forEach(z=>{let{element:ee,player:oe,instruction:he}=z;if(i.has(ee)){if(f.has(ee)){oe.onDestroy(()=>st(ee,he.toStyles)),oe.disabled=!0,oe.overrideTotalTime(he.totalTime),o.push(oe);return}let Re=rn;if(pe.size>1){let Ye=ee,yt=[];for(;Ye=Ye.parentNode;){let De=pe.get(Ye);if(De){Re=De;break}yt.push(Ye)}yt.forEach(De=>pe.set(De,Re))}let ut=this._buildAnimation(oe.namespaceId,he,ne,s,Oe,ue);if(oe.setRealPlayer(ut),Re===rn)we.push(oe);else{let Ye=this.playersByElement.get(Re);Ye&&Ye.length&&(oe.parentPlayer=ft(Ye)),o.push(oe)}}else bt(ee,he.fromStyles),oe.onDestroy(()=>st(ee,he.toStyles)),Qe.push(oe),f.has(ee)&&o.push(oe)}),Qe.forEach(z=>{let ee=s.get(z.element);if(ee&&ee.length){let oe=ft(ee);z.setRealPlayer(oe)}}),o.forEach(z=>{z.parentPlayer?z.syncPlayerEvents(z.parentPlayer):z.destroy()});for(let z=0;z<B.length;z++){let ee=B[z],oe=ee[rt];if(Ht(ee,Xn),oe&&oe.hasAnimation)continue;let he=[];if(l.size){let ut=l.get(ee);ut&&ut.length&&he.push(...ut);let Ye=this.driver.query(ee,Zn,!0);for(let yt=0;yt<Ye.length;yt++){let De=l.get(Ye[yt]);De&&De.length&&he.push(...De)}}let Re=he.filter(ut=>!ut.destroyed);Re.length?iu(this,ee,Re):this.processLeaveNode(ee)}return B.length=0,we.forEach(z=>{this.players.push(z),z.onDone(()=>{z.destroy();let ee=this.players.indexOf(z);this.players.splice(ee,1)}),z.play()}),we}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,o,s){let r=[];if(t){let l=this.playersByQueriedElement.get(e);l&&(r=l)}else{let l=this.playersByElement.get(e);if(l){let d=!s||s==fn;l.forEach(u=>{u.queued||!d&&u.triggerName!=o||r.push(u)})}}return(i||o)&&(r=r.filter(l=>!(i&&i!=l.namespaceId||o&&o!=l.triggerName))),r}_beforeAnimationBuild(e,t,i){let o=t.triggerName,s=t.element,r=t.isRemovalTransition?void 0:e,l=t.isRemovalTransition?void 0:o;for(let d of t.timelines){let u=d.element,f=u!==s,C=Ke(i,u,[]);this._getPreviousPlayers(u,f,r,l,t.toState).forEach(E=>{let I=E.getRealPlayer();I.beforeDestroy&&I.beforeDestroy(),E.destroy(),C.push(E)})}bt(s,t.fromStyles)}_buildAnimation(e,t,i,o,s,r){let l=t.triggerName,d=t.element,u=[],f=new Set,C=new Set,y=t.timelines.map(I=>{let P=I.element;f.add(P);let B=P[rt];if(B&&B.removedBeforeQueried)return new Dt(I.duration,I.delay);let L=P!==d,H=ou((i.get(P)||Zd).map(ne=>ne.getRealPlayer())).filter(ne=>{let pe=ne;return pe.element?pe.element===P:!1}),$=s.get(P),J=r.get(P),te=es(this._normalizer,I.keyframes,$,J),re=this._buildPlayer(I,te,H);if(I.subTimeline&&o&&C.add(P),L){let ne=new Cn(e,l,P);ne.setRealPlayer(re),u.push(ne)}return re});u.forEach(I=>{Ke(this.playersByQueriedElement,I.element,[]).push(I),I.onDone(()=>eu(this.playersByQueriedElement,I.element,I))}),f.forEach(I=>tt(I,rs));let E=ft(y);return E.onDestroy(()=>{f.forEach(I=>Ht(I,rs)),st(d,t.toStyles)}),C.forEach(I=>{Ke(o,I,[]).push(E)}),E}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new Dt(e.duration,e.delay)}},Cn=class{namespaceId;triggerName;element;_player=new Dt;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(o=>Jn(e,i,void 0,o))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Ke(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function eu(n,e,t){let i=n.get(e);if(i){if(i.length){let o=i.indexOf(t);i.splice(o,1)}i.length==0&&n.delete(e)}return i}function tu(n){return n??null}function ii(n){return n&&n.nodeType===1}function nu(n){return n=="start"||n=="done"}function Sl(n,e){let t=n.style.display;return n.style.display=e??"none",t}function xl(n,e,t,i,o){let s=[];t.forEach(d=>s.push(Sl(d)));let r=[];i.forEach((d,u)=>{let f=new Map;d.forEach(C=>{let y=e.computeStyle(u,C,o);f.set(C,y),(!y||y.length==0)&&(u[rt]=jd,r.push(u))}),n.set(u,f)});let l=0;return t.forEach(d=>Sl(d,s[l++])),r}function wl(n,e){let t=new Map;if(n.forEach(l=>t.set(l,[])),e.length==0)return t;let i=1,o=new Set(e),s=new Map;function r(l){if(!l)return i;let d=s.get(l);if(d)return d;let u=l.parentNode;return t.has(u)?d=u:o.has(u)?d=i:d=r(u),s.set(l,d),d}return e.forEach(l=>{let d=r(l);d!==i&&t.get(d).push(l)}),t}function tt(n,e){n.classList?.add(e)}function Ht(n,e){n.classList?.remove(e)}function iu(n,e,t){ft(t).onDone(()=>n.processLeaveNode(e))}function ou(n){let e=[];return kl(n,e),e}function kl(n,e){for(let t=0;t<n.length;t++){let i=n[t];i instanceof Vn?kl(i.players,e):e.push(i)}}function su(n,e){let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let o=0;o<t.length;o++){let s=t[o];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}function El(n,e,t){let i=t.get(n);if(!i)return!1;let o=e.get(n);return o?i.forEach(s=>o.add(s)):e.set(n,i),t.delete(n),!0}var Kt=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(e,t)=>{};constructor(e,t,i){this._driver=t,this._normalizer=i,this._transitionEngine=new Ss(e.body,t,i),this._timelineEngine=new ys(e.body,t,i),this._transitionEngine.onRemovalComplete=(o,s)=>this.onRemovalComplete(o,s)}registerTrigger(e,t,i,o,s){let r=e+"-"+o,l=this._triggerCache[r];if(!l){let d=[],u=[],f=Al(this._driver,s,d,u);if(d.length)throw el(o,d);l=Kd(o,f,this._normalizer),this._triggerCache[r]=l}this._transitionEngine.registerTrigger(t,o,l)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,o){this._transitionEngine.insertNode(e,t,i,o)}onRemove(e,t,i){this._transitionEngine.removeNode(e,t,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,o){if(i.charAt(0)=="@"){let[s,r]=ts(i),l=o;this._timelineEngine.command(s,t,r,l)}else this._transitionEngine.trigger(e,t,i,o)}listen(e,t,i,o,s){if(i.charAt(0)=="@"){let[r,l]=ts(i);return this._timelineEngine.listen(r,t,l,s)}return this._transitionEngine.listen(e,t,i,o,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function ru(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=ms(e[0]),e.length>1&&(i=ms(e[e.length-1]))):e instanceof Map&&(t=ms(e)),t||i?new au(n,t,i):null}var au=(()=>{class n{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(t,i,o){this._element=t,this._startStyles=i,this._endStyles=o;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&st(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(st(this._element,this._initialStyles),this._endStyles&&(st(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(bt(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(bt(this._element,this._endStyles),this._endStyles=null),st(this._element,this._initialStyles),this._state=3)}}return n})();function ms(n){let e=null;return n.forEach((t,i)=>{lu(i)&&(e=e||new Map,e.set(i,t))}),e}function lu(n){return n==="display"||n==="position"}var di=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer=null;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(e,t,i,o){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=o,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer()&&this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return this.domPlayer;this._initialized=!0;let e=this.keyframes,t=this._triggerWebAnimation(this.element,e,this.options);if(!t)return this._onFinish(),null;this.domPlayer=t,this._finalKeyframe=e.length?e[e.length-1]:new Map;let i=()=>this._onFinish();return t.addEventListener("finish",i),this.onDestroy(()=>{t.removeEventListener("finish",i)}),t}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer?.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){let o=this._convertKeyframesToObject(t);try{return e.animate(o,i)}catch{return null}}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){let e=this._buildPlayer();e&&(this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),e.play())}pause(){this.init(),this.domPlayer?.pause()}finish(){this.init(),this.domPlayer&&(this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish())}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer?.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer||this.init(),this.domPlayer&&(this.domPlayer.currentTime=e*this.time)}getPosition(){return this.domPlayer?+(this.domPlayer.currentTime??0)/this.time:this._initialized?1:0}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,o)=>{o!=="offset"&&e.set(o,this._finished?i:ei(this.element,o))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},ui=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return ns(e,t)}getParentElement(e){return Yn(e)}query(e,t,i){return is(e,t,i)}computeStyle(e,t,i){return ei(e,t)}animate(e,t,i,o,s,r=[]){let l=o==0?"both":"forwards",d={duration:i,delay:o,fill:l};s&&(d.easing=s);let u=new Map,f=r.filter(E=>E instanceof di);gl(i,o)&&f.forEach(E=>{E.currentSnapshot.forEach((I,P)=>u.set(P,I))});let C=ml(t).map(E=>new Map(E));C=hl(e,C,u);let y=ru(e,C);return new di(e,C,d,y)}};var oi="@",Pl="@.disabled",mi=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(e,t,i,o){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=o}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,o=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,o)}removeChild(e,t,i,o){if(o){this.delegate.removeChild(e,t,i,o);return}this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,o){this.delegate.setAttribute(e,t,i,o)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,o){this.delegate.setStyle(e,t,i,o)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){t.charAt(0)==oi&&t==Pl?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i,o){return this.delegate.listen(e,t,i,o)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},xs=class extends mi{factory;constructor(e,t,i,o,s){super(t,i,o,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){t.charAt(0)==oi?t.charAt(1)=="."&&t==Pl?(i=i===void 0?!0:!!i,this.disableAnimations(e,i)):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i,o){if(t.charAt(0)==oi){let s=cu(e),r=t.slice(1),l="";return r.charAt(0)!=oi&&([r,l]=du(r)),this.engine.listen(this.namespaceId,s,r,l,d=>{let u=d._data||-1;this.factory.scheduleListenerCallback(u,i,d)})}return this.delegate.listen(e,t,i,o)}};function cu(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}function du(n){let e=n.indexOf("."),t=n.substring(0,e),i=n.slice(e+1);return[t,i]}var pi=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(e,t,i){this.delegate=e,this.engine=t,this._zone=i,t.onRemovalComplete=(o,s)=>{s?.removeChild(null,o)}}createRenderer(e,t){let o=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let u=this._rendererCache,f=u.get(o);if(!f){let C=()=>u.delete(o);f=new mi("",o,this.engine,C),u.set(o,f)}return f}let s=t.id,r=t.id+"-"+this._currentId;this._currentId++,this.engine.register(r,e);let l=u=>{Array.isArray(u)?u.forEach(l):this.engine.registerTrigger(s,r,e,u.name,u)};return t.data.animation.forEach(l),new xs(this,r,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,i){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(i));return}let o=this._animationCallbacksBuffer;o.length==0&&queueMicrotask(()=>{this._zone.run(()=>{o.forEach(s=>{let[r,l]=s;r(l)}),this._animationCallbacksBuffer=[]})}),o.push([t,i])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(e){this.engine.flush(),this.delegate.componentReplaced?.(e)}};var mu=(()=>{class n extends Kt{constructor(t,i,o){super(t,i,o)}ngOnDestroy(){this.flush()}static \u0275fac=function(i){return new(i||n)(it(In),it(kt),it(Pt))};static \u0275prov=ye({token:n,factory:n.\u0275fac})}return n})();function pu(){return new si}function gu(){return new pi(O(sa),O(Kt),O(je))}var Nl=[{provide:Pt,useFactory:pu},{provide:Kt,useClass:mu},{provide:Yr,useFactory:gu}],Ex=[{provide:kt,useClass:ws},{provide:Ko,useValue:"NoopAnimations"},...Nl],hu=[{provide:kt,useFactory:()=>new ui},{provide:Ko,useFactory:()=>"BrowserAnimations"},...Nl];function Rl(){return Qr("NgEagerAnimations"),[...hu]}var fu={dashboard:{},accounts:{},settings:{},leads:{requiredFeature:"leadManagement",membershipLevel:"bronze",membershipMessage:"\u6F5B\u5728\u5BA2\u6236\u7BA1\u7406\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},automation:{requiredFeature:"automation",membershipLevel:"silver",membershipMessage:"\u81EA\u52D5\u5316\u4E2D\u5FC3\u9700\u8981\u767D\u9280\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"resource-discovery":{requiredFeature:"resourceDiscovery",membershipLevel:"bronze",membershipMessage:"\u8CC7\u6E90\u767C\u73FE\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"search-discovery":{requiredFeature:"resourceDiscovery",membershipLevel:"bronze",membershipMessage:"\u641C\u7D22\u767C\u73FE\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"ai-center":{requiredFeature:"aiCenter",membershipLevel:"gold",membershipMessage:"AI \u4E2D\u5FC3\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"multi-role":{requiredFeature:"multiRole",membershipLevel:"diamond",membershipMessage:"\u591A\u89D2\u8272\u5354\u4F5C\u9700\u8981\u947D\u77F3\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},analytics:{requiredFeature:"dataInsightsBasic",membershipLevel:"gold",membershipMessage:"\u6578\u64DA\u5206\u6790\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},monitoring:{}},Fl={free:0,bronze:1,silver:2,gold:3,diamond:4,star:5,king:6};function _u(n,e){let t=Fl[n]??0,i=Fl[e]??0;return t>=i}var Xe=(n,e)=>{let t=O(mt),i=O(Ne),o=O(Bn);if(t.level()==="king")return!0;let r=n.routeConfig?.path||"",l=fu[r];if(!l||!l.requiredFeature&&!l.membershipLevel)return!0;if(l.requiredFeature&&!t.hasFeature(l.requiredFeature))return i.warning(l.membershipMessage||"\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD"),o.navigate(["/dashboard"]),!1;if(l.membershipLevel){let d=t.membership()?.level||"free";if(!_u(d,l.membershipLevel))return i.warning(l.membershipMessage||"\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD"),o.navigate(["/dashboard"]),!1}return!0};var Ll=[{path:"auth",loadChildren:()=>import("./chunk-PL3IG7ZR.js").then(n=>n.AUTH_ROUTES)},{path:"login",redirectTo:"auth/login",pathMatch:"full"},{path:"register",redirectTo:"auth/register",pathMatch:"full"},{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-GZIPWUYL.js").then(n=>n.DashboardViewComponent),title:"\u5100\u8868\u677F",canActivate:[qe]},{path:"accounts",loadComponent:()=>import("./chunk-245WFN6O.js").then(n=>n.AccountsViewComponent),title:"\u5E33\u865F\u7BA1\u7406",canActivate:[qe]},{path:"settings",loadComponent:()=>import("./chunk-G25XVIP4.js").then(n=>n.SettingsViewComponent),title:"\u8A2D\u5B9A",canActivate:[qe]},{path:"user-settings",loadComponent:()=>import("./chunk-RVA65MP4.js").then(n=>n.UserSettingsViewComponent),title:"\u7528\u6236\u8A2D\u7F6E",canActivate:[qe]},{path:"upgrade",loadComponent:()=>import("./chunk-BYLDC53U.js").then(n=>n.UpgradeViewComponent),title:"\u5347\u7D1A\u65B9\u6848",canActivate:[qe]},{path:"quota",loadComponent:()=>import("./chunk-DVLUHLOW.js").then(n=>n.QuotaDashboardViewComponent),title:"\u914D\u984D\u7BA1\u7406",canActivate:[qe]},{path:"billing",loadComponent:()=>import("./chunk-TBTMF7NE.js").then(n=>n.BillingViewComponent),title:"\u8A08\u8CBB\u7BA1\u7406",canActivate:[qe]},{path:"payment",loadComponent:()=>import("./chunk-OAUL4DFA.js").then(n=>n.PaymentViewComponent),title:"\u652F\u4ED8\u4E2D\u5FC3",canActivate:[qe]},{path:"wallet/recharge",loadComponent:()=>import("./chunk-W2NN5XBL.js").then(n=>n.WalletRechargeComponent),title:"\u5145\u503C\u4E2D\u5FC3",canActivate:[qe]},{path:"wallet/withdraw",loadComponent:()=>import("./chunk-VY6RFRVY.js").then(n=>n.WalletWithdrawComponent),title:"\u63D0\u73FE",canActivate:[qe]},{path:"wallet/transactions",loadComponent:()=>import("./chunk-X3HB2OPZ.js").then(n=>n.WalletTransactionsComponent),title:"\u4EA4\u6613\u8A18\u9304",canActivate:[qe]},{path:"wallet/orders",loadComponent:()=>import("./chunk-6NYJDW3P.js").then(n=>n.WalletOrdersComponent),title:"\u5145\u503C\u8A02\u55AE",canActivate:[qe]},{path:"wallet/analytics",loadComponent:()=>import("./chunk-G7PWOTJV.js").then(n=>n.WalletAnalyticsComponent),title:"\u6D88\u8CBB\u5206\u6790",canActivate:[qe]},{path:"wallet",pathMatch:"full",loadComponent:()=>import("./chunk-EU5IAAYX.js").then(n=>n.WalletViewComponent),title:"\u6211\u7684\u9322\u5305",canActivate:[qe]},{path:"leads",loadComponent:()=>import("./chunk-P5U5XBST.js").then(n=>n.LeadsViewComponent),title:"\u6F5B\u5728\u5BA2\u6236",canActivate:[Xe]},{path:"automation",loadComponent:()=>import("./chunk-6A5QFJWR.js").then(n=>n.AutomationViewComponent),title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",canActivate:[Xe]},{path:"resource-discovery",loadComponent:()=>import("./chunk-EEDC5I2G.js").then(n=>n.ResourceDiscoveryViewComponent),title:"\u8CC7\u6E90\u4E2D\u5FC3",data:{discoveryMode:"resource-center"},canActivate:[Xe]},{path:"search-discovery",loadComponent:()=>import("./chunk-EEDC5I2G.js").then(n=>n.ResourceDiscoveryViewComponent),title:"\u641C\u7D22\u767C\u73FE",data:{discoveryMode:"search-discovery"},canActivate:[Xe]},{path:"marketing-hub",loadComponent:()=>import("./chunk-3XEYBGR4.js").then(n=>n.SmartMarketingViewComponent),title:"\u7B56\u7565\u898F\u5283",data:{hubMode:"strategy"},canActivate:[Xe]},{path:"marketing-hub/execution",loadComponent:()=>import("./chunk-3XEYBGR4.js").then(n=>n.SmartMarketingViewComponent),title:"\u81EA\u52D5\u57F7\u884C",data:{hubMode:"execution"},canActivate:[Xe]},{path:"role-library",loadComponent:()=>import("./chunk-VQDQGGAN.js").then(n=>n.MultiRoleViewComponent),title:"\u89D2\u8272\u8CC7\u6E90\u5EAB",canActivate:[Xe]},{path:"ai-engine",loadComponent:()=>import("./chunk-PQAQCX52.js").then(n=>n.AiCenterViewComponent),title:"\u667A\u80FD\u5F15\u64CE",data:{enginePanel:"default"},canActivate:[Xe]},{path:"ai-engine/overview",loadComponent:()=>import("./chunk-PQAQCX52.js").then(n=>n.AiCenterViewComponent),title:"\u77E5\u8BC6\u5927\u8111\u603B\u89C8",data:{enginePanel:"overview"},canActivate:[Xe]},{path:"ai-engine/knowledge",loadComponent:()=>import("./chunk-PQAQCX52.js").then(n=>n.AiCenterViewComponent),title:"\u77E5\u8BC6\u7BA1\u7406",data:{enginePanel:"knowledge"},canActivate:[Xe]},{path:"ai-engine/gaps",loadComponent:()=>import("./chunk-PQAQCX52.js").then(n=>n.AiCenterViewComponent),title:"\u77E5\u8BC6\u7F3A\u53E3",data:{enginePanel:"gaps"},canActivate:[Xe]},{path:"ai-center",redirectTo:"ai-engine",pathMatch:"full"},{path:"multi-role",redirectTo:"role-library",pathMatch:"full"},{path:"smart-marketing",redirectTo:"marketing-hub",pathMatch:"full"},{path:"analytics",loadComponent:()=>import("./chunk-A6BITHN3.js").then(n=>n.AnalyticsViewComponent),title:"\u6578\u64DA\u5206\u6790",canActivate:[Xe]},{path:"monitoring",loadComponent:()=>import("./chunk-DBHTJVQ7.js").then(n=>n.MonitoringViewComponent),title:"\u76E3\u63A7\u4E2D\u5FC3"},{path:"performance",redirectTo:"settings",pathMatch:"full"},{path:"alerts",redirectTo:"settings",pathMatch:"full"},{path:"**",redirectTo:"dashboard"}],gi={dashboard:"/dashboard",accounts:"/accounts","add-account":"/accounts","add-account-advanced":"/accounts","api-credentials":"/accounts",settings:"/settings","user-settings":"/user-settings",profile:"/user-settings","membership-center":"/upgrade",wallet:"/wallet","wallet-transactions":"/wallet/transactions","wallet-recharge":"/wallet/recharge","wallet-orders":"/wallet/orders","wallet-analytics":"/wallet/analytics","wallet-withdraw":"/wallet/withdraw","marketing-hub":"/marketing-hub","marketing-tasks":"/marketing-hub","marketing-monitor":"/marketing-hub","marketing-report":"/marketing-hub","ai-assistant":"/marketing-hub","ai-team":"/marketing-hub/execution",ads:"/automation",campaigns:"/automation","role-library":"/role-library","role-store":"/role-library","my-roles":"/role-library","scene-templates":"/role-library","script-editor":"/role-library","multi-role":"/role-library","ai-engine":"/ai-engine","ai-center":"/ai-engine","ai-models":"/ai-engine","ai-brain":"/ai-engine","ai-persona":"/ai-engine","knowledge-brain":"/ai-engine/overview","knowledge-gaps":"/ai-engine/gaps","knowledge-manage":"/ai-engine/knowledge",automation:"/automation",monitoring:"/monitoring","monitoring-accounts":"/monitoring","monitoring-groups":"/monitoring","keyword-sets":"/monitoring","trigger-rules":"/monitoring","chat-templates":"/monitoring","collected-users":"/monitoring","resource-discovery":"/resource-discovery",resources:"/resource-discovery","resource-center":"/resource-discovery","search-discovery":"/search-discovery",leads:"/leads","lead-nurturing":"/leads","member-database":"/leads","user-tracking":"/leads","nurturing-analytics":"/analytics",analytics:"/analytics","analytics-center":"/analytics",performance:"/settings",alerts:"/settings","runtime-logs":"/settings",logs:"/settings","smart-marketing":"/marketing-hub",billing:"/billing",upgrade:"/upgrade",quota:"/quota",payment:"/payment"},Ox=Object.entries(gi).reduce((n,[e,t])=>(n[t]=e,n),{});var vu,Cu;function yu(){return{geminiUrl:vu,vertexUrl:Cu}}function bu(n,e,t,i){var o,s;if(!n?.baseUrl){let r=yu();return e?(o=r.vertexUrl)!==null&&o!==void 0?o:t:(s=r.geminiUrl)!==null&&s!==void 0?s:i}return n.baseUrl}var ct=class{};function W(n,e){let t=/\{([^}]+)\}/g;return n.replace(t,(i,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){let s=e[o];return s!=null?String(s):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function c(n,e,t){for(let s=0;s<e.length-1;s++){let r=e[s];if(r.endsWith("[]")){let l=r.slice(0,-2);if(!(l in n))if(Array.isArray(t))n[l]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${r}`);if(Array.isArray(n[l])){let d=n[l];if(Array.isArray(t))for(let u=0;u<d.length;u++){let f=d[u];c(f,e.slice(s+1),t[u])}else for(let u of d)c(u,e.slice(s+1),t)}return}else if(r.endsWith("[0]")){let l=r.slice(0,-3);l in n||(n[l]=[{}]);let d=n[l];c(d[0],e.slice(s+1),t);return}(!n[r]||typeof n[r]!="object")&&(n[r]={}),n=n[r]}let i=e[e.length-1],o=n[i];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function a(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let i=0;i<e.length;i++){if(typeof n!="object"||n===null)return t;let o=e[i];if(o.endsWith("[]")){let s=o.slice(0,-2);if(s in n){let r=n[s];return Array.isArray(r)?r.map(l=>a(l,e.slice(i+1),t)):t}else return t}else n=n[o]}return n}catch(i){if(i instanceof TypeError)return t;throw i}}function Su(n,e){for(let[t,i]of Object.entries(e)){let o=t.split("."),s=i.split("."),r=new Set,l=-1;for(let d=0;d<o.length;d++)if(o[d]==="*"){l=d;break}if(l!==-1&&s.length>l)for(let d=l;d<s.length;d++){let u=s[d];u!=="*"&&!u.endsWith("[]")&&!u.endsWith("[0]")&&r.add(u)}Ds(n,o,s,0,r)}}function Ds(n,e,t,i,o){if(i>=e.length||typeof n!="object"||n===null)return;let s=e[i];if(s.endsWith("[]")){let r=s.slice(0,-2),l=n;if(r in l&&Array.isArray(l[r]))for(let d of l[r])Ds(d,e,t,i+1,o)}else if(s==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){let r=n,l=Object.keys(r).filter(u=>!u.startsWith("_")&&!o.has(u)),d={};for(let u of l)d[u]=r[u];for(let[u,f]of Object.entries(d)){let C=[];for(let y of t.slice(i))y==="*"?C.push(u):C.push(y);c(r,C,f)}for(let u of l)delete r[u]}}else{let r=n;s in r&&Ds(r[s],e,t,i+1,o)}}function Tr(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function xu(n){let e={},t=a(n,["operationName"]);t!=null&&c(e,["operationName"],t);let i=a(n,["resourceName"]);return i!=null&&c(e,["_url","resourceName"],i),e}function wu(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata"]);i!=null&&c(e,["metadata"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["response","generateVideoResponse"]);return r!=null&&c(e,["response"],Tu(r)),e}function Eu(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata"]);i!=null&&c(e,["metadata"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["response"]);return r!=null&&c(e,["response"],Au(r)),e}function Tu(n){let e={},t=a(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Du(r))),c(e,["generatedVideos"],s)}let i=a(n,["raiMediaFilteredCount"]);i!=null&&c(e,["raiMediaFilteredCount"],i);let o=a(n,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function Au(n){let e={},t=a(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Mu(r))),c(e,["generatedVideos"],s)}let i=a(n,["raiMediaFilteredCount"]);i!=null&&c(e,["raiMediaFilteredCount"],i);let o=a(n,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function Du(n){let e={},t=a(n,["video"]);return t!=null&&c(e,["video"],Fu(t)),e}function Mu(n){let e={},t=a(n,["_self"]);return t!=null&&c(e,["video"],Lu(t)),e}function Iu(n){let e={},t=a(n,["operationName"]);return t!=null&&c(e,["_url","operationName"],t),e}function ku(n){let e={},t=a(n,["operationName"]);return t!=null&&c(e,["_url","operationName"],t),e}function Pu(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata"]);i!=null&&c(e,["metadata"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["response"]);return r!=null&&c(e,["response"],Nu(r)),e}function Nu(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["parent"]);i!=null&&c(e,["parent"],i);let o=a(n,["documentName"]);return o!=null&&c(e,["documentName"],o),e}function lc(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata"]);i!=null&&c(e,["metadata"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["response"]);return r!=null&&c(e,["response"],Ru(r)),e}function Ru(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["parent"]);i!=null&&c(e,["parent"],i);let o=a(n,["documentName"]);return o!=null&&c(e,["documentName"],o),e}function Fu(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["uri"],t);let i=a(n,["encodedVideo"]);i!=null&&c(e,["videoBytes"],Tr(i));let o=a(n,["encoding"]);return o!=null&&c(e,["mimeType"],o),e}function Lu(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["uri"],t);let i=a(n,["bytesBase64Encoded"]);i!=null&&c(e,["videoBytes"],Tr(i));let o=a(n,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}var Ft=(function(n){return n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL",n})(Ft||{});var Ms=(function(n){return n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO",n})(Ms||{});var cc=(function(n){return n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",n})(cc||{});var bn=(function(n){return n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT",n})(bn||{});var xn=class{constructor(e){let t={};for(let i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var Rt=class{get text(){var e,t,i,o,s,r,l,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1,C=[];for(let y of(d=(l=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||l===void 0?void 0:l.parts)!==null&&d!==void 0?d:[]){for(let[E,I]of Object.entries(y))E!=="text"&&E!=="thought"&&E!=="thoughtSignature"&&(I!==null||I!==void 0)&&C.push(E);if(typeof y.text=="string"){if(typeof y.thought=="boolean"&&y.thought)continue;f=!0,u+=y.text}}return C.length>0&&console.warn(`there are non-text parts ${C} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var e,t,i,o,s,r,l,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="",f=[];for(let C of(d=(l=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||l===void 0?void 0:l.parts)!==null&&d!==void 0?d:[]){for(let[y,E]of Object.entries(C))y!=="inlineData"&&(E!==null||E!==void 0)&&f.push(y);C.inlineData&&typeof C.inlineData.data=="string"&&(u+=atob(C.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,t,i,o,s,r,l,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let u=(d=(l=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||l===void 0?void 0:l.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if(u?.length!==0)return u}get executableCode(){var e,t,i,o,s,r,l,d,u;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let f=(d=(l=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||l===void 0?void 0:l.parts)===null||d===void 0?void 0:d.filter(C=>C.executableCode).map(C=>C.executableCode).filter(C=>C!==void 0);if(f?.length!==0)return(u=f?.[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,t,i,o,s,r,l,d,u;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let f=(d=(l=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||l===void 0?void 0:l.parts)===null||d===void 0?void 0:d.filter(C=>C.codeExecutionResult).map(C=>C.codeExecutionResult).filter(C=>C!==void 0);if(f?.length!==0)return(u=f?.[0])===null||u===void 0?void 0:u.output}},Si=class{},xi=class{},Is=class{},ks=class{},Ps=class{},Ns=class{},wi=class{},Ei=class{},Ti=class{},Rs=class{};var Ai=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,o,s=e;return t?o=Eu(s):o=wu(s),Object.assign(i,o),i}},Di=class{},Mi=class{},Ii=class{},ki=class{},Fs=class{},Ls=class{},Vs=class{};var Bs=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,s=Pu(e);return Object.assign(i,s),i}},Os=class{},Gs=class{},Us=class{};var Pi=class{};var qs=class{get text(){var e,t,i;let o="",s=!1,r=[];for(let l of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(let[d,u]of Object.entries(l))d!=="text"&&d!=="thought"&&u!==null&&r.push(d);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;s=!0,o+=l.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?o:void 0}get data(){var e,t,i;let o="",s=[];for(let r of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(let[l,d]of Object.entries(r))l!=="inlineData"&&d!==null&&s.push(l);r.inlineData&&typeof r.inlineData.data=="string"&&(o+=atob(r.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}};var $s=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Hs=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,s=lc(e);return Object.assign(i,s),i}};function Se(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function dc(n,e){let t=Se(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function uc(n){return Array.isArray(n)?n.map(e=>Ni(e)):[Ni(n)]}function Ni(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function mc(n){let e=Ni(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function pc(n){let e=Ni(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Vl(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function gc(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>Vl(e)):[Vl(n)]}function Ks(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Bl(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Ol(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function Ue(n){if(n==null)throw new Error("ContentUnion is required");return Ks(n)?n:{role:"user",parts:gc(n)}}function Ar(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let i=Ue(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){let t=Ue(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Ue(t)):[Ue(e)]}function nt(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Bl(n)||Ol(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ue(n)]}let e=[],t=[],i=Ks(n[0]);for(let o of n){let s=Ks(o);if(s!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(s)e.push(o);else{if(Bl(o)||Ol(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return i||e.push({role:"user",parts:gc(t)}),e}function Vu(n,e){n.includes("null")&&(e.nullable=!0);let t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(Ft).includes(t[0].toUpperCase())?t[0].toUpperCase():Ft.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let i of t)e.anyOf.push({type:Object.values(Ft).includes(i.toUpperCase())?i.toUpperCase():Ft.TYPE_UNSPECIFIED})}}function zt(n){let e={},t=["items"],i=["anyOf"],o=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");let s=n.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,n=s[1]):s[1].type==="null"&&(e.nullable=!0,n=s[0])),n.type instanceof Array&&Vu(n.type,e);for(let[r,l]of Object.entries(n))if(l!=null)if(r=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;e.type=Object.values(Ft).includes(l.toUpperCase())?l.toUpperCase():Ft.TYPE_UNSPECIFIED}else if(t.includes(r))e[r]=zt(l);else if(i.includes(r)){let d=[];for(let u of l){if(u.type=="null"){e.nullable=!0;continue}d.push(zt(u))}e[r]=d}else if(o.includes(r)){let d={};for(let[u,f]of Object.entries(l))d[u]=zt(f);e[r]=d}else{if(r==="additionalProperties")continue;e[r]=l}return e}function Dr(n){return zt(n)}function Mr(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Ir(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Xt(n){if(n.functionDeclarations)for(let e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=zt(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=zt(e.response));return n}function Zt(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of n)e.push(t);return e}function Bu(n,e,t,i=1){let o=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:o?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function vt(n,e){if(typeof e!="string")throw new Error("name must be a string");return Bu(n,e,"cachedContents")}function hc(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function St(n){return Tr(n)}function Ou(n){return n!=null&&typeof n=="object"&&"name"in n}function Gu(n){return n!=null&&typeof n=="object"&&"video"in n}function Uu(n){return n!=null&&typeof n=="object"&&"uri"in n}function fc(n){var e;let t;if(Ou(n)&&(t=n.name),!(Uu(n)&&(t=n.uri,t===void 0))&&!(Gu(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function _c(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function vc(n){for(let e of["models","tunedModels","publisherModels"])if(qu(n,e))return n[e];return[]}function qu(n,e){return n!==null&&typeof n=="object"&&e in n}function $u(n,e={}){let t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function Hu(n,e={}){let t=[],i=new Set;for(let o of n){let s=o.name;if(i.has(s))throw new Error(`Duplicate function name ${s} found in MCP tools. Please ensure function names are unique.`);i.add(s);let r=$u(o,e);r.functionDeclarations&&t.push(...r.functionDeclarations)}return{functionDeclarations:t}}function Cc(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(o>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function Ku(n){if(typeof n!="string")return n;let e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function yc(n){if(typeof n!="object"||n===null)return{};let e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;let o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return n;let s=!1;for(let r of o){if(typeof r!="object"||r===null)continue;let d=r.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){s=!0;break}}return s&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function jt(n,e){let t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function bc(n){let e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function Wu(n){let e={},t=a(n,["responsesFile"]);t!=null&&c(e,["fileName"],t);let i=a(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>Tm(r))),c(e,["inlinedResponses"],s)}let o=a(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["inlinedEmbedContentResponses"],s)}return e}function zu(n){let e={},t=a(n,["predictionsFormat"]);t!=null&&c(e,["format"],t);let i=a(n,["gcsDestination","outputUriPrefix"]);i!=null&&c(e,["gcsUri"],i);let o=a(n,["bigqueryDestination","outputUri"]);return o!=null&&c(e,["bigqueryUri"],o),e}function Ju(n){let e={},t=a(n,["format"]);t!=null&&c(e,["predictionsFormat"],t);let i=a(n,["gcsUri"]);i!=null&&c(e,["gcsDestination","outputUriPrefix"],i);let o=a(n,["bigqueryUri"]);if(o!=null&&c(e,["bigqueryDestination","outputUri"],o),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(a(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function yi(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata","displayName"]);i!=null&&c(e,["displayName"],i);let o=a(n,["metadata","state"]);o!=null&&c(e,["state"],bc(o));let s=a(n,["metadata","createTime"]);s!=null&&c(e,["createTime"],s);let r=a(n,["metadata","endTime"]);r!=null&&c(e,["endTime"],r);let l=a(n,["metadata","updateTime"]);l!=null&&c(e,["updateTime"],l);let d=a(n,["metadata","model"]);d!=null&&c(e,["model"],d);let u=a(n,["metadata","output"]);return u!=null&&c(e,["dest"],Wu(yc(u))),e}function Ws(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["displayName"]);i!=null&&c(e,["displayName"],i);let o=a(n,["state"]);o!=null&&c(e,["state"],bc(o));let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["createTime"]);r!=null&&c(e,["createTime"],r);let l=a(n,["startTime"]);l!=null&&c(e,["startTime"],l);let d=a(n,["endTime"]);d!=null&&c(e,["endTime"],d);let u=a(n,["updateTime"]);u!=null&&c(e,["updateTime"],u);let f=a(n,["model"]);f!=null&&c(e,["model"],f);let C=a(n,["inputConfig"]);C!=null&&c(e,["src"],Qu(C));let y=a(n,["outputConfig"]);y!=null&&c(e,["dest"],zu(yc(y)));let E=a(n,["completionStats"]);return E!=null&&c(e,["completionStats"],E),e}function Qu(n){let e={},t=a(n,["instancesFormat"]);t!=null&&c(e,["format"],t);let i=a(n,["gcsSource","uris"]);i!=null&&c(e,["gcsUri"],i);let o=a(n,["bigquerySource","inputUri"]);return o!=null&&c(e,["bigqueryUri"],o),e}function Yu(n,e){let t={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let i=a(e,["fileName"]);i!=null&&c(t,["fileName"],i);let o=a(e,["inlinedRequests"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>Em(n,r))),c(t,["requests","requests"],s)}return t}function Xu(n){let e={},t=a(n,["format"]);t!=null&&c(e,["instancesFormat"],t);let i=a(n,["gcsUri"]);i!=null&&c(e,["gcsSource","uris"],i);let o=a(n,["bigqueryUri"]);if(o!=null&&c(e,["bigquerySource","inputUri"],o),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Zu(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function ju(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],jt(n,i)),t}function em(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],jt(n,i)),t}function tm(n){let e={},t=a(n,["content"]);t!=null&&c(e,["content"],t);let i=a(n,["citationMetadata"]);i!=null&&c(e,["citationMetadata"],nm(i));let o=a(n,["tokenCount"]);o!=null&&c(e,["tokenCount"],o);let s=a(n,["finishReason"]);s!=null&&c(e,["finishReason"],s);let r=a(n,["avgLogprobs"]);r!=null&&c(e,["avgLogprobs"],r);let l=a(n,["groundingMetadata"]);l!=null&&c(e,["groundingMetadata"],l);let d=a(n,["index"]);d!=null&&c(e,["index"],d);let u=a(n,["logprobsResult"]);u!=null&&c(e,["logprobsResult"],u);let f=a(n,["safetyRatings"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(E=>E)),c(e,["safetyRatings"],y)}let C=a(n,["urlContextMetadata"]);return C!=null&&c(e,["urlContextMetadata"],C),e}function nm(n){let e={},t=a(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>o)),c(e,["citations"],i)}return e}function Sc(n){let e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Nm(s))),c(e,["parts"],o)}let i=a(n,["role"]);return i!=null&&c(e,["role"],i),e}function im(n,e){let t={},i=a(n,["displayName"]);if(e!==void 0&&i!=null&&c(e,["batch","displayName"],i),a(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function om(n,e){let t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&c(e,["displayName"],i);let o=a(n,["dest"]);return e!==void 0&&o!=null&&c(e,["outputConfig"],Ju(Ku(o))),t}function Gl(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["src"]);o!=null&&c(t,["batch","inputConfig"],Yu(n,Cc(n,o)));let s=a(e,["config"]);return s!=null&&im(s,t),t}function sm(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["model"],Se(n,i));let o=a(e,["src"]);o!=null&&c(t,["inputConfig"],Xu(Cc(n,o)));let s=a(e,["config"]);return s!=null&&om(s,t),t}function rm(n,e){let t={},i=a(n,["displayName"]);return e!==void 0&&i!=null&&c(e,["batch","displayName"],i),t}function am(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["src"]);o!=null&&c(t,["batch","inputConfig"],gm(n,o));let s=a(e,["config"]);return s!=null&&rm(s,t),t}function lm(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],jt(n,i)),t}function cm(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],jt(n,i)),t}function dm(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["name"]);i!=null&&c(e,["name"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);return s!=null&&c(e,["error"],s),e}function um(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["name"]);i!=null&&c(e,["name"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);return s!=null&&c(e,["error"],s),e}function mm(n,e){let t={},i=a(e,["contents"]);if(i!=null){let s=Ar(n,i);Array.isArray(s)&&(s=s.map(r=>r)),c(t,["requests[]","request","content"],s)}let o=a(e,["config"]);return o!=null&&(c(t,["_self"],pm(o,t)),Su(t,{"requests[].*":"requests[].request.*"})),t}function pm(n,e){let t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&c(e,["requests[]","taskType"],i);let o=a(n,["title"]);e!==void 0&&o!=null&&c(e,["requests[]","title"],o);let s=a(n,["outputDimensionality"]);if(e!==void 0&&s!=null&&c(e,["requests[]","outputDimensionality"],s),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function gm(n,e){let t={},i=a(e,["fileName"]);i!=null&&c(t,["file_name"],i);let o=a(e,["inlinedRequests"]);return o!=null&&c(t,["requests"],mm(n,o)),t}function hm(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function fm(n){let e={},t=a(n,["id"]);t!=null&&c(e,["id"],t);let i=a(n,["args"]);i!=null&&c(e,["args"],i);let o=a(n,["name"]);if(o!=null&&c(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function _m(n){let e={},t=a(n,["mode"]);t!=null&&c(e,["mode"],t);let i=a(n,["allowedFunctionNames"]);if(i!=null&&c(e,["allowedFunctionNames"],i),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function vm(n,e,t){let i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&c(t,["systemInstruction"],Sc(Ue(o)));let s=a(e,["temperature"]);s!=null&&c(i,["temperature"],s);let r=a(e,["topP"]);r!=null&&c(i,["topP"],r);let l=a(e,["topK"]);l!=null&&c(i,["topK"],l);let d=a(e,["candidateCount"]);d!=null&&c(i,["candidateCount"],d);let u=a(e,["maxOutputTokens"]);u!=null&&c(i,["maxOutputTokens"],u);let f=a(e,["stopSequences"]);f!=null&&c(i,["stopSequences"],f);let C=a(e,["responseLogprobs"]);C!=null&&c(i,["responseLogprobs"],C);let y=a(e,["logprobs"]);y!=null&&c(i,["logprobs"],y);let E=a(e,["presencePenalty"]);E!=null&&c(i,["presencePenalty"],E);let I=a(e,["frequencyPenalty"]);I!=null&&c(i,["frequencyPenalty"],I);let P=a(e,["seed"]);P!=null&&c(i,["seed"],P);let B=a(e,["responseMimeType"]);B!=null&&c(i,["responseMimeType"],B);let L=a(e,["responseSchema"]);L!=null&&c(i,["responseSchema"],Dr(L));let H=a(e,["responseJsonSchema"]);if(H!=null&&c(i,["responseJsonSchema"],H),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let $=a(e,["safetySettings"]);if(t!==void 0&&$!=null){let we=$;Array.isArray(we)&&(we=we.map(Qe=>Rm(Qe))),c(t,["safetySettings"],we)}let J=a(e,["tools"]);if(t!==void 0&&J!=null){let we=Zt(J);Array.isArray(we)&&(we=we.map(Qe=>Lm(Xt(Qe)))),c(t,["tools"],we)}let te=a(e,["toolConfig"]);if(t!==void 0&&te!=null&&c(t,["toolConfig"],Fm(te)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let re=a(e,["cachedContent"]);t!==void 0&&re!=null&&c(t,["cachedContent"],vt(n,re));let ne=a(e,["responseModalities"]);ne!=null&&c(i,["responseModalities"],ne);let pe=a(e,["mediaResolution"]);pe!=null&&c(i,["mediaResolution"],pe);let ie=a(e,["speechConfig"]);if(ie!=null&&c(i,["speechConfig"],Mr(ie)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let ue=a(e,["thinkingConfig"]);ue!=null&&c(i,["thinkingConfig"],ue);let ke=a(e,["imageConfig"]);ke!=null&&c(i,["imageConfig"],wm(ke));let Oe=a(e,["enableEnhancedCivicAnswers"]);return Oe!=null&&c(i,["enableEnhancedCivicAnswers"],Oe),i}function Cm(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["candidates"]);if(i!=null){let d=i;Array.isArray(d)&&(d=d.map(u=>tm(u))),c(e,["candidates"],d)}let o=a(n,["modelVersion"]);o!=null&&c(e,["modelVersion"],o);let s=a(n,["promptFeedback"]);s!=null&&c(e,["promptFeedback"],s);let r=a(n,["responseId"]);r!=null&&c(e,["responseId"],r);let l=a(n,["usageMetadata"]);return l!=null&&c(e,["usageMetadata"],l),e}function ym(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],jt(n,i)),t}function bm(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],jt(n,i)),t}function Sm(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function xm(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function wm(n){let e={},t=a(n,["aspectRatio"]);t!=null&&c(e,["aspectRatio"],t);let i=a(n,["imageSize"]);if(i!=null&&c(e,["imageSize"],i),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Em(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["request","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let l=nt(o);Array.isArray(l)&&(l=l.map(d=>Sc(d))),c(t,["request","contents"],l)}let s=a(e,["metadata"]);s!=null&&c(t,["metadata"],s);let r=a(e,["config"]);return r!=null&&c(t,["request","generationConfig"],vm(n,r,a(t,["request"],{}))),t}function Tm(n){let e={},t=a(n,["response"]);t!=null&&c(e,["response"],Cm(t));let i=a(n,["error"]);return i!=null&&c(e,["error"],i),e}function Am(n,e){let t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);if(e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),a(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function Dm(n,e){let t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);e!==void 0&&o!=null&&c(e,["_query","pageToken"],o);let s=a(n,["filter"]);return e!==void 0&&s!=null&&c(e,["_query","filter"],s),t}function Mm(n){let e={},t=a(n,["config"]);return t!=null&&Am(t,e),e}function Im(n){let e={},t=a(n,["config"]);return t!=null&&Dm(t,e),e}function km(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["operations"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>yi(r))),c(e,["batchJobs"],s)}return e}function Pm(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["batchPredictionJobs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>Ws(r))),c(e,["batchJobs"],s)}return e}function Nm(n){let e={},t=a(n,["mediaResolution"]);t!=null&&c(e,["mediaResolution"],t);let i=a(n,["codeExecutionResult"]);i!=null&&c(e,["codeExecutionResult"],i);let o=a(n,["executableCode"]);o!=null&&c(e,["executableCode"],o);let s=a(n,["fileData"]);s!=null&&c(e,["fileData"],hm(s));let r=a(n,["functionCall"]);r!=null&&c(e,["functionCall"],fm(r));let l=a(n,["functionResponse"]);l!=null&&c(e,["functionResponse"],l);let d=a(n,["inlineData"]);d!=null&&c(e,["inlineData"],Zu(d));let u=a(n,["text"]);u!=null&&c(e,["text"],u);let f=a(n,["thought"]);f!=null&&c(e,["thought"],f);let C=a(n,["thoughtSignature"]);C!=null&&c(e,["thoughtSignature"],C);let y=a(n,["videoMetadata"]);return y!=null&&c(e,["videoMetadata"],y),e}function Rm(n){let e={},t=a(n,["category"]);if(t!=null&&c(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let i=a(n,["threshold"]);return i!=null&&c(e,["threshold"],i),e}function Fm(n){let e={},t=a(n,["functionCallingConfig"]);t!=null&&c(e,["functionCallingConfig"],_m(t));let i=a(n,["retrievalConfig"]);return i!=null&&c(e,["retrievalConfig"],i),e}function Lm(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(C=>C)),c(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);o!=null&&c(e,["computerUse"],o);let s=a(n,["fileSearch"]);s!=null&&c(e,["fileSearch"],s);let r=a(n,["codeExecution"]);if(r!=null&&c(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],Sm(l));let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],xm(d));let u=a(n,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}var xt=(function(n){return n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents",n})(xt||{}),_t=class{constructor(e,t,i,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,o)}init(e,t,i){var o,s;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let r={config:{}};!i||Object.keys(i).length===0?r={config:{}}:typeof i=="object"?r=Object.assign({},i):r=i,r.config&&(r.config.pageToken=t.nextPageToken),this.paramsInternal=r,this.pageInternalSize=(s=(o=r.config)===null||o===void 0?void 0:o.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var zs=class extends ct{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new _t(xt.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=Gl(this.apiClient,e),i=t._url,o=W("{model}:batchGenerateContent",i),l=t.batch.inputConfig.requests,d=l.requests,u=[];for(let f of d){let C=Object.assign({},f);if(C.systemInstruction){let y=C.systemInstruction;delete C.systemInstruction;let E=C.request;E.systemInstruction=y,C.request=E}u.push(C)}return l.requests=u,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let i=t?Object.assign({},t):{},o=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${o}`),i.dest===void 0){let s=this.getGcsUri(e),r=this.getBigqueryUri(e);if(s)s.endsWith(".jsonl")?i.dest=`${s.slice(0,-6)}/dest`:i.dest=`${s}_dest_${o}`;else if(r)i.dest=`${r}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=sm(this.apiClient,e);return l=W("batchPredictionJobs",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>Ws(f))}else{let u=Gl(this.apiClient,e);return l=W("{model}:batchGenerateContent",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>yi(f))}}async createEmbeddingsInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=am(this.apiClient,e);return s=W("{model}:asyncBatchEmbedContent",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>yi(d))}}async get(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=bm(this.apiClient,e);return l=W("batchPredictionJobs/{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>Ws(f))}else{let u=ym(this.apiClient,e);return l=W("batches/{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>yi(f))}}async cancel(e){var t,i,o,s;let r="",l={};if(this.apiClient.isVertexAI()){let d=em(this.apiClient,e);r=W("batchPredictionJobs/{name}:cancel",d._url),l=d._query,delete d._url,delete d._query,await this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{let d=ju(this.apiClient,e);r=W("batches/{name}:cancel",d._url),l=d._query,delete d._url,delete d._query,await this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Im(e);return l=W("batchPredictionJobs",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Pm(f),y=new Pi;return Object.assign(y,C),y})}else{let u=Mm(e);return l=W("batches",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=km(f),y=new Pi;return Object.assign(y,C),y})}}async delete(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=cm(this.apiClient,e);return l=W("batchPredictionJobs/{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>um(f))}else{let u=lm(this.apiClient,e);return l=W("batches/{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>dm(f))}}};function Vm(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function Ul(n){let e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>rp(s))),c(e,["parts"],o)}let i=a(n,["role"]);return i!=null&&c(e,["role"],i),e}function Bm(n,e){let t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&c(e,["ttl"],i);let o=a(n,["expireTime"]);e!==void 0&&o!=null&&c(e,["expireTime"],o);let s=a(n,["displayName"]);e!==void 0&&s!=null&&c(e,["displayName"],s);let r=a(n,["contents"]);if(e!==void 0&&r!=null){let f=nt(r);Array.isArray(f)&&(f=f.map(C=>Ul(C))),c(e,["contents"],f)}let l=a(n,["systemInstruction"]);e!==void 0&&l!=null&&c(e,["systemInstruction"],Ul(Ue(l)));let d=a(n,["tools"]);if(e!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(C=>lp(C))),c(e,["tools"],f)}let u=a(n,["toolConfig"]);if(e!==void 0&&u!=null&&c(e,["toolConfig"],ap(u)),a(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function Om(n,e){let t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&c(e,["ttl"],i);let o=a(n,["expireTime"]);e!==void 0&&o!=null&&c(e,["expireTime"],o);let s=a(n,["displayName"]);e!==void 0&&s!=null&&c(e,["displayName"],s);let r=a(n,["contents"]);if(e!==void 0&&r!=null){let C=nt(r);Array.isArray(C)&&(C=C.map(y=>y)),c(e,["contents"],C)}let l=a(n,["systemInstruction"]);e!==void 0&&l!=null&&c(e,["systemInstruction"],Ue(l));let d=a(n,["tools"]);if(e!==void 0&&d!=null){let C=d;Array.isArray(C)&&(C=C.map(y=>cp(y))),c(e,["tools"],C)}let u=a(n,["toolConfig"]);e!==void 0&&u!=null&&c(e,["toolConfig"],u);let f=a(n,["kmsKeyName"]);return e!==void 0&&f!=null&&c(e,["encryption_spec","kmsKeyName"],f),t}function Gm(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["model"],dc(n,i));let o=a(e,["config"]);return o!=null&&Bm(o,t),t}function Um(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["model"],dc(n,i));let o=a(e,["config"]);return o!=null&&Om(o,t),t}function qm(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],vt(n,i)),t}function $m(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],vt(n,i)),t}function Hm(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function Km(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function Wm(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function zm(n){let e={},t=a(n,["id"]);t!=null&&c(e,["id"],t);let i=a(n,["args"]);i!=null&&c(e,["args"],i);let o=a(n,["name"]);if(o!=null&&c(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Jm(n){let e={},t=a(n,["mode"]);t!=null&&c(e,["mode"],t);let i=a(n,["allowedFunctionNames"]);if(i!=null&&c(e,["allowedFunctionNames"],i),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Qm(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&c(e,["description"],t);let i=a(n,["name"]);i!=null&&c(e,["name"],i);let o=a(n,["parameters"]);o!=null&&c(e,["parameters"],o);let s=a(n,["parametersJsonSchema"]);s!=null&&c(e,["parametersJsonSchema"],s);let r=a(n,["response"]);r!=null&&c(e,["response"],r);let l=a(n,["responseJsonSchema"]);return l!=null&&c(e,["responseJsonSchema"],l),e}function Ym(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],vt(n,i)),t}function Xm(n,e){let t={},i=a(e,["name"]);return i!=null&&c(t,["_url","name"],vt(n,i)),t}function Zm(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function jm(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function ep(n,e){let t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),t}function tp(n,e){let t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),t}function np(n){let e={},t=a(n,["config"]);return t!=null&&ep(t,e),e}function ip(n){let e={},t=a(n,["config"]);return t!=null&&tp(t,e),e}function op(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["cachedContents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["cachedContents"],s)}return e}function sp(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["cachedContents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["cachedContents"],s)}return e}function rp(n){let e={},t=a(n,["mediaResolution"]);t!=null&&c(e,["mediaResolution"],t);let i=a(n,["codeExecutionResult"]);i!=null&&c(e,["codeExecutionResult"],i);let o=a(n,["executableCode"]);o!=null&&c(e,["executableCode"],o);let s=a(n,["fileData"]);s!=null&&c(e,["fileData"],Wm(s));let r=a(n,["functionCall"]);r!=null&&c(e,["functionCall"],zm(r));let l=a(n,["functionResponse"]);l!=null&&c(e,["functionResponse"],l);let d=a(n,["inlineData"]);d!=null&&c(e,["inlineData"],Vm(d));let u=a(n,["text"]);u!=null&&c(e,["text"],u);let f=a(n,["thought"]);f!=null&&c(e,["thought"],f);let C=a(n,["thoughtSignature"]);C!=null&&c(e,["thoughtSignature"],C);let y=a(n,["videoMetadata"]);return y!=null&&c(e,["videoMetadata"],y),e}function ap(n){let e={},t=a(n,["functionCallingConfig"]);t!=null&&c(e,["functionCallingConfig"],Jm(t));let i=a(n,["retrievalConfig"]);return i!=null&&c(e,["retrievalConfig"],i),e}function lp(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(C=>C)),c(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);o!=null&&c(e,["computerUse"],o);let s=a(n,["fileSearch"]);s!=null&&c(e,["fileSearch"],s);let r=a(n,["codeExecution"]);if(r!=null&&c(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],Zm(l));let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],jm(d));let u=a(n,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function cp(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>Qm(y))),c(e,["functionDeclarations"],C)}let i=a(n,["retrieval"]);i!=null&&c(e,["retrieval"],i);let o=a(n,["googleSearchRetrieval"]);o!=null&&c(e,["googleSearchRetrieval"],o);let s=a(n,["computerUse"]);if(s!=null&&c(e,["computerUse"],s),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=a(n,["codeExecution"]);r!=null&&c(e,["codeExecution"],r);let l=a(n,["enterpriseWebSearch"]);l!=null&&c(e,["enterpriseWebSearch"],l);let d=a(n,["googleMaps"]);d!=null&&c(e,["googleMaps"],d);let u=a(n,["googleSearch"]);u!=null&&c(e,["googleSearch"],u);let f=a(n,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}function dp(n,e){let t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&c(e,["ttl"],i);let o=a(n,["expireTime"]);return e!==void 0&&o!=null&&c(e,["expireTime"],o),t}function up(n,e){let t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&c(e,["ttl"],i);let o=a(n,["expireTime"]);return e!==void 0&&o!=null&&c(e,["expireTime"],o),t}function mp(n,e){let t={},i=a(e,["name"]);i!=null&&c(t,["_url","name"],vt(n,i));let o=a(e,["config"]);return o!=null&&dp(o,t),t}function pp(n,e){let t={},i=a(e,["name"]);i!=null&&c(t,["_url","name"],vt(n,i));let o=a(e,["config"]);return o!=null&&up(o,t),t}var Js=class extends ct{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new _t(xt.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Um(this.apiClient,e);return l=W("cachedContents",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>f)}else{let u=Gm(this.apiClient,e);return l=W("cachedContents",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>f)}}async get(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Xm(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>f)}else{let u=Ym(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>f)}}async delete(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=$m(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Km(f),y=new Ii;return Object.assign(y,C),y})}else{let u=qm(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Hm(f),y=new Ii;return Object.assign(y,C),y})}}async update(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=pp(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>f)}else{let u=mp(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>f)}}async listInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=ip(e);return l=W("cachedContents",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=sp(f),y=new ki;return Object.assign(y,C),y})}else{let u=np(e);return l=W("cachedContents",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=op(f),y=new ki;return Object.assign(y,C),y})}}};function Ri(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(n);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(n,i[o])&&(t[i[o]]=n[i[o]]);return t}function ql(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ae(n){return this instanceof ae?(this.v=n,this):new ae(n)}function at(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),o,s=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",r),o[Symbol.asyncIterator]=function(){return this},o;function r(E){return function(I){return Promise.resolve(I).then(E,C)}}function l(E,I){i[E]&&(o[E]=function(P){return new Promise(function(B,L){s.push([E,P,B,L])>1||d(E,P)})},I&&(o[E]=I(o[E])))}function d(E,I){try{u(i[E](I))}catch(P){y(s[0][3],P)}}function u(E){E.value instanceof ae?Promise.resolve(E.value.v).then(f,C):y(s[0][2],E)}function f(E){d("next",E)}function C(E){d("throw",E)}function y(E,I){E(I),s.shift(),s.length&&d(s[0][0],s[0][1])}}function lt(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof ql=="function"?ql(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(r){return new Promise(function(l,d){r=n[s](r),o(l,d,r.done,r.value)})}}function o(s,r,l,d){Promise.resolve(d).then(function(u){s({value:u,done:l})},r)}}function gp(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;let t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:xc(t)}function xc(n){if(n.parts===void 0||n.parts.length===0)return!1;for(let e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function hp(n){if(n.length!==0){for(let e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function $l(n){if(n===void 0||n.length===0)return[];let e=[],t=n.length,i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{let o=[],s=!0;for(;i<t&&n[i].role==="model";)o.push(n[i]),s&&!xc(n[i])&&(s=!1),i++;s?e.push(...o):e.pop()}return e}var Qs=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Ys(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Ys=class{constructor(e,t,i,o={},s=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=o,this.history=s,this.sendPromise=Promise.resolve(),hp(s)}async sendMessage(e){var t;await this.sendPromise;let i=Ue(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var s,r,l;let d=await o,u=(r=(s=d.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content,f=d.automaticFunctionCallingHistory,C=this.getHistory(!0).length,y=[];f!=null&&(y=(l=f.slice(C))!==null&&l!==void 0?l:[]);let E=u?[u]:[];this.recordHistory(i,E,y)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;let i=Ue(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});let s=await o;return this.processStreamResponse(s,i)}getHistory(e=!1){let t=e?$l(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return at(this,arguments,function*(){var o,s,r,l,d,u;let f=[];try{for(var C=!0,y=lt(e),E;E=yield ae(y.next()),o=E.done,!o;C=!0){l=E.value,C=!1;let I=l;if(gp(I)){let P=(u=(d=I.candidates)===null||d===void 0?void 0:d[0])===null||u===void 0?void 0:u.content;P!==void 0&&f.push(P)}yield yield ae(I)}}catch(I){s={error:I}}finally{try{!C&&!o&&(r=y.return)&&(yield ae(r.call(y)))}finally{if(s)throw s.error}}this.recordHistory(t,f)})}recordHistory(e,t,i){let o=[];t.length>0&&t.every(s=>s.role!==void 0)?o=t:o.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...$l(i)):this.history.push(e),this.history.push(...o)}};var Fi=class n extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,n.prototype)}};function fp(n){let e={},t=a(n,["file"]);return t!=null&&c(e,["file"],t),e}function _p(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function vp(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","file"],fc(t)),e}function Cp(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function yp(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","file"],fc(t)),e}function bp(n,e){let t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),t}function Sp(n){let e={},t=a(n,["config"]);return t!=null&&bp(t,e),e}function xp(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["files"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["files"],s)}return e}var Xs=class extends ct{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new _t(xt.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=Sp(e);return s=W("files",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(u=>{let f=u;return f.sdkHttpResponse={headers:d.headers},f})),o.then(d=>{let u=xp(d),f=new Os;return Object.assign(f,u),f})}}async createInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=fp(e);return s=W("upload/v1beta/files",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{let u=_p(d),f=new Gs;return Object.assign(f,u),f})}}async get(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=yp(e);return s=W("files/{file}",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=vp(e);return s=W("files/{file}",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(u=>{let f=u;return f.sdkHttpResponse={headers:d.headers},f})),o.then(d=>{let u=Cp(d),f=new Us;return Object.assign(f,u),f})}}};function bi(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function wp(n){let e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Gp(s))),c(e,["parts"],o)}let i=a(n,["role"]);return i!=null&&c(e,["role"],i),e}function Ep(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function Tp(n){let e={},t=a(n,["id"]);t!=null&&c(e,["id"],t);let i=a(n,["args"]);i!=null&&c(e,["args"],i);let o=a(n,["name"]);if(o!=null&&c(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Ap(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&c(e,["description"],t);let i=a(n,["name"]);i!=null&&c(e,["name"],i);let o=a(n,["parameters"]);o!=null&&c(e,["parameters"],o);let s=a(n,["parametersJsonSchema"]);s!=null&&c(e,["parametersJsonSchema"],s);let r=a(n,["response"]);r!=null&&c(e,["response"],r);let l=a(n,["responseJsonSchema"]);return l!=null&&c(e,["responseJsonSchema"],l),e}function Dp(n){let e={},t=a(n,["modelSelectionConfig"]);t!=null&&c(e,["modelConfig"],t);let i=a(n,["responseJsonSchema"]);i!=null&&c(e,["responseJsonSchema"],i);let o=a(n,["audioTimestamp"]);o!=null&&c(e,["audioTimestamp"],o);let s=a(n,["candidateCount"]);s!=null&&c(e,["candidateCount"],s);let r=a(n,["enableAffectiveDialog"]);r!=null&&c(e,["enableAffectiveDialog"],r);let l=a(n,["frequencyPenalty"]);l!=null&&c(e,["frequencyPenalty"],l);let d=a(n,["logprobs"]);d!=null&&c(e,["logprobs"],d);let u=a(n,["maxOutputTokens"]);u!=null&&c(e,["maxOutputTokens"],u);let f=a(n,["mediaResolution"]);f!=null&&c(e,["mediaResolution"],f);let C=a(n,["presencePenalty"]);C!=null&&c(e,["presencePenalty"],C);let y=a(n,["responseLogprobs"]);y!=null&&c(e,["responseLogprobs"],y);let E=a(n,["responseMimeType"]);E!=null&&c(e,["responseMimeType"],E);let I=a(n,["responseModalities"]);I!=null&&c(e,["responseModalities"],I);let P=a(n,["responseSchema"]);P!=null&&c(e,["responseSchema"],P);let B=a(n,["routingConfig"]);B!=null&&c(e,["routingConfig"],B);let L=a(n,["seed"]);L!=null&&c(e,["seed"],L);let H=a(n,["speechConfig"]);H!=null&&c(e,["speechConfig"],H);let $=a(n,["stopSequences"]);$!=null&&c(e,["stopSequences"],$);let J=a(n,["temperature"]);J!=null&&c(e,["temperature"],J);let te=a(n,["thinkingConfig"]);te!=null&&c(e,["thinkingConfig"],te);let re=a(n,["topK"]);re!=null&&c(e,["topK"],re);let ne=a(n,["topP"]);if(ne!=null&&c(e,["topP"],ne),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Mp(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function Ip(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function kp(n,e){let t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig"],i);let o=a(n,["responseModalities"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","responseModalities"],o);let s=a(n,["temperature"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","temperature"],s);let r=a(n,["topP"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig","topP"],r);let l=a(n,["topK"]);e!==void 0&&l!=null&&c(e,["setup","generationConfig","topK"],l);let d=a(n,["maxOutputTokens"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","maxOutputTokens"],d);let u=a(n,["mediaResolution"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","mediaResolution"],u);let f=a(n,["seed"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","seed"],f);let C=a(n,["speechConfig"]);e!==void 0&&C!=null&&c(e,["setup","generationConfig","speechConfig"],Ir(C));let y=a(n,["thinkingConfig"]);e!==void 0&&y!=null&&c(e,["setup","generationConfig","thinkingConfig"],y);let E=a(n,["enableAffectiveDialog"]);e!==void 0&&E!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],E);let I=a(n,["systemInstruction"]);e!==void 0&&I!=null&&c(e,["setup","systemInstruction"],wp(Ue(I)));let P=a(n,["tools"]);if(e!==void 0&&P!=null){let re=Zt(P);Array.isArray(re)&&(re=re.map(ne=>qp(Xt(ne)))),c(e,["setup","tools"],re)}let B=a(n,["sessionResumption"]);e!==void 0&&B!=null&&c(e,["setup","sessionResumption"],Up(B));let L=a(n,["inputAudioTranscription"]);e!==void 0&&L!=null&&c(e,["setup","inputAudioTranscription"],L);let H=a(n,["outputAudioTranscription"]);e!==void 0&&H!=null&&c(e,["setup","outputAudioTranscription"],H);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&c(e,["setup","realtimeInputConfig"],$);let J=a(n,["contextWindowCompression"]);e!==void 0&&J!=null&&c(e,["setup","contextWindowCompression"],J);let te=a(n,["proactivity"]);if(e!==void 0&&te!=null&&c(e,["setup","proactivity"],te),a(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function Pp(n,e){let t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig"],Dp(i));let o=a(n,["responseModalities"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","responseModalities"],o);let s=a(n,["temperature"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","temperature"],s);let r=a(n,["topP"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig","topP"],r);let l=a(n,["topK"]);e!==void 0&&l!=null&&c(e,["setup","generationConfig","topK"],l);let d=a(n,["maxOutputTokens"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","maxOutputTokens"],d);let u=a(n,["mediaResolution"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","mediaResolution"],u);let f=a(n,["seed"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","seed"],f);let C=a(n,["speechConfig"]);e!==void 0&&C!=null&&c(e,["setup","generationConfig","speechConfig"],Ir(C));let y=a(n,["thinkingConfig"]);e!==void 0&&y!=null&&c(e,["setup","generationConfig","thinkingConfig"],y);let E=a(n,["enableAffectiveDialog"]);e!==void 0&&E!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],E);let I=a(n,["systemInstruction"]);e!==void 0&&I!=null&&c(e,["setup","systemInstruction"],Ue(I));let P=a(n,["tools"]);if(e!==void 0&&P!=null){let ne=Zt(P);Array.isArray(ne)&&(ne=ne.map(pe=>$p(Xt(pe)))),c(e,["setup","tools"],ne)}let B=a(n,["sessionResumption"]);e!==void 0&&B!=null&&c(e,["setup","sessionResumption"],B);let L=a(n,["inputAudioTranscription"]);e!==void 0&&L!=null&&c(e,["setup","inputAudioTranscription"],L);let H=a(n,["outputAudioTranscription"]);e!==void 0&&H!=null&&c(e,["setup","outputAudioTranscription"],H);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&c(e,["setup","realtimeInputConfig"],$);let J=a(n,["contextWindowCompression"]);e!==void 0&&J!=null&&c(e,["setup","contextWindowCompression"],J);let te=a(n,["proactivity"]);e!==void 0&&te!=null&&c(e,["setup","proactivity"],te);let re=a(n,["explicitVadSignal"]);return e!==void 0&&re!=null&&c(e,["setup","explicitVadSignal"],re),t}function Np(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["setup","model"],Se(n,i));let o=a(e,["config"]);return o!=null&&c(t,["config"],kp(o,t)),t}function Rp(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["setup","model"],Se(n,i));let o=a(e,["config"]);return o!=null&&c(t,["config"],Pp(o,t)),t}function Fp(n){let e={},t=a(n,["musicGenerationConfig"]);return t!=null&&c(e,["musicGenerationConfig"],t),e}function Lp(n){let e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>o)),c(e,["weightedPrompts"],i)}return e}function Vp(n){let e={},t=a(n,["media"]);if(t!=null){let u=uc(t);Array.isArray(u)&&(u=u.map(f=>bi(f))),c(e,["mediaChunks"],u)}let i=a(n,["audio"]);i!=null&&c(e,["audio"],bi(pc(i)));let o=a(n,["audioStreamEnd"]);o!=null&&c(e,["audioStreamEnd"],o);let s=a(n,["video"]);s!=null&&c(e,["video"],bi(mc(s)));let r=a(n,["text"]);r!=null&&c(e,["text"],r);let l=a(n,["activityStart"]);l!=null&&c(e,["activityStart"],l);let d=a(n,["activityEnd"]);return d!=null&&c(e,["activityEnd"],d),e}function Bp(n){let e={},t=a(n,["media"]);if(t!=null){let u=uc(t);Array.isArray(u)&&(u=u.map(f=>f)),c(e,["mediaChunks"],u)}let i=a(n,["audio"]);i!=null&&c(e,["audio"],pc(i));let o=a(n,["audioStreamEnd"]);o!=null&&c(e,["audioStreamEnd"],o);let s=a(n,["video"]);s!=null&&c(e,["video"],mc(s));let r=a(n,["text"]);r!=null&&c(e,["text"],r);let l=a(n,["activityStart"]);l!=null&&c(e,["activityStart"],l);let d=a(n,["activityEnd"]);return d!=null&&c(e,["activityEnd"],d),e}function Op(n){let e={},t=a(n,["setupComplete"]);t!=null&&c(e,["setupComplete"],t);let i=a(n,["serverContent"]);i!=null&&c(e,["serverContent"],i);let o=a(n,["toolCall"]);o!=null&&c(e,["toolCall"],o);let s=a(n,["toolCallCancellation"]);s!=null&&c(e,["toolCallCancellation"],s);let r=a(n,["usageMetadata"]);r!=null&&c(e,["usageMetadata"],Hp(r));let l=a(n,["goAway"]);l!=null&&c(e,["goAway"],l);let d=a(n,["sessionResumptionUpdate"]);d!=null&&c(e,["sessionResumptionUpdate"],d);let u=a(n,["voiceActivityDetectionSignal"]);return u!=null&&c(e,["voiceActivityDetectionSignal"],u),e}function Gp(n){let e={},t=a(n,["mediaResolution"]);t!=null&&c(e,["mediaResolution"],t);let i=a(n,["codeExecutionResult"]);i!=null&&c(e,["codeExecutionResult"],i);let o=a(n,["executableCode"]);o!=null&&c(e,["executableCode"],o);let s=a(n,["fileData"]);s!=null&&c(e,["fileData"],Ep(s));let r=a(n,["functionCall"]);r!=null&&c(e,["functionCall"],Tp(r));let l=a(n,["functionResponse"]);l!=null&&c(e,["functionResponse"],l);let d=a(n,["inlineData"]);d!=null&&c(e,["inlineData"],bi(d));let u=a(n,["text"]);u!=null&&c(e,["text"],u);let f=a(n,["thought"]);f!=null&&c(e,["thought"],f);let C=a(n,["thoughtSignature"]);C!=null&&c(e,["thoughtSignature"],C);let y=a(n,["videoMetadata"]);return y!=null&&c(e,["videoMetadata"],y),e}function Up(n){let e={},t=a(n,["handle"]);if(t!=null&&c(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function qp(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(C=>C)),c(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);o!=null&&c(e,["computerUse"],o);let s=a(n,["fileSearch"]);s!=null&&c(e,["fileSearch"],s);let r=a(n,["codeExecution"]);if(r!=null&&c(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],Mp(l));let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],Ip(d));let u=a(n,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function $p(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>Ap(y))),c(e,["functionDeclarations"],C)}let i=a(n,["retrieval"]);i!=null&&c(e,["retrieval"],i);let o=a(n,["googleSearchRetrieval"]);o!=null&&c(e,["googleSearchRetrieval"],o);let s=a(n,["computerUse"]);if(s!=null&&c(e,["computerUse"],s),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=a(n,["codeExecution"]);r!=null&&c(e,["codeExecution"],r);let l=a(n,["enterpriseWebSearch"]);l!=null&&c(e,["enterpriseWebSearch"],l);let d=a(n,["googleMaps"]);d!=null&&c(e,["googleMaps"],d);let u=a(n,["googleSearch"]);u!=null&&c(e,["googleSearch"],u);let f=a(n,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}function Hp(n){let e={},t=a(n,["promptTokenCount"]);t!=null&&c(e,["promptTokenCount"],t);let i=a(n,["cachedContentTokenCount"]);i!=null&&c(e,["cachedContentTokenCount"],i);let o=a(n,["candidatesTokenCount"]);o!=null&&c(e,["responseTokenCount"],o);let s=a(n,["toolUsePromptTokenCount"]);s!=null&&c(e,["toolUsePromptTokenCount"],s);let r=a(n,["thoughtsTokenCount"]);r!=null&&c(e,["thoughtsTokenCount"],r);let l=a(n,["totalTokenCount"]);l!=null&&c(e,["totalTokenCount"],l);let d=a(n,["promptTokensDetails"]);if(d!=null){let E=d;Array.isArray(E)&&(E=E.map(I=>I)),c(e,["promptTokensDetails"],E)}let u=a(n,["cacheTokensDetails"]);if(u!=null){let E=u;Array.isArray(E)&&(E=E.map(I=>I)),c(e,["cacheTokensDetails"],E)}let f=a(n,["candidatesTokensDetails"]);if(f!=null){let E=f;Array.isArray(E)&&(E=E.map(I=>I)),c(e,["responseTokensDetails"],E)}let C=a(n,["toolUsePromptTokensDetails"]);if(C!=null){let E=C;Array.isArray(E)&&(E=E.map(I=>I)),c(e,["toolUsePromptTokensDetails"],E)}let y=a(n,["trafficType"]);return y!=null&&c(e,["trafficType"],y),e}function Kp(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function Wp(n){let e={},t=a(n,["content"]);t!=null&&c(e,["content"],t);let i=a(n,["citationMetadata"]);i!=null&&c(e,["citationMetadata"],zp(i));let o=a(n,["tokenCount"]);o!=null&&c(e,["tokenCount"],o);let s=a(n,["finishReason"]);s!=null&&c(e,["finishReason"],s);let r=a(n,["avgLogprobs"]);r!=null&&c(e,["avgLogprobs"],r);let l=a(n,["groundingMetadata"]);l!=null&&c(e,["groundingMetadata"],l);let d=a(n,["index"]);d!=null&&c(e,["index"],d);let u=a(n,["logprobsResult"]);u!=null&&c(e,["logprobsResult"],u);let f=a(n,["safetyRatings"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(E=>E)),c(e,["safetyRatings"],y)}let C=a(n,["urlContextMetadata"]);return C!=null&&c(e,["urlContextMetadata"],C),e}function zp(n){let e={},t=a(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>o)),c(e,["citations"],i)}return e}function Jp(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let s=nt(o);Array.isArray(s)&&(s=s.map(r=>r)),c(t,["contents"],s)}return t}function Qp(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["tokensInfo"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["tokensInfo"],o)}return e}function Yp(n){let e={},t=a(n,["values"]);t!=null&&c(e,["values"],t);let i=a(n,["statistics"]);return i!=null&&c(e,["statistics"],Xp(i)),e}function Xp(n){let e={},t=a(n,["truncated"]);t!=null&&c(e,["truncated"],t);let i=a(n,["token_count"]);return i!=null&&c(e,["tokenCount"],i),e}function Yi(n){let e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>r0(s))),c(e,["parts"],o)}let i=a(n,["role"]);return i!=null&&c(e,["role"],i),e}function Zp(n){let e={},t=a(n,["controlType"]);t!=null&&c(e,["controlType"],t);let i=a(n,["enableControlImageComputation"]);return i!=null&&c(e,["computeControl"],i),e}function jp(n){let e={};if(a(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function eg(n,e){let t={},i=a(n,["systemInstruction"]);e!==void 0&&i!=null&&c(e,["systemInstruction"],Ue(i));let o=a(n,["tools"]);if(e!==void 0&&o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>Ac(l))),c(e,["tools"],r)}let s=a(n,["generationConfig"]);return e!==void 0&&s!=null&&c(e,["generationConfig"],Kg(s)),t}function tg(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let r=nt(o);Array.isArray(r)&&(r=r.map(l=>Yi(l))),c(t,["contents"],r)}let s=a(e,["config"]);return s!=null&&jp(s),t}function ng(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let r=nt(o);Array.isArray(r)&&(r=r.map(l=>l)),c(t,["contents"],r)}let s=a(e,["config"]);return s!=null&&eg(s,t),t}function ig(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["totalTokens"]);i!=null&&c(e,["totalTokens"],i);let o=a(n,["cachedContentTokenCount"]);return o!=null&&c(e,["cachedContentTokenCount"],o),e}function og(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["totalTokens"]);return i!=null&&c(e,["totalTokens"],i),e}function sg(n,e){let t={},i=a(e,["model"]);return i!=null&&c(t,["_url","name"],Se(n,i)),t}function rg(n,e){let t={},i=a(e,["model"]);return i!=null&&c(t,["_url","name"],Se(n,i)),t}function ag(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function lg(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function cg(n,e){let t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&c(e,["parameters","storageUri"],i);let o=a(n,["negativePrompt"]);e!==void 0&&o!=null&&c(e,["parameters","negativePrompt"],o);let s=a(n,["numberOfImages"]);e!==void 0&&s!=null&&c(e,["parameters","sampleCount"],s);let r=a(n,["aspectRatio"]);e!==void 0&&r!=null&&c(e,["parameters","aspectRatio"],r);let l=a(n,["guidanceScale"]);e!==void 0&&l!=null&&c(e,["parameters","guidanceScale"],l);let d=a(n,["seed"]);e!==void 0&&d!=null&&c(e,["parameters","seed"],d);let u=a(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&c(e,["parameters","safetySetting"],u);let f=a(n,["personGeneration"]);e!==void 0&&f!=null&&c(e,["parameters","personGeneration"],f);let C=a(n,["includeSafetyAttributes"]);e!==void 0&&C!=null&&c(e,["parameters","includeSafetyAttributes"],C);let y=a(n,["includeRaiReason"]);e!==void 0&&y!=null&&c(e,["parameters","includeRaiReason"],y);let E=a(n,["language"]);e!==void 0&&E!=null&&c(e,["parameters","language"],E);let I=a(n,["outputMimeType"]);e!==void 0&&I!=null&&c(e,["parameters","outputOptions","mimeType"],I);let P=a(n,["outputCompressionQuality"]);e!==void 0&&P!=null&&c(e,["parameters","outputOptions","compressionQuality"],P);let B=a(n,["addWatermark"]);e!==void 0&&B!=null&&c(e,["parameters","addWatermark"],B);let L=a(n,["labels"]);e!==void 0&&L!=null&&c(e,["labels"],L);let H=a(n,["editMode"]);e!==void 0&&H!=null&&c(e,["parameters","editMode"],H);let $=a(n,["baseSteps"]);return e!==void 0&&$!=null&&c(e,["parameters","editConfig","baseSteps"],$),t}function dg(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["prompt"]);o!=null&&c(t,["instances[0]","prompt"],o);let s=a(e,["referenceImages"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>m0(d))),c(t,["instances[0]","referenceImages"],l)}let r=a(e,["config"]);return r!=null&&cg(r,t),t}function ug(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Xi(s))),c(e,["generatedImages"],o)}return e}function mg(n,e){let t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&c(e,["requests[]","taskType"],i);let o=a(n,["title"]);e!==void 0&&o!=null&&c(e,["requests[]","title"],o);let s=a(n,["outputDimensionality"]);if(e!==void 0&&s!=null&&c(e,["requests[]","outputDimensionality"],s),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function pg(n,e){let t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&c(e,["instances[]","task_type"],i);let o=a(n,["title"]);e!==void 0&&o!=null&&c(e,["instances[]","title"],o);let s=a(n,["outputDimensionality"]);e!==void 0&&s!=null&&c(e,["parameters","outputDimensionality"],s);let r=a(n,["mimeType"]);e!==void 0&&r!=null&&c(e,["instances[]","mimeType"],r);let l=a(n,["autoTruncate"]);return e!==void 0&&l!=null&&c(e,["parameters","autoTruncate"],l),t}function gg(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let l=Ar(n,o);Array.isArray(l)&&(l=l.map(d=>d)),c(t,["requests[]","content"],l)}let s=a(e,["config"]);s!=null&&mg(s,t);let r=a(e,["model"]);return r!==void 0&&c(t,["requests[]","model"],Se(n,r)),t}function hg(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let r=Ar(n,o);Array.isArray(r)&&(r=r.map(l=>l)),c(t,["instances[]","content"],r)}let s=a(e,["config"]);return s!=null&&pg(s,t),t}function fg(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["embeddings"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["embeddings"],s)}let o=a(n,["metadata"]);return o!=null&&c(e,["metadata"],o),e}function _g(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["predictions[]","embeddings"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>Yp(r))),c(e,["embeddings"],s)}let o=a(n,["metadata"]);return o!=null&&c(e,["metadata"],o),e}function vg(n){let e={},t=a(n,["endpoint"]);t!=null&&c(e,["name"],t);let i=a(n,["deployedModelId"]);return i!=null&&c(e,["deployedModelId"],i),e}function Cg(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function yg(n){let e={},t=a(n,["id"]);t!=null&&c(e,["id"],t);let i=a(n,["args"]);i!=null&&c(e,["args"],i);let o=a(n,["name"]);if(o!=null&&c(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function bg(n){let e={},t=a(n,["mode"]);t!=null&&c(e,["mode"],t);let i=a(n,["allowedFunctionNames"]);if(i!=null&&c(e,["allowedFunctionNames"],i),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Sg(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&c(e,["description"],t);let i=a(n,["name"]);i!=null&&c(e,["name"],i);let o=a(n,["parameters"]);o!=null&&c(e,["parameters"],o);let s=a(n,["parametersJsonSchema"]);s!=null&&c(e,["parametersJsonSchema"],s);let r=a(n,["response"]);r!=null&&c(e,["response"],r);let l=a(n,["responseJsonSchema"]);return l!=null&&c(e,["responseJsonSchema"],l),e}function xg(n,e,t){let i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&c(t,["systemInstruction"],Yi(Ue(o)));let s=a(e,["temperature"]);s!=null&&c(i,["temperature"],s);let r=a(e,["topP"]);r!=null&&c(i,["topP"],r);let l=a(e,["topK"]);l!=null&&c(i,["topK"],l);let d=a(e,["candidateCount"]);d!=null&&c(i,["candidateCount"],d);let u=a(e,["maxOutputTokens"]);u!=null&&c(i,["maxOutputTokens"],u);let f=a(e,["stopSequences"]);f!=null&&c(i,["stopSequences"],f);let C=a(e,["responseLogprobs"]);C!=null&&c(i,["responseLogprobs"],C);let y=a(e,["logprobs"]);y!=null&&c(i,["logprobs"],y);let E=a(e,["presencePenalty"]);E!=null&&c(i,["presencePenalty"],E);let I=a(e,["frequencyPenalty"]);I!=null&&c(i,["frequencyPenalty"],I);let P=a(e,["seed"]);P!=null&&c(i,["seed"],P);let B=a(e,["responseMimeType"]);B!=null&&c(i,["responseMimeType"],B);let L=a(e,["responseSchema"]);L!=null&&c(i,["responseSchema"],Dr(L));let H=a(e,["responseJsonSchema"]);if(H!=null&&c(i,["responseJsonSchema"],H),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let $=a(e,["safetySettings"]);if(t!==void 0&&$!=null){let we=$;Array.isArray(we)&&(we=we.map(Qe=>p0(Qe))),c(t,["safetySettings"],we)}let J=a(e,["tools"]);if(t!==void 0&&J!=null){let we=Zt(J);Array.isArray(we)&&(we=we.map(Qe=>y0(Xt(Qe)))),c(t,["tools"],we)}let te=a(e,["toolConfig"]);if(t!==void 0&&te!=null&&c(t,["toolConfig"],C0(te)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let re=a(e,["cachedContent"]);t!==void 0&&re!=null&&c(t,["cachedContent"],vt(n,re));let ne=a(e,["responseModalities"]);ne!=null&&c(i,["responseModalities"],ne);let pe=a(e,["mediaResolution"]);pe!=null&&c(i,["mediaResolution"],pe);let ie=a(e,["speechConfig"]);if(ie!=null&&c(i,["speechConfig"],Mr(ie)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let ue=a(e,["thinkingConfig"]);ue!=null&&c(i,["thinkingConfig"],ue);let ke=a(e,["imageConfig"]);ke!=null&&c(i,["imageConfig"],Yg(ke));let Oe=a(e,["enableEnhancedCivicAnswers"]);return Oe!=null&&c(i,["enableEnhancedCivicAnswers"],Oe),i}function wg(n,e,t){let i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&c(t,["systemInstruction"],Ue(o));let s=a(e,["temperature"]);s!=null&&c(i,["temperature"],s);let r=a(e,["topP"]);r!=null&&c(i,["topP"],r);let l=a(e,["topK"]);l!=null&&c(i,["topK"],l);let d=a(e,["candidateCount"]);d!=null&&c(i,["candidateCount"],d);let u=a(e,["maxOutputTokens"]);u!=null&&c(i,["maxOutputTokens"],u);let f=a(e,["stopSequences"]);f!=null&&c(i,["stopSequences"],f);let C=a(e,["responseLogprobs"]);C!=null&&c(i,["responseLogprobs"],C);let y=a(e,["logprobs"]);y!=null&&c(i,["logprobs"],y);let E=a(e,["presencePenalty"]);E!=null&&c(i,["presencePenalty"],E);let I=a(e,["frequencyPenalty"]);I!=null&&c(i,["frequencyPenalty"],I);let P=a(e,["seed"]);P!=null&&c(i,["seed"],P);let B=a(e,["responseMimeType"]);B!=null&&c(i,["responseMimeType"],B);let L=a(e,["responseSchema"]);L!=null&&c(i,["responseSchema"],Dr(L));let H=a(e,["responseJsonSchema"]);H!=null&&c(i,["responseJsonSchema"],H);let $=a(e,["routingConfig"]);$!=null&&c(i,["routingConfig"],$);let J=a(e,["modelSelectionConfig"]);J!=null&&c(i,["modelConfig"],J);let te=a(e,["safetySettings"]);if(t!==void 0&&te!=null){let z=te;Array.isArray(z)&&(z=z.map(ee=>ee)),c(t,["safetySettings"],z)}let re=a(e,["tools"]);if(t!==void 0&&re!=null){let z=Zt(re);Array.isArray(z)&&(z=z.map(ee=>Ac(Xt(ee)))),c(t,["tools"],z)}let ne=a(e,["toolConfig"]);t!==void 0&&ne!=null&&c(t,["toolConfig"],ne);let pe=a(e,["labels"]);t!==void 0&&pe!=null&&c(t,["labels"],pe);let ie=a(e,["cachedContent"]);t!==void 0&&ie!=null&&c(t,["cachedContent"],vt(n,ie));let ue=a(e,["responseModalities"]);ue!=null&&c(i,["responseModalities"],ue);let ke=a(e,["mediaResolution"]);ke!=null&&c(i,["mediaResolution"],ke);let Oe=a(e,["speechConfig"]);Oe!=null&&c(i,["speechConfig"],Mr(Oe));let we=a(e,["audioTimestamp"]);we!=null&&c(i,["audioTimestamp"],we);let Qe=a(e,["thinkingConfig"]);Qe!=null&&c(i,["thinkingConfig"],Qe);let rn=a(e,["imageConfig"]);if(rn!=null&&c(i,["imageConfig"],Xg(rn)),a(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return i}function Hl(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let r=nt(o);Array.isArray(r)&&(r=r.map(l=>Yi(l))),c(t,["contents"],r)}let s=a(e,["config"]);return s!=null&&c(t,["generationConfig"],xg(n,s,t)),t}function Kl(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["contents"]);if(o!=null){let r=nt(o);Array.isArray(r)&&(r=r.map(l=>l)),c(t,["contents"],r)}let s=a(e,["config"]);return s!=null&&c(t,["generationConfig"],wg(n,s,t)),t}function Wl(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["candidates"]);if(i!=null){let d=i;Array.isArray(d)&&(d=d.map(u=>Wp(u))),c(e,["candidates"],d)}let o=a(n,["modelVersion"]);o!=null&&c(e,["modelVersion"],o);let s=a(n,["promptFeedback"]);s!=null&&c(e,["promptFeedback"],s);let r=a(n,["responseId"]);r!=null&&c(e,["responseId"],r);let l=a(n,["usageMetadata"]);return l!=null&&c(e,["usageMetadata"],l),e}function zl(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["candidates"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(f=>f)),c(e,["candidates"],u)}let o=a(n,["createTime"]);o!=null&&c(e,["createTime"],o);let s=a(n,["modelVersion"]);s!=null&&c(e,["modelVersion"],s);let r=a(n,["promptFeedback"]);r!=null&&c(e,["promptFeedback"],r);let l=a(n,["responseId"]);l!=null&&c(e,["responseId"],l);let d=a(n,["usageMetadata"]);return d!=null&&c(e,["usageMetadata"],d),e}function Eg(n,e){let t={};if(a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let i=a(n,["numberOfImages"]);e!==void 0&&i!=null&&c(e,["parameters","sampleCount"],i);let o=a(n,["aspectRatio"]);e!==void 0&&o!=null&&c(e,["parameters","aspectRatio"],o);let s=a(n,["guidanceScale"]);if(e!==void 0&&s!=null&&c(e,["parameters","guidanceScale"],s),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=a(n,["safetyFilterLevel"]);e!==void 0&&r!=null&&c(e,["parameters","safetySetting"],r);let l=a(n,["personGeneration"]);e!==void 0&&l!=null&&c(e,["parameters","personGeneration"],l);let d=a(n,["includeSafetyAttributes"]);e!==void 0&&d!=null&&c(e,["parameters","includeSafetyAttributes"],d);let u=a(n,["includeRaiReason"]);e!==void 0&&u!=null&&c(e,["parameters","includeRaiReason"],u);let f=a(n,["language"]);e!==void 0&&f!=null&&c(e,["parameters","language"],f);let C=a(n,["outputMimeType"]);e!==void 0&&C!=null&&c(e,["parameters","outputOptions","mimeType"],C);let y=a(n,["outputCompressionQuality"]);if(e!==void 0&&y!=null&&c(e,["parameters","outputOptions","compressionQuality"],y),a(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let E=a(n,["imageSize"]);if(e!==void 0&&E!=null&&c(e,["parameters","sampleImageSize"],E),a(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function Tg(n,e){let t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&c(e,["parameters","storageUri"],i);let o=a(n,["negativePrompt"]);e!==void 0&&o!=null&&c(e,["parameters","negativePrompt"],o);let s=a(n,["numberOfImages"]);e!==void 0&&s!=null&&c(e,["parameters","sampleCount"],s);let r=a(n,["aspectRatio"]);e!==void 0&&r!=null&&c(e,["parameters","aspectRatio"],r);let l=a(n,["guidanceScale"]);e!==void 0&&l!=null&&c(e,["parameters","guidanceScale"],l);let d=a(n,["seed"]);e!==void 0&&d!=null&&c(e,["parameters","seed"],d);let u=a(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&c(e,["parameters","safetySetting"],u);let f=a(n,["personGeneration"]);e!==void 0&&f!=null&&c(e,["parameters","personGeneration"],f);let C=a(n,["includeSafetyAttributes"]);e!==void 0&&C!=null&&c(e,["parameters","includeSafetyAttributes"],C);let y=a(n,["includeRaiReason"]);e!==void 0&&y!=null&&c(e,["parameters","includeRaiReason"],y);let E=a(n,["language"]);e!==void 0&&E!=null&&c(e,["parameters","language"],E);let I=a(n,["outputMimeType"]);e!==void 0&&I!=null&&c(e,["parameters","outputOptions","mimeType"],I);let P=a(n,["outputCompressionQuality"]);e!==void 0&&P!=null&&c(e,["parameters","outputOptions","compressionQuality"],P);let B=a(n,["addWatermark"]);e!==void 0&&B!=null&&c(e,["parameters","addWatermark"],B);let L=a(n,["labels"]);e!==void 0&&L!=null&&c(e,["labels"],L);let H=a(n,["imageSize"]);e!==void 0&&H!=null&&c(e,["parameters","sampleImageSize"],H);let $=a(n,["enhancePrompt"]);return e!==void 0&&$!=null&&c(e,["parameters","enhancePrompt"],$),t}function Ag(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["prompt"]);o!=null&&c(t,["instances[0]","prompt"],o);let s=a(e,["config"]);return s!=null&&Eg(s,t),t}function Dg(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["prompt"]);o!=null&&c(t,["instances[0]","prompt"],o);let s=a(e,["config"]);return s!=null&&Tg(s,t),t}function Mg(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>Ug(r))),c(e,["generatedImages"],s)}let o=a(n,["positivePromptSafetyAttributes"]);return o!=null&&c(e,["positivePromptSafetyAttributes"],Ec(o)),e}function Ig(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>Xi(r))),c(e,["generatedImages"],s)}let o=a(n,["positivePromptSafetyAttributes"]);return o!=null&&c(e,["positivePromptSafetyAttributes"],Tc(o)),e}function kg(n,e){let t={},i=a(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&c(e,["parameters","sampleCount"],i),a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let o=a(n,["durationSeconds"]);if(e!==void 0&&o!=null&&c(e,["parameters","durationSeconds"],o),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&c(e,["parameters","aspectRatio"],s);let r=a(n,["resolution"]);e!==void 0&&r!=null&&c(e,["parameters","resolution"],r);let l=a(n,["personGeneration"]);if(e!==void 0&&l!=null&&c(e,["parameters","personGeneration"],l),a(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let d=a(n,["negativePrompt"]);e!==void 0&&d!=null&&c(e,["parameters","negativePrompt"],d);let u=a(n,["enhancePrompt"]);if(e!==void 0&&u!=null&&c(e,["parameters","enhancePrompt"],u),a(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let f=a(n,["lastFrame"]);e!==void 0&&f!=null&&c(e,["instances[0]","lastFrame"],Zi(f));let C=a(n,["referenceImages"]);if(e!==void 0&&C!=null){let y=C;Array.isArray(y)&&(y=y.map(E=>N0(E))),c(e,["instances[0]","referenceImages"],y)}if(a(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(a(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function Pg(n,e){let t={},i=a(n,["numberOfVideos"]);e!==void 0&&i!=null&&c(e,["parameters","sampleCount"],i);let o=a(n,["outputGcsUri"]);e!==void 0&&o!=null&&c(e,["parameters","storageUri"],o);let s=a(n,["fps"]);e!==void 0&&s!=null&&c(e,["parameters","fps"],s);let r=a(n,["durationSeconds"]);e!==void 0&&r!=null&&c(e,["parameters","durationSeconds"],r);let l=a(n,["seed"]);e!==void 0&&l!=null&&c(e,["parameters","seed"],l);let d=a(n,["aspectRatio"]);e!==void 0&&d!=null&&c(e,["parameters","aspectRatio"],d);let u=a(n,["resolution"]);e!==void 0&&u!=null&&c(e,["parameters","resolution"],u);let f=a(n,["personGeneration"]);e!==void 0&&f!=null&&c(e,["parameters","personGeneration"],f);let C=a(n,["pubsubTopic"]);e!==void 0&&C!=null&&c(e,["parameters","pubsubTopic"],C);let y=a(n,["negativePrompt"]);e!==void 0&&y!=null&&c(e,["parameters","negativePrompt"],y);let E=a(n,["enhancePrompt"]);e!==void 0&&E!=null&&c(e,["parameters","enhancePrompt"],E);let I=a(n,["generateAudio"]);e!==void 0&&I!=null&&c(e,["parameters","generateAudio"],I);let P=a(n,["lastFrame"]);e!==void 0&&P!=null&&c(e,["instances[0]","lastFrame"],dt(P));let B=a(n,["referenceImages"]);if(e!==void 0&&B!=null){let $=B;Array.isArray($)&&($=$.map(J=>R0(J))),c(e,["instances[0]","referenceImages"],$)}let L=a(n,["mask"]);e!==void 0&&L!=null&&c(e,["instances[0]","mask"],P0(L));let H=a(n,["compressionQuality"]);return e!==void 0&&H!=null&&c(e,["parameters","compressionQuality"],H),t}function Ng(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata"]);i!=null&&c(e,["metadata"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["response","generateVideoResponse"]);return r!=null&&c(e,["response"],Vg(r)),e}function Rg(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata"]);i!=null&&c(e,["metadata"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["response"]);return r!=null&&c(e,["response"],Bg(r)),e}function Fg(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["prompt"]);o!=null&&c(t,["instances[0]","prompt"],o);let s=a(e,["image"]);s!=null&&c(t,["instances[0]","image"],Zi(s));let r=a(e,["video"]);r!=null&&c(t,["instances[0]","video"],Dc(r));let l=a(e,["source"]);l!=null&&Og(l,t);let d=a(e,["config"]);return d!=null&&kg(d,t),t}function Lg(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["prompt"]);o!=null&&c(t,["instances[0]","prompt"],o);let s=a(e,["image"]);s!=null&&c(t,["instances[0]","image"],dt(s));let r=a(e,["video"]);r!=null&&c(t,["instances[0]","video"],Mc(r));let l=a(e,["source"]);l!=null&&Gg(l,t);let d=a(e,["config"]);return d!=null&&Pg(d,t),t}function Vg(n){let e={},t=a(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>$g(r))),c(e,["generatedVideos"],s)}let i=a(n,["raiMediaFilteredCount"]);i!=null&&c(e,["raiMediaFilteredCount"],i);let o=a(n,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function Bg(n){let e={},t=a(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Hg(r))),c(e,["generatedVideos"],s)}let i=a(n,["raiMediaFilteredCount"]);i!=null&&c(e,["raiMediaFilteredCount"],i);let o=a(n,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function Og(n,e){let t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&c(e,["instances[0]","prompt"],i);let o=a(n,["image"]);e!==void 0&&o!=null&&c(e,["instances[0]","image"],Zi(o));let s=a(n,["video"]);return e!==void 0&&s!=null&&c(e,["instances[0]","video"],Dc(s)),t}function Gg(n,e){let t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&c(e,["instances[0]","prompt"],i);let o=a(n,["image"]);e!==void 0&&o!=null&&c(e,["instances[0]","image"],dt(o));let s=a(n,["video"]);return e!==void 0&&s!=null&&c(e,["instances[0]","video"],Mc(s)),t}function Ug(n){let e={},t=a(n,["_self"]);t!=null&&c(e,["image"],Zg(t));let i=a(n,["raiFilteredReason"]);i!=null&&c(e,["raiFilteredReason"],i);let o=a(n,["_self"]);return o!=null&&c(e,["safetyAttributes"],Ec(o)),e}function Xi(n){let e={},t=a(n,["_self"]);t!=null&&c(e,["image"],wc(t));let i=a(n,["raiFilteredReason"]);i!=null&&c(e,["raiFilteredReason"],i);let o=a(n,["_self"]);o!=null&&c(e,["safetyAttributes"],Tc(o));let s=a(n,["prompt"]);return s!=null&&c(e,["enhancedPrompt"],s),e}function qg(n){let e={},t=a(n,["_self"]);t!=null&&c(e,["mask"],wc(t));let i=a(n,["labels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["labels"],o)}return e}function $g(n){let e={},t=a(n,["video"]);return t!=null&&c(e,["video"],I0(t)),e}function Hg(n){let e={},t=a(n,["_self"]);return t!=null&&c(e,["video"],k0(t)),e}function Kg(n){let e={},t=a(n,["modelSelectionConfig"]);t!=null&&c(e,["modelConfig"],t);let i=a(n,["responseJsonSchema"]);i!=null&&c(e,["responseJsonSchema"],i);let o=a(n,["audioTimestamp"]);o!=null&&c(e,["audioTimestamp"],o);let s=a(n,["candidateCount"]);s!=null&&c(e,["candidateCount"],s);let r=a(n,["enableAffectiveDialog"]);r!=null&&c(e,["enableAffectiveDialog"],r);let l=a(n,["frequencyPenalty"]);l!=null&&c(e,["frequencyPenalty"],l);let d=a(n,["logprobs"]);d!=null&&c(e,["logprobs"],d);let u=a(n,["maxOutputTokens"]);u!=null&&c(e,["maxOutputTokens"],u);let f=a(n,["mediaResolution"]);f!=null&&c(e,["mediaResolution"],f);let C=a(n,["presencePenalty"]);C!=null&&c(e,["presencePenalty"],C);let y=a(n,["responseLogprobs"]);y!=null&&c(e,["responseLogprobs"],y);let E=a(n,["responseMimeType"]);E!=null&&c(e,["responseMimeType"],E);let I=a(n,["responseModalities"]);I!=null&&c(e,["responseModalities"],I);let P=a(n,["responseSchema"]);P!=null&&c(e,["responseSchema"],P);let B=a(n,["routingConfig"]);B!=null&&c(e,["routingConfig"],B);let L=a(n,["seed"]);L!=null&&c(e,["seed"],L);let H=a(n,["speechConfig"]);H!=null&&c(e,["speechConfig"],H);let $=a(n,["stopSequences"]);$!=null&&c(e,["stopSequences"],$);let J=a(n,["temperature"]);J!=null&&c(e,["temperature"],J);let te=a(n,["thinkingConfig"]);te!=null&&c(e,["thinkingConfig"],te);let re=a(n,["topK"]);re!=null&&c(e,["topK"],re);let ne=a(n,["topP"]);if(ne!=null&&c(e,["topP"],ne),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Wg(n,e){let t={},i=a(e,["model"]);return i!=null&&c(t,["_url","name"],Se(n,i)),t}function zg(n,e){let t={},i=a(e,["model"]);return i!=null&&c(t,["_url","name"],Se(n,i)),t}function Jg(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function Qg(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function Yg(n){let e={},t=a(n,["aspectRatio"]);t!=null&&c(e,["aspectRatio"],t);let i=a(n,["imageSize"]);if(i!=null&&c(e,["imageSize"],i),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Xg(n){let e={},t=a(n,["aspectRatio"]);t!=null&&c(e,["aspectRatio"],t);let i=a(n,["imageSize"]);i!=null&&c(e,["imageSize"],i);let o=a(n,["outputMimeType"]);o!=null&&c(e,["imageOutputOptions","mimeType"],o);let s=a(n,["outputCompressionQuality"]);return s!=null&&c(e,["imageOutputOptions","compressionQuality"],s),e}function Zg(n){let e={},t=a(n,["bytesBase64Encoded"]);t!=null&&c(e,["imageBytes"],St(t));let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function wc(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["gcsUri"],t);let i=a(n,["bytesBase64Encoded"]);i!=null&&c(e,["imageBytes"],St(i));let o=a(n,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}function Zi(n){let e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=a(n,["imageBytes"]);t!=null&&c(e,["bytesBase64Encoded"],St(t));let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function dt(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["gcsUri"],t);let i=a(n,["imageBytes"]);i!=null&&c(e,["bytesBase64Encoded"],St(i));let o=a(n,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}function jg(n,e,t){let i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&c(t,["_query","pageSize"],o);let s=a(e,["pageToken"]);t!==void 0&&s!=null&&c(t,["_query","pageToken"],s);let r=a(e,["filter"]);t!==void 0&&r!=null&&c(t,["_query","filter"],r);let l=a(e,["queryBase"]);return t!==void 0&&l!=null&&c(t,["_url","models_url"],_c(n,l)),i}function e0(n,e,t){let i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&c(t,["_query","pageSize"],o);let s=a(e,["pageToken"]);t!==void 0&&s!=null&&c(t,["_query","pageToken"],s);let r=a(e,["filter"]);t!==void 0&&r!=null&&c(t,["_query","filter"],r);let l=a(e,["queryBase"]);return t!==void 0&&l!=null&&c(t,["_url","models_url"],_c(n,l)),i}function t0(n,e){let t={},i=a(e,["config"]);return i!=null&&jg(n,i,t),t}function n0(n,e){let t={},i=a(e,["config"]);return i!=null&&e0(n,i,t),t}function i0(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["_self"]);if(o!=null){let s=vc(o);Array.isArray(s)&&(s=s.map(r=>Zs(r))),c(e,["models"],s)}return e}function o0(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["_self"]);if(o!=null){let s=vc(o);Array.isArray(s)&&(s=s.map(r=>js(r))),c(e,["models"],s)}return e}function s0(n){let e={},t=a(n,["maskMode"]);t!=null&&c(e,["maskMode"],t);let i=a(n,["segmentationClasses"]);i!=null&&c(e,["maskClasses"],i);let o=a(n,["maskDilation"]);return o!=null&&c(e,["dilation"],o),e}function Zs(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["displayName"]);i!=null&&c(e,["displayName"],i);let o=a(n,["description"]);o!=null&&c(e,["description"],o);let s=a(n,["version"]);s!=null&&c(e,["version"],s);let r=a(n,["_self"]);r!=null&&c(e,["tunedModelInfo"],b0(r));let l=a(n,["inputTokenLimit"]);l!=null&&c(e,["inputTokenLimit"],l);let d=a(n,["outputTokenLimit"]);d!=null&&c(e,["outputTokenLimit"],d);let u=a(n,["supportedGenerationMethods"]);u!=null&&c(e,["supportedActions"],u);let f=a(n,["temperature"]);f!=null&&c(e,["temperature"],f);let C=a(n,["maxTemperature"]);C!=null&&c(e,["maxTemperature"],C);let y=a(n,["topP"]);y!=null&&c(e,["topP"],y);let E=a(n,["topK"]);E!=null&&c(e,["topK"],E);let I=a(n,["thinking"]);return I!=null&&c(e,["thinking"],I),e}function js(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["displayName"]);i!=null&&c(e,["displayName"],i);let o=a(n,["description"]);o!=null&&c(e,["description"],o);let s=a(n,["versionId"]);s!=null&&c(e,["version"],s);let r=a(n,["deployedModels"]);if(r!=null){let C=r;Array.isArray(C)&&(C=C.map(y=>vg(y))),c(e,["endpoints"],C)}let l=a(n,["labels"]);l!=null&&c(e,["labels"],l);let d=a(n,["_self"]);d!=null&&c(e,["tunedModelInfo"],S0(d));let u=a(n,["defaultCheckpointId"]);u!=null&&c(e,["defaultCheckpointId"],u);let f=a(n,["checkpoints"]);if(f!=null){let C=f;Array.isArray(C)&&(C=C.map(y=>y)),c(e,["checkpoints"],C)}return e}function r0(n){let e={},t=a(n,["mediaResolution"]);t!=null&&c(e,["mediaResolution"],t);let i=a(n,["codeExecutionResult"]);i!=null&&c(e,["codeExecutionResult"],i);let o=a(n,["executableCode"]);o!=null&&c(e,["executableCode"],o);let s=a(n,["fileData"]);s!=null&&c(e,["fileData"],Cg(s));let r=a(n,["functionCall"]);r!=null&&c(e,["functionCall"],yg(r));let l=a(n,["functionResponse"]);l!=null&&c(e,["functionResponse"],l);let d=a(n,["inlineData"]);d!=null&&c(e,["inlineData"],Kp(d));let u=a(n,["text"]);u!=null&&c(e,["text"],u);let f=a(n,["thought"]);f!=null&&c(e,["thought"],f);let C=a(n,["thoughtSignature"]);C!=null&&c(e,["thoughtSignature"],C);let y=a(n,["videoMetadata"]);return y!=null&&c(e,["videoMetadata"],y),e}function a0(n){let e={},t=a(n,["productImage"]);return t!=null&&c(e,["image"],dt(t)),e}function l0(n,e){let t={},i=a(n,["numberOfImages"]);e!==void 0&&i!=null&&c(e,["parameters","sampleCount"],i);let o=a(n,["baseSteps"]);e!==void 0&&o!=null&&c(e,["parameters","baseSteps"],o);let s=a(n,["outputGcsUri"]);e!==void 0&&s!=null&&c(e,["parameters","storageUri"],s);let r=a(n,["seed"]);e!==void 0&&r!=null&&c(e,["parameters","seed"],r);let l=a(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&c(e,["parameters","safetySetting"],l);let d=a(n,["personGeneration"]);e!==void 0&&d!=null&&c(e,["parameters","personGeneration"],d);let u=a(n,["addWatermark"]);e!==void 0&&u!=null&&c(e,["parameters","addWatermark"],u);let f=a(n,["outputMimeType"]);e!==void 0&&f!=null&&c(e,["parameters","outputOptions","mimeType"],f);let C=a(n,["outputCompressionQuality"]);e!==void 0&&C!=null&&c(e,["parameters","outputOptions","compressionQuality"],C);let y=a(n,["enhancePrompt"]);e!==void 0&&y!=null&&c(e,["parameters","enhancePrompt"],y);let E=a(n,["labels"]);return e!==void 0&&E!=null&&c(e,["labels"],E),t}function c0(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["source"]);o!=null&&u0(o,t);let s=a(e,["config"]);return s!=null&&l0(s,t),t}function d0(n){let e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Xi(o))),c(e,["generatedImages"],i)}return e}function u0(n,e){let t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&c(e,["instances[0]","prompt"],i);let o=a(n,["personImage"]);e!==void 0&&o!=null&&c(e,["instances[0]","personImage","image"],dt(o));let s=a(n,["productImages"]);if(e!==void 0&&s!=null){let r=s;Array.isArray(r)&&(r=r.map(l=>a0(l))),c(e,["instances[0]","productImages"],r)}return t}function m0(n){let e={},t=a(n,["referenceImage"]);t!=null&&c(e,["referenceImage"],dt(t));let i=a(n,["referenceId"]);i!=null&&c(e,["referenceId"],i);let o=a(n,["referenceType"]);o!=null&&c(e,["referenceType"],o);let s=a(n,["maskImageConfig"]);s!=null&&c(e,["maskImageConfig"],s0(s));let r=a(n,["controlImageConfig"]);r!=null&&c(e,["controlImageConfig"],Zp(r));let l=a(n,["styleImageConfig"]);l!=null&&c(e,["styleImageConfig"],l);let d=a(n,["subjectImageConfig"]);return d!=null&&c(e,["subjectImageConfig"],d),e}function Ec(n){let e={},t=a(n,["safetyAttributes","categories"]);t!=null&&c(e,["categories"],t);let i=a(n,["safetyAttributes","scores"]);i!=null&&c(e,["scores"],i);let o=a(n,["contentType"]);return o!=null&&c(e,["contentType"],o),e}function Tc(n){let e={},t=a(n,["safetyAttributes","categories"]);t!=null&&c(e,["categories"],t);let i=a(n,["safetyAttributes","scores"]);i!=null&&c(e,["scores"],i);let o=a(n,["contentType"]);return o!=null&&c(e,["contentType"],o),e}function p0(n){let e={},t=a(n,["category"]);if(t!=null&&c(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let i=a(n,["threshold"]);return i!=null&&c(e,["threshold"],i),e}function g0(n){let e={},t=a(n,["image"]);return t!=null&&c(e,["image"],dt(t)),e}function h0(n,e){let t={},i=a(n,["mode"]);e!==void 0&&i!=null&&c(e,["parameters","mode"],i);let o=a(n,["maxPredictions"]);e!==void 0&&o!=null&&c(e,["parameters","maxPredictions"],o);let s=a(n,["confidenceThreshold"]);e!==void 0&&s!=null&&c(e,["parameters","confidenceThreshold"],s);let r=a(n,["maskDilation"]);e!==void 0&&r!=null&&c(e,["parameters","maskDilation"],r);let l=a(n,["binaryColorThreshold"]);e!==void 0&&l!=null&&c(e,["parameters","binaryColorThreshold"],l);let d=a(n,["labels"]);return e!==void 0&&d!=null&&c(e,["labels"],d),t}function f0(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["source"]);o!=null&&v0(o,t);let s=a(e,["config"]);return s!=null&&h0(s,t),t}function _0(n){let e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>qg(o))),c(e,["generatedMasks"],i)}return e}function v0(n,e){let t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&c(e,["instances[0]","prompt"],i);let o=a(n,["image"]);e!==void 0&&o!=null&&c(e,["instances[0]","image"],dt(o));let s=a(n,["scribbleImage"]);return e!==void 0&&s!=null&&c(e,["instances[0]","scribble"],g0(s)),t}function C0(n){let e={},t=a(n,["functionCallingConfig"]);t!=null&&c(e,["functionCallingConfig"],bg(t));let i=a(n,["retrievalConfig"]);return i!=null&&c(e,["retrievalConfig"],i),e}function y0(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(C=>C)),c(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);o!=null&&c(e,["computerUse"],o);let s=a(n,["fileSearch"]);s!=null&&c(e,["fileSearch"],s);let r=a(n,["codeExecution"]);if(r!=null&&c(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],Jg(l));let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],Qg(d));let u=a(n,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function Ac(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>Sg(y))),c(e,["functionDeclarations"],C)}let i=a(n,["retrieval"]);i!=null&&c(e,["retrieval"],i);let o=a(n,["googleSearchRetrieval"]);o!=null&&c(e,["googleSearchRetrieval"],o);let s=a(n,["computerUse"]);if(s!=null&&c(e,["computerUse"],s),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=a(n,["codeExecution"]);r!=null&&c(e,["codeExecution"],r);let l=a(n,["enterpriseWebSearch"]);l!=null&&c(e,["enterpriseWebSearch"],l);let d=a(n,["googleMaps"]);d!=null&&c(e,["googleMaps"],d);let u=a(n,["googleSearch"]);u!=null&&c(e,["googleSearch"],u);let f=a(n,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}function b0(n){let e={},t=a(n,["baseModel"]);t!=null&&c(e,["baseModel"],t);let i=a(n,["createTime"]);i!=null&&c(e,["createTime"],i);let o=a(n,["updateTime"]);return o!=null&&c(e,["updateTime"],o),e}function S0(n){let e={},t=a(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&c(e,["baseModel"],t);let i=a(n,["createTime"]);i!=null&&c(e,["createTime"],i);let o=a(n,["updateTime"]);return o!=null&&c(e,["updateTime"],o),e}function x0(n,e){let t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&c(e,["displayName"],i);let o=a(n,["description"]);e!==void 0&&o!=null&&c(e,["description"],o);let s=a(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&c(e,["defaultCheckpointId"],s),t}function w0(n,e){let t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&c(e,["displayName"],i);let o=a(n,["description"]);e!==void 0&&o!=null&&c(e,["description"],o);let s=a(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&c(e,["defaultCheckpointId"],s),t}function E0(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","name"],Se(n,i));let o=a(e,["config"]);return o!=null&&x0(o,t),t}function T0(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["config"]);return o!=null&&w0(o,t),t}function A0(n,e){let t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&c(e,["parameters","storageUri"],i);let o=a(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&c(e,["parameters","safetySetting"],o);let s=a(n,["personGeneration"]);e!==void 0&&s!=null&&c(e,["parameters","personGeneration"],s);let r=a(n,["includeRaiReason"]);e!==void 0&&r!=null&&c(e,["parameters","includeRaiReason"],r);let l=a(n,["outputMimeType"]);e!==void 0&&l!=null&&c(e,["parameters","outputOptions","mimeType"],l);let d=a(n,["outputCompressionQuality"]);e!==void 0&&d!=null&&c(e,["parameters","outputOptions","compressionQuality"],d);let u=a(n,["enhanceInputImage"]);e!==void 0&&u!=null&&c(e,["parameters","upscaleConfig","enhanceInputImage"],u);let f=a(n,["imagePreservationFactor"]);e!==void 0&&f!=null&&c(e,["parameters","upscaleConfig","imagePreservationFactor"],f);let C=a(n,["labels"]);e!==void 0&&C!=null&&c(e,["labels"],C);let y=a(n,["numberOfImages"]);e!==void 0&&y!=null&&c(e,["parameters","sampleCount"],y);let E=a(n,["mode"]);return e!==void 0&&E!=null&&c(e,["parameters","mode"],E),t}function D0(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["_url","model"],Se(n,i));let o=a(e,["image"]);o!=null&&c(t,["instances[0]","image"],dt(o));let s=a(e,["upscaleFactor"]);s!=null&&c(t,["parameters","upscaleConfig","upscaleFactor"],s);let r=a(e,["config"]);return r!=null&&A0(r,t),t}function M0(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Xi(s))),c(e,["generatedImages"],o)}return e}function I0(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["uri"],t);let i=a(n,["encodedVideo"]);i!=null&&c(e,["videoBytes"],St(i));let o=a(n,["encoding"]);return o!=null&&c(e,["mimeType"],o),e}function k0(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["uri"],t);let i=a(n,["bytesBase64Encoded"]);i!=null&&c(e,["videoBytes"],St(i));let o=a(n,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}function P0(n){let e={},t=a(n,["image"]);t!=null&&c(e,["_self"],dt(t));let i=a(n,["maskMode"]);return i!=null&&c(e,["maskMode"],i),e}function N0(n){let e={},t=a(n,["image"]);t!=null&&c(e,["image"],Zi(t));let i=a(n,["referenceType"]);return i!=null&&c(e,["referenceType"],i),e}function R0(n){let e={},t=a(n,["image"]);t!=null&&c(e,["image"],dt(t));let i=a(n,["referenceType"]);return i!=null&&c(e,["referenceType"],i),e}function Dc(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["uri"],t);let i=a(n,["videoBytes"]);i!=null&&c(e,["encodedVideo"],St(i));let o=a(n,["mimeType"]);return o!=null&&c(e,["encoding"],o),e}function Mc(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["gcsUri"],t);let i=a(n,["videoBytes"]);i!=null&&c(e,["bytesBase64Encoded"],St(i));let o=a(n,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}function F0(n,e){let t={},i=a(n,["displayName"]);return e!==void 0&&i!=null&&c(e,["displayName"],i),t}function L0(n){let e={},t=a(n,["config"]);return t!=null&&F0(t,e),e}function V0(n,e){let t={},i=a(n,["force"]);return e!==void 0&&i!=null&&c(e,["_query","force"],i),t}function B0(n){let e={},t=a(n,["name"]);t!=null&&c(e,["_url","name"],t);let i=a(n,["config"]);return i!=null&&V0(i,e),e}function O0(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","name"],t),e}function G0(n,e){let t={},i=a(n,["customMetadata"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["customMetadata"],s)}let o=a(n,["chunkingConfig"]);return e!==void 0&&o!=null&&c(e,["chunkingConfig"],o),t}function U0(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let i=a(n,["metadata"]);i!=null&&c(e,["metadata"],i);let o=a(n,["done"]);o!=null&&c(e,["done"],o);let s=a(n,["error"]);s!=null&&c(e,["error"],s);let r=a(n,["response"]);return r!=null&&c(e,["response"],$0(r)),e}function q0(n){let e={},t=a(n,["fileSearchStoreName"]);t!=null&&c(e,["_url","file_search_store_name"],t);let i=a(n,["fileName"]);i!=null&&c(e,["fileName"],i);let o=a(n,["config"]);return o!=null&&G0(o,e),e}function $0(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["parent"]);i!=null&&c(e,["parent"],i);let o=a(n,["documentName"]);return o!=null&&c(e,["documentName"],o),e}function H0(n,e){let t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),t}function K0(n){let e={},t=a(n,["config"]);return t!=null&&H0(t,e),e}function W0(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["fileSearchStores"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["fileSearchStores"],s)}return e}function Ic(n,e){let t={},i=a(n,["mimeType"]);e!==void 0&&i!=null&&c(e,["mimeType"],i);let o=a(n,["displayName"]);e!==void 0&&o!=null&&c(e,["displayName"],o);let s=a(n,["customMetadata"]);if(e!==void 0&&s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>d)),c(e,["customMetadata"],l)}let r=a(n,["chunkingConfig"]);return e!==void 0&&r!=null&&c(e,["chunkingConfig"],r),t}function z0(n){let e={},t=a(n,["fileSearchStoreName"]);t!=null&&c(e,["_url","file_search_store_name"],t);let i=a(n,["config"]);return i!=null&&Ic(i,e),e}function J0(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}var Q0="Content-Type",Y0="X-Server-Timeout",X0="User-Agent",er="x-goog-api-client",Z0="1.34.0",j0=`google-genai-sdk/${Z0}`,eh="v1beta1",th="v1beta",tr=class{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:eh,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:th,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){let o=[this.getRequestUrlInternal(t)];return i&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);if(e.queryParams)for(let[r,l]of Object.entries(e.queryParams))o.searchParams.append(r,String(l));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,t,o.toString(),e.abortSignal),this.unaryApiCall(o,s,e.httpMethod)}patchHttpOptions(e,t){let i=JSON.parse(JSON.stringify(e));for(let[o,s]of Object.entries(t))typeof s=="object"?i[o]=Object.assign(Object.assign({},i[o]),s):s!==void 0&&(i[o]=s);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,t,o.toString(),e.abortSignal),this.streamApiCall(o,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i,o){if(t&&t.timeout||o){let s=new AbortController,r=s.signal;if(t.timeout&&t?.timeout>0){let l=setTimeout(()=>s.abort(),t.timeout);l&&typeof l.unref=="function"&&l.unref()}o&&o.addEventListener("abort",()=>{s.abort()}),e.signal=r}return t&&t.extraBody!==null&&nh(e,t.extraBody),e.headers=await this.getHeadersInternal(t,i),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Jl(o),new xn(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Jl(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return at(this,arguments,function*(){var i;let o=(i=e?.body)===null||i===void 0?void 0:i.getReader(),s=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let r="",l="data:",d=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:u,value:f}=yield ae(o.read());if(u){if(r.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let C=s.decode(f,{stream:!0});try{let I=JSON.parse(C);if("error"in I){let P=JSON.parse(JSON.stringify(I.error)),B=P.status,L=P.code,H=`got status: ${B}. ${JSON.stringify(I)}`;if(L>=400&&L<600)throw new Fi({message:H,status:L})}}catch(I){if(I.name==="ApiError")throw I}r+=C;let y=-1,E=0;for(;;){y=-1,E=0;for(let B of d){let L=r.indexOf(B);L!==-1&&(y===-1||L<y)&&(y=L,E=B.length)}if(y===-1)break;let I=r.substring(0,y);r=r.substring(y+E);let P=I.trim();if(P.startsWith(l)){let B=P.substring(l.length).trim();try{let L=new Response(B,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield ae(new xn(L))}catch(L){throw new Error(`exception parsing stream chunk ${B}. ${L}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){let e={},t=j0+" "+this.clientOptions.userAgentExtra;return e[X0]=t,e[er]=t,e[Q0]="application/json",e}async getHeadersInternal(e,t){let i=new Headers;if(e&&e.headers){for(let[o,s]of Object.entries(e.headers))i.append(o,s);e.timeout&&e.timeout>0&&i.append(Y0,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(i,t),i}getFileName(e){var t;let i="";return typeof e=="string"&&(i=e.replace(/[/\\]+$/,""),i=(t=i.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),i}async uploadFile(e,t){var i;let o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);let s=this.clientOptions.uploader,r=await s.stat(e);o.sizeBytes=String(r.size);let l=(i=t?.mimeType)!==null&&i!==void 0?i:r.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=l;let d={file:o},u=this.getFileName(e),f=W("upload/v1beta/files",d._url),C=await this.fetchUploadUrl(f,o.sizeBytes,o.mimeType,u,d,t?.httpOptions);return s.upload(e,C,this)}async uploadFileToFileSearchStore(e,t,i){var o;let s=this.clientOptions.uploader,r=await s.stat(t),l=String(r.size),d=(o=i?.mimeType)!==null&&o!==void 0?o:r.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let u=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(t),C={};i!=null&&Ic(i,C);let y=await this.fetchUploadUrl(u,l,d,f,C,i?.httpOptions);return s.uploadToFileSearchStore(t,y,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,i,o,s,r){var l;let d={};r?d=r:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${i}`},o?{"X-Goog-Upload-File-Name":o}:{})};let u=await this.request({path:e,body:JSON.stringify(s),httpMethod:"POST",httpOptions:d});if(!u||!u?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let f=(l=u?.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}};async function Jl(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){let t=n.status,i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};let o=JSON.stringify(i);throw t>=400&&t<600?new Fi({message:o,status:t}):new Error(o)}}function nh(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{let s=JSON.parse(n.body);if(typeof s=="object"&&s!==null&&!Array.isArray(s))t=s;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(s,r){let l=Object.assign({},s);for(let d in r)if(Object.prototype.hasOwnProperty.call(r,d)){let u=r[d],f=l[d];u&&typeof u=="object"&&!Array.isArray(u)&&f&&typeof f=="object"&&!Array.isArray(f)?l[d]=i(f,u):(f&&u&&typeof f!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof f}, New type: ${typeof u}. Overwriting.`),l[d]=u)}return l}let o=i(t,e);n.body=JSON.stringify(o)}var ih="mcp_used/unknown",oh=!1;function kc(n){for(let e of n)if(sh(e)||typeof e=="object"&&"inputSchema"in e)return!0;return oh}function Pc(n){var e;let t=(e=n[er])!==null&&e!==void 0?e:"";n[er]=(t+` ${ih}`).trimStart()}function sh(n){return n!==null&&typeof n=="object"&&n instanceof nr}function rh(n){return at(this,arguments,function*(t,i=100){let o,s=0;for(;s<i;){let r=yield ae(t.listTools({cursor:o}));for(let l of r.tools)yield yield ae(l),s++;if(!r.nextCursor)break;o=r.nextCursor}})}var nr=class n{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new n(e,t)}async initialize(){var e,t,i,o;if(this.mcpTools.length>0)return;let s={},r=[];for(let f of this.mcpClients)try{for(var l=!0,d=(t=void 0,lt(rh(f))),u;u=await d.next(),e=u.done,!e;l=!0){o=u.value,l=!1;let C=o;r.push(C);let y=C.name;if(s[y])throw new Error(`Duplicate function name ${y} found in MCP tools. Please ensure function names are unique.`);s[y]=f}}catch(C){t={error:C}}finally{try{!l&&!e&&(i=d.return)&&await i.call(d)}finally{if(t)throw t.error}}this.mcpTools=r,this.functionNameToMcpClient=s}async tool(){return await this.initialize(),Hu(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let i of e)if(i.name in this.functionNameToMcpClient){let o=this.functionNameToMcpClient[i.name],s;this.config.timeout&&(s={timeout:this.config.timeout});let r=await o.callTool({name:i.name,arguments:i.args},void 0,s);t.push({functionResponse:{name:i.name,response:r.isError?{error:r}:r}})}return t}};async function ah(n,e,t){let i=new $s,o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data),Object.assign(i,o),e(i)}var ir=class{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let o=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),r=ch(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),d=`${o}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${l}`,u=()=>{},f=new Promise($=>{u=$}),C=e.callbacks,y=function(){u({})},E=this.apiClient,I={onopen:y,onmessage:$=>{ah(E,C.onmessage,$)},onerror:(t=C?.onerror)!==null&&t!==void 0?t:function($){},onclose:(i=C?.onclose)!==null&&i!==void 0?i:function($){}},P=this.webSocketFactory.create(d,lh(r),I);P.connect(),await f;let H={setup:{model:Se(this.apiClient,e.model)}};return P.send(JSON.stringify(H)),new or(P,this.apiClient)}},or=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=Lp(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=Fp(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(bn.PLAY)}pause(){this.sendPlaybackControl(bn.PAUSE)}stop(){this.sendPlaybackControl(bn.STOP)}resetContext(){this.sendPlaybackControl(bn.RESET_CONTEXT)}close(){this.conn.close()}};function lh(n){let e={};return n.forEach((t,i)=>{e[i]=t}),e}function ch(n){let e=new Headers;for(let[t,i]of Object.entries(n))e.append(t,i);return e}var dh="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function uh(n,e,t){let i=new qs,o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;let s=JSON.parse(o);if(n.isVertexAI()){let r=Op(s);Object.assign(i,r)}else Object.assign(i,s);e(i)}var sr=class{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new ir(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,o,s,r,l;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let d=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),f,C=this.apiClient.getHeaders();e.config&&e.config.tools&&kc(e.config.tools)&&Pc(C);let y=gh(C);if(this.apiClient.isVertexAI())f=`${d}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(y,f);else{let ie=this.apiClient.getApiKey(),ue="BidiGenerateContent",ke="key";ie?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),ue="BidiGenerateContentConstrained",ke="access_token"),f=`${d}/ws/google.ai.generativelanguage.${u}.GenerativeService.${ue}?${ke}=${ie}`}let E=()=>{},I=new Promise(ie=>{E=ie}),P=e.callbacks,B=function(){var ie;(ie=P?.onopen)===null||ie===void 0||ie.call(P),E({})},L=this.apiClient,H={onopen:B,onmessage:ie=>{uh(L,P.onmessage,ie)},onerror:(t=P?.onerror)!==null&&t!==void 0?t:function(ie){},onclose:(i=P?.onclose)!==null&&i!==void 0?i:function(ie){}},$=this.webSocketFactory.create(f,ph(y),H);$.connect(),await I;let J=Se(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&J.startsWith("publishers/")){let ie=this.apiClient.getProject(),ue=this.apiClient.getLocation();J=`projects/${ie}/locations/${ue}/`+J}let te={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Ms.AUDIO]}:e.config.responseModalities=[Ms.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let re=(l=(r=e.config)===null||r===void 0?void 0:r.tools)!==null&&l!==void 0?l:[],ne=[];for(let ie of re)if(this.isCallableTool(ie)){let ue=ie;ne.push(await ue.tool())}else ne.push(ie);ne.length>0&&(e.config.tools=ne);let pe={model:J,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?te=Rp(this.apiClient,pe):te=Np(this.apiClient,pe),delete te.config,$.send(JSON.stringify(te)),new rr($,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},mh={turnComplete:!0},rr=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=nt(t.turns),e.isVertexAI()||(i=i.map(o=>Yi(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(let s of i){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(dh)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},mh),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:Bp(e)}:t={realtimeInput:Vp(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function ph(n){let e={};return n.forEach((t,i)=>{e[i]=t}),e}function gh(n){let e=new Headers;for(let[t,i]of Object.entries(n))e.append(t,i);return e}var Ql=10;function Yl(n){var e,t,i;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(let r of(t=n?.tools)!==null&&t!==void 0?t:[])if(Jt(r)){o=!0;break}if(!o)return!0;let s=(i=n?.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function Jt(n){return"callTool"in n&&typeof n.callTool=="function"}function hh(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>Jt(o)))!==null&&i!==void 0?i:!1}function Xl(n){var e;let t=[];return!((e=n?.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((i,o)=>{if(Jt(i))return;let s=i;s.functionDeclarations&&s.functionDeclarations.length>0&&t.push(o)}),t}function Zl(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var ar=class extends ct{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,o,s,r,l;let d=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!hh(t)||Yl(t.config))return await this.generateContentInternal(d);let u=Xl(t);if(u.length>0){let P=u.map(B=>`tools[${B}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${P}.`)}let f,C,y=nt(d.contents),E=(s=(o=(i=d.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&s!==void 0?s:Ql,I=0;for(;I<E&&(f=await this.generateContentInternal(d),!(!f.functionCalls||f.functionCalls.length===0));){let P=f.candidates[0].content,B=[];for(let L of(l=(r=t.config)===null||r===void 0?void 0:r.tools)!==null&&l!==void 0?l:[])if(Jt(L)){let $=await L.callTool(f.functionCalls);B.push(...$)}I++,C={role:"user",parts:B},d.contents=nt(d.contents),d.contents.push(P),d.contents.push(C),Zl(d.config)&&(y.push(P),y.push(C))}return Zl(d.config)&&(f.automaticFunctionCallingHistory=y),f},this.generateContentStream=async t=>{var i,o,s,r,l;if(this.maybeMoveToResponseJsonSchem(t),Yl(t.config)){let C=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(C)}let d=Xl(t);if(d.length>0){let C=d.map(y=>`tools[${y}]`).join(", ");throw new Error(`Incompatible tools found at ${C}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let u=(s=(o=(i=t?.config)===null||i===void 0?void 0:i.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||s===void 0?void 0:s.streamFunctionCallArguments,f=(l=(r=t?.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(u&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var o;let s,r=[];if(i?.generatedImages)for(let d of i.generatedImages)d&&d?.safetyAttributes&&((o=d?.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?s=d?.safetyAttributes:r.push(d);let l;return s?l={generatedImages:r,positivePromptSafetyAttributes:s,sdkHttpResponse:i.sdkHttpResponse}:l={generatedImages:r,sdkHttpResponse:i.sdkHttpResponse},l}),this.list=async t=>{var i;let r={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(!((i=r.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new _t(xt.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(r),r)},this.editImage=async t=>{let i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));let o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{var i,o,s,r,l,d;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((i=t.video)===null||i===void 0)&&i.uri&&(!((o=t.video)===null||o===void 0)&&o.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((r=(s=t.source)===null||s===void 0?void 0:s.video)===null||r===void 0)&&r.uri&&(!((d=(l=t.source)===null||l===void 0?void 0:l.video)===null||d===void 0)&&d.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,o;let s=(t=e.config)===null||t===void 0?void 0:t.tools;if(!s)return e;let r=await Promise.all(s.map(async d=>Jt(d)?await d.tool():d)),l={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:r})};if(l.config.tools=r,e.config&&e.config.tools&&kc(e.config.tools)){let d=(o=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&o!==void 0?o:{},u=Object.assign({},d);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),Pc(u),l.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return l}async initAfcToolsMap(e){var t,i,o;let s=new Map;for(let r of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(Jt(r)){let l=r,d=await l.tool();for(let u of(o=d.functionDeclarations)!==null&&o!==void 0?o:[]){if(!u.name)throw new Error("Function declaration name is required.");if(s.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);s.set(u.name,l)}}return s}async processAfcStream(e){var t,i,o;let s=(o=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:Ql,r=!1,l=0,d=await this.initAfcToolsMap(e);return(function(u,f,C){return at(this,arguments,function*(){for(var y,E,I,P,B,L;l<s;){r&&(l++,r=!1);let te=yield ae(u.processParamsMaybeAddMcpUsage(C)),re=yield ae(u.generateContentStreamInternal(te)),ne=[],pe=[];try{for(var H=!0,$=(E=void 0,lt(re)),J;J=yield ae($.next()),y=J.done,!y;H=!0){P=J.value,H=!1;let ie=P;if(yield yield ae(ie),ie.candidates&&(!((B=ie.candidates[0])===null||B===void 0)&&B.content)){pe.push(ie.candidates[0].content);for(let ue of(L=ie.candidates[0].content.parts)!==null&&L!==void 0?L:[])if(l<s&&ue.functionCall){if(!ue.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(ue.functionCall.name)){let ke=yield ae(f.get(ue.functionCall.name).callTool([ue.functionCall]));ne.push(...ke)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${ue.functionCall.name}`)}}}}catch(ie){E={error:ie}}finally{try{!H&&!y&&(I=$.return)&&(yield ae(I.call($)))}finally{if(E)throw E.error}}if(ne.length>0){r=!0;let ie=new Rt;ie.candidates=[{content:{role:"user",parts:ne}}],yield yield ae(ie);let ue=[];ue.push(...pe),ue.push({role:"user",parts:ne});let ke=nt(C.contents).concat(ue);C.contents=ke}else break}})})(this,d,e)}async generateContentInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Kl(this.apiClient,e);return l=W("{model}:generateContent",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=zl(f),y=new Rt;return Object.assign(y,C),y})}else{let u=Hl(this.apiClient,e);return l=W("{model}:generateContent",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Wl(f),y=new Rt;return Object.assign(y,C),y})}}async generateContentStreamInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Kl(this.apiClient,e);return l=W("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.requestStream({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),r.then(function(C){return at(this,arguments,function*(){var y,E,I,P;try{for(var B=!0,L=lt(C),H;H=yield ae(L.next()),y=H.done,!y;B=!0){P=H.value,B=!1;let $=P,J=zl(yield ae($.json()));J.sdkHttpResponse={headers:$.headers};let te=new Rt;Object.assign(te,J),yield yield ae(te)}}catch($){E={error:$}}finally{try{!B&&!y&&(I=L.return)&&(yield ae(I.call(L)))}finally{if(E)throw E.error}}})})}else{let u=Hl(this.apiClient,e);return l=W("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.requestStream({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),r.then(function(C){return at(this,arguments,function*(){var y,E,I,P;try{for(var B=!0,L=lt(C),H;H=yield ae(L.next()),y=H.done,!y;B=!0){P=H.value,B=!1;let $=P,J=Wl(yield ae($.json()));J.sdkHttpResponse={headers:$.headers};let te=new Rt;Object.assign(te,J),yield yield ae(te)}}catch($){E={error:$}}finally{try{!B&&!y&&(I=L.return)&&(yield ae(I.call(L)))}finally{if(E)throw E.error}}})})}}async embedContent(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=hg(this.apiClient,e);return l=W("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=_g(f),y=new Si;return Object.assign(y,C),y})}else{let u=gg(this.apiClient,e);return l=W("{model}:batchEmbedContents",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=fg(f),y=new Si;return Object.assign(y,C),y})}}async generateImagesInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Dg(this.apiClient,e);return l=W("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Ig(f),y=new xi;return Object.assign(y,C),y})}else{let u=Ag(this.apiClient,e);return l=W("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Mg(f),y=new xi;return Object.assign(y,C),y})}}async editImageInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){let l=dg(this.apiClient,e);return s=W("{model}:predict",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(u=>{let f=u;return f.sdkHttpResponse={headers:d.headers},f})),o.then(d=>{let u=ug(d),f=new Is;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){let l=D0(this.apiClient,e);return s=W("{model}:predict",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(u=>{let f=u;return f.sdkHttpResponse={headers:d.headers},f})),o.then(d=>{let u=M0(d),f=new ks;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){let l=c0(this.apiClient,e);return s=W("{model}:predict",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{let u=d0(d),f=new Ps;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){let l=f0(this.apiClient,e);return s=W("{model}:predict",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{let u=_0(d),f=new Ns;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=zg(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>js(f))}else{let u=Wg(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>Zs(f))}}async listInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=n0(this.apiClient,e);return l=W("{models_url}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=o0(f),y=new wi;return Object.assign(y,C),y})}else{let u=t0(this.apiClient,e);return l=W("{models_url}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=i0(f),y=new wi;return Object.assign(y,C),y})}}async update(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=T0(this.apiClient,e);return l=W("{model}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>js(f))}else{let u=E0(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>Zs(f))}}async delete(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=rg(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=lg(f),y=new Ei;return Object.assign(y,C),y})}else{let u=sg(this.apiClient,e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=ag(f),y=new Ei;return Object.assign(y,C),y})}}async countTokens(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=ng(this.apiClient,e);return l=W("{model}:countTokens",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=og(f),y=new Ti;return Object.assign(y,C),y})}else{let u=tg(this.apiClient,e);return l=W("{model}:countTokens",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=ig(f),y=new Ti;return Object.assign(y,C),y})}}async computeTokens(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){let l=Jp(this.apiClient,e);return s=W("{model}:computeTokens",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(u=>{let f=u;return f.sdkHttpResponse={headers:d.headers},f})),o.then(d=>{let u=Qp(d),f=new Rs;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Lg(this.apiClient,e);return l=W("{model}:predictLongRunning",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>{let C=Rg(f),y=new Ai;return Object.assign(y,C),y})}else{let u=Fg(this.apiClient,e);return l=W("{model}:predictLongRunning",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>{let C=Ng(f),y=new Ai;return Object.assign(y,C),y})}}};var lr=class extends ct{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],s;i&&"httpOptions"in i&&(s=i.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){let t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],s;i&&"httpOptions"in i&&(s=i.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=ku(e);return l=W("{operationName}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r}else{let u=Iu(e);return l=W("{operationName}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r}}async fetchPredictVideosOperationInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){let l=xu(e);return s=W("{resourceName}:fetchPredictOperation",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}};function fh(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function _h(n){let e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Th(s))),c(e,["parts"],o)}let i=a(n,["role"]);return i!=null&&c(e,["role"],i),e}function vh(n,e,t){let i={},o=a(e,["expireTime"]);t!==void 0&&o!=null&&c(t,["expireTime"],o);let s=a(e,["newSessionExpireTime"]);t!==void 0&&s!=null&&c(t,["newSessionExpireTime"],s);let r=a(e,["uses"]);t!==void 0&&r!=null&&c(t,["uses"],r);let l=a(e,["liveConnectConstraints"]);t!==void 0&&l!=null&&c(t,["bidiGenerateContentSetup"],Eh(n,l));let d=a(e,["lockAdditionalFields"]);return t!==void 0&&d!=null&&c(t,["fieldMask"],d),i}function Ch(n,e){let t={},i=a(e,["config"]);return i!=null&&c(t,["config"],vh(n,i,t)),t}function yh(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function bh(n){let e={},t=a(n,["id"]);t!=null&&c(e,["id"],t);let i=a(n,["args"]);i!=null&&c(e,["args"],i);let o=a(n,["name"]);if(o!=null&&c(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Sh(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function xh(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function wh(n,e){let t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig"],i);let o=a(n,["responseModalities"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","responseModalities"],o);let s=a(n,["temperature"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","temperature"],s);let r=a(n,["topP"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig","topP"],r);let l=a(n,["topK"]);e!==void 0&&l!=null&&c(e,["setup","generationConfig","topK"],l);let d=a(n,["maxOutputTokens"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","maxOutputTokens"],d);let u=a(n,["mediaResolution"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","mediaResolution"],u);let f=a(n,["seed"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","seed"],f);let C=a(n,["speechConfig"]);e!==void 0&&C!=null&&c(e,["setup","generationConfig","speechConfig"],Ir(C));let y=a(n,["thinkingConfig"]);e!==void 0&&y!=null&&c(e,["setup","generationConfig","thinkingConfig"],y);let E=a(n,["enableAffectiveDialog"]);e!==void 0&&E!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],E);let I=a(n,["systemInstruction"]);e!==void 0&&I!=null&&c(e,["setup","systemInstruction"],_h(Ue(I)));let P=a(n,["tools"]);if(e!==void 0&&P!=null){let re=Zt(P);Array.isArray(re)&&(re=re.map(ne=>Dh(Xt(ne)))),c(e,["setup","tools"],re)}let B=a(n,["sessionResumption"]);e!==void 0&&B!=null&&c(e,["setup","sessionResumption"],Ah(B));let L=a(n,["inputAudioTranscription"]);e!==void 0&&L!=null&&c(e,["setup","inputAudioTranscription"],L);let H=a(n,["outputAudioTranscription"]);e!==void 0&&H!=null&&c(e,["setup","outputAudioTranscription"],H);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&c(e,["setup","realtimeInputConfig"],$);let J=a(n,["contextWindowCompression"]);e!==void 0&&J!=null&&c(e,["setup","contextWindowCompression"],J);let te=a(n,["proactivity"]);if(e!==void 0&&te!=null&&c(e,["setup","proactivity"],te),a(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function Eh(n,e){let t={},i=a(e,["model"]);i!=null&&c(t,["setup","model"],Se(n,i));let o=a(e,["config"]);return o!=null&&c(t,["config"],wh(o,t)),t}function Th(n){let e={},t=a(n,["mediaResolution"]);t!=null&&c(e,["mediaResolution"],t);let i=a(n,["codeExecutionResult"]);i!=null&&c(e,["codeExecutionResult"],i);let o=a(n,["executableCode"]);o!=null&&c(e,["executableCode"],o);let s=a(n,["fileData"]);s!=null&&c(e,["fileData"],yh(s));let r=a(n,["functionCall"]);r!=null&&c(e,["functionCall"],bh(r));let l=a(n,["functionResponse"]);l!=null&&c(e,["functionResponse"],l);let d=a(n,["inlineData"]);d!=null&&c(e,["inlineData"],fh(d));let u=a(n,["text"]);u!=null&&c(e,["text"],u);let f=a(n,["thought"]);f!=null&&c(e,["thought"],f);let C=a(n,["thoughtSignature"]);C!=null&&c(e,["thoughtSignature"],C);let y=a(n,["videoMetadata"]);return y!=null&&c(e,["videoMetadata"],y),e}function Ah(n){let e={},t=a(n,["handle"]);if(t!=null&&c(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Dh(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(C=>C)),c(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);o!=null&&c(e,["computerUse"],o);let s=a(n,["fileSearch"]);s!=null&&c(e,["fileSearch"],s);let r=a(n,["codeExecution"]);if(r!=null&&c(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],Sh(l));let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],xh(d));let u=a(n,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function Mh(n){let e=[];for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){let o=Object.keys(i).map(s=>`${t}.${s}`);e.push(...o)}else e.push(t)}return e.join(",")}function Ih(n,e){let t=null,i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){let s=i.setup;typeof s=="object"&&s!==null?(n.bidiGenerateContentSetup=s,t=s):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;let o=n.fieldMask;if(t){let s=Mh(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)s?n.fieldMask=s:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){let r=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],l=[];o.length>0&&(l=o.map(u=>r.includes(u)?`generationConfig.${u}`:u));let d=[];s&&d.push(s),l.length>0&&d.push(...l),d.length>0?n.fieldMask=d.join(","):delete n.fieldMask}else delete n.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?n.fieldMask=o.join(","):delete n.fieldMask;return n}var cr=class extends ct{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let l=Ch(this.apiClient,e);s=W("auth_tokens",l._url),r=l._query,delete l.config,delete l._url,delete l._query;let d=Ih(l,e.config);return o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),o.then(u=>u)}}};function kh(n,e){let t={},i=a(n,["force"]);return e!==void 0&&i!=null&&c(e,["_query","force"],i),t}function Ph(n){let e={},t=a(n,["name"]);t!=null&&c(e,["_url","name"],t);let i=a(n,["config"]);return i!=null&&kh(i,e),e}function Nh(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","name"],t),e}function Rh(n,e){let t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),t}function Fh(n){let e={},t=a(n,["parent"]);t!=null&&c(e,["_url","parent"],t);let i=a(n,["config"]);return i!=null&&Rh(i,e),e}function Lh(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let i=a(n,["nextPageToken"]);i!=null&&c(e,["nextPageToken"],i);let o=a(n,["documents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),c(e,["documents"],s)}return e}var dr=class extends ct{constructor(e){super(),this.apiClient=e,this.list=async t=>new _t(xt.PAGED_ITEM_DOCUMENTS,i=>this.listInternal({parent:t.parent,config:i.config}),await this.listInternal(t),t)}async get(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=Nh(e);return s=W("{name}",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,i;let o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=Ph(e);o=W("{name}",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=Fh(e);return s=W("{parent}/documents",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{let u=Lh(d),f=new Fs;return Object.assign(f,u),f})}}};var ur=class extends ct{constructor(e,t=new dr(e)){super(),this.apiClient=e,this.documents=t,this.list=async(i={})=>new _t(xt.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(i),i)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=L0(e);return s=W("fileSearchStores",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async get(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=O0(e);return s=W("{name}",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,i;let o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=B0(e);o=W("{name}",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=K0(e);return s=W("fileSearchStores",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{let u=W0(d),f=new Ls;return Object.assign(f,u),f})}}async uploadToFileSearchStoreInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=z0(e);return s=W("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{let u=J0(d),f=new Vs;return Object.assign(f,u),f})}}async importFile(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=q0(e);return s=W("{file_search_store_name}:importFile",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{let u=U0(d),f=new Bs;return Object.assign(f,u),f})}}};var Nc=function(){let{crypto:n}=globalThis;if(n?.randomUUID)return Nc=n.randomUUID.bind(n),n.randomUUID();let e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,i=>(+i^t()&15>>+i/4).toString(16))},Vh=()=>Nc();function mr(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}var pr=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){let e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};var ze=class extends Error{},Je=class n extends ze{constructor(e,t,i,o){super(`${n.makeMessage(e,t,i)}`),this.status=e,this.headers=o,this.error=t}static makeMessage(e,t,i){let o=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):i;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,t,i,o){if(!e||!o)return new Qt({message:i,cause:pr(t)});let s=t;return e===400?new Vi(e,s,i,o):e===401?new Bi(e,s,i,o):e===403?new Oi(e,s,i,o):e===404?new Gi(e,s,i,o):e===409?new Ui(e,s,i,o):e===422?new qi(e,s,i,o):e===429?new $i(e,s,i,o):e>=500?new Hi(e,s,i,o):new n(e,s,i,o)}},wn=class extends Je{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Qt=class extends Je{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Li=class extends Qt{constructor({message:e}={}){super({message:e??"Request timed out."})}},Vi=class extends Je{},Bi=class extends Je{},Oi=class extends Je{},Gi=class extends Je{},Ui=class extends Je{},qi=class extends Je{},$i=class extends Je{},Hi=class extends Je{};var Bh=/^[a-z][a-z0-9+.-]*:/i,Oh=n=>Bh.test(n),gr=n=>(gr=Array.isArray,gr(n)),Gh=gr,Uh=Gh,jl=Uh;function qh(n){if(!n)return!0;for(let e in n)return!1;return!0}function $h(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var Hh=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ze(`${n} must be an integer`);if(e<0)throw new ze(`${n} must be a positive integer`);return e},Kh=n=>{try{return JSON.parse(n)}catch{return}};var Wh=n=>new Promise(e=>setTimeout(e,n));var Wt="0.0.1";function zh(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Jh=()=>{var n,e,t,i,o;let s=zh();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Wt,"X-Stainless-OS":tc(Deno.build.os),"X-Stainless-Arch":ec(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(n=Deno.version)===null||n===void 0?void 0:n.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Wt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Wt,"X-Stainless-OS":tc((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":ec((i=globalThis.process.arch)!==null&&i!==void 0?i:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};let r=Qh();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Wt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Wt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Qh(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let i=t.exec(navigator.userAgent);if(i){let o=i[1]||0,s=i[2]||0,r=i[3]||0;return{browser:e,version:`${o}.${s}.${r}`}}}return null}var ec=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",tc=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),hi,Yh=()=>hi??(hi=Jh());function Xh(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Rc(...n){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function Zh(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return Rc({start(){},async pull(t){let{done:i,value:o}=await e.next();i?t.close():t.enqueue(o)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function Fc(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function jh(n){var e,t;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((t=(e=n[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let i=n.getReader(),o=i.cancel();i.releaseLock(),await o}var ef=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Lc=()=>{var n;if(typeof File>"u"){let{process:e}=globalThis,t=typeof((n=e?.versions)===null||n===void 0?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ts(n,e,t){return Lc(),new File(n,e??"unknown_file",t)}function tf(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}var nf=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";var Vc=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",of=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Vc(n),sf=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function rf(n,e,t){if(Lc(),n=await n,of(n))return n instanceof File?n:Ts([await n.arrayBuffer()],n.name);if(sf(n)){let o=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),Ts(await hr(o),e,t)}let i=await hr(n);if(e||(e=tf(n)),!t?.type){let o=i.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof o=="string"&&(t=Object.assign(Object.assign({},t),{type:o}))}return Ts(i,e,t)}async function hr(n){var e,t,i,o,s;let r=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)r.push(n);else if(Vc(n))r.push(n instanceof Blob?n:await n.arrayBuffer());else if(nf(n))try{for(var l=!0,d=lt(n),u;u=await d.next(),e=u.done,!e;l=!0){o=u.value,l=!1;let f=o;r.push(...await hr(f))}}catch(f){t={error:f}}finally{try{!l&&!e&&(i=d.return)&&await i.call(d)}finally{if(t)throw t.error}}else{let f=(s=n?.constructor)===null||s===void 0?void 0:s.name;throw new Error(`Unexpected data type: ${typeof n}${f?`; constructor: ${f}`:""}${af(n)}`)}return r}function af(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}var lf=(()=>{class n{constructor(t){this._client=t}}n._key=[];return n})();function Bc(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var nc=Object.freeze(Object.create(null)),cf=(n=Bc)=>function(t,...i){if(t.length===1)return t[0];let o=!1,s=[],r=t.reduce((f,C,y)=>{var E,I,P;/[?#]/.test(C)&&(o=!0);let B=i[y],L=(o?encodeURIComponent:n)(""+B);return y!==i.length&&(B==null||typeof B=="object"&&B.toString===((P=Object.getPrototypeOf((I=Object.getPrototypeOf((E=B.hasOwnProperty)!==null&&E!==void 0?E:nc))!==null&&I!==void 0?I:nc))===null||P===void 0?void 0:P.toString))&&(L=B+"",s.push({start:f.length+C.length,length:L.length,error:`Value of type ${Object.prototype.toString.call(B).slice(8,-1)} is not a valid path parameter`})),f+C+(y===i.length?"":L)},""),l=r.split(/[?#]/,1)[0],d=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,u;for(;(u=d.exec(l))!==null;)s.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(s.sort((f,C)=>f.start-C.start),s.length>0){let f=0,C=s.reduce((y,E)=>{let I=" ".repeat(E.start-f),P="^".repeat(E.length);return f=E.start+E.length,y+I+P},"");throw new ze(`Path parameters result in path with invalid segments:
${s.map(y=>y.error).join(`
`)}
${r}
${C}`)}return r},fi=cf(Bc);var Ki=class extends lf{create(e,t){var i;let{api_version:o=this._client.apiVersion}=e,s=Ri(e,["api_version"]);if("model"in s&&"agent_config"in s)throw new ze("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in s&&"generation_config"in s)throw new ze("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(fi`/${o}/interactions`,Object.assign(Object.assign({body:s},t),{stream:(i=e.stream)!==null&&i!==void 0?i:!1}))}delete(e,t={},i){let{api_version:o=this._client.apiVersion}=t??{};return this._client.delete(fi`/${o}/interactions/${e}`,i)}cancel(e,t={},i){let{api_version:o=this._client.apiVersion}=t??{};return this._client.post(fi`/${o}/interactions/${e}/cancel`,i)}get(e,t={},i){var o;let s=t??{},{api_version:r=this._client.apiVersion}=s,l=Ri(s,["api_version"]);return this._client.get(fi`/${r}/interactions/${e}`,Object.assign(Object.assign({query:l},i),{stream:(o=t?.stream)!==null&&o!==void 0?o:!1}))}};Ki._key=Object.freeze(["interactions"]);var Wi=class extends Ki{};function df(n){let e=0;for(let o of n)e+=o.length;let t=new Uint8Array(e),i=0;for(let o of n)t.set(o,i),i+=o.length;return t}var _i;function kr(n){let e;return(_i??(e=new globalThis.TextEncoder,_i=e.encode.bind(e)))(n)}var vi;function ic(n){let e;return(vi??(e=new globalThis.TextDecoder,vi=e.decode.bind(e)))(n)}var Yt=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?kr(e):e;this.buffer=df([this.buffer,t]);let i=[],o;for(;(o=uf(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){i.push(ic(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let s=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,r=ic(this.buffer.subarray(0,s));i.push(r),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return i}flush(){return this.buffer.length?this.decode(`
`):[]}};Yt.NEWLINE_CHARS=new Set([`
`,"\r"]);Yt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function uf(n,e){for(let o=e??0;o<n.length;o++){if(n[o]===10)return{preceding:o,index:o+1,carriage:!1};if(n[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function mf(n){for(let i=0;i<n.length-1;i++){if(n[i]===10&&n[i+1]===10||n[i]===13&&n[i+1]===13)return i+2;if(n[i]===13&&n[i+1]===10&&i+3<n.length&&n[i+2]===13&&n[i+3]===10)return i+4}return-1}var zi={off:0,error:200,warn:300,info:400,debug:500},oc=(n,e,t)=>{if(n){if($h(zi,n))return n;$e(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(zi))}`)}};function Sn(){}function Ci(n,e,t){return!e||zi[n]>zi[t]?Sn:e[n].bind(e)}var pf={error:Sn,warn:Sn,info:Sn,debug:Sn},sc=new WeakMap;function $e(n){var e;let t=n.logger,i=(e=n.logLevel)!==null&&e!==void 0?e:"off";if(!t)return pf;let o=sc.get(t);if(o&&o[0]===i)return o[1];let s={error:Ci("error",t,i),warn:Ci("warn",t,i),info:Ci("info",t,i),debug:Ci("debug",t,i)};return sc.set(t,[i,s]),s}var Nt=n=>(n.options&&(n.options=Object.assign({},n.options),delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var fr=class n{constructor(e,t,i){this.iterator=e,this.controller=t,this.client=i}static fromSSEResponse(e,t,i){let o=!1,s=i?$e(i):console;function r(){return at(this,arguments,function*(){var d,u,f,C;if(o)throw new ze("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let y=!1;try{try{for(var E=!0,I=lt(gf(e,t)),P;P=yield ae(I.next()),d=P.done,!d;E=!0){C=P.value,E=!1;let B=C;if(!y)if(B.data.startsWith("[DONE]")){y=!0;continue}else try{yield yield ae(JSON.parse(B.data))}catch(L){throw s.error("Could not parse message into JSON:",B.data),s.error("From chunk:",B.raw),L}}}catch(B){u={error:B}}finally{try{!E&&!d&&(f=I.return)&&(yield ae(f.call(I)))}finally{if(u)throw u.error}}y=!0}catch(B){if(mr(B))return yield ae(void 0);throw B}finally{y||t.abort()}})}return new n(r,t,i)}static fromReadableStream(e,t,i){let o=!1;function s(){return at(this,arguments,function*(){var d,u,f,C;let y=new Yt,E=Fc(e);try{for(var I=!0,P=lt(E),B;B=yield ae(P.next()),d=B.done,!d;I=!0){C=B.value,I=!1;let L=C;for(let H of y.decode(L))yield yield ae(H)}}catch(L){u={error:L}}finally{try{!I&&!d&&(f=P.return)&&(yield ae(f.call(P)))}finally{if(u)throw u.error}}for(let L of y.flush())yield yield ae(L)})}function r(){return at(this,arguments,function*(){var d,u,f,C;if(o)throw new ze("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let y=!1;try{try{for(var E=!0,I=lt(s()),P;P=yield ae(I.next()),d=P.done,!d;E=!0){C=P.value,E=!1;let B=C;y||B&&(yield yield ae(JSON.parse(B)))}}catch(B){u={error:B}}finally{try{!E&&!d&&(f=I.return)&&(yield ae(f.call(I)))}finally{if(u)throw u.error}}y=!0}catch(B){if(mr(B))return yield ae(void 0);throw B}finally{y||t.abort()}})}return new n(r,t,i)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],i=this.iterator(),o=s=>({next:()=>{if(s.length===0){let r=i.next();e.push(r),t.push(r)}return s.shift()}});return[new n(()=>o(e),this.controller,this.client),new n(()=>o(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return Rc({async start(){t=e[Symbol.asyncIterator]()},async pull(i){try{let{value:o,done:s}=await t.next();if(s)return i.close();let r=kr(JSON.stringify(o)+`
`);i.enqueue(r)}catch(o){i.error(o)}},async cancel(){var i;await((i=t.return)===null||i===void 0?void 0:i.call(t))}})}};function gf(n,e){return at(this,arguments,function*(){var i,o,s,r;if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new ze("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new ze("Attempted to iterate over a response with no body");let l=new _r,d=new Yt,u=Fc(n.body);try{for(var f=!0,C=lt(hf(u)),y;y=yield ae(C.next()),i=y.done,!i;f=!0){r=y.value,f=!1;let E=r;for(let I of d.decode(E)){let P=l.decode(I);P&&(yield yield ae(P))}}}catch(E){o={error:E}}finally{try{!f&&!i&&(s=C.return)&&(yield ae(s.call(C)))}finally{if(o)throw o.error}}for(let E of d.flush()){let I=l.decode(E);I&&(yield yield ae(I))}})}function hf(n){return at(this,arguments,function*(){var t,i,o,s;let r=new Uint8Array;try{for(var l=!0,d=lt(n),u;u=yield ae(d.next()),t=u.done,!t;l=!0){s=u.value,l=!1;let f=s;if(f==null)continue;let C=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?kr(f):f,y=new Uint8Array(r.length+C.length);y.set(r),y.set(C,r.length),r=y;let E;for(;(E=mf(r))!==-1;)yield yield ae(r.slice(0,E)),r=r.slice(E)}}catch(f){i={error:f}}finally{try{!l&&!t&&(o=d.return)&&(yield ae(o.call(d)))}finally{if(i)throw i.error}}r.length>0&&(yield yield ae(r))})}var _r=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,i,o]=ff(e,":");return o.startsWith(" ")&&(o=o.substring(1)),t==="event"?this.event=o:t==="data"&&this.data.push(o),null}};function ff(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function _f(n,e){let{response:t,requestLogID:i,retryOfRequestLogID:o,startTime:s}=e,r=await(async()=>{var l;if(e.options.stream)return $e(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):fr.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let d=t.headers.get("content-type"),u=(l=d?.split(";")[0])===null||l===void 0?void 0:l.trim();return u?.includes("application/json")||u?.endsWith("+json")?await t.json():await t.text()})();return $e(n).debug(`[${i}] response parsed`,Nt({retryOfRequestLogID:o,url:t.url,status:t.status,body:r,durationMs:Date.now()-s})),r}var vr=class n extends Promise{constructor(e,t,i=_f){super(o=>{o(null)}),this.responsePromise=t,this.parseResponse=i,this.client=e}_thenUnwrap(e){return new n(this.client,this.responsePromise,async(t,i)=>e(await this.parseResponse(t,i),i))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var Oc=Symbol("brand.privateNullableHeaders");function*vf(n){if(!n)return;if(Oc in n){let{values:i,nulls:o}=n;yield*i.entries();for(let s of o)yield[s,null];return}let e=!1,t;n instanceof Headers?t=n.entries():jl(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let i of t){let o=i[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let s=jl(i[1])?i[1]:[i[1]],r=!1;for(let l of s)l!==void 0&&(e&&!r&&(r=!0,yield[o,null]),yield[o,l])}}var yn=n=>{let e=new Headers,t=new Set;for(let i of n){let o=new Set;for(let[s,r]of vf(i)){let l=s.toLowerCase();o.has(l)||(e.delete(s),o.add(l)),r===null?(e.delete(s),t.add(l)):(e.append(s,r),t.delete(l))}}return{[Oc]:!0,values:e,nulls:t}};var As=n=>{var e,t,i,o,s,r;if(typeof globalThis.process<"u")return(i=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&i!==void 0?i:void 0;if(typeof globalThis.Deno<"u")return(r=(s=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||s===void 0?void 0:s.call(o,n))===null||r===void 0?void 0:r.trim()};var Gc,Cf=(()=>{class n{constructor(t){var i,o,s,r,l,d,u,{baseURL:f=As("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:C=(i=As("GEMINI_API_KEY"))!==null&&i!==void 0?i:null,apiVersion:y="v1beta"}=t,E=Ri(t,["baseURL","apiKey","apiVersion"]);let I=Object.assign(Object.assign({apiKey:C,apiVersion:y},E),{baseURL:f||"https://generativelanguage.googleapis.com"});this.baseURL=I.baseURL,this.timeout=(o=I.timeout)!==null&&o!==void 0?o:n.DEFAULT_TIMEOUT,this.logger=(s=I.logger)!==null&&s!==void 0?s:console;let P="warn";this.logLevel=P,this.logLevel=(l=(r=oc(I.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:oc(As("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&l!==void 0?l:P,this.fetchOptions=I.fetchOptions,this.maxRetries=(d=I.maxRetries)!==null&&d!==void 0?d:2,this.fetch=(u=I.fetch)!==null&&u!==void 0?u:Xh(),this.encoder=ef,this._options=I,this.apiKey=C,this.apiVersion=y,this.clientAdapter=I.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:i}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!i.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){let i=yn([t.headers]);if(!(i.values.has("authorization")||i.values.has("x-goog-api-key"))){if(this.apiKey)return yn([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return yn([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([i,o])=>typeof o<"u").map(([i,o])=>{if(typeof o=="string"||typeof o=="number"||typeof o=="boolean")return`${encodeURIComponent(i)}=${encodeURIComponent(o)}`;if(o===null)return`${encodeURIComponent(i)}=`;throw new ze(`Cannot stringify type ${typeof o}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Wt}`}defaultIdempotencyKey(){return`stainless-node-retry-${Vh()}`}makeStatusError(t,i,o,s){return Je.generate(t,i,o,s)}buildURL(t,i,o){let s=!this.baseURLOverridden()&&o||this.baseURL,r=Oh(t)?new URL(t):new URL(s+(s.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),l=this.defaultQuery();return qh(l)||(i=Object.assign(Object.assign({},l),i)),typeof i=="object"&&i&&!Array.isArray(i)&&(r.search=this.stringifyQuery(i)),r.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){let i=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${i}`}}async prepareRequest(t,{url:i,options:o}){}get(t,i){return this.methodRequest("get",t,i)}post(t,i){return this.methodRequest("post",t,i)}patch(t,i){return this.methodRequest("patch",t,i)}put(t,i){return this.methodRequest("put",t,i)}delete(t,i){return this.methodRequest("delete",t,i)}methodRequest(t,i,o){return this.request(Promise.resolve(o).then(s=>Object.assign({method:t,path:i},s)))}request(t,i=null){return new vr(this,this.makeRequest(t,i,void 0))}async makeRequest(t,i,o){var s,r,l;let d=await t,u=(s=d.maxRetries)!==null&&s!==void 0?s:this.maxRetries;i==null&&(i=u),await this.prepareOptions(d);let{req:f,url:C,timeout:y}=await this.buildRequest(d,{retryCount:u-i});await this.prepareRequest(f,{url:C,options:d});let E="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),I=o===void 0?"":`, retryOf: ${o}`,P=Date.now();if($e(this).debug(`[${E}] sending request`,Nt({retryOfRequestLogID:o,method:d.method,url:C,options:d,headers:f.headers})),!((r=d.signal)===null||r===void 0)&&r.aborted)throw new wn;let B=new AbortController,L=await this.fetchWithTimeout(C,f,y,B).catch(pr),H=Date.now();if(L instanceof globalThis.Error){let J=`retrying, ${i} attempts remaining`;if(!((l=d.signal)===null||l===void 0)&&l.aborted)throw new wn;let te=mr(L)||/timed? ?out/i.test(String(L)+("cause"in L?String(L.cause):""));if(i)return $e(this).info(`[${E}] connection ${te?"timed out":"failed"} - ${J}`),$e(this).debug(`[${E}] connection ${te?"timed out":"failed"} (${J})`,Nt({retryOfRequestLogID:o,url:C,durationMs:H-P,message:L.message})),this.retryRequest(d,i,o??E);throw $e(this).info(`[${E}] connection ${te?"timed out":"failed"} - error; no more retries left`),$e(this).debug(`[${E}] connection ${te?"timed out":"failed"} (error; no more retries left)`,Nt({retryOfRequestLogID:o,url:C,durationMs:H-P,message:L.message})),te?new Li:new Qt({cause:L})}let $=`[${E}${I}] ${f.method} ${C} ${L.ok?"succeeded":"failed"} with status ${L.status} in ${H-P}ms`;if(!L.ok){let J=await this.shouldRetry(L);if(i&&J){let ue=`retrying, ${i} attempts remaining`;return await jh(L.body),$e(this).info(`${$} - ${ue}`),$e(this).debug(`[${E}] response error (${ue})`,Nt({retryOfRequestLogID:o,url:L.url,status:L.status,headers:L.headers,durationMs:H-P})),this.retryRequest(d,i,o??E,L.headers)}let te=J?"error; no more retries left":"error; not retryable";$e(this).info(`${$} - ${te}`);let re=await L.text().catch(ue=>pr(ue).message),ne=Kh(re),pe=ne?void 0:re;throw $e(this).debug(`[${E}] response error (${te})`,Nt({retryOfRequestLogID:o,url:L.url,status:L.status,headers:L.headers,message:pe,durationMs:Date.now()-P})),this.makeStatusError(L.status,ne,pe,L.headers)}return $e(this).info($),$e(this).debug(`[${E}] response start`,Nt({retryOfRequestLogID:o,url:L.url,status:L.status,headers:L.headers,durationMs:H-P})),{response:L,options:d,controller:B,requestLogID:E,retryOfRequestLogID:o,startTime:P}}async fetchWithTimeout(t,i,o,s){let r=i||{},{signal:l,method:d}=r,u=Ri(r,["signal","method"]);l&&l.addEventListener("abort",()=>s.abort());let f=setTimeout(()=>s.abort(),o),C=globalThis.ReadableStream&&u.body instanceof globalThis.ReadableStream||typeof u.body=="object"&&u.body!==null&&Symbol.asyncIterator in u.body,y=Object.assign(Object.assign(Object.assign({signal:s.signal},C?{duplex:"half"}:{}),{method:"GET"}),u);d&&(y.method=d.toUpperCase());try{return await this.fetch.call(void 0,t,y)}finally{clearTimeout(f)}}async shouldRetry(t){let i=t.headers.get("x-should-retry");return i==="true"?!0:i==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,i,o,s){var r;let l,d=s?.get("retry-after-ms");if(d){let f=parseFloat(d);Number.isNaN(f)||(l=f)}let u=s?.get("retry-after");if(u&&!l){let f=parseFloat(u);Number.isNaN(f)?l=Date.parse(u)-Date.now():l=f*1e3}if(!(l&&0<=l&&l<60*1e3)){let f=(r=t.maxRetries)!==null&&r!==void 0?r:this.maxRetries;l=this.calculateDefaultRetryTimeoutMillis(i,f)}return await Wh(l),this.makeRequest(t,i-1,o)}calculateDefaultRetryTimeoutMillis(t,i){let r=i-t,l=Math.min(.5*Math.pow(2,r),8),d=1-Math.random()*.25;return l*d*1e3}async buildRequest(t,{retryCount:i=0}={}){var o,s,r;let l=Object.assign({},t),{method:d,path:u,query:f,defaultBaseURL:C}=l,y=this.buildURL(u,f,C);"timeout"in l&&Hh("timeout",l.timeout),l.timeout=(o=l.timeout)!==null&&o!==void 0?o:this.timeout;let{bodyHeaders:E,body:I}=this.buildBody({options:l}),P=await this.buildHeaders({options:t,method:d,bodyHeaders:E,retryCount:i});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:d,headers:P},l.signal&&{signal:l.signal}),globalThis.ReadableStream&&I instanceof globalThis.ReadableStream&&{duplex:"half"}),I&&{body:I}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(r=l.fetchOptions)!==null&&r!==void 0?r:{}),url:y,timeout:l.timeout}}async buildHeaders({options:t,method:i,bodyHeaders:o,retryCount:s}){let r={};this.idempotencyHeader&&i!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=t.idempotencyKey);let l=await this.authHeaders(t),d=yn([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),Yh()),this._options.defaultHeaders,o,t.headers,l]);return this.validateHeaders(d),d.values}buildBody({options:{body:t,headers:i}}){if(!t)return{bodyHeaders:void 0,body:void 0};let o=yn([i]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&o.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:Zh(t)}:this.encoder({body:t,headers:o})}}return n.DEFAULT_TIMEOUT=6e4,n})(),Pe=class extends Cf{constructor(){super(...arguments),this.interactions=new Wi(this)}};Gc=Pe;Pe.GeminiNextGenAPIClient=Gc;Pe.GeminiNextGenAPIClientError=ze;Pe.APIError=Je;Pe.APIConnectionError=Qt;Pe.APIConnectionTimeoutError=Li;Pe.APIUserAbortError=wn;Pe.NotFoundError=Gi;Pe.ConflictError=Ui;Pe.RateLimitError=$i;Pe.BadRequestError=Vi;Pe.AuthenticationError=Bi;Pe.InternalServerError=Hi;Pe.PermissionDeniedError=Oi;Pe.UnprocessableEntityError=qi;Pe.toFile=rf;Pe.Interactions=Wi;function yf(n,e){let t={},i=a(n,["name"]);return i!=null&&c(t,["_url","name"],i),t}function bf(n,e){let t={},i=a(n,["name"]);return i!=null&&c(t,["_url","name"],i),t}function Sf(n,e){let t={},i=a(n,["sdkHttpResponse"]);return i!=null&&c(t,["sdkHttpResponse"],i),t}function xf(n,e){let t={},i=a(n,["sdkHttpResponse"]);return i!=null&&c(t,["sdkHttpResponse"],i),t}function wf(n,e,t){let i={};if(a(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let o=a(n,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&c(e,["displayName"],o),a(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let s=a(n,["epochCount"]);e!==void 0&&s!=null&&c(e,["tuningTask","hyperparameters","epochCount"],s);let r=a(n,["learningRateMultiplier"]);if(r!=null&&c(i,["tuningTask","hyperparameters","learningRateMultiplier"],r),a(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(a(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let l=a(n,["batchSize"]);e!==void 0&&l!=null&&c(e,["tuningTask","hyperparameters","batchSize"],l);let d=a(n,["learningRate"]);if(e!==void 0&&d!=null&&c(e,["tuningTask","hyperparameters","learningRate"],d),a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(a(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return i}function Ef(n,e,t){let i={},o=a(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let E=a(n,["validationDataset"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec"],rc(E))}else if(o==="PREFERENCE_TUNING"){let E=a(n,["validationDataset"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec"],rc(E))}let s=a(n,["tunedModelDisplayName"]);e!==void 0&&s!=null&&c(e,["tunedModelDisplayName"],s);let r=a(n,["description"]);e!==void 0&&r!=null&&c(e,["description"],r);let l=a(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let E=a(n,["epochCount"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","hyperParameters","epochCount"],E)}else if(l==="PREFERENCE_TUNING"){let E=a(n,["epochCount"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],E)}let d=a(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let E=a(n,["learningRateMultiplier"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],E)}else if(d==="PREFERENCE_TUNING"){let E=a(n,["learningRateMultiplier"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],E)}let u=a(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){let E=a(n,["exportLastCheckpointOnly"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","exportLastCheckpointOnly"],E)}else if(u==="PREFERENCE_TUNING"){let E=a(n,["exportLastCheckpointOnly"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],E)}let f=a(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){let E=a(n,["adapterSize"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","hyperParameters","adapterSize"],E)}else if(f==="PREFERENCE_TUNING"){let E=a(n,["adapterSize"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],E)}if(a(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let C=a(n,["labels"]);e!==void 0&&C!=null&&c(e,["labels"],C);let y=a(n,["beta"]);return e!==void 0&&y!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","beta"],y),i}function Tf(n,e){let t={},i=a(n,["baseModel"]);i!=null&&c(t,["baseModel"],i);let o=a(n,["preTunedModel"]);o!=null&&c(t,["preTunedModel"],o);let s=a(n,["trainingDataset"]);s!=null&&Vf(s);let r=a(n,["config"]);return r!=null&&wf(r,t),t}function Af(n,e){let t={},i=a(n,["baseModel"]);i!=null&&c(t,["baseModel"],i);let o=a(n,["preTunedModel"]);o!=null&&c(t,["preTunedModel"],o);let s=a(n,["trainingDataset"]);s!=null&&Bf(s,t,e);let r=a(n,["config"]);return r!=null&&Ef(r,t,e),t}function Df(n,e){let t={},i=a(n,["name"]);return i!=null&&c(t,["_url","name"],i),t}function Mf(n,e){let t={},i=a(n,["name"]);return i!=null&&c(t,["_url","name"],i),t}function If(n,e,t){let i={},o=a(n,["pageSize"]);e!==void 0&&o!=null&&c(e,["_query","pageSize"],o);let s=a(n,["pageToken"]);e!==void 0&&s!=null&&c(e,["_query","pageToken"],s);let r=a(n,["filter"]);return e!==void 0&&r!=null&&c(e,["_query","filter"],r),i}function kf(n,e,t){let i={},o=a(n,["pageSize"]);e!==void 0&&o!=null&&c(e,["_query","pageSize"],o);let s=a(n,["pageToken"]);e!==void 0&&s!=null&&c(e,["_query","pageToken"],s);let r=a(n,["filter"]);return e!==void 0&&r!=null&&c(e,["_query","filter"],r),i}function Pf(n,e){let t={},i=a(n,["config"]);return i!=null&&If(i,t),t}function Nf(n,e){let t={},i=a(n,["config"]);return i!=null&&kf(i,t),t}function Rf(n,e){let t={},i=a(n,["sdkHttpResponse"]);i!=null&&c(t,["sdkHttpResponse"],i);let o=a(n,["nextPageToken"]);o!=null&&c(t,["nextPageToken"],o);let s=a(n,["tunedModels"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(l=>Uc(l))),c(t,["tuningJobs"],r)}return t}function Ff(n,e){let t={},i=a(n,["sdkHttpResponse"]);i!=null&&c(t,["sdkHttpResponse"],i);let o=a(n,["nextPageToken"]);o!=null&&c(t,["nextPageToken"],o);let s=a(n,["tuningJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(l=>Cr(l))),c(t,["tuningJobs"],r)}return t}function Lf(n,e){let t={},i=a(n,["name"]);i!=null&&c(t,["model"],i);let o=a(n,["name"]);return o!=null&&c(t,["endpoint"],o),t}function Vf(n,e){let t={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let i=a(n,["examples"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(t,["examples","examples"],o)}return t}function Bf(n,e,t){let i={},o=a(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let r=a(n,["gcsUri"]);e!==void 0&&r!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(o==="PREFERENCE_TUNING"){let r=a(n,["gcsUri"]);e!==void 0&&r!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],r)}let s=a(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let r=a(n,["vertexDatasetResource"]);e!==void 0&&r!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(s==="PREFERENCE_TUNING"){let r=a(n,["vertexDatasetResource"]);e!==void 0&&r!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],r)}if(a(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return i}function Uc(n,e){let t={},i=a(n,["sdkHttpResponse"]);i!=null&&c(t,["sdkHttpResponse"],i);let o=a(n,["name"]);o!=null&&c(t,["name"],o);let s=a(n,["state"]);s!=null&&c(t,["state"],hc(s));let r=a(n,["createTime"]);r!=null&&c(t,["createTime"],r);let l=a(n,["tuningTask","startTime"]);l!=null&&c(t,["startTime"],l);let d=a(n,["tuningTask","completeTime"]);d!=null&&c(t,["endTime"],d);let u=a(n,["updateTime"]);u!=null&&c(t,["updateTime"],u);let f=a(n,["description"]);f!=null&&c(t,["description"],f);let C=a(n,["baseModel"]);C!=null&&c(t,["baseModel"],C);let y=a(n,["_self"]);return y!=null&&c(t,["tunedModel"],Lf(y)),t}function Cr(n,e){let t={},i=a(n,["sdkHttpResponse"]);i!=null&&c(t,["sdkHttpResponse"],i);let o=a(n,["name"]);o!=null&&c(t,["name"],o);let s=a(n,["state"]);s!=null&&c(t,["state"],hc(s));let r=a(n,["createTime"]);r!=null&&c(t,["createTime"],r);let l=a(n,["startTime"]);l!=null&&c(t,["startTime"],l);let d=a(n,["endTime"]);d!=null&&c(t,["endTime"],d);let u=a(n,["updateTime"]);u!=null&&c(t,["updateTime"],u);let f=a(n,["error"]);f!=null&&c(t,["error"],f);let C=a(n,["description"]);C!=null&&c(t,["description"],C);let y=a(n,["baseModel"]);y!=null&&c(t,["baseModel"],y);let E=a(n,["tunedModel"]);E!=null&&c(t,["tunedModel"],E);let I=a(n,["preTunedModel"]);I!=null&&c(t,["preTunedModel"],I);let P=a(n,["supervisedTuningSpec"]);P!=null&&c(t,["supervisedTuningSpec"],P);let B=a(n,["preferenceOptimizationSpec"]);B!=null&&c(t,["preferenceOptimizationSpec"],B);let L=a(n,["tuningDataStats"]);L!=null&&c(t,["tuningDataStats"],L);let H=a(n,["encryptionSpec"]);H!=null&&c(t,["encryptionSpec"],H);let $=a(n,["partnerModelTuningSpec"]);$!=null&&c(t,["partnerModelTuningSpec"],$);let J=a(n,["customBaseModel"]);J!=null&&c(t,["customBaseModel"],J);let te=a(n,["experiment"]);te!=null&&c(t,["experiment"],te);let re=a(n,["labels"]);re!=null&&c(t,["labels"],re);let ne=a(n,["outputUri"]);ne!=null&&c(t,["outputUri"],ne);let pe=a(n,["pipelineJob"]);pe!=null&&c(t,["pipelineJob"],pe);let ie=a(n,["serviceAccount"]);ie!=null&&c(t,["serviceAccount"],ie);let ue=a(n,["tunedModelDisplayName"]);ue!=null&&c(t,["tunedModelDisplayName"],ue);let ke=a(n,["veoTuningSpec"]);return ke!=null&&c(t,["veoTuningSpec"],ke),t}function Of(n,e){let t={},i=a(n,["sdkHttpResponse"]);i!=null&&c(t,["sdkHttpResponse"],i);let o=a(n,["name"]);o!=null&&c(t,["name"],o);let s=a(n,["metadata"]);s!=null&&c(t,["metadata"],s);let r=a(n,["done"]);r!=null&&c(t,["done"],r);let l=a(n,["error"]);return l!=null&&c(t,["error"],l),t}function rc(n,e){let t={},i=a(n,["gcsUri"]);i!=null&&c(t,["validationDatasetUri"],i);let o=a(n,["vertexDatasetResource"]);return o!=null&&c(t,["validationDatasetUri"],o),t}var yr=class extends ct{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new _t(xt.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var i;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let o={tunedModelName:t.baseModel};!((i=t.config)===null||i===void 0)&&i.preTunedModelCheckpointId&&(o.checkpointId=t.config.preTunedModelCheckpointId);let s=Object.assign(Object.assign({},t),{preTunedModel:o});return s.baseModel=void 0,await this.tuneInternal(s)}else{let o=Object.assign({},t);return await this.tuneInternal(o)}else{let o=Object.assign({},t),s=await this.tuneMldevInternal(o),r="";return s.metadata!==void 0&&s.metadata.tunedModel!==void 0?r=s.metadata.tunedModel:s.name!==void 0&&s.name.includes("/operations/")&&(r=s.name.split("/operations/")[0]),{name:r,state:cc.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Mf(e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>Cr(f))}else{let u=Df(e);return l=W("{name}",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>Uc(f))}}async listInternal(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=Nf(e);return l=W("tuningJobs",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Ff(f),y=new Di;return Object.assign(y,C),y})}else{let u=Pf(e);return l=W("tunedModels",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Rf(f),y=new Di;return Object.assign(y,C),y})}}async cancel(e){var t,i,o,s;let r,l="",d={};if(this.apiClient.isVertexAI()){let u=bf(e);return l=W("{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=xf(f),y=new Mi;return Object.assign(y,C),y})}else{let u=yf(e);return l=W("{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(C=>{let y=C;return y.sdkHttpResponse={headers:f.headers},y})),r.then(f=>{let C=Sf(f),y=new Mi;return Object.assign(y,C),y})}}async tuneInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){let l=Af(e,e);return s=W("tuningJobs",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(u=>{let f=u;return f.sdkHttpResponse={headers:d.headers},f})),o.then(d=>Cr(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=Tf(e);return s=W("tunedModels",l._url),r=l._query,delete l._url,delete l._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(u=>{let f=u;return f.sdkHttpResponse={headers:d.headers},f})),o.then(d=>Of(d))}}};var br=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},Gf=1024*1024*8,Uf=3,qf=1e3,$f=2,Ji="x-goog-upload-status";async function Hf(n,e,t){var i;let o=await qc(n,e,t),s=await o?.json();if(((i=o?.headers)===null||i===void 0?void 0:i[Ji])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return s.file}async function Kf(n,e,t){var i;let o=await qc(n,e,t),s=await o?.json();if(((i=o?.headers)===null||i===void 0?void 0:i[Ji])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let r=lc(s),l=new Hs;return Object.assign(l,r),l}async function qc(n,e,t){var i,o;let s=0,r=0,l=new xn(new Response),d="upload";for(s=n.size;r<s;){let u=Math.min(Gf,s-r),f=n.slice(r,r+u);r+u>=s&&(d+=", finalize");let C=0,y=qf;for(;C<Uf&&(l=await t.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(r),"Content-Length":String(u)}}}),!(!((i=l?.headers)===null||i===void 0)&&i[Ji]));)C++,await zf(y),y=y*$f;if(r+=u,((o=l?.headers)===null||o===void 0?void 0:o[Ji])!=="active")break;if(s<=r)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function Wf(n){return{size:n.size,type:n.type}}function zf(n){return new Promise(e=>setTimeout(e,n))}var Sr=class{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Hf(e,t,i)}async uploadToFileSearchStore(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Kf(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Wf(e)}};var xr=class{create(e,t,i){return new wr(e,t,i)}},wr=class{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var ac="x-goog-api-key",Er=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(ac)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(ac,this.apiKey)}}};var Jf="gl-node/",Qi=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Pe({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let i=bu(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let o=new Er(this.apiKey);this.apiClient=new tr({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Jf+"web",uploader:new Sr,downloader:new br}),this.models=new ar(this.apiClient),this.live=new sr(this.apiClient,o,new xr),this.batches=new zs(this.apiClient),this.chats=new Qs(this.models,this.apiClient),this.caches=new Js(this.apiClient),this.files=new Xs(this.apiClient),this.operations=new lr(this.apiClient),this.authTokens=new cr(this.apiClient),this.tunings=new yr(this.apiClient),this.fileSearchStores=new ur(this.apiClient)}};var ji=class n{constructor(){this.genAI=null;this.apiKey="";this.ipc=O(Ie);this.isInitialized=!1;this.loadApiKeyFromBackend()}loadApiKeyFromBackend(){let e=localStorage.getItem("ai_api_key");e&&this.setApiKeyInternal(e),this.ipc.on("ai-settings-loaded",t=>{t?.geminiApiKey&&(this.setApiKeyInternal(t.geminiApiKey),localStorage.setItem("ai_api_key",t.geminiApiKey),console.log("[GeminiService] API key loaded from backend"))}),this.ipc.send("get-ai-settings",{}),setTimeout(()=>{this.isConfigured()||console.warn("Gemini API Key not found. AI features will be disabled until configured.")},2e3)}setApiKeyInternal(e){e&&(this.apiKey=e,this.genAI=new Qi({apiKey:e}),this.isInitialized=!0)}setApiKey(e){e&&(this.setApiKeyInternal(e),localStorage.setItem("ai_api_key",e),this.ipc.send("save-ai-settings",{geminiApiKey:e}),console.log("[GeminiService] API key configured and saved to backend"))}isConfigured(){return this.genAI!==null&&this.apiKey.length>0}getApiKey(){return this.apiKey}async generateOutreachMessage(e,t){if(!this.genAI)throw new Error("Gemini API is not initialized. Please ensure the API_KEY environment variable is set.");let i="gemini-2.5-flash",o="You are an expert marketing assistant for a tool called TG-AI\u667A\u63A7\u738B. You write friendly, professional, and short direct messages (DMs). Do not use markdown formatting. Just return the plain text of the message.",s=`
      A user was found in the Telegram group "${e.sourceGroup}" because they mentioned the keyword "${e.triggeredKeyword}".
      Their username is @${e.username}.

      Based on the following instruction, write a direct message to this user.

      Instruction: "${t}"
    `;try{return(await this.genAI.models.generateContent({model:i,contents:s,config:{systemInstruction:o}})).text}catch(r){throw console.error("Error generating content with Gemini:",r),new Error("Failed to generate message. Check console for details.")}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var En=class n{constructor(){this.ipcService=O(Ie)}downloadExcelTemplate(){this.ipcService.send("download-excel-template")}loadAccountsFromExcel(){this.ipcService.send("load-accounts-from-excel")}reloadSessionsAndAccounts(){this.ipcService.send("reload-sessions-and-accounts")}exportLeadsToExcel(e){this.ipcService.send("export-leads-to-excel",JSON.parse(JSON.stringify(e)))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac})}};var Qf=(n,e)=>e.id,Yf=(n,e)=>e.label;function Xf(n,e){if(n&1&&(x(0,"div",6),m(1),w()),n&2){let t=_().$implicit;h(),R(t.title)}}function Zf(n,e){if(n&1){let t=F();x(0,"button",12),U("click",function(){b(t);let o=_().$implicit,s=_();return S(s.handleNextStep(o))}),x(1,"span"),m(2,"\u2192"),w(),x(3,"span",13),m(4),w()()}if(n&2){let t=_().$implicit;h(4),R(t.nextStep.label)}}function jf(n,e){if(n&1){let t=F();x(0,"button",15),U("click",function(){let o=b(t).$implicit,s=_(2).$implicit,r=_();return S(r.handleAction(s,o))}),m(1),w()}if(n&2){let t=e.$implicit;V("bg-white",t.variant==="primary")("text-slate-900",t.variant==="primary")("hover:bg-white/90",t.variant==="primary")("bg-white/20",t.variant==="secondary"||!t.variant)("text-white",t.variant==="secondary"||!t.variant)("hover:bg-white/30",t.variant==="secondary"||!t.variant)("bg-red-600",t.variant==="danger")("text-white",t.variant==="danger")("hover:bg-red-700",t.variant==="danger"),h(),k(" ",t.label," ")}}function e_(n,e){if(n&1&&(x(0,"div",9),X(1,jf,2,19,"button",14,Yf),w()),n&2){let t=_().$implicit;h(),Z(t.actions)}}function t_(n,e){if(n&1){let t=F();x(0,"button",16),U("click",function(){b(t);let o=_().$implicit,s=_();return S(s.dismiss(o.id))}),j(),x(1,"svg",17),Ee(2,"path",18),w()()}}function n_(n,e){if(n&1&&(x(0,"div",11),Ee(1,"div",19),w()),n&2){let t=_().$implicit;h(),me("width",t.progress,"%")}}function i_(n,e){if(n&1&&(x(0,"div",2)(1,"div",3)(2,"div",4),m(3),w(),x(4,"div",5),T(5,Xf,2,1,"div",6),x(6,"div",7),m(7),w(),T(8,Zf,5,1,"button",8),T(9,e_,3,0,"div",9),w(),T(10,t_,3,0,"button",10),w(),T(11,n_,2,2,"div",11),w()),n&2){let t=e.$implicit,i=_();V("bg-emerald-500/95",t.type==="success")("bg-red-500/95",t.type==="error")("bg-amber-500/95",t.type==="warning")("bg-blue-500/95",t.type==="info")("bg-slate-700/95",t.type==="progress")("border-emerald-400/50",t.type==="success")("border-red-400/50",t.type==="error")("border-amber-400/50",t.type==="warning")("border-blue-400/50",t.type==="info")("border-slate-600/50",t.type==="progress"),h(3),k(" ",t.icon||i.getDefaultIcon(t.type)," "),h(2),A(t.title?5:-1),h(2),k(" ",t.message," "),h(),A(t.nextStep?8:-1),h(),A(t.actions&&t.actions.length>0?9:-1),h(),A(t.dismissible!==!1?10:-1),h(),A(t.type==="progress"&&t.progress!==void 0?11:-1)}}var eo=class n{constructor(){this.toastService=O(Ne)}get toasts(){return this.toastService.getToasts()}getDefaultIcon(e){return{success:"\u2705",error:"\u274C",warning:"\u26A0\uFE0F",info:"\u2139\uFE0F",progress:"\u23F3"}[e]||"\u2139\uFE0F"}dismiss(e){this.toastService.dismiss(e)}handleNextStep(e){e.nextStep&&(e.nextStep.action(),this.dismiss(e.id))}handleAction(e,t){t.handler(),this.dismiss(e.id)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-toast"]],decls:3,vars:0,consts:[[1,"fixed","top-4","right-4","z-[9999]","space-y-3","max-w-md"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden",3,"bg-emerald-500/95","bg-red-500/95","bg-amber-500/95","bg-blue-500/95","bg-slate-700/95","border-emerald-400/50","border-red-400/50","border-amber-400/50","border-blue-400/50","border-slate-600/50"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden"],[1,"flex","items-start","gap-3","p-4"],[1,"flex-shrink-0","text-xl"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-white","mb-0.5"],[1,"text-white","text-sm"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors"],[1,"flex","items-center","gap-2","mt-3"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1"],[1,"h-1","bg-slate-600"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors",3,"click"],[1,"underline"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"bg-white","text-slate-900","hover:bg-white/90","bg-white/20","text-white","hover:bg-white/30","bg-red-600","hover:bg-red-700"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"click"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all","duration-300"]],template:function(t,i){t&1&&(x(0,"div",0),X(1,i_,12,27,"div",1,Qf),w()),t&2&&(h(),Z(i.toasts()))},dependencies:[de],styles:["@keyframes _ngcontent-%COMP%_slide-in{0%{transform:translate(100%) scale(.95);opacity:0}to{transform:translate(0) scale(1);opacity:1}}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in .3s cubic-bezier(.34,1.56,.64,1)}"]})}};function o_(n,e){n&1&&(p(0,"span",5),m(1,"\u2139\uFE0F"),g())}function s_(n,e){n&1&&(p(0,"span",6),m(1,"\u26A0\uFE0F"),g())}function r_(n,e){n&1&&(p(0,"span",7),m(1,"\u{1F5D1}\uFE0F"),g())}function a_(n,e){if(n&1&&(p(0,"li",18),q(1,"span",20),p(2,"span",21),m(3),g()()),n&2){let t=e.$implicit,i=_(3);h(),V("bg-yellow-500",i.dialogService.state().type==="warning")("bg-red-500",i.dialogService.state().type==="danger")("bg-blue-500",i.dialogService.state().type==="info"),h(2),R(t)}}function l_(n,e){if(n&1&&(p(0,"li",19),m(1),g()),n&2){let t=_(3);h(),k("...\u9084\u6709 ",t.dialogService.state().affectedItems.length-5," \u9805")}}function c_(n,e){if(n&1&&(p(0,"div",11)(1,"p",16),m(2,"\u5C07\u6703\u53D7\u5230\u5F71\u97FF:"),g(),p(3,"ul",17),X(4,a_,4,7,"li",18,ht),T(6,l_,2,1,"li",19),g()()),n&2){let t=_(2);h(4),Z(t.dialogService.state().affectedItems.slice(0,5)),h(2),A(t.dialogService.state().affectedItems.length>5?6:-1)}}function d_(n,e){if(n&1){let t=F();p(0,"div",12)(1,"p",16),m(2," \u8F38\u5165\u300C"),p(3,"span",22),m(4),g(),m(5,"\u300D\u4EE5\u78BA\u8A8D "),g(),p(6,"input",23),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.confirmTextInput,o)||(s.confirmTextInput=o),S(o)}),g()()}if(n&2){let t=_(2);h(4),R(t.dialogService.state().confirmTextRequired),h(2),_e("ngModel",t.confirmTextInput)}}function u_(n,e){if(n&1){let t=F();p(0,"div",0)(1,"div",1),D("click",function(){b(t);let o=_();return S(o.dialogService.onCancel())}),g(),p(2,"div",2)(3,"div",3)(4,"div",4),T(5,o_,2,0,"span",5)(6,s_,2,0,"span",6)(7,r_,2,0,"span",7),g()(),p(8,"div",8)(9,"h3",9),m(10),g(),p(11,"p",10),m(12),g(),T(13,c_,7,1,"div",11),T(14,d_,7,2,"div",12),g(),p(15,"div",13)(16,"button",14),D("click",function(){b(t);let o=_();return S(o.dialogService.onCancel())}),m(17),g(),p(18,"button",15),D("click",function(){b(t);let o=_();return S(o.onConfirmClick())}),m(19),g()()()()}if(n&2){let t,i=_();h(4),V("bg-blue-500/20",i.dialogService.state().type==="info")("bg-yellow-500/20",i.dialogService.state().type==="warning")("bg-red-500/20",i.dialogService.state().type==="danger"),h(),A((t=i.dialogService.state().type)==="info"?5:t==="warning"?6:t==="danger"?7:-1),h(5),R(i.dialogService.state().title),h(2),R(i.dialogService.state().message),h(),A(i.dialogService.state().affectedItems&&i.dialogService.state().affectedItems.length>0?13:-1),h(),A(i.dialogService.state().requireConfirmText?14:-1),h(3),k(" ",i.dialogService.state().cancelText," "),h(),V("bg-blue-500",i.dialogService.state().type==="info")("hover:bg-blue-600",i.dialogService.state().type==="info")("bg-yellow-500",i.dialogService.state().type==="warning")("hover:bg-yellow-600",i.dialogService.state().type==="warning")("text-black",i.dialogService.state().type==="warning")("bg-red-500",i.dialogService.state().type==="danger")("hover:bg-red-600",i.dialogService.state().type==="danger")("text-white",i.dialogService.state().type!=="warning"),K("disabled",!i.canConfirm()),h(),k(" ",i.dialogService.state().confirmText," ")}}var to=class n{constructor(){this.dialogService=O(Va);this.confirmTextInput=""}canConfirm(){let e=this.dialogService.state();return e.requireConfirmText?this.confirmTextInput===e.confirmTextRequired:!0}onConfirmClick(){this.canConfirm()&&(this.confirmTextInput="",this.dialogService.onConfirm())}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-global-confirm-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"pt-6","text-center"],[1,"inline-flex","w-16","h-16","rounded-full","items-center","justify-center","text-3xl"],[1,"text-blue-400"],[1,"text-yellow-400"],[1,"text-red-400"],[1,"p-6","text-center"],[1,"text-lg","font-semibold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-4","whitespace-pre-line"],[1,"mt-4","p-3","bg-slate-700/50","rounded-lg","text-left","max-h-32","overflow-y-auto"],[1,"mt-4"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","rounded-lg","transition-colors","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-xs","text-slate-500","mb-2"],[1,"space-y-1"],[1,"text-sm","text-slate-300","flex","items-center","gap-2"],[1,"text-xs","text-slate-500"],[1,"w-1.5","h-1.5","rounded-full","flex-shrink-0"],[1,"truncate"],[1,"text-red-400","font-medium"],["type","text","placeholder","\u8ACB\u8F38\u5165\u78BA\u8A8D\u6587\u5B57",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-center","focus:border-red-500","focus:outline-none",3,"ngModelChange","ngModel"]],template:function(t,i){t&1&&T(0,u_,20,30,"div",0),t&2&&A(i.dialogService.state().isOpen?0:-1)},dependencies:[de,Te,Le,Ve,Be],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};var no=class n{constructor(e,t){this.ipc=e;this.ngZone=t;this.allEvents$=new Mn;this.connectionState$=new qr("disconnected");this.recentEvents=[];this.maxRecentEvents=100;this.eventCounts=new Map;this.listenerCleanup=null;this.initialize()}async initialize(){try{await this.ipc.invoke("events:register-receiver"),this.setupEventListener(),await this.fetchHistory(),this.connectionState$.next("connected"),console.log("[RealtimeEvents] Initialized successfully")}catch(e){console.error("[RealtimeEvents] Initialization failed:",e),this.connectionState$.next("disconnected")}}setupEventListener(){window.electronAPI?.onEvent&&window.electronAPI.onEvent(e=>{this.ngZone.run(()=>{this.handleIncomingEvent(e)})})}handleIncomingEvent(e){this.recentEvents.push(e),this.recentEvents.length>this.maxRecentEvents&&this.recentEvents.shift();let t=this.eventCounts.get(e.type)||0;this.eventCounts.set(e.type,t+1),this.allEvents$.next(e),console.log(`[RealtimeEvents] Received: ${e.type}`,e.data)}async fetchHistory(){try{let e=await this.ipc.invoke("events:get-history",{limit:50});e&&Array.isArray(e)&&(this.recentEvents=e)}catch(e){console.error("[RealtimeEvents] Failed to fetch history:",e)}}events(){return this.allEvents$.asObservable()}on(e){return this.allEvents$.pipe($o(t=>t.type===e))}onAny(e){return this.allEvents$.pipe($o(t=>e.includes(t.type)))}onAlerts(){return this.onAny(["alert.new","alert.resolved","alert.cleared"])}onCapacity(){return this.onAny(["capacity.warning","capacity.critical","capacity.normal"])}onApiStatus(){return this.onAny(["api.added","api.removed","api.disabled","api.recovered","api.exhausted"])}onLogin(){return this.onAny(["login.success","login.failed","login.batch_complete"])}getConnectionState(){return this.connectionState$.asObservable()}getRecentEvents(e=20){return this.recentEvents.slice(-e)}getRecentByType(e,t=10){return this.recentEvents.filter(i=>i.type===e).slice(-t)}getStats(){return Array.from(this.eventCounts.entries()).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count)}async refreshHistory(){await this.fetchHistory()}ngOnDestroy(){this.listenerCleanup&&this.listenerCleanup(),this.allEvents$.complete()}static{this.\u0275fac=function(t){return new(t||n)(it(Ie),it(je))}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var $c=(n,e)=>e.id;function m_(n,e){if(n&1){let t=F();x(0,"div",4),U("click",function(){let o=b(t).$implicit,s=_();return S(s.handleClick(o))}),x(1,"div",5),m(2),w(),x(3,"div",6)(4,"div",7),m(5),w(),x(6,"div",8),m(7),w(),x(8,"div",9),m(9),w()(),x(10,"button",10),U("click",function(o){let s=b(t).$implicit,r=_();return S(r.dismiss(s,o))}),m(11,"\xD7"),w()()}if(n&2){let t=e.$implicit,i=_();Ae("level-"+t.level),K("@slideIn",void 0),h(2),R(i.getIcon(t.level)),h(3),R(t.title),h(2),R(t.message),h(2),R(i.formatTime(t.timestamp))}}function p_(n,e){if(n&1&&(x(0,"span",13),m(1),w()),n&2){let t=_(2);h(),R(t.unreadCount()>99?"99+":t.unreadCount())}}function g_(n,e){if(n&1){let t=F();x(0,"div",11),U("click",function(){b(t);let o=_();return S(o.togglePanel())}),x(1,"span",12),m(2,"\u{1F514}"),w(),T(3,p_,2,1,"span",13),w()}if(n&2){let t=_();V("panel-open",t.showPanel()),h(3),A(t.unreadCount()>0?3:-1)}}function h_(n,e){n&1&&(x(0,"div",18),m(1,"\u6682\u65E0\u544A\u8B66"),w())}function f_(n,e){if(n&1&&(x(0,"div",21)(1,"span",22),m(2),w(),x(3,"div",23)(4,"div",24),m(5),w(),x(6,"div",25),m(7),w()()()),n&2){let t=e.$implicit,i=_(2);Ae("level-"+t.level),h(2),R(i.getIcon(t.level)),h(3),R(t.title),h(2),R(i.formatTime(t.timestamp))}}function __(n,e){if(n&1){let t=F();x(0,"div",14),U("click",function(o){return b(t),S(o.stopPropagation())}),x(1,"div",15)(2,"h4"),m(3,"\u7CFB\u7EDF\u544A\u8B66"),w(),x(4,"button",16),U("click",function(){b(t);let o=_();return S(o.markAllRead())}),m(5,"\u5168\u90E8\u5DF2\u8BFB"),w()(),x(6,"div",17),T(7,h_,2,0,"div",18),X(8,f_,8,5,"div",19,$c),w(),x(10,"div",20)(11,"a",16),U("click",function(){b(t);let o=_();return S(o.goToAlerts())}),m(12,"\u67E5\u770B\u5168\u90E8 \u2192"),w()()()}if(n&2){let t=_();h(7),A(t.allNotifications().length===0?7:-1),h(),Z(t.allNotifications().slice(0,5))}}var io=class n{constructor(){this.ipcService=O(Ie);this.realtimeEvents=O(no);this.allNotifications=v([]);this.visibleNotifications=v([]);this.unreadCount=v(0);this.showPanel=v(!1);this.isConnected=v(!1);this.eventSubscription=null;this.dismissTimeouts=new Map;this.boundOnDocumentClick=this.onDocumentClick.bind(this);this.toggleDebounce=!1}ngOnInit(){this.loadAlerts(),this.subscribeToEvents(),this.pollInterval=setInterval(()=>this.loadAlerts(),9e4),document.addEventListener("click",this.boundOnDocumentClick)}ngOnDestroy(){this.eventSubscription&&this.eventSubscription.unsubscribe(),this.pollInterval&&clearInterval(this.pollInterval),document.removeEventListener("click",this.boundOnDocumentClick),this.dismissTimeouts.forEach(e=>clearTimeout(e))}onDocumentClick(e){let t=e.target;t&&(t.closest(".alert-badge")||t.closest(".quick-panel")||this.showPanel.set(!1))}subscribeToEvents(){this.eventSubscription=this.realtimeEvents.onAlerts().subscribe({next:e=>{this.handleRealtimeEvent(e)},error:e=>{console.error("[AlertNotification] Realtime subscription error:",e)}}),this.realtimeEvents.getConnectionState().subscribe(e=>{this.isConnected.set(e==="connected")})}handleRealtimeEvent(e){switch(console.log("[AlertNotification] Received realtime event:",e.type),e.type){case"alert.new":let t=e.data,i={id:t.id||e.id,type:t.type||"system",level:t.level||"warning",title:t.title||"\u7CFB\u7EDF\u544A\u8B66",message:t.message||"",timestamp:e.timestamp,dismissed:!1},o=this.allNotifications();o.find(r=>r.id===i.id)||(this.allNotifications.set([i,...o]),this.unreadCount.update(r=>r+1),this.showNotification(i));break;case"alert.resolved":let s=e.data.alert_id;this.allNotifications.update(r=>r.filter(l=>l.id!==s));break;case"alert.cleared":this.allNotifications.set([]),this.unreadCount.set(0);break}}async loadAlerts(){try{let e=await this.ipcService.invoke("alerts:get",{});if(e?.success){let i=(e.data?.active||[]).map(o=>({id:String(o.id||o.alert_id||Math.random()),type:o.alert_type||o.type||"system",level:this.mapLevel(o.level),title:o.title||this.generateTitle(o.alert_type||o.type,o.level),message:o.message||"",timestamp:this.parseTimestamp(o.created_at||o.timestamp),dismissed:!!(o.acknowledged||o.dismissed||o.resolved)}));if(!this.isConnected()){let o=new Set(this.allNotifications().map(r=>r.id)),s=i.filter(r=>!o.has(r.id));for(let r of s)this.showNotification(r)}this.allNotifications.set(i),this.unreadCount.set(i.filter(o=>!o.dismissed).length)}}catch(e){console.error("Load alerts failed:",e)}}mapLevel(e){return{info:"info",warning:"warning",error:"critical",critical:"urgent"}[e]||"warning"}generateTitle(e,t){return{cpu_high:"CPU \u4F7F\u7528\u7387\u8FC7\u9AD8",memory_high:"\u5185\u5B58\u4F7F\u7528\u7387\u8FC7\u9AD8",disk_space_low:"\u78C1\u76D8\u7A7A\u95F4\u4E0D\u8DB3",error_rate:"\u9519\u8BEF\u7387\u8FC7\u9AD8",connection_disconnected:"\u8FDE\u63A5\u65AD\u5F00",account_health:"\u8D26\u53F7\u5065\u5EB7\u5F02\u5E38",performance_degraded:"\u6027\u80FD\u4E0B\u964D",queue_length:"\u961F\u5217\u79EF\u538B"}[e]||`\u7CFB\u7EDF\u544A\u8B66 (${t||"warning"})`}parseTimestamp(e){if(!e)return Date.now()/1e3;if(typeof e=="number"&&e>1577836800&&e<4102444800)return e;if(typeof e=="string"){let t=new Date(e.replace(" ","T"));if(!isNaN(t.getTime()))return t.getTime()/1e3}return typeof e=="number"&&e>15778368e5?e/1e3:Date.now()/1e3}showNotification(e){let t=this.visibleNotifications();t.length>=3&&this.dismiss(t[0]),this.visibleNotifications.set([...t,e]);let i=this.getDismissDuration(e.level);if(i>0){let o=setTimeout(()=>this.dismiss(e),i);this.dismissTimeouts.set(e.id,o)}}getDismissDuration(e){return{info:5e3,warning:8e3,critical:15e3,urgent:0}[e]??8e3}dismiss(e,t){t&&t.stopPropagation();let i=this.dismissTimeouts.get(e.id);i&&(clearTimeout(i),this.dismissTimeouts.delete(e.id)),this.visibleNotifications.set(this.visibleNotifications().filter(o=>o.id!==e.id))}handleClick(e){this.dismiss(e),this.goToAlerts()}togglePanel(){if(this.toggleDebounce)return;this.toggleDebounce=!0,setTimeout(()=>this.toggleDebounce=!1,200);let e=this.showPanel();this.showPanel.set(!e),!e&&this.unreadCount()>0&&setTimeout(()=>this.markAllRead(),1e3)}closePanel(){this.showPanel.set(!1)}async markAllRead(){try{await this.ipcService.send("alerts:mark-read",{}),this.unreadCount.set(0)}catch(e){console.error("Mark all read failed:",e)}}goToAlerts(){window.dispatchEvent(new CustomEvent("changeView",{detail:"admin/alerts"})),this.closePanel()}getIcon(e){return{urgent:"\u{1F6A8}",critical:"\u26D4",warning:"\u26A0\uFE0F",info:"\u2139\uFE0F"}[e]||"\u{1F514}"}formatTime(e){if(!e||isNaN(e))return"";let t=new Date(e*1e3);if(isNaN(t.getTime()))return"";let o=(new Date().getTime()-t.getTime())/1e3;return o<0||o<60?"\u521A\u521A":o<3600?`${Math.floor(o/60)} \u5206\u949F\u524D`:o<86400?`${Math.floor(o/3600)} \u5C0F\u65F6\u524D`:t.toLocaleDateString()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-alert-notification"]],decls:5,vars:2,consts:[[1,"notification-container"],[1,"notification",3,"class"],[1,"alert-badge",3,"panel-open"],[1,"quick-panel"],[1,"notification",3,"click"],[1,"notification-icon"],[1,"notification-content"],[1,"notification-title"],[1,"notification-message"],[1,"notification-time"],[1,"notification-close",3,"click"],[1,"alert-badge",3,"click"],[1,"badge-icon"],[1,"badge-count"],[1,"quick-panel",3,"click"],[1,"panel-header"],[3,"click"],[1,"panel-content"],[1,"panel-empty"],[1,"panel-item",3,"class"],[1,"panel-footer"],[1,"panel-item"],[1,"item-icon"],[1,"item-content"],[1,"item-title"],[1,"item-time"]],template:function(t,i){t&1&&(x(0,"div",0),X(1,m_,12,7,"div",1,$c),w(),T(3,g_,4,3,"div",2),T(4,__,13,1,"div",3)),t&2&&(h(),Z(i.visibleNotifications()),h(2),A(i.unreadCount()>0||i.showPanel()?3:-1),h(),A(i.showPanel()?4:-1))},dependencies:[de],styles:[".notification-container[_ngcontent-%COMP%]{position:fixed;top:1rem;right:1rem;z-index:10000;display:flex;flex-direction:column;gap:.75rem;max-width:400px;pointer-events:none}.notification[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;padding:1rem;background:#1e293bfa;border-radius:.75rem;box-shadow:0 4px 20px #0000004d;border-left:4px solid #6b7280;pointer-events:auto;cursor:pointer;animation:_ngcontent-%COMP%_slideIn .3s ease-out;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}.notification.level-urgent[_ngcontent-%COMP%]{border-left-color:#ef4444;background:#ef444426;animation:_ngcontent-%COMP%_slideIn .3s ease-out,_ngcontent-%COMP%_urgentPulse 2s infinite}@keyframes _ngcontent-%COMP%_urgentPulse{0%,to{box-shadow:0 4px 20px #ef44444d}50%{box-shadow:0 4px 30px #ef444480}}.notification.level-critical[_ngcontent-%COMP%]{border-left-color:#f97316;background:#f9731626}.notification.level-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.notification.level-info[_ngcontent-%COMP%]{border-left-color:#3b82f6}.notification-icon[_ngcontent-%COMP%]{font-size:1.5rem;flex-shrink:0}.notification-content[_ngcontent-%COMP%]{flex:1;min-width:0}.notification-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#f1f5f9;margin-bottom:.25rem}.notification-message[_ngcontent-%COMP%]{font-size:.8rem;color:#d1d5db;line-height:1.4}.notification-time[_ngcontent-%COMP%]{font-size:.7rem;color:#6b7280;margin-top:.375rem}.notification-close[_ngcontent-%COMP%]{background:transparent;border:none;color:#6b7280;font-size:1.25rem;cursor:pointer;padding:0;line-height:1;transition:color .2s}.notification-close[_ngcontent-%COMP%]:hover{color:#f1f5f9}.alert-badge[_ngcontent-%COMP%]{position:fixed;top:1rem;right:1rem;z-index:9999;display:flex;align-items:center;gap:.25rem;padding:.5rem .75rem;background:#ef4444e6;border-radius:2rem;cursor:pointer;box-shadow:0 2px 10px #ef444466;animation:_ngcontent-%COMP%_badgePulse 2s infinite}@keyframes _ngcontent-%COMP%_badgePulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.alert-badge.panel-open[_ngcontent-%COMP%]{background:#3b82f6e6;box-shadow:0 2px 10px #3b82f666;animation:none}.badge-icon[_ngcontent-%COMP%]{font-size:1rem}.badge-count[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#fff}.quick-panel[_ngcontent-%COMP%]{position:fixed;top:4rem;right:1rem;z-index:9998;width:320px;background:#1e293bfa;border-radius:.75rem;box-shadow:0 4px 20px #0000004d;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1)}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid rgba(255,255,255,.1)}.panel-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:#f1f5f9}.panel-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent;border:none;color:#3b82f6;font-size:.75rem;cursor:pointer}.panel-content[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.panel-empty[_ngcontent-%COMP%]{padding:2rem;text-align:center;color:#6b7280;font-size:.875rem}.panel-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;border-left:3px solid #6b7280;cursor:pointer;transition:background .2s}.panel-item[_ngcontent-%COMP%]:hover{background:#ffffff0d}.panel-item.level-urgent[_ngcontent-%COMP%]{border-left-color:#ef4444}.panel-item.level-critical[_ngcontent-%COMP%]{border-left-color:#f97316}.panel-item.level-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.panel-item.level-info[_ngcontent-%COMP%]{border-left-color:#3b82f6}.item-icon[_ngcontent-%COMP%]{font-size:1rem}.item-content[_ngcontent-%COMP%]{flex:1;min-width:0}.item-title[_ngcontent-%COMP%]{font-size:.8rem;color:#f1f5f9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-time[_ngcontent-%COMP%]{font-size:.7rem;color:#6b7280}.panel-footer[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid rgba(255,255,255,.1);text-align:center}.panel-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3b82f6;font-size:.8rem;cursor:pointer}.panel-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})}};var v_=["inputRef"];function C_(n,e){if(n&1&&(p(0,"p",6),m(1),g()),n&2){let t,i=_(2);h(),R((t=i.dialogService.inputDialog())==null?null:t.message)}}function y_(n,e){if(n&1){let t=F();p(0,"textarea",14,0),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.inputValue,o)||(s.inputValue=o),S(o)}),D("keydown.enter",function(o){b(t);let s=_(2);return S(s.onEnterKey(o))}),m(2,"              "),g()}if(n&2){let t,i=_(2);_e("ngModel",i.inputValue),K("placeholder",((t=i.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function b_(n,e){if(n&1){let t=F();p(0,"input",15,0),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.inputValue,o)||(s.inputValue=o),S(o)}),D("keydown.enter",function(o){b(t);let s=_(2);return S(s.onEnterKey(o))}),g()}if(n&2){let t,i=_(2);_e("ngModel",i.inputValue),K("placeholder",((t=i.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function S_(n,e){if(n&1&&(p(0,"p",10)(1,"span"),m(2,"\u26A0\uFE0F"),g(),m(3),g()),n&2){let t=_(2);h(3),k(" ",t.dialogService.inputDialogError()," ")}}function x_(n,e){if(n&1){let t=F();p(0,"div",1)(1,"div",2),D("click",function(){b(t);let o=_();return S(o.cancelDialog())}),g(),p(2,"div",3)(3,"div",4)(4,"h3",5)(5,"span"),m(6,"\u270F\uFE0F"),g(),m(7),g(),T(8,C_,2,1,"p",6),g(),p(9,"div",7),D("click",function(o){b(t);let s=_();return S(s.focusInput(o))}),T(10,y_,3,2,"textarea",8)(11,b_,2,2,"input",9),T(12,S_,4,1,"p",10),g(),p(13,"div",11)(14,"button",12),D("click",function(){b(t);let o=_();return S(o.cancelDialog())}),m(15),g(),p(16,"button",13),D("click",function(){b(t);let o=_();return S(o.confirmWithValue())}),m(17),g()()()()}if(n&2){let t,i,o,s,r,l=_();h(7),k(" ",(t=l.dialogService.inputDialog())==null?null:t.title," "),h(),A((i=l.dialogService.inputDialog())!=null&&i.message?8:-1),h(2),A(((o=l.dialogService.inputDialog())==null?null:o.inputType)==="textarea"?10:11),h(2),A(l.dialogService.inputDialogError()?12:-1),h(3),k(" ",((s=l.dialogService.inputDialog())==null?null:s.cancelText)||"\u53D6\u6D88"," "),h(2),k(" ",((r=l.dialogService.inputDialog())==null?null:r.confirmText)||"\u78BA\u5B9A"," ")}}var oo=class n{constructor(){this.dialogService=O(Wn);this.inputValue="";this.lastDialogState=!1}ngAfterViewChecked(){let e=!!this.dialogService.inputDialog();e&&!this.lastDialogState&&(this.inputValue=this.dialogService.inputDialog()?.defaultValue||"",setTimeout(()=>this.focusInput(),100),setTimeout(()=>this.focusInput(),300)),!e&&this.lastDialogState&&(this.inputValue=""),this.lastDialogState=e}focusInput(e){e&&e.stopPropagation(),this.inputRef?.nativeElement&&(this.inputRef.nativeElement.focus(),console.log("[InputDialog] Focus requested"))}onEnterKey(e){this.dialogService.inputDialog()?.inputType!=="textarea"&&(e.preventDefault(),this.confirmWithValue())}confirmWithValue(){this.dialogService.updateInputValue(this.inputValue),this.dialogService.confirmInput()}cancelDialog(){this.inputValue="",this.dialogService.cancelInput()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-global-input-dialog"]],viewQuery:function(t,i){if(t&1&&Pn(v_,5),t&2){let o;dn(o=un())&&(i.inputRef=o.first)}},decls:1,vars:1,consts:[["inputRef",""],[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"p-6","pb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-2"],[1,"px-6","pb-4",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModel","placeholder"],[1,"mt-2","text-sm","text-red-400","flex","items-center","gap-1"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","bg-purple-500","hover:bg-purple-600","text-white","rounded-lg","transition-colors","font-medium",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModelChange","keydown.enter","ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModelChange","keydown.enter","ngModel","placeholder"]],template:function(t,i){t&1&&T(0,x_,18,6,"div",1),t&2&&A(i.dialogService.inputDialog()?0:-1)},dependencies:[de,Te,Le,Ve,Be],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};function w_(n,e){if(n&1&&(x(0,"p",9),m(1),w()),n&2){let t=_(2);h(),R(t.progressSignal().itemName)}}function E_(n,e){if(n&1&&(x(0,"p",6),m(1),w()),n&2){let t=_(2);h(),R(t.progressSignal().message)}}function T_(n,e){if(n&1){let t=F();x(0,"button",11),U("click",function(){b(t);let o=_(2);return S(o.onCancel())}),m(1," \u53D6\u6D88 "),w()}}function A_(n,e){if(n&1&&(x(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),m(4),w(),x(5,"div",4)(6,"div",5)(7,"span",6),m(8),w(),x(9,"span",6),m(10),w()(),x(11,"div",7),Ee(12,"div",8),w()(),T(13,w_,2,1,"p",9),T(14,E_,2,1,"p",6),T(15,T_,2,0,"button",10),w()()()),n&2){let t=_();h(4),R(t.titleSignal()),h(4),be("",t.progressSignal().current," / ",t.progressSignal().total),h(2),k("",t.percentage(),"%"),h(2),me("width",t.percentage(),"%"),h(),A(t.progressSignal().itemName?13:-1),h(),A(t.progressSignal().message?14:-1),h(),A(t.cancellableSignal()?15:-1)}}var so=class n{constructor(){this._show=v(!1);this._title=v("\u5904\u7406\u4E2D...");this._progress=v({current:0,total:0});this._cancellable=v(!1);this.showSignal=G(()=>this._show());this.titleSignal=G(()=>this._title());this.progressSignal=G(()=>this._progress());this.cancellableSignal=G(()=>this._cancellable());this.percentage=G(()=>{let e=this._progress();return e.total>0?Math.round(e.current/e.total*100):0})}set show(e){this._show.set(e)}set title(e){this._title.set(e)}set progress(e){this._progress.set(e)}set cancellable(e){this._cancellable.set(e)}onCancel(){this.onCancelCallback&&this.onCancelCallback()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-progress-dialog"]],inputs:{show:"show",title:"title",progress:"progress",cancellable:"cancellable",onCancelCallback:"onCancelCallback"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","z-50","flex","items-center","justify-center"],[1,"bg-slate-800/90","dark:bg-slate-900/90","rounded-lg","p-6","shadow-xl","border","border-slate-700","min-w-[400px]"],[1,"flex","flex-col","gap-4"],[1,"text-lg","font-semibold","text-slate-200"],[1,"w-full"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-sm","text-slate-300"],[1,"w-full","bg-slate-700","rounded-full","h-3","overflow-hidden"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","h-full","transition-all","duration-300","ease-out"],[1,"text-sm","text-slate-400","text-center"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm",3,"click"]],template:function(t,i){t&1&&T(0,A_,16,9,"div",0),t&2&&A(i.showSignal()?0:-1)},dependencies:[de],styles:[".transition-all[_ngcontent-%COMP%]{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.3s}"]})}};function D_(n,e){if(n&1&&(x(0,"span",3),m(1),w()),n&2){let t=_();h(),k(" ",t.membershipService.daysRemaining(),"\u5929 ")}}function M_(n,e){if(n&1&&(x(0,"span"),m(1),Me(2,"date"),w()),n&2){let t,i=_(3);h(),k("\u5230\u671F\u6642\u9593\uFF1A",At(2,1,(t=i.membershipService.membership())==null?null:t.expiresAt,"yyyy-MM-dd"))}}function I_(n,e){n&1&&(x(0,"span",19),m(1,"\u6703\u54E1\u5DF2\u904E\u671F"),w())}function k_(n,e){if(n&1&&(x(0,"div",8),T(1,M_,3,4,"span")(2,I_,2,0,"span",19),w()),n&2){let t=_(2);h(),A(t.membershipService.daysRemaining()>0?1:2)}}function P_(n,e){if(n&1){let t=F();x(0,"div",4)(1,"div",5)(2,"span",6),m(3),w(),x(4,"span",7),m(5),w()(),T(6,k_,3,1,"div",8),x(7,"div",9)(8,"div")(9,"div",10)(10,"span"),m(11,"\u4ECA\u65E5\u6D88\u606F"),w(),x(12,"span"),m(13),w()(),x(14,"div",11),Ee(15,"div",12),w()(),x(16,"div")(17,"div",10)(18,"span"),m(19,"\u4ECA\u65E5 AI"),w(),x(20,"span"),m(21),w()(),x(22,"div",11),Ee(23,"div",13),w()()(),x(24,"div",14)(25,"button",15),U("click",function(){b(t);let o=_();return S(o.openActivate())}),m(26),w(),x(27,"button",16),U("click",function(){b(t);let o=_();return S(o.showDetails=!1)}),j(),x(28,"svg",17),Ee(29,"path",18),w()()()()}if(n&2){let t=_();h(3),R(t.membershipService.levelIcon()),h(2),R(t.membershipService.levelName()),h(),A(t.membershipService.level()!=="bronze"?6:-1),h(7),be("",t.usage().todayMessages," / ",t.quotaText("messages")),h(2),me("width",t.usagePercent().messages,"%"),h(6),be("",t.usage().todayAiCalls," / ",t.quotaText("ai")),h(2),me("width",t.usagePercent().ai,"%"),h(3),k(" ",t.membershipService.level()==="bronze"?"\u6FC0\u6D3B\u6703\u54E1":"\u7E8C\u8CBB/\u5347\u7D1A"," ")}}var N_=(n,e)=>e.level;function R_(n,e){n&1&&(p(0,"div",22),m(1," \u63A8\u85A6 "),g())}function F_(n,e){n&1&&(p(0,"div",23),m(1," \u7576\u524D "),g())}function L_(n,e){n&1&&(p(0,"span",28),m(1,"\u514D\u8CBB"),g())}function V_(n,e){if(n&1&&(p(0,"span",5),m(1),g(),p(2,"span",33),m(3,"/\u6708"),g()),n&2){let t=_().$implicit;h(),k("",t.monthlyPrice," USDT")}}function B_(n,e){if(n&1&&(p(0,"div",29),m(1),g()),n&2){let t=_().$implicit,i=_(3);h(),be(" \u5E74\u4ED8 ",t.yearlyPrice," USDT (\u7701 ",i.Math.round((1-t.yearlyPrice/(t.monthlyPrice*12))*100),"%) ")}}function O_(n,e){if(n&1&&(p(0,"li",31),j(),p(1,"svg",34),q(2,"path",35),g(),m(3),g()),n&2){let t=e.$implicit;h(3),k(" ",t," ")}}function G_(n,e){if(n&1){let t=F();p(0,"div",21),T(1,R_,2,0,"div",22),T(2,F_,2,0,"div",23),p(3,"div",24)(4,"span",25),m(5),g(),p(6,"h3",26),m(7),g(),p(8,"div",27),T(9,L_,2,0,"span",28)(10,V_,4,1),g(),T(11,B_,2,2,"div",29),g(),p(12,"ul",30),X(13,O_,4,1,"li",31,ht),g(),p(15,"button",32),D("click",function(){let o=b(t).$implicit,s=_(3);return S(s.selectPlan(o))}),m(16),g()()}if(n&2){let t=e.$implicit,i=_(3);V("border-cyan-500",t.level===i.membershipService.level())("border-slate-600",t.level!==i.membershipService.level())("bg-slate-700/50",t.level===i.membershipService.level())("bg-slate-800",t.level!==i.membershipService.level()),h(),A(t.recommended?1:-1),h(),A(t.level===i.membershipService.level()?2:-1),h(3),R(t.icon),h(2),R(t.name),h(2),A(t.monthlyPrice===0?9:10),h(2),A(t.yearlyPrice>0?11:-1),h(2),Z(t.features),h(2),V("bg-gradient-to-r",t.level!=="bronze")("from-cyan-500",t.level!=="bronze")("to-blue-500",t.level!=="bronze")("text-white",t.level!=="bronze")("bg-slate-700",t.level==="bronze")("text-slate-400",t.level==="bronze"),K("disabled",t.level==="bronze"),h(),k(" ",t.level==="bronze"?"\u7576\u524D\u65B9\u6848":t.level===i.membershipService.level()?"\u7E8C\u8CBB":"\u9078\u64C7"," ")}}function U_(n,e){if(n&1&&(p(0,"div",14),X(1,G_,17,28,"div",15,N_),g(),p(3,"div",16)(4,"h4",17),m(5,"\u{1F4B3} \u8CFC\u8CB7\u65B9\u5F0F"),g(),p(6,"p",18),m(7," \u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6\uFF0C\u6216\u901A\u904E\u5B98\u65B9\u6E20\u9053\u7372\u53D6\u3002\u8CFC\u8CB7\u5F8C\u5728\u300C\u6FC0\u6D3B\u5361\u5BC6\u300D\u6A19\u7C64\u4E2D\u8F38\u5165\u6FC0\u6D3B\u78BC\u3002 "),g(),p(8,"div",19)(9,"a",20),m(10,"\u{1F4F1} \u806F\u7E6B\u5BA2\u670D"),g(),p(11,"a",20),m(12,"\u{1F310} \u5B98\u65B9\u5546\u57CE"),g()()()),n&2){let t=_(2);h(),Z(t.plans)}}function q_(n,e){if(n&1){let t=F();p(0,"div",13)(1,"div",36)(2,"div",37),m(3,"\u{1F511}"),g(),p(4,"h3",38),m(5,"\u6FC0\u6D3B\u6703\u54E1\u5361\u5BC6"),g(),p(6,"p",39),m(7,"\u8F38\u5165\u60A8\u8CFC\u8CB7\u7684\u5361\u5BC6\u6FC0\u6D3B\u6703\u54E1"),g()(),p(8,"div",40)(9,"div")(10,"label",41),m(11,"\u5361\u5BC6"),g(),p(12,"input",42),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.licenseKey,o)||(s.licenseKey=o),S(o)}),g()(),p(13,"div")(14,"label",41),m(15,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u901A\u77E5)"),g(),p(16,"input",43),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.email,o)||(s.email=o),S(o)}),g()(),p(17,"button",44),D("click",function(){b(t);let o=_(2);return S(o.activateLicense())}),m(18),g()(),p(19,"div",16)(20,"h4",17),m(21,"\u{1F4CB} \u5361\u5BC6\u683C\u5F0F\u8AAA\u660E"),g(),p(22,"ul",45)(23,"li"),m(24,"\u2022 TGAI-B2-XXXX-XXXX-XXXX (\u{1F948} \u767D\u9280\u6708\u5361)"),g(),p(25,"li"),m(26,"\u2022 TGAI-G2-XXXX-XXXX-XXXX (\u{1F947} \u9EC3\u91D1\u6708\u5361)"),g(),p(27,"li"),m(28,"\u2022 TGAI-D2-XXXX-XXXX-XXXX (\u{1F48E} \u947D\u77F3\u6708\u5361)"),g(),p(29,"li"),m(30,"\u2022 TGAI-S2-XXXX-XXXX-XXXX (\u{1F31F} \u661F\u8000\u6708\u5361)"),g(),p(31,"li"),m(32,"\u2022 TGAI-K2-XXXX-XXXX-XXXX (\u{1F451} \u738B\u8005\u6708\u5361)"),g()()()()}if(n&2){let t=_(2);h(12),_e("ngModel",t.licenseKey),h(4),_e("ngModel",t.email),h(),K("disabled",t.isActivating()),h(),k(" ",t.isActivating()?"\u6FC0\u6D3B\u4E2D...":"\u6FC0\u6D3B"," ")}}function $_(n,e){if(n&1){let t=F();p(0,"div",13)(1,"div",36)(2,"div",37),m(3,"\u{1F381}"),g(),p(4,"h3",38),m(5,"\u9080\u8ACB\u597D\u53CB\uFF0C\u96D9\u65B9\u7372\u76CA"),g(),p(6,"p",39),m(7,"\u5206\u4EAB\u60A8\u7684\u9080\u8ACB\u78BC\uFF0C\u9080\u8ACB\u597D\u53CB\u8A3B\u518A"),g()(),p(8,"div",46)(9,"div",47)(10,"div",48),m(11,"\u6211\u7684\u9080\u8ACB\u78BC"),g(),p(12,"div",49),m(13),g(),p(14,"button",50),D("click",function(){b(t);let o=_(2);return S(o.copyInviteCode())}),m(15," \u{1F4CB} \u8907\u88FD\u9080\u8ACB\u78BC "),g()()(),p(16,"div",51)(17,"div",52)(18,"div",53),m(19),g(),p(20,"div",54),m(21,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),g()(),p(22,"div",52)(23,"div",28),m(24),g(),p(25,"div",54),m(26,"\u7372\u5F97\u734E\u52F5"),g()()(),p(27,"div",55)(28,"h4",56),m(29,"\u{1F3AF} \u734E\u52F5\u898F\u5247"),g(),p(30,"ul",57)(31,"li",58)(32,"span",59),m(33,"\u2713"),g(),m(34," \u9080\u8ACB 1 \u4EBA\u8A3B\u518A\uFF1A\u60A8\u7372\u5F97 3 \u5929\u6703\u54E1 "),g(),p(35,"li",58)(36,"span",59),m(37,"\u2713"),g(),m(38," \u88AB\u9080\u8ACB\u4EBA\u7372\u5F97\uFF1A1 \u5929\u6703\u54E1\u9AD4\u9A57 "),g(),p(39,"li",58)(40,"span",59),m(41,"\u2713"),g(),m(42," \u88AB\u9080\u8ACB\u4EBA\u9996\u6B21\u4ED8\u8CBB\uFF1A\u7372\u5F97\u8C50\u539A\u734E\u52F5 "),g(),p(43,"li",58)(44,"span",59),m(45,"\u2713"),g(),m(46," \u88AB\u9080\u8ACB\u4EBA\u91CD\u8907\u4ED8\u8CBB\uFF1A10% \u8FD4\u50AD "),g()()(),p(47,"div",60)(48,"h4",17),m(49,"\u{1F39F}\uFE0F \u4F7F\u7528\u9080\u8ACB\u78BC"),g(),p(50,"div",61)(51,"input",62),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.inviteCodeInput,o)||(s.inviteCodeInput=o),S(o)}),g(),p(52,"button",63),D("click",function(){b(t);let o=_(2);return S(o.applyInviteCode())}),m(53," \u4F7F\u7528 "),g()()()()}if(n&2){let t,i,o,s=_(2);h(13),k(" ",(t=s.membershipService.membership())==null?null:t.inviteCode," "),h(6),R(((i=s.membershipService.membership())==null?null:i.inviteCount)||0),h(5),k("",((o=s.membershipService.membership())==null?null:o.inviteRewards)||0,"\u5929"),h(27),_e("ngModel",s.inviteCodeInput)}}function H_(n,e){if(n&1){let t=F();p(0,"div",1),D("click",function(){b(t);let o=_();return S(o.close())}),p(1,"div",2),D("click",function(o){return b(t),S(o.stopPropagation())}),p(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),m(6,"\u{1F680} \u5347\u7D1A\u60A8\u7684 TG-AI\u667A\u63A7\u738B"),g(),p(7,"p",6),m(8,"\u89E3\u9396\u66F4\u591A\u529F\u80FD\uFF0C\u63D0\u5347\u71DF\u92B7\u6548\u7387"),g()(),p(9,"button",7),D("click",function(){b(t);let o=_();return S(o.close())}),j(),p(10,"svg",8),q(11,"path",9),g()()(),ce(),p(12,"div",10)(13,"button",11),D("click",function(){b(t);let o=_();return S(o.activeTab.set("plans"))}),m(14," \u6703\u54E1\u65B9\u6848 "),g(),p(15,"button",11),D("click",function(){b(t);let o=_();return S(o.activeTab.set("activate"))}),m(16," \u6FC0\u6D3B\u5361\u5BC6 "),g(),p(17,"button",11),D("click",function(){b(t);let o=_();return S(o.activeTab.set("invite"))}),m(18," \u9080\u8ACB\u734E\u52F5 "),g()()(),p(19,"div",12),T(20,U_,13,0),T(21,q_,33,4,"div",13),T(22,$_,54,4,"div",13),g()()()}if(n&2){let t=_();h(13),V("text-white",t.activeTab()==="plans")("text-white/60",t.activeTab()!=="plans")("border-white",t.activeTab()==="plans")("border-transparent",t.activeTab()!=="plans"),h(2),V("text-white",t.activeTab()==="activate")("text-white/60",t.activeTab()!=="activate")("border-white",t.activeTab()==="activate")("border-transparent",t.activeTab()!=="activate"),h(2),V("text-white",t.activeTab()==="invite")("text-white/60",t.activeTab()!=="invite")("border-white",t.activeTab()==="invite")("border-transparent",t.activeTab()!=="invite"),h(3),A(t.activeTab()==="plans"?20:-1),h(),A(t.activeTab()==="activate"?21:-1),h(),A(t.activeTab()==="invite"?22:-1)}}function K_(n,e){if(n&1&&(x(0,"li"),m(1),w()),n&2){let t=e.$implicit;h(),k("\u2728 ",t)}}function W_(n,e){if(n&1){let t=F();x(0,"div",0)(1,"button",1),U("click",function(){b(t);let o=_();return S(o.dismiss())}),j(),x(2,"svg",2),Ee(3,"path",3),w()(),ce(),x(4,"div",4)(5,"div",5),m(6,"\u26A1"),w(),x(7,"div",6)(8,"h4",7),m(9),w(),x(10,"p",8),m(11),w(),x(12,"ul",9),X(13,K_,2,1,"li",null,ht),w(),x(15,"button",10),U("click",function(){b(t);let o=_();return S(o.upgrade())}),m(16),w()()()()}if(n&2){let t=_();h(9),R(t.message),h(2),k(" \u5347\u7D1A\u5230 ",t.nextLevelName," \u7372\u5F97\u66F4\u591A\u914D\u984D "),h(2),Z(t.suggestion.benefits.slice(0,3)),h(3),k(" \u7ACB\u5373\u5347\u7D1A ",t.suggestion.price," USDT/\u6708 ")}}var Hc=class n{constructor(){this.membershipService=O(mt);this.showDetails=!1;this.badgeClass=G(()=>this.membershipService.level());this.usage=G(()=>this.membershipService.usage());this.usagePercent=G(()=>this.membershipService.getUsagePercentage())}quotaText(e){let t=this.membershipService.quotas(),i=e==="messages"?t.dailyMessages:t.dailyAiCalls;return i===-1?"\u221E":i.toString()}openActivate(){this.showDetails=!1,window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-membership-badge"]],decls:7,vars:6,consts:[[1,"membership-badge","flex","items-center","gap-2","px-3","py-1.5","rounded-full","cursor-pointer","hover:opacity-80","transition-opacity",3,"click"],[1,"text-lg"],[1,"text-sm","font-medium"],[1,"text-xs","bg-red-500/50","px-1.5","py-0.5","rounded"],[1,"absolute","top-full","right-0","mt-2","w-72","bg-slate-800","rounded-lg","shadow-xl","border","border-slate-600","p-4","z-50"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-2xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-300","mb-3"],[1,"space-y-2","mb-4"],[1,"flex","justify-between","text-xs","text-slate-400","mb-1"],[1,"w-full","bg-slate-700","rounded-full","h-1.5"],[1,"bg-cyan-500","h-1.5","rounded-full","transition-all"],[1,"bg-purple-500","h-1.5","rounded-full","transition-all"],[1,"flex","gap-2"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","text-sm","py-2","rounded-lg","hover:opacity-90",3,"click"],[1,"px-3","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-red-400"]],template:function(t,i){t&1&&(x(0,"div",0),U("click",function(){return i.showDetails=!i.showDetails}),x(1,"span",1),m(2),w(),x(3,"span",2),m(4),w(),T(5,D_,2,1,"span",3),w(),T(6,P_,30,12,"div",4)),t&2&&(Ae(i.badgeClass()),h(2),R(i.membershipService.levelIcon()),h(2),R(i.membershipService.levelName()),h(),A(i.membershipService.daysRemaining()>0&&i.membershipService.daysRemaining()<=7?5:-1),h(),A(i.showDetails?6:-1))},dependencies:[de,Fn],styles:["[_nghost-%COMP%]{position:relative;display:inline-block}.membership-badge.bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}.membership-badge.silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,silver,#a8a8a8);color:#1f2937}.membership-badge.gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:#1f2937}.membership-badge.diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b9f2ff,#87ceeb);color:#1f2937}.membership-badge.star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}.membership-badge.king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}"]})}},ro=class n{constructor(){this.membershipService=O(mt);this.toastService=O(Ne);this.show=v(!1);this.activeTab=v("plans");this.isActivating=v(!1);this.licenseKey="";this.email="";this.inviteCodeInput="";this.plans=this.membershipService.getPricingPlans();this.Math=Math;window.addEventListener("open-membership-dialog",()=>{this.show.set(!0)})}close(){this.show.set(!1)}selectPlan(e){e.level!=="bronze"&&(this.activeTab.set("activate"),this.toastService.info(`\u8ACB\u8CFC\u8CB7 ${e.name} \u5361\u5BC6\u5F8C\u5728\u6B64\u6FC0\u6D3B`))}async activateLicense(){if(!this.licenseKey.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u5361\u5BC6");return}this.isActivating.set(!0);try{let e=await this.membershipService.activateMembership(this.licenseKey.trim(),this.email.trim());e.success?(this.toastService.success(e.message,5e3),this.licenseKey="",this.email="",this.close()):this.toastService.error(e.message)}catch{this.toastService.error("\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isActivating.set(!1)}}copyInviteCode(){let e=this.membershipService.membership()?.inviteCode;e&&(navigator.clipboard.writeText(e),this.toastService.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD"))}async applyInviteCode(){if(!this.inviteCodeInput.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u9080\u8ACB\u78BC");return}let e=await this.membershipService.applyInviteCode(this.inviteCodeInput.trim());e.success?(this.toastService.success(e.message,5e3),this.inviteCodeInput=""):this.toastService.error(e.message)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-membership-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-600","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","gap-4","mt-4"],[1,"font-medium","pb-2","border-b-2","transition-colors",3,"click"],[1,"p-6","overflow-y-auto","max-h-[60vh]"],[1,"max-w-md","mx-auto"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"relative","rounded-xl","border-2","p-4","transition-all",3,"border-cyan-500","border-slate-600","bg-slate-700/50","bg-slate-800"],[1,"mt-6","p-4","bg-slate-700/50","rounded-lg"],[1,"font-medium","text-white","mb-2"],[1,"text-sm","text-slate-300"],[1,"flex","gap-4","mt-3"],["href","#",1,"text-sm","text-cyan-400","hover:underline"],[1,"relative","rounded-xl","border-2","p-4","transition-all"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-xs","px-3","py-1","rounded-full"],[1,"absolute","-top-3","right-2","bg-green-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center","mb-4"],[1,"text-3xl"],[1,"text-lg","font-bold","text-white","mt-2"],[1,"mt-2"],[1,"text-2xl","font-bold","text-green-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"space-y-2","text-sm"],[1,"flex","items-start","gap-2","text-slate-300"],[1,"w-full","mt-4","py-2","rounded-lg","font-medium","transition-colors",3,"click","disabled"],[1,"text-slate-400"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4","text-green-400","mt-0.5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-center","mb-6"],[1,"text-4xl","mb-2"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","mt-1"],[1,"space-y-4"],[1,"block","text-sm","text-slate-300","mb-1"],["type","text","placeholder","TGAI-XX-XXXX-XXXX-XXXX",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none","uppercase","tracking-wider","font-mono",3,"ngModelChange","ngModel"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","font-bold","py-3","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","text-slate-400","space-y-1"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-600/20","rounded-xl","p-6","mb-6"],[1,"text-center"],[1,"text-sm","text-slate-400","mb-2"],[1,"text-3xl","font-mono","font-bold","text-white","tracking-widest","mb-3"],[1,"bg-white/10","hover:bg-white/20","text-white","px-4","py-2","rounded-lg","transition-colors",3,"click"],[1,"grid","grid-cols-2","gap-4","mb-6"],[1,"bg-slate-700/50","rounded-lg","p-4","text-center"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400"],[1,"bg-slate-700/50","rounded-lg","p-4"],[1,"font-medium","text-white","mb-3"],[1,"space-y-2","text-sm","text-slate-300"],[1,"flex","items-center","gap-2"],[1,"text-green-400"],[1,"mt-6","p-4","border","border-dashed","border-slate-600","rounded-lg"],[1,"flex","gap-2"],["type","text","placeholder","\u8F38\u5165\u597D\u53CB\u7684\u9080\u8ACB\u78BC",1,"flex-1","bg-slate-700","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm","uppercase",3,"ngModelChange","ngModel"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","px-4","py-2","rounded-lg","text-sm",3,"click"]],template:function(t,i){t&1&&T(0,H_,23,27,"div",0),t&2&&A(i.show()?0:-1)},dependencies:[de,Te,Le,Ve,Be],encapsulation:2})}},ao=class n{constructor(){this.membershipService=O(mt);this.show=!1;this.message="";this.suggestion=this.membershipService.getUpgradeSuggestion()}get nextLevelName(){return this.suggestion?.nextLevel?{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.suggestion.nextLevel]:""}showPrompt(e){this.message=e,this.suggestion=this.membershipService.getUpgradeSuggestion(),this.suggestion&&(this.show=!0)}dismiss(){this.show=!1}upgrade(){this.dismiss(),window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-upgrade-prompt"]],decls:1,vars:1,consts:[[1,"fixed","bottom-4","right-4","max-w-sm","bg-gradient-to-r","from-slate-800","to-slate-700","rounded-xl","shadow-2xl","border","border-slate-600","p-4","z-40","animate-slide-up"],[1,"absolute","top-2","right-2","text-slate-500","hover:text-white",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-start","gap-3"],[1,"text-3xl"],[1,"flex-1"],[1,"font-bold","text-white","mb-1"],[1,"text-sm","text-slate-300","mb-3"],[1,"text-xs","text-slate-400","space-y-1","mb-3"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-sm","font-medium","px-4","py-2","rounded-lg","hover:opacity-90",3,"click"]],template:function(t,i){t&1&&T(0,W_,17,3,"div",0),t&2&&A(i.show&&i.suggestion?0:-1)},dependencies:[de],styles:["@keyframes _ngcontent-%COMP%_slide-up{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.animate-slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-up .3s ease-out}"]})}};var Nr="TG-AI\u667A\u63A7\u738B-2026-Secure-Key",lo=class n{constructor(){this._isSecure=v(!0);this.isSecure=this._isSecure.asReadonly();this.initSecurityChecks()}initSecurityChecks(){this.isProduction()&&(this.detectDevTools(),this.preventContextMenu(),this.preventKeyboardShortcuts())}isProduction(){return!window.location.href.includes("localhost")&&!window.location.href.includes("127.0.0.1")}detectDevTools(){setInterval(()=>{let i=window.outerWidth-window.innerWidth>160,o=window.outerHeight-window.innerHeight>160;i||o?(this._isSecure.set(!1),console.clear(),console.log("%c\u26A0\uFE0F \u6AA2\u6E2C\u5230\u958B\u767C\u8005\u5DE5\u5177","color: red; font-size: 20px;")):this._isSecure.set(!0)},1e3),setInterval(()=>{let i=performance.now();performance.now()-i>100&&this._isSecure.set(!1)},5e3)}preventContextMenu(){document.addEventListener("contextmenu",e=>(e.preventDefault(),!1))}preventKeyboardShortcuts(){document.addEventListener("keydown",e=>e.key==="F12"||e.ctrlKey&&e.shiftKey&&e.key==="I"||e.ctrlKey&&e.shiftKey&&e.key==="J"||e.ctrlKey&&e.key==="u"?(e.preventDefault(),!1):!0)}encrypt(e){if(!e)return"";try{let t=btoa(unescape(encodeURIComponent(e)));return"ENC:"+this.shuffle(t,Nr)}catch(t){return console.error("Encryption failed:",t),e}}decrypt(e){if(!e)return"";if(!e.startsWith("ENC:"))return e;try{let t=e.substring(4),i=this.unshuffle(t,Nr);return decodeURIComponent(escape(atob(i)))}catch(t){return console.error("Decryption failed:",t),""}}shuffle(e,t){let o=t.split("").reduce((s,r)=>s+r.charCodeAt(0),0)%26;return e.split("").map(s=>{let r=s.charCodeAt(0);return r>=65&&r<=90?String.fromCharCode((r-65+o)%26+65):r>=97&&r<=122?String.fromCharCode((r-97+o)%26+97):s}).join("")}unshuffle(e,t){let o=t.split("").reduce((s,r)=>s+r.charCodeAt(0),0)%26;return e.split("").map(s=>{let r=s.charCodeAt(0);return r>=65&&r<=90?String.fromCharCode((r-65-o+26)%26+65):r>=97&&r<=122?String.fromCharCode((r-97-o+26)%26+97):s}).join("")}secureStore(e,t){let i=this.encrypt(JSON.stringify(t));localStorage.setItem(e,i)}secureRetrieve(e,t){let i=localStorage.getItem(e);if(!i)return t;try{let o=this.decrypt(i);return JSON.parse(o)}catch{return t}}secureRemove(e){localStorage.removeItem(e)}storeApiKey(e,t){this.secureStore(`api_${e}`,t)}getApiKey(e){return this.secureRetrieve(`api_${e}`,"")}removeApiKey(e){this.secureRemove(`api_${e}`)}generateFingerprint(){let t=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||"unknown",navigator.deviceMemory||"unknown"].join("|");return this.hashString(t)}hashString(e){let t=0;for(let i=0;i<e.length;i++){let o=e.charCodeAt(i);t=(t<<5)-t+o,t=t&t}return"fp-"+Math.abs(t).toString(16)}signRequest(e,t){let i=JSON.stringify(e)+t+Nr;return this.hashString(i)}verifySignature(e,t,i){let o=Date.now();return Math.abs(o-t)>300*1e3?!1:this.signRequest(e,t)===i}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var z_={LCP:{good:2500,poor:4e3},FID:{good:100,poor:300},CLS:{good:.1,poor:.25},FCP:{good:1800,poor:3e3},TTFB:{good:800,poor:1800},INP:{good:200,poor:500}},co=class n{constructor(){this.observers=[];this.metrics=[];this.reported=!1;this.reportTimeout=null;typeof window<"u"&&typeof PerformanceObserver<"u"&&(this.initObservers(),this.scheduleReport())}ngOnDestroy(){this.observers.forEach(e=>{try{e.disconnect()}catch{}}),this.reportTimeout&&clearTimeout(this.reportTimeout)}initObservers(){this.observe("largest-contentful-paint",i=>{let o=i[i.length-1];o&&this.recordMetric("LCP",o.startTime)}),this.observe("first-input",i=>{let o=i[0];if(o){let s=o.processingStart-o.startTime;this.recordMetric("FID",s)}});let e=0,t=[];this.observe("layout-shift",i=>{for(let o of i){let s=o;s.hadRecentInput||(e+=s.value,t.push(o))}this.recordMetric("CLS",e)}),this.observe("paint",i=>{for(let o of i)o.name==="first-contentful-paint"&&this.recordMetric("FCP",o.startTime)}),this.observe("navigation",i=>{let o=i[0];if(o){let s=o.responseStart-o.requestStart;this.recordMetric("TTFB",s)}}),this.observe("event",i=>{let o=0;for(let s of i){let r=s;r.duration>o&&(o=r.duration)}o>0&&this.recordMetric("INP",o)},{durationThreshold:40})}observe(e,t,i){try{if(!PerformanceObserver.supportedEntryTypes?.includes(e))return;let o=new PerformanceObserver(r=>{t(r.getEntries())}),s=M({type:e,buffered:!0},i);o.observe(s),this.observers.push(o)}catch{}}recordMetric(e,t){let i=z_[e],o="good";i&&(t>i.poor?o="poor":t>i.good&&(o="needs-improvement"));let s=this.metrics.findIndex(l=>l.name===e),r={name:e,value:Math.round(t*100)/100,rating:o,timestamp:Date.now()};s>=0?this.metrics[s]=r:this.metrics.push(r)}scheduleReport(){document.readyState==="complete"?this.reportTimeout=setTimeout(()=>this.sendReport(),1e4):window.addEventListener("load",()=>{this.reportTimeout=setTimeout(()=>this.sendReport(),1e4)},{once:!0}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&!this.reported&&this.sendReport()})}sendReport(){if(this.reported||this.metrics.length===0)return;this.reported=!0;let e={metrics:[...this.metrics],navigation:this.getNavigationTiming(),url:window.location.pathname,userAgent:navigator.userAgent,connection:this.getConnectionInfo()},t=JSON.stringify(e);try{navigator.sendBeacon?navigator.sendBeacon("/api/v1/performance",t):fetch("/api/v1/performance",{method:"POST",body:t,headers:{"Content-Type":"application/json"},keepalive:!0}).catch(()=>{})}catch{}}getNavigationTiming(){try{let e=performance.getEntriesByType("navigation")[0];return e?{type:e.type,redirectCount:e.redirectCount,loadTime:Math.round(e.loadEventEnd-e.startTime),domContentLoaded:Math.round(e.domContentLoadedEventEnd-e.startTime),domInteractive:Math.round(e.domInteractive-e.startTime)}:null}catch{return null}}getConnectionInfo(){try{let e=navigator.connection;return e?{effectiveType:e.effectiveType||"unknown",downlink:e.downlink||0,rtt:e.rtt||0}:void 0}catch{return}}getMetrics(){return[...this.metrics]}recordCustomMetric(e,t){this.recordMetric(e,t)}measureDuration(e){let t=performance.now();return()=>{let i=performance.now()-t;this.recordMetric(e,i)}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var J_="TgMatrixCache",Q_=1,wt="appState",gt="offlineOperations",Kc="2.1.1",Y_=1440*60*1e3,en=class n{constructor(e){this.ngZone=e;this.db=null;this.dbReady=!1;this.networkStatus=v("online");this.isOnline=G(()=>this.networkStatus()!=="offline");this.isPageVisible=v(!0);this.pendingOperations=v([]);this.hasPendingOperations=G(()=>this.pendingOperations().length>0);this.cachedState=v(null);this.isCacheValid=G(()=>{let e=this.cachedState();return!(!e||e.version!==Kc||Date.now()-e.lastUpdated>Y_)});this.initDatabase(),this.setupNetworkListener(),this.setupVisibilityListener()}async initDatabase(){return new Promise((e,t)=>{let i=indexedDB.open(J_,Q_);i.onerror=()=>{console.error("[OfflineCache] Failed to open IndexedDB:",i.error),t(i.error)},i.onsuccess=()=>{this.db=i.result,this.dbReady=!0,console.log("[OfflineCache] \u2705 IndexedDB initialized"),this.loadCachedState(),this.loadPendingOperations(),e()},i.onupgradeneeded=o=>{let s=o.target.result;s.objectStoreNames.contains(wt)||(s.createObjectStore(wt,{keyPath:"id"}),console.log("[OfflineCache] Created state store")),s.objectStoreNames.contains(gt)||(s.createObjectStore(gt,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),console.log("[OfflineCache] Created operations store"))}})}setupNetworkListener(){if(window.addEventListener("online",()=>{this.ngZone.run(()=>{console.log("[OfflineCache] \u{1F310} Network online"),this.networkStatus.set("online"),this.syncPendingOperations()})}),window.addEventListener("offline",()=>{this.ngZone.run(()=>{console.log("[OfflineCache] \u{1F4F4} Network offline"),this.networkStatus.set("offline")})}),this.networkStatus.set(navigator.onLine?"online":"offline"),"connection"in navigator){let e=navigator.connection;e&&e.addEventListener("change",()=>{this.ngZone.run(()=>{let t=e.effectiveType;t==="slow-2g"||t==="2g"?this.networkStatus.set("slow"):navigator.onLine&&this.networkStatus.set("online")})})}}setupVisibilityListener(){document.addEventListener("visibilitychange",()=>{this.ngZone.run(()=>{let e=document.visibilityState==="visible";console.log(`[OfflineCache] \u{1F441}\uFE0F Page visibility: ${e?"visible":"hidden"}`),this.isPageVisible.set(e),e&&this.isOnline()&&window.dispatchEvent(new CustomEvent("page-became-visible"))})})}async cacheState(e){if(!this.dbReady||!this.db){console.warn("[OfflineCache] Database not ready");return}let t={accounts:e.accounts||[],keywordSets:e.keywordSets||[],monitoredGroups:e.monitoredGroups||[],campaigns:e.campaigns||[],leads:e.leads||[],settings:e.settings||{},lastUpdated:Date.now(),version:Kc};try{let o=this.db.transaction([wt],"readwrite").objectStore(wt);await new Promise((s,r)=>{let l=o.put(M({id:"main"},t));l.onsuccess=()=>s(),l.onerror=()=>r(l.error)}),this.cachedState.set(t),console.log("[OfflineCache] \u2705 State cached")}catch(i){console.error("[OfflineCache] Failed to cache state:",i)}}async loadCachedState(){if(!this.dbReady||!this.db)return null;try{let i=this.db.transaction([wt],"readonly").objectStore(wt),o=await new Promise((s,r)=>{let l=i.get("main");l.onsuccess=()=>s(l.result),l.onerror=()=>r(l.error)});if(o){let e=o,{id:s}=e,r=Lt(e,["id"]);return this.cachedState.set(r),console.log("[OfflineCache] \u2705 Loaded cached state from",new Date(r.lastUpdated).toLocaleString()),r}return null}catch(t){return console.error("[OfflineCache] Failed to load cached state:",t),null}}async addOfflineOperation(e,t){if(!this.dbReady||!this.db){console.warn("[OfflineCache] Database not ready, operation not queued");return}let i={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,command:e,payload:t,timestamp:Date.now(),retryCount:0};try{let s=this.db.transaction([gt],"readwrite").objectStore(gt);await new Promise((r,l)=>{let d=s.put(i);d.onsuccess=()=>r(),d.onerror=()=>l(d.error)}),this.pendingOperations.update(r=>[...r,i]),console.log("[OfflineCache] \u2795 Queued offline operation:",e)}catch(o){console.error("[OfflineCache] Failed to queue operation:",o)}}async loadPendingOperations(){if(!(!this.dbReady||!this.db))try{let t=this.db.transaction([gt],"readonly").objectStore(gt),i=await new Promise((o,s)=>{let r=t.getAll();r.onsuccess=()=>o(r.result||[]),r.onerror=()=>s(r.error)});this.pendingOperations.set(i),i.length>0&&console.log("[OfflineCache] \u{1F4CB} Loaded",i.length,"pending operations")}catch(e){console.error("[OfflineCache] Failed to load pending operations:",e)}}async syncPendingOperations(){let e=this.pendingOperations();e.length!==0&&(console.log("[OfflineCache] \u{1F504} Syncing",e.length,"pending operations"),window.dispatchEvent(new CustomEvent("sync-offline-operations",{detail:{operations:e}})))}async removeOperation(e){if(!(!this.dbReady||!this.db))try{let i=this.db.transaction([gt],"readwrite").objectStore(gt);await new Promise((o,s)=>{let r=i.delete(e);r.onsuccess=()=>o(),r.onerror=()=>s(r.error)}),this.pendingOperations.update(o=>o.filter(s=>s.id!==e)),console.log("[OfflineCache] \u2705 Removed operation:",e)}catch(t){console.error("[OfflineCache] Failed to remove operation:",t)}}async clearCache(){if(!(!this.dbReady||!this.db))try{let e=this.db.transaction([wt,gt],"readwrite");await Promise.all([new Promise((t,i)=>{let o=e.objectStore(wt).clear();o.onsuccess=()=>t(),o.onerror=()=>i(o.error)}),new Promise((t,i)=>{let o=e.objectStore(gt).clear();o.onsuccess=()=>t(),o.onerror=()=>i(o.error)})]),this.cachedState.set(null),this.pendingOperations.set([]),console.log("[OfflineCache] \u{1F5D1}\uFE0F Cache cleared")}catch(e){console.error("[OfflineCache] Failed to clear cache:",e)}}getCacheStats(){let e=this.cachedState();return{stateAge:e?Date.now()-e.lastUpdated:-1,pendingCount:this.pendingOperations().length,isValid:this.isCacheValid()}}static{this.\u0275fac=function(t){return new(t||n)(it(je))}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var Tn=new Set,uo=null;function X_(n){Jo()&&(Tn.has(n)||(Tn.add(n),uo&&clearTimeout(uo),uo=setTimeout(()=>{Tn.size>0&&console.warn(`[i18n] ${Tn.size} missing translation key(s):`,Array.from(Tn).sort().join(", ")),uo=null},2e3)))}var tn=class n{constructor(){this.i18n=O(et)}transform(e,t){if(!e)return"";let i=this.i18n.t(e,t);return i===e&&Jo()&&X_(e),i}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275pipe=Xr({name:"i18n",type:n,pure:!1})}};var Wc=n=>({count:n});function Z_(n,e){if(n&1&&(m(0),Me(1,"i18n")),n&2){let t=_(3);k(" \xB7 ",At(1,1,"offline.pendingSync",zo(4,Wc,t.pendingCount()))," ")}}function j_(n,e){if(n&1&&(x(0,"span",3),m(1,"\u{1F4F4}"),w(),x(2,"span",4),m(3),Me(4,"i18n"),T(5,Z_,2,6),w()),n&2){let t=_(2);h(3),k(" ",He(4,2,"offline.networkOffline")," "),h(2),A(t.pendingCount()>0?5:-1)}}function ev(n,e){n&1&&(x(0,"span",3),m(1,"\u{1F40C}"),w(),x(2,"span",4),m(3),Me(4,"i18n"),w()),n&2&&(h(3),R(He(4,1,"offline.slowNetwork")))}function tv(n,e){if(n&1&&(x(0,"span",5),m(1,"\u{1F504}"),w(),x(2,"span",4),m(3),Me(4,"i18n"),w()),n&2){let t=_(2);h(3),R(At(4,1,"offline.syncing",zo(4,Wc,t.pendingCount())))}}function nv(n,e){if(n&1&&(x(0,"div",1)(1,"div",2),T(2,j_,6,4),T(3,ev,5,3),T(4,tv,5,6),w()()),n&2){let t=_();Ae(t.barClass()),h(2),A(t.status()==="offline"?2:-1),h(),A(t.status()==="slow"?3:-1),h(),A(t.status()==="online"&&t.pendingCount()>0?4:-1)}}var mo=class n{constructor(){this.offlineCache=O(en);this.status=G(()=>this.offlineCache.networkStatus());this.pendingCount=G(()=>this.offlineCache.pendingOperations().length);this.shouldShow=G(()=>{let e=this.status(),t=this.pendingCount();return e==="offline"||e==="slow"||e==="online"&&t>0});this.barClass=G(()=>{let e=this.status(),t=this.pendingCount();return e==="offline"?"bar-offline":e==="slow"?"bar-slow":e==="online"&&t>0?"bar-syncing":""})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-offline-indicator"]],decls:1,vars:1,consts:[["role","alert","aria-live","assertive",1,"offline-bar",3,"class"],["role","alert","aria-live","assertive",1,"offline-bar"],[1,"offline-content"],[1,"offline-icon"],[1,"offline-text"],[1,"offline-icon","sync-spin"]],template:function(t,i){t&1&&T(0,nv,5,5,"div",0),t&2&&A(i.shouldShow()?0:-1)},dependencies:[de,tn],styles:[".offline-bar[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;z-index:9999;padding:8px 16px;font-size:13px;font-weight:500;transition:all .3s ease;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.offline-bar.bar-offline[_ngcontent-%COMP%]{background:#eab308f2;color:#92400e}.offline-bar.bar-slow[_ngcontent-%COMP%]{background:#f97316e6;color:#7c2d12}.offline-bar.bar-syncing[_ngcontent-%COMP%]{background:#22c55ee6;color:#14532d}.offline-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.offline-icon[_ngcontent-%COMP%]{font-size:16px}.sync-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})}};var zc={default:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdHWAgoOBgX98fX19e3t7e3t7e3t7e3t7e3t7e3t7fHx9fX5+f4CAgoKDhIWFhYWEg4KBgH9+fXx7enp5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl6enp7e3x8fX1+fn9/gICBgYKCg4ODhISEhISEg4OCgoGBgH9/fn59fXx8e3t7e3t7e3t7e3t7e3t7e3t7fHx9fX5+f4CAgoKDhIWFhYWEg4KBgH9+fXx7enp5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl6enp7e3x8fX1+fn9/gICBgYKCg4ODhISEhISEg4OCgoGBgH9/fn59fXx8e3t7e3t7e3t7e3t7e3t7e3t7",success:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAABhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=",warning:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACAgICAgICAgICAgH9/f39/f39/f39/f39/f4CAgICAgIGBgYGBgYGBgYGBgYGBgYCAgICAgH9/f39/f39/f39/f39/f39/gICAgICAgYGBgYGBgYGBgYGBgYGBgICAgICAf39/f39/f39/f39/f39/f3+AgICAgICBgYGBgYGBgYGBgYGBgYGAgICAgIB/f39/f39/f39/f39/f39/f4CAgICAgIGBgYGBgYGBgYGBgYGBgYCAgICAf39/f39/f39/f39/f39/f39/gICAgICAgYGBgYGBgYGBgYGBgYGBgICAgICA",error:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAAD/////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA",lead:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAABVVldYWVpbXF1eX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=",message:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAABgYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7//w=="},Jc={enabled:!0,desktop:!0,sound:!0,soundVolume:.5,doNotDisturb:!1,doNotDisturbSchedule:{enabled:!1,startTime:"22:00",endTime:"08:00"},priorities:{low:{enabled:!0,sound:!1,desktop:!1},normal:{enabled:!0,sound:!0,desktop:!0},high:{enabled:!0,sound:!0,desktop:!0},urgent:{enabled:!0,sound:!0,desktop:!0}},types:{info:{enabled:!0,sound:"default"},success:{enabled:!0,sound:"success"},warning:{enabled:!0,sound:"warning"},error:{enabled:!0,sound:"error"},lead:{enabled:!0,sound:"lead"},message:{enabled:!0,sound:"message"},system:{enabled:!0,sound:"default"}}},nn=class n{constructor(){this._notifications=v([]);this.notifications=this._notifications.asReadonly();this._settings=v(Jc);this.settings=this._settings.asReadonly();this.unreadCount=G(()=>this._notifications().filter(e=>!e.read).length);this.unreadByPriority=G(()=>{let e=this._notifications().filter(t=>!t.read);return{urgent:e.filter(t=>t.priority==="urgent").length,high:e.filter(t=>t.priority==="high").length,normal:e.filter(t=>t.priority==="normal").length,low:e.filter(t=>t.priority==="low").length}});this._desktopPermission=v("default");this.desktopPermission=this._desktopPermission.asReadonly();this.loadSettings(),this.loadNotifications(),this.checkDesktopPermission()}notify(e){let t={id:"notif-"+Date.now().toString(36)+Math.random().toString(36).substr(2,5),type:e.type||"info",priority:e.priority||"normal",title:e.title,body:e.body,icon:e.icon||this.getDefaultIcon(e.type||"info"),timestamp:new Date,read:!1,data:e.data,actions:e.actions,sound:e.sound??!0,desktop:e.desktop??!0,persistent:e.persistent??!1};return this.shouldNotify(t)?(this.addToHistory(t),t.sound&&this._settings().sound&&this.playSound(t.type),t.desktop&&this._settings().desktop&&this.showDesktopNotification(t),t):(this.addToHistory(t),t)}info(e,t,i){return this.notify(N(M({},i),{type:"info",title:e,body:t}))}success(e,t,i){return this.notify(N(M({},i),{type:"success",title:e,body:t}))}warning(e,t,i){return this.notify(N(M({},i),{type:"warning",priority:"high",title:e,body:t}))}error(e,t,i){return this.notify(N(M({},i),{type:"error",priority:"urgent",title:e,body:t}))}lead(e,t,i){return this.notify(N(M({},i),{type:"lead",priority:"high",title:"\u{1F3AF} \u65B0\u6F5B\u5728\u5BA2\u6236",body:`${e} \u4F86\u81EA ${t}`,icon:"\u{1F3AF}"}))}message(e,t,i){return this.notify(N(M({},i),{type:"message",title:`\u{1F4AC} ${e}`,body:t.length>100?t.substring(0,100)+"...":t,icon:"\u{1F4AC}"}))}markAsRead(e){this._notifications.update(t=>t.map(i=>i.id===e?N(M({},i),{read:!0}):i)),this.saveNotifications()}markAllAsRead(){this._notifications.update(e=>e.map(t=>N(M({},t),{read:!0}))),this.saveNotifications()}remove(e){this._notifications.update(t=>t.filter(i=>i.id!==e)),this.saveNotifications()}clearAll(){this._notifications.set([]),this.saveNotifications()}clearRead(){this._notifications.update(e=>e.filter(t=>!t.read)),this.saveNotifications()}updateSettings(e){this._settings.update(t=>M(M({},t),e)),this.saveSettings()}toggleDoNotDisturb(){this._settings.update(e=>N(M({},e),{doNotDisturb:!e.doNotDisturb})),this.saveSettings()}async requestDesktopPermission(){if(!("Notification"in window))return!1;let e=await Notification.requestPermission();return this._desktopPermission.set(e),e==="granted"}addToHistory(e){this._notifications.update(t=>[e,...t].slice(0,100)),this.saveNotifications()}shouldNotify(e){let t=this._settings();return!(!t.enabled||t.doNotDisturb&&e.priority!=="urgent"||t.doNotDisturbSchedule?.enabled&&this.isInDoNotDisturbTime()&&e.priority!=="urgent"||!t.priorities[e.priority].enabled||!t.types[e.type].enabled)}isInDoNotDisturbTime(){let e=this._settings().doNotDisturbSchedule;if(!e?.enabled)return!1;let t=new Date,i=t.getHours()*60+t.getMinutes(),[o,s]=e.startTime.split(":").map(Number),[r,l]=e.endTime.split(":").map(Number),d=o*60+s,u=r*60+l;return d<u?i>=d&&i<u:i>=d||i<u}playSound(e){let t=this._settings(),i=t.types[e]?.sound||"default",o=zc[i]||zc.default;try{let s=new Audio(o);s.volume=t.soundVolume,s.play().catch(r=>console.warn("Failed to play notification sound:",r))}catch(s){console.warn("Failed to create audio:",s)}}showDesktopNotification(e){if("Notification"in window&&Notification.permission==="granted")try{let t=new Notification(e.title,{body:e.body,icon:e.icon,tag:e.id,requireInteraction:e.persistent});t.onclick=()=>{window.focus(),this.markAsRead(e.id),t.close()},e.persistent||setTimeout(()=>t.close(),5e3)}catch(t){console.warn("Failed to show desktop notification:",t)}}getDefaultIcon(e){return{info:"\u2139\uFE0F",success:"\u2705",warning:"\u26A0\uFE0F",error:"\u274C",lead:"\u{1F3AF}",message:"\u{1F4AC}",system:"\u2699\uFE0F"}[e]}checkDesktopPermission(){"Notification"in window&&this._desktopPermission.set(Notification.permission)}loadSettings(){try{let e=localStorage.getItem("tg-matrix-notification-settings");e&&this._settings.set(M(M({},Jc),JSON.parse(e)))}catch(e){console.error("Failed to load notification settings:",e)}}saveSettings(){try{localStorage.setItem("tg-matrix-notification-settings",JSON.stringify(this._settings()))}catch(e){console.error("Failed to save notification settings:",e)}}loadNotifications(){try{let e=localStorage.getItem("tg-matrix-notifications");if(e){let t=JSON.parse(e).map(i=>N(M({},i),{timestamp:new Date(i.timestamp)}));this._notifications.set(t)}}catch(e){console.error("Failed to load notifications:",e)}}saveNotifications(){try{localStorage.setItem("tg-matrix-notifications",JSON.stringify(this._notifications()))}catch(e){console.error("Failed to save notifications:",e)}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var on=class n{constructor(){this._isOnline=v(navigator.onLine);this._status=v(navigator.onLine?"online":"offline");this._lastOfflineTime=v(null);this._networkEvents=new Mn;this.isOnline=G(()=>this._isOnline());this.status=G(()=>this._status());this.isOffline=G(()=>!this._isOnline());this.networkEvents$=this._networkEvents.asObservable();this.online$=$r(qo(window,"online").pipe(Uo(()=>!0)),qo(window,"offline").pipe(Uo(()=>!1))).pipe(Kr(navigator.onLine),Hr()),this.online$.subscribe(e=>{if(this._isOnline.set(e),this._status.set(e?"online":"offline"),!e)this._lastOfflineTime.set(Date.now()),this._networkEvents.next({status:"offline",timestamp:Date.now(),message:"\u7DB2\u7D61\u9023\u63A5\u5DF2\u65B7\u958B"}),console.warn("[NetworkService] Network offline");else{let t=this._lastOfflineTime()?Math.round((Date.now()-this._lastOfflineTime())/1e3):0;this._networkEvents.next({status:"online",timestamp:Date.now(),message:t>0?`\u7DB2\u7D61\u5DF2\u6062\u5FA9\uFF08\u96E2\u7DDA ${t} \u79D2\uFF09`:"\u7DB2\u7D61\u5DF2\u9023\u63A5"}),console.log("[NetworkService] Network online")}}),this.checkNetworkSpeed()}ngOnDestroy(){this._networkEvents.complete()}checkNetworkSpeed(){let e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e&&e.addEventListener("change",()=>{let t=e.effectiveType;["slow-2g","2g"].includes(t)?(this._status.set("slow"),this._networkEvents.next({status:"slow",timestamp:Date.now(),message:"\u7DB2\u7D61\u9023\u63A5\u8F03\u6162\uFF0C\u90E8\u5206\u529F\u80FD\u53EF\u80FD\u5EF6\u9072"})):this._status()==="slow"&&this._isOnline()&&this._status.set("online")})}async checkConnection(){try{let t=(await fetch("/api/health",{method:"HEAD",cache:"no-store"})).ok;return this._isOnline.set(t),this._status.set(t?"online":"offline"),t}catch{return this._isOnline.set(!1),this._status.set("offline"),!1}}getStatusMessage(){switch(this._status()){case"online":return"\u7DB2\u7D61\u9023\u63A5\u6B63\u5E38";case"offline":return"\u7DB2\u7D61\u5DF2\u65B7\u958B\uFF0C\u8ACB\u6AA2\u67E5\u60A8\u7684\u7DB2\u7D61\u9023\u63A5";case"slow":return"\u7DB2\u7D61\u9023\u63A5\u8F03\u6162\uFF0C\u8ACB\u8010\u5FC3\u7B49\u5F85";default:return""}}getStatusIcon(){switch(this._status()){case"online":return"\u{1F7E2}";case"offline":return"\u{1F534}";case"slow":return"\u{1F7E1}";default:return""}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var po=class n{constructor(){this.authService=O(Kn);this.networkService=O(on);this.authEvents=O(Hn);this.ws=null;this.reconnectTimer=null;this.heartbeatTimer=null;this.networkSubscription=null;this.authSubscription=null;this.HEARTBEAT_INTERVAL=3e4;this.RECONNECT_DELAY=3e3;this.MAX_RECONNECT_ATTEMPTS=10;this._isConnected=v(!1);this._reconnectAttempts=v(0);this._connectionId=v("");this.isConnected=G(()=>this._isConnected());this.connectionId=G(()=>this._connectionId());this.handlers=new Map;this.offlineQueue=[];this.subscriptions=new Set;Yo.apiMode==="http"&&(this.initConnectionWatcher(),this.initNetworkWatcher(),this.initAuthWatcher())}ngOnDestroy(){this.disconnect(),this.networkSubscription?.unsubscribe(),this.authSubscription?.unsubscribe()}initConnectionWatcher(){let e=()=>{this.authService.isAuthenticated()&&!this._isConnected()?this.connect():!this.authService.isAuthenticated()&&this._isConnected()&&this.disconnect()};setInterval(e,5e3),setTimeout(e,1e3)}initNetworkWatcher(){this.networkSubscription=this.networkService.online$.subscribe(e=>{e&&this.authService.isAuthenticated()&&!this._isConnected()&&(console.log("[RealtimeService] Network restored, reconnecting WebSocket..."),this._reconnectAttempts.set(0),this.connect())})}initAuthWatcher(){this.authSubscription=this.authEvents.authEvents$.subscribe(e=>{e.type==="login"?(console.log("[RealtimeService] Login event, connecting WebSocket..."),setTimeout(()=>this.connect(),500)):e.type==="logout"&&(console.log("[RealtimeService] Logout event, disconnecting WebSocket..."),this.disconnect())})}connect(){if(Yo.apiMode!=="ipc"&&this.ws?.readyState!==WebSocket.OPEN)try{let e=this.getWebSocketUrl(),t=this.authService.accessToken();if(!t){console.warn("No access token, skipping WebSocket connection");return}this.ws=new WebSocket(`${e}?token=${t}`),this.ws.onopen=()=>{console.log("WebSocket connected"),this._isConnected.set(!0),this._reconnectAttempts.set(0),this.startHeartbeat(),this.processOfflineQueue(),this.resubscribe()},this.ws.onmessage=i=>{this.handleMessage(i.data)},this.ws.onclose=i=>{console.log("WebSocket closed:",i.code,i.reason),this._isConnected.set(!1),this.stopHeartbeat(),this._reconnectAttempts()<this.MAX_RECONNECT_ATTEMPTS&&this.scheduleReconnect()},this.ws.onerror=i=>{console.error("WebSocket error:",i)}}catch(e){console.error("WebSocket connection error:",e)}}disconnect(){this.clearReconnectTimer(),this.stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=null),this._isConnected.set(!1)}send(e,t={}){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return!1;try{return this.ws.send(JSON.stringify({type:e,data:t})),!0}catch(i){return console.error("Send error:",i),!1}}subscribe(e){this.subscriptions.add(e),this._isConnected()?this.send("subscribe",{channel:e}):this.offlineQueue.push({channel:e,action:"subscribe"})}unsubscribe(e){this.subscriptions.delete(e),this._isConnected()?this.send("unsubscribe",{channel:e}):this.offlineQueue.push({channel:e,action:"unsubscribe"})}on(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{this.off(e,t)}}off(e,t){let i=this.handlers.get(e);i&&i.delete(t)}once(e,t){let i=o=>{t(o),this.off(e,i)};return this.on(e,i)}handleMessage(e){try{let t=JSON.parse(e);if(t.type==="connected"){this._connectionId.set(t.data?.connection_id||"");return}if(t.type==="pong")return;if(t.type==="ping"){this.send("pong");return}let i=this.handlers.get(t.type);i&&i.forEach(s=>{try{s(t)}catch(r){console.error("Event handler error:",r)}});let o=this.handlers.get("*");o&&o.forEach(s=>{try{s(t)}catch(r){console.error("Wildcard handler error:",r)}})}catch(t){console.error("Parse message error:",t)}}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=setInterval(()=>{this.send("ping")},this.HEARTBEAT_INTERVAL)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}scheduleReconnect(){this.clearReconnectTimer();let e=this._reconnectAttempts(),t=this.RECONNECT_DELAY*Math.pow(1.5,e);console.log(`Reconnecting in ${t}ms (attempt ${e+1})`),this.reconnectTimer=setTimeout(()=>{this._reconnectAttempts.update(i=>i+1),this.connect()},t)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}processOfflineQueue(){for(;this.offlineQueue.length>0;){let e=this.offlineQueue.shift();this.send(e.action,{channel:e.channel})}}resubscribe(){for(let e of this.subscriptions)this.send("subscribe",{channel:e})}getWebSocketUrl(){return window.location.hostname==="localhost"&&window.location.port==="4200"?"ws://localhost:8000/ws":`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var go=class n{constructor(){this.realtime=O(po);this.bizApi=O(zn);this.notifService=O(nn);this._notifications=v([]);this.notifications=this._notifications.asReadonly();this.unreadCount=G(()=>this._notifications().filter(e=>!e.read).length);this._lastEvent=v(null);this.lastEvent=this._lastEvent.asReadonly();this._queueStats=v({completed:0,retrying:0,deadLetter:0,lastUpdated:""});this.queueStats=this._queueStats.asReadonly();this.unsubscribers=[];this.initSubscriptions()}ngOnDestroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[]}initSubscriptions(){this.realtime.subscribe("business:event"),this.realtime.subscribe("lead:scoring"),this.realtime.subscribe("ab:test"),this.realtime.subscribe("message:status"),this.unsubscribers.push(this.realtime.on("business:event",e=>this.handleBusinessEvent(e)),this.realtime.on("lead:scoring",e=>this.handleScoringEvent(e)),this.realtime.on("ab:test",e=>this.handleABTestEvent(e)),this.realtime.on("message:status",e=>this.handleMessageStatus(e)))}handleBusinessEvent(e){this._lastEvent.set(e),(e.data?.event||"")==="dedup:completed"&&(this.addNotification("success","\u53BB\u91CD\u5B8C\u6210",`\u767C\u73FE ${e.data?.groups||0} \u7D44\u91CD\u8907\u806F\u7E6B\u4EBA`),this.bizApi.scanDuplicates())}handleScoringEvent(e){this._lastEvent.set(e);let t=e.data||{};this.addNotification("success","\u7DDA\u7D22\u8A55\u5206\u5B8C\u6210",`\u5DF2\u8A55\u5206 ${t.scored_count||0} \u689D\u7DDA\u7D22\uFF0C${t.hot||0} \u689D\u71B1\u9580`),this.bizApi.loadSummary()}handleABTestEvent(e){this._lastEvent.set(e);let t=e.data||{},i=t.event||"";i==="ab_test:completed"?(this.addNotification("success","A/B \u6E2C\u8A66\u5B8C\u6210",`${t.test_name||"N/A"} \u6E2C\u8A66\u5B8C\u6210\uFF0C\u8D0F\u5BB6: ${t.winner||"N/A"}`),this.bizApi.loadABTests()):i==="ab_test:created"&&(this.addNotification("info","\u65B0 A/B \u6E2C\u8A66",`\u5DF2\u5275\u5EFA\u6E2C\u8A66: ${t.test_name||"N/A"}`),this.bizApi.loadABTests())}handleMessageStatus(e){let t=e.data||{},i=t.event||"";this._queueStats.update(o=>{let s=N(M({},o),{lastUpdated:new Date().toISOString()});return i==="message:completed"?s.completed=o.completed+1:i==="message:retrying"?s.retrying=o.retrying+1:i==="message:dead_letter"&&(s.deadLetter=o.deadLetter+1,this.addNotification("warning","\u6D88\u606F\u9001\u9054\u5931\u6557",`\u6D88\u606F ${t.message_id||""} \u5DF2\u9032\u5165\u6B7B\u4FE1\u968A\u5217: ${t.reason||""}`)),s})}addNotification(e,t,i){let o={id:`n_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,type:e,title:t,message:i,timestamp:new Date,read:!1};this._notifications.update(r=>[o,...r].slice(0,50));let s={info:"info",success:"success",warning:"warning",error:"error"};try{this.notifService.notify({type:s[e]||"info",title:t,body:i,priority:e==="warning"||e==="error"?"high":"normal"})}catch{}}markAsRead(e){this._notifications.update(t=>t.map(i=>i.id===e?N(M({},i),{read:!0}):i))}markAllAsRead(){this._notifications.update(e=>e.map(t=>N(M({},t),{read:!0})))}clearNotifications(){this._notifications.set([])}resetQueueStats(){this._queueStats.set({completed:0,retrying:0,deadLetter:0,lastUpdated:""})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var Qc=(n,e)=>e.id;function iv(n,e){if(n&1&&(x(0,"span",3),m(1),w()),n&2){let t=_();h(),R(t.unreadCount()>99?"99+":t.unreadCount())}}function ov(n,e){if(n&1){let t=F();x(0,"button",15),Me(1,"i18n"),U("click",function(){b(t);let o=_(2);return S(o.markAllRead())}),m(2),Me(3,"i18n"),w()}n&2&&(Fe("title",He(1,2,"notification.markAllRead")),h(2),k(" \u2713 ",He(3,4,"notification.markAllRead")," "))}function sv(n,e){if(n&1){let t=F();x(0,"button",16),U("click",function(){b(t);let o=_(2);return S(o.clearAll())}),m(1," \u{1F5D1}\uFE0F "),w()}}function rv(n,e){if(n&1&&(x(0,"span",19),m(1),w()),n&2){let t=_(3);h(),k("\u{1F480} ",t.queueStats().deadLetter)}}function av(n,e){if(n&1&&(x(0,"div",10)(1,"span",17),m(2),w(),x(3,"span",18),m(4),w(),T(5,rv,2,1,"span",19),w()),n&2){let t=_(2);h(2),k("\u2705 ",t.queueStats().completed),h(2),k("\u{1F504} ",t.queueStats().retrying),h(),A(t.queueStats().deadLetter>0?5:-1)}}function lv(n,e){if(n&1&&(x(0,"span",21),m(1),w()),n&2){let t=_().$implicit,i=_(2);h(),R(i.getCountByType(t.id))}}function cv(n,e){if(n&1){let t=F();x(0,"button",20),U("click",function(){let o=b(t).$implicit,s=_(2);return S(s.activeFilter.set(o.id))}),m(1),T(2,lv,2,1,"span",21),w()}if(n&2){let t=e.$implicit,i=_(2);V("active",i.activeFilter()===t.id),cn("aria-selected",i.activeFilter()===t.id),h(),k(" ",t.label," "),h(),A(t.id!=="all"&&i.getCountByType(t.id)>0?2:-1)}}function dv(n,e){n&1&&(x(0,"div",14)(1,"span",22),m(2,"\u{1F4ED}"),w(),x(3,"p"),m(4),Me(5,"i18n"),w()()),n&2&&(h(4),R(He(5,1,"notification.empty")))}function uv(n,e){if(n&1){let t=F();x(0,"div",24),U("click",function(){let o=b(t).$implicit,s=_(3);return S(s.onNotifClick(o))}),x(1,"div",25),m(2),w(),x(3,"div",26)(4,"div",27),m(5),w(),x(6,"div",28),m(7),w(),x(8,"div",29),m(9),Me(10,"date"),w()(),x(11,"button",30),U("click",function(o){let s=b(t).$implicit,r=_(3);return S(r.dismiss(s.id,o))}),m(12," \xD7 "),w()()}if(n&2){let t=e.$implicit,i=_(3);V("unread",!t.read),h(2),R(i.getTypeIcon(t.type)),h(3),R(t.title),h(2),R(t.body),h(2),R(At(10,6,t.timestamp,"MM/dd HH:mm"))}}function mv(n,e){if(n&1&&X(0,uv,13,9,"div",23,Qc),n&2){let t=_(2);Z(t.filteredNotifications())}}function pv(n,e){if(n&1&&(x(0,"div",4)(1,"div",5)(2,"h3",6),m(3),Me(4,"i18n"),w(),x(5,"div",7),T(6,ov,4,6,"button",8),T(7,sv,2,0,"button",9),w()(),T(8,av,6,3,"div",10),x(9,"div",11),X(10,cv,3,5,"button",12,Qc),w(),x(12,"div",13),T(13,dv,6,3,"div",14)(14,mv,2,0),w()()),n&2){let t=_();h(3),R(He(4,5,"notification.center")),h(3),A(t.unreadCount()>0?6:-1),h(),A(t.filteredNotifications().length>0?7:-1),h(),A(t.queueStats().lastUpdated?8:-1),h(2),Z(t.filterTabs),h(3),A(t.filteredNotifications().length===0?13:14)}}var ho=class n{constructor(){this.notifService=O(nn);this.bizEvents=O(go);this.elementRef=O(Wr);this.isOpen=v(!1);this.activeFilter=v("all");this.unreadCount=G(()=>this.notifService.unreadCount());this.queueStats=this.bizEvents.queueStats;this.filterTabs=[{id:"all",label:"\u5168\u90E8"},{id:"system",label:"\u7CFB\u7D71"},{id:"warning",label:"\u544A\u8B66"},{id:"error",label:"\u932F\u8AA4"},{id:"lead",label:"\u6F5B\u5BA2"},{id:"success",label:"\u6210\u529F"}];this.filteredNotifications=G(()=>{let e=this.notifService.notifications(),t=this.activeFilter();return[...t==="all"?e:e.filter(o=>o.type===t)].sort((o,s)=>o.read!==s.read?o.read?1:-1:new Date(s.timestamp).getTime()-new Date(o.timestamp).getTime())})}onDocumentClick(e){this.isOpen()&&!this.elementRef.nativeElement.contains(e.target)&&this.isOpen.set(!1)}onEscPress(){this.isOpen.set(!1)}togglePanel(){this.isOpen.update(e=>!e)}markAllRead(){this.notifService.markAllAsRead()}clearAll(){this.notifService.clearAll()}dismiss(e,t){t.stopPropagation(),this.notifService.remove(e)}onNotifClick(e){e.read||this.notifService.markAsRead(e.id),e.actions?.length&&(e.actions[0].handler(),this.isOpen.set(!1))}getTypeIcon(e){return{info:"\u2139\uFE0F",success:"\u2705",warning:"\u26A0\uFE0F",error:"\u274C",lead:"\u{1F3AF}",message:"\u{1F4AC}",system:"\u{1F527}"}[e]||"\u{1F4CC}"}getCountByType(e){return e==="all"?this.notifService.notifications().length:this.notifService.notifications().filter(t=>t.type===e&&!t.read).length}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-notification-center"]],hostBindings:function(t,i){t&1&&D("click",function(s){return i.onDocumentClick(s)},Tt)("keydown.escape",function(){return i.onEscPress()},Tt)},decls:8,vars:9,consts:[["role","region","aria-label","\u901A\u77E5\u4E2D\u5FC3",1,"notification-center"],["aria-haspopup","true",1,"bell-btn",3,"click","title"],["aria-hidden","true",1,"bell-icon"],["aria-hidden","true",1,"badge"],["role","dialog","aria-label","\u901A\u77E5\u5217\u8868","tabindex","-1",1,"panel"],[1,"panel-header"],["id","notification-panel-title",1,"panel-title"],[1,"panel-actions"],[1,"action-btn",3,"title"],["title","\u6E05\u7A7A",1,"action-btn","danger"],[1,"queue-stats-bar"],["role","tablist","aria-label","\u901A\u77E5\u5206\u985E",1,"filter-tabs"],["role","tab",1,"filter-tab",3,"active"],["role","tabpanel","aria-label","\u901A\u77E5\u5217\u8868",1,"notification-list"],[1,"empty-state"],[1,"action-btn",3,"click","title"],["title","\u6E05\u7A7A",1,"action-btn","danger",3,"click"],[1,"qs-item","qs-ok"],[1,"qs-item","qs-retry"],[1,"qs-item","qs-dead"],["role","tab",1,"filter-tab",3,"click"],[1,"tab-count"],[1,"empty-icon"],[1,"notification-item",3,"unread"],[1,"notification-item",3,"click"],[1,"notif-icon"],[1,"notif-content"],[1,"notif-title"],[1,"notif-body"],[1,"notif-time"],["title","\u79FB\u9664",1,"notif-dismiss",3,"click"]],template:function(t,i){t&1&&(x(0,"div",0)(1,"button",1),Me(2,"i18n"),Me(3,"i18n"),U("click",function(){return i.togglePanel()}),x(4,"span",2),m(5,"\u{1F514}"),w(),T(6,iv,2,1,"span",3),w(),T(7,pv,15,7,"div",4),w()),t&2&&(h(),Fe("title",He(2,5,"notification.title")+" ("+i.unreadCount()+")"),cn("aria-expanded",i.isOpen())("aria-label",He(3,7,"notification.title")+", "+i.unreadCount()+" \u672A\u8B80"),h(5),A(i.unreadCount()>0?6:-1),h(),A(i.isOpen()?7:-1))},dependencies:[de,Fn,tn],styles:[".notification-center[_ngcontent-%COMP%]{position:relative}.bell-btn[_ngcontent-%COMP%]{position:relative;background:none;border:none;cursor:pointer;padding:6px 8px;border-radius:8px;transition:background .2s;font-size:18px}.bell-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.badge[_ngcontent-%COMP%]{position:absolute;top:0;right:0;min-width:18px;height:18px;background:#ef4444;color:#fff;font-size:10px;font-weight:700;border-radius:9px;display:flex;align-items:center;justify-content:center;padding:0 4px;line-height:1}.panel[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:380px;max-height:520px;background:var(--theme-surface, #1e293b);border:1px solid var(--theme-border, #334155);border-radius:12px;box-shadow:0 20px 60px #0006;z-index:10000;display:flex;flex-direction:column;overflow:hidden;animation:_ngcontent-%COMP%_slideDown .2s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 10px;border-bottom:1px solid var(--theme-border, #334155)}.panel-title[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:var(--theme-text, #e2e8f0);margin:0}.panel-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.action-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--theme-text-muted, #94a3b8);cursor:pointer;font-size:12px;padding:4px 8px;border-radius:6px;transition:all .15s}.action-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;color:var(--theme-text, #e2e8f0)}.action-btn.danger[_ngcontent-%COMP%]:hover{color:#ef4444}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:2px;padding:8px 12px;overflow-x:auto;border-bottom:1px solid var(--theme-border, #334155)}.filter-tab[_ngcontent-%COMP%]{background:none;border:none;color:var(--theme-text-muted, #94a3b8);cursor:pointer;font-size:12px;padding:4px 10px;border-radius:6px;white-space:nowrap;transition:all .15s;display:flex;align-items:center;gap:4px}.filter-tab[_ngcontent-%COMP%]:hover{background:#ffffff0f}.filter-tab.active[_ngcontent-%COMP%]{background:var(--theme-primary, #3b82f6);color:#fff}.tab-count[_ngcontent-%COMP%]{background:#fff3;border-radius:8px;padding:0 5px;font-size:10px;min-width:16px;text-align:center}.notification-list[_ngcontent-%COMP%]{overflow-y:auto;flex:1;max-height:380px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:var(--theme-text-muted, #94a3b8)}.empty-icon[_ngcontent-%COMP%]{font-size:32px;margin-bottom:8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.notification-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:10px;padding:12px 16px;border-bottom:1px solid var(--theme-border, rgba(255,255,255,.05));cursor:pointer;transition:background .15s;position:relative}.notification-item[_ngcontent-%COMP%]:hover{background:#ffffff0a}.notification-item.unread[_ngcontent-%COMP%]{background:#3b82f60f;border-left:3px solid var(--theme-primary, #3b82f6)}.notif-icon[_ngcontent-%COMP%]{font-size:20px;flex-shrink:0;margin-top:2px}.notif-content[_ngcontent-%COMP%]{flex:1;min-width:0}.notif-title[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:var(--theme-text, #e2e8f0);line-height:1.3}.notif-body[_ngcontent-%COMP%]{font-size:12px;color:var(--theme-text-muted, #94a3b8);margin-top:2px;line-height:1.4;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.notif-time[_ngcontent-%COMP%]{font-size:11px;color:var(--theme-text-muted, #64748b);margin-top:4px}.notif-dismiss[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;background:none;border:none;color:var(--theme-text-muted, #64748b);cursor:pointer;font-size:16px;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .15s}.notification-item[_ngcontent-%COMP%]:hover   .notif-dismiss[_ngcontent-%COMP%]{opacity:1}.notif-dismiss[_ngcontent-%COMP%]:hover{color:#ef4444;background:#ef44441a}.queue-stats-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:6px 16px;background:#0f172a80;border-bottom:1px solid var(--theme-border, #334155);font-size:11px}.qs-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:3px}.qs-ok[_ngcontent-%COMP%]{color:#22c55e}.qs-retry[_ngcontent-%COMP%]{color:#f59e0b}.qs-dead[_ngcontent-%COMP%]{color:#ef4444;font-weight:600}@media(max-width:480px){.panel[_ngcontent-%COMP%]{position:fixed;top:60px;left:8px;right:8px;width:auto;max-height:calc(100vh - 80px)}}"]})}};var Yc="tg-matrix-audit-log",Rr=500,gv=300*1e3,fo=class n{constructor(){this.ipc=O(Ie);this._entries=v([]);this.entries=this._entries.asReadonly();this.entryCount=G(()=>this._entries().length);this.reportTimer=null;this.pendingReport=[];this.loadFromStorage(),this.startPeriodicReport()}ngOnDestroy(){this.reportTimer&&clearInterval(this.reportTimer),this.flushReport()}track(e,t={},i="info"){let o={id:`audit_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,action:e,severity:i,timestamp:Date.now(),details:t,userId:this.getCurrentUserId()};this._entries.update(s=>{let r=[o,...s];return r.length>Rr?r.slice(0,Rr):r}),this.pendingReport.push(o),this.saveToStorage()}trackLogin(e){this.track("auth.login",{username:e})}trackLogout(){this.track("auth.logout",{})}trackAccountAdd(e,t){this.track("account.add",{accountId:e,phone:t})}trackAccountRemove(e){this.track("account.remove",{accountId:e})}trackViewChange(e,t){this.track("nav.view_change",{from:e,to:t},"info")}trackSettingsChange(e,t,i){this.track("settings.profile_update",{setting:e,oldValue:t,newValue:i})}trackError(e,t){this.track("system.error",M({error:e},t),"error")}trackQuotaExceeded(e,t,i){this.track("quota.exceeded",{quotaType:e,current:t,limit:i},"warning")}query(e={}){let t=this._entries();return e.action&&(t=t.filter(i=>i.action===e.action)),e.severity&&(t=t.filter(i=>i.severity===e.severity)),e.startTime&&(t=t.filter(i=>i.timestamp>=e.startTime)),e.endTime&&(t=t.filter(i=>i.timestamp<=e.endTime)),e.limit&&(t=t.slice(0,e.limit)),t}exportAsJson(){return JSON.stringify(this._entries(),null,2)}clearLocal(){this._entries.set([]),this.saveToStorage()}getCurrentUserId(){try{let e=localStorage.getItem("tg-matrix-user");if(e){let t=JSON.parse(e);return t.id?.toString()||t.username}}catch{}}loadFromStorage(){try{let e=localStorage.getItem(Yc);if(e){let t=JSON.parse(e);this._entries.set(t.slice(0,Rr))}}catch(e){console.warn("[AuditTracker] Failed to load from storage:",e)}}saveToStorage(){try{localStorage.setItem(Yc,JSON.stringify(this._entries()))}catch(e){console.warn("[AuditTracker] Failed to save to storage:",e)}}startPeriodicReport(){this.reportTimer=setInterval(()=>this.flushReport(),gv)}flushReport(){if(this.pendingReport.length===0)return;let e=[...this.pendingReport];this.pendingReport=[];try{this.ipc.send("audit-log-batch",{entries:e})}catch{this.pendingReport.push(...e)}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var _o=class n{constructor(){this.tasks=v(new Map);this.connectionState=v({stage:"connecting",progress:0,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()});this.showConnectionStatus=v(!0);this.isLoading=G(()=>{let e=this.tasks();for(let t of e.values())if(t.blocking!==!1)return!0;return!1});this.currentTask=G(()=>{let e=this.tasks();if(e.size===0)return null;let t=Array.from(e.values());return t[t.length-1]});this.message=G(()=>this.currentTask()?.message||"");this.progress=G(()=>this.currentTask()?.progress);this.taskCount=G(()=>this.tasks().size);this.connectionProgressTimer=null}start(e="\u8F09\u5165\u4E2D...",t){let i=t||this.generateId();return this.tasks.update(o=>{let s=new Map(o);return s.set(i,{id:i,message:e,startTime:Date.now(),type:"spinner"}),s}),i}startWithProgress(e,t){let i=t||this.generateId();return this.tasks.update(o=>{let s=new Map(o);return s.set(i,{id:i,message:e,progress:0,startTime:Date.now(),type:"progress"}),s}),i}updateProgress(e,t,i){this.tasks.update(o=>{let s=new Map(o),r=s.get(e);return r&&s.set(e,N(M({},r),{progress:Math.min(100,Math.max(0,t)),message:i||r.message})),s})}updateMessage(e,t){this.tasks.update(i=>{let o=new Map(i),s=o.get(e);return s&&o.set(e,N(M({},s),{message:t})),o})}stop(e){this.tasks.update(t=>{let i=new Map(t);return i.delete(e),i})}stopAll(){this.tasks.set(new Map)}async wrap(e,t="\u8F09\u5165\u4E2D..."){let i=this.start(t);try{return await e}finally{this.stop(i)}}async wrapWithProgress(e,t="\u8655\u7406\u4E2D..."){let i=this.startWithProgress(t);try{return await e((s,r)=>{this.updateProgress(i,s,r)})}finally{this.stop(i)}}generateId(){return"load-"+Date.now().toString(36)+Math.random().toString(36).substr(2,5)}startConnection(){this.showConnectionStatus.set(!0),this.connectionState.set({stage:"connecting",progress:5,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()}),this.simulateConnectionProgress()}simulateConnectionProgress(){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=setInterval(()=>{let e=this.connectionState();e.stage==="connecting"&&e.progress<25?this.connectionState.update(t=>N(M({},t),{progress:Math.min(25,t.progress+2)})):e.stage==="loading-data"&&e.progress<75&&this.connectionState.update(t=>N(M({},t),{progress:Math.min(75,t.progress+1)}))},200)}updateConnectionStage(e,t){let i={connecting:10,"loading-data":40,initializing:70,ready:100,error:0};this.connectionState.update(o=>N(M({},o),{stage:e,progress:i[e],message:t||this.getStageMessage(e)})),(e==="ready"||e==="error")&&(this.connectionProgressTimer&&(clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=null),e==="ready"&&setTimeout(()=>{this.showConnectionStatus.set(!1)},500))}connectionError(e){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionState.set({stage:"error",progress:0,message:"\u9023\u63A5\u5931\u6557",startTime:Date.now(),error:e})}hideConnectionStatus(){this.showConnectionStatus.set(!1)}getStageMessage(e){switch(e){case"connecting":return"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...";case"loading-data":return"\u6B63\u5728\u8F09\u5165\u6578\u64DA...";case"initializing":return"\u6B63\u5728\u521D\u59CB\u5316...";case"ready":return"\u9023\u63A5\u6210\u529F";case"error":return"\u9023\u63A5\u5931\u6557"}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var vo=class n{constructor(e){this.ngZone=e;this.status=v({registered:!1,active:!1,waiting:!1,updateAvailable:!1,version:null});this.cacheStats=v({});this.isSupported="serviceWorker"in navigator;this.registration=null;this.isSupported?this.init():console.log("[SwManager] Service Worker not supported")}async init(){if(location.protocol!=="https:"&&location.hostname!=="localhost"){console.log("[SwManager] Skipping SW registration (not HTTPS)");return}try{navigator.serviceWorker.addEventListener("message",e=>{this.handleSwMessage(e)}),this.registration=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),console.log("[SwManager] \u2705 Service Worker registered"),this.ngZone.run(()=>{this.status.update(e=>N(M({},e),{registered:!0}))}),this.monitorRegistration(),this.checkForUpdates()}catch(e){console.error("[SwManager] Registration failed:",e)}}monitorRegistration(){this.registration&&(this.registration.active&&this.ngZone.run(()=>{this.status.update(e=>N(M({},e),{active:!0}))}),this.registration.waiting&&this.ngZone.run(()=>{this.status.update(e=>N(M({},e),{waiting:!0,updateAvailable:!0}))}),this.registration.addEventListener("updatefound",()=>{console.log("[SwManager] Update found");let e=this.registration.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(console.log("[SwManager] New version available"),this.ngZone.run(()=>{this.status.update(t=>N(M({},t),{updateAvailable:!0,waiting:!0}))}))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[SwManager] Controller changed")}))}handleSwMessage(e){console.log("[SwManager] Message from SW:",e.data),this.ngZone.run(()=>{switch(e.data.type){case"CACHE_STATS":this.cacheStats.set(e.data.stats);break;case"SYNC_OFFLINE_OPERATIONS":window.dispatchEvent(new CustomEvent("sync-offline-operations-from-sw"));break}})}async checkForUpdates(){if(!this.registration)return!1;try{return await this.registration.update(),console.log("[SwManager] Update check complete"),this.status().updateAvailable}catch(e){return console.error("[SwManager] Update check failed:",e),!1}}async applyUpdate(){if(!this.registration?.waiting){console.log("[SwManager] No waiting SW");return}console.log("[SwManager] Applying update..."),this.registration.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()},{once:!0})}async getCacheStats(){return navigator.serviceWorker.controller?new Promise(e=>{let t=new MessageChannel;t.port1.onmessage=i=>{i.data.type==="CACHE_STATS"&&e(i.data.stats)},navigator.serviceWorker.controller.postMessage({type:"GET_CACHE_STATS"},[t.port2]),setTimeout(()=>e({}),3e3)}):{}}async clearCache(){navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),console.log("[SwManager] Cache clear requested"))}async triggerSync(e="sync-offline-operations"){if(this.registration)if("sync"in this.registration)try{await this.registration.sync.register(e),console.log("[SwManager] Background sync registered:",e)}catch(t){console.error("[SwManager] Sync registration failed:",t)}else console.log("[SwManager] Background sync not supported")}async unregister(){if(!this.registration)return!1;try{let e=await this.registration.unregister();return console.log("[SwManager] Unregistered:",e),this.ngZone.run(()=>{this.status.set({registered:!1,active:!1,waiting:!1,updateAvailable:!1,version:null})}),e}catch(e){return console.error("[SwManager] Unregister failed:",e),!1}}static{this.\u0275fac=function(t){return new(t||n)(it(je))}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};var hv=(n,e)=>e.id;function fv(n,e){if(n&1&&Ee(0,"div",22),n&2){let t=_(2);me("left",t.highlightRect().left-8,"px")("top",t.highlightRect().top-8,"px")("width",t.highlightRect().width+16,"px")("height",t.highlightRect().height+16,"px")}}function _v(n,e){if(n&1){let t=F();x(0,"div",23),U("click",function(){let o=b(t).$index,s=_(2);return S(s.goToStep(o))}),w()}if(n&2){let t=e.$index,i=_(2);V("bg-gradient-to-r",t<=i.currentIndex())("from-cyan-500",t<=i.currentIndex())("to-blue-500",t<=i.currentIndex())("bg-slate-700",t>i.currentIndex())}}function vv(n,e){if(n&1&&(x(0,"li",30)(1,"span",31),m(2,"\u2713"),w(),x(3,"span"),m(4),w()()),n&2){let t=e.$implicit;h(4),R(t)}}function Cv(n,e){if(n&1&&(x(0,"div",27)(1,"ul",29),X(2,vv,5,1,"li",30,ht),w()()),n&2){let t=_();h(2),Z(t.tips)}}function yv(n,e){if(n&1){let t=F();x(0,"button",32),U("click",function(){b(t);let o=_(),s=_(2);return S(s.handleAction(o.actionTarget))}),m(1),w()}if(n&2){let t=_();h(),k(" ",t.actionLabel," \u2192 ")}}function bv(n,e){if(n&1&&(x(0,"div",11)(1,"div",24),m(2),w(),x(3,"h2",25),m(4),w(),x(5,"p",26),m(6),w(),T(7,Cv,4,0,"div",27),T(8,yv,2,1,"button",28),w()),n&2){let t=e;h(2),k(" ",t.icon," "),h(2),k(" ",t.title," "),h(2),k(" ",t.description," "),h(),A(t.tips&&t.tips.length>0?7:-1),h(),A(t.actionLabel&&t.actionTarget?8:-1)}}function Sv(n,e){if(n&1){let t=F();x(0,"button",33),U("click",function(){b(t);let o=_(2);return S(o.next())}),m(1," \u4E0B\u4E00\u6B65 \u2192 "),w()}}function xv(n,e){if(n&1){let t=F();x(0,"button",34),U("click",function(){b(t);let o=_(2);return S(o.complete())}),m(1," \u5F00\u59CB\u4F7F\u7528 \u{1F680} "),w()}}function wv(n,e){if(n&1){let t=F();x(0,"div",1),U("click",function(o){b(t);let s=_();return S(s.onBackdropClick(o))}),Ee(1,"div",2),T(2,fv,1,8,"div",3),x(3,"div",4),U("click",function(o){return b(t),S(o.stopPropagation())}),x(4,"div",5)(5,"div",6),X(6,_v,1,8,"div",7,hv),w(),x(8,"div",8)(9,"span"),m(10),w(),x(11,"button",9),U("click",function(){b(t);let o=_();return S(o.skipAll())}),m(12," \u8DF3\u8FC7\u5F15\u5BFC "),w()()(),x(13,"div",10),T(14,bv,9,5,"div",11),w(),x(15,"div",12)(16,"div",13)(17,"label",14)(18,"input",15),U("change",function(){b(t);let o=_();return S(o.toggleNeverShow())}),w(),x(19,"span"),m(20,"\u4EE5\u540E\u4E0D\u518D\u63D0\u793A"),w()()(),x(21,"div",16)(22,"button",17),U("click",function(){b(t);let o=_();return S(o.previous())}),m(23," \u2190 \u4E0A\u4E00\u6B65 "),w(),T(24,Sv,2,0,"button",18)(25,xv,2,0,"button",19),w()(),x(26,"div",20),m(27," \u6309 "),x(28,"kbd",21),m(29,"\u2190"),w(),x(30,"kbd",21),m(31,"\u2192"),w(),m(32," \u5BFC\u822A \xB7 "),x(33,"kbd",21),m(34,"ESC"),w(),m(35," \u5173\u95ED "),w()()()}if(n&2){let t,i,o=_();h(2),A((t=o.currentStep())!=null&&t.targetSelector&&o.highlightRect()?2:-1),h(4),Z(o.steps),h(4),be("\u6B65\u9AA4 ",o.currentIndex()+1," / ",o.steps.length),h(4),A((i=o.currentStep())?14:-1,i),h(4),Fe("checked",o.neverShowAgain()),h(4),Fe("disabled",o.currentIndex()===0),h(2),A(o.currentIndex()<o.steps.length-1?24:25)}}function Ev(n,e){if(n&1){let t=F();x(0,"div",1),Ee(1,"div",2),x(2,"div",3),Ee(3,"div",4),x(4,"h4",5),m(5),w(),x(6,"p",6),m(7),w(),x(8,"button",7),U("click",function(){b(t);let o=_();return S(o.dismiss())}),m(9,"\u77E5\u9053\u4E86"),w()()()}if(n&2){let t=_();me("top",t.position.top,"px")("left",t.position.left,"px"),h(5),R(t.title),h(2),R(t.description)}}var Fr="tg-ai-onboarding",sn="tg-ai-onboarding-never-show",Co=class n{constructor(){this.show=v(!1);this.currentIndex=v(0);this.neverShowAgain=v(!1);this.highlightRect=v(null);this.navigateEvent=Q();this.steps=[{id:"welcome",title:"\u6B22\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B",description:"\u667A\u80FD Telegram \u8425\u9500\u7CFB\u7EDF\uFF0C\u5E2E\u52A9\u60A8\u9AD8\u6548\u83B7\u5BA2\u3001\u81EA\u52A8\u5316\u8FD0\u8425",icon:"\u{1F389}",position:"center",tips:["\u652F\u6301\u591A\u8D26\u53F7\u7BA1\u7406\u548C\u534F\u4F5C","AI \u667A\u80FD\u8425\u9500\u548C\u81EA\u52A8\u56DE\u590D","\u7FA4\u7EC4\u641C\u7D22\u548C\u8D44\u6E90\u7BA1\u7406"]},{id:"add-account",title:"\u7B2C\u4E00\u6B65\uFF1A\u6DFB\u52A0\u8D26\u53F7",description:"\u7ED1\u5B9A\u60A8\u7684 Telegram \u8D26\u53F7\uFF0C\u8FD9\u662F\u4F7F\u7528\u6240\u6709\u529F\u80FD\u7684\u524D\u63D0",icon:"\u{1F4F1}",targetSelector:'[data-tour="accounts"]',position:"right",tips:["\u652F\u6301\u624B\u673A\u53F7\u9A8C\u8BC1\u767B\u5F55","\u53EF\u6DFB\u52A0\u591A\u4E2A\u8D26\u53F7\u540C\u65F6\u8FD0\u8425","\u5EFA\u8BAE\u4F7F\u7528\u72EC\u7ACB\u8425\u9500\u53F7"],actionLabel:"\u53BB\u6DFB\u52A0\u8D26\u53F7",actionTarget:"accounts"},{id:"search-discovery",title:"\u7B2C\u4E8C\u6B65\uFF1A\u641C\u7D22\u53D1\u73B0",description:"\u641C\u7D22\u76EE\u6807\u7FA4\u7EC4\u548C\u9891\u9053\uFF0C\u53D1\u73B0\u6F5C\u5728\u5BA2\u6237\u8D44\u6E90",icon:"\u{1F50D}",targetSelector:'[data-tour="search-discovery"]',position:"right",tips:["\u652F\u6301\u591A\u6E20\u9053\u641C\u7D22\uFF08\u5B98\u65B9/\u4E2D\u6587\u641C\u7D22\uFF09","\u4E00\u952E\u52A0\u5165\u76EE\u6807\u7FA4\u7EC4","\u6536\u85CF\u548C\u7BA1\u7406\u641C\u7D22\u7ED3\u679C"],actionLabel:"\u53BB\u641C\u7D22\u53D1\u73B0",actionTarget:"search-discovery"},{id:"monitoring-setup",title:"\u7B2C\u4E09\u6B65\uFF1A\u76D1\u63A7\u4E0E\u5173\u952E\u8BCD",description:"\u4E3A\u5DF2\u52A0\u5165\u7684\u7FA4\u7EC4\u8BBE\u7F6E\u5173\u952E\u8BCD\u76D1\u63A7\uFF0C\u81EA\u52A8\u6355\u6349\u6F5C\u5728\u5BA2\u6237",icon:"\u{1F4E1}",targetSelector:'[data-tour="monitoring-center"]',position:"right",tips:["\u76D1\u63A7\u4E2D\u5FC3\u7EDF\u4E00\u7BA1\u7406\u6240\u6709\u7FA4\u7EC4","\u7ED1\u5B9A\u5173\u952E\u8BCD\u96C6\uFF0C\u81EA\u52A8\u5339\u914D\u6D88\u606F","\u7CFB\u7EDF\u5185\u7F6E\u884C\u4E1A\u9884\u8BBE\u5173\u952E\u8BCD\uFF08\u52A0\u5BC6\u8D27\u5E01\u3001\u7535\u5546\u7B49\uFF09"],actionLabel:"\u53BB\u8BBE\u7F6E\u76D1\u63A7",actionTarget:"automation"},{id:"ai-marketing",title:"\u7B2C\u56DB\u6B65\uFF1AAI \u667A\u80FD\u8425\u9500",description:"\u8BA9 AI \u5E2E\u60A8\u5236\u5B9A\u8425\u9500\u7B56\u7565\uFF0C\u81EA\u52A8\u6267\u884C\u8425\u9500\u4EFB\u52A1",icon:"\u{1F916}",targetSelector:'[data-tour="ai-assistant"]',position:"right",tips:["AI \u4E00\u952E\u751F\u6210\u8425\u9500\u7B56\u7565","\u81EA\u52A8\u5316\u6267\u884C\u548C\u8DDF\u8FDB","\u6570\u636E\u5206\u6790\u548C\u6548\u679C\u8FFD\u8E2A"],actionLabel:"\u4F53\u9A8C AI \u8425\u9500",actionTarget:"ai-assistant"},{id:"complete",title:"\u51C6\u5907\u5C31\u7EEA\uFF01",description:"\u60A8\u5DF2\u4E86\u89E3\u6838\u5FC3\u529F\u80FD\uFF0C\u73B0\u5728\u53EF\u4EE5\u5F00\u59CB\u60A8\u7684\u8425\u9500\u4E4B\u65C5\u4E86",icon:"\u{1F680}",position:"center",tips:["\u6DFB\u52A0\u8D26\u53F7 \u2192 \u641C\u7D22\u7FA4\u7EC4 \u2192 \u8BBE\u7F6E\u76D1\u63A7 \u2192 \u83B7\u5F97 Lead","\u4EEA\u8868\u76D8\u67E5\u770B\u6574\u4F53\u6570\u636E","\u6709\u95EE\u9898\u968F\u65F6\u70B9\u51FB\u53F3\u4E0A\u89D2 \u2753 \u5E2E\u52A9"]}];this.currentStep=G(()=>this.steps[this.currentIndex()])}ngOnInit(){this.checkFirstRun(),this.loadNeverShowSetting()}handleKeydown(e){if(this.show())switch(e.key){case"Escape":this.skipAll();break;case"ArrowRight":case"Enter":this.currentIndex()<this.steps.length-1?this.next():this.complete();break;case"ArrowLeft":this.previous();break}}checkFirstRun(){let e=localStorage.getItem(Fr);localStorage.getItem(sn)!=="true"&&(e||setTimeout(()=>this.show.set(!0),800))}loadNeverShowSetting(){let e=localStorage.getItem(sn);this.neverShowAgain.set(e==="true")}toggleNeverShow(){let e=!this.neverShowAgain();this.neverShowAgain.set(e),localStorage.setItem(sn,String(e))}open(){this.currentIndex.set(0),this.show.set(!0),this.updateHighlight()}close(){this.show.set(!1),this.highlightRect.set(null)}next(){this.currentIndex()<this.steps.length-1&&(this.currentIndex.update(e=>e+1),this.updateHighlight())}previous(){this.currentIndex()>0&&(this.currentIndex.update(e=>e-1),this.updateHighlight())}goToStep(e){e>=0&&e<this.steps.length&&(this.currentIndex.set(e),this.updateHighlight())}skipAll(){this.markAsCompleted(),this.close()}complete(){this.markAsCompleted(),this.close()}markAsCompleted(){localStorage.setItem(Fr,new Date().toISOString()),this.neverShowAgain()&&localStorage.setItem(sn,"true")}handleAction(e){this.navigateEvent.emit(e),this.next()}onBackdropClick(e){}updateHighlight(){let e=this.currentStep();e?.targetSelector?setTimeout(()=>{let t=document.querySelector(e.targetSelector);t?(this.highlightRect.set(t.getBoundingClientRect()),t.scrollIntoView({behavior:"smooth",block:"center"})):this.highlightRect.set(null)},100):this.highlightRect.set(null)}reset(){localStorage.removeItem(Fr),localStorage.removeItem(sn),this.neverShowAgain.set(!1),this.currentIndex.set(0)}shouldShowOnboarding(){return localStorage.getItem(sn)!=="true"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-onboarding"]],hostBindings:function(t,i){t&1&&D("keydown",function(s){return i.handleKeydown(s)},Jr)},outputs:{navigateEvent:"navigateEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center"],[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center",3,"click"],[1,"absolute","inset-0","bg-black/80","backdrop-blur-sm"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none",3,"left","top","width","height"],[1,"relative","w-full","max-w-lg","mx-4","sm:mx-auto","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","rounded-2xl","sm:rounded-3xl","shadow-2xl","border","border-slate-600/50","overflow-hidden",3,"click"],[1,"px-4","sm:px-6","pt-4","sm:pt-5"],[1,"flex","items-center","gap-1.5","sm:gap-2"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"bg-gradient-to-r","from-cyan-500","to-blue-500","bg-slate-700"],[1,"flex","justify-between","items-center","mt-2","text-xs","text-slate-500"],[1,"hover:text-slate-300","transition-colors","px-2","py-1","-mr-2",3,"click"],[1,"p-4","sm:p-6"],[1,"text-center"],[1,"px-4","sm:px-6","pb-4","sm:pb-5"],[1,"flex","items-center","justify-center","mb-4"],[1,"flex","items-center","gap-2","cursor-pointer","text-sm","text-slate-500","hover:text-slate-400","transition-colors"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-cyan-500","focus:ring-cyan-500/50",3,"change","checked"],[1,"flex","justify-between","gap-3"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-slate-700/80","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-40","disabled:cursor-not-allowed","text-sm","sm:text-base",3,"click","disabled"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25"],[1,"hidden","sm:block","px-6","pb-4","text-center","text-xs","text-slate-600"],[1,"px-1.5","py-0.5","bg-slate-700","rounded","text-slate-400"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"click"],[1,"text-5xl","sm:text-6xl","mb-4","sm:mb-5","animate-bounce-slow"],[1,"text-xl","sm:text-2xl","font-bold","text-white","mb-2","sm:mb-3"],[1,"text-slate-300","text-sm","sm:text-base","mb-4","sm:mb-5","max-w-sm","mx-auto","leading-relaxed"],[1,"bg-slate-800/60","rounded-xl","p-3","sm:p-4","mb-4","sm:mb-5","text-left","max-w-sm","mx-auto","border","border-slate-700/50"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25"],[1,"space-y-2"],[1,"flex","items-start","gap-2","text-slate-400","text-sm"],[1,"text-cyan-400","mt-0.5","flex-shrink-0"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25",3,"click"]],template:function(t,i){t&1&&T(0,wv,36,7,"div",0),t&2&&A(i.show()?0:-1)},dependencies:[de,Te],styles:["@keyframes _ngcontent-%COMP%_bounce-slow{0%,to{transform:translateY(0)}50%{transform:translateY(-8px)}}.animate-bounce-slow[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-slow 2s ease-in-out infinite}"]})}},Xc=class n{constructor(){this.show=v(!1);this.title="";this.description="";this.position={top:0,left:0}}highlight(e,t,i){let o=e.getBoundingClientRect();this.position={top:o.top,left:o.left},this.title=t,this.description=i,this.show.set(!0)}dismiss(){this.show.set(!1)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-feature-highlight"]],decls:1,vars:1,consts:[[1,"fixed","z-[9998]",3,"top","left"],[1,"fixed","z-[9998]"],[1,"absolute","-inset-2","bg-cyan-500/20","rounded-xl","animate-pulse"],[1,"absolute","top-full","left-1/2","-translate-x-1/2","mt-4","w-64","bg-slate-800","rounded-xl","shadow-xl","border","border-slate-600","p-4","z-10"],[1,"absolute","-top-2","left-1/2","-translate-x-1/2","w-4","h-4","bg-slate-800","border-l","border-t","border-slate-600","rotate-45"],[1,"font-bold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(t,i){t&1&&T(0,Ev,10,6,"div",0),t&2&&A(i.show()?0:-1)},dependencies:[de],encapsulation:2})}};var Tv=(n,e)=>e.code;function Av(n,e){if(n&1){let t=F();x(0,"div",7),U("click",function(){let o=b(t).$implicit,s=_(2);return S(s.selectLocale(o.code))}),x(1,"span",2),m(2),w(),x(3,"span",8),m(4),w()()}if(n&2){let t=e.$implicit,i=_(2);V("active",t.code===i.i18n.locale()),h(2),R(t.flag),h(2),R(t.nativeName)}}function Dv(n,e){if(n&1&&(x(0,"div",5),X(1,Av,5,4,"div",6,Tv),w()),n&2){let t=_();h(),Z(t.locales)}}var yo=class n{constructor(){this.i18n=O(et);this.locales=ga;this.isOpen=!1}toggleDropdown(){this.isOpen=!this.isOpen}selectLocale(e){this.i18n.setLocale(e),this.isOpen=!1}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-language-switcher-compact"]],decls:9,vars:5,consts:[[1,"language-switcher"],[1,"current-language",3,"click"],[1,"flag"],[1,"lang-name"],[1,"arrow"],[1,"dropdown"],[1,"option",3,"active"],[1,"option",3,"click"],[1,"name"]],template:function(t,i){t&1&&(x(0,"div",0)(1,"div",1),U("click",function(){return i.toggleDropdown()}),x(2,"span",2),m(3),w(),x(4,"span",3),m(5),w(),x(6,"span",4),m(7,"\u25BC"),w()(),T(8,Dv,3,0,"div",5),w()),t&2&&(h(3),R(i.i18n.currentLocaleInfo().flag),h(2),R(i.i18n.currentLocaleInfo().nativeName),h(),V("open",i.isOpen),h(2),A(i.isOpen?8:-1))},dependencies:[de],styles:[".language-switcher[_ngcontent-%COMP%]{position:relative;display:inline-block}.current-language[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;cursor:pointer;transition:all .2s ease}.current-language[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.flag[_ngcontent-%COMP%]{font-size:18px}.lang-name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}.arrow[_ngcontent-%COMP%]{font-size:10px;color:var(--text-muted, #888);transition:transform .2s ease}.arrow.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin-top:4px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;overflow:hidden;z-index:100;box-shadow:0 4px 12px #0000004d}.option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 12px;cursor:pointer;transition:background .2s ease}.option[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.option.active[_ngcontent-%COMP%]{background:var(--primary-color, #7c3aed)}.option[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}"]})}};var Mv=(n,e)=>e.api_id;function Iv(n,e){n&1&&(x(0,"div",5),Ee(1,"span",6),x(2,"span"),m(3,"\u6B63\u5728\u5206\u6790\u6700\u4F73 API..."),w()())}function kv(n,e){if(n&1){let t=F();x(0,"div",7)(1,"div",8),m(2,"\u2B50 \u63A8\u85A6"),w(),x(3,"div",9)(4,"div",10),m(5),w(),x(6,"div",11),m(7),w()(),x(8,"div",12)(9,"div",13),Ee(10,"div",14),w(),x(11,"span",15),m(12),w()(),x(13,"button",16),U("click",function(){b(t);let o=_(2);return S(o.useRecommended())}),m(14,"\u4F7F\u7528\u6B64 API"),w()(),x(15,"p",17),m(16,"\u{1F4A1} \u6B64 API \u8CA0\u8F09\u6700\u4F4E\uFF0C\u53EF\u7528\u7A7A\u9593\u5145\u8DB3"),w()}if(n&2){let t=_(2);h(5),R(t.safeDisplayName(t.recommendedApi().name,t.recommendedApi().api_id)),h(2),k("ID: ",t.recommendedApi().api_id),h(3),me("width",t.recommendedApi().account_count/t.recommendedApi().max_accounts*100,"%"),h(2),be("",t.recommendedApi().account_count,"/",t.recommendedApi().max_accounts)}}function Pv(n,e){if(n&1){let t=F();x(0,"div",18)(1,"div",19),m(2,"\u{1F680} \u4E00\u9375\u767B\u5165"),w(),x(3,"div",20),m(4,"\u{1F510}"),w(),x(5,"h3"),m(6,"\u4F7F\u7528\u5E73\u53F0\u516C\u5171 API"),w(),x(7,"p",21),m(8,"\u7121\u9700\u4E86\u89E3 API\uFF0C\u76F4\u63A5\u958B\u59CB\u767B\u5165"),w(),x(9,"ul",22)(10,"li"),m(11,"\u2705 \u514D\u914D\u7F6E\uFF0C\u5373\u958B\u5373\u7528"),w(),x(12,"li"),m(13,"\u2705 \u7A69\u5B9A\u53EF\u9760"),w(),x(14,"li"),m(15,"\u2705 \u9069\u5408\u65B0\u624B\u7528\u6236"),w()(),x(16,"button",23),U("click",function(){b(t);let o=_(2);return S(o.usePlatformApi())}),m(17," \u{1F680} \u7ACB\u5373\u4F7F\u7528 "),w()(),x(18,"div",24)(19,"span"),m(20,"\u6216\u8005"),w()(),x(21,"div",25)(22,"button",26),U("click",function(){b(t);let o=_(2);return S(o.selectMode("manual"))}),m(23," \u{1F527} \u6211\u6709\u81EA\u5DF1\u7684 API\uFF08\u9032\u968E\u7528\u6236\uFF09 "),w(),x(24,"p",27),m(25,"\u5982\u679C\u60A8\u6709\u81EA\u5DF1\u7684 Telegram API \u6191\u64DA\uFF0C\u9EDE\u64CA\u6B64\u8655\u6DFB\u52A0"),w()()}}function Nv(n,e){if(n&1&&(x(0,"div",3),T(1,Iv,4,0,"div",5)(2,kv,17,6)(3,Pv,26,0),w()),n&2){let t=_();h(),A(t.isLoading()?1:t.recommendedApi()?2:3)}}function Rv(n,e){if(n&1){let t=F();x(0,"div",28)(1,"span",29),m(2,"\u{1F4ED}"),w(),x(3,"p"),m(4,"\u60A8\u9084\u6C92\u6709\u6DFB\u52A0\u4EFB\u4F55 API"),w(),x(5,"button",30),U("click",function(){b(t);let o=_(2);return S(o.selectMode("manual"))}),m(6,"\u2795 \u6DFB\u52A0\u7B2C\u4E00\u500B API"),w()()}}function Fv(n,e){n&1&&(x(0,"span",42),m(1,"\u505C\u7528"),w())}function Lv(n,e){n&1&&(x(0,"span",43),m(1,"\u5DF2\u6EFF"),w())}function Vv(n,e){n&1&&(x(0,"span",44),m(1,"\u63A8\u85A6"),w())}function Bv(n,e){if(n&1){let t=F();x(0,"div",36),U("click",function(){let o=b(t).$implicit,s=_(3);return S(s.selectPoolApi(o))}),x(1,"div",37)(2,"span",38),m(3),w(),x(4,"span",39),m(5),w()(),x(6,"div",40)(7,"span",41),m(8),w(),T(9,Fv,2,0,"span",42)(10,Lv,2,0,"span",43)(11,Vv,2,0,"span",44),w()()}if(n&2){let t,i=e.$implicit,o=_(3);V("selected",o.selectedPoolApi()===i.api_id)("disabled",!i.is_active||i.account_count>=i.max_accounts),h(3),R(o.safeDisplayName(i.name,i.api_id)),h(2),k("ID: ",i.api_id),h(2),V("warning",i.account_count>=i.max_accounts*.8)("full",i.account_count>=i.max_accounts),h(),be(" ",i.account_count,"/",i.max_accounts," "),h(),A(i.is_active?i.account_count>=i.max_accounts?10:((t=o.recommendedApi())==null?null:t.api_id)===i.api_id?11:-1:9)}}function Ov(n,e){if(n&1){let t=F();x(0,"button",45),U("click",function(){b(t);let o=_(3);return S(o.confirmPoolSelection())}),m(1,"\u78BA\u8A8D\u9078\u64C7"),w()}}function Gv(n,e){if(n&1){let t=F();x(0,"div",31),X(1,Bv,12,13,"div",32,Mv),w(),T(3,Ov,2,0,"button",33),x(4,"div",34)(5,"button",35),U("click",function(){b(t);let o=_(2);return S(o.selectMode("manual"))}),m(6,"\u2795 \u6DFB\u52A0\u65B0 API"),w()()}if(n&2){let t=_(2);h(),Z(t.apiList()),h(2),A(t.selectedPoolApi()?3:-1)}}function Uv(n,e){if(n&1&&(x(0,"div",3),T(1,Rv,7,0,"div",28)(2,Gv,7,1),w()),n&2){let t=_();h(),A(t.apiList().length===0?1:2)}}function qv(n,e){if(n&1){let t=F();x(0,"div",46)(1,"label"),m(2,"API \u540D\u7A31\uFF08\u53EF\u9078\uFF09"),w(),x(3,"input",56),U("input",function(o){b(t);let s=_(2);return S(s.manualApiName.set(o.target.value))}),w()()}if(n&2){let t=_(2);h(3),Fe("value",t.manualApiName())}}function $v(n,e){if(n&1){let t=F();x(0,"div",3)(1,"div",46)(2,"label"),m(3,"API ID "),x(4,"span",47),m(5,"*"),w()(),x(6,"input",48),U("input",function(o){b(t);let s=_();return S(s.manualApiId.set(o.target.value))}),w()(),x(7,"div",46)(8,"label"),m(9,"API Hash "),x(10,"span",47),m(11,"*"),w()(),x(12,"input",49),U("input",function(o){b(t);let s=_();return S(s.manualApiHash.set(o.target.value))}),w()(),x(13,"div",50)(14,"input",51),U("change",function(o){b(t);let s=_();return S(s.saveToPool.set(o.target.checked))}),w(),x(15,"label",52),m(16,"\u4FDD\u5B58\u5230\u6211\u7684 API \u6C60\uFF08\u65B9\u4FBF\u4E0B\u6B21\u4F7F\u7528\uFF09"),w()(),T(17,qv,4,1,"div",46),x(18,"button",53),U("click",function(){b(t);let o=_();return S(o.confirmManualInput())}),m(19," \u78BA\u8A8D\u4F7F\u7528 "),w(),x(20,"div",54)(21,"span"),m(22,"\u{1F449}"),w(),x(23,"a",55),m(24,"\u524D\u5F80\u7533\u8ACB API \u6191\u64DA"),w()()()}if(n&2){let t=_();h(6),Fe("value",t.manualApiId()),h(6),Fe("value",t.manualApiHash()),h(2),Fe("checked",t.saveToPool()),h(3),A(t.saveToPool()?17:-1),h(),Fe("disabled",!t.isManualValid())}}function Hv(n,e){if(n&1){let t=F();x(0,"div",4)(1,"div",57)(2,"span",58),m(3,"\u5DF2\u9078\u64C7\uFF1A"),w(),x(4,"span",59),m(5),w(),x(6,"span",60),m(7),w()(),x(8,"button",61),U("click",function(){b(t);let o=_();return S(o.clearSelection())}),m(9,"\u2715"),w()()}if(n&2){let t=_();h(5),R(t.safeDisplayName(t.selectedApi().name,t.selectedApi().api_id)),h(2),k("ID: ",t.selectedApi().api_id)}}var bo=class n{constructor(){this.ipcService=O(Ie);this.toast=O(Ne);this.membershipService=O(mt);this.showSelected=!0;this.apiSelected=new Vt;this.selectionCleared=new Vt;this.currentMode=v("recommend");this.isLoading=v(!1);this.apiList=v([]);this.selectedApi=v(null);this.recommendedApi=v(null);this.selectedPoolApi=v(null);this.manualApiId=v("");this.manualApiHash=v("");this.manualApiName=v("");this.saveToPool=v(!0);this.ipcChannels=[];this.isManualValid=G(()=>{let e=this.manualApiId(),t=this.manualApiHash();return e&&/^\d+$/.test(e)&&t&&/^[a-f0-9]{32}$/i.test(t)})}safeDisplayName(e,t){return e?/[\uFFFD\u0000-\u001F]/.test(e)||e.includes("\uFFFD")||/[\uE000-\uF8FF]/.test(e)||(e.match(/[\u4E00-\u9FFF]/g)?.length||0)===0&&/[^\x00-\x7F]/.test(e)&&e.length<10?`API ${t}`:e.replace(/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\w\s\-_@#$%&*()+=\[\]{}|;:'",.<>?/\\]/g,"").length>e.length*.3?`API ${t}`:e:`API ${t}`}ngOnInit(){this.setupIpcListeners(),this.loadApiList()}ngOnDestroy(){this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("api-credentials-updated",e=>{if(this.isLoading.set(!1),e.credentials){let t=e.credentials.filter(i=>!i.is_public&&i.is_active);this.apiList.set(t),this.findBestApi(t)}}),this.ipcChannels.push("api-credentials-updated"),this.ipcService.on("api-credential-added",e=>{e.success?(this.toast.success("\u2705 API \u6191\u64DA\u5DF2\u4FDD\u5B58\u5230 API \u6C60"),this.loadApiList()):this.toast.error(`\u4FDD\u5B58\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcChannels.push("api-credential-added")}loadApiList(){this.isLoading.set(!0),this.ipcService.send("get-api-credentials",{})}findBestApi(e){let t=e.filter(i=>i.is_active&&i.account_count<i.max_accounts);t.length>0?(t.sort((i,o)=>i.account_count/i.max_accounts-o.account_count/o.max_accounts),this.recommendedApi.set(t[0])):this.recommendedApi.set(null)}selectMode(e){this.currentMode.set(e)}useRecommended(){let e=this.recommendedApi();if(e&&e.api_hash){let t=this.safeDisplayName(e.name,e.api_id),i={api_id:e.api_id,api_hash:e.api_hash,name:t,source:"pool"};this.selectedApi.set(i),this.apiSelected.emit(i),this.toast.success(`\u5DF2\u9078\u64C7 ${t}`)}else e&&this.toast.error("\u6B64 API \u7F3A\u5C11 Hash\uFF0C\u8ACB\u91CD\u65B0\u6DFB\u52A0")}usePlatformApi(){let e={api_id:"2040",api_hash:"b18441a1ff607e10a989891a5462e627",name:"\u5E73\u53F0\u516C\u5171 API",source:"platform"};this.selectedApi.set(e),this.apiSelected.emit(e),this.toast.success("\u2705 \u5DF2\u9078\u64C7\u5E73\u53F0\u516C\u5171 API\uFF0C\u53EF\u76F4\u63A5\u767B\u5165")}selectPoolApi(e){!e.is_active||e.account_count>=e.max_accounts||this.selectedPoolApi.set(e.api_id)}confirmPoolSelection(){let e=this.selectedPoolApi(),t=this.apiList().find(i=>i.api_id===e);if(t&&t.api_hash){let i=this.safeDisplayName(t.name,t.api_id),o={api_id:t.api_id,api_hash:t.api_hash,name:i,source:"pool"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success(`\u5DF2\u9078\u64C7 ${i}`)}}confirmManualInput(){if(!this.isManualValid())return;let e=this.manualApiId(),t=this.manualApiHash(),i=this.manualApiName()||`API ${e}`;this.saveToPool()&&this.ipcService.send("add-api-credential",{api_id:e,api_hash:t,name:i,source:"manual"});let o={api_id:e,api_hash:t,name:i,source:"manual"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success("API \u5DF2\u78BA\u8A8D")}clearSelection(){this.selectedApi.set(null),this.selectedPoolApi.set(null),this.manualApiId.set(""),this.manualApiHash.set(""),this.manualApiName.set(""),this.selectionCleared.emit()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-api-selector"]],inputs:{showSelected:"showSelected"},outputs:{apiSelected:"apiSelected",selectionCleared:"selectionCleared"},decls:12,vars:10,consts:[[1,"api-selector"],[1,"mode-tabs"],[1,"mode-tab",3,"click"],[1,"mode-content"],[1,"selected-display"],[1,"loading-state"],[1,"spinner"],[1,"recommended-card"],[1,"recommend-badge"],[1,"api-info"],[1,"api-name"],[1,"api-id"],[1,"api-quota"],[1,"quota-bar"],[1,"quota-fill"],[1,"quota-text"],[1,"use-btn",3,"click"],[1,"recommend-reason"],[1,"platform-api-card"],[1,"platform-badge"],[1,"platform-icon"],[1,"platform-desc"],[1,"platform-features"],[1,"platform-btn",3,"click"],[1,"divider-text"],[1,"advanced-option"],[1,"advanced-btn",3,"click"],[1,"advanced-hint"],[1,"empty-state"],[1,"empty-icon"],[1,"add-btn",3,"click"],[1,"api-list"],[1,"api-item",3,"selected","disabled"],[1,"confirm-btn"],[1,"pool-footer"],[1,"add-more-btn",3,"click"],[1,"api-item",3,"click"],[1,"api-item-info"],[1,"api-item-name"],[1,"api-item-id"],[1,"api-item-right"],[1,"quota-badge"],[1,"status-badge","inactive"],[1,"status-badge","full"],[1,"status-badge","recommend"],[1,"confirm-btn",3,"click"],[1,"form-group"],[1,"required"],["type","text","placeholder","\u4F8B\u5982\uFF1A12345678",1,"form-input",3,"input","value"],["type","text","placeholder","\u4F8B\u5982\uFF1Aa1b2c3d4e5f6g7h8...",1,"form-input",3,"input","value"],[1,"save-option"],["type","checkbox","id","saveToPool",3,"change","checked"],["for","saveToPool"],[1,"confirm-btn",3,"click","disabled"],[1,"guide-link"],["href","https://my.telegram.org","target","_blank"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u4E3B\u529B API",1,"form-input",3,"input","value"],[1,"selected-info"],[1,"selected-label"],[1,"selected-name"],[1,"selected-id"],[1,"clear-btn",3,"click"]],template:function(t,i){t&1&&(x(0,"div",0)(1,"div",1)(2,"button",2),U("click",function(){return i.selectMode("recommend")}),m(3," \u{1F3AF} \u667A\u80FD\u63A8\u85A6 "),w(),x(4,"button",2),U("click",function(){return i.selectMode("pool")}),m(5," \u{1F4CB} \u6211\u7684 API "),w(),x(6,"button",2),U("click",function(){return i.selectMode("manual")}),m(7," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),w()(),T(8,Nv,4,1,"div",3),T(9,Uv,3,1,"div",3),T(10,$v,25,5,"div",3),T(11,Hv,10,2,"div",4),w()),t&2&&(h(2),V("active",i.currentMode()==="recommend"),h(2),V("active",i.currentMode()==="pool"),h(2),V("active",i.currentMode()==="manual"),h(2),A(i.currentMode()==="recommend"?8:-1),h(),A(i.currentMode()==="pool"?9:-1),h(),A(i.currentMode()==="manual"?10:-1),h(),A(i.selectedApi()&&i.showSelected?11:-1))},dependencies:[de,Te],styles:['.api-selector[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;overflow:hidden}.mode-tabs[_ngcontent-%COMP%]{display:flex;background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.25rem}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.625rem .5rem;background:transparent;border:none;border-radius:.5rem;color:var(--text-muted, #94a3b8);font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s}.mode-tab[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.mode-tab.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.mode-content[_ngcontent-%COMP%]{padding:1rem}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:2rem;color:var(--text-muted, #94a3b8)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:1.5rem}.empty-icon[_ngcontent-%COMP%]{font-size:2rem;display:block;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-secondary, #cbd5e1)}.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);margin-bottom:1rem}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);border:none;border-radius:.5rem;color:#fff;font-size:.8rem;cursor:pointer}.recommended-card[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid var(--primary, #06b6d4);border-radius:.75rem;padding:1rem;position:relative}.recommend-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;right:12px;padding:.25rem .75rem;background:var(--primary, #06b6d4);border-radius:1rem;font-size:.7rem;color:#fff;font-weight:600}.api-info[_ngcontent-%COMP%]{margin-bottom:.75rem}.api-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white);font-size:1rem}.api-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-quota[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.quota-bar[_ngcontent-%COMP%]{flex:1;height:6px;background:#ffffff1a;border-radius:3px;overflow:hidden}.quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#22c55e,#06b6d4);border-radius:3px}.quota-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #cbd5e1);min-width:40px}.use-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.recommend-reason[_ngcontent-%COMP%]{margin:.75rem 0 0;font-size:.75rem;color:var(--text-muted, #94a3b8);text-align:center}.api-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto}.api-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.api-item[_ngcontent-%COMP%]:hover:not(.disabled){border-color:var(--primary, #06b6d4)}.api-item.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.api-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.api-item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.api-item-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white);font-size:.875rem}.api-item-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.api-item-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.quota-badge[_ngcontent-%COMP%]{padding:.125rem .5rem;background:#22c55e33;border-radius:.25rem;font-size:.7rem;color:#86efac}.quota-badge.warning[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.quota-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.status-badge[_ngcontent-%COMP%]{padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}.status-badge.recommend[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.status-badge.inactive[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.status-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.confirm-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;margin-top:.75rem}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.pool-footer[_ngcontent-%COMP%]{margin-top:.75rem;text-align:center}.add-more-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);font-size:.8rem;cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:.75rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.required[_ngcontent-%COMP%]{color:#ef4444}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;box-sizing:border-box}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.save-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.save-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.guide-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.25rem;margin-top:.75rem;font-size:.75rem}.guide-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.platform-api-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d426,#3b82f626);border:2px solid rgba(6,182,212,.5);border-radius:.75rem;padding:1.25rem;text-align:center;position:relative}.platform-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;left:50%;transform:translate(-50%);padding:.25rem 1rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border-radius:1rem;font-size:.75rem;color:#fff;font-weight:600;white-space:nowrap}.platform-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin:.5rem 0}.platform-api-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:.5rem 0;color:var(--text-primary, white);font-size:1.125rem}.platform-desc[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.platform-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;text-align:left;display:inline-block}.platform-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary, #cbd5e1);margin-bottom:.25rem}.platform-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}.platform-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #06b6d466}.divider-text[_ngcontent-%COMP%]{display:flex;align-items:center;margin:1rem 0;color:var(--text-muted, #64748b);font-size:.75rem}.divider-text[_ngcontent-%COMP%]:before, .divider-text[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:var(--border-default, rgba(148, 163, 184, .2))}.divider-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 .75rem}.advanced-option[_ngcontent-%COMP%]{text-align:center}.advanced-btn[_ngcontent-%COMP%]{background:transparent;border:1px dashed var(--border-default, rgba(148, 163, 184, .3));border-radius:.5rem;padding:.625rem 1rem;color:var(--text-muted, #94a3b8);font-size:.8rem;cursor:pointer;transition:all .2s}.advanced-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.advanced-hint[_ngcontent-%COMP%]{margin:.5rem 0 0;font-size:.7rem;color:var(--text-muted, #64748b)}.selected-display[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:#22c55e1a;border-top:1px solid rgba(34,197,94,.2)}.selected-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.selected-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.selected-name[_ngcontent-%COMP%]{font-weight:500;color:#86efac}.selected-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:1rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:var(--primary, #06b6d4);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}']})}};function Kv(n,e){n&1&&(q(0,"span",21),m(1," \u751F\u6210\u4E2D... "))}function Wv(n,e){n&1&&m(0," \u{1F4F7} \u751F\u6210\u4E8C\u7DAD\u78BC ")}function zv(n,e){if(n&1){let t=F();p(0,"div",6)(1,"div",7)(2,"p"),m(3,"\u4F7F\u7528 Telegram App \u6383\u63CF\u4E8C\u7DAD\u78BC\uFF0C\u5FEB\u901F\u6DFB\u52A0\u5E33\u865F\u3002"),g()(),p(4,"div",8)(5,"label",9),m(6,"\u{1F510} \u9078\u64C7 API \u6191\u64DA"),g(),p(7,"app-api-selector",10),D("apiSelected",function(o){b(t);let s=_();return S(s.onApiSelected(o))})("selectionCleared",function(){b(t);let o=_();return S(o.onApiCleared())}),g()(),p(8,"div",8)(9,"label",9),m(10,"\u{1F4F2} \u8A2D\u5099\u6A21\u64EC"),g(),p(11,"div",11)(12,"button",12),D("click",function(){b(t);let o=_();return S(o.deviceType.set("random"))}),m(13," \u{1F3B2} \u667A\u80FD\u96A8\u6A5F "),g(),p(14,"button",12),D("click",function(){b(t);let o=_();return S(o.deviceType.set("ios"))}),m(15," \u{1F4F1} iOS "),g(),p(16,"button",12),D("click",function(){b(t);let o=_();return S(o.deviceType.set("android"))}),m(17," \u{1F916} Android "),g(),p(18,"button",12),D("click",function(){b(t);let o=_();return S(o.deviceType.set("desktop"))}),m(19," \u{1F4BB} Desktop "),g()()(),p(20,"div",8)(21,"label",9),m(22,"\u{1F310} \u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),g(),p(23,"div",13)(24,"input",14),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.proxyInput,o)||(s.proxyInput=o),S(o)}),g(),p(25,"button",15),D("click",function(){b(t);let o=_();return S(o.selectRandomProxy())}),m(26," \u{1F3B2} "),g()(),p(27,"div",16)(28,"input",17),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.bindProxyToAccount,o)||(s.bindProxyToAccount=o),S(o)}),g(),p(29,"label",18),m(30,"\u70BA\u6B64\u5E33\u865F\u7D81\u5B9A\u6B64\u4EE3\u7406 IP\uFF08\u63A8\u85A6\uFF09"),g()()(),p(31,"div",8)(32,"label",9),m(33,"\u{1F510} \u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09"),g(),p(34,"input",19),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.twoFactorPassword,o)||(s.twoFactorPassword=o),S(o)}),g()(),p(35,"button",20),D("click",function(){b(t);let o=_();return S(o.createQRLogin())}),T(36,Kv,2,0)(37,Wv,1,0),g()()}if(n&2){let t=_();h(7),K("showSelected",!1),h(5),V("active",t.deviceType()==="random"),h(2),V("active",t.deviceType()==="ios"),h(2),V("active",t.deviceType()==="android"),h(2),V("active",t.deviceType()==="desktop"),h(6),_e("ngModel",t.proxyInput),h(4),_e("ngModel",t.bindProxyToAccount),h(6),_e("ngModel",t.twoFactorPassword),h(),K("disabled",t.isCreating()||!t.selectedApi()),h(),A(t.isCreating()?36:37)}}function Jv(n,e){if(n&1&&q(0,"img",28),n&2){let t=_(3);K("src","data:image/png;base64,"+t.session().qrImageBase64,zr)}}function Qv(n,e){n&1&&(p(0,"div",29),q(1,"span",36),g())}function Yv(n,e){if(n&1&&(p(0,"div",27),T(1,Jv,1,1,"img",28)(2,Qv,2,0,"div",29),g(),p(3,"div",30)(4,"div",31),m(5),g(),p(6,"p",32),m(7," 1. \u6253\u958B Telegram App"),q(8,"br"),m(9," 2. \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC"),q(10,"br"),m(11," 3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u767B\u5165 "),g()(),p(12,"div",33)(13,"span",34),m(14,"\u6A21\u64EC\u8A2D\u5099:"),g(),p(15,"span",35),m(16),g()()),n&2){let t,i=_(2);h(),A(i.session().qrImageBase64?1:2),h(3),V("warning",i.countdown()<=10),h(),k(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A",i.countdown()," \u79D2 "),h(11),be("",(t=i.session().deviceInfo)==null?null:t.model," (",(t=i.session().deviceInfo)==null?null:t.system,")")}}function Xv(n,e){n&1&&(q(0,"span",21),m(1," \u9A57\u8B49\u4E2D... "))}function Zv(n,e){n&1&&m(0," \u78BA\u8A8D ")}function jv(n,e){if(n&1){let t=F();p(0,"div",23)(1,"div",37),m(2,"\u{1F510}"),g(),p(3,"h4"),m(4,"\u9700\u8981\u4E8C\u6B65\u9A57\u8B49"),g(),p(5,"p"),m(6,"\u8ACB\u8F38\u5165\u60A8\u7684\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF1A"),g(),p(7,"input",38),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.twoFactorInput,o)||(s.twoFactorInput=o),S(o)}),D("keyup.enter",function(){b(t);let o=_(2);return S(o.submit2FA())}),g(),p(8,"button",39),D("click",function(){b(t);let o=_(2);return S(o.submit2FA())}),T(9,Xv,2,0)(10,Zv,1,0),g()()}if(n&2){let t=_(2);h(7),_e("ngModel",t.twoFactorInput),h(),K("disabled",!t.twoFactorInput||t.isSubmitting2FA()),h(),A(t.isSubmitting2FA()?9:10)}}function eC(n,e){if(n&1&&m(0),n&2){let t=_(4);k(" ",t.session().userInfo.lastName," ")}}function tC(n,e){if(n&1&&(p(0,"div",48),m(1),g()),n&2){let t=_(4);h(),R("@"+t.session().userInfo.username)}}function nC(n,e){if(n&1&&(p(0,"div",41)(1,"div",44),m(2),g(),p(3,"div",45)(4,"div",46),m(5),T(6,eC,1,1),g(),p(7,"div",47),m(8),g(),T(9,tC,2,1,"div",48),g()()),n&2){let t=_(3);h(2),k(" ",(t.session().userInfo.firstName||"?").charAt(0).toUpperCase()," "),h(3),k(" ",t.session().userInfo.firstName," "),h(),A(t.session().userInfo.lastName?6:-1),h(2),R(t.session().phone),h(),A(t.session().userInfo.username?9:-1)}}function iC(n,e){if(n&1){let t=F();p(0,"div",24)(1,"div",40),m(2,"\u2705"),g(),p(3,"h4"),m(4,"\u767B\u5165\u6210\u529F\uFF01"),g(),T(5,nC,10,5,"div",41),p(6,"p",42),m(7,"\u5E33\u865F\u5DF2\u6210\u529F\u6DFB\u52A0\uFF0C\u6B63\u5728\u5F8C\u53F0\u5347\u7D1A\u70BA\u539F\u751F API..."),g(),p(8,"button",43),D("click",function(){b(t);let o=_(2);return S(o.onClose())}),m(9,"\u5B8C\u6210"),g()()}if(n&2){let t=_(2);h(5),A(t.session().userInfo?5:-1)}}function oC(n,e){if(n&1){let t=F();p(0,"div",25)(1,"div",37),m(2,"\u23F0"),g(),p(3,"h4"),m(4,"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"),g(),p(5,"p"),m(6,"\u8ACB\u9EDE\u64CA\u4E0B\u65B9\u6309\u9215\u91CD\u65B0\u751F\u6210\u3002"),g(),p(7,"button",49),D("click",function(){b(t);let o=_(2);return S(o.refreshQR())}),m(8,"\u{1F504} \u91CD\u65B0\u751F\u6210"),g()()}}function sC(n,e){if(n&1){let t=F();p(0,"div",25)(1,"div",50),m(2,"\u274C"),g(),p(3,"h4"),m(4,"\u767B\u5165\u5931\u6557"),g(),p(5,"p"),m(6),g(),p(7,"button",49),D("click",function(){b(t);let o=_(2);return S(o.refreshQR())}),m(8,"\u{1F504} \u91CD\u8A66"),g()()}if(n&2){let t=_(2);h(6),R(t.session().message||"\u672A\u77E5\u932F\u8AA4")}}function rC(n,e){if(n&1){let t=F();p(0,"div",26)(1,"button",51),D("click",function(){b(t);let o=_(2);return S(o.refreshQR())}),m(2," \u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC "),g(),p(3,"button",52),D("click",function(){b(t);let o=_(2);return S(o.cancelLogin())}),m(4," \u274C \u53D6\u6D88 "),g()()}}function aC(n,e){if(n&1&&(p(0,"div",22),T(1,Yv,17,6)(2,jv,11,3,"div",23)(3,iC,10,1,"div",24)(4,oC,9,0,"div",25)(5,sC,9,1,"div",25),g(),T(6,rC,5,0,"div",26)),n&2){let t,i=_();h(),A((t=i.session().status)==="pending"?1:t==="waiting_2fa"?2:t==="success"?3:t==="expired"?4:t==="error"?5:-1),h(5),A(i.session().status==="pending"?6:-1)}}var So=class n{constructor(){this.ipcService=O(Ie);this.toast=O(Ne);this.i18n=O(et);this.closed=new Vt;this.loginSuccess=new Vt;this.session=v(null);this.isCreating=v(!1);this.isSubmitting2FA=v(!1);this.countdown=v(60);this.deviceType=v("random");this.proxyInput="";this.twoFactorPassword="";this.twoFactorInput="";this.bindProxyToAccount=!0;this.selectedApi=v(null);this.countdownTimer=null;this.statusCheckTimer=null;this.createTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}onApiSelected(e){this.selectedApi.set(e)}onApiCleared(){this.selectedApi.set(null)}ngOnDestroy(){this.clearTimers(),this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.ipcChannels.forEach(e=>{this.ipcService.cleanup(e)}),this.ipcChannels=[]}setupIpcListeners(){this.ipcService.on("qr-login-created",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),console.log("[QR Login] QR code created successfully",e),e.success!==!1&&(this.session.set({sessionId:e.sessionId,qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,expiresIn:e.expiresIn,status:"pending",deviceInfo:e.deviceInfo,message:e.message}),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-created"),this.ipcService.on("qr-login-status",e=>{let t=this.session();t&&e.sessionId===t.sessionId&&this.session.set(N(M({},t),{status:e.status,message:e.message}))}),this.ipcChannels.push("qr-login-status"),this.ipcService.on("qr-login-success",e=>{this.clearTimers();let t=this.session();t&&this.session.set(N(M({},t),{status:"success",phone:e.phone,userInfo:e.userInfo,message:e.message})),this.toast.success(e.message||"\u767B\u5165\u6210\u529F\uFF01"),this.loginSuccess.emit(e)}),this.ipcChannels.push("qr-login-success"),this.ipcService.on("qr-login-refreshed",e=>{let t=this.session();t&&e.success!==!1&&(this.session.set(N(M({},t),{qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,status:"pending"})),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-refreshed"),this.ipcService.on("qr-login-error",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),this.isSubmitting2FA.set(!1),console.error("[QR Login] Error:",e.error);let t=this.session();t&&this.session.set(N(M({},t),{status:"error",message:e.error})),this.toast.error(e.error||"\u64CD\u4F5C\u5931\u6557")}),this.ipcChannels.push("qr-login-error"),this.ipcService.on("qr-login-2fa-success",e=>{this.isSubmitting2FA.set(!1)}),this.ipcChannels.push("qr-login-2fa-success")}createQRLogin(){let e=this.selectedApi();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API \u6191\u64DA");return}this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!0);let t={proxy:this.proxyInput||null,deviceType:this.deviceType()==="random"?null:this.deviceType(),twoFactorPassword:this.twoFactorPassword||null,bindProxy:this.bindProxyToAccount,customApiId:e.api_id,customApiHash:e.api_hash};console.log("[QR Login] Creating QR login...",N(M({},t),{customApiHash:"***"})),this.createTimeout=setTimeout(()=>{this.isCreating()&&(console.error("[QR Login] Timeout waiting for QR code generation (60s)"),this.isCreating.set(!1),this.toast.error(`\u751F\u6210\u4E8C\u7DAD\u78BC\u8D85\u6642\uFF0860\u79D2\uFF09\uFF0C\u8ACB\u6AA2\u67E5\uFF1A
1. \u5F8C\u7AEF\u65E5\u8A8C\u662F\u5426\u6709\u932F\u8AA4
2. \u7DB2\u7D61\u9023\u63A5\u662F\u5426\u6B63\u5E38
3. \u4EE3\u7406\u8A2D\u7F6E\u662F\u5426\u6B63\u78BA
4. \u662F\u5426\u5DF2\u5B89\u88DD telethon \u548C qrcode \u5EAB`),this.createTimeout=null)},6e4),this.ipcService.send("qr-login-create",t)}refreshQR(){let e=this.session();e?this.ipcService.send("qr-login-refresh",{sessionId:e.sessionId}):this.createQRLogin()}submit2FA(){let e=this.session();!e||!this.twoFactorInput||(this.isSubmitting2FA.set(!0),this.ipcService.send("qr-login-submit-2fa",{sessionId:e.sessionId,password:this.twoFactorInput}))}cancelLogin(){let e=this.session();e&&this.ipcService.send("qr-login-cancel",{sessionId:e.sessionId}),this.clearTimers(),this.session.set(null)}onClose(){this.cancelLogin(),this.closed.emit()}selectRandomProxy(){this.toast.info("\u4EE3\u7406\u6C60\u529F\u80FD\u5373\u5C07\u63A8\u51FA")}startCountdown(e){this.clearTimers(),this.countdown.set(e),this.countdownTimer=setInterval(()=>{let t=this.countdown();if(t<=1){this.clearTimers();let i=this.session();i&&i.status==="pending"&&this.session.set(N(M({},i),{status:"expired",message:"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"}))}else this.countdown.set(t-1)},1e3)}clearTimers(){this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null),this.statusCheckTimer&&(clearInterval(this.statusCheckTimer),this.statusCheckTimer=null)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-qr-login"]],outputs:{closed:"closed",loginSuccess:"loginSuccess"},decls:11,vars:1,consts:[[1,"qr-login-container"],[1,"header"],[1,"title"],[1,"icon"],[1,"close-btn",3,"click"],[1,"content"],[1,"setup-section"],[1,"info-box"],[1,"option-group"],[1,"option-label"],[3,"apiSelected","selectionCleared","showSelected"],[1,"device-options"],[1,"device-btn",3,"click"],[1,"proxy-input-group"],["type","text","placeholder","socks5://host:port \u6216\u7559\u7A7A\u4F7F\u7528\u76F4\u9023",1,"proxy-input",3,"ngModelChange","ngModel"],["title","\u96A8\u6A5F\u9078\u64C7\u4EE3\u7406",1,"random-proxy-btn",3,"click"],[1,"checkbox-option"],["type","checkbox","id","bindProxy",3,"ngModelChange","ngModel"],["for","bindProxy"],["type","password","placeholder","\u53EF\u9078\uFF0C\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49",1,"form-input",3,"ngModelChange","ngModel"],[1,"create-btn",3,"click","disabled"],[1,"spinner"],[1,"qr-section"],[1,"tfa-section"],[1,"success-section"],[1,"error-section"],[1,"action-buttons"],[1,"qr-display"],["alt","QR Code",1,"qr-image",3,"src"],[1,"qr-placeholder"],[1,"qr-info"],[1,"countdown"],[1,"instruction"],[1,"device-info"],[1,"label"],[1,"value"],[1,"spinner","large"],[1,"status-icon","warning"],["type","password","placeholder","\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input","tfa-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"submit-btn",3,"click","disabled"],[1,"status-icon","success"],[1,"user-info-card"],[1,"success-message"],[1,"done-btn",3,"click"],[1,"user-avatar"],[1,"user-details"],[1,"user-name"],[1,"user-phone"],[1,"user-username"],[1,"refresh-btn",3,"click"],[1,"status-icon","error"],[1,"action-btn","secondary",3,"click"],[1,"action-btn","cancel",3,"click"]],template:function(t,i){t&1&&(p(0,"div",0)(1,"div",1)(2,"h3",2)(3,"span",3),m(4,"\u{1F4F1}"),g(),m(5," \u6383\u78BC\u5FEB\u901F\u767B\u5165 "),g(),p(6,"button",4),D("click",function(){return i.onClose()}),m(7,"\xD7"),g()(),p(8,"div",5),T(9,zv,38,14,"div",6)(10,aC,7,2),g()()),t&2&&(h(9),A(i.session()?10:9))},dependencies:[de,Te,Le,On,Ve,Be,bo],styles:[".qr-login-container[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .95));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;width:420px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px -12px #00000080}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary, white)}.icon[_ngcontent-%COMP%]{font-size:1.25rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);font-size:1.5rem;cursor:pointer;padding:.25rem;line-height:1}.close-btn[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.content[_ngcontent-%COMP%]{padding:1.5rem}.setup-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.info-box[_ngcontent-%COMP%]{background:#06b6d41a;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:1rem}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-secondary, #cbd5e1);font-size:.875rem}.info-box[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.75rem;margin-top:.5rem}.option-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.option-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary, #cbd5e1)}.device-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem}.device-btn[_ngcontent-%COMP%]{padding:.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);font-size:.75rem;cursor:pointer;transition:all .2s}.device-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.device-btn.active[_ngcontent-%COMP%]{background:#06b6d433;border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.proxy-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.proxy-input[_ngcontent-%COMP%]{flex:1;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.proxy-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.random-proxy-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s}.random-proxy-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.checkbox-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.checkbox-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.create-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;margin-top:.5rem}.create-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.create-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.qr-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.qr-display[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:.75rem}.qr-image[_ngcontent-%COMP%]{width:200px;height:200px;display:block}.qr-placeholder[_ngcontent-%COMP%]{width:200px;height:200px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.qr-info[_ngcontent-%COMP%]{text-align:center}.countdown[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--primary, #06b6d4);margin-bottom:.5rem}.countdown.warning[_ngcontent-%COMP%]{color:#f59e0b;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.instruction[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-muted, #94a3b8);line-height:1.6;margin:0}.device-info[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.5rem 1rem;border-radius:.5rem}.device-info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-right:.5rem}.tfa-section[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:1rem}.status-icon[_ngcontent-%COMP%]{font-size:3rem}.status-icon.success[_ngcontent-%COMP%]{color:#22c55e}.status-icon.warning[_ngcontent-%COMP%]{color:#f59e0b}.status-icon.error[_ngcontent-%COMP%]{color:#ef4444}.tfa-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.tfa-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-muted, #94a3b8);font-size:.875rem}.tfa-input[_ngcontent-%COMP%]{max-width:250px;text-align:center}.submit-btn[_ngcontent-%COMP%], .done-btn[_ngcontent-%COMP%], .refresh-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.refresh-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.user-info-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;width:100%}.user-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:700;color:#fff}.user-details[_ngcontent-%COMP%]{text-align:left}.user-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.user-phone[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.user-username[_ngcontent-%COMP%]{font-size:.75rem;color:var(--primary, #06b6d4)}.success-message[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem;width:100%}.action-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1rem;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;font-size:.875rem;cursor:pointer;transition:all .2s}.action-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-secondary, #cbd5e1)}.action-btn.secondary[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.action-btn.cancel[_ngcontent-%COMP%]{background:#ef44441a;border-color:#ef44444d;color:#fca5a5}.action-btn.cancel[_ngcontent-%COMP%]:hover{background:#ef444433}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.spinner.large[_ngcontent-%COMP%]{width:40px;height:40px;border-width:3px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.warning-box[_ngcontent-%COMP%]{background:#ef444426;border:1px solid rgba(239,68,68,.4);border-radius:.75rem;overflow:hidden}.warning-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#ef444433;border-bottom:1px solid rgba(239,68,68,.3)}.warning-icon[_ngcontent-%COMP%]{font-size:1.25rem}.warning-title[_ngcontent-%COMP%]{flex:1;font-weight:600;color:#fca5a5}.dismiss-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fca5a5;font-size:1.25rem;cursor:pointer;padding:0;line-height:1}.warning-content[_ngcontent-%COMP%]{padding:.75rem 1rem}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#fecaca;font-size:.8rem}.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:.5rem 0;padding-left:1.25rem;color:#fca5a5;font-size:.75rem}.warning-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.warning-action[_ngcontent-%COMP%]{margin-top:.75rem!important;padding-top:.5rem;border-top:1px solid rgba(239,68,68,.2)}.warning-action[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa;text-decoration:underline}.api-section[_ngcontent-%COMP%]{background:#06b6d40d;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:.75rem}.option-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.checkbox-option.inline[_ngcontent-%COMP%]{font-size:.75rem}.api-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.api-input-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.input-label[_ngcontent-%COMP%]{width:70px;font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-input-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1}.api-hint[_ngcontent-%COMP%]{margin:0;font-size:.7rem;color:var(--text-muted, #64748b)}.api-hint[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.public-api-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#ef44441a;border-radius:.25rem;font-size:.75rem;color:#fca5a5}.warning-badge[_ngcontent-%COMP%]{background:#ef44444d;padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}"]})}};var wo=(n,e)=>e.key,lC=(n,e)=>e.id,cC=(n,e)=>e.test_id,dC=(n,e)=>e.name;function uC(n,e){if(n&1){let t=F();p(0,"button",53),D("click",function(){let o=b(t).$implicit,s=_(3);return S(s.filterTemplateCategory.set(o.key))}),m(1),g()}if(n&2){let t=e.$implicit,i=_(3);V("bg-blue-500",i.filterTemplateCategory()===t.key)("text-white",i.filterTemplateCategory()===t.key)("bg-slate-700",i.filterTemplateCategory()!==t.key)("text-slate-400",i.filterTemplateCategory()!==t.key),h(),be(" ",t.icon," ",t.label," ")}}function mC(n,e){n&1&&(p(0,"div",50),j(),p(1,"svg",54),q(2,"circle",55)(3,"path",56),g(),ce(),p(4,"span",57),m(5,"\u8F09\u5165\u6A21\u677F..."),g()())}function pC(n,e){n&1&&(p(0,"div",51)(1,"p"),m(2,"\u6C92\u6709\u627E\u5230\u6A21\u677F"),g(),p(3,"p",58),m(4,"\u8ACB\u5148\u5230\u300C\u804A\u5929\u6A21\u677F\u300D\u9801\u9762\u5275\u5EFA\u6A21\u677F"),g()())}function gC(n,e){if(n&1){let t=F();p(0,"button",60),D("click",function(){let o=b(t).$implicit,s=_(4);return S(s.selectTemplate(o))}),p(1,"div",61)(2,"span",62),m(3),g(),p(4,"span",23),m(5),g()(),p(6,"p",63),m(7),g()()}if(n&2){let t,i,o,s,r,l=e.$implicit,d=_(4);V("border-blue-500",((t=d.selectedTemplate())==null?null:t.id)===l.id)("bg-blue-500/10",((i=d.selectedTemplate())==null?null:i.id)===l.id)("border-slate-600",((o=d.selectedTemplate())==null?null:o.id)!==l.id)("bg-slate-800/50",((s=d.selectedTemplate())==null?null:s.id)!==l.id)("hover:border-slate-500",((r=d.selectedTemplate())==null?null:r.id)!==l.id),h(3),R(l.name),h(2),k("\u4F7F\u7528 ",l.usageCount," \u6B21"),h(2),R(l.content)}}function hC(n,e){if(n&1&&(p(0,"div",52),X(1,gC,8,13,"button",59,lC),g()),n&2){let t=_(3);h(),Z(t.filteredTemplates())}}function fC(n,e){if(n&1){let t=F();p(0,"div",17)(1,"div",45)(2,"label",46),m(3,"\u9078\u64C7\u804A\u5929\u6A21\u677F"),g(),p(4,"button",47),D("click",function(){b(t);let o=_(2);return S(o.loadTemplates())}),m(5," \u{1F504} \u5237\u65B0 "),g()(),p(6,"div",48),X(7,uC,2,10,"button",49,wo),g(),T(9,mC,6,0,"div",50)(10,pC,5,0,"div",51)(11,hC,3,0,"div",52),g()}if(n&2){let t=_(2);h(7),Z(t.templateCategories),h(2),A(t.isLoadingTemplates()?9:t.filteredTemplates().length===0?10:11)}}function _C(n,e){if(n&1&&(q(0,"span",73),p(1,"span"),m(2),g()),n&2){let t=_(4);h(2),k("\u5DF2\u9023\u63A5 ",t.aiStatus().model)}}function vC(n,e){n&1&&(q(0,"span",74),p(1,"span"),m(2,"\u4F7F\u7528\u672C\u5730\u6A21\u677F"),g())}function CC(n,e){if(n&1&&(p(0,"div",72),T(1,_C,3,1)(2,vC,3,0),g()),n&2){let t=_(3);V("bg-green-500/20",t.aiStatus().connected)("text-green-400",t.aiStatus().connected)("bg-amber-500/20",!t.aiStatus().connected)("text-amber-400",!t.aiStatus().connected),h(),A(t.aiStatus().connected?1:2)}}function yC(n,e){if(n&1){let t=F();p(0,"button",75),D("click",function(){let o=b(t).$implicit,s=_(3);return S(s.selectedAiStyle.set(o.key))}),m(1),g()}if(n&2){let t=e.$implicit,i=_(3);V("bg-purple-500",i.selectedAiStyle()===t.key)("text-white",i.selectedAiStyle()===t.key)("bg-slate-700",i.selectedAiStyle()!==t.key)("text-slate-400",i.selectedAiStyle()!==t.key),h(),k(" ",t.label," ")}}function bC(n,e){n&1&&(j(),p(0,"svg",76),q(1,"circle",55)(2,"path",56),g(),m(3," \u751F\u6210\u4E2D... "))}function SC(n,e){n&1&&m(0," \u2728 \u751F\u6210 5 \u7A2E\u4E0D\u540C\u8868\u9054 ")}function xC(n,e){if(n&1){let t=F();p(0,"label",83)(1,"input",84),D("change",function(){let o=b(t).$implicit,s=_(4);return S(s.toggleMessageSelection(o))}),g(),p(2,"span",85),m(3),g()()}if(n&2){let t=e.$implicit,i=_(4);V("border-purple-500",i.isMessageSelected(t))("bg-purple-500/10",i.isMessageSelected(t))("border-slate-600",!i.isMessageSelected(t))("bg-slate-800/50",!i.isMessageSelected(t)),h(),K("checked",i.isMessageSelected(t)),h(2),R(t)}}function wC(n,e){if(n&1){let t=F();p(0,"button",90),D("click",function(){let o=b(t).$implicit,s=_(5);return S(s.setSendStrategy(o.key))}),m(1),g()}if(n&2){let t=e.$implicit,i=_(5);V("bg-purple-500",i.sendStrategy()===t.key)("text-white",i.sendStrategy()===t.key)("bg-slate-700",i.sendStrategy()!==t.key)("text-slate-400",i.sendStrategy()!==t.key),K("title",t.desc),h(),k(" ",t.label," ")}}function EC(n,e){if(n&1&&(p(0,"div",81)(1,"span",86),m(2,"\u{1F4E4} \u767C\u9001\u7B56\u7565\uFF1A"),g(),p(3,"div",87),X(4,wC,2,10,"button",88,wo),g(),p(6,"p",89),m(7),g()()),n&2){let t=_(4);h(4),Z(t.sendStrategies),h(3),k(" ",t.getStrategyDescription()," ")}}function TC(n,e){if(n&1){let t=F();p(0,"button",90),D("click",function(){let o=b(t).$implicit,s=_(5);return S(s.abTestId.set(o.test_id))}),m(1),g()}if(n&2){let t=e.$implicit,i=_(5);V("bg-purple-500",i.abTestId()===t.test_id)("text-white",i.abTestId()===t.test_id)("bg-slate-700/50",i.abTestId()!==t.test_id)("text-slate-400",i.abTestId()!==t.test_id),K("title","\u4F7F\u7528 A/B \u6E2C\u8A66: "+t.name),h(),k(" \u{1F9EA} ",t.name," ")}}function AC(n,e){n&1&&(p(0,"p",94),m(1," \u5C07\u7531\u5F8C\u7AEF A/B \u6E2C\u8A66\u5F15\u64CE\u81EA\u52D5\u9078\u64C7\u6A21\u677F\u8B8A\u9AD4\u4E26\u8A18\u9304\u6548\u679C "),g())}function DC(n,e){if(n&1){let t=F();p(0,"div",82)(1,"span",91),m(2,"\u{1F9EA} A/B \u6E2C\u8A66\uFF08\u53EF\u9078\uFF09\uFF1A"),g(),p(3,"div",87)(4,"button",92),D("click",function(){b(t);let o=_(4);return S(o.abTestId.set(""))}),m(5," \u4E0D\u4F7F\u7528 "),g(),X(6,TC,2,10,"button",93,cC),g(),T(8,AC,2,0,"p",94),g()}if(n&2){let t=_(4);h(4),V("bg-slate-600",!t.abTestId())("text-white",!t.abTestId())("bg-slate-700/50",t.abTestId())("text-slate-400",t.abTestId()),h(2),Z(t.abTests()),h(2),A(t.abTestId()?8:-1)}}function MC(n,e){if(n&1){let t=F();p(0,"div",71)(1,"div",5)(2,"span",77),m(3),g(),p(4,"div",15)(5,"button",78),D("click",function(){b(t);let o=_(3);return S(o.selectAllMessages())}),m(6," \u5168\u9078 "),g(),p(7,"button",79),D("click",function(){b(t);let o=_(3);return S(o.clearSelectedMessages())}),m(8," \u6E05\u9664 "),g()()(),X(9,xC,4,10,"label",80,Bt),T(11,EC,8,1,"div",81),T(12,DC,9,9,"div",82),g()}if(n&2){let t=_(3);h(3),k("\u53EF\u591A\u9078\u6A21\u677F\uFF08\u5DF2\u9078 ",t.selectedMessages().size," \u500B\uFF09\uFF1A"),h(6),Z(t.aiGeneratedMessages()),h(2),A(t.selectedMessages().size>1?11:-1),h(),A(t.abTestsLoaded()&&t.abTests().length>0&&t.selectedMessages().size>1?12:-1)}}function IC(n,e){if(n&1){let t=F();p(0,"div",18)(1,"div",45)(2,"label",64),m(3,"\u{1F916} AI \u667A\u80FD\u751F\u6210"),g(),T(4,CC,3,9,"div",65),g(),p(5,"div",66)(6,"div")(7,"span",67),m(8,"\u8A9E\u8A00\u98A8\u683C\uFF1A"),g(),p(9,"div",37),X(10,yC,2,9,"button",68,wo),g()(),p(12,"div")(13,"span",67),m(14,"\u6D88\u606F\u4E3B\u984C\uFF1A"),g(),p(15,"input",69),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.aiTopic,o)||(s.aiTopic=o),S(o)}),g()(),p(16,"button",70),D("click",function(){b(t);let o=_(2);return S(o.generateAiMessage())}),T(17,bC,4,0)(18,SC,1,0),g(),T(19,MC,13,3,"div",71),g()()}if(n&2){let t=_(2);h(4),A(t.aiStatus().source!=="unknown"?4:-1),h(6),Z(t.aiStyles),h(5),_e("ngModel",t.aiTopic),h(),K("disabled",t.isGeneratingAi()||!t.aiTopic.trim()),h(),A(t.isGeneratingAi()?17:18),h(2),A(t.aiGeneratedMessages().length>0?19:-1)}}function kC(n,e){if(n&1&&(p(0,"span",20),m(1),g()),n&2){let t,i=_(2);h(),k("\uFF08\u4F7F\u7528\u6A21\u677F\uFF1A",(t=i.selectedTemplate())==null?null:t.name,"\uFF09")}}function PC(n,e){if(n&1){let t=F();p(0,"button",95),D("click",function(){let o=b(t).$implicit,s=_(2);return S(s.insertVariable(o.key))}),p(1,"span",31),m(2),g(),p(3,"span",96),m(4,"|"),g(),p(5,"span",97),m(6),g()()}if(n&2){let t=e.$implicit;K("title","\u63D2\u5165 "+t.key),h(2),R(t.key),h(4),R(t.label)}}function NC(n,e){if(n&1){let t=F();p(0,"div",98)(1,"span",99),m(2),g(),p(3,"span",100),m(4),g(),p(5,"button",101),D("click",function(){let o=b(t).$index,s=_(3);return S(s.removeAttachment(o))}),j(),p(6,"svg",102),q(7,"path",12),g()()()}if(n&2){let t=e.$implicit;h(2),R(t.type.startsWith("image")?"\u{1F5BC}\uFE0F":"\u{1F4C4}"),h(2),R(t.name)}}function RC(n,e){if(n&1&&(p(0,"div",27),X(1,NC,8,2,"div",98,dC),g()),n&2){let t=_(2);h(),Z(t.attachments())}}function FC(n,e){if(n&1&&(p(0,"span",38),m(1),g()),n&2){let t=e.$implicit;h(),k(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function LC(n,e){if(n&1&&(p(0,"span",39),m(1),g()),n&2){let t=_(2);h(),k(" +",t.targets().length-20," \u66F4\u591A... ")}}function VC(n,e){if(n&1&&(p(0,"div",108),m(1),g()),n&2){let t=_(3);h(),k(" \u{1F4E8} \u6B63\u5728\u767C\u9001\u7D66: ",t.currentTarget()," ")}}function BC(n,e){if(n&1&&(p(0,"span",111),m(1),g()),n&2){let t=e.$implicit;h(),be(" ",t.label,": ",t.count," ")}}function OC(n,e){if(n&1&&(p(0,"div",109)(1,"div",110),m(2,"\u5931\u6557\u539F\u56E0\uFF1A"),g(),p(3,"div",37),X(4,BC,2,2,"span",111,Bt),g()()),n&2){let t=_(3);h(4),Z(t.failureReasonsList())}}function GC(n,e){if(n&1&&(p(0,"div",40)(1,"div",103)(2,"span",104),m(3,"\u767C\u9001\u9032\u5EA6"),g(),p(4,"span",9),m(5),g()(),p(6,"div",105),q(7,"div",106),g(),p(8,"div",107)(9,"span"),m(10),g(),p(11,"span"),m(12),g(),p(13,"span"),m(14),g()(),T(15,VC,2,1,"div",108),T(16,OC,6,0,"div",109),g()),n&2){let t=_(2);h(5),be("",t.sentCount()," / ",t.targets().length),h(2),me("width",t.progressPercent(),"%"),h(3),k("\u2705 \u6210\u529F: ",t.successCount()),h(2),k("\u274C \u5931\u6557: ",t.failedCount()),h(2),k("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining()),h(),A(t.currentTarget()?15:-1),h(),A(t.failedCount()>0&&t.failureReasonsList().length>0?16:-1)}}function UC(n,e){n&1&&(p(0,"span",112),m(1,"\u23F3"),g(),m(2," \u767C\u9001\u4E2D... "))}function qC(n,e){if(n&1&&m(0),n&2){let t=_(2);k(" \u{1F4E8} \u958B\u59CB\u767C\u9001 (",t.targets().length," \u4EBA) ")}}function $C(n,e){if(n&1){let t=F();p(0,"div",2),D("click",function(o){b(t);let s=_();return S(s.onBackdropClick(o))}),p(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),m(6," \u{1F4E8} "),g(),p(7,"div")(8,"h2",8),m(9,"\u6279\u91CF\u767C\u9001\u6D88\u606F"),g(),p(10,"p",9),m(11),g()()(),p(12,"button",10),D("click",function(){b(t);let o=_();return S(o.close())}),j(),p(13,"svg",11),q(14,"path",12),g()()()(),ce(),p(15,"div",13)(16,"div")(17,"label",14),m(18," \u{1F4DD} \u6D88\u606F\u4F86\u6E90 "),g(),p(19,"div",15)(20,"button",16),D("click",function(){b(t);let o=_();return S(o.setMessageSource("template"))}),m(21," \u{1F4C4} \u804A\u5929\u6A21\u677F "),g(),p(22,"button",16),D("click",function(){b(t);let o=_();return S(o.setMessageSource("custom"))}),m(23," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),g(),p(24,"button",16),D("click",function(){b(t);let o=_();return S(o.setMessageSource("ai"))}),m(25," \u{1F916} AI \u751F\u6210 "),g()()(),T(26,fC,12,1,"div",17),T(27,IC,20,5,"div",18),p(28,"div")(29,"label",19),m(30," \u{1F4DD} \u6D88\u606F\u5167\u5BB9 "),T(31,kC,2,1,"span",20),g(),p(32,"textarea",21),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.messageContent,o)||(s.messageContent=o),S(o)}),m(33,"              "),g(),p(34,"div",22)(35,"span",23),m(36,"\u53EF\u7528\u8B8A\u91CF\uFF1A"),g(),X(37,PC,7,3,"button",24,wo),g()(),p(39,"div")(40,"label",19),m(41," \u{1F4CE} \u9644\u4EF6\uFF08\u53EF\u9078\uFF09 "),g(),p(42,"div",25)(43,"button",26),D("click",function(){b(t);let o=_();return S(o.selectImages())}),m(44," \u{1F5BC}\uFE0F \u6DFB\u52A0\u5716\u7247 "),g(),p(45,"button",26),D("click",function(){b(t);let o=_();return S(o.selectFiles())}),m(46," \u{1F4C4} \u6DFB\u52A0\u6587\u4EF6 "),g()(),T(47,RC,3,0,"div",27),g(),p(48,"div",17)(49,"label",14),m(50," \u2699\uFE0F \u767C\u9001\u8A2D\u7F6E "),g(),p(51,"div",28)(52,"div",6)(53,"span",29),m(54,"\u767C\u9001\u9593\u9694\uFF1A"),g(),p(55,"input",30),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.minInterval,o)||(s.minInterval=o),S(o)}),g(),p(56,"span",31),m(57,"-"),g(),p(58,"input",32),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.maxInterval,o)||(s.maxInterval=o),S(o)}),g(),p(59,"span",9),m(60,"\u79D2\uFF08\u96A8\u6A5F\uFF09"),g()(),p(61,"div",6)(62,"span",29),m(63,"\u5E33\u865F\u8F2A\u63DB\uFF1A"),g(),p(64,"label",33)(65,"input",34),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.accountRotation,o)||(s.accountRotation=o),S(o)}),g(),q(66,"div",35),g(),p(67,"span",9),m(68,"\u555F\u7528\u591A\u5E33\u865F\u8F2A\u63DB\u767C\u9001"),g()()()(),p(69,"div")(70,"label",19),m(71),g(),p(72,"div",36)(73,"div",37),X(74,FC,2,1,"span",38,Bt),T(76,LC,2,1,"span",39),g()()()(),T(77,GC,17,9,"div",40),p(78,"div",41)(79,"button",42),D("click",function(){b(t);let o=_();return S(o.close())}),m(80),g(),p(81,"button",43),D("click",function(){b(t);let o=_();return S(o.previewMessage())}),m(82," \u{1F441}\uFE0F \u9810\u89BD "),g(),p(83,"button",44),D("click",function(){b(t);let o=_();return S(o.startSending())}),T(84,UC,3,0)(85,qC,1,1),g()()()()}if(n&2){let t=_();h(11),k("\u5411 ",t.targets().length," \u500B\u7528\u6236\u767C\u9001\u6D88\u606F"),h(9),V("border-blue-500",t.messageSource()==="template")("bg-blue-500/20",t.messageSource()==="template")("text-blue-400",t.messageSource()==="template")("border-slate-600",t.messageSource()!=="template")("bg-slate-800/50",t.messageSource()!=="template")("text-slate-400",t.messageSource()!=="template"),h(2),V("border-cyan-500",t.messageSource()==="custom")("bg-cyan-500/20",t.messageSource()==="custom")("text-cyan-400",t.messageSource()==="custom")("border-slate-600",t.messageSource()!=="custom")("bg-slate-800/50",t.messageSource()!=="custom")("text-slate-400",t.messageSource()!=="custom"),h(2),V("border-purple-500",t.messageSource()==="ai")("bg-purple-500/20",t.messageSource()==="ai")("text-purple-400",t.messageSource()==="ai")("border-slate-600",t.messageSource()!=="ai")("bg-slate-800/50",t.messageSource()!=="ai")("text-slate-400",t.messageSource()!=="ai"),h(2),A(t.messageSource()==="template"?26:-1),h(),A(t.messageSource()==="ai"?27:-1),h(4),A(t.messageSource()==="template"&&t.selectedTemplate()?31:-1),h(),_e("ngModel",t.messageContent),h(5),Z(t.availableVariables),h(10),A(t.attachments().length>0?47:-1),h(8),_e("ngModel",t.minInterval),h(3),_e("ngModel",t.maxInterval),h(7),_e("ngModel",t.accountRotation),h(6),k(" \u{1F465} \u767C\u9001\u76EE\u6A19\uFF08",t.targets().length," \u4EBA\uFF09 "),h(3),Z(t.targets().slice(0,20)),h(2),A(t.targets().length>20?76:-1),h(),A(t.isSending()?77:-1),h(2),K("disabled",t.isSending()),h(),k(" ",t.isSending()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),h(),K("disabled",!t.canSend()||t.isSending()),h(2),K("disabled",!t.canSend()||t.isSending()),h(),A(t.isSending()?84:85)}}function HC(n,e){if(n&1&&(p(0,"div",116),m(1),g()),n&2){let t=_(2);h(),k(" \u{1F4CE} \u5305\u542B ",t.attachments().length," \u500B\u9644\u4EF6 ")}}function KC(n,e){if(n&1){let t=F();p(0,"div",1)(1,"div",113)(2,"h3",114),m(3,"\u{1F4F1} \u6D88\u606F\u9810\u89BD"),g(),p(4,"div",115),m(5),g(),T(6,HC,2,1,"div",116),p(7,"button",117),D("click",function(){b(t);let o=_();return S(o.showPreview.set(!1))}),m(8," \u95DC\u9589 "),g()()()}if(n&2){let t=_();h(5),k(" ",t.previewText()," "),h(),A(t.attachments().length>0?6:-1)}}var xo=class n{constructor(){this.ipc=O(Ie);this.toast=O(Ne);this.bizApi=O(zn);this.listeners=[];this.isOpen=se(!1);this.targets=se([]);this.closeDialog=Q();this.sendComplete=Q();this.messageSource=v("custom");this.chatTemplates=v([]);this.isLoadingTemplates=v(!1);this.selectedTemplate=v(null);this.filterTemplateCategory=v("all");this.templateCategories=[{key:"all",icon:"\u{1F4CB}",label:"\u5168\u90E8"},{key:"greeting",icon:"\u{1F44B}",label:"\u554F\u5019\u8A9E"},{key:"follow_up",icon:"\u{1F4E9}",label:"\u8DDF\u9032\u6D88\u606F"},{key:"promotion",icon:"\u{1F4E2}",label:"\u63A8\u5EE3\u6D88\u606F"},{key:"custom",icon:"\u270F\uFE0F",label:"\u81EA\u5B9A\u7FA9"}];this.filteredTemplates=G(()=>{let e=this.filterTemplateCategory(),t=this.chatTemplates();return e==="all"?t.filter(i=>i.isEnabled):t.filter(i=>i.isEnabled&&i.category===e)});this.selectedAiStyle=v("friendly");this.aiTopic="";this.isGeneratingAi=v(!1);this.aiGeneratedMessages=v([]);this.aiStatus=v({connected:!1,model:null,source:"unknown"});this.selectedMessages=v(new Set);this.sendStrategy=v("random");this.sendStrategies=[{key:"random",label:"\u{1F3B2} \u96A8\u6A5F\u767C\u9001",desc:"\u6BCF\u500B\u7528\u6236\u96A8\u6A5F\u9078\u64C7\u4E00\u500B\u6A21\u677F"},{key:"rotate",label:"\u{1F504} \u8F2A\u8F49\u767C\u9001",desc:"\u4F9D\u6B21\u4F7F\u7528\u6A21\u677F\uFF081\u21922\u21923\u21921...\uFF09"},{key:"sequential",label:"\u{1F4CB} \u9806\u5E8F\u767C\u9001",desc:"\u6309\u9806\u5E8F\u7528\u5B8C\u518D\u91CD\u8907"}];this.abTestId=v("");this.abTests=v([]);this.abTestsLoaded=v(!1);this.aiStyles=[{key:"friendly",label:"\u53CB\u597D\u89AA\u5207"},{key:"formal",label:"\u6B63\u5F0F\u5546\u52D9"},{key:"humorous",label:"\u8F15\u9B06\u5E7D\u9ED8"},{key:"concise",label:"\u7C21\u6F54\u660E\u4E86"},{key:"enthusiastic",label:"\u71B1\u60C5\u6D0B\u6EA2"}];this.messageContent="";this.attachments=v([]);this.minInterval=30;this.maxInterval=60;this.accountRotation=!0;this.availableVariables=[{key:"{firstName}",label:"\u540D\u5B57"},{key:"{lastName}",label:"\u59D3\u6C0F"},{key:"{username}",label:"\u7528\u6236\u540D"},{key:"{name}",label:"\u986F\u793A\u540D"},{key:"{fullName}",label:"\u5168\u540D"},{key:"{groupName}",label:"\u4F86\u6E90\u7FA4\u7D44"},{key:"{keyword}",label:"\u89F8\u767C\u95DC\u9375\u8A5E"},{key:"{source}",label:"\u4F86\u6E90\u6E20\u9053"},{key:"{greeting}",label:"\u554F\u5019\u8A9E"},{key:"{date}",label:"\u65E5\u671F"},{key:"{time}",label:"\u6642\u9593"},{key:"{day}",label:"\u661F\u671F"}];this.isSending=v(!1);this.sentCount=v(0);this.successCount=v(0);this.failedCount=v(0);this.currentTarget=v("");this.failureReasons=v({});this.failureReasonLabels={privacy_restricted:"\u{1F512} \u96B1\u79C1\u9650\u5236",flood_wait:"\u23F1\uFE0F API \u9650\u5236",user_not_found:"\u2753 \u7528\u6236\u4E0D\u5B58\u5728",user_blocked:"\u{1F6AB} \u88AB\u5C01\u9396",invalid_id:"\u26A0\uFE0F \u7121\u6548 ID",no_account:"\u{1F4F1} \u7121\u53EF\u7528\u5E33\u865F",cancelled:"\u23F9\uFE0F \u5DF2\u53D6\u6D88",other:"\u274C \u5176\u4ED6\u932F\u8AA4"};this.showPreview=v(!1);this.progressPercent=G(()=>{let e=this.targets().length;return e>0?this.sentCount()/e*100:0});this.failureReasonsList=G(()=>{let e=this.failureReasons();return Object.keys(e).map(t=>({key:t,label:this.failureReasonLabels[t]||t,count:e[t]}))});this.estimatedRemaining=G(()=>{let e=this.targets().length-this.sentCount(),t=(this.minInterval+this.maxInterval)/2,i=e*t;return i<60?`${Math.round(i)} \u79D2`:i<3600?`${Math.round(i/60)} \u5206\u9418`:`${Math.round(i/3600)} \u5C0F\u6642`});this.previewText=G(()=>{let e=this.targets()[0]||{};return this.replaceVariables(this.messageContent,e)});this.aiGenerateTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadTemplates(),this.loadABTests()}async loadABTests(){try{let e=await this.bizApi.loadABTests();this.abTests.set(e.filter(t=>t.status==="running")),this.abTestsLoaded.set(!0)}catch{this.abTestsLoaded.set(!0)}}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-send:progress",s=>{this.sentCount.set(s.sent),this.successCount.set(s.success),this.failedCount.set(s.failed),s.currentTarget&&this.currentTarget.set(s.currentTarget),s.failureReasons&&this.failureReasons.set(s.failureReasons)});this.listeners.push(e);let t=this.ipc.on("batch-send:complete",s=>{if(this.isSending.set(!1),this.sendComplete.emit({success:s.success,failed:s.failed}),s.error)this.toast.error(`\u274C \u767C\u9001\u5931\u6557\uFF1A${s.error}`);else if(s.failed>0){let r=s.failureSummary||`\u5931\u6557 ${s.failed} \u500B`;this.toast.warning(`\u26A0\uFE0F \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${s.success}\uFF0C${r}`)}else this.toast.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${s.success} \u500B`);s.failureReasons&&this.failureReasons.set(s.failureReasons)});this.listeners.push(t);let i=this.ipc.on("get-chat-templates-result",s=>{this.isLoadingTemplates.set(!1),s.templates&&this.chatTemplates.set(s.templates)});this.listeners.push(i);let o=this.ipc.on("ai-generate-message-result",s=>{console.log("[AI] \u6536\u5230\u751F\u6210\u7D50\u679C:",s),this.aiGenerateTimeout&&(clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=null),this.isGeneratingAi.set(!1),s.success&&s.messages?(this.aiGeneratedMessages.set(s.messages),s.source==="ai"&&s.model?(this.aiStatus.set({connected:!0,model:s.model,source:"ai"}),this.toast.success(`\u{1F916} ${s.model} \u751F\u6210\u4E86 ${s.messages.length} \u689D\u6D88\u606F\uFF01`)):(this.aiStatus.set({connected:!1,model:null,source:"local"}),this.toast.info("\u{1F4CB} \u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F\u751F\u6210\u6D88\u606F"))):this.toast.error(s.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(o)}setMessageSource(e){this.messageSource.set(e),e==="template"&&this.loadTemplates()}loadTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectTemplate(e){this.selectedTemplate.set(e),this.messageContent=e.content,this.toast.info(`\u5DF2\u9078\u64C7\u6A21\u677F\uFF1A${e.name}`)}generateAiMessage(){if(!this.aiTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingAi.set(!0),this.aiGeneratedMessages.set([]),this.aiGenerateTimeout&&clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=setTimeout(()=>{this.isGeneratingAi()&&(this.isGeneratingAi.set(!1),this.toast.warning("AI \u751F\u6210\u8D85\u6642\uFF0C\u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F"),this.useLocalAiTemplates())},1e4),console.log("[AI] \u767C\u9001\u751F\u6210\u8ACB\u6C42:",{topic:this.aiTopic,style:this.selectedAiStyle()}),this.ipc.send("ai-generate-message",{topic:this.aiTopic,style:this.selectedAiStyle(),count:5,context:{targetCount:this.targets().length,sampleTarget:this.targets()[0]}})}useLocalAiTemplates(){let e=this.aiTopic||"\u6253\u62DB\u547C",t=this.selectedAiStyle(),i={friendly:["{greeting}\uFF01\u6211\u662F\u5728\u7FA4\u88E1\u770B\u5230\u4F60\u7684\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B~","Hi {name}\uFF01\u5F88\u9AD8\u8208\u80FD\u8A8D\u8B58\u4F60\uFF0C\u5E0C\u671B\u4EE5\u5F8C\u591A\u591A\u4EA4\u6D41 \u{1F60A}","{greeting}{name}\uFF0C\u6211\u89BA\u5F97\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u8A71\u984C\uFF0C\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F","\u55E8\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u60F3\u8DDF\u4F60\u4EA4\u500B\u670B\u53CB~",`{greeting}\uFF01\u6211\u662F${e}\u76F8\u95DC\u7684\uFF0C\u770B\u5230\u4F60\u4E5F\u5C0D\u9019\u500B\u611F\u8208\u8DA3\uFF1F`],formal:["{greeting}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u60A8\u3002\u6211\u6CE8\u610F\u5230\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u7684\u8208\u8DA3\u9EDE\uFF0C\u4E0D\u77E5\u662F\u5426\u65B9\u4FBF\u4EA4\u6D41\uFF1F",`\u60A8\u597D {name}\uFF0C\u5192\u6627\u6253\u64FE\u3002\u6211\u5C08\u6CE8\u65BC${e}\u9818\u57DF\uFF0C\u5E0C\u671B\u80FD\u8207\u60A8\u5EFA\u7ACB\u806F\u7E6B\u3002`,"{greeting}\uFF0C\u6211\u662F\u901A\u904E\u7FA4\u7D44\u8A8D\u8B58\u5230\u60A8\u7684\u3002\u5982\u6709\u5408\u4F5C\u6A5F\u6703\uFF0C\u671F\u5F85\u9032\u4E00\u6B65\u6E9D\u901A\u3002","\u5C0A\u656C\u7684 {name}\uFF0C\u5F88\u69AE\u5E78\u80FD\u5920\u8207\u60A8\u53D6\u5F97\u806F\u7E6B\u3002\u671F\u5F85\u672A\u4F86\u6709\u6A5F\u6703\u5408\u4F5C\u3002",`{greeting}\uFF0C\u6211\u5C0D${e}\u5F88\u611F\u8208\u8DA3\uFF0C\u770B\u5230\u60A8\u4E5F\u5728\u9019\u500B\u9818\u57DF\uFF0C\u60F3\u5411\u60A8\u8ACB\u6559\u3002`],humorous:["{greeting}\uFF01\u6211\u4E0D\u662F\u63A8\u92B7\u54E1\uFF0C\u53EA\u662F\u89BA\u5F97\u4F60\u770B\u8D77\u4F86\u5F88\u9177\u60F3\u8A8D\u8B58\u4E00\u4E0B \u{1F60E}",`Hi {name}\uFF01\u5225\u64D4\u5FC3\uFF0C\u6211\u53EA\u662F\u60F3\u804A\u804A${e}\u800C\u5DF2\uFF0C\u4E0D\u6703\u63A8\u92B7\u4EFB\u4F55\u6771\u897F \u{1F923}`,`{greeting}\uFF01\u80FD\u9047\u5230\u5C0D${e}\u611F\u8208\u8DA3\u7684\u4EBA\u771F\u662F\u592A\u96E3\u5F97\u4E86\uFF01`,"\u55E8\uFF01\u770B\u5230\u4F60\u5728\u7FA4\u88E1\u7684\u767C\u8A00\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u5FCD\u4E0D\u4F4F\u4F86\u6253\u500B\u62DB\u547C~","{greeting}\uFF01\u96E3\u5F97\u9047\u5230\u540C\u597D\uFF0C\u5FC5\u9808\u8A8D\u8B58\u4E00\u4E0B\uFF01"],concise:["{greeting}\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B\u3002",`Hi {name}\uFF0C\u95DC\u65BC${e}\u60F3\u548C\u4F60\u804A\u804A\u3002`,`\u60A8\u597D\uFF0C\u770B\u5230\u4F60\u5C0D${e}\u611F\u8208\u8DA3\uFF0C\u65B9\u4FBF\u4EA4\u6D41\u55CE\uFF1F`,`{greeting}\uFF0C\u6211\u4E5F\u95DC\u6CE8${e}\uFF0C\u4EA4\u500B\u670B\u53CB\uFF1F`,`Hi\uFF0C\u60F3\u8ACB\u6559\u4E00\u4E0B${e}\u76F8\u95DC\u7684\u554F\u984C\u3002`],enthusiastic:["{greeting}\uFF01\uFF01\u592A\u958B\u5FC3\u80FD\u8A8D\u8B58\u4F60\u4E86\uFF01\u{1F389}",`\u54C7\uFF01{name}\uFF01\u7D42\u65BC\u627E\u5230\u540C\u6A23\u559C\u6B61${e}\u7684\u4EBA\u4E86\uFF01\u2728`,"{greeting}\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u8D85\u8208\u596E\u7684\uFF01\u6211\u5011\u4E00\u5B9A\u6709\u5F88\u591A\u5171\u540C\u8A71\u984C\uFF01",`Hi {name}\uFF01\u2764\uFE0F \u8D85\u7D1A\u671F\u5F85\u548C\u4F60\u804A${e}\uFF01`,"{greeting}\uFF01\u9047\u5230\u4F60\u7C21\u76F4\u592A\u68D2\u4E86\uFF01\u{1F31F}"]},o=i[t]||i.friendly;this.aiGeneratedMessages.set(o),this.toast.info("\u5DF2\u751F\u6210\u672C\u5730\u6A21\u677F\u4F9B\u9078\u64C7")}selectAiMessage(e){this.messageContent=e}isMessageSelected(e){return this.selectedMessages().has(e)}toggleMessageSelection(e){let t=new Set(this.selectedMessages());t.has(e)?t.delete(e):t.add(e),this.selectedMessages.set(t),t.size===1?this.messageContent=Array.from(t)[0]:t.size>1?this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${t.size} \u500B\u6A21\u677F`:this.messageContent=""}selectAllMessages(){let e=new Set(this.aiGeneratedMessages());this.selectedMessages.set(e),this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${e.size} \u500B\u6A21\u677F`}clearSelectedMessages(){this.selectedMessages.set(new Set),this.messageContent=""}setSendStrategy(e){this.sendStrategy.set(e)}getStrategyDescription(){return{random:`\u5C07\u96A8\u6A5F\u9078\u64C7\u6A21\u677F\u767C\u9001\u7D66 ${this.targets().length} \u500B\u7528\u6236\uFF0C\u589E\u52A0\u6D88\u606F\u591A\u6A23\u6027`,rotate:"\u6A21\u677F\u5C07\u8F2A\u6D41\u4F7F\u7528\uFF0C\u78BA\u4FDD\u6BCF\u500B\u6A21\u677F\u88AB\u5747\u52FB\u4F7F\u7528",sequential:"\u6309\u9806\u5E8F\u4F9D\u6B21\u4F7F\u7528\u6BCF\u500B\u6A21\u677F"}[this.sendStrategy()]||""}canSend(){return this.selectedMessages().size>0?!0:this.messageContent.trim().length>0||this.attachments().length>0}insertVariable(e){this.messageContent+=e}async selectImages(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"Images",extensions:["jpg","jpeg","png","gif","webp"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(i=>({name:i.fileName,path:i.filePath,type:i.fileType}));this.attachments.update(i=>[...i,...t])}}catch(e){console.error("Select images failed:",e)}}async selectFiles(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"All Files",extensions:["*"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(i=>({name:i.fileName,path:i.filePath,type:i.fileType}));this.attachments.update(i=>[...i,...t])}}catch(e){console.error("Select files failed:",e)}}removeAttachment(e){this.attachments.update(t=>t.filter((i,o)=>o!==e))}previewMessage(){this.showPreview.set(!0)}replaceVariables(e,t){let i=e,o=t.firstName||t.first_name||"",s=t.lastName||t.last_name||"",r=t.username||"",l=t.displayName||t.name||o||r||"\u670B\u53CB",d=`${o} ${s}`.trim()||l,u=t.groupName||t.sourceGroup||t.source||"\u7FA4\u7D44",f=t.keyword||t.triggeredKeyword||t.matchedKeyword||"",C=t.source||t.sourceType||"";i=i.replace(/{firstName}/g,o),i=i.replace(/{first_name}/g,o),i=i.replace(/{lastName}/g,s),i=i.replace(/{last_name}/g,s),i=i.replace(/{username}/g,r),i=i.replace(/{displayName}/g,l),i=i.replace(/{name}/g,l),i=i.replace(/{fullName}/g,d),i=i.replace(/{full_name}/g,d),i=i.replace(/{groupName}/g,u),i=i.replace(/{group_name}/g,u),i=i.replace(/{keyword}/g,f),i=i.replace(/{source}/g,C);let y=new Date,E=y.getHours(),I="\u60A8\u597D";E>=5&&E<12?I="\u65E9\u4E0A\u597D":E>=12&&E<14?I="\u4E2D\u5348\u597D":E>=14&&E<18?I="\u4E0B\u5348\u597D":E>=18&&E<22?I="\u665A\u4E0A\u597D":I="\u591C\u6DF1\u4E86";let P=["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],B=`${y.getMonth()+1}\u6708${y.getDate()}\u65E5`,L=`${y.getHours().toString().padStart(2,"0")}:${y.getMinutes().toString().padStart(2,"0")}`,H=P[y.getDay()];return i=i.replace(/{greeting}/g,I),i=i.replace(/{date}/g,B),i=i.replace(/{time}/g,L),i=i.replace(/{day}/g,H),i}startSending(){if(!this.canSend())return;this.isSending.set(!0),this.sentCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.currentTarget.set(""),this.failureReasons.set({});let e=Array.from(this.selectedMessages()),t=e.length>1,i={targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,lastName:o.lastName,displayName:o.displayName,groupName:o.groupName,keyword:o.keyword,source:o.source})),attachments:this.attachments(),config:M({minInterval:this.minInterval,maxInterval:this.maxInterval,accountRotation:this.accountRotation},this.abTestId()?{abTestId:this.abTestId()}:{})};t?(i.messages=e,i.sendStrategy=this.sendStrategy(),i.message="",this.toast.info(`\u{1F4E8} \u4F7F\u7528 ${e.length} \u500B\u6A21\u677F${this.sendStrategy()==="random"?"\u96A8\u6A5F":this.sendStrategy()==="rotate"?"\u8F2A\u8F49":"\u9806\u5E8F"}\u767C\u9001...`)):e.length===1?i.message=e[0]:i.message=this.messageContent,this.ipc.send("batch-send:start",i),t||this.toast.info(`\u{1F4E8} \u958B\u59CB\u6279\u91CF\u767C\u9001 ${this.targets().length} \u689D\u6D88\u606F...`)}close(){if(this.isSending()){if(!confirm("\u767C\u9001\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-send:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isSending()&&this.close()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-batch-send-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"]},outputs:{closeDialog:"closeDialog",sendComplete:"sendComplete"},decls:2,vars:2,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/80","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-blue-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-blue-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"p-4","bg-purple-500/10","rounded-xl","border","border-purple-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"text-xs","text-blue-400","ml-2"],["rows","5","placeholder",`\u8F38\u5165\u6D88\u606F\u5167\u5BB9...

\u9EDE\u64CA\u4E0B\u65B9\u8B8A\u91CF\u6309\u9215\u53EF\u5FEB\u901F\u63D2\u5165\uFF0C\u4F8B\u5982\uFF1A
{greeting}{name}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u4F60\uFF01`,1,"w-full","bg-slate-800/50","border","border-slate-600","rounded-xl","p-4","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mt-2","flex","flex-wrap","gap-2","items-center"],[1,"text-xs","text-slate-500"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"title"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-800/50","border","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","hover:border-slate-500","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"mt-3","flex","flex-wrap","gap-2"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","10","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","10","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","ngModel"],[1,"w-11","h-6","bg-slate-700","peer-focus:ring-2","peer-focus:ring-blue-500","rounded-full","peer","peer-checked:after:translate-x-full","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-500"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-3","bg-slate-700","text-white","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-blue-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-blue-500/20",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium","text-slate-300"],[1,"text-xs","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","gap-2","mb-3","flex-wrap"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-blue-500","text-white","bg-slate-700","text-slate-400"],[1,"flex","items-center","justify-center","py-6"],[1,"text-center","py-6","text-slate-500"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"ml-2","text-slate-400","text-sm"],[1,"text-xs","mt-1"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"click"],[1,"flex","items-center","justify-between","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","line-clamp-2"],[1,"text-sm","font-medium","text-purple-300"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs",3,"bg-green-500/20","text-green-400","bg-amber-500/20","text-amber-400"],[1,"space-y-3"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u6253\u500B\u62DB\u547C\u3001\u4ECB\u7D39\u7522\u54C1\u3001\u9080\u8ACB\u52A0\u7FA4...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"w-full","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"space-y-3","mt-3"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs"],[1,"w-2","h-2","bg-green-500","rounded-full","animate-pulse"],[1,"w-2","h-2","bg-amber-500","rounded-full"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],[1,"text-xs","text-slate-400"],[1,"text-xs","px-2","py-1","bg-purple-500/20","text-purple-400","rounded","hover:bg-purple-500/30",3,"click"],[1,"text-xs","px-2","py-1","bg-slate-700","text-slate-400","rounded","hover:bg-slate-600",3,"click"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"mt-3","p-3","bg-gradient-to-r","from-purple-500/5","to-blue-500/5","rounded-lg","border","border-purple-500/20"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer"],["type","checkbox",1,"mt-1","w-4","h-4","rounded","bg-slate-700","border-slate-500","text-purple-500","focus:ring-purple-500",3,"change","checked"],[1,"flex-1","text-sm","text-slate-300"],[1,"text-xs","text-slate-400","block","mb-2"],[1,"flex","gap-2","flex-wrap"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400","title"],[1,"text-xs","text-slate-500","mt-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"click","title"],[1,"text-xs","text-purple-400","block","mb-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"bg-purple-500","text-white","bg-slate-700/50","text-slate-400","title"],[1,"text-xs","text-purple-400/70","mt-2"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"click","title"],[1,"text-slate-500"],[1,"text-white"],[1,"flex","items-center","gap-2","px-3","py-2","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"text-lg"],[1,"text-sm","text-white","max-w-[150px]","truncate"],[1,"text-slate-400","hover:text-red-400",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-white"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-blue-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"mt-2","text-xs","text-cyan-400"],[1,"mt-3","p-2","bg-red-500/10","border","border-red-500/20","rounded-lg"],[1,"text-xs","text-red-400","font-medium","mb-1"],[1,"text-xs","px-2","py-0.5","bg-red-500/20","text-red-300","rounded"],[1,"animate-spin"],[1,"bg-slate-900","rounded-xl","p-6","max-w-md","w-full","border","border-slate-700"],[1,"text-lg","font-bold","text-white","mb-4"],[1,"p-4","bg-slate-800","rounded-lg","text-white","whitespace-pre-wrap"],[1,"mt-3","text-sm","text-slate-400"],[1,"mt-4","w-full","py-2","bg-slate-700","text-white","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"]],template:function(t,i){t&1&&(T(0,$C,86,53,"div",0),T(1,KC,9,2,"div",1)),t&2&&(A(i.isOpen()?0:-1),h(),A(i.showPreview()?1:-1))},dependencies:[de,Te,Le,Gn,On,Ve,$n,qn,Be],encapsulation:2})}};var WC=(n,e)=>e.telegramId,Zc=(n,e)=>e.id,zC=(n,e)=>e.key;function JC(n,e){n&1&&(p(0,"div",42),j(),p(1,"svg",45),q(2,"circle",46)(3,"path",47),g(),ce(),p(4,"span",48),m(5,"\u8F09\u5165\u7FA4\u7D44\u5217\u8868..."),g()())}function QC(n,e){n&1&&(p(0,"div",43)(1,"p",49),m(2,"\u{1F605} \u6C92\u6709\u53EF\u7528\u7684\u7FA4\u7D44"),g(),p(3,"p",50),m(4,"\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44\u4E26\u4E14\u64C1\u6709\u9080\u8ACB\u6B0A\u9650"),g()())}function YC(n,e){n&1&&(p(0,"span",57),m(1,"\u7BA1\u7406\u54E1"),g())}function XC(n,e){n&1&&(p(0,"span",58),m(1,"\u6210\u54E1"),g())}function ZC(n,e){n&1&&(j(),p(0,"svg",61),q(1,"path",62),g())}function jC(n,e){if(n&1){let t=F();p(0,"button",52),D("click",function(){let o=b(t).$implicit,s=_(4);return S(s.selectGroup(o))}),p(1,"div",53),m(2),g(),p(3,"div",54)(4,"div",55)(5,"span",56),m(6),g(),T(7,YC,2,0,"span",57)(8,XC,2,0,"span",58),g(),p(9,"div",59)(10,"span"),m(11),Me(12,"number"),g(),p(13,"span"),m(14,"\u2022"),g(),p(15,"span",60),m(16),g()()(),T(17,ZC,2,0,":svg:svg",61),g()}if(n&2){let t,i,o,s,r,l,d=e.$implicit,u=_(4);V("border-emerald-500",((t=u.selectedGroup())==null?null:t.id)===d.id)("bg-emerald-500/10",((i=u.selectedGroup())==null?null:i.id)===d.id)("border-slate-600",((o=u.selectedGroup())==null?null:o.id)!==d.id)("bg-slate-800/50",((s=u.selectedGroup())==null?null:s.id)!==d.id)("hover:border-slate-500",((r=u.selectedGroup())==null?null:r.id)!==d.id),h(),V("from-blue-500",d.type==="group")("to-cyan-500",d.type==="group")("from-purple-500",d.type==="supergroup")("to-pink-500",d.type==="supergroup")("from-amber-500",d.type==="channel")("to-orange-500",d.type==="channel"),h(),k(" ",d.type==="channel"?"\u{1F4E2}":"\u{1F465}"," "),h(4),R(d.name),h(),A(d.isAdmin?7:8),h(4),k("\u{1F464} ",He(12,28,d.memberCount)," \u6210\u54E1"),h(5),R(d.url),h(),A(((l=u.selectedGroup())==null?null:l.id)===d.id?17:-1)}}function ey(n,e){if(n&1&&(p(0,"div",44),X(1,jC,18,30,"button",51,Zc),g()),n&2){let t=_(3);h(),Z(t.availableGroups())}}function ty(n,e){if(n&1&&(p(0,"div")(1,"label",30),m(2," \u9078\u64C7\u76EE\u6A19\u7FA4\u7D44 "),g(),T(3,JC,6,0,"div",42)(4,QC,5,0,"div",43)(5,ey,3,0,"div",44),g()),n&2){let t=_(2);h(3),A(t.isLoadingGroups()?3:t.availableGroups().length===0?4:5)}}function ny(n,e){if(n&1){let t=F();p(0,"div")(1,"span",64),m(2,"\u7FA4\u7D44\u540D\u7A31\uFF1A"),g(),p(3,"input",71),Ce("ngModelChange",function(o){b(t);let s=_(3);return ve(s.newGroupName,o)||(s.newGroupName=o),S(o)}),g(),p(4,"span",72),m(5),g()()}if(n&2){let t=_(3);h(3),_e("ngModel",t.newGroupName),h(2),k("",t.newGroupName.length,"/128")}}function iy(n,e){if(n&1){let t=F();p(0,"button",76),D("click",function(){let o=b(t).$implicit,s=_(4);return S(s.selectedGroupNameStyle.set(o.key))}),m(1),g()}if(n&2){let t=e.$implicit,i=_(4);V("bg-purple-500",i.selectedGroupNameStyle()===t.key)("text-white",i.selectedGroupNameStyle()===t.key)("bg-slate-700",i.selectedGroupNameStyle()!==t.key)("text-slate-400",i.selectedGroupNameStyle()!==t.key),h(),k(" ",t.label," ")}}function oy(n,e){n&1&&(j(),p(0,"svg",77),q(1,"circle",46)(2,"path",78),g(),m(3," \u751F\u6210\u4E2D... "))}function sy(n,e){n&1&&m(0," \u2728 \u751F\u6210\u7FA4\u540D ")}function ry(n,e){if(n&1){let t=F();p(0,"button",81),D("click",function(){let o=b(t).$implicit,s=_(5);return S(s.selectGeneratedName(o))}),m(1),g()}if(n&2){let t=e.$implicit,i=_(5);V("border-purple-500",i.newGroupName===t)("bg-purple-500/10",i.newGroupName===t)("border-slate-600",i.newGroupName!==t)("bg-slate-800/50",i.newGroupName!==t),h(),k(" ",t," ")}}function ay(n,e){if(n&1&&(p(0,"div",26)(1,"span",79),m(2,"\u9078\u64C7\u4E00\u500B\uFF1A"),g(),X(3,ry,2,9,"button",80,Bt),g()),n&2){let t=_(4);h(3),Z(t.generatedGroupNames())}}function ly(n,e){if(n&1){let t=F();p(0,"div",27)(1,"div")(2,"span",64),m(3,"\u4E3B\u984C/\u95DC\u9375\u8A5E\uFF1A"),g(),p(4,"input",73),Ce("ngModelChange",function(o){b(t);let s=_(3);return ve(s.aiGroupKeywords,o)||(s.aiGroupKeywords=o),S(o)}),g()(),p(5,"div")(6,"span",64),m(7,"\u98A8\u683C\uFF1A"),g(),p(8,"div",32),X(9,iy,2,9,"button",74,zC),g()(),p(11,"button",75),D("click",function(){b(t);let o=_(3);return S(o.generateGroupNames())}),T(12,oy,4,0)(13,sy,1,0),g(),T(14,ay,5,0,"div",26),g()}if(n&2){let t=_(3);h(4),_e("ngModel",t.aiGroupKeywords),h(5),Z(t.groupNameStyles),h(2),K("disabled",t.isGeneratingNames()||!t.aiGroupKeywords.trim()),h(),A(t.isGeneratingNames()?12:13),h(2),A(t.generatedGroupNames().length>0?14:-1)}}function cy(n,e){if(n&1){let t=F();p(0,"div",16)(1,"label",63),m(2,"\u{1F4DD} \u65B0\u7FA4\u7D44\u4FE1\u606F"),g(),p(3,"div")(4,"span",64),m(5,"\u7FA4\u540D\u751F\u6210\uFF1A"),g(),p(6,"div",14)(7,"button",25),D("click",function(){b(t);let o=_(2);return S(o.groupNameMode.set("manual"))}),m(8," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),g(),p(9,"button",25),D("click",function(){b(t);let o=_(2);return S(o.groupNameMode.set("ai"))}),m(10," \u{1F916} AI \u751F\u6210 "),g()()(),T(11,ny,6,2,"div"),T(12,ly,15,4,"div",27),p(13,"div")(14,"span",64),m(15,"\u7FA4\u7D44\u985E\u578B\uFF1A"),g(),p(16,"div",65)(17,"label",66)(18,"input",67),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.newGroupType,o)||(s.newGroupType=o),S(o)}),g(),p(19,"span",68),m(20,"\u666E\u901A\u7FA4\u7D44 (\u6700\u591A 200 \u4EBA)"),g()(),p(21,"label",66)(22,"input",69),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.newGroupType,o)||(s.newGroupType=o),S(o)}),g(),p(23,"span",68),m(24,"\u8D85\u7D1A\u7FA4\u7D44 (\u6700\u591A 20 \u842C\u4EBA)"),g()()()(),p(25,"div")(26,"span",64),m(27,"\u7FA4\u7D44\u63CF\u8FF0\uFF08\u53EF\u9078\uFF09\uFF1A"),g(),p(28,"textarea",70),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.newGroupDescription,o)||(s.newGroupDescription=o),S(o)}),m(29,"                  "),g()()()}if(n&2){let t=_(2);h(7),V("bg-cyan-500",t.groupNameMode()==="manual")("text-white",t.groupNameMode()==="manual")("bg-slate-700",t.groupNameMode()!=="manual")("text-slate-400",t.groupNameMode()!=="manual"),h(2),V("bg-purple-500",t.groupNameMode()==="ai")("text-white",t.groupNameMode()==="ai")("bg-slate-700",t.groupNameMode()!=="ai")("text-slate-400",t.groupNameMode()!=="ai"),h(2),A(t.groupNameMode()==="manual"?11:-1),h(),A(t.groupNameMode()==="ai"?12:-1),h(6),_e("ngModel",t.newGroupType),h(4),_e("ngModel",t.newGroupType),h(6),_e("ngModel",t.newGroupDescription)}}function dy(n,e){n&1&&(p(0,"div",82),j(),p(1,"svg",85),q(2,"circle",46)(3,"path",78),g(),ce(),p(4,"span",86),m(5,"\u8F09\u5165\u6A21\u677F..."),g()())}function uy(n,e){n&1&&(p(0,"p",83),m(1,"\u6C92\u6709\u53EF\u7528\u7684\u6A21\u677F"),g())}function my(n,e){if(n&1){let t=F();p(0,"button",81),D("click",function(){let o=b(t).$implicit,s=_(4);return S(s.selectWelcomeTemplate(o))}),p(1,"span",88),m(2),g(),p(3,"p",89),m(4),g()()}if(n&2){let t,i,o,s,r=e.$implicit,l=_(4);V("border-blue-500",((t=l.selectedWelcomeTemplate())==null?null:t.id)===r.id)("bg-blue-500/10",((i=l.selectedWelcomeTemplate())==null?null:i.id)===r.id)("border-slate-600",((o=l.selectedWelcomeTemplate())==null?null:o.id)!==r.id)("bg-slate-800/50",((s=l.selectedWelcomeTemplate())==null?null:s.id)!==r.id),h(2),R(r.name),h(2),R(r.content)}}function py(n,e){if(n&1&&(p(0,"div",84),X(1,my,5,10,"button",87,Zc),g()),n&2){let t=_(3);h(),Z(t.welcomeTemplates())}}function gy(n,e){if(n&1&&(p(0,"div",26),T(1,dy,6,0,"div",82)(2,uy,2,0,"p",83)(3,py,3,0,"div",84),g()),n&2){let t=_(2);h(),A(t.isLoadingTemplates()?1:t.welcomeTemplates().length===0?2:3)}}function hy(n,e){n&1&&(j(),p(0,"svg",77),q(1,"circle",46)(2,"path",78),g(),m(3," \u751F\u6210\u4E2D... "))}function fy(n,e){n&1&&m(0," \u2728 \u751F\u6210\u6B61\u8FCE\u6D88\u606F ")}function _y(n,e){if(n&1&&(p(0,"div",91)(1,"p",92),m(2),g()()),n&2){let t=_(3);h(2),R(t.generatedWelcomeMessage())}}function vy(n,e){if(n&1){let t=F();p(0,"div",27)(1,"input",90),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.aiWelcomeTopic,o)||(s.aiWelcomeTopic=o),S(o)}),g(),p(2,"button",75),D("click",function(){b(t);let o=_(2);return S(o.generateWelcomeMessage())}),T(3,hy,4,0)(4,fy,1,0),g(),T(5,_y,3,1,"div",91),g()}if(n&2){let t=_(2);h(),_e("ngModel",t.aiWelcomeTopic),h(),K("disabled",t.isGeneratingWelcome()||!t.aiWelcomeTopic.trim()),h(),A(t.isGeneratingWelcome()?3:4),h(2),A(t.generatedWelcomeMessage()?5:-1)}}function Cy(n,e){if(n&1){let t=F();p(0,"div",28)(1,"span",64),m(2,"\u6D88\u606F\u5167\u5BB9\uFF1A"),g(),p(3,"textarea",93),Ce("ngModelChange",function(o){b(t);let s=_(2);return ve(s.welcomeMessageContent,o)||(s.welcomeMessageContent=o),S(o)}),m(4,"                  "),g()()}if(n&2){let t=_(2);h(3),_e("ngModel",t.welcomeMessageContent)}}function yy(n,e){if(n&1&&(p(0,"span",98),m(1),g()),n&2){let t=_(3);h(),k("\u26A0\uFE0F \u5DF2\u5728\u7FA4\u5167: ",t.permissionCheck().alreadyInGroup," \u4EBA")}}function by(n,e){if(n&1&&(p(0,"span",99),m(1),g()),n&2){let t=_(3);h(),k("\u274C \u96B1\u79C1\u9650\u5236: ",t.permissionCheck().privacyRestricted," \u4EBA")}}function Sy(n,e){if(n&1&&(p(0,"div",94)(1,"h4",95),m(2,"\u{1F4CA} \u6B0A\u9650\u6AA2\u67E5\u7D50\u679C"),g(),p(3,"div",96)(4,"span",97),m(5),g(),T(6,yy,2,1,"span",98),T(7,by,2,1,"span",99),g()()),n&2){let t=_(2);V("bg-emerald-500/10",t.permissionCheck().canInvite>0)("border",!0)("border-emerald-500/30",t.permissionCheck().canInvite>0)("bg-amber-500/10",t.permissionCheck().canInvite===0)("border-amber-500/30",t.permissionCheck().canInvite===0),h(5),k("\u2705 \u53EF\u62C9\u5165: ",t.permissionCheck().canInvite," \u4EBA"),h(),A(t.permissionCheck().alreadyInGroup>0?6:-1),h(),A(t.permissionCheck().privacyRestricted>0?7:-1)}}function xy(n,e){if(n&1&&(p(0,"span",33),m(1),g()),n&2){let t=e.$implicit;h(),k(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function wy(n,e){if(n&1&&(p(0,"span",34),m(1),g()),n&2){let t=_(2);h(),k(" +",t.targets().length-20," \u66F4\u591A... ")}}function Ey(n,e){if(n&1&&(p(0,"div",35)(1,"div",100)(2,"span",92),m(3,"\u62C9\u7FA4\u9032\u5EA6"),g(),p(4,"span",8),m(5),g()(),p(6,"div",101),q(7,"div",102),g(),p(8,"div",103)(9,"span",104),m(10),g(),p(11,"span",98),m(12),g(),p(13,"span",99),m(14),g(),p(15,"span"),m(16),g()(),p(17,"p",105),m(18," \u{1F4A1} \u6210\u529F\u5305\u542B\uFF1A\u76F4\u63A5\u9080\u8ACB + \u5DF2\u767C\u9001\u9080\u8ACB\u93C8\u63A5 "),g()()),n&2){let t=_(2);h(5),be("",t.invitedCount()," / ",t.targets().length),h(2),me("width",t.progressPercent(),"%"),h(3),k("\u2705 \u6210\u529F: ",t.successCount()),h(2),k("\u26A0\uFE0F \u8DF3\u904E: ",t.skippedCount()),h(2),k("\u274C \u5931\u6557: ",t.failedCount()),h(2),k("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining())}}function Ty(n,e){n&1&&(p(0,"div",36)(1,"div",106)(2,"span"),m(3,"\u26A0\uFE0F"),g(),p(4,"span"),m(5,"\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F\u5F8C\u518D\u9032\u884C\u62C9\u7FA4\u64CD\u4F5C"),g()()())}function Ay(n,e){if(n&1&&(p(0,"div",37)(1,"div",107)(2,"span"),m(3,"\u{1F517}"),g(),p(4,"span"),m(5),g(),p(6,"span",108),m(7,"|"),g(),p(8,"span"),m(9),g()()()),n&2){let t,i=_(2);h(5),k("\u53EF\u7528\u5E33\u865F: ",i.onlineAccountsCount()," \u500B\u5728\u7DDA"),h(4),k("\u5C07\u4F7F\u7528: ",((t=i.preferredAccount())==null?null:t.firstName)||((t=i.preferredAccount())==null?null:t.phone)||"\u81EA\u52D5\u9078\u64C7")}}function Dy(n,e){n&1&&m(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function My(n,e){if(n&1&&(m(0),T(1,Dy,1,0)),n&2){let t=_(3);be(" \u5275\u5EFA\u7FA4\u7D44\u300C",t.newGroupName,"\u300D\u2192 \u62C9\u5165 ",t.targets().length," \u4EBA "),h(),A(t.welcomeMessageSource()!=="none"?1:-1)}}function Iy(n,e){n&1&&m(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function ky(n,e){if(n&1&&(m(0),T(1,Iy,1,0)),n&2){let t,i=_(3);be(" \u62C9\u5165\u7FA4\u7D44\u300C",(t=i.selectedGroup())==null?null:t.name,"\u300D\u2192 ",i.targets().length," \u4EBA "),h(),A(i.welcomeMessageSource()!=="none"?1:-1)}}function Py(n,e){if(n&1&&(p(0,"div",38)(1,"div",109)(2,"span"),m(3,"\u{1F4CB}"),g(),p(4,"span"),T(5,My,2,3)(6,ky,2,3),g()()()),n&2){let t=_(2);h(5),A(t.groupSource()==="create"?5:6)}}function Ny(n,e){if(n&1&&(p(0,"span",110),m(1,"\u23F3"),g(),m(2)),n&2){let t=_(2);h(2),k(" ",t.createGroupProgressMessage()||"\u5275\u5EFA\u7FA4\u7D44\u4E2D..."," ")}}function Ry(n,e){n&1&&(p(0,"span",110),m(1,"\u23F3"),g(),m(2," \u62C9\u7FA4\u4E2D... "))}function Fy(n,e){if(n&1&&m(0),n&2){let t=_(2);k(" \u{1F680} \u5275\u5EFA\u4E26\u62C9\u4EBA (",t.targets().length," \u4EBA) ")}}function Ly(n,e){if(n&1&&m(0),n&2){let t=_(2);k(" \u{1F465} \u958B\u59CB\u62C9\u7FA4 (",t.targets().length," \u4EBA) ")}}function Vy(n,e){if(n&1){let t=F();p(0,"div",1),D("click",function(o){b(t);let s=_();return S(s.onBackdropClick(o))}),p(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),m(6," \u{1F465} "),g(),p(7,"div")(8,"h2",7),m(9,"\u6279\u91CF\u62C9\u5165\u7FA4\u7D44"),g(),p(10,"p",8),m(11),g()()(),p(12,"button",9),D("click",function(){b(t);let o=_();return S(o.close())}),j(),p(13,"svg",10),q(14,"path",11),g()()()(),ce(),p(15,"div",12)(16,"div")(17,"label",13),m(18," \u{1F3AF} \u7FA4\u7D44\u4F86\u6E90 "),g(),p(19,"div",14)(20,"button",15),D("click",function(){b(t);let o=_();return S(o.setGroupSource("existing"))}),m(21," \u{1F3E0} \u73FE\u6709\u7FA4\u7D44 "),g(),p(22,"button",15),D("click",function(){b(t);let o=_();return S(o.setGroupSource("create"))}),m(23," \u2795 \u5275\u5EFA\u65B0\u7FA4 "),g()()(),T(24,ty,6,1,"div"),T(25,cy,30,21,"div",16),p(26,"div",17)(27,"label",13),m(28," \u2699\uFE0F \u62C9\u7FA4\u8A2D\u7F6E "),g(),p(29,"div",18)(30,"div",5)(31,"span",19),m(32,"\u6BCF\u6279\u6B21\u4EBA\u6578\uFF1A"),g(),p(33,"input",20),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.batchSize,o)||(s.batchSize=o),S(o)}),g(),p(34,"span",8),m(35,"\u4EBA"),g()(),p(36,"div",5)(37,"span",19),m(38,"\u6279\u6B21\u9593\u9694\uFF1A"),g(),p(39,"input",21),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.minInterval,o)||(s.minInterval=o),S(o)}),g(),p(40,"span",22),m(41,"-"),g(),p(42,"input",23),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.maxInterval,o)||(s.maxInterval=o),S(o)}),g(),p(43,"span",8),m(44,"\u79D2"),g()()()(),p(45,"div",17)(46,"label",13),m(47," \u{1F4AC} \u6B61\u8FCE\u6D88\u606F "),g(),p(48,"div",24)(49,"button",25),D("click",function(){b(t);let o=_();return S(o.welcomeMessageSource.set("none"))}),m(50," \u274C \u4E0D\u767C\u9001 "),g(),p(51,"button",25),D("click",function(){b(t);let o=_();return S(o.welcomeMessageSource.set("template"))}),m(52," \u{1F4C4} \u9078\u6A21\u677F "),g(),p(53,"button",25),D("click",function(){b(t);let o=_();return S(o.welcomeMessageSource.set("ai"))}),m(54," \u{1F916} AI \u751F\u6210 "),g()(),T(55,gy,4,1,"div",26),T(56,vy,6,4,"div",27),T(57,Cy,5,1,"div",28),g(),T(58,Sy,8,13,"div",29),p(59,"div")(60,"label",30),m(61),g(),p(62,"div",31)(63,"div",32),X(64,xy,2,1,"span",33,WC),T(66,wy,2,1,"span",34),g()()()(),T(67,Ey,19,8,"div",35),T(68,Ty,6,0,"div",36)(69,Ay,10,2,"div",37),T(70,Py,7,1,"div",38),p(71,"div",39)(72,"button",40),D("click",function(){b(t);let o=_();return S(o.close())}),m(73),g(),p(74,"button",41),D("click",function(){b(t);let o=_();return S(o.startInviting())}),T(75,Ny,3,1)(76,Ry,3,0)(77,Fy,1,1)(78,Ly,1,1),g()()()()}if(n&2){let t=_();h(11),k("\u5C07 ",t.targets().length," \u500B\u7528\u6236\u62C9\u5165\u7FA4\u7D44"),h(9),V("border-emerald-500",t.groupSource()==="existing")("bg-emerald-500/20",t.groupSource()==="existing")("text-emerald-400",t.groupSource()==="existing")("border-slate-600",t.groupSource()!=="existing")("bg-slate-800/50",t.groupSource()!=="existing")("text-slate-400",t.groupSource()!=="existing"),h(2),V("border-cyan-500",t.groupSource()==="create")("bg-cyan-500/20",t.groupSource()==="create")("text-cyan-400",t.groupSource()==="create")("border-slate-600",t.groupSource()!=="create")("bg-slate-800/50",t.groupSource()!=="create")("text-slate-400",t.groupSource()!=="create"),h(2),A(t.groupSource()==="existing"?24:-1),h(),A(t.groupSource()==="create"?25:-1),h(8),_e("ngModel",t.batchSize),h(6),_e("ngModel",t.minInterval),h(3),_e("ngModel",t.maxInterval),h(7),V("bg-slate-600",t.welcomeMessageSource()==="none")("text-white",t.welcomeMessageSource()==="none")("bg-slate-700",t.welcomeMessageSource()!=="none")("text-slate-400",t.welcomeMessageSource()!=="none"),h(2),V("bg-blue-500",t.welcomeMessageSource()==="template")("text-white",t.welcomeMessageSource()==="template")("bg-slate-700",t.welcomeMessageSource()!=="template")("text-slate-400",t.welcomeMessageSource()!=="template"),h(2),V("bg-purple-500",t.welcomeMessageSource()==="ai")("text-white",t.welcomeMessageSource()==="ai")("bg-slate-700",t.welcomeMessageSource()!=="ai")("text-slate-400",t.welcomeMessageSource()!=="ai"),h(2),A(t.welcomeMessageSource()==="template"?55:-1),h(),A(t.welcomeMessageSource()==="ai"?56:-1),h(),A(t.welcomeMessageSource()!=="none"?57:-1),h(),A(t.selectedGroup()?58:-1),h(3),k(" \u{1F465} \u76EE\u6A19\u7528\u6236\uFF08",t.targets().length," \u4EBA\uFF09 "),h(3),Z(t.targets().slice(0,20)),h(2),A(t.targets().length>20?66:-1),h(),A(t.isInviting()?67:-1),h(),A(t.onlineAccountsCount()===0?68:69),h(2),A(t.canInvite()?70:-1),h(2),K("disabled",t.isInviting()||t.isCreatingGroup()),h(),k(" ",t.isInviting()||t.isCreatingGroup()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),h(),K("disabled",!t.canInvite()||t.isInviting()||t.isCreatingGroup()),h(),A(t.isCreatingGroup()?75:t.isInviting()?76:t.groupSource()==="create"?77:78)}}var Eo=class n{constructor(){this.ipc=O(Ie);this.toast=O(Ne);this.isOpen=se(!1);this.targets=se([]);this.accounts=se([]);this.closeDialog=Q();this.inviteComplete=Q();this._currentInviteId=v(null);this.groupSource=v("existing");this.availableGroups=v([]);this.isLoadingGroups=v(!1);this.selectedGroup=v(null);this.groupNameMode=v("manual");this.newGroupName="";this.newGroupType="supergroup";this.newGroupDescription="";this.aiGroupKeywords="";this.selectedGroupNameStyle=v("professional");this.isGeneratingNames=v(!1);this.generatedGroupNames=v([]);this.groupNameStyles=[{key:"professional",label:"\u5C08\u696D\u6B63\u5F0F"},{key:"lively",label:"\u6D3B\u6F51\u6709\u8DA3"},{key:"mysterious",label:"\u795E\u79D8\u9AD8\u7AEF"},{key:"simple",label:"\u7C21\u7D04\u660E\u4E86"}];this.welcomeMessageSource=v("none");this.welcomeTemplates=v([]);this.isLoadingTemplates=v(!1);this.selectedWelcomeTemplate=v(null);this.welcomeMessageContent="";this.aiWelcomeTopic="";this.isGeneratingWelcome=v(!1);this.generatedWelcomeMessage=v("");this.batchSize=10;this.minInterval=60;this.maxInterval=120;this.isInviting=v(!1);this.invitedCount=v(0);this.successCount=v(0);this.failedCount=v(0);this.skippedCount=v(0);this.isCreatingGroup=v(!1);this.createdGroupId=v(null);this.createGroupProgressMessage=v("");this.listeners=[];this.progressPercent=G(()=>{let e=this.targets().length;return e>0?this.invitedCount()/e*100:0});this.estimatedRemaining=G(()=>{let e=this.targets().length-this.invitedCount(),t=(this.minInterval+this.maxInterval)/2,o=Math.ceil(e/this.batchSize)*t;return o<60?`${Math.round(o)} \u79D2`:o<3600?`${Math.round(o/60)} \u5206\u9418`:`${Math.round(o/3600)} \u5C0F\u6642`});this.permissionCheck=G(()=>{let e=this.targets().length;return{canInvite:Math.floor(e*.8),alreadyInGroup:Math.floor(e*.1),privacyRestricted:Math.floor(e*.1)}});this.onlineAccountsCount=G(()=>this.accounts().filter(e=>e.status==="Online").length);this.preferredAccount=G(()=>{let e=this.accounts().filter(i=>i.status==="Online");return e.find(i=>i.role==="Sender")||e[0]||null});this.createGroupTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadAvailableGroups(),this.loadWelcomeTemplates()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-invite:progress",u=>{this.invitedCount.set(u.invited),this.successCount.set(u.success),this.failedCount.set(u.failed),this.skippedCount.set(u.skipped)});this.listeners.push(e);let t=this.ipc.on("batch-invite:complete",u=>{let f=this._currentInviteId();if(u.inviteId&&f&&u.inviteId!==f){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08inviteId \u4E0D\u5339\u914D\uFF09:",u.inviteId,"!=",f);return}if(!this.isOpen()&&!this.isInviting()&&!f){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08\u5C0D\u8A71\u6846\u672A\u6253\u958B\u4E14\u7121\u6D3B\u8E8D\u9080\u8ACB\uFF09");return}this._currentInviteId.set(null),this.isInviting.set(!1),this.isCreatingGroup.set(!1),this.inviteComplete.emit({success:u.success,failed:u.failed,skipped:u.skipped}),u.success>0?this.toast.success(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u2705 \u6210\u529F/\u5DF2\u767C\u9001\u9080\u8ACB ${u.success} \u4EBA\uFF0C\u26A0\uFE0F \u8DF3\u904E ${u.skipped}\uFF0C\u274C \u5931\u6557 ${u.failed}`):u.skipped>0?this.toast.warning("\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6240\u6709\u7528\u6236\u5DF2\u5728\u7FA4\u5167\u6216\u96B1\u79C1\u9650\u5236"):this.toast.error("\u6279\u91CF\u62C9\u7FA4\u5931\u6557\uFF1A\u7121\u6CD5\u9080\u8ACB\u4EFB\u4F55\u7528\u6236\uFF0C\u8ACB\u6AA2\u67E5\u5E33\u865F\u72C0\u614B")});this.listeners.push(t);let i=this.ipc.on("get-admin-groups-result",u=>{this.isLoadingGroups.set(!1),u.groups&&this.availableGroups.set(u.groups)});this.listeners.push(i);let o=this.ipc.on("get-chat-templates-result",u=>{this.isLoadingTemplates.set(!1),u.templates&&this.welcomeTemplates.set(u.templates.filter(f=>f.isEnabled))});this.listeners.push(o);let s=this.ipc.on("ai-generate-group-names-result",u=>{this.isGeneratingNames.set(!1),u.success&&u.names?(this.generatedGroupNames.set(u.names),this.toast.success("\u7FA4\u540D\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(u.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(s);let r=this.ipc.on("ai-generate-welcome-result",u=>{this.isGeneratingWelcome.set(!1),u.success&&u.message?(this.generatedWelcomeMessage.set(u.message),this.welcomeMessageContent=u.message,this.toast.success("\u6B61\u8FCE\u6D88\u606F\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(u.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(r);let l=this.ipc.on("create-group-progress",u=>{console.log("[BatchInvite] \u5275\u5EFA\u9032\u5EA6:",u),this.createGroupProgressMessage.set(u.message)});this.listeners.push(l);let d=this.ipc.on("create-group-result",u=>{if(console.log("[BatchInvite] \u6536\u5230\u5275\u5EFA\u7FA4\u7D44\u7D50\u679C:",u),this.createGroupTimeout&&(clearTimeout(this.createGroupTimeout),this.createGroupTimeout=null),this.isCreatingGroup.set(!1),u.success&&u.groupId)this.createdGroupId.set(u.groupId),this.toast.success(`\u7FA4\u7D44\u300C${this.newGroupName}\u300D\u5275\u5EFA\u6210\u529F\uFF01`),this.startInvitingToGroup(u.groupId,u.groupUrl||"");else{let f=u.error||"\u5275\u5EFA\u7FA4\u7D44\u5931\u6557";f.includes("FLOOD")?this.toast.error("\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"):f.includes("not connected")||f.includes("Offline")?this.toast.error("\u5E33\u865F\u672A\u9023\u63A5\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"):f.includes("PEER_FLOOD")?this.toast.error("\u5E33\u865F\u88AB\u9650\u5236\uFF0C\u8ACB\u66F4\u63DB\u5E33\u865F\u6216\u7A0D\u5F8C\u518D\u8A66"):this.toast.error(f)}});this.listeners.push(d)}setGroupSource(e){this.groupSource.set(e),e==="existing"&&this.loadAvailableGroups()}loadAvailableGroups(){this.isLoadingGroups.set(!0),this.ipc.send("get-admin-groups",{})}loadWelcomeTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectGroup(e){this.selectedGroup.set(e)}selectGeneratedName(e){this.newGroupName=e}generateGroupNames(){if(!this.aiGroupKeywords.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u4E3B\u984C\u95DC\u9375\u8A5E");return}this.isGeneratingNames.set(!0),this.generatedGroupNames.set([]),this.ipc.send("ai-generate-group-names",{keywords:this.aiGroupKeywords,style:this.selectedGroupNameStyle(),count:5})}selectWelcomeTemplate(e){this.selectedWelcomeTemplate.set(e),this.welcomeMessageContent=e.content}generateWelcomeMessage(){if(!this.aiWelcomeTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingWelcome.set(!0),this.generatedWelcomeMessage.set(""),this.ipc.send("ai-generate-welcome",{topic:this.aiWelcomeTopic,groupName:this.newGroupName||this.selectedGroup()?.name||""})}canInvite(){return this.groupSource()==="existing"?this.selectedGroup()!==null&&this.targets().length>0:this.newGroupName.trim().length>0&&this.targets().length>0}startInviting(){this.canInvite()&&(this.groupSource()==="create"?this.createGroupAndInvite():this.startInvitingToGroup(this.selectedGroup().id,this.selectedGroup().url))}async createGroupAndInvite(){let e=await this.checkOnlineAccounts();if(e.length===0){this.toast.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.isCreatingGroup.set(!0),this.createGroupProgressMessage.set("\u6B63\u5728\u6E96\u5099\u5275\u5EFA\u7FA4\u7D44..."),this.createGroupTimeout&&clearTimeout(this.createGroupTimeout),this.createGroupTimeout=setTimeout(()=>{this.isCreatingGroup()&&(this.isCreatingGroup.set(!1),this.toast.error("\u5275\u5EFA\u7FA4\u7D44\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u6216\u5E33\u865F\u72C0\u614B\uFF0C\u6216\u5617\u8A66\u5275\u5EFA\u666E\u901A\u7FA4\u7D44"))},6e4),console.log("[BatchInvite] \u958B\u59CB\u5275\u5EFA\u7FA4\u7D44:",{name:this.newGroupName,type:this.newGroupType,account:e[0]?.phone}),this.ipc.send("create-group",{name:this.newGroupName,description:this.newGroupDescription,type:this.newGroupType,accountPhone:e[0]?.phone}),this.toast.info(`\u6B63\u5728\u4F7F\u7528\u5E33\u865F ${e[0]?.firstName||e[0]?.phone} \u5275\u5EFA\u7FA4\u7D44...`)}async checkOnlineAccounts(){let e=this.accounts(),t=e.filter(i=>i.status==="Online");return console.log("[BatchInvite] \u6AA2\u67E5\u5E33\u865F: \u7E3D\u6578",e.length,", \u5728\u7DDA",t.length),t.length===0&&this.toast.warning("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"),t}startInvitingToGroup(e,t){let i=`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this._currentInviteId.set(i),this.isInviting.set(!0),this.invitedCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.skippedCount.set(0),this.ipc.send("batch-invite:start",{inviteId:i,groupId:e,groupUrl:t,targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,displayName:o.displayName})),config:{batchSize:this.batchSize,minInterval:this.minInterval,maxInterval:this.maxInterval,sendWelcomeMessage:this.welcomeMessageSource()!=="none",welcomeMessage:this.welcomeMessageContent}}),this.toast.info("\u958B\u59CB\u6279\u91CF\u62C9\u7FA4..."),console.log("[BatchInvite] \u958B\u59CB\u9080\u8ACB\uFF0CinviteId:",i)}close(){if(this.isInviting()){if(!confirm("\u62C9\u7FA4\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-invite:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isInviting()&&this.close()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-batch-invite-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"],accounts:[1,"accounts"]},outputs:{closeDialog:"closeDialog",inviteComplete:"inviteComplete"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30","space-y-4"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","1","max","50",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],["type","number","min","30","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","30","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"flex","gap-2","mb-3"],[1,"flex-1","py-2","rounded-lg","text-sm","transition-all",3,"click"],[1,"space-y-2"],[1,"space-y-3"],[1,"mt-3"],[1,"p-4","rounded-xl",3,"bg-emerald-500/10","border","border-emerald-500/30","bg-amber-500/10","border-amber-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-red-500/10","border-t","border-red-500/30"],[1,"px-5","py-2","bg-slate-800/30","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-emerald-500/20",3,"click","disabled"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2","max-h-48","overflow-y-auto","pr-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-6","w-6","text-cyan-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"ml-2","text-slate-400"],[1,"text-lg","mb-2"],[1,"text-sm"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"border-emerald-500","bg-emerald-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","flex","items-center","justify-center","text-lg"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white","truncate"],[1,"px-1.5","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded"],[1,"px-1.5","py-0.5","bg-slate-600","text-slate-400","text-xs","rounded"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"truncate"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-emerald-400","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"block","text-sm","font-medium","text-cyan-300"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"flex","gap-3"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","radio","name","groupType","value","group",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300"],["type","radio","name","groupType","value","supergroup",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],["rows","2","placeholder","\u7C21\u77ED\u4ECB\u7D39\u7FA4\u7D44\u76EE\u7684...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-cyan-500","text-sm",3,"ngModelChange","ngModel"],["type","text","placeholder","\u8F38\u5165\u7FA4\u7D44\u540D\u7A31...","maxlength","128",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1","block"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u5E63\u5708\u3001\u4EA4\u6D41\u3001VIP...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],[1,"w-full","py-2","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-sm",3,"click","disabled"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"text-xs","text-slate-400"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"click"],[1,"flex","items-center","justify-center","py-4"],[1,"text-sm","text-slate-500","text-center","py-4"],[1,"max-h-32","overflow-y-auto","space-y-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],[1,"ml-2","text-slate-400","text-sm"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400","truncate","mt-1"],["type","text","placeholder","\u6B61\u8FCE\u6D88\u606F\u4E3B\u984C\uFF0C\u4F8B\u5982\uFF1A\u6B61\u8FCE\u52A0\u5165\u3001\u793E\u7FA4\u4ECB\u7D39...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"p-3","bg-slate-800/50","rounded-lg","border","border-purple-500/30"],[1,"text-sm","text-white"],["rows","2","placeholder","\u8F38\u5165\u6B61\u8FCE\u6D88\u606F\u5167\u5BB9...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-emerald-500","text-sm",3,"ngModelChange","ngModel"],[1,"p-4","rounded-xl"],[1,"text-sm","font-medium","text-slate-300","mb-2"],[1,"flex","items-center","gap-6","text-sm"],[1,"text-emerald-400"],[1,"text-amber-400"],[1,"text-red-400"],[1,"flex","items-center","justify-between","mb-2"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"text-green-400"],[1,"mt-1","text-xs","text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-red-400"],[1,"flex","items-center","gap-2","text-xs","text-slate-400"],[1,"text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-slate-400"],[1,"animate-spin"]],template:function(t,i){t&1&&T(0,Vy,79,67,"div",0),t&2&&A(i.isOpen()?0:-1)},dependencies:[de,Te,Le,Gn,ma,Ve,pa,$n,qn,Be,Ln],encapsulation:2})}};var jc=(n,e)=>e.value;function By(n,e){if(n&1&&(p(0,"p",30),m(1),Me(2,"number"),g(),p(3,"p",31),m(4,"\u6210\u54E1\u6578"),g()),n&2){let t=_(3);h(),R(He(2,1,t.group().memberCount))}}function Oy(n,e){n&1&&(p(0,"p",32),m(1,"?"),g(),p(2,"p",33),m(3,"\u7121\u6578\u64DA"),g())}function Gy(n,e){n&1&&(p(0,"span",41),m(1,"\u23F3"),g(),p(2,"span"),m(3,"\u7372\u53D6\u4E2D..."),g())}function Uy(n,e){n&1&&(p(0,"span"),m(1,"\u{1F504}"),g(),p(2,"span"),m(3,"\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578"),g())}function qy(n,e){if(n&1){let t=F();p(0,"div",27)(1,"div",34)(2,"span",35),m(3,"\u26A0\uFE0F"),g(),p(4,"div",24)(5,"p",36),m(6,"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\u64DA"),g(),p(7,"p",37),m(8,"\u53EF\u80FD\u539F\u56E0\uFF1A"),g(),p(9,"ul",38)(10,"li"),m(11,"\u5C1A\u672A\u52A0\u5165\u8A72\u7FA4\u7D44"),g(),p(12,"li"),m(13,"\u7FA4\u7D44\u5DF2\u8B8A\u70BA\u79C1\u6709"),g(),p(14,"li"),m(15,"\u983B\u9053\u985E\u578B\u4E0D\u652F\u6301\u63D0\u53D6\u6210\u54E1"),g(),p(16,"li"),m(17,"\u5E33\u865F\u88AB\u8E22\u51FA\u7FA4\u7D44"),g()(),p(18,"div",39)(19,"button",40),D("click",function(){b(t);let o=_(3);return S(o.refreshMemberCount())}),T(20,Gy,4,0)(21,Uy,4,0),g()()()()()}if(n&2){let t=_(3);h(19),K("disabled",t.isRefreshingCount()),h(),A(t.isRefreshingCount()?20:21)}}function $y(n,e){n&1&&(p(0,"div",28)(1,"div",34)(2,"span",35),m(3,"\u{1F6AB}"),g(),p(4,"div",24)(5,"p",42),m(6,"\u983B\u9053\u4E0D\u652F\u6301\u6210\u54E1\u63D0\u53D6"),g(),p(7,"p",8),m(8," Telegram \u983B\u9053\uFF08Channel\uFF09\u6C92\u6709\u6210\u54E1\u5217\u8868\uFF0C\u53EA\u6709\u8A02\u95B1\u8005\u3002 \u5982\u9700\u7372\u53D6\u8A02\u95B1\u8005\u4FE1\u606F\uFF0C\u8ACB\u4F7F\u7528\u983B\u9053\u5206\u6790\u529F\u80FD\u3002 "),g()()()())}function Hy(n,e){if(n&1){let t=F();p(0,"div",48)(1,"p",49),m(2,"\u{1F4CB} \u66FF\u4EE3\u65B9\u6848\uFF1A"),g(),p(3,"ul",50)(4,"li",51)(5,"span",52),m(6,"1."),g(),p(7,"span"),m(8,"\u78BA\u4FDD\u7FA4\u7D44\u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u767C\u8A00\u7528\u6236"),g()(),p(9,"li",51)(10,"span",52),m(11,"2."),g(),p(12,"span"),m(13,"\u5728\u300C\u5DF2\u6536\u96C6\u7528\u6236\u300D\u6A19\u7C64\u9801\u67E5\u770B\u76E3\u63A7\u671F\u9593\u6536\u96C6\u7684\u7528\u6236"),g()(),p(14,"li",51)(15,"span",52),m(16,"3."),g(),p(17,"span"),m(18,"\u6216\u806F\u7E6B\u7FA4\u4E3B\u7372\u53D6\u7BA1\u7406\u54E1\u6B0A\u9650"),g()()()(),p(19,"div",53)(20,"button",54),D("click",function(){b(t);let o=_(4);return S(o.checkMonitoringStatus())}),p(21,"span"),m(22,"\u{1F4E1}"),g(),p(23,"span"),m(24,"\u78BA\u8A8D\u76E3\u63A7\u72C0\u614B"),g()(),p(25,"button",55),D("click",function(){b(t);let o=_(4);return S(o.collectFromHistory())}),p(26,"span"),m(27,"\u{1F504}"),g(),p(28,"span"),m(29,"\u5F9E\u6B77\u53F2\u6536\u96C6"),g()(),p(30,"button",56),D("click",function(){b(t);let o=_(4);return S(o.viewCollectedUsers())}),p(31,"span"),m(32,"\u{1F465}"),g(),p(33,"span"),m(34),g()()()}if(n&2){let t=_(4);h(34),k("\u67E5\u770B\u5DF2\u6536\u96C6 (",t.collectedUsersCount(),")")}}function Ky(n,e){if(n&1&&(p(0,"div",46)(1,"p",57)(2,"span"),m(3,"\u{1F4A1}"),g(),p(4,"span"),m(5),g()()()),n&2){let t=_(4);h(5),R(t.extractionError().suggestion)}}function Wy(n,e){if(n&1){let t=F();p(0,"button",58),D("click",function(){b(t);let o=_(4);return S(o.joinGroup())}),p(1,"span"),m(2,"\u2795"),g(),p(3,"span"),m(4,"\u52A0\u5165\u7FA4\u7D44"),g()()}}function zy(n,e){if(n&1&&(p(0,"div",43)(1,"div",34)(2,"span",35),m(3),g(),p(4,"div",24)(5,"p",44),m(6),g(),p(7,"p",45),m(8),g(),T(9,Hy,35,1)(10,Ky,6,1,"div",46),T(11,Wy,5,0,"button",47),g()()()),n&2){let t=_(3);V("bg-red-500/10",t.extractionError().code==="ADMIN_REQUIRED")("border-red-500/30",t.extractionError().code==="ADMIN_REQUIRED")("bg-amber-500/10",t.extractionError().code!=="ADMIN_REQUIRED")("border-amber-500/30",t.extractionError().code!=="ADMIN_REQUIRED"),h(3),R(t.extractionError().code==="ADMIN_REQUIRED"?"\u{1F512}":"\u26A0\uFE0F"),h(2),V("text-red-400",t.extractionError().code==="ADMIN_REQUIRED")("text-amber-400",t.extractionError().code!=="ADMIN_REQUIRED"),h(),k(" ",t.extractionError().title," "),h(2),R(t.extractionError().reason),h(),A(t.extractionError().code==="ADMIN_REQUIRED"?9:10),h(2),A(t.extractionError().canAutoJoin?11:-1)}}function Jy(n,e){if(n&1&&(p(0,"div",22)(1,"div",5)(2,"div",23),m(3),g(),p(4,"div",24)(5,"h3",25),m(6),g(),p(7,"p",8),m(8),g()(),p(9,"div",26),T(10,By,5,3)(11,Oy,4,0),g()()(),T(12,qy,22,2,"div",27),T(13,$y,9,0,"div",28),T(14,zy,12,17,"div",29)),n&2){let t=_(2);h(3),k(" ",t.group().name[0]," "),h(3),R(t.group().name),h(2),R(t.group().url||"\u79C1\u5BC6\u7FA4\u7D44"),h(2),A(t.group().memberCount>0?10:11),h(2),A(t.group().memberCount===0?12:-1),h(),A(t.isChannel()?13:-1),h(),A(t.extractionError()?14:-1)}}function Qy(n,e){n&1&&(p(0,"span",79),m(1,"\u{1F512}"),g())}function Yy(n,e){if(n&1){let t=F();p(0,"button",78),D("click",function(){let o=b(t).$implicit,s=_(3);return S(s.setLimit(o.value))}),m(1),T(2,Qy,2,0,"span",79),g()}if(n&2){let t=e.$implicit,i=_(3);V("border-emerald-500",i.config().limit===t.value)("bg-emerald-500/20",i.config().limit===t.value)("text-emerald-400",i.config().limit===t.value)("border-slate-700",i.config().limit!==t.value)("bg-slate-800/50",i.config().limit!==t.value)("text-slate-400",i.config().limit!==t.value),K("disabled",t.value>i.maxLimit()),h(),k(" ",t.label," "),h(),A(t.value>i.maxLimit()?2:-1)}}function Xy(n,e){if(n&1){let t=F();p(0,"button",80),D("click",function(){let o=b(t).$implicit,s=_(3);return S(s.setOnlineStatus(o.value))}),m(1),g()}if(n&2){let t=e.$implicit,i=_(3);V("border-cyan-500",i.config().filters.onlineStatus===t.value)("bg-cyan-500/20",i.config().filters.onlineStatus===t.value)("text-cyan-400",i.config().filters.onlineStatus===t.value)("border-slate-700",i.config().filters.onlineStatus!==t.value)("bg-slate-800/50",i.config().filters.onlineStatus!==t.value)("text-slate-400",i.config().filters.onlineStatus!==t.value),h(),be(" ",t.icon," ",t.label," ")}}function Zy(n,e){if(n&1){let t=F();p(0,"div",77)(1,"div")(2,"label",81),m(3,"\u23F0 \u6D3B\u8E8D\u5EA6\u7BE9\u9078"),g(),p(4,"div",82)(5,"span",83),m(6,"\u6700\u8FD1"),g(),p(7,"select",84),D("change",function(o){b(t);let s=_(3);return S(s.setActivityDays(o))}),p(8,"option",85),m(9,"\u4E0D\u9650"),g(),p(10,"option",86),m(11,"3 \u5929"),g(),p(12,"option",87),m(13,"7 \u5929"),g(),p(14,"option",88),m(15,"14 \u5929"),g(),p(16,"option",89),m(17,"30 \u5929"),g()(),p(18,"span",83),m(19,"\u5167\u6D3B\u52D5"),g()()(),p(20,"div",68)(21,"label",90)(22,"input",70),D("change",function(){b(t);let o=_(3);return S(o.toggleAdvanced("autoSaveToResources"))}),g(),p(23,"div")(24,"p",71),m(25,"\u81EA\u52D5\u4FDD\u5B58"),g(),p(26,"p",31),m(27,"\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3"),g()()(),p(28,"label",90)(29,"input",70),D("change",function(){b(t);let o=_(3);return S(o.toggleAdvanced("skipDuplicates"))}),g(),p(30,"div")(31,"p",71),m(32,"\u8DF3\u904E\u91CD\u8907"),g(),p(33,"p",31),m(34,"\u5DF2\u5B58\u5728\u7684\u6210\u54E1"),g()()(),p(35,"label",90)(36,"input",70),D("change",function(){b(t);let o=_(3);return S(o.toggleFilter("excludeAdmins"))}),g(),p(37,"div")(38,"p",71),m(39,"\u6392\u9664\u7BA1\u7406\u54E1"),g(),p(40,"p",31),m(41,"\u7FA4\u4E3B\u548C\u7BA1\u7406\u54E1"),g()()(),p(42,"label",90)(43,"input",70),D("change",function(){b(t);let o=_(3);return S(o.toggleAdvanced("shuffleOrder"))}),g(),p(44,"div")(45,"p",71),m(46,"\u96A8\u6A5F\u9806\u5E8F"),g(),p(47,"p",31),m(48,"\u6253\u4E82\u63D0\u53D6\u9806\u5E8F"),g()()()()()}if(n&2){let t=_(3);h(7),K("value",t.config().filters.minActivityDays||""),h(15),K("checked",t.config().advanced.autoSaveToResources),h(7),K("checked",t.config().advanced.skipDuplicates),h(7),K("checked",t.config().filters.excludeAdmins),h(7),K("checked",t.config().advanced.shuffleOrder)}}function jy(n,e){if(n&1){let t=F();p(0,"div")(1,"label",59),m(2," \u26A1 \u5FEB\u901F\u6A21\u677F "),g(),p(3,"div",60)(4,"button",61),D("click",function(){b(t);let o=_(2);return S(o.selectTemplate("quick"))}),p(5,"div",62),m(6,"\u26A1"),g(),p(7,"p",63),m(8,"\u5FEB\u901F\u63D0\u53D6"),g(),p(9,"p",64),m(10,"100\u4EBA \xB7 \u50C5\u5728\u7DDA"),g()(),p(11,"button",61),D("click",function(){b(t);let o=_(2);return S(o.selectTemplate("deep"))}),p(12,"div",62),m(13,"\u{1F50D}"),g(),p(14,"p",63),m(15,"\u6DF1\u5EA6\u63D0\u53D6"),g(),p(16,"p",64),m(17,"500\u4EBA \xB7 \u5168\u72C0\u614B"),g()(),p(18,"button",61),D("click",function(){b(t);let o=_(2);return S(o.selectTemplate("precise"))}),p(19,"div",62),m(20,"\u{1F3AF}"),g(),p(21,"p",63),m(22,"\u7CBE\u6E96\u63D0\u53D6"),g(),p(23,"p",64),m(24,"\u81EA\u5B9A\u7FA9\u689D\u4EF6"),g()()()(),p(25,"div")(26,"label",59),m(27," \u{1F522} \u63D0\u53D6\u6578\u91CF "),g(),p(28,"div",53),X(29,Yy,3,15,"button",65,jc),g()(),p(31,"div")(32,"label",59),m(33," \u{1F4CD} \u5728\u7DDA\u72C0\u614B "),g(),p(34,"div",66),X(35,Xy,2,14,"button",67,jc),g()(),p(37,"div")(38,"label",59),m(39," \u{1F3F7}\uFE0F \u6210\u54E1\u5C6C\u6027 "),g(),p(40,"div",68)(41,"label",69)(42,"input",70),D("change",function(){b(t);let o=_(2);return S(o.toggleFilter("excludeBots"))}),g(),p(43,"div")(44,"p",71),m(45,"\u6392\u9664\u6A5F\u5668\u4EBA"),g(),p(46,"p",31),m(47,"\u904E\u6FFE Bot \u5E33\u865F"),g()()(),p(48,"label",69)(49,"input",70),D("change",function(){b(t);let o=_(2);return S(o.toggleFilter("hasUsername"))}),g(),p(50,"div")(51,"p",71),m(52,"\u9700\u6709\u7528\u6236\u540D"),g(),p(53,"p",31),m(54,"\u50C5\u63D0\u53D6\u6709 @username"),g()()(),p(55,"label",69)(56,"input",70),D("change",function(){b(t);let o=_(2);return S(o.toggleFilter("hasChinese"))}),g(),p(57,"div")(58,"p",71),m(59,"\u50C5\u83EF\u4EBA\u7528\u6236"),g(),p(60,"p",31),m(61,"\u4E2D\u6587\u540D\u7A31\u512A\u5148"),g()()(),p(62,"label",69)(63,"input",70),D("change",function(){b(t);let o=_(2);return S(o.toggleFilter("isPremium"))}),g(),p(64,"div")(65,"p",71),m(66,"Premium \u7528\u6236"),g(),p(67,"p",31),m(68,"\u50C5\u4ED8\u8CBB\u6703\u54E1 \u2B50"),g()()()()(),p(69,"div",72)(70,"button",73),D("click",function(){b(t);let o=_(2);return S(o.showAdvanced.set(!o.showAdvanced()))}),p(71,"span",74),m(72,"\u2699\uFE0F \u9AD8\u7D1A\u9078\u9805"),g(),j(),p(73,"svg",75),q(74,"path",76),g()(),T(75,Zy,49,5,"div",77),g()}if(n&2){let t=_(2);h(4),V("border-emerald-500",t.selectedTemplate()==="quick")("bg-emerald-500/20",t.selectedTemplate()==="quick")("border-slate-700",t.selectedTemplate()!=="quick")("bg-slate-800/50",t.selectedTemplate()!=="quick"),h(7),V("border-blue-500",t.selectedTemplate()==="deep")("bg-blue-500/20",t.selectedTemplate()==="deep")("border-slate-700",t.selectedTemplate()!=="deep")("bg-slate-800/50",t.selectedTemplate()!=="deep"),h(7),V("border-purple-500",t.selectedTemplate()==="precise")("bg-purple-500/20",t.selectedTemplate()==="precise")("border-slate-700",t.selectedTemplate()!=="precise")("bg-slate-800/50",t.selectedTemplate()!=="precise"),h(11),Z(t.limitOptions),h(6),Z(t.onlineStatusOptions),h(7),K("checked",t.config().filters.excludeBots),h(7),K("checked",t.config().filters.hasUsername===!0),h(7),K("checked",t.config().filters.hasChinese===!0),h(7),K("checked",t.config().filters.isPremium===!0),h(10),V("rotate-180",t.showAdvanced()),h(2),A(t.showAdvanced()?75:-1)}}function eb(n,e){if(n&1){let t=F();p(0,"div",1),D("click",function(o){b(t);let s=_();return S(s.onBackdropClick(o))}),p(1,"div",2),D("click",function(o){return b(t),S(o.stopPropagation())}),p(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),m(6," \u{1F465} "),g(),p(7,"div")(8,"h2",7),m(9,"\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1"),g(),p(10,"p",8),m(11,"\u914D\u7F6E\u63D0\u53D6\u9078\u9805\u548C\u7BE9\u9078\u689D\u4EF6"),g()()(),p(12,"button",9),D("click",function(){b(t);let o=_();return S(o.close())}),j(),p(13,"svg",10),q(14,"path",11),g()()()(),ce(),p(15,"div",12),T(16,Jy,15,7),T(17,jy,76,31),g(),p(18,"div",13)(19,"div",14)(20,"div",15)(21,"span",16),m(22," \u{1F4A1} \u9810\u8A08\u63D0\u53D6\uFF1A "),p(23,"span",17),m(24),g(),m(25," \u4EBA "),g()(),p(26,"div",16),m(27," \u{1F4CA} \u4ECA\u65E5\u914D\u984D\uFF1A "),p(28,"span",18),m(29),g(),m(30),g()(),p(31,"div",19)(32,"button",20),D("click",function(){b(t);let o=_();return S(o.close())}),m(33," \u53D6\u6D88 "),g(),p(34,"button",21),D("click",function(){b(t);let o=_();return S(o.startExtraction())}),p(35,"span"),m(36,"\u{1F465}"),g(),p(37,"span"),m(38),g()()()()()()}if(n&2){let t=_();h(16),A(t.group()?16:-1),h(),A(t.isChannel()?-1:17),h(7),R(t.estimatedCount()),h(5),R(t.remainingQuota()),h(),k(" / ",t.dailyQuota()," "),h(4),K("disabled",!t.canStart()),h(4),k("\u958B\u59CB\u63D0\u53D6 (",t.config().limit," \u4EBA)")}}var To=class n{constructor(){this.isOpen=se(!1);this.group=se(null);this.closeDialog=Q();this.startExtractionEvent=Q();this.memberCountRefreshed=Q();this.enableMonitoringEvent=Q();this.joinGroupEvent=Q();this.viewCollectedUsersEvent=Q();this.ipcService=O(Ie);this.toast=O(Ne);this.showAdvanced=v(!1);this.selectedTemplate=v("quick");this.isRefreshingCount=v(!1);this.extractionError=v(null);this.collectedUsersCount=v(0);this.isMonitoring=v(!1);this.config=v({limit:100,filters:{onlineStatus:"all",hasChinese:null,hasUsername:null,isPremium:null,excludeBots:!0,excludeAdmins:!1,minActivityDays:null},advanced:{shuffleOrder:!1,skipDuplicates:!0,autoSaveToResources:!0,extractAvatar:!1}});this.limitOptions=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:-1,label:"\u5168\u90E8"}];this.onlineStatusOptions=[{value:"all",label:"\u5168\u90E8",icon:"\u{1F4CA}"},{value:"online",label:"\u5728\u7DDA",icon:"\u{1F7E2}"},{value:"recently",label:"\u6700\u8FD1",icon:"\u{1F7E1}"},{value:"offline",label:"\u96E2\u7DDA",icon:"\u26AB"}];this.maxLimit=G(()=>{let e=this.group()?.memberCount||0;return Math.min(e,1e4)});this.dailyQuota=v(1e3);this.remainingQuota=v(800);this.estimatedCount=G(()=>{let e=this.config().limit,t=this.group()?.memberCount||0;return e===-1?Math.min(t,this.remainingQuota()):Math.min(e,t,this.remainingQuota())});this.isChannel=G(()=>this.group()?.resourceType==="channel");this.canStart=G(()=>!this.group()||this.isChannel()?!1:this.estimatedCount()>0);this.listeners=[]}ngOnInit(){this.loadQuota(),this.listenForExtractionErrors(),this.loadCollectedUsersCount()}ngOnDestroy(){this.listeners.forEach(e=>e())}loadQuota(){let e=this.ipcService.on("extraction-quota",t=>{t&&(this.dailyQuota.set(t.daily||1e3),this.remainingQuota.set(t.remaining||800))});this.listeners.push(e),this.ipcService.send("get-extraction-quota",{})}listenForExtractionErrors(){let e=this.ipcService.on("members-extracted",t=>{let i=this.group();if(!(!i||String(t.resourceId)!==String(i.id)))if(!t.success&&t.error_code){let o=t.error_details||{},r={ADMIN_REQUIRED:{title:"\u9700\u8981\u7BA1\u7406\u54E1\u6B0A\u9650",defaultReason:"\u6B64\u7FA4\u7D44\u8A2D\u7F6E\u4E86\u6210\u54E1\u5217\u8868\u53EA\u5C0D\u7BA1\u7406\u54E1\u53EF\u898B"},PEER_ID_INVALID:{title:"\u5E33\u865F\u5C1A\u672A\u9023\u63A5\u6B64\u7FA4\u7D44",defaultReason:"Telegram \u8981\u6C42\u5E33\u865F\u5FC5\u9808\u5148\u52A0\u5165\u7FA4\u7D44"},NOT_PARTICIPANT:{title:"\u5E33\u865F\u4E0D\u662F\u7FA4\u7D44\u6210\u54E1",defaultReason:"\u7576\u524D\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44"},CHANNEL_PRIVATE:{title:"\u79C1\u6709\u7FA4\u7D44",defaultReason:"\u9019\u662F\u4E00\u500B\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u5148\u52A0\u5165"},CHANNEL_INVALID:{title:"\u7121\u6548\u7684\u7FA4\u7D44",defaultReason:"\u7FA4\u7D44\u53EF\u80FD\u5DF2\u88AB\u522A\u9664\u6216 ID \u7121\u6548"},USERNAME_NOT_OCCUPIED:{title:"\u7121\u6CD5\u89E3\u6790\u7FA4\u7D44",defaultReason:"\u9019\u53EF\u80FD\u662F\u79C1\u6709\u7FA4\u7D44\uFF0C\u6C92\u6709\u516C\u958B\u7684 username"}}[t.error_code]||{title:"\u63D0\u53D6\u5931\u6557",defaultReason:t.error||"\u672A\u77E5\u932F\u8AA4"};this.extractionError.set({code:t.error_code,title:r.title,reason:o.reason||r.defaultReason,suggestion:o.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66\u6216\u5617\u8A66\u5176\u4ED6\u65B9\u5F0F",alternative:o.alternative==="monitor_messages"?"monitor":void 0,canAutoJoin:o.can_auto_join})}else t.success&&this.extractionError.set(null)});this.listeners.push(e)}enableMonitoring(){let e=this.group();e&&(this.enableMonitoringEvent.emit(e),this.toast.info("\u{1F4E1} \u6B63\u5728\u958B\u555F\u6D88\u606F\u76E3\u63A7\uFF0C\u5C07\u81EA\u52D5\u6536\u96C6\u767C\u8A00\u7528\u6236"),this.close())}joinGroup(){let e=this.group();e&&(this.joinGroupEvent.emit(e),this.toast.info("\u2795 \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44..."))}selectTemplate(e){switch(this.selectedTemplate.set(e),e){case"quick":this.config.update(t=>N(M({},t),{limit:100,filters:N(M({},t.filters),{onlineStatus:"online",excludeBots:!0})}));break;case"deep":this.config.update(t=>N(M({},t),{limit:500,filters:N(M({},t.filters),{onlineStatus:"all",excludeBots:!0})}));break;case"precise":break}}setLimit(e){this.selectedTemplate.set("precise"),this.config.update(t=>N(M({},t),{limit:e}))}setOnlineStatus(e){this.selectedTemplate.set("precise"),this.config.update(t=>N(M({},t),{filters:N(M({},t.filters),{onlineStatus:e})}))}toggleFilter(e){this.selectedTemplate.set("precise"),this.config.update(t=>{let i=M({},t.filters);return e==="excludeBots"||e==="excludeAdmins"?i[e]=!i[e]:i[e]===null||i[e]===void 0?i[e]=!0:i[e]===!0?i[e]=!1:i[e]=null,N(M({},t),{filters:i})})}toggleAdvanced(e){this.config.update(t=>N(M({},t),{advanced:N(M({},t.advanced),{[e]:!t.advanced[e]})}))}setActivityDays(e){let t=e.target.value,i=t?parseInt(t,10):null;this.selectedTemplate.set("precise"),this.config.update(o=>N(M({},o),{filters:N(M({},o.filters),{minActivityDays:i})}))}refreshMemberCount(){let e=this.group();if(!e)return;this.isRefreshingCount.set(!0);let t=this.ipcService.on("group-member-count-result",i=>{this.isRefreshingCount.set(!1),t(),i.success&&i.memberCount>0?(this.toast.success(`\u2705 \u6210\u529F\u7372\u53D6\u6210\u54E1\u6578\uFF1A${i.memberCount} \u4EBA`),this.memberCountRefreshed.emit({groupId:e.id,memberCount:i.memberCount})):this.toast.error(i.error||"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\uFF0C\u8ACB\u78BA\u8A8D\u5DF2\u52A0\u5165\u8A72\u7FA4\u7D44")});this.listeners.push(t),this.ipcService.send("get-group-member-count",{groupId:e.id,url:e.url,telegramId:e.telegramId||e.id,accountPhone:e.accountPhone}),setTimeout(()=>{this.isRefreshingCount()&&(this.isRefreshingCount.set(!1),this.toast.error("\u7372\u53D6\u6210\u54E1\u6578\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"))},15e3)}startExtraction(){let e=this.group();if(!e){this.toast.error("\u7FA4\u7D44\u4FE1\u606F\u4E0D\u5B58\u5728");return}if(this.estimatedCount()===0){this.toast.warning("\u6210\u54E1\u6578\u64DA\u4E0D\u53EF\u7528\uFF0C\u8ACB\u5148\u9EDE\u64CA\u300C\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578\u300D");return}this.startExtractionEvent.emit({group:e,config:this.config()}),this.close()}close(){this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&this.close()}checkMonitoringStatus(){let e=this.group();if(!e)return;this.ipcService.send("get-group-monitoring-status",{groupId:e.id,telegramId:e.telegramId});let t=this.ipcService.on("group-monitoring-status",i=>{String(i.groupId)===String(e.id)&&(this.isMonitoring.set(i.isMonitoring),this.collectedUsersCount.set(i.collectedUsers||0),i.isMonitoring?this.toast.success(`\u2705 \u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u5DF2\u6536\u96C6 ${i.collectedUsers} \u4F4D\u7528\u6236`):this.toast.warning("\u26A0\uFE0F \u76E3\u63A7\u672A\u958B\u555F\uFF0C\u8ACB\u5728\u7FA4\u7D44\u8A73\u60C5\u4E2D\u958B\u555F\u76E3\u63A7"),t())});this.listeners.push(t),this.toast.info("\u{1F50D} \u6B63\u5728\u6AA2\u67E5\u76E3\u63A7\u72C0\u614B...")}viewCollectedUsers(){let e=this.group();e&&(this.viewCollectedUsersEvent.emit(e),this.close())}collectFromHistory(){let e=this.group();if(!e)return;this.toast.info("\u{1F504} \u6B63\u5728\u5F9E\u6B77\u53F2\u6D88\u606F\u4E2D\u6536\u96C6\u7528\u6236..."),this.ipcService.send("collect-users-from-history",{groupId:e.id,telegramId:e.telegramId,limit:500});let t=this.ipcService.on("collect-from-history-result",i=>{String(i.groupId)===String(e.id)&&(t(),i.success?(this.toast.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${i.collected} \u4F4D\u7528\u6236\uFF0C\u65B0\u589E ${i.newUsers||0} \u4F4D`),this.collectedUsersCount.update(o=>o+(i.newUsers||0))):this.toast.error(i.error||"\u6536\u96C6\u5931\u6557"))});this.listeners.push(t)}loadCollectedUsersCount(){let e=this.group();if(!e)return;this.ipcService.send("get-collected-users-count",{groupId:e.id,sourceType:"monitoring"});let t=this.ipcService.on("collected-users-count",i=>{String(i.groupId)===String(e.id)&&(this.collectedUsersCount.set(i.count||0),t())});this.listeners.push(t)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-member-extraction-dialog"]],inputs:{isOpen:[1,"isOpen"],group:[1,"group"]},outputs:{closeDialog:"closeDialog",startExtractionEvent:"startExtractionEvent",memberCountRefreshed:"memberCountRefreshed",enableMonitoringEvent:"enableMonitoringEvent",joinGroupEvent:"joinGroupEvent",viewCollectedUsersEvent:"viewCollectedUsersEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col",3,"click"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","space-y-5"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"flex","items-center","justify-between","mb-4","text-sm"],[1,"flex","items-center","gap-4"],[1,"text-slate-400"],[1,"text-emerald-400","font-medium"],[1,"text-cyan-400","font-medium"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-colors","font-medium",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-emerald-500/20","to-cyan-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1"],[1,"font-medium","text-white"],[1,"text-right"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-4","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"border",3,"bg-red-500/10","border-red-500/30","bg-amber-500/10","border-amber-500/30"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-lg","font-bold","text-amber-400"],[1,"text-xs","text-amber-400"],[1,"flex","items-start","gap-3"],[1,"text-xl"],[1,"font-medium","text-amber-400","mb-1"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-slate-400","space-y-1","list-disc","list-inside","mb-3"],[1,"flex","gap-2"],[1,"px-3","py-1.5","bg-amber-500/20","hover:bg-amber-500/30","text-amber-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-1",3,"click","disabled"],[1,"animate-spin"],[1,"font-medium","text-red-400","mb-1"],[1,"border"],[1,"font-medium","mb-1"],[1,"text-sm","text-slate-400","mb-2"],[1,"p-3","bg-slate-800/50","rounded-lg"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2"],[1,"p-3","bg-slate-800/50","rounded-lg","mb-3"],[1,"text-sm","text-slate-300","mb-2"],[1,"text-sm","text-slate-400","space-y-1.5"],[1,"flex","items-start","gap-2"],[1,"text-emerald-400"],[1,"flex","flex-wrap","gap-2"],[1,"px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-orange-500/20","hover:bg-orange-500/30","text-orange-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-sm","text-cyan-400","flex","items-center","gap-2"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"grid","grid-cols-3","gap-3"],[1,"p-4","rounded-xl","border","transition-all","text-center","group",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","mt-1"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-emerald-500","bg-emerald-500/20","text-emerald-400","border-slate-700","bg-slate-800/50","text-slate-400","disabled"],[1,"grid","grid-cols-4","gap-2"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"border-cyan-500","bg-cyan-500/20","text-cyan-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","gap-3","p-3","bg-slate-800/50","rounded-xl","border","border-slate-700/50","cursor-pointer","hover:bg-slate-800","transition-colors"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600","text-emerald-500","focus:ring-emerald-500",3,"change","checked"],[1,"text-sm","text-white"],[1,"border","border-slate-700/50","rounded-xl","overflow-hidden"],[1,"w-full","p-4","bg-slate-800/30","flex","items-center","justify-between","hover:bg-slate-800/50","transition-colors",3,"click"],[1,"text-sm","font-medium","text-slate-300"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-400","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-4","space-y-4","border-t","border-slate-700/50"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"click","disabled"],[1,"ml-1","text-xs","text-orange-400"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"click"],[1,"block","text-sm","text-slate-400","mb-2"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-slate-300"],[1,"px-3","py-1.5","bg-slate-700","border","border-slate-600","rounded-lg","text-sm","text-white","focus:ring-emerald-500","focus:border-emerald-500",3,"change","value"],["value",""],["value","3"],["value","7"],["value","14"],["value","30"],[1,"flex","items-center","gap-3","cursor-pointer","p-2","bg-slate-700/30","rounded-lg","hover:bg-slate-700/50"]],template:function(t,i){t&1&&T(0,eb,39,7,"div",0),t&2&&A(i.isOpen()?0:-1)},dependencies:[de,Te,Gt,Ut,Ln],encapsulation:2})}};var tb=(n,e)=>e.phone;function nb(n,e){if(n&1&&(x(0,"p",18),m(1),w()),n&2){let t=_().$implicit;h(),be(" \u2713 \u6709\u5143\u6578\u64DA: ",t.metadata.firstName||""," ",t.metadata.username?"@"+t.metadata.username:""," ")}}function ib(n,e){n&1&&(x(0,"p",19),m(1,"\u26A0 \u7121\u5143\u6578\u64DA\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u9304\u9A57\u8B49"),w())}function ob(n,e){if(n&1&&(x(0,"div",9)(1,"div",15)(2,"span",16),m(3,"\u{1F4F1}"),w(),x(4,"div")(5,"p",17),m(6),w(),T(7,nb,2,2,"p",18)(8,ib,2,0,"p",19),w()()()),n&2){let t=e.$implicit;h(6),k("+",t.phone),h(),A(t.hasMetadata&&t.metadata?7:8)}}function sb(n,e){n&1&&(x(0,"span",20),m(1,"\u23F3"),w(),x(2,"span"),m(3,"\u6062\u5FA9\u4E2D..."),w())}function rb(n,e){n&1&&(x(0,"span"),m(1,"\u{1F504}"),w(),x(2,"span"),m(3,"\u6062\u5FA9\u5E33\u865F"),w())}var Ao=class n{constructor(){this.sessions=se([]);this.isRecovering=se(!1);this.dismiss=Q();this.recover=Q()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-orphan-session-dialog"]],inputs:{sessions:[1,"sessions"],isRecovering:[1,"isRecovering"]},outputs:{dismiss:"dismiss",recover:"recover"},decls:27,vars:3,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-amber-500/50"],[1,"bg-amber-500/20","p-6","text-center","border-b","border-amber-500/30"],[1,"text-5xl","mb-3"],[1,"text-xl","font-bold","text-amber-400"],[1,"text-slate-400","text-sm","mt-2"],[1,"p-6","space-y-4"],[1,"text-slate-300","text-sm"],[1,"bg-slate-700/50","rounded-lg","p-3","max-h-48","overflow-y-auto","space-y-2"],[1,"flex","items-center","justify-between","p-2","bg-slate-600/50","rounded-lg"],[1,"bg-blue-500/10","border","border-blue-500/30","rounded-lg","p-3"],[1,"text-blue-400","text-sm"],[1,"p-4","bg-slate-700/30","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-amber-500","hover:bg-amber-600","disabled:opacity-50","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click","disabled"],[1,"flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-white","font-medium"],[1,"text-green-400","text-xs"],[1,"text-amber-400","text-xs"],[1,"animate-spin"]],template:function(t,i){t&1&&(x(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m(4,"\u{1F504}"),w(),x(5,"h2",4),m(6,"\u767C\u73FE\u53EF\u6062\u5FA9\u7684\u5E33\u865F"),w(),x(7,"p",5),m(8),w()(),x(9,"div",6)(10,"p",7),m(11," \u9019\u4E9B Session \u6587\u4EF6\u5B58\u5728\u65BC\u7CFB\u7D71\u4E2D\uFF0C\u4F46\u672A\u5728\u6578\u64DA\u5EAB\u4E2D\u627E\u5230\u5C0D\u61C9\u7684\u5E33\u865F\u8A18\u9304\u3002 \u60A8\u53EF\u4EE5\u5617\u8A66\u6062\u5FA9\u9019\u4E9B\u5E33\u865F\uFF0C\u6216\u9078\u64C7\u5FFD\u7565\u3002 "),w(),x(12,"div",8),X(13,ob,9,2,"div",9,tb),w(),x(15,"div",10)(16,"p",11),m(17," \u{1F4A1} "),x(18,"strong"),m(19,"\u63D0\u793A\uFF1A"),w(),m(20," \u6062\u5FA9\u5F8C\uFF0C\u5E33\u865F\u5C07\u4EE5\u300C\u96E2\u7DDA\u300D\u72C0\u614B\u6DFB\u52A0\u5230\u5217\u8868\u4E2D\u3002 \u60A8\u9700\u8981\u9EDE\u64CA\u300C\u767B\u9304\u300D\u4F86\u91CD\u65B0\u9023\u63A5\u5E33\u865F\u3002 "),w()()(),x(21,"div",12)(22,"button",13),U("click",function(){return i.dismiss.emit()}),m(23," \u7A0D\u5F8C\u8655\u7406 "),w(),x(24,"button",14),U("click",function(){return i.recover.emit()}),T(25,sb,4,0)(26,rb,4,0),w()()()()),t&2&&(h(8),k(" \u767C\u73FE ",i.sessions().length," \u500B Session \u6587\u4EF6\u9700\u8981\u624B\u52D5\u6062\u5FA9 "),h(5),Z(i.sessions()),h(11),Fe("disabled",i.isRecovering()),h(),A(i.isRecovering()?25:26))},encapsulation:2})}};function ab(n,e){if(n&1&&(x(0,"div",14)(1,"p",17)(2,"span",18),m(3,"\u932F\u8AA4\u8A73\u60C5\uFF1A"),w(),m(4),w()()),n&2){let t=_();h(4),k(" ",t.errorDetail()," ")}}var Do=class n{constructor(){this.errorDetail=se("");this.close=Q()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-backend-error-dialog"]],inputs:{errorDetail:[1,"errorDetail"]},outputs:{close:"close"},decls:45,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-red-500/50"],[1,"bg-red-500/20","p-6","text-center","border-b","border-red-500/30"],[1,"text-5xl","mb-3"],[1,"text-xl","font-bold","text-red-400"],[1,"p-6","space-y-4"],[1,"text-slate-300"],[1,"bg-slate-700/50","rounded-lg","p-4","space-y-3"],[1,"flex","items-start","gap-3"],[1,"text-cyan-400"],[1,"text-white","font-medium"],["href","https://www.python.org/downloads/","target","_blank",1,"text-cyan-400","text-sm","hover:underline"],[1,"text-slate-400","text-sm"],[1,"block","bg-slate-800","text-green-400","text-sm","p-2","rounded","mt-1"],[1,"bg-red-500/10","border","border-red-500/30","rounded-lg","p-3"],[1,"p-4","bg-slate-700/30","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"text-red-400","text-sm"],[1,"font-medium"]],template:function(t,i){t&1&&(x(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m(4,"\u26A0\uFE0F"),w(),x(5,"h2",4),m(6,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),w()(),x(7,"div",5)(8,"p",6),m(9," \u7A0B\u5E8F\u9700\u8981 Python \u74B0\u5883\u624D\u80FD\u6B63\u5E38\u904B\u884C\u3002\u8ACB\u78BA\u4FDD\uFF1A "),w(),x(10,"div",7)(11,"div",8)(12,"span",9),m(13,"1."),w(),x(14,"div")(15,"p",10),m(16,"\u5B89\u88DD Python 3.9+"),w(),x(17,"a",11),m(18," https://www.python.org/downloads/ "),w()()(),x(19,"div",8)(20,"span",9),m(21,"2."),w(),x(22,"div")(23,"p",10),m(24,'\u5B89\u88DD\u6642\u52FE\u9078 "Add Python to PATH"'),w(),x(25,"p",12),m(26,"\u78BA\u4FDD Python \u6DFB\u52A0\u5230\u7CFB\u7D71\u74B0\u5883\u8B8A\u91CF"),w()()(),x(27,"div",8)(28,"span",9),m(29,"3."),w(),x(30,"div")(31,"p",10),m(32,"\u5B89\u88DD\u4F9D\u8CF4"),w(),x(33,"code",13),m(34," pip install pyrogram tgcrypto aiosqlite "),w()()(),x(35,"div",8)(36,"span",9),m(37,"4."),w(),x(38,"div")(39,"p",10),m(40,"\u91CD\u65B0\u555F\u52D5\u7A0B\u5E8F"),w()()()(),T(41,ab,5,1,"div",14),w(),x(42,"div",15)(43,"button",16),U("click",function(){return i.close.emit()}),m(44," \u6211\u77E5\u9053\u4E86 "),w()()()()),t&2&&(h(41),A(i.errorDetail()?41:-1))},encapsulation:2})}};var Mo=class n{constructor(){this.name=se("");this.cancel=Q();this.submit=Q();this.nameChange=Q()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-keyword-creator-dialog"]],inputs:{name:[1,"name"]},outputs:{cancel:"cancel",submit:"submit",nameChange:"nameChange"},decls:18,vars:1,consts:[[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden","border","border-cyan-500/30",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/20","to-blue-500/20","p-4","border-b","border-slate-700/50"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],[1,"p-6"],[1,"block","text-sm","text-slate-400","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u8CB7\u5BB6\u610F\u5411\u3001\u7522\u54C1\u8AEE\u8A62...","autofocus","",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-lg","px-4","py-3","text-white","focus:border-cyan-500","focus:ring-1","focus:ring-cyan-500","transition-colors",3,"input","keyup.enter","value"],[1,"text-xs","text-slate-500","mt-2"],[1,"p-4","bg-slate-700/30","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","transition-colors","font-medium",3,"click"]],template:function(t,i){t&1&&(x(0,"div",0),U("click",function(){return i.cancel.emit()}),x(1,"div",1),U("click",function(s){return s.stopPropagation()}),x(2,"div",2)(3,"h2",3)(4,"span"),m(5,"\u{1F511}"),w(),m(6," \u5275\u5EFA\u95DC\u9375\u8A5E\u96C6 "),w()(),x(7,"div",4)(8,"label",5),m(9,"\u95DC\u9375\u8A5E\u96C6\u540D\u7A31"),w(),x(10,"input",6),U("input",function(s){return i.nameChange.emit(s.target.value)})("keyup.enter",function(){return i.submit.emit()}),w(),x(11,"p",7),m(12," \u{1F4A1} \u5275\u5EFA\u5F8C\u53EF\u5728\u8A5E\u96C6\u4E2D\u6DFB\u52A0\u591A\u500B\u95DC\u9375\u8A5E "),w()(),x(13,"div",8)(14,"button",9),U("click",function(){return i.cancel.emit()}),m(15," \u53D6\u6D88 "),w(),x(16,"button",10),U("click",function(){return i.submit.emit()}),m(17," \u5275\u5EFA "),w()()()()),t&2&&(h(10),Fe("value",i.name()))},encapsulation:2})}};function lb(n,e){n&1&&(p(0,"div",8)(1,"div",16)(2,"div",17)(3,"div",18),m(4,"\u{1F916}"),g(),p(5,"div",19),m(6,"AI \u81EA\u52D5\u56DE\u8986"),g(),p(7,"div",20),m(8,"\u667A\u80FD\u5BA2\u670D\u52A9\u624B"),g()(),p(9,"div",17)(10,"div",18),m(11,"\u{1F50D}"),g(),p(12,"div",19),m(13,"\u8CC7\u6E90\u767C\u73FE"),g(),p(14,"div",20),m(15,"\u81EA\u52D5\u641C\u7D22\u7FA4\u7D44"),g()(),p(16,"div",17)(17,"div",18),m(18,"\u{1F4CA}"),g(),p(19,"div",19),m(20,"\u6578\u64DA\u5206\u6790"),g(),p(21,"div",20),m(22,"\u8F49\u5316\u8FFD\u8E64\u5831\u8868"),g()()(),p(23,"p",21),m(24," TG-AI\u667A\u63A7\u738B \u5C07\u5E6B\u52A9\u60A8\u81EA\u52D5\u5316 Telegram \u71DF\u92B7\u6D41\u7A0B\uFF0C"),q(25,"br"),m(26," \u8B93\u60A8\u5C08\u6CE8\u65BC\u696D\u52D9\u589E\u9577\u800C\u975E\u91CD\u8907\u64CD\u4F5C\u3002 "),g()())}function cb(n,e){if(n&1&&(p(0,"option",35),m(1),g()),n&2){let t=e.$implicit;K("value",t),h(),R(t)}}function db(n,e){if(n&1){let t=F();p(0,"select",34),D("ngModelChange",function(o){b(t);let s=_(3);return S(s.localModelChange.emit(o))}),X(1,cb,2,2,"option",35,ht),g()}if(n&2){let t=_(3);K("ngModel",t.localModel()),h(),Z(t.ollamaModels())}}function ub(n,e){if(n&1){let t=F();p(0,"input",36),D("ngModelChange",function(o){b(t);let s=_(3);return S(s.localModelChange.emit(o))}),g()}if(n&2){let t=_(3);K("ngModel",t.localModel())}}function mb(n,e){if(n&1&&(p(0,"div",17)(1,"label",30),m(2,"\u9078\u64C7 AI \u6A21\u578B"),g(),T(3,db,3,1,"select",31)(4,ub,1,1,"input",32),p(5,"p",33),m(6,"\u63A8\u85A6\uFF1Aqwen2:7b\uFF08\u4E2D\u82F1\u6587\u901A\u7528\uFF09"),g()()),n&2){let t=_(2);h(3),A(t.ollamaModels().length>0?3:4)}}function pb(n,e){if(n&1){let t=F();p(0,"div",45)(1,"select",46),D("ngModelChange",function(o){b(t);let s=_(3);return S(s.backupProviderChange.emit(o))}),p(2,"option",47),m(3,"Google Gemini\uFF08\u514D\u8CBB\u984D\u5EA6\uFF09"),g(),p(4,"option",48),m(5,"OpenAI GPT"),g()()()}if(n&2){let t=_(3);h(),K("ngModel",t.backupProvider())}}function gb(n,e){if(n&1){let t=F();p(0,"div",17)(1,"div",37)(2,"p",38),m(3,"\u{1F4E6} \u5B89\u88DD Ollama\uFF08\u514D\u8CBB\uFF09\uFF1A"),g(),p(4,"code",39),m(5," curl -fsSL https://ollama.com/install.sh | sh "),g(),p(6,"p",40),m(7," \u5B89\u88DD\u5F8C\u904B\u884C "),p(8,"code",41),m(9,"ollama pull qwen2:7b"),g(),m(10," \u4E0B\u8F09\u6A21\u578B "),g()()(),p(11,"div",17)(12,"label",42)(13,"input",43),D("change",function(){b(t);let o=_(2);return S(o.autoFallbackChange.emit(!o.autoFallback()))}),g(),p(14,"span",44),m(15,"\u4F7F\u7528\u96F2\u7AEF AI \u4F5C\u70BA\u5099\u9078"),g()(),T(16,pb,6,1,"div",45),g()}if(n&2){let t=_(2);h(13),K("checked",t.autoFallback()),h(3),A(t.autoFallback()?16:-1)}}function hb(n,e){if(n&1){let t=F();p(0,"div",9)(1,"h3",22),m(2,"\u{1F999} AI \u670D\u52D9\u914D\u7F6E"),g(),p(3,"div",23)(4,"div",24)(5,"div",25)(6,"span",26),m(7),g(),p(8,"div")(9,"div",27),m(10),g(),p(11,"div",28),m(12),g()()(),p(13,"button",29),D("click",function(){b(t);let o=_();return S(o.detectOllamaClick.emit())}),m(14),g()()(),T(15,mb,7,1,"div",17)(16,gb,17,2),g()}if(n&2){let t=_();h(3),Ae(t.ollamaDetected()?"bg-green-500/20 border border-green-500/30":"bg-yellow-500/20 border border-yellow-500/30"),h(4),R(t.ollamaDetected()?"\u2705":"\u26A0\uFE0F"),h(3),k(" ",t.ollamaDetected()?"Ollama \u5DF2\u6AA2\u6E2C\u5230":"Ollama \u672A\u904B\u884C"," "),h(2),k(" ",t.ollamaDetected()?"\u672C\u5730 AI \u670D\u52D9\u53EF\u7528":"\u5EFA\u8B70\u5B89\u88DD Ollama \u7372\u5F97\u514D\u8CBB AI \u80FD\u529B"," "),h(),K("disabled",t.isDetecting()),h(),k(" ",t.isDetecting()?"\u6AA2\u6E2C\u4E2D...":"\u91CD\u65B0\u6AA2\u6E2C"," "),h(),A(t.ollamaDetected()?15:16)}}function fb(n,e){if(n&1&&(p(0,"p"),m(1),g()),n&2){let t=_(2);h(),k("\u2705 \u6A21\u578B\uFF1A",t.localModel())}}function _b(n,e){if(n&1&&(p(0,"div",8)(1,"div",49),m(2,"\u{1F389}"),g(),p(3,"h3",50),m(4,"\u8A2D\u7F6E\u5B8C\u6210\uFF01"),g(),p(5,"p",21),m(6," \u60A8\u5DF2\u6E96\u5099\u597D\u958B\u59CB\u4F7F\u7528 TG-AI\u667A\u63A7\u738B\u3002"),q(7,"br"),m(8," \u63A5\u4E0B\u4F86\u8ACB\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B Telegram \u5E33\u865F\u3002 "),g(),p(9,"div",51)(10,"div",52)(11,"p"),m(12),g(),T(13,fb,2,1,"p"),p(14,"p"),m(15),g()()()()),n&2){let t=_();h(12),k("\u2705 AI \u670D\u52D9\uFF1A",t.ollamaDetected()?"Ollama \u672C\u5730 AI":"\u96F2\u7AEF AI"),h(),A(t.ollamaDetected()?13:-1),h(2),k("\u2705 \u81EA\u52D5\u964D\u7D1A\uFF1A",t.autoFallback()?"\u5DF2\u555F\u7528":"\u5DF2\u7981\u7528")}}function vb(n,e){if(n&1){let t=F();p(0,"button",53),D("click",function(){b(t);let o=_();return S(o.stepChange.emit(o.step()-1))}),m(1," \u4E0A\u4E00\u6B65 "),g()}}function Cb(n,e){if(n&1){let t=F();p(0,"button",54),D("click",function(){b(t);let o=_();return S(o.stepChange.emit(o.step()+1))}),m(1," \u4E0B\u4E00\u6B65 "),g()}}function yb(n,e){if(n&1){let t=F();p(0,"button",55),D("click",function(){b(t);let o=_();return S(o.complete.emit())}),m(1," \u958B\u59CB\u4F7F\u7528 \u{1F680} "),g()}}var Io=class n{constructor(){this.step=se(1);this.ollamaDetected=se(!1);this.isDetecting=se(!1);this.ollamaModels=se([]);this.localModel=se("");this.autoFallback=se(!1);this.backupProvider=se("gemini");this.skip=Q();this.complete=Q();this.stepChange=Q();this.detectOllamaClick=Q();this.localModelChange=Q();this.autoFallbackChange=Q();this.backupProviderChange=Q()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-welcome-dialog"]],inputs:{step:[1,"step"],ollamaDetected:[1,"ollamaDetected"],isDetecting:[1,"isDetecting"],ollamaModels:[1,"ollamaModels"],localModel:[1,"localModel"],autoFallback:[1,"autoFallback"],backupProvider:[1,"backupProvider"]},outputs:{skip:"skip",complete:"complete",stepChange:"stepChange",detectOllamaClick:"detectOllamaClick",localModelChange:"localModelChange",autoFallbackChange:"autoFallbackChange",backupProviderChange:"backupProviderChange"},decls:22,vars:9,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","shadow-2xl","w-full","max-w-2xl","mx-4","overflow-hidden","border","border-cyan-500/30"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","p-6","text-center"],[1,"text-3xl","font-bold","text-white","mb-2"],[1,"text-cyan-100"],[1,"flex","justify-center","gap-2","py-4","bg-slate-800/50"],[1,"w-3","h-3","rounded-full","transition-all"],[1,"p-6"],[1,"text-center","space-y-6"],[1,"space-y-4"],[1,"p-6","bg-slate-800/50","flex","justify-between","items-center"],[1,"text-sm","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"flex","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all"],[1,"grid","grid-cols-3","gap-4","mb-6"],[1,"p-4","bg-slate-700/50","rounded-xl"],[1,"text-3xl","mb-2"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-slate-400"],[1,"text-slate-300"],[1,"text-lg","font-semibold","text-white","text-center","mb-4"],[1,"p-4","rounded-xl"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-2xl"],[1,"font-medium","text-white"],[1,"text-sm","text-slate-400"],[1,"px-3","py-1","bg-slate-700","hover:bg-slate-600","rounded","text-sm","text-white","disabled:opacity-50",3,"click","disabled"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],[1,"text-xs","text-slate-500","mt-1"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],[3,"value"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300","space-y-2"],[1,"font-medium"],[1,"block","bg-slate-800","p-2","rounded","text-cyan-400","text-xs"],[1,"text-xs","text-slate-500"],[1,"text-cyan-400"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-cyan-500","rounded",3,"change","checked"],[1,"text-sm","text-slate-300"],[1,"mt-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded","py-1","px-2","text-sm","text-white",3,"ngModelChange","ngModel"],["value","gemini"],["value","openai"],[1,"text-6xl","mb-4"],[1,"text-2xl","font-bold","text-white"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30"],[1,"text-sm","text-slate-300","space-y-1"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all",3,"click"]],template:function(t,i){if(t&1&&(p(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),m(4,"\u{1F680} \u6B61\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B"),g(),p(5,"p",4),m(6,"AI \u9A45\u52D5\u7684 Telegram \u71DF\u92B7\u81EA\u52D5\u5316\u5E73\u53F0"),g()(),p(7,"div",5),q(8,"div",6)(9,"div",6)(10,"div",6),g(),p(11,"div",7),T(12,lb,27,0,"div",8)(13,hb,17,8,"div",9)(14,_b,16,3,"div",8),g(),p(15,"div",10)(16,"button",11),D("click",function(){return i.skip.emit()}),m(17," \u8DF3\u904E\u8A2D\u7F6E "),g(),p(18,"div",12),T(19,vb,2,0,"button",13),T(20,Cb,2,0,"button",14)(21,yb,2,0,"button",15),g()()()()),t&2){let o;h(8),Ae(i.step()>=1?"bg-cyan-500":"bg-slate-600"),h(),Ae(i.step()>=2?"bg-cyan-500":"bg-slate-600"),h(),Ae(i.step()>=3?"bg-cyan-500":"bg-slate-600"),h(2),A((o=i.step())===1?12:o===2?13:o===3?14:-1),h(7),A(i.step()>1?19:-1),h(),A(i.step()<3?20:21)}},dependencies:[Te,Gt,Ut,Le,Un,Ve,Be],encapsulation:2})}};var bb=(n,e)=>e.id;function Sb(n,e){n&1&&(x(0,"div",13),j(),x(1,"svg",17),Ee(2,"circle",18)(3,"path",19),w(),ce(),x(4,"p"),m(5,"\u66AB\u7121\u64CD\u4F5C\u6B77\u53F2"),w()())}function xb(n,e){n&1&&(x(0,"span",32),m(1,"\uFF08\u5DF2\u64A4\u92B7\uFF09"),w())}function wb(n,e){if(n&1&&(x(0,"span",35),m(1),w()),n&2){let t=_().$implicit;h(),k("",t.failureCount," \u5931\u6557")}}function Eb(n,e){if(n&1){let t=F();x(0,"button",37),U("click",function(o){b(t);let s=_().$implicit;return _(2).undo.emit(s.id),S(o.stopPropagation())}),m(1," \u64A4\u92B7 "),w()}}function Tb(n,e){if(n&1&&(x(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24),j(),x(4,"svg",25),Ee(5,"rect",26)(6,"rect",27)(7,"rect",28)(8,"rect",29),w()(),ce(),x(9,"div")(10,"p",30),m(11),w(),x(12,"p",31),m(13),T(14,xb,2,0,"span",32),w()()(),x(15,"div",23)(16,"div",33)(17,"span",34),m(18),w(),T(19,wb,2,1,"span",35),w(),T(20,Eb,2,0,"button",36),w()()()),n&2){let t=e.$implicit,i=_(2);V("opacity-50",t.reversed),h(3),V("bg-cyan-500/20",t.operationType==="update_status")("bg-blue-500/20",t.operationType==="add_tag")("bg-red-500/20",t.operationType==="delete"||t.operationType==="add_to_dnc"),h(),V("text-cyan-400",t.operationType==="update_status")("text-blue-400",t.operationType==="add_tag")("text-red-400",t.operationType==="delete"||t.operationType==="add_to_dnc"),h(7),R(i.getOpTypeName(t.operationType)),h(2),be(" ",t.itemCount," \u9805 \xB7 ",i.formatDate(t.createdAt)," "),h(),A(t.reversed?14:-1),h(4),k("",t.successCount," \u6210\u529F"),h(),A(t.failureCount>0?19:-1),h(),A(t.isReversible&&!t.reversed?20:-1)}}function Ab(n,e){if(n&1&&(x(0,"div",14),X(1,Tb,21,21,"div",20,bb),w()),n&2){let t=_();h(),Z(t.history())}}var ko=class n{constructor(){this.history=se([]);this.close=Q();this.undo=Q()}getOpTypeName(e){return{update_status:"\u72C0\u614B\u66F4\u65B0",add_tag:"\u6DFB\u52A0\u6A19\u7C64",delete:"\u522A\u9664",add_to_dnc:"\u52A0\u5165\u9ED1\u540D\u55AE",export:"\u5C0E\u51FA"}[e]||e}formatDate(e){try{let t=new Date(e);return`${t.getMonth()+1}/${t.getDate()} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}catch{return e}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-batch-history-dialog"]],inputs:{history:[1,"history"]},outputs:{close:"close",undo:"undo"},decls:19,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","backdrop-blur-sm",3,"click"],[1,"bg-slate-100","dark:bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-300","dark:border-slate-700","w-full","max-w-3xl","max-h-[80vh]","overflow-hidden",3,"click"],[1,"p-4","border-b","border-slate-300","dark:border-slate-700","flex","items-center","justify-between","bg-slate-200/50","dark:bg-slate-800/50"],[1,"text-lg","font-bold","text-slate-900","dark:text-white","flex","items-center","gap-2"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-purple-500"],["d","M3 3v5h5"],["d","M3.05 13A9 9 0 1 0 6 5.3L3 8"],["d","M12 7v5l4 2"],[1,"text-slate-500","hover:text-slate-700","dark:text-slate-400","dark:hover:text-white",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"p-4","overflow-y-auto","max-h-[60vh]"],[1,"text-center","py-8","text-slate-500"],[1,"space-y-3"],[1,"p-4","border-t","border-slate-300","dark:border-slate-700","bg-slate-200/50","dark:bg-slate-800/50","flex","justify-end"],[1,"px-4","py-2","bg-slate-300","dark:bg-slate-700","hover:bg-slate-400","dark:hover:bg-slate-600","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-12","w-12","mx-auto","mb-3","text-slate-400"],["cx","12","cy","12","r","10"],["d","M12 8v4l3 3"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700",3,"opacity-50"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"p-2","rounded-lg"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],["x","3","y","3","width","7","height","7"],["x","14","y","3","width","7","height","7"],["x","14","y","14","width","7","height","7"],["x","3","y","14","width","7","height","7"],[1,"font-medium","text-slate-900","dark:text-white"],[1,"text-xs","text-slate-500"],[1,"text-yellow-500","ml-2"],[1,"text-sm"],[1,"text-green-400"],[1,"text-red-400","ml-2"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded",3,"click"]],template:function(t,i){t&1&&(x(0,"div",0),U("click",function(){return i.close.emit()}),x(1,"div",1),U("click",function(s){return s.stopPropagation()}),x(2,"div",2)(3,"h3",3),j(),x(4,"svg",4),Ee(5,"path",5)(6,"path",6)(7,"path",7),w(),m(8," \u6279\u91CF\u64CD\u4F5C\u6B77\u53F2 "),w(),ce(),x(9,"button",8),U("click",function(){return i.close.emit()}),j(),x(10,"svg",9),Ee(11,"line",10)(12,"line",11),w()()(),ce(),x(13,"div",12),T(14,Sb,6,0,"div",13)(15,Ab,3,0,"div",14),w(),x(16,"div",15)(17,"button",16),U("click",function(){return i.close.emit()}),m(18," \u95DC\u9589 "),w()()()()),t&2&&(h(14),A(i.history().length===0?14:15))},encapsulation:2})}};function Db(n,e){if(n&1&&(x(0,"p",10),m(1," \u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236 "),x(2,"span",16),m(3),w(),m(4," \u55CE\uFF1F "),w()),n&2){let t,i=_();h(3),k("@",((t=i.dialogData().lead)==null?null:t.username)||((t=i.dialogData().lead)==null?null:t.userId))}}function Mb(n,e){if(n&1&&(x(0,"p",10),m(1," \u78BA\u5B9A\u8981\u522A\u9664 "),x(2,"span",17),m(3),w(),m(4," \u500B\u9078\u4E2D\u7684\u5BA2\u6236\u55CE\uFF1F "),w()),n&2){let t=_();h(3),R(t.dialogData().count)}}var Po=class n{constructor(){this.dialogData=se({});this.cancel=Q();this.confirm=Q()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-delete-confirm-dialog"]],inputs:{dialogData:[1,"dialogData"]},outputs:{cancel:"cancel",confirm:"confirm"},decls:22,vars:1,consts:[[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden",3,"click"],[1,"px-6","py-4","border-b","border-slate-700","flex","items-center","gap-3"],[1,"p-2","bg-red-500/20","rounded-lg"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-6","w-6","text-red-400"],["d","M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],[1,"text-lg","font-bold","text-white"],[1,"px-6","py-6"],[1,"text-slate-300","mb-4"],[1,"bg-red-500/10","border","border-red-500/20","rounded-lg","p-3","text-sm","text-red-300"],[1,"px-6","py-4","border-t","border-slate-700","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-red-500","hover:bg-red-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],[1,"font-bold","text-cyan-400"],[1,"font-bold","text-red-400"]],template:function(t,i){t&1&&(x(0,"div",0),U("click",function(){return i.cancel.emit()}),x(1,"div",1),U("click",function(s){return s.stopPropagation()}),x(2,"div",2)(3,"div",3),j(),x(4,"svg",4),Ee(5,"path",5)(6,"line",6)(7,"line",7),w()(),ce(),x(8,"h3",8),m(9,"\u78BA\u8A8D\u522A\u9664"),w()(),x(10,"div",9),T(11,Db,5,1,"p",10)(12,Mb,5,1,"p",10),x(13,"div",11),m(14," \u26A0\uFE0F \u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\uFF0C\u6240\u6709\u76F8\u95DC\u8A18\u9304\u5C07\u88AB\u6C38\u4E45\u522A\u9664\u3002 "),w()(),x(15,"div",12)(16,"button",13),U("click",function(){return i.cancel.emit()}),m(17," \u53D6\u6D88 "),w(),x(18,"button",14),U("click",function(){return i.confirm.emit()}),j(),x(19,"svg",15),Ee(20,"path",5),w(),m(21," \u78BA\u8A8D\u522A\u9664 "),w()()()()),t&2&&(h(11),A(i.dialogData().type==="single"?11:12))},encapsulation:2})}};var Ib=(n,e)=>e.id;function kb(n,e){if(n&1){let t=F();x(0,"div",8)(1,"p",12),m(2,"\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44"),w(),x(3,"button",13),U("click",function(){b(t);let o=_();return S(o.goCreateGroup.emit())}),m(4," \u53BB\u5275\u5EFA\u7FA4\u7D44 \u2192 "),w()()}}function Pb(n,e){if(n&1){let t=F();x(0,"button",15),U("click",function(){let o=b(t).$implicit,s=_(2);return S(s.inviteToGroup.emit(o.id))}),x(1,"div",16)(2,"div")(3,"p",17),m(4),w(),x(5,"p",18),m(6),w()(),x(7,"span",19),m(8,"\u2192"),w()()()}if(n&2){let t=e.$implicit;h(4),R(t.name),h(2),k("",(t.members==null?null:t.members.length)||0," \u500B\u6210\u54E1")}}function Nb(n,e){if(n&1&&(x(0,"div",9),X(1,Pb,9,2,"button",14,Ib),w()),n&2){let t=_();h(),Z(t.groups())}}var No=class n{constructor(){this.groups=se([]);this.close=Q();this.inviteToGroup=Q();this.goCreateGroup=Q()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-invite-group-dialog"]],inputs:{groups:[1,"groups"]},outputs:{close:"close",inviteToGroup:"inviteToGroup",goCreateGroup:"goCreateGroup"},decls:17,vars:1,consts:[[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden",3,"click"],[1,"px-6","py-4","border-b","border-slate-700","flex","items-center","gap-3"],[1,"p-2","bg-emerald-500/20","rounded-lg"],[1,"text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"px-6","py-4","max-h-64","overflow-y-auto"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2"],[1,"px-6","py-4","border-t","border-slate-700"],[1,"w-full","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"mb-2"],[1,"text-cyan-400","hover:underline","text-sm",3,"click"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group",3,"click"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-white","group-hover:text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-emerald-400","opacity-0","group-hover:opacity-100","transition-opacity"]],template:function(t,i){t&1&&(x(0,"div",0),U("click",function(){return i.close.emit()}),x(1,"div",1),U("click",function(s){return s.stopPropagation()}),x(2,"div",2)(3,"div",3)(4,"span",4),m(5,"\u{1F465}"),w()(),x(6,"div")(7,"h3",5),m(8,"\u9080\u8ACB\u9032\u7FA4"),w(),x(9,"p",6),m(10,"\u9078\u64C7\u5354\u4F5C\u7FA4\u7D44"),w()()(),x(11,"div",7),T(12,kb,5,0,"div",8)(13,Nb,3,0,"div",9),w(),x(14,"div",10)(15,"button",11),U("click",function(){return i.close.emit()}),m(16," \u53D6\u6D88 "),w()()()()),t&2&&(h(12),A(i.groups().length===0?12:13))},encapsulation:2})}};var ed=(n,e)=>e.id,Rb=(n,e)=>e.name;function Fb(n,e){if(n&1&&m(0),n&2){let t=_();k(" @",t.lead().username," ")}}function Lb(n,e){if(n&1&&m(0),n&2){let t=_();be(" ",t.lead().firstName," ",t.lead().lastName||""," ")}}function Vb(n,e){if(n&1&&(m(0),Me(1,"slice")),n&2){let t=_();k(" ID: ",Nn(1,1,t.lead().userId,0,12)," ")}}function Bb(n,e){if(n&1&&(p(0,"p",9),m(1),g()),n&2){let t=_();h(),k("\u{1F4F1} ",t.lead().phone)}}function Ob(n,e){if(n&1&&(p(0,"span",11),m(1),Me(2,"slice"),g()),n&2){let t=_();h(),k("\u{1F4CD} ",Nn(2,1,t.lead().sourceGroup,0,20))}}function Gb(n,e){if(n&1&&(p(0,"span",12),m(1),Me(2,"slice"),g()),n&2){let t=_();h(),k("\u{1F511} ",Nn(2,1,t.lead().triggeredKeyword,0,15))}}function Ub(n,e){if(n&1&&(p(0,"span",21),m(1),g()),n&2){let t=_();Ae(t.getIntentLevelColor(t.lead().intentLevel)),h(),be("",t.getIntentLevelEmoji(t.lead().intentLevel)," ",t.t(t.lead().intentLevel))}}function qb(n,e){if(n&1&&(p(0,"option",25),m(1),g()),n&2){let t=_(2);h(),R(t.t("noSenderAccounts"))}}function $b(n,e){if(n&1&&(p(0,"option",46),m(1),g()),n&2){let t=e.$implicit,i=_(3);K("value",t.id),h(),be("",t.phone," (",t.username||i.t(t.status),")")}}function Hb(n,e){if(n&1&&(p(0,"option",25),m(1,"\u9078\u64C7\u767C\u9001\u5E33\u865F..."),g(),X(2,$b,2,3,"option",46,ed)),n&2){let t=_(2);h(2),Z(t.senderAccounts())}}function Kb(n,e){if(n&1){let t=F();p(0,"div",26)(1,"p",47),m(2),g(),p(3,"a",48),D("click",function(){b(t);let o=_(2);return o.navigateTo.emit("accounts"),S(o.close.emit())}),m(4,"\u524D\u5F80\u5E33\u865F\u7BA1\u7406 \u2192"),g()()}if(n&2){let t=_(2);h(2),k("\u26A0\uFE0F ",t.t("noSenderAccountsHint"))}}function Wb(n,e){n&1&&(p(0,"span",52),m(1,"\u2713 \u5DF2\u9023\u63A5"),g())}function zb(n,e){n&1&&(p(0,"span",53),m(1,"\u{1F4DA} RAG \u5DF2\u555F\u7528"),g())}function Jb(n,e){if(n&1&&m(0),n&2){let t=_(4);k(" | \u4F86\u6E90: ",t.generationState().lead.sourceGroup," ")}}function Qb(n,e){if(n&1&&m(0),n&2){let t=_(4);k(" | \u89F8\u767C\u8A5E: ",t.generationState().lead.triggerKeyword," ")}}function Yb(n,e){if(n&1&&(p(0,"div",54)(1,"strong",63),m(2,"\u5BA2\u6236\u8CC7\u8A0A\uFF1A"),g(),m(3),T(4,Jb,1,1),T(5,Qb,1,1),g()),n&2){let t=_(3);h(3),k(" @",t.generationState().lead.username," "),h(),A(t.generationState().lead.sourceGroup?4:-1),h(),A(t.generationState().lead.triggerKeyword?5:-1)}}function Xb(n,e){if(n&1&&(p(0,"span",64),m(1,"\u27F3"),g(),p(2,"span"),m(3),g()),n&2){let t=_(3);h(3),R(t.t("generating"))}}function Zb(n,e){if(n&1&&(p(0,"span"),m(1,"\u2728"),g(),p(2,"span"),m(3),g()),n&2){let t=_(3);h(3),R(t.t("generateWithAi"))}}function jb(n,e){if(n&1){let t=F();p(0,"button",65),D("click",function(){b(t);let o=_(3);return S(o.generateMsg.emit())}),m(1," \u{1F504} "),g()}}function e1(n,e){if(n&1){let t=F();p(0,"div",60),m(1),p(2,"a",66),D("click",function(){b(t);let o=_(3);return o.navigateTo.emit("settings"),S(o.close.emit())}),m(3),g()()}if(n&2){let t=_(3);h(),k(" \u26A0\uFE0F ",t.t("aiNotConfigured")," "),h(2),R(t.t("goToSettings"))}}function t1(n,e){if(n&1){let t=F();p(0,"div",61)(1,"strong"),m(2),g(),m(3),p(4,"button",67),D("click",function(){b(t);let o=_(3);return S(o.generateMsg.emit())}),m(5,"\u91CD\u8A66"),g()()}if(n&2){let t=_(3);h(2),k("",t.t("error"),":"),h(),k(" ",t.generationState().error," ")}}function n1(n,e){n&1&&(p(0,"div",62)(1,"p",68),m(2,"\u2713 AI \u5DF2\u751F\u6210\u6D88\u606F\uFF0C\u60A8\u53EF\u4EE5\u5728\u4E0B\u65B9\u7DE8\u8F2F\u5F8C\u767C\u9001"),g()())}function i1(n,e){if(n&1){let t=F();p(0,"div",31)(1,"div",49)(2,"div",6)(3,"span",50),m(4,"\u{1F916}"),g(),p(5,"span",51),m(6),g(),T(7,Wb,2,0,"span",52),g(),T(8,zb,2,0,"span",53),g(),T(9,Yb,6,3,"div",54),p(10,"div")(11,"label",55),m(12),g(),p(13,"textarea",56),D("ngModelChange",function(o){b(t);let s=_(2);return S(s.updatePrompt.emit(o))}),m(14,"                    "),g()(),p(15,"div",57)(16,"button",58),D("click",function(){b(t);let o=_(2);return S(o.generateMsg.emit())}),T(17,Xb,4,1)(18,Zb,4,1),g(),T(19,jb,2,0,"button",59),g(),T(20,e1,4,2,"div",60),T(21,t1,6,2,"div",61),T(22,n1,3,0,"div",62),g()}if(n&2){let t=_(2);h(6),k(" ",t.aiApiType()==="local"?"\u672C\u5730 AI":t.aiApiType()==="openai"?"OpenAI":t.aiApiType()==="custom"?"\u81EA\u5B9A\u7FA9 API":"Gemini"," "),h(),A(t.isAiConfigured()?7:-1),h(),A(t.ragEnabled()?8:-1),h(),A(t.generationState().lead?9:-1),h(3),R(t.t("customizePrompt")),h(),K("ngModel",t.generationState().customPrompt)("placeholder",t.t("aiPromptPlaceholder")),h(3),K("disabled",t.generationState().status==="loading"||!t.isAiConfigured()),h(),A(t.generationState().status==="loading"?17:18),h(2),A(t.generationState().status==="success"?19:-1),h(),A(t.isAiConfigured()?-1:20),h(),A(t.generationState().status==="error"?21:-1),h(),A(t.generationState().status==="success"&&t.generationState().generatedMessage?22:-1)}}function o1(n,e){if(n&1&&(p(0,"option",46),m(1),g()),n&2){let t=e.$implicit;K("value",t.id),h(),R(t.name)}}function s1(n,e){if(n&1){let t=F();p(0,"div",22)(1,"label",23),m(2),g(),p(3,"select",69),D("change",function(o){b(t);let s=_(2);return S(s.applyTmpl.emit(o))}),p(4,"option",25),m(5),g(),X(6,o1,2,2,"option",46,ed),g()()}if(n&2){let t=_(2);h(2),k("\u{1F4CB} ",t.t("selectTemplate")),h(3),R(t.t("selectTemplatePlaceholder")),h(),Z(t.messageTemplates())}}function r1(n,e){if(n&1){let t=F();p(0,"button",70),D("click",function(){b(t);let o=_(2);return S(o.addMoreAttach.emit("file"))}),m(1," \u2795 \u6DFB\u52A0\u66F4\u591A "),g(),p(2,"button",71),D("click",function(){b(t);let o=_(2);return S(o.clearAttach.emit())}),m(3," \u{1F5D1}\uFE0F \u6E05\u7A7A "),g()}}function a1(n,e){n&1&&(p(0,"span",77),m(1,"\u{1F5BC}\uFE0F"),g())}function l1(n,e){n&1&&(p(0,"span",78),m(1,"\u{1F4C4}"),g())}function c1(n,e){if(n&1&&(p(0,"span",80),m(1),g()),n&2){let t=_().$implicit;h(),k(" (",(t.fileSize/1024/1024).toFixed(2)," MB) ")}}function d1(n,e){n&1&&(p(0,"span",81),m(1,"\u2713"),g())}function u1(n,e){if(n&1){let t=F();p(0,"div",75)(1,"div",76),T(2,a1,2,0,"span",77)(3,l1,2,0,"span",78),p(4,"span",79),m(5),g(),T(6,c1,2,1,"span",80),T(7,d1,2,0,"span",81),g(),p(8,"button",82),D("click",function(){let o=b(t).$index,s=_(3);return S(s.removeAttach.emit(o))}),m(9,"\xD7"),g()()}if(n&2){let t=e.$implicit;h(2),A(t.type==="image"?2:3),h(3),R(t.name),h(),A(t.fileSize?6:-1),h(),A(t.filePath?7:-1)}}function m1(n,e){if(n&1&&(p(0,"div",38)(1,"div",32)(2,"span",72),m(3),g(),p(4,"span",73),m(5),g()(),p(6,"div",74),X(7,u1,10,4,"div",75,Rb),g()()),n&2){let t=_(2);h(3),k("\u{1F4CE} \u9644\u4EF6\u5217\u8868 (",t.generationState().attachments.length,")"),h(2),k(" \u7E3D\u5927\u5C0F: ",t.getTotalAttachmentSize()," MB "),h(2),Z(t.generationState().attachments)}}function p1(n,e){n&1&&m(0," \u26A0\uFE0F \u7121\u53EF\u7528\u767C\u9001\u5E33\u865F ")}function g1(n,e){n&1&&m(0," \u26A0\uFE0F \u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F ")}function h1(n,e){n&1&&m(0," \u26A0\uFE0F \u8ACB\u8F38\u5165\u8A0A\u606F\u5167\u5BB9\u6216\u6DFB\u52A0\u9644\u4EF6 ")}function f1(n,e){if(n&1&&(p(0,"div",39)(1,"p",83),T(2,p1,1,0)(3,g1,1,0)(4,h1,1,0),g()()),n&2){let t=_(2);h(2),A(t.senderAccounts().length===0?2:t.selectedSenderId()?t.editableMessage().trim().length===0&&!t.generationState().attachment&&t.generationState().attachments.length===0?4:-1:3)}}function _1(n,e){n&1&&(p(0,"div",40)(1,"p",84),m(2,"\u{1F6AB} \u6B64\u5BA2\u6236\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE\uFF0C\u7121\u6CD5\u767C\u9001\u8A0A\u606F"),g()())}function v1(n,e){if(n&1){let t=F();p(0,"div",19)(1,"div",22)(2,"label",23),m(3),g(),p(4,"select",24),D("ngModelChange",function(o){b(t);let s=_();return S(s.senderChange.emit(o))}),T(5,qb,2,1,"option",25)(6,Hb,4,0),g(),T(7,Kb,5,1,"div",26),g(),p(8,"div",27)(9,"label",28),D("click",function(){b(t);let o=_();return S(o.msgModeChange.emit("manual"))}),p(10,"div",29),m(11,"\u{1F4DD}"),g(),p(12,"span",30),m(13),g()(),p(14,"label",28),D("click",function(){b(t);let o=_();return S(o.msgModeChange.emit("ai"))}),p(15,"div",29),m(16,"\u{1F916}"),g(),p(17,"span",30),m(18),g()(),p(19,"label",28),D("click",function(){b(t);let o=_();return S(o.msgModeChange.emit("template"))}),p(20,"div",29),m(21,"\u{1F4CB}"),g(),p(22,"span",30),m(23),g()()(),T(24,i1,23,13,"div",31),T(25,s1,8,2,"div",22),p(26,"div",22)(27,"div",32)(28,"label",33),m(29),g(),p(30,"span",34),m(31),g()(),p(32,"textarea",35),D("ngModelChange",function(o){b(t);let s=_();return S(s.editableMsgChange.emit(o))}),m(33,"            "),g()(),p(34,"div",31)(35,"div",36)(36,"button",37),D("click",function(){b(t);let o=_();return S(o.selectAttach.emit({type:"image",multi:!0}))}),m(37),g(),p(38,"button",37),D("click",function(){b(t);let o=_();return S(o.selectAttach.emit({type:"file",multi:!0}))}),m(39),g(),T(40,r1,4,0),g(),T(41,m1,9,2,"div",38),g(),T(42,f1,5,1,"div",39),T(43,_1,3,0,"div",40),p(44,"div",41)(45,"button",42),D("click",function(){b(t);let o=_();return S(o.addDnc.emit(o.lead().id))}),m(46),g(),p(47,"div",43)(48,"button",44),D("click",function(){b(t);let o=_();return S(o.close.emit())}),m(49),g(),p(50,"button",45),D("click",function(){b(t);let o=_();return S(o.sendMsg.emit())}),m(51),g()()()()}if(n&2){let t=_();h(3),k("\u{1F4E4} ",t.t("selectSenderAccount")),h(),K("ngModel",t.selectedSenderId()),h(),A(t.senderAccounts().length===0?5:6),h(2),A(t.senderAccounts().length===0?7:-1),h(2),Ae(t.messageMode()==="manual"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),h(4),R(t.t("manualInput")),h(),Ae(t.messageMode()==="ai"?"bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),h(4),R(t.t("aiGenerate")),h(),Ae(t.messageMode()==="template"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),h(4),R(t.t("useTemplate")),h(),A(t.messageMode()==="ai"?24:-1),h(),A(t.messageMode()==="template"?25:-1),h(4),k("\u270F\uFE0F ",t.t("messageContent")),h(2),be("",t.editableMessage().length," ",t.t("characters")),h(),K("ngModel",t.editableMessage())("placeholder",t.t("messageContentPlaceholder")),h(5),k(" \u{1F5BC}\uFE0F ",t.t("attachImage")," "),h(2),k(" \u{1F4CE} ",t.t("attachFile")," "),h(),A(t.generationState().attachments.length>0?40:-1),h(),A(t.generationState().attachments.length>0?41:-1),h(),A(!t.canSendMessage()&&!t.lead().doNotContact?42:-1),h(),A(t.lead().doNotContact?43:-1),h(2),K("disabled",t.lead().doNotContact),h(),k(" \u{1F6AB} ",t.lead().doNotContact?t.t("userOnDNC"):t.t("addToDNC")," "),h(3),k(" ",t.t("cancel")," "),h(),K("disabled",!t.canSendMessage()||t.lead().doNotContact),h(),k(" \u2708\uFE0F ",t.t("sendMessage")," ")}}function C1(n,e){n&1&&(p(0,"span",64),m(1,"\u27F3"),g(),p(2,"span"),m(3,"\u52A0\u8F09\u4E2D..."),g())}function y1(n,e){n&1&&(p(0,"span"),m(1,"\u{1F4AC}"),g(),p(2,"span"),m(3,"\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304"),g())}function b1(n,e){if(n&1&&(p(0,"span",73),m(1),g()),n&2){let t=_(2);h(),k("\u5171 ",t.chatHistory().length," \u689D\u6D88\u606F")}}function S1(n,e){if(n&1&&(p(0,"div",95)(1,"div",97)(2,"div",98)(3,"p",99),m(4),g()(),p(5,"p",100),m(6),g()()()),n&2){let t=_().$implicit,i=_(3);h(4),R(t.content),h(2),R(i.formatTimestamp(t.timestamp))}}function x1(n,e){if(n&1&&(p(0,"div",96)(1,"div",97)(2,"div",101)(3,"p",99),m(4),g()(),p(5,"div",102)(6,"span",73),m(7),g(),p(8,"span",103),m(9,"\u{1F916} AI"),g()()()()),n&2){let t=_().$implicit,i=_(3);h(4),R(t.content),h(3),R(i.formatTimestamp(t.timestamp))}}function w1(n,e){if(n&1&&T(0,S1,7,2,"div",95)(1,x1,10,2,"div",96),n&2){let t=e.$implicit;A(t.role==="user"?0:t.role==="assistant"?1:-1)}}function E1(n,e){n&1&&(p(0,"div",93)(1,"span",104),m(2,"\u27F3"),g(),p(3,"span",105),m(4,"\u52A0\u8F09\u4E2D..."),g()())}function T1(n,e){if(n&1){let t=F();p(0,"div",94)(1,"button",106),D("click",function(){b(t);let o=_(3);return S(o.loadMoreHistory.emit())}),m(2," \u52A0\u8F09\u66F4\u591A\u6D88\u606F "),g()()}}function A1(n,e){if(n&1){let t=F();p(0,"div",92),D("scroll",function(o){b(t);let s=_(2);return S(s.historyScroll.emit(o))}),X(1,w1,2,1,null,null,Wo().trackByChatMessageId,!0),T(3,E1,5,0,"div",93),T(4,T1,3,0,"div",94),g()}if(n&2){let t=_(2);h(),Z(t.chatHistory()),h(2),A(t.chatHistoryLoadingMore()?3:-1),h(),A(t.chatHistoryHasMore()&&!t.chatHistoryLoadingMore()?4:-1)}}function D1(n,e){n&1&&(p(0,"span",103),m(1,"\u{1F916} AI"),g())}function M1(n,e){if(n&1&&(p(0,"div",96)(1,"div",97)(2,"div",101)(3,"p",99),m(4),g()(),p(5,"div",102)(6,"span",73),m(7),g(),T(8,D1,2,0,"span",103),g()()()),n&2){let t=_().$implicit,i=_(2);h(4),R(t.content),h(3),R(i.formatTimestamp(t.timestamp)),h(),A(t.type.includes("AI")?8:-1)}}function I1(n,e){if(n&1&&(p(0,"div",95)(1,"div",97)(2,"div",98)(3,"p",99),m(4),g()(),p(5,"p",100),m(6),g()()()),n&2){let t=_().$implicit,i=_(2);h(4),R(t.content),h(2),R(i.formatTimestamp(t.timestamp))}}function k1(n,e){if(n&1&&(p(0,"div",107)(1,"div",108),m(2),g()()),n&2){let t=_().$implicit,i=_(2);h(2),jr(" ",t.type,": ",t.content," \xB7 ",i.formatTimestamp(t.timestamp)," ")}}function P1(n,e){if(n&1&&T(0,M1,9,3,"div",96)(1,I1,7,2,"div",95)(2,k1,3,3,"div",107),n&2){let t=e.$implicit;A(t.type.includes("Sent")||t.type.includes("Message")?0:t.type.includes("Reply")||t.type.includes("Received")?1:2)}}function N1(n,e){if(n&1&&(p(0,"div",90)(1,"div",109),m(2,"\u{1F4AC}"),g(),p(3,"p",110),m(4),g(),p(5,"p",111),m(6,"\u9EDE\u64CA\u300C\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304\u300D\u67E5\u770B\u6240\u6709\u5C0D\u8A71"),g()()),n&2){let t=_(2);h(4),R(t.t("noHistoryFound"))}}function R1(n,e){if(n&1&&(p(0,"div",91)(1,"h4",112)(2,"span"),m(3,"\u{1F4CA}"),g(),m(4," AI \u5C0D\u8A71\u5206\u6790 "),g(),p(5,"div",113)(6,"div",114)(7,"p",115),m(8,"\u7E3D\u4E92\u52D5"),g(),p(9,"p",116),m(10),g()(),p(11,"div",114)(12,"p",115),m(13,"\u5C0D\u8A71\u968E\u6BB5"),g(),p(14,"p",117),m(15),g()(),p(16,"div",114)(17,"p",115),m(18,"\u8208\u8DA3\u7A0B\u5EA6"),g(),p(19,"p",50),m(20,"\u2B50\u2B50\u2B50"),g()()()()),n&2){let t=_(2);h(10),R(t.lead().interactionHistory.length),h(5),R(t.lead().status||"\u521D\u6B21\u63A5\u89F8")}}function F1(n,e){if(n&1){let t=F();p(0,"div",20)(1,"div",85)(2,"button",86),D("click",function(){b(t);let o=_();return S(o.loadHistory.emit(o.lead().userId))}),T(3,C1,4,0)(4,y1,4,0),g(),T(5,b1,2,1,"span",73),g(),T(6,A1,5,2,"div",87),p(7,"div",88)(8,"div",89),X(9,P1,3,1,null,null,Wo().trackByChatMessageId,!0),g()(),T(11,N1,7,1,"div",90),T(12,R1,21,2,"div",91),g()}if(n&2){let t=_();h(2),K("disabled",t.isLoadingChatHistory()),h(),A(t.isLoadingChatHistory()?3:4),h(2),A(t.selectedChatUserId()===t.lead().userId&&t.chatHistory().length>0?5:-1),h(),A(t.selectedChatUserId()===t.lead().userId&&t.chatHistory().length>0?6:-1),h(3),Z(t.lead().interactionHistory),h(2),A(t.lead().interactionHistory.length===0&&(!t.selectedChatUserId()||t.chatHistory().length===0)?11:-1),h(),A(t.lead().interactionHistory.length>0?12:-1)}}var Ro=class n{constructor(){this.i18n=O(et);this.lead=se.required();this.generationState=se({});this.leadDetailView=se("sendMessage");this.chatHistory=se([]);this.editableMessage=se("");this.messageMode=se("manual");this.senderAccounts=se([]);this.selectedSenderId=se("");this.selectedChatUserId=se("");this.chatHistoryHasMore=se(!1);this.chatHistoryLoadingMore=se(!1);this.isLoadingChatHistory=se(!1);this.isAiConfigured=se(!1);this.aiApiType=se("");this.messageTemplates=se([]);this.canSendMessage=se(!1);this.ragEnabled=se(!1);this.close=Q();this.generateMsg=Q();this.sendMsg=Q();this.loadHistory=Q();this.loadMoreHistory=Q();this.historyScroll=Q();this.selectAttach=Q();this.addMoreAttach=Q();this.clearAttach=Q();this.removeAttach=Q();this.applyTmpl=Q();this.updatePrompt=Q();this.addDnc=Q();this.editableMsgChange=Q();this.msgModeChange=Q();this.senderChange=Q();this.viewChange=Q();this.navigateTo=Q()}t(e,t){return this.i18n.t(e,t)}formatTimestamp(e){if(!e)return"";try{let t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString()+" "+t.toLocaleTimeString()}catch{return""}}getOnlineStatusColor(e){switch(e){case"Online":return"bg-green-500";case"Recently":return"bg-yellow-500";case"Offline":return"bg-slate-500";default:return"bg-slate-400"}}getIntentLevelColor(e){switch(e){case"HOT":return"bg-red-500/20 text-red-400 border border-red-500/30";case"WARM":return"bg-orange-500/20 text-orange-400 border border-orange-500/30";case"NEUTRAL":return"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30";case"COLD":return"bg-blue-500/20 text-blue-400 border border-blue-500/30";default:return"bg-slate-500/20 text-slate-400 border border-slate-500/30"}}getIntentLevelEmoji(e){switch(e){case"HOT":return"\u{1F525}";case"WARM":return"\u{1F321}\uFE0F";case"NEUTRAL":return"\u{1F610}";case"COLD":return"\u2744\uFE0F";default:return"\u26AA"}}trackByChatMessageId(e,t){return t.id||e}getTotalAttachmentSize(){return((this.generationState()?.attachments||[]).reduce((i,o)=>i+(o.fileSize||0),0)/1024/1024).toFixed(2)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-lead-detail-dialog"]],inputs:{lead:[1,"lead"],generationState:[1,"generationState"],leadDetailView:[1,"leadDetailView"],chatHistory:[1,"chatHistory"],editableMessage:[1,"editableMessage"],messageMode:[1,"messageMode"],senderAccounts:[1,"senderAccounts"],selectedSenderId:[1,"selectedSenderId"],selectedChatUserId:[1,"selectedChatUserId"],chatHistoryHasMore:[1,"chatHistoryHasMore"],chatHistoryLoadingMore:[1,"chatHistoryLoadingMore"],isLoadingChatHistory:[1,"isLoadingChatHistory"],isAiConfigured:[1,"isAiConfigured"],aiApiType:[1,"aiApiType"],messageTemplates:[1,"messageTemplates"],canSendMessage:[1,"canSendMessage"],ragEnabled:[1,"ragEnabled"]},outputs:{close:"close",generateMsg:"generateMsg",sendMsg:"sendMsg",loadHistory:"loadHistory",loadMoreHistory:"loadMoreHistory",historyScroll:"historyScroll",selectAttach:"selectAttach",addMoreAttach:"addMoreAttach",clearAttach:"clearAttach",removeAttach:"removeAttach",applyTmpl:"applyTmpl",updatePrompt:"updatePrompt",addDnc:"addDnc",editableMsgChange:"editableMsgChange",msgModeChange:"msgModeChange",senderChange:"senderChange",viewChange:"viewChange",navigateTo:"navigateTo"},decls:30,vars:24,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-gradient-to-br","from-slate-900","via-slate-900","to-slate-800","border","border-cyan-500/30","rounded-2xl","shadow-2xl","shadow-cyan-500/10","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","text-slate-200",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/10","via-blue-500/10","to-purple-500/10","border-b","border-cyan-500/20","p-5"],[1,"flex","justify-between","items-start"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold","text-xl","shadow-lg","shadow-cyan-500/30"],[1,"flex","items-center","gap-2"],[1,"text-xl","font-bold","text-white"],[1,"h-2.5","w-2.5","rounded-full","animate-pulse"],[1,"text-sm","text-cyan-400"],[1,"flex","items-center","gap-2","mt-1","flex-wrap"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-purple-500/20","text-purple-400","border","border-purple-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-cyan-500/20","text-cyan-400","border","border-cyan-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full",3,"class"],[1,"text-slate-400","hover:text-white","text-2xl","leading-none","transition-colors","p-2","hover:bg-white/10","rounded-lg",3,"click"],[1,"border-b","border-cyan-500/20","bg-slate-900/50"],["aria-label","Tabs",1,"flex","px-5"],[1,"whitespace-nowrap","py-3","px-4","border-b-2","border-transparent","font-medium","text-sm","cursor-pointer","text-slate-400","hover:text-cyan-400","hover:bg-cyan-500/5","transition-all","rounded-t-lg","flex","items-center","gap-2",3,"click"],[1,"overflow-y-auto","max-h-[calc(90vh-220px)]","p-5"],[1,"space-y-4"],[1,"py-4"],[1,"text-xs","px-2","py-0.5","rounded-full"],[1,"bg-slate-800/50","rounded-xl","p-4","border","border-slate-700/50"],[1,"block","text-sm","font-medium","text-cyan-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","focus:border-cyan-500",3,"ngModelChange","ngModel"],["value",""],[1,"mt-2","p-2","bg-amber-500/10","border","border-amber-500/30","rounded-lg"],[1,"grid","grid-cols-3","gap-3"],[1,"cursor-pointer","p-3","rounded-xl","border-2","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"text-sm","font-medium"],[1,"space-y-3"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-cyan-400"],[1,"text-xs","text-slate-500","bg-slate-700/50","px-2","py-1","rounded"],["rows","5",1,"form-textarea","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-3","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","resize-none","placeholder-slate-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","gap-3","flex-wrap"],[1,"flex","items-center","gap-2","bg-slate-800/50","hover:bg-cyan-500/20","text-slate-300","hover:text-cyan-400","text-sm","font-medium","py-2","px-4","rounded-lg","transition-all","border","border-slate-700/50","hover:border-cyan-500/30",3,"click"],[1,"p-3","rounded-xl","bg-cyan-500/10","border","border-cyan-500/30"],[1,"p-3","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-3","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"flex","justify-between","items-center","pt-4","border-t","border-cyan-500/20"],[1,"text-sm","text-red-400","hover:text-red-300","disabled:text-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-1.5","px-3","py-2","rounded-lg","hover:bg-red-500/10","transition-all",3,"click","disabled"],[1,"flex","gap-3"],[1,"bg-slate-700/80","hover:bg-slate-600","text-slate-300","font-medium","py-2.5","px-5","rounded-xl","transition-all","border","border-slate-600/50","hover:border-slate-500",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-400","hover:to-blue-400","text-white","font-bold","py-2.5","px-6","rounded-xl","shadow-lg","shadow-cyan-500/30","disabled:from-slate-500","disabled:to-slate-600","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2","transition-all",3,"click","disabled"],[3,"value"],[1,"text-xs","text-amber-400"],[1,"text-xs","text-cyan-400","hover:underline","cursor-pointer","mt-1","inline-block",3,"click"],[1,"flex","items-center","justify-between","p-2","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg"],[1,"text-lg"],[1,"text-sm","text-slate-400"],[1,"text-xs","text-green-400"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-2","py-1","rounded"],[1,"p-2","bg-cyan-500/10","border","border-cyan-500/20","rounded-lg","text-xs","text-slate-400"],[1,"block","text-sm","font-medium","text-slate-500","dark:text-slate-400","mb-1"],["rows","2",1,"form-textarea","w-full","bg-slate-200/50","dark:bg-slate-800/50","border-slate-300","dark:border-slate-700","rounded-lg","py-2","px-3","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","justify-center","gap-3"],[1,"bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","text-white","font-bold","py-2","px-6","rounded-lg","transition","duration-200","shadow-lg","disabled:from-slate-400","disabled:to-slate-500","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg"],[1,"p-3","bg-amber-500/10","border","border-amber-500/20","text-amber-400","rounded-lg","text-sm","text-center"],[1,"p-3","bg-red-500/10","border","border-red-500/20","text-red-400","rounded-lg","text-sm"],[1,"p-3","bg-green-500/10","border","border-green-500/20","rounded-lg"],[1,"text-cyan-400"],[1,"animate-spin"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg",3,"click"],[1,"text-cyan-400","hover:underline","cursor-pointer","ml-1",3,"click"],[1,"ml-2","text-cyan-400","hover:underline",3,"click"],[1,"text-xs","text-green-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"change"],[1,"flex","items-center","gap-2","bg-green-500/20","hover:bg-green-500/30","text-green-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-green-500/30",3,"click"],[1,"flex","items-center","gap-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-red-500/30",3,"click"],[1,"text-sm","text-cyan-400","font-medium"],[1,"text-xs","text-slate-500"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"flex","items-center","justify-between","text-sm","bg-slate-800/50","rounded-lg","px-3","py-2"],[1,"flex","items-center","gap-2","truncate","flex-1","min-w-0"],[1,"text-green-400"],[1,"text-blue-400"],[1,"truncate","text-white"],[1,"text-slate-500","text-xs","whitespace-nowrap"],[1,"text-green-500","text-xs"],[1,"text-red-400","hover:text-red-300","text-lg","font-bold","p-1","hover:bg-red-500/20","rounded","ml-2",3,"click"],[1,"text-sm","text-amber-400"],[1,"text-sm","text-red-400"],[1,"mb-4","flex","items-center","justify-between"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","font-bold","py-2","px-4","rounded-lg","text-sm","disabled:bg-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4"],[1,"h-96","overflow-y-auto"],[1,"space-y-3","mb-4"],[1,"text-center","py-8"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-cyan-500/20"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4",3,"scroll"],[1,"text-center","py-4"],[1,"text-center","py-2"],[1,"flex","justify-start"],[1,"flex","justify-end"],[1,"max-w-[75%]"],[1,"bg-slate-700","text-white","rounded-2xl","rounded-bl-sm","px-4","py-2"],[1,"text-sm"],[1,"text-xs","text-slate-500","mt-1"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","rounded-2xl","rounded-br-sm","px-4","py-2","shadow-lg"],[1,"flex","items-center","justify-end","gap-2","mt-1"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-1.5","py-0.5","rounded"],[1,"animate-spin","text-cyan-400"],[1,"ml-2","text-sm","text-slate-500"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","justify-center"],[1,"bg-slate-800/50","text-slate-400","text-xs","px-3","py-1","rounded-full"],[1,"text-4xl","mb-2"],[1,"text-slate-500","dark:text-slate-400"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-sm","font-medium","text-cyan-400","mb-2","flex","items-center","gap-2"],[1,"grid","grid-cols-3","gap-2","text-center","text-xs"],[1,"p-2","bg-slate-700/50","rounded"],[1,"text-slate-400"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","font-bold","text-cyan-400"]],template:function(t,i){t&1&&(p(0,"div",0),D("click",function(){return i.close.emit()}),p(1,"div",1),D("click",function(s){return s.stopPropagation()}),p(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),m(6),g(),p(7,"div")(8,"div",6)(9,"h3",7),T(10,Fb,1,1)(11,Lb,1,2)(12,Vb,2,5),g(),q(13,"span",8),g(),T(14,Bb,2,1,"p",9),p(15,"div",10),T(16,Ob,3,5,"span",11),T(17,Gb,3,5,"span",12),T(18,Ub,2,4,"span",13),g()()(),p(19,"button",14),D("click",function(){return i.close.emit()}),m(20,"\u2715"),g()()(),p(21,"div",15)(22,"nav",16)(23,"a",17),D("click",function(){return i.viewChange.emit("sendMessage")}),m(24),g(),p(25,"a",17),D("click",function(){return i.viewChange.emit("history")}),m(26),g()()(),p(27,"div",18),T(28,v1,52,31,"div",19),T(29,F1,13,6,"div",20),g()()()),t&2&&(h(6),k(" ",(i.lead().username||i.lead().firstName||i.lead().userId||"?")[0].toUpperCase()," "),h(4),A(i.lead().username?10:i.lead().firstName?11:12),h(3),Ae(i.getOnlineStatusColor(i.lead().onlineStatus)),h(),A(i.lead().phone?14:-1),h(2),A(i.lead().sourceGroup?16:-1),h(),A(i.lead().triggeredKeyword&&i.lead().triggeredKeyword!=="\u7121"?17:-1),h(),A(i.lead().intentLevel?18:-1),h(5),V("border-cyan-400",i.leadDetailView()==="sendMessage")("text-cyan-400",i.leadDetailView()==="sendMessage")("bg-cyan-500/10",i.leadDetailView()==="sendMessage"),h(),k(" \u{1F4AC} ",i.t("sendMessageTab")," "),h(),V("border-cyan-400",i.leadDetailView()==="history")("text-cyan-400",i.leadDetailView()==="history")("bg-cyan-500/10",i.leadDetailView()==="history"),h(),k(" \u{1F4CB} ",i.t("historyTab")," "),h(2),A(i.leadDetailView()==="sendMessage"?28:-1),h(),A(i.leadDetailView()==="history"?29:-1))},dependencies:[Te,Gt,Ut,Le,Un,Ve,Be,oa],encapsulation:2})}};var L1=(n,e)=>e.title,V1=(n,e)=>e.id;function B1(n,e){n&1&&(p(0,"div",11)(1,"div",16),m(2,"\u{1F50D}"),g(),p(3,"p",17),m(4,"\u672A\u627E\u5230\u5339\u914D\u7684\u7D50\u679C"),g(),p(5,"p",18),m(6,"\u5617\u8A66\u5176\u4ED6\u95DC\u9375\u8A5E"),g()())}function O1(n,e){if(n&1&&(p(0,"div",26),m(1),g()),n&2){let t=_().$implicit;h(),R(t.subtitle)}}function G1(n,e){if(n&1&&(p(0,"kbd",9),m(1),g()),n&2){let t=_().$implicit;h(),k(" ",t.shortcut," ")}}function U1(n,e){if(n&1){let t=F();p(0,"div",22),D("click",function(){let o=b(t).$implicit,s=_(4);return S(s.executeCommand(o))})("mouseenter",function(){let o=b(t).$index,s=_().$implicit,r=_(3);return S(r.selectedIndex.set(r.getGlobalIndex(s,o)))}),p(1,"div",23),m(2),g(),p(3,"div",24)(4,"div",25),m(5),g(),T(6,O1,2,1,"div",26),g(),p(7,"span",27),m(8),g(),T(9,G1,2,1,"kbd",9),g()}if(n&2){let t=e.$implicit,i=e.$index,o=_().$implicit,s=_(3);V("bg-cyan-500/20",s.isSelected(o,i))("hover:bg-slate-800",!s.isSelected(o,i)),h(),V("bg-cyan-500/20",s.isSelected(o,i))("bg-slate-800",!s.isSelected(o,i)),h(),k(" ",t.icon," "),h(3),R(t.title),h(),A(t.subtitle?6:-1),h(),V("bg-blue-500/20",t.type==="page")("text-blue-400",t.type==="page")("bg-green-500/20",t.type==="action")("text-green-400",t.type==="action")("bg-purple-500/20",t.type==="contact")("text-purple-400",t.type==="contact")("bg-amber-500/20",t.type==="recent")("text-amber-400",t.type==="recent"),h(),k(" ",s.getTypeLabel(t.type)," "),h(),A(t.shortcut?9:-1)}}function q1(n,e){if(n&1&&(p(0,"div",19)(1,"div",20),m(2),g(),X(3,U1,10,29,"div",21,V1),g()),n&2){let t=e.$implicit;h(2),k(" ",t.title," "),h(),Z(t.items)}}function $1(n,e){if(n&1&&X(0,q1,5,1,"div",19,L1),n&2){let t=_(2);Z(t.filteredGroups())}}function H1(n,e){if(n&1){let t=F();p(0,"div",2),D("click",function(){b(t);let o=_();return S(o.close())}),q(1,"div",3),p(2,"div",4),D("click",function(o){return b(t),S(o.stopPropagation())}),p(3,"div",5),j(),p(4,"svg",6),q(5,"path",7),g(),ce(),p(6,"input",8,0),Ce("ngModelChange",function(o){b(t);let s=_();return ve(s.query,o)||(s.query=o),S(o)}),D("ngModelChange",function(o){b(t);let s=_();return S(s.onQueryChange(o))})("keydown",function(o){b(t);let s=_();return S(s.onKeyDown(o))}),g(),p(8,"kbd",9),m(9,"ESC"),g()(),p(10,"div",10),T(11,B1,7,0,"div",11)(12,$1,2,0),g(),p(13,"div",12)(14,"div",13)(15,"span",14)(16,"kbd",15),m(17,"\u2191"),g(),p(18,"kbd",15),m(19,"\u2193"),g(),m(20," \u5C0E\u822A "),g(),p(21,"span",14)(22,"kbd",15),m(23,"\u21B5"),g(),m(24," \u9078\u64C7 "),g(),p(25,"span",14)(26,"kbd",15),m(27,"ESC"),g(),m(28," \u95DC\u9589 "),g()(),p(29,"span"),m(30,"TG-Matrix \u547D\u4EE4\u9762\u677F"),g()()()()}if(n&2){let t=_();V("animate-fade-in",t.animateIn()),h(2),V("animate-slide-down",t.animateIn()),h(4),_e("ngModel",t.query),h(5),A(t.filteredGroups().length===0?11:12)}}var Fo=class n{constructor(){this.navigate=Q();this.isOpen=v(!1);this.animateIn=v(!0);this.query="";this.selectedIndex=v(0);this.recentPages=v([]);this.commands=v([]);this.filteredGroups=G(()=>{let e=this.query.toLowerCase().trim(),t=this.commands();if(!e)return this.getDefaultGroups(t);let i=t.filter(o=>o.title.toLowerCase().includes(e)||o.subtitle?.toLowerCase().includes(e)||o.keywords.some(s=>s.toLowerCase().includes(e)));return this.groupByType(i)})}ngOnInit(){this.initCommands(),this.loadRecentPages()}ngOnDestroy(){}initCommands(){let e=[{id:"nav-dashboard",type:"page",icon:"\u{1F4CA}",title:"\u5100\u8868\u677F",subtitle:"\u67E5\u770B\u7CFB\u7D71\u6982\u89BD",keywords:["dashboard","\u9996\u9801","\u6982\u89BD"],action:()=>this.navigateTo("dashboard")},{id:"nav-accounts",type:"page",icon:"\u{1F464}",title:"\u5E33\u865F\u7BA1\u7406",subtitle:"\u7BA1\u7406 Telegram \u5E33\u865F",keywords:["accounts","\u5E33\u6236","\u767B\u9304"],action:()=>this.navigateTo("accounts")},{id:"nav-resource",type:"page",icon:"\u{1F4C7}",title:"\u8CC7\u6E90\u4E2D\u5FC3",subtitle:"\u7BA1\u7406\u806F\u7E6B\u4EBA\u548C\u7FA4\u7D44",keywords:["resource","\u806F\u7E6B\u4EBA","\u7FA4\u7D44","contacts"],action:()=>this.navigateTo("resource-center")},{id:"nav-ai-assistant",type:"page",icon:"\u{1F3AF}",title:"\u7B56\u7565\u898F\u5283",subtitle:"AI \u71DF\u92B7\u52A9\u624B",keywords:["ai","\u71DF\u92B7","\u7B56\u7565","marketing"],action:()=>this.navigateTo("ai-assistant")},{id:"nav-ai-team",type:"page",icon:"\u{1F916}",title:"\u81EA\u52D5\u57F7\u884C",subtitle:"AI \u5718\u968A\u92B7\u552E",keywords:["ai","\u5718\u968A","\u81EA\u52D5","team"],action:()=>this.navigateTo("ai-team")},{id:"nav-analytics",type:"page",icon:"\u{1F4C8}",title:"\u6578\u64DA\u6D1E\u5BDF",subtitle:"\u667A\u80FD\u5206\u6790\u5831\u544A",keywords:["analytics","\u5206\u6790","\u5831\u544A","\u7D71\u8A08"],action:()=>this.navigateTo("analytics")},{id:"nav-automation",type:"page",icon:"\u26A1",title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",subtitle:"\u76E3\u63A7\u548C\u81EA\u52D5\u56DE\u8986",keywords:["automation","\u81EA\u52D5\u5316","\u76E3\u63A7"],action:()=>this.navigateTo("automation")},{id:"nav-leads",type:"page",icon:"\u{1F3AF}",title:"\u6F5B\u5728\u5BA2\u6236",subtitle:"\u5BA2\u6236\u7BA1\u7406",keywords:["leads","\u5BA2\u6236","crm"],action:()=>this.navigateTo("leads")},{id:"nav-settings",type:"page",icon:"\u2699\uFE0F",title:"\u7CFB\u7D71\u8A2D\u7F6E",subtitle:"\u914D\u7F6E\u7CFB\u7D71\u9078\u9805",keywords:["settings","\u8A2D\u7F6E","\u914D\u7F6E"],action:()=>this.navigateTo("settings")},{id:"action-add-account",type:"action",icon:"\u2795",title:"\u6DFB\u52A0\u5E33\u865F",subtitle:"\u6DFB\u52A0\u65B0\u7684 Telegram \u5E33\u865F",keywords:["add","account","\u65B0\u589E"],shortcut:"\u2318N",action:()=>this.navigateTo("add-account")},{id:"action-send-message",type:"action",icon:"\u2709\uFE0F",title:"\u767C\u9001\u6D88\u606F",subtitle:"\u5411\u806F\u7E6B\u4EBA\u767C\u9001\u6D88\u606F",keywords:["send","message","\u767C\u9001"],action:()=>this.emitAction("send-message")},{id:"action-extract",type:"action",icon:"\u{1F4E5}",title:"\u63D0\u53D6\u6210\u54E1",subtitle:"\u5F9E\u7FA4\u7D44\u63D0\u53D6\u6210\u54E1",keywords:["extract","member","\u63D0\u53D6"],action:()=>this.emitAction("extract-members")},{id:"action-search-group",type:"action",icon:"\u{1F50D}",title:"\u641C\u7D22\u7FA4\u7D44",subtitle:"\u641C\u7D22 Telegram \u7FA4\u7D44",keywords:["search","group","\u641C\u7D22"],action:()=>this.emitAction("search-groups")},{id:"action-start-monitor",type:"action",icon:"\u{1F4E1}",title:"\u555F\u52D5\u76E3\u63A7",subtitle:"\u958B\u59CB\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F",keywords:["monitor","start","\u76E3\u63A7"],action:()=>this.emitAction("start-monitor")},{id:"action-refresh",type:"action",icon:"\u{1F504}",title:"\u5237\u65B0\u6578\u64DA",subtitle:"\u91CD\u65B0\u52A0\u8F09\u6578\u64DA",keywords:["refresh","reload","\u5237\u65B0"],shortcut:"\u2318R",action:()=>this.emitAction("refresh")},{id:"help-docs",type:"help",icon:"\u{1F4D6}",title:"\u5E6B\u52A9\u6587\u6A94",subtitle:"\u67E5\u770B\u4F7F\u7528\u6307\u5357",keywords:["help","docs","\u5E6B\u52A9","\u6587\u6A94"],action:()=>this.emitAction("open-docs")},{id:"help-shortcuts",type:"help",icon:"\u2328\uFE0F",title:"\u5FEB\u6377\u9375",subtitle:"\u67E5\u770B\u6240\u6709\u5FEB\u6377\u9375",keywords:["shortcuts","keyboard","\u5FEB\u6377\u9375"],action:()=>this.emitAction("show-shortcuts")},{id:"help-feedback",type:"help",icon:"\u{1F4AC}",title:"\u610F\u898B\u53CD\u994B",subtitle:"\u63D0\u4EA4\u554F\u984C\u6216\u5EFA\u8B70",keywords:["feedback","\u53CD\u994B","\u5EFA\u8B70"],action:()=>this.emitAction("open-feedback")}];this.commands.set(e)}getDefaultGroups(e){let t=this.recentPages(),i=[];if(t.length>0){let r=e.filter(l=>t.includes(l.id)).sort((l,d)=>t.indexOf(l.id)-t.indexOf(d.id)).slice(0,5).map(l=>N(M({},l),{type:"recent"}));r.length>0&&i.push({title:"\u6700\u8FD1\u8A2A\u554F",items:r})}let o=e.filter(r=>r.type==="page").slice(0,6);i.push({title:"\u9801\u9762",items:o});let s=e.filter(r=>r.type==="action").slice(0,4);return i.push({title:"\u5FEB\u901F\u64CD\u4F5C",items:s}),i}groupByType(e){let t=[],i=e.filter(l=>l.type==="page"),o=e.filter(l=>l.type==="action"),s=e.filter(l=>l.type==="contact"),r=e.filter(l=>l.type==="help");return i.length>0&&t.push({title:"\u9801\u9762",items:i}),o.length>0&&t.push({title:"\u64CD\u4F5C",items:o}),s.length>0&&t.push({title:"\u806F\u7E6B\u4EBA",items:s}),r.length>0&&t.push({title:"\u5E6B\u52A9",items:r}),t}onGlobalKeyDown(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),this.toggle()),e.key==="Escape"&&this.isOpen()&&(e.preventDefault(),this.close())}onKeyDown(e){let i=this.filteredGroups().reduce((o,s)=>o+s.items.length,0);switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex.update(s=>(s+1)%i);break;case"ArrowUp":e.preventDefault(),this.selectedIndex.update(s=>(s-1+i)%i);break;case"Enter":e.preventDefault();let o=this.getSelectedItem();o&&this.executeCommand(o);break}}onQueryChange(e){this.selectedIndex.set(0)}getSelectedItem(){let e=this.filteredGroups(),t=0;for(let i of e)for(let o of i.items){if(t===this.selectedIndex())return o;t++}return null}getGlobalIndex(e,t){let i=this.filteredGroups(),o=0;for(let s of i){if(s===e)return o+t;o+=s.items.length}return 0}isSelected(e,t){return this.getGlobalIndex(e,t)===this.selectedIndex()}getTypeLabel(e){return{page:"\u9801\u9762",action:"\u64CD\u4F5C",contact:"\u806F\u7E6B\u4EBA",recent:"\u6700\u8FD1",help:"\u5E6B\u52A9"}[e]}toggle(){this.isOpen()?this.close():this.open()}open(){this.query="",this.selectedIndex.set(0),this.animateIn.set(!0),this.isOpen.set(!0)}close(){this.animateIn.set(!1),setTimeout(()=>{this.isOpen.set(!1)},150)}executeCommand(e){e.type==="page"&&this.addToRecent(e.id),e.action(),this.close()}navigateTo(e){this.navigate.emit(e)}emitAction(e){this.navigate.emit(`action:${e}`)}addToRecent(e){this.recentPages.update(t=>{let i=t.filter(o=>o!==e);return[e,...i].slice(0,10)}),this.saveRecentPages()}loadRecentPages(){try{let e=localStorage.getItem("tg-matrix-recent-pages");e&&this.recentPages.set(JSON.parse(e))}catch{}}saveRecentPages(){try{localStorage.setItem("tg-matrix-recent-pages",JSON.stringify(this.recentPages()))}catch{}}addCommand(e){this.commands.update(t=>[...t,e])}addContactCommands(e){let t=e.map(i=>({id:`contact-${i.id}`,type:"contact",icon:"\u{1F464}",title:i.name,subtitle:i.username?`@${i.username}`:void 0,keywords:[i.name,i.username||""].filter(Boolean),action:()=>this.navigate.emit(`contact:${i.id}`)}));this.commands.update(i=>[...i.filter(o=>o.type!=="contact"),...t])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-command-palette"]],hostBindings:function(t,i){t&1&&D("keydown",function(s){return i.onGlobalKeyDown(s)},Tt)},outputs:{navigate:"navigate"},decls:1,vars:1,consts:[["searchInput",""],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"animate-fade-in"],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"click"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm"],[1,"command-palette","relative","w-full","max-w-2xl","mx-4","bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden",3,"click"],[1,"flex","items-center","gap-3","p-4","border-b","border-slate-700/50"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text","placeholder","\u641C\u7D22\u9801\u9762\u3001\u529F\u80FD\u3001\u806F\u7E6B\u4EBA...","autofocus","",1,"flex-1","bg-transparent","text-white","placeholder-slate-500","outline-none","text-lg",3,"ngModelChange","keydown","ngModel"],[1,"px-2","py-1","text-xs","text-slate-400","bg-slate-800","rounded","border","border-slate-700"],[1,"max-h-[60vh]","overflow-y-auto"],[1,"p-8","text-center"],[1,"flex","items-center","justify-between","px-4","py-3","border-t","border-slate-700/50","text-xs","text-slate-500"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-1"],[1,"px-1.5","py-0.5","bg-slate-800","rounded"],[1,"text-4xl","mb-3"],[1,"text-slate-400"],[1,"text-sm","text-slate-500","mt-1"],[1,"py-2"],[1,"px-4","py-2","text-xs","font-semibold","text-slate-500","uppercase","tracking-wider"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"bg-cyan-500/20","hover:bg-slate-800"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"click","mouseenter"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","text-xl"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"px-2","py-0.5","text-xs","rounded-full"]],template:function(t,i){t&1&&T(0,H1,31,6,"div",1),t&2&&A(i.isOpen()?0:-1)},dependencies:[de,Te,Le,Ve,Be],styles:[".animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}.animate-slide-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-down .2s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_slide-down{0%{opacity:0;transform:translateY(-20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b}"]})}};function K1(n,e){if(n&1&&(x(0,"span",3),m(1),w()),n&2){let t=_();V("animate-bounce",t.level==="king")("animate-pulse",t.level!=="king"&&t.level!=="bronze"),h(),k(" ",t.levelIcon()," ")}}function W1(n,e){if(n&1&&(x(0,"span",2),m(1),w()),n&2){let t=_();h(),R(t.levelText())}}var Lo=class n{constructor(){this.i18n=O(et);this.level="bronze";this.size="sm";this.showIcon=!0;this.showText=!0;this.LEVEL_ICONS={bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"};this.LEVEL_NAMES={bronze:"membershipLevels.bronze",silver:"membershipLevels.silver",gold:"membershipLevels.gold",diamond:"membershipLevels.diamond",star:"membershipLevels.star",king:"membershipLevels.king"};this.badgeClasses=G(()=>`badge-${this.size} badge-${this.level}`);this.levelIcon=G(()=>this.LEVEL_ICONS[this.level]||"\u2694\uFE0F");this.levelText=G(()=>{let e=this.LEVEL_NAMES[this.level];return this.i18n.t(e)});this.tooltip=G(()=>this.levelText())}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["user-level-badge"]],inputs:{level:"level",size:"size",showIcon:"showIcon",showText:"showText"},decls:3,vars:5,consts:[[1,"user-level-badge",3,"title"],[1,"badge-icon",3,"animate-bounce","animate-pulse"],[1,"badge-text"],[1,"badge-icon"]],template:function(t,i){t&1&&(x(0,"span",0),T(1,K1,2,5,"span",1),T(2,W1,2,1,"span",2),w()),t&2&&(Ae(i.badgeClasses()),Fe("title",i.tooltip()),h(),A(i.showIcon?1:-1),h(),A(i.showText?2:-1))},dependencies:[de],styles:[".user-level-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:9999px;font-weight:600;white-space:nowrap;transition:all .2s ease}.badge-xs[_ngcontent-%COMP%]{font-size:10px;padding:1px 4px;gap:2px}.badge-sm[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px;gap:3px}.badge-md[_ngcontent-%COMP%]{font-size:12px;padding:3px 10px;gap:4px}.badge-lg[_ngcontent-%COMP%]{font-size:14px;padding:4px 12px;gap:5px}.badge-bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b6914,peru);color:#fff8dc;border:1px solid rgba(205,133,63,.5)}.badge-silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,#708090,silver,#a8a8a8);color:#1a1a2e;border:1px solid rgba(192,192,192,.5);box-shadow:0 0 8px #c0c0c04d}.badge-gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b8860b,gold,orange);color:#1a1a2e;border:1px solid rgba(255,215,0,.5);box-shadow:0 0 10px #ffd70066}.badge-diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#00ced1,#87ceeb,#b9f2ff);color:#1a1a2e;border:1px solid rgba(135,206,235,.5);box-shadow:0 0 12px #00ced180}.badge-star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9932cc,orchid,#ff69b4);color:#fff;border:1px solid rgba(218,112,214,.5);box-shadow:0 0 15px #9932cc80}.badge-king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff4500,tomato 30%,gold 70%,orange);color:#fff;border:1px solid rgba(255,215,0,.6);box-shadow:0 0 20px #ff450099,0 0 40px #ffd7004d;animation:_ngcontent-%COMP%_king-glow 2s ease-in-out infinite alternate}@keyframes _ngcontent-%COMP%_king-glow{0%{box-shadow:0 0 20px #ff450099,0 0 40px #ffd7004d}to{box-shadow:0 0 25px #ff4500cc,0 0 50px #ffd70080}}.badge-icon[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center}.badge-text[_ngcontent-%COMP%]{line-height:1}.animate-pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}.animate-bounce[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.7}}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(-10%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:translateY(0);animation-timing-function:cubic-bezier(0,0,.2,1)}}"]})}};function z1(n,e){if(n&1){let t=F();x(0,"button",5),U("click",function(){b(t);let o=_(2);return S(o.dismiss())}),m(1,"\u2715"),w()}}function J1(n,e){if(n&1&&(x(0,"div",1)(1,"span",2),m(2),w(),x(3,"span",3),m(4),w(),T(5,z1,2,0,"button",4),w()),n&2){let t=_();Ae("status-"+t.status()),h(2),R(t.getIcon()),h(2),R(t.message()),h(),A(t.status()==="online"?5:-1)}}var Vo=class n{constructor(){this.networkService=O(on);this.subscription=null;this.showBanner=v(!1);this.status=v("online");this.message=v("");this.dismissTimer=null}ngOnInit(){this.subscription=this.networkService.networkEvents$.subscribe(e=>{this.status.set(e.status),this.message.set(e.message||""),this.showBanner.set(!0),this.dismissTimer&&clearTimeout(this.dismissTimer),e.status==="online"&&(this.dismissTimer=setTimeout(()=>{this.showBanner.set(!1)},3e3))})}ngOnDestroy(){this.subscription?.unsubscribe(),this.dismissTimer&&clearTimeout(this.dismissTimer)}getIcon(){return this.networkService.getStatusIcon()}dismiss(){this.showBanner.set(!1)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-network-status"]],decls:1,vars:1,consts:[[1,"network-banner",3,"class"],[1,"network-banner"],[1,"icon"],[1,"message"],[1,"dismiss-btn"],[1,"dismiss-btn",3,"click"]],template:function(t,i){t&1&&T(0,J1,6,5,"div",0),t&2&&A(i.showBanner()?0:-1)},dependencies:[de],styles:[".network-banner[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:9999;padding:.75rem 1rem;display:flex;align-items:center;justify-content:center;gap:.5rem;font-size:.875rem;font-weight:500;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}.status-offline[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}.status-online[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.status-slow[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.icon[_ngcontent-%COMP%]{font-size:1rem}.message[_ngcontent-%COMP%]{flex:1;text-align:center}.dismiss-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;opacity:.8;cursor:pointer;padding:.25rem;font-size:.875rem}.dismiss-btn[_ngcontent-%COMP%]:hover{opacity:1}"]})}};function Q1(n,e){n&1&&(x(0,"div",6),m(1,"\u2713"),w(),x(2,"h2",7),m(3,"\u6B61\u8FCE\u56DE\u4F86"),w(),x(4,"p",8),m(5,"\u6B63\u5728\u9032\u5165\u7CFB\u7D71..."),w())}function Y1(n,e){n&1&&(x(0,"div",9),m(1,"\u{1F44B}"),w(),x(2,"h2",7),m(3,"\u5DF2\u5B89\u5168\u767B\u51FA"),w(),x(4,"p",8),m(5,"\u671F\u5F85\u60A8\u7684\u518D\u6B21\u8A2A\u554F"),w())}function X1(n,e){n&1&&(x(0,"div",10),m(1,"\u26A0\uFE0F"),w(),x(2,"h2",7),m(3,"\u6703\u8A71\u5DF2\u904E\u671F"),w(),x(4,"p",8),m(5,"\u8ACB\u91CD\u65B0\u767B\u5165"),w())}function Z1(n,e){if(n&1){let t=F();x(0,"div",1),U("click",function(){b(t);let o=_();return S(o.onOverlayClick())}),x(1,"div",2),T(2,Q1,6,0)(3,Y1,6,0)(4,X1,6,0),w(),x(5,"div",3)(6,"span",4),m(7,"\u{1F916}"),w(),x(8,"span",5),m(9,"TG-AI \u667A\u63A7\u738B"),w()()()}if(n&2){let t,i=_();Ae("type-"+i.type()),h(2),A((t=i.type())==="login"?2:t==="logout"?3:t==="session_expired"?4:-1)}}var Bo=class n{constructor(){this.authEvents=O(Hn);this.cdr=O(Rn);this.ngZone=O(je);this.subscription=null;this.show=v(!1);this.type=v("none");this.hideTimer=null;this.safetyTimer=null}ngOnInit(){this.subscription=this.authEvents.authEvents$.subscribe(e=>{this.handleEvent(e)})}ngOnDestroy(){this.subscription?.unsubscribe(),this.clearTimers()}clearTimers(){this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null),this.safetyTimer&&(clearTimeout(this.safetyTimer),this.safetyTimer=null)}safeHide(){this.show.set(!1);try{this.cdr.markForCheck(),this.cdr.detectChanges()}catch{}}onOverlayClick(){this.clearTimers(),this.safeHide()}handleEvent(e){this.clearTimers();let t=0;switch(e.type){case"login":this.type.set("login"),this.show.set(!0),t=1500;break;case"logout":this.type.set("logout"),this.show.set(!0),t=1e3;break;case"session_expired":this.type.set("session_expired"),this.show.set(!0),t=2e3;break;default:return}this.hideTimer=setTimeout(()=>{this.ngZone.run(()=>{this.safeHide()})},t),this.safetyTimer=setTimeout(()=>{this.show()&&(console.warn("[AuthTransition] Safety timeout: force hiding overlay"),this.ngZone.run(()=>{this.safeHide()}))},5e3)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-auth-transition"]],decls:1,vars:1,consts:[[1,"transition-overlay",3,"class"],[1,"transition-overlay",3,"click"],[1,"transition-content"],[1,"brand-footer"],[1,"brand-icon"],[1,"brand-name"],[1,"success-icon"],[1,"title"],[1,"subtitle"],[1,"logout-icon"],[1,"warning-icon"]],template:function(t,i){t&1&&T(0,Z1,10,3,"div",0),t&2&&A(i.show()?0:-1)},dependencies:[de],styles:[".transition-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.type-login[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0f172a,#1e3a5f,#0f172a)}.type-logout[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e293b,#334155,#1e293b)}.type-session_expired[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e293b,#422006,#1e293b)}.transition-content[_ngcontent-%COMP%]{text-align:center;animation:_ngcontent-%COMP%_scaleIn .4s ease-out}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}.success-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.5rem;color:#fff;animation:_ngcontent-%COMP%_bounceIn .5s ease-out}.logout-icon[_ngcontent-%COMP%], .warning-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1.5rem;animation:_ngcontent-%COMP%_bounceIn .5s ease-out}@keyframes _ngcontent-%COMP%_bounceIn{0%{transform:scale(0);opacity:0}50%{transform:scale(1.1)}to{transform:scale(1);opacity:1}}.title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;color:#fff;margin:0 0 .5rem}.subtitle[_ngcontent-%COMP%]{font-size:1rem;color:#ffffffb3;margin:0}.brand-footer[_ngcontent-%COMP%]{position:absolute;bottom:2rem;display:flex;align-items:center;gap:.5rem;color:#ffffff80;font-size:.875rem}.brand-icon[_ngcontent-%COMP%]{font-size:1.25rem}.brand-name[_ngcontent-%COMP%]{font-weight:500}"]})}};var Oo=class n{constructor(){this.collapsed=v(!1);this.isMobile=v(!1);this.mobileMenuOpen=v(!1);this.groupStates=v({});this._mediaQuery=null;this._mediaHandler=null;try{localStorage.getItem("sidebar_collapsed")==="true"&&this.collapsed.set(!0)}catch{}try{let e=localStorage.getItem("sidebar_group_states");e&&this.groupStates.set(JSON.parse(e))}catch{}}initMobileDetection(){typeof window>"u"||(this._mediaQuery=window.matchMedia("(max-width: 768px)"),this._mediaHandler=e=>{let t=e.matches;this.isMobile.set(t),t&&(this.collapsed.set(!1),this.mobileMenuOpen.set(!1))},this._mediaHandler(this._mediaQuery),this._mediaQuery.addEventListener("change",this._mediaHandler))}destroyMobileDetection(){this._mediaQuery&&this._mediaHandler&&this._mediaQuery.removeEventListener("change",this._mediaHandler)}toggleCollapse(){if(this.isMobile()){this.toggleMobileMenu();return}let e=!this.collapsed();this.collapsed.set(e),localStorage.setItem("sidebar_collapsed",String(e))}toggleMobileMenu(){this.mobileMenuOpen.update(e=>!e)}onMobileNavSelect(){this.isMobile()&&this.mobileMenuOpen.set(!1)}toggleGroup(e){let t=M({},this.groupStates());t[e]=!t[e],this.groupStates.set(t);try{localStorage.setItem("sidebar_group_states",JSON.stringify(t))}catch{}}isGroupCollapsed(e){return!!this.groupStates()[e]}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=ye({token:n,factory:n.\u0275fac,providedIn:"root"})}};function td(){this.ipcService.on("connection-confirmed",n=>{console.log("[Frontend] \u2705 Connection confirmed:",n),this.backendConnectionState.set("connected"),this.backendConnectionProgress.set(100),this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.hideConnectionIndicator()}),this.ipcService.on("connection-error",n=>{console.log("[Frontend] \u274C Connection error:",n),this.backendConnectionState()==="connecting"&&(this.backendConnectionState.set("error"),this.backendConnectionMessage.set(n.message||"\u9023\u63A5\u5931\u6557"))}),this.ipcService.on("ipc-command-error",n=>{["get-system-status","get-initial-state","get-accounts","get-monitored-groups","get-keyword-sets","get-queue-status","get-monitoring-status","get-logs","get-alerts","add-monitored-group","add-group","batch-send:start"].includes(n.command)||(n.isTimeout?(console.warn(`[App] Command timeout: ${n.command}`,n.error),this.toastService.warning(`\u64CD\u4F5C\u8D85\u6642\uFF1A${n.error}`,5e3)):(console.error(`[App] Command error: ${n.command}`,n.error),this.toastService.error(`\u64CD\u4F5C\u5931\u6557 (${n.command}): ${n.error}`,5e3)))}),this.ipcService.on("connection-mode-changed",n=>{console.log("[Frontend] Connection mode changed:",n.mode),n.mode==="polling"?console.log("[Frontend] \u26A0\uFE0F Running in degraded mode (HTTP polling)"):n.mode==="websocket"&&console.log("[Frontend] \u2705 WebSocket connection restored")}),this.ipcService.on("loading-progress",n=>{console.log("[Frontend] Loading progress:",n),this.backendConnectionProgress.set(n.progress),this.backendConnectionMessage.set(n.message),n.step==="complete"&&(this.backendConnectionState.set("connected"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.hideConnectionIndicator())}),this.ipcService.on("log-entry",n=>{n.timestamp=new Date(n.timestamp),this.logs.update(e=>[n,...e].slice(0,100))}),this.ipcService.on("log-entries-batch",n=>{if(n.entries&&n.entries.length>0){let e=n.entries.map(t=>N(M({},t),{timestamp:new Date(t.timestamp)}));this.logs.update(t=>[...e.reverse(),...t].slice(0,100))}}),this.ipcService.on("monitoring-status-changed",n=>{this.isMonitoring.set(n),this.isStartingMonitoring.set(!1)}),this.ipcService.on("monitoring-start-failed",n=>{if(console.log("[Frontend] Monitoring start failed:",n),this.isStartingMonitoring.set(!1),n.reason==="config_check_failed"){let e=n.issues||[],t=n.warnings||[],i=e.some(o=>o.message?.includes("\u96E2\u7DDA")||o.message?.includes("offline")||o.code==="no_online_accounts");if(e.length>0){let o=e.map(s=>`\u2022 ${s.message}`).join(`
`);i?this.toastService.withActions("error",`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${o}`,[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],15e3):this.toastService.error(`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${o}`,1e4)}t.length>0&&setTimeout(()=>{let o=t.slice(0,3).map(s=>s.message).join("\uFF1B");this.toastService.warning(`\u26A0 \u5176\u4ED6\u554F\u984C\uFF1A${o}`,8e3)},1e3)}else if(n.reason==="no_online_listeners")this.toastService.withActions("error","\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u5728\u7DDA\u7684\u76E3\u807D\u8CEC\u6236",[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],1e4);else if(n.reason==="no_groups")this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",5e3);else if(n.reason==="no_accessible_groups"){let e=n.cannot_join_list||[];if(e.length>0){let t=e.map(i=>`\u2022 ${i.url}: ${i.reason||"\u672A\u77E5\u539F\u56E0"}`).join(`
`);this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002
${t}`,12e3)}else this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002\u8ACB\u78BA\u4FDD\u76E3\u63A7\u865F\u5DF2\u52A0\u5165\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",8e3)}else n.reason==="exception"?this.toastService.error(n.message||"\u555F\u52D5\u76E3\u63A7\u6642\u767C\u751F\u932F\u8AA4",8e3):this.toastService.error(n.message||"\u555F\u52D5\u76E3\u63A7\u5931\u6557",5e3)}),this.ipcService.on("monitoring-config-check",n=>{if(console.log("[Frontend] Monitoring config check:",n),this.lastConfigCheck.set(n),n.passed&&n.warnings.length>0){let e=n.warnings.slice(0,2);for(let t of e){let i=t.code||"";this.errorNavigationMap[i]?this.toastService.warningWithAction(`\u26A0 ${t.message}`,"\u53BB\u8A2D\u7F6E",()=>this.navigateToError(i)):this.toastService.warning(`\u26A0 ${t.message}
\u4FEE\u5FA9: ${t.fix}`,8e3)}n.summary.can_send_messages||setTimeout(()=>{this.toastService.warningWithAction("\u76E3\u63A7\u5C07\u904B\u884C\uFF0C\u4F46 Lead \u4E0D\u6703\u81EA\u52D5\u767C\u9001\u6D88\u606F\u3002","\u914D\u7F6E\u898F\u5247",()=>this.navigateToError("NO_CAMPAIGN"))},2e3)}}),this.ipcService.on("monitoring-status-report",n=>{if(console.log("[Frontend] Monitoring status report:",n),n.accessible_groups>0){let e=n.accessible_list.slice(0,3).map(i=>i.title||i.url).join(", "),t=n.accessible_groups>3?`\u7B49 ${n.accessible_groups} \u500B\u7FA4\u7D44`:"";this.toastService.success(`\u2713 \u53EF\u76E3\u63A7\u7FA4\u7D44: ${e}${t}`,4e3)}if(n.groups_needing_join>0){let e=n.needing_join_list.slice(0,2).map(i=>i.url).join(", "),t=n.groups_needing_join>2?`\u7B49 ${n.groups_needing_join} \u500B`:"";this.toastService.warning(`\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u7FA4\u7D44: ${e}${t}\u3002\u6B63\u5728\u5617\u8A66\u81EA\u52D5\u52A0\u5165...`,6e3)}n.accessible_groups===0&&n.groups_needing_join>0&&this.toastService.warning("\u76E3\u63A7\u865F\u5C1A\u672A\u52A0\u5165\u4EFB\u4F55\u76E3\u63A7\u7FA4\u7D44\u3002\u7CFB\u7D71\u5C07\u5617\u8A66\u81EA\u52D5\u52A0\u5165\u516C\u958B\u7FA4\u7D44\u3002",5e3)}),this.ipcService.on("template-already-exists",n=>{console.log("[Frontend] Template already exists:",n),this.toastService.warning(n.message||`\u6A21\u677F "${n.name}" \u5DF2\u5B58\u5728`,3e3)}),this.ipcService.on("accounts-updated",n=>{console.log("[Frontend] Received accounts-updated event:",n.length,"accounts");let e=this.accounts().length,t=this.accounts();this.accounts.set(n),n.forEach(i=>{let o=t.find(s=>s.id===i.id);if(o&&o.status!==i.status)if(console.log(`[Frontend] Account ${i.phone} status changed: ${o.status} -> ${i.status}`),i.status==="Online")this.toastService.success(`\u8D26\u6237 ${i.phone} \u767B\u5F55\u6210\u529F`),this.cancelLogin();else if(i.status==="Logging in...")this.toastService.info(`\u8D26\u6237 ${i.phone} \u6B63\u5728\u767B\u5F55...`);else if(i.status==="Waiting Code"){let s=this.loginState();s.accountId===i.id&&!s.requiresCode&&this.toastService.info(`\u8D26\u6237 ${i.phone} \u7B49\u5F85\u9A8C\u8BC1\u7801`)}else if(i.status==="Waiting 2FA"){let s=this.loginState();s.accountId===i.id&&!s.requires2FA&&(this.loginState.set({accountId:i.id,phone:i.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info(`\u8D26\u6237 ${i.phone} \u7B49\u5F85 2FA \u5BC6\u7801`))}else(i.status.includes("Error")||i.status==="Error")&&(this.toastService.error(`\u8D26\u6237 ${i.phone} \u767B\u5F55\u5931\u8D25`),this.cancelLogin())}),n.length>e&&this.toastService.success(`\u8D26\u6237\u5217\u8868\u5DF2\u66F4\u65B0\uFF08${n.length} \u4E2A\u8D26\u6237\uFF09`)}),this.ipcService.on("account-validation-error",n=>{console.error("Account validation error:",n);let e=Array.isArray(n.errors)?n.errors:[n.errors||"\u9A8C\u8BC1\u5931\u8D25"];if((n.error_type||"validation")==="duplicate"||e.some(s=>s.includes("\u5DF2\u5B58\u5728")||s.includes("already exists"))){this.validationErrors.set({account:e}),this.toastService.error(e.join("; "));return}this.accounts().length===0?(this.validationErrors.set({account:e}),this.toastService.error(`\u6DFB\u52A0\u8D26\u6237\u5931\u8D25: ${e.join("; ")}`)):console.warn("Validation error received but accounts already exist, ignoring:",e)}),this.ipcService.on("new-lead-captured",n=>{n.timestamp=new Date(n.timestamp),n.interactionHistory.forEach(e=>e.timestamp=new Date(e.timestamp)),this.leads.update(e=>[n,...e])}),this.ipcService.on("keyword-matched",n=>{console.log("[Frontend] Keyword matched event:",n),this.realtimeMatches.update(e=>[n,...e].slice(0,50)),this.todayStats.update(e=>N(M({},e),{matchCount:e.matchCount+1}))}),this.ipcService.on("lead-captured",n=>{console.log("[Frontend] Lead captured event received:",n),this.todayStats.update(t=>N(M({},t),{newLeads:t.newLeads+1})),this.showNotification("\u65B0\u6F5B\u5728\u5BA2\u6236\u5DF2\u6355\u7372",`@${n.username||n.firstName||"\u7528\u6236"} \u5DF2\u6355\u7372`,{requireInteraction:!0}),n.interactionHistory||(n.interactionHistory=[]),n.status||(n.status="New"),n.doNotContact===void 0&&(n.doNotContact=!1),n.timestamp=new Date(n.timestamp||new Date),n.interactionHistory&&n.interactionHistory.forEach(t=>t.timestamp=new Date(t.timestamp)),this.leads.update(t=>{let i=t.findIndex(o=>o.userId===n.userId);return i>=0?(t[i]=n,[...t]):[n,...t]});let e=n.username?`@${n.username}`:n.firstName||n.userId;this.toastService.success(`\u{1F3AF} ${this.t("newLeadCaptured")}: ${e}`,4e3)}),this.ipcService.on("session-files-cleaned",n=>{this.toastService.success(`\u6E05\u7406\u5B8C\u6210\uFF1A\u5220\u9664\u4E86 ${n.deleted_count} \u4E2A\u5B64\u7ACB\u6587\u4EF6\uFF0C\u4FDD\u7559\u4E86 ${n.kept_count} \u4E2A\u6709\u6548\u6587\u4EF6`),console.log("[Frontend] Session files cleaned:",n)}),this.ipcService.on("session-files-cleanup-error",n=>{this.toastService.error(`\u6E05\u7406\u5931\u8D25\uFF1A${n.error}`),console.error("[Frontend] Session files cleanup error:",n)})}function nd(){this.ipcService.on("session-import-result",n=>{console.log("[Frontend] Session import result:",n),n.success?(this.toastService.success(n.phone?`\u2705 Session \u5C0E\u5165\u6210\u529F: ${n.phone}`:`\u2705 \u5C0E\u5165\u5B8C\u6210: ${n.count||1} \u500B\u5E33\u865F`,3e3),this.ipcService.send("get-initial-state")):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${n.message}`,4e3)}),this.ipcService.on("session-import-needs-credentials",n=>{console.log("[Frontend] Session import needs credentials:",n),this.toastService.warning(`\u26A0\uFE0F \u5C0E\u5165 ${n.phoneNumber} \u9700\u8981 API \u6191\u64DA`,4e3),this.toastService.info("\u8ACB\u5148\u5728\u300CAPI \u6191\u64DA\u6C60\u300D\u9801\u9762\u6DFB\u52A0 API \u6191\u64DA\uFF0C\u7136\u5F8C\u91CD\u8A66\u5C0E\u5165",5e3)}),this.ipcService.on("orphan-sessions-detected",n=>{console.log("[Frontend] Orphan sessions detected:",n),n.count>0&&(this.orphanSessions.set(n.sessions),this.showOrphanSessionDialog.set(!0),this.toastService.warning(`\u767C\u73FE ${n.count} \u500B\u9700\u8981\u624B\u52D5\u6062\u5FA9\u7684 Session \u6587\u4EF6`,5e3))}),this.ipcService.on("orphan-sessions-scanned",n=>{console.log("[Frontend] Orphan sessions scanned:",n),n.success&&n.orphan_sessions.length>0&&this.orphanSessions.set(n.orphan_sessions)}),this.ipcService.on("orphan-sessions-recovered",n=>{console.log("[Frontend] Orphan sessions recovered:",n),this.isRecoveringOrphanSessions.set(!1),n.success?(this.toastService.success(`\u6210\u529F\u6062\u5FA9 ${n.recovered_count} \u500B\u5E33\u865F`,3e3),this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([]),this.ipcService.send("get-accounts")):this.toastService.error(`\u6062\u5FA9\u5931\u6557: ${n.message}`,4e3)}),this.ipcService.on("keyword-set-validation-error",n=>{console.error("[Frontend] Keyword set validation error:",n);let e=n.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${e}`)}),this.ipcService.on("keyword-set-error",n=>{if(console.log("[Frontend] Keyword set error event:",n),n.success)n.message&&this.toastService.success(n.message),this.newKeywordSet.set({name:""});else{let e=n.error||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";console.warn("[Frontend] Keyword set error:",e,n.details),e.includes("\u5DF2\u5B58\u5728")||e.includes("already exists")?this.toastService.warning("\u5173\u952E\u8BCD\u96C6\u5DF2\u5B58\u5728",3e3):e.includes("\u4E0D\u5B58\u5728")||e.includes("not found")?console.log("[Frontend] Keyword set already deleted, ignoring"):e.includes("\u6570\u636E\u5EAB")||e.includes("\u6570\u636E\u5E93")||e.includes("\u640D\u58DE")||e.includes("\u635F\u574F")?this.toastService.error(`\u6570\u636E\u5E93\u9519\u8BEF: ${e}\u3002\u8BF7\u4F7F\u7528 rebuild_database.py \u91CD\u5EFA\u6570\u636E\u5E93\u3002`,1e4):this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${e}`)}}),this.ipcService.on("keyword-validation-error",n=>{console.error("[Frontend] Keyword validation error:",n);let e=n.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u9519\u8BEF: ${e}`)}),this.ipcService.on("group-validation-error",n=>{console.error("[Frontend] Group validation error:",n);let e=n.errors?.join("; ")||"\u6DFB\u52A0\u7FA4\u7EC4\u5931\u8D25";this.toastService.error(`\u7FA4\u7EC4\u9519\u8BEF: ${e}`)}),this.ipcService.on("group-membership-status",n=>{console.log("[Frontend] Group membership status:",n),n.status.is_member?this.toastService.success(`\u2713 \u76E3\u63A7\u865F\u5DF2\u5728\u7FA4\u7D44\u4E2D: ${n.status.chat_title||n.url}`,3e3):n.status.can_join&&(n.status.is_private?this.toastService.warning("\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u624B\u52D5\u5C07\u76E3\u63A7\u865F\u52A0\u5165\u7FA4\u7D44",5e3):this.toastService.info("\u2139 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u7FA4\u7D44\uFF0C\u555F\u52D5\u76E3\u63A7\u6642\u5C07\u81EA\u52D5\u52A0\u5165",4e3))}),this.ipcService.on("group-join-result",n=>{console.log("[Frontend] Group join result:",n),n.success?n.alreadyMember?this.toastService.success(`${n.phone} \u5DF2\u7D93\u5728\u7FA4\u7D44 ${n.chatTitle||n.groupUrl} \u4E2D`,3e3):this.toastService.success(`${n.phone} \u6210\u529F\u52A0\u5165\u7FA4\u7D44 ${n.chatTitle||n.groupUrl}`,4e3):this.toastService.error(`\u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${n.error}`,5e3)}),this.ipcService.on("template-validation-error",n=>{console.error("[Frontend] Template validation error:",n);let e=n.errors?.join("; ")||"\u6DFB\u52A0\u6A21\u677F\u5931\u8D25";this.toastService.error(`\u6A21\u677F\u9519\u8BEF: ${e}`)}),this.ipcService.on("campaign-validation-error",n=>{console.error("[Frontend] Campaign validation error:",n);let e=n.errors?.join("; ")||"\u521B\u5EFA\u6D3B\u52A8\u5931\u8D25";this.toastService.error(`\u6D3B\u52A8\u9519\u8BEF: ${e}`)}),this.ipcService.on("login-requires-code",n=>{console.log("[Frontend] Received login-requires-code event:",n),console.log("[Frontend] Current loginState before update:",this.loginState()),this.loginState.set({accountId:n.accountId,phone:n.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:n.phoneCodeHash,isSubmittingCode:!1,canRetrySMS:n.canRetrySMS||!1,waitSeconds:n.waitSeconds}),console.log("[Frontend] Updated loginState:",this.loginState()),console.log("[Frontend] requiresCode value:",this.loginState().requiresCode),this.loginCode.set(""),n.message?n.sendType==="app"?this.toastService.info(n.message,8e3):this.toastService.info(n.message):n.sendType==="app"?this.toastService.info("\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230\u60A8\u7684 Telegram \u5E94\u7528\u3002\u8BF7\u68C0\u67E5\u60A8\u624B\u673A\u4E0A\u5DF2\u767B\u5F55\u7684 Telegram \u5E94\u7528\uFF0C\u67E5\u770B\u9A8C\u8BC1\u7801\u6D88\u606F\u3002",8e3):n.sendType==="sms"?this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${n.phone} \u7684\u77ED\u4FE1\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`):this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${n.phone}\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`)}),this.ipcService.on("login-requires-2fa",n=>{console.log("[Frontend] Received login-requires-2fa event:",n),this.loginState.set({accountId:n.accountId,phone:n.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info("\u8BF7\u8F93\u5165 2FA \u5BC6\u7801")}),this.ipcService.on("account-login-error",n=>{if(console.error("[Frontend] Account login error:",n),n.floodWait){let t=n.floodWait,i=Math.floor(t/3600),o=Math.floor(t%3600/60),s=t%60,r="";i>0?(r=`${i} \u5C0F\u65F6`,o>0&&(r+=` ${o} \u5206\u949F`)):o>0?(r=`${o} \u5206\u949F`,s>0&&(r+=` ${s} \u79D2`)):r=`${s} \u79D2`;let l=`\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7B49\u5F85 ${r} \u540E\u518D\u8BD5\u3002\u9A8C\u8BC1\u7801\u672A\u53D1\u9001\u3002`;this.toastService.error(l),console.error("FloodWait error:",{waitSeconds:t,timeStr:r})}else this.toastService.error(n.friendlyMessage||n.message);console.error("Login error details:",{accountId:n.accountId,phone:n.phone,status:n.status,message:n.message,codeExpired:n.codeExpired,floodWait:n.floodWait});let e=this.loginState();if(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:e.requiresCode,requires2FA:e.requires2FA,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!1}),n.floodWait){this.cancelLogin();return}n.codeExpired?(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set("")):n.message&&(n.message.includes("banned")||n.message.includes("invalid phone"))?this.cancelLogin():n.message&&n.message.includes("Invalid verification code")&&this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!1})}),this.ipcService.on("account-status-updated",n=>{}),this.ipcService.on("initial-state-core",n=>{console.log("[Frontend] \u{1F680} Received initial-state-core (accounts + settings)"),n?.accounts&&(this.accounts.set(n.accounts),console.log("[Frontend] Accounts loaded:",n.accounts.length)),n?.settings&&(this.spintaxEnabled.set(n.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(n.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(n.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(n.settings.smartSendingEnabled??!0)),n?.isMonitoring!==void 0&&this.isMonitoring.set(n.isMonitoring),console.log("[App] Setting coreDataLoaded to true"),this.coreDataLoaded.set(!0),console.log("[App] coreDataLoaded is now:",this.coreDataLoaded())}),this.ipcService.on("initial-state-config",n=>{console.log("[Frontend] \u{1F4CB} Received initial-state-config"),n?.keywordSets&&this.keywordSets.set(n.keywordSets),n?.monitoredGroups&&this.monitoredGroups.set(n.monitoredGroups),n?.campaigns&&this.campaigns.set(n.campaigns),n?.messageTemplates&&this.messageTemplates.set(n.messageTemplates)}),this.ipcService.on("initial-state-data",n=>{if(console.log("[Frontend] \u{1F4CA} Received initial-state-data (leads + logs)"),console.log("[Frontend] leads count:",n?.leads?.length,"total:",n?.leadsTotal,"hasMore:",n?.leadsHasMore),n?.leads){let e=(n.leads||[]).map(t=>this.mapLeadFromBackend(t));this.leads.set(e),this.contactsService.importLeadsDirectly(e),console.log("[Frontend] Initial leads synced to resource center:",e.length)}n?.leadsTotal!==void 0&&this.leadsTotal.set(n.leadsTotal),n?.leadsHasMore!==void 0&&this.leadsHasMore.set(n.leadsHasMore),n?.leads&&n?.leadsTotal&&n.leads.length<n.leadsTotal&&(console.log("[Frontend] \u{1F504} Auto-loading remaining leads..."),this.leadsHasMore.set(!0),this.leadsLoading.set(!1),setTimeout(()=>this.loadRemainingLeads(),500)),n?.logs&&this.logs.set(n.logs)}),this.ipcService.on("initial-state",n=>{console.log("[Frontend] \u2605\u2605\u2605 Received initial-state event \u2605\u2605\u2605"),console.log("[Frontend] initial-state payload:",n),console.log("[Frontend] accounts in payload:",n?.accounts?.length||0);let e=Date.now();if(e-this.lastInitialStateTime<500){this.initialStateDebounceTimer&&clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=setTimeout(()=>{try{this.applyInitialState(n)}catch(t){console.error("[Frontend] Error applying initial state:",t)}finally{this.initialStateDebounceTimer=void 0}},500);return}this.lastInitialStateTime=e;try{this.applyInitialState(n)}catch(t){console.error("[Frontend] Error applying initial state:",t)}}),this.ipcService.on("keyword-sets-updated",n=>{typeof console<"u"&&console.log&&console.log("[Frontend] Received keyword-sets-updated:",n.keywordSets?.length||0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),n.keywordSets&&Array.isArray(n.keywordSets)?this.keywordSetsUpdateDebounceTimer=setTimeout(()=>{try{let e=new Set,t=n.keywordSets.filter(s=>!s||typeof s.id!="number"||e.has(s.id)?!1:(e.add(s.id),!0)).map(s=>{let r=Array.isArray(s.keywords)?s.keywords:[],l=new Set,d=r.filter(u=>{if(!u||typeof u.keyword!="string")return!1;let f=`${u.keyword}_${u.isRegex}`;return l.has(f)?!1:(l.add(f),!0)});return N(M({},s),{keywords:d})}),i=this.keywordSets();JSON.stringify(i)!==JSON.stringify(t)&&this.keywordSets.set(t)}catch(e){console.error("[Frontend] Error processing keyword-sets-updated:",e)}finally{this.keywordSetsUpdateDebounceTimer=void 0}},150):this.keywordSets().length>0&&this.keywordSets.set([])}),this.ipcService.on("keyword-validation-error",n=>{console.log("[Frontend] Keyword validation error:",n),n.errors&&n.errors.length>0&&(this.toastService.error(`\u95DC\u9375\u8A5E\u9A57\u8B49\u5931\u6557: ${n.errors.join(", ")}`,4e3),setTimeout(()=>{},1e3))}),this.ipcService.on("groups-updated",n=>{console.log("[Frontend] Received groups-updated:",n.monitoredGroups?.length||0),this.monitoredGroups.set(n.monitoredGroups||[])}),this.ipcService.on("templates-updated",n=>{console.log("[Frontend] Received templates-updated:",n.messageTemplates?.length||0),this.messageTemplates.set(n.messageTemplates||[])}),this.ipcService.on("campaigns-updated",n=>{console.log("[Frontend] Received campaigns-updated:",n.campaigns?.length||0),this.campaigns.set(n.campaigns||[]),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-already-exists",n=>{console.log("[Frontend] Campaign already exists:",n),this.toastService.warning(n.message||`\u6D3B\u52D5 "${n.name}" \u5DF2\u5B58\u5728`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-validation-error",n=>{console.log("[Frontend] Campaign validation error:",n),n.errors&&n.errors.length>0&&this.toastService.error(`\u6D3B\u52D5\u9A57\u8B49\u5931\u6557: ${n.errors.join(", ")}`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("search-leads-result",n=>{this.isSearchingLeads.set(!1),n.success&&n.results?(this.leadSearchResults.set(n.results),n.results.length===0&&this.toastService.info("\u672A\u627E\u5230\u5339\u914D\u7684\u6F5C\u5728\u5BA2\u6237")):(this.toastService.error(n.error||"\u641C\u7D22\u5931\u8D25"),this.leadSearchResults.set([]))}),this.ipcService.on("backup-created",n=>{this.isCreatingBackup.set(!1),n.success?(this.toastService.success("\u5907\u4EFD\u521B\u5EFA\u6210\u529F"),this.loadBackups()):this.toastService.error(n.error||"\u5907\u4EFD\u521B\u5EFA\u5931\u8D25")}),this.ipcService.on("backups-list",n=>{n.success&&n.backups&&this.backups.set(n.backups)}),this.ipcService.on("backup-restored",n=>{this.isRestoringBackup.set(!1),n.success?this.toastService.success("\u5907\u4EFD\u6062\u590D\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u9875\u9762"):this.toastService.error(n.error||"\u5907\u4EFD\u6062\u590D\u5931\u8D25")}),this.ipcService.on("backup-deleted",n=>{n.success?(this.toastService.success("\u5907\u4EFD\u5DF2\u5220\u9664"),this.loadBackups()):this.toastService.error(n.error||"\u5220\u9664\u5907\u4EFD\u5931\u8D25")}),this.ipcService.on("leads-updated",n=>{let e=n.total??n.leads?.length??0;console.log("[Frontend] Received leads-updated:",n.leads?.length||0,"total:",e);let t=(n.leads||[]).map(i=>this.mapLeadFromBackend(i));this.leads.set(t),this.leadsTotal.set(e),this.contactsService.importLeadsDirectly(t)}),this.ipcService.on("leads-paginated",n=>{if(console.log("[Frontend] Received leads-paginated:",n.leads?.length||0,"total:",n.total),this.leadsLoading.set(!1),n.leads&&n.leads.length>0){let e=n.leads.map(t=>this.mapLeadFromBackend(t));this.leads.set(e),this.leadsTotal.set(n.total),this.leadsHasMore.set(n.hasMore),this.contactsService.importLeadsDirectly(e),console.log("[Frontend] \u2705 Synced to resource center:",e.length,"leads"),n.hasMore||this.toastService.success(`\u6578\u64DA\u52A0\u8F09\u5B8C\u6210\uFF1A\u5171 ${e.length} \u689D`)}}),this.ipcService.on("funnel-stats",n=>{console.log("[Frontend] Received funnel-stats:",n),n.error||this.funnelStats.set(n)}),this.ipcService.on("funnel-overview",n=>{this.isLoadingFunnel.set(!1),n.success&&this.funnelOverview.set({stages:n.stages||[],totalLeads:n.total_leads||0,convertedLeads:n.converted_leads||0,averageConversionDays:n.average_days||0,conversionRate:n.conversion_rate||0})}),this.ipcService.on("user-journey",n=>{this.isLoadingJourney.set(!1),n.success&&n.journey&&this.userJourneyData.set({userId:n.userId,stages:n.journey.transitions||[],currentStage:n.journey.current_stage||"new",totalDays:n.journey.total_days||0,isConverted:n.journey.is_converted||!1})}),this.ipcService.on("funnel-stage-transitioned",n=>{n.success?(this.toastService.success(`\u2705 \u6F0F\u6597\u968E\u6BB5\u5DF2\u66F4\u65B0: ${n.stage}`),this.loadFunnelOverview(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${n.error}`)}),this.ipcService.on("marketing-stats",n=>{this.isLoadingMarketing.set(!1),n.success!==!1&&this.marketingStats.set({totalCampaigns:n.total_campaigns||0,running:n.running||0,completed:n.completed||0,totalMessages:n.total_messages||0,totalInvites:n.total_invites||0,successRate:n.success_rate||0})}),this.ipcService.on("marketing-campaigns",n=>{n.success&&n.campaigns&&this.marketingCampaigns.set(n.campaigns)}),this.ipcService.on("campaign-created",n=>{n.success?(this.toastService.success("\u2705 \u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.showCreateCampaignDialog.set(!1),this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""},this.loadMarketingCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${n.error}`)}),this.ipcService.on("campaign-started",n=>{n.success&&(this.toastService.info("\u{1F680} \u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadMarketingCampaigns())}),this.ipcService.on("campaign-complete",n=>{n.success&&(this.toastService.success(`\u2705 \u6D3B\u52D5\u5B8C\u6210\uFF01\u6210\u529F: ${n.stats?.success||0}, \u5931\u6557: ${n.stats?.failed||0}`),this.loadMarketingStats(),this.loadMarketingCampaigns())}),this.ipcService.on("warmup-progress",n=>{n.success&&n.accountId&&this.warmupDetails.update(e=>N(M({},e),{[n.accountId]:{enabled:n.enabled||!1,startDate:n.start_date||null,stage:n.stage?.stage||0,stageName:n.stage?.stage_name||"",daysCompleted:n.days_completed||0,totalDays:n.total_days||14,progressPercent:n.progress_percentage||0,dailyLimit:n.stage?.daily_limit||0,allowedActions:n.stage?.allowed_actions||[]}}))})}function id(){this.ipcService.on("migration-status",n=>{this.isLoadingMigration.set(!1),n.error||this.migrationStatus.set({currentVersion:n.current_version||0,latestVersion:n.latest_version||0,appliedCount:n.applied_count||0,pendingCount:n.pending_count||0,appliedMigrations:n.applied_migrations||[],pendingMigrations:n.pending_migrations||[]})}),this.ipcService.on("migration-completed",n=>{this.isRunningMigration.set(!1),n.error?this.toastService.error(`\u9077\u79FB\u5931\u6557: ${n.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u9077\u79FB\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("rollback-completed",n=>{this.isRunningMigration.set(!1),n.error?this.toastService.error(`\u56DE\u6EFE\u5931\u6557: ${n.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u56DE\u6EFE\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("scheduler-status",n=>{n.success!==!1&&this.schedulerStatus.set({isRunning:n.is_running||!1,tasks:n.tasks||[]})}),this.ipcService.on("scheduler-started",n=>{n.success&&(this.toastService.success("\u2705 \u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-stopped",n=>{n.success&&(this.toastService.info("\u8ABF\u5EA6\u5668\u5DF2\u505C\u6B62"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-task-result",n=>{n.success?this.toastService.success(`\u2705 \u4EFB\u52D9 ${n.taskName} \u57F7\u884C\u5B8C\u6210`):this.toastService.error(`\u4EFB\u52D9\u57F7\u884C\u5931\u6557: ${n.error}`),this.loadSchedulerStatus()}),this.ipcService.on("log-files",n=>{this.isLoadingLogs.set(!1),n.files&&this.logFiles.set(n.files.map(e=>({name:e.name,size:e.size,sizeFormatted:this.formatFileSize(e.size),modifiedAt:e.modified_at,isCompressed:e.name.endsWith(".gz")})))}),this.ipcService.on("log-stats",n=>{n.error||this.logStats.set({totalFiles:n.total_files||0,totalSize:n.total_size||0,totalSizeFormatted:this.formatFileSize(n.total_size||0),compressedFiles:n.compressed_files||0,oldestFile:n.oldest_file,newestFile:n.newest_file})}),this.ipcService.on("logs-rotated",n=>{this.isRotatingLogs.set(!1),n.success?(this.toastService.success(`\u2705 \u65E5\u8A8C\u8F2A\u8F49\u5B8C\u6210\uFF0C\u8F2A\u8F49\u4E86 ${n.rotated_count||0} \u500B\u6587\u4EF6`),this.loadLogFiles(),this.loadLogStats()):this.toastService.error(`\u65E5\u8A8C\u8F2A\u8F49\u5931\u6557: ${n.error}`)}),this.ipcService.on("log-file-content",n=>{n.content&&this.logFileContent.set(n.content)}),this.ipcService.on("log-file-deleted",n=>{n.success&&(this.toastService.success("\u2705 \u65E5\u8A8C\u6587\u4EF6\u5DF2\u522A\u9664"),this.loadLogFiles(),this.loadLogStats())}),this.ipcService.on("resources-batch-updated",n=>{n.success&&(this.toastService.success(`\u2705 \u5DF2\u66F4\u65B0 ${n.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-batch-deleted",n=>{n.success&&(this.toastService.success(`\u2705 \u5DF2\u522A\u9664 ${n.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-cleared",n=>{n.success?(this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u6E05\u7A7A\u6240\u6709\u8CC7\u6E90\uFF0C\u5171 ${n.deletedCount||0} \u689D`),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7A7A\u5931\u6557: ${n.error}`)}),this.ipcService.on("clear-resources-complete",n=>{n.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF0C\u5DF2\u522A\u9664 ${n.deleted_count||0} \u689D\u8A18\u9304`),this.discoveredResources.set([]),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${n.error}`)}),this.ipcService.on("users-with-profiles",n=>{console.log("[Frontend] Received users-with-profiles:",n.users?.length||0),n.error||this.usersWithProfiles.set(n)}),this.ipcService.on("one-click-start-progress",n=>{console.log("[Frontend] One-click progress:",n),this.oneClickProgress.set(n.progress),this.oneClickMessage.set(n.message)}),this.ipcService.on("group-join-progress",n=>{let e=`\u{1F465} \u6B63\u5728\u6AA2\u67E5\u7FA4\u7D44 ${n.current}/${n.total}...`;this.oneClickMessage.set(e);let t=42+n.current/n.total*6;this.oneClickProgress.set(Math.round(t))}),this.ipcService.on("group-join-complete",n=>{console.log("[Frontend] Group join complete:",n);let e=n.skipped_cached?` (${n.skipped_cached} \u500B\u7DE9\u5B58\u547D\u4E2D)`:"";this.oneClickMessage.set(`\u2705 \u7FA4\u7D44\u52A0\u5165\u5B8C\u6210: ${n.success_count}/${n.total} \u6210\u529F${e}`)}),this.ipcService.on("one-click-start-result",n=>{console.log("[Frontend] One-click result:",n),this.oneClickStarting.set(!1),this.oneClickStartReport.set(n),this.showStartReport.set(!0),n.overall_success?this.toastService.success("\u{1F389} \u4E00\u9375\u555F\u52D5\u6210\u529F\uFF01\u7CFB\u7D71\u5DF2\u5C31\u7DD2",5e3):this.toastService.warning("\u26A0\uFE0F \u90E8\u5206\u529F\u80FD\u555F\u52D5\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u65E5\u8A8C",5e3),this.loadSystemStatus()}),this.ipcService.on("one-click-stop-result",n=>{console.log("[Frontend] One-click stop result:",n),n.success&&this.toastService.info("\u{1F6D1} \u6240\u6709\u670D\u52D9\u5DF2\u505C\u6B62",3e3),this.loadSystemStatus()}),this.ipcService.on("system-status",n=>{console.log("[Frontend] System status:",n),n.error||this.systemStatus.set(n)}),this.ipcService.on("trigger-rules-result",n=>{n.success&&setTimeout(()=>this.loadSystemStatus(),100)}),this.ipcService.on("ai-settings-updated",n=>{console.log("[Frontend] AI settings updated:",n),n.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(n.auto_chat_enabled),n.auto_chat_mode&&this.aiAutoChatMode.set(n.auto_chat_mode)}),this.ipcService.on("bulk-update-complete",n=>{console.log("[Frontend] Bulk update complete:",n),n.success?(this.toastService.success(`\u5DF2\u66F4\u65B0 ${n.count} \u500B\u7528\u6236`),this.selectedUserIds.set([]),this.loadUsersWithProfiles(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${n.error}`)}),this.ipcService.on("settings-updated",n=>{n&&(this.spintaxEnabled.set(n.spintaxEnabled??!0),this.autoReplyEnabled.set(n.autoReplyEnabled??!1),this.autoReplyMessage.set(n.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(n.smartSendingEnabled??!0))}),this.ipcService.on("queue-status",n=>{if(typeof n=="object"&&"phone"in n){let l=n;this.queueStatuses.update(d=>N(M({},d),{[l.phone]:l}))}else{let l=n;this.queueStatuses.set(l)}let e=Object.values(this.queueStatuses()),t=e.reduce((l,d)=>l+(d.pending||0),0),i=e.reduce((l,d)=>l+(d.processing||0),0),o=e.reduce((l,d)=>l+(d.stats?.completed||0),0),s=e.reduce((l,d)=>l+(d.failed||0),0),r=o+s;this.queueStats.set({pending:t,sending:i,sent:o,failed:s,retrying:e.reduce((l,d)=>l+(d.retrying||0),0),totalToday:r,successRate:r>0?o/r:0,avgSendTime:e.reduce((l,d)=>l+(d.stats?.avg_time||0),0)/(e.length||1)})}),this.ipcService.on("queue-messages",n=>{this.queueMessages.set(n.messages)}),this.ipcService.on("sending-stats",n=>{let e={labels:n.stats.map(t=>t.date),datasets:[{label:"\u6210\u529F\u53D1\u9001",data:n.stats.map(t=>t.successful||0),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5931\u8D25",data:n.stats.map(t=>t.failed||0),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0}]};this.sendingStatsData.set(e)}),this.ipcService.on("queue-length-history",n=>{let e={labels:n.history.map(t=>t.date),datasets:[{label:"\u961F\u5217\u957F\u5EA6",data:n.history.map(t=>t.queue_length||0),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]};this.queueLengthHistoryData.set(e)}),this.ipcService.on("account-sending-comparison",n=>{let e={labels:n.comparison.map(t=>t.phone),datasets:[{label:"\u603B\u53D1\u9001",data:n.comparison.map(t=>t.total_sent||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u6210\u529F",data:n.comparison.map(t=>t.successful||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5931\u8D25",data:n.comparison.map(t=>t.failed||0),backgroundColor:"rgba(239, 68, 68, 0.8)"}]};this.accountComparisonData.set(e)}),this.ipcService.on("campaign-performance-stats",n=>{let e={labels:n.stats.map(t=>t.campaign_name||"Unknown"),datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:n.stats.map(t=>t.leads_captured||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u5DF2\u8054\u7CFB",data:n.stats.map(t=>t.leads_contacted||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5DF2\u56DE\u590D",data:n.stats.map(t=>t.leads_replied||0),backgroundColor:"rgba(168, 85, 247, 0.8)"}]};this.campaignPerformanceData.set(e)}),this.ipcService.on("ai-greeting-suggestion",n=>{console.log("[AI] Received greeting suggestion:",n),this.aiGreetingSuggestion.set(n),this.showAiGreetingDialog.set(!0),this.toastService.info(`\u{1F916} AI \u5DF2\u70BA @${n.username||n.firstName} \u751F\u6210\u554F\u5019\u5EFA\u8B70`,5e3)}),this.ipcService.on("alert-triggered",n=>{n.timestamp=new Date(n.timestamp).toISOString(),this.alerts.update(e=>e.some(i=>i.alert_type===n.alert_type&&i.message===n.message&&Math.abs(new Date(i.timestamp).getTime()-new Date(n.timestamp).getTime())<6e4)?e:[n,...e].slice(0,100)),this.showBrowserNotification(n),this.showNotification(`\u544A\u8B66: ${n.level.toUpperCase()}`,n.message,{requireInteraction:n.level==="critical"})}),this.ipcService.on("alert-rules-loaded",n=>{n.success&&n.rules&&this.alertRules.set(n.rules)}),this.ipcService.on("alert-rule-updated",n=>{n.success?(this.toastService.success("\u544A\u8B66\u89C4\u5219\u5DF2\u66F4\u65B0"),this.loadAlertRules()):this.toastService.error(n.error||"\u66F4\u65B0\u5931\u8D25")}),this.ipcService.on("alert-history-loaded",n=>{n.success&&n.history&&this.alertHistory.set(n.history)}),this.ipcService.on("alerts-loaded",n=>{this.alerts.set(n.alerts)})}function od(){this.ipcService.on("rag-initialized",n=>{this.isInitializingRag.set(!1),n.success?(this.ragSystemInitialized.set(!0),this.toastService.success("\u2705 RAG \u7CFB\u7D71\u521D\u59CB\u5316\u5B8C\u6210"),this.refreshRagStats()):this.toastService.error(`RAG \u521D\u59CB\u5316\u5931\u6557: ${n.error}`)}),this.ipcService.on("rag-stats",n=>{if(n.success&&n.rag){let e=n.rag,t=e.by_type||{},i=0,o=0;for(let s of Object.keys(t))(s.toLowerCase().includes("qa")||s.toLowerCase().includes("\u554F\u7B54"))&&(i+=t[s].count||0),(s.toLowerCase().includes("script")||s.toLowerCase().includes("\u8A71\u8853"))&&(o+=t[s].count||0);this.ragStats.set({total_knowledge:e.total_knowledge||0,qa_count:i,scripts_count:o,total_uses:e.total_uses||0,avg_score:e.avg_score||0,chromadb_enabled:e.chromadb_enabled||!1,neural_embedding:e.neural_embedding||!1,by_type:t}),e.total_knowledge>0&&this.ragSystemInitialized.set(!0)}}),this.ipcService.on("rag-search-result",n=>{this.isSearchingRag.set(!1),n.success&&n.results?this.ragSearchResults.set(n.results):n.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${n.error}`)}),this.ipcService.on("rag-learning-triggered",n=>{this.isRagLearning.set(!1),n.success?(this.toastService.success(`\u{1F393} \u5B78\u7FD2\u5B8C\u6210\uFF01\u8655\u7406 ${n.conversationsProcessed||0} \u500B\u5C0D\u8A71\uFF0C\u63D0\u53D6 ${n.knowledgeExtracted||0} \u689D\u77E5\u8B58`),this.refreshRagStats()):this.toastService.error(`\u5B78\u7FD2\u5931\u6557: ${n.error}`)}),this.ipcService.on("rag-reindex-complete",n=>{this.isReindexing.set(!1),n.success?(this.toastService.success(`\u{1F504} \u91CD\u65B0\u7D22\u5F15\u5B8C\u6210\uFF01\u8655\u7406 ${n.conversations_processed||0} \u500B\u5C0D\u8A71`),this.refreshRagStats()):this.toastService.error(`\u91CD\u65B0\u7D22\u5F15\u5931\u6557: ${n.error}`)}),this.ipcService.on("rag-cleanup-complete",n=>{this.isCleaningRag.set(!1),n.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664 ${n.deleted||0} \u689D\uFF0C\u5408\u4F75 ${n.merged||0} \u689D`),this.refreshRagStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${n.error}`)}),this.ipcService.on("rag-knowledge-added",n=>{n.success?(this.toastService.success("\u2705 \u77E5\u8B58\u5DF2\u6DFB\u52A0"),this.refreshRagStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${n.error}`)}),this.ipcService.on("rag-feedback-recorded",n=>{n.success||this.toastService.error(`\u53CD\u994B\u8A18\u9304\u5931\u6557: ${n.error}`)}),this.ipcService.on("memories-searched",n=>{this.isSearchingMemory.set(!1),n.success&&n.memories?this.vectorMemorySearchResults.set(n.memories.map(e=>({id:e.id,userId:e.user_id,content:e.content,memoryType:e.memory_type,importance:e.importance,similarity:e.similarity||0,createdAt:e.created_at}))):n.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${n.error}`)}),this.ipcService.on("memory-added",n=>{this.isAddingMemory.set(!1),n.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u6DFB\u52A0"),this.newMemory={userId:"",content:"",type:"conversation",importance:.5},this.showAddMemoryDialog.set(!1),this.refreshMemoryStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${n.error}`)}),this.ipcService.on("memory-stats",n=>{n.success&&this.vectorMemoryStats.set({totalMemories:n.totalMemories||0,byType:n.byType||{},totalUsers:n.totalUsers||0,avgImportance:n.avgImportance||0})}),this.ipcService.on("memory-user-list",n=>{n.success&&n.users&&this.memoryUserList.set(n.users)}),this.ipcService.on("memory-deleted",n=>{n.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u522A\u9664"),this.vectorMemorySearchResults.update(e=>e.filter(t=>t.id!==n.memoryId)),this.refreshMemoryStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${n.error}`)}),this.ipcService.on("memories-merged",n=>{n.success?(this.toastService.success(`\u2705 \u5408\u4F75\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${n.mergedCount||0} \u689D\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u5408\u4F75\u5931\u6557: ${n.error}`)}),this.ipcService.on("old-memories-cleaned",n=>{n.success?(this.toastService.success(`\u2705 \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664\u4E86 ${n.deletedCount||0} \u689D\u820A\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${n.error}`)}),this.ipcService.on("batch-operation-result",n=>{this.handleBatchOperationResult(n)}),this.ipcService.on("batch-operation-progress",n=>{this.handleBatchOperationProgress(n)}),this.ipcService.on("batch-undo-result",n=>{this.handleBatchUndoResult(n)}),this.ipcService.on("batch-operation-history",n=>{this.handleBatchOperationHistory(n)}),this.ipcService.on("all-tags",n=>{this.handleAllTags(n)}),this.ipcService.on("tag-created",n=>{this.handleTagCreated(n)}),this.ipcService.on("tag-deleted",n=>{this.handleTagDeleted(n)}),this.ipcService.on("ad-templates",n=>{this.handleAdTemplates(n)}),this.ipcService.on("ad-schedules",n=>{this.handleAdSchedules(n)}),this.ipcService.on("ad-send-logs",n=>{this.handleAdSendLogs(n)}),this.ipcService.on("ad-overview-stats",n=>{this.handleAdOverviewStats(n)}),this.ipcService.on("ad-template-created",n=>{this.handleAdTemplateCreated(n)}),this.ipcService.on("ad-template-deleted",n=>{this.handleAdTemplateDeleted(n)}),this.ipcService.on("ad-template-toggled",n=>{n.success&&this.loadAdTemplates()}),this.ipcService.on("ad-schedule-created",n=>{this.handleAdScheduleCreated(n)}),this.ipcService.on("ad-schedule-deleted",n=>{this.handleAdScheduleDeleted(n)}),this.ipcService.on("ad-schedule-toggled",n=>{n.success&&this.loadAdSchedules()}),this.ipcService.on("ad-schedule-run-result",n=>{this.handleAdScheduleRunResult(n)}),this.ipcService.on("spintax-validated",n=>{this.handleSpintaxValidated(n)}),this.ipcService.on("ad-sent",n=>{this.toastService.success(`\u5EE3\u544A\u5DF2\u767C\u9001\u5230 ${n.groupTitle||n.groupId}`)}),this.ipcService.on("ad-send-failed",n=>{this.toastService.error(`\u767C\u9001\u5931\u6557: ${n.error}`)}),this.ipcService.on("broadcast-progress",n=>{this.progressDialog.set({show:!0,title:"\u5EE3\u544A\u767C\u9001\u4E2D...",progress:{current:n.current,total:n.total,message:`\u5DF2\u767C\u9001 ${n.sent}\uFF0C\u5931\u6557 ${n.failed}`},cancellable:!1})}),this.ipcService.on("broadcast-completed",n=>{this.progressDialog.update(e=>N(M({},e),{show:!1})),this.toastService.success(`\u5EE3\u544A\u767C\u9001\u5B8C\u6210: ${n.sent} \u6210\u529F, ${n.failed} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()}),this.ipcService.on("tracked-users",n=>{this.handleTrackedUsers(n)}),this.ipcService.on("user-groups",n=>{this.handleUserGroups(n)}),this.ipcService.on("high-value-groups",n=>{this.handleHighValueGroups(n)}),this.ipcService.on("tracking-stats",n=>{this.handleTrackingStats(n)}),this.ipcService.on("user-added-to-track",n=>{this.handleUserAddedToTrack(n)}),this.ipcService.on("user-added-from-lead",n=>{n.success?this.toastService.success("Lead \u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${n.error}`)}),this.ipcService.on("user-removed",n=>{this.handleUserRemoved(n)}),this.ipcService.on("user-tracking-started",n=>{this.isTrackingUser.set(!0)}),this.ipcService.on("user-tracking-completed",n=>{this.handleUserTrackingCompleted(n)}),this.ipcService.on("user-tracking-failed",n=>{this.handleUserTrackingFailed(n)}),this.ipcService.on("user-value-updated",n=>{n.success&&this.loadTrackedUsers()}),this.ipcService.on("batch-tracking-progress",n=>{this.progressDialog.set({show:!0,title:"\u6279\u91CF\u8FFD\u8E64\u4E2D...",progress:{current:n.current,total:n.total,message:`\u6B63\u5728\u8FFD\u8E64\u7528\u6236 ${n.userId}`},cancellable:!1})}),this.ipcService.on("batch-tracking-completed",n=>{this.progressDialog.update(e=>N(M({},e),{show:!1})),this.toastService.success(`\u6279\u91CF\u8FFD\u8E64\u5B8C\u6210: ${n.completed} \u6210\u529F, ${n.failed} \u5931\u6557`),this.loadTrackedUsers(),this.loadTrackingStats()}),this.ipcService.on("campaigns",n=>{this.handleCampaigns(n)}),this.ipcService.on("campaign-created",n=>{this.handleCampaignCreated(n)}),this.ipcService.on("campaign-deleted",n=>{this.handleCampaignDeleted(n)}),this.ipcService.on("campaign-started",n=>{n.success!==!1&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadCampaigns())}),this.ipcService.on("campaign-paused",n=>{n.success&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u66AB\u505C"),this.loadCampaigns())}),this.ipcService.on("campaign-stopped",n=>{n.success!==!1&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u505C\u6B62"),this.loadCampaigns())}),this.ipcService.on("campaign-completed",n=>{this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u57F7\u884C\u5B8C\u6210"),this.loadCampaigns(),this.loadUnifiedOverview()}),this.ipcService.on("campaign-step-started",n=>{this.progressDialog.set({show:!0,title:"\u57F7\u884C\u71DF\u92B7\u6D3B\u52D5...",progress:{current:0,total:0,message:`\u57F7\u884C\u6B65\u9A5F: ${n.actionType}`},cancellable:!1})}),this.ipcService.on("campaign-step-completed",n=>{this.progressDialog.update(e=>N(M({},e),{show:!1}))}),this.ipcService.on("unified-overview",n=>{this.handleUnifiedOverview(n)}),this.ipcService.on("funnel-analysis",n=>{this.handleFunnelAnalysis(n)}),this.ipcService.on("role-templates",n=>{this.handleRoleTemplates(n)}),this.ipcService.on("all-roles",n=>{this.handleAllRoles(n)}),this.ipcService.on("role-assigned",n=>{n.success?(this.toastService.success("\u89D2\u8272\u5DF2\u5206\u914D"),this.loadAllRoles(),this.loadRoleStats()):this.toastService.error(`\u5206\u914D\u5931\u6557: ${n.error}`)}),this.ipcService.on("role-removed",n=>{n.success&&(this.toastService.success("\u89D2\u8272\u5DF2\u79FB\u9664"),this.loadAllRoles(),this.loadRoleStats())}),this.ipcService.on("role-stats",n=>{this.handleRoleStats(n)}),this.ipcService.on("script-templates",n=>{this.handleScriptTemplates(n)}),this.ipcService.on("collab-groups",n=>{this.handleCollabGroups(n)}),this.ipcService.on("collab-stats",n=>{this.handleCollabStats(n)}),this.ipcService.on("collab-group-created",n=>{n.success!==!1&&(this.toastService.success("\u5354\u4F5C\u7FA4\u7D44\u5DF2\u5275\u5EFA"),this.loadCollabGroups())})}function sd(){this.ipcService.on("resource-discovery-initialized",n=>{if(n.success){if(this.resourceDiscoveryInitialized.set(!0),this.toastService.success("\u2705 \u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71\u5DF2\u521D\u59CB\u5316"),this.refreshResourceStats(),this.loadDiscoveryKeywords(),this.pendingSearchQuery){let e=this.pendingSearchQuery;this.pendingSearchQuery="",this.toastService.info(`\u6B63\u5728\u641C\u7D22 "${e}"...`),setTimeout(()=>this.searchResources(),500)}}else this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${n.error}`)}),this.ipcService.on("search-results-direct",n=>{if(this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),n.success&&n.results){let e=n.results,t=n.query?.toLowerCase()||"",i=e.sort((r,l)=>{let d=(r.title||"").toLowerCase(),u=(l.title||"").toLowerCase(),f=d.includes(t)?1:0,C=u.includes(t)?1:0;return f!==C?C-f:(l.overall_score||0)-(r.overall_score||0)}),o=new Set,s=i.filter(r=>o.has(r.telegram_id)?!1:(o.add(r.telegram_id),!0));if(this.discoveredResources.set(s),this.currentSearchKeyword.set(t),s.length>0){let r=this.generateSearchCacheKey(n.query||"",this.selectedSearchSources());this.setSearchCache(r,s)}s.length===0?console.log(`[Search] \u672A\u627E\u5230\u8207\u300C${n.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`):console.log(`[Search] \u627E\u5230 ${s.length} \u500B\u8207\u300C${n.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`)}else n.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${n.error}`)}),this.ipcService.on("search-resources-complete",n=>{this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),n.success?(n.found===0?console.log("[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C"):console.log(`[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u627E\u5230 ${n.found} \u4E2A`),this.refreshResourceStats()):this.toastService.error(`\u641C\u7D22\u5931\u8D25: ${n.error}`)}),this.ipcService.on("search-jiso-complete",n=>{if(n.success&&n.results){let t=n.results.length;if(t===0)console.log("[Search] \u6781\u641C\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C");else{let i=n.cached?"\uFF08\u7F13\u5B58\uFF09":"",o=n.bot?`\uFF08\u4F86\u81EA @${n.bot}\uFF09`:"";console.log(`[Search] \u6781\u641C\u5B8C\u6210${i}\uFF1A\u627E\u5230 ${t} \u4E2A\u7FA4\u7EC4${o}`);let s=this.discoveredResources(),r=new Set(s.map(d=>d.telegram_id||d.username)),l=n.results.filter(d=>!r.has(d.telegram_id)&&!r.has(d.username)).map(d=>{let u=d.username||"";u&&u.toLowerCase().endsWith("bot")&&(u="");let f=d.link||"";return f&&/t\.me\/[^/]+\/\d+/.test(f)&&(f=""),{id:0,telegram_id:d.telegram_id&&/^-?\d+$/.test(String(d.telegram_id))?String(d.telegram_id):"",username:u,title:d.title||"",description:d.description||"",member_count:d.member_count||0,resource_type:d.chat_type||d.resource_type||"group",activity_score:.5,relevance_score:.6,overall_score:.6,status:"discovered",discovery_source:"jiso",discovery_keyword:this.currentSearchKeyword(),created_at:new Date().toISOString(),invite_link:f,link:f||(u?`https://t.me/${u}`:""),is_saved:!1,can_join:!!(f||u)}});if(l.length>0){let d=[...s,...l];this.discoveredResources.set(d),console.log(`[Search] \u5DF2\u5408\u4F75 ${l.length} \u500B\u65B0\u7D50\u679C`);let u=this.currentSearchKeyword();if(u&&d.length>0){let f=this.generateSearchCacheKey(u,this.selectedSearchSources());this.setSearchCache(f,d)}}}this.refreshResourceStats()}else if(n.error){let t=n.error,i=[],o="";t.includes("Username not found")||t.includes("\u4E0D\u53EF\u7528")?(i=["\u641C\u7D22\u6A5F\u5668\u4EBA\u9996\u6B21\u4F7F\u7528\u9700\u8981\u6FC0\u6D3B","\u8ACB\u5728 Telegram \u4E2D\u6253\u958B @smss \u4E26\u767C\u9001 /start","\u6216\u8005\u6253\u958B @jisou3 \u4E26\u767C\u9001 /start","\u6FC0\u6D3B\u5F8C\u91CD\u65B0\u641C\u7D22"],o="\u641C\u7D22\u6A5F\u5668\u4EBA\u5C1A\u672A\u6FC0\u6D3B"):t.includes("FloodWait")||t.includes("\u9650\u5236")?(i=["\u7B49\u5F85\u5E7E\u5206\u9418\u5F8C\u91CD\u8A66","\u6E1B\u5C11\u641C\u7D22\u983B\u7387","\u4F7F\u7528\u5176\u4ED6\u5E33\u865F\u641C\u7D22"],o="Telegram \u8ACB\u6C42\u983B\u7387\u9650\u5236"):t.includes("\u6CA1\u6709\u53EF\u7528")?(i=["\u6AA2\u67E5\u5E33\u865F\u662F\u5426\u5DF2\u767B\u9304","\u78BA\u4FDD\u81F3\u5C11\u6709\u4E00\u500B\u5E33\u865F\u5728\u7DDA"],o="\u6C92\u6709\u53EF\u7528\u5E33\u865F"):i=["\u91CD\u8A66\u641C\u7D22","\u4F7F\u7528\u4E0D\u540C\u95DC\u9375\u8A5E"],this.searchError.set({hasError:!0,message:t,details:o,suggestions:i}),this.toastService.error(`\u6781\u641C\u5931\u6557: ${o||t}`)}let e=this.selectedSearchSources();e.length===1&&e[0]==="jiso"&&(this.isSearchingResources.set(!1),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null))}),this.ipcService.on("jiso-search-progress",n=>{n.status==="searching"?console.log(`[Search] \u6781\u641C\uFF1A${n.message}`):n.status==="waiting"&&console.log(`[Search] \u6781\u641C\u7B49\u5F85\uFF1A${n.message}`)}),this.ipcService.on("search-channels-list",n=>{n.success&&(this.systemChannels.set(n.system_channels||[]),this.customChannels.set(n.custom_channels||[]))}),this.ipcService.on("search-channel-added",n=>{n.success?(this.toastService.success(`\u2705 \u5DF2\u6DFB\u52A0\u6E20\u9053 @${n.botUsername}`),this.showAddChannelDialog.set(!1),this.loadSearchChannels()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${n.error}`)}),this.ipcService.on("search-channel-updated",n=>{n.success?(this.toastService.success("\u2705 \u6E20\u9053\u5DF2\u66F4\u65B0"),this.loadSearchChannels()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${n.error}`)}),this.ipcService.on("search-channel-deleted",n=>{n.success?(this.toastService.success("\u{1F5D1}\uFE0F \u6E20\u9053\u5DF2\u522A\u9664"),this.loadSearchChannels()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${n.error}`)}),this.ipcService.on("search-channel-tested",n=>{this.isTestingChannel.set(!1),n.success?(this.toastService.success(`\u2705 @${n.botUsername} \u6E2C\u8A66\u6210\u529F (${n.responseTime?.toFixed(1)}s)`),this.loadSearchChannels()):(this.toastService.warning(`\u274C @${n.botUsername} \u6E2C\u8A66\u5931\u6557: ${n.error}`),this.loadSearchChannels())}),this.ipcService.on("resources-list",n=>{if(this.isInSearchResultMode()){console.log("[\u8CC7\u6E90\u4E2D\u5FC3] \u5FFD\u7565 resources-list\uFF0C\u7576\u524D\u8655\u65BC\u641C\u7D22\u7D50\u679C\u6A21\u5F0F");return}if(n.success&&n.resources){this.discoveredResources.set(n.resources);let e=n.resources.filter(t=>!t.type_verified&&t.username);if(e.length>0){let i=e.slice(0,10).map(o=>o.id);this.ipcService.send("batch-verify-resource-types",{resourceIds:i})}}}),this.ipcService.on("resource-stats",n=>{n.success&&(this.resourceStats.set({total_resources:n.total_resources||0,by_status:n.by_status||{},by_type:n.by_type||{},today_discovered:n.today_discovered||0,pending_joins:n.pending_joins||0,joined_count:n.joined_count||0,avg_score:n.avg_score||0}),n.total_resources&&n.total_resources>0&&this.resourceDiscoveryInitialized.set(!0))}),this.ipcService.on("resource-added",n=>{n.success?(this.toastService.success("\u2705 \u8CC7\u6E90\u5DF2\u6DFB\u52A0"),this.showAddResourceDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${n.error}`)}),this.ipcService.on("resource-type-verified",n=>{n.success?(n.oldType!==n.newType?this.toastService.success(`\u2705 \u985E\u578B\u5DF2\u66F4\u65B0: ${n.oldType} \u2192 ${n.newType}`):this.toastService.info(`\u{1F4CB} \u985E\u578B\u78BA\u8A8D: ${n.newType}`),this.loadResources()):this.toastService.error(`\u9A57\u8B49\u5931\u6557: ${n.error}`)}),this.ipcService.on("resources-types-verified",n=>{n.success&&n.count&&n.count>0&&this.loadResources()}),this.ipcService.on("resource-deleted",n=>{n.success?(this.toastService.success("\u{1F5D1}\uFE0F \u8CC7\u6E90\u5DF2\u522A\u9664"),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${n.error}`)}),this.ipcService.on("leave-group-complete",n=>{n.success?(this.toastService.success("\u{1F6AA} \u5DF2\u9000\u51FA\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):this.toastService.error(`\u9000\u51FA\u7FA4\u7D44\u5931\u6557: ${n.error}`)}),this.ipcService.on("remove-group-result",n=>{n.success?(this.toastService.success("\u2705 \u5DF2\u505C\u6B62\u76E3\u63A7\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):(this.toastService.error(`\u505C\u6B62\u76E3\u63A7\u5931\u6557: ${n.error||"\u672A\u77E5\u932F\u8AA4"}`),this.loadResources())}),this.ipcService.on("join-queue-updated",n=>{n.success?(this.toastService.success(`\u{1F4CB} \u5DF2\u6DFB\u52A0 ${n.added} \u500B\u8CC7\u6E90\u5230\u52A0\u5165\u968A\u5217`),this.refreshResourceStats(),this.selectedResourceIds.set([])):this.toastService.error(`\u6DFB\u52A0\u5230\u968A\u5217\u5931\u6557: ${n.error}`)}),this.ipcService.on("join-queue-processed",n=>{this.isProcessingJoinQueue.set(!1),n.success?(this.toastService.success(`\u{1F680} \u8655\u7406\u5B8C\u6210\uFF1A\u6210\u529F ${n.successCount}\uFF0C\u5931\u6557 ${n.failed}`),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u8655\u7406\u5931\u6557: ${n.error}`)}),this.ipcService.on("batch-join-started",n=>{n.success&&this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${n.count} \u500B\u8CC7\u6E90`)}),this.ipcService.on("batch-join-complete",n=>{n.success&&(this.toastService.success(`\u2705 \u6279\u91CF\u52A0\u5165\u5B8C\u6210\uFF1A\u6210\u529F ${n.successCount}\uFF0C\u5931\u6557 ${n.failed}\uFF0C\u8DF3\u904E ${n.skipped}`),this.loadResources(),this.refreshResourceStats())}),this.ipcService.on("join-and-monitor-complete",n=>{this.isJoiningResource.set(!1),n.success?(this.toastService.success("\u2705 \u5DF2\u52A0\u5165\u4E26\u6DFB\u52A0\u5230\u76E3\u63A7"),this.showJoinMonitorDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u52A0\u5165\u5931\u6557: ${n.error}`)}),this.ipcService.on("join-and-monitor-with-account-complete",n=>{if(this.isJoiningResource.set(!1),n.success){let e=this.joinMonitorSelectedKeywordSetIds().length,t=this.joinMonitorResource(),i=n.status==="pending_approval"?"pending_approval":"joined";this.updateResourceStatusLocally(t,i,n.phone,n.memberCount),n.status==="pending_approval"?(this.toastService.info(`\u{1F4E8} \u52A0\u5165\u8ACB\u6C42\u5DF2\u767C\u9001\uFF0C\u7B49\u5F85\u7BA1\u7406\u54E1\u6279\u51C6
\u5E33\u865F: ${n.phone}`,5e3),this.showJoinMonitorDialog.set(!1)):this.showPostJoinOptions(t,n.phone,e),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")}else{let e=n.error||"\u672A\u77E5\u932F\u8AA4";e.includes("\u7F3A\u5C11\u52A0\u5165\u65B9\u5F0F")||e.includes("username")?this.toastService.error(`\u274C \u7121\u6CD5\u52A0\u5165\uFF1A\u6B64\u7FA4\u7D44\u6C92\u6709\u63D0\u4F9B\u6709\u6548\u7684\u52A0\u5165\u93C8\u63A5
\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5`,6e3):this.toastService.error(`\u274C \u52A0\u5165\u5931\u6557: ${e}`,5e3)}}),this.ipcService.on("batch-join-and-monitor-complete",n=>{if(this.isJoiningResource.set(!1),this.closeBatchJoinMonitorDialog(),n.success){let e=this.joinMonitorSelectedKeywordSetIds().length,t=e>0?`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${n.successCount}\uFF0C\u5931\u6557 ${n.failed}\uFF0C\u5DF2\u7D81\u5B9A ${e} \u500B\u95DC\u9375\u8A5E\u96C6`:`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${n.successCount}\uFF0C\u5931\u6557 ${n.failed}`;this.toastService.success(t),this.loadResources(),this.refreshResourceStats(),this.selectedResourceIds.set([]),this.ipcService.send("get-monitored-groups")}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${n.error}`)}),this.ipcService.on("members-extraction-progress",n=>{let e=n.message||n.status;this.memberListProgress.set({extracted:n.extracted,total:n.total,status:e})}),this.ipcService.on("members-extracted",n=>{if(this.memberListLoading.set(!1),n.success&&n.members){let e=new Set(this.memberListData().map(i=>i.user_id)),t=n.members.filter(i=>!e.has(i.user_id));if(this.memberListData.update(i=>[...i,...t]),this.memberListProgress.update(i=>N(M({},i),{extracted:this.memberListData().length,status:`\u5DF2\u63D0\u53D6 ${this.memberListData().length} \u500B\u6210\u54E1`})),n.syncStats){let i=n.syncStats;i.new&&i.new>0&&this.toastService.success(`\u{1F4CA} \u8CC7\u6E90\u4E2D\u5FC3\u540C\u6B65\uFF1A\u65B0\u589E ${i.new} \u500B\u806F\u7E6B\u4EBA`+(i.updated?`\uFF0C\u66F4\u65B0 ${i.updated} \u500B`:""),5e3)}if(n.lastExtraction?.lastCount){let i=n.lastExtraction,o=(n.members?.length||0)-(i.lastCount||0);o>0?this.toastService.info(`\u{1F4C8} \u6BD4\u4E0A\u6B21\u591A\u63D0\u53D6 ${o} \u4EBA`,4e3):o<0&&this.toastService.info(`\u{1F4C9} \u6BD4\u4E0A\u6B21\u5C11 ${Math.abs(o)} \u4EBA\uFF08\u53EF\u80FD\u6709\u6210\u54E1\u9000\u7FA4\uFF09`,4e3)}if(t.length>0?this.calculateAndShowExtractionSummary(t):this.toastService.info("\u6C92\u6709\u66F4\u591A\u65B0\u6210\u54E1"),n.insights?.recommendations?.length&&setTimeout(()=>{for(let i of n.insights.recommendations.slice(0,3))this.toastService.info(i,6e3)},2e3),n.dailyQuota){let i=n.dailyQuota,o=Math.round((i.used||0)/(i.limit||5e3)*100);o>=90?this.toastService.warning(`\u26A0\uFE0F \u4ECA\u65E5\u63D0\u53D6\u914D\u984D\u5373\u5C07\u7528\u5B8C\uFF1A${i.used}/${i.limit} (${o}%)`,8e3):o>=70&&this.toastService.info(`\u{1F4CA} \u4ECA\u65E5\u63D0\u53D6\u914D\u984D\uFF1A${i.used}/${i.limit} (\u5269\u9918 ${i.remaining})`,5e3)}if(n.limit_warning){let i=n.limit_warning;this.toastService.warning(`\u26A0\uFE0F \u6B64\u7FA4\u7D44\u6709 ${(i.total_in_group||0).toLocaleString()} \u6210\u54E1\uFF0CTelegram \u9650\u5236\u6700\u591A\u63D0\u53D6 ${(i.api_limit||1e4).toLocaleString()}\u3002\u53EF\u4F7F\u7528\u300C\u63D0\u53D6\u6D3B\u8E8D\u7528\u6236\u300D\u5F9E\u6D88\u606F\u6B77\u53F2\u4E2D\u88DC\u5145\u767C\u73FE\u66F4\u591A\u7528\u6236\u3002`,1e4),n.resourceId&&setTimeout(()=>{this.ipcService.send("extract-active-users",{resourceId:n.resourceId,telegramId:n.telegramId,messageLimit:2e3}),this.toastService.info("\u{1F4CA} \u6B63\u5728\u5F9E\u6D88\u606F\u6B77\u53F2\u4E2D\u88DC\u5145\u63D0\u53D6\u6D3B\u8E8D\u7528\u6236...",5e3)},2e3)}}else n.error&&this.handleMemberExtractionError(n)}),this.ipcService.on("active-users-extracted",n=>{if(n.success){let e=n.new_members||0;if(e>0){if(this.toastService.success(`\u{1F4CA} \u6D3B\u8E8D\u7528\u6236\u63D0\u53D6\u5B8C\u6210\uFF1A\u6383\u63CF ${n.messages_scanned} \u689D\u6D88\u606F\uFF0C\u767C\u73FE ${n.unique_users} \u7528\u6236 (\u65B0\u589E ${e})`,6e3),n.members){let t=new Set(this.memberListData().map(o=>o.user_id)),i=n.members.filter(o=>!t.has(o.user_id));i.length>0&&this.memberListData.update(o=>[...o,...i])}}else this.toastService.info(`\u{1F4CA} \u6D88\u606F\u6B77\u53F2\u4E2D\u672A\u767C\u73FE\u65B0\u7528\u6236 (\u6383\u63CF ${n.messages_scanned} \u689D\u6D88\u606F)`)}else n.error&&this.toastService.warning(`\u6D3B\u8E8D\u7528\u6236\u63D0\u53D6\u5931\u6557: ${n.error}`)}),this.ipcService.on("batch-extraction-progress",n=>{n.status==="extracting"&&n.currentGroup&&this.toastService.info(`\u{1F4E6} [${n.currentIndex||n.completed+1}/${n.totalGroups}] \u6B63\u5728\u63D0\u53D6: ${n.currentGroup}`,3e3)}),this.ipcService.on("batch-members-extracted",n=>{if(n.success||n.completed&&n.completed>0){let e=n.failed?`\uFF0C${n.failed} \u500B\u5931\u6557`:"";this.toastService.success(`\u2705 \u6279\u91CF\u63D0\u53D6\u5B8C\u6210\uFF1A${n.completed}/${n.totalGroups} \u500B\u7FA4\u7D44\u6210\u529F${e}\uFF0C\u5171 ${n.totalMembers||0} \u500B\u6210\u54E1`,8e3),this.loadResources(),this.refreshResourceStats()}else this.toastService.error(`\u6279\u91CF\u63D0\u53D6\u5931\u6557: ${n.error}`)}),this.ipcService.on("group-message-sent",n=>{n.success?this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001\u5230\u7FA4\u7D44"):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${n.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("message-queued",n=>{console.log("[Frontend] Message queued:",n),this.toastService.info("\u{1F4E4} \u6D88\u606F\u5DF2\u52A0\u5165\u767C\u9001\u968A\u5217")}),this.ipcService.on("message-sent",n=>{console.log("[Frontend] Message sent result:",n),n.success?(this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001"),this.closeLeadDetailModal(),this.ipcService.send("get-leads",{})):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${n.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("link-analysis-complete",n=>{this.isAnalyzingLink.set(!1),n.success?n.isPrivate?this.toastService.warning(n.message||"\u9019\u662F\u79C1\u6709\u93C8\u63A5"):(this.toastService.success("\u2705 \u5206\u6790\u5B8C\u6210"),console.log("Link analysis result:",n)):this.toastService.error(`\u5206\u6790\u5931\u6557: ${n.error}`)})}function rd(){this.ipcService.on("ollama-models",n=>{n.success&&n.models?(this.availableOllamaModels.set(n.models),this.toastService.success(`\u627E\u5230 ${n.models.length} \u500B\u6A21\u578B`)):n.error&&this.toastService.error(`\u7372\u53D6\u6A21\u578B\u5217\u8868\u5931\u6557: ${n.error}`)}),this.ipcService.on("local-ai-test-result",n=>{this.isTestingLocalAi.set(!1),n.success?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success(n.message||"\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(n.error||"\u9023\u63A5\u5931\u6557"),this.toastService.error(n.error||"\u9023\u63A5\u5931\u6557"))}),this.ipcService.on("first-run-status",n=>{this.isFirstRun.set(n.isFirstRun),n.isFirstRun&&(console.log("[App] \u9996\u6B21\u904B\u884C\uFF0C\u5F8C\u53F0\u975C\u9ED8\u914D\u7F6E AI\uFF08\u4E0D\u5F37\u5236\u986F\u793A\u5411\u5C0E\uFF09"),setTimeout(()=>this.detectOllama(),1e3))}),this.ipcService.on("backend-status",n=>{console.log("[App] Backend status:",n),this.backendRunning.set(n.running),!n.running&&n.error&&(this.backendError.set(n.error),this.showBackendErrorDialog.set(!0),this.toastService.error("\u274C Python \u5F8C\u7AEF\u672A\u904B\u884C\uFF0C\u90E8\u5206\u529F\u80FD\u7121\u6CD5\u4F7F\u7528"))}),this.ipcService.on("ollama-detected",n=>{if(this.isDetectingOllama.set(!1),n.success&&(this.ollamaDetected.set(n.available||!1),n.models&&n.models.length>0)){this.detectedOllamaModels.set(n.models);let t=["qwen2:7b","qwen:7b","llama3:8b","mistral:7b"].find(i=>n.models.some(o=>o.includes(i.split(":")[0])))||n.models[0];this.autoSelectedModel.set(t),this.localAiModel.set(t)}}),this.ipcService.on("first-run-settings-saved",n=>{n.success?console.log("[App] \u9996\u6B21\u8A2D\u7F6E\u5DF2\u4FDD\u5B58"):console.error("[App] \u9996\u6B21\u8A2D\u7F6E\u4FDD\u5B58\u5931\u6557:",n.error)}),this.ipcService.on("discovery-keywords",n=>{n.success&&n.keywords&&this.discoveryKeywords.set(n.keywords)}),this.ipcService.on("discovery-keyword-added",n=>{n.success?(this.toastService.success(`\u2795 \u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0: ${n.keyword}`),this.showAddKeywordDialog.set(!1),this.newResourceKeyword="",this.loadDiscoveryKeywords()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${n.error}`)}),this.ipcService.on("discussion-watcher-initialized",n=>{n.success?(this.discussionWatcherInitialized.set(!0),this.toastService.success("\u2705 \u8A0E\u8AD6\u7D44\u76E3\u63A7\u670D\u52D9\u5DF2\u521D\u59CB\u5316"),this.loadChannelDiscussions(),this.refreshDiscussionStats()):this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${n.error}`)}),this.ipcService.on("discussion-discovered",n=>{n.success&&n.discussion?(this.toastService.success(`\u2705 \u767C\u73FE\u8A0E\u8AD6\u7D44: ${n.discussion.discussion_title}`),this.loadChannelDiscussions()):this.toastService.error(n.error||"\u672A\u627E\u5230\u8A0E\u8AD6\u7D44")}),this.ipcService.on("discussions-batch-discovered",n=>{n.success?(this.toastService.success(`\u2705 \u767C\u73FE\u4E86 ${n.count} \u500B\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u767C\u73FE\u5931\u6557: ${n.error}`)}),this.ipcService.on("channel-discussions-list",n=>{n.success&&n.discussions&&this.channelDiscussions.set(n.discussions)}),this.ipcService.on("discussion-monitoring-status",n=>{n.success?(this.toastService.success(`${n.status==="monitoring"?"\u{1F7E2} \u958B\u59CB":"\u{1F534} \u505C\u6B62"}\u76E3\u63A7\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u64CD\u4F5C\u5931\u6557: ${n.error}`)}),this.ipcService.on("discussion-messages",n=>{this.isLoadingDiscussionMessages.set(!1),n.success&&n.messages?this.discussionMessages.set(n.messages):(this.toastService.error(n.error||"\u52A0\u8F7D\u6D88\u606F\u5931\u8D25"),this.discussionMessages.set([]))}),this.ipcService.on("discussion-message",n=>{n.is_matched&&this.toastService.info(`\u{1F3AF} \u95DC\u9375\u8A5E\u5339\u914D: @${n.username} - ${n.keywords.join(", ")}`)}),this.ipcService.on("discussion-lead-captured",n=>{this.toastService.success(`\u{1F464} \u65B0\u6F5B\u5728\u5BA2\u6236: @${n.username}`),this.refreshDiscussionStats()}),this.ipcService.on("discussion-reply-result",n=>{n.success?(this.toastService.success("\u2705 \u56DE\u5FA9\u5DF2\u767C\u9001"),this.selectedDiscussionId()&&this.loadDiscussionMessages(this.selectedDiscussionId())):this.toastService.error(`\u56DE\u5FA9\u5931\u6557: ${n.error}`)}),this.ipcService.on("discussion-stats",n=>{n.success&&(this.discussionStats.set({total_discussions:n.total_discussions||0,monitoring_count:n.monitoring_count||0,total_messages:n.total_messages||0,matched_messages:n.matched_messages||0,leads_from_discussions:n.leads_from_discussions||0,today_messages:n.today_messages||0,today_leads:n.today_leads||0}),n.total_discussions>0&&this.discussionWatcherInitialized.set(!0))}),this.ipcService.on("chat-list",n=>{n.success&&n.chats?this.chatList.set(n.chats):console.error("[Frontend] Chat list error:",n.error)}),this.ipcService.on("chat-history-full",n=>{if(console.log("[Frontend] Received chat-history-full event:",n),n.success&&n.messages){let e=this.chatHistoryPage();if(e===0)this.chatHistoryAllMessages.set(n.messages),this.chatHistory.set(n.messages),console.log("[Frontend] Loaded first page:",n.messages.length,"messages");else{let i=[...this.chatHistoryAllMessages(),...n.messages];this.chatHistoryAllMessages.set(i),this.chatHistory.set(i),console.log("[Frontend] Loaded page",e,":",n.messages.length,"messages, total:",i.length)}this.chatHistoryHasMore.set(n.hasMore||!1),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1),console.log("[Frontend] Chat history loaded. Has more:",n.hasMore,"Total:",n.total)}else console.error("[Frontend] Chat history error:",n.error),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}),this.ipcService.on("chat-message-received",n=>{this.selectedChatUserId()===n.userId&&this.loadChatHistory(n.userId),this.loadChatList()}),this.ipcService.on("ai-response-generated",n=>{this.selectedChatUserId()===n.userId&&this.loadChatHistory(n.userId)}),this.ipcService.on("monitoring-status",n=>{n.success&&console.log("[Frontend] Monitoring status:",n)}),this.ipcService.on("monitoring-health",n=>{n.success&&(n.issues&&n.issues.length>0&&console.warn("[Frontend] Monitoring issues:",n.issues),n.warnings&&n.warnings.length>0&&console.warn("[Frontend] Monitoring warnings:",n.warnings))}),this.ipcService.on("alerts-loaded",n=>{let e=n.alerts.map(t=>N(M({},t),{timestamp:new Date(t.timestamp).toISOString(),acknowledged_at:t.acknowledged_at?new Date(t.acknowledged_at).toISOString():void 0,resolved_at:t.resolved_at?new Date(t.resolved_at).toISOString():void 0}));this.alerts.set(e)})}function ad(){td.call(this),nd.call(this),id.call(this),od.call(this),sd.call(this),rd.call(this)}var Lr=class{constructor(){this.searchTimeout=null}initRagSystem(){this.isInitializingRag.set(!0),this.ipcService.send("init-rag-system",{})}triggerRagLearning(){this.isRagLearning.set(!0),this.ipcService.send("trigger-rag-learning",{})}reindexHighValueConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30})}cleanupRagKnowledge(){this.isCleaningRag.set(!0),this.ipcService.send("cleanup-rag-knowledge",{minScore:.2,daysOld:30,mergeSimilar:!0})}reindexConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30}),this.toastService.info("\u958B\u59CB\u91CD\u5EFA\u7D22\u5F15...")}refreshRagStats(){this.ipcService.send("get-rag-stats",{})}searchRagKnowledge(){this.ragSearchQuery.trim()&&(this.isSearchingRag.set(!0),this.ipcService.send("search-rag",{query:this.ragSearchQuery,limit:10}))}sendRagFeedback(e,t){this.ipcService.send("rag-feedback",{knowledgeId:e,isPositive:t}),this.toastService.info(t?"\u{1F44D} \u611F\u8B1D\u53CD\u994B\uFF01":"\u{1F44E} \u5DF2\u8A18\u9304\u53CD\u994B")}addRagKnowledge(){if(!this.newRagKnowledge.answer.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u56DE\u7B54\u5167\u5BB9");return}this.ipcService.send("add-rag-knowledge",{type:this.newRagKnowledge.type,question:this.newRagKnowledge.question,answer:this.newRagKnowledge.answer,context:this.newRagKnowledge.context}),this.newRagKnowledge={type:"qa",question:"",answer:"",context:""},this.showAddRagKnowledgeDialog.set(!1)}searchVectorMemory(){this.vectorMemorySearchQuery.trim()&&(this.isSearchingMemory.set(!0),this.ipcService.send("search-vector-memories",{userId:this.selectedMemoryUserId()||"",query:this.vectorMemorySearchQuery,limit:10}))}addVectorMemory(){if(!this.newMemory.content.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u8A18\u61B6\u5167\u5BB9");return}this.isAddingMemory.set(!0),this.ipcService.send("add-vector-memory",{userId:this.newMemory.userId||"manual",content:this.newMemory.content,type:this.newMemory.type,importance:this.newMemory.importance})}refreshMemoryStats(){this.ipcService.send("get-memory-stats",{userId:""})}deleteVectorMemory(e){this.ipcService.send("delete-vector-memory",{memoryId:e})}loadMemoryUserList(){this.ipcService.send("get-memory-user-list",{})}cleanupOldMemories(){this.ipcService.send("cleanup-old-memories",{daysOld:90})}mergeSimilarMemories(){let e=this.selectedMemoryUserId();if(!e){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("merge-similar-memories",{userId:e,threshold:.85})}getResourceDiscoveryAccounts(){return this.accounts().filter(t=>t.status==="Online").sort((t,i)=>{let o={Explorer:1,Listener:2,Sender:3,AI:4,Backup:5,Unassigned:6};return(o[t.role]||99)-(o[i.role]||99)})}getSelectedResourceAccount(){let e=this.resourceAccountId();if(e)return this.accounts().find(i=>i.id===e)||null;let t=this.getResourceDiscoveryAccounts();return t.length>0?t[0]:null}selectResourceAccount(e){this.resourceAccountId.set(e);let t=this.accounts().find(i=>i.id===e);t&&this.toastService.success(`\u8CC7\u6E90\u767C\u73FE\u5C07\u4F7F\u7528: ${t.phone}`),this.showResourceAccountSelector.set(!1)}getRoleDisplayName(e){return{Explorer:"\u{1F50D} \u63A2\u7D22\u865F",Listener:"\u{1F441}\uFE0F \u76E3\u63A7\u865F",Sender:"\u{1F4E4} \u767C\u9001\u865F",AI:"\u{1F916} AI\u865F",Backup:"\u26A1 \u5099\u7528\u865F",Unassigned:"\u2B55 \u672A\u5206\u914D"}[e]||"\u2B55 \u672A\u5206\u914D"}initResourceDiscovery(){let e=this.getSelectedResourceAccount();if(!e){this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.toastService.info(`\u6B63\u5728\u4F7F\u7528 ${e.phone} \u521D\u59CB\u5316\u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71...`),this.ipcService.send("init-resource-discovery",{accountId:e.id,phone:e.phone})}autoInitResourceDiscovery(){this.resourceDiscoveryInitialized()||this.initResourceDiscovery(),this.refreshResourceStats(),this.loadDiscoveryKeywords()}generateSearchSessionId(){return`search_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}generateSearchCacheKey(e,t){let i=e.toLowerCase().trim(),o=[...t].sort().join(",");return`${i}|${o}`}getSearchCache(e){let t=this.searchResultsCache.get(e);return t?Date.now()-t.timestamp>this.CACHE_EXPIRY_MS?(this.searchResultsCache.delete(e),null):t.results:null}setSearchCache(e,t){if(this.searchResultsCache.size>20){let i=Array.from(this.searchResultsCache.entries());i.sort((s,r)=>s[1].timestamp-r[1].timestamp),i.slice(0,i.length-20).forEach(([s])=>this.searchResultsCache.delete(s))}this.searchResultsCache.set(e,{results:[...t],timestamp:Date.now()}),console.log(`[Search Cache] \u5DF2\u7DE9\u5B58\u641C\u7D22\u7D50\u679C: "${e}" (${t.length} \u689D)`)}clearSearchCache(){this.searchResultsCache.clear(),console.log("[Search Cache] \u5DF2\u6E05\u9664\u6240\u6709\u7DE9\u5B58")}searchResources(){if(!this.resourceSearchQuery.trim()){this.toastService.error(this.t("searchPlaceholder"));return}if(this.selectedSearchSources().length===0){this.toastService.error("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u641C\u7D22\u6E20\u9053");return}if(this.getOnlineAccountsCount()===0){this.toastService.error("\u8ACB\u5148\u767B\u9304\u5E33\u865F");return}let e=this.resourceSearchQuery.trim(),t=this.selectedSearchSources(),i=this.generateSearchCacheKey(e,t),o=this.getSearchCache(i);if(o){console.log(`[Search Cache] \u4F7F\u7528\u7DE9\u5B58\u7D50\u679C: "${e}" (${o.length} \u689D)`),this.currentSearchKeyword.set(e),this.discoveredResources.set(o),this.showSearchHistory.set(!1);let u=this.searchHistoryKeywords(),f=[e,...u.filter(C=>C!==e)].slice(0,10);this.searchHistoryKeywords.set(f);return}let s=this.generateSearchSessionId();this.currentSearchSessionId.set(s),this.currentSearchKeyword.set(e),this.showSearchHistory.set(!1);let r=this.searchHistoryKeywords(),l=[e,...r.filter(u=>u!==e)].slice(0,10);this.searchHistoryKeywords.set(l),this.discoveredResources.set([]);let d=e.split(/[,;]/).map(u=>u.trim()).filter(u=>u.length>0);d.length>1?(console.log(`[Search] \u6B63\u5728\u641C\u7D22 ${d.length} \u4E2A\u5173\u952E\u8BCD...`),this.searchMultipleKeywords(d)):(this.isSearchingResources.set(!0),this.searchError.set({hasError:!1,message:"",details:"",suggestions:[]}),console.log(`[Search] \u6B63\u5728\u641C\u7D22 "${e}"...`),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u7A0D\u540E\u518D\u8BD5"))},7e4),this.executeMultiSourceSearch(e,t))}executeMultiSourceSearch(e,t){let i=this.getSelectedResourceAccount()?.phone,o=this.currentSearchSessionId();(t.includes("telegram")||t.includes("local"))&&this.ipcService.send("search-resources",{query:e,phone:i,sources:t.filter(s=>s!=="jiso"),limit:50,searchType:this.resourceSearchType(),minMembers:this.resourceMinMembers(),replaceMode:!0,searchSessionId:o,searchKeyword:e}),t.includes("jiso")&&(console.log("[Search] \u6B63\u5728\u901A\u8FC7\u6781\u641C Bot \u641C\u7D22..."),this.ipcService.send("search-jiso",{keyword:e,phone:i,limit:50,searchSessionId:o,searchKeyword:e})),t.includes("tgstat")}searchMultipleKeywords(e){this.isSearchingResources.set(!0);let t=this.selectedSearchSources();this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6"))},e.length*1e4+3e4),e.forEach((i,o)=>{setTimeout(()=>{this.executeMultiSourceSearch(i,t)},o*5e3)})}openTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link;t?this.ipcService.send("open-external-link",{url:t}):this.toastService.warning("\u6B64\u7FA4\u7D44\u6C92\u6709\u516C\u958B\u93C8\u63A5")}copyTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||"";t?(navigator.clipboard.writeText(t),this.toastService.success("\u93C8\u63A5\u5DF2\u8907\u88FD")):(navigator.clipboard.writeText(e.title),this.toastService.warning("\u6B64\u7FA4\u7D44\u7121\u516C\u958B\u93C8\u63A5\uFF0C\u5DF2\u8907\u88FD\u7FA4\u7D44\u540D\u7A31\uFF0C\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u641C\u7D22"))}copyUsername(e){let t=`@${e}`;navigator.clipboard.writeText(t),this.toastService.success("\u5DF2\u8907\u88FD "+t)}getResourceTypeIcon(e){switch(e){case"channel":return"\u{1F4E2}";case"supergroup":return"\u{1F465}";case"group":return"\u{1F4AC}";default:return"\u{1F4CC}"}}getResourceTypeLabel(e){switch(e){case"channel":return"\u983B\u9053";case"supergroup":return"\u8D85\u7D1A\u7FA4\u7D44";case"group":return"\u7FA4\u7D44";default:return"\u672A\u77E5"}}formatMemberCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}quickJoinResource(e){this.ipcService.send("batch-join-resources",{resourceIds:[e]}),this.toastService.info("\u6B63\u5728\u5617\u8A66\u52A0\u5165...")}loadResources(){this.ipcService.send("get-resources",{status:this.resourceFilterStatus()||void 0,type:this.resourceFilterType()||void 0,limit:100,offset:0})}filterResourcesByLink(){let e=this.resourceFilterLink();if(!e){this.loadResources();return}let i=this.discoveredResources().filter(o=>{let s=!!(o.username||o.invite_link);return e==="has_link"?s:e==="no_link"?!s:!0});this.discoveredResources.set(i)}refreshResourceStats(){this.ipcService.send("get-resource-stats",{})}openChannelManageDialog(){this.loadSearchChannels(),this.showChannelManageDialog.set(!0)}closeChannelManageDialog(){this.showChannelManageDialog.set(!1)}loadSearchChannels(){this.ipcService.send("get-search-channels",{})}openAddChannelDialog(){this.newChannelUsername="",this.newChannelDisplayName="",this.newChannelQueryFormat="{keyword}",this.newChannelPriority="backup",this.newChannelNotes="",this.showAddChannelDialog.set(!0)}closeAddChannelDialog(){this.showAddChannelDialog.set(!1)}addSearchChannel(){if(!this.newChannelUsername.trim()){this.toastService.error("\u8ACB\u8F38\u5165 Bot \u7528\u6236\u540D");return}this.ipcService.send("add-search-channel",{botUsername:this.newChannelUsername.trim(),displayName:this.newChannelDisplayName.trim()||this.newChannelUsername.trim(),queryFormat:this.newChannelQueryFormat,priority:this.newChannelPriority,notes:this.newChannelNotes})}deleteSearchChannel(e){if(e<0){this.toastService.warning("\u7121\u6CD5\u522A\u9664\u7CFB\u7D71\u6E20\u9053");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u500B\u641C\u7D22\u6E20\u9053\u55CE\uFF1F")&&this.ipcService.send("delete-search-channel",{channelId:e})}testSearchChannel(e){this.isTestingChannel.set(!0),this.toastService.info(`\u6B63\u5728\u6E2C\u8A66 @${e}...`),this.ipcService.send("test-search-channel",{botUsername:e})}toggleChannelEnabled(e,t){if(e<0){this.toastService.warning("\u7121\u6CD5\u4FEE\u6539\u7CFB\u7D71\u6E20\u9053");return}this.ipcService.send("update-search-channel",{channelId:e,enabled:!t})}getChannelStatusColor(e){switch(e){case"online":return"text-green-400";case"offline":return"text-red-400";case"captcha":return"text-yellow-400";default:return"text-gray-400"}}getChannelStatusIcon(e){switch(e){case"online":return"\u{1F7E2}";case"offline":return"\u{1F534}";case"captcha":return"\u{1F7E1}";default:return"\u26AA"}}openJoinAndMonitorDialog(e){this.joinMonitorResource.set(e),this.joinMonitorKeywords.set([]),this.joinMonitorNewKeyword="",this.joinMonitorAutoEnable.set(!0),this.loadAccountQuotas(),e.joined_by_phone?this.joinMonitorSelectedPhone.set(e.joined_by_phone):this.joinMonitorSelectedPhone.set("");let t=this.monitoredGroups().find(i=>i.url===e.username||i.url===`@${e.username}`||i.url===e.telegram_id||i.id===e.id);t&&t.keywordSetIds?this.joinMonitorSelectedKeywordSetIds.set([...t.keywordSetIds]):this.joinMonitorSelectedKeywordSetIds.set([]),this.showQuickCreateKeywordSet.set(!1),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword="",this.showJoinMonitorDialog.set(!0)}closeJoinMonitorDialog(){this.showJoinMonitorDialog.set(!1),this.joinMonitorResource.set(null),this.showChangeMonitorAccount.set(!1)}getAvailableAccountsForMonitor(){return this.accounts().filter(e=>e.status==="Online")}selectMonitorAccount(e){this.joinMonitorSelectedPhone.set(e),this.showChangeMonitorAccount.set(!1)}stopMonitoringGroup(e){if(!e)return;let t=e.telegram_id||e.id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u8B58\u5225\u7FA4\u7D44");return}this.ipcService.send("remove-group",{groupId:t,id:e.id,telegramId:e.telegram_id,username:e.username,link:e.link||e.invite_link}),this.updateResourceStatusLocally(e,"joined"),this.closeJoinMonitorDialog(),this.closeResourceMenu(),this.toastService.info("\u6B63\u5728\u505C\u6B62\u76E3\u63A7..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},500)}confirmLeaveGroup(e){if(!e)return;let t=e.title||e.username||"\u6B64\u7FA4\u7D44";confirm(`\u78BA\u5B9A\u8981\u9000\u51FA\u300C${t}\u300D\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\uFF1A
\u2022 \u5F9E Telegram \u9000\u51FA\u7FA4\u7D44
\u2022 \u505C\u6B62\u6240\u6709\u76E3\u63A7
\u2022 \u522A\u9664\u76F8\u95DC\u6578\u64DA`)&&this.leaveGroup(e)}leaveGroup(e){if(!e)return;let t=e.joined_by_phone||this.joinMonitorSelectedPhone(),i=e.telegram_id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u78BA\u5B9A\u4F7F\u7528\u7684\u5E33\u865F");return}this.ipcService.send("leave-group",{phone:t,groupId:i,resourceId:e.id}),this.updateResourceStatusLocally(e,"discovered"),this.closeJoinMonitorDialog(),this.toastService.info("\u6B63\u5728\u9000\u51FA\u7FA4\u7D44..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},1e3)}openInTelegram(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||e.link;t?window.open(t,"_blank"):this.toastService.warning("\u6C92\u6709\u53EF\u7528\u7684\u93C8\u63A5")}deleteResource(e){if(e?.id&&confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u300C${e.title||"\u6B64\u8CC7\u6E90"}\u300D\u7684\u8A18\u9304\u55CE\uFF1F`)){this.ipcService.send("delete-resource",{resourceId:e.id});let t=this.discoveredResources();this.discoveredResources.set(t.filter(i=>i.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664\u8CC7\u6E90\u8A18\u9304"),this.refreshResourceStats()}}updateResourceStatusLocally(e,t,i,o){if(!e)return;let s=this.discoveredResources(),r=e.telegram_id||e.username||e.title,l=s.map(d=>{if((d.telegram_id||d.username||d.title)===r){let f=N(M({},d),{status:t,joined_at:new Date().toISOString()});return i&&(f.joined_by_phone=i),o&&o>0&&(f.member_count=o),f}return d});this.discoveredResources.set(l),console.log(`[Frontend] Updated resource status: ${r} -> ${t}`)}showPostJoinOptions(e,t,i){this.showJoinMonitorDialog.set(!1),this.showSuccessAnimation({icon:"\u{1F680}",title:"\u52A0\u5165\u6210\u529F\uFF01",subtitle:e?.title||"\u7FA4\u7D44\u5DF2\u6DFB\u52A0\u5230\u76E3\u63A7",duration:1200}),setTimeout(()=>{this.postJoinResource.set(e),this.postJoinPhone.set(t),this.showPostJoinDialog.set(!0)},1200)}closePostJoinDialog(){this.showPostJoinDialog.set(!1),this.postJoinResource.set(null),this.postJoinPhone.set("")}showSuccessAnimation(e){this.successOverlayConfig.set(e),this.showSuccessOverlay.set(!0);let t=e.duration||1500;setTimeout(()=>{this.hideSuccessAnimation()},t)}hideSuccessAnimation(){this.showSuccessOverlay.set(!1),this.successOverlayConfig.set(null)}postJoinExtractMembers(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openMemberListDialog(e))}postJoinSendMessage(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openSingleMessageDialog(e))}postJoinContinue(){this.closePostJoinDialog(),this.toastService.info("\u7E7C\u7E8C\u700F\u89BD\u5176\u4ED6\u7FA4\u7D44",2e3)}loadAccountQuotas(){let i=this.accounts().filter(o=>o.status==="Online").map(o=>{let s=Math.floor(o.dailySendCount/10)||0,r=20,l=Math.floor(o.dailySendCount/5)||0,d=o.healthScore||0,u=r>0?(r-l)/r*100:0,f=d*.5+u*.5;return{phone:o.phone,nickname:o.group||o.phone,joinedGroups:s,dailyLimit:r,dailyUsed:Math.min(l,r),isRecommended:!1,recommendScore:f,healthScore:d}}).sort((o,s)=>s.recommendScore-o.recommendScore).map((o,s)=>{let r=o.healthScore>=70&&o.dailyUsed<o.dailyLimit*.8,l=s<2&&r;return N(M({},o),{isRecommended:l})});if(this.accountQuotas.set(i),!this.joinMonitorSelectedPhone()){let o=i.find(s=>s.isRecommended);o?this.joinMonitorSelectedPhone.set(o.phone):i.length>0&&this.joinMonitorSelectedPhone.set(i[0].phone)}}toggleKeywordSetSelection(e){let t=this.joinMonitorSelectedKeywordSetIds();if(t.includes(e))this.joinMonitorSelectedKeywordSetIds.set(t.filter(i=>i!==e));else{let i=this.keywordSets().find(o=>o.id===e);if(i&&(!i.keywords||i.keywords.length===0)){this.toastService.warning(`\u26A0\uFE0F \u300C${i.name}\u300D\u6C92\u6709\u95DC\u9375\u8A5E\uFF0C\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u518D\u4F7F\u7528`);return}this.joinMonitorSelectedKeywordSetIds.set([...t,e])}}isKeywordSetSelected(e){return this.joinMonitorSelectedKeywordSetIds().includes(e)}openQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!0),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword=""}closeQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!1)}addQuickKeyword(){let e=this.quickCreateKeywordSetNewKeyword.trim();e&&!this.quickCreateKeywordSetKeywords().includes(e)&&(this.quickCreateKeywordSetKeywords.update(t=>[...t,e]),this.quickCreateKeywordSetNewKeyword="")}removeQuickKeyword(e){this.quickCreateKeywordSetKeywords.update(t=>t.filter(i=>i!==e))}addQuickRecommendedKeyword(e){this.quickCreateKeywordSetKeywords().includes(e)||this.quickCreateKeywordSetKeywords.update(t=>[...t,e])}executeQuickCreateKeywordSet(){let e=this.quickCreateKeywordSetName.trim(),t=this.quickCreateKeywordSetKeywords();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u8A5E\u96C6\u540D\u7A31");return}if(t.length===0){this.toastService.warning("\u8ACB\u81F3\u5C11\u6DFB\u52A0\u4E00\u500B\u95DC\u9375\u8A5E");return}this.ipcService.send("add-keyword-set",{name:e});let i=o=>{if(o.success&&o.setId){for(let s of t)this.ipcService.send("add-keyword",{setId:o.setId,keyword:s,isRegex:!1});this.joinMonitorSelectedKeywordSetIds.update(s=>[...s,o.setId]),this.toastService.success(`\u5DF2\u5275\u5EFA\u4E26\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6\u300C${e}\u300D`),this.closeQuickCreateKeywordSet(),this.ipcService.send("get-keyword-sets")}this.ipcService.off("keyword-set-added",i)};this.ipcService.on("keyword-set-added",i)}addMonitorKeyword(){let e=this.joinMonitorNewKeyword.trim();e&&!this.joinMonitorKeywords().includes(e)&&(this.joinMonitorKeywords.update(t=>[...t,e]),this.joinMonitorNewKeyword="")}removeMonitorKeyword(e){this.joinMonitorKeywords.update(t=>t.filter(i=>i!==e))}addRecommendedKeyword(e){this.joinMonitorKeywords().includes(e)||this.joinMonitorKeywords.update(t=>[...t,e])}getRecommendedKeywords(){let e=this.joinMonitorResource();if(!e)return[];let t=e.title||"",i=[];return(t.includes("\u4E8C\u624B")||t.includes("\u4EA4\u6613"))&&i.push("\u6C42\u8CFC","\u51FA\u552E","\u8F49\u8B93"),(t.includes("\u62DB\u8058")||t.includes("\u6C42\u8077"))&&i.push("\u62DB\u4EBA","\u6C42\u8077","\u517C\u8077"),(t.includes("\u83EF\u4EBA")||t.includes("\u6D77\u5916"))&&i.push("\u5408\u4F5C","\u8CC7\u6E90","\u6C42\u52A9"),i.length===0&&i.push("\u6C42\u8CFC","\u5408\u4F5C","\u8AEE\u8A62"),i.filter(o=>!this.joinMonitorKeywords().includes(o))}getKeywordPreview(e){if(!e||e.length===0)return"";let t=e.slice(0,3).map(i=>i.keyword||i.text||i).join(", ");return e.length>3?t+"...":t}executeJoinAndMonitor(){let e=this.joinMonitorResource(),t=this.joinMonitorSelectedPhone();if(!e){this.toastService.error("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}if(e.status!=="joined"&&e.status!=="monitoring"&&!t){this.toastService.error("\u8ACB\u9078\u64C7\u52A0\u5165\u5E33\u865F");return}this.isJoiningResource.set(!0);let i=this.joinMonitorSelectedKeywordSetIds(),o={resourceId:e.id||0,phone:t,keywordSetIds:i,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable()};if(!e.id||e.id===0){let s=e.link||e.invite_link||"",r=e.username||"";if(r&&r.toLowerCase().endsWith("bot")&&(console.log(`[Frontend] \u904E\u6FFE bot username: ${r}`),r=""),s&&/t\.me\/[^/]+\/\d+/.test(s)&&(console.log(`[Frontend] \u904E\u6FFE\u6D88\u606F\u93C8\u63A5: ${s}`),s=""),!s&&!r){let d=e.title||"\u6B64\u7FA4\u7D44";this.toastService.error(`\u7121\u6CD5\u52A0\u5165\u300C${d}\u300D\uFF1A
\u2022 \u6B64\u641C\u7D22\u7D50\u679C\u6C92\u6709\u63D0\u4F9B\u7FA4\u7D44\u7684\u9080\u8ACB\u93C8\u63A5
\u2022 \u8ACB\u5728 Telegram \u4E2D\u9EDE\u64CA\u641C\u7D22\u6A5F\u5668\u4EBA\u7684\u7D50\u679C
\u2022 \u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5\u5F8C\u518D\u8A66`),this.isJoiningResource.set(!1);return}let l="";e.telegram_id&&e.telegram_id!==e.title&&!e.telegram_id.toLowerCase().endsWith("bot")?l=e.telegram_id:r&&(l=r),o.resourceInfo={username:r,telegram_id:l,title:e.title||r||"\u672A\u547D\u540D\u7FA4\u7D44",description:e.description||"",member_count:e.member_count||0,resource_type:e.resource_type||"supergroup",link:s||(r?`https://t.me/${r}`:"")},console.log("[Frontend] Sending resourceInfo:",o.resourceInfo)}if(this.ipcService.send("join-and-monitor-with-account",o),e.status==="joined"||e.status==="monitoring"){let s=e.username?`@${e.username}`:e.telegram_id;this.ipcService.send("add-group",{url:s,keywordSetIds:i})}}openMonitorSettings(e){this.openJoinAndMonitorDialog(e)}openBatchJoinMonitorDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}let t=this.discoveredResources().filter(i=>e.includes(i.id));this.batchJoinResources.set(t),this.joinMonitorSelectedPhones.set([]),this.joinMonitorKeywords.set([]),this.joinMonitorSelectedKeywordSetIds.set([]),this.joinMonitorBatchMode.set(!0),this.joinMonitorBatchInterval.set(45),this.loadAccountQuotas(),this.showBatchJoinMonitorDialog.set(!0)}getBatchJoinTotalMembers(){return this.batchJoinResources().reduce((e,t)=>e+(t.member_count||0),0)}closeBatchJoinMonitorDialog(){this.showBatchJoinMonitorDialog.set(!1),this.batchJoinResources.set([])}toggleAccountSelection(e){let t=this.joinMonitorSelectedPhones();t.includes(e)?this.joinMonitorSelectedPhones.set(t.filter(i=>i!==e)):this.joinMonitorSelectedPhones.set([...t,e])}selectAllAccounts(){let e=this.accountQuotas().map(t=>t.phone);this.joinMonitorSelectedPhones.set(e)}executeBatchJoinMonitor(){let e=this.batchJoinResources(),t=this.joinMonitorSelectedPhones();if(e.length===0){this.toastService.error("\u6C92\u6709\u9078\u64C7\u7FA4\u7D44");return}if(t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u5E33\u865F");return}this.isJoiningResource.set(!0),this.batchJoinProgress.set({current:0,total:e.length,status:"\u6E96\u5099\u4E2D..."});let i=this.joinMonitorSelectedKeywordSetIds();this.ipcService.send("batch-join-and-monitor",{resourceIds:e.map(o=>o.id),phones:t,keywordSetIds:i,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable(),batchMode:this.joinMonitorBatchMode(),batchInterval:this.joinMonitorBatchInterval()}),this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44\uFF0C\u4F7F\u7528 ${t.length} \u500B\u5E33\u865F`)}},ld=Object.getOwnPropertyDescriptors(Lr.prototype);var Vr=class{openMemberListDialog(e){this.memberListResource.set(e),this.memberListData.set([]),this.memberListLoading.set(!1),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:""}),this.selectedMemberIds.set([]),this.memberExtractStarted.set(!1),this.memberListFilter.set("all"),this.memberExtractConfig.set({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}}),this.showMemberListDialog.set(!0)}closeMemberListDialog(){this.showMemberListDialog.set(!1),this.memberListResource.set(null),this.memberListData.set([])}loadMemberList(e){if(!e||!e.telegram_id){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44\u4FE1\u606F");return}this.memberListLoading.set(!0),this.memberListProgress.update(t=>N(M({},t),{status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:0})}extractMoreMembers(){let e=this.memberListResource(),t=this.memberListData().length;e&&(this.memberListLoading.set(!0),this.memberListProgress.update(i=>N(M({},i),{status:"\u6B63\u5728\u63D0\u53D6\u66F4\u591A\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:t}))}toggleMemberIdSelection(e){let t=this.selectedMemberIds();t.includes(e)?this.selectedMemberIds.set(t.filter(i=>i!==e)):this.selectedMemberIds.set([...t,e])}selectAllMembers(){let e=this.memberListData().map(t=>t.user_id);this.selectedMemberIds.set(e)}exportMembersToCSV(){let e=this.getFilteredMembers();if(e.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u6210\u54E1");return}let t=this.memberListResource(),i=`members_${t?.username||t?.telegram_id}_${new Date().toISOString().slice(0,10)}.csv`,o=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u5168\u540D","\u96FB\u8A71\u865F\u78BC","\u500B\u4EBA\u7C21\u4ECB","\u8A9E\u8A00","DC","\u5728\u7DDA\u72C0\u614B","\u6700\u5F8C\u4E0A\u7DDA","\u89D2\u8272","\u52A0\u5165\u65E5\u671F","Premium","\u5DF2\u8A8D\u8B49","Bot","\u6709\u982D\u50CF","\u8A50\u9A19","\u5047\u5E33\u865F","\u53D7\u9650\u5236","\u5DF2\u522A\u9664","\u83EF\u4EBA","\u6D3B\u8E8D\u5EA6","\u50F9\u503C\u7B49\u7D1A","\u4F86\u6E90\u7FA4\u7D44","\u63D0\u53D6\u6642\u9593"],s=C=>{if(C==null)return"";let y=String(C);return y.includes(",")||y.includes('"')||y.includes(`
`)?`"${y.replace(/"/g,'""')}"`:y},r=e.map(C=>[C.user_id,C.username||"",C.first_name||"",C.last_name||"",C.full_name||`${C.first_name||""} ${C.last_name||""}`.trim(),C.phone||"",s(C.bio||""),C.language_code||"",C.dc_id||"",C.online_status||"",C.last_online||"",C.chat_member_status||"member",C.joined_date||"",C.is_premium?"\u662F":"\u5426",C.is_verified?"\u662F":"\u5426",C.is_bot?"\u662F":"\u5426",C.has_photo?"\u662F":"\u5426",C.is_scam?"\u662F":"\u5426",C.is_fake?"\u662F":"\u5426",C.is_restricted?"\u662F":"\u5426",C.is_deleted?"\u662F":"\u5426",this.isChineseMember(C)?"\u662F":"\u5426",C.activity_score?(C.activity_score*100).toFixed(0)+"%":"",C.value_level||"",C.source_chat_title||"",C.extracted_at||""]),l=[o,...r].map(C=>C.map(s).join(",")).join(`
`),d=new Blob(["\uFEFF"+l],{type:"text/csv;charset=utf-8"}),u=URL.createObjectURL(d),f=document.createElement("a");f.href=u,f.download=i,f.click(),URL.revokeObjectURL(u),this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}setMemberExtractLimit(e){this.memberExtractConfig.update(t=>N(M({},t),{limit:e}))}applyExtractPreset(e){this.selectedPreset.set(e);let t=this.extractPresets.find(i=>i.id===e);t&&(this.memberExtractConfig.update(i=>N(M({},i),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),t.config.userTypes&&this.memberExtractConfig.update(i=>N(M({},i),{userTypes:M(M({},i.userTypes),t.config.userTypes)})),t.config.activityFilters&&this.memberExtractConfig.update(i=>N(M({},i),{activityFilters:M(M({},i.activityFilters),t.config.activityFilters)})),t.config.accountFeatures&&this.memberExtractConfig.update(i=>N(M({},i),{accountFeatures:M(M({},i.accountFeatures),t.config.accountFeatures)})),this.toastService.info(`\u5DF2\u61C9\u7528\u300C${t.name}\u300D\u9810\u8A2D`))}toggleUserType(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>N(M({},t),{userTypes:N(M({},t.userTypes),{[e]:!t.userTypes[e]})}))}toggleActivityFilter(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>N(M({},t),{activityFilters:N(M({},t.activityFilters),{[e]:!t.activityFilters[e]})}))}toggleAccountFeature(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>N(M({},t),{accountFeatures:N(M({},t.accountFeatures),{[e]:!t.accountFeatures[e]})}))}toggleExcludeFilter(e){this.memberExtractConfig.update(t=>N(M({},t),{excludeFilters:N(M({},t.excludeFilters),{[e]:!t.excludeFilters[e]})}))}getActiveFilterCount(){let e=this.memberExtractConfig(),t=0;return Object.values(e.userTypes).forEach(i=>i&&t++),Object.values(e.activityFilters).forEach(i=>i&&t++),Object.values(e.accountFeatures).forEach(i=>i&&t++),t}clearAllFilters(){this.selectedPreset.set(""),this.memberExtractConfig.update(e=>N(M({},e),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),this.toastService.info("\u5DF2\u6E05\u9664\u6240\u6709\u7BE9\u9078\u689D\u4EF6")}startMemberExtraction(){console.log("[Frontend] startMemberExtraction called");let e=this.memberListResource();if(console.log("[Frontend] Resource:",e),!e){console.error("[Frontend] No resource selected"),this.toastService.error("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u7FA4\u7D44");return}this.memberExtractStarted.set(!0),this.memberListLoading.set(!0),this.memberListData.set([]),this.extractionStartTime.set(Date.now());let t=this.memberExtractConfig(),i=t.limit===-1?t.customLimit:t.limit===0?99999:t.limit;console.log("[Frontend] Extraction config:",{limit:i,config:t}),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."});let o={resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:i,offset:0,filters:{onlineOnly:t.activityFilters.onlineNow,chineseOnly:t.userTypes.chinese,premiumOnly:t.accountFeatures.premium,hasUsername:t.accountFeatures.hasUsername,excludeBots:t.excludeFilters.bots}};console.log("[Frontend] Sending extract-members IPC:",o),this.toastService.info("\u{1F4E4} \u6B63\u5728\u767C\u9001\u63D0\u53D6\u8ACB\u6C42..."),this.ipcService.send("extract-members",o),t.backgroundMode&&(this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C"),this.closeMemberListDialog())}pauseMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>N(M({},e),{status:"\u5DF2\u66AB\u505C"})),this.toastService.info("\u23F8\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u66AB\u505C")}stopMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>N(M({},e),{status:"\u5DF2\u505C\u6B62"})),this.toastService.info("\u23F9\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u505C\u6B62")}toggleMemberExtractBackground(){this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C\uFF0C\u5B8C\u6210\u5F8C\u6703\u901A\u77E5\u60A8"),this.closeMemberListDialog()}handleMemberExtractionError(e){let t=e.error_code||"UNKNOWN",i=e.error_details||{};switch(this.memberListProgress.update(o=>N(M({},o),{status:"\u63D0\u53D6\u5931\u6557"})),t){case"PEER_ID_INVALID":case"NOT_PARTICIPANT":case"CHANNEL_PRIVATE":let o=i.attempts||0;o>1?this.showExtractionErrorWithAction("\u26A0\uFE0F \u7FA4\u7D44\u540C\u6B65\u672A\u5B8C\u6210",i.reason||`\u5DF2\u5617\u8A66 ${o} \u6B21\uFF0CTelegram \u670D\u52D9\u5668\u5C1A\u672A\u540C\u6B65`,i.suggestion||"\u8ACB\u7B49\u5F85 30 \u79D2\u5F8C\u518D\u8A66\uFF0C\u6216\u91CD\u65B0\u52A0\u5165\u7FA4\u7D44",void 0):this.showExtractionErrorWithAction("\u26A0\uFE0F \u7121\u6CD5\u63D0\u53D6\u6210\u54E1",i.reason||"\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44",i.suggestion||"\u8ACB\u5148\u52A0\u5165\u7FA4\u7D44\u518D\u5617\u8A66\u63D0\u53D6",i.can_auto_join?"join":void 0);break;case"ADMIN_REQUIRED":this.showExtractionErrorWithAction("\u{1F512} \u6210\u54E1\u5217\u8868\u53D7\u9650",i.reason||"\u7FA4\u7D44\u8A2D\u7F6E\u9650\u5236\u4E86\u6210\u54E1\u5217\u8868\u8A2A\u554F",i.suggestion||"\u53EF\u5617\u8A66\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u6536\u96C6\u6D3B\u8E8D\u7528\u6236",i.alternative==="monitor_messages"?"monitor":void 0);break;case"FLOOD_WAIT":this.toastService.warning(`\u23F3 ${e.error}

${i.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}`);break;case"CHANNEL_INVALID":this.toastService.error(`\u274C ${e.error}

${i.suggestion||"\u8ACB\u5237\u65B0\u8CC7\u6E90\u5217\u8868"}`);break;case"E4001_NOT_SYNCED":{let l=i.tried_phones||[],d=i.action;d==="retry_later"?this.showExtractionErrorWithAction("\u23F3 \u5DF2\u52A0\u5165\u7FA4\u7D44\uFF0C\u7B49\u5F85\u540C\u6B65",i.reason||"\u5E33\u865F\u5DF2\u6210\u529F\u52A0\u5165\u7FA4\u7D44\uFF0CTelegram \u6B63\u5728\u540C\u6B65",i.suggestion||"\u8ACB\u7B49\u5F85 30 \u79D2\u5F8C\u91CD\u65B0\u63D0\u53D6",void 0):d==="auto_join"&&i.can_auto_join?this.showExtractionErrorWithAction("\u26A0\uFE0F \u5E33\u865F\u672A\u52A0\u5165\u7FA4\u7D44",i.reason||"\u6240\u6709\u5E33\u865F\u5747\u7121\u6CD5\u8A2A\u554F\u6B64\u7FA4\u7D44",(l.length>1?`\u5DF2\u5617\u8A66 ${l.length} \u500B\u5E33\u865F\u3002`:"")+(i.suggestion||"\u8ACB\u624B\u52D5\u52A0\u5165\u7FA4\u7D44\u5F8C\u91CD\u8A66"),"join"):this.showExtractionErrorWithAction("\u26A0\uFE0F \u63D0\u53D6\u5931\u6557",i.reason||"\u7121\u6CD5\u8A2A\u554F\u7FA4\u7D44\u6210\u54E1\u5217\u8868",i.suggestion||"\u8ACB\u78BA\u8A8D\u5E33\u865F\u5DF2\u52A0\u5165\u6B64\u7FA4\u7D44",void 0);break}case"E4002_ADMIN_REQUIRED":this.showExtractionErrorWithAction("\u{1F512} \u6210\u54E1\u5217\u8868\u53D7\u9650",i.reason||"\u7FA4\u7D44\u9650\u5236\u4E86\u6210\u54E1\u5217\u8868\u8A2A\u554F\u6B0A\u9650",i.suggestion||"\u53EF\u5617\u8A66\u4F7F\u7528\u300C\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u300D\u65B9\u5F0F\u6536\u96C6\u6D3B\u8E8D\u7528\u6236","monitor");break;case"E4003_RATE_LIMITED":let r=i.retry_after_seconds||120;this.toastService.warning(`\u23F3 Telegram \u901F\u7387\u9650\u5236

\u8ACB\u7B49\u5F85 ${r} \u79D2\u5F8C\u518D\u8A66`,r>60?1e4:5e3);break;case"E4004_NO_CHAT_ID":this.toastService.warning(`\u26A0\uFE0F \u7121\u6CD5\u78BA\u5B9A\u7FA4\u7D44\u6A19\u8B58

${i.suggestion||"\u8ACB\u5148\u901A\u904E\u641C\u7D22\u767C\u73FE\u7372\u53D6\u7FA4\u7D44\u4FE1\u606F"}`,5e3);break;case"E4005_QUOTA_EXCEEDED":{let l=i.daily_quota;this.toastService.warning(`\u{1F4CA} \u4ECA\u65E5\u63D0\u53D6\u914D\u984D\u5DF2\u9054\u4E0A\u9650

\u5DF2\u63D0\u53D6 ${l?.used||"?"} / ${l?.limit||"?"} \u4EBA
\u660E\u5929\u5C07\u81EA\u52D5\u91CD\u7F6E`,1e4),this.memberListProgress.update(d=>N(M({},d),{status:"\u4ECA\u65E5\u914D\u984D\u5DF2\u7528\u5B8C"}));break}default:this.toastService.error(`\u274C \u63D0\u53D6\u5931\u6557: ${e.error}`)}}showExtractionErrorWithAction(e,t,i,o){let s=this.memberListResource(),r=`${e}

\u539F\u56E0\uFF1A${t}

\u{1F4A1} ${i}`;o==="join"&&s?(r+=`

\u9EDE\u64CA\u300C\u52A0\u5165\u7FA4\u7D44\u300D\u6309\u9215\u5F8C\u91CD\u8A66`,this.toastService.warning(r),this.memberListProgress.update(l=>N(M({},l),{status:"\u9700\u8981\u5148\u52A0\u5165\u7FA4\u7D44"}))):o==="monitor"&&s?(r+=`

\u5EFA\u8B70\uFF1A\u555F\u52D5\u6D88\u606F\u76E3\u63A7\u4F86\u6536\u96C6\u6D3B\u8E8D\u7528\u6236`,this.toastService.warning(r),this.memberListProgress.update(l=>N(M({},l),{status:"\u5EFA\u8B70\u4F7F\u7528\u6D88\u606F\u76E3\u63A7"}))):this.toastService.error(r)}async autoJoinAndExtract(){let e=this.memberListResource();if(!e)return;this.toastService.info("\u{1F680} \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44...");let t=this.accounts().find(i=>i.status==="Online");t?(this.ipcService.send("join-group",{phone:t.phone,groupUrl:e.username?`https://t.me/${e.username}`:e.invite_link}),this.ipcService.once("group-join-result",i=>{i.success?(this.toastService.success("\u2705 \u6210\u529F\u52A0\u5165\u7FA4\u7D44\uFF0C\u6B63\u5728\u91CD\u65B0\u63D0\u53D6..."),setTimeout(()=>{this.startMemberExtraction()},2e3)):this.toastService.error(`\u274C \u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${i.error}`)})):this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F")}getFirstOnlineAccount(){return this.accounts().find(e=>e.status==="Online")}calculateAndShowExtractionSummary(e){let t=this.memberListResource(),i=this.extractionStartTime(),o=i>0?Math.round((Date.now()-i)/1e3):0,s=0,r=0,l=0,d=0,u=0,f=0,C={S:0,A:0,B:0,C:0,D:0};for(let y of e){y.online_status==="online"?s++:y.online_status==="recently"&&r++,y.is_premium&&l++,this.isChineseMember(y)&&d++,y.username&&u++,y.is_bot&&f++;let E=y.value_level||this.calculateMemberValueLevel(y);E&&C.hasOwnProperty(E)&&C[E]++}this.extractionSummary.set({groupName:t?.title||t?.name||"\u672A\u77E5\u7FA4\u7D44",groupUrl:t?.username?`t.me/${t.username}`:t?.url||"",totalExtracted:e.length,totalInGroup:t?.member_count||0,onlineCount:s,recentlyCount:r,premiumCount:l,chineseCount:d,hasUsernameCount:u,botCount:f,valueLevelDistribution:C,extractedAt:new Date().toLocaleString("zh-TW"),duration:o}),this.showExtractionSummaryDialog.set(!0),this.toastService.success(`\u2705 \u6210\u529F\u63D0\u53D6 ${e.length} \u500B\u6210\u54E1`)}calculateMemberValueLevel(e){let t=0;return e.is_premium&&(t+=30),e.online_status==="online"?t+=25:e.online_status==="recently"?t+=20:e.online_status==="last_week"&&(t+=10),e.username&&(t+=15),this.isChineseMember(e)&&(t+=10),e.is_bot&&(t-=50),e.activity_score&&(t+=Math.min(e.activity_score,20)),t>=70?"S":t>=50?"A":t>=30?"B":t>=10?"C":"D"}closeExtractionSummaryDialog(){this.showExtractionSummaryDialog.set(!1)}goToMemberDatabaseFromSummary(){this.closeExtractionSummaryDialog(),this.closeMemberListDialog(),this.currentView.set("member-database")}startBatchMarketingFromSummary(){this.closeExtractionSummaryDialog(),this.toastService.info("\u{1F4A1} \u8ACB\u5728\u6210\u54E1\u5217\u8868\u4E2D\u9078\u64C7\u8981\u71DF\u92B7\u7684\u7528\u6236\uFF0C\u7136\u5F8C\u9EDE\u64CA\u300C\u6279\u91CF\u767C\u9001\u300D")}getValueLevelPercent(e){let t=this.extractionSummary(),i=t.totalExtracted;if(i===0)return 0;let o=t.valueLevelDistribution[e]||0;return Math.round(o/i*100)}setMemberFilter(e){this.memberListFilter.set(e)}getFilteredMembers(){let e=this.memberListData();switch(this.memberListFilter()){case"chinese":return e.filter(i=>this.isChineseMember(i));case"online":return e.filter(i=>i.online_status==="online"||i.online_status==="recently");case"premium":return e.filter(i=>i.is_premium);case"hasUsername":return e.filter(i=>!!i.username);default:return e}}isChineseMember(e){let t=/[\u4e00-\u9fa5]/,i=(e.first_name||"")+(e.last_name||"");return t.test(i)}getChineseMemberCount(){return this.memberListData().filter(e=>this.isChineseMember(e)).length}getOnlineMemberCount(){return this.memberListData().filter(e=>e.online_status==="online"||e.online_status==="recently").length}getPremiumMemberCount(){return this.memberListData().filter(e=>e.is_premium).length}getMemberExtractPercent(){let e=this.memberListProgress();return e.total===0?0:Math.min(100,Math.round(this.memberListData().length/e.total*100))}isAllMembersSelected(){let e=this.getFilteredMembers();return e.length>0&&e.every(t=>this.selectedMemberIds().includes(t.user_id))}toggleSelectAllMembersList(){let e=this.getFilteredMembers();this.isAllMembersSelected()?this.selectedMemberIds.set([]):this.selectedMemberIds.set(e.map(t=>t.user_id))}sendPrivateMessage(e){if(!e.username){this.toastService.warning("\u8A72\u7528\u6236\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u79C1\u4FE1");return}this.toastService.info(`\u{1F4E8} \u6E96\u5099\u767C\u9001\u79C1\u4FE1\u7D66 @${e.username}`)}batchSendPrivateMessage(){let e=this.selectedMemberIds().length;this.toastService.info(`\u{1F4E8} \u6E96\u5099\u6279\u91CF\u767C\u9001\u79C1\u4FE1\u7D66 ${e} \u500B\u6210\u54E1`)}batchAddFriend(){let e=this.selectedMemberIds().length;this.toastService.info(`\u2795 \u6E96\u5099\u6279\u91CF\u6DFB\u52A0 ${e} \u500B\u597D\u53CB`)}addMemberToFunnel(e){let t={userId:e.user_id,username:e.username||"",firstName:e.first_name||"",lastName:e.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u624B\u52D5\u6DFB\u52A0",onlineStatus:e.online_status||"unknown"};this.ipcService.send("add-lead",t),this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${e.first_name||e.username||"ID:"+e.user_id} \u52A0\u5165\u71DF\u92B7\u6F0F\u6597`)}batchAddToFunnel(){let e=this.selectedMemberIds(),t=this.memberListData().filter(o=>e.includes(o.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let i=0;for(let o of t){let s={userId:o.user_id,username:o.username||"",firstName:o.first_name||"",lastName:o.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u6279\u91CF\u6DFB\u52A0",onlineStatus:o.online_status||"unknown"};this.ipcService.send("add-lead",s),i++}this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${i} \u500B\u6210\u54E1\u52A0\u5165\u71DF\u92B7\u6F0F\u6597`),this.clearMemberSelection()}clearMemberSelection(){this.selectedMemberIds.set([])}exportSelectedMembersToCSV(){let e=this.selectedMemberIds(),t=this.memberListData().filter(d=>e.includes(d.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let i=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u8A55\u7D1A","\u5728\u7DDA\u72C0\u614B","Premium","\u4F86\u6E90\u7FA4\u7D44"],o=t.map(d=>[d.user_id,d.username||"",d.first_name||"",d.last_name||"",this.calculateMemberValueLevel(d),d.online_status||"unknown",d.is_premium?"\u662F":"\u5426",this.memberListResource()?.title||""]),s=[i.join(","),...o.map(d=>d.join(","))].join(`
`),r=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=`selected-members-${new Date().toISOString().split("T")[0]}.csv`,l.click(),this.toastService.success(`\u{1F4E5} \u5DF2\u5C0E\u51FA ${t.length} \u500B\u6210\u54E1`)}copyMemberUsernames(e=!1){let i=(e?this.memberListData().filter(o=>this.selectedMemberIds().includes(o.user_id)):this.getFilteredMembers()).filter(o=>o.username).map(o=>`@${o.username}`);if(i.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u8907\u88FD\u7684\u7528\u6236\u540D");return}navigator.clipboard.writeText(i.join(`
`)).then(()=>{this.toastService.success(`\u{1F4CB} \u5DF2\u8907\u88FD ${i.length} \u500B\u7528\u6236\u540D`)}).catch(()=>{let o=document.createElement("textarea");o.value=i.join(`
`),document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),this.toastService.success(`\u{1F4CB} \u5DF2\u8907\u88FD ${i.length} \u500B\u7528\u6236\u540D`)})}copyMemberIds(e=!1){let i=(e?this.memberListData().filter(o=>this.selectedMemberIds().includes(o.user_id)):this.getFilteredMembers()).map(o=>o.user_id);if(i.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u8907\u88FD\u7684\u7528\u6236 ID");return}navigator.clipboard.writeText(i.join(`
`)).then(()=>{this.toastService.success(`\u{1F4CB} \u5DF2\u8907\u88FD ${i.length} \u500B\u7528\u6236 ID`)}).catch(()=>{this.toastService.error("\u8907\u88FD\u5931\u6557")})}selectHighValueMembers(){let t=this.memberListData().filter(i=>{let o=this.calculateMemberValueLevel(i);return o==="S"||o==="A"}).map(i=>i.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B S/A \u7D1A\u6210\u54E1`)}selectOnlineMembers(){let t=this.memberListData().filter(i=>i.online_status==="online"||i.online_status==="recently").map(i=>i.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B\u5728\u7DDA/\u6700\u8FD1\u6D3B\u8E8D\u6210\u54E1`)}selectAllMembersInList(){let e=this.getFilteredMembers();this.selectedMemberIds.set(e.map(t=>t.user_id)),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${e.length} \u500B\u6210\u54E1`)}openBatchMemberExtractDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u63D0\u53D6 ${e.length} \u500B\u7FA4\u7D44\u7684\u6210\u54E1`),this.ipcService.send("batch-extract-members",{resourceIds:e,limit:100,safeMode:!0})}openSingleMessageDialog(e){this.singleMessageResource.set(e),this.singleMessageContent="",this.singleMessageScheduled.set(!1),this.singleMessageScheduleTime="",this.singleMessageAccountId.set(""),this.loadAccountQuotas(),this.showSingleMessageDialog.set(!0)}closeSingleMessageDialog(){this.showSingleMessageDialog.set(!1),this.singleMessageResource.set(null)}executeSingleMessage(){let e=this.singleMessageResource(),t=this.singleMessageContent.trim();if(!e){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44");return}if(!t){this.toastService.error("\u8ACB\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let i=this.singleMessageAccountId();if(!i){this.toastService.error("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.singleMessageScheduled()&&this.singleMessageScheduleTime?(this.ipcService.send("schedule-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:i,scheduledTime:this.singleMessageScheduleTime}),this.toastService.success(`\u23F0 \u6D88\u606F\u5DF2\u6392\u7A0B\uFF0C\u5C07\u65BC ${this.singleMessageScheduleTime} \u767C\u9001`)):(this.ipcService.send("send-group-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:i}),this.toastService.info("\u{1F4E8} \u6B63\u5728\u767C\u9001\u6D88\u606F...")),this.closeSingleMessageDialog()}refreshAllResources(){this.isRefreshing.set(!0),this.toastService.info("\u6B63\u5728\u5237\u65B0\u8CC7\u6E90\u6578\u64DA..."),this.refreshResourceStats(),this.loadResources(),this.loadDiscoveryKeywords(),setTimeout(()=>{this.isRefreshing.set(!1),this.toastService.success("\u5237\u65B0\u5B8C\u6210")},2e3)}clearSearchResults(){let e=this.discoveredResources().length;if(e===0){this.toastService.warning("\u6C92\u6709\u53EF\u6E05\u7A7A\u7684\u8CC7\u6E90");return}confirm(`\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709 ${e} \u689D\u641C\u7D22\u7D50\u679C\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u8CC7\u6E90\u8A18\u9304\uFF0C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&this.ngZone.run(()=>{this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.refreshResourceStats(),this.cdr.detectChanges()})}deleteAllDiscoveredResources(){let e=this.discoveredResources().filter(t=>t.status==="discovered").map(t=>t.id);if(e.length===0){this.toastService.info("\u6C92\u6709\u53EF\u522A\u9664\u7684\u672A\u8655\u7406\u8CC7\u6E90");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6240\u6709\u672A\u8655\u7406\u7684\u8CC7\u6E90\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002")&&(this.ipcService.send("delete-resources-batch",{resourceIds:e}),this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u522A\u9664 ${e.length} \u500B\u8CC7\u6E90`),setTimeout(()=>this.loadResources(),500))}clearDiscoveredResources(){this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.toastService.info("\u5DF2\u6E05\u7A7A\u7576\u524D\u641C\u7D22\u7D50\u679C")}clearHistoryData(e="all"){confirm(`\u78BA\u5B9A\u8981\u6E05\u7406 ${{all:"\u6240\u6709\u8CC7\u6E90\u6578\u64DA",old_data:"\u820A\u6578\u64DA",search_history:"\u641C\u7D22\u6B77\u53F2\uFF08\u4FDD\u7559\u6536\u85CF\uFF09"}[e]} \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&(this.toastService.info("\u{1F9F9} \u6B63\u5728\u6E05\u7406..."),this.ipcService.send("clear-resources",{type:e,daysToKeep:e==="old_data"?7:0}))}clearAllSearchHistory(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2\u55CE\uFF1F\u6B64\u64CD\u4F5C\u6703\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u641C\u7D22\u7D50\u679C\u3002")&&(this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.searchHistoryKeywords.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.showSearchHistory.set(!1),this.toastService.success("\u5DF2\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2"))}toggleSearchHistoryMode(){let e=!this.showSearchHistory();this.showSearchHistory.set(e),e?(this.loadResources(),this.toastService.info("\u6B63\u5728\u8F09\u5165\u6B77\u53F2\u641C\u7D22\u7D50\u679C...")):this.currentSearchKeyword()||this.discoveredResources.set([])}searchFromHistory(e){this.resourceSearchQuery=e,this.showSearchHistory.set(!1),this.searchResources()}handleSearchDiscoverySearch(e){this.resourceSearchQuery=e.query,this.selectedSearchSources.set(e.sources),this.searchResources()}handleSearchDiscoverySelectAccount(e){this.selectResourceAccount(e.id)}handleOnboardingNavigate(e){console.log("[Onboarding] \u5BFC\u822A\u5230:",e),this.changeView(e)}openOnboarding(){this.onboardingComponent&&this.onboardingComponent.open()}resetOnboarding(){this.onboardingComponent&&(this.onboardingComponent.reset(),this.onboardingComponent.open())}saveResource(e){if(!e.telegram_id){this.toastService.error("\u7121\u6CD5\u6536\u85CF\uFF1A\u7F3A\u5C11\u8CC7\u6E90 ID");return}this.ipcService.send("save-resource",{telegram_id:e.telegram_id,username:e.username,title:e.title,description:e.description,member_count:e.member_count,resource_type:e.resource_type,overall_score:e.overall_score,discovery_keyword:this.currentSearchKeyword()});let t=new Set(this.savedResources());t.add(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(s=>s.telegram_id===e.telegram_id?N(M({},s),{is_saved:!0}):s);this.discoveredResources.set(o),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF\u300C${e.title}\u300D`)}unsaveResource(e){if(!e.telegram_id)return;this.ipcService.send("unsave-resource",{telegram_id:e.telegram_id});let t=new Set(this.savedResources());t.delete(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(s=>s.telegram_id===e.telegram_id?N(M({},s),{is_saved:!1}):s);this.discoveredResources.set(o),this.toastService.info(`\u5DF2\u53D6\u6D88\u6536\u85CF\u300C${e.title}\u300D`)}batchSaveResources(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u6536\u85CF\u7684\u8CC7\u6E90");return}let t=this.discoveredResources().filter(i=>e.includes(i.id)||e.some(o=>String(o)===i.telegram_id));t.forEach(i=>this.saveResource(i)),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF ${t.length} \u500B\u8CC7\u6E90`)}isResourceSaved(e){return e.is_saved||this.savedResources().has(e.telegram_id)}syncContactsData(){this.contactsService.syncFromSources(),this.toastService.info("\u6B63\u5728\u540C\u6B65\u6578\u64DA...",2e3)}joinAndMonitor(e){let t=this.discoveredResources().find(i=>i.id===e);if(!t){this.toastService.error("\u627E\u4E0D\u5230\u8A72\u8CC7\u6E90");return}this.toastService.info(`\u6B63\u5728\u52A0\u5165\u4E26\u76E3\u63A7: ${t.title}`),this.ipcService.send("join-and-monitor-resource",{resourceId:e,username:t.username,telegramId:t.telegram_id,title:t.title})}batchJoinAndMonitor(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}this.toastService.info(`\u6B63\u5728\u6279\u91CF\u52A0\u5165\u4E26\u76E3\u63A7 ${e.length} \u500B\u7FA4\u7D44...`),this.ipcService.send("batch-join-and-monitor",{resourceIds:e})}loadDiscoveryKeywords(){this.ipcService.send("get-discovery-keywords",{})}addDiscoveryKeyword(){if(!this.newResourceKeyword.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E");return}this.ipcService.send("add-discovery-keyword",{keyword:this.newResourceKeyword.trim(),category:"general",priority:5})}searchWithKeyword(e){this.resourceSearchQuery=e,this.searchResources()}toggleResourceSelection(e){let t=this.selectedResourceIds();t.includes(e)?this.selectedResourceIds.set(t.filter(i=>i!==e)):this.selectedResourceIds.set([...t,e])}toggleSelectAllResources(){let e=this.discoveredResources();this.selectedResourceIds().length===e.length?this.selectedResourceIds.set([]):this.selectedResourceIds.set(e.map(i=>i.id))}addSelectedToJoinQueue(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("add-to-join-queue",{resourceIds:e,priority:5})}processJoinQueue(){this.isProcessingJoinQueue.set(!0),this.ipcService.send("process-join-queue",{limit:5})}toggleSearchSource(e){let t=this.selectedSearchSources();t.includes(e)?this.selectedSearchSources.set(t.filter(i=>i!==e)):this.selectedSearchSources.set([...t,e])}selectAllSearchSources(){this.selectedSearchSources.set(["telegram","jiso","tgstat","local"])}enterGroup(e){this.changeView("resources"),this.toastService.info(`\u6E96\u5099\u9032\u5165\u7FA4\u7D44\uFF1A${e.title}`)}batchEnterGroups(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}let t=this.discoveredResources().filter(i=>e.includes(i.id));this.toastService.info(`\u6E96\u5099\u9032\u5165 ${t.length} \u500B\u7FA4\u7D44\u67E5\u770B\u6210\u54E1`)}sendGroupMessage(e){this.selectedResourceIds.set([e.id]),this.showBatchMessageDialog.set(!0)}executeBatchMessage(){let e=this.selectedResourceIds();if(e.length===0||!this.batchMessageContent.trim()){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u4E26\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let t=this.discoveredResources().filter(i=>e.includes(i.id));this.toastService.success(`\u958B\u59CB\u5411 ${t.length} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!1)}inviteMembersToGroup(e){this.selectedResourceIds.set([e.id]),this.loadAvailableMembers(),this.showBatchInviteDialog.set(!0)}executeBatchInvite(){let e=this.selectedResourceIds(),t=this.batchInviteConfig.selectedMemberIds;if(e.length===0||t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u548C\u6210\u54E1");return}this.toastService.success(`\u958B\u59CB\u9080\u8ACB ${t.length} \u4F4D\u6210\u54E1\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44`),this.showBatchInviteDialog.set(!1)}loadAvailableMembers(){this.availableMembersForInvite.set([{id:"1",name:"\u793A\u4F8B\u6210\u54E11",username:"member1"},{id:"2",name:"\u793A\u4F8B\u6210\u54E12",username:"member2"}])}toggleSelectAllMembers(e){e.target.checked?(this.batchInviteConfig.selectedMemberIds=this.availableMembersForInvite().map(i=>i.id),this.batchInviteConfig.selectAll=!0):(this.batchInviteConfig.selectedMemberIds=[],this.batchInviteConfig.selectAll=!1)}toggleMemberSelection(e,t){let i=t.target.checked,o=this.batchInviteConfig.selectedMemberIds;i?this.batchInviteConfig.selectedMemberIds=[...o,e]:this.batchInviteConfig.selectedMemberIds=o.filter(s=>s!==e),this.batchInviteConfig.selectAll=this.batchInviteConfig.selectedMemberIds.length===this.availableMembersForInvite().length}batchJoinSelected(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("batch-join-resources",{resourceIds:e,delayMin:30,delayMax:60})}toggleResourceMenu(e,t){t&&t.stopPropagation(),this.openResourceMenuId()===e?this.openResourceMenuId.set(null):this.openResourceMenuId.set(e)}closeResourceMenu(){this.openResourceMenuId.set(null)}getResourceStatusColor(e){return{discovered:"bg-blue-500",queued:"bg-yellow-500",joining:"bg-orange-500",joined:"bg-green-500",monitoring:"bg-emerald-500",left:"bg-gray-500",blocked:"bg-red-500",invalid:"bg-slate-500"}[e]||"bg-gray-500"}getSizeGrade(e){return e>=1e5?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",label:"\u8D85\u5927\u578B"}:e>=1e4?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",label:"\u5927\u578B"}:e>=1e3?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",label:"\u4E2D\u578B"}:e>=100?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",label:"\u5C0F\u578B"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",label:"\u5FAE\u578B"}}getScoreGrade(e){let t=e*100;return t>=90?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",icon:"\u{1F3C6}"}:t>=75?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",icon:"\u2B50"}:t>=60?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",icon:"\u{1F44D}"}:t>=40?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",icon:"\u{1F44C}"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",icon:"\u26A0\uFE0F"}}getScoreBarColor(e){let t=e*100;return t>=90?"bg-amber-400":t>=75?"bg-green-400":t>=60?"bg-blue-400":t>=40?"bg-slate-400":"bg-red-400"}getResourceStatusName(e){return{discovered:"\u5DF2\u767C\u73FE",queued:"\u968A\u5217\u4E2D",joining:"\u52A0\u5165\u4E2D",joined:"\u5DF2\u52A0\u5165",monitoring:"\u76E3\u63A7\u4E2D",left:"\u5DF2\u9000\u51FA",blocked:"\u88AB\u5C01\u7981",invalid:"\u7121\u6548"}[e]||e}getResourceTypeName(e){return{group:"\u7FA4\u7D44",supergroup:"\u8D85\u7D1A\u7FA4\u7D44",channel:"\u983B\u9053",bot:"\u6A5F\u5668\u4EBA"}[e]||e}getResourceTypeStyle(e){return{channel:{icon:"\u{1F4E2}",label:"\u983B\u9053",bgClass:"bg-purple-500/20",textClass:"text-purple-400",canMessage:!1,canExtract:!1},supergroup:{icon:"\u{1F465}",label:"\u8D85\u7D1A\u7FA4\u7D44",bgClass:"bg-blue-500/20",textClass:"text-blue-400",canMessage:!0,canExtract:!0},group:{icon:"\u{1F4AC}",label:"\u7FA4\u7D44",bgClass:"bg-green-500/20",textClass:"text-green-400",canMessage:!0,canExtract:!0},bot:{icon:"\u{1F916}",label:"\u6A5F\u5668\u4EBA",bgClass:"bg-orange-500/20",textClass:"text-orange-400",canMessage:!0,canExtract:!1}}[e]||{icon:"\u{1F4CC}",label:"\u672A\u77E5",bgClass:"bg-slate-500/20",textClass:"text-slate-400",canMessage:!1,canExtract:!1}}isChannel(e){return e?.resource_type==="channel"}canSendMessageToResource(e){return!this.isChannel(e)}canExtractMembers(e){return!this.isChannel(e)}showChannelMemberWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u63D0\u53D6\u6210\u54E1\u5217\u8868

Telegram \u4E0D\u5141\u8A31\u67E5\u770B\u983B\u9053\u7684\u8A02\u95B1\u8005\u5217\u8868\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u5C0B\u627E\u8A72\u983B\u9053\u7684\u95DC\u806F\u8A0E\u8AD6\u7FA4\u7D44`)}showChannelMessageWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u767C\u9001\u6D88\u606F

\u53EA\u6709\u983B\u9053\u7BA1\u7406\u54E1\u53EF\u4EE5\u767C\u5E03\u5167\u5BB9\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u95DC\u6CE8\u983B\u9053\u7372\u53D6\u8CC7\u8A0A\uFF0C\u6216\u5C0B\u627E\u8A0E\u8AD6\u7FA4\u7D44`)}verifyResourceType(e){if(!e?.id){this.toastService.error("\u7121\u6548\u7684\u8CC7\u6E90");return}this.toastService.info(`\u{1F50D} \u6B63\u5728\u9A57\u8B49: ${e.title||e.username}...`),this.ipcService.send("verify-resource-type",{resourceId:e.id})}getResourcePermissionStatus(e){return this.isChannel(e)?{icon:"\u{1F4E2}",text:"\u50C5\u8A02\u95B1",class:"text-purple-400"}:{icon:"\u2705",text:"\u53EF\u4E92\u52D5",class:"text-green-400"}}getSelectedChannelCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(i=>e.includes(i.id)&&i.resource_type==="channel").length}getSelectedGroupCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(i=>e.includes(i.id)&&i.resource_type!=="channel").length}getSelectedMessageableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(i=>e.includes(i.id)&&i.resource_type!=="channel")}getSelectedExtractableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(i=>e.includes(i.id)&&i.resource_type!=="channel")}openBatchMessageWithFilter(){let e=this.getSelectedChannelCount();e>0&&this.toastService.info(`\u{1F4E2} \u5DF2\u81EA\u52D5\u6392\u9664 ${e} \u500B\u983B\u9053\uFF0C\u5C07\u5C0D ${this.getSelectedGroupCount()} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!0)}},cd=Object.getOwnPropertyDescriptors(Vr.prototype);var Br=class{initDiscussionWatcher(){this.ipcService.send("init-discussion-watcher",{})}discoverDiscussion(){if(!this.discoverChannelId.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u983B\u9053 ID \u6216 username");return}this.ipcService.send("discover-discussion",{channelId:this.discoverChannelId.trim()}),this.discoverChannelId=""}discoverDiscussionsFromResources(){this.ipcService.send("discover-discussions-from-resources",{})}loadChannelDiscussions(){this.ipcService.send("get-channel-discussions",{activeOnly:!0})}refreshDiscussionStats(){this.ipcService.send("get-discussion-stats",{})}startDiscussionMonitoring(e){this.ipcService.send("start-discussion-monitoring",{discussionId:e})}stopDiscussionMonitoring(e){this.ipcService.send("stop-discussion-monitoring",{discussionId:e})}loadDiscussionMessages(e){this.selectedDiscussionId.set(e),this.isLoadingDiscussionMessages.set(!0),this.ipcService.send("get-discussion-messages",{discussionId:e,limit:50,matchedOnly:!1})}replyToDiscussion(e,t,i){if(!i||!i.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u56DE\u5FA9\u5167\u5BB9");return}this.ipcService.send("reply-to-discussion",{discussionId:t,messageId:e,replyText:i.trim()}),this.discussionReplyText.set("")}initKnowledgeBase(){this.ipcService.send("init-knowledge-base",{})}loadKnowledgeData(){this.isLoadingKnowledge.set(!0),this.ipcService.send("get-knowledge-stats",{}),this.refreshCurrentKnowledgeTab()}refreshCurrentKnowledgeTab(){switch(this.knowledgeTab()){case"documents":this.ipcService.send("get-documents",{});break;case"images":this.ipcService.send("get-media",{mediaType:"image"});break;case"videos":this.ipcService.send("get-media",{mediaType:"video"});break;case"qa":this.ipcService.send("get-qa-pairs",{});break}}switchKnowledgeTab(e){this.knowledgeTab.set(e),this.refreshCurrentKnowledgeTab()}addDocument(){let e=this.newDocument();if(!e.title&&!e.content){this.toastService.error(this.t("documentTitle")+" required",2e3);return}this.ipcService.send("add-document",{title:e.title,content:e.content,category:e.category,tags:e.tags.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})}async uploadDocumentFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let i=t.files[0],o=this.newDocument(),s=new FileReader;s.onload=()=>{let r=s.result;this.ipcService.send("add-document",{title:o.title||i.name.replace(/\.[^/.]+$/,""),content:r,category:o.category,tags:o.tags.split(",").map(l=>l.trim()).filter(l=>l)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})},i.type==="application/pdf"?this.toastService.info("PDF \u6587\u4EF6\u5C07\u7531\u5F8C\u7AEF\u8655\u7406",2e3):s.readAsText(i),t.value=""}deleteDocument(e){this.ipcService.send("delete-document",{id:e}),this.knowledgeDocuments.update(t=>t.filter(i=>i.id!==e))}async uploadMediaFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let i=t.files[0],o=this.newMedia(),r=i.type.startsWith("video/")?"video":"image",l=new FileReader;l.onload=()=>{let d=l.result.split(",")[1];this.ipcService.send("add-media",{base64Data:d,name:o.name||i.name.replace(/\.[^/.]+$/,""),category:o.category,description:o.description,mediaType:r}),this.showAddMediaDialog.set(!1),this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"})},l.readAsDataURL(i),t.value=""}deleteMedia(e,t){this.ipcService.send("delete-media",{id:e}),t==="image"?this.knowledgeImages.update(i=>i.filter(o=>o.id!==e)):this.knowledgeVideos.update(i=>i.filter(o=>o.id!==e))}addQaPair(){let e=this.newQaPair();if(!e.question||!e.answer){this.toastService.error(this.t("question")+" & "+this.t("answer")+" required",2e3);return}this.ipcService.send("add-qa-pair",{question:e.question,answer:e.answer,category:e.category,keywords:e.keywords.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddQaDialog.set(!1),this.newQaPair.set({question:"",answer:"",category:"general",keywords:""})}deleteQaPair(e){this.knowledgeQaPairs.update(t=>t.filter(i=>i.id!==e))}openAddImageDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"}),this.showAddMediaDialog.set(!0)}openAddVideoDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"video"}),this.showAddMediaDialog.set(!0)}updateNewDocumentField(e,t){let i=this.newDocument();this.newDocument.set(N(M({},i),{[e]:t}))}updateNewMediaField(e,t){let i=this.newMedia();this.newMedia.set(N(M({},i),{[e]:t}))}updateNewQaPairField(e,t){let i=this.newQaPair();this.newQaPair.set(N(M({},i),{[e]:t}))}searchKnowledge(e){e.trim()&&this.ipcService.send("search-knowledge",{query:e,includeDocs:!0,includeImages:!0,includeVideos:!0,limit:20})}sendAiGreeting(){let e=this.aiGreetingSuggestion();e&&(this.ipcService.send("send-message",{phone:e.accountPhone,recipientId:e.userId,text:e.suggestedGreeting,leadId:e.leadId}),this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null),this.toastService.success(`\u2713 \u554F\u5019\u6D88\u606F\u5DF2\u767C\u9001\u7D66 @${e.username||e.firstName}`))}editAiGreeting(e){let t=this.aiGreetingSuggestion();t&&this.aiGreetingSuggestion.set(N(M({},t),{suggestedGreeting:e}))}dismissAiGreeting(){this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null)}formatFileSize(e){if(!e)return"0 B";let t=1024,i=["B","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+i[o]}async uploadVoiceSample(e){let t=e.target;if(!t.files||t.files.length===0)return;let i=t.files[0];if(!["audio/wav","audio/mp3","audio/mpeg","audio/ogg","audio/flac"].includes(i.type)){this.voiceCloneError.set(this.t("invalidAudioFormat"));return}if(i.size>50*1024*1024){this.voiceCloneError.set(this.t("audioFileTooLarge"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0),this.voiceCloneError.set("");try{let s=new FileReader;s.onprogress=r=>{r.lengthComputable&&this.voiceUploadProgress.set(Math.round(r.loaded/r.total*50))},s.onload=async()=>{let r=s.result.split(",")[1],l=i.name.replace(/\.[^/.]+$/,"");this.ipcService.send("upload-voice-sample",{name:l,audioData:r,fileName:i.name,fileType:i.type}),this.voiceUploadProgress.set(100),setTimeout(()=>{let d={id:Date.now().toString(),name:l,audioPath:i.name,promptText:"",createdAt:new Date};this.clonedVoices.update(u=>[...u,d]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3)},500)},s.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},s.readAsDataURL(i)}catch(s){this.voiceCloneError.set(s.message),this.isUploadingVoice.set(!1)}t.value=""}selectClonedVoice(e){this.selectedClonedVoice.set(e);let t=this.clonedVoices().find(i=>i.id===e);t&&this.ttsVoice.set(t.audioPath)}deleteClonedVoice(e){this.clonedVoices.update(t=>t.filter(i=>i.id!==e)),this.selectedClonedVoice()===e&&(this.selectedClonedVoice.set(""),this.ttsVoice.set("")),this.saveClonedVoicesToStorage(),this.ipcService.send("delete-voice-sample",{voiceId:e}),this.toastService.success(this.t("voiceDeleted"),2e3)}async previewClonedVoice(e){let t=this.clonedVoices().find(i=>i.id===e);t&&this.ipcService.send("preview-voice-sample",{voiceId:e,audioPath:t.audioPath})}async generateWithClonedVoice(e){let t=this.ttsEndpoint(),i=this.selectedClonedVoice();if(!t){this.toastService.error(this.t("ttsEndpointRequired"),2e3);return}if(!i){this.toastService.error(this.t("selectVoiceFirst"),2e3);return}let o=this.clonedVoices().find(s=>s.id===i);o&&this.ipcService.send("generate-cloned-voice",{endpoint:t,text:e,voiceId:i,audioPath:o.audioPath})}saveClonedVoicesToStorage(){let e=this.clonedVoices().map(t=>N(M({},t),{createdAt:t.createdAt.toISOString()}));localStorage.setItem("cloned_voices",JSON.stringify(e))}loadClonedVoicesFromStorage(){let e=localStorage.getItem("cloned_voices");if(e)try{let t=JSON.parse(e).map(i=>N(M({},i),{createdAt:new Date(i.createdAt)}));this.clonedVoices.set(t)}catch(t){console.error("Failed to load cloned voices:",t)}}openRecordingDialog(){this.showRecordingDialog.set(!0),this.voiceName.set(""),this.voicePromptText.set(""),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.voiceCloneError.set(""),this.recordingTime.set(0)}closeRecordingDialog(){this.stopRecording(),this.showRecordingDialog.set(!1),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl())}async startRecording(){try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:44100,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});this.audioChunks=[],this.mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"}),this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.onstop=()=>{let t=new Blob(this.audioChunks,{type:"audio/webm"});this.recordedAudioBlob.set(t),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioUrl.set(URL.createObjectURL(t)),e.getTracks().forEach(i=>i.stop())},this.mediaRecorder.start(100),this.isRecording.set(!0),this.recordingTime.set(0),this.recordingTimer=setInterval(()=>{this.recordingTime.update(t=>t+1),this.recordingTime()>=10&&this.stopRecording()},1e3)}catch(e){console.error("Recording error:",e),this.voiceCloneError.set(this.t("microphoneAccessDenied"))}}stopRecording(){this.mediaRecorder&&this.isRecording()&&(this.mediaRecorder.stop(),this.isRecording.set(!1),this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null))}async confirmAndUploadRecording(){let e=this.recordedAudioBlob(),t=this.voiceName().trim(),i=this.voicePromptText().trim();if(!t){this.voiceCloneError.set(this.t("voiceNameRequired"));return}if(!e){this.voiceCloneError.set(this.t("noRecordingToUpload"));return}let o=this.recordingTime();if(o<3){this.voiceCloneError.set(this.t("recordingTooShort"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0);try{let s=new FileReader;s.onprogress=r=>{r.lengthComputable&&this.voiceUploadProgress.set(Math.round(r.loaded/r.total*50))},s.onload=async()=>{let r=s.result.split(",")[1];this.ipcService.send("upload-voice-sample",{name:t,audioData:r,fileName:`${t}.webm`,fileType:"audio/webm",promptText:i,duration:o}),this.voiceUploadProgress.set(100);let l={id:Date.now().toString(),name:t,audioPath:`${t}.webm`,promptText:i,createdAt:new Date};this.clonedVoices.update(d=>[...d,l]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3),this.closeRecordingDialog()},s.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},s.readAsDataURL(e)}catch(s){this.voiceCloneError.set(s.message),this.isUploadingVoice.set(!1)}}resetRecording(){this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.recordingTime.set(0),this.voiceCloneError.set("")}loadAiSettings(){let e=localStorage.getItem("ai_api_key"),t=localStorage.getItem("ai_api_type"),i=localStorage.getItem("ai_custom_endpoint");e&&this.aiApiKey.set(e),t&&this.aiApiType.set(t),i&&this.customApiEndpoint.set(i);let o=localStorage.getItem("local_ai_endpoint"),s=localStorage.getItem("local_ai_model");o&&this.localAiEndpoint.set(o),s&&this.localAiModel.set(s);let r=localStorage.getItem("tts_endpoint"),l=localStorage.getItem("tts_enabled"),d=localStorage.getItem("tts_voice"),u=localStorage.getItem("stt_endpoint"),f=localStorage.getItem("stt_enabled");r&&this.ttsEndpoint.set(r),l&&this.ttsEnabled.set(l==="true"),d&&this.ttsVoice.set(d),u&&this.sttEndpoint.set(u),f&&this.sttEnabled.set(f==="true"),this.loadClonedVoicesFromStorage(),this.loadAiChatSettings()}},dd=Object.getOwnPropertyDescriptors(Br.prototype);var Or=class{toggleLeadSelection(e){this.selectedLeadIds.update(t=>{let i=new Set(t);return i.has(e)?i.delete(e):i.add(e),i}),this.isSelectAllLeads.set(this.selectedLeadIds().size===this.leads().length)}toggleSelectAllLeads(){if(this.isSelectAllLeads())this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1);else{let e=this.leads(),t=new Set(e.map(i=>i.id));this.selectedLeadIds.set(t),this.isSelectAllLeads.set(!0),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}}clearLeadSelection(){this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1),this.showBatchOperationMenu.set(!1)}isLeadSelected(e){return this.selectedLeadIds().has(e)}selectAllFilteredLeads(){let e=this.filteredLeads(),t=new Set(e.map(i=>i.id));this.selectedLeadIds.set(t),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}confirmDeleteLead(e){this.deleteConfirmDialog.set({show:!0,type:"single",lead:e})}confirmBatchDeleteLeads(){let e=this.selectedLeadsCount();if(e===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u522A\u9664\u7684\u5BA2\u6236");return}this.deleteConfirmDialog.set({show:!0,type:"batch",count:e})}executeDeleteLeads(){let e=this.deleteConfirmDialog();if(this.deleteConfirmDialog.set({show:!1,type:"single"}),e.type==="single"&&e.lead)this.ipcService.send("delete-lead",{leadId:e.lead.id}),this.leads.update(t=>t.filter(i=>i.id!==e.lead.id)),this.toastService.success(`\u5DF2\u522A\u9664\u5BA2\u6236 @${e.lead.username||e.lead.userId}`);else if(e.type==="batch"){let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u6C92\u6709\u9078\u4E2D\u7684\u5BA2\u6236");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-delete-leads",{leadIds:t}),this.leads.update(i=>i.filter(o=>!this.selectedLeadIds().has(o.id))),this.toastService.success(`\u6B63\u5728\u522A\u9664 ${t.length} \u500B\u5BA2\u6236...`),this.clearLeadSelection()}}cancelDeleteLeads(){this.deleteConfirmDialog.set({show:!1,type:"single"})}exportSelectedLeads(){let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u5C0E\u51FA\u7684\u5BA2\u6236");return}let t=this.leads().filter(u=>e.includes(u.id)),i=["ID","\u7528\u6236\u540D","\u59D3\u540D","\u72C0\u614B","\u4F86\u6E90","\u95DC\u9375\u8A5E","\u6642\u9593"],o=t.map(u=>[u.userId,u.username||"",`${u.firstName||""} ${u.lastName||""}`.trim(),u.status,u.sourceGroup,u.triggeredKeyword,new Date(u.timestamp).toLocaleString()]),s=[i.join(","),...o.map(u=>u.join(","))].join(`
`),r=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(r),d=document.createElement("a");d.href=l,d.download=`leads_export_${new Date().toISOString().slice(0,10)}.csv`,d.click(),URL.revokeObjectURL(l),this.toastService.success(`\u5DF2\u5C0E\u51FA ${t.length} \u500B\u5BA2\u6236`)}batchUpdateLeadStatus(e){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-lead-status",{leadIds:t,newStatus:e})}batchAddTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}if(!e||!e.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.batchOperationInProgress.set(!0),this.showBatchTagSelector.set(!1),this.ipcService.send("batch-add-tag",{leadIds:t,tag:e.trim()})}batchRemoveTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.ipcService.send("batch-remove-tag",{leadIds:t,tag:e})}batchAddToDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}confirm(`\u78BA\u5B9A\u8981\u5C07 ${e.length} \u500B Lead \u6DFB\u52A0\u5230 DNC \u5217\u8868\u55CE\uFF1F`)&&(this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-add-to-dnc",{leadIds:e}))}batchRemoveFromDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-remove-from-dnc",{leadIds:e})}batchUpdateFunnelStage(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-funnel-stage",{leadIds:t,newStage:e})}batchDeleteLeads(){if(!this.checkBatchOperationPermission())return;if(Array.from(this.selectedLeadIds()).length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.confirmBatchDeleteLeads()}undoBatchOperation(e){confirm("\u78BA\u5B9A\u8981\u64A4\u92B7\u6B64\u64CD\u4F5C\u55CE\uFF1F")&&this.ipcService.send("undo-batch-operation",{operationId:e})}loadBatchOperationHistory(){this.ipcService.send("get-batch-operation-history",{limit:50,offset:0}),this.showBatchOperationHistory.set(!0)}openBatchOperationMenu(){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u9EDE\u64CA\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),this.showLeadsActionMenu.set(!1);return}this.showBatchOperationMenu.set(!this.showBatchOperationMenu()),this.loadAllTags(),this.showLeadsActionMenu.set(!1)}loadAllTags(){this.ipcService.send("get-all-tags",{})}createTag(){let e=this.newTagName().trim();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.ipcService.send("create-tag",{name:e,color:this.newTagColor()}),this.newTagName.set(""),this.showAddTagDialog.set(!1)}deleteTag(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A19\u7C64 "${e}" \u55CE\uFF1F\u6B64\u6A19\u7C64\u5C07\u5F9E\u6240\u6709 Lead \u4E2D\u79FB\u9664\u3002`)&&this.ipcService.send("delete-tag",{name:e})}onLeadSearchInput(){this.leadSearchTimeout&&clearTimeout(this.leadSearchTimeout);let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.leadSearchTimeout=setTimeout(()=>{this.searchLeads()},500)}searchLeads(){let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.isSearchingLeads.set(!0),this.ipcService.send("search-leads",{query:e,limit:100})}clearLeadSearch(){this.leadSearchQuery.set(""),this.leadSearchResults.set([]),this.leadSearchTimeout&&(clearTimeout(this.leadSearchTimeout),this.leadSearchTimeout=null)}createBackup(){this.isCreatingBackup.set(!0),this.ipcService.send("create-backup",{name:`backup_${new Date().toISOString().replace(/[:.]/g,"-")}`,description:"Manual backup"})}loadBackups(){this.ipcService.send("list-backups",{})}restoreBackup(e){confirm("\u786E\u5B9A\u8981\u6062\u590D\u6B64\u5907\u4EFD\u5417\uFF1F\u5F53\u524D\u6570\u636E\u5C06\u88AB\u8986\u76D6\uFF01")&&(this.isRestoringBackup.set(!0),this.ipcService.send("restore-backup",{backupId:e}))}deleteBackup(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5907\u4EFD\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF01")&&this.ipcService.send("delete-backup",{backupId:e})}handleBatchOperationResult(e){if(this.batchOperationInProgress.set(!1),e.success){let t=e.successCount||0,i=e.failureCount||0;i>0?this.toastService.warning(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u6210\u529F, ${i} \u5931\u6557`):this.toastService.success(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u9805\u5DF2\u8655\u7406`),this.clearLeadSelection(),this.ipcService.send("get-initial-state",{})}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationProgress(e){this.progressDialog.set({show:!0,title:"\u6279\u91CF\u64CD\u4F5C\u9032\u884C\u4E2D...",progress:{current:e.current,total:e.total,message:e.message},cancellable:!1}),e.current>=e.total&&setTimeout(()=>{this.progressDialog.update(t=>N(M({},t),{show:!1}))},500)}handleBatchUndoResult(e){e.success?(this.toastService.success("\u64CD\u4F5C\u5DF2\u64A4\u92B7"),this.ipcService.send("get-initial-state",{}),this.loadBatchOperationHistory()):this.toastService.error(`\u64A4\u92B7\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationHistory(e){e.success&&this.batchOperationHistory.set(e.operations||[])}handleAllTags(e){e.success&&this.allTags.set(e.tags||[])}handleTagCreated(e){e.success?(this.toastService.success("\u6A19\u7C64\u5275\u5EFA\u6210\u529F"),this.loadAllTags()):this.toastService.error(`\u5275\u5EFA\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleTagDeleted(e){e.success?(this.toastService.success("\u6A19\u7C64\u5DF2\u522A\u9664"),this.loadAllTags()):this.toastService.error(`\u522A\u9664\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}getOperationTypeName(e){return{update_status:"\u66F4\u65B0\u72C0\u614B",add_tag:"\u6DFB\u52A0\u6A19\u7C64",remove_tag:"\u79FB\u9664\u6A19\u7C64",add_to_dnc:"\u6DFB\u52A0\u5230 DNC",remove_from_dnc:"\u5F9E DNC \u79FB\u9664",update_funnel_stage:"\u66F4\u65B0\u6F0F\u6597\u968E\u6BB5",delete:"\u522A\u9664"}[e]||e}formatBatchOperationDate(e){return new Date(e).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}loadAdTemplates(){this.ipcService.send("get-ad-templates",{activeOnly:!1})}loadAdSchedules(){this.ipcService.send("get-ad-schedules",{activeOnly:!1})}loadAdSendLogs(){this.ipcService.send("get-ad-send-logs",{limit:100})}loadAdOverviewStats(){this.ipcService.send("get-ad-overview-stats",{days:7})}loadAdSystemData(){this.loadAdTemplates(),this.loadAdSchedules(),this.loadAdOverviewStats()}createAdTemplate(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdTemplate();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31");return}if(!e.content.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9");return}this.ipcService.send("create-ad-template",{name:e.name,content:e.content,mediaType:e.mediaType}),this.newAdTemplate.set({name:"",content:"",mediaType:"text"}),this.showAdTemplateForm.set(!1)}deleteAdTemplate(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u6A21\u677F\u55CE\uFF1F")&&this.ipcService.send("delete-ad-template",{templateId:e})}toggleAdTemplateStatus(e){this.ipcService.send("toggle-ad-template-status",{templateId:e})}previewSpintax(e){if(!e.trim()){this.spintaxPreview.set([]);return}this.isPreviewingSpintax.set(!0),this.ipcService.send("validate-spintax",{content:e})}createAdSchedule(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdSchedule();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u8A08\u5283\u540D\u7A31");return}if(!e.templateId){this.toastService.warning("\u8ACB\u9078\u64C7\u5EE3\u544A\u6A21\u677F");return}if(e.targetGroups.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u76EE\u6A19\u7FA4\u7D44");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.ipcService.send("create-ad-schedule",e),this.newAdSchedule.set({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]}),this.showAdScheduleForm.set(!1)}deleteAdSchedule(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u8A08\u5283\u55CE\uFF1F")&&this.ipcService.send("delete-ad-schedule",{scheduleId:e})}toggleAdScheduleStatus(e){this.ipcService.send("toggle-ad-schedule-status",{scheduleId:e})}runAdScheduleNow(e){confirm("\u78BA\u5B9A\u8981\u7ACB\u5373\u57F7\u884C\u6B64\u8A08\u5283\u55CE\uFF1F")&&(this.ipcService.send("run-ad-schedule-now",{scheduleId:e}),this.toastService.info("\u6B63\u5728\u57F7\u884C..."))}getSendModeLabel(e){return{scheduled:"\u5B9A\u6642\u767C\u9001",triggered:"\u95DC\u9375\u8A5E\u89F8\u767C",relay:"\u63A5\u529B\u767C\u9001",interval:"\u9593\u9694\u5FAA\u74B0"}[e]||e}getScheduleTypeLabel(e){return{once:"\u4E00\u6B21\u6027",daily:"\u6BCF\u65E5",interval:"\u9593\u9694",cron:"Cron"}[e]||e}getAccountStrategyLabel(e){return{single:"\u55AE\u4E00\u5E33\u865F",rotate:"\u8F2A\u63DB\u5E33\u865F",relay:"\u63A5\u529B\u767C\u9001",random:"\u96A8\u6A5F\u9078\u64C7"}[e]||e}getAdStatusColor(e){return{sent:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",deleted:"bg-yellow-500/20 text-yellow-400",banned:"bg-red-600/20 text-red-500"}[e]||"bg-slate-500/20 text-slate-400"}toggleAccountForSchedule(e){this.newAdSchedule.update(t=>{let i=[...t.assignedAccounts],o=i.indexOf(e);return o>=0?i.splice(o,1):i.push(e),N(M({},t),{assignedAccounts:i})})}updateScheduleTargetGroups(e){let t=e.split(`
`).map(i=>i.trim()).filter(i=>i.length>0);this.newAdSchedule.update(i=>N(M({},i),{targetGroups:t}))}handleAdTemplates(e){e.success&&this.adTemplates.set(e.templates||[])}handleAdSchedules(e){e.success&&this.adSchedules.set(e.schedules||[])}handleAdSendLogs(e){e.success&&this.adSendLogs.set(e.logs||[])}handleAdOverviewStats(e){e.success&&this.adOverviewStats.set(e.overview||null)}handleAdTemplateCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u5275\u5EFA"),this.loadAdTemplates()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdTemplateDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u522A\u9664"),this.loadAdTemplates())}handleAdScheduleCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u5275\u5EFA"),this.loadAdSchedules()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdScheduleDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u522A\u9664"),this.loadAdSchedules())}handleSpintaxValidated(e){this.isPreviewingSpintax.set(!1),e.success||e.valid?this.spintaxPreview.set(e.variants||[]):(this.toastService.error(`Spintax \u8A9E\u6CD5\u932F\u8AA4: ${e.error}`),this.spintaxPreview.set([]))}handleAdScheduleRunResult(e){e.success?(this.toastService.success(`\u8A08\u5283\u57F7\u884C\u5B8C\u6210: ${e.sent||0} \u6210\u529F, ${e.failed||0} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()):this.toastService.error(`\u57F7\u884C\u5931\u6557: ${e.error}`)}loadTrackedUsers(){this.ipcService.send("get-tracked-users",{limit:100,valueLevel:this.userValueFilter()||void 0})}loadTrackingStats(){this.ipcService.send("get-tracking-stats",{})}loadHighValueGroups(){this.ipcService.send("get-high-value-groups",{limit:50})}loadUserTrackingData(){this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups()}addUserToTrack(){let e=this.newTrackedUser();if(!e.userId.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u7528\u6236 ID");return}this.ipcService.send("add-user-to-track",{userId:e.userId.trim(),username:e.username.trim()||void 0,notes:e.notes.trim()||void 0,source:"manual"}),this.newTrackedUser.set({userId:"",username:"",notes:""}),this.showAddUserForm.set(!1)}addLeadToTracking(e){this.ipcService.send("add-user-from-lead",{leadId:e})}removeTrackedUser(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u7528\u6236\u8FFD\u8E64\u55CE\uFF1F")&&this.ipcService.send("remove-tracked-user",{userId:e})}trackUserGroups(e){let t=this.accounts().filter(i=>i.status==="Online");if(t.length===0){this.toastService.warning("\u6C92\u6709\u5728\u7DDA\u5E33\u865F\u53EF\u7528\u65BC\u8FFD\u8E64");return}this.isTrackingUser.set(!0),this.ipcService.send("track-user-groups",{userId:e,accountPhone:t[0].phone})}viewUserGroups(e){this.selectedTrackedUser.set(e),this.ipcService.send("get-user-groups",{userId:e.userId})}updateUserValueLevel(e,t){this.ipcService.send("update-user-value-level",{userId:e,valueLevel:t})}getValueLevelLabel(e){return{vip:"VIP",high:"\u9AD8\u50F9\u503C",medium:"\u4E2D\u7B49",low:"\u4F4E"}[e]||e}getValueLevelColor(e){return{vip:"bg-purple-500/20 text-purple-400 border-purple-500/30",high:"bg-orange-500/20 text-orange-400 border-orange-500/30",medium:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",low:"bg-slate-500/20 text-slate-400 border-slate-500/30"}[e]||"bg-slate-500/20 text-slate-400"}getTrackingStatusLabel(e){return{pending:"\u5F85\u8FFD\u8E64",tracking:"\u8FFD\u8E64\u4E2D",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getTrackingStatusColor(e){return{pending:"bg-yellow-500/20 text-yellow-400",tracking:"bg-blue-500/20 text-blue-400",completed:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}handleTrackedUsers(e){e.success&&this.trackedUsers.set(e.users||[])}handleUserGroups(e){e.success&&this.userGroups.set(e.groups||[])}handleHighValueGroups(e){e.success&&this.highValueGroups.set(e.groups||[])}handleTrackingStats(e){e.success&&this.trackingStats.set(e.stats||null)}handleUserAddedToTrack(e){e.success?(this.toastService.success("\u7528\u6236\u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"),this.loadTrackedUsers()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}handleUserRemoved(e){e.success&&(this.toastService.success("\u7528\u6236\u5DF2\u79FB\u9664"),this.loadTrackedUsers())}handleUserTrackingCompleted(e){this.isTrackingUser.set(!1),e.success&&(this.toastService.success(`\u8FFD\u8E64\u5B8C\u6210: \u767C\u73FE ${e.groupsFound} \u500B\u7FA4\u7D44, ${e.highValueGroups} \u500B\u9AD8\u50F9\u503C`),this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups())}handleUserTrackingFailed(e){this.isTrackingUser.set(!1),this.toastService.error(`\u8FFD\u8E64\u5931\u6557: ${e.error}`),this.loadTrackedUsers()}loadCampaigns(){this.ipcService.send("get-campaigns",{limit:50})}loadUnifiedOverview(){this.ipcService.send("get-unified-overview",{days:7})}loadFunnelAnalysis(){this.ipcService.send("get-funnel-analysis",{})}loadCampaignData(){this.loadCampaigns(),this.loadUnifiedOverview(),this.loadFunnelAnalysis()}createCampaignFromForm(){if(!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.campaignFormData();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}this.ipcService.send("create-campaign",{name:e.name,description:e.description,phases:e.phases,keywords:e.keywords,targetGroups:e.targetGroups,assignedAccounts:e.assignedAccounts}),this.campaignFormData.set({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]}),this.showCampaignForm.set(!1)}startCampaign(e){confirm("\u78BA\u5B9A\u8981\u555F\u52D5\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("start-campaign",{campaignId:e})}pauseCampaign(e){this.ipcService.send("pause-campaign",{campaignId:e})}resumeCampaign(e){this.ipcService.send("resume-campaign",{campaignId:e})}stopCampaign(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("stop-campaign",{campaignId:e})}deleteCampaign(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("delete-campaign",{campaignId:e})}viewCampaignDetails(e){this.selectedCampaign.set(e),this.ipcService.send("get-campaign-logs",{campaignId:e.id})}getCampaignStatusLabel(e){return{draft:"\u8349\u7A3F",scheduled:"\u5DF2\u6392\u7A0B",running:"\u904B\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getCampaignStatusColor(e){return{draft:"bg-slate-500/20 text-slate-400",scheduled:"bg-blue-500/20 text-blue-400",running:"bg-green-500/20 text-green-400",paused:"bg-yellow-500/20 text-yellow-400",completed:"bg-cyan-500/20 text-cyan-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}getPhaseLabel(e){return{discovery:"\u8CC7\u6E90\u767C\u73FE",monitoring:"\u76E3\u63A7\u7372\u5BA2",outreach:"\u5EE3\u544A\u89F8\u9054",tracking:"\u7528\u6236\u8FFD\u8E64",conversion:"\u8F49\u5316\u6210\u4EA4"}[e]||e}toggleCampaignPhase(e){this.campaignFormData.update(t=>{let i=[...t.phases],o=i.indexOf(e);return o>=0?i.splice(o,1):i.push(e),N(M({},t),{phases:i})})}addCampaignKeyword(){let e=this.campaignKeywordInput().trim();e&&(this.campaignFormData.update(t=>N(M({},t),{keywords:[...t.keywords,e]})),this.campaignKeywordInput.set(""))}removeCampaignKeyword(e){this.campaignFormData.update(t=>N(M({},t),{keywords:t.keywords.filter(i=>i!==e)}))}toggleCampaignAccount(e){this.campaignFormData.update(t=>{let i=[...t.assignedAccounts],o=i.indexOf(e);return o>=0?i.splice(o,1):i.push(e),N(M({},t),{assignedAccounts:i})})}handleCampaigns(e){e.success&&this.campaigns.set(e.campaigns||[])}handleCampaignCreated(e){e.success?(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.loadCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleCampaignDeleted(e){e.success&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u522A\u9664"),this.loadCampaigns())}handleUnifiedOverview(e){e.success&&this.unifiedOverview.set(e)}handleFunnelAnalysis(e){e.success&&this.funnelAnalysis.set(e)}loadRoleTemplates(){this.ipcService.send("get-role-templates",{})}loadAllRoles(){this.ipcService.send("get-all-roles",{activeOnly:!0})}loadScriptTemplates(){this.ipcService.send("get-script-templates",{activeOnly:!0})}loadCollabGroups(){this.ipcService.send("get-collab-groups",{limit:50})}loadCollabStats(){this.ipcService.send("get-collab-stats",{})}loadRoleStats(){this.ipcService.send("get-role-stats",{})}loadMultiRoleData(){this.loadRoleTemplates(),this.loadAllRoles(),this.loadScriptTemplates(),this.loadCollabGroups(),this.loadCollabStats(),this.loadRoleStats()}assignRole(){let e=this.newRoleAssign();if(!e.accountPhone){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}if(!e.roleName.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31");return}this.ipcService.send("assign-role",{accountPhone:e.accountPhone,roleType:e.roleType,roleName:e.roleName}),this.newRoleAssign.set({accountPhone:"",roleType:"seller",roleName:""}),this.showRoleAssignForm.set(!1)}removeRole(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u89D2\u8272\u55CE\uFF1F")&&this.ipcService.send("remove-role",{roleId:e})}getRoleIcon(e){return{seller:"\u{1F9D1}\u200D\u{1F4BC}",expert:"\u{1F468}\u200D\u{1F52C}",satisfied:"\u{1F60A}",hesitant:"\u{1F914}",converted:"\u{1F389}",curious:"\u2753",manager:"\u{1F454}",support:"\u{1F6E0}\uFE0F"}[e]||"\u{1F464}"}getRoleLabel(e){return{seller:"\u92B7\u552E\u9867\u554F",expert:"\u5C08\u696D\u9867\u554F",satisfied:"\u6EFF\u610F\u5BA2\u6236",hesitant:"\u7336\u8C6B\u5BA2\u6236",converted:"\u6210\u4EA4\u5BA2\u6236",curious:"\u597D\u5947\u8005",manager:"\u7D93\u7406\u4E3B\u7BA1",support:"\u552E\u5F8C\u5BA2\u670D"}[e]||e}getScenarioLabel(e){return{group_conversion:"\u7FA4\u804A\u8F49\u5316",private_followup:"\u79C1\u804A\u8DDF\u9032",objection_handling:"\u7570\u8B70\u8655\u7406",product_intro:"\u7522\u54C1\u4ECB\u7D39",trust_building:"\u5EFA\u7ACB\u4FE1\u4EFB",urgency_creation:"\u88FD\u9020\u7DCA\u8FEB\u611F",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}getCollabStatusLabel(e){return{warming:"\u9810\u71B1\u4E2D",active:"\u6D3B\u8E8D\u4E2D",completed:"\u5DF2\u5B8C\u6210",archived:"\u5DF2\u6B78\u6A94"}[e]||e}getCollabStatusColor(e){return{warming:"bg-yellow-500/20 text-yellow-400",active:"bg-green-500/20 text-green-400",completed:"bg-blue-500/20 text-blue-400",archived:"bg-slate-500/20 text-slate-400"}[e]||"bg-slate-500/20 text-slate-400"}handleRoleTemplates(e){e.success&&this.roleTemplates.set(e.templates||{})}handleAllRoles(e){e.success&&this.allRoles.set(e.roles||[])}handleScriptTemplates(e){e.success&&this.scriptTemplates.set(e.templates||[])}handleCollabGroups(e){e.success&&this.collabGroups.set(e.groups||[])}handleCollabStats(e){e.success&&this.collabStats.set(e)}handleRoleStats(e){e.success&&this.roleStats.set(e)}},ud=Object.getOwnPropertyDescriptors(Or.prototype);var Gr=class{handleMemberSendMessage(e){let t=this.convertMemberToLead(e);this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.first_name||e.username||e.user_id}`)}handleMemberAddToFunnel(e){let t=this.leads().find(o=>o.userId===e.user_id);if(t){this.toastService.warning(`\u26A0\uFE0F ${e.first_name||e.username||e.user_id} \u5DF2\u5728\u92B7\u552E\u6F0F\u6597\u4E2D`),this.currentView.set("leads"),setTimeout(()=>this.openLeadDetailModal(t),100);return}let i=this.convertMemberToLead(e);this.ipcService.send("add-lead",{user_id:e.user_id,username:e.username,first_name:e.first_name,last_name:e.last_name,source_chat_title:e.source_chat_title,source_chat_id:e.source_chat_id,notes:`\u5F9E\u6210\u54E1\u8CC7\u6599\u5EAB\u6DFB\u52A0 (${e.value_level}\u7D1A)`}),this.leads.update(o=>[i,...o]),this.toastService.success(`\u2705 \u5DF2\u5C07 ${e.first_name||e.username||e.user_id} \u52A0\u5165\u92B7\u552E\u6F0F\u6597`),this.currentView.set("leads")}handleResourceSendMessage(e){let t={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:"New",onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.display_name||e.username||e.telegram_id}`)}handleResourceViewDetail(e){let t="New";e.status==="converted"?t="Closed-Won":e.status==="contacted"?t="Contacted":e.status==="interested"&&(t="Replied");let i={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:t,onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(i)}handleResourceBatchSend(e){if(e.length===0)return;let t=e.map(i=>({telegramId:i.telegram_id,username:i.username||"",firstName:i.first_name,lastName:i.last_name,displayName:i.display_name||i.first_name||i.username||i.telegram_id,groupName:i.source_name||i.source_chat_title||"",keyword:i.triggered_keyword||"",source:i.source_type||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u7528\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}handleBatchSendComplete(e){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u5931\u6557 ${e.failed}`)}closeBatchSendDialog(){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([])}openBatchSendForLeads(){let e=this.leads().filter(i=>this.selectedLeadIds().has(i.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u767C\u9001\u6D88\u606F\u7684\u5BA2\u6236");return}let t=e.map(i=>({telegramId:i.userId||String(i.id),username:i.username,firstName:i.firstName,lastName:i.lastName,displayName:i.firstName||i.username||"\u672A\u77E5",groupName:i.sourceGroup||"",keyword:i.triggeredKeyword||"",source:i.sourceType||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u5BA2\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}openBatchInviteForLeads(){let e=this.leads().filter(i=>this.selectedLeadIds().has(i.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u62C9\u7FA4\u7684\u5BA2\u6236");return}let t=e.map(i=>({telegramId:i.userId||String(i.id),username:i.username,firstName:i.firstName,displayName:i.firstName||i.username||"\u672A\u77E5"}));this.batchInviteTargets.set(t),this.showBatchInviteDialogState.set(!0),this.toastService.info(`\u{1F465} \u6E96\u5099\u5C07 ${e.length} \u500B\u5BA2\u6236\u62C9\u5165\u7FA4\u7D44`)}closeBatchInviteDialog(){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([])}handleBatchInviteComplete(e){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u8DF3\u904E ${e.skipped}\uFF0C\u5931\u6557 ${e.failed}`)}openMemberExtractionDialog(e){let t={id:String(e.id),name:e.name||e.title||"\u672A\u77E5\u7FA4\u7D44",url:e.url||"",telegramId:e.telegramId||e.telegram_id||"",memberCount:e.memberCount||e.member_count||0,accountPhone:e.accountPhone,resourceType:e.resourceType||e.resource_type||"group"};this.memberExtractionGroup.set(t),this.showMemberExtractionDialog.set(!0)}closeMemberExtractionDialog(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null)}closeMemberExtractionDialogUnified(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null),this.dialogService.closeMemberExtraction()}handleMemberCountRefreshed(e){console.log("[Frontend] Member count refreshed:",e);let t=this.memberExtractionGroup();t&&t.id===e.groupId&&this.memberExtractionGroup.set(N(M({},t),{memberCount:e.memberCount})),this.monitoredGroups.update(i=>i.map(o=>String(o.id)===e.groupId?N(M({},o),{memberCount:e.memberCount,member_count:e.memberCount}):o))}handleMemberExtractionStart(e){if(this.showMemberExtractionDialog.set(!1),this.monitoringGroupsRef)this.monitoringGroupsRef.executeExtraction({limit:e.config.limit,filters:e.config.filters,advanced:e.config.advanced});else{let t=e.group,i="";if(t.url){let o=t.url.match(/t\.me\/([+\w]+)/);o&&(i=o[1])}this.ipcService.send("extract-members",{chatId:i||t.url,username:i,telegramId:t.telegramId,resourceId:t.id,groupName:t.name,phone:e.config.accountPhone||t.accountPhone||null,limit:e.config.limit===-1?void 0:e.config.limit,filters:{bots:!e.config.filters.excludeBots,onlineStatus:e.config.filters.onlineStatus,offline:e.config.filters.onlineStatus==="offline",online:e.config.filters.onlineStatus==="online",chinese:e.config.filters.hasChinese,hasUsername:e.config.filters.hasUsername,isPremium:e.config.filters.isPremium,excludeAdmins:e.config.filters.excludeAdmins},autoSave:e.config.advanced.autoSaveToResources,skipDuplicates:e.config.advanced.skipDuplicates}),this.toastService.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${t.name} \u7684\u6210\u54E1...`)}}handleMonitoringConfigAction(e){switch(e){case"goto-resource-center":this.currentView.set("resource-center");break;case"goto-search-discovery":this.currentView.set("search-discovery");break;case"goto-accounts":this.currentView.set("monitoring-accounts");break;case"goto-keywords":this.currentView.set("keyword-sets");break;case"goto-templates":this.currentView.set("chat-templates");break;case"goto-triggers":this.currentView.set("trigger-rules");break;default:console.log("[Frontend] Unknown config action:",e)}}handleResourceSendToAISales(e){e.length!==0&&(this.ipcService.send("ai-team:add-targets",{targets:e.map(t=>({telegramId:t.telegram_id,username:t.username,displayName:t.display_name,sourceType:t.source_type}))}),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07 ${e.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165 AI \u92B7\u552E\u968A\u5217`))}handleResourceStatusChanged(e){if(!e.contacts.length)return;console.log("[Frontend] Syncing status change to leads:",e.contacts.length,"contacts, status:",e.status);let t=new Set(e.contacts.map(s=>s.telegram_id)),o={new:"New",contacted:"Contacted",interested:"Interested",negotiating:"Negotiating",converted:"Closed-Won",lost:"Closed-Lost",blocked:"Unsubscribed"}[e.status]||e.status;this.leads.update(s=>s.map(r=>t.has(String(r.userId))?N(M({},r),{status:o}):r)),this.ipcService.send("sync-resource-status-to-leads",{telegramIds:Array.from(t),status:o}),console.log("[Frontend] Status synced for",e.contacts.length,"contacts")}refreshLeadsData(){console.log("[Frontend] Refreshing leads data for resource center...");let e=this.leads();e.length>0&&(this.syncLeadsToResourceCenter(e),console.log("[Frontend] Synced current leads to resource center:",e.length)),this.leadsHasMore()&&!this.leadsLoading()?(this.loadRemainingLeads(),this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u66F4\u591A\u6578\u64DA... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3)):this.leadsLoading()?this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u4E2D... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3):this.toastService.success(`\u6578\u64DA\u5DF2\u540C\u6B65 (\u5171 ${e.length} \u689D)`)}handleCommandNavigation(e){if(!e.startsWith("action:")&&!e.startsWith("contact:")){this.currentView.set(e);return}if(e.startsWith("action:")){switch(e.replace("action:","")){case"send-message":this.toastService.info("\u8ACB\u5148\u9078\u64C7\u806F\u7E6B\u4EBA"),this.currentView.set("resource-center");break;case"extract-members":this.currentView.set("resource-center");break;case"search-groups":this.currentView.set("resource-center");break;case"start-monitor":this.startMonitoring();break;case"refresh":this.ipcService.send("get-initial-state"),this.toastService.success("\u6578\u64DA\u5DF2\u5237\u65B0");break;case"open-docs":window.open("https://docs.tg-matrix.com","_blank");break;case"show-shortcuts":this.toastService.info(`\u2318K \u6253\u958B\u547D\u4EE4\u9762\u677F
\u2318R \u5237\u65B0\u6578\u64DA
\u2318N \u6DFB\u52A0\u5E33\u865F`);break;case"open-feedback":this.toastService.info("\u8ACB\u767C\u9001\u90F5\u4EF6\u81F3 support@tg-matrix.com");break}return}if(e.startsWith("contact:")){let t=e.replace("contact:","");this.toastService.info(`\u6B63\u5728\u67E5\u770B\u806F\u7E6B\u4EBA ${t}`)}}handleMemberBatchSendMessage(e){if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let t=e.filter(i=>i.username);if(t.length===0){this.toastService.warning("\u6240\u9078\u6210\u54E1\u90FD\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u6D88\u606F");return}t.length<e.length&&this.toastService.warning(`${e.length-t.length} \u500B\u6210\u54E1\u6C92\u6709\u7528\u6236\u540D\uFF0C\u5C07\u88AB\u8DF3\u904E`),this.batchMessageTargets=t.map(i=>({userId:i.user_id,username:i.username,firstName:i.first_name,lastName:i.last_name,displayName:`${i.first_name||""} ${i.last_name||""}`.trim()||i.username})),this.showBatchMessageDialog.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${t.length} \u500B\u6210\u54E1\u767C\u9001\u6D88\u606F`)}handleNavigate(e){console.log("[Frontend] Navigate to:",e),this.currentView.set(e)}handleAIStrategyStart(e){console.log("[Frontend] AI Strategy started:",e),this.ipcService.send("execute-ai-strategy",{strategy:e}),this.currentView.set("automation"),this.toastService.success(`\u{1F680} AI \u7B56\u7565\u5DF2\u555F\u52D5: ${e.industry}`)}handleAIStrategyHandover(e){console.log("[Frontend] Handover strategy to AI Team:",e),this.aiTeamIncomingStrategy.set(e),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A: ${e.industry}`)}convertMemberToLead(e){return{id:parseInt(e.user_id)||Date.now(),userId:e.user_id,username:e.username,firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_chat_title,triggeredKeyword:"",timestamp:new Date(e.extracted_at||new Date),status:e.contacted?"Contacted":"New",onlineStatus:this.mapOnlineStatus(e.online_status),interactionHistory:[],doNotContact:!1,intentScore:this.mapValueLevelToScore(e.value_level),intentLevel:this.mapValueLevelToIntent(e.value_level),sourceType:"group_extract"}}mapOnlineStatus(e){switch(e){case"online":return"Online";case"recently":return"Recently";default:return"Offline"}}mapValueLevelToScore(e){switch(e){case"S":return 90;case"A":return 75;case"B":return 55;case"C":return 35;case"D":return 15;default:return 30}}mapValueLevelToIntent(e){switch(e){case"S":return"HOT";case"A":return"WARM";case"B":return"NEUTRAL";case"C":return"COLD";case"D":return"NONE";default:return"NEUTRAL"}}log(e,t){let i={id:Date.now(),timestamp:new Date,message:e,type:t};this.logs.update(o=>[i,...o].slice(0,100))}},md=Object.getOwnPropertyDescriptors(Gr.prototype);function pd(n){let e=[ld,cd,dd,ud,md];for(let i of e){let t=i,{constructor:o}=t,s=Lt(t,["constructor"]);Object.defineProperties(n.prototype,s)}}var j1=["onboardingRef"],eS=["monitoringGroupsRef"],tS=()=>[xo],nS=()=>[Eo],iS=()=>[To],oS=()=>[ao,import("./chunk-ZKLHGNQW.js").then(n=>n.PaymentComponent)];function sS(n,e){n&1&&(p(0,"p",12),m(1,"\u4F7F\u7528\u7DE9\u5B58\u6578\u64DA"),g())}function rS(n,e){if(n&1&&(p(0,"p",13),m(1),g()),n&2){let t=_(3);h(),k("",t.offlineCache.pendingOperations().length," \u500B\u5F85\u540C\u6B65\u64CD\u4F5C")}}function aS(n,e){if(n&1&&(p(0,"div",7),q(1,"div",8),p(2,"div",9)(3,"div",10)(4,"p",11),m(5,"\u{1F4F4} \u96E2\u7DDA\u6A21\u5F0F"),g(),T(6,sS,2,0,"p",12),T(7,rS,2,1,"p",13),g()()()),n&2){let t=_(2);h(6),A(t.offlineCache.isCacheValid()?6:-1),h(),A(t.offlineCache.hasPendingOperations()?7:-1)}}function lS(n,e){if(n&1&&(p(0,"div",7),q(1,"div",14),p(2,"div",9)(3,"div",10)(4,"p",15),m(5),g()()()()),n&2){let t=_(2);h(5),R(t.backendConnectionMessage())}}function cS(n,e){if(n&1){let t=F();p(0,"div",7)(1,"div",16),D("click",function(){b(t);let o=_(2);return S(o.retryConnection())}),g(),p(2,"div",9)(3,"div",10)(4,"p",17),m(5,"\u964D\u7D1A\u6A21\u5F0F\uFF08\u9EDE\u64CA\u91CD\u9023\uFF09"),g()()()()}}function dS(n,e){if(n&1){let t=F();p(0,"div",7)(1,"div",18),D("click",function(){b(t);let o=_(2);return S(o.retryConnection())}),g(),p(2,"div",9)(3,"div",10)(4,"p",19),m(5),g(),p(6,"p",12),m(7,"\u9EDE\u64CA\u91CD\u8A66"),g()()()()}if(n&2){let t=_(2);h(5),R(t.backendConnectionMessage())}}function uS(n,e){if(n&1&&(p(0,"div",1),T(1,aS,8,2,"div",7)(2,lS,6,1,"div",7)(3,cS,6,0,"div",7)(4,dS,8,1,"div",7),g()),n&2){let t=_();h(),A(t.offlineCache.isOnline()?t.backendConnectionState()==="connecting"?2:t.backendConnectionState()==="timeout"?3:t.backendConnectionState()==="error"?4:-1:1)}}function mS(n,e){if(n&1&&(p(0,"p",29),m(1),g()),n&2){let t,i=_(2);h(),R((t=i.successOverlayConfig())==null?null:t.subtitle)}}function pS(n,e){if(n&1&&(p(0,"div",2),q(1,"div",20),p(2,"div",21),q(3,"div",22),p(4,"div",23)(5,"div",24)(6,"div",25)(7,"span",26),m(8),g()()(),p(9,"div",27)(10,"h3",28),m(11),g(),T(12,mS,2,1,"p",29),g(),q(13,"div",30)(14,"div",31)(15,"div",32)(16,"div",33),g()()()),n&2){let t,i,o,s=_();h(8),R(((t=s.successOverlayConfig())==null?null:t.icon)||"\u2705"),h(3),R(((i=s.successOverlayConfig())==null?null:i.title)||"\u64CD\u4F5C\u6210\u529F"),h(),A((o=s.successOverlayConfig())!=null&&o.subtitle?12:-1)}}function gS(n,e){if(n&1){let t=F();p(0,"app-batch-send-dialog",34),D("closeDialog",function(){b(t);let o=_();return S(o.dialogService.closeBatchSend())})("sendComplete",function(o){b(t);let s=_();return S(s.handleBatchSendComplete(o))}),g()}if(n&2){let t=_();K("isOpen",t.dialogService.showBatchMessageDialog())("targets",t.dialogService.batchSendTargets())}}function hS(n,e){if(n&1){let t=F();p(0,"app-batch-invite-dialog",35),D("closeDialog",function(){b(t);let o=_();return S(o.dialogService.closeBatchInvite())})("inviteComplete",function(o){b(t);let s=_();return S(s.handleBatchInviteComplete(o))}),g()}if(n&2){let t=_();K("isOpen",t.dialogService.showBatchInviteDialog())("targets",t.dialogService.batchInviteTargets())("accounts",t.accounts())}}function fS(n,e){if(n&1){let t=F();p(0,"app-member-extraction-dialog",36),D("closeDialog",function(){b(t);let o=_();return S(o.closeMemberExtractionDialogUnified())})("startExtractionEvent",function(o){b(t);let s=_();return S(s.handleMemberExtractionStart(o))})("memberCountRefreshed",function(o){b(t);let s=_();return S(s.handleMemberCountRefreshed(o))}),g()}if(n&2){let t=_();K("isOpen",t.dialogService.showMemberExtractionDialog()||t.showMemberExtractionDialog())("group",t.dialogService.memberExtractionGroup()||t.memberExtractionGroup())}}function _S(n,e){n&1&&q(0,"app-payment")(1,"app-upgrade-prompt")}function vS(n,e){if(n&1){let t=F();p(0,"div",4)(1,"div",37),D("click",function(){b(t);let o=_();return S(o.closeQrLogin())}),g(),p(2,"div",38)(3,"app-qr-login",39),D("closed",function(){b(t);let o=_();return S(o.closeQrLogin())})("loginSuccess",function(o){b(t);let s=_();return S(s.onQrLoginSuccess(o))}),g()()()}}function CS(n,e){if(n&1){let t=F();p(0,"app-delete-confirm-dialog",103),D("cancel",function(){b(t);let o=_(2);return S(o.cancelDeleteLeads())})("confirm",function(){b(t);let o=_(2);return S(o.executeDeleteLeads())}),g()}if(n&2){let t=_(2);K("dialogData",t.deleteConfirmDialog())}}function yS(n,e){if(n&1){let t=F();p(0,"app-invite-group-dialog",104),D("close",function(){b(t);let o=_(2);return S(o.showInviteGroupDialog.set(!1))})("inviteToGroup",function(o){b(t);let s=_(2);return S(s.executeInviteToGroup(o))})("goCreateGroup",function(){b(t);let o=_(2);return o.currentView.set("multi-role"),S(o.showInviteGroupDialog.set(!1))}),g()}if(n&2){let t=_(2);K("groups",t.collabGroups())}}function bS(n,e){n&1&&(j(),p(0,"svg",106),q(1,"line",107)(2,"line",108),g())}function SS(n,e){n&1&&(j(),p(0,"svg",106),q(1,"line",109)(2,"line",110)(3,"line",111),g())}function xS(n,e){if(n&1){let t=F();p(0,"button",105),D("click",function(){b(t);let o=_(2);return S(o.toggleMobileMenu())}),T(1,bS,3,0,":svg:svg",106)(2,SS,4,0,":svg:svg",106),g()}if(n&2){let t=_(2);cn("aria-expanded",t.mobileMenuOpen())("aria-label",t.mobileMenuOpen()?"\u95DC\u9589\u9078\u55AE":"\u958B\u555F\u9078\u55AE"),h(),A(t.mobileMenuOpen()?1:2)}}function wS(n,e){if(n&1){let t=F();p(0,"div",112),D("click",function(){b(t);let o=_(2);return S(o.mobileMenuOpen.set(!1))}),g()}}function ES(n,e){if(n&1){let t=F();p(0,"button",113),D("click",function(){b(t);let o=_(2);return S(o.toggleSidebarCollapse())}),j(),p(1,"svg",114),q(2,"polyline",115),g()()}if(n&2){let t=_(2);K("title",t.sidebarCollapsed()?"\u5C55\u958B\u5074\u908A\u6B04":"\u6536\u7E2E\u5074\u908A\u6B04"),h(),V("rotate-180",t.sidebarCollapsed())}}function TS(n,e){if(n&1&&(p(0,"div")(1,"h1",116),m(2),g(),p(3,"p",117),m(4),g()()),n&2){let t=_(2);h(2),R(t.t("title")),h(2),R(t.t("subtitle"))}}function AS(n,e){n&1&&(p(0,"div",64),q(1,"app-notification-center"),g())}function DS(n,e){n&1&&(p(0,"div",65)(1,"div",118),q(2,"div",119),p(3,"div",120),q(4,"div",121)(5,"div",122),g()()())}function MS(n,e){n&1&&(p(0,"span",137),m(1,"\u{1F948}"),g())}function IS(n,e){n&1&&(p(0,"span",137),m(1,"\u{1F947}"),g())}function kS(n,e){n&1&&(p(0,"span",137),m(1,"\u{1F48E}"),g())}function PS(n,e){n&1&&(p(0,"span",137),m(1,"\u{1F31F}"),g())}function NS(n,e){n&1&&(p(0,"span",138),m(1,"\u{1F451}"),g())}function RS(n,e){if(n&1&&(p(0,"div",136),T(1,MS,2,0,"span",137)(2,IS,2,0,"span",137)(3,kS,2,0,"span",137)(4,PS,2,0,"span",137)(5,NS,2,0,"span",138),g()),n&2){let t,i=_(3);V("badge-silver",i.userMembershipLevel()==="silver")("badge-gold",i.userMembershipLevel()==="gold")("badge-diamond",i.userMembershipLevel()==="diamond")("badge-star",i.userMembershipLevel()==="star")("badge-king",i.userMembershipLevel()==="king"),h(),A((t=i.userMembershipLevel())==="silver"?1:t==="gold"?2:t==="diamond"?3:t==="star"?4:t==="king"?5:-1)}}function FS(n,e){if(n&1){let t=F();p(0,"div",123),D("click",function(){b(t);let o=_(2);return S(o.changeView("profile"))}),p(1,"div",124)(2,"div",125),q(3,"div",126),p(4,"div",127)(5,"div",128),m(6),g()(),T(7,RS,6,11,"div",129),g(),p(8,"div",120)(9,"div",130),m(10),g(),p(11,"div",131),q(12,"user-level-badge",132),g()(),p(13,"div",133),j(),p(14,"svg",134),q(15,"polyline",135),g()()()()}if(n&2){let t,i,o,s,r=_(2);V("level-bronze",r.userMembershipLevel()==="bronze")("level-silver",r.userMembershipLevel()==="silver")("level-gold",r.userMembershipLevel()==="gold")("level-diamond",r.userMembershipLevel()==="diamond")("level-star",r.userMembershipLevel()==="star")("level-king",r.userMembershipLevel()==="king"),h(3),V("glow-bronze",r.userMembershipLevel()==="bronze")("glow-silver",r.userMembershipLevel()==="silver")("glow-gold",r.userMembershipLevel()==="gold")("glow-diamond",r.userMembershipLevel()==="diamond")("glow-star",r.userMembershipLevel()==="star")("glow-king",r.userMembershipLevel()==="king"),h(),V("border-bronze",r.userMembershipLevel()==="bronze")("border-silver",r.userMembershipLevel()==="silver")("border-gold",r.userMembershipLevel()==="gold")("border-diamond",r.userMembershipLevel()==="diamond")("border-star",r.userMembershipLevel()==="star")("border-king",r.userMembershipLevel()==="king"),h(),V("avatar-bronze",r.userMembershipLevel()==="bronze")("avatar-silver",r.userMembershipLevel()==="silver")("avatar-gold",r.userMembershipLevel()==="gold")("avatar-diamond",r.userMembershipLevel()==="diamond")("avatar-star",r.userMembershipLevel()==="star")("avatar-king",r.userMembershipLevel()==="king"),h(),k(" ",((((t=r.currentUser())==null?null:t.displayName)||((i=r.currentUser())==null?null:i.display_name)||((o=r.currentUser())==null?null:o.username))==null?null:(((t=t)==null?null:t.displayName)||((i=i)==null?null:i.display_name)||((o=o)==null?null:o.username)).charAt(0).toUpperCase())||"?"," "),h(),A(r.userMembershipLevel()!=="bronze"?7:-1),h(3),k(" ",((s=r.currentUser())==null?null:s.displayName)||((s=r.currentUser())==null?null:s.display_name)||((s=r.currentUser())==null?null:s.username)||"\u7528\u6236"," "),h(2),K("level",r.userMembershipLevel())}}function LS(n,e){if(n&1){let t=F();p(0,"div",82)(1,"a",139),D("click",function(){b(t);let o=_(2);return S(o.changeView("accounts"))}),j(),p(2,"svg",69),q(3,"path",140)(4,"circle",141)(5,"path",142)(6,"path",143),g(),ce(),p(7,"span"),m(8),g()(),p(9,"a",144),D("click",function(){b(t);let o=_(2);return S(o.changeView("search-discovery"))}),j(),p(10,"svg",69),q(11,"circle",145)(12,"path",146),g(),ce(),p(13,"span"),m(14),g(),p(15,"span",147),m(16,"NEW"),g()(),p(17,"a",148),D("click",function(){b(t);let o=_(2);return S(o.changeView("resource-center"))}),j(),p(18,"svg",69),q(19,"ellipse",149)(20,"path",150)(21,"path",151),g(),ce(),p(22,"span"),m(23),g()(),p(24,"a",68),D("click",function(){b(t);let o=_(2);return S(o.changeView("leads"))}),j(),p(25,"svg",69),q(26,"path",152)(27,"path",153),g(),ce(),p(28,"span"),m(29),g()()()}if(n&2){_();let t=Ot(32),i=_();h(),me("background-color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-item-active)":"transparent")("color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-text-active)":"var(--sidebar-text)"),V("active",t==="accounts"||t==="add-account"||t==="api-credentials"),h(7),R(i.t("accounts")),h(),me("background-color",t==="search-discovery"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="search-discovery"?"#22d3ee":"var(--sidebar-text)"),V("active",t==="search-discovery"),h(5),R(i.t("menu.searchDiscovery")),h(3),me("background-color",t==="resource-center"||t==="resources"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="resource-center"||t==="resources"?"#22d3ee":"var(--sidebar-text)"),V("active",t==="resource-center"||t==="resources"),h(6),R(i.t("menu.resourceCenter")),h(),me("background-color",t==="leads"?"var(--sidebar-item-active)":"transparent")("color",t==="leads"?"var(--sidebar-text-active)":"var(--sidebar-text)"),V("active",t==="leads"),h(5),R(i.t("menu.sendConsole"))}}function VS(n,e){if(n&1){let t=F();p(0,"div",82)(1,"a",154),D("click",function(){b(t);let o=_(2);return S(o.changeView("automation"))}),p(2,"div",155)(3,"span",156),m(4,"\u{1F4CA}"),g()(),p(5,"div",157)(6,"span",158),m(7),g(),p(8,"span",159),m(9),g()()(),p(10,"a",160),D("click",function(){b(t);let o=_(2);return S(o.changeView("monitoring-accounts"))}),p(11,"span",161),m(12,"\u{1F4F1}"),g(),p(13,"span"),m(14),g()(),p(15,"a",160),D("click",function(){b(t);let o=_(2);return S(o.changeView("monitoring-groups"))}),p(16,"span",161),m(17,"\u{1F4AC}"),g(),p(18,"span"),m(19),g()(),p(20,"a",160),D("click",function(){b(t);let o=_(2);return S(o.changeView("keyword-sets"))}),p(21,"span",161),m(22,"\u{1F511}"),g(),p(23,"span"),m(24),g()(),p(25,"a",160),D("click",function(){b(t);let o=_(2);return S(o.changeView("chat-templates"))}),p(26,"span",161),m(27,"\u{1F4DD}"),g(),p(28,"span"),m(29),g()(),p(30,"a",160),D("click",function(){b(t);let o=_(2);return S(o.changeView("trigger-rules"))}),p(31,"span",161),m(32,"\u26A1"),g(),p(33,"span"),m(34),g()(),p(35,"a",160),D("click",function(){b(t);let o=_(2);return S(o.changeView("collected-users"))}),p(36,"span",161),m(37,"\u{1F465}"),g(),p(38,"span"),m(39),g(),p(40,"span",162),m(41,"NEW"),g()()()}if(n&2){_();let t=Ot(32),i=_();h(),me("background-color",t==="automation"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="automation"?"#22d3ee":"var(--sidebar-text)"),V("active",t==="automation"),h(),V("bg-gradient-to-br",t==="automation")("from-cyan-500",t==="automation")("to-blue-500",t==="automation")("bg-slate-700/50",t!=="automation")("group-hover:bg-slate-700",t!=="automation"),h(5),R(i.t("menu.automationOverview")),h(2),R(i.t("menu.configAndStatus")),h(),me("background-color",t==="monitoring-accounts"?"rgba(6, 182, 212, 0.1)":"transparent")("color",t==="monitoring-accounts"?"#22d3ee":"var(--sidebar-text)"),V("active",t==="monitoring-accounts"),h(4),R(i.t("menu.monitorAccounts")),h(),me("background-color",t==="monitoring-groups"?"rgba(16, 185, 129, 0.1)":"transparent")("color",t==="monitoring-groups"?"#34d399":"var(--sidebar-text)"),V("active",t==="monitoring-groups"),h(4),R(i.t("menu.monitorGroups")),h(),me("background-color",t==="keyword-sets"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="keyword-sets"?"#a78bfa":"var(--sidebar-text)"),V("active",t==="keyword-sets"),h(4),R(i.t("menu.keywordSets")),h(),me("background-color",t==="chat-templates"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="chat-templates"?"#f472b6":"var(--sidebar-text)"),V("active",t==="chat-templates"),h(4),R(i.t("menu.chatTemplates")),h(),me("background-color",t==="trigger-rules"?"rgba(251, 146, 60, 0.1)":"transparent")("color",t==="trigger-rules"?"#fb923c":"var(--sidebar-text)"),V("active",t==="trigger-rules"),h(4),R(i.t("menu.triggerRules")),h(),me("background-color",t==="collected-users"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="collected-users"?"#a78bfa":"var(--sidebar-text)"),V("active",t==="collected-users"),h(4),R(i.t("menu.collectedUsers"))}}function BS(n,e){n&1&&(p(0,"span",164),m(1,"1"),g())}function OS(n,e){n&1&&(p(0,"span",165),m(1,"\u{1F48E}"),g())}function GS(n,e){n&1&&(p(0,"span",167),m(1,"2"),g())}function US(n,e){n&1&&(p(0,"span",165),m(1,"\u{1F48E}"),g())}function qS(n,e){n&1&&(p(0,"span",168),m(1,"3"),g())}function $S(n,e){n&1&&(p(0,"span",165),m(1,"\u{1F947}"),g())}function HS(n,e){if(n&1){let t=F();p(0,"div",82)(1,"a",163),D("click",function(){b(t);let o=_(2);return S(o.changeView("ai-assistant"))}),p(2,"div",155)(3,"span",156),m(4,"\u{1F3AF}"),g()(),p(5,"div",157)(6,"span",158),m(7,"\u7B56\u7565\u898F\u5283"),g(),p(8,"span",159),m(9,"AI \u71DF\u92B7\u52A9\u624B"),g()(),T(10,BS,2,0,"span",164)(11,OS,2,0,"span",165),g(),p(12,"a",166),D("click",function(){b(t);let o=_(2);return S(o.changeView("ai-team"))}),p(13,"div",155)(14,"span",156),m(15,"\u{1F916}"),g()(),p(16,"div",157)(17,"span",158),m(18,"\u81EA\u52D5\u57F7\u884C"),g(),p(19,"span",159),m(20,"AI \u5718\u968A\u92B7\u552E"),g()(),T(21,GS,2,0,"span",167)(22,US,2,0,"span",165),g(),p(23,"a",166),D("click",function(){b(t);let o=_(2);return S(o.changeView("analytics"))}),p(24,"div",155)(25,"span",156),m(26,"\u{1F4CA}"),g()(),p(27,"div",157)(28,"span",158),m(29,"\u6578\u64DA\u6D1E\u5BDF"),g(),p(30,"span",159),m(31,"\u667A\u80FD\u5206\u6790\u5831\u544A"),g()(),T(32,qS,2,0,"span",168)(33,$S,2,0,"span",165),g()()}if(n&2){_();let t=Ot(32),i=_();h(),me("background-color",t==="ai-assistant"?"rgba(249, 115, 22, 0.15)":"transparent")("color",t==="ai-assistant"?"#fb923c":"var(--sidebar-text)"),V("active",t==="ai-assistant")("opacity-50",!i.membershipService.hasFeature("strategyPlanning")),K("title",i.membershipService.hasFeature("strategyPlanning")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),h(),V("bg-gradient-to-br",t==="ai-assistant")("from-orange-500",t==="ai-assistant")("to-amber-500",t==="ai-assistant")("bg-slate-700/50",t!=="ai-assistant")("group-hover:bg-slate-700",t!=="ai-assistant"),h(8),A(i.membershipService.hasFeature("strategyPlanning")?10:11),h(2),me("background-color",t==="ai-team"?"rgba(168, 85, 247, 0.15)":"transparent")("color",t==="ai-team"?"#c084fc":"var(--sidebar-text)"),V("active",t==="ai-team")("opacity-50",!i.membershipService.hasFeature("autoExecution")),K("title",i.membershipService.hasFeature("autoExecution")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),h(),V("bg-gradient-to-br",t==="ai-team")("from-purple-500",t==="ai-team")("to-pink-500",t==="ai-team")("bg-slate-700/50",t!=="ai-team")("group-hover:bg-slate-700",t!=="ai-team"),h(8),A(i.membershipService.hasFeature("autoExecution")?21:22),h(2),me("background-color",t==="analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics"?"#22d3ee":"var(--sidebar-text)"),V("active",t==="analytics")("opacity-50",!i.membershipService.hasFeature("dataInsightsBasic")),K("title",i.membershipService.hasFeature("dataInsightsBasic")?"":"\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),h(),V("bg-gradient-to-br",t==="analytics")("from-cyan-500",t==="analytics")("to-blue-500",t==="analytics")("bg-slate-700/50",t!=="analytics")("group-hover:bg-slate-700",t!=="analytics"),h(8),A(i.membershipService.hasFeature("dataInsightsBasic")?32:33)}}function KS(n,e){n&1&&(p(0,"span",176),m(1,"\u{1F48E}"),g())}function WS(n,e){if(n&1){let t=F();p(0,"div",82)(1,"a",68),D("click",function(){b(t);let o=_(2);return S(o.changeView("analytics-center"))}),j(),p(2,"svg",69),q(3,"path",169)(4,"path",170)(5,"path",171),g(),ce(),p(6,"span"),m(7,"\u5206\u6790\u4E2D\u5FC3"),g()(),p(8,"a",68),D("click",function(){b(t);let o=_(2);return S(o.changeView("lead-nurturing"))}),j(),p(9,"svg",69),q(10,"path",172)(11,"circle",173),g(),ce(),p(12,"span"),m(13,"\u5BA2\u6236\u57F9\u80B2"),g(),p(14,"span",174),m(15,"AI"),g()(),p(16,"a",175),D("click",function(){b(t);let o=_(2);return o.changeView("multi-role"),S(o.loadMultiRoleData())}),j(),p(17,"svg",69),q(18,"path",140)(19,"circle",141)(20,"path",142)(21,"path",143),g(),ce(),p(22,"span"),m(23,"\u591A\u89D2\u8272\u5354\u4F5C"),g(),T(24,KS,2,0,"span",176),g()()}if(n&2){_();let t=Ot(32),i=_();h(),me("background-color",t==="analytics-center"||t==="nurturing-analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics-center"||t==="nurturing-analytics"?"#22d3ee":"var(--sidebar-text)"),V("active",t==="analytics-center"||t==="nurturing-analytics"),h(7),me("background-color",t==="lead-nurturing"?"rgba(236, 72, 153, 0.15)":"transparent")("color",t==="lead-nurturing"?"#f472b6":"var(--sidebar-text)"),V("active",t==="lead-nurturing"),h(8),me("background-color",t==="multi-role"?"rgba(99, 102, 241, 0.15)":"transparent")("color",t==="multi-role"?"#a5b4fc":i.membershipService.hasFeature("multiRole")?"var(--sidebar-text)":"var(--sidebar-text-muted)"),V("active",t==="multi-role")("opacity-50",!i.membershipService.hasFeature("multiRole"))("cursor-not-allowed",!i.membershipService.hasFeature("multiRole")),K("title",i.membershipService.hasFeature("multiRole")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),h(8),A(i.membershipService.hasFeature("multiRole")?-1:24)}}function zS(n,e){if(n&1&&(p(0,"span",180),m(1),g()),n&2){let t=_(3);h(),R(t.ragBrainService.gapsCount())}}function JS(n,e){if(n&1){let t=F();p(0,"div",82)(1,"a",177),D("click",function(){b(t);let o=_(2);return S(o.changeView("ai-engine"))}),j(),p(2,"svg",69),q(3,"path",178),g(),ce(),p(4,"span",179),m(5),g(),T(6,zS,2,1,"span",180),g()()}if(n&2){let t=_(2);h(),me("background-color",t.isAiEngineView()?"rgba(168, 85, 247, 0.15)":"transparent")("color",t.isAiEngineView()?"#c084fc":"var(--sidebar-text)"),V("active",t.isAiEngineView()),h(4),R(t.t("aiEngine")),h(),A(t.ragBrainService.gapsCount()>0?6:-1)}}function QS(n,e){if(n&1){let t=F();p(0,"div",82)(1,"a",68),D("click",function(){b(t);let o=_(2);return S(o.changeView("settings"))}),j(),p(2,"svg",69),q(3,"circle",181)(4,"path",182),g(),ce(),p(5,"span"),m(6),g()()()}if(n&2){_();let t=Ot(32),i=_();h(),me("background-color",t==="settings"?"var(--sidebar-item-active)":"transparent")("color",t==="settings"?"var(--sidebar-text-active)":"var(--sidebar-text)"),V("active",t==="settings"),h(5),R(i.t("settings"))}}function YS(n,e){if(n&1){let t=F();p(0,"app-lead-detail-dialog",183),D("close",function(){b(t);let o=_(2);return S(o.closeLeadDetailModal())})("generateMsg",function(){b(t);let o=_(2);return S(o.generateMessage())})("sendMsg",function(){b(t);let o=_(2);return S(o.sendMessageToLead())})("loadHistory",function(o){b(t);let s=_(2);return S(s.loadChatHistory(o))})("loadMoreHistory",function(){b(t);let o=_(2);return S(o.loadMoreChatHistory())})("historyScroll",function(o){b(t);let s=_(2);return S(s.onChatHistoryScroll(o))})("selectAttach",function(o){b(t);let s=_(2);return S(s.selectAttachment(o.type,o.multi))})("addMoreAttach",function(o){b(t);let s=_(2);return S(s.addMoreAttachments(o))})("clearAttach",function(){b(t);let o=_(2);return S(o.clearAllAttachments())})("removeAttach",function(o){b(t);let s=_(2);return S(s.removeAttachmentByIndex(o))})("applyTmpl",function(o){b(t);let s=_(2);return S(s.applyTemplate(o))})("updatePrompt",function(o){b(t);let s=_(2);return S(s.updateCustomPrompt(o))})("addDnc",function(o){b(t);let s=_(2);return S(s.addToDoNotContact(o))})("editableMsgChange",function(o){b(t);let s=_(2);return S(s.editableMessage.set(o))})("msgModeChange",function(o){b(t);let s=_(2);return S(s.messageMode.set(o))})("senderChange",function(o){b(t);let s=_(2);return S(s.selectedSenderId.set(o))})("viewChange",function(o){b(t);let s=_(2);return S(s.leadDetailView.set(o))})("navigateTo",function(o){b(t);let s=_(2);return S(s.currentView.set(o))}),g()}if(n&2){let t=_(2);K("lead",e)("generationState",t.generationState())("leadDetailView",t.leadDetailView())("chatHistory",t.chatHistory())("editableMessage",t.editableMessage())("messageMode",t.messageMode())("senderAccounts",t.senderAccounts())("selectedSenderId",t.selectedSenderId())("selectedChatUserId",t.selectedChatUserId())("chatHistoryHasMore",t.chatHistoryHasMore())("chatHistoryLoadingMore",t.chatHistoryLoadingMore())("isLoadingChatHistory",t.isLoadingChatHistory())("isAiConfigured",t.isAiConfigured())("aiApiType",t.aiApiType())("messageTemplates",t.messageTemplates())("canSendMessage",t.canSendMessage())("ragEnabled",t.ragEnabled())}}function XS(n,e){if(n&1){let t=F();p(0,"app-batch-history-dialog",184),D("close",function(){b(t);let o=_(2);return S(o.showBatchOperationHistory.set(!1))})("undo",function(o){b(t);let s=_(2);return S(s.undoBatchOperation(o))}),g()}if(n&2){let t=_(2);K("history",t.batchOperationHistory())}}function ZS(n,e){if(n&1){let t=F();p(0,"app-welcome-dialog",185),D("skip",function(){b(t);let o=_(2);return S(o.skipFirstRunSetup())})("complete",function(){b(t);let o=_(2);return S(o.completeFirstRunSetup())})("stepChange",function(o){b(t);let s=_(2);return S(s.welcomeStep.set(o))})("detectOllamaClick",function(){b(t);let o=_(2);return S(o.detectOllama())})("localModelChange",function(o){b(t);let s=_(2);return S(s.localAiModel.set(o))})("autoFallbackChange",function(o){b(t);let s=_(2);return S(s.aiAutoFallback.set(o))})("backupProviderChange",function(o){b(t);let s=_(2);return S(s.aiBackupProvider.set(o))}),g()}if(n&2){let t=_(2);K("step",t.welcomeStep())("ollamaDetected",t.ollamaDetected())("isDetecting",t.isDetectingOllama())("ollamaModels",t.detectedOllamaModels())("localModel",t.localAiModel())("autoFallback",t.aiAutoFallback())("backupProvider",t.aiBackupProvider())}}function jS(n,e){if(n&1){let t=F();p(0,"app-orphan-session-dialog",186),D("dismiss",function(){b(t);let o=_(2);return S(o.dismissOrphanSessionDialog())})("recover",function(){b(t);let o=_(2);return S(o.recoverOrphanSessions())}),g()}if(n&2){let t=_(2);K("sessions",t.orphanSessions())("isRecovering",t.isRecoveringOrphanSessions())}}function ex(n,e){if(n&1){let t=F();p(0,"app-backend-error-dialog",187),D("close",function(){b(t);let o=_(2);return S(o.showBackendErrorDialog.set(!1))}),g()}if(n&2){let t=_(2);K("errorDetail",t.backendError())}}function tx(n,e){if(n&1){let t=F();p(0,"div",188),D("click",function(){b(t);let o=_(2);return S(o.showBackendErrorDialog.set(!0))}),p(1,"span",137),m(2,"\u26A0\uFE0F"),g(),p(3,"span",189),m(4,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),g()()}}function nx(n,e){if(n&1){let t=F();p(0,"app-keyword-creator-dialog",190),D("cancel",function(){b(t);let o=_(2);return S(o.cancelNewKeywordSet())})("submit",function(){b(t);let o=_(2);return S(o.submitNewKeywordSet())})("nameChange",function(o){b(t);let s=_(2);return S(s.newKeywordSet.set({name:o}))}),g()}if(n&2){let t=_(2);K("name",t.newKeywordSet().name)}}function ix(n,e){if(n&1){let t=F();p(0,"div",5)(1,"app-onboarding",40,0),D("navigateEvent",function(o){b(t);let s=_();return S(s.handleOnboardingNavigate(o))}),g(),q(3,"app-progress-dialog",41),T(4,CS,1,1,"app-delete-confirm-dialog",42),T(5,yS,1,1,"app-invite-group-dialog",43),T(6,xS,3,3,"button",44),T(7,wS,1,0,"div",45),p(8,"aside",46)(9,"div",47),T(10,ES,3,3,"button",48),p(11,"div",49)(12,"div",50),q(13,"div",51),j(),p(14,"svg",52),q(15,"path",53)(16,"path",54)(17,"path",55)(18,"path",56)(19,"circle",57),p(20,"defs")(21,"linearGradient",58),q(22,"stop",59)(23,"stop",60),g(),p(24,"linearGradient",61),q(25,"stop",62)(26,"stop",63),g()()()(),T(27,TS,5,2,"div"),g(),T(28,AS,2,0,"div",64),T(29,DS,6,0,"div",65)(30,FS,16,52,"div",66),g(),ce(),p(31,"nav",67),ea(32),p(33,"a",68),D("click",function(){b(t);let o=_();return S(o.changeView("membership-center"))}),j(),p(34,"svg",69),q(35,"polygon",70),g(),ce(),p(36,"span"),m(37),g()(),p(38,"a",68),D("click",function(){b(t);let o=_();return S(o.changeView("wallet"))}),j(),p(39,"svg",69),q(40,"rect",71)(41,"line",72),g(),ce(),p(42,"span"),m(43),g()(),p(44,"a",68),D("click",function(){b(t);let o=_();return S(o.changeView("dashboard"))}),j(),p(45,"svg",69),q(46,"rect",73)(47,"rect",74)(48,"rect",75)(49,"rect",76),g(),ce(),p(50,"span"),m(51),g()(),p(52,"div",77)(53,"button",78),D("click",function(){b(t);let o=_();return S(o.toggleSidebarGroup("manual"))}),p(54,"span",79),m(55),g(),j(),p(56,"svg",80),q(57,"polyline",81),g()(),T(58,LS,30,28,"div",82),g(),ce(),p(59,"div",77)(60,"button",78),D("click",function(){b(t);let o=_();return S(o.toggleSidebarGroup("monitoring"))}),p(61,"span",83)(62,"span",84),m(63,"\u{1F4E1}"),g(),m(64),g(),j(),p(65,"svg",80),q(66,"polyline",81),g()(),T(67,VS,42,60,"div",82),g(),ce(),p(68,"div",77)(69,"button",78),D("click",function(){b(t);let o=_();return S(o.toggleSidebarGroup("marketing"))}),p(70,"span",83)(71,"span",85),m(72,"AI"),g(),m(73),g(),j(),p(74,"svg",80),q(75,"polyline",81),g()(),T(76,HS,34,60,"div",82),g(),ce(),p(77,"div",77)(78,"button",78),D("click",function(){b(t);let o=_();return S(o.toggleSidebarGroup("analytics"))}),p(79,"span",79),m(80," \u{1F4CA} \u6578\u64DA\u5206\u6790 "),g(),j(),p(81,"svg",80),q(82,"polyline",81),g()(),T(83,WS,25,24,"div",82),g(),ce(),p(84,"div",77)(85,"button",78),D("click",function(){b(t);let o=_();return S(o.toggleSidebarGroup("ai"))}),p(86,"span",79),m(87),g(),j(),p(88,"svg",80),q(89,"polyline",81),g()(),T(90,JS,7,8,"div",82),g(),ce(),p(91,"div",77)(92,"button",78),D("click",function(){b(t);let o=_();return S(o.toggleSidebarGroup("system"))}),p(93,"span",79),m(94),g(),j(),p(95,"svg",80),q(96,"polyline",81),g()(),T(97,QS,7,7,"div",82),g()(),ce(),p(98,"div",86)(99,"button",87),D("click",function(){b(t);let o=_();return S(o.openOnboarding())}),p(100,"span",88),m(101,"\u2753"),g(),p(102,"span"),m(103),g()(),p(104,"div")(105,"label",89),m(106),g(),q(107,"app-language-switcher-compact"),g(),p(108,"div")(109,"label",89),m(110),g(),p(111,"div",90)(112,"button",91),D("click",function(){b(t);let o=_();return S(o.theme.set("light"))}),j(),p(113,"svg",92),q(114,"path",93),g()(),ce(),p(115,"button",91),D("click",function(){b(t);let o=_();return S(o.theme.set("dark"))}),j(),p(116,"svg",92),q(117,"path",94),g()()()()()(),ce(),p(118,"main",95),q(119,"router-outlet"),g(),T(120,YS,1,17,"app-lead-detail-dialog",96),T(121,XS,1,1,"app-batch-history-dialog",97),T(122,ZS,1,7,"app-welcome-dialog",98),T(123,jS,1,2,"app-orphan-session-dialog",99),T(124,ex,1,1,"app-backend-error-dialog",100),T(125,tx,5,0,"div",101),T(126,nx,1,1,"app-keyword-creator-dialog",102),g()}if(n&2){let t,i=_();h(3),K("show",i.progressDialog().show)("title",i.progressDialog().title)("progress",i.progressDialog().progress)("cancellable",i.progressDialog().cancellable),h(),A(i.deleteConfirmDialog().show?4:-1),h(),A(i.showInviteGroupDialog()?5:-1),h(),A(i.isMobile()?6:-1),h(),A(i.isMobile()&&i.mobileMenuOpen()?7:-1),h(),V("w-64",!i.sidebarCollapsed()||i.isMobile()&&i.mobileMenuOpen())("w-16",i.sidebarCollapsed()&&!i.isMobile())("mobile-sidebar-hidden",i.isMobile()&&!i.mobileMenuOpen())("mobile-sidebar-visible",i.isMobile()&&i.mobileMenuOpen()),h(2),A(i.isMobile()?-1:10),h(),V("justify-center",i.sidebarCollapsed()),h(16),A(i.sidebarCollapsed()?-1:27),h(),A(i.sidebarCollapsed()?-1:28),h(),A(i.currentUser()?30:29),h(3);let o=ta(i.currentView());h(),me("background-color",o==="membership-center"?"var(--sidebar-item-active)":"transparent")("color",o==="membership-center"?"var(--sidebar-text-active)":"var(--sidebar-text)"),V("active",o==="membership-center"),h(4),R(i.t("menu.membershipCenter")),h(),me("background-color",o==="wallet"?"var(--sidebar-item-active)":"transparent")("color",o==="wallet"?"var(--sidebar-text-active)":"var(--sidebar-text)"),V("active",o==="wallet"),h(5),R(i.t("menu.myWallet")),h(),me("background-color",o==="dashboard"?"var(--sidebar-item-active)":"transparent")("color",o==="dashboard"?"var(--sidebar-text-active)":"var(--sidebar-text)"),V("active",o==="dashboard"),h(7),R(i.t("dashboard")),h(4),k(" \u{1F527} ",i.t("menu.manualOperations")," "),h(),V("rotate-180",!i.isSidebarGroupExpanded("manual")),h(2),A(i.isSidebarGroupExpanded("manual")?58:-1),h(6),k(" ",i.t("menu.monitoringCenter")," "),h(),V("rotate-180",!i.isSidebarGroupExpanded("monitoring")),h(2),A(i.isSidebarGroupExpanded("monitoring")?67:-1),h(6),k(" ",i.t("menu.aiMarketing")," "),h(),V("rotate-180",!i.isSidebarGroupExpanded("marketing")),h(2),A(i.isSidebarGroupExpanded("marketing")?76:-1),h(5),V("rotate-180",!i.isSidebarGroupExpanded("analytics")),h(2),A(i.isSidebarGroupExpanded("analytics")?83:-1),h(4),k(" \u{1F9E0} ",i.t("aiIntelligence")," "),h(),V("rotate-180",!i.isSidebarGroupExpanded("ai")),h(2),A(i.isSidebarGroupExpanded("ai")?90:-1),h(4),k(" \u2699\uFE0F ",i.t("systemMonitor")," "),h(),V("rotate-180",!i.isSidebarGroupExpanded("system")),h(2),A(i.isSidebarGroupExpanded("system")?97:-1),h(6),R(i.t("menu.help")),h(3),R(i.t("language")),h(4),R(i.t("appearance")),h(2),me("background-color",i.theme()==="light"?"var(--bg-card)":"transparent")("color",i.theme()==="light"?"var(--primary)":"var(--text-muted)")("box-shadow",i.theme()==="light"?"var(--shadow-sm)":"none"),h(3),me("background-color",i.theme()==="dark"?"var(--primary-bg)":"transparent")("color",i.theme()==="dark"?"var(--primary)":"var(--text-muted)")("box-shadow",i.theme()==="dark"?"var(--shadow-sm)":"none"),h(3),V("pt-14",i.isMobile())("pl-0",i.isMobile()),h(2),A((t=i.generationState().lead)?120:-1,t),h(),A(i.showBatchOperationHistory()?121:-1),h(),A(i.showWelcomeDialog()?122:-1),h(),A(i.showOrphanSessionDialog()?123:-1),h(),A(i.showBackendErrorDialog()?124:-1),h(),A(i.backendRunning()?-1:125),h(),A(i.showKeywordSetCreator()?126:-1)}}function ox(n,e){n&1&&(p(0,"div",6),q(1,"router-outlet"),g())}var An=class n{constructor(){this.router=O(Bn);this.geminiService=O(ji);this.accountLoaderService=O(En);this.ipcService=O(Ie);this.offlineCache=O(en);this.swManager=O(vo);this.toastService=O(Ne);this.membershipService=O(mt);this.securityService=O(lo);this.loadingService=O(_o);this.contactsService=O(Ca);this.backupService=O(Ra);this.i18n=O(et);this.authService=O(Kn);this.webVitals=O(co);this.auditTracker=O(fo);this.navBridge=O(fa);this.navShortcuts=O(_a);this.unifiedNav=O(ha);this.sidebarState=O(Oo);this.navigationService=O(Sa);this.monitoringMgmt=O(va);this.leadMgmt=O(xa);this.campaignMgmt=O(ya);this.templateMgmt=O(ba);this.groupMgmt=O(wa);this.messageMgmt=O(Ea);this.facade=O(Ta);this.animationConfig=O(Aa);this.settingsService=O(Da);this.aiChatService=O(Ma);this.resourceService=O(Ia);this.exportService=O(ka);this.ragService=O(Pa);this.ragBrainService=O(La);this.vectorMemoryService=O(Na);this.schedulerService=O(Fa);this.dialogService=O(Wn);this.document=O(In);this.cdr=O(Rn);this.ngZone=O(je);this.membershipUpdateHandler=null;this.Math=Math;this.isAuthenticated=G(()=>this.authService.isAuthenticated());this.currentUser=G(()=>this.authService.user());this.userMembershipLevel=G(()=>this.authService.membershipLevel());this.t=(e,t)=>this.i18n.t(e,t);this.theme=v("dark");this.currentView=v("dashboard");this.dashboardMode=v("smart");this.useRouterMode=v(!0);this.navMode=v("classic");this.leadDetailView=v("sendMessage");this.leadsViewMode=v("kanban");this.leadStatusFilter=v("all");this.leadSourceFilter=v("all");this.leadSortBy=v("time");this.showLeadsViewMenu=v(!1);this.showLeadsActionMenu=v(!1);this.aiCenterTab=v("config");this.automationTab=v("targets");this.sidebarGroups=v({manual:!0,monitoring:!0,marketing:!0,analytics:!1,advanced:!1,ai:!0,system:!1});this.aiTeamIncomingStrategy=v(null);this.showBatchMessageDialogState=v(!1);this.batchSelectedLeads=v([]);this.batchSendTargets=v([]);this.showBatchInviteDialogState=v(!1);this.batchInviteTargets=v([]);this.migrationStatus=v({currentVersion:0,latestVersion:0,appliedCount:0,pendingCount:0,appliedMigrations:[],pendingMigrations:[]});this.isLoadingMigration=v(!1);this.isRunningMigration=v(!1);this.schedulerStatus=v({isRunning:!1,tasks:[]});this.schedulerTab=v("tasks");this.logFiles=v([]);this.logStats=v({totalFiles:0,totalSize:0,totalSizeFormatted:"0 B",compressedFiles:0,oldestFile:null,newestFile:null});this.isLoadingLogs=v(!1);this.isRotatingLogs=v(!1);this.selectedLogFile=v(null);this.logFileContent=v("");this.showResourceBatchMenu=v(!1);this.resourceBatchAction=v(null);this.showMembershipDialog=v(!1);this.settingsTab=v("backup");this.vectorMemoryStats=v({totalMemories:0,byType:{},totalUsers:0,avgImportance:0});this.vectorMemorySearchQuery="";this.vectorMemorySearchResults=v([]);this.isSearchingMemory=v(!1);this.isAddingMemory=v(!1);this.showAddMemoryDialog=v(!1);this.newMemory={userId:"",content:"",type:"conversation",importance:.5};this.selectedMemoryUserId=v("");this.memoryUserList=v([]);this.showVoiceRecordingDialog=v(!1);this.voiceCloneTab=v("manage");this.messageMode=v("manual");this.editableMessage=v("");this.selectedSenderId=v(null);this.aiApiKey=v("");this.aiApiType=v("gemini");this.customApiEndpoint=v("");this.showApiKey=v(!1);this.isTestingAi=v(!1);this.aiConnectionStatus=v(null);this.aiConnectionError=v("");this.localAiEndpoint=v("http://localhost:11434");this.localAiModel=v("qwen2:7b");this.localAiProvider=v("ollama");this.isTestingLocalAi=v(!1);this.localAiStatus=v(null);this.localAiError=v("");this.availableOllamaModels=v([]);this.aiAutoFallback=v(!0);this.aiBackupProvider=v("gemini");this.aiShowProviderLabel=v(!0);this.isFirstRun=v(!1);this.showWelcomeDialog=v(!1);this.welcomeStep=v(1);this.isDetectingOllama=v(!1);this.ollamaDetected=v(!1);this.detectedOllamaModels=v([]);this.autoSelectedModel=v("");this.backendRunning=v(!0);this.backendError=v("");this.showBackendErrorDialog=v(!1);this.showOrphanSessionDialog=v(!1);this.orphanSessions=v([]);this.isRecoveringOrphanSessions=v(!1);this.showMembershipStats=v(!1);this.ttsEndpoint=v("");this.ttsEnabled=v(!1);this.ttsVoice=v("");this.isTestingTts=v(!1);this.ttsStatus=v(null);this.ttsError=v("");this.sttEndpoint=v("");this.sttEnabled=v(!1);this.isTestingStt=v(!1);this.sttStatus=v(null);this.sttError=v("");this.aiAutoChatEnabled=v(!1);this.aiAutoChatMode=v("semi");this.aiTypingSpeed=v(50);this.aiReplyDelay=v([2,8]);this.aiSystemPrompt=v("");this.aiMaxContextMessages=v(20);this.aiEnableMemory=v(!0);this.aiAutoGreeting=v(!1);this.aiGreetingMessage=v("");this.ragEnabled=v(!0);this.aiGreetingSuggestion=v(null);this.showAiGreetingDialog=v(!1);this.knowledgeStats=v({documents:0,images:0,videos:0,qa_pairs:0});this.knowledgeDocuments=v([]);this.knowledgeImages=v([]);this.knowledgeVideos=v([]);this.knowledgeQaPairs=v([]);this.knowledgeTab=v("documents");this.isLoadingKnowledge=v(!1);this.showAddDocumentDialog=v(!1);this.showAddMediaDialog=v(!1);this.showAddQaDialog=v(!1);this.newDocument=v({title:"",category:"general",tags:"",content:""});this.newMedia=v({name:"",category:"general",description:"",mediaType:"image"});this.newQaPair=v({question:"",answer:"",category:"general",keywords:""});this.ragSystemInitialized=v(!1);this.isInitializingRag=v(!1);this.isRagLearning=v(!1);this.isReindexing=v(!1);this.isCleaningRag=v(!1);this.isSearchingRag=v(!1);this.ragSearchQuery="";this.ragSearchResults=v([]);this.ragStats=v({total_knowledge:0,qa_count:0,scripts_count:0,total_uses:0,avg_score:0,chromadb_enabled:!1,neural_embedding:!1,by_type:{}});this.showAddRagKnowledgeDialog=v(!1);this.newRagKnowledge={type:"qa",question:"",answer:"",context:""};this.ragTypeKeys=G(()=>Object.keys(this.ragStats().by_type));this.resourceDiscoveryInitialized=v(!1);this.isSearchingResources=v(!1);this.isProcessingJoinQueue=v(!1);this.resourceSearchQuery="";this.pendingSearchQuery="";this.resourceSearchType=v("all");this.searchError=v({hasError:!1,message:"",details:"",suggestions:[]});this.currentSearchSessionId=v("");this.currentSearchKeyword=v("");this.showSearchHistory=v(!1);this.searchHistoryKeywords=v([]);this.savedResources=v(new Set);this.showSearchSuggestions=v(!1);this.hotSearchKeywords=v(["\u652F\u4ED8","USDT","\u4EA4\u6613","\u62DB\u8058","\u4EE3\u8CFC","\u52A0\u5BC6\u8CA8\u5E63","\u96FB\u5F71","\u97F3\u6A02","\u8CC7\u6E90\u5206\u4EAB","\u4EA4\u6D41\u7FA4"]);this.resourceAccountId=v(null);this.showResourceAccountSelector=v(!1);this.resourceMinMembers=v(0);this.showSearchOptions=v(!1);this.searchReplaceMode=v(!0);this.isRefreshing=v(!1);this.linkAnalysisInput="";this.isAnalyzingLink=v(!1);this.discoveredResources=v([]);this.resourceStats=v({total_resources:0,by_status:{},by_type:{},today_discovered:0,pending_joins:0,joined_count:0,avg_score:0});this.discoveryKeywords=v([]);this.showAddResourceDialog=v(!1);this.showAddKeywordDialog=v(!1);this.showChannelManageDialog=v(!1);this.showAddChannelDialog=v(!1);this.newResourceKeyword="";this.systemChannels=v([]);this.customChannels=v([]);this.newChannelUsername="";this.newChannelDisplayName="";this.newChannelQueryFormat="{keyword}";this.newChannelPriority="backup";this.showJoinMonitorDialog=v(!1);this.joinMonitorResource=v(null);this.joinMonitorSelectedPhone=v("");this.joinMonitorSelectedPhones=v([]);this.joinMonitorKeywords=v([]);this.joinMonitorSelectedKeywordSetIds=v([]);this.joinMonitorNewKeyword="";this.joinMonitorAutoEnable=v(!0);this.joinMonitorBatchMode=v(!0);this.joinMonitorBatchInterval=v(45);this.isJoiningResource=v(!1);this.showQuickCreateKeywordSet=v(!1);this.quickCreateKeywordSetName="";this.showChangeMonitorAccount=v(!1);this.openResourceMenuId=v(null);this.quickCreateKeywordSetKeywords=v([]);this.quickCreateKeywordSetNewKeyword="";this.showBatchJoinMonitorDialog=v(!1);this.batchJoinResources=v([]);this.batchJoinProgress=v({current:0,total:0,status:""});this.showMemberListDialog=v(!1);this.memberListResource=v(null);this.memberListData=v([]);this.memberListLoading=v(!1);this.memberListProgress=v({extracted:0,total:0,status:""});this.selectedMemberIds=v([]);this.memberExtractStarted=v(!1);this.memberListFilter=v("all");this.memberExtractConfig=v({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}});this.extractPresets=[{id:"precise",name:"\u{1F3AF} \u7CBE\u6E96\u6D3B\u8E8D",desc:"\u73FE\u5728\u5728\u7DDA+\u6709\u7528\u6236\u540D",config:{activityFilters:{onlineNow:!0,within3Days:!0},accountFeatures:{hasUsername:!0}}},{id:"chinese",name:"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA\u512A\u5148",desc:"\u83EF\u4EBA+7\u5929\u5167\u6D3B\u8E8D",config:{userTypes:{chinese:!0},activityFilters:{within7Days:!0}}},{id:"premium",name:"\u{1F48E} \u9AD8\u50F9\u503C",desc:"Premium+\u6D3B\u8E8D\u7528\u6236",config:{accountFeatures:{premium:!0},activityFilters:{within7Days:!0}}},{id:"all",name:"\u{1F4E6} \u5168\u90E8\u63D0\u53D6",desc:"\u4E0D\u7BE9\u9078\uFF0C\u63D0\u53D6\u6240\u6709",config:{}}];this.selectedPreset=v("");this.showExtractionSummaryDialog=v(!1);this.extractionSummary=v({groupName:"",groupUrl:"",totalExtracted:0,totalInGroup:0,onlineCount:0,recentlyCount:0,premiumCount:0,chineseCount:0,hasUsernameCount:0,botCount:0,valueLevelDistribution:{S:0,A:0,B:0,C:0,D:0},extractedAt:"",duration:0});this.extractionStartTime=v(0);this.showMemberExtractionDialog=v(!1);this.memberExtractionGroup=v(null);this.showSingleMessageDialog=v(!1);this.singleMessageResource=v(null);this.singleMessageContent="";this.singleMessageScheduled=v(!1);this.singleMessageScheduleTime="";this.singleMessageAccountId=v("");this.accountQuotas=v([]);this.newChannelNotes="";this.isTestingChannel=v(!1);this.selectedResourceIds=v([]);this.resourceFilterStatus=v("");this.resourceFilterType=v("");this.resourceFilterLink=v("");this.selectedSearchSources=v(["telegram","jiso"]);this.showBatchJoinMenu=v(!1);this.searchResultsCache=new Map;this.CACHE_EXPIRY_MS=300*1e3;this.showBatchMessageDialog=v(!1);this.showBatchInviteDialog=v(!1);this.batchMessageContent="";this.batchMessageTargets=[];this.batchMessageConfig={delayMin:60,delayMax:120,dailyLimit:50,smartAntiBlock:!0,accountMode:"rotate",scheduled:!1,scheduleTime:""};this.batchInviteConfig={selectedMemberIds:[],selectAll:!1,delayMin:120,delayMax:300,perGroupLimit:10,smartAntiBlock:!0};this.availableMembersForInvite=v([]);this.discussionWatcherInitialized=v(!1);this.channelDiscussions=v([]);this.discussionMessages=v([]);this.discussionStats=v({total_discussions:0,monitoring_count:0,total_messages:0,matched_messages:0,leads_from_discussions:0,today_messages:0,today_leads:0});this.selectedDiscussionId=v("");this.discoverChannelId="";this.resourcesTab=v("resources");this.resourceCenterTab=v("manage");this.isLoadingDiscussionMessages=v(!1);this.discussionReplyText=v("");this.clonedVoices=v([]);this.selectedClonedVoice=v("");this.isUploadingVoice=v(!1);this.voiceUploadProgress=v(0);this.voiceCloneError=v("");this.isRecording=v(!1);this.recordingTime=v(0);this.recordingTimer=null;this.mediaRecorder=null;this.audioChunks=[];this.voicePromptText=v("");this.voiceName=v("");this.showRecordingDialog=v(!1);this.recordedAudioBlob=v(null);this.recordedAudioUrl=v("");this.accounts=v([]);this.keywordSets=v([]);this.monitoredGroups=v([]);this.leads=v([]);this.leadsTotal=v(0);this.leadsHasMore=v(!1);this.leadsLoading=v(!1);this.logs=v([]);this.selectedLeadForInvite=v(null);this.showInviteGroupDialog=v(!1);this.realtimeMatches=v([]);this.todayStats=v({matchCount:0,newLeads:0,messagesSent:0,conversions:0});this.chatList=v([]);this.chatHistory=v([]);this.selectedChatUserId=v(null);this.isLoadingChatHistory=v(!1);this.chatListSearch=v("");this.chatListFunnelFilter=v("");this.chatHistoryPage=v(0);this.chatHistoryPageSize=v(50);this.chatHistoryHasMore=v(!1);this.chatHistoryLoadingMore=v(!1);this.chatHistoryAllMessages=v([]);this.lastQueueStatusRefresh=0;this.queueStatuses=v({});this.queueMessages=v([]);this.selectedQueuePhone=v(null);this.queueStats=v({pending:0,sending:0,sent:0,failed:0,retrying:0,totalToday:0,successRate:0,avgSendTime:0});this.sendingStatsData=v(null);this.queueLengthHistoryData=v(null);this.accountComparisonData=v(null);this.campaignPerformanceData=v(null);this.alerts=v([]);this.unacknowledgedAlertsCount=G(()=>this.alerts().filter(e=>!e.acknowledged&&!e.resolved).length);this.selectedLeadIds=v(new Set);this.isSelectAllLeads=v(!1);this.showBatchOperationMenu=v(!1);this.showFloatingMoreMenu=v(!1);this.batchOperationInProgress=v(!1);this.batchOperationHistory=v([]);this.showBatchOperationHistory=v(!1);this.allTags=v([]);this.newTagName=v("");this.newTagColor=v("#3B82F6");this.showAddTagDialog=v(!1);this.batchTagInput=v("");this.showBatchTagSelector=v(!1);this.showBatchRemoveTagSelector=v(!1);this.leadSearchQuery=v("");this.leadSearchResults=v([]);this.isSearchingLeads=v(!1);this.leadSearchTimeout=null;this.backups=v([]);this.isCreatingBackup=v(!1);this.isRestoringBackup=v(!1);this.selectedLeadsCount=G(()=>this.selectedLeadIds().size);this.hasSelectedLeads=G(()=>this.selectedLeadIds().size>0);this.adTemplates=v([]);this.adSchedules=v([]);this.adSendLogs=v([]);this.adOverviewStats=v(null);this.showAdTemplateForm=v(!1);this.showAdScheduleForm=v(!1);this.editingAdTemplate=v(null);this.editingAdSchedule=v(null);this.newAdTemplate=v({name:"",content:"",mediaType:"text"});this.newAdSchedule=v({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]});this.spintaxPreview=v([]);this.isPreviewingSpintax=v(!1);this.adSystemTab=v("templates");this.trackedUsers=v([]);this.userGroups=v([]);this.highValueGroups=v([]);this.trackingStats=v(null);this.showAddUserForm=v(!1);this.newTrackedUser=v({userId:"",username:"",notes:""});this.selectedTrackedUser=v(null);this.isTrackingUser=v(!1);this.userTrackingTab=v("users");this.userValueFilter=v("");this.selectedCampaign=v(null);this.unifiedOverview=v(null);this.funnelAnalysis=v(null);this.showCampaignForm=v(!1);this.campaignKeywordInput=v("");this.campaignFormData=v({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]});this.roleTemplates=v({});this.allRoles=v([]);this.scriptTemplates=v([]);this.collabGroups=v([]);this.collabStats=v(null);this.roleStats=v(null);this.showRoleAssignForm=v(!1);this.multiRoleTab=v("roles");this.newRoleAssign=v({accountPhone:"",roleType:"seller",roleName:""});this.validationErrors=v({});this.progressDialog=v({show:!1,title:"\u5904\u7406\u4E2D...",progress:{current:0,total:0},cancellable:!1});this.logFilterType=v("");this.logFilterStartDate=v("");this.logFilterEndDate=v("");this.logFilterSearch=v("");this.filteredLogs=G(()=>{let e=this.logs(),t=this.logFilterType(),i=this.logFilterStartDate(),o=this.logFilterEndDate(),s=this.logFilterSearch();return e.filter(r=>{if(t&&r.type!==t)return!1;if(i){let l=new Date(i);if(r.timestamp<l)return!1}if(o){let l=new Date(o);if(l.setHours(23,59,59,999),r.timestamp>l)return!1}if(s){let l=s.toLowerCase();if(!r.message.toLowerCase().includes(l))return!1}return!0})});this.generationState=v({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]});this.messageTemplates=v([]);this.doNotContactList=v(new Set);this.campaigns=v([]);this.spintaxEnabled=v(!0);this.autoReplyEnabled=v(!1);this.autoReplyMessage=v("Thanks for getting back to me! I'll read your message and respond shortly.");this.smartSendingEnabled=v(!0);this.saveSettingsTimer=null;this.showPostJoinDialog=v(!1);this.postJoinResource=v(null);this.postJoinPhone=v("");this.showSuccessOverlay=v(!1);this.successOverlayConfig=v(null);this.newAccount=v({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""});this.newKeyword=v({setId:null,keyword:"",isRegex:!1});this.testKeywordText=v("");this.keywordTestResult=v(null);this.newKeywordSet=v({name:""});this.newGroup=v({url:"",keywordSetIds:[]});this.newTemplate=v({name:"",prompt:""});this.showTemplateCreator=v(!1);this.showKeywordSetCreator=v(!1);this.newCampaign=v(this.getEmptyCampaignForm());this.loginState=v({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1});this.loginCode=v("");this.login2FAPassword=v("");this.accountRoles=["Listener","Sender","Unassigned"];this.selectedAccountGroup=v("All");this.accountGroups=G(()=>["All",...new Set(this.accounts().map(e=>e.group).filter(Boolean))]);this.filteredAccounts=G(()=>{let e=this.accounts(),t=this.selectedAccountGroup();return t==="All"?e:e.filter(i=>i.group===t)});this.selectedAccounts=G(()=>this.accounts().filter(e=>e.selected));this.isAllAccountsSelected=G(()=>{let e=this.filteredAccounts();return e.length>0&&e.every(t=>t.selected)});this.listenerAccounts=G(()=>this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online"));this.senderAccounts=G(()=>this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up")));this.leadStatuses=["New","Contacted","Replied","Follow-up","Closed-Won","Closed-Lost"];this.openLeadMenuId=v(null);this.displayLeads=G(()=>this.leadSearchQuery().trim()&&this.leadSearchResults().length>0?this.leadSearchResults():this.leads());this.leadsByStatusMap=G(()=>{let e=this.displayLeads(),t=new Map;return this.leadStatuses.forEach(i=>t.set(i,[])),e.forEach(i=>{t.has(i.status)&&t.get(i.status).push(i)}),t});this.filteredLeads=G(()=>{let e=this.leadStatusFilter(),t=this.leadSourceFilter(),i=this.leadSortBy(),o=this.displayLeads();return e!=="all"&&(o=o.filter(s=>s.status===e)),t!=="all"&&(o=o.filter(s=>s.sourceType===t)),o.sort((s,r)=>i==="intent"?(r.intentScore||0)-(s.intentScore||0):i==="time"?new Date(r.timestamp).getTime()-new Date(s.timestamp).getTime():(s.username||"").localeCompare(r.username||""))});this.leadsBySource=G(()=>{let e=this.leads();return{group_extract:e.filter(t=>t.sourceType==="group_extract").length,keyword_trigger:e.filter(t=>t.sourceType==="keyword_trigger").length,import:e.filter(t=>t.sourceType==="import").length,unknown:e.filter(t=>!t.sourceType||t.sourceType==="unknown").length}});this.funnelStats=v({stages:{},tags:[],interest_distribution:{},today_new:0,week_converted:0});this.funnelOverview=v({stages:[],totalLeads:0,convertedLeads:0,averageConversionDays:0,conversionRate:0});this.showFunnelVisualization=v(!1);this.isLoadingFunnel=v(!1);this.selectedJourneyUserId=v("");this.userJourneyData=v(null);this.isLoadingJourney=v(!1);this.leadsTab=v("kanban");this.marketingCampaigns=v([]);this.marketingStats=v({totalCampaigns:0,running:0,completed:0,totalMessages:0,totalInvites:0,successRate:0});this.showCreateCampaignDialog=v(!1);this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""};this.isLoadingMarketing=v(!1);this.warmupDetails=v({});this.showWarmupConfig=v(!1);this.selectedWarmupAccountId=v(null);this.usersWithProfiles=v({users:[],total:0,limit:50,offset:0});this.userFilterStage=v("");this.userFilterTags=v("");this.userFilterSearch=v("");this.selectedUserIds=v([]);this.funnelStages=[{key:"new",name:"\u65B0\u5BA2\u6236",color:"bg-blue-500"},{key:"contacted",name:"\u5DF2\u806F\u7E6B",color:"bg-cyan-500"},{key:"replied",name:"\u5DF2\u56DE\u5FA9",color:"bg-green-500"},{key:"interested",name:"\u6709\u8208\u8DA3",color:"bg-yellow-500"},{key:"negotiating",name:"\u6D3D\u8AC7\u4E2D",color:"bg-orange-500"},{key:"follow_up",name:"\u9700\u8DDF\u9032",color:"bg-purple-500"},{key:"converted",name:"\u5DF2\u6210\u4EA4",color:"bg-emerald-500"},{key:"churned",name:"\u5DF2\u6D41\u5931",color:"bg-red-500"}];this.dashboardStats=G(()=>{let e=this.accounts(),t=this.leads(),i=e.filter(l=>l.status==="Online").length,o=new Date;o.setHours(0,0,0,0);let s=t.filter(l=>new Date(l.timestamp)>=o).length,r=e.reduce((l,d)=>l+d.dailySendCount,0);return{totalAccounts:e.length,onlineAccounts:i,totalLeads:t.length,leadsToday:s,messagesSentToday:r}});this.selectedAnalyticsCampaignId=v("all");this.filteredAnalyticsLeads=G(()=>{let e=this.leads(),t=this.selectedAnalyticsCampaignId();return t==="all"?e:e.filter(i=>i.campaignId===t)});this.analyticsData=G(()=>{let e=this.filteredAnalyticsLeads(),t=new Date;t.setHours(0,0,0,0);let i=[];for(let r=6;r>=0;r--){let l=new Date(t);l.setDate(t.getDate()-r);let d=e.filter(u=>{let f=new Date(u.timestamp);return f.setHours(0,0,0,0),f.getTime()===l.getTime()}).length;i.push({date:l,count:d})}let o=Math.max(...i.map(r=>r.count),1),s={new:e.length,contacted:e.filter(r=>r.status!=="New").length,replied:e.filter(r=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(r.status)).length};return{leadsByDay:i,maxLeadsInPeriod:o,funnel:s}});this.campaignPerformance=G(()=>{let e=this.leads();return this.campaigns().map(t=>{let i=e.filter(l=>l.campaignId===t.id),o=i.filter(l=>l.status!=="New").length,s=i.filter(l=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(l.status)).length,r=o>0?s/o*100:0;return{id:t.id,name:t.name,isActive:t.isActive,leads:i.length,contacted:o,replied:s,replyRate:r}})});this.isMonitoring=v(!1);this.coreDataLoaded=v(!1);this.senderRoundRobinIndex=v(0);this.oneClickStarting=v(!1);this.oneClickProgress=v(0);this.oneClickMessage=v("");this.oneClickStartReport=v(null);this.showStartReport=v(!1);this.systemStatus=v({accounts:{total:0,online:0,offline:0},monitoring:{active:!1,groups:0},ai:{enabled:!1,mode:"semi",endpoint:""},keywords:{sets:0,total:0},campaigns:{total:0,active:0},templates:{total:0,active:0},poller:{running:!1}});this.lastInitialStateTime=0;this.isPageVisible=!0;this.backendConnectionState=v("connecting");this.backendConnectionMessage=v("\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...");this.backendConnectionProgress=v(0);this.connectionStartTime=0;this.connectionTimeoutId=null;this.isStartingMonitoring=v(!1);this.lastConfigCheck=v(null);this.errorNavigationMap={NO_LISTENER:{view:"accounts",elementId:"accounts-section"},LISTENER_OFFLINE:{view:"accounts",elementId:"accounts-section"},NO_SENDER:{view:"accounts",elementId:"accounts-section"},SENDER_OFFLINE:{view:"accounts",elementId:"accounts-section"},SENDER_LIMIT_REACHED:{view:"accounts",elementId:"accounts-section"},NO_GROUPS:{view:"automation",elementId:"monitored-groups-section"},NO_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},EMPTY_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},GROUP_NO_KEYWORD:{view:"automation",elementId:"monitored-groups-section"},NO_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_ACTIVE_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},CAMPAIGN_INCOMPLETE:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_TEMPLATE:{view:"automation",elementId:"templates-section"},AI_NOT_ENABLED:{view:"ai-engine",elementId:"ai-settings-section"}};this.selectedDays=v(7);this.alertManagementTab=v("alerts");this.alertRules=v([]);this.alertHistory=v([]);this.showAddAlertRuleDialog=v(!1);this.deleteConfirmDialog=v({show:!1,type:"single"});this.isSubmittingCampaign=v(!1);let e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.theme.set(e?"dark":"light"),Ho(()=>{this.document.documentElement.className=this.theme()}),Ho(()=>{let t=this.navBridge.currentView(),i=this.currentView();t&&t!==i&&(console.log("[AppComponent] \u540C\u6B65\u5C0E\u822A:",t,"\u2190 from NavBridge"),this.currentView.set(t))})}get routerUrl(){return this.router?.url||"N/A"}toggleSidebarGroup(e){let t=this.sidebarGroups();this.sidebarGroups.set(N(M({},t),{[e]:!t[e]})),localStorage.setItem("sidebar_groups",JSON.stringify(this.sidebarGroups()))}isSidebarGroupExpanded(e){return this.sidebarGroups()[e]??!0}loadSidebarGroupsState(){try{let e=localStorage.getItem("sidebar_groups");if(e){let i=JSON.parse(e);this.sidebarGroups.set(M(M({},this.sidebarGroups()),i))}localStorage.getItem("sidebar_collapsed")==="true"&&this.sidebarCollapsed.set(!0)}catch(e){console.warn("[Sidebar] Failed to load sidebar groups state:",e)}}get sidebarCollapsed(){return this.sidebarState.collapsed}get isMobile(){return this.sidebarState.isMobile}get mobileMenuOpen(){return this.sidebarState.mobileMenuOpen}initMobileDetection(){this.sidebarState.initMobileDetection()}toggleMobileMenu(){this.sidebarState.toggleMobileMenu()}onMobileNavSelect(){this.sidebarState.onMobileNavSelect()}toggleSidebarCollapse(){this.sidebarState.toggleCollapse()}get showQrLoginDialog(){return this.dialogService.showQrLoginDialog}hideSearchSuggestions(){setTimeout(()=>this.showSearchSuggestions.set(!1),200)}isInSearchResultMode(){return this.currentSearchKeyword().length>0}exitSearchResultMode(){this.currentSearchKeyword.set(""),this.loadResources()}saveSettings(){this.saveSettingsTimer&&clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=setTimeout(()=>{this.ipcService.send("save-settings",{settings:{spintaxEnabled:this.spintaxEnabled(),autoReplyEnabled:this.autoReplyEnabled(),autoReplyMessage:this.autoReplyMessage(),smartSendingEnabled:this.smartSendingEnabled()}}),this.saveSettingsTimer=null},500)}showSettingsSavedToast(){this.toastService.success(this.t("settingsSaved"),2e3)}async testAiConnection(){if(this.aiApiType()==="local"){await this.testLocalAiConnection();return}if(this.aiApiKey()){this.isTestingAi.set(!0),this.aiConnectionStatus.set(null);try{this.ipcService.send("test-ai-connection",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint()}),await new Promise(t=>setTimeout(t,1500));let e=this.aiApiKey();this.aiApiType()==="gemini"&&e.startsWith("AIza")?this.aiConnectionStatus.set("success"):this.aiApiType()==="openai"&&e.startsWith("sk-")?this.aiConnectionStatus.set("success"):this.aiApiType()==="custom"&&e.length>10?this.aiConnectionStatus.set("success"):(this.aiConnectionStatus.set("error"),this.aiConnectionError.set(this.t("invalidApiKeyFormat")))}catch(e){this.aiConnectionStatus.set("error"),this.aiConnectionError.set(e.message)}finally{this.isTestingAi.set(!1)}}}async testLocalAiConnection(){let e=this.localAiEndpoint();if(e){this.isTestingLocalAi.set(!0),this.localAiStatus.set(null);try{this.ipcService.send("test-local-ai",{endpoint:e,provider:this.localAiProvider(),model:this.localAiModel()}),this.localAiProvider()==="ollama"&&this.ipcService.send("get-ollama-models",{endpoint:e}),await new Promise(t=>setTimeout(t,3e3)),e.startsWith("http://")||e.startsWith("https://")?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success("\u672C\u5730 AI \u670D\u52D9\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(this.t("invalidEndpointFormat")))}catch(t){this.localAiStatus.set("error"),this.localAiError.set(t.message)}finally{this.isTestingLocalAi.set(!1)}}}refreshOllamaModels(){let e=this.localAiEndpoint();e&&(this.toastService.info("\u6B63\u5728\u7372\u53D6\u6A21\u578B\u5217\u8868..."),this.ipcService.send("get-ollama-models",{endpoint:e}))}setLocalAiPresets(e){switch(this.localAiProvider.set(e),e){case"ollama":this.localAiEndpoint.set("http://localhost:11434"),this.localAiModel.set("qwen2:7b");break;case"lmstudio":this.localAiEndpoint.set("http://localhost:1234"),this.localAiModel.set("");break;case"custom":this.localAiEndpoint.set(""),this.localAiModel.set("");break}}async testTtsConnection(){let e=this.ttsEndpoint();if(e){this.isTestingTts.set(!0),this.ttsStatus.set(null);try{this.ipcService.send("test-tts-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.ttsStatus.set("success"):(this.ttsStatus.set("error"),this.ttsError.set(this.t("invalidEndpointFormat")))}catch(t){this.ttsStatus.set("error"),this.ttsError.set(t.message)}finally{this.isTestingTts.set(!1)}}}async testSttConnection(){let e=this.sttEndpoint();if(e){this.isTestingStt.set(!0),this.sttStatus.set(null);try{this.ipcService.send("test-stt-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.sttStatus.set("success"):(this.sttStatus.set("error"),this.sttError.set(this.t("invalidEndpointFormat")))}catch(t){this.sttStatus.set("error"),this.sttError.set(t.message)}finally{this.isTestingStt.set(!1)}}}saveAiSettings(){localStorage.setItem("ai_api_key",this.aiApiKey()),localStorage.setItem("ai_api_type",this.aiApiType()),localStorage.setItem("ai_custom_endpoint",this.customApiEndpoint()),localStorage.setItem("local_ai_endpoint",this.localAiEndpoint()),localStorage.setItem("local_ai_model",this.localAiModel()),localStorage.setItem("tts_endpoint",this.ttsEndpoint()),localStorage.setItem("tts_enabled",String(this.ttsEnabled())),localStorage.setItem("tts_voice",this.ttsVoice()),localStorage.setItem("stt_endpoint",this.sttEndpoint()),localStorage.setItem("stt_enabled",String(this.sttEnabled())),this.ipcService.send("save-ai-settings",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint(),localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel(),ttsEndpoint:this.ttsEndpoint(),ttsEnabled:this.ttsEnabled(),ttsVoice:this.ttsVoice(),sttEndpoint:this.sttEndpoint(),sttEnabled:this.sttEnabled()}),this.aiApiType()==="gemini"&&this.aiApiKey()&&this.geminiService.setApiKey(this.aiApiKey()),this.toastService.success(this.t("aiSettingsSaved"),2e3)}toggleAiAutoChat(){this.aiAutoChatEnabled.set(!this.aiAutoChatEnabled()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoChatEnabled()?"AI \u81EA\u52D5\u804A\u5929\u5DF2\u958B\u555F":"AI \u81EA\u52D5\u804A\u5929\u5DF2\u95DC\u9589",2e3)}toggleAiAutoGreeting(){this.aiAutoGreeting.set(!this.aiAutoGreeting()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoGreeting()?"\u81EA\u52D5\u554F\u5019\u5DF2\u958B\u555F":"\u81EA\u52D5\u554F\u5019\u5DF2\u95DC\u9589",2e3)}saveAiChatSettings(){localStorage.setItem("ai_auto_chat_enabled",String(this.aiAutoChatEnabled())),localStorage.setItem("ai_auto_chat_mode",this.aiAutoChatMode()),localStorage.setItem("ai_typing_speed",String(this.aiTypingSpeed())),localStorage.setItem("ai_reply_delay",JSON.stringify(this.aiReplyDelay())),localStorage.setItem("ai_system_prompt",this.aiSystemPrompt()),localStorage.setItem("ai_max_context_messages",String(this.aiMaxContextMessages())),localStorage.setItem("ai_enable_memory",String(this.aiEnableMemory())),localStorage.setItem("ai_auto_greeting",String(this.aiAutoGreeting())),localStorage.setItem("ai_greeting_message",this.aiGreetingMessage()),this.ipcService.send("update-ai-chat-settings",{settings:{auto_chat_enabled:this.aiAutoChatEnabled()?1:0,auto_chat_mode:this.aiAutoChatMode(),typing_speed:this.aiTypingSpeed(),reply_delay_min:this.aiReplyDelay()[0],reply_delay_max:this.aiReplyDelay()[1],system_prompt:this.aiSystemPrompt(),max_context_messages:this.aiMaxContextMessages(),enable_memory:this.aiEnableMemory()?1:0,auto_greeting:this.aiAutoGreeting()?1:0,greeting_message:this.aiGreetingMessage()},localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel()}),this.toastService.success(this.t("aiSettingsSaved"),2e3)}loadAiChatSettings(){let e=localStorage.getItem("ai_auto_chat_enabled"),t=localStorage.getItem("ai_auto_chat_mode"),i=localStorage.getItem("ai_typing_speed"),o=localStorage.getItem("ai_reply_delay"),s=localStorage.getItem("ai_system_prompt"),r=localStorage.getItem("ai_max_context_messages"),l=localStorage.getItem("ai_enable_memory"),d=localStorage.getItem("ai_auto_greeting"),u=localStorage.getItem("ai_greeting_message");if(e&&this.aiAutoChatEnabled.set(e==="true"),t&&this.aiAutoChatMode.set(t),i&&this.aiTypingSpeed.set(parseInt(i)),o)try{this.aiReplyDelay.set(JSON.parse(o))}catch{}s&&this.aiSystemPrompt.set(s),r&&this.aiMaxContextMessages.set(parseInt(r)),l&&this.aiEnableMemory.set(l==="true"),d&&this.aiAutoGreeting.set(d==="true"),u&&this.aiGreetingMessage.set(u)}isRegexValid(e){if(!e)return!0;try{return new RegExp(e),!0}catch{return!1}}getRegexError(e){if(!e)return null;try{return new RegExp(e),null}catch(t){return t.message}}getListenerAccounts(){return this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online")}getSenderAccounts(){return this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up"))}getOnlineAccountsCount(){return this.accounts().filter(e=>e.status==="Online").length}navigateToView(e){this.changeView(e)}navigateToAutomationTab(e){this.currentView.set("automation"),this.automationTab.set(e)}isAiEngineView(){let e=this.currentView();return e==="ai-engine"||e==="ai-center"||e==="knowledge-brain"||e==="knowledge-manage"||e==="knowledge-gaps"}leadsByStatus(e){return this.leadsByStatusMap().get(e)||[]}todayNewLeads(){let e=new Date;return e.setHours(0,0,0,0),this.leads().filter(t=>new Date(t.timestamp)>=e).length}getConversionRate(){let e=this.leads().length;return e===0?"0.0":(this.leadsByStatus("Closed-Won").length/e*100).toFixed(1)}getContactRate(){let e=this.leads().length;if(e===0)return"0.0";let t=this.leadsByStatus("New").length;return((e-t)/e*100).toFixed(1)}getReplyRate(){let e=this.leads().length-this.leadsByStatus("New").length;return e===0?"0.0":((this.leadsByStatus("Replied").length+this.leadsByStatus("Follow-up").length+this.leadsByStatus("Closed-Won").length+this.leadsByStatus("Closed-Lost").length)/e*100).toFixed(1)}loadFunnelStats(){this.ipcService.send("get-funnel-stats",{})}loadFunnelOverview(){this.isLoadingFunnel.set(!0),this.ipcService.send("get-funnel-overview",{})}loadUserJourney(e){e&&(this.isLoadingJourney.set(!0),this.selectedJourneyUserId.set(e),this.ipcService.send("get-user-journey",{userId:e}))}transitionFunnelStage(e,t,i){this.ipcService.send("transition-funnel-stage",{userId:e,stage:t,reason:i||"\u624B\u52D5\u8F49\u63DB"})}loadMarketingStats(){this.isLoadingMarketing.set(!0),this.ipcService.send("get-marketing-stats",{})}loadMarketingCampaigns(){this.ipcService.send("get-marketing-campaigns",{})}createMarketingCampaign(){if(!this.newMarketingCampaign.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}this.ipcService.send("create-marketing-campaign",{name:this.newMarketingCampaign.name,type:this.newMarketingCampaign.type,targetGroup:this.newMarketingCampaign.targetGroup,messageTemplate:this.newMarketingCampaign.messageTemplate})}startMarketingCampaign(e){this.ipcService.send("start-marketing-campaign",{campaignId:e})}loadWarmupDetails(e){this.ipcService.send("get-warmup-progress",{accountId:e})}loadAllWarmupDetails(){this.accounts().forEach(t=>{t.id&&this.loadWarmupDetails(t.id)})}toggleWarmup(e,t){this.ipcService.send("update-account",{id:e,warmupEnabled:t}),this.toastService.info(t?"\u5DF2\u555F\u7528\u9810\u71B1":"\u5DF2\u505C\u7528\u9810\u71B1")}getWarmupStageColor(e){return{1:"text-blue-400",2:"text-cyan-400",3:"text-yellow-400",4:"text-green-400"}[e]||"text-slate-400"}getWarmupStageIcon(e){return{1:"\u{1F507}",2:"\u{1F4AC}",3:"\u{1F4C8}",4:"\u2705"}[e]||"\u2753"}loadMigrationStatus(){this.isLoadingMigration.set(!0),this.ipcService.send("migration-status",{})}runMigration(e){this.isRunningMigration.set(!0),this.ipcService.send("migrate",{targetVersion:e})}rollbackMigration(e){confirm(`\u78BA\u5B9A\u8981\u56DE\u6EFE\u5230\u7248\u672C ${e} \u55CE\uFF1F\u9019\u53EF\u80FD\u6703\u5C0E\u81F4\u6578\u64DA\u4E1F\u5931\uFF01`)&&(this.isRunningMigration.set(!0),this.ipcService.send("rollback-migration",{targetVersion:e}))}loadSchedulerStatus(){this.ipcService.send("get-scheduler-status",{})}startScheduler(){this.ipcService.send("start-scheduler",{})}stopScheduler(){this.ipcService.send("stop-scheduler",{})}runSchedulerTask(e){this.ipcService.send("run-scheduler-task",{taskName:e})}updateSchedulerInterval(e,t){this.ipcService.send("update-scheduler-interval",{taskName:e,interval:t})}loadLogFiles(){this.isLoadingLogs.set(!0),this.ipcService.send("list-log-files",{})}loadLogStats(){this.ipcService.send("get-log-stats",{})}rotateLogs(){this.isRotatingLogs.set(!0),this.ipcService.send("rotate-logs",{})}viewLogFile(e){this.selectedLogFile.set(e),this.ipcService.send("read-log-file",{filename:e})}downloadLogFile(e){this.ipcService.send("download-log-file",{filename:e})}deleteLogFile(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u65E5\u8A8C\u6587\u4EF6 ${e} \u55CE\uFF1F`)&&this.ipcService.send("delete-log-file",{filename:e})}hasSelectedResources(){return this.selectedResourceIds().length>0}selectedResourceCount(){return this.selectedResourceIds().length}batchApproveResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"approved"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchRejectResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"rejected"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchSetResourcePriority(e){let t=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:t,priority:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchDeleteResources(){if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${this.selectedResourceCount()} \u500B\u8CC7\u6E90\u55CE\uFF1F`))return;let e=this.selectedResourceIds();this.ipcService.send("batch-delete-resources",{resourceIds:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}loadUsersWithProfiles(){this.ipcService.send("get-users-with-profiles",{stage:this.userFilterStage()||void 0,tags:this.userFilterTags()||void 0,search:this.userFilterSearch()||void 0,limit:50,offset:0})}toggleUserSelection(e){let t=this.selectedUserIds();t.includes(e)?this.selectedUserIds.set(t.filter(i=>i!==e)):this.selectedUserIds.set([...t,e])}selectAllUsers(){let e=this.usersWithProfiles().users.map(t=>t.user_id);this.selectedUserIds.set(e)}deselectAllUsers(){this.selectedUserIds.set([])}bulkUpdateTags(e,t){let i=this.selectedUserIds();if(i.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-tags",{userIds:i,tags:e,action:t})}bulkUpdateStage(e){let t=this.selectedUserIds();if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-stage",{userIds:t,stage:e})}getStageName(e){let t=this.funnelStages.find(i=>i.key===e);return t?t.name:e}getStageColor(e){let t=this.funnelStages.find(i=>i.key===e);return t?t.color:"bg-gray-500"}onDocumentClick(e){this.openResourceMenuId()!==null&&this.openResourceMenuId.set(null)}ngOnInit(){console.log("[App] ngOnInit called, coreDataLoaded:",this.coreDataLoaded()),console.log("[App] Current URL:",window.location.href),console.log("[App] Router URL:",this.router.url),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[App] Angular ready event dispatched")},100),this.loadAiSettings(),this.initMobileDetection(),this.loadSidebarGroupsState(),this.router.events.subscribe(e=>{if(e instanceof ca){let i=(e.urlAfterRedirects||e.url).split("?")[0];if(i==="/ai-engine"||i.startsWith("/ai-engine/")){this.currentView()!=="ai-engine"&&this.currentView.set("ai-engine");return}let o=Object.entries(gi).find(([,s])=>s===i);if(o){let s=o[0];this.currentView()!==s&&this.currentView.set(s)}}}),window.addEventListener("changeView",e=>{let t=e;t.detail&&this.changeView(t.detail)}),this.setupVisibilityListener(),this.setupIpcListeners(),this.checkFirstRun(),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),this.loadCachedStateIfAvailable(),window.addEventListener("page-became-visible",()=>{console.log("[App] Page became visible, refreshing data..."),this.ipcService.send("get-initial-state")}),window.addEventListener("sync-offline-operations",(e=>{this.syncOfflineOperations(e.detail.operations)})),console.log("[App] Current URL:",window.location.href),this.ipcService.send("get-initial-state"),this.isAuthenticated()&&this.authService.fetchCurrentUser().then(e=>{if(e){if(console.log("[App] User data refreshed:",{displayName:e.displayName||e.display_name,telegramId:e.telegramId||e.telegram_id,membership:this.authService.membershipLevel()}),this.membershipService.isSaaSMode()){let t=this.authService.user(),i=this.authService.membershipLevel()||"bronze",o=t?.membershipExpires||t?.subscription_expires,s=!!t?.isLifetime;this.membershipService.syncFromAuthService(i,o,s)}this.cdr.detectChanges()}}).catch(e=>console.warn("[App] Failed to refresh user data:",e)),this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4),setTimeout(()=>{this.refreshQueueStatusThrottled()},2e3),this.watchViewChanges(),this.setupKeyboardShortcuts(),this.membershipUpdateHandler=e=>{console.log("[AppComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",e.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler),window.addEventListener("save-ai-settings",(e=>{let t=e.detail;console.log("[AppComponent] \u6536\u5230 AI \u8A2D\u7F6E\u4FDD\u5B58\u4E8B\u4EF6:",t),t.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(t.auto_chat_enabled===1),t.auto_chat_mode&&this.aiAutoChatMode.set(t.auto_chat_mode),t.auto_greeting!==void 0&&this.aiAutoGreeting.set(t.auto_greeting===1),this.ipcService.send("update-ai-chat-settings",{settings:t}),this.toastService.success("AI \u8A2D\u7F6E\u5DF2\u4FDD\u5B58",2e3)})),window.addEventListener("get-sender-accounts",(()=>{let t=this.accounts().filter(i=>i.role==="Sender"&&i.status==="Online").map(i=>({phone:i.phone,username:i.username||i.first_name||i.phone,avatar:i.avatar,sentToday:i.sentToday||i.dailySendCount||0,dailyLimit:i.dailySendLimit||50}));window.dispatchEvent(new CustomEvent("sender-accounts-loaded",{detail:t}))}))}checkFirstRun(){this.ipcService.send("check-first-run",{})}detectOllama(){this.isDetectingOllama.set(!0),this.ipcService.send("detect-ollama",{})}completeFirstRunSetup(){let e={aiConfig:{primaryProvider:this.ollamaDetected()?"local":"cloud",localAi:{provider:"ollama",endpoint:this.localAiEndpoint(),model:this.autoSelectedModel()||this.localAiModel(),autoDetect:!0},cloudAi:{enabled:!this.ollamaDetected(),provider:this.aiApiType(),apiKey:this.aiApiKey()},autoFallback:{enabled:this.aiAutoFallback(),fallbackProvider:this.aiBackupProvider()}},settings:{language:"zh",theme:this.theme(),firstRun:{completed:!0,completedAt:new Date().toISOString()}}};this.ipcService.send("save-first-run-settings",e),this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.success("\u{1F389} \u8A2D\u7F6E\u5B8C\u6210\uFF01\u6B61\u8FCE\u4F7F\u7528 TG-Matrix")}skipFirstRunSetup(){this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.info("\u60A8\u53EF\u4EE5\u7A0D\u5F8C\u5728\u8A2D\u7F6E\u4E2D\u914D\u7F6E AI")}watchViewChanges(){let e=null,t=()=>{let i=this.currentView();i!==e&&(e=i,i==="leads"?(this.loadFunnelStats(),this.loadUsersWithProfiles()):i==="resources"?(this.refreshResourceStats(),this.isInSearchResultMode()||this.loadResources(),this.loadDiscoveryKeywords()):this.isAiEngineView()&&this.refreshRagStats())};t(),this.viewCheckInterval=setInterval(t,2e3)}setupVisibilityListener(){this.visibilityChangeHandler=()=>{this.isPageVisible=!document.hidden,this.isPageVisible?(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u53EF\u898B\uFF0C\u6062\u5FA9\u5237\u65B0"),this.resumeRefreshIntervals()):(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u96B1\u85CF\uFF0C\u66AB\u505C\u5237\u65B0"),this.pauseRefreshIntervals())},document.addEventListener("visibilitychange",this.visibilityChangeHandler)}pauseRefreshIntervals(){this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0)}resumeRefreshIntervals(){if(!this.viewCheckInterval){let e="",t=()=>{let i=this.currentView();i!==e&&(e=i)};this.viewCheckInterval=setInterval(t,2e3)}this.queueRefreshInterval||(this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4)),this.isAuthenticated()&&this.authService.forceRefreshUser().then(e=>{e&&(console.log("[App] \u9801\u9762\u53EF\u898B\uFF0C\u7528\u6236\u6578\u64DA\u5DF2\u5237\u65B0:",{displayName:e.displayName,membershipLevel:e.membershipLevel}),this.cdr.detectChanges())}).catch(e=>{console.warn("[App] \u9801\u9762\u53EF\u898B\u6642\u5237\u65B0\u7528\u6236\u6578\u64DA\u5931\u6557:",e)})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&e.key==="n"&&this.currentView()==="accounts"&&(e.preventDefault(),setTimeout(()=>{let t=document.querySelector('[name="phone"]');t&&t.focus()},100)),e.key==="Escape"&&(this.selectedQueuePhone()&&this.closeQueueDetails(),this.progressDialog().show&&this.progressDialog().cancellable&&this.progressDialog.set(N(M({},this.progressDialog()),{show:!1}))),!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement)&&(e.key==="1"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("dashboard")):e.key==="2"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("accounts")):e.key==="3"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("automation")):e.key==="4"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("leads")):e.key==="5"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("ads")):e.key==="6"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("campaigns")):e.key==="7"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.changeView("settings")))})}ngOnDestroy(){this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler),this.ipcService.cleanup("log-entry"),this.ipcService.cleanup("monitoring-status-changed"),this.ipcService.cleanup("monitoring-status-report"),this.ipcService.cleanup("monitoring-start-failed"),this.ipcService.cleanup("monitoring-config-check"),this.ipcService.cleanup("initial-state"),this.ipcService.cleanup("accounts-updated"),this.ipcService.cleanup("new-lead-captured"),this.ipcService.cleanup("queue-status"),this.ipcService.cleanup("queue-messages"),this.ipcService.cleanup("sending-stats"),this.ipcService.cleanup("queue-length-history"),this.ipcService.cleanup("account-sending-comparison"),this.ipcService.cleanup("campaign-performance-stats"),this.ipcService.cleanup("alert-triggered"),this.ipcService.cleanup("alerts-loaded"),this.ipcService.cleanup("account-validation-error"),this.ipcService.cleanup("keyword-set-validation-error"),this.ipcService.cleanup("keyword-validation-error"),this.ipcService.cleanup("group-validation-error"),this.ipcService.cleanup("group-membership-status"),this.ipcService.cleanup("group-join-result"),this.ipcService.cleanup("template-validation-error"),this.ipcService.cleanup("campaign-validation-error"),this.ipcService.cleanup("keyword-sets-updated"),this.ipcService.cleanup("groups-updated"),this.ipcService.cleanup("templates-updated"),this.ipcService.cleanup("campaigns-updated"),this.ipcService.cleanup("leads-updated"),this.ipcService.cleanup("funnel-stats"),this.ipcService.cleanup("users-with-profiles"),this.ipcService.cleanup("bulk-update-complete"),this.ipcService.cleanup("login-requires-code"),this.ipcService.cleanup("login-requires-2fa"),this.ipcService.cleanup("account-login-error"),this.ipcService.cleanup("session-files-cleaned"),this.ipcService.cleanup("session-files-cleanup-error"),this.ipcService.cleanup("session-import-result"),this.ipcService.cleanup("session-import-needs-credentials"),this.ipcService.cleanup("orphan-sessions-detected"),this.ipcService.cleanup("orphan-sessions-scanned"),this.ipcService.cleanup("orphan-sessions-recovered"),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0),this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.initialStateDebounceTimer&&(clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=void 0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),this.saveSettingsTimer&&(clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=null),this.queueStatusRefreshThrottleTimer&&(clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=void 0),this.chatListSearchDebounceTimer&&(clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=void 0),this.logFilterDebounceTimer&&(clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=void 0)}startConnectionTimeout(){setTimeout(()=>{this.backendConnectionState()==="connecting"&&(this.backendConnectionMessage.set("\u6B63\u5728\u9023\u63A5..."),this.backendConnectionProgress.set(50))},3e3)}hideConnectionIndicator(){setTimeout(()=>{this.backendConnectionState()},2e3)}async loadCachedStateIfAvailable(){try{let e=await this.offlineCache.loadCachedState();e&&this.offlineCache.isCacheValid()&&(console.log("[App] \u{1F680} Loading cached state for fast startup"),e.accounts?.length>0&&this.accounts.set(e.accounts),e.keywordSets?.length>0&&this.keywordSets.set(e.keywordSets),e.leads?.length>0&&this.leads.set(e.leads.map(t=>this.mapLeadFromBackend(t))),e.settings&&this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),console.log("[App] \u2705 Cached state applied, waiting for fresh data..."))}catch(e){console.warn("[App] Failed to load cached state:",e)}}async syncOfflineOperations(e){if(!this.offlineCache.isOnline()){console.log("[App] Still offline, skipping sync");return}console.log("[App] \u{1F504} Syncing",e.length,"offline operations");for(let t of e)try{this.ipcService.send(t.command,t.payload),await this.offlineCache.removeOperation(t.id),console.log("[App] \u2705 Synced operation:",t.command)}catch(i){console.error("[App] Failed to sync operation:",t.command,i)}e.length>0&&this.toastService.success(`\u2705 \u5DF2\u540C\u6B65 ${e.length} \u500B\u96E2\u7DDA\u64CD\u4F5C`)}retryConnection(){this.backendConnectionState.set("connecting"),this.backendConnectionMessage.set("\u6B63\u5728\u91CD\u65B0\u9023\u63A5..."),this.backendConnectionProgress.set(0),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),this.ipcService.send("get-initial-state")}setupIpcListeners(){ad.call(this)}applyInitialState(e){console.log("Received initial state from backend:",e),this.backendConnectionState.set("connected"),this.backendConnectionProgress.set(100),this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.accounts.set(e.accounts||[]),this.keywordSets.set(e.keywordSets||[]),this.monitoredGroups.set(e.monitoredGroups||[]),this.campaigns.set(e.campaigns||[]),this.messageTemplates.set(e.messageTemplates||[]),e.isMonitoring!==void 0&&this.isMonitoring.set(e.isMonitoring);let t=(e.leads||[]).map(i=>this.mapLeadFromBackend(i));this.leads.set(t),this.leadsTotal.set(e.leadsTotal??e.leads?.length??0),this.contactsService.importLeadsDirectly(t),this.logs.set((e.logs||[]).map(i=>N(M({},i),{timestamp:new Date(i.timestamp)}))),e.settings&&(this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(e.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(e.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.settings.smartSendingEnabled??!0)),this.offlineCache.cacheState({accounts:e.accounts||[],keywordSets:e.keywordSets||[],monitoredGroups:e.monitoredGroups||[],campaigns:e.campaigns||[],leads:e.leads||[],settings:e.settings||{}})}setLanguage(e){let t={en:"en",zh:"zh-TW"};this.i18n.setLocale(t[e]||"zh-TW")}changeView(e){if(e==="ads"&&!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="multi-role"&&!this.membershipService.hasFeature("multiRole")){this.toastService.warning("\u{1F48E} \u591A\u89D2\u8272\u5354\u4F5C\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="user-tracking"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u7528\u6236\u8FFD\u8E64\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="campaigns"&&!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-team"&&!this.membershipService.hasFeature("autoExecution")){this.toastService.warning("\u{1F48E} AI\u5718\u968A\u92B7\u552E\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-assistant"&&!this.membershipService.hasFeature("strategyPlanning")){this.toastService.warning("\u{1F48E} AI\u7B56\u7565\u898F\u5283\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u6D1E\u5BDF\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics-center"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5206\u6790\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="lead-nurturing"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u5BA2\u6236\u57F9\u80B2\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="nurturing-analytics"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u57F9\u80B2\u5206\u6790\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.currentView();this.navBridge.navigateTo(e);let i=gi[e];i&&this.router.navigate([i]),this.currentView.set(e),this.auditTracker.trackViewChange(t,e),this.onMobileNavSelect()}switchDashboardMode(e){if(e==="smart"&&!this.membershipService.hasFeature("smartMode")){this.toastService.warning("\u{1F947} \u667A\u80FD\u6A21\u5F0F\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.dashboardMode.set(e)}handleDashboardNavigation(e){let i={"monitoring-accounts":"monitoring-accounts","monitoring-groups":"monitoring-groups","keyword-sets":"keyword-sets","chat-templates":"chat-templates","trigger-rules":"trigger-rules","collected-users":"collected-users","automation-rules":"trigger-rules",resources:"resources",rules:"trigger-rules","send-settings":"leads",analytics:"analytics"}[e];i&&this.changeView(i)}handleDashboardConfigAction(e){this.handleDashboardNavigation(e)}checkBatchOperationPermission(){return this.membershipService.hasFeature("batchOperations")?!0:(this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),!1)}addAccount(){let e=this.membershipService.canAddAccount(this.accounts().length);if(!e.allowed){this.toastService.warning(e.message||"\u5DF2\u9054\u5230\u8CEC\u6236\u6578\u91CF\u4E0A\u9650"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newAccount();this.validationErrors.set({});let i=[],o=t.phone.trim().replace(/[\s\-\(\)]/g,"");if(o?/^\+\d{1,15}$/.test(o)||i.push("Phone number must be in format +1234567890 (with country code)"):i.push("Phone number is required"),t.apiId&&!/^\d+$/.test(t.apiId.trim())&&i.push("API ID must be a positive integer"),t.apiHash&&!/^[a-fA-F0-9]{32}$/.test(t.apiHash.trim())&&i.push("API Hash must be a 32-character hexadecimal string"),t.proxy&&!/^(socks5|http|https):\/\/([^:]+(:[^@]+)?@)?[^:]+(:\d+)?$/.test(t.proxy.trim())&&i.push("Proxy must be in format: socks5://host:port or http://host:port"),i.length>0){this.validationErrors.set({account:i}),this.toastService.error(`\u9A8C\u8BC1\u5931\u8D25: ${i.join("; ")}`),console.error("Account validation errors:",i);return}let r={phone:t.phone.trim().replace(/[\s\-\(\)]/g,""),apiId:t.apiId.trim(),apiHash:t.apiHash.trim(),proxy:t.proxy.trim()||"",group:t.group.trim()||"",twoFactorPassword:t.twoFactorPassword.trim()||"",role:"Unassigned",enableWarmup:t.enableWarmup||!1};console.log("Sending add-account command:",r),this.ipcService.send("add-account",r),this.newAccount.set({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""}),this.toastService.info("\u6B63\u5728\u6DFB\u52A0\u8D26\u6237\uFF0C\u8BF7\u7A0D\u5019...")}onAccountAdded(e){console.log("[Frontend] Account added from add-account page:",e),this.toastService.success("\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01"),this.changeView("accounts")}goToAddAccount(){this.changeView("add-account")}loginAccount(e){console.log("[Frontend] loginAccount called with accountId:",e);let t=this.accounts().find(i=>i.id===e);if(!t){console.error("[Frontend] Account not found:",e),this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}console.log("[Frontend] Found account:",t.phone,"Status:",t.status),this.toastService.info("\u6B63\u5728\u767B\u5F55\u8D26\u6237..."),this.loginState.set({accountId:e,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set(""),console.log("[Frontend] Sending login-account command to IPC"),this.ipcService.send("login-account",e)}logoutAccount(e){let t=this.accounts().find(i=>i.id===e);if(!t){this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}confirm(`\u786E\u5B9A\u8981\u9000\u51FA\u8D26\u6237 ${t.phone} \u5417\uFF1F`)&&(this.toastService.info("\u6B63\u5728\u9000\u51FA\u8D26\u6237..."),this.ipcService.send("logout-account",e),this.ipcService.once("logout-account-result",i=>{i.success?this.toastService.success(`\u8D26\u6237 ${t.phone} \u5DF2\u9000\u51FA`):this.toastService.error(`\u9000\u51FA\u5931\u8D25: ${i.error||"\u672A\u77E5\u9519\u8BEF"}`)}))}editAccount(e){this.toastService.info(`\u7DE8\u8F2F\u5E33\u6236: ${e.phone}`)}submitLoginCode(){let e=this.loginState();!e.accountId||!e.phoneCodeHash||!this.loginCode().trim()||(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!0}),this.toastService.info("\u6B63\u5728\u9A8C\u8BC1\u9A8C\u8BC1\u7801..."),this.ipcService.send("login-account",{accountId:e.accountId,phoneCode:this.loginCode().trim(),phoneCodeHash:e.phoneCodeHash}),this.loginCode.set(""))}submitLogin2FA(){let e=this.loginState();!e.accountId||!this.login2FAPassword().trim()||(this.ipcService.send("login-account",{accountId:e.accountId,twoFactorPassword:this.login2FAPassword().trim()}),this.login2FAPassword.set(""))}cancelLogin(){this.loginState.set({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set("")}resendVerificationCode(){let e=this.loginState();e.accountId&&(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.toastService.info("\u6B63\u5728\u91CD\u65B0\u53D1\u9001\u9A8C\u8BC1\u7801\u5230\u60A8\u7684 Telegram \u5E94\u7528...",5e3),this.ipcService.send("login-account",e.accountId))}checkAccountStatus(e){this.ipcService.send("check-account-status",e)}navigateToError(e){let t=this.errorNavigationMap[e];if(!t){console.log("[Frontend] No navigation defined for error:",e);return}this.changeView(t.view),setTimeout(()=>{if(t.elementId){let i=document.getElementById(t.elementId);i&&(i.scrollIntoView({behavior:"smooth",block:"center"}),i.classList.add("highlight-pulse"),setTimeout(()=>{i.classList.remove("highlight-pulse")},3e3))}t.action&&t.action()},300),this.toastService.info("\u5DF2\u8DF3\u8F49\u5230\u76F8\u95DC\u8A2D\u7F6E\u5340\u57DF",2e3)}startMonitoring(){if(this.isStartingMonitoring()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u76E3\u63A7\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.listenerAccounts();if(e.length===0){let i=this.accounts().filter(o=>o.role==="Listener");if(i.length>0){let o=i.filter(s=>s.status!=="Online");o.length>0?this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6709 ${i.length} \u500B\u76E3\u807D\u8CEC\u6236\uFF0C\u4F46\u6C92\u6709\u5728\u7DDA\u7684\u8CEC\u6236\u3002

\u8ACB\u5148\u767B\u9304\u4EE5\u4E0B\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA\uFF1A
`+o.map(s=>`- ${s.phone} (${s.status})`).join(`
`),8e3):this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u7570\u5E38\uFF0C\u8ACB\u6AA2\u67E5\u8CEC\u6236\u72C0\u614B\u3002",5e3)}else this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u807D\u8CEC\u6236\u3002

\u8ACB\u5148\uFF1A
1. \u5728"\u8CEC\u6236\u7BA1\u7406"\u4E2D\u6DFB\u52A0\u8CEC\u6236
2. \u5C07\u8CEC\u6236\u89D2\u8272\u8A2D\u7F6E\u70BA"\u76E3\u807D"
3. \u767B\u9304\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA`,6e3);return}if(this.monitoredGroups().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44\u3002",4e3);return}if(this.keywordSets().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u95DC\u9375\u8A5E\u96C6\u3002\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u96C6\u3002",4e3);return}if(e.filter(i=>i.status==="Online").length===0){this.toastService.warning("\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u4E0D\u7A69\u5B9A\uFF0C\u8ACB\u7B49\u5F85\u8CEC\u6236\u5B8C\u5168\u4E0A\u7DDA\u5F8C\u518D\u8A66\u3002",4e3);return}this.isStartingMonitoring.set(!0),this.ipcService.send("start-monitoring"),setTimeout(()=>{this.isStartingMonitoring.set(!1)},5e3)}stopMonitoring(){this.ipcService.send("stop-monitoring")}oneClickStart(){if(this.oneClickStarting()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.accounts().length;if(e===0){this.toastService.error("\u274C \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55\u5E33\u865F\uFF0C\u8ACB\u5148\u6DFB\u52A0\u5E33\u865F",4e3);return}this.oneClickStarting.set(!0),this.oneClickProgress.set(0),this.oneClickMessage.set(`\u{1F680} \u958B\u59CB\u555F\u52D5 (${e} \u500B\u5E33\u865F)...`),this.ipcService.send("one-click-start",{forceRefresh:!0}),this.toastService.info(`\u{1F680} \u958B\u59CB\u4E00\u9375\u555F\u52D5\uFF0C\u5F8C\u7AEF\u5C07\u81EA\u52D5\u9023\u63A5 ${e} \u500B\u5E33\u865F`,3e3)}oneClickStop(){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6240\u6709\u670D\u52D9\u55CE\uFF1F\u9019\u5C07\u505C\u6B62\u76E3\u63A7\u548C AI \u81EA\u52D5\u804A\u5929\u3002")&&this.ipcService.send("one-click-stop")}loadSystemStatus(){this.ipcService.send("get-system-status")}clearLogs(){confirm("\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u65E5\u5FD7\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-logs"),this.logs.set([]),this.toastService.success("\u65E5\u5FD7\u5DF2\u6E05\u9664"))}refreshQueueStatus(e){this.ipcService.send("get-queue-status",e?{phone:e}:{})}clearPendingQueue(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5F85\u767C\u9001\u6D88\u606F\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002")&&(this.ipcService.send("clear-queue",{status:"pending"}),this.toastService.success("\u5F85\u767C\u9001\u968A\u5217\u5DF2\u6E05\u7A7A"))}retryMessage(e){this.ipcService.send("retry-message",{messageId:e}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u767C\u9001...")}cancelMessage(e){this.ipcService.send("cancel-message",{messageId:e}),this.toastService.success("\u6D88\u606F\u5DF2\u53D6\u6D88"),this.refreshQueueStatus()}clearQueue(e,t){confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u961F\u5217\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-queue",{phone:e,status:t}),this.toastService.info("\u6B63\u5728\u6E05\u7A7A\u961F\u5217..."))}pauseQueue(e){this.ipcService.send("pause-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6682\u505C\u961F\u5217...")}resumeQueue(e){this.ipcService.send("resume-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6062\u590D\u961F\u5217...")}deleteQueueMessage(e,t){confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u6D88\u606F\u5417\uFF1F")&&(this.ipcService.send("delete-queue-message",{phone:e,messageId:t}),this.toastService.info("\u6B63\u5728\u5220\u9664\u6D88\u606F..."))}updateQueueMessagePriority(e,t,i){let o=i==="HIGH"||i==="NORMAL"||i==="LOW"?i:"NORMAL";this.ipcService.send("update-queue-message-priority",{phone:e,messageId:t,priority:o})}getQueueMessages(e,t,i=100){this.ipcService.send("get-queue-messages",{phone:e,status:t,limit:i})}viewQueueDetails(e){this.selectedQueuePhone.set(e),this.getQueueMessages(e)}closeQueueDetails(){this.selectedQueuePhone.set(null),this.queueMessages.set([])}loadSendingStats(e=7,t){this.ipcService.send("get-sending-stats",{days:e,phone:t})}loadQueueLengthHistory(e=7){this.ipcService.send("get-queue-length-history",{days:e})}loadAccountSendingComparison(e=7){this.ipcService.send("get-account-sending-comparison",{days:e})}loadCampaignPerformanceStats(e=7){this.ipcService.send("get-campaign-performance-stats",{days:e})}onDaysChange(e){this.selectedDays.set(e),this.loadAllAnalytics(e)}loadAllAnalytics(e=7){this.loadSendingStats(e),this.loadQueueLengthHistory(e),this.loadAccountSendingComparison(e),this.loadCampaignPerformanceStats(e)}capturesChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),i=new Date;i.setHours(0,0,0,0);let o=[],s=[];for(let r=t-1;r>=0;r--){let l=new Date(i);l.setDate(i.getDate()-r);let d=l.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(d);let u=e.filter(f=>{let C=new Date(f.timestamp);return C.setHours(0,0,0,0),C.getTime()===l.getTime()}).length;s.push(u)}return{labels:o,datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:s,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]}}conversionsChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),i=new Date;i.setHours(0,0,0,0);let o=[],s=[],r=[];for(let l=t-1;l>=0;l--){let d=new Date(i);d.setDate(i.getDate()-l);let u=d.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(u);let f=e.filter(C=>{let y=new Date(C.timestamp);return y.setHours(0,0,0,0),y.getTime()===d.getTime()});s.push(f.filter(C=>C.status!=="New").length),r.push(f.filter(C=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(C.status)).length)}return{labels:o,datasets:[{label:"\u5DF2\u8054\u7CFB",data:s,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5DF2\u56DE\u590D",data:r,borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",fill:!0}]}}messagesChartData(){return this.sendingStatsData()}funnelChartData(){let e=this.funnelStats();if(!e||!e.stages||Object.keys(e.stages).length===0)return null;let t=this.funnelStages,i=t.map(s=>s.name),o=t.map(s=>{let r=e.stages[s.key];return r?r.count:0});return{labels:i,datasets:[{label:"\u6F0F\u6597\u6570\u636E",data:o,backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(34, 197, 94, 0.8)","rgba(168, 85, 247, 0.8)","rgba(239, 68, 68, 0.8)","rgba(245, 158, 11, 0.8)","rgba(236, 72, 153, 0.8)","rgba(16, 185, 129, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(34, 197, 94)","rgb(168, 85, 247)","rgb(239, 68, 68)","rgb(245, 158, 11)","rgb(236, 72, 153)","rgb(16, 185, 129)","rgb(239, 68, 68)"],borderWidth:1}]}}loadAlerts(e=!1,t){this.ipcService.send("get-alerts",{limit:50,unresolvedOnly:e,level:t})}acknowledgeAlert(e){this.ipcService.send("acknowledge-alert",{alertId:e})}resolveAlert(e){this.ipcService.send("resolve-alert",{alertId:e})}loadAlertHistory(e=30){this.ipcService.send("get-alert-history",{days:e})}loadAlertRules(){this.ipcService.send("get-alert-rules",{})}toggleAlertRule(e){this.ipcService.send("toggle-alert-rule",{ruleId:e})}editAlertRule(e){this.showAddAlertRuleDialog.set(!0)}deleteAlertRule(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u544A\u8B66\u89C4\u5219\u5417\uFF1F")&&this.ipcService.send("delete-alert-rule",{ruleId:e})}async showNotification(e,t,i){"Notification"in window&&(Notification.permission==="granted"?new Notification(e,M({body:t,icon:"/assets/icon.png",badge:"/assets/badge.png",tag:"tg-matrix-notification",requireInteraction:!1},i)):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&this.showNotification(e,t,i))}showBrowserNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification(`\u544A\u8B66: ${e.level.toUpperCase()}`,{body:e.message,icon:"/assets/icon.ico",tag:`alert-${e.id}`,requireInteraction:e.level==="critical"||e.level==="error"})}async requestNotificationPermission(){"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()}formatDate(e){return new Date(e).toLocaleString()}mapLeadFromBackend(e){let t="unknown",i=e.notes||"",o=e.triggered_keyword||e.triggeredKeyword||"";return i.includes("\u89F8\u767C\u8A5E")||o?t="keyword_trigger":e.extracted_by_phone||e.source_chat_id?t="group_extract":(i.includes("\u5C0E\u5165")||i.includes("import"))&&(t="import"),{id:e.id,userId:e.user_id||e.userId||"",username:e.username||"",firstName:e.first_name||e.firstName||"",lastName:e.last_name||e.lastName||"",sourceGroup:e.source_chat_title||e.sourceGroup||e.source_group||"",triggeredKeyword:i||o||"",timestamp:new Date(e.created_at||e.timestamp||e.extracted_at||Date.now()),status:e.status||e.response_status||"New",onlineStatus:e.online_status||e.onlineStatus||"hidden",assignedTemplateId:e.assignedTemplateId||e.assigned_template_id,interactionHistory:e.interactionHistory||e.interaction_history||[],doNotContact:!!e.doNotContact||!!e.do_not_contact,campaignId:e.campaignId||e.campaign_id,intentScore:e.intent_score||e.intentScore||0,intentLevel:e.intent_level||e.intentLevel||"none",sourceType:e.source_type||e.sourceType||t}}syncLeadsToResourceCenter(e){let t=(e||[]).map(i=>this.mapLeadFromBackend(i));this.contactsService.importLeadsDirectly(t),console.log("[Frontend] Synced",t.length,"leads to resource center")}loadRemainingLeads(){if(console.log("[Frontend] loadRemainingLeads called, loading:",this.leadsLoading(),"hasMore:",this.leadsHasMore()),this.leadsLoading()){console.log("[Frontend] \u23F3 Already loading, skipping...");return}let e=this.leads().length,t=this.leadsTotal();if(e>=t&&t>0){console.log("[Frontend] \u2705 All data already loaded:",e,"/",t);return}console.log("[Frontend] \u{1F4E5} Loading remaining leads:",e,"/",t),this.leadsLoading.set(!0),this.ipcService.send("get-leads-paginated",{page:1,pageSize:500,status:null,search:null})}safeFormatDate(e,t="MM/dd HH:mm"){if(!e)return"-";try{let i=e instanceof Date?e:new Date(e);if(isNaN(i.getTime()))return"-";let o=f=>f.toString().padStart(2,"0"),s=o(i.getMonth()+1),r=o(i.getDate()),l=o(i.getHours()),d=o(i.getMinutes()),u=i.getFullYear();return t==="MM/dd HH:mm"?`${s}/${r} ${l}:${d}`:t==="yyyy-MM-dd HH:mm"?`${u}-${s}-${r} ${l}:${d}`:t==="HH:mm:ss"?`${l}:${d}:${o(i.getSeconds())}`:`${s}/${r} ${l}:${d}`}catch{return"-"}}getQueueStatusForAccount(e){return this.queueStatuses()[e]||null}getTotalQueueStats(){let e=this.queueStatuses(),t=0,i=0,o=0,s=0,r=0,l=0;return Object.values(e).forEach(d=>{t+=d.pending,i+=d.processing,o+=d.retrying,s+=d.failed,r+=d.stats.completed,l+=d.stats.failed}),{pending:t,processing:i,retrying:o,failed:s,completed:r,failedCount:l,totalAccounts:Object.keys(e).length}}applyLogFilter(){this.ipcService.send("get-logs",{limit:1e3,type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}resetLogFilter(){this.logFilterType.set(""),this.logFilterStartDate.set(""),this.logFilterEndDate.set(""),this.logFilterSearch.set(""),this.ipcService.send("get-logs",{limit:100})}exportLogs(){this.ipcService.send("export-logs",{type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}onExcelFileSelected(){this.accountLoaderService.loadAccountsFromExcel()}onDownloadTemplate(){this.accountLoaderService.downloadExcelTemplate()}reloadSessionsAndAccounts(){this.accountLoaderService.reloadSessionsAndAccounts()}openQrLogin(){this.dialogService.openQrLogin()}closeQrLogin(){this.dialogService.closeQrLogin()}onQrLoginSuccess(e){this.dialogService.closeQrLogin(),this.toastService.success(`\u5E33\u865F ${e.phone||""} \u5DF2\u6210\u529F\u6DFB\u52A0\uFF01`),this.reloadSessionsAndAccounts()}exportLeads(){if(!this.membershipService.hasFeature("dataExport")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5C0E\u51FA\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.accountLoaderService.exportLeadsToExcel(this.leads())}importSession(){this.ipcService.send("import-session")}exportSession(e){this.ipcService.send("export-session",e)}cleanupSessionFiles(){confirm("\u786E\u5B9A\u8981\u6E05\u7406\u6240\u6709\u5B64\u7ACB\u7684 session \u6587\u4EF6\u5417\uFF1F\u8FD9\u5C06\u5220\u9664\u6240\u6709\u5E26\u65F6\u95F4\u6233\u7684 session \u6587\u4EF6\u548C\u4E0D\u5728\u6570\u636E\u5E93\u4E2D\u7684 session \u6587\u4EF6\u3002")&&(this.ipcService.send("cleanup-session-files"),this.toastService.info("\u6B63\u5728\u6E05\u7406\u5B64\u7ACB\u7684 session \u6587\u4EF6..."))}scanOrphanSessions(){this.toastService.info("\u6B63\u5728\u6383\u63CF\u5B64\u7ACB\u7684 Session \u6587\u4EF6...",2e3),this.ipcService.send("scan-orphan-sessions",{})}recoverOrphanSessions(){let e=this.orphanSessions();if(e.length===0){this.toastService.warning("\u6C92\u6709\u9700\u8981\u6062\u5FA9\u7684 Session \u6587\u4EF6");return}this.isRecoveringOrphanSessions.set(!0),this.toastService.info(`\u6B63\u5728\u6062\u5FA9 ${e.length} \u500B\u5E33\u865F...`,2e3),this.ipcService.send("recover-orphan-sessions",{sessions:e})}dismissOrphanSessionDialog(){this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([])}toggleAllAccountSelection(e){let t=e.target.checked,i=new Set(this.filteredAccounts().map(o=>o.id));this.accounts.update(o=>o.map(s=>i.has(s.id)?N(M({},s),{selected:t}):s))}bulkAssignRole(e){let t=this.selectedAccounts().map(i=>i.id);if(t.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u89D2\u8272...",progress:{current:0,total:t.length},cancellable:!1}),this.simulateBulkOperationProgress(t.length,()=>{this.ipcService.send("bulk-assign-role",{accountIds:t,role:e}),this.toastService.success(`\u5DF2\u4E3A ${t.length} \u4E2A\u8D26\u6237\u5206\u914D\u89D2\u8272`)})}bulkAssignGroup(e){let t=e||window.prompt(this.t("enterGroupName"));if(t){let i=this.selectedAccounts().map(o=>o.id);if(i.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u5206\u7EC4...",progress:{current:0,total:i.length},cancellable:!1}),this.simulateBulkOperationProgress(i.length,()=>{this.ipcService.send("bulk-assign-group",{accountIds:i,group:t}),this.toastService.success(`\u5DF2\u4E3A ${i.length} \u4E2A\u8D26\u6237\u5206\u914D\u5206\u7EC4`)})}}bulkDelete(){let e=this.selectedAccounts().map(t=>t.id);if(e.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u8D26\u6237");return}window.confirm(`\u786E\u5B9A\u8981\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`)&&(this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5220\u9664\u8D26\u6237...",progress:{current:0,total:e.length},cancellable:!1}),this.simulateBulkOperationProgress(e.length,()=>{this.ipcService.send("bulk-delete-accounts",{accountIds:e}),this.toastService.success(`\u5DF2\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237`)}))}simulateBulkOperationProgress(e,t){let i=0,o=setInterval(()=>{i+=Math.max(1,Math.floor(e/20)),i>=e&&(i=e,clearInterval(o),setTimeout(()=>{this.progressDialog.set(N(M({},this.progressDialog()),{show:!1})),t()},300)),this.progressDialog.set(N(M({},this.progressDialog()),{progress:{current:i,total:e,message:`\u5904\u7406\u4E2D ${i}/${e}`}}))},50)}updateAccountRole(e,t){this.ipcService.send("update-account-data",{id:e,updates:{role:t}})}showAddGroupDialog(){this.toastService.info("\u8ACB\u5728\u76E3\u63A7\u7FA4\u7D44\u5340\u584A\u4E2D\u9EDE\u64CA\u300C+ \u6DFB\u52A0\u7FA4\u7D44\u300D")}showAddKeywordSetDialog(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.newKeywordSet.set({name:""}),this.showKeywordSetCreator.set(!0)}submitNewKeywordSet(){let t=this.newKeywordSet().name.trim();t?(console.log("[Frontend] Sending add-keyword-set command:",t),this.ipcService.send("add-keyword-set",{name:t}),this.toastService.success("\u6B63\u5728\u5275\u5EFA\u95DC\u9375\u8A5E\u96C6...",2e3),this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})):this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}cancelNewKeywordSet(){this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})}addKeywordSet(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let i=this.newKeywordSet().name.trim();if(i){if(!i){this.toastService.warning("\u95DC\u9375\u8A5E\u96C6\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A",3e3);return}console.log("[Frontend] Sending add-keyword-set command:",i),this.ipcService.send("add-keyword-set",{name:i})}else this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}handleSaveGroupConfig(e){console.log("[Frontend] Saving group config:",e);let t=this.monitoredGroups().find(i=>i.id===e.groupId);t?(this.ipcService.send("add-group",{url:t.url,keywordSetIds:e.keywordSetIds}),this.toastService.success("\u7FA4\u7D44\u914D\u7F6E\u5DF2\u4FDD\u5B58",2e3)):(console.error("[Frontend] Group not found for config save:",e.groupId),this.toastService.error("\u627E\u4E0D\u5230\u7FA4\u7D44\uFF0C\u7121\u6CD5\u4FDD\u5B58\u914D\u7F6E"))}handleSaveKeywordSetConfig(e){console.log("[Frontend] Saving keyword set config:",e);let i=this.keywordSets().find(s=>s.id===e.setId)?.keywords?.map(s=>s.keyword)||[],o=e.keywords.filter(s=>!i.includes(s));for(let s of o)console.log("[Frontend] Adding keyword:",s,"to set:",e.setId),this.ipcService.send("add-keyword",{setId:e.setId,keyword:s,isRegex:!1});o.length>0?this.toastService.success(`\u5DF2\u6DFB\u52A0 ${o.length} \u500B\u95DC\u9375\u8A5E`,2e3):this.toastService.info("\u6C92\u6709\u65B0\u95DC\u9375\u8A5E\u9700\u8981\u6DFB\u52A0",2e3)}handleExtractMembersFromAutomation(e){console.log("[Frontend] Extract members from automation center:",e);try{let t="";e.groupUrl&&(t=e.groupUrl.replace("@","").replace("https://t.me/","").replace("http://t.me/","").replace("t.me/","").split("/")[0]);let i=this.monitoredGroups().find(r=>r.id===parseInt(e.groupId,10)||r.url===e.groupUrl||r.url===`@${t}`||r.url===t),o=this.discoveredResources().find(r=>r.username===t||r.id===parseInt(e.groupId,10)),s={id:o?.id||parseInt(e.groupId,10)||0,title:e.groupName,username:t,telegram_id:o?.telegram_id||i?.telegram_id||t||e.groupId,member_count:e.memberCount||i?.member_count||0,resource_type:"group"};if(console.log("[Frontend] Opening member list dialog with resource:",s),!s.telegram_id&&!s.username){this.toastService.error("\u7121\u6CD5\u7372\u53D6\u7FA4\u7D44\u4FE1\u606F\uFF0C\u8ACB\u5F9E\u8CC7\u6E90\u767C\u73FE\u9801\u9762\u63D0\u53D6\u6210\u54E1");return}this.currentView.set("resources"),setTimeout(()=>{this.openMemberListDialog(s)},100)}catch(t){console.error("[Frontend] Error opening member list dialog:",t),this.toastService.error("\u6253\u958B\u6210\u54E1\u63D0\u53D6\u5C0D\u8A71\u6846\u5931\u6557")}}addKeyword(){let e=this.newKeyword();if(!e.setId){this.toastService.warning(this.t("selectKeywordSetFirst"),3e3);return}if(!e.keyword.trim()){this.toastService.warning(this.t("keywordEmpty"),3e3);return}if(e.isRegex)try{new RegExp(e.keyword)}catch(l){this.toastService.error(`${this.t("invalidRegex")}: ${l.message}`,4e3);return}let t=e.keyword.trim(),i=this.keywordSets().find(l=>l.id===e.setId);if(!i){this.toastService.error("\u95DC\u9375\u8A5E\u96C6\u4E0D\u5B58\u5728",3e3);return}if(i.keywords.some(l=>l.keyword===t&&l.isRegex===e.isRegex)){this.toastService.warning("\u8A72\u95DC\u9375\u8A5E\u5DF2\u5B58\u5728\u65BC\u6B64\u95DC\u9375\u8A5E\u96C6\u4E2D",3e3);return}let r={id:Date.now(),keyword:t,isRegex:e.isRegex};this.keywordSets.update(l=>l.map(d=>d.id===e.setId?N(M({},d),{keywords:[...d.keywords,r]}):d)),this.newKeyword.set({setId:e.setId,keyword:"",isRegex:!1}),this.testKeywordText.set(""),this.keywordTestResult.set(null),this.ipcService.send("add-keyword",{setId:e.setId,keyword:t,isRegex:e.isRegex}),this.toastService.success(this.t("keywordAdded"),2e3)}onTestTextInput(e){e.target.value.trim()||this.keywordTestResult.set(null)}testKeyword(){let e=this.newKeyword(),t=this.testKeywordText().trim();if(!e.keyword.trim()){this.toastService.warning("\u8ACB\u5148\u8F38\u5165\u95DC\u9375\u8A5E",2e3),this.keywordTestResult.set(null);return}if(!t){this.keywordTestResult.set(null);return}try{let i=!1;if(e.isRegex)try{i=new RegExp(e.keyword,"i").test(t)}catch(o){this.keywordTestResult.set({matches:!1,error:o.message}),this.toastService.error(`${this.t("invalidRegex")}: ${o.message}`,4e3);return}else i=t.toLowerCase().includes(e.keyword.toLowerCase());this.keywordTestResult.set({matches:i})}catch(i){this.keywordTestResult.set({matches:!1,error:i.message}),this.toastService.error(`\u6E2C\u8A66\u5931\u6557: ${i.message}`,3e3)}}removeKeywordFromSet(e,t){let i=this.keywordSets().find(s=>s.id===e),o=i?.keywords.find(s=>s.id===t);i&&o?(this.keywordSets.update(s=>s.map(r=>r.id===e?N(M({},r),{keywords:r.keywords.filter(l=>l.id!==t)}):r)),this.ipcService.send("remove-keyword",{setId:e,keywordId:t}),this.toastService.success("\u95DC\u9375\u8A5E\u5DF2\u522A\u9664",2e3)):this.toastService.warning("\u95DC\u9375\u8A5E\u4E0D\u5B58\u5728",2e3)}addGroup(){let e=this.membershipService.quotas();if(e.maxGroups!==-1&&this.monitoredGroups().length>=e.maxGroups){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxGroups} \u500B\u7FA4\u7D44`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newGroup();t.url.trim()&&(this.monitoredGroups().some(o=>o.url===t.url.trim())&&this.toastService.warning("\u8A72\u7FA4\u7D44\u5DF2\u5B58\u5728\uFF0C\u5C07\u66F4\u65B0\u95DC\u9375\u8A5E\u96C6\u914D\u7F6E",3e3),this.ipcService.send("add-group",{url:t.url.trim(),keywordSetIds:t.keywordSetIds}),this.newGroup.set({url:"",keywordSetIds:[]}))}joinGroup(e){console.log("[Frontend] joinGroup called with:",e),console.log("[Frontend] All accounts:",this.accounts());let t=this.accounts(),i=t.filter(s=>s.role==="Listener"&&s.status==="Online");if(console.log("[Frontend] Listener accounts:",i),i.length===0){let s=t.filter(r=>r.status==="Online");if(console.log("[Frontend] Online accounts (any role):",s),s.length===0){this.toastService.error("\u6C92\u6709\u5728\u7DDA\u7684\u5E33\u865F\uFF0C\u7121\u6CD5\u52A0\u5165\u7FA4\u7D44",3e3);return}i=s,this.toastService.warning("\u6C92\u6709\u76E3\u63A7\u5E33\u865F\uFF0C\u4F7F\u7528\u5176\u4ED6\u5728\u7DDA\u5E33\u865F\u52A0\u5165",3e3)}let o=i[0].phone;console.log("[Frontend] Using phone to join:",o),this.toastService.info(`\u6B63\u5728\u5617\u8A66\u8B93 ${o} \u52A0\u5165\u7FA4\u7D44...`,3e3),this.ipcService.send("join-group",{phone:o,groupUrl:e})}toggleArrayItem(e,t){let i=[...e],o=i.indexOf(t);return o>-1?i.splice(o,1):i.push(t),i}toggleKeywordSetForNewGroup(e){this.newGroup.update(t=>t?N(M({},t),{keywordSetIds:this.toggleArrayItem(t.keywordSetIds||[],e)}):{url:"",keywordSetIds:[e]})}toggleTriggerGroup(e,t){this.campaigns.update(i=>i.map(o=>o.id===e?N(M({},o),{trigger:N(M({},o.trigger),{sourceGroupIds:this.toggleArrayItem(o.trigger.sourceGroupIds,t)})}):o))}toggleTriggerKeywordSet(e,t){this.campaigns.update(i=>i.map(o=>o.id===e?N(M({},o),{trigger:N(M({},o.trigger),{keywordSetIds:this.toggleArrayItem(o.trigger.keywordSetIds,t)})}):o))}toggleNewCampaignSourceGroup(e){this.newCampaign.update(t=>N(M({},t),{trigger:N(M({},t.trigger),{sourceGroupIds:this.toggleArrayItem(t.trigger.sourceGroupIds,e)})}))}toggleNewCampaignKeywordSet(e){this.newCampaign.update(t=>N(M({},t),{trigger:N(M({},t.trigger),{keywordSetIds:this.toggleArrayItem(t.trigger.keywordSetIds,e)})}))}removeById(e,t,i){console.log(`[Frontend] Removing ${i} with id: ${t}`);let o=e();o.find(r=>r.id===t)?(e.set(o.filter(r=>r.id!==t)),console.log(`[Frontend] Optimistically removed ${i} ${t} from local list`),this.toastService.success(`${i==="keyword-set"?"\u95DC\u9375\u8A5E\u96C6":i} \u522A\u9664\u6210\u529F`,2e3)):console.warn(`[Frontend] ${i} ${t} not found in local list`),this.ipcService.send(`remove-${i.replace(" ","-")}`,{id:t})}openLeadDetailModal(e){let t=this.messageTemplates().find(o=>o.id===e.assignedTemplateId);this.generationState.set({status:"idle",lead:e,generatedMessage:"",error:null,customPrompt:t?.prompt||"",attachment:null,attachments:[]}),this.leadDetailView.set("sendMessage"),this.messageMode.set("manual"),this.editableMessage.set("");let i=this.senderAccounts();i.length>0&&!this.selectedSenderId()&&this.selectedSenderId.set(i[0].id)}closeLeadDetailModal(){this.generationState.set({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]}),this.editableMessage.set(""),this.messageMode.set("manual")}startAiChat(e){this.openLeadDetailModal(e),this.messageMode.set("ai"),this.toastService.info(`\u{1F916} \u5DF2\u958B\u555F AI \u804A\u5929\u6A21\u5F0F\uFF0C\u70BA @${e.username||e.userId} \u751F\u6210\u667A\u80FD\u56DE\u8986`)}inviteToGroup(e){if(this.collabGroups().length===0){this.toastService.warning("\u26A0\uFE0F \u8ACB\u5148\u5728\u300C\u591A\u89D2\u8272\u5354\u4F5C\u300D\u4E2D\u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44"),this.currentView.set("multi-role");return}this.selectedLeadForInvite.set(e),this.showInviteGroupDialog.set(!0),this.toastService.info(`\u{1F465} \u9078\u64C7\u8981\u9080\u8ACB @${e.username||e.userId} \u7684\u7FA4\u7D44`)}executeInviteToGroup(e){let t=this.selectedLeadForInvite();t&&(this.ipcService.send("invite-lead-to-collab-group",{leadId:t.id,userId:t.userId,username:t.username,groupId:e}),this.showInviteGroupDialog.set(!1),this.selectedLeadForInvite.set(null),this.toastService.success("\u2713 \u5DF2\u767C\u9001\u9080\u8ACB\u8ACB\u6C42"))}addToDnc(e){this.ipcService.send("add-to-dnc",{leadId:e.id,userId:e.userId}),this.toastService.success(`\u{1F6AB} \u5DF2\u5C07 @${e.username||e.userId} \u52A0\u5165\u9ED1\u540D\u55AE`)}async generateMessage(){let e=this.membershipService.canUseAi();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5 AI \u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState();if(t.lead){this.generationState.update(i=>N(M({},i),{status:"loading",error:null}));try{let i=t.customPrompt;this.spintaxEnabled()&&(i=this.parseSpintax(i));let o=this.aiApiType(),s="";o==="local"||o==="custom"?s=await this.generateWithLocalAI(t.lead,i):o==="openai"?s=await this.generateWithOpenAI(t.lead,i):s=await this.geminiService.generateOutreachMessage(t.lead,i),this.membershipService.recordAiCall(1),this.generationState.update(r=>N(M({},r),{status:"success",generatedMessage:s})),this.editableMessage.set(s)}catch(i){this.generationState.update(o=>N(M({},o),{status:"error",error:i.message}))}}}async generateWithLocalAI(e,t){let i=this.aiApiType()==="local"?this.localAiEndpoint():this.customApiEndpoint(),o=this.localAiModel()||"default";if(!i)throw new Error("\u672C\u5730 AI \u7AEF\u9EDE\u672A\u914D\u7F6E");let s=`\u4F60\u662F\u4E00\u500B\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\u6D88\u606F\u3002
\u898F\u5247\uFF1A
1. \u6D88\u606F\u5FC5\u9808\u7C21\u77ED\uFF0815-40\u5B57\u4EE5\u5167\uFF09
2. \u50CF\u670B\u53CB\u804A\u5929\u4E00\u6A23\u81EA\u7136\uFF0C\u4E0D\u8981\u592A\u6B63\u5F0F
3. \u4E0D\u8981\u4F7F\u7528"\u60A8\u597D"\u7B49\u904E\u65BC\u6B63\u5F0F\u7684\u958B\u982D
4. \u53EF\u4EE5\u7528"\u55E8"\u3001"\u54C8\u56C9"\u3001"hi"\u7B49\u8F15\u9B06\u554F\u5019
5. \u76F4\u63A5\u5207\u5165\u8A71\u984C\uFF0C\u4E0D\u8981\u56C9\u55E6
6. \u8A9E\u6C23\u8F15\u9B06\u53CB\u597D\uFF0C\u50CF\u662F\u5728\u5FAE\u4FE1\u804A\u5929`,r=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\u3002
\u7528\u4E00\u53E5\u8A71\u6253\u500B\u62DB\u547C\uFF0C\u7C21\u77ED\u81EA\u7136\u5C31\u597D\u3002`;return new Promise((l,d)=>{let u=setTimeout(()=>{d(new Error("AI \u751F\u6210\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u670D\u52D9\u9023\u63A5"))},6e4);this.ipcService.once("ai-response",f=>{clearTimeout(u),console.log("[AI] Received ai-response:",f),f?.success&&f?.response?l(f.response):d(new Error(f?.error||"AI \u751F\u6210\u5931\u6557"))}),console.log("[AI] Sending generate-ai-response with endpoint:",i),this.ipcService.send("generate-ai-response",{userId:e.id||e.username,message:r,systemPrompt:s,localAiEndpoint:i,localAiModel:o})})}async generateWithOpenAI(e,t){let i=this.aiApiKey();if(!i)throw new Error("OpenAI API Key \u672A\u914D\u7F6E");let o="\u4F60\u662F\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\uFF0815-40\u5B57\uFF09\uFF0C\u50CF\u670B\u53CB\u804A\u5929\uFF0C\u4E0D\u8981\u6B63\u5F0F\u3002",s=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\uFF0C\u7528\u4E00\u53E5\u8A71\u6253\u62DB\u547C\u3002`,r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:o},{role:"user",content:s}],max_tokens:500,temperature:.7})});if(!r.ok)throw new Error(`OpenAI API \u932F\u8AA4: ${r.status}`);return(await r.json()).choices?.[0]?.message?.content||"\u751F\u6210\u5931\u6557"}updateCustomPrompt(e){this.generationState.update(t=>N(M({},t),{customPrompt:e}))}applyTemplate(e){let t=e.target,i=parseInt(t.value,10);if(!i)return;let o=this.messageTemplates().find(s=>s.id===i);if(o){let s=o.prompt;this.spintaxEnabled()&&(s=this.parseSpintax(s)),this.editableMessage.set(s)}}isAiConfigured(){let e=this.aiApiType();return e==="local"?!!this.localAiEndpoint():e==="custom"?!!this.customApiEndpoint()&&!!this.aiApiKey():this.geminiService.isConfigured()||!!this.aiApiKey()}canSendMessage(){let e=this.editableMessage().trim().length>0,t=this.generationState(),i=t.attachment!==null||t.attachments.length>0,o=this.selectedSenderId()!==null&&this.senderAccounts().length>0;return(e||i)&&o}sendMessageToLead(){let e=this.membershipService.canSendMessage();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5\u6D88\u606F\u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState(),i=t.lead;if(!i)return;let o=this.editableMessage().trim(),s=t.attachment!==null;if(!o&&!s){this.toastService.error(this.t("messageRequired"),3e3);return}let r=this.selectedSenderId();if(!r){this.toastService.error(this.t("selectSenderFirst"),3e3);return}let l=this.accounts().find(u=>u.id===r);if(!l){this.toastService.error(this.t("senderAccountNotFound"),3e3);return}let d=t.attachments.length>0?t.attachments:t.attachment?[t.attachment]:[];d.length===0?this.ipcService.send("send-message",{leadId:i.id,accountPhone:l.phone,userId:i.userId,username:i.username,sourceGroup:i.sourceGroup,message:o,attachment:null}):d.length===1?this.ipcService.send("send-message",{leadId:i.id,accountPhone:l.phone,userId:i.userId,username:i.username,sourceGroup:i.sourceGroup,message:o,attachment:d[0]}):d.forEach((u,f)=>{this.ipcService.send("send-message",{leadId:i.id,accountPhone:l.phone,userId:i.userId,username:i.username,sourceGroup:i.sourceGroup,message:f===0?o:"",attachment:u})}),this.membershipService.recordMessageSent(1),this.toastService.success(this.t("messageQueued"),2e3),this.closeLeadDetailModal()}sendMessage(){this.sendMessageToLead()}onFileAttached(e,t){let i=e.target;if(!i.files?.length)return;let o=i.files[0];o.size>10*1024*1024&&this.toastService.warning("\u5927\u6587\u4EF6\u5EFA\u8B70\u4F7F\u7528\u300C\u9078\u64C7\u6587\u4EF6\u300D\u6309\u9215\u4E0A\u50B3",3e3);let s=new FileReader;s.onload=()=>{let r={name:o.name,type:t,dataUrl:s.result,fileSize:o.size};this.generationState.update(l=>N(M({},l),{attachment:r}))},s.readAsDataURL(o),i.value=""}async selectAttachment(e,t=!1){let i=await this.ipcService.selectFileForAttachment(e,t);if(!i.success){i.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}if(t&&i.files){let o=i.files.map(l=>({name:l.fileName,type:l.fileType,filePath:l.filePath,fileSize:l.fileSize}));this.generationState.update(l=>N(M({},l),{attachments:[...l.attachments,...o],attachment:o[0]}));let r=(o.reduce((l,d)=>l+(d.fileSize||0),0)/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7 ${o.length} \u500B\u6587\u4EF6 (\u5171 ${r} MB)`,2e3)}else{let o={name:i.fileName,type:i.fileType,filePath:i.filePath,fileSize:i.fileSize};this.generationState.update(r=>N(M({},r),{attachment:o,attachments:[o]}));let s=(i.fileSize/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7: ${i.fileName} (${s} MB)`,2e3)}}async addMoreAttachments(e){let t=await this.ipcService.selectFileForAttachment(e,!0);if(!t.success||!t.files){t.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}let i=t.files.map(o=>({name:o.fileName,type:o.fileType,filePath:o.filePath,fileSize:o.fileSize}));this.generationState.update(o=>N(M({},o),{attachments:[...o.attachments,...i],attachment:o.attachment||i[0]})),this.toastService.success(`\u5DF2\u6DFB\u52A0 ${i.length} \u500B\u6587\u4EF6`,2e3)}removeAttachmentByIndex(e){this.generationState.update(t=>{let i=t.attachments.filter((o,s)=>s!==e);return N(M({},t),{attachments:i,attachment:i.length>0?i[0]:null})})}clearAllAttachments(){this.generationState.update(e=>N(M({},e),{attachments:[],attachment:null}))}getTotalAttachmentSize(){return(this.generationState().attachments.reduce((i,o)=>i+(o.fileSize||0),0)/1024/1024).toFixed(2)}removeAttachment(){this.clearAllAttachments()}parseSpintax(e){let t=/\{([^{}]+)\}/g;for(;t.test(e);)e=e.replace(t,(i,o)=>{let s=o.split("|");return s[Math.floor(Math.random()*s.length)]});return e}addInteractionHistory(e,t,i,o){let s={id:Date.now(),timestamp:new Date,type:t,content:i};if(o&&o.id===e){o.interactionHistory.unshift(s);return}this.leads.update(r=>r.map(l=>l.id===e?N(M({},l),{interactionHistory:[s,...l.interactionHistory]}):l))}updateLeadStatus(e,t,i=!0){this.ipcService.send("update-lead-status",{leadId:e,newStatus:t})}toggleLeadMenu(e){this.openLeadMenuId()===e?this.openLeadMenuId.set(null):this.openLeadMenuId.set(e)}closeLeadMenu(){this.openLeadMenuId.set(null)}addToDoNotContact(e){let t=this.leads().find(i=>i.id===e);t&&(this.ipcService.send("add-to-dnc",{userId:t.userId}),this.closeLeadDetailModal())}updateAdTemplateName(e){this.newAdTemplate.update(t=>N(M({},t),{name:e}))}updateAdTemplateContent(e){this.newAdTemplate.update(t=>N(M({},t),{content:e}))}updateAdTemplateMediaType(e){this.newAdTemplate.update(t=>N(M({},t),{mediaType:e}))}updateAdScheduleName(e){this.newAdSchedule.update(t=>N(M({},t),{name:e}))}updateAdScheduleTemplateId(e){this.newAdSchedule.update(t=>N(M({},t),{templateId:e}))}updateAdScheduleSendMode(e){this.newAdSchedule.update(t=>N(M({},t),{sendMode:e}))}updateAdScheduleType(e){this.newAdSchedule.update(t=>N(M({},t),{scheduleType:e}))}updateAdScheduleTime(e){this.newAdSchedule.update(t=>N(M({},t),{scheduleTime:e}))}updateAdScheduleInterval(e){this.newAdSchedule.update(t=>N(M({},t),{intervalMinutes:e}))}updateAdScheduleStrategy(e){this.newAdSchedule.update(t=>N(M({},t),{accountStrategy:e}))}updateTrackedUserId(e){this.newTrackedUser.update(t=>N(M({},t),{userId:e}))}updateTrackedUserName(e){this.newTrackedUser.update(t=>N(M({},t),{username:e}))}updateTrackedUserNotes(e){this.newTrackedUser.update(t=>N(M({},t),{notes:e}))}updateCampaignFormName(e){this.campaignFormData.update(t=>N(M({},t),{name:e}))}updateCampaignFormDesc(e){this.campaignFormData.update(t=>N(M({},t),{description:e}))}updateRoleAssignPhone(e){this.newRoleAssign.update(t=>N(M({},t),{accountPhone:e}))}updateRoleAssignType(e){this.newRoleAssign.update(t=>N(M({},t),{roleType:e}))}updateRoleAssignName(e){this.newRoleAssign.update(t=>N(M({},t),{roleName:e}))}getRolesOfType(e){return this.allRoles().filter(t=>t.roleType===e)}addTemplate(){let e=this.newTemplate();e.name.trim()&&e.prompt.trim()?(this.ipcService.send("add-template",{name:e.name,prompt:e.prompt}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F")):this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}addTemplateQuick(e,t){if(e?.trim()&&t?.trim()){if(this.messageTemplates().some(o=>o.name===e.trim())){this.toastService.warning("\u6A21\u677F\u540D\u7A31\u5DF2\u5B58\u5728\uFF0C\u7121\u6CD5\u5275\u5EFA\u91CD\u8907\u6A21\u677F",3e3);return}this.ipcService.send("add-template",{name:e.trim(),prompt:t.trim()}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F"),this.messageTemplates().length>0&&this.showTemplateCreator.set(!1)}else this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}updateTemplateName(e){this.newTemplate.update(t=>N(M({},t),{name:e}))}updateTemplatePrompt(e){this.newTemplate.update(t=>N(M({},t),{prompt:e}))}insertTemplateVariable(e,t){let i=e.selectionStart,o=e.selectionEnd,s=e.value,r=s.substring(0,i)+t+s.substring(o);e.value=r,this.updateTemplatePrompt(r),setTimeout(()=>{e.focus(),e.selectionStart=e.selectionEnd=i+t.length},0)}toggleTemplateStatus(e){this.ipcService.send("toggle-template-status",{id:e})}removeTemplate(e){let t=this.messageTemplates().find(o=>o.id===e);if(!t)return;let i=this.campaigns().filter(o=>o.actions.some(s=>s.templateId===e));if(i.length>0){let o=i.map(s=>s.name).join(", ");if(!confirm(`\u6A21\u677F "${t.name}" \u6B63\u5728\u88AB\u4EE5\u4E0B\u6D3B\u52D5\u4F7F\u7528\uFF1A${o}

\u522A\u9664\u6A21\u677F\u5F8C\uFF0C\u9019\u4E9B\u6D3B\u52D5\u5C07\u7121\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002

\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F`))return}else if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F "${t.name}" \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002`))return;this.ipcService.send("remove-template",{id:e}),this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664")}getTemplateName(e){return e?this.messageTemplates().find(t=>t.id===e)?.name||"Unknown Template":"N/A"}getKeywordSetName(e){return this.keywordSets().find(t=>t.id===e)?.name||"Unknown Set"}getGroupName(e){return this.monitoredGroups().find(t=>t.id===e)?.name||"Unknown Group"}getCampaignName(e){return e?this.campaigns().find(t=>t.id===e)?.name||"Unknown Campaign":"N/A"}getCampaignById(e){if(e!==void 0)return this.campaigns().find(t=>t.id===e)}getEmptyCampaignForm(){return{name:"",trigger:{sourceGroupIds:[],keywordSetIds:[]},action:{templateId:0,minDelaySeconds:30,maxDelaySeconds:120}}}addCampaign(){if(this.isSubmittingCampaign()){this.toastService.warning("\u6B63\u5728\u5275\u5EFA\u6D3B\u52D5\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.newCampaign(),t=[];if(e.name?.trim()||t.push("\u6D3B\u52A8\u540D\u79F0"),(!e.action.templateId||e.action.templateId===0)&&t.push("\u6D88\u606F\u6A21\u677F"),e.trigger.sourceGroupIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6765\u6E90\u7FA4\u7EC4"),e.trigger.keywordSetIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5173\u952E\u8BCD\u96C6"),t.length>0){this.toastService.error(`\u8BF7\u5B8C\u5584\u4EE5\u4E0B\u5185\u5BB9: ${t.join(", ")}`);return}let i=e.name.trim();if(this.campaigns().find(s=>s.name===i)){this.toastService.warning(`\u6D3B\u52D5 "${i}" \u5DF2\u5B58\u5728\uFF0C\u8ACB\u4F7F\u7528\u4E0D\u540C\u7684\u540D\u7A31`,4e3);return}this.isSubmittingCampaign.set(!0),this.newCampaign.set(this.getEmptyCampaignForm()),this.ipcService.send("add-campaign",M({},e)),setTimeout(()=>{this.isSubmittingCampaign.set(!1)},3e3)}toggleCampaignStatus(e){this.ipcService.send("toggle-campaign-status",{id:e})}getLogColor(e){switch(e){case"info":return"text-cyan-400";case"success":return"text-green-400";case"warning":return"text-yellow-400";case"error":return"text-red-400";default:return"text-slate-400"}}formatTimestamp(e){if(!e)return"";try{let t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString()+" "+t.toLocaleTimeString()}catch{return""}}async loadChatList(){try{let e=this.chatListSearch(),t=this.chatListFunnelFilter();this.ipcService.send("get-chat-list",{limit:50,offset:0,search:e||void 0,funnelStage:t||void 0})}catch(e){console.error("[Frontend] Error loading chat list:",e)}}onChatListSearchChange(e){this.chatListSearch.set(e),this.chatListSearchDebounceTimer&&clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=setTimeout(()=>{this.loadChatList(),this.chatListSearchDebounceTimer=void 0},300)}onLogFilterChange(){this.logFilterDebounceTimer&&clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=setTimeout(()=>{this.applyLogFilter(),this.logFilterDebounceTimer=void 0},500)}refreshQueueStatusThrottled(){let e=Date.now(),t=e-this.lastQueueStatusRefresh;t>=2e3?(this.lastQueueStatusRefresh=e,this.refreshQueueStatus()):(this.queueStatusRefreshThrottleTimer&&clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=setTimeout(()=>{this.lastQueueStatusRefresh=Date.now(),this.queueStatusRefreshThrottleTimer=void 0,this.refreshQueueStatus()},2e3-t))}getAccountQueueStatuses(){let e=this.queueStatuses();return Object.entries(e).map(([t,i])=>{let o=this.accounts().find(s=>s.phone===t);return{phone:t,displayName:t,status:i.processing>0?"active":(i.pending>0,"idle"),pending:i.pending,processing:i.processing,completed:i.stats.completed,failed:i.stats.failed,retrying:i.retrying,sendRate:i.processing>0?1.5:0,avgResponseTime:500,dailyLimit:o?.dailySendLimit??100,dailyUsed:o?.dailySendCount??0,estimatedMinutes:i.pending>0?Math.ceil(i.pending/1.5):0,lastError:i.failed>0?"\u90E8\u5206\u6D88\u606F\u767C\u9001\u5931\u6557":void 0}})}pauseAllQueues(){this.ipcService.send("pause-all-queues",{}),this.toastService.info("\u6B63\u5728\u66AB\u505C\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}resumeAllQueues(){this.ipcService.send("resume-all-queues",{}),this.toastService.info("\u6B63\u5728\u6062\u5FA9\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}retryAllFailed(){this.ipcService.send("retry-all-failed",{}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u6240\u6709\u5931\u6557\u7684\u6D88\u606F...",2e3)}checkAutomationConfig(){this.toastService.info("\u6B63\u5728\u6AA2\u67E5\u914D\u7F6E...",2e3),this.ipcService.send("check-automation-config",{accounts:this.accounts().map(e=>({phone:e.phone,role:e.role,status:e.status})),groups:this.monitoredGroups(),keywords:this.keywordSets(),campaigns:this.campaigns()})}handleWorkflowNavigation(e){this.changeView(e.view),e.handler&&setTimeout(()=>{switch(e.handler){case"start-monitoring":this.startMonitoring();break;case"scan-sessions":this.scanOrphanSessions();break;case"new-campaign":break;case"export-leads":this.exportLeads();break;default:console.log("[Workflow] Unknown handler:",e.handler)}},300)}onWorkflowCompleted(e){this.toastService.success(`\u{1F389} \u5DE5\u4F5C\u6D41\u300C${e.title}\u300D\u5DF2\u5B8C\u6210\uFF01`,4e3),console.log("[Workflow] Completed:",e.id)}async loadChatHistory(e,t=!0){try{console.log("[Frontend] Loading chat history for user:",e,"reset:",t),t?(this.isLoadingChatHistory.set(!0),this.chatHistoryPage.set(0),this.chatHistoryAllMessages.set([])):this.chatHistoryLoadingMore.set(!0),this.selectedChatUserId.set(e);let i=this.chatHistoryPage(),o=this.chatHistoryPageSize(),s=i*o;console.log("[Frontend] Sending get-chat-history-full:",{userId:e,limit:o,offset:s}),this.ipcService.send("get-chat-history-full",{userId:e,limit:o,offset:s})}catch(i){console.error("[Frontend] Error loading chat history:",i),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}}async loadMoreChatHistory(){let e=this.selectedChatUserId();!e||this.chatHistoryLoadingMore()||!this.chatHistoryHasMore()||(this.chatHistoryPage.update(t=>t+1),await this.loadChatHistory(e,!1))}onChatHistoryScroll(e){let t=e.target;if(!t)return;let i=t.scrollTop,o=t.scrollHeight,s=t.clientHeight;o-i-s<200&&this.chatHistoryHasMore()&&!this.chatHistoryLoadingMore()&&this.loadMoreChatHistory()}async sendAiResponse(e,t){try{let i=this.generationState().lead;if(!i)return;this.ipcService.send("send-ai-response",{userId:e,message:t,accountPhone:this.senderAccounts().find(o=>o.id===this.selectedSenderId())?.phone,sourceGroup:i.sourceGroup,username:i.username}),setTimeout(()=>{this.loadChatHistory(e)},1e3)}catch(i){console.error("[Frontend] Error sending AI response:",i)}}async checkMonitoringStatus(){try{this.ipcService.send("get-monitoring-status",{})}catch(e){console.error("[Frontend] Error checking monitoring status:",e)}}async checkMonitoringHealth(){try{this.ipcService.send("check-monitoring-health",{})}catch(e){console.error("[Frontend] Error checking monitoring health:",e)}}trackByChatMessageId(e,t){return t.id||e}trackByChatId(e,t){return t.userId||e}trackByLogId(e,t){let i=0;return t.timestamp&&(t.timestamp instanceof Date?i=t.timestamp.getTime():typeof t.timestamp=="number"?i=t.timestamp:typeof t.timestamp=="string"&&(i=new Date(t.timestamp).getTime()||0)),`${t.id}-${i}-${e}`}isValidAlertDetails(e){if(!e||typeof e!="object"||e===null||Array.isArray(e))return!1;try{return Object.keys(e).length>0}catch{return!1}}safeStringify(e){try{return JSON.stringify(e,null,2)}catch{return"\u7121\u6CD5\u986F\u793A\u8A73\u60C5"}}getStatusColor(e){switch(e){case"Online":return"bg-green-500/10 text-green-400";case"Offline":return"bg-slate-500/10 text-slate-400";case"Banned":return"bg-red-500/10 text-red-400";case"Proxy Error":return"bg-orange-500/10 text-orange-400";case"Logging in...":return"bg-blue-500/10 text-blue-400 animate-pulse";case"Resting (Cooldown)":return"bg-yellow-500/10 text-yellow-400";case"Warming Up":return"bg-indigo-500/10 text-indigo-400 animate-pulse";case"New":return"bg-blue-500/10 text-blue-400";case"Contacted":return"bg-yellow-500/10 text-yellow-400";case"Replied":return"bg-green-500/10 text-green-400";case"Follow-up":return"bg-purple-500/10 text-purple-400";case"Closed-Won":return"bg-teal-500/10 text-teal-400";case"Closed-Lost":return"bg-red-500/10 text-red-400";default:return"bg-slate-700/20 text-slate-300"}}getStatusBarColor(e){switch(e){case"New":return"bg-amber-500";case"Contacted":return"bg-cyan-500";case"Replied":return"bg-purple-500";case"Follow-up":return"bg-orange-500";case"Closed-Won":return"bg-emerald-500";case"Closed-Lost":return"bg-red-500";default:return"bg-slate-500"}}getHealthColor(e){return e>80?"bg-green-500":e>50?"bg-yellow-500":"bg-red-500"}getOnlineStatusColor(e){switch(e){case"Online":return"bg-green-500";case"Recently":return"bg-yellow-500";case"Offline":return"bg-slate-500";default:return"bg-slate-400"}}getIntentLevelColor(e){switch(e){case"HOT":return"bg-red-500/20 text-red-400 border border-red-500/30";case"WARM":return"bg-orange-500/20 text-orange-400 border border-orange-500/30";case"NEUTRAL":return"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30";case"COLD":return"bg-blue-500/20 text-blue-400 border border-blue-500/30";case"NONE":return"bg-slate-500/20 text-slate-400 border border-slate-500/30";default:return"bg-slate-500/20 text-slate-400 border border-slate-500/30"}}getIntentLevelEmoji(e){switch(e){case"HOT":return"\u{1F525}";case"WARM":return"\u{1F321}\uFE0F";case"NEUTRAL":return"\u{1F610}";case"COLD":return"\u2744\uFE0F";case"NONE":return"\u26AA";default:return"\u26AA"}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-root"]],viewQuery:function(t,i){if(t&1&&Pn(j1,5)(eS,5),t&2){let o;dn(o=un())&&(i.onboardingComponent=o.first),dn(o=un())&&(i.monitoringGroupsRef=o.first)}},hostBindings:function(t,i){t&1&&D("click",function(s){return i.onDocumentClick(s)},Tt)},features:[na([En,Ne])],decls:26,vars:7,consts:[["onboardingRef",""],[1,"fixed","bottom-4","right-4","z-50"],[1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","pointer-events-none"],[3,"navigate"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"flex","h-screen",2,"background-color","var(--bg-primary)","color","var(--text-primary)"],[1,"auth-wrapper",2,"min-height","100vh","background","linear-gradient(to bottom right, #0f172a, #1e293b, #0f172a)"],[1,"group","relative"],[1,"w-3","h-3","rounded-full","bg-slate-500","cursor-default"],[1,"absolute","bottom-full","right-0","mb-2","hidden","group-hover:block"],[1,"bg-slate-800/95","backdrop-blur-sm","rounded-lg","px-3","py-2","shadow-lg","border","border-slate-700","whitespace-nowrap"],[1,"text-xs","text-slate-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-xs","text-amber-400","mt-1"],[1,"w-3","h-3","rounded-full","bg-cyan-500","animate-pulse","cursor-default"],[1,"text-xs","text-slate-300"],[1,"w-3","h-3","rounded-full","bg-amber-500","cursor-pointer",3,"click"],[1,"text-xs","text-amber-400"],[1,"w-3","h-3","rounded-full","bg-red-500","cursor-pointer","animate-pulse",3,"click"],[1,"text-xs","text-red-400"],[1,"absolute","inset-0","bg-black/40","animate-fade-in"],[1,"relative","z-10","animate-success-pop"],[1,"absolute","inset-0","-m-8","rounded-full","bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","blur-xl","animate-pulse"],[1,"relative","bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","p-8","shadow-2xl","border","border-emerald-500/30"],[1,"flex","justify-center","mb-4"],[1,"w-20","h-20","rounded-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","flex","items-center","justify-center","shadow-lg","shadow-emerald-500/30"],[1,"text-4xl","animate-bounce"],[1,"text-center"],[1,"text-xl","font-bold","text-white","mb-1"],[1,"text-sm","text-slate-400"],[1,"absolute","-top-2","-left-2","w-4","h-4","bg-emerald-400","rounded-full","animate-ping"],[1,"absolute","-top-1","-right-3","w-3","h-3","bg-cyan-400","rounded-full","animate-ping",2,"animation-delay","0.1s"],[1,"absolute","-bottom-2","-left-1","w-2","h-2","bg-emerald-300","rounded-full","animate-ping",2,"animation-delay","0.2s"],[1,"absolute","-bottom-1","-right-2","w-3","h-3","bg-cyan-300","rounded-full","animate-ping",2,"animation-delay","0.3s"],[3,"closeDialog","sendComplete","isOpen","targets"],[3,"closeDialog","inviteComplete","isOpen","targets","accounts"],[3,"closeDialog","startExtractionEvent","memberCountRefreshed","isOpen","group"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm",3,"click"],[1,"relative","z-10"],[3,"closed","loginSuccess"],[3,"navigateEvent"],[3,"show","title","progress","cancellable"],[3,"dialogData"],[3,"groups"],["aria-controls","mobile-sidebar",1,"fixed","top-3","left-3","z-[9999]","w-10","h-10","rounded-lg","flex","items-center","justify-center","transition-all","duration-200",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 12px rgba(6, 182, 212, 0.5)"],[1,"fixed","inset-0","bg-black/50","z-[998]","backdrop-blur-sm","transition-opacity"],["id","mobile-sidebar","role","navigation","aria-label","\u4E3B\u5C0E\u822A",1,"backdrop-blur-sm","flex-shrink-0","flex","flex-col","sidebar","h-screen","transition-all","duration-300",2,"background-color","var(--bg-sidebar)","border-right","1px solid var(--border-default)"],[1,"flex-shrink-0"],[1,"absolute","top-3","-right-3","z-50","w-6","h-6","rounded-full","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 8px rgba(6, 182, 212, 0.4)",3,"title"],[1,"flex","items-center","gap-3","p-4"],[1,"relative","flex-shrink-0"],[1,"absolute","inset-0","rounded-xl","blur-md","opacity-50",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)"],["viewBox","0 0 64 64","fill","none",1,"h-10","w-10","relative","z-10"],["d","M32 8L52 20V44L32 56L12 44V20L32 8Z","fill","url(#sidebarLogoGrad)","stroke","url(#sidebarLogoStroke)","stroke-width","1.5"],["d","M22 28L40 22L34 36L28 32L22 28Z","fill","white","opacity","0.95"],["d","M28 32L34 36L32 42L28 32Z","fill","white","opacity","0.8"],["d","M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z","fill","#fbbf24"],["cx","32","cy","8","r","1.2","fill","#fef3c7"],["id","sidebarLogoGrad","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#0891b2"],["offset","100%","stop-color","#7c3aed"],["id","sidebarLogoStroke","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#22d3ee"],["offset","100%","stop-color","#a78bfa"],[1,"px-3","mb-2","flex","justify-end"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","level-bronze"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","cursor-pointer","transition-all","duration-300","hover:scale-[1.02]","group",3,"level-bronze","level-silver","level-gold","level-diamond","level-star","level-king"],[1,"flex-1","overflow-y-auto","overflow-x-hidden","sidebar-nav","mt-2","px-2","pb-2"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","sidebar-icon"],["points","12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"],["x","1","y","4","width","22","height","16","rx","2","ry","2"],["x1","1","y1","10","x2","23","y2","10"],["x","3","y","3","width","7","height","7"],["x","14","y","3","width","7","height","7"],["x","14","y","14","width","7","height","7"],["x","3","y","14","width","7","height","7"],[1,"sidebar-group"],[1,"w-full","flex","items-center","justify-between","px-3","py-2","mt-2","rounded-md","hover:bg-white/5","transition-colors","cursor-pointer","group",3,"click"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","transition-transform","duration-200",2,"color","var(--sidebar-group-title)"],["points","6 9 12 15 18 9"],[1,"sidebar-group-content","overflow-hidden"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","font-semibold","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-cyan-500","to-blue-500","text-center","leading-5","text-[10px]"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-violet-500","to-fuchsia-500","text-center","leading-5","text-[10px]"],[1,"flex-shrink-0","p-4","space-y-3","border-t",2,"border-color","var(--border-default)","background-color","var(--bg-sidebar)"],[1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2.5","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10","hover:from-cyan-500/20","hover:to-blue-500/20","border","border-cyan-500/30","hover:border-cyan-500/50","text-cyan-400","rounded-xl","transition-all","text-sm","font-medium","group",3,"click"],[1,"text-lg","group-hover:animate-bounce"],[1,"block","text-sm","font-medium","mb-2",2,"color","var(--sidebar-group-title)"],[1,"flex","rounded-md","shadow-sm","p-1",2,"background-color","var(--bg-tertiary)"],[1,"w-full","text-sm","py-1.5","rounded","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"],["role","main","aria-label","\u4E3B\u8981\u5167\u5BB9",1,"flex-1","overflow-y-auto",2,"background-color","var(--bg-primary)"],[3,"lead","generationState","leadDetailView","chatHistory","editableMessage","messageMode","senderAccounts","selectedSenderId","selectedChatUserId","chatHistoryHasMore","chatHistoryLoadingMore","isLoadingChatHistory","isAiConfigured","aiApiType","messageTemplates","canSendMessage","ragEnabled"],[3,"history"],[3,"step","ollamaDetected","isDetecting","ollamaModels","localModel","autoFallback","backupProvider"],[3,"sessions","isRecovering"],[3,"errorDetail"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600"],[3,"name"],[3,"cancel","confirm","dialogData"],[3,"close","inviteToGroup","goCreateGroup","groups"],["aria-controls","mobile-sidebar",1,"fixed","top-3","left-3","z-[9999]","w-10","h-10","rounded-lg","flex","items-center","justify-center","transition-all","duration-200",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 12px rgba(6, 182, 212, 0.5)",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5","text-white"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],["x1","3","y1","6","x2","21","y2","6"],["x1","3","y1","12","x2","21","y2","12"],["x1","3","y1","18","x2","21","y2","18"],[1,"fixed","inset-0","bg-black/50","z-[998]","backdrop-blur-sm","transition-opacity",3,"click"],[1,"absolute","top-3","-right-3","z-50","w-6","h-6","rounded-full","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 8px rgba(6, 182, 212, 0.4)",3,"click","title"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","text-white","transition-transform","duration-200"],["points","15 18 9 12 15 6"],[1,"text-xl","font-bold","bg-gradient-to-r","from-cyan-400","to-purple-400","bg-clip-text","text-transparent"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"flex","items-center","gap-3","animate-pulse"],[1,"w-12","h-12","rounded-full","bg-slate-600/40"],[1,"flex-1","min-w-0"],[1,"h-4","w-20","bg-slate-600/40","rounded","mb-2"],[1,"h-3","w-14","bg-slate-600/30","rounded"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","cursor-pointer","transition-all","duration-300","hover:scale-[1.02]","group",3,"click"],[1,"flex","items-center","gap-3"],[1,"avatar-wrapper","relative"],[1,"avatar-glow","absolute","inset-0","rounded-full","opacity-0","group-hover:opacity-100","transition-opacity","duration-300"],[1,"avatar-border","w-12","h-12","rounded-full","p-[2px]"],[1,"w-full","h-full","rounded-full","flex","items-center","justify-center","text-white","font-bold","text-lg","avatar-inner"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg",3,"badge-silver","badge-gold","badge-diamond","badge-star","badge-king"],[1,"text-sm","font-semibold","truncate",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-1.5","mt-0.5"],["size","sm",3,"level"],[1,"arrow-icon","transition-transform","duration-300","group-hover:translate-x-1"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4",2,"color","var(--text-muted)"],["points","9 18 15 12 9 6"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg"],[1,"animate-pulse"],[1,"animate-bounce"],["data-tour","accounts",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["d","M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"],["cx","9","cy","7","r","4"],["d","M23 21v-2a4 4 0 0 0-3-3.87"],["d","M16 3.13a4 4 0 0 1 0 7.75"],["data-tour","search-discovery",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","11","cy","11","r","8"],["d","M21 21l-4.35-4.35"],[1,"absolute","right-2","px-1.5","py-0.5","text-[10px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","12","cy","5","rx","9","ry","3"],["d","M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"],["d","M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"],["d","M22 2L11 13"],["d","M22 2L15 22L11 13L2 9L22 2Z"],["data-tour","monitoring-center",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1","relative","group",3,"click"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","transition-all"],[1,"text-lg"],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-[10px]","opacity-60"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],[1,"text-lg","ml-1"],[1,"ml-auto","text-xs","px-1.5","py-0.5","bg-violet-500/20","text-violet-400","rounded"],["data-tour","ai-assistant",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-orange-500","to-amber-500","text-white","rounded-full","font-bold","shadow-lg","shadow-orange-500/20"],[1,"absolute","right-2","text-xs"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-full","font-bold","shadow-lg","shadow-purple-500/20"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold","shadow-lg","shadow-cyan-500/20"],["d","M18 20V10"],["d","M12 20V4"],["d","M6 20v-6"],["d","M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"],["cx","12","cy","12","r","4"],[1,"ml-auto","px-1.5","py-0.5","text-xs","bg-pink-500/20","text-pink-400","rounded"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click","title"],[1,"ml-auto","text-xs","opacity-60"],["data-tour","ai-engine",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["d","M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"],[1,"flex-1"],[1,"text-xs","font-bold","rounded-full","px-1.5","py-0.5",2,"background-color","rgba(239, 68, 68, 0.2)","color","#f87171"],["cx","12","cy","12","r","3"],["d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"],[3,"close","generateMsg","sendMsg","loadHistory","loadMoreHistory","historyScroll","selectAttach","addMoreAttach","clearAttach","removeAttach","applyTmpl","updatePrompt","addDnc","editableMsgChange","msgModeChange","senderChange","viewChange","navigateTo","lead","generationState","leadDetailView","chatHistory","editableMessage","messageMode","senderAccounts","selectedSenderId","selectedChatUserId","chatHistoryHasMore","chatHistoryLoadingMore","isLoadingChatHistory","isAiConfigured","aiApiType","messageTemplates","canSendMessage","ragEnabled"],[3,"close","undo","history"],[3,"skip","complete","stepChange","detectOllamaClick","localModelChange","autoFallbackChange","backupProviderChange","step","ollamaDetected","isDetecting","ollamaModels","localModel","autoFallback","backupProvider"],[3,"dismiss","recover","sessions","isRecovering"],[3,"close","errorDetail"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600",3,"click"],[1,"text-sm","font-medium"],[3,"cancel","submit","nameChange","name"]],template:function(t,i){t&1&&(q(0,"app-network-status")(1,"app-auth-transition")(2,"app-toast")(3,"app-global-confirm-dialog")(4,"app-global-input-dialog")(5,"app-alert-notification")(6,"app-offline-indicator"),T(7,uS,5,1,"div",1),T(8,pS,17,3,"div",2),p(9,"app-command-palette",3),D("navigate",function(s){return i.handleCommandNavigation(s)}),g(),an(10,gS,1,2),ln(11,10,tS),an(13,hS,1,3),ln(14,13,nS),an(16,fS,1,2),ln(17,16,iS),q(19,"app-membership-dialog"),an(20,_S,2,0),ln(21,20,oS),Zr(),T(23,vS,4,0,"div",4),T(24,ix,127,93,"div",5)(25,ox,2,0,"div",6)),t&2&&(h(7),A(i.backendConnectionState()!=="connected"||!i.offlineCache.isOnline()?7:-1),h(),A(i.showSuccessOverlay()?8:-1),h(3),kn(i.dialogService.showBatchMessageDialog()),h(3),kn(i.dialogService.showBatchInviteDialog()),h(3),kn(i.dialogService.showMemberExtractionDialog()||i.showMemberExtractionDialog()),h(6),A(i.showQrLoginDialog()?23:-1),h(),A(i.isAuthenticated()?24:25))},dependencies:[de,Te,da,eo,to,oo,so,mo,ho,io,Lo,ro,Co,yo,So,Ao,Do,Mo,Io,ko,Po,No,Ro,Fo,Vo,Bo],styles:['[_nghost-%COMP%]     .highlight-pulse{animation:_ngcontent-%COMP%_highlight-pulse 1.5s ease-in-out 2}@keyframes _ngcontent-%COMP%_highlight-pulse{0%,to{box-shadow:0 0 #06b6d400;border-color:inherit}50%{box-shadow:0 0 20px 5px #06b6d480;border-color:#06b6d4}}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_success-pop{0%{transform:scale(.5);opacity:0}50%{transform:scale(1.1)}to{transform:scale(1);opacity:1}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .3s ease-out forwards}.animate-success-pop[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_success-pop .5s cubic-bezier(.68,-.55,.265,1.55) forwards}[_nghost-%COMP%]     .page-content{animation:_ngcontent-%COMP%_page-fade-in .3s ease-out}@keyframes _ngcontent-%COMP%_page-fade-in{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}[_nghost-%COMP%]     .card-hover{transition:all .2s ease}[_nghost-%COMP%]     .card-hover:hover{transform:translateY(-2px);box-shadow:0 8px 25px -5px #0000004d}[_nghost-%COMP%]     .sidebar-item{position:relative;overflow:hidden}[_nghost-%COMP%]     .sidebar-item:before{content:"";position:absolute;left:0;top:50%;width:3px;height:0;background:linear-gradient(to bottom,#06b6d4,#8b5cf6);transition:height .2s ease;transform:translateY(-50%);border-radius:0 2px 2px 0}[_nghost-%COMP%]     .sidebar-item:hover:before, [_nghost-%COMP%]     .sidebar-item.active:before{height:60%}[_nghost-%COMP%]     .btn-ripple{position:relative;overflow:hidden}[_nghost-%COMP%]     .btn-ripple:after{content:"";position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none;background-image:radial-gradient(circle,#fff 10%,transparent 10.01%);background-repeat:no-repeat;background-position:50%;transform:scale(10);opacity:0;transition:transform .5s,opacity .5s}[_nghost-%COMP%]     .btn-ripple:active:after{transform:scale(0);opacity:.3;transition:0s}[_nghost-%COMP%]     .animate-number{animation:_ngcontent-%COMP%_number-pop .3s ease-out}@keyframes _ngcontent-%COMP%_number-pop{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}[_nghost-%COMP%]     .gradient-border{position:relative;background:linear-gradient(var(--card-bg),var(--card-bg)) padding-box,linear-gradient(135deg,#06b6d4,#8b5cf6) border-box;border:1px solid transparent}[_nghost-%COMP%]     .mobile-sidebar-hidden{position:fixed!important;left:0;top:0;bottom:0;z-index:999;transform:translate(-100%);width:16rem!important;transition:transform .3s cubic-bezier(.4,0,.2,1)}[_nghost-%COMP%]     .mobile-sidebar-visible{position:fixed!important;left:0;top:0;bottom:0;z-index:999;transform:translate(0);width:16rem!important;transition:transform .3s cubic-bezier(.4,0,.2,1)}@media(max-width:768px){[_nghost-%COMP%]     main.flex-1{padding:52px 16px 16px!important}}'],changeDetection:0})}};pd(An);console.log("[Bootstrap] index.tsx loaded, starting Angular bootstrap...");console.log("[Bootstrap] Angular imports completed");console.log("[Bootstrap] AppComponent and routes imported, calling bootstrapApplication...");ra(An,{providers:[ia(),aa(),Rl(),ua(Ll)]}).then(()=>{console.log("[TG-AI\u667A\u63A7\u738B] Application started successfully"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[TG-AI\u667A\u63A7\u738B] angular-ready event dispatched")},50)}).catch(n=>{console.error("[TG-AI\u667A\u63A7\u738B] Application failed to start:",n);let e=document.getElementById("app-loading"),t=document.getElementById("error-container"),i=document.getElementById("error-message"),o=document.getElementById("loading-status"),s=document.getElementById("loading-progress");o&&(o.textContent="\u8F09\u5165\u5931\u6557"),s&&(s.style.background="#ef4444",s.style.width="100%"),t&&(t.style.display="block"),i&&(i.textContent="\u932F\u8AA4: "+(n?.message||n))});
