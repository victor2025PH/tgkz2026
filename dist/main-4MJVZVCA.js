import{$ as Pn,$a as T,A as wd,Aa as ys,Ab as sp,B as $m,Ba as Ii,Bb as di,C as Cn,Ca as Ue,Cb as ap,D as _s,Da as Ss,Db as bt,E as Ot,Ea as Zm,Eb as rt,F as me,Fa as ep,Fb as Ee,G as vs,Ga as ie,Gb as je,H as It,Ha as Yn,Hb as yt,I as j,Ia as Ye,Ib as Fi,J as Qn,Ja as ws,Jb as lp,K as Hm,Ka as ft,Kb as cp,L as He,La as Es,Lb as Pd,M as Ae,Ma as tp,Mb as R,N as F,Na as cr,Nb as ge,O as Ed,Oa as np,Ob as Le,P as qm,Pa as _t,Pb as dn,Q as ai,Qa as Fd,Qb as dp,R as Xt,Ra as y,Rb as Rd,S as _,Sa as S,Sb as J,T as v,Ta as ct,Tb as Ie,U as ne,Ua as be,Ub as ui,V as ce,Va as O,W as ar,Wa as U,X as lt,Xa as L,Y as lr,Ya as r,Z as Wm,Za as s,_ as qe,_a as B,a as E,aa as Dd,ab as k,b as P,ba as Ad,bb as Se,c as bd,ca as f,cb as I,d as Nm,da as zm,db as Ke,e as Vm,ea as gt,eb as Zt,f as gs,fa as Ft,fb as dt,g as an,ga as li,gb as x,h as ln,ha as Pt,hb as se,i as jn,ia as ki,ib as m,j as xn,ja as Km,jb as ci,k as Oe,ka as Md,kb as Rn,l as Bm,la as jm,lb as Nn,m as yd,ma as xs,mb as ee,n as Lm,na as Td,nb as N,o as tt,oa as kd,ob as de,p as Om,pa as Cs,pb as l,q as ri,qa as ot,qb as D,r as Um,ra as Jm,rb as M,s as hs,sa as lo,sb as X,t as Gm,ta as c,tb as cn,u as Jn,ua as co,ub as ip,v as Sd,va as Qm,vb as op,w as sr,wa as bs,wb as H,x as ao,xa as Ym,xb as q,y as fs,ya as Id,yb as W,z as si,za as Xm,zb as rp}from"./chunk-IPEV7SJL.js";var up=null;function un(){return up}function Nd(i){up??=i}var dr=class{},uo=(()=>{class i{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>F(mp),providedIn:"platform"})}return i})();var mp=(()=>{class i extends uo{_location;_history;_doc=F(lt);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return un().getBaseHref(this._doc)}onPopState(t){let n=un().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",t,!1),()=>n.removeEventListener("popstate",t)}onHashChange(t){let n=un().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",t,!1),()=>n.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,n,o){this._history.pushState(t,n,o)}replaceState(t,n,o){this._history.replaceState(t,n,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>new i,providedIn:"platform"})}return i})();function hp(i,e){return i?e?i.endsWith("/")?e.startsWith("/")?i+e.slice(1):i+e:e.startsWith("/")?i+e:`${i}/${e}`:i:e}function pp(i){let e=i.search(/#|\?|$/);return i[e-1]==="/"?i.slice(0,e-1)+i.slice(e):i}function mi(i){return i&&i[0]!=="?"?`?${i}`:i}var Ds=(()=>{class i{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>F(y1),providedIn:"root"})}return i})(),b1=new He(""),y1=(()=>{class i extends Ds{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,n){super(),this._platformLocation=t,this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??F(lt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return hp(this._baseHref,t)}path(t=!1){let n=this._platformLocation.pathname+mi(this._platformLocation.search),o=this._platformLocation.hash;return o&&t?`${n}${o}`:n}pushState(t,n,o,a){let d=this.prepareExternalUrl(o+mi(a));this._platformLocation.pushState(t,n,d)}replaceState(t,n,o,a){let d=this.prepareExternalUrl(o+mi(a));this._platformLocation.replaceState(t,n,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(n){return new(n||i)(Ae(uo),Ae(b1,8))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),mo=(()=>{class i{_subject=new an;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let n=this._locationStrategy.getBaseHref();this._basePath=E1(pp(gp(n))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,n=""){return this.path()==this.normalize(t+mi(n))}normalize(t){return i.stripTrailingSlash(w1(this._basePath,gp(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,n="",o=null){this._locationStrategy.pushState(o,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+mi(n)),o)}replaceState(t,n="",o=null){this._locationStrategy.replaceState(o,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+mi(n)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}),()=>{let n=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(n,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",n){this._urlChangeListeners.forEach(o=>o(t,n))}subscribe(t,n,o){return this._subject.subscribe({next:t,error:n??void 0,complete:o??void 0})}static normalizeQueryParams=mi;static joinWithSlash=hp;static stripTrailingSlash=pp;static \u0275fac=function(n){return new(n||i)(Ae(Ds))};static \u0275prov=j({token:i,factory:()=>S1(),providedIn:"root"})}return i})();function S1(){return new mo(Ae(Ds))}function w1(i,e){if(!i||!e.startsWith(i))return e;let t=e.substring(i.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function gp(i){return i.replace(/\/index.html$/,"")}function E1(i){if(new RegExp("^(https?:)?//").test(i)){let[,t]=i.split(/\/\/[^\/]+/);return t}return i}var Gd=(function(i){return i[i.Decimal=0]="Decimal",i[i.Percent=1]="Percent",i[i.Currency=2]="Currency",i[i.Scientific=3]="Scientific",i})(Gd||{});var Dt=(function(i){return i[i.Format=0]="Format",i[i.Standalone=1]="Standalone",i})(Dt||{}),Qe=(function(i){return i[i.Narrow=0]="Narrow",i[i.Abbreviated=1]="Abbreviated",i[i.Wide=2]="Wide",i[i.Short=3]="Short",i})(Qe||{}),Ut=(function(i){return i[i.Short=0]="Short",i[i.Medium=1]="Medium",i[i.Long=2]="Long",i[i.Full=3]="Full",i})(Ut||{}),Gt={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function xp(i){return Zt(i)[dt.LocaleId]}function Cp(i,e,t){let n=Zt(i),o=[n[dt.DayPeriodsFormat],n[dt.DayPeriodsStandalone]],a=mn(o,e);return mn(a,t)}function bp(i,e,t){let n=Zt(i),o=[n[dt.DaysFormat],n[dt.DaysStandalone]],a=mn(o,e);return mn(a,t)}function yp(i,e,t){let n=Zt(i),o=[n[dt.MonthsFormat],n[dt.MonthsStandalone]],a=mn(o,e);return mn(a,t)}function Sp(i,e){let n=Zt(i)[dt.Eras];return mn(n,e)}function ur(i,e){let t=Zt(i);return mn(t[dt.DateFormat],e)}function mr(i,e){let t=Zt(i);return mn(t[dt.TimeFormat],e)}function pr(i,e){let n=Zt(i)[dt.DateTimeFormat];return mn(n,e)}function Vn(i,e){let t=Zt(i),n=t[dt.NumberSymbols][e];if(typeof n>"u"){if(e===Gt.CurrencyDecimal)return t[dt.NumberSymbols][Gt.Decimal];if(e===Gt.CurrencyGroup)return t[dt.NumberSymbols][Gt.Group]}return n}function wp(i,e){return Zt(i)[dt.NumberFormats][e]}function Ep(i){if(!i[dt.ExtraData])throw new me(2303,!1)}function Dp(i){let e=Zt(i);return Ep(e),(e[dt.ExtraData][2]||[]).map(n=>typeof n=="string"?Vd(n):[Vd(n[0]),Vd(n[1])])}function Ap(i,e,t){let n=Zt(i);Ep(n);let o=[n[dt.ExtraData][0],n[dt.ExtraData][1]],a=mn(o,e)||[];return mn(a,t)||[]}function mn(i,e){for(let t=e;t>-1;t--)if(typeof i[t]<"u")return i[t];throw new me(2304,!1)}function Vd(i){let[e,t]=i.split(":");return{hours:+e,minutes:+t}}var D1=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,As={},A1=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function Mp(i,e,t,n){let o=V1(i);e=Xn(t,e)||e;let d=[],u;for(;e;)if(u=A1.exec(e),u){d=d.concat(u.slice(1));let C=d.pop();if(!C)break;e=C}else{d.push(e);break}let p=o.getTimezoneOffset();n&&(p=kp(n,p),o=N1(o,n));let g="";return d.forEach(C=>{let w=P1(C);g+=w?w(o,t,p):C==="''"?"'":C.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),g}function Fs(i,e,t){let n=new Date(0);return n.setFullYear(i,e,t),n.setHours(0,0,0),n}function Xn(i,e){let t=xp(i);if(As[t]??={},As[t][e])return As[t][e];let n="";switch(e){case"shortDate":n=ur(i,Ut.Short);break;case"mediumDate":n=ur(i,Ut.Medium);break;case"longDate":n=ur(i,Ut.Long);break;case"fullDate":n=ur(i,Ut.Full);break;case"shortTime":n=mr(i,Ut.Short);break;case"mediumTime":n=mr(i,Ut.Medium);break;case"longTime":n=mr(i,Ut.Long);break;case"fullTime":n=mr(i,Ut.Full);break;case"short":let o=Xn(i,"shortTime"),a=Xn(i,"shortDate");n=Ms(pr(i,Ut.Short),[o,a]);break;case"medium":let d=Xn(i,"mediumTime"),u=Xn(i,"mediumDate");n=Ms(pr(i,Ut.Medium),[d,u]);break;case"long":let p=Xn(i,"longTime"),g=Xn(i,"longDate");n=Ms(pr(i,Ut.Long),[p,g]);break;case"full":let C=Xn(i,"fullTime"),w=Xn(i,"fullDate");n=Ms(pr(i,Ut.Full),[C,w]);break}return n&&(As[t][e]=n),n}function Ms(i,e){return e&&(i=i.replace(/\{([^}]+)}/g,function(t,n){return e!=null&&n in e?e[n]:t})),i}function bn(i,e,t="-",n,o){let a="";(i<0||o&&i<=0)&&(o?i=-i+1:(i=-i,a=t));let d=String(i);for(;d.length<e;)d="0"+d;return n&&(d=d.slice(d.length-e)),a+d}function M1(i,e){return bn(i,3).substring(0,e)}function ut(i,e,t=0,n=!1,o=!1){return function(a,d){let u=T1(i,a);if((t>0||u>-t)&&(u+=t),i===3)u===0&&t===-12&&(u=12);else if(i===6)return M1(u,e);let p=Vn(d,Gt.MinusSign);return bn(u,e,p,n,o)}}function T1(i,e){switch(i){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();case 3:return e.getHours();case 4:return e.getMinutes();case 5:return e.getSeconds();case 6:return e.getMilliseconds();case 7:return e.getDay();default:throw new me(2301,!1)}}function Ze(i,e,t=Dt.Format,n=!1){return function(o,a){return k1(o,a,i,e,t,n)}}function k1(i,e,t,n,o,a){switch(t){case 2:return yp(e,o,n)[i.getMonth()];case 1:return bp(e,o,n)[i.getDay()];case 0:let d=i.getHours(),u=i.getMinutes();if(a){let g=Dp(e),C=Ap(e,o,n),w=g.findIndex(A=>{if(Array.isArray(A)){let[V,G]=A,z=d>=V.hours&&u>=V.minutes,$=d<G.hours||d===G.hours&&u<G.minutes;if(V.hours<G.hours){if(z&&$)return!0}else if(z||$)return!0}else if(A.hours===d&&A.minutes===u)return!0;return!1});if(w!==-1)return C[w]}return Cp(e,o,n)[d<12?0:1];case 3:return Sp(e,n)[i.getFullYear()<=0?0:1];default:let p=t;throw new me(2302,!1)}}function Ts(i){return function(e,t,n){let o=-1*n,a=Vn(t,Gt.MinusSign),d=o>0?Math.floor(o/60):Math.ceil(o/60);switch(i){case 0:return(o>=0?"+":"")+bn(d,2,a)+bn(Math.abs(o%60),2,a);case 1:return"GMT"+(o>=0?"+":"")+bn(d,1,a);case 2:return"GMT"+(o>=0?"+":"")+bn(d,2,a)+":"+bn(Math.abs(o%60),2,a);case 3:return n===0?"Z":(o>=0?"+":"")+bn(d,2,a)+":"+bn(Math.abs(o%60),2,a);default:throw new me(2310,!1)}}}var I1=0,Is=4;function F1(i){let e=Fs(i,I1,1).getDay();return Fs(i,0,1+(e<=Is?Is:Is+7)-e)}function Tp(i){let e=i.getDay(),t=e===0?-3:Is-e;return Fs(i.getFullYear(),i.getMonth(),i.getDate()+t)}function Bd(i,e=!1){return function(t,n){let o;if(e){let a=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,d=t.getDate();o=1+Math.floor((d+a)/7)}else{let a=Tp(t),d=F1(a.getFullYear()),u=a.getTime()-d.getTime();o=1+Math.round(u/6048e5)}return bn(o,i,Vn(n,Gt.MinusSign))}}function ks(i,e=!1){return function(t,n){let a=Tp(t).getFullYear();return bn(a,i,Vn(n,Gt.MinusSign),e)}}var Ld={};function P1(i){if(Ld[i])return Ld[i];let e;switch(i){case"G":case"GG":case"GGG":e=Ze(3,Qe.Abbreviated);break;case"GGGG":e=Ze(3,Qe.Wide);break;case"GGGGG":e=Ze(3,Qe.Narrow);break;case"y":e=ut(0,1,0,!1,!0);break;case"yy":e=ut(0,2,0,!0,!0);break;case"yyy":e=ut(0,3,0,!1,!0);break;case"yyyy":e=ut(0,4,0,!1,!0);break;case"Y":e=ks(1);break;case"YY":e=ks(2,!0);break;case"YYY":e=ks(3);break;case"YYYY":e=ks(4);break;case"M":case"L":e=ut(1,1,1);break;case"MM":case"LL":e=ut(1,2,1);break;case"MMM":e=Ze(2,Qe.Abbreviated);break;case"MMMM":e=Ze(2,Qe.Wide);break;case"MMMMM":e=Ze(2,Qe.Narrow);break;case"LLL":e=Ze(2,Qe.Abbreviated,Dt.Standalone);break;case"LLLL":e=Ze(2,Qe.Wide,Dt.Standalone);break;case"LLLLL":e=Ze(2,Qe.Narrow,Dt.Standalone);break;case"w":e=Bd(1);break;case"ww":e=Bd(2);break;case"W":e=Bd(1,!0);break;case"d":e=ut(2,1);break;case"dd":e=ut(2,2);break;case"c":case"cc":e=ut(7,1);break;case"ccc":e=Ze(1,Qe.Abbreviated,Dt.Standalone);break;case"cccc":e=Ze(1,Qe.Wide,Dt.Standalone);break;case"ccccc":e=Ze(1,Qe.Narrow,Dt.Standalone);break;case"cccccc":e=Ze(1,Qe.Short,Dt.Standalone);break;case"E":case"EE":case"EEE":e=Ze(1,Qe.Abbreviated);break;case"EEEE":e=Ze(1,Qe.Wide);break;case"EEEEE":e=Ze(1,Qe.Narrow);break;case"EEEEEE":e=Ze(1,Qe.Short);break;case"a":case"aa":case"aaa":e=Ze(0,Qe.Abbreviated);break;case"aaaa":e=Ze(0,Qe.Wide);break;case"aaaaa":e=Ze(0,Qe.Narrow);break;case"b":case"bb":case"bbb":e=Ze(0,Qe.Abbreviated,Dt.Standalone,!0);break;case"bbbb":e=Ze(0,Qe.Wide,Dt.Standalone,!0);break;case"bbbbb":e=Ze(0,Qe.Narrow,Dt.Standalone,!0);break;case"B":case"BB":case"BBB":e=Ze(0,Qe.Abbreviated,Dt.Format,!0);break;case"BBBB":e=Ze(0,Qe.Wide,Dt.Format,!0);break;case"BBBBB":e=Ze(0,Qe.Narrow,Dt.Format,!0);break;case"h":e=ut(3,1,-12);break;case"hh":e=ut(3,2,-12);break;case"H":e=ut(3,1);break;case"HH":e=ut(3,2);break;case"m":e=ut(4,1);break;case"mm":e=ut(4,2);break;case"s":e=ut(5,1);break;case"ss":e=ut(5,2);break;case"S":e=ut(6,1);break;case"SS":e=ut(6,2);break;case"SSS":e=ut(6,3);break;case"Z":case"ZZ":case"ZZZ":e=Ts(0);break;case"ZZZZZ":e=Ts(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=Ts(1);break;case"OOOO":case"ZZZZ":case"zzzz":e=Ts(2);break;default:return null}return Ld[i]=e,e}function kp(i,e){i=i.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+i)/6e4;return isNaN(t)?e:t}function R1(i,e){return i=new Date(i.getTime()),i.setMinutes(i.getMinutes()+e),i}function N1(i,e,t){let o=i.getTimezoneOffset(),a=kp(e,o);return R1(i,-1*(a-o))}function V1(i){if(fp(i))return i;if(typeof i=="number"&&!isNaN(i))return new Date(i);if(typeof i=="string"){if(i=i.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(i)){let[o,a=1,d=1]=i.split("-").map(u=>+u);return Fs(o,a-1,d)}let t=parseFloat(i);if(!isNaN(i-t))return new Date(t);let n;if(n=i.match(D1))return B1(n)}let e=new Date(i);if(!fp(e))throw new me(2311,!1);return e}function B1(i){let e=new Date(0),t=0,n=0,o=i[8]?e.setUTCFullYear:e.setFullYear,a=i[8]?e.setUTCHours:e.setHours;i[9]&&(t=Number(i[9]+i[10]),n=Number(i[9]+i[11])),o.call(e,Number(i[1]),Number(i[2])-1,Number(i[3]));let d=Number(i[4]||0)-t,u=Number(i[5]||0)-n,p=Number(i[6]||0),g=Math.floor(parseFloat("0."+(i[7]||0))*1e3);return a.call(e,d,u,p,g),e}function fp(i){return i instanceof Date&&!isNaN(i.valueOf())}var L1=/^(\d+)?\.((\d+)(-(\d+))?)?$/,_p=22,Ps=".",gr="0",O1=";",U1=",",Od="#";function G1(i,e,t,n,o,a,d=!1){let u="",p=!1;if(!isFinite(i))u=Vn(t,Gt.Infinity);else{let g=q1(i);d&&(g=H1(g));let C=e.minInt,w=e.minFrac,A=e.maxFrac;if(a){let Z=a.match(L1);if(Z===null)throw new me(2306,!1);let Y=Z[1],re=Z[3],le=Z[5];Y!=null&&(C=Ud(Y)),re!=null&&(w=Ud(re)),le!=null?A=Ud(le):re!=null&&w>A&&(A=w)}W1(g,w,A);let V=g.digits,G=g.integerLen,z=g.exponent,$=[];for(p=V.every(Z=>!Z);G<C;G++)V.unshift(0);for(;G<0;G++)V.unshift(0);G>0?$=V.splice(G,V.length):($=V,V=[0]);let K=[];for(V.length>=e.lgSize&&K.unshift(V.splice(-e.lgSize,V.length).join(""));V.length>e.gSize;)K.unshift(V.splice(-e.gSize,V.length).join(""));V.length&&K.unshift(V.join("")),u=K.join(Vn(t,n)),$.length&&(u+=Vn(t,o)+$.join("")),z&&(u+=Vn(t,Gt.Exponential)+"+"+z)}return i<0&&!p?u=e.negPre+u+e.negSuf:u=e.posPre+u+e.posSuf,u}function Ip(i,e,t){let n=wp(e,Gd.Decimal),o=$1(n,Vn(e,Gt.MinusSign));return G1(i,o,e,Gt.Group,Gt.Decimal,t)}function $1(i,e="-"){let t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},n=i.split(O1),o=n[0],a=n[1],d=o.indexOf(Ps)!==-1?o.split(Ps):[o.substring(0,o.lastIndexOf(gr)+1),o.substring(o.lastIndexOf(gr)+1)],u=d[0],p=d[1]||"";t.posPre=u.substring(0,u.indexOf(Od));for(let C=0;C<p.length;C++){let w=p.charAt(C);w===gr?t.minFrac=t.maxFrac=C+1:w===Od?t.maxFrac=C+1:t.posSuf+=w}let g=u.split(U1);if(t.gSize=g[1]?g[1].length:0,t.lgSize=g[2]||g[1]?(g[2]||g[1]).length:0,a){let C=o.length-t.posPre.length-t.posSuf.length,w=a.indexOf(Od);t.negPre=a.substring(0,w).replace(/'/g,""),t.negSuf=a.slice(w+C).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}function H1(i){if(i.digits[0]===0)return i;let e=i.digits.length-i.integerLen;return i.exponent?i.exponent+=2:(e===0?i.digits.push(0,0):e===1&&i.digits.push(0),i.integerLen+=2),i}function q1(i){let e=Math.abs(i)+"",t=0,n,o,a,d,u;for((o=e.indexOf(Ps))>-1&&(e=e.replace(Ps,"")),(a=e.search(/e/i))>0?(o<0&&(o=a),o+=+e.slice(a+1),e=e.substring(0,a)):o<0&&(o=e.length),a=0;e.charAt(a)===gr;a++);if(a===(u=e.length))n=[0],o=1;else{for(u--;e.charAt(u)===gr;)u--;for(o-=a,n=[],d=0;a<=u;a++,d++)n[d]=Number(e.charAt(a))}return o>_p&&(n=n.splice(0,_p-1),t=o-1,o=1),{digits:n,exponent:t,integerLen:o}}function W1(i,e,t){if(e>t)throw new me(2307,!1);let n=i.digits,o=n.length-i.integerLen,a=Math.min(Math.max(e,o),t),d=a+i.integerLen,u=n[d];if(d>0){n.splice(Math.max(i.integerLen,d));for(let w=d;w<n.length;w++)n[w]=0}else{o=Math.max(0,o),i.integerLen=1,n.length=Math.max(1,d=a+1),n[0]=0;for(let w=1;w<d;w++)n[w]=0}if(u>=5)if(d-1<0){for(let w=0;w>d;w--)n.unshift(0),i.integerLen++;n.unshift(1),i.integerLen++}else n[d-1]++;for(;o<Math.max(0,a);o++)n.push(0);let p=a!==0,g=e+i.integerLen,C=n.reduceRight(function(w,A,V,G){return A=A+w,G[V]=A<10?A:A-10,p&&(G[V]===0&&V>=g?G.pop():p=!1),A>=10?1:0},0);C&&(n.unshift(C),i.integerLen++)}function Ud(i){let e=parseInt(i);if(isNaN(e))throw new me(2305,!1);return e}var hr=(()=>{class i{_viewContainer;_context=new Rs;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,n){this._viewContainer=t,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){vp(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){vp(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||i)(Ue(Ss),Ue(Xm))};static \u0275dir=Ye({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return i})(),Rs=class{$implicit=null;ngIf=null};function vp(i,e){if(i&&!i.createEmbeddedView)throw new me(2020,!1)}function $d(i,e){return new me(2100,!1)}var z1="mediumDate",Fp=new He(""),Pp=new He(""),yn=(()=>{class i{locale;defaultTimezone;defaultOptions;constructor(t,n,o){this.locale=t,this.defaultTimezone=n,this.defaultOptions=o}transform(t,n,o,a){if(t==null||t===""||t!==t)return null;try{let d=n??this.defaultOptions?.dateFormat??z1,u=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return Mp(t,d,a||this.locale,u)}catch(d){throw $d(i,d.message)}}static \u0275fac=function(n){return new(n||i)(Ue(Pd,16),Ue(Fp,24),Ue(Pp,24))};static \u0275pipe=ws({name:"date",type:i,pure:!0})}return i})();var St=(()=>{class i{_locale;constructor(t){this._locale=t}transform(t,n,o){if(!K1(t))return null;o||=this._locale;try{let a=j1(t);return Ip(a,o,n)}catch(a){throw $d(i,a.message)}}static \u0275fac=function(n){return new(n||i)(Ue(Pd,16))};static \u0275pipe=ws({name:"number",type:i,pure:!0})}return i})();function K1(i){return!(i==null||i===""||i!==i)}function j1(i){if(typeof i=="string"&&!isNaN(Number(i)-parseFloat(i)))return Number(i);if(typeof i!="number")throw new me(2309,!1);return i}var fr=(()=>{class i{transform(t,n,o){if(t==null)return null;if(!(typeof t=="string"||Array.isArray(t)))throw $d(i,t);return t.slice(n,o)}static \u0275fac=function(n){return new(n||i)};static \u0275pipe=ws({name:"slice",type:i,pure:!1})}return i})();var oe=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Yn({type:i});static \u0275inj=Qn({})}return i})();function _r(i,e){e=encodeURIComponent(e);for(let t of i.split(";")){let n=t.indexOf("="),[o,a]=n==-1?[t,""]:[t.slice(0,n),t.slice(n+1)];if(o.trim()===e)return decodeURIComponent(a)}return null}var Pi=class{};var Rp="browser";var vr=class{_doc;constructor(e){this._doc=e}manager},Ns=(()=>{class i extends vr{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,o,a){return t.addEventListener(n,o,a),()=>this.removeEventListener(t,n,o,a)}removeEventListener(t,n,o,a){return t.removeEventListener(n,o,a)}static \u0275fac=function(n){return new(n||i)(Ae(lt))};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})(),Ls=new He(""),zd=(()=>{class i{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,n){this._zone=n,t.forEach(d=>{d.manager=this});let o=t.filter(d=>!(d instanceof Ns));this._plugins=o.slice().reverse();let a=t.find(d=>d instanceof Ns);a&&this._plugins.push(a)}addEventListener(t,n,o,a){return this._findPluginFor(n).addEventListener(t,n,o,a)}getZone(){return this._zone}_findPluginFor(t){let n=this._eventNameToPlugin.get(t);if(n)return n;if(n=this._plugins.find(a=>a.supports(t)),!n)throw new me(5101,!1);return this._eventNameToPlugin.set(t,n),n}static \u0275fac=function(n){return new(n||i)(Ae(Ls),Ae(Pn))};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})(),Hd="ng-app-id";function Np(i){for(let e of i)e.remove()}function Vp(i,e){let t=e.createElement("style");return t.textContent=i,t}function Q1(i,e,t,n){let o=i.head?.querySelectorAll(`style[${Hd}="${e}"],link[${Hd}="${e}"]`);if(o)for(let a of o)a.removeAttribute(Hd),a instanceof HTMLLinkElement?n.set(a.href.slice(a.href.lastIndexOf("/")+1),{usage:0,elements:[a]}):a.textContent&&t.set(a.textContent,{usage:0,elements:[a]})}function Wd(i,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",i),t}var Kd=(()=>{class i{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,n,o,a={}){this.doc=t,this.appId=n,this.nonce=o,Q1(t,n,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,n){for(let o of t)this.addUsage(o,this.inline,Vp);n?.forEach(o=>this.addUsage(o,this.external,Wd))}removeStyles(t,n){for(let o of t)this.removeUsage(o,this.inline);n?.forEach(o=>this.removeUsage(o,this.external))}addUsage(t,n,o){let a=n.get(t);a?a.usage++:n.set(t,{usage:1,elements:[...this.hosts].map(d=>this.addElement(d,o(t,this.doc)))})}removeUsage(t,n){let o=n.get(t);o&&(o.usage--,o.usage<=0&&(Np(o.elements),n.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])Np(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[n,{elements:o}]of this.inline)o.push(this.addElement(t,Vp(n,this.doc)));for(let[n,{elements:o}]of this.external)o.push(this.addElement(t,Wd(n,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,n){return this.nonce&&n.setAttribute("nonce",this.nonce),t.appendChild(n)}static \u0275fac=function(n){return new(n||i)(Ae(lt),Ae(Md),Ae(kd,8),Ae(xs))};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})(),qd={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},jd=/%COMP%/g;var Lp="%COMP%",Y1=`_nghost-${Lp}`,X1=`_ngcontent-${Lp}`,Z1=!0,ev=new He("",{factory:()=>Z1});function tv(i){return X1.replace(jd,i)}function nv(i){return Y1.replace(jd,i)}function Op(i,e){return e.map(t=>t.replace(jd,i))}var br=(()=>{class i{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;constructor(t,n,o,a,d,u,p=null,g=null){this.eventManager=t,this.sharedStylesHost=n,this.appId=o,this.removeStylesOnCompDestroy=a,this.doc=d,this.ngZone=u,this.nonce=p,this.tracingService=g,this.defaultRenderer=new xr(t,d,u,this.tracingService)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;let o=this.getOrCreateRenderer(t,n);return o instanceof Bs?o.applyToHost(t):o instanceof Cr&&o.applyStyles(),o}getOrCreateRenderer(t,n){let o=this.rendererByCompId,a=o.get(n.id);if(!a){let d=this.doc,u=this.ngZone,p=this.eventManager,g=this.sharedStylesHost,C=this.removeStylesOnCompDestroy,w=this.tracingService;switch(n.encapsulation){case Cs.Emulated:a=new Bs(p,g,n,this.appId,C,d,u,w);break;case Cs.ShadowDom:return new Vs(p,t,n,d,u,this.nonce,w,g);case Cs.ExperimentalIsolatedShadowDom:return new Vs(p,t,n,d,u,this.nonce,w);default:a=new Cr(p,g,n,C,d,u,w);break}o.set(n.id,a)}return a}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(n){return new(n||i)(Ae(zd),Ae(Kd),Ae(Md),Ae(ev),Ae(lt),Ae(Pn),Ae(kd),Ae(bs,8))};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})(),xr=class{eventManager;doc;ngZone;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,n,o){this.eventManager=e,this.doc=t,this.ngZone=n,this.tracingService=o}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(qd[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(Bp(e)?e.content:e).appendChild(t)}insertBefore(e,t,n){e&&(Bp(e)?e.content:e).insertBefore(t,n)}removeChild(e,t){t.remove()}selectRootElement(e,t){let n=typeof e=="string"?this.doc.querySelector(e):e;if(!n)throw new me(-5104,!1);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,o){if(o){t=o+":"+t;let a=qd[o];a?e.setAttributeNS(a,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){let o=qd[n];o?e.removeAttributeNS(o,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,o){o&(co.DashCase|co.Important)?e.style.setProperty(t,n,o&co.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&co.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e!=null&&(e[t]=n)}setValue(e,t){e.nodeValue=t}listen(e,t,n,o){if(typeof e=="string"&&(e=un().getGlobalEventTarget(this.doc,e),!e))throw new me(5102,!1);let a=this.decoratePreventDefault(n);return this.tracingService?.wrapEventListener&&(a=this.tracingService.wrapEventListener(e,t,a)),this.eventManager.addEventListener(e,t,a,o)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;e(t)===!1&&t.preventDefault()}}};function Bp(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var Vs=class extends xr{hostEl;sharedStylesHost;shadowRoot;constructor(e,t,n,o,a,d,u,p){super(e,o,a,u),this.hostEl=t,this.sharedStylesHost=p,this.shadowRoot=t.attachShadow({mode:"open"}),this.sharedStylesHost&&this.sharedStylesHost.addHost(this.shadowRoot);let g=n.styles;g=Op(n.id,g);for(let w of g){let A=document.createElement("style");d&&A.setAttribute("nonce",d),A.textContent=w,this.shadowRoot.appendChild(A)}let C=n.getExternalStyles?.();if(C)for(let w of C){let A=Wd(w,o);d&&A.setAttribute("nonce",d),this.shadowRoot.appendChild(A)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost&&this.sharedStylesHost.removeHost(this.shadowRoot)}},Cr=class extends xr{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,n,o,a,d,u,p){super(e,a,d,u),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=o;let g=n.styles;this.styles=p?Op(p,g):g,this.styleUrls=n.getExternalStyles?.(p)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Qm.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Bs=class extends Cr{contentAttr;hostAttr;constructor(e,t,n,o,a,d,u,p){let g=o+"-"+n.id;super(e,t,n,a,d,u,p,g),this.contentAttr=tv(g),this.hostAttr=nv(g)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}};var Os=class i extends dr{supportsDOMEvents=!0;static makeCurrent(){Nd(new i)}onAndCancel(e,t,n,o){return e.addEventListener(t,n,o),()=>{e.removeEventListener(t,n,o)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=iv();return t==null?null:ov(t)}resetBaseElement(){yr=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return _r(document.cookie,e)}},yr=null;function iv(){return yr=yr||document.head.querySelector("base"),yr?yr.getAttribute("href"):null}function ov(i){return new URL(i,document.baseURI).pathname}var rv=(()=>{class i{build(){return new XMLHttpRequest}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})(),Up=["alt","control","meta","shift"],sv={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},av={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},Gp=(()=>{class i extends vr{constructor(t){super(t)}supports(t){return i.parseEventName(t)!=null}addEventListener(t,n,o,a){let d=i.parseEventName(n),u=i.eventCallback(d.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>un().onAndCancel(t,d.domEventName,u,a))}static parseEventName(t){let n=t.toLowerCase().split("."),o=n.shift();if(n.length===0||!(o==="keydown"||o==="keyup"))return null;let a=i._normalizeKey(n.pop()),d="",u=n.indexOf("code");if(u>-1&&(n.splice(u,1),d="code."),Up.forEach(g=>{let C=n.indexOf(g);C>-1&&(n.splice(C,1),d+=g+".")}),d+=a,n.length!=0||a.length===0)return null;let p={};return p.domEventName=o,p.fullKey=d,p}static matchEventFullKeyCode(t,n){let o=sv[t.key]||t.key,a="";return n.indexOf("code.")>-1&&(o=t.code,a="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),Up.forEach(d=>{if(d!==o){let u=av[d];u(t)&&(a+=d+".")}}),a+=o,a===n)}static eventCallback(t,n,o){return a=>{i.matchEventFullKeyCode(a,t)&&o.runGuarded(()=>n(a))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(n){return new(n||i)(Ae(lt))};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})();function Jd(i,e,t){let n=E({rootComponent:i,platformRef:t?.platformRef},lv(e));return dp(n)}function lv(i){return{appProviders:[...pv,...i?.providers??[]],platformProviders:mv}}function cv(){Os.makeCurrent()}function dv(){return new Dd}function uv(){return Km(document),document}var mv=[{provide:xs,useValue:Rp},{provide:jm,useValue:cv,multi:!0},{provide:lt,useFactory:uv}];var pv=[{provide:qm,useValue:"root"},{provide:Dd,useFactory:dv},{provide:Ls,useClass:Ns,multi:!0},{provide:Ls,useClass:Gp,multi:!0},br,Kd,zd,{provide:ys,useExisting:br},{provide:Pi,useClass:rv},[]];var Ri=class i{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let n=t.indexOf(":");if(n>0){let o=t.slice(0,n),a=t.slice(n+1).trim();this.addHeaderEntry(o,a)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,n)=>{this.addHeaderEntry(n,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,n])=>{this.setHeaderEntries(t,n)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new i;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(e.name,t);let o=(e.op==="a"?this.headers.get(t):void 0)||[];o.push(...n),this.headers.set(t,o);break;case"d":let a=e.value;if(!a)this.headers.delete(t),this.normalizedNames.delete(t);else{let d=this.headers.get(t);if(!d)return;d=d.filter(u=>a.indexOf(u)===-1),d.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,d)}break}}addHeaderEntry(e,t){let n=e.toLowerCase();this.maybeSetNormalizedName(e,n),this.headers.has(n)?this.headers.get(n).push(t):this.headers.set(n,[t])}setHeaderEntries(e,t){let n=(Array.isArray(t)?t:[t]).map(a=>a.toString()),o=e.toLowerCase();this.headers.set(o,n),this.maybeSetNormalizedName(e,o)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var Gs=class{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}},$s=class{encodeKey(e){return $p(e)}encodeValue(e){return $p(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function gv(i,e){let t=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(o=>{let a=o.indexOf("="),[d,u]=a==-1?[e.decodeKey(o),""]:[e.decodeKey(o.slice(0,a)),e.decodeValue(o.slice(a+1))],p=t.get(d)||[];p.push(u),t.set(d,p)}),t}var hv=/%(\d[a-f0-9])/gi,fv={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function $p(i){return encodeURIComponent(i).replace(hv,(e,t)=>fv[t]??e)}function Us(i){return`${i}`}var pi=class i{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new $s,e.fromString){if(e.fromObject)throw new me(2805,!1);this.map=gv(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let n=e.fromObject[t],o=Array.isArray(n)?n.map(Us):[Us(n)];this.map.set(t,o)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(n=>{let o=e[n];Array.isArray(o)?o.forEach(a=>{t.push({param:n,value:a,op:"a"})}):t.push({param:n,value:o,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(n=>t+"="+this.encoder.encodeValue(n)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new i({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(Us(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let n=this.map.get(e.param)||[],o=n.indexOf(Us(e.value));o!==-1&&n.splice(o,1),n.length>0?this.map.set(e.param,n):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};function _v(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Hp(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function qp(i){return typeof Blob<"u"&&i instanceof Blob}function Wp(i){return typeof FormData<"u"&&i instanceof FormData}function vv(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}var zp="Content-Type",Kp="Accept",jp="text/plain",Jp="application/json",xv=`${Jp}, ${jp}, */*`,Sr=class i{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;referrerPolicy;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(e,t,n,o){this.url=t,this.method=e.toUpperCase();let a;if(_v(this.method)||o?(this.body=n!==void 0?n:null,a=o):a=n,a){if(this.reportProgress=!!a.reportProgress,this.withCredentials=!!a.withCredentials,this.keepalive=!!a.keepalive,a.responseType&&(this.responseType=a.responseType),a.headers&&(this.headers=a.headers),a.context&&(this.context=a.context),a.params&&(this.params=a.params),a.priority&&(this.priority=a.priority),a.cache&&(this.cache=a.cache),a.credentials&&(this.credentials=a.credentials),typeof a.timeout=="number"){if(a.timeout<1||!Number.isInteger(a.timeout))throw new me(2822,"");this.timeout=a.timeout}a.mode&&(this.mode=a.mode),a.redirect&&(this.redirect=a.redirect),a.integrity&&(this.integrity=a.integrity),a.referrer&&(this.referrer=a.referrer),a.referrerPolicy&&(this.referrerPolicy=a.referrerPolicy),this.transferCache=a.transferCache}if(this.headers??=new Ri,this.context??=new Gs,!this.params)this.params=new pi,this.urlWithParams=t;else{let d=this.params.toString();if(d.length===0)this.urlWithParams=t;else{let u=t.indexOf("?"),p=u===-1?"?":u<t.length-1?"&":"";this.urlWithParams=t+p+d}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||Hp(this.body)||qp(this.body)||Wp(this.body)||vv(this.body)?this.body:this.body instanceof pi?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||Wp(this.body)?null:qp(this.body)?this.body.type||null:Hp(this.body)?null:typeof this.body=="string"?jp:this.body instanceof pi?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?Jp:null}clone(e={}){let t=e.method||this.method,n=e.url||this.url,o=e.responseType||this.responseType,a=e.keepalive??this.keepalive,d=e.priority||this.priority,u=e.cache||this.cache,p=e.mode||this.mode,g=e.redirect||this.redirect,C=e.credentials||this.credentials,w=e.referrer||this.referrer,A=e.integrity||this.integrity,V=e.referrerPolicy||this.referrerPolicy,G=e.transferCache??this.transferCache,z=e.timeout??this.timeout,$=e.body!==void 0?e.body:this.body,K=e.withCredentials??this.withCredentials,Z=e.reportProgress??this.reportProgress,Y=e.headers||this.headers,re=e.params||this.params,le=e.context??this.context;return e.setHeaders!==void 0&&(Y=Object.keys(e.setHeaders).reduce((ue,pe)=>ue.set(pe,e.setHeaders[pe]),Y)),e.setParams&&(re=Object.keys(e.setParams).reduce((ue,pe)=>ue.set(pe,e.setParams[pe]),re)),new i(t,n,$,{params:re,headers:Y,context:le,reportProgress:Z,responseType:o,withCredentials:K,transferCache:G,keepalive:a,cache:u,priority:d,timeout:z,mode:p,redirect:g,credentials:C,referrer:w,integrity:A,referrerPolicy:V})}},po=(function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i})(po||{}),go=class{headers;status;statusText;url;ok;type;redirected;responseType;constructor(e,t=200,n="OK"){this.headers=e.headers||new Ri,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.redirected=e.redirected,this.responseType=e.responseType,this.ok=this.status>=200&&this.status<300}},Hs=class i extends go{constructor(e={}){super(e)}type=po.ResponseHeader;clone(e={}){return new i({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},qs=class i extends go{body;constructor(e={}){super(e),this.body=e.body!==void 0?e.body:null}type=po.Response;clone(e={}){return new i({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0,redirected:e.redirected??this.redirected,responseType:e.responseType??this.responseType})}},wr=class extends go{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},Cv=200,bv=204;var yv=new He("");var Sv=/^\)\]\}',?\n/;var Yd=(()=>{class i{xhrFactory;tracingService=F(bs,{optional:!0});constructor(t){this.xhrFactory=t}maybePropagateTrace(t){return this.tracingService?.propagate?this.tracingService.propagate(t):t}handle(t){if(t.method==="JSONP")throw new me(-2800,!1);let n=this.xhrFactory;return Oe(null).pipe(Cn(()=>new gs(a=>{let d=n.build();if(d.open(t.method,t.urlWithParams),t.withCredentials&&(d.withCredentials=!0),t.headers.forEach(($,K)=>d.setRequestHeader($,K.join(","))),t.headers.has(Kp)||d.setRequestHeader(Kp,xv),!t.headers.has(zp)){let $=t.detectContentTypeHeader();$!==null&&d.setRequestHeader(zp,$)}if(t.timeout&&(d.timeout=t.timeout),t.responseType){let $=t.responseType.toLowerCase();d.responseType=$!=="json"?$:"text"}let u=t.serializeBody(),p=null,g=()=>{if(p!==null)return p;let $=d.statusText||"OK",K=new Ri(d.getAllResponseHeaders()),Z=d.responseURL||t.url;return p=new Hs({headers:K,status:d.status,statusText:$,url:Z}),p},C=this.maybePropagateTrace(()=>{let{headers:$,status:K,statusText:Z,url:Y}=g(),re=null;K!==bv&&(re=typeof d.response>"u"?d.responseText:d.response),K===0&&(K=re?Cv:0);let le=K>=200&&K<300;if(t.responseType==="json"&&typeof re=="string"){let ue=re;re=re.replace(Sv,"");try{re=re!==""?JSON.parse(re):null}catch(pe){re=ue,le&&(le=!1,re={error:pe,text:re})}}le?(a.next(new qs({body:re,headers:$,status:K,statusText:Z,url:Y||void 0})),a.complete()):a.error(new wr({error:re,headers:$,status:K,statusText:Z,url:Y||void 0}))}),w=this.maybePropagateTrace($=>{let{url:K}=g(),Z=new wr({error:$,status:d.status||0,statusText:d.statusText||"Unknown Error",url:K||void 0});a.error(Z)}),A=w;t.timeout&&(A=this.maybePropagateTrace($=>{let{url:K}=g(),Z=new wr({error:new DOMException("Request timed out","TimeoutError"),status:d.status||0,statusText:d.statusText||"Request timeout",url:K||void 0});a.error(Z)}));let V=!1,G=this.maybePropagateTrace($=>{V||(a.next(g()),V=!0);let K={type:po.DownloadProgress,loaded:$.loaded};$.lengthComputable&&(K.total=$.total),t.responseType==="text"&&d.responseText&&(K.partialText=d.responseText),a.next(K)}),z=this.maybePropagateTrace($=>{let K={type:po.UploadProgress,loaded:$.loaded};$.lengthComputable&&(K.total=$.total),a.next(K)});return d.addEventListener("load",C),d.addEventListener("error",w),d.addEventListener("timeout",A),d.addEventListener("abort",w),t.reportProgress&&(d.addEventListener("progress",G),u!==null&&d.upload&&d.upload.addEventListener("progress",z)),d.send(u),a.next({type:po.Sent}),()=>{d.removeEventListener("error",w),d.removeEventListener("abort",w),d.removeEventListener("load",C),d.removeEventListener("timeout",A),t.reportProgress&&(d.removeEventListener("progress",G),u!==null&&d.upload&&d.upload.removeEventListener("progress",z)),d.readyState!==d.DONE&&d.abort()}})))}static \u0275fac=function(n){return new(n||i)(Ae(Pi))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function wv(i,e){return e(i)}function Ev(i,e,t){return(n,o)=>Xt(t,()=>e(n,a=>i(a,o)))}var Qp=new He("",{factory:()=>[]}),Dv=new He(""),Yp=new He("",{factory:()=>!0});var Xd=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:function(n){let o=null;return n?o=new(n||i):o=Ae(Yd),o},providedIn:"root"})}return i})();var Ws=(()=>{class i{backend;injector;chain=null;pendingTasks=F(zm);contributeToStability=F(Yp);constructor(t,n){this.backend=t,this.injector=n}handle(t){if(this.chain===null){let n=Array.from(new Set([...this.injector.get(Qp),...this.injector.get(Dv,[])]));this.chain=n.reduceRight((o,a)=>Ev(o,a,this.injector),wv)}if(this.contributeToStability){let n=this.pendingTasks.add();return this.chain(t,o=>this.backend.handle(o)).pipe(fs(n))}else return this.chain(t,n=>this.backend.handle(n))}static \u0275fac=function(n){return new(n||i)(Ae(Xd),Ae(ai))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Zd=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:function(n){let o=null;return n?o=new(n||i):o=Ae(Ws),o},providedIn:"root"})}return i})();function Qd(i,e){return{body:e,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials,credentials:i.credentials,transferCache:i.transferCache,timeout:i.timeout,keepalive:i.keepalive,priority:i.priority,cache:i.cache,mode:i.mode,redirect:i.redirect,integrity:i.integrity,referrer:i.referrer,referrerPolicy:i.referrerPolicy}}var Av=(()=>{class i{handler;constructor(t){this.handler=t}request(t,n,o={}){let a;if(t instanceof Sr)a=t;else{let p;o.headers instanceof Ri?p=o.headers:p=new Ri(o.headers);let g;o.params&&(o.params instanceof pi?g=o.params:g=new pi({fromObject:o.params})),a=new Sr(t,n,o.body!==void 0?o.body:null,{headers:p,context:o.context,params:g,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache,keepalive:o.keepalive,priority:o.priority,cache:o.cache,mode:o.mode,redirect:o.redirect,credentials:o.credentials,referrer:o.referrer,referrerPolicy:o.referrerPolicy,integrity:o.integrity,timeout:o.timeout})}let d=Oe(a).pipe(sr(p=>this.handler.handle(p)));if(t instanceof Sr||o.observe==="events")return d;let u=d.pipe(Jn(p=>p instanceof qs));switch(o.observe||"body"){case"body":switch(a.responseType){case"arraybuffer":return u.pipe(tt(p=>{if(p.body!==null&&!(p.body instanceof ArrayBuffer))throw new me(2806,!1);return p.body}));case"blob":return u.pipe(tt(p=>{if(p.body!==null&&!(p.body instanceof Blob))throw new me(2807,!1);return p.body}));case"text":return u.pipe(tt(p=>{if(p.body!==null&&typeof p.body!="string")throw new me(2808,!1);return p.body}));case"json":default:return u.pipe(tt(p=>p.body))}case"response":return u;default:throw new me(2809,!1)}}delete(t,n={}){return this.request("DELETE",t,n)}get(t,n={}){return this.request("GET",t,n)}head(t,n={}){return this.request("HEAD",t,n)}jsonp(t,n){return this.request("JSONP",t,{params:new pi().append(n,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,n={}){return this.request("OPTIONS",t,n)}patch(t,n,o={}){return this.request("PATCH",t,Qd(o,n))}post(t,n,o={}){return this.request("POST",t,Qd(o,n))}put(t,n,o={}){return this.request("PUT",t,Qd(o,n))}static \u0275fac=function(n){return new(n||i)(Ae(Zd))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Mv=new He("",{factory:()=>!0}),Tv="XSRF-TOKEN",kv=new He("",{factory:()=>Tv}),Iv="X-XSRF-TOKEN",Fv=new He("",{providedIn:"root",factory:()=>Iv}),Pv=(()=>{class i{cookieName=F(kv);doc=F(lt);lastCookieString="";lastToken=null;parseCount=0;getToken(){let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=_r(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Xp=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:function(n){let o=null;return n?o=new(n||i):o=Ae(Pv),o},providedIn:"root"})}return i})();function Rv(i,e){if(!F(Mv)||i.method==="GET"||i.method==="HEAD")return e(i);try{let o=F(uo).href,{origin:a}=new URL(o),{origin:d}=new URL(i.url,a);if(a!==d)return e(i)}catch{return e(i)}let t=F(Xp).getToken(),n=F(Fv);return t!=null&&!i.headers.has(n)&&(i=i.clone({headers:i.headers.set(n,t)})),e(i)}function eu(...i){let e=[Av,Ws,{provide:Zd,useExisting:Ws},{provide:Xd,useFactory:()=>F(yv,{optional:!0})??F(Yd)},{provide:Qp,useValue:Rv,multi:!0}];for(let t of i)e.push(...t.\u0275providers);return Ed(e)}var Zp=(()=>{class i{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(n){return new(n||i)(Ae(lt))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Me=(function(i){return i[i.State=0]="State",i[i.Transition=1]="Transition",i[i.Sequence=2]="Sequence",i[i.Group=3]="Group",i[i.Animate=4]="Animate",i[i.Keyframes=5]="Keyframes",i[i.Style=6]="Style",i[i.Trigger=7]="Trigger",i[i.Reference=8]="Reference",i[i.AnimateChild=9]="AnimateChild",i[i.AnimateRef=10]="AnimateRef",i[i.Query=11]="Query",i[i.Stagger=12]="Stagger",i})(Me||{}),pn="*";function gi(i,e){return{type:Me.Trigger,name:i,definitions:e,options:{}}}function gn(i,e=null){return{type:Me.Animate,styles:e,timings:i}}function zs(i,e=null){return{type:Me.Group,steps:i,options:e}}function eg(i,e=null){return{type:Me.Sequence,steps:i,options:e}}function et(i){return{type:Me.Style,styles:i,offset:null}}function Vi(i,e,t=null){return{type:Me.Transition,expr:i,animation:e,options:t}}function tu(i=null){return{type:Me.AnimateChild,options:i}}function vt(i,e,t=null){return{type:Me.Query,selector:i,animation:e,options:t}}var Bn=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(e=0,t=0){this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},Ni=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(e){this.players=e;let t=0,n=0,o=0,a=this.players.length;a==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++t==a&&this._onFinish()}),d.onDestroy(()=>{++n==a&&this._onDestroy()}),d.onStart(()=>{++o==a&&this._onStart()})}),this.totalTime=this.players.reduce((d,u)=>Math.max(d,u.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(n=>{let o=n.totalTime?Math.min(1,t/n.totalTime):1;n.setPosition(o)})}getPosition(){let e=this.players.reduce((t,n)=>t===null||n.totalTime>t.totalTime?n:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},ho="!";function tg(i){return new me(3e3,!1)}function Vv(){return new me(3100,!1)}function Bv(){return new me(3101,!1)}function Lv(i){return new me(3001,!1)}function Ov(i){return new me(3003,!1)}function Uv(i){return new me(3004,!1)}function ig(i,e){return new me(3005,!1)}function og(){return new me(3006,!1)}function rg(){return new me(3007,!1)}function sg(i,e){return new me(3008,!1)}function ag(i){return new me(3002,!1)}function lg(i,e,t,n,o){return new me(3010,!1)}function cg(){return new me(3011,!1)}function dg(){return new me(3012,!1)}function ug(){return new me(3200,!1)}function mg(){return new me(3202,!1)}function pg(){return new me(3013,!1)}function gg(i){return new me(3014,!1)}function hg(i){return new me(3015,!1)}function fg(i){return new me(3016,!1)}function _g(i,e){return new me(3404,!1)}function Gv(i){return new me(3502,!1)}function vg(i){return new me(3503,!1)}function xg(){return new me(3300,!1)}function Cg(i){return new me(3504,!1)}function bg(i){return new me(3301,!1)}function yg(i,e){return new me(3302,!1)}function Sg(i){return new me(3303,!1)}function wg(i,e){return new me(3400,!1)}function Eg(i){return new me(3401,!1)}function Dg(i){return new me(3402,!1)}function Ag(i,e){return new me(3505,!1)}function Zn(i){switch(i.length){case 0:return new Bn;case 1:return i[0];default:return new Ni(i)}}function ru(i,e,t=new Map,n=new Map){let o=[],a=[],d=-1,u=null;if(e.forEach(p=>{let g=p.get("offset"),C=g==d,w=C&&u||new Map;p.forEach((A,V)=>{let G=V,z=A;if(V!=="offset")switch(G=i.normalizePropertyName(G,o),z){case ho:z=t.get(V);break;case pn:z=n.get(V);break;default:z=i.normalizeStyleValue(V,G,z,o);break}w.set(G,z)}),C||a.push(w),u=w,d=g}),o.length)throw Gv(o);return a}function Ks(i,e,t,n){switch(e){case"start":i.onStart(()=>n(t&&nu(t,"start",i)));break;case"done":i.onDone(()=>n(t&&nu(t,"done",i)));break;case"destroy":i.onDestroy(()=>n(t&&nu(t,"destroy",i)));break}}function nu(i,e,t){let n=t.totalTime,o=!!t.disabled,a=js(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,n??i.totalTime,o),d=i._data;return d!=null&&(a._data=d),a}function js(i,e,t,n,o="",a=0,d){return{element:i,triggerName:e,fromState:t,toState:n,phaseName:o,totalTime:a,disabled:!!d}}function $t(i,e,t){let n=i.get(e);return n||i.set(e,n=t),n}function su(i){let e=i.indexOf(":"),t=i.substring(1,e),n=i.slice(e+1);return[t,n]}var $v=typeof document>"u"?null:document.documentElement;function Js(i){let e=i.parentNode||i.host||null;return e===$v?null:e}function Hv(i){return i.substring(1,6)=="ebkit"}var Bi=null,ng=!1;function Mg(i){Bi||(Bi=qv()||{},ng=Bi.style?"WebkitAppearance"in Bi.style:!1);let e=!0;return Bi.style&&!Hv(i)&&(e=i in Bi.style,!e&&ng&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in Bi.style)),e}function qv(){return typeof document<"u"?document.body:null}function au(i,e){for(;e;){if(e===i)return!0;e=Js(e)}return!1}function lu(i,e,t){if(t)return Array.from(i.querySelectorAll(e));let n=i.querySelector(e);return n?[n]:[]}var Wv=1e3,cu="{{",zv="}}",du="ng-enter",Qs="ng-leave",Er="ng-trigger",Dr=".ng-trigger",uu="ng-animating",Ys=".ng-animating";function Ln(i){if(typeof i=="number")return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:iu(parseFloat(e[1]),e[2])}function iu(i,e){switch(e){case"s":return i*Wv;default:return i}}function Ar(i,e,t){return i.hasOwnProperty("duration")?i:jv(i,e,t)}var Kv=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function jv(i,e,t){let n,o=0,a="";if(typeof i=="string"){let d=i.match(Kv);if(d===null)return e.push(tg(i)),{duration:0,delay:0,easing:""};n=iu(parseFloat(d[1]),d[2]);let u=d[3];u!=null&&(o=iu(parseFloat(u),d[4]));let p=d[5];p&&(a=p)}else n=i;if(!t){let d=!1,u=e.length;n<0&&(e.push(Vv()),d=!0),o<0&&(e.push(Bv()),d=!0),d&&e.splice(u,0,tg(i))}return{duration:n,delay:o,easing:a}}function Tg(i){return i.length?i[0]instanceof Map?i:i.map(e=>new Map(Object.entries(e))):[]}function Sn(i,e,t){e.forEach((n,o)=>{let a=Xs(o);t&&!t.has(o)&&t.set(o,i.style[a]),i.style[a]=n})}function hi(i,e){e.forEach((t,n)=>{let o=Xs(n);i.style[o]=""})}function fo(i){return Array.isArray(i)?i.length==1?i[0]:eg(i):i}function kg(i,e,t){let n=e.params||{},o=mu(i);o.length&&o.forEach(a=>{n.hasOwnProperty(a)||t.push(Lv(a))})}var ou=new RegExp(`${cu}\\s*(.+?)\\s*${zv}`,"g");function mu(i){let e=[];if(typeof i=="string"){let t;for(;t=ou.exec(i);)e.push(t[1]);ou.lastIndex=0}return e}function _o(i,e,t){let n=`${i}`,o=n.replace(ou,(a,d)=>{let u=e[d];return u==null&&(t.push(Ov(d)),u=""),u.toString()});return o==n?i:o}var Jv=/-+([a-z0-9])/g;function Xs(i){return i.replace(Jv,(...e)=>e[1].toUpperCase())}function Ig(i,e){return i===0||e===0}function Fg(i,e,t){if(t.size&&e.length){let n=e[0],o=[];if(t.forEach((a,d)=>{n.has(d)||o.push(d),n.set(d,a)}),o.length)for(let a=1;a<e.length;a++){let d=e[a];o.forEach(u=>d.set(u,Zs(i,u)))}}return e}function Ht(i,e,t){switch(e.type){case Me.Trigger:return i.visitTrigger(e,t);case Me.State:return i.visitState(e,t);case Me.Transition:return i.visitTransition(e,t);case Me.Sequence:return i.visitSequence(e,t);case Me.Group:return i.visitGroup(e,t);case Me.Animate:return i.visitAnimate(e,t);case Me.Keyframes:return i.visitKeyframes(e,t);case Me.Style:return i.visitStyle(e,t);case Me.Reference:return i.visitReference(e,t);case Me.AnimateChild:return i.visitAnimateChild(e,t);case Me.AnimateRef:return i.visitAnimateRef(e,t);case Me.Query:return i.visitQuery(e,t);case Me.Stagger:return i.visitStagger(e,t);default:throw Uv(e.type)}}function Zs(i,e){return window.getComputedStyle(i)[e]}var Tu=(()=>{class i{validateStyleProperty(t){return Mg(t)}containsElement(t,n){return au(t,n)}getParentElement(t){return Js(t)}query(t,n,o){return lu(t,n,o)}computeStyle(t,n,o){return o||""}animate(t,n,o,a,d,u=[],p){return new Bn(o,a)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})(),Oi=class{static NOOP=new Tu},Ui=class{};var Qv=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),oa=class extends Ui{normalizePropertyName(e,t){return Xs(e)}normalizeStyleValue(e,t,n,o){let a="",d=n.toString().trim();if(Qv.has(t)&&n!==0&&n!=="0")if(typeof n=="number")a="px";else{let u=n.match(/^[+-]?[\d\.]+([a-z]*)$/);u&&u[1].length==0&&o.push(ig(e,n))}return d+a}};var ra="*";function Yv(i,e){let t=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>Xv(n,t,e)):t.push(i),t}function Xv(i,e,t){if(i[0]==":"){let p=Zv(i,t);if(typeof p=="function"){e.push(p);return}i=p}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(hg(i)),e;let o=n[1],a=n[2],d=n[3];e.push(Pg(o,d));let u=o==ra&&d==ra;a[0]=="<"&&!u&&e.push(Pg(d,o))}function Zv(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(fg(i)),"* => *"}}var ea=new Set(["true","1"]),ta=new Set(["false","0"]);function Pg(i,e){let t=ea.has(i)||ta.has(i),n=ea.has(e)||ta.has(e);return(o,a)=>{let d=i==ra||i==o,u=e==ra||e==a;return!d&&t&&typeof o=="boolean"&&(d=o?ea.has(i):ta.has(i)),!u&&n&&typeof a=="boolean"&&(u=a?ea.has(e):ta.has(e)),d&&u}}var Hg=":self",ex=new RegExp(`s*${Hg}s*,?`,"g");function qg(i,e,t,n){return new vu(i).build(e,t,n)}var Rg="",vu=class{_driver;constructor(e){this._driver=e}build(e,t,n){let o=new xu(t);return this._resetContextStyleTimingState(o),Ht(this,fo(e),o)}_resetContextStyleTimingState(e){e.currentQuerySelector=Rg,e.collectedStyles=new Map,e.collectedStyles.set(Rg,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,o=t.depCount=0,a=[],d=[];return e.name.charAt(0)=="@"&&t.errors.push(og()),e.definitions.forEach(u=>{if(this._resetContextStyleTimingState(t),u.type==Me.State){let p=u,g=p.name;g.toString().split(/\s*,\s*/).forEach(C=>{p.name=C,a.push(this.visitState(p,t))}),p.name=g}else if(u.type==Me.Transition){let p=this.visitTransition(u,t);n+=p.queryCount,o+=p.depCount,d.push(p)}else t.errors.push(rg())}),{type:Me.Trigger,name:e.name,states:a,transitions:d,queryCount:n,depCount:o,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),o=e.options&&e.options.params||null;if(n.containsDynamicStyles){let a=new Set,d=o||{};n.styles.forEach(u=>{u instanceof Map&&u.forEach(p=>{mu(p).forEach(g=>{d.hasOwnProperty(g)||a.add(g)})})}),a.size&&t.errors.push(sg(e.name,[...a.values()]))}return{type:Me.State,name:e.name,style:n,options:o?{params:o}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=Ht(this,fo(e.animation),t),o=Yv(e.expr,t.errors);return{type:Me.Transition,matchers:o,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:Li(e.options)}}visitSequence(e,t){return{type:Me.Sequence,steps:e.steps.map(n=>Ht(this,n,t)),options:Li(e.options)}}visitGroup(e,t){let n=t.currentTime,o=0,a=e.steps.map(d=>{t.currentTime=n;let u=Ht(this,d,t);return o=Math.max(o,t.currentTime),u});return t.currentTime=o,{type:Me.Group,steps:a,options:Li(e.options)}}visitAnimate(e,t){let n=ox(e.timings,t.errors);t.currentAnimateTimings=n;let o,a=e.styles?e.styles:et({});if(a.type==Me.Keyframes)o=this.visitKeyframes(a,t);else{let d=e.styles,u=!1;if(!d){u=!0;let g={};n.easing&&(g.easing=n.easing),d=et(g)}t.currentTime+=n.duration+n.delay;let p=this.visitStyle(d,t);p.isEmptyStep=u,o=p}return t.currentAnimateTimings=null,{type:Me.Animate,timings:n,style:o,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],o=Array.isArray(e.styles)?e.styles:[e.styles];for(let u of o)typeof u=="string"?u===pn?n.push(u):t.errors.push(ag(u)):n.push(new Map(Object.entries(u)));let a=!1,d=null;return n.forEach(u=>{if(u instanceof Map&&(u.has("easing")&&(d=u.get("easing"),u.delete("easing")),!a)){for(let p of u.values())if(p.toString().indexOf(cu)>=0){a=!0;break}}}),{type:Me.Style,styles:n,easing:d,offset:e.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,o=t.currentTime,a=t.currentTime;n&&a>0&&(a-=n.duration+n.delay),e.styles.forEach(d=>{typeof d!="string"&&d.forEach((u,p)=>{let g=t.collectedStyles.get(t.currentQuerySelector),C=g.get(p),w=!0;C&&(a!=o&&a>=C.startTime&&o<=C.endTime&&(t.errors.push(lg(p,C.startTime,C.endTime,a,o)),w=!1),a=C.startTime),w&&g.set(p,{startTime:a,endTime:o}),t.options&&kg(u,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:Me.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(cg()),n;let o=1,a=0,d=[],u=!1,p=!1,g=0,C=e.steps.map(K=>{let Z=this._makeStyleAst(K,t),Y=Z.offset!=null?Z.offset:ix(Z.styles),re=0;return Y!=null&&(a++,re=Z.offset=Y),p=p||re<0||re>1,u=u||re<g,g=re,d.push(re),Z});p&&t.errors.push(dg()),u&&t.errors.push(ug());let w=e.steps.length,A=0;a>0&&a<w?t.errors.push(mg()):a==0&&(A=o/(w-1));let V=w-1,G=t.currentTime,z=t.currentAnimateTimings,$=z.duration;return C.forEach((K,Z)=>{let Y=A>0?Z==V?1:A*Z:d[Z],re=Y*$;t.currentTime=G+z.delay+re,z.duration=re,this._validateStyleAst(K,t),K.offset=Y,n.styles.push(K)}),n}visitReference(e,t){return{type:Me.Reference,animation:Ht(this,fo(e.animation),t),options:Li(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:Me.AnimateChild,options:Li(e.options)}}visitAnimateRef(e,t){return{type:Me.AnimateRef,animation:this.visitReference(e.animation,t),options:Li(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,o=e.options||{};t.queryCount++,t.currentQuery=e;let[a,d]=tx(e.selector);t.currentQuerySelector=n.length?n+" "+a:a,$t(t.collectedStyles,t.currentQuerySelector,new Map);let u=Ht(this,fo(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:Me.Query,selector:a,limit:o.limit||0,optional:!!o.optional,includeSelf:d,animation:u,originalSelector:e.selector,options:Li(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(pg());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:Ar(e.timings,t.errors,!0);return{type:Me.Stagger,animation:Ht(this,fo(e.animation),t),timings:n,options:null}}};function tx(i){let e=!!i.split(/\s*,\s*/).find(t=>t==Hg);return e&&(i=i.replace(ex,"")),i=i.replace(/@\*/g,Dr).replace(/@\w+/g,t=>Dr+"-"+t.slice(1)).replace(/:animating/g,Ys),[i,e]}function nx(i){return i?E({},i):null}var xu=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(e){this.errors=e}};function ix(i){if(typeof i=="string")return null;let e=null;if(Array.isArray(i))i.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let t=i;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function ox(i,e){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let a=Ar(i,e).duration;return pu(a,0,"")}let t=i;if(t.split(/\s+/).some(a=>a.charAt(0)=="{"&&a.charAt(1)=="{")){let a=pu(0,0,"");return a.dynamic=!0,a.strValue=t,a}let o=Ar(t,e);return pu(o.duration,o.delay,o.easing)}function Li(i){return i?(i=E({},i),i.params&&(i.params=nx(i.params))):i={},i}function pu(i,e,t){return{duration:i,delay:e,easing:t}}function ku(i,e,t,n,o,a,d=null,u=!1){return{type:1,element:i,keyframes:e,preStyleProps:t,postStyleProps:n,duration:o,delay:a,totalTime:o+a,easing:d,subTimeline:u}}var Tr=class{_map=new Map;get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},rx=1,sx=":enter",ax=new RegExp(sx,"g"),lx=":leave",cx=new RegExp(lx,"g");function Wg(i,e,t,n,o,a=new Map,d=new Map,u,p,g=[]){return new Cu().buildKeyframes(i,e,t,n,o,a,d,u,p,g)}var Cu=class{buildKeyframes(e,t,n,o,a,d,u,p,g,C=[]){g=g||new Tr;let w=new bu(e,t,g,o,a,C,[]);w.options=p;let A=p.delay?Ln(p.delay):0;w.currentTimeline.delayNextStep(A),w.currentTimeline.setStyles([d],null,w.errors,p),Ht(this,n,w);let V=w.timelines.filter(G=>G.containsAnimation());if(V.length&&u.size){let G;for(let z=V.length-1;z>=0;z--){let $=V[z];if($.element===t){G=$;break}}G&&!G.allowOnlyTimelineStyles()&&G.setStyles([u],null,w.errors,p)}return V.length?V.map(G=>G.buildKeyframes()):[ku(t,[],[],[],0,A,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let o=t.createSubContext(e.options),a=t.currentTimeline.currentTime,d=this._visitSubInstructions(n,o,o.options);a!=d&&t.transformIntoNewTimeline(d)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let o of e){let a=o?.delay;if(a){let d=typeof a=="number"?a:Ln(_o(a,o?.params??{},t.errors));n.delayNextStep(d)}}}_visitSubInstructions(e,t,n){let a=t.currentTimeline.currentTime,d=n.duration!=null?Ln(n.duration):null,u=n.delay!=null?Ln(n.delay):null;return d!==0&&e.forEach(p=>{let g=t.appendInstructionToTimeline(p,d,u);a=Math.max(a,g.duration+g.delay)}),a}visitReference(e,t){t.updateOptions(e.options,!0),Ht(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,o=t,a=e.options;if(a&&(a.params||a.delay)&&(o=t.createSubContext(a),o.transformIntoNewTimeline(),a.delay!=null)){o.previousNode.type==Me.Style&&(o.currentTimeline.snapshotCurrentStyles(),o.previousNode=sa);let d=Ln(a.delay);o.delayNextStep(d)}e.steps.length&&(e.steps.forEach(d=>Ht(this,d,o)),o.currentTimeline.applyStylesToKeyframe(),o.subContextCount>n&&o.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],o=t.currentTimeline.currentTime,a=e.options&&e.options.delay?Ln(e.options.delay):0;e.steps.forEach(d=>{let u=t.createSubContext(e.options);a&&u.delayNextStep(a),Ht(this,d,u),o=Math.max(o,u.currentTimeline.currentTime),n.push(u.currentTimeline)}),n.forEach(d=>t.currentTimeline.mergeTimelineCollectedStyles(d)),t.transformIntoNewTimeline(o),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,o=t.params?_o(n,t.params,t.errors):n;return Ar(o,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),o=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),o.snapshotCurrentStyles());let a=e.style;a.type==Me.Keyframes?this.visitKeyframes(a,t):(t.incrementTime(n.duration),this.visitStyle(a,t),o.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,o=t.currentAnimateTimings;!o&&n.hasCurrentStyleProperties()&&n.forwardFrame();let a=o&&o.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(a):n.setStyles(e.styles,a,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,o=t.currentTimeline.duration,a=n.duration,u=t.createSubContext().currentTimeline;u.easing=n.easing,e.styles.forEach(p=>{let g=p.offset||0;u.forwardTime(g*a),u.setStyles(p.styles,p.easing,t.errors,t.options),u.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(u),t.transformIntoNewTimeline(o+a),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,o=e.options||{},a=o.delay?Ln(o.delay):0;a&&(t.previousNode.type===Me.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=sa);let d=n,u=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!o.optional,t.errors);t.currentQueryTotal=u.length;let p=null;u.forEach((g,C)=>{t.currentQueryIndex=C;let w=t.createSubContext(e.options,g);a&&w.delayNextStep(a),g===t.element&&(p=w.currentTimeline),Ht(this,e.animation,w),w.currentTimeline.applyStylesToKeyframe();let A=w.currentTimeline.currentTime;d=Math.max(d,A)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(d),p&&(t.currentTimeline.mergeTimelineCollectedStyles(p),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,o=t.currentTimeline,a=e.timings,d=Math.abs(a.duration),u=d*(t.currentQueryTotal-1),p=d*t.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":p=u-p;break;case"full":p=n.currentStaggerTime;break}let C=t.currentTimeline;p&&C.delayNextStep(p);let w=C.currentTime;Ht(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=o.currentTime-w+(o.startTime-n.currentTimeline.startTime)}},sa={},bu=class i{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=sa;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(e,t,n,o,a,d,u,p){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=o,this._leaveClassName=a,this.errors=d,this.timelines=u,this.currentTimeline=p||new aa(this._driver,t,0),u.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,o=this.options;n.duration!=null&&(o.duration=Ln(n.duration)),n.delay!=null&&(o.delay=Ln(n.delay));let a=n.params;if(a){let d=o.params;d||(d=this.options.params={}),Object.keys(a).forEach(u=>{(!t||!d.hasOwnProperty(u))&&(d[u]=_o(a[u],d,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(o=>{n[o]=t[o]})}}return e}createSubContext(e=null,t,n){let o=t||this.element,a=new i(this._driver,o,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(o,n||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(e),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(e){return this.previousNode=sa,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let o={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},a=new yu(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,o,e.stretchStartingKeyframe);return this.timelines.push(a),o}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,o,a,d){let u=[];if(o&&u.push(this.element),e.length>0){e=e.replace(ax,"."+this._enterClassName),e=e.replace(cx,"."+this._leaveClassName);let p=n!=1,g=this._driver.query(this.element,e,p);n!==0&&(g=n<0?g.slice(g.length+n,g.length):g.slice(0,n)),u.push(...g)}return!a&&u.length==0&&d.push(gg(t)),u}},aa=class i{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(e,t,n,o){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=o,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new i(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=rx,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||pn),this._currentKeyframe.set(t,pn);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,o){t&&this._previousKeyframe.set("easing",t);let a=o&&o.params||{},d=dx(e,this._globalTimelineStyles);for(let[u,p]of d){let g=_o(p,a,n);this._pendingStyles.set(u,g),this._localTimelineStyles.has(u)||this._backFill.set(u,this._globalTimelineStyles.get(u)??pn),this._updateStyle(u,g)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let o=this._styleSummary.get(n);(!o||t.time>o.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,o=[];this._keyframes.forEach((u,p)=>{let g=new Map([...this._backFill,...u]);g.forEach((C,w)=>{C===ho?e.add(w):C===pn&&t.add(w)}),n||g.set("offset",p/this.duration),o.push(g)});let a=[...e.values()],d=[...t.values()];if(n){let u=o[0],p=new Map(u);u.set("offset",0),p.set("offset",1),o=[u,p]}return ku(this.element,o,a,d,this.duration,this.startTime,this.easing,!1)}},yu=class extends aa{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(e,t,n,o,a,d,u=!1){super(e,t,d.delay),this.keyframes=n,this.preStyleProps=o,this.postStyleProps=a,this._stretchStartingKeyframe=u,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:o}=this.timings;if(this._stretchStartingKeyframe&&t){let a=[],d=n+t,u=t/d,p=new Map(e[0]);p.set("offset",0),a.push(p);let g=new Map(e[0]);g.set("offset",Ng(u)),a.push(g);let C=e.length-1;for(let w=1;w<=C;w++){let A=new Map(e[w]),V=A.get("offset"),G=t+V*n;A.set("offset",Ng(G/d)),a.push(A)}n=d,t=0,o="",e=a}return ku(this.element,e,this.preStyleProps,this.postStyleProps,n,t,o,!0)}};function Ng(i,e=3){let t=Math.pow(10,e-1);return Math.round(i*t)/t}function dx(i,e){let t=new Map,n;return i.forEach(o=>{if(o==="*"){n??=e.keys();for(let a of n)t.set(a,pn)}else for(let[a,d]of o)t.set(a,d)}),t}function Vg(i,e,t,n,o,a,d,u,p,g,C,w,A){return{type:0,element:i,triggerName:e,isRemovalTransition:o,fromState:t,fromStyles:a,toState:n,toStyles:d,timelines:u,queriedElements:p,preStyleProps:g,postStyleProps:C,totalTime:w,errors:A}}var gu={},la=class{_triggerName;ast;_stateStyles;constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,o){return ux(this.ast.matchers,e,t,n,o)}buildStyles(e,t,n){let o=this._stateStyles.get("*");return e!==void 0&&(o=this._stateStyles.get(e?.toString())||o),o?o.buildStyles(t,n):new Map}build(e,t,n,o,a,d,u,p,g,C){let w=[],A=this.ast.options&&this.ast.options.params||gu,V=u&&u.params||gu,G=this.buildStyles(n,V,w),z=p&&p.params||gu,$=this.buildStyles(o,z,w),K=new Set,Z=new Map,Y=new Map,re=o==="void",le={params:zg(z,A),delay:this.ast.options?.delay},ue=C?[]:Wg(e,t,this.ast.animation,a,d,G,$,le,g,w),pe=0;return ue.forEach(Fe=>{pe=Math.max(Fe.duration+Fe.delay,pe)}),w.length?Vg(t,this._triggerName,n,o,re,G,$,[],[],Z,Y,pe,w):(ue.forEach(Fe=>{let we=Fe.element,Pe=$t(Z,we,new Set);Fe.preStyleProps.forEach(wt=>Pe.add(wt));let at=$t(Y,we,new Set);Fe.postStyleProps.forEach(wt=>at.add(wt)),we!==t&&K.add(we)}),Vg(t,this._triggerName,n,o,re,G,$,ue,[...K.values()],Z,Y,pe))}};function ux(i,e,t,n,o){return i.some(a=>a(e,t,n,o))}function zg(i,e){let t=E({},e);return Object.entries(i).forEach(([n,o])=>{o!=null&&(t[n]=o)}),t}var Su=class{styles;defaultParams;normalizer;constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,o=zg(e,this.defaultParams);return this.styles.styles.forEach(a=>{typeof a!="string"&&a.forEach((d,u)=>{d&&(d=_o(d,o,t));let p=this.normalizer.normalizePropertyName(u,t);d=this.normalizer.normalizeStyleValue(u,p,d,t),n.set(u,d)})}),n}};function mx(i,e,t){return new wu(i,e,t)}var wu=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,t.states.forEach(o=>{let a=o.options&&o.options.params||{};this.states.set(o.name,new Su(o.style,a,n))}),Bg(this.states,"true","1"),Bg(this.states,"false","0"),t.transitions.forEach(o=>{this.transitionFactories.push(new la(e,o,this.states))}),this.fallbackTransition=px(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,o){return this.transitionFactories.find(d=>d.match(e,t,n,o))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function px(i,e,t){let n=[(d,u)=>!0],o={type:Me.Sequence,steps:[],options:null},a={type:Me.Transition,animation:o,matchers:n,options:null,queryCount:0,depCount:0};return new la(i,a,e)}function Bg(i,e,t){i.has(e)?i.has(t)||i.set(t,i.get(e)):i.has(t)&&i.set(e,i.get(t))}var gx=new Tr,Eu=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n}register(e,t){let n=[],o=[],a=qg(this._driver,t,n,o);if(n.length)throw vg(n);this._animations.set(e,a)}_buildPlayer(e,t,n){let o=e.element,a=ru(this._normalizer,e.keyframes,t,n);return this._driver.animate(o,a,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let o=[],a=this._animations.get(e),d,u=new Map;if(a?(d=Wg(this._driver,t,a,du,Qs,new Map,new Map,n,gx,o),d.forEach(C=>{let w=$t(u,C.element,new Map);C.postStyleProps.forEach(A=>w.set(A,null))})):(o.push(xg()),d=[]),o.length)throw Cg(o);u.forEach((C,w)=>{C.forEach((A,V)=>{C.set(V,this._driver.computeStyle(w,V,pn))})});let p=d.map(C=>{let w=u.get(C.element);return this._buildPlayer(C,new Map,w)}),g=Zn(p);return this._playersById.set(e,g),g.onDestroy(()=>this.destroy(e)),this.players.push(g),g}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw bg(e);return t}listen(e,t,n,o){let a=js(t,"","","");return Ks(this._getPlayer(e),n,a,o),()=>{}}command(e,t,n,o){if(n=="register"){this.register(e,o[0]);return}if(n=="create"){let d=o[0]||{};this.create(e,t,d);return}let a=this._getPlayer(e);switch(n){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(o[0]));break;case"destroy":this.destroy(e);break}}},Lg="ng-animate-queued",hx=".ng-animate-queued",hu="ng-animate-disabled",fx=".ng-animate-disabled",_x="ng-star-inserted",vx=".ng-star-inserted",xx=[],Kg={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Cx={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},wn="__ng_removed",kr=class{namespaceId;value;options;get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),o=n?e.value:e;if(this.value=yx(o),n){let a=e,{value:d}=a,u=bd(a,["value"]);this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(o=>{n[o]==null&&(n[o]=t[o])})}}},Mr="void",fu=new kr(Mr),Du=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this._hostClassName="ng-tns-"+e,hn(t,this._hostClassName)}listen(e,t,n,o){if(!this._triggers.has(t))throw yg(n,t);if(n==null||n.length==0)throw Sg(t);if(!Sx(n))throw wg(n,t);let a=$t(this._elementListeners,e,[]),d={name:t,phase:n,callback:o};a.push(d);let u=$t(this._engine.statesByElement,e,new Map);return u.has(t)||(hn(e,Er),hn(e,Er+"-"+t),u.set(t,fu)),()=>{this._engine.afterFlush(()=>{let p=a.indexOf(d);p>=0&&a.splice(p,1),this._triggers.has(t)||u.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw Eg(e);return t}trigger(e,t,n,o=!0){let a=this._getTrigger(t),d=new Ir(this.id,t,e),u=this._engine.statesByElement.get(e);u||(hn(e,Er),hn(e,Er+"-"+t),this._engine.statesByElement.set(e,u=new Map));let p=u.get(t),g=new kr(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&p&&g.absorbOptions(p.options),u.set(t,g),p||(p=fu),!(g.value===Mr)&&p.value===g.value){if(!Dx(p.params,g.params)){let z=[],$=a.matchStyles(p.value,p.params,z),K=a.matchStyles(g.value,g.params,z);z.length?this._engine.reportError(z):this._engine.afterFlush(()=>{hi(e,$),Sn(e,K)})}return}let A=$t(this._engine.playersByElement,e,[]);A.forEach(z=>{z.namespaceId==this.id&&z.triggerName==t&&z.queued&&z.destroy()});let V=a.matchTransition(p.value,g.value,e,g.params),G=!1;if(!V){if(!o)return;V=a.fallbackTransition,G=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:V,fromState:p,toState:g,player:d,isFallbackTransition:G}),G||(hn(e,Lg),d.onStart(()=>{vo(e,Lg)})),d.onDone(()=>{let z=this.players.indexOf(d);z>=0&&this.players.splice(z,1);let $=this._engine.playersByElement.get(e);if($){let K=$.indexOf(d);K>=0&&$.splice(K,1)}}),this.players.push(d),A.push(d),d}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(o=>o.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,Dr,!0);n.forEach(o=>{if(o[wn])return;let a=this._engine.fetchNamespacesByElement(o);a.size?a.forEach(d=>d.triggerLeaveAnimation(o,t,!1,!0)):this.clearElementCache(o)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(o=>this.clearElementCache(o)))}triggerLeaveAnimation(e,t,n,o){let a=this._engine.statesByElement.get(e),d=new Map;if(a){let u=[];if(a.forEach((p,g)=>{if(d.set(g,p.value),this._triggers.has(g)){let C=this.trigger(e,g,Mr,o);C&&u.push(C)}}),u.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,d),n&&Zn(u).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let o=new Set;t.forEach(a=>{let d=a.name;if(o.has(d))return;o.add(d);let p=this._triggers.get(d).fallbackTransition,g=n.get(d)||fu,C=new kr(Mr),w=new Ir(this.id,d,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:d,transition:p,fromState:g,toState:C,player:w,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let o=!1;if(n.totalAnimations){let a=n.players.length?n.playersByQueriedElement.get(e):[];if(a&&a.length)o=!0;else{let d=e;for(;d=d.parentNode;)if(n.statesByElement.get(d)){o=!0;break}}}if(this.prepareLeaveAnimationListeners(e),o)n.markElementAsRemoved(this.id,e,!1,t);else{let a=e[wn];(!a||a===Kg)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){hn(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let o=n.player;if(o.destroyed)return;let a=n.element,d=this._elementListeners.get(a);d&&d.forEach(u=>{if(u.name==n.triggerName){let p=js(a,n.triggerName,n.fromState.value,n.toState.value);p._data=e,Ks(n.player,u.phase,p,u.callback)}}),o.markedForDestroy?this._engine.afterFlush(()=>{o.destroy()}):t.push(n)}),this._queue=[],t.sort((n,o)=>{let a=n.transition.ast.depCount,d=o.transition.ast.depCount;return a==0||d==0?a-d:this._engine.driver.containsElement(n.element,o.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},Au=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(e,t)=>{};_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new Du(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,o=this.namespacesByHostElement;if(n.length-1>=0){let d=!1,u=this.driver.getParentElement(t);for(;u;){let p=o.get(u);if(p){let g=n.indexOf(p);n.splice(g+1,0,e),d=!0;break}u=this.driver.getParentElement(u)}d||n.unshift(e)}else n.push(e);return o.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let o=this._namespaceLookup[e];o&&o.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let o=this._namespaceList.indexOf(n);o>=0&&this._namespaceList.splice(o,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let o of n.values())if(o.namespaceId){let a=this._fetchNamespace(o.namespaceId);a&&t.add(a)}}return t}trigger(e,t,n,o){if(na(t)){let a=this._fetchNamespace(e);if(a)return a.trigger(t,n,o),!0}return!1}insertNode(e,t,n,o){if(!na(t))return;let a=t[wn];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;let d=this.collectedLeaveElements.indexOf(t);d>=0&&this.collectedLeaveElements.splice(d,1)}if(e){let d=this._fetchNamespace(e);d&&d.insertNode(t,n)}o&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),hn(e,hu)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),vo(e,hu))}removeNode(e,t,n){if(na(t)){let o=e?this._fetchNamespace(e):null;o?o.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let a=this.namespacesByHostElement.get(t);a&&a.id!==e&&a.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,o,a){this.collectedLeaveElements.push(t),t[wn]={namespaceId:e,setForRemoval:o,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:a}}listen(e,t,n,o,a){return na(t)?this._fetchNamespace(e).listen(t,n,o,a):()=>{}}_buildInstruction(e,t,n,o,a){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,o,e.fromState.options,e.toState.options,t,a)}destroyInnerAnimations(e){let t=this.driver.query(e,Dr,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,Ys,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Zn(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[wn];if(t&&t.setForRemoval){if(e[wn]=Kg,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(hu)&&this.markElementAsDisabled(e,!1),this.driver.query(e,fx,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,o)=>this._balanceNamespaceList(n,o)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let o=this.collectedEnterElements[n];hn(o,_x)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let o=0;o<n.length;o++)n[o]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let o=this.collectedLeaveElements[n];this.processLeaveNode(o)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?Zn(t).onDone(()=>{n.forEach(o=>o())}):n.forEach(o=>o())}}reportError(e){throw Dg(e)}_flushAnimations(e,t){let n=new Tr,o=[],a=new Map,d=[],u=new Map,p=new Map,g=new Map,C=new Set;this.disabledNodes.forEach(_e=>{C.add(_e);let ye=this.driver.query(_e,hx,!0);for(let De=0;De<ye.length;De++)C.add(ye[De])});let w=this.bodyNode,A=Array.from(this.statesByElement.keys()),V=Gg(A,this.collectedEnterElements),G=new Map,z=0;V.forEach((_e,ye)=>{let De=du+z++;G.set(ye,De),_e.forEach($e=>hn($e,De))});let $=[],K=new Set,Z=new Set;for(let _e=0;_e<this.collectedLeaveElements.length;_e++){let ye=this.collectedLeaveElements[_e],De=ye[wn];De&&De.setForRemoval&&($.push(ye),K.add(ye),De.hasAnimation?this.driver.query(ye,vx,!0).forEach($e=>K.add($e)):Z.add(ye))}let Y=new Map,re=Gg(A,Array.from(K));re.forEach((_e,ye)=>{let De=Qs+z++;Y.set(ye,De),_e.forEach($e=>hn($e,De))}),e.push(()=>{V.forEach((_e,ye)=>{let De=G.get(ye);_e.forEach($e=>vo($e,De))}),re.forEach((_e,ye)=>{let De=Y.get(ye);_e.forEach($e=>vo($e,De))}),$.forEach(_e=>{this.processLeaveNode(_e)})});let le=[],ue=[];for(let _e=this._namespaceList.length-1;_e>=0;_e--)this._namespaceList[_e].drainQueuedTransitions(t).forEach(De=>{let $e=De.player,ht=De.element;if(le.push($e),this.collectedEnterElements.length){let Et=ht[wn];if(Et&&Et.setForMove){if(Et.previousTriggersValues&&Et.previousTriggersValues.has(De.triggerName)){let Ti=Et.previousTriggersValues.get(De.triggerName),sn=this.statesByElement.get(De.element);if(sn&&sn.has(De.triggerName)){let ps=sn.get(De.triggerName);ps.value=Ti,sn.set(De.triggerName,ps)}}$e.destroy();return}}let Fn=!w||!this.driver.containsElement(w,ht),Yt=Y.get(ht),oi=G.get(ht),nt=this._buildInstruction(De,n,oi,Yt,Fn);if(nt.errors&&nt.errors.length){ue.push(nt);return}if(Fn){$e.onStart(()=>hi(ht,nt.fromStyles)),$e.onDestroy(()=>Sn(ht,nt.toStyles)),o.push($e);return}if(De.isFallbackTransition){$e.onStart(()=>hi(ht,nt.fromStyles)),$e.onDestroy(()=>Sn(ht,nt.toStyles)),o.push($e);return}let Rm=[];nt.timelines.forEach(Et=>{Et.stretchStartingKeyframe=!0,this.disabledNodes.has(Et.element)||Rm.push(Et)}),nt.timelines=Rm,n.append(ht,nt.timelines);let C1={instruction:nt,player:$e,element:ht};d.push(C1),nt.queriedElements.forEach(Et=>$t(u,Et,[]).push($e)),nt.preStyleProps.forEach((Et,Ti)=>{if(Et.size){let sn=p.get(Ti);sn||p.set(Ti,sn=new Set),Et.forEach((ps,Cd)=>sn.add(Cd))}}),nt.postStyleProps.forEach((Et,Ti)=>{let sn=g.get(Ti);sn||g.set(Ti,sn=new Set),Et.forEach((ps,Cd)=>sn.add(Cd))})});if(ue.length){let _e=[];ue.forEach(ye=>{_e.push(Ag(ye.triggerName,ye.errors))}),le.forEach(ye=>ye.destroy()),this.reportError(_e)}let pe=new Map,Fe=new Map;d.forEach(_e=>{let ye=_e.element;n.has(ye)&&(Fe.set(ye,ye),this._beforeAnimationBuild(_e.player.namespaceId,_e.instruction,pe))}),o.forEach(_e=>{let ye=_e.element;this._getPreviousPlayers(ye,!1,_e.namespaceId,_e.triggerName,null).forEach($e=>{$t(pe,ye,[]).push($e),$e.destroy()})});let we=$.filter(_e=>$g(_e,p,g)),Pe=new Map;Ug(Pe,this.driver,Z,g,pn).forEach(_e=>{$g(_e,p,g)&&we.push(_e)});let wt=new Map;V.forEach((_e,ye)=>{Ug(wt,this.driver,new Set(_e),p,ho)}),we.forEach(_e=>{let ye=Pe.get(_e),De=wt.get(_e);Pe.set(_e,new Map([...ye?.entries()??[],...De?.entries()??[]]))});let Xe=[],Qt=[],rr={};d.forEach(_e=>{let{element:ye,player:De,instruction:$e}=_e;if(n.has(ye)){if(C.has(ye)){De.onDestroy(()=>Sn(ye,$e.toStyles)),De.disabled=!0,De.overrideTotalTime($e.totalTime),o.push(De);return}let ht=rr;if(Fe.size>1){let Yt=ye,oi=[];for(;Yt=Yt.parentNode;){let nt=Fe.get(Yt);if(nt){ht=nt;break}oi.push(Yt)}oi.forEach(nt=>Fe.set(nt,ht))}let Fn=this._buildAnimation(De.namespaceId,$e,pe,a,wt,Pe);if(De.setRealPlayer(Fn),ht===rr)Xe.push(De);else{let Yt=this.playersByElement.get(ht);Yt&&Yt.length&&(De.parentPlayer=Zn(Yt)),o.push(De)}}else hi(ye,$e.fromStyles),De.onDestroy(()=>Sn(ye,$e.toStyles)),Qt.push(De),C.has(ye)&&o.push(De)}),Qt.forEach(_e=>{let ye=a.get(_e.element);if(ye&&ye.length){let De=Zn(ye);_e.setRealPlayer(De)}}),o.forEach(_e=>{_e.parentPlayer?_e.syncPlayerEvents(_e.parentPlayer):_e.destroy()});for(let _e=0;_e<$.length;_e++){let ye=$[_e],De=ye[wn];if(vo(ye,Qs),De&&De.hasAnimation)continue;let $e=[];if(u.size){let Fn=u.get(ye);Fn&&Fn.length&&$e.push(...Fn);let Yt=this.driver.query(ye,Ys,!0);for(let oi=0;oi<Yt.length;oi++){let nt=u.get(Yt[oi]);nt&&nt.length&&$e.push(...nt)}}let ht=$e.filter(Fn=>!Fn.destroyed);ht.length?wx(this,ye,ht):this.processLeaveNode(ye)}return $.length=0,Xe.forEach(_e=>{this.players.push(_e),_e.onDone(()=>{_e.destroy();let ye=this.players.indexOf(_e);this.players.splice(ye,1)}),_e.play()}),Xe}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,o,a){let d=[];if(t){let u=this.playersByQueriedElement.get(e);u&&(d=u)}else{let u=this.playersByElement.get(e);if(u){let p=!a||a==Mr;u.forEach(g=>{g.queued||!p&&g.triggerName!=o||d.push(g)})}}return(n||o)&&(d=d.filter(u=>!(n&&n!=u.namespaceId||o&&o!=u.triggerName))),d}_beforeAnimationBuild(e,t,n){let o=t.triggerName,a=t.element,d=t.isRemovalTransition?void 0:e,u=t.isRemovalTransition?void 0:o;for(let p of t.timelines){let g=p.element,C=g!==a,w=$t(n,g,[]);this._getPreviousPlayers(g,C,d,u,t.toState).forEach(V=>{let G=V.getRealPlayer();G.beforeDestroy&&G.beforeDestroy(),V.destroy(),w.push(V)})}hi(a,t.fromStyles)}_buildAnimation(e,t,n,o,a,d){let u=t.triggerName,p=t.element,g=[],C=new Set,w=new Set,A=t.timelines.map(G=>{let z=G.element;C.add(z);let $=z[wn];if($&&$.removedBeforeQueried)return new Bn(G.duration,G.delay);let K=z!==p,Z=Ex((n.get(z)||xx).map(pe=>pe.getRealPlayer())).filter(pe=>{let Fe=pe;return Fe.element?Fe.element===z:!1}),Y=a.get(z),re=d.get(z),le=ru(this._normalizer,G.keyframes,Y,re),ue=this._buildPlayer(G,le,Z);if(G.subTimeline&&o&&w.add(z),K){let pe=new Ir(e,u,z);pe.setRealPlayer(ue),g.push(pe)}return ue});g.forEach(G=>{$t(this.playersByQueriedElement,G.element,[]).push(G),G.onDone(()=>bx(this.playersByQueriedElement,G.element,G))}),C.forEach(G=>hn(G,uu));let V=Zn(A);return V.onDestroy(()=>{C.forEach(G=>vo(G,uu)),Sn(p,t.toStyles)}),w.forEach(G=>{$t(o,G,[]).push(V)}),V}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new Bn(e.duration,e.delay)}},Ir=class{namespaceId;triggerName;element;_player=new Bn;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(o=>Ks(e,n,void 0,o))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){$t(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function bx(i,e,t){let n=i.get(e);if(n){if(n.length){let o=n.indexOf(t);n.splice(o,1)}n.length==0&&i.delete(e)}return n}function yx(i){return i??null}function na(i){return i&&i.nodeType===1}function Sx(i){return i=="start"||i=="done"}function Og(i,e){let t=i.style.display;return i.style.display=e??"none",t}function Ug(i,e,t,n,o){let a=[];t.forEach(p=>a.push(Og(p)));let d=[];n.forEach((p,g)=>{let C=new Map;p.forEach(w=>{let A=e.computeStyle(g,w,o);C.set(w,A),(!A||A.length==0)&&(g[wn]=Cx,d.push(g))}),i.set(g,C)});let u=0;return t.forEach(p=>Og(p,a[u++])),d}function Gg(i,e){let t=new Map;if(i.forEach(u=>t.set(u,[])),e.length==0)return t;let n=1,o=new Set(e),a=new Map;function d(u){if(!u)return n;let p=a.get(u);if(p)return p;let g=u.parentNode;return t.has(g)?p=g:o.has(g)?p=n:p=d(g),a.set(u,p),p}return e.forEach(u=>{let p=d(u);p!==n&&t.get(p).push(u)}),t}function hn(i,e){i.classList?.add(e)}function vo(i,e){i.classList?.remove(e)}function wx(i,e,t){Zn(t).onDone(()=>i.processLeaveNode(e))}function Ex(i){let e=[];return jg(i,e),e}function jg(i,e){for(let t=0;t<i.length;t++){let n=i[t];n instanceof Ni?jg(n.players,e):e.push(n)}}function Dx(i,e){let t=Object.keys(i),n=Object.keys(e);if(t.length!=n.length)return!1;for(let o=0;o<t.length;o++){let a=t[o];if(!e.hasOwnProperty(a)||i[a]!==e[a])return!1}return!0}function $g(i,e,t){let n=t.get(i);if(!n)return!1;let o=e.get(i);return o?n.forEach(a=>o.add(a)):e.set(i,n),t.delete(i),!0}var xo=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(e,t)=>{};constructor(e,t,n){this._driver=t,this._normalizer=n,this._transitionEngine=new Au(e.body,t,n),this._timelineEngine=new Eu(e.body,t,n),this._transitionEngine.onRemovalComplete=(o,a)=>this.onRemovalComplete(o,a)}registerTrigger(e,t,n,o,a){let d=e+"-"+o,u=this._triggerCache[d];if(!u){let p=[],g=[],C=qg(this._driver,a,p,g);if(p.length)throw _g(o,p);u=mx(o,C,this._normalizer),this._triggerCache[d]=u}this._transitionEngine.registerTrigger(t,o,u)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,o){this._transitionEngine.insertNode(e,t,n,o)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,o){if(n.charAt(0)=="@"){let[a,d]=su(n),u=o;this._timelineEngine.command(a,t,d,u)}else this._transitionEngine.trigger(e,t,n,o)}listen(e,t,n,o,a){if(n.charAt(0)=="@"){let[d,u]=su(n);return this._timelineEngine.listen(d,t,u,a)}return this._transitionEngine.listen(e,t,n,o,a)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function Ax(i,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=_u(e[0]),e.length>1&&(n=_u(e[e.length-1]))):e instanceof Map&&(t=_u(e)),t||n?new Mx(i,t,n):null}var Mx=(()=>{class i{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(t,n,o){this._element=t,this._startStyles=n,this._endStyles=o;let a=i.initialStylesByElement.get(t);a||i.initialStylesByElement.set(t,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&Sn(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Sn(this._element,this._initialStyles),this._endStyles&&(Sn(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(hi(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(hi(this._element,this._endStyles),this._endStyles=null),Sn(this._element,this._initialStyles),this._state=3)}}return i})();function _u(i){let e=null;return i.forEach((t,n)=>{Tx(n)&&(e=e||new Map,e.set(n,t))}),e}function Tx(i){return i==="display"||i==="position"}var ca=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer=null;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(e,t,n,o){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=o,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer()&&this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return this.domPlayer;this._initialized=!0;let e=this.keyframes,t=this._triggerWebAnimation(this.element,e,this.options);if(!t)return this._onFinish(),null;this.domPlayer=t,this._finalKeyframe=e.length?e[e.length-1]:new Map;let n=()=>this._onFinish();return t.addEventListener("finish",n),this.onDestroy(()=>{t.removeEventListener("finish",n)}),t}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer?.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){let o=this._convertKeyframesToObject(t);try{return e.animate(o,n)}catch{return null}}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){let e=this._buildPlayer();e&&(this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),e.play())}pause(){this.init(),this.domPlayer?.pause()}finish(){this.init(),this.domPlayer&&(this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish())}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer?.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer||this.init(),this.domPlayer&&(this.domPlayer.currentTime=e*this.time)}getPosition(){return this.domPlayer?+(this.domPlayer.currentTime??0)/this.time:this._initialized?1:0}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,o)=>{o!=="offset"&&e.set(o,this._finished?n:Zs(this.element,o))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},da=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return au(e,t)}getParentElement(e){return Js(e)}query(e,t,n){return lu(e,t,n)}computeStyle(e,t,n){return Zs(e,t)}animate(e,t,n,o,a,d=[]){let u=o==0?"both":"forwards",p={duration:n,delay:o,fill:u};a&&(p.easing=a);let g=new Map,C=d.filter(V=>V instanceof ca);Ig(n,o)&&C.forEach(V=>{V.currentSnapshot.forEach((G,z)=>g.set(z,G))});let w=Tg(t).map(V=>new Map(V));w=Fg(e,w,g);let A=Ax(e,w);return new ca(e,w,p,A)}};var ia="@",Jg="@.disabled",ua=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(e,t,n,o){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=o}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,o=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,o)}removeChild(e,t,n,o){if(o){this.delegate.removeChild(e,t,n,o);return}this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,o){this.delegate.setAttribute(e,t,n,o)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,o){this.delegate.setStyle(e,t,n,o)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==ia&&t==Jg?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n,o){return this.delegate.listen(e,t,n,o)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},Mu=class extends ua{factory;constructor(e,t,n,o,a){super(t,n,o,a),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==ia?t.charAt(1)=="."&&t==Jg?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n,o){if(t.charAt(0)==ia){let a=kx(e),d=t.slice(1),u="";return d.charAt(0)!=ia&&([d,u]=Ix(d)),this.engine.listen(this.namespaceId,a,d,u,p=>{let g=p._data||-1;this.factory.scheduleListenerCallback(g,n,p)})}return this.delegate.listen(e,t,n,o)}};function kx(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function Ix(i){let e=i.indexOf("."),t=i.substring(0,e),n=i.slice(e+1);return[t,n]}var ma=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,t.onRemovalComplete=(o,a)=>{a?.removeChild(null,o)}}createRenderer(e,t){let o=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let g=this._rendererCache,C=g.get(o);if(!C){let w=()=>g.delete(o);C=new ua("",o,this.engine,w),g.set(o,C)}return C}let a=t.id,d=t.id+"-"+this._currentId;this._currentId++,this.engine.register(d,e);let u=g=>{Array.isArray(g)?g.forEach(u):this.engine.registerTrigger(a,d,e,g.name,g)};return t.data.animation.forEach(u),new Mu(this,d,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let o=this._animationCallbacksBuffer;o.length==0&&queueMicrotask(()=>{this._zone.run(()=>{o.forEach(a=>{let[d,u]=a;d(u)}),this._animationCallbacksBuffer=[]})}),o.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(e){this.engine.flush(),this.delegate.componentReplaced?.(e)}};var Px=(()=>{class i extends xo{constructor(t,n,o){super(t,n,o)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||i)(Ae(lt),Ae(Oi),Ae(Ui))};static \u0275prov=j({token:i,factory:i.\u0275fac})}return i})();function Rx(){return new oa}function Nx(){return new ma(F(br),F(xo),F(Pn))}var Qg=[{provide:Ui,useFactory:Rx},{provide:xo,useClass:Px},{provide:ys,useFactory:Nx}],YY=[{provide:Oi,useClass:Tu},{provide:Td,useValue:"NoopAnimations"},...Qg],Vx=[{provide:Oi,useFactory:()=>new da},{provide:Td,useFactory:()=>"BrowserAnimations"},...Qg];function Yg(){return Ym("NgEagerAnimations"),[...Vx]}var ah=(()=>{class i{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,n){this._renderer=t,this._elementRef=n}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(n){return new(n||i)(Ue(Ii),Ue(ki))};static \u0275dir=Ye({type:i})}return i})(),Gi=(()=>{class i extends ah{static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,features:[ft]})}return i})(),_i=new He(""),Bx={provide:_i,useExisting:It(()=>it),multi:!0},it=(()=>{class i extends Gi{writeValue(t){this.setProperty("checked",t)}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,o){n&1&&x("change",function(d){return o.onChange(d.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[bt([Bx]),ft]})}return i})(),Lx={provide:_i,useExisting:It(()=>xe),multi:!0};function Ox(){let i=un()?un().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var Ux=new He(""),xe=(()=>{class i extends ah{_compositionMode;_composing=!1;constructor(t,n,o){super(t,n),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!Ox())}writeValue(t){let n=t??"";this.setProperty("value",n)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(n){return new(n||i)(Ue(Ii),Ue(ki),Ue(Ux,8))};static \u0275dir=Ye({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,o){n&1&&x("input",function(d){return o._handleInput(d.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(d){return o._compositionEnd(d.target.value)})},standalone:!1,features:[bt([Lx]),ft]})}return i})();function Gx(i){return i==null||Pu(i)===0}function Pu(i){return i==null?null:Array.isArray(i)||typeof i=="string"?i.length:i instanceof Set?i.size:null}var $i=new He(""),lh=new He("");function $x(i){return e=>{if(e.value==null||i==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t<i?{min:{min:i,actual:e.value}}:null}}function Hx(i){return e=>{if(e.value==null||i==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t>i?{max:{max:i,actual:e.value}}:null}}function qx(i){return Gx(i.value)?{required:!0}:null}function Wx(i){return e=>{let t=e.value?.length??Pu(e.value);return t===null||t===0?null:t<i?{minlength:{requiredLength:i,actualLength:t}}:null}}function zx(i){return e=>{let t=e.value?.length??Pu(e.value);return t!==null&&t>i?{maxlength:{requiredLength:i,actualLength:t}}:null}}function Xg(i){return null}function ch(i){return i!=null}function dh(i){return cr(i)?xn(i):i}function uh(i){let e={};return i.forEach(t=>{e=t!=null?E(E({},e),t):e}),Object.keys(e).length===0?null:e}function mh(i,e){return e.map(t=>t(i))}function Kx(i){return!i.validate}function ph(i){return i.map(e=>Kx(e)?e:t=>e.validate(t))}function jx(i){if(!i)return null;let e=i.filter(ch);return e.length==0?null:function(t){return uh(mh(t,e))}}function Ru(i){return i!=null?jx(ph(i)):null}function Jx(i){if(!i)return null;let e=i.filter(ch);return e.length==0?null:function(t){let n=mh(t,e).map(dh);return Gm(n).pipe(tt(uh))}}function Nu(i){return i!=null?Jx(ph(i)):null}function Zg(i,e){return i===null?[e]:Array.isArray(i)?[...i,e]:[i,e]}function Qx(i){return i._rawValidators}function Yx(i){return i._rawAsyncValidators}function Iu(i){return i?Array.isArray(i)?i:[i]:[]}function ga(i,e){return Array.isArray(i)?i.includes(e):i===e}function eh(i,e){let t=Iu(e);return Iu(i).forEach(o=>{ga(t,o)||t.push(o)}),t}function th(i,e){return Iu(e).filter(t=>!ga(i,t))}var ha=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Ru(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Nu(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},yo=class extends ha{name;get formDirective(){return null}get path(){return null}},So=class extends ha{_parent=null;name=null;valueAccessor=null},fa=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}};var ve=(()=>{class i extends fa{constructor(t){super(t)}static \u0275fac=function(n){return new(n||i)(Ue(So,2))};static \u0275dir=Ye({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,o){n&2&&N("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[ft]})}return i})(),gh=(()=>{class i extends fa{constructor(t){super(t)}static \u0275fac=function(n){return new(n||i)(Ue(yo,10))};static \u0275dir=Ye({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["","formArray",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,o){n&2&&N("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[ft]})}return i})();var Fr="VALID",pa="INVALID",Co="PENDING",Pr="DISABLED",fi=class{},_a=class extends fi{value;source;constructor(e,t){super(),this.value=e,this.source=t}},Nr=class extends fi{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},Vr=class extends fi{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},bo=class extends fi{status;source;constructor(e,t){super(),this.status=e,this.source=t}},Fu=class extends fi{source;constructor(e){super(),this.source=e}},va=class extends fi{source;constructor(e){super(),this.source=e}};function hh(i){return(ba(i)?i.validators:i)||null}function Xx(i){return Array.isArray(i)?Ru(i):i||null}function fh(i,e){return(ba(e)?e.asyncValidators:i)||null}function Zx(i){return Array.isArray(i)?Nu(i):i||null}function ba(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function eC(i,e,t){let n=i.controls;if(!(e?Object.keys(n):n).length)throw new me(1e3,"");if(!n[t])throw new me(1001,"")}function tC(i,e,t){i._forEachChild((n,o)=>{if(t[o]===void 0)throw new me(1002,"")})}var xa=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Ft(this.statusReactive)}set status(e){Ft(()=>this.statusReactive.set(e))}_status=R(()=>this.statusReactive());statusReactive=f(void 0);get valid(){return this.status===Fr}get invalid(){return this.status===pa}get pending(){return this.status==Co}get disabled(){return this.status===Pr}get enabled(){return this.status!==Pr}errors;get pristine(){return Ft(this.pristineReactive)}set pristine(e){Ft(()=>this.pristineReactive.set(e))}_pristine=R(()=>this.pristineReactive());pristineReactive=f(!0);get dirty(){return!this.pristine}get touched(){return Ft(this.touchedReactive)}set touched(e){Ft(()=>this.touchedReactive.set(e))}_touched=R(()=>this.touchedReactive());touchedReactive=f(!1);get untouched(){return!this.touched}_events=new an;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(eh(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(eh(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(th(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(th(e,this._rawAsyncValidators))}hasValidator(e){return ga(this._rawValidators,e)}hasAsyncValidator(e){return ga(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(P(E({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new Vr(!0,n))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new Vr(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(P(E({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new Nr(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new Nr(!0,n))}markAsPending(e={}){this.status=Co;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new bo(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(P(E({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Pr,this.errors=null,this._forEachChild(o=>{o.disable(P(E({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new _a(this.value,n)),this._events.next(new bo(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(P(E({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Fr,this._forEachChild(n=>{n.enable(P(E({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(P(E({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Fr||this.status===Co)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new _a(this.value,t)),this._events.next(new bo(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(P(E({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Pr:Fr}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Co,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let n=dh(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,o)=>n&&n._find(o),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new bo(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new qe,this.statusChanges=new qe}_calculateStatus(){return this._allControlsDisabled()?Pr:this.errors?pa:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Co)?Co:this._anyControlsHaveStatus(pa)?pa:Fr}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),o=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),o&&this._events.next(new Nr(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Vr(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ba(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Xx(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Zx(this._rawAsyncValidators)}},Ca=class extends xa{constructor(e,t,n){super(hh(t),fh(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){tC(this,!0,e),Object.keys(e).forEach(n=>{eC(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(n=>{let o=this.controls[n];o&&o.patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,o)=>{n.reset(e?e[o]:null,P(E({},t),{onlySelf:!0}))}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new va(this))}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,n)=>n._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,n]of Object.entries(this.controls))if(this.contains(t)&&e(n))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,n,o)=>((n.enabled||this.disabled)&&(t[o]=n.value),t))}_reduceChildren(e,t){let n=e;return this._forEachChild((o,a)=>{n=t(n,o,a)}),n}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var ya=new He("",{factory:()=>Sa}),Sa="always";function nC(i,e){return[...e.path,i]}function _h(i,e,t=Sa){vh(i,e),e.valueAccessor.writeValue(i.value),(i.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(i.disabled),oC(i,e),sC(i,e),rC(i,e),iC(i,e)}function nh(i,e){i.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function iC(i,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(t),e._registerOnDestroy(()=>{i._unregisterOnDisabledChange(t)})}}function vh(i,e){let t=Qx(i);e.validator!==null?i.setValidators(Zg(t,e.validator)):typeof t=="function"&&i.setValidators([t]);let n=Yx(i);e.asyncValidator!==null?i.setAsyncValidators(Zg(n,e.asyncValidator)):typeof n=="function"&&i.setAsyncValidators([n]);let o=()=>i.updateValueAndValidity();nh(e._rawValidators,o),nh(e._rawAsyncValidators,o)}function oC(i,e){e.valueAccessor.registerOnChange(t=>{i._pendingValue=t,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&xh(i,e)})}function rC(i,e){e.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&xh(i,e),i.updateOn!=="submit"&&i.markAsTouched()})}function xh(i,e){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function sC(i,e){let t=(n,o)=>{e.valueAccessor.writeValue(n),o&&e.viewToModelUpdate(n)};i.registerOnChange(t),e._registerOnDestroy(()=>{i._unregisterOnChange(t)})}function aC(i,e){i==null,vh(i,e)}function lC(i,e){if(!i.hasOwnProperty("model"))return!1;let t=i.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function cC(i){return Object.getPrototypeOf(i.constructor)===Gi}function dC(i,e){i._syncPendingControls(),e.forEach(t=>{let n=t.control;n.updateOn==="submit"&&n._pendingChange&&(t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function uC(i,e){if(!e)return null;Array.isArray(e);let t,n,o;return e.forEach(a=>{a.constructor===xe?t=a:cC(a)?n=a:o=a}),o||n||t||null}var mC={provide:yo,useExisting:It(()=>Vu)},Rr=Promise.resolve(),Vu=(()=>{class i extends yo{callSetDisabledState;get submitted(){return Ft(this.submittedReactive)}_submitted=R(()=>this.submittedReactive());submittedReactive=f(!1);_directives=new Set;form;ngSubmit=new qe;options;constructor(t,n,o){super(),this.callSetDisabledState=o,this.form=new Ca({},Ru(t),Nu(n))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Rr.then(()=>{let n=this._findContainer(t.path);t.control=n.registerControl(t.name,t.control),_h(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Rr.then(()=>{let n=this._findContainer(t.path);n&&n.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Rr.then(()=>{let n=this._findContainer(t.path),o=new Ca({});aC(o,t),n.registerControl(t.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Rr.then(()=>{let n=this._findContainer(t.path);n&&n.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,n){Rr.then(()=>{this.form.get(t.path).setValue(n)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),dC(this.form,this._directives),this.ngSubmit.emit(t),this.form._events.next(new Fu(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static \u0275fac=function(n){return new(n||i)(Ue($i,10),Ue(lh,10),Ue(ya,8))};static \u0275dir=Ye({type:i,selectors:[["form",3,"ngNoForm","",3,"formGroup","",3,"formArray",""],["ng-form"],["","ngForm",""]],hostBindings:function(n,o){n&1&&x("submit",function(d){return o.onSubmit(d)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[bt([mC]),ft]})}return i})();function ih(i,e){let t=i.indexOf(e);t>-1&&i.splice(t,1)}function oh(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var pC=class extends xa{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,n){super(hh(t),fh(n,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ba(t)&&(t.nonNullable||t.initialValueIsDefault)&&(oh(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),t.overwriteDefaultValue&&(this.defaultValue=this.value),this._pendingChange=!1,t?.emitEvent!==!1&&this._events.next(new va(this))}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){ih(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){ih(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){oh(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var gC={provide:So,useExisting:It(()=>he)},rh=Promise.resolve(),he=(()=>{class i extends So{_changeDetectorRef;callSetDisabledState;control=new pC;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new qe;constructor(t,n,o,a,d,u){super(),this._changeDetectorRef=d,this.callSetDisabledState=u,this._parent=t,this._setValidators(n),this._setAsyncValidators(o),this.valueAccessor=uC(this,a)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),lC(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){_h(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){rh.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let n=t.isDisabled.currentValue,o=n!==0&&Rd(n);rh.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?nC(t,this._parent):[t]}static \u0275fac=function(n){return new(n||i)(Ue(yo,9),Ue($i,10),Ue(lh,10),Ue(_i,10),Ue(dn,8),Ue(ya,8))};static \u0275dir=Ye({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[bt([gC]),ft,li]})}return i})();var Ch=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275dir=Ye({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return i})(),hC={provide:_i,useExisting:It(()=>Rt),multi:!0},Rt=(()=>{class i extends Gi{writeValue(t){let n=t??"";this.setProperty("value",n)}registerOnChange(t){this.onChange=n=>{t(n==""?null:parseFloat(n))}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(n,o){n&1&&x("input",function(d){return o.onChange(d.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[bt([hC]),ft]})}return i})(),fC={provide:_i,useExisting:It(()=>Br),multi:!0};var _C=(()=>{class i{_accessors=[];add(t,n){this._accessors.push([t,n])}remove(t){for(let n=this._accessors.length-1;n>=0;--n)if(this._accessors[n][1]===t){this._accessors.splice(n,1);return}}select(t){this._accessors.forEach(n=>{this._isSameGroup(n,t)&&n[1]!==t&&n[1].fireUncheck(t.value)})}_isSameGroup(t,n){return t[0].control?t[0]._parent===n._control._parent&&t[1].name===n.name:!1}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Br=(()=>{class i extends Gi{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=F(ya,{optional:!0})??Sa;constructor(t,n,o,a){super(t,n),this._registry=o,this._injector=a}ngOnInit(){this._control=this._injector.get(So),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this.setProperty("checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=()=>{t(this.value),this._registry.select(this)}}setDisabledState(t){(this.setDisabledStateFired||t||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",t),this.setDisabledStateFired=!0}fireUncheck(t){this.writeValue(t)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(n){return new(n||i)(Ue(Ii),Ue(ki),Ue(_C),Ue(ar))};static \u0275dir=Ye({type:i,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(n,o){n&1&&x("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[bt([fC]),ft]})}return i})(),vC={provide:_i,useExisting:It(()=>Hi),multi:!0},Hi=(()=>{class i extends Gi{writeValue(t){this.setProperty("value",parseFloat(t))}registerOnChange(t){this.onChange=n=>{t(n==""?null:parseFloat(n))}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(n,o){n&1&&x("change",function(d){return o.onChange(d.target.value)})("input",function(d){return o.onChange(d.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[bt([vC]),ft]})}return i})();var xC={provide:_i,useExisting:It(()=>Ge),multi:!0};function bh(i,e){return i==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${i}: ${e}`.slice(0,50))}function CC(i){return i.split(":")[0]}var Ge=(()=>{class i extends Gi{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;appRefInjector=F(np).injector;destroyRef=F(lr);cdr=F(dn);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,Id({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(t){this.cdr.markForCheck(),this.value=t;let n=this._getOptionId(t),o=bh(n,t);this.setProperty("value",o)}registerOnChange(t){this.onChange=n=>{this.value=this._getOptionValue(n),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n),t))return n;return null}_getOptionValue(t){let n=CC(t);return this._optionMap.has(n)?this._optionMap.get(n):t}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,o){n&1&&x("change",function(d){return o.onChange(d.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[bt([xC]),ft]})}return i})(),Re=(()=>{class i{_element;_renderer;_select;id;constructor(t,n,o){this._element=t,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(bh(this.id,t)),this._select._writeValueAfterRender())}set value(t){this._setElementValue(t),this._select&&this._select._writeValueAfterRender()}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(n){return new(n||i)(Ue(ki),Ue(Ii),Ue(Ge,9))};static \u0275dir=Ye({type:i,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return i})(),bC={provide:_i,useExisting:It(()=>yh),multi:!0};function sh(i,e){return i==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${i}: ${e}`.slice(0,50))}function yC(i){return i.split(":")[0]}var yh=(()=>{class i extends Gi{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let n;if(Array.isArray(t)){let o=t.map(a=>this._getOptionId(a));n=(a,d)=>{a._setSelected(o.indexOf(d.toString())>-1)}}else n=(o,a)=>{o._setSelected(!1)};this._optionMap.forEach(n)}registerOnChange(t){this.onChange=n=>{let o=[],a=n.selectedOptions;if(a!==void 0){let d=a;for(let u=0;u<d.length;u++){let p=d[u],g=this._getOptionValue(p.value);o.push(g)}}else{let d=n.options;for(let u=0;u<d.length;u++){let p=d[u];if(p.selected){let g=this._getOptionValue(p.value);o.push(g)}}}this.value=o,t(o)}}_registerOption(t){let n=(this._idCounter++).toString();return this._optionMap.set(n,t),n}_getOptionId(t){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n)._value,t))return n;return null}_getOptionValue(t){let n=yC(t);return this._optionMap.has(n)?this._optionMap.get(n)._value:t}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,o){n&1&&x("change",function(d){return o.onChange(d.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[bt([bC]),ft]})}return i})(),Ne=(()=>{class i{_element;_renderer;_select;id;_value;constructor(t,n,o){this._element=t,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(sh(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(sh(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(n){return new(n||i)(Ue(ki),Ue(Ii),Ue(yh,9))};static \u0275dir=Ye({type:i,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return i})();function Sh(i){return typeof i=="number"?i:parseInt(i,10)}function wh(i){return typeof i=="number"?i:parseFloat(i)}var Lr=(()=>{class i{_validator=Xg;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let n=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(n),this._validator=this._enabled?this.createValidator(n):Xg,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(n){return new(n||i)};static \u0275dir=Ye({type:i,features:[li]})}return i})(),SC={provide:$i,useExisting:It(()=>tn),multi:!0},tn=(()=>{class i extends Lr{max;inputName="max";normalizeInput=t=>wh(t);createValidator=t=>Hx(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&_t("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[bt([SC]),ft]})}return i})(),wC={provide:$i,useExisting:It(()=>Nt),multi:!0},Nt=(()=>{class i extends Lr{min;inputName="min";normalizeInput=t=>wh(t);createValidator=t=>$x(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&_t("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[bt([wC]),ft]})}return i})(),EC={provide:$i,useExisting:It(()=>Bu),multi:!0};var Bu=(()=>{class i extends Lr{required;inputName="required";normalizeInput=Rd;createValidator=t=>qx;enabled(t){return t}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(n,o){n&2&&_t("required",o._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[bt([EC]),ft]})}return i})();var DC={provide:$i,useExisting:It(()=>Lu),multi:!0},Lu=(()=>{class i extends Lr{minlength;inputName="minlength";normalizeInput=t=>Sh(t);createValidator=t=>Wx(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["","minlength","","formControlName",""],["","minlength","","formControl",""],["","minlength","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&_t("minlength",o._enabled?o.minlength:null)},inputs:{minlength:"minlength"},standalone:!1,features:[bt([DC]),ft]})}return i})(),AC={provide:$i,useExisting:It(()=>qi),multi:!0},qi=(()=>{class i extends Lr{maxlength;inputName="maxlength";normalizeInput=t=>Sh(t);createValidator=t=>zx(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275dir=Ye({type:i,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&_t("maxlength",o._enabled?o.maxlength:null)},inputs:{maxlength:"maxlength"},standalone:!1,features:[bt([AC]),ft]})}return i})();var MC=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Yn({type:i});static \u0275inj=Qn({})}return i})();var ae=(()=>{class i{static withConfig(t){return{ngModule:i,providers:[{provide:ya,useValue:t.callSetDisabledState??Sa}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Yn({type:i});static \u0275inj=Qn({imports:[MC]})}return i})();var ke="primary",Qr=Symbol("RouteTitle"),Hu=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function ji(i){return new Hu(i)}function Ph(i,e,t){let n=t.path.split("/");if(n.length>i.length||t.pathMatch==="full"&&(e.hasChildren()||n.length<i.length))return null;let o={};for(let a=0;a<n.length;a++){let d=n[a],u=i[a];if(d[0]===":")o[d.substring(1)]=u;else if(d!==u.path)return null}return{consumed:i.slice(0,n.length),posParams:o}}function ka(i){return new Promise((e,t)=>{i.pipe(si()).subscribe({next:n=>e(n),error:n=>t(n)})})}function TC(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;++t)if(!On(i[t],e[t]))return!1;return!0}function On(i,e){let t=i?qu(i):void 0,n=e?qu(e):void 0;if(!t||!n||t.length!=n.length)return!1;let o;for(let a=0;a<t.length;a++)if(o=t[a],!Rh(i[o],e[o]))return!1;return!0}function qu(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function Rh(i,e){if(Array.isArray(i)&&Array.isArray(e)){if(i.length!==e.length)return!1;let t=[...i].sort(),n=[...e].sort();return t.every((o,a)=>n[a]===o)}else return i===e}function Nh(i){return i.length>0?i[i.length-1]:null}function Qi(i){return yd(i)?i:cr(i)?xn(Promise.resolve(i)):Oe(i)}function Vh(i){return yd(i)?ka(i):Promise.resolve(i)}var kC={exact:Lh,subset:Oh},Bh={exact:IC,subset:FC,ignored:()=>!0};function Eh(i,e,t){return kC[t.paths](i.root,e.root,t.matrixParams)&&Bh[t.queryParams](i.queryParams,e.queryParams)&&!(t.fragment==="exact"&&i.fragment!==e.fragment)}function IC(i,e){return On(i,e)}function Lh(i,e,t){if(!zi(i.segments,e.segments)||!Da(i.segments,e.segments,t)||i.numberOfChildren!==e.numberOfChildren)return!1;for(let n in e.children)if(!i.children[n]||!Lh(i.children[n],e.children[n],t))return!1;return!0}function FC(i,e){return Object.keys(e).length<=Object.keys(i).length&&Object.keys(e).every(t=>Rh(i[t],e[t]))}function Oh(i,e,t){return Uh(i,e,e.segments,t)}function Uh(i,e,t,n){if(i.segments.length>t.length){let o=i.segments.slice(0,t.length);return!(!zi(o,t)||e.hasChildren()||!Da(o,t,n))}else if(i.segments.length===t.length){if(!zi(i.segments,t)||!Da(i.segments,t,n))return!1;for(let o in e.children)if(!i.children[o]||!Oh(i.children[o],e.children[o],n))return!1;return!0}else{let o=t.slice(0,i.segments.length),a=t.slice(i.segments.length);return!zi(i.segments,o)||!Da(i.segments,o,n)||!i.children[ke]?!1:Uh(i.children[ke],e,a,n)}}function Da(i,e,t){return e.every((n,o)=>Bh[t](i[o].parameters,n.parameters))}var Dn=class{root;queryParams;fragment;_queryParamMap;constructor(e=new ze([],{}),t={},n=null){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap??=ji(this.queryParams),this._queryParamMap}toString(){return NC.serialize(this)}},ze=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Aa(this)}},vi=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=ji(this.parameters),this._parameterMap}toString(){return $h(this)}};function PC(i,e){return zi(i,e)&&i.every((t,n)=>On(t.parameters,e[n].parameters))}function zi(i,e){return i.length!==e.length?!1:i.every((t,n)=>t.path===e[n].path)}function RC(i,e){let t=[];return Object.entries(i.children).forEach(([n,o])=>{n===ke&&(t=t.concat(e(o,n)))}),Object.entries(i.children).forEach(([n,o])=>{n!==ke&&(t=t.concat(e(o,n)))}),t}var Qa=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>new Ji,providedIn:"root"})}return i})(),Ji=class{parse(e){let t=new zu(e);return new Dn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Or(e.root,!0)}`,n=LC(e.queryParams),o=typeof e.fragment=="string"?`#${VC(e.fragment)}`:"";return`${t}${n}${o}`}},NC=new Ji;function Aa(i){return i.segments.map(e=>$h(e)).join("/")}function Or(i,e){if(!i.hasChildren())return Aa(i);if(e){let t=i.children[ke]?Or(i.children[ke],!1):"",n=[];return Object.entries(i.children).forEach(([o,a])=>{o!==ke&&n.push(`${o}:${Or(a,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}else{let t=RC(i,(n,o)=>o===ke?[Or(i.children[ke],!1)]:[`${o}:${Or(n,!1)}`]);return Object.keys(i.children).length===1&&i.children[ke]!=null?`${Aa(i)}/${t[0]}`:`${Aa(i)}/(${t.join("//")})`}}function Gh(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function wa(i){return Gh(i).replace(/%3B/gi,";")}function VC(i){return encodeURI(i)}function Wu(i){return Gh(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ma(i){return decodeURIComponent(i)}function Dh(i){return Ma(i.replace(/\+/g,"%20"))}function $h(i){return`${Wu(i.path)}${BC(i.parameters)}`}function BC(i){return Object.entries(i).map(([e,t])=>`;${Wu(e)}=${Wu(t)}`).join("")}function LC(i){let e=Object.entries(i).map(([t,n])=>Array.isArray(n)?n.map(o=>`${wa(t)}=${wa(o)}`).join("&"):`${wa(t)}=${wa(n)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var OC=/^[^\/()?;#]+/;function Ou(i){let e=i.match(OC);return e?e[0]:""}var UC=/^[^\/()?;=#]+/;function GC(i){let e=i.match(UC);return e?e[0]:""}var $C=/^[^=?&#]+/;function HC(i){let e=i.match($C);return e?e[0]:""}var qC=/^[^&#]+/;function WC(i){let e=i.match(qC);return e?e[0]:""}var zu=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new ze([],{}):new ze([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[ke]=new ze(e,t)),n}parseSegment(){let e=Ou(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new me(4009,!1);return this.capture(e),new vi(Ma(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=GC(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let o=Ou(this.remaining);o&&(n=o,this.capture(n))}e[Ma(t)]=Ma(n)}parseQueryParam(e){let t=HC(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let d=WC(this.remaining);d&&(n=d,this.capture(n))}let o=Dh(t),a=Dh(n);if(e.hasOwnProperty(o)){let d=e[o];Array.isArray(d)||(d=[d],e[o]=d),d.push(a)}else e[o]=a}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=Ou(this.remaining),o=this.remaining[n.length];if(o!=="/"&&o!==")"&&o!==";")throw new me(4010,!1);let a;n.indexOf(":")>-1?(a=n.slice(0,n.indexOf(":")),this.capture(a),this.capture(":")):e&&(a=ke);let d=this.parseChildren();t[a??ke]=Object.keys(d).length===1&&d[ke]?d[ke]:new ze([],d),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new me(4011,!1)}};function Hh(i){return i.segments.length>0?new ze([],{[ke]:i}):i}function qh(i){let e={};for(let[n,o]of Object.entries(i.children)){let a=qh(o);if(n===ke&&a.segments.length===0&&a.hasChildren())for(let[d,u]of Object.entries(a.children))e[d]=u;else(a.segments.length>0||a.hasChildren())&&(e[n]=a)}let t=new ze(i.segments,e);return zC(t)}function zC(i){if(i.numberOfChildren===1&&i.children[ke]){let e=i.children[ke];return new ze(i.segments.concat(e.segments),e.children)}return i}function Hr(i){return i instanceof Dn}function Wh(i,e,t=null,n=null,o=new Ji){let a=zh(i);return Kh(a,e,t,n,o)}function zh(i){let e;function t(a){let d={};for(let p of a.children){let g=t(p);d[p.outlet]=g}let u=new ze(a.url,d);return a===i&&(e=u),u}let n=t(i.root),o=Hh(n);return e??o}function Kh(i,e,t,n,o){let a=i;for(;a.parent;)a=a.parent;if(e.length===0)return Uu(a,a,a,t,n,o);let d=KC(e);if(d.toRoot())return Uu(a,a,new ze([],{}),t,n,o);let u=jC(d,a,i),p=u.processChildren?Gr(u.segmentGroup,u.index,d.commands):Jh(u.segmentGroup,u.index,d.commands);return Uu(a,u.segmentGroup,p,t,n,o)}function Ia(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function qr(i){return typeof i=="object"&&i!=null&&i.outlets}function Ah(i,e,t){i||="\u0275";let n=new Dn;return n.queryParams={[i]:e},t.parse(t.serialize(n)).queryParams[i]}function Uu(i,e,t,n,o,a){let d={};for(let[g,C]of Object.entries(n??{}))d[g]=Array.isArray(C)?C.map(w=>Ah(g,w,a)):Ah(g,C,a);let u;i===e?u=t:u=jh(i,e,t);let p=Hh(qh(u));return new Dn(p,d,o)}function jh(i,e,t){let n={};return Object.entries(i.children).forEach(([o,a])=>{a===e?n[o]=t:n[o]=jh(a,e,t)}),new ze(i.segments,n)}var Fa=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&Ia(n[0]))throw new me(4003,!1);let o=n.find(qr);if(o&&o!==Nh(n))throw new me(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function KC(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new Fa(!0,0,i);let e=0,t=!1,n=i.reduce((o,a,d)=>{if(typeof a=="object"&&a!=null){if(a.outlets){let u={};return Object.entries(a.outlets).forEach(([p,g])=>{u[p]=typeof g=="string"?g.split("/"):g}),[...o,{outlets:u}]}if(a.segmentPath)return[...o,a.segmentPath]}return typeof a!="string"?[...o,a]:d===0?(a.split("/").forEach((u,p)=>{p==0&&u==="."||(p==0&&u===""?t=!0:u===".."?e++:u!=""&&o.push(u))}),o):[...o,a]},[]);return new Fa(t,e,n)}var Eo=class{segmentGroup;processChildren;index;constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}};function jC(i,e,t){if(i.isAbsolute)return new Eo(e,!0,0);if(!t)return new Eo(e,!1,NaN);if(t.parent===null)return new Eo(t,!0,0);let n=Ia(i.commands[0])?0:1,o=t.segments.length-1+n;return JC(t,o,i.numberOfDoubleDots)}function JC(i,e,t){let n=i,o=e,a=t;for(;a>o;){if(a-=o,n=n.parent,!n)throw new me(4005,!1);o=n.segments.length}return new Eo(n,!1,o-a)}function QC(i){return qr(i[0])?i[0].outlets:{[ke]:i}}function Jh(i,e,t){if(i??=new ze([],{}),i.segments.length===0&&i.hasChildren())return Gr(i,e,t);let n=YC(i,e,t),o=t.slice(n.commandIndex);if(n.match&&n.pathIndex<i.segments.length){let a=new ze(i.segments.slice(0,n.pathIndex),{});return a.children[ke]=new ze(i.segments.slice(n.pathIndex),i.children),Gr(a,0,o)}else return n.match&&o.length===0?new ze(i.segments,{}):n.match&&!i.hasChildren()?Ku(i,e,t):n.match?Gr(i,0,o):Ku(i,e,t)}function Gr(i,e,t){if(t.length===0)return new ze(i.segments,{});{let n=QC(t),o={};if(Object.keys(n).some(a=>a!==ke)&&i.children[ke]&&i.numberOfChildren===1&&i.children[ke].segments.length===0){let a=Gr(i.children[ke],e,t);return new ze(i.segments,a.children)}return Object.entries(n).forEach(([a,d])=>{typeof d=="string"&&(d=[d]),d!==null&&(o[a]=Jh(i.children[a],e,d))}),Object.entries(i.children).forEach(([a,d])=>{n[a]===void 0&&(o[a]=d)}),new ze(i.segments,o)}}function YC(i,e,t){let n=0,o=e,a={match:!1,pathIndex:0,commandIndex:0};for(;o<i.segments.length;){if(n>=t.length)return a;let d=i.segments[o],u=t[n];if(qr(u))break;let p=`${u}`,g=n<t.length-1?t[n+1]:null;if(o>0&&p===void 0)break;if(p&&g&&typeof g=="object"&&g.outlets===void 0){if(!Th(p,g,d))return a;n+=2}else{if(!Th(p,{},d))return a;n++}o++}return{match:!0,pathIndex:o,commandIndex:n}}function Ku(i,e,t){let n=i.segments.slice(0,e),o=0;for(;o<t.length;){let a=t[o];if(qr(a)){let p=XC(a.outlets);return new ze(n,p)}if(o===0&&Ia(t[0])){let p=i.segments[e];n.push(new vi(p.path,Mh(t[0]))),o++;continue}let d=qr(a)?a.outlets[ke]:`${a}`,u=o<t.length-1?t[o+1]:null;d&&u&&Ia(u)?(n.push(new vi(d,Mh(u))),o+=2):(n.push(new vi(d,{})),o++)}return new ze(n,{})}function XC(i){let e={};return Object.entries(i).forEach(([t,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(e[t]=Ku(new ze([],{}),0,n))}),e}function Mh(i){let e={};return Object.entries(i).forEach(([t,n])=>e[t]=`${n}`),e}function Th(i,e,t){return i==t.path&&On(e,t.parameters)}var Ta="imperative",xt=(function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i})(xt||{}),on=class{id;url;constructor(e,t){this.id=e,this.url=t}},Ao=class extends on{type=xt.NavigationStart;navigationTrigger;restoredState;constructor(e,t,n="imperative",o=null){super(e,t),this.navigationTrigger=n,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},xi=class extends on{urlAfterRedirects;type=xt.NavigationEnd;constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Vt=(function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i[i.Aborted=4]="Aborted",i})(Vt||{}),Pa=(function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i})(Pa||{}),Un=class extends on{reason;code;type=xt.NavigationCancel;constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Ci=class extends on{reason;code;type=xt.NavigationSkipped;constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o}},Mo=class extends on{error;target;type=xt.NavigationError;constructor(e,t,n,o){super(e,t),this.error=n,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Wr=class extends on{urlAfterRedirects;state;type=xt.RoutesRecognized;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ra=class extends on{urlAfterRedirects;state;type=xt.GuardsCheckStart;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Na=class extends on{urlAfterRedirects;state;shouldActivate;type=xt.GuardsCheckEnd;constructor(e,t,n,o,a){super(e,t),this.urlAfterRedirects=n,this.state=o,this.shouldActivate=a}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Va=class extends on{urlAfterRedirects;state;type=xt.ResolveStart;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ba=class extends on{urlAfterRedirects;state;type=xt.ResolveEnd;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},La=class{route;type=xt.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Oa=class{route;type=xt.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Ua=class{snapshot;type=xt.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ga=class{snapshot;type=xt.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},$a=class{snapshot;type=xt.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ha=class{snapshot;type=xt.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var zr=class{},To=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function ZC(i){return!(i instanceof zr)&&!(i instanceof To)}function eb(i,e){return i.providers&&!i._injector&&(i._injector=ep(i.providers,e,`Route: ${i.path}`)),i._injector??e}function En(i){return i.outlet||ke}function tb(i,e){let t=i.filter(n=>En(n)===e);return t.push(...i.filter(n=>En(n)!==e)),t}function Po(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let e=i.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var qa=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Po(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new Yr(this.rootInjector)}},Yr=(()=>{class i{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,n){let o=this.getOrCreateContext(t);o.outlet=n,this.contexts.set(t,o)}onChildOutletDestroyed(t){let n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new qa(this.rootInjector),this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(n){return new(n||i)(Ae(ai))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Wa=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=ju(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){let t=ju(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Ju(e,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return Ju(e,this._root).map(t=>t.value)}};function ju(i,e){if(i===e.value)return e;for(let t of e.children){let n=ju(i,t);if(n)return n}return null}function Ju(i,e){if(i===e.value)return[e];for(let t of e.children){let n=Ju(i,t);if(n.length)return n.unshift(e),n}return[]}var nn=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function wo(i){let e={};return i&&i.children.forEach(t=>e[t.value.outlet]=t),e}var Kr=class extends Wa{snapshot;constructor(e,t){super(e),this.snapshot=t,t0(this,e)}toString(){return this.snapshot.toString()}};function Qh(i){let e=nb(i),t=new ln([new vi("",{})]),n=new ln({}),o=new ln({}),a=new ln({}),d=new ln(""),u=new ko(t,n,a,d,o,ke,i,e.root);return u.snapshot=e.root,new Kr(new nn(u,[]),e)}function nb(i){let e={},t={},n={},a=new Ki([],e,n,"",t,ke,i,null,{});return new jr("",new nn(a,[]))}var ko=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,n,o,a,d,u,p){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=n,this.fragmentSubject=o,this.dataSubject=a,this.outlet=d,this.component=u,this._futureSnapshot=p,this.title=this.dataSubject?.pipe(tt(g=>g[Qr]))??Oe(void 0),this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(tt(e=>ji(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(tt(e=>ji(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function za(i,e,t="emptyOnly"){let n,{routeConfig:o}=i;return e!==null&&(t==="always"||o?.path===""||!e.component&&!e.routeConfig?.loadComponent)?n={params:E(E({},e.params),i.params),data:E(E({},e.data),i.data),resolve:E(E(E(E({},i.data),e.data),o?.data),i._resolvedData)}:n={params:E({},i.params),data:E({},i.data),resolve:E(E({},i.data),i._resolvedData??{})},o&&Xh(o)&&(n.resolve[Qr]=o.title),n}var Ki=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Qr]}constructor(e,t,n,o,a,d,u,p,g){this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=a,this.outlet=d,this.component=u,this.routeConfig=p,this._resolve=g}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=ji(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=ji(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(n=>n.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},jr=class extends Wa{url;constructor(e,t){super(t),this.url=e,t0(this,t)}toString(){return Yh(this._root)}};function t0(i,e){e.value._routerState=i,e.children.forEach(t=>t0(i,t))}function Yh(i){let e=i.children.length>0?` { ${i.children.map(Yh).join(", ")} } `:"";return`${i.value}${e}`}function Gu(i){if(i.snapshot){let e=i.snapshot,t=i._futureSnapshot;i.snapshot=t,On(e.queryParams,t.queryParams)||i.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&i.fragmentSubject.next(t.fragment),On(e.params,t.params)||i.paramsSubject.next(t.params),TC(e.url,t.url)||i.urlSubject.next(t.url),On(e.data,t.data)||i.dataSubject.next(t.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function Qu(i,e){let t=On(i.params,e.params)&&PC(i.url,e.url),n=!i.parent!=!e.parent;return t&&!n&&(!i.parent||Qu(i.parent,e.parent))}function Xh(i){return typeof i.title=="string"||i.title===null}var Zh=new He(""),ef=(()=>{class i{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=ke;activateEvents=new qe;deactivateEvents=new qe;attachEvents=new qe;detachEvents=new qe;routerOutletData=Le();parentContexts=F(Yr);location=F(Ss);changeDetector=F(dn);inputBinder=F(n0,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:n,previousValue:o}=t.name;if(n)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new me(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new me(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new me(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,n){this.activated=t,this._activatedRoute=n,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,n){if(this.isActivated)throw new me(4013,!1);this._activatedRoute=t;let o=this.location,d=t.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,p=new Yu(t,u,o.injector,this.routerOutletData);this.activated=o.createComponent(d,{index:o.length,injector:p,environmentInjector:n}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(n){return new(n||i)};static \u0275dir=Ye({type:i,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[li]})}return i})(),Yu=class{route;childContexts;parent;outletData;constructor(e,t,n,o){this.route=e,this.childContexts=t,this.parent=n,this.outletData=o}get(e,t){return e===ko?this.route:e===Yr?this.childContexts:e===Zh?this.outletData:this.parent.get(e,t)}},n0=new He("");var tf=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=ie({type:i,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(n,o){n&1&&B(0,"router-outlet")},dependencies:[ef],encapsulation:2})}return i})();function i0(i){let e=i.children&&i.children.map(i0),t=e?P(E({},i),{children:e}):E({},i);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ke&&(t.component=tf),t}function ib(i,e,t){let n=Jr(i,e._root,t?t._root:void 0);return new Kr(n,e)}function Jr(i,e,t){if(t&&i.shouldReuseRoute(e.value,t.value.snapshot)){let n=t.value;n._futureSnapshot=e.value;let o=ob(i,e,t);return new nn(n,o)}else{if(i.shouldAttach(e.value)){let a=i.retrieve(e.value);if(a!==null){let d=a.route;return d.value._futureSnapshot=e.value,d.children=e.children.map(u=>Jr(i,u)),d}}let n=rb(e.value),o=e.children.map(a=>Jr(i,a));return new nn(n,o)}}function ob(i,e,t){return e.children.map(n=>{for(let o of t.children)if(i.shouldReuseRoute(n.value,o.value.snapshot))return Jr(i,n,o);return Jr(i,n)})}function rb(i){return new ko(new ln(i.url),new ln(i.params),new ln(i.queryParams),new ln(i.fragment),new ln(i.data),i.outlet,i.component,i)}var Io=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},nf="ngNavigationCancelingError";function Ka(i,e){let{redirectTo:t,navigationBehaviorOptions:n}=Hr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,o=of(!1,Vt.Redirect);return o.url=t,o.navigationBehaviorOptions=n,o}function of(i,e){let t=new Error(`NavigationCancelingError: ${i||""}`);return t[nf]=!0,t.cancellationCode=e,t}function sb(i){return rf(i)&&Hr(i.url)}function rf(i){return!!i&&i[nf]}var ab=(i,e,t,n)=>tt(o=>(new Xu(e,o.targetRouterState,o.currentRouterState,t,n).activate(i),o)),Xu=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,n,o,a){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=o,this.inputBindingEnabled=a}activate(e){let t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Gu(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){let o=wo(t);e.children.forEach(a=>{let d=a.value.outlet;this.deactivateRoutes(a,o[d],n),delete o[d]}),Object.values(o).forEach(a=>{this.deactivateRouteAndItsChildren(a,n)})}deactivateRoutes(e,t,n){let o=e.value,a=t?t.value:null;if(o===a)if(o.component){let d=n.getContext(o.outlet);d&&this.deactivateChildRoutes(e,t,d.children)}else this.deactivateChildRoutes(e,t,n);else a&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,a=wo(e);for(let d of Object.values(a))this.deactivateRouteAndItsChildren(d,o);if(n&&n.outlet){let d=n.outlet.detach(),u=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:d,route:e,contexts:u})}}deactivateRouteAndOutlet(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,a=wo(e);for(let d of Object.values(a))this.deactivateRouteAndItsChildren(d,o);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,t,n){let o=wo(t);e.children.forEach(a=>{this.activateRoutes(a,o[a.value.outlet],n),this.forwardEvent(new Ha(a.value.snapshot))}),e.children.length&&this.forwardEvent(new Ga(e.value.snapshot))}activateRoutes(e,t,n){let o=e.value,a=t?t.value:null;if(Gu(o),o===a)if(o.component){let d=n.getOrCreateContext(o.outlet);this.activateChildRoutes(e,t,d.children)}else this.activateChildRoutes(e,t,n);else if(o.component){let d=n.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let u=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),d.children.onOutletReAttached(u.contexts),d.attachRef=u.componentRef,d.route=u.route.value,d.outlet&&d.outlet.attach(u.componentRef,u.route.value),Gu(u.route.value),this.activateChildRoutes(e,null,d.children)}else d.attachRef=null,d.route=o,d.outlet&&d.outlet.activateWith(o,d.injector),this.activateChildRoutes(e,null,d.children)}else this.activateChildRoutes(e,null,n)}},ja=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Do=class{component;route;constructor(e,t){this.component=e,this.route=t}};function lb(i,e,t){let n=i._root,o=e?e._root:null;return Ur(n,o,t,[n.value])}function cb(i){let e=i.routeConfig?i.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:i,guards:e}}function Ro(i,e){let t=Symbol(),n=e.get(i,t);return n===t?typeof i=="function"&&!Hm(i)?i:e.get(i):n}function Ur(i,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let a=wo(e);return i.children.forEach(d=>{db(d,a[d.value.outlet],t,n.concat([d.value]),o),delete a[d.value.outlet]}),Object.entries(a).forEach(([d,u])=>$r(u,t.getContext(d),o)),o}function db(i,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let a=i.value,d=e?e.value:null,u=t?t.getContext(i.value.outlet):null;if(d&&a.routeConfig===d.routeConfig){let p=ub(d,a,a.routeConfig.runGuardsAndResolvers);p?o.canActivateChecks.push(new ja(n)):(a.data=d.data,a._resolvedData=d._resolvedData),a.component?Ur(i,e,u?u.children:null,n,o):Ur(i,e,t,n,o),p&&u&&u.outlet&&u.outlet.isActivated&&o.canDeactivateChecks.push(new Do(u.outlet.component,d))}else d&&$r(e,u,o),o.canActivateChecks.push(new ja(n)),a.component?Ur(i,null,u?u.children:null,n,o):Ur(i,null,t,n,o);return o}function ub(i,e,t){if(typeof t=="function")return t(i,e);switch(t){case"pathParamsChange":return!zi(i.url,e.url);case"pathParamsOrQueryParamsChange":return!zi(i.url,e.url)||!On(i.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Qu(i,e)||!On(i.queryParams,e.queryParams);case"paramsChange":default:return!Qu(i,e)}}function $r(i,e,t){let n=wo(i),o=i.value;Object.entries(n).forEach(([a,d])=>{o.component?e?$r(d,e.children.getContext(a),t):$r(d,null,t):$r(d,e,t)}),o.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Do(e.outlet.component,o)):t.canDeactivateChecks.push(new Do(null,o)):t.canDeactivateChecks.push(new Do(null,o))}function Xr(i){return typeof i=="function"}function mb(i){return typeof i=="boolean"}function pb(i){return i&&Xr(i.canLoad)}function gb(i){return i&&Xr(i.canActivate)}function hb(i){return i&&Xr(i.canActivateChild)}function fb(i){return i&&Xr(i.canDeactivate)}function _b(i){return i&&Xr(i.canMatch)}function sf(i){return i instanceof Lm||i?.name==="EmptyError"}var Ea=Symbol("INITIAL_VALUE");function Fo(){return Cn(i=>Om(i.map(e=>e.pipe(ao(1),$m(Ea)))).pipe(tt(e=>{for(let t of e)if(t!==!0){if(t===Ea)return Ea;if(t===!1||vb(t))return t}return!0}),Jn(e=>e!==Ea),ao(1)))}function vb(i){return Hr(i)||i instanceof Io}function af(i){return i.aborted?Oe(void 0).pipe(ao(1)):new gs(e=>{let t=()=>{e.next(),e.complete()};return i.addEventListener("abort",t),()=>i.removeEventListener("abort",t)})}function lf(i){return _s(af(i))}function xb(i,e){return ri(t=>{let{targetSnapshot:n,currentSnapshot:o,guards:{canActivateChecks:a,canDeactivateChecks:d}}=t;return d.length===0&&a.length===0?Oe(P(E({},t),{guardsResult:!0})):Cb(d,n,o,i).pipe(ri(u=>u&&mb(u)?bb(n,a,i,e):Oe(u)),tt(u=>P(E({},t),{guardsResult:u})))})}function Cb(i,e,t,n){return xn(i).pipe(ri(o=>Db(o.component,o.route,t,e,n)),si(o=>o!==!0,!0))}function bb(i,e,t,n){return xn(e).pipe(sr(o=>Um(Sb(o.route.parent,n),yb(o.route,n),Eb(i,o.path,t),wb(i,o.route,t))),si(o=>o!==!0,!0))}function yb(i,e){return i!==null&&e&&e(new $a(i)),Oe(!0)}function Sb(i,e){return i!==null&&e&&e(new Ua(i)),Oe(!0)}function wb(i,e,t){let n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||n.length===0)return Oe(!0);let o=n.map(a=>hs(()=>{let d=Po(e)??t,u=Ro(a,d),p=gb(u)?u.canActivate(e,i):Xt(d,()=>u(e,i));return Qi(p).pipe(si())}));return Oe(o).pipe(Fo())}function Eb(i,e,t){let n=e[e.length-1],a=e.slice(0,e.length-1).reverse().map(d=>cb(d)).filter(d=>d!==null).map(d=>hs(()=>{let u=d.guards.map(p=>{let g=Po(d.node)??t,C=Ro(p,g),w=hb(C)?C.canActivateChild(n,i):Xt(g,()=>C(n,i));return Qi(w).pipe(si())});return Oe(u).pipe(Fo())}));return Oe(a).pipe(Fo())}function Db(i,e,t,n,o){let a=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!a||a.length===0)return Oe(!0);let d=a.map(u=>{let p=Po(e)??o,g=Ro(u,p),C=fb(g)?g.canDeactivate(i,e,t,n):Xt(p,()=>g(i,e,t,n));return Qi(C).pipe(si())});return Oe(d).pipe(Fo())}function Ab(i,e,t,n,o){let a=e.canLoad;if(a===void 0||a.length===0)return Oe(!0);let d=a.map(u=>{let p=Ro(u,i),g=pb(p)?p.canLoad(e,t):Xt(i,()=>p(e,t)),C=Qi(g);return o?C.pipe(lf(o)):C});return Oe(d).pipe(Fo(),cf(n))}function cf(i){return Vm(Ot(e=>{if(typeof e!="boolean")throw Ka(i,e)}),tt(e=>e===!0))}function Mb(i,e,t,n,o){let a=e.canMatch;if(!a||a.length===0)return Oe(!0);let d=a.map(u=>{let p=Ro(u,i),g=_b(p)?p.canMatch(e,t):Xt(i,()=>p(e,t)),C=Qi(g);return o?C.pipe(lf(o)):C});return Oe(d).pipe(Fo(),cf(n))}var Wi=class df extends Error{segmentGroup;constructor(e){super(),this.segmentGroup=e||null,Object.setPrototypeOf(this,df.prototype)}},Zu=class uf extends Error{urlTree;constructor(e){super(),this.urlTree=e,Object.setPrototypeOf(this,uf.prototype)}};function Tb(i){throw new me(4e3,!1)}function kb(i){throw of(!1,Vt.GuardRejected)}var Ib=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}async lineralizeSegments(e,t){let n=[],o=t.root;for(;;){if(n=n.concat(o.segments),o.numberOfChildren===0)return n;if(o.numberOfChildren>1||!o.children[ke])throw Tb(`${e.redirectTo}`);o=o.children[ke]}}async applyRedirectCommands(e,t,n,o,a){let d=await Fb(t,o,a);if(d instanceof Dn)throw new Zu(d);let u=this.applyRedirectCreateUrlTree(d,this.urlSerializer.parse(d),e,n);if(d[0]==="/")throw new Zu(u);return u}applyRedirectCreateUrlTree(e,t,n,o){let a=this.createSegmentGroup(e,t.root,n,o);return new Dn(a,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let n={};return Object.entries(e).forEach(([o,a])=>{if(typeof a=="string"&&a[0]===":"){let u=a.substring(1);n[o]=t[u]}else n[o]=a}),n}createSegmentGroup(e,t,n,o){let a=this.createSegments(e,t.segments,n,o),d={};return Object.entries(t.children).forEach(([u,p])=>{d[u]=this.createSegmentGroup(e,p,n,o)}),new ze(a,d)}createSegments(e,t,n,o){return t.map(a=>a.path[0]===":"?this.findPosParam(e,a,o):this.findOrReturn(a,n))}findPosParam(e,t,n){let o=n[t.path.substring(1)];if(!o)throw new me(4001,!1);return o}findOrReturn(e,t){let n=0;for(let o of t){if(o.path===e.path)return t.splice(n),o;n++}return e}};function Fb(i,e,t){if(typeof i=="string")return Promise.resolve(i);let n=i,{queryParams:o,fragment:a,routeConfig:d,url:u,outlet:p,params:g,data:C,title:w}=e;return ka(Qi(Xt(t,()=>n({params:g,data:C,queryParams:o,fragment:a,routeConfig:d,url:u,outlet:p,title:w}))))}var e0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Pb(i,e,t,n,o,a){let d=mf(i,e,t);return d.matched?(n=eb(e,n),Mb(n,e,t,o,a).pipe(tt(u=>u===!0?d:E({},e0)))):Oe(d)}function mf(i,e,t){if(e.path==="**")return Rb(t);if(e.path==="")return e.pathMatch==="full"&&(i.hasChildren()||t.length>0)?E({},e0):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let o=(e.matcher||Ph)(t,i,e);if(!o)return E({},e0);let a={};Object.entries(o.posParams??{}).forEach(([u,p])=>{a[u]=p.path});let d=o.consumed.length>0?E(E({},a),o.consumed[o.consumed.length-1].parameters):a;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:d,positionalParamSegments:o.posParams??{}}}function Rb(i){return{matched:!0,parameters:i.length>0?Nh(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function kh(i,e,t,n){return t.length>0&&Bb(i,t,n)?{segmentGroup:new ze(e,Vb(n,new ze(t,i.children))),slicedSegments:[]}:t.length===0&&Lb(i,t,n)?{segmentGroup:new ze(i.segments,Nb(i,t,n,i.children)),slicedSegments:t}:{segmentGroup:new ze(i.segments,i.children),slicedSegments:t}}function Nb(i,e,t,n){let o={};for(let a of t)if(Ya(i,e,a)&&!n[En(a)]){let d=new ze([],{});o[En(a)]=d}return E(E({},n),o)}function Vb(i,e){let t={};t[ke]=e;for(let n of i)if(n.path===""&&En(n)!==ke){let o=new ze([],{});t[En(n)]=o}return t}function Bb(i,e,t){return t.some(n=>Ya(i,e,n)&&En(n)!==ke)}function Lb(i,e,t){return t.some(n=>Ya(i,e,n))}function Ya(i,e,t){return(i.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function Ob(i,e,t){return e.length===0&&!i.children[t]}var Ub=class{};async function Gb(i,e,t,n,o,a,d="emptyOnly",u){return new Hb(i,e,t,n,o,d,a,u).recognize()}var $b=31,Hb=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;abortSignal;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,n,o,a,d,u,p){this.injector=e,this.configLoader=t,this.rootComponentType=n,this.config=o,this.urlTree=a,this.paramsInheritanceStrategy=d,this.urlSerializer=u,this.abortSignal=p,this.applyRedirects=new Ib(this.urlSerializer,this.urlTree)}noMatchError(e){return new me(4002,`'${e.segmentGroup}'`)}async recognize(){let e=kh(this.urlTree.root,[],[],this.config).segmentGroup,{children:t,rootSnapshot:n}=await this.match(e),o=new nn(n,t),a=new jr("",o),d=Wh(n,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,a.url=this.urlSerializer.serialize(d),{state:a,tree:d}}async match(e){let t=new Ki([],Object.freeze({}),Object.freeze(E({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),ke,this.rootComponentType,null,{});try{return{children:await this.processSegmentGroup(this.injector,this.config,e,ke,t),rootSnapshot:t}}catch(n){if(n instanceof Zu)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof Wi?this.noMatchError(n):n}}async processSegmentGroup(e,t,n,o,a){if(n.segments.length===0&&n.hasChildren())return this.processChildren(e,t,n,a);let d=await this.processSegment(e,t,n,n.segments,o,!0,a);return d instanceof nn?[d]:[]}async processChildren(e,t,n,o){let a=[];for(let p of Object.keys(n.children))p==="primary"?a.unshift(p):a.push(p);let d=[];for(let p of a){let g=n.children[p],C=tb(t,p),w=await this.processSegmentGroup(e,C,g,p,o);d.push(...w)}let u=pf(d);return qb(u),u}async processSegment(e,t,n,o,a,d,u){for(let p of t)try{return await this.processSegmentAgainstRoute(p._injector??e,t,p,n,o,a,d,u)}catch(g){if(g instanceof Wi||sf(g))continue;throw g}if(Ob(n,o,a))return new Ub;throw new Wi(n)}async processSegmentAgainstRoute(e,t,n,o,a,d,u,p){if(En(n)!==d&&(d===ke||!Ya(o,a,n)))throw new Wi(o);if(n.redirectTo===void 0)return this.matchSegmentAgainstRoute(e,o,n,a,d,p);if(this.allowRedirects&&u)return this.expandSegmentAgainstRouteUsingRedirect(e,o,t,n,a,d,p);throw new Wi(o)}async expandSegmentAgainstRouteUsingRedirect(e,t,n,o,a,d,u){let{matched:p,parameters:g,consumedSegments:C,positionalParamSegments:w,remainingSegments:A}=mf(t,o,a);if(!p)throw new Wi(t);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>$b&&(this.allowRedirects=!1));let V=new Ki(a,g,Object.freeze(E({},this.urlTree.queryParams)),this.urlTree.fragment,Ih(o),En(o),o.component??o._loadedComponent??null,o,Fh(o)),G=za(V,u,this.paramsInheritanceStrategy);if(V.params=Object.freeze(G.params),V.data=Object.freeze(G.data),this.abortSignal.aborted)throw new Error(this.abortSignal.reason);let z=await this.applyRedirects.applyRedirectCommands(C,o.redirectTo,w,V,e),$=await this.applyRedirects.lineralizeSegments(o,z);return this.processSegment(e,n,t,$.concat(A),d,!1,u)}async matchSegmentAgainstRoute(e,t,n,o,a,d){if(this.abortSignal.aborted)throw new Error(this.abortSignal.reason);let u=await ka(Pb(t,n,o,e,this.urlSerializer,this.abortSignal));if(n.path==="**"&&(t.children={}),!u?.matched)throw new Wi(t);e=n._injector??e;let{routes:p}=await this.getChildConfig(e,n,o),g=n._loadedInjector??e,{parameters:C,consumedSegments:w,remainingSegments:A}=u,V=new Ki(w,C,Object.freeze(E({},this.urlTree.queryParams)),this.urlTree.fragment,Ih(n),En(n),n.component??n._loadedComponent??null,n,Fh(n)),G=za(V,d,this.paramsInheritanceStrategy);V.params=Object.freeze(G.params),V.data=Object.freeze(G.data);let{segmentGroup:z,slicedSegments:$}=kh(t,w,A,p);if($.length===0&&z.hasChildren()){let Y=await this.processChildren(g,p,z,V);return new nn(V,Y)}if(p.length===0&&$.length===0)return new nn(V,[]);let K=En(n)===a,Z=await this.processSegment(g,p,z,$,K?ke:a,!0,V);return new nn(V,Z instanceof nn?[Z]:[])}async getChildConfig(e,t,n){if(t.children)return{routes:t.children,injector:e};if(t.loadChildren){if(t._loadedRoutes!==void 0)return{routes:t._loadedRoutes,injector:t._loadedInjector};if(this.abortSignal.aborted)throw new Error(this.abortSignal.reason);if(await ka(Ab(e,t,n,this.urlSerializer,this.abortSignal))){let a=await this.configLoader.loadChildren(e,t);return t._loadedRoutes=a.routes,t._loadedInjector=a.injector,a}throw kb(t)}return{routes:[],injector:e}}};function qb(i){i.sort((e,t)=>e.value.outlet===ke?-1:t.value.outlet===ke?1:e.value.outlet.localeCompare(t.value.outlet))}function Wb(i){let e=i.value.routeConfig;return e&&e.path===""}function pf(i){let e=[],t=new Set;for(let n of i){if(!Wb(n)){e.push(n);continue}let o=e.find(a=>n.value.routeConfig===a.value.routeConfig);o!==void 0?(o.children.push(...n.children),t.add(o)):e.push(n)}for(let n of t){let o=pf(n.children);e.push(new nn(n.value,o))}return e.filter(n=>!t.has(n))}function Ih(i){return i.data||{}}function Fh(i){return i.resolve||{}}var zb=new He("",{factory:()=>Gb});function Kb(i,e,t,n,o,a,d){let u=i.get(zb);return ri(p=>Oe(p).pipe(Cn(g=>u(i,e,t,n,g.extractedUrl,o,a,d)),tt(({state:g,tree:C})=>P(E({},p),{targetSnapshot:g,urlAfterRedirects:C}))))}function jb(i,e){return ri(t=>{let{targetSnapshot:n,guards:{canActivateChecks:o}}=t;if(!o.length)return Oe(t);let a=new Set(o.map(p=>p.route)),d=new Set;for(let p of a)if(!d.has(p))for(let g of gf(p))d.add(g);let u=0;return xn(d).pipe(sr(p=>a.has(p)?Jb(p,n,i,e):(p.data=za(p,p.parent,i).resolve,Oe(void 0))),Ot(()=>u++),wd(1),ri(p=>u===d.size?Oe(t):jn))})}function gf(i){let e=i.children.map(t=>gf(t)).flat();return[i,...e]}function Jb(i,e,t,n){let o=i.routeConfig,a=i._resolve;return o?.title!==void 0&&!Xh(o)&&(a[Qr]=o.title),hs(()=>(i.data=za(i,i.parent,t).resolve,Qb(a,i,e,n).pipe(tt(d=>(i._resolvedData=d,i.data=E(E({},i.data),d),null)))))}function Qb(i,e,t,n){let o=qu(i);if(o.length===0)return Oe({});let a={};return xn(o).pipe(ri(d=>Yb(i[d],e,t,n).pipe(si(),Ot(u=>{if(u instanceof Io)throw Ka(new Ji,u);a[d]=u}))),wd(1),tt(()=>a),Sd(d=>sf(d)?jn:Bm(d)))}function Yb(i,e,t,n){let o=Po(e)??n,a=Ro(i,o),d=a.resolve?a.resolve(e,t):Xt(o,()=>a(e,t));return Qi(d)}function $u(i){return Cn(e=>{let t=i(e);return t?xn(t).pipe(tt(()=>e)):Oe(e)})}var o0=(()=>{class i{buildTitle(t){let n,o=t.root;for(;o!==void 0;)n=this.getResolvedTitleForRoute(o)??n,o=o.children.find(a=>a.outlet===ke);return n}getResolvedTitleForRoute(t){return t.data[Qr]}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>F(hf),providedIn:"root"})}return i})(),hf=(()=>{class i extends o0{title;constructor(t){super(),this.title=t}updateTitle(t){let n=this.buildTitle(t);n!==void 0&&this.title.setTitle(n)}static \u0275fac=function(n){return new(n||i)(Ae(Zp))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Xa=new He("",{factory:()=>({})}),r0=new He(""),Xb=(()=>{class i{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=F(lp);async loadComponent(t,n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Promise.resolve(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let o=(async()=>{try{let a=await Vh(Xt(t,()=>n.loadComponent())),d=await vf(_f(a));return this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=d,d}finally{this.componentLoaders.delete(n)}})();return this.componentLoaders.set(n,o),o}loadChildren(t,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return Promise.resolve({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);let o=(async()=>{try{let a=await ff(n,this.compiler,t,this.onLoadEndListener);return n._loadedRoutes=a.routes,n._loadedInjector=a.injector,a}finally{this.childrenLoaders.delete(n)}})();return this.childrenLoaders.set(n,o),o}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();async function ff(i,e,t,n){let o=await Vh(Xt(t,()=>i.loadChildren())),a=await vf(_f(o)),d;a instanceof Zm||Array.isArray(a)?d=a:d=await e.compileModuleAsync(a),n&&n(i);let u,p,g=!1;return Array.isArray(d)?(p=d,g=!0):(u=d.create(t).injector,p=u.get(r0,[],{optional:!0,self:!0}).flat()),{routes:p.map(i0),injector:u}}function Zb(i){return i&&typeof i=="object"&&"default"in i}function _f(i){return Zb(i)?i.default:i}async function vf(i){return i}var Za=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>F(ey),providedIn:"root"})}return i})(),ey=(()=>{class i{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ty=new He("");var ny=()=>{},iy=new He(""),oy=(()=>{class i{currentNavigation=f(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=f(null);events=new an;transitionAbortWithErrorSubject=new an;configLoader=F(Xb);environmentInjector=F(ai);destroyRef=F(lr);urlSerializer=F(Qa);rootContexts=F(Yr);location=F(mo);inputBindingEnabled=F(n0,{optional:!0})!==null;titleStrategy=F(o0);options=F(Xa,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=F(Za);createViewTransition=F(ty,{optional:!0});navigationErrorHandler=F(iy,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Oe(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=o=>this.events.next(new La(o)),n=o=>this.events.next(new Oa(o));this.configLoader.onLoadEndListener=n,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let n=++this.navigationId;Ft(()=>{this.transitions?.next(P(E({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:n}))})}setupNavigations(t){return this.transitions=new ln(null),this.transitions.pipe(Jn(n=>n!==null),Cn(n=>{let o=!1,a=new AbortController;return Oe(n).pipe(Cn(d=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",Vt.SupersededByNewNavigation),jn;this.currentTransition=n;let u=this.lastSuccessfulNavigation();this.currentNavigation.set({id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,targetBrowserUrl:typeof d.extras.browserUrl=="string"?this.urlSerializer.parse(d.extras.browserUrl):d.extras.browserUrl,trigger:d.source,extras:d.extras,previousNavigation:u?P(E({},u),{previousNavigation:null}):null,abort:()=>a.abort()});let p=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),g=d.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!p&&g!=="reload")return this.events.next(new Ci(d.id,this.urlSerializer.serialize(d.rawUrl),"",Pa.IgnoredSameUrlNavigation)),d.resolve(!1),jn;if(this.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return Oe(d).pipe(Cn(C=>(this.events.next(new Ao(C.id,this.urlSerializer.serialize(C.extractedUrl),C.source,C.restoredState)),C.id!==this.navigationId?jn:Promise.resolve(C))),Kb(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy,a.signal),Ot(C=>{n.targetSnapshot=C.targetSnapshot,n.urlAfterRedirects=C.urlAfterRedirects,this.currentNavigation.update(A=>(A.finalUrl=C.urlAfterRedirects,A));let w=new Wr(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(w)}));if(p&&this.urlHandlingStrategy.shouldProcessUrl(d.currentRawUrl)){let{id:C,extractedUrl:w,source:A,restoredState:V,extras:G}=d,z=new Ao(C,this.urlSerializer.serialize(w),A,V);this.events.next(z);let $=Qh(this.rootComponentType).snapshot;return this.currentTransition=n=P(E({},d),{targetSnapshot:$,urlAfterRedirects:w,extras:P(E({},G),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(K=>(K.finalUrl=w,K)),Oe(n)}else return this.events.next(new Ci(d.id,this.urlSerializer.serialize(d.extractedUrl),"",Pa.IgnoredByUrlHandlingStrategy)),d.resolve(!1),jn}),Ot(d=>{let u=new Ra(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(u)}),tt(d=>(this.currentTransition=n=P(E({},d),{guards:lb(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),n)),xb(this.environmentInjector,d=>this.events.next(d)),Ot(d=>{if(n.guardsResult=d.guardsResult,d.guardsResult&&typeof d.guardsResult!="boolean")throw Ka(this.urlSerializer,d.guardsResult);let u=new Na(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(u)}),Jn(d=>d.guardsResult?!0:(this.cancelNavigationTransition(d,"",Vt.GuardRejected),!1)),$u(d=>{if(d.guards.canActivateChecks.length!==0)return Oe(d).pipe(Ot(u=>{let p=new Va(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(p)}),Cn(u=>{let p=!1;return Oe(u).pipe(jb(this.paramsInheritanceStrategy,this.environmentInjector),Ot({next:()=>p=!0,complete:()=>{p||this.cancelNavigationTransition(u,"",Vt.NoDataFromResolver)}}))}),Ot(u=>{let p=new Ba(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(p)}))}),$u(d=>{let u=g=>{let C=[];if(g.routeConfig?._loadedComponent)g.component=g.routeConfig?._loadedComponent;else if(g.routeConfig?.loadComponent){let w=Po(g)??this.environmentInjector;C.push(this.configLoader.loadComponent(w,g.routeConfig).then(A=>{g.component=A}))}for(let w of g.children)C.push(...u(w));return C},p=u(d.targetSnapshot.root);return p.length===0?Oe(d):xn(Promise.all(p).then(()=>d))}),$u(()=>this.afterPreactivation()),Cn(()=>{let{currentSnapshot:d,targetSnapshot:u}=n,p=this.createViewTransition?.(this.environmentInjector,d.root,u.root);return p?xn(p).pipe(tt(()=>n)):Oe(n)}),tt(d=>{let u=ib(t.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return this.currentTransition=n=P(E({},d),{targetRouterState:u}),this.currentNavigation.update(p=>(p.targetRouterState=u,p)),n}),Ot(()=>{this.events.next(new zr)}),ab(this.rootContexts,t.routeReuseStrategy,d=>this.events.next(d),this.inputBindingEnabled),ao(1),_s(af(a.signal).pipe(Jn(()=>!o&&!n.targetRouterState),Ot(()=>{this.cancelNavigationTransition(n,a.signal.reason+"",Vt.Aborted)}))),Ot({next:d=>{o=!0,this.currentNavigation.update(u=>(u.abort=ny,u)),this.lastSuccessfulNavigation.set(Ft(this.currentNavigation)),this.events.next(new xi(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects))),this.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{o=!0}}),_s(this.transitionAbortWithErrorSubject.pipe(Ot(d=>{throw d}))),fs(()=>{a.abort(),o||this.cancelNavigationTransition(n,"",Vt.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),Sd(d=>{if(this.destroyed)return n.resolve(!1),jn;if(o=!0,rf(d))this.events.next(new Un(n.id,this.urlSerializer.serialize(n.extractedUrl),d.message,d.cancellationCode)),sb(d)?this.events.next(new To(d.url,d.navigationBehaviorOptions)):n.resolve(!1);else{let u=new Mo(n.id,this.urlSerializer.serialize(n.extractedUrl),d,n.targetSnapshot??void 0);try{let p=Xt(this.environmentInjector,()=>this.navigationErrorHandler?.(u));if(p instanceof Io){let{message:g,cancellationCode:C}=Ka(this.urlSerializer,p);this.events.next(new Un(n.id,this.urlSerializer.serialize(n.extractedUrl),g,C)),this.events.next(new To(p.redirectTo,p.navigationBehaviorOptions))}else throw this.events.next(u),d}catch(p){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(p)}}return jn}))}))}cancelNavigationTransition(t,n,o){let a=new Un(t.id,this.urlSerializer.serialize(t.extractedUrl),n,o);this.events.next(a),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),n=Ft(this.currentNavigation),o=n?.targetBrowserUrl??n?.extractedUrl;return t.toString()!==o?.toString()&&!n?.extras.skipLocationChange}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function ry(i){return i!==Ta}var xf=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>F(sy),providedIn:"root"})}return i})(),Ja=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},sy=(()=>{class i extends Ja{static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Cf=(()=>{class i{urlSerializer=F(Qa);options=F(Xa,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=F(mo);urlHandlingStrategy=F(Za);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Dn;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:n,targetBrowserUrl:o}){let a=t!==void 0?this.urlHandlingStrategy.merge(t,n):n,d=o??a;return d instanceof Dn?this.urlSerializer.serialize(d):d}commitTransition({targetRouterState:t,finalUrl:n,initialUrl:o}){n&&t?(this.currentUrlTree=n,this.rawUrlTree=this.urlHandlingStrategy.merge(n,o),this.routerState=t):this.rawUrlTree=o}routerState=Qh(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:()=>F(ay),providedIn:"root"})}return i})(),ay=(()=>{class i extends Cf{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(n=>{n.type==="popstate"&&setTimeout(()=>{t(n.url,n.state,"popstate")})})}handleRouterEvent(t,n){t instanceof Ao?this.updateStateMemento():t instanceof Ci?this.commitTransition(n):t instanceof Wr?this.urlUpdateStrategy==="eager"&&(n.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof zr?(this.commitTransition(n),this.urlUpdateStrategy==="deferred"&&!n.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof Un&&t.code!==Vt.SupersededByNewNavigation&&t.code!==Vt.Redirect?this.restoreHistory(n):t instanceof Mo?this.restoreHistory(n,!0):t instanceof xi&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:n,id:o}){let{replaceUrl:a,state:d}=n;if(this.location.isCurrentPathEqualTo(t)||a){let u=this.browserPageId,p=E(E({},d),this.generateNgRouterState(o,u));this.location.replaceState(t,"",p)}else{let u=E(E({},d),this.generateNgRouterState(o,this.browserPageId+1));this.location.go(t,"",u)}}restoreHistory(t,n=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,a=this.currentPageId-o;a!==0?this.location.historyGo(a):this.getCurrentUrlTree()===t.finalUrl&&a===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(n&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,n){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:n}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Pt(i)))(o||i)}})();static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function bf(i,e){i.events.pipe(Jn(t=>t instanceof xi||t instanceof Un||t instanceof Mo||t instanceof Ci),tt(t=>t instanceof xi||t instanceof Ci?0:(t instanceof Un?t.code===Vt.Redirect||t.code===Vt.SupersededByNewNavigation:!1)?2:1),Jn(t=>t!==2),ao(1)).subscribe(()=>{e()})}var ly={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},cy={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Zr=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=F(tp);stateManager=F(Cf);options=F(Xa,{optional:!0})||{};pendingTasks=F(Wm);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=F(oy);urlSerializer=F(Qa);location=F(mo);urlHandlingStrategy=F(Za);injector=F(ai);_events=new an;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=F(xf);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=F(r0,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!F(n0,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Nm;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(n=>{try{let o=this.navigationTransitions.currentTransition,a=Ft(this.navigationTransitions.currentNavigation);if(o!==null&&a!==null){if(this.stateManager.handleRouterEvent(n,a),n instanceof Un&&n.code!==Vt.Redirect&&n.code!==Vt.SupersededByNewNavigation)this.navigated=!0;else if(n instanceof xi)this.navigated=!0;else if(n instanceof To){let d=n.navigationBehaviorOptions,u=this.urlHandlingStrategy.merge(n.url,o.currentRawUrl),p=E({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||ry(o.source)},d);this.scheduleNavigation(u,Ta,null,p,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}ZC(n)&&this._events.next(n)}catch(o){this.navigationTransitions.transitionAbortWithErrorSubject.next(o)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ta,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,n,o)=>{this.navigateToSyncWithBrowser(t,o,n)})}navigateToSyncWithBrowser(t,n,o){let a={replaceUrl:!0},d=o?.navigationId?o:null;if(o){let p=E({},o);delete p.navigationId,delete p.\u0275routerPageId,Object.keys(p).length!==0&&(a.state=p)}let u=this.parseUrl(t);this.scheduleNavigation(u,n,d,a).catch(p=>{this.disposed||this.injector.get(Ad)(p)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Ft(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(i0),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,n={}){let{relativeTo:o,queryParams:a,fragment:d,queryParamsHandling:u,preserveFragment:p}=n,g=p?this.currentUrlTree.fragment:d,C=null;switch(u??this.options.defaultQueryParamsHandling){case"merge":C=E(E({},this.currentUrlTree.queryParams),a);break;case"preserve":C=this.currentUrlTree.queryParams;break;default:C=a||null}C!==null&&(C=this.removeEmptyProps(C));let w;try{let A=o?o.snapshot:this.routerState.snapshot.root;w=zh(A)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),w=this.currentUrlTree.root}return Kh(w,t,C,g??null,this.urlSerializer)}navigateByUrl(t,n={skipLocationChange:!1}){let o=Hr(t)?t:this.parseUrl(t),a=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(a,Ta,null,n)}navigate(t,n={skipLocationChange:!1}){return dy(t),this.navigateByUrl(this.createUrlTree(t,n),n)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.console.warn(vs(4018,!1)),this.urlSerializer.parse("/")}}isActive(t,n){let o;if(n===!0?o=E({},ly):n===!1?o=E({},cy):o=n,Hr(t))return Eh(this.currentUrlTree,t,o);let a=this.parseUrl(t);return Eh(this.currentUrlTree,a,o)}removeEmptyProps(t){return Object.entries(t).reduce((n,[o,a])=>(a!=null&&(n[o]=a),n),{})}scheduleNavigation(t,n,o,a,d){if(this.disposed)return Promise.resolve(!1);let u,p,g;d?(u=d.resolve,p=d.reject,g=d.promise):g=new Promise((w,A)=>{u=w,p=A});let C=this.pendingTasks.add();return bf(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(C))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:a,resolve:u,reject:p,promise:g,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),g.catch(w=>Promise.reject(w))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function dy(i){for(let e=0;e<i.length;e++)if(i[e]==null)throw new me(4008,!1)}var uy,my;function py(){return{geminiUrl:uy,vertexUrl:my}}function gy(i,e,t,n){var o,a;if(!i?.baseUrl){let d=py();return e?(o=d.vertexUrl)!==null&&o!==void 0?o:t:(a=d.geminiUrl)!==null&&a!==void 0?a:n}return i.baseUrl}var Tn=class{};function fe(i,e){let t=/\{([^}]+)\}/g;return i.replace(t,(n,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){let a=e[o];return a!=null?String(a):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function b(i,e,t){for(let a=0;a<e.length-1;a++){let d=e[a];if(d.endsWith("[]")){let u=d.slice(0,-2);if(!(u in i))if(Array.isArray(t))i[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${d}`);if(Array.isArray(i[u])){let p=i[u];if(Array.isArray(t))for(let g=0;g<p.length;g++){let C=p[g];b(C,e.slice(a+1),t[g])}else for(let g of p)b(g,e.slice(a+1),t)}return}else if(d.endsWith("[0]")){let u=d.slice(0,-3);u in i||(i[u]=[{}]);let p=i[u];b(p[0],e.slice(a+1),t);return}(!i[d]||typeof i[d]!="object")&&(i[d]={}),i=i[d]}let n=e[e.length-1],o=i[n];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function h(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;let o=e[n];if(o.endsWith("[]")){let a=o.slice(0,-2);if(a in i){let d=i[a];return Array.isArray(d)?d.map(u=>h(u,e.slice(n+1),t)):t}else return t}else i=i[o]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function hy(i,e){for(let[t,n]of Object.entries(e)){let o=t.split("."),a=n.split("."),d=new Set,u=-1;for(let p=0;p<o.length;p++)if(o[p]==="*"){u=p;break}if(u!==-1&&a.length>u)for(let p=u;p<a.length;p++){let g=a[p];g!=="*"&&!g.endsWith("[]")&&!g.endsWith("[0]")&&d.add(g)}l0(i,o,a,0,d)}}function l0(i,e,t,n,o){if(n>=e.length||typeof i!="object"||i===null)return;let a=e[n];if(a.endsWith("[]")){let d=a.slice(0,-2),u=i;if(d in u&&Array.isArray(u[d]))for(let p of u[d])l0(p,e,t,n+1,o)}else if(a==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let d=i,u=Object.keys(d).filter(g=>!g.startsWith("_")&&!o.has(g)),p={};for(let g of u)p[g]=d[g];for(let[g,C]of Object.entries(p)){let w=[];for(let A of t.slice(n))A==="*"?w.push(g):w.push(A);b(d,w,C)}for(let g of u)delete d[g]}}else{let d=i;a in d&&l0(d[a],e,t,n+1,o)}}function sm(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function fy(i){let e={},t=h(i,["operationName"]);t!=null&&b(e,["operationName"],t);let n=h(i,["resourceName"]);return n!=null&&b(e,["_url","resourceName"],n),e}function _y(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata"]);n!=null&&b(e,["metadata"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["response","generateVideoResponse"]);return d!=null&&b(e,["response"],xy(d)),e}function vy(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata"]);n!=null&&b(e,["metadata"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["response"]);return d!=null&&b(e,["response"],Cy(d)),e}function xy(i){let e={},t=h(i,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>by(d))),b(e,["generatedVideos"],a)}let n=h(i,["raiMediaFilteredCount"]);n!=null&&b(e,["raiMediaFilteredCount"],n);let o=h(i,["raiMediaFilteredReasons"]);return o!=null&&b(e,["raiMediaFilteredReasons"],o),e}function Cy(i){let e={},t=h(i,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>yy(d))),b(e,["generatedVideos"],a)}let n=h(i,["raiMediaFilteredCount"]);n!=null&&b(e,["raiMediaFilteredCount"],n);let o=h(i,["raiMediaFilteredReasons"]);return o!=null&&b(e,["raiMediaFilteredReasons"],o),e}function by(i){let e={},t=h(i,["video"]);return t!=null&&b(e,["video"],My(t)),e}function yy(i){let e={},t=h(i,["_self"]);return t!=null&&b(e,["video"],Ty(t)),e}function Sy(i){let e={},t=h(i,["operationName"]);return t!=null&&b(e,["_url","operationName"],t),e}function wy(i){let e={},t=h(i,["operationName"]);return t!=null&&b(e,["_url","operationName"],t),e}function Ey(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata"]);n!=null&&b(e,["metadata"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["response"]);return d!=null&&b(e,["response"],Dy(d)),e}function Dy(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["parent"]);n!=null&&b(e,["parent"],n);let o=h(i,["documentName"]);return o!=null&&b(e,["documentName"],o),e}function Kf(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata"]);n!=null&&b(e,["metadata"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["response"]);return d!=null&&b(e,["response"],Ay(d)),e}function Ay(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["parent"]);n!=null&&b(e,["parent"],n);let o=h(i,["documentName"]);return o!=null&&b(e,["documentName"],o),e}function My(i){let e={},t=h(i,["uri"]);t!=null&&b(e,["uri"],t);let n=h(i,["encodedVideo"]);n!=null&&b(e,["videoBytes"],sm(n));let o=h(i,["encoding"]);return o!=null&&b(e,["mimeType"],o),e}function Ty(i){let e={},t=h(i,["gcsUri"]);t!=null&&b(e,["uri"],t);let n=h(i,["bytesBase64Encoded"]);n!=null&&b(e,["videoBytes"],sm(n));let o=h(i,["mimeType"]);return o!=null&&b(e,["mimeType"],o),e}var Zi=(function(i){return i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL",i})(Zi||{});var c0=(function(i){return i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO",i})(c0||{});var jf=(function(i){return i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",i})(jf||{});var ts=(function(i){return i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT",i})(ts||{});var is=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var Xi=class{get text(){var e,t,n,o,a,d,u,p;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let g="",C=!1,w=[];for(let A of(p=(u=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||u===void 0?void 0:u.parts)!==null&&p!==void 0?p:[]){for(let[V,G]of Object.entries(A))V!=="text"&&V!=="thought"&&V!=="thoughtSignature"&&(G!==null||G!==void 0)&&w.push(V);if(typeof A.text=="string"){if(typeof A.thought=="boolean"&&A.thought)continue;C=!0,g+=A.text}}return w.length>0&&console.warn(`there are non-text parts ${w} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),C?g:void 0}get data(){var e,t,n,o,a,d,u,p;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let g="",C=[];for(let w of(p=(u=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||u===void 0?void 0:u.parts)!==null&&p!==void 0?p:[]){for(let[A,V]of Object.entries(w))A!=="inlineData"&&(V!==null||V!==void 0)&&C.push(A);w.inlineData&&typeof w.inlineData.data=="string"&&(g+=atob(w.inlineData.data))}return C.length>0&&console.warn(`there are non-data parts ${C} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),g.length>0?btoa(g):void 0}get functionCalls(){var e,t,n,o,a,d,u,p;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let g=(p=(u=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||u===void 0?void 0:u.parts)===null||p===void 0?void 0:p.filter(C=>C.functionCall).map(C=>C.functionCall).filter(C=>C!==void 0);if(g?.length!==0)return g}get executableCode(){var e,t,n,o,a,d,u,p,g;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let C=(p=(u=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||u===void 0?void 0:u.parts)===null||p===void 0?void 0:p.filter(w=>w.executableCode).map(w=>w.executableCode).filter(w=>w!==void 0);if(C?.length!==0)return(g=C?.[0])===null||g===void 0?void 0:g.code}get codeExecutionResult(){var e,t,n,o,a,d,u,p,g;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let C=(p=(u=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||u===void 0?void 0:u.parts)===null||p===void 0?void 0:p.filter(w=>w.codeExecutionResult).map(w=>w.codeExecutionResult).filter(w=>w!==void 0);if(C?.length!==0)return(g=C?.[0])===null||g===void 0?void 0:g.output}},al=class{},ll=class{},d0=class{},u0=class{},m0=class{},p0=class{},cl=class{},dl=class{},ul=class{},g0=class{};var ml=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,o,a=e;return t?o=vy(a):o=_y(a),Object.assign(n,o),n}},pl=class{},gl=class{},hl=class{},fl=class{},h0=class{},f0=class{},_0=class{};var v0=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,a=Ey(e);return Object.assign(n,a),n}},x0=class{},C0=class{},b0=class{};var _l=class{};var y0=class{get text(){var e,t,n;let o="",a=!1,d=[];for(let u of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[p,g]of Object.entries(u))p!=="text"&&p!=="thought"&&g!==null&&d.push(p);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;a=!0,o+=u.text}}return d.length>0&&console.warn(`there are non-text parts ${d} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),a?o:void 0}get data(){var e,t,n;let o="",a=[];for(let d of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[u,p]of Object.entries(d))u!=="inlineData"&&p!==null&&a.push(u);d.inlineData&&typeof d.inlineData.data=="string"&&(o+=atob(d.inlineData.data))}return a.length>0&&console.warn(`there are non-data parts ${a} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}};var S0=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var w0=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,a=Kf(e);return Object.assign(n,a),n}};function We(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Jf(i,e){let t=We(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function Qf(i){return Array.isArray(i)?i.map(e=>vl(e)):[vl(i)]}function vl(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function Yf(i){let e=vl(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Xf(i){let e=vl(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function yf(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function Zf(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>yf(e)):[yf(i)]}function E0(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function Sf(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function wf(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function At(i){if(i==null)throw new Error("ContentUnion is required");return E0(i)?i:{role:"user",parts:Zf(i)}}function am(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=At(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){let t=At(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>At(t)):[At(e)]}function fn(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(Sf(i)||wf(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[At(i)]}let e=[],t=[],n=E0(i[0]);for(let o of i){let a=E0(o);if(a!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(o);else{if(Sf(o)||wf(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return n||e.push({role:"user",parts:Zf(t)}),e}function ky(i,e){i.includes("null")&&(e.nullable=!0);let t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(Zi).includes(t[0].toUpperCase())?t[0].toUpperCase():Zi.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(Zi).includes(n.toUpperCase())?n.toUpperCase():Zi.TYPE_UNSPECIFIED})}}function Vo(i){let e={},t=["items"],n=["anyOf"],o=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");let a=i.anyOf;a!=null&&a.length==2&&(a[0].type==="null"?(e.nullable=!0,i=a[1]):a[1].type==="null"&&(e.nullable=!0,i=a[0])),i.type instanceof Array&&ky(i.type,e);for(let[d,u]of Object.entries(i))if(u!=null)if(d=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(Zi).includes(u.toUpperCase())?u.toUpperCase():Zi.TYPE_UNSPECIFIED}else if(t.includes(d))e[d]=Vo(u);else if(n.includes(d)){let p=[];for(let g of u){if(g.type=="null"){e.nullable=!0;continue}p.push(Vo(g))}e[d]=p}else if(o.includes(d)){let p={};for(let[g,C]of Object.entries(u))p[g]=Vo(C);e[d]=p}else{if(d==="additionalProperties")continue;e[d]=u}return e}function lm(i){return Vo(i)}function cm(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function dm(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function Uo(i){if(i.functionDeclarations)for(let e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Vo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Vo(e.response));return i}function Go(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of i)e.push(t);return e}function Iy(i,e,t,n=1){let o=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:o?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function ti(i,e){if(typeof e!="string")throw new Error("name must be a string");return Iy(i,e,"cachedContents")}function e_(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function bi(i){return sm(i)}function Fy(i){return i!=null&&typeof i=="object"&&"name"in i}function Py(i){return i!=null&&typeof i=="object"&&"video"in i}function Ry(i){return i!=null&&typeof i=="object"&&"uri"in i}function t_(i){var e;let t;if(Fy(i)&&(t=i.name),!(Ry(i)&&(t=i.uri,t===void 0))&&!(Py(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function n_(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function i_(i){for(let e of["models","tunedModels","publisherModels"])if(Ny(i,e))return i[e];return[]}function Ny(i,e){return i!==null&&typeof i=="object"&&e in i}function Vy(i,e={}){let t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function By(i,e={}){let t=[],n=new Set;for(let o of i){let a=o.name;if(n.has(a))throw new Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);n.add(a);let d=Vy(o,e);d.functionDeclarations&&t.push(...d.functionDeclarations)}return{functionDeclarations:t}}function o_(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(o>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function Ly(i){if(typeof i!="string")return i;let e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function r_(i){if(typeof i!="object"||i===null)return{};let e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;let o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return i;let a=!1;for(let d of o){if(typeof d!="object"||d===null)continue;let p=d.response;if(typeof p!="object"||p===null)continue;if(p.embedding!==void 0){a=!0;break}}return a&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function $o(i,e){let t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function s_(i){let e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function Oy(i){let e={},t=h(i,["responsesFile"]);t!=null&&b(e,["fileName"],t);let n=h(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>x2(d))),b(e,["inlinedResponses"],a)}let o=h(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["inlinedEmbedContentResponses"],a)}return e}function Uy(i){let e={},t=h(i,["predictionsFormat"]);t!=null&&b(e,["format"],t);let n=h(i,["gcsDestination","outputUriPrefix"]);n!=null&&b(e,["gcsUri"],n);let o=h(i,["bigqueryDestination","outputUri"]);return o!=null&&b(e,["bigqueryUri"],o),e}function Gy(i){let e={},t=h(i,["format"]);t!=null&&b(e,["predictionsFormat"],t);let n=h(i,["gcsUri"]);n!=null&&b(e,["gcsDestination","outputUriPrefix"],n);let o=h(i,["bigqueryUri"]);if(o!=null&&b(e,["bigqueryDestination","outputUri"],o),h(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(h(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function rl(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata","displayName"]);n!=null&&b(e,["displayName"],n);let o=h(i,["metadata","state"]);o!=null&&b(e,["state"],s_(o));let a=h(i,["metadata","createTime"]);a!=null&&b(e,["createTime"],a);let d=h(i,["metadata","endTime"]);d!=null&&b(e,["endTime"],d);let u=h(i,["metadata","updateTime"]);u!=null&&b(e,["updateTime"],u);let p=h(i,["metadata","model"]);p!=null&&b(e,["model"],p);let g=h(i,["metadata","output"]);return g!=null&&b(e,["dest"],Oy(r_(g))),e}function D0(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["displayName"]);n!=null&&b(e,["displayName"],n);let o=h(i,["state"]);o!=null&&b(e,["state"],s_(o));let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["createTime"]);d!=null&&b(e,["createTime"],d);let u=h(i,["startTime"]);u!=null&&b(e,["startTime"],u);let p=h(i,["endTime"]);p!=null&&b(e,["endTime"],p);let g=h(i,["updateTime"]);g!=null&&b(e,["updateTime"],g);let C=h(i,["model"]);C!=null&&b(e,["model"],C);let w=h(i,["inputConfig"]);w!=null&&b(e,["src"],$y(w));let A=h(i,["outputConfig"]);A!=null&&b(e,["dest"],Uy(r_(A)));let V=h(i,["completionStats"]);return V!=null&&b(e,["completionStats"],V),e}function $y(i){let e={},t=h(i,["instancesFormat"]);t!=null&&b(e,["format"],t);let n=h(i,["gcsSource","uris"]);n!=null&&b(e,["gcsUri"],n);let o=h(i,["bigquerySource","inputUri"]);return o!=null&&b(e,["bigqueryUri"],o),e}function Hy(i,e){let t={};if(h(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(h(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=h(e,["fileName"]);n!=null&&b(t,["fileName"],n);let o=h(e,["inlinedRequests"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>v2(i,d))),b(t,["requests","requests"],a)}return t}function qy(i){let e={},t=h(i,["format"]);t!=null&&b(e,["instancesFormat"],t);let n=h(i,["gcsUri"]);n!=null&&b(e,["gcsSource","uris"],n);let o=h(i,["bigqueryUri"]);if(o!=null&&b(e,["bigquerySource","inputUri"],o),h(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Wy(i){let e={},t=h(i,["data"]);if(t!=null&&b(e,["data"],t),h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function zy(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],$o(i,n)),t}function Ky(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],$o(i,n)),t}function jy(i){let e={},t=h(i,["content"]);t!=null&&b(e,["content"],t);let n=h(i,["citationMetadata"]);n!=null&&b(e,["citationMetadata"],Jy(n));let o=h(i,["tokenCount"]);o!=null&&b(e,["tokenCount"],o);let a=h(i,["finishReason"]);a!=null&&b(e,["finishReason"],a);let d=h(i,["avgLogprobs"]);d!=null&&b(e,["avgLogprobs"],d);let u=h(i,["groundingMetadata"]);u!=null&&b(e,["groundingMetadata"],u);let p=h(i,["index"]);p!=null&&b(e,["index"],p);let g=h(i,["logprobsResult"]);g!=null&&b(e,["logprobsResult"],g);let C=h(i,["safetyRatings"]);if(C!=null){let A=C;Array.isArray(A)&&(A=A.map(V=>V)),b(e,["safetyRatings"],A)}let w=h(i,["urlContextMetadata"]);return w!=null&&b(e,["urlContextMetadata"],w),e}function Jy(i){let e={},t=h(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),b(e,["citations"],n)}return e}function a_(i){let e={},t=h(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>D2(a))),b(e,["parts"],o)}let n=h(i,["role"]);return n!=null&&b(e,["role"],n),e}function Qy(i,e){let t={},n=h(i,["displayName"]);if(e!==void 0&&n!=null&&b(e,["batch","displayName"],n),h(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function Yy(i,e){let t={},n=h(i,["displayName"]);e!==void 0&&n!=null&&b(e,["displayName"],n);let o=h(i,["dest"]);return e!==void 0&&o!=null&&b(e,["outputConfig"],Gy(Ly(o))),t}function Ef(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["src"]);o!=null&&b(t,["batch","inputConfig"],Hy(i,o_(i,o)));let a=h(e,["config"]);return a!=null&&Qy(a,t),t}function Xy(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["model"],We(i,n));let o=h(e,["src"]);o!=null&&b(t,["inputConfig"],qy(o_(i,o)));let a=h(e,["config"]);return a!=null&&Yy(a,t),t}function Zy(i,e){let t={},n=h(i,["displayName"]);return e!==void 0&&n!=null&&b(e,["batch","displayName"],n),t}function e2(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["src"]);o!=null&&b(t,["batch","inputConfig"],a2(i,o));let a=h(e,["config"]);return a!=null&&Zy(a,t),t}function t2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],$o(i,n)),t}function n2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],$o(i,n)),t}function i2(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["name"]);n!=null&&b(e,["name"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);return a!=null&&b(e,["error"],a),e}function o2(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["name"]);n!=null&&b(e,["name"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);return a!=null&&b(e,["error"],a),e}function r2(i,e){let t={},n=h(e,["contents"]);if(n!=null){let a=am(i,n);Array.isArray(a)&&(a=a.map(d=>d)),b(t,["requests[]","request","content"],a)}let o=h(e,["config"]);return o!=null&&(b(t,["_self"],s2(o,t)),hy(t,{"requests[].*":"requests[].request.*"})),t}function s2(i,e){let t={},n=h(i,["taskType"]);e!==void 0&&n!=null&&b(e,["requests[]","taskType"],n);let o=h(i,["title"]);e!==void 0&&o!=null&&b(e,["requests[]","title"],o);let a=h(i,["outputDimensionality"]);if(e!==void 0&&a!=null&&b(e,["requests[]","outputDimensionality"],a),h(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function a2(i,e){let t={},n=h(e,["fileName"]);n!=null&&b(t,["file_name"],n);let o=h(e,["inlinedRequests"]);return o!=null&&b(t,["requests"],r2(i,o)),t}function l2(i){let e={};if(h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(i,["fileUri"]);t!=null&&b(e,["fileUri"],t);let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function c2(i){let e={},t=h(i,["id"]);t!=null&&b(e,["id"],t);let n=h(i,["args"]);n!=null&&b(e,["args"],n);let o=h(i,["name"]);if(o!=null&&b(e,["name"],o),h(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function d2(i){let e={},t=h(i,["mode"]);t!=null&&b(e,["mode"],t);let n=h(i,["allowedFunctionNames"]);if(n!=null&&b(e,["allowedFunctionNames"],n),h(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function u2(i,e,t){let n={},o=h(e,["systemInstruction"]);t!==void 0&&o!=null&&b(t,["systemInstruction"],a_(At(o)));let a=h(e,["temperature"]);a!=null&&b(n,["temperature"],a);let d=h(e,["topP"]);d!=null&&b(n,["topP"],d);let u=h(e,["topK"]);u!=null&&b(n,["topK"],u);let p=h(e,["candidateCount"]);p!=null&&b(n,["candidateCount"],p);let g=h(e,["maxOutputTokens"]);g!=null&&b(n,["maxOutputTokens"],g);let C=h(e,["stopSequences"]);C!=null&&b(n,["stopSequences"],C);let w=h(e,["responseLogprobs"]);w!=null&&b(n,["responseLogprobs"],w);let A=h(e,["logprobs"]);A!=null&&b(n,["logprobs"],A);let V=h(e,["presencePenalty"]);V!=null&&b(n,["presencePenalty"],V);let G=h(e,["frequencyPenalty"]);G!=null&&b(n,["frequencyPenalty"],G);let z=h(e,["seed"]);z!=null&&b(n,["seed"],z);let $=h(e,["responseMimeType"]);$!=null&&b(n,["responseMimeType"],$);let K=h(e,["responseSchema"]);K!=null&&b(n,["responseSchema"],lm(K));let Z=h(e,["responseJsonSchema"]);if(Z!=null&&b(n,["responseJsonSchema"],Z),h(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let Y=h(e,["safetySettings"]);if(t!==void 0&&Y!=null){let Xe=Y;Array.isArray(Xe)&&(Xe=Xe.map(Qt=>A2(Qt))),b(t,["safetySettings"],Xe)}let re=h(e,["tools"]);if(t!==void 0&&re!=null){let Xe=Go(re);Array.isArray(Xe)&&(Xe=Xe.map(Qt=>T2(Uo(Qt)))),b(t,["tools"],Xe)}let le=h(e,["toolConfig"]);if(t!==void 0&&le!=null&&b(t,["toolConfig"],M2(le)),h(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let ue=h(e,["cachedContent"]);t!==void 0&&ue!=null&&b(t,["cachedContent"],ti(i,ue));let pe=h(e,["responseModalities"]);pe!=null&&b(n,["responseModalities"],pe);let Fe=h(e,["mediaResolution"]);Fe!=null&&b(n,["mediaResolution"],Fe);let we=h(e,["speechConfig"]);if(we!=null&&b(n,["speechConfig"],cm(we)),h(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let Pe=h(e,["thinkingConfig"]);Pe!=null&&b(n,["thinkingConfig"],Pe);let at=h(e,["imageConfig"]);at!=null&&b(n,["imageConfig"],_2(at));let wt=h(e,["enableEnhancedCivicAnswers"]);return wt!=null&&b(n,["enableEnhancedCivicAnswers"],wt),n}function m2(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["candidates"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(g=>jy(g))),b(e,["candidates"],p)}let o=h(i,["modelVersion"]);o!=null&&b(e,["modelVersion"],o);let a=h(i,["promptFeedback"]);a!=null&&b(e,["promptFeedback"],a);let d=h(i,["responseId"]);d!=null&&b(e,["responseId"],d);let u=h(i,["usageMetadata"]);return u!=null&&b(e,["usageMetadata"],u),e}function p2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],$o(i,n)),t}function g2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],$o(i,n)),t}function h2(i){let e={};if(h(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(i,["enableWidget"]);return t!=null&&b(e,["enableWidget"],t),e}function f2(i){let e={};if(h(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(i,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],t),e}function _2(i){let e={},t=h(i,["aspectRatio"]);t!=null&&b(e,["aspectRatio"],t);let n=h(i,["imageSize"]);if(n!=null&&b(e,["imageSize"],n),h(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function v2(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["request","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let u=fn(o);Array.isArray(u)&&(u=u.map(p=>a_(p))),b(t,["request","contents"],u)}let a=h(e,["metadata"]);a!=null&&b(t,["metadata"],a);let d=h(e,["config"]);return d!=null&&b(t,["request","generationConfig"],u2(i,d,h(t,["request"],{}))),t}function x2(i){let e={},t=h(i,["response"]);t!=null&&b(e,["response"],m2(t));let n=h(i,["error"]);return n!=null&&b(e,["error"],n),e}function C2(i,e){let t={},n=h(i,["pageSize"]);e!==void 0&&n!=null&&b(e,["_query","pageSize"],n);let o=h(i,["pageToken"]);if(e!==void 0&&o!=null&&b(e,["_query","pageToken"],o),h(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function b2(i,e){let t={},n=h(i,["pageSize"]);e!==void 0&&n!=null&&b(e,["_query","pageSize"],n);let o=h(i,["pageToken"]);e!==void 0&&o!=null&&b(e,["_query","pageToken"],o);let a=h(i,["filter"]);return e!==void 0&&a!=null&&b(e,["_query","filter"],a),t}function y2(i){let e={},t=h(i,["config"]);return t!=null&&C2(t,e),e}function S2(i){let e={},t=h(i,["config"]);return t!=null&&b2(t,e),e}function w2(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["operations"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>rl(d))),b(e,["batchJobs"],a)}return e}function E2(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["batchPredictionJobs"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>D0(d))),b(e,["batchJobs"],a)}return e}function D2(i){let e={},t=h(i,["mediaResolution"]);t!=null&&b(e,["mediaResolution"],t);let n=h(i,["codeExecutionResult"]);n!=null&&b(e,["codeExecutionResult"],n);let o=h(i,["executableCode"]);o!=null&&b(e,["executableCode"],o);let a=h(i,["fileData"]);a!=null&&b(e,["fileData"],l2(a));let d=h(i,["functionCall"]);d!=null&&b(e,["functionCall"],c2(d));let u=h(i,["functionResponse"]);u!=null&&b(e,["functionResponse"],u);let p=h(i,["inlineData"]);p!=null&&b(e,["inlineData"],Wy(p));let g=h(i,["text"]);g!=null&&b(e,["text"],g);let C=h(i,["thought"]);C!=null&&b(e,["thought"],C);let w=h(i,["thoughtSignature"]);w!=null&&b(e,["thoughtSignature"],w);let A=h(i,["videoMetadata"]);return A!=null&&b(e,["videoMetadata"],A),e}function A2(i){let e={},t=h(i,["category"]);if(t!=null&&b(e,["category"],t),h(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(i,["threshold"]);return n!=null&&b(e,["threshold"],n),e}function M2(i){let e={},t=h(i,["functionCallingConfig"]);t!=null&&b(e,["functionCallingConfig"],d2(t));let n=h(i,["retrievalConfig"]);return n!=null&&b(e,["retrievalConfig"],n),e}function T2(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(w=>w)),b(e,["functionDeclarations"],C)}if(h(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(i,["googleSearchRetrieval"]);n!=null&&b(e,["googleSearchRetrieval"],n);let o=h(i,["computerUse"]);o!=null&&b(e,["computerUse"],o);let a=h(i,["fileSearch"]);a!=null&&b(e,["fileSearch"],a);let d=h(i,["codeExecution"]);if(d!=null&&b(e,["codeExecution"],d),h(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=h(i,["googleMaps"]);u!=null&&b(e,["googleMaps"],h2(u));let p=h(i,["googleSearch"]);p!=null&&b(e,["googleSearch"],f2(p));let g=h(i,["urlContext"]);return g!=null&&b(e,["urlContext"],g),e}var yi=(function(i){return i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents",i})(yi||{}),ei=class{constructor(e,t,n,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,o)}init(e,t,n){var o,a;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let d={config:{}};!n||Object.keys(n).length===0?d={config:{}}:typeof n=="object"?d=Object.assign({},n):d=n,d.config&&(d.config.pageToken=t.nextPageToken),this.paramsInternal=d,this.pageInternalSize=(a=(o=d.config)===null||o===void 0?void 0:o.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var A0=class extends Tn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ei(yi.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=Ef(this.apiClient,e),n=t._url,o=fe("{model}:batchGenerateContent",n),u=t.batch.inputConfig.requests,p=u.requests,g=[];for(let C of p){let w=Object.assign({},C);if(w.systemInstruction){let A=w.systemInstruction;delete w.systemInstruction;let V=w.request;V.systemInstruction=A,w.request=V}g.push(w)}return u.requests=g,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},o=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${o}`),n.dest===void 0){let a=this.getGcsUri(e),d=this.getBigqueryUri(e);if(a)a.endsWith(".jsonl")?n.dest=`${a.slice(0,-6)}/dest`:n.dest=`${a}_dest_${o}`;else if(d)n.dest=`${d}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=Xy(this.apiClient,e);return u=fe("batchPredictionJobs",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>D0(C))}else{let g=Ef(this.apiClient,e);return u=fe("{model}:batchGenerateContent",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>rl(C))}}async createEmbeddingsInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=e2(this.apiClient,e);return a=fe("{model}:asyncBatchEmbedContent",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>rl(p))}}async get(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=g2(this.apiClient,e);return u=fe("batchPredictionJobs/{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>D0(C))}else{let g=p2(this.apiClient,e);return u=fe("batches/{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>rl(C))}}async cancel(e){var t,n,o,a;let d="",u={};if(this.apiClient.isVertexAI()){let p=Ky(this.apiClient,e);d=fe("batchPredictionJobs/{name}:cancel",p._url),u=p._query,delete p._url,delete p._query,await this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let p=zy(this.apiClient,e);d=fe("batches/{name}:cancel",p._url),u=p._query,delete p._url,delete p._query,await this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=S2(e);return u=fe("batchPredictionJobs",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=E2(C),A=new _l;return Object.assign(A,w),A})}else{let g=y2(e);return u=fe("batches",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=w2(C),A=new _l;return Object.assign(A,w),A})}}async delete(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=n2(this.apiClient,e);return u=fe("batchPredictionJobs/{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>o2(C))}else{let g=t2(this.apiClient,e);return u=fe("batches/{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>i2(C))}}};function k2(i){let e={},t=h(i,["data"]);if(t!=null&&b(e,["data"],t),h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function Df(i){let e={},t=h(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>Z2(a))),b(e,["parts"],o)}let n=h(i,["role"]);return n!=null&&b(e,["role"],n),e}function I2(i,e){let t={},n=h(i,["ttl"]);e!==void 0&&n!=null&&b(e,["ttl"],n);let o=h(i,["expireTime"]);e!==void 0&&o!=null&&b(e,["expireTime"],o);let a=h(i,["displayName"]);e!==void 0&&a!=null&&b(e,["displayName"],a);let d=h(i,["contents"]);if(e!==void 0&&d!=null){let C=fn(d);Array.isArray(C)&&(C=C.map(w=>Df(w))),b(e,["contents"],C)}let u=h(i,["systemInstruction"]);e!==void 0&&u!=null&&b(e,["systemInstruction"],Df(At(u)));let p=h(i,["tools"]);if(e!==void 0&&p!=null){let C=p;Array.isArray(C)&&(C=C.map(w=>tS(w))),b(e,["tools"],C)}let g=h(i,["toolConfig"]);if(e!==void 0&&g!=null&&b(e,["toolConfig"],eS(g)),h(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function F2(i,e){let t={},n=h(i,["ttl"]);e!==void 0&&n!=null&&b(e,["ttl"],n);let o=h(i,["expireTime"]);e!==void 0&&o!=null&&b(e,["expireTime"],o);let a=h(i,["displayName"]);e!==void 0&&a!=null&&b(e,["displayName"],a);let d=h(i,["contents"]);if(e!==void 0&&d!=null){let w=fn(d);Array.isArray(w)&&(w=w.map(A=>A)),b(e,["contents"],w)}let u=h(i,["systemInstruction"]);e!==void 0&&u!=null&&b(e,["systemInstruction"],At(u));let p=h(i,["tools"]);if(e!==void 0&&p!=null){let w=p;Array.isArray(w)&&(w=w.map(A=>nS(A))),b(e,["tools"],w)}let g=h(i,["toolConfig"]);e!==void 0&&g!=null&&b(e,["toolConfig"],g);let C=h(i,["kmsKeyName"]);return e!==void 0&&C!=null&&b(e,["encryption_spec","kmsKeyName"],C),t}function P2(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["model"],Jf(i,n));let o=h(e,["config"]);return o!=null&&I2(o,t),t}function R2(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["model"],Jf(i,n));let o=h(e,["config"]);return o!=null&&F2(o,t),t}function N2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],ti(i,n)),t}function V2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],ti(i,n)),t}function B2(i){let e={},t=h(i,["sdkHttpResponse"]);return t!=null&&b(e,["sdkHttpResponse"],t),e}function L2(i){let e={},t=h(i,["sdkHttpResponse"]);return t!=null&&b(e,["sdkHttpResponse"],t),e}function O2(i){let e={};if(h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(i,["fileUri"]);t!=null&&b(e,["fileUri"],t);let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function U2(i){let e={},t=h(i,["id"]);t!=null&&b(e,["id"],t);let n=h(i,["args"]);n!=null&&b(e,["args"],n);let o=h(i,["name"]);if(o!=null&&b(e,["name"],o),h(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function G2(i){let e={},t=h(i,["mode"]);t!=null&&b(e,["mode"],t);let n=h(i,["allowedFunctionNames"]);if(n!=null&&b(e,["allowedFunctionNames"],n),h(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function $2(i){let e={};if(h(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=h(i,["description"]);t!=null&&b(e,["description"],t);let n=h(i,["name"]);n!=null&&b(e,["name"],n);let o=h(i,["parameters"]);o!=null&&b(e,["parameters"],o);let a=h(i,["parametersJsonSchema"]);a!=null&&b(e,["parametersJsonSchema"],a);let d=h(i,["response"]);d!=null&&b(e,["response"],d);let u=h(i,["responseJsonSchema"]);return u!=null&&b(e,["responseJsonSchema"],u),e}function H2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],ti(i,n)),t}function q2(i,e){let t={},n=h(e,["name"]);return n!=null&&b(t,["_url","name"],ti(i,n)),t}function W2(i){let e={};if(h(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(i,["enableWidget"]);return t!=null&&b(e,["enableWidget"],t),e}function z2(i){let e={};if(h(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(i,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],t),e}function K2(i,e){let t={},n=h(i,["pageSize"]);e!==void 0&&n!=null&&b(e,["_query","pageSize"],n);let o=h(i,["pageToken"]);return e!==void 0&&o!=null&&b(e,["_query","pageToken"],o),t}function j2(i,e){let t={},n=h(i,["pageSize"]);e!==void 0&&n!=null&&b(e,["_query","pageSize"],n);let o=h(i,["pageToken"]);return e!==void 0&&o!=null&&b(e,["_query","pageToken"],o),t}function J2(i){let e={},t=h(i,["config"]);return t!=null&&K2(t,e),e}function Q2(i){let e={},t=h(i,["config"]);return t!=null&&j2(t,e),e}function Y2(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["cachedContents"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["cachedContents"],a)}return e}function X2(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["cachedContents"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["cachedContents"],a)}return e}function Z2(i){let e={},t=h(i,["mediaResolution"]);t!=null&&b(e,["mediaResolution"],t);let n=h(i,["codeExecutionResult"]);n!=null&&b(e,["codeExecutionResult"],n);let o=h(i,["executableCode"]);o!=null&&b(e,["executableCode"],o);let a=h(i,["fileData"]);a!=null&&b(e,["fileData"],O2(a));let d=h(i,["functionCall"]);d!=null&&b(e,["functionCall"],U2(d));let u=h(i,["functionResponse"]);u!=null&&b(e,["functionResponse"],u);let p=h(i,["inlineData"]);p!=null&&b(e,["inlineData"],k2(p));let g=h(i,["text"]);g!=null&&b(e,["text"],g);let C=h(i,["thought"]);C!=null&&b(e,["thought"],C);let w=h(i,["thoughtSignature"]);w!=null&&b(e,["thoughtSignature"],w);let A=h(i,["videoMetadata"]);return A!=null&&b(e,["videoMetadata"],A),e}function eS(i){let e={},t=h(i,["functionCallingConfig"]);t!=null&&b(e,["functionCallingConfig"],G2(t));let n=h(i,["retrievalConfig"]);return n!=null&&b(e,["retrievalConfig"],n),e}function tS(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(w=>w)),b(e,["functionDeclarations"],C)}if(h(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(i,["googleSearchRetrieval"]);n!=null&&b(e,["googleSearchRetrieval"],n);let o=h(i,["computerUse"]);o!=null&&b(e,["computerUse"],o);let a=h(i,["fileSearch"]);a!=null&&b(e,["fileSearch"],a);let d=h(i,["codeExecution"]);if(d!=null&&b(e,["codeExecution"],d),h(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=h(i,["googleMaps"]);u!=null&&b(e,["googleMaps"],W2(u));let p=h(i,["googleSearch"]);p!=null&&b(e,["googleSearch"],z2(p));let g=h(i,["urlContext"]);return g!=null&&b(e,["urlContext"],g),e}function nS(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let w=t;Array.isArray(w)&&(w=w.map(A=>$2(A))),b(e,["functionDeclarations"],w)}let n=h(i,["retrieval"]);n!=null&&b(e,["retrieval"],n);let o=h(i,["googleSearchRetrieval"]);o!=null&&b(e,["googleSearchRetrieval"],o);let a=h(i,["computerUse"]);if(a!=null&&b(e,["computerUse"],a),h(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let d=h(i,["codeExecution"]);d!=null&&b(e,["codeExecution"],d);let u=h(i,["enterpriseWebSearch"]);u!=null&&b(e,["enterpriseWebSearch"],u);let p=h(i,["googleMaps"]);p!=null&&b(e,["googleMaps"],p);let g=h(i,["googleSearch"]);g!=null&&b(e,["googleSearch"],g);let C=h(i,["urlContext"]);return C!=null&&b(e,["urlContext"],C),e}function iS(i,e){let t={},n=h(i,["ttl"]);e!==void 0&&n!=null&&b(e,["ttl"],n);let o=h(i,["expireTime"]);return e!==void 0&&o!=null&&b(e,["expireTime"],o),t}function oS(i,e){let t={},n=h(i,["ttl"]);e!==void 0&&n!=null&&b(e,["ttl"],n);let o=h(i,["expireTime"]);return e!==void 0&&o!=null&&b(e,["expireTime"],o),t}function rS(i,e){let t={},n=h(e,["name"]);n!=null&&b(t,["_url","name"],ti(i,n));let o=h(e,["config"]);return o!=null&&iS(o,t),t}function sS(i,e){let t={},n=h(e,["name"]);n!=null&&b(t,["_url","name"],ti(i,n));let o=h(e,["config"]);return o!=null&&oS(o,t),t}var M0=class extends Tn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ei(yi.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=R2(this.apiClient,e);return u=fe("cachedContents",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>C)}else{let g=P2(this.apiClient,e);return u=fe("cachedContents",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>C)}}async get(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=q2(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>C)}else{let g=H2(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>C)}}async delete(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=V2(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=L2(C),A=new hl;return Object.assign(A,w),A})}else{let g=N2(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=B2(C),A=new hl;return Object.assign(A,w),A})}}async update(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=sS(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>C)}else{let g=rS(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>C)}}async listInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=Q2(e);return u=fe("cachedContents",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=X2(C),A=new fl;return Object.assign(A,w),A})}else{let g=J2(e);return u=fe("cachedContents",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=Y2(C),A=new fl;return Object.assign(A,w),A})}}};function xl(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(i);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(i,n[o])&&(t[n[o]]=i[n[o]]);return t}function Af(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(i){return this instanceof Te?(this.v=i,this):new Te(i)}function An(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),o,a=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",d),o[Symbol.asyncIterator]=function(){return this},o;function d(V){return function(G){return Promise.resolve(G).then(V,w)}}function u(V,G){n[V]&&(o[V]=function(z){return new Promise(function($,K){a.push([V,z,$,K])>1||p(V,z)})},G&&(o[V]=G(o[V])))}function p(V,G){try{g(n[V](G))}catch(z){A(a[0][3],z)}}function g(V){V.value instanceof Te?Promise.resolve(V.value.v).then(C,w):A(a[0][2],V)}function C(V){p("next",V)}function w(V){p("throw",V)}function A(V,G){V(G),a.shift(),a.length&&p(a[0][0],a[0][1])}}function Mn(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Af=="function"?Af(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=i[a]&&function(d){return new Promise(function(u,p){d=i[a](d),o(u,p,d.done,d.value)})}}function o(a,d,u,p){Promise.resolve(p).then(function(g){a({value:g,done:u})},d)}}function aS(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:l_(t)}function l_(i){if(i.parts===void 0||i.parts.length===0)return!1;for(let e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function lS(i){if(i.length!==0){for(let e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Mf(i){if(i===void 0||i.length===0)return[];let e=[],t=i.length,n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{let o=[],a=!0;for(;n<t&&i[n].role==="model";)o.push(i[n]),a&&!l_(i[n])&&(a=!1),n++;a?e.push(...o):e.pop()}return e}var T0=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new k0(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},k0=class{constructor(e,t,n,o={},a=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=o,this.history=a,this.sendPromise=Promise.resolve(),lS(a)}async sendMessage(e){var t;await this.sendPromise;let n=At(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var a,d,u;let p=await o,g=(d=(a=p.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content,C=p.automaticFunctionCallingHistory,w=this.getHistory(!0).length,A=[];C!=null&&(A=(u=C.slice(w))!==null&&u!==void 0?u:[]);let V=g?[g]:[];this.recordHistory(n,V,A)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;let n=At(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});let a=await o;return this.processStreamResponse(a,n)}getHistory(e=!1){let t=e?Mf(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return An(this,arguments,function*(){var o,a,d,u,p,g;let C=[];try{for(var w=!0,A=Mn(e),V;V=yield Te(A.next()),o=V.done,!o;w=!0){u=V.value,w=!1;let G=u;if(aS(G)){let z=(g=(p=G.candidates)===null||p===void 0?void 0:p[0])===null||g===void 0?void 0:g.content;z!==void 0&&C.push(z)}yield yield Te(G)}}catch(G){a={error:G}}finally{try{!w&&!o&&(d=A.return)&&(yield Te(d.call(A)))}finally{if(a)throw a.error}}this.recordHistory(t,C)})}recordHistory(e,t,n){let o=[];t.length>0&&t.every(a=>a.role!==void 0)?o=t:o.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...Mf(n)):this.history.push(e),this.history.push(...o)}};var Cl=class i extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,i.prototype)}};function cS(i){let e={},t=h(i,["file"]);return t!=null&&b(e,["file"],t),e}function dS(i){let e={},t=h(i,["sdkHttpResponse"]);return t!=null&&b(e,["sdkHttpResponse"],t),e}function uS(i){let e={},t=h(i,["name"]);return t!=null&&b(e,["_url","file"],t_(t)),e}function mS(i){let e={},t=h(i,["sdkHttpResponse"]);return t!=null&&b(e,["sdkHttpResponse"],t),e}function pS(i){let e={},t=h(i,["name"]);return t!=null&&b(e,["_url","file"],t_(t)),e}function gS(i,e){let t={},n=h(i,["pageSize"]);e!==void 0&&n!=null&&b(e,["_query","pageSize"],n);let o=h(i,["pageToken"]);return e!==void 0&&o!=null&&b(e,["_query","pageToken"],o),t}function hS(i){let e={},t=h(i,["config"]);return t!=null&&gS(t,e),e}function fS(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["files"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["files"],a)}return e}var I0=class extends Tn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ei(yi.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=hS(e);return a=fe("files",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(g=>{let C=g;return C.sdkHttpResponse={headers:p.headers},C})),o.then(p=>{let g=fS(p),C=new x0;return Object.assign(C,g),C})}}async createInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=cS(e);return a=fe("upload/v1beta/files",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>{let g=dS(p),C=new C0;return Object.assign(C,g),C})}}async get(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=pS(e);return a=fe("files/{file}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>p)}}async delete(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=uS(e);return a=fe("files/{file}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(g=>{let C=g;return C.sdkHttpResponse={headers:p.headers},C})),o.then(p=>{let g=mS(p),C=new b0;return Object.assign(C,g),C})}}};function sl(i){let e={},t=h(i,["data"]);if(t!=null&&b(e,["data"],t),h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function _S(i){let e={},t=h(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>PS(a))),b(e,["parts"],o)}let n=h(i,["role"]);return n!=null&&b(e,["role"],n),e}function vS(i){let e={};if(h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(i,["fileUri"]);t!=null&&b(e,["fileUri"],t);let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function xS(i){let e={},t=h(i,["id"]);t!=null&&b(e,["id"],t);let n=h(i,["args"]);n!=null&&b(e,["args"],n);let o=h(i,["name"]);if(o!=null&&b(e,["name"],o),h(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function CS(i){let e={};if(h(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=h(i,["description"]);t!=null&&b(e,["description"],t);let n=h(i,["name"]);n!=null&&b(e,["name"],n);let o=h(i,["parameters"]);o!=null&&b(e,["parameters"],o);let a=h(i,["parametersJsonSchema"]);a!=null&&b(e,["parametersJsonSchema"],a);let d=h(i,["response"]);d!=null&&b(e,["response"],d);let u=h(i,["responseJsonSchema"]);return u!=null&&b(e,["responseJsonSchema"],u),e}function bS(i){let e={},t=h(i,["modelSelectionConfig"]);t!=null&&b(e,["modelConfig"],t);let n=h(i,["responseJsonSchema"]);n!=null&&b(e,["responseJsonSchema"],n);let o=h(i,["audioTimestamp"]);o!=null&&b(e,["audioTimestamp"],o);let a=h(i,["candidateCount"]);a!=null&&b(e,["candidateCount"],a);let d=h(i,["enableAffectiveDialog"]);d!=null&&b(e,["enableAffectiveDialog"],d);let u=h(i,["frequencyPenalty"]);u!=null&&b(e,["frequencyPenalty"],u);let p=h(i,["logprobs"]);p!=null&&b(e,["logprobs"],p);let g=h(i,["maxOutputTokens"]);g!=null&&b(e,["maxOutputTokens"],g);let C=h(i,["mediaResolution"]);C!=null&&b(e,["mediaResolution"],C);let w=h(i,["presencePenalty"]);w!=null&&b(e,["presencePenalty"],w);let A=h(i,["responseLogprobs"]);A!=null&&b(e,["responseLogprobs"],A);let V=h(i,["responseMimeType"]);V!=null&&b(e,["responseMimeType"],V);let G=h(i,["responseModalities"]);G!=null&&b(e,["responseModalities"],G);let z=h(i,["responseSchema"]);z!=null&&b(e,["responseSchema"],z);let $=h(i,["routingConfig"]);$!=null&&b(e,["routingConfig"],$);let K=h(i,["seed"]);K!=null&&b(e,["seed"],K);let Z=h(i,["speechConfig"]);Z!=null&&b(e,["speechConfig"],Z);let Y=h(i,["stopSequences"]);Y!=null&&b(e,["stopSequences"],Y);let re=h(i,["temperature"]);re!=null&&b(e,["temperature"],re);let le=h(i,["thinkingConfig"]);le!=null&&b(e,["thinkingConfig"],le);let ue=h(i,["topK"]);ue!=null&&b(e,["topK"],ue);let pe=h(i,["topP"]);if(pe!=null&&b(e,["topP"],pe),h(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function yS(i){let e={};if(h(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(i,["enableWidget"]);return t!=null&&b(e,["enableWidget"],t),e}function SS(i){let e={};if(h(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(i,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],t),e}function wS(i,e){let t={},n=h(i,["generationConfig"]);e!==void 0&&n!=null&&b(e,["setup","generationConfig"],n);let o=h(i,["responseModalities"]);e!==void 0&&o!=null&&b(e,["setup","generationConfig","responseModalities"],o);let a=h(i,["temperature"]);e!==void 0&&a!=null&&b(e,["setup","generationConfig","temperature"],a);let d=h(i,["topP"]);e!==void 0&&d!=null&&b(e,["setup","generationConfig","topP"],d);let u=h(i,["topK"]);e!==void 0&&u!=null&&b(e,["setup","generationConfig","topK"],u);let p=h(i,["maxOutputTokens"]);e!==void 0&&p!=null&&b(e,["setup","generationConfig","maxOutputTokens"],p);let g=h(i,["mediaResolution"]);e!==void 0&&g!=null&&b(e,["setup","generationConfig","mediaResolution"],g);let C=h(i,["seed"]);e!==void 0&&C!=null&&b(e,["setup","generationConfig","seed"],C);let w=h(i,["speechConfig"]);e!==void 0&&w!=null&&b(e,["setup","generationConfig","speechConfig"],dm(w));let A=h(i,["thinkingConfig"]);e!==void 0&&A!=null&&b(e,["setup","generationConfig","thinkingConfig"],A);let V=h(i,["enableAffectiveDialog"]);e!==void 0&&V!=null&&b(e,["setup","generationConfig","enableAffectiveDialog"],V);let G=h(i,["systemInstruction"]);e!==void 0&&G!=null&&b(e,["setup","systemInstruction"],_S(At(G)));let z=h(i,["tools"]);if(e!==void 0&&z!=null){let ue=Go(z);Array.isArray(ue)&&(ue=ue.map(pe=>NS(Uo(pe)))),b(e,["setup","tools"],ue)}let $=h(i,["sessionResumption"]);e!==void 0&&$!=null&&b(e,["setup","sessionResumption"],RS($));let K=h(i,["inputAudioTranscription"]);e!==void 0&&K!=null&&b(e,["setup","inputAudioTranscription"],K);let Z=h(i,["outputAudioTranscription"]);e!==void 0&&Z!=null&&b(e,["setup","outputAudioTranscription"],Z);let Y=h(i,["realtimeInputConfig"]);e!==void 0&&Y!=null&&b(e,["setup","realtimeInputConfig"],Y);let re=h(i,["contextWindowCompression"]);e!==void 0&&re!=null&&b(e,["setup","contextWindowCompression"],re);let le=h(i,["proactivity"]);if(e!==void 0&&le!=null&&b(e,["setup","proactivity"],le),h(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function ES(i,e){let t={},n=h(i,["generationConfig"]);e!==void 0&&n!=null&&b(e,["setup","generationConfig"],bS(n));let o=h(i,["responseModalities"]);e!==void 0&&o!=null&&b(e,["setup","generationConfig","responseModalities"],o);let a=h(i,["temperature"]);e!==void 0&&a!=null&&b(e,["setup","generationConfig","temperature"],a);let d=h(i,["topP"]);e!==void 0&&d!=null&&b(e,["setup","generationConfig","topP"],d);let u=h(i,["topK"]);e!==void 0&&u!=null&&b(e,["setup","generationConfig","topK"],u);let p=h(i,["maxOutputTokens"]);e!==void 0&&p!=null&&b(e,["setup","generationConfig","maxOutputTokens"],p);let g=h(i,["mediaResolution"]);e!==void 0&&g!=null&&b(e,["setup","generationConfig","mediaResolution"],g);let C=h(i,["seed"]);e!==void 0&&C!=null&&b(e,["setup","generationConfig","seed"],C);let w=h(i,["speechConfig"]);e!==void 0&&w!=null&&b(e,["setup","generationConfig","speechConfig"],dm(w));let A=h(i,["thinkingConfig"]);e!==void 0&&A!=null&&b(e,["setup","generationConfig","thinkingConfig"],A);let V=h(i,["enableAffectiveDialog"]);e!==void 0&&V!=null&&b(e,["setup","generationConfig","enableAffectiveDialog"],V);let G=h(i,["systemInstruction"]);e!==void 0&&G!=null&&b(e,["setup","systemInstruction"],At(G));let z=h(i,["tools"]);if(e!==void 0&&z!=null){let pe=Go(z);Array.isArray(pe)&&(pe=pe.map(Fe=>VS(Uo(Fe)))),b(e,["setup","tools"],pe)}let $=h(i,["sessionResumption"]);e!==void 0&&$!=null&&b(e,["setup","sessionResumption"],$);let K=h(i,["inputAudioTranscription"]);e!==void 0&&K!=null&&b(e,["setup","inputAudioTranscription"],K);let Z=h(i,["outputAudioTranscription"]);e!==void 0&&Z!=null&&b(e,["setup","outputAudioTranscription"],Z);let Y=h(i,["realtimeInputConfig"]);e!==void 0&&Y!=null&&b(e,["setup","realtimeInputConfig"],Y);let re=h(i,["contextWindowCompression"]);e!==void 0&&re!=null&&b(e,["setup","contextWindowCompression"],re);let le=h(i,["proactivity"]);e!==void 0&&le!=null&&b(e,["setup","proactivity"],le);let ue=h(i,["explicitVadSignal"]);return e!==void 0&&ue!=null&&b(e,["setup","explicitVadSignal"],ue),t}function DS(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["setup","model"],We(i,n));let o=h(e,["config"]);return o!=null&&b(t,["config"],wS(o,t)),t}function AS(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["setup","model"],We(i,n));let o=h(e,["config"]);return o!=null&&b(t,["config"],ES(o,t)),t}function MS(i){let e={},t=h(i,["musicGenerationConfig"]);return t!=null&&b(e,["musicGenerationConfig"],t),e}function TS(i){let e={},t=h(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),b(e,["weightedPrompts"],n)}return e}function kS(i){let e={},t=h(i,["media"]);if(t!=null){let g=Qf(t);Array.isArray(g)&&(g=g.map(C=>sl(C))),b(e,["mediaChunks"],g)}let n=h(i,["audio"]);n!=null&&b(e,["audio"],sl(Xf(n)));let o=h(i,["audioStreamEnd"]);o!=null&&b(e,["audioStreamEnd"],o);let a=h(i,["video"]);a!=null&&b(e,["video"],sl(Yf(a)));let d=h(i,["text"]);d!=null&&b(e,["text"],d);let u=h(i,["activityStart"]);u!=null&&b(e,["activityStart"],u);let p=h(i,["activityEnd"]);return p!=null&&b(e,["activityEnd"],p),e}function IS(i){let e={},t=h(i,["media"]);if(t!=null){let g=Qf(t);Array.isArray(g)&&(g=g.map(C=>C)),b(e,["mediaChunks"],g)}let n=h(i,["audio"]);n!=null&&b(e,["audio"],Xf(n));let o=h(i,["audioStreamEnd"]);o!=null&&b(e,["audioStreamEnd"],o);let a=h(i,["video"]);a!=null&&b(e,["video"],Yf(a));let d=h(i,["text"]);d!=null&&b(e,["text"],d);let u=h(i,["activityStart"]);u!=null&&b(e,["activityStart"],u);let p=h(i,["activityEnd"]);return p!=null&&b(e,["activityEnd"],p),e}function FS(i){let e={},t=h(i,["setupComplete"]);t!=null&&b(e,["setupComplete"],t);let n=h(i,["serverContent"]);n!=null&&b(e,["serverContent"],n);let o=h(i,["toolCall"]);o!=null&&b(e,["toolCall"],o);let a=h(i,["toolCallCancellation"]);a!=null&&b(e,["toolCallCancellation"],a);let d=h(i,["usageMetadata"]);d!=null&&b(e,["usageMetadata"],BS(d));let u=h(i,["goAway"]);u!=null&&b(e,["goAway"],u);let p=h(i,["sessionResumptionUpdate"]);p!=null&&b(e,["sessionResumptionUpdate"],p);let g=h(i,["voiceActivityDetectionSignal"]);return g!=null&&b(e,["voiceActivityDetectionSignal"],g),e}function PS(i){let e={},t=h(i,["mediaResolution"]);t!=null&&b(e,["mediaResolution"],t);let n=h(i,["codeExecutionResult"]);n!=null&&b(e,["codeExecutionResult"],n);let o=h(i,["executableCode"]);o!=null&&b(e,["executableCode"],o);let a=h(i,["fileData"]);a!=null&&b(e,["fileData"],vS(a));let d=h(i,["functionCall"]);d!=null&&b(e,["functionCall"],xS(d));let u=h(i,["functionResponse"]);u!=null&&b(e,["functionResponse"],u);let p=h(i,["inlineData"]);p!=null&&b(e,["inlineData"],sl(p));let g=h(i,["text"]);g!=null&&b(e,["text"],g);let C=h(i,["thought"]);C!=null&&b(e,["thought"],C);let w=h(i,["thoughtSignature"]);w!=null&&b(e,["thoughtSignature"],w);let A=h(i,["videoMetadata"]);return A!=null&&b(e,["videoMetadata"],A),e}function RS(i){let e={},t=h(i,["handle"]);if(t!=null&&b(e,["handle"],t),h(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function NS(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(w=>w)),b(e,["functionDeclarations"],C)}if(h(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(i,["googleSearchRetrieval"]);n!=null&&b(e,["googleSearchRetrieval"],n);let o=h(i,["computerUse"]);o!=null&&b(e,["computerUse"],o);let a=h(i,["fileSearch"]);a!=null&&b(e,["fileSearch"],a);let d=h(i,["codeExecution"]);if(d!=null&&b(e,["codeExecution"],d),h(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=h(i,["googleMaps"]);u!=null&&b(e,["googleMaps"],yS(u));let p=h(i,["googleSearch"]);p!=null&&b(e,["googleSearch"],SS(p));let g=h(i,["urlContext"]);return g!=null&&b(e,["urlContext"],g),e}function VS(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let w=t;Array.isArray(w)&&(w=w.map(A=>CS(A))),b(e,["functionDeclarations"],w)}let n=h(i,["retrieval"]);n!=null&&b(e,["retrieval"],n);let o=h(i,["googleSearchRetrieval"]);o!=null&&b(e,["googleSearchRetrieval"],o);let a=h(i,["computerUse"]);if(a!=null&&b(e,["computerUse"],a),h(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let d=h(i,["codeExecution"]);d!=null&&b(e,["codeExecution"],d);let u=h(i,["enterpriseWebSearch"]);u!=null&&b(e,["enterpriseWebSearch"],u);let p=h(i,["googleMaps"]);p!=null&&b(e,["googleMaps"],p);let g=h(i,["googleSearch"]);g!=null&&b(e,["googleSearch"],g);let C=h(i,["urlContext"]);return C!=null&&b(e,["urlContext"],C),e}function BS(i){let e={},t=h(i,["promptTokenCount"]);t!=null&&b(e,["promptTokenCount"],t);let n=h(i,["cachedContentTokenCount"]);n!=null&&b(e,["cachedContentTokenCount"],n);let o=h(i,["candidatesTokenCount"]);o!=null&&b(e,["responseTokenCount"],o);let a=h(i,["toolUsePromptTokenCount"]);a!=null&&b(e,["toolUsePromptTokenCount"],a);let d=h(i,["thoughtsTokenCount"]);d!=null&&b(e,["thoughtsTokenCount"],d);let u=h(i,["totalTokenCount"]);u!=null&&b(e,["totalTokenCount"],u);let p=h(i,["promptTokensDetails"]);if(p!=null){let V=p;Array.isArray(V)&&(V=V.map(G=>G)),b(e,["promptTokensDetails"],V)}let g=h(i,["cacheTokensDetails"]);if(g!=null){let V=g;Array.isArray(V)&&(V=V.map(G=>G)),b(e,["cacheTokensDetails"],V)}let C=h(i,["candidatesTokensDetails"]);if(C!=null){let V=C;Array.isArray(V)&&(V=V.map(G=>G)),b(e,["responseTokensDetails"],V)}let w=h(i,["toolUsePromptTokensDetails"]);if(w!=null){let V=w;Array.isArray(V)&&(V=V.map(G=>G)),b(e,["toolUsePromptTokensDetails"],V)}let A=h(i,["trafficType"]);return A!=null&&b(e,["trafficType"],A),e}function LS(i){let e={},t=h(i,["data"]);if(t!=null&&b(e,["data"],t),h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function OS(i){let e={},t=h(i,["content"]);t!=null&&b(e,["content"],t);let n=h(i,["citationMetadata"]);n!=null&&b(e,["citationMetadata"],US(n));let o=h(i,["tokenCount"]);o!=null&&b(e,["tokenCount"],o);let a=h(i,["finishReason"]);a!=null&&b(e,["finishReason"],a);let d=h(i,["avgLogprobs"]);d!=null&&b(e,["avgLogprobs"],d);let u=h(i,["groundingMetadata"]);u!=null&&b(e,["groundingMetadata"],u);let p=h(i,["index"]);p!=null&&b(e,["index"],p);let g=h(i,["logprobsResult"]);g!=null&&b(e,["logprobsResult"],g);let C=h(i,["safetyRatings"]);if(C!=null){let A=C;Array.isArray(A)&&(A=A.map(V=>V)),b(e,["safetyRatings"],A)}let w=h(i,["urlContextMetadata"]);return w!=null&&b(e,["urlContextMetadata"],w),e}function US(i){let e={},t=h(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),b(e,["citations"],n)}return e}function GS(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let a=fn(o);Array.isArray(a)&&(a=a.map(d=>d)),b(t,["contents"],a)}return t}function $S(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["tokensInfo"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),b(e,["tokensInfo"],o)}return e}function HS(i){let e={},t=h(i,["values"]);t!=null&&b(e,["values"],t);let n=h(i,["statistics"]);return n!=null&&b(e,["statistics"],qS(n)),e}function qS(i){let e={},t=h(i,["truncated"]);t!=null&&b(e,["truncated"],t);let n=h(i,["token_count"]);return n!=null&&b(e,["tokenCount"],n),e}function Nl(i){let e={},t=h(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>Z5(a))),b(e,["parts"],o)}let n=h(i,["role"]);return n!=null&&b(e,["role"],n),e}function WS(i){let e={},t=h(i,["controlType"]);t!=null&&b(e,["controlType"],t);let n=h(i,["enableControlImageComputation"]);return n!=null&&b(e,["computeControl"],n),e}function zS(i){let e={};if(h(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(h(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(h(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function KS(i,e){let t={},n=h(i,["systemInstruction"]);e!==void 0&&n!=null&&b(e,["systemInstruction"],At(n));let o=h(i,["tools"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(u=>m_(u))),b(e,["tools"],d)}let a=h(i,["generationConfig"]);return e!==void 0&&a!=null&&b(e,["generationConfig"],L5(a)),t}function jS(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let d=fn(o);Array.isArray(d)&&(d=d.map(u=>Nl(u))),b(t,["contents"],d)}let a=h(e,["config"]);return a!=null&&zS(a),t}function JS(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let d=fn(o);Array.isArray(d)&&(d=d.map(u=>u)),b(t,["contents"],d)}let a=h(e,["config"]);return a!=null&&KS(a,t),t}function QS(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["totalTokens"]);n!=null&&b(e,["totalTokens"],n);let o=h(i,["cachedContentTokenCount"]);return o!=null&&b(e,["cachedContentTokenCount"],o),e}function YS(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["totalTokens"]);return n!=null&&b(e,["totalTokens"],n),e}function XS(i,e){let t={},n=h(e,["model"]);return n!=null&&b(t,["_url","name"],We(i,n)),t}function ZS(i,e){let t={},n=h(e,["model"]);return n!=null&&b(t,["_url","name"],We(i,n)),t}function e5(i){let e={},t=h(i,["sdkHttpResponse"]);return t!=null&&b(e,["sdkHttpResponse"],t),e}function t5(i){let e={},t=h(i,["sdkHttpResponse"]);return t!=null&&b(e,["sdkHttpResponse"],t),e}function n5(i,e){let t={},n=h(i,["outputGcsUri"]);e!==void 0&&n!=null&&b(e,["parameters","storageUri"],n);let o=h(i,["negativePrompt"]);e!==void 0&&o!=null&&b(e,["parameters","negativePrompt"],o);let a=h(i,["numberOfImages"]);e!==void 0&&a!=null&&b(e,["parameters","sampleCount"],a);let d=h(i,["aspectRatio"]);e!==void 0&&d!=null&&b(e,["parameters","aspectRatio"],d);let u=h(i,["guidanceScale"]);e!==void 0&&u!=null&&b(e,["parameters","guidanceScale"],u);let p=h(i,["seed"]);e!==void 0&&p!=null&&b(e,["parameters","seed"],p);let g=h(i,["safetyFilterLevel"]);e!==void 0&&g!=null&&b(e,["parameters","safetySetting"],g);let C=h(i,["personGeneration"]);e!==void 0&&C!=null&&b(e,["parameters","personGeneration"],C);let w=h(i,["includeSafetyAttributes"]);e!==void 0&&w!=null&&b(e,["parameters","includeSafetyAttributes"],w);let A=h(i,["includeRaiReason"]);e!==void 0&&A!=null&&b(e,["parameters","includeRaiReason"],A);let V=h(i,["language"]);e!==void 0&&V!=null&&b(e,["parameters","language"],V);let G=h(i,["outputMimeType"]);e!==void 0&&G!=null&&b(e,["parameters","outputOptions","mimeType"],G);let z=h(i,["outputCompressionQuality"]);e!==void 0&&z!=null&&b(e,["parameters","outputOptions","compressionQuality"],z);let $=h(i,["addWatermark"]);e!==void 0&&$!=null&&b(e,["parameters","addWatermark"],$);let K=h(i,["labels"]);e!==void 0&&K!=null&&b(e,["labels"],K);let Z=h(i,["editMode"]);e!==void 0&&Z!=null&&b(e,["parameters","editMode"],Z);let Y=h(i,["baseSteps"]);return e!==void 0&&Y!=null&&b(e,["parameters","editConfig","baseSteps"],Y),t}function i5(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["prompt"]);o!=null&&b(t,["instances[0]","prompt"],o);let a=h(e,["referenceImages"]);if(a!=null){let u=a;Array.isArray(u)&&(u=u.map(p=>rw(p))),b(t,["instances[0]","referenceImages"],u)}let d=h(e,["config"]);return d!=null&&n5(d,t),t}function o5(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>Vl(a))),b(e,["generatedImages"],o)}return e}function r5(i,e){let t={},n=h(i,["taskType"]);e!==void 0&&n!=null&&b(e,["requests[]","taskType"],n);let o=h(i,["title"]);e!==void 0&&o!=null&&b(e,["requests[]","title"],o);let a=h(i,["outputDimensionality"]);if(e!==void 0&&a!=null&&b(e,["requests[]","outputDimensionality"],a),h(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function s5(i,e){let t={},n=h(i,["taskType"]);e!==void 0&&n!=null&&b(e,["instances[]","task_type"],n);let o=h(i,["title"]);e!==void 0&&o!=null&&b(e,["instances[]","title"],o);let a=h(i,["outputDimensionality"]);e!==void 0&&a!=null&&b(e,["parameters","outputDimensionality"],a);let d=h(i,["mimeType"]);e!==void 0&&d!=null&&b(e,["instances[]","mimeType"],d);let u=h(i,["autoTruncate"]);return e!==void 0&&u!=null&&b(e,["parameters","autoTruncate"],u),t}function a5(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let u=am(i,o);Array.isArray(u)&&(u=u.map(p=>p)),b(t,["requests[]","content"],u)}let a=h(e,["config"]);a!=null&&r5(a,t);let d=h(e,["model"]);return d!==void 0&&b(t,["requests[]","model"],We(i,d)),t}function l5(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let d=am(i,o);Array.isArray(d)&&(d=d.map(u=>u)),b(t,["instances[]","content"],d)}let a=h(e,["config"]);return a!=null&&s5(a,t),t}function c5(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["embeddings"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["embeddings"],a)}let o=h(i,["metadata"]);return o!=null&&b(e,["metadata"],o),e}function d5(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["predictions[]","embeddings"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>HS(d))),b(e,["embeddings"],a)}let o=h(i,["metadata"]);return o!=null&&b(e,["metadata"],o),e}function u5(i){let e={},t=h(i,["endpoint"]);t!=null&&b(e,["name"],t);let n=h(i,["deployedModelId"]);return n!=null&&b(e,["deployedModelId"],n),e}function m5(i){let e={};if(h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(i,["fileUri"]);t!=null&&b(e,["fileUri"],t);let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function p5(i){let e={},t=h(i,["id"]);t!=null&&b(e,["id"],t);let n=h(i,["args"]);n!=null&&b(e,["args"],n);let o=h(i,["name"]);if(o!=null&&b(e,["name"],o),h(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function g5(i){let e={},t=h(i,["mode"]);t!=null&&b(e,["mode"],t);let n=h(i,["allowedFunctionNames"]);if(n!=null&&b(e,["allowedFunctionNames"],n),h(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function h5(i){let e={};if(h(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=h(i,["description"]);t!=null&&b(e,["description"],t);let n=h(i,["name"]);n!=null&&b(e,["name"],n);let o=h(i,["parameters"]);o!=null&&b(e,["parameters"],o);let a=h(i,["parametersJsonSchema"]);a!=null&&b(e,["parametersJsonSchema"],a);let d=h(i,["response"]);d!=null&&b(e,["response"],d);let u=h(i,["responseJsonSchema"]);return u!=null&&b(e,["responseJsonSchema"],u),e}function f5(i,e,t){let n={},o=h(e,["systemInstruction"]);t!==void 0&&o!=null&&b(t,["systemInstruction"],Nl(At(o)));let a=h(e,["temperature"]);a!=null&&b(n,["temperature"],a);let d=h(e,["topP"]);d!=null&&b(n,["topP"],d);let u=h(e,["topK"]);u!=null&&b(n,["topK"],u);let p=h(e,["candidateCount"]);p!=null&&b(n,["candidateCount"],p);let g=h(e,["maxOutputTokens"]);g!=null&&b(n,["maxOutputTokens"],g);let C=h(e,["stopSequences"]);C!=null&&b(n,["stopSequences"],C);let w=h(e,["responseLogprobs"]);w!=null&&b(n,["responseLogprobs"],w);let A=h(e,["logprobs"]);A!=null&&b(n,["logprobs"],A);let V=h(e,["presencePenalty"]);V!=null&&b(n,["presencePenalty"],V);let G=h(e,["frequencyPenalty"]);G!=null&&b(n,["frequencyPenalty"],G);let z=h(e,["seed"]);z!=null&&b(n,["seed"],z);let $=h(e,["responseMimeType"]);$!=null&&b(n,["responseMimeType"],$);let K=h(e,["responseSchema"]);K!=null&&b(n,["responseSchema"],lm(K));let Z=h(e,["responseJsonSchema"]);if(Z!=null&&b(n,["responseJsonSchema"],Z),h(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let Y=h(e,["safetySettings"]);if(t!==void 0&&Y!=null){let Xe=Y;Array.isArray(Xe)&&(Xe=Xe.map(Qt=>sw(Qt))),b(t,["safetySettings"],Xe)}let re=h(e,["tools"]);if(t!==void 0&&re!=null){let Xe=Go(re);Array.isArray(Xe)&&(Xe=Xe.map(Qt=>pw(Uo(Qt)))),b(t,["tools"],Xe)}let le=h(e,["toolConfig"]);if(t!==void 0&&le!=null&&b(t,["toolConfig"],mw(le)),h(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let ue=h(e,["cachedContent"]);t!==void 0&&ue!=null&&b(t,["cachedContent"],ti(i,ue));let pe=h(e,["responseModalities"]);pe!=null&&b(n,["responseModalities"],pe);let Fe=h(e,["mediaResolution"]);Fe!=null&&b(n,["mediaResolution"],Fe);let we=h(e,["speechConfig"]);if(we!=null&&b(n,["speechConfig"],cm(we)),h(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let Pe=h(e,["thinkingConfig"]);Pe!=null&&b(n,["thinkingConfig"],Pe);let at=h(e,["imageConfig"]);at!=null&&b(n,["imageConfig"],H5(at));let wt=h(e,["enableEnhancedCivicAnswers"]);return wt!=null&&b(n,["enableEnhancedCivicAnswers"],wt),n}function _5(i,e,t){let n={},o=h(e,["systemInstruction"]);t!==void 0&&o!=null&&b(t,["systemInstruction"],At(o));let a=h(e,["temperature"]);a!=null&&b(n,["temperature"],a);let d=h(e,["topP"]);d!=null&&b(n,["topP"],d);let u=h(e,["topK"]);u!=null&&b(n,["topK"],u);let p=h(e,["candidateCount"]);p!=null&&b(n,["candidateCount"],p);let g=h(e,["maxOutputTokens"]);g!=null&&b(n,["maxOutputTokens"],g);let C=h(e,["stopSequences"]);C!=null&&b(n,["stopSequences"],C);let w=h(e,["responseLogprobs"]);w!=null&&b(n,["responseLogprobs"],w);let A=h(e,["logprobs"]);A!=null&&b(n,["logprobs"],A);let V=h(e,["presencePenalty"]);V!=null&&b(n,["presencePenalty"],V);let G=h(e,["frequencyPenalty"]);G!=null&&b(n,["frequencyPenalty"],G);let z=h(e,["seed"]);z!=null&&b(n,["seed"],z);let $=h(e,["responseMimeType"]);$!=null&&b(n,["responseMimeType"],$);let K=h(e,["responseSchema"]);K!=null&&b(n,["responseSchema"],lm(K));let Z=h(e,["responseJsonSchema"]);Z!=null&&b(n,["responseJsonSchema"],Z);let Y=h(e,["routingConfig"]);Y!=null&&b(n,["routingConfig"],Y);let re=h(e,["modelSelectionConfig"]);re!=null&&b(n,["modelConfig"],re);let le=h(e,["safetySettings"]);if(t!==void 0&&le!=null){let _e=le;Array.isArray(_e)&&(_e=_e.map(ye=>ye)),b(t,["safetySettings"],_e)}let ue=h(e,["tools"]);if(t!==void 0&&ue!=null){let _e=Go(ue);Array.isArray(_e)&&(_e=_e.map(ye=>m_(Uo(ye)))),b(t,["tools"],_e)}let pe=h(e,["toolConfig"]);t!==void 0&&pe!=null&&b(t,["toolConfig"],pe);let Fe=h(e,["labels"]);t!==void 0&&Fe!=null&&b(t,["labels"],Fe);let we=h(e,["cachedContent"]);t!==void 0&&we!=null&&b(t,["cachedContent"],ti(i,we));let Pe=h(e,["responseModalities"]);Pe!=null&&b(n,["responseModalities"],Pe);let at=h(e,["mediaResolution"]);at!=null&&b(n,["mediaResolution"],at);let wt=h(e,["speechConfig"]);wt!=null&&b(n,["speechConfig"],cm(wt));let Xe=h(e,["audioTimestamp"]);Xe!=null&&b(n,["audioTimestamp"],Xe);let Qt=h(e,["thinkingConfig"]);Qt!=null&&b(n,["thinkingConfig"],Qt);let rr=h(e,["imageConfig"]);if(rr!=null&&b(n,["imageConfig"],q5(rr)),h(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function Tf(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let d=fn(o);Array.isArray(d)&&(d=d.map(u=>Nl(u))),b(t,["contents"],d)}let a=h(e,["config"]);return a!=null&&b(t,["generationConfig"],f5(i,a,t)),t}function kf(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["contents"]);if(o!=null){let d=fn(o);Array.isArray(d)&&(d=d.map(u=>u)),b(t,["contents"],d)}let a=h(e,["config"]);return a!=null&&b(t,["generationConfig"],_5(i,a,t)),t}function If(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["candidates"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(g=>OS(g))),b(e,["candidates"],p)}let o=h(i,["modelVersion"]);o!=null&&b(e,["modelVersion"],o);let a=h(i,["promptFeedback"]);a!=null&&b(e,["promptFeedback"],a);let d=h(i,["responseId"]);d!=null&&b(e,["responseId"],d);let u=h(i,["usageMetadata"]);return u!=null&&b(e,["usageMetadata"],u),e}function Ff(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["candidates"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(C=>C)),b(e,["candidates"],g)}let o=h(i,["createTime"]);o!=null&&b(e,["createTime"],o);let a=h(i,["modelVersion"]);a!=null&&b(e,["modelVersion"],a);let d=h(i,["promptFeedback"]);d!=null&&b(e,["promptFeedback"],d);let u=h(i,["responseId"]);u!=null&&b(e,["responseId"],u);let p=h(i,["usageMetadata"]);return p!=null&&b(e,["usageMetadata"],p),e}function v5(i,e){let t={};if(h(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=h(i,["numberOfImages"]);e!==void 0&&n!=null&&b(e,["parameters","sampleCount"],n);let o=h(i,["aspectRatio"]);e!==void 0&&o!=null&&b(e,["parameters","aspectRatio"],o);let a=h(i,["guidanceScale"]);if(e!==void 0&&a!=null&&b(e,["parameters","guidanceScale"],a),h(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let d=h(i,["safetyFilterLevel"]);e!==void 0&&d!=null&&b(e,["parameters","safetySetting"],d);let u=h(i,["personGeneration"]);e!==void 0&&u!=null&&b(e,["parameters","personGeneration"],u);let p=h(i,["includeSafetyAttributes"]);e!==void 0&&p!=null&&b(e,["parameters","includeSafetyAttributes"],p);let g=h(i,["includeRaiReason"]);e!==void 0&&g!=null&&b(e,["parameters","includeRaiReason"],g);let C=h(i,["language"]);e!==void 0&&C!=null&&b(e,["parameters","language"],C);let w=h(i,["outputMimeType"]);e!==void 0&&w!=null&&b(e,["parameters","outputOptions","mimeType"],w);let A=h(i,["outputCompressionQuality"]);if(e!==void 0&&A!=null&&b(e,["parameters","outputOptions","compressionQuality"],A),h(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(h(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let V=h(i,["imageSize"]);if(e!==void 0&&V!=null&&b(e,["parameters","sampleImageSize"],V),h(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function x5(i,e){let t={},n=h(i,["outputGcsUri"]);e!==void 0&&n!=null&&b(e,["parameters","storageUri"],n);let o=h(i,["negativePrompt"]);e!==void 0&&o!=null&&b(e,["parameters","negativePrompt"],o);let a=h(i,["numberOfImages"]);e!==void 0&&a!=null&&b(e,["parameters","sampleCount"],a);let d=h(i,["aspectRatio"]);e!==void 0&&d!=null&&b(e,["parameters","aspectRatio"],d);let u=h(i,["guidanceScale"]);e!==void 0&&u!=null&&b(e,["parameters","guidanceScale"],u);let p=h(i,["seed"]);e!==void 0&&p!=null&&b(e,["parameters","seed"],p);let g=h(i,["safetyFilterLevel"]);e!==void 0&&g!=null&&b(e,["parameters","safetySetting"],g);let C=h(i,["personGeneration"]);e!==void 0&&C!=null&&b(e,["parameters","personGeneration"],C);let w=h(i,["includeSafetyAttributes"]);e!==void 0&&w!=null&&b(e,["parameters","includeSafetyAttributes"],w);let A=h(i,["includeRaiReason"]);e!==void 0&&A!=null&&b(e,["parameters","includeRaiReason"],A);let V=h(i,["language"]);e!==void 0&&V!=null&&b(e,["parameters","language"],V);let G=h(i,["outputMimeType"]);e!==void 0&&G!=null&&b(e,["parameters","outputOptions","mimeType"],G);let z=h(i,["outputCompressionQuality"]);e!==void 0&&z!=null&&b(e,["parameters","outputOptions","compressionQuality"],z);let $=h(i,["addWatermark"]);e!==void 0&&$!=null&&b(e,["parameters","addWatermark"],$);let K=h(i,["labels"]);e!==void 0&&K!=null&&b(e,["labels"],K);let Z=h(i,["imageSize"]);e!==void 0&&Z!=null&&b(e,["parameters","sampleImageSize"],Z);let Y=h(i,["enhancePrompt"]);return e!==void 0&&Y!=null&&b(e,["parameters","enhancePrompt"],Y),t}function C5(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["prompt"]);o!=null&&b(t,["instances[0]","prompt"],o);let a=h(e,["config"]);return a!=null&&v5(a,t),t}function b5(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["prompt"]);o!=null&&b(t,["instances[0]","prompt"],o);let a=h(e,["config"]);return a!=null&&x5(a,t),t}function y5(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>R5(d))),b(e,["generatedImages"],a)}let o=h(i,["positivePromptSafetyAttributes"]);return o!=null&&b(e,["positivePromptSafetyAttributes"],d_(o)),e}function S5(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>Vl(d))),b(e,["generatedImages"],a)}let o=h(i,["positivePromptSafetyAttributes"]);return o!=null&&b(e,["positivePromptSafetyAttributes"],u_(o)),e}function w5(i,e){let t={},n=h(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&b(e,["parameters","sampleCount"],n),h(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let o=h(i,["durationSeconds"]);if(e!==void 0&&o!=null&&b(e,["parameters","durationSeconds"],o),h(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let a=h(i,["aspectRatio"]);e!==void 0&&a!=null&&b(e,["parameters","aspectRatio"],a);let d=h(i,["resolution"]);e!==void 0&&d!=null&&b(e,["parameters","resolution"],d);let u=h(i,["personGeneration"]);if(e!==void 0&&u!=null&&b(e,["parameters","personGeneration"],u),h(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let p=h(i,["negativePrompt"]);e!==void 0&&p!=null&&b(e,["parameters","negativePrompt"],p);let g=h(i,["enhancePrompt"]);if(e!==void 0&&g!=null&&b(e,["parameters","enhancePrompt"],g),h(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let C=h(i,["lastFrame"]);e!==void 0&&C!=null&&b(e,["instances[0]","lastFrame"],Bl(C));let w=h(i,["referenceImages"]);if(e!==void 0&&w!=null){let A=w;Array.isArray(A)&&(A=A.map(V=>Dw(V))),b(e,["instances[0]","referenceImages"],A)}if(h(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(h(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function E5(i,e){let t={},n=h(i,["numberOfVideos"]);e!==void 0&&n!=null&&b(e,["parameters","sampleCount"],n);let o=h(i,["outputGcsUri"]);e!==void 0&&o!=null&&b(e,["parameters","storageUri"],o);let a=h(i,["fps"]);e!==void 0&&a!=null&&b(e,["parameters","fps"],a);let d=h(i,["durationSeconds"]);e!==void 0&&d!=null&&b(e,["parameters","durationSeconds"],d);let u=h(i,["seed"]);e!==void 0&&u!=null&&b(e,["parameters","seed"],u);let p=h(i,["aspectRatio"]);e!==void 0&&p!=null&&b(e,["parameters","aspectRatio"],p);let g=h(i,["resolution"]);e!==void 0&&g!=null&&b(e,["parameters","resolution"],g);let C=h(i,["personGeneration"]);e!==void 0&&C!=null&&b(e,["parameters","personGeneration"],C);let w=h(i,["pubsubTopic"]);e!==void 0&&w!=null&&b(e,["parameters","pubsubTopic"],w);let A=h(i,["negativePrompt"]);e!==void 0&&A!=null&&b(e,["parameters","negativePrompt"],A);let V=h(i,["enhancePrompt"]);e!==void 0&&V!=null&&b(e,["parameters","enhancePrompt"],V);let G=h(i,["generateAudio"]);e!==void 0&&G!=null&&b(e,["parameters","generateAudio"],G);let z=h(i,["lastFrame"]);e!==void 0&&z!=null&&b(e,["instances[0]","lastFrame"],kn(z));let $=h(i,["referenceImages"]);if(e!==void 0&&$!=null){let Y=$;Array.isArray(Y)&&(Y=Y.map(re=>Aw(re))),b(e,["instances[0]","referenceImages"],Y)}let K=h(i,["mask"]);e!==void 0&&K!=null&&b(e,["instances[0]","mask"],Ew(K));let Z=h(i,["compressionQuality"]);return e!==void 0&&Z!=null&&b(e,["parameters","compressionQuality"],Z),t}function D5(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata"]);n!=null&&b(e,["metadata"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["response","generateVideoResponse"]);return d!=null&&b(e,["response"],k5(d)),e}function A5(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata"]);n!=null&&b(e,["metadata"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["response"]);return d!=null&&b(e,["response"],I5(d)),e}function M5(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["prompt"]);o!=null&&b(t,["instances[0]","prompt"],o);let a=h(e,["image"]);a!=null&&b(t,["instances[0]","image"],Bl(a));let d=h(e,["video"]);d!=null&&b(t,["instances[0]","video"],p_(d));let u=h(e,["source"]);u!=null&&F5(u,t);let p=h(e,["config"]);return p!=null&&w5(p,t),t}function T5(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["prompt"]);o!=null&&b(t,["instances[0]","prompt"],o);let a=h(e,["image"]);a!=null&&b(t,["instances[0]","image"],kn(a));let d=h(e,["video"]);d!=null&&b(t,["instances[0]","video"],g_(d));let u=h(e,["source"]);u!=null&&P5(u,t);let p=h(e,["config"]);return p!=null&&E5(p,t),t}function k5(i){let e={},t=h(i,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>V5(d))),b(e,["generatedVideos"],a)}let n=h(i,["raiMediaFilteredCount"]);n!=null&&b(e,["raiMediaFilteredCount"],n);let o=h(i,["raiMediaFilteredReasons"]);return o!=null&&b(e,["raiMediaFilteredReasons"],o),e}function I5(i){let e={},t=h(i,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>B5(d))),b(e,["generatedVideos"],a)}let n=h(i,["raiMediaFilteredCount"]);n!=null&&b(e,["raiMediaFilteredCount"],n);let o=h(i,["raiMediaFilteredReasons"]);return o!=null&&b(e,["raiMediaFilteredReasons"],o),e}function F5(i,e){let t={},n=h(i,["prompt"]);e!==void 0&&n!=null&&b(e,["instances[0]","prompt"],n);let o=h(i,["image"]);e!==void 0&&o!=null&&b(e,["instances[0]","image"],Bl(o));let a=h(i,["video"]);return e!==void 0&&a!=null&&b(e,["instances[0]","video"],p_(a)),t}function P5(i,e){let t={},n=h(i,["prompt"]);e!==void 0&&n!=null&&b(e,["instances[0]","prompt"],n);let o=h(i,["image"]);e!==void 0&&o!=null&&b(e,["instances[0]","image"],kn(o));let a=h(i,["video"]);return e!==void 0&&a!=null&&b(e,["instances[0]","video"],g_(a)),t}function R5(i){let e={},t=h(i,["_self"]);t!=null&&b(e,["image"],W5(t));let n=h(i,["raiFilteredReason"]);n!=null&&b(e,["raiFilteredReason"],n);let o=h(i,["_self"]);return o!=null&&b(e,["safetyAttributes"],d_(o)),e}function Vl(i){let e={},t=h(i,["_self"]);t!=null&&b(e,["image"],c_(t));let n=h(i,["raiFilteredReason"]);n!=null&&b(e,["raiFilteredReason"],n);let o=h(i,["_self"]);o!=null&&b(e,["safetyAttributes"],u_(o));let a=h(i,["prompt"]);return a!=null&&b(e,["enhancedPrompt"],a),e}function N5(i){let e={},t=h(i,["_self"]);t!=null&&b(e,["mask"],c_(t));let n=h(i,["labels"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),b(e,["labels"],o)}return e}function V5(i){let e={},t=h(i,["video"]);return t!=null&&b(e,["video"],Sw(t)),e}function B5(i){let e={},t=h(i,["_self"]);return t!=null&&b(e,["video"],ww(t)),e}function L5(i){let e={},t=h(i,["modelSelectionConfig"]);t!=null&&b(e,["modelConfig"],t);let n=h(i,["responseJsonSchema"]);n!=null&&b(e,["responseJsonSchema"],n);let o=h(i,["audioTimestamp"]);o!=null&&b(e,["audioTimestamp"],o);let a=h(i,["candidateCount"]);a!=null&&b(e,["candidateCount"],a);let d=h(i,["enableAffectiveDialog"]);d!=null&&b(e,["enableAffectiveDialog"],d);let u=h(i,["frequencyPenalty"]);u!=null&&b(e,["frequencyPenalty"],u);let p=h(i,["logprobs"]);p!=null&&b(e,["logprobs"],p);let g=h(i,["maxOutputTokens"]);g!=null&&b(e,["maxOutputTokens"],g);let C=h(i,["mediaResolution"]);C!=null&&b(e,["mediaResolution"],C);let w=h(i,["presencePenalty"]);w!=null&&b(e,["presencePenalty"],w);let A=h(i,["responseLogprobs"]);A!=null&&b(e,["responseLogprobs"],A);let V=h(i,["responseMimeType"]);V!=null&&b(e,["responseMimeType"],V);let G=h(i,["responseModalities"]);G!=null&&b(e,["responseModalities"],G);let z=h(i,["responseSchema"]);z!=null&&b(e,["responseSchema"],z);let $=h(i,["routingConfig"]);$!=null&&b(e,["routingConfig"],$);let K=h(i,["seed"]);K!=null&&b(e,["seed"],K);let Z=h(i,["speechConfig"]);Z!=null&&b(e,["speechConfig"],Z);let Y=h(i,["stopSequences"]);Y!=null&&b(e,["stopSequences"],Y);let re=h(i,["temperature"]);re!=null&&b(e,["temperature"],re);let le=h(i,["thinkingConfig"]);le!=null&&b(e,["thinkingConfig"],le);let ue=h(i,["topK"]);ue!=null&&b(e,["topK"],ue);let pe=h(i,["topP"]);if(pe!=null&&b(e,["topP"],pe),h(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function O5(i,e){let t={},n=h(e,["model"]);return n!=null&&b(t,["_url","name"],We(i,n)),t}function U5(i,e){let t={},n=h(e,["model"]);return n!=null&&b(t,["_url","name"],We(i,n)),t}function G5(i){let e={};if(h(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(i,["enableWidget"]);return t!=null&&b(e,["enableWidget"],t),e}function $5(i){let e={};if(h(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(i,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],t),e}function H5(i){let e={},t=h(i,["aspectRatio"]);t!=null&&b(e,["aspectRatio"],t);let n=h(i,["imageSize"]);if(n!=null&&b(e,["imageSize"],n),h(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function q5(i){let e={},t=h(i,["aspectRatio"]);t!=null&&b(e,["aspectRatio"],t);let n=h(i,["imageSize"]);n!=null&&b(e,["imageSize"],n);let o=h(i,["outputMimeType"]);o!=null&&b(e,["imageOutputOptions","mimeType"],o);let a=h(i,["outputCompressionQuality"]);return a!=null&&b(e,["imageOutputOptions","compressionQuality"],a),e}function W5(i){let e={},t=h(i,["bytesBase64Encoded"]);t!=null&&b(e,["imageBytes"],bi(t));let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function c_(i){let e={},t=h(i,["gcsUri"]);t!=null&&b(e,["gcsUri"],t);let n=h(i,["bytesBase64Encoded"]);n!=null&&b(e,["imageBytes"],bi(n));let o=h(i,["mimeType"]);return o!=null&&b(e,["mimeType"],o),e}function Bl(i){let e={};if(h(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=h(i,["imageBytes"]);t!=null&&b(e,["bytesBase64Encoded"],bi(t));let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function kn(i){let e={},t=h(i,["gcsUri"]);t!=null&&b(e,["gcsUri"],t);let n=h(i,["imageBytes"]);n!=null&&b(e,["bytesBase64Encoded"],bi(n));let o=h(i,["mimeType"]);return o!=null&&b(e,["mimeType"],o),e}function z5(i,e,t){let n={},o=h(e,["pageSize"]);t!==void 0&&o!=null&&b(t,["_query","pageSize"],o);let a=h(e,["pageToken"]);t!==void 0&&a!=null&&b(t,["_query","pageToken"],a);let d=h(e,["filter"]);t!==void 0&&d!=null&&b(t,["_query","filter"],d);let u=h(e,["queryBase"]);return t!==void 0&&u!=null&&b(t,["_url","models_url"],n_(i,u)),n}function K5(i,e,t){let n={},o=h(e,["pageSize"]);t!==void 0&&o!=null&&b(t,["_query","pageSize"],o);let a=h(e,["pageToken"]);t!==void 0&&a!=null&&b(t,["_query","pageToken"],a);let d=h(e,["filter"]);t!==void 0&&d!=null&&b(t,["_query","filter"],d);let u=h(e,["queryBase"]);return t!==void 0&&u!=null&&b(t,["_url","models_url"],n_(i,u)),n}function j5(i,e){let t={},n=h(e,["config"]);return n!=null&&z5(i,n,t),t}function J5(i,e){let t={},n=h(e,["config"]);return n!=null&&K5(i,n,t),t}function Q5(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["_self"]);if(o!=null){let a=i_(o);Array.isArray(a)&&(a=a.map(d=>F0(d))),b(e,["models"],a)}return e}function Y5(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["_self"]);if(o!=null){let a=i_(o);Array.isArray(a)&&(a=a.map(d=>P0(d))),b(e,["models"],a)}return e}function X5(i){let e={},t=h(i,["maskMode"]);t!=null&&b(e,["maskMode"],t);let n=h(i,["segmentationClasses"]);n!=null&&b(e,["maskClasses"],n);let o=h(i,["maskDilation"]);return o!=null&&b(e,["dilation"],o),e}function F0(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["displayName"]);n!=null&&b(e,["displayName"],n);let o=h(i,["description"]);o!=null&&b(e,["description"],o);let a=h(i,["version"]);a!=null&&b(e,["version"],a);let d=h(i,["_self"]);d!=null&&b(e,["tunedModelInfo"],gw(d));let u=h(i,["inputTokenLimit"]);u!=null&&b(e,["inputTokenLimit"],u);let p=h(i,["outputTokenLimit"]);p!=null&&b(e,["outputTokenLimit"],p);let g=h(i,["supportedGenerationMethods"]);g!=null&&b(e,["supportedActions"],g);let C=h(i,["temperature"]);C!=null&&b(e,["temperature"],C);let w=h(i,["maxTemperature"]);w!=null&&b(e,["maxTemperature"],w);let A=h(i,["topP"]);A!=null&&b(e,["topP"],A);let V=h(i,["topK"]);V!=null&&b(e,["topK"],V);let G=h(i,["thinking"]);return G!=null&&b(e,["thinking"],G),e}function P0(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["displayName"]);n!=null&&b(e,["displayName"],n);let o=h(i,["description"]);o!=null&&b(e,["description"],o);let a=h(i,["versionId"]);a!=null&&b(e,["version"],a);let d=h(i,["deployedModels"]);if(d!=null){let w=d;Array.isArray(w)&&(w=w.map(A=>u5(A))),b(e,["endpoints"],w)}let u=h(i,["labels"]);u!=null&&b(e,["labels"],u);let p=h(i,["_self"]);p!=null&&b(e,["tunedModelInfo"],hw(p));let g=h(i,["defaultCheckpointId"]);g!=null&&b(e,["defaultCheckpointId"],g);let C=h(i,["checkpoints"]);if(C!=null){let w=C;Array.isArray(w)&&(w=w.map(A=>A)),b(e,["checkpoints"],w)}return e}function Z5(i){let e={},t=h(i,["mediaResolution"]);t!=null&&b(e,["mediaResolution"],t);let n=h(i,["codeExecutionResult"]);n!=null&&b(e,["codeExecutionResult"],n);let o=h(i,["executableCode"]);o!=null&&b(e,["executableCode"],o);let a=h(i,["fileData"]);a!=null&&b(e,["fileData"],m5(a));let d=h(i,["functionCall"]);d!=null&&b(e,["functionCall"],p5(d));let u=h(i,["functionResponse"]);u!=null&&b(e,["functionResponse"],u);let p=h(i,["inlineData"]);p!=null&&b(e,["inlineData"],LS(p));let g=h(i,["text"]);g!=null&&b(e,["text"],g);let C=h(i,["thought"]);C!=null&&b(e,["thought"],C);let w=h(i,["thoughtSignature"]);w!=null&&b(e,["thoughtSignature"],w);let A=h(i,["videoMetadata"]);return A!=null&&b(e,["videoMetadata"],A),e}function ew(i){let e={},t=h(i,["productImage"]);return t!=null&&b(e,["image"],kn(t)),e}function tw(i,e){let t={},n=h(i,["numberOfImages"]);e!==void 0&&n!=null&&b(e,["parameters","sampleCount"],n);let o=h(i,["baseSteps"]);e!==void 0&&o!=null&&b(e,["parameters","baseSteps"],o);let a=h(i,["outputGcsUri"]);e!==void 0&&a!=null&&b(e,["parameters","storageUri"],a);let d=h(i,["seed"]);e!==void 0&&d!=null&&b(e,["parameters","seed"],d);let u=h(i,["safetyFilterLevel"]);e!==void 0&&u!=null&&b(e,["parameters","safetySetting"],u);let p=h(i,["personGeneration"]);e!==void 0&&p!=null&&b(e,["parameters","personGeneration"],p);let g=h(i,["addWatermark"]);e!==void 0&&g!=null&&b(e,["parameters","addWatermark"],g);let C=h(i,["outputMimeType"]);e!==void 0&&C!=null&&b(e,["parameters","outputOptions","mimeType"],C);let w=h(i,["outputCompressionQuality"]);e!==void 0&&w!=null&&b(e,["parameters","outputOptions","compressionQuality"],w);let A=h(i,["enhancePrompt"]);e!==void 0&&A!=null&&b(e,["parameters","enhancePrompt"],A);let V=h(i,["labels"]);return e!==void 0&&V!=null&&b(e,["labels"],V),t}function nw(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["source"]);o!=null&&ow(o,t);let a=h(e,["config"]);return a!=null&&tw(a,t),t}function iw(i){let e={},t=h(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>Vl(o))),b(e,["generatedImages"],n)}return e}function ow(i,e){let t={},n=h(i,["prompt"]);e!==void 0&&n!=null&&b(e,["instances[0]","prompt"],n);let o=h(i,["personImage"]);e!==void 0&&o!=null&&b(e,["instances[0]","personImage","image"],kn(o));let a=h(i,["productImages"]);if(e!==void 0&&a!=null){let d=a;Array.isArray(d)&&(d=d.map(u=>ew(u))),b(e,["instances[0]","productImages"],d)}return t}function rw(i){let e={},t=h(i,["referenceImage"]);t!=null&&b(e,["referenceImage"],kn(t));let n=h(i,["referenceId"]);n!=null&&b(e,["referenceId"],n);let o=h(i,["referenceType"]);o!=null&&b(e,["referenceType"],o);let a=h(i,["maskImageConfig"]);a!=null&&b(e,["maskImageConfig"],X5(a));let d=h(i,["controlImageConfig"]);d!=null&&b(e,["controlImageConfig"],WS(d));let u=h(i,["styleImageConfig"]);u!=null&&b(e,["styleImageConfig"],u);let p=h(i,["subjectImageConfig"]);return p!=null&&b(e,["subjectImageConfig"],p),e}function d_(i){let e={},t=h(i,["safetyAttributes","categories"]);t!=null&&b(e,["categories"],t);let n=h(i,["safetyAttributes","scores"]);n!=null&&b(e,["scores"],n);let o=h(i,["contentType"]);return o!=null&&b(e,["contentType"],o),e}function u_(i){let e={},t=h(i,["safetyAttributes","categories"]);t!=null&&b(e,["categories"],t);let n=h(i,["safetyAttributes","scores"]);n!=null&&b(e,["scores"],n);let o=h(i,["contentType"]);return o!=null&&b(e,["contentType"],o),e}function sw(i){let e={},t=h(i,["category"]);if(t!=null&&b(e,["category"],t),h(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(i,["threshold"]);return n!=null&&b(e,["threshold"],n),e}function aw(i){let e={},t=h(i,["image"]);return t!=null&&b(e,["image"],kn(t)),e}function lw(i,e){let t={},n=h(i,["mode"]);e!==void 0&&n!=null&&b(e,["parameters","mode"],n);let o=h(i,["maxPredictions"]);e!==void 0&&o!=null&&b(e,["parameters","maxPredictions"],o);let a=h(i,["confidenceThreshold"]);e!==void 0&&a!=null&&b(e,["parameters","confidenceThreshold"],a);let d=h(i,["maskDilation"]);e!==void 0&&d!=null&&b(e,["parameters","maskDilation"],d);let u=h(i,["binaryColorThreshold"]);e!==void 0&&u!=null&&b(e,["parameters","binaryColorThreshold"],u);let p=h(i,["labels"]);return e!==void 0&&p!=null&&b(e,["labels"],p),t}function cw(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["source"]);o!=null&&uw(o,t);let a=h(e,["config"]);return a!=null&&lw(a,t),t}function dw(i){let e={},t=h(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>N5(o))),b(e,["generatedMasks"],n)}return e}function uw(i,e){let t={},n=h(i,["prompt"]);e!==void 0&&n!=null&&b(e,["instances[0]","prompt"],n);let o=h(i,["image"]);e!==void 0&&o!=null&&b(e,["instances[0]","image"],kn(o));let a=h(i,["scribbleImage"]);return e!==void 0&&a!=null&&b(e,["instances[0]","scribble"],aw(a)),t}function mw(i){let e={},t=h(i,["functionCallingConfig"]);t!=null&&b(e,["functionCallingConfig"],g5(t));let n=h(i,["retrievalConfig"]);return n!=null&&b(e,["retrievalConfig"],n),e}function pw(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(w=>w)),b(e,["functionDeclarations"],C)}if(h(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(i,["googleSearchRetrieval"]);n!=null&&b(e,["googleSearchRetrieval"],n);let o=h(i,["computerUse"]);o!=null&&b(e,["computerUse"],o);let a=h(i,["fileSearch"]);a!=null&&b(e,["fileSearch"],a);let d=h(i,["codeExecution"]);if(d!=null&&b(e,["codeExecution"],d),h(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=h(i,["googleMaps"]);u!=null&&b(e,["googleMaps"],G5(u));let p=h(i,["googleSearch"]);p!=null&&b(e,["googleSearch"],$5(p));let g=h(i,["urlContext"]);return g!=null&&b(e,["urlContext"],g),e}function m_(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let w=t;Array.isArray(w)&&(w=w.map(A=>h5(A))),b(e,["functionDeclarations"],w)}let n=h(i,["retrieval"]);n!=null&&b(e,["retrieval"],n);let o=h(i,["googleSearchRetrieval"]);o!=null&&b(e,["googleSearchRetrieval"],o);let a=h(i,["computerUse"]);if(a!=null&&b(e,["computerUse"],a),h(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let d=h(i,["codeExecution"]);d!=null&&b(e,["codeExecution"],d);let u=h(i,["enterpriseWebSearch"]);u!=null&&b(e,["enterpriseWebSearch"],u);let p=h(i,["googleMaps"]);p!=null&&b(e,["googleMaps"],p);let g=h(i,["googleSearch"]);g!=null&&b(e,["googleSearch"],g);let C=h(i,["urlContext"]);return C!=null&&b(e,["urlContext"],C),e}function gw(i){let e={},t=h(i,["baseModel"]);t!=null&&b(e,["baseModel"],t);let n=h(i,["createTime"]);n!=null&&b(e,["createTime"],n);let o=h(i,["updateTime"]);return o!=null&&b(e,["updateTime"],o),e}function hw(i){let e={},t=h(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&b(e,["baseModel"],t);let n=h(i,["createTime"]);n!=null&&b(e,["createTime"],n);let o=h(i,["updateTime"]);return o!=null&&b(e,["updateTime"],o),e}function fw(i,e){let t={},n=h(i,["displayName"]);e!==void 0&&n!=null&&b(e,["displayName"],n);let o=h(i,["description"]);e!==void 0&&o!=null&&b(e,["description"],o);let a=h(i,["defaultCheckpointId"]);return e!==void 0&&a!=null&&b(e,["defaultCheckpointId"],a),t}function _w(i,e){let t={},n=h(i,["displayName"]);e!==void 0&&n!=null&&b(e,["displayName"],n);let o=h(i,["description"]);e!==void 0&&o!=null&&b(e,["description"],o);let a=h(i,["defaultCheckpointId"]);return e!==void 0&&a!=null&&b(e,["defaultCheckpointId"],a),t}function vw(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","name"],We(i,n));let o=h(e,["config"]);return o!=null&&fw(o,t),t}function xw(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["config"]);return o!=null&&_w(o,t),t}function Cw(i,e){let t={},n=h(i,["outputGcsUri"]);e!==void 0&&n!=null&&b(e,["parameters","storageUri"],n);let o=h(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&b(e,["parameters","safetySetting"],o);let a=h(i,["personGeneration"]);e!==void 0&&a!=null&&b(e,["parameters","personGeneration"],a);let d=h(i,["includeRaiReason"]);e!==void 0&&d!=null&&b(e,["parameters","includeRaiReason"],d);let u=h(i,["outputMimeType"]);e!==void 0&&u!=null&&b(e,["parameters","outputOptions","mimeType"],u);let p=h(i,["outputCompressionQuality"]);e!==void 0&&p!=null&&b(e,["parameters","outputOptions","compressionQuality"],p);let g=h(i,["enhanceInputImage"]);e!==void 0&&g!=null&&b(e,["parameters","upscaleConfig","enhanceInputImage"],g);let C=h(i,["imagePreservationFactor"]);e!==void 0&&C!=null&&b(e,["parameters","upscaleConfig","imagePreservationFactor"],C);let w=h(i,["labels"]);e!==void 0&&w!=null&&b(e,["labels"],w);let A=h(i,["numberOfImages"]);e!==void 0&&A!=null&&b(e,["parameters","sampleCount"],A);let V=h(i,["mode"]);return e!==void 0&&V!=null&&b(e,["parameters","mode"],V),t}function bw(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["_url","model"],We(i,n));let o=h(e,["image"]);o!=null&&b(t,["instances[0]","image"],kn(o));let a=h(e,["upscaleFactor"]);a!=null&&b(t,["parameters","upscaleConfig","upscaleFactor"],a);let d=h(e,["config"]);return d!=null&&Cw(d,t),t}function yw(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>Vl(a))),b(e,["generatedImages"],o)}return e}function Sw(i){let e={},t=h(i,["uri"]);t!=null&&b(e,["uri"],t);let n=h(i,["encodedVideo"]);n!=null&&b(e,["videoBytes"],bi(n));let o=h(i,["encoding"]);return o!=null&&b(e,["mimeType"],o),e}function ww(i){let e={},t=h(i,["gcsUri"]);t!=null&&b(e,["uri"],t);let n=h(i,["bytesBase64Encoded"]);n!=null&&b(e,["videoBytes"],bi(n));let o=h(i,["mimeType"]);return o!=null&&b(e,["mimeType"],o),e}function Ew(i){let e={},t=h(i,["image"]);t!=null&&b(e,["_self"],kn(t));let n=h(i,["maskMode"]);return n!=null&&b(e,["maskMode"],n),e}function Dw(i){let e={},t=h(i,["image"]);t!=null&&b(e,["image"],Bl(t));let n=h(i,["referenceType"]);return n!=null&&b(e,["referenceType"],n),e}function Aw(i){let e={},t=h(i,["image"]);t!=null&&b(e,["image"],kn(t));let n=h(i,["referenceType"]);return n!=null&&b(e,["referenceType"],n),e}function p_(i){let e={},t=h(i,["uri"]);t!=null&&b(e,["uri"],t);let n=h(i,["videoBytes"]);n!=null&&b(e,["encodedVideo"],bi(n));let o=h(i,["mimeType"]);return o!=null&&b(e,["encoding"],o),e}function g_(i){let e={},t=h(i,["uri"]);t!=null&&b(e,["gcsUri"],t);let n=h(i,["videoBytes"]);n!=null&&b(e,["bytesBase64Encoded"],bi(n));let o=h(i,["mimeType"]);return o!=null&&b(e,["mimeType"],o),e}function Mw(i,e){let t={},n=h(i,["displayName"]);return e!==void 0&&n!=null&&b(e,["displayName"],n),t}function Tw(i){let e={},t=h(i,["config"]);return t!=null&&Mw(t,e),e}function kw(i,e){let t={},n=h(i,["force"]);return e!==void 0&&n!=null&&b(e,["_query","force"],n),t}function Iw(i){let e={},t=h(i,["name"]);t!=null&&b(e,["_url","name"],t);let n=h(i,["config"]);return n!=null&&kw(n,e),e}function Fw(i){let e={},t=h(i,["name"]);return t!=null&&b(e,["_url","name"],t),e}function Pw(i,e){let t={},n=h(i,["customMetadata"]);if(e!==void 0&&n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["customMetadata"],a)}let o=h(i,["chunkingConfig"]);return e!==void 0&&o!=null&&b(e,["chunkingConfig"],o),t}function Rw(i){let e={},t=h(i,["name"]);t!=null&&b(e,["name"],t);let n=h(i,["metadata"]);n!=null&&b(e,["metadata"],n);let o=h(i,["done"]);o!=null&&b(e,["done"],o);let a=h(i,["error"]);a!=null&&b(e,["error"],a);let d=h(i,["response"]);return d!=null&&b(e,["response"],Vw(d)),e}function Nw(i){let e={},t=h(i,["fileSearchStoreName"]);t!=null&&b(e,["_url","file_search_store_name"],t);let n=h(i,["fileName"]);n!=null&&b(e,["fileName"],n);let o=h(i,["config"]);return o!=null&&Pw(o,e),e}function Vw(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["parent"]);n!=null&&b(e,["parent"],n);let o=h(i,["documentName"]);return o!=null&&b(e,["documentName"],o),e}function Bw(i,e){let t={},n=h(i,["pageSize"]);e!==void 0&&n!=null&&b(e,["_query","pageSize"],n);let o=h(i,["pageToken"]);return e!==void 0&&o!=null&&b(e,["_query","pageToken"],o),t}function Lw(i){let e={},t=h(i,["config"]);return t!=null&&Bw(t,e),e}function Ow(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["fileSearchStores"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["fileSearchStores"],a)}return e}function h_(i,e){let t={},n=h(i,["mimeType"]);e!==void 0&&n!=null&&b(e,["mimeType"],n);let o=h(i,["displayName"]);e!==void 0&&o!=null&&b(e,["displayName"],o);let a=h(i,["customMetadata"]);if(e!==void 0&&a!=null){let u=a;Array.isArray(u)&&(u=u.map(p=>p)),b(e,["customMetadata"],u)}let d=h(i,["chunkingConfig"]);return e!==void 0&&d!=null&&b(e,["chunkingConfig"],d),t}function Uw(i){let e={},t=h(i,["fileSearchStoreName"]);t!=null&&b(e,["_url","file_search_store_name"],t);let n=h(i,["config"]);return n!=null&&h_(n,e),e}function Gw(i){let e={},t=h(i,["sdkHttpResponse"]);return t!=null&&b(e,["sdkHttpResponse"],t),e}var $w="Content-Type",Hw="X-Server-Timeout",qw="User-Agent",R0="x-goog-api-client",Ww="1.34.0",zw=`google-genai-sdk/${Ww}`,Kw="v1beta1",jw="v1beta",N0=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Kw,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:jw,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let o=[this.getRequestUrlInternal(t)];return n&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[d,u]of Object.entries(e.queryParams))o.searchParams.append(d,String(u));let a={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else a.body=e.body;return a=await this.includeExtraHttpOptionsToRequestInit(a,t,o.toString(),e.abortSignal),this.unaryApiCall(o,a,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[o,a]of Object.entries(t))typeof a=="object"?n[o]=Object.assign(Object.assign({},n[o]),a):a!==void 0&&(n[o]=a);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,n);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let a={};return a.body=e.body,a=await this.includeExtraHttpOptionsToRequestInit(a,t,o.toString(),e.abortSignal),this.streamApiCall(o,a,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,o){if(t&&t.timeout||o){let a=new AbortController,d=a.signal;if(t.timeout&&t?.timeout>0){let u=setTimeout(()=>a.abort(),t.timeout);u&&typeof u.unref=="function"&&u.unref()}o&&o.addEventListener("abort",()=>{a.abort()}),e.signal=d}return t&&t.extraBody!==null&&Jw(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async o=>(await Pf(o),new is(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async o=>(await Pf(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return An(this,arguments,function*(){var n;let o=(n=e?.body)===null||n===void 0?void 0:n.getReader(),a=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let d="",u="data:",p=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:g,value:C}=yield Te(o.read());if(g){if(d.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let w=a.decode(C,{stream:!0});try{let G=JSON.parse(w);if("error"in G){let z=JSON.parse(JSON.stringify(G.error)),$=z.status,K=z.code,Z=`got status: ${$}. ${JSON.stringify(G)}`;if(K>=400&&K<600)throw new Cl({message:Z,status:K})}}catch(G){if(G.name==="ApiError")throw G}d+=w;let A=-1,V=0;for(;;){A=-1,V=0;for(let $ of p){let K=d.indexOf($);K!==-1&&(A===-1||K<A)&&(A=K,V=$.length)}if(A===-1)break;let G=d.substring(0,A);d=d.substring(A+V);let z=G.trim();if(z.startsWith(u)){let $=z.substring(u.length).trim();try{let K=new Response($,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield Te(new is(K))}catch(K){throw new Error(`exception parsing stream chunk ${$}. ${K}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=zw+" "+this.clientOptions.userAgentExtra;return e[qw]=t,e[R0]=t,e[$w]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[o,a]of Object.entries(e.headers))n.append(o,a);e.timeout&&e.timeout>0&&n.append(Hw,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);let a=this.clientOptions.uploader,d=await a.stat(e);o.sizeBytes=String(d.size);let u=(n=t?.mimeType)!==null&&n!==void 0?n:d.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=u;let p={file:o},g=this.getFileName(e),C=fe("upload/v1beta/files",p._url),w=await this.fetchUploadUrl(C,o.sizeBytes,o.mimeType,g,p,t?.httpOptions);return a.upload(e,w,this)}async uploadFileToFileSearchStore(e,t,n){var o;let a=this.clientOptions.uploader,d=await a.stat(t),u=String(d.size),p=(o=n?.mimeType)!==null&&o!==void 0?o:d.type;if(p===void 0||p==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let g=`upload/v1beta/${e}:uploadToFileSearchStore`,C=this.getFileName(t),w={};n!=null&&h_(n,w);let A=await this.fetchUploadUrl(g,u,p,C,w,n?.httpOptions);return a.uploadToFileSearchStore(t,A,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,o,a,d){var u;let p={};d?p=d:p={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},o?{"X-Goog-Upload-File-Name":o}:{})};let g=await this.request({path:e,body:JSON.stringify(a),httpMethod:"POST",httpOptions:p});if(!g||!g?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let C=(u=g?.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(C===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return C}};async function Pf(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){let t=i.status,n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};let o=JSON.stringify(n);throw t>=400&&t<600?new Cl({message:o,status:t}):new Error(o)}}function Jw(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{let a=JSON.parse(i.body);if(typeof a=="object"&&a!==null&&!Array.isArray(a))t=a;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(a,d){let u=Object.assign({},a);for(let p in d)if(Object.prototype.hasOwnProperty.call(d,p)){let g=d[p],C=u[p];g&&typeof g=="object"&&!Array.isArray(g)&&C&&typeof C=="object"&&!Array.isArray(C)?u[p]=n(C,g):(C&&g&&typeof C!=typeof g&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${p}". Original type: ${typeof C}, New type: ${typeof g}. Overwriting.`),u[p]=g)}return u}let o=n(t,e);i.body=JSON.stringify(o)}var Qw="mcp_used/unknown",Yw=!1;function f_(i){for(let e of i)if(Xw(e)||typeof e=="object"&&"inputSchema"in e)return!0;return Yw}function __(i){var e;let t=(e=i[R0])!==null&&e!==void 0?e:"";i[R0]=(t+` ${Qw}`).trimStart()}function Xw(i){return i!==null&&typeof i=="object"&&i instanceof V0}function Zw(i){return An(this,arguments,function*(t,n=100){let o,a=0;for(;a<n;){let d=yield Te(t.listTools({cursor:o}));for(let u of d.tools)yield yield Te(u),a++;if(!d.nextCursor)break;o=d.nextCursor}})}var V0=class i{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new i(e,t)}async initialize(){var e,t,n,o;if(this.mcpTools.length>0)return;let a={},d=[];for(let C of this.mcpClients)try{for(var u=!0,p=(t=void 0,Mn(Zw(C))),g;g=await p.next(),e=g.done,!e;u=!0){o=g.value,u=!1;let w=o;d.push(w);let A=w.name;if(a[A])throw new Error(`Duplicate function name ${A} found in MCP tools. Please ensure function names are unique.`);a[A]=C}}catch(w){t={error:w}}finally{try{!u&&!e&&(n=p.return)&&await n.call(p)}finally{if(t)throw t.error}}this.mcpTools=d,this.functionNameToMcpClient=a}async tool(){return await this.initialize(),By(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let o=this.functionNameToMcpClient[n.name],a;this.config.timeout&&(a={timeout:this.config.timeout});let d=await o.callTool({name:n.name,arguments:n.args},void 0,a);t.push({functionResponse:{name:n.name,response:d.isError?{error:d}:d}})}return t}};async function eE(i,e,t){let n=new S0,o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data),Object.assign(n,o),e(n)}var B0=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let o=this.apiClient.getWebsocketBaseUrl(),a=this.apiClient.getApiVersion(),d=nE(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),p=`${o}/ws/google.ai.generativelanguage.${a}.GenerativeService.BidiGenerateMusic?key=${u}`,g=()=>{},C=new Promise(Y=>{g=Y}),w=e.callbacks,A=function(){g({})},V=this.apiClient,G={onopen:A,onmessage:Y=>{eE(V,w.onmessage,Y)},onerror:(t=w?.onerror)!==null&&t!==void 0?t:function(Y){},onclose:(n=w?.onclose)!==null&&n!==void 0?n:function(Y){}},z=this.webSocketFactory.create(p,tE(d),G);z.connect(),await C;let Z={setup:{model:We(this.apiClient,e.model)}};return z.send(JSON.stringify(Z)),new L0(z,this.apiClient)}},L0=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=TS(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=MS(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(ts.PLAY)}pause(){this.sendPlaybackControl(ts.PAUSE)}stop(){this.sendPlaybackControl(ts.STOP)}resetContext(){this.sendPlaybackControl(ts.RESET_CONTEXT)}close(){this.conn.close()}};function tE(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function nE(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var iE="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function oE(i,e,t){let n=new y0,o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;let a=JSON.parse(o);if(i.isVertexAI()){let d=FS(a);Object.assign(n,d)}else Object.assign(n,a);e(n)}var O0=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new B0(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,o,a,d,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let p=this.apiClient.getWebsocketBaseUrl(),g=this.apiClient.getApiVersion(),C,w=this.apiClient.getHeaders();e.config&&e.config.tools&&f_(e.config.tools)&&__(w);let A=aE(w);if(this.apiClient.isVertexAI())C=`${p}/ws/google.cloud.aiplatform.${g}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(A,C);else{let we=this.apiClient.getApiKey(),Pe="BidiGenerateContent",at="key";we?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),g!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),Pe="BidiGenerateContentConstrained",at="access_token"),C=`${p}/ws/google.ai.generativelanguage.${g}.GenerativeService.${Pe}?${at}=${we}`}let V=()=>{},G=new Promise(we=>{V=we}),z=e.callbacks,$=function(){var we;(we=z?.onopen)===null||we===void 0||we.call(z),V({})},K=this.apiClient,Z={onopen:$,onmessage:we=>{oE(K,z.onmessage,we)},onerror:(t=z?.onerror)!==null&&t!==void 0?t:function(we){},onclose:(n=z?.onclose)!==null&&n!==void 0?n:function(we){}},Y=this.webSocketFactory.create(C,sE(A),Z);Y.connect(),await G;let re=We(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&re.startsWith("publishers/")){let we=this.apiClient.getProject(),Pe=this.apiClient.getLocation();re=`projects/${we}/locations/${Pe}/`+re}let le={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[c0.AUDIO]}:e.config.responseModalities=[c0.AUDIO]),!((a=e.config)===null||a===void 0)&&a.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let ue=(u=(d=e.config)===null||d===void 0?void 0:d.tools)!==null&&u!==void 0?u:[],pe=[];for(let we of ue)if(this.isCallableTool(we)){let Pe=we;pe.push(await Pe.tool())}else pe.push(we);pe.length>0&&(e.config.tools=pe);let Fe={model:re,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?le=AS(this.apiClient,Fe):le=DS(this.apiClient,Fe),delete le.config,Y.send(JSON.stringify(le)),new U0(Y,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},rE={turnComplete:!0},U0=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=fn(t.turns),e.isVertexAI()||(n=n.map(o=>Nl(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let a of n){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!e.isVertexAI()&&!("id"in a))throw new Error(iE)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},rE),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:IS(e)}:t={realtimeInput:kS(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function sE(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function aE(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var Rf=10;function Nf(i){var e,t,n;if(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(let d of(t=i?.tools)!==null&&t!==void 0?t:[])if(Bo(d)){o=!0;break}if(!o)return!0;let a=(n=i?.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return a&&(a<0||!Number.isInteger(a))||a==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",a),!0):!1}function Bo(i){return"callTool"in i&&typeof i.callTool=="function"}function lE(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>Bo(o)))!==null&&n!==void 0?n:!1}function Vf(i){var e;let t=[];return!((e=i?.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,o)=>{if(Bo(n))return;let a=n;a.functionDeclarations&&a.functionDeclarations.length>0&&t.push(o)}),t}function Bf(i){var e;return!(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var G0=class extends Tn{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,o,a,d,u;let p=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!lE(t)||Nf(t.config))return await this.generateContentInternal(p);let g=Vf(t);if(g.length>0){let z=g.map($=>`tools[${$}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${z}.`)}let C,w,A=fn(p.contents),V=(a=(o=(n=p.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&a!==void 0?a:Rf,G=0;for(;G<V&&(C=await this.generateContentInternal(p),!(!C.functionCalls||C.functionCalls.length===0));){let z=C.candidates[0].content,$=[];for(let K of(u=(d=t.config)===null||d===void 0?void 0:d.tools)!==null&&u!==void 0?u:[])if(Bo(K)){let Y=await K.callTool(C.functionCalls);$.push(...Y)}G++,w={role:"user",parts:$},p.contents=fn(p.contents),p.contents.push(z),p.contents.push(w),Bf(p.config)&&(A.push(z),A.push(w))}return Bf(p.config)&&(C.automaticFunctionCallingHistory=A),C},this.generateContentStream=async t=>{var n,o,a,d,u;if(this.maybeMoveToResponseJsonSchem(t),Nf(t.config)){let w=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(w)}let p=Vf(t);if(p.length>0){let w=p.map(A=>`tools[${A}]`).join(", ");throw new Error(`Incompatible tools found at ${w}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let g=(a=(o=(n=t?.config)===null||n===void 0?void 0:n.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||a===void 0?void 0:a.streamFunctionCallArguments,C=(u=(d=t?.config)===null||d===void 0?void 0:d.automaticFunctionCalling)===null||u===void 0?void 0:u.disable;if(g&&!C)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var o;let a,d=[];if(n?.generatedImages)for(let p of n.generatedImages)p&&p?.safetyAttributes&&((o=p?.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?a=p?.safetyAttributes:d.push(p);let u;return a?u={generatedImages:d,positivePromptSafetyAttributes:a,sdkHttpResponse:n.sdkHttpResponse}:u={generatedImages:d,sdkHttpResponse:n.sdkHttpResponse},u}),this.list=async t=>{var n;let d={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!d.config.queryBase){if(!((n=d.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");d.config.filter="labels.tune-type:*"}return new ei(yi.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(d),d)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{var n,o,a,d,u,p;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((o=t.video)===null||o===void 0)&&o.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((d=(a=t.source)===null||a===void 0?void 0:a.video)===null||d===void 0)&&d.uri&&(!((p=(u=t.source)===null||u===void 0?void 0:u.video)===null||p===void 0)&&p.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,o;let a=(t=e.config)===null||t===void 0?void 0:t.tools;if(!a)return e;let d=await Promise.all(a.map(async p=>Bo(p)?await p.tool():p)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:d})};if(u.config.tools=d,e.config&&e.config.tools&&f_(e.config.tools)){let p=(o=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&o!==void 0?o:{},g=Object.assign({},p);Object.keys(g).length===0&&(g=this.apiClient.getDefaultHeaders()),__(g),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:g})}return u}async initAfcToolsMap(e){var t,n,o;let a=new Map;for(let d of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(Bo(d)){let u=d,p=await u.tool();for(let g of(o=p.functionDeclarations)!==null&&o!==void 0?o:[]){if(!g.name)throw new Error("Function declaration name is required.");if(a.has(g.name))throw new Error(`Duplicate tool declaration name: ${g.name}`);a.set(g.name,u)}}return a}async processAfcStream(e){var t,n,o;let a=(o=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&o!==void 0?o:Rf,d=!1,u=0,p=await this.initAfcToolsMap(e);return(function(g,C,w){return An(this,arguments,function*(){for(var A,V,G,z,$,K;u<a;){d&&(u++,d=!1);let le=yield Te(g.processParamsMaybeAddMcpUsage(w)),ue=yield Te(g.generateContentStreamInternal(le)),pe=[],Fe=[];try{for(var Z=!0,Y=(V=void 0,Mn(ue)),re;re=yield Te(Y.next()),A=re.done,!A;Z=!0){z=re.value,Z=!1;let we=z;if(yield yield Te(we),we.candidates&&(!(($=we.candidates[0])===null||$===void 0)&&$.content)){Fe.push(we.candidates[0].content);for(let Pe of(K=we.candidates[0].content.parts)!==null&&K!==void 0?K:[])if(u<a&&Pe.functionCall){if(!Pe.functionCall.name)throw new Error("Function call name was not returned by the model.");if(C.has(Pe.functionCall.name)){let at=yield Te(C.get(Pe.functionCall.name).callTool([Pe.functionCall]));pe.push(...at)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${C.keys()}, mising tool: ${Pe.functionCall.name}`)}}}}catch(we){V={error:we}}finally{try{!Z&&!A&&(G=Y.return)&&(yield Te(G.call(Y)))}finally{if(V)throw V.error}}if(pe.length>0){d=!0;let we=new Xi;we.candidates=[{content:{role:"user",parts:pe}}],yield yield Te(we);let Pe=[];Pe.push(...Fe),Pe.push({role:"user",parts:pe});let at=fn(w.contents).concat(Pe);w.contents=at}else break}})})(this,p,e)}async generateContentInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=kf(this.apiClient,e);return u=fe("{model}:generateContent",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=Ff(C),A=new Xi;return Object.assign(A,w),A})}else{let g=Tf(this.apiClient,e);return u=fe("{model}:generateContent",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=If(C),A=new Xi;return Object.assign(A,w),A})}}async generateContentStreamInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=kf(this.apiClient,e);return u=fe("{model}:streamGenerateContent?alt=sse",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.requestStream({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),d.then(function(w){return An(this,arguments,function*(){var A,V,G,z;try{for(var $=!0,K=Mn(w),Z;Z=yield Te(K.next()),A=Z.done,!A;$=!0){z=Z.value,$=!1;let Y=z,re=Ff(yield Te(Y.json()));re.sdkHttpResponse={headers:Y.headers};let le=new Xi;Object.assign(le,re),yield yield Te(le)}}catch(Y){V={error:Y}}finally{try{!$&&!A&&(G=K.return)&&(yield Te(G.call(K)))}finally{if(V)throw V.error}}})})}else{let g=Tf(this.apiClient,e);return u=fe("{model}:streamGenerateContent?alt=sse",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.requestStream({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}),d.then(function(w){return An(this,arguments,function*(){var A,V,G,z;try{for(var $=!0,K=Mn(w),Z;Z=yield Te(K.next()),A=Z.done,!A;$=!0){z=Z.value,$=!1;let Y=z,re=If(yield Te(Y.json()));re.sdkHttpResponse={headers:Y.headers};let le=new Xi;Object.assign(le,re),yield yield Te(le)}}catch(Y){V={error:Y}}finally{try{!$&&!A&&(G=K.return)&&(yield Te(G.call(K)))}finally{if(V)throw V.error}}})})}}async embedContent(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=l5(this.apiClient,e);return u=fe("{model}:predict",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=d5(C),A=new al;return Object.assign(A,w),A})}else{let g=a5(this.apiClient,e);return u=fe("{model}:batchEmbedContents",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=c5(C),A=new al;return Object.assign(A,w),A})}}async generateImagesInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=b5(this.apiClient,e);return u=fe("{model}:predict",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=S5(C),A=new ll;return Object.assign(A,w),A})}else{let g=C5(this.apiClient,e);return u=fe("{model}:predict",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=y5(C),A=new ll;return Object.assign(A,w),A})}}async editImageInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=i5(this.apiClient,e);return a=fe("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(g=>{let C=g;return C.sdkHttpResponse={headers:p.headers},C})),o.then(p=>{let g=o5(p),C=new d0;return Object.assign(C,g),C})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=bw(this.apiClient,e);return a=fe("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(g=>{let C=g;return C.sdkHttpResponse={headers:p.headers},C})),o.then(p=>{let g=yw(p),C=new u0;return Object.assign(C,g),C})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=nw(this.apiClient,e);return a=fe("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>{let g=iw(p),C=new m0;return Object.assign(C,g),C})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=cw(this.apiClient,e);return a=fe("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>{let g=dw(p),C=new p0;return Object.assign(C,g),C})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=U5(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>P0(C))}else{let g=O5(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>F0(C))}}async listInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=J5(this.apiClient,e);return u=fe("{models_url}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=Y5(C),A=new cl;return Object.assign(A,w),A})}else{let g=j5(this.apiClient,e);return u=fe("{models_url}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=Q5(C),A=new cl;return Object.assign(A,w),A})}}async update(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=xw(this.apiClient,e);return u=fe("{model}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>P0(C))}else{let g=vw(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>F0(C))}}async delete(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=ZS(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=t5(C),A=new dl;return Object.assign(A,w),A})}else{let g=XS(this.apiClient,e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=e5(C),A=new dl;return Object.assign(A,w),A})}}async countTokens(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=JS(this.apiClient,e);return u=fe("{model}:countTokens",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=YS(C),A=new ul;return Object.assign(A,w),A})}else{let g=jS(this.apiClient,e);return u=fe("{model}:countTokens",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=QS(C),A=new ul;return Object.assign(A,w),A})}}async computeTokens(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=GS(this.apiClient,e);return a=fe("{model}:computeTokens",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(g=>{let C=g;return C.sdkHttpResponse={headers:p.headers},C})),o.then(p=>{let g=$S(p),C=new g0;return Object.assign(C,g),C})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=T5(this.apiClient,e);return u=fe("{model}:predictLongRunning",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>{let w=A5(C),A=new ml;return Object.assign(A,w),A})}else{let g=M5(this.apiClient,e);return u=fe("{model}:predictLongRunning",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>{let w=D5(C),A=new ml;return Object.assign(A,w),A})}}};var $0=class extends Tn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],a;n&&"httpOptions"in n&&(a=n.httpOptions);let d=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:a}});return t._fromAPIResponse({apiResponse:d,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],a;n&&"httpOptions"in n&&(a=n.httpOptions);let d=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:a}});return t._fromAPIResponse({apiResponse:d,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=wy(e);return u=fe("{operationName}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d}else{let g=Sy(e);return u=fe("{operationName}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d}}async fetchPredictVideosOperationInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=fy(e);return a=fe("{resourceName}:fetchPredictOperation",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}};function cE(i){let e={},t=h(i,["data"]);if(t!=null&&b(e,["data"],t),h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function dE(i){let e={},t=h(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>xE(a))),b(e,["parts"],o)}let n=h(i,["role"]);return n!=null&&b(e,["role"],n),e}function uE(i,e,t){let n={},o=h(e,["expireTime"]);t!==void 0&&o!=null&&b(t,["expireTime"],o);let a=h(e,["newSessionExpireTime"]);t!==void 0&&a!=null&&b(t,["newSessionExpireTime"],a);let d=h(e,["uses"]);t!==void 0&&d!=null&&b(t,["uses"],d);let u=h(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&b(t,["bidiGenerateContentSetup"],vE(i,u));let p=h(e,["lockAdditionalFields"]);return t!==void 0&&p!=null&&b(t,["fieldMask"],p),n}function mE(i,e){let t={},n=h(e,["config"]);return n!=null&&b(t,["config"],uE(i,n,t)),t}function pE(i){let e={};if(h(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(i,["fileUri"]);t!=null&&b(e,["fileUri"],t);let n=h(i,["mimeType"]);return n!=null&&b(e,["mimeType"],n),e}function gE(i){let e={},t=h(i,["id"]);t!=null&&b(e,["id"],t);let n=h(i,["args"]);n!=null&&b(e,["args"],n);let o=h(i,["name"]);if(o!=null&&b(e,["name"],o),h(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function hE(i){let e={};if(h(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(i,["enableWidget"]);return t!=null&&b(e,["enableWidget"],t),e}function fE(i){let e={};if(h(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(i,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],t),e}function _E(i,e){let t={},n=h(i,["generationConfig"]);e!==void 0&&n!=null&&b(e,["setup","generationConfig"],n);let o=h(i,["responseModalities"]);e!==void 0&&o!=null&&b(e,["setup","generationConfig","responseModalities"],o);let a=h(i,["temperature"]);e!==void 0&&a!=null&&b(e,["setup","generationConfig","temperature"],a);let d=h(i,["topP"]);e!==void 0&&d!=null&&b(e,["setup","generationConfig","topP"],d);let u=h(i,["topK"]);e!==void 0&&u!=null&&b(e,["setup","generationConfig","topK"],u);let p=h(i,["maxOutputTokens"]);e!==void 0&&p!=null&&b(e,["setup","generationConfig","maxOutputTokens"],p);let g=h(i,["mediaResolution"]);e!==void 0&&g!=null&&b(e,["setup","generationConfig","mediaResolution"],g);let C=h(i,["seed"]);e!==void 0&&C!=null&&b(e,["setup","generationConfig","seed"],C);let w=h(i,["speechConfig"]);e!==void 0&&w!=null&&b(e,["setup","generationConfig","speechConfig"],dm(w));let A=h(i,["thinkingConfig"]);e!==void 0&&A!=null&&b(e,["setup","generationConfig","thinkingConfig"],A);let V=h(i,["enableAffectiveDialog"]);e!==void 0&&V!=null&&b(e,["setup","generationConfig","enableAffectiveDialog"],V);let G=h(i,["systemInstruction"]);e!==void 0&&G!=null&&b(e,["setup","systemInstruction"],dE(At(G)));let z=h(i,["tools"]);if(e!==void 0&&z!=null){let ue=Go(z);Array.isArray(ue)&&(ue=ue.map(pe=>bE(Uo(pe)))),b(e,["setup","tools"],ue)}let $=h(i,["sessionResumption"]);e!==void 0&&$!=null&&b(e,["setup","sessionResumption"],CE($));let K=h(i,["inputAudioTranscription"]);e!==void 0&&K!=null&&b(e,["setup","inputAudioTranscription"],K);let Z=h(i,["outputAudioTranscription"]);e!==void 0&&Z!=null&&b(e,["setup","outputAudioTranscription"],Z);let Y=h(i,["realtimeInputConfig"]);e!==void 0&&Y!=null&&b(e,["setup","realtimeInputConfig"],Y);let re=h(i,["contextWindowCompression"]);e!==void 0&&re!=null&&b(e,["setup","contextWindowCompression"],re);let le=h(i,["proactivity"]);if(e!==void 0&&le!=null&&b(e,["setup","proactivity"],le),h(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function vE(i,e){let t={},n=h(e,["model"]);n!=null&&b(t,["setup","model"],We(i,n));let o=h(e,["config"]);return o!=null&&b(t,["config"],_E(o,t)),t}function xE(i){let e={},t=h(i,["mediaResolution"]);t!=null&&b(e,["mediaResolution"],t);let n=h(i,["codeExecutionResult"]);n!=null&&b(e,["codeExecutionResult"],n);let o=h(i,["executableCode"]);o!=null&&b(e,["executableCode"],o);let a=h(i,["fileData"]);a!=null&&b(e,["fileData"],pE(a));let d=h(i,["functionCall"]);d!=null&&b(e,["functionCall"],gE(d));let u=h(i,["functionResponse"]);u!=null&&b(e,["functionResponse"],u);let p=h(i,["inlineData"]);p!=null&&b(e,["inlineData"],cE(p));let g=h(i,["text"]);g!=null&&b(e,["text"],g);let C=h(i,["thought"]);C!=null&&b(e,["thought"],C);let w=h(i,["thoughtSignature"]);w!=null&&b(e,["thoughtSignature"],w);let A=h(i,["videoMetadata"]);return A!=null&&b(e,["videoMetadata"],A),e}function CE(i){let e={},t=h(i,["handle"]);if(t!=null&&b(e,["handle"],t),h(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function bE(i){let e={},t=h(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(w=>w)),b(e,["functionDeclarations"],C)}if(h(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(i,["googleSearchRetrieval"]);n!=null&&b(e,["googleSearchRetrieval"],n);let o=h(i,["computerUse"]);o!=null&&b(e,["computerUse"],o);let a=h(i,["fileSearch"]);a!=null&&b(e,["fileSearch"],a);let d=h(i,["codeExecution"]);if(d!=null&&b(e,["codeExecution"],d),h(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=h(i,["googleMaps"]);u!=null&&b(e,["googleMaps"],hE(u));let p=h(i,["googleSearch"]);p!=null&&b(e,["googleSearch"],fE(p));let g=h(i,["urlContext"]);return g!=null&&b(e,["urlContext"],g),e}function yE(i){let e=[];for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let o=Object.keys(n).map(a=>`${t}.${a}`);e.push(...o)}else e.push(t)}return e.join(",")}function SE(i,e){let t=null,n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let a=n.setup;typeof a=="object"&&a!==null?(i.bidiGenerateContentSetup=a,t=a):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;let o=i.fieldMask;if(t){let a=yE(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)a?i.fieldMask=a:delete i.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){let d=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],u=[];o.length>0&&(u=o.map(g=>d.includes(g)?`generationConfig.${g}`:g));let p=[];a&&p.push(a),u.length>0&&p.push(...u),p.length>0?i.fieldMask=p.join(","):delete i.fieldMask}else delete i.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?i.fieldMask=o.join(","):delete i.fieldMask;return i}var H0=class extends Tn{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let u=mE(this.apiClient,e);a=fe("auth_tokens",u._url),d=u._query,delete u.config,delete u._url,delete u._query;let p=SE(u,e.config);return o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(g=>g.json()),o.then(g=>g)}}};function wE(i,e){let t={},n=h(i,["force"]);return e!==void 0&&n!=null&&b(e,["_query","force"],n),t}function EE(i){let e={},t=h(i,["name"]);t!=null&&b(e,["_url","name"],t);let n=h(i,["config"]);return n!=null&&wE(n,e),e}function DE(i){let e={},t=h(i,["name"]);return t!=null&&b(e,["_url","name"],t),e}function AE(i,e){let t={},n=h(i,["pageSize"]);e!==void 0&&n!=null&&b(e,["_query","pageSize"],n);let o=h(i,["pageToken"]);return e!==void 0&&o!=null&&b(e,["_query","pageToken"],o),t}function ME(i){let e={},t=h(i,["parent"]);t!=null&&b(e,["_url","parent"],t);let n=h(i,["config"]);return n!=null&&AE(n,e),e}function TE(i){let e={},t=h(i,["sdkHttpResponse"]);t!=null&&b(e,["sdkHttpResponse"],t);let n=h(i,["nextPageToken"]);n!=null&&b(e,["nextPageToken"],n);let o=h(i,["documents"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),b(e,["documents"],a)}return e}var q0=class extends Tn{constructor(e){super(),this.apiClient=e,this.list=async t=>new ei(yi.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=DE(e);return a=fe("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>p)}}async delete(e){var t,n;let o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let d=EE(e);o=fe("{name}",d._url),a=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=ME(e);return a=fe("{parent}/documents",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>{let g=TE(p),C=new h0;return Object.assign(C,g),C})}}};var W0=class extends Tn{constructor(e,t=new q0(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new ei(yi.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Tw(e);return a=fe("fileSearchStores",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>p)}}async get(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Fw(e);return a=fe("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>p)}}async delete(e){var t,n;let o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let d=Iw(e);o=fe("{name}",d._url),a=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Lw(e);return a=fe("fileSearchStores",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>{let g=Ow(p),C=new f0;return Object.assign(C,g),C})}}async uploadToFileSearchStoreInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Uw(e);return a=fe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>{let g=Gw(p),C=new _0;return Object.assign(C,g),C})}}async importFile(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Nw(e);return a=fe("{file_search_store_name}:importFile",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),o.then(p=>{let g=Rw(p),C=new v0;return Object.assign(C,g),C})}}};var v_=function(){let{crypto:i}=globalThis;if(i?.randomUUID)return v_=i.randomUUID.bind(i),i.randomUUID();let e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},kE=()=>v_();function z0(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}var K0=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){let e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};var qt=class extends Error{},Wt=class i extends qt{constructor(e,t,n,o){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=o,this.error=t}static makeMessage(e,t,n){let o=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,t,n,o){if(!e||!o)return new Lo({message:n,cause:K0(t)});let a=t;return e===400?new yl(e,a,n,o):e===401?new Sl(e,a,n,o):e===403?new wl(e,a,n,o):e===404?new El(e,a,n,o):e===409?new Dl(e,a,n,o):e===422?new Al(e,a,n,o):e===429?new Ml(e,a,n,o):e>=500?new Tl(e,a,n,o):new i(e,a,n,o)}},os=class extends Wt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Lo=class extends Wt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},bl=class extends Lo{constructor({message:e}={}){super({message:e??"Request timed out."})}},yl=class extends Wt{},Sl=class extends Wt{},wl=class extends Wt{},El=class extends Wt{},Dl=class extends Wt{},Al=class extends Wt{},Ml=class extends Wt{},Tl=class extends Wt{};var IE=/^[a-z][a-z0-9+.-]*:/i,FE=i=>IE.test(i),j0=i=>(j0=Array.isArray,j0(i)),PE=j0,RE=PE,Lf=RE;function NE(i){if(!i)return!0;for(let e in i)return!1;return!0}function VE(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var BE=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new qt(`${i} must be an integer`);if(e<0)throw new qt(`${i} must be a positive integer`);return e},LE=i=>{try{return JSON.parse(i)}catch{return}};var OE=i=>new Promise(e=>setTimeout(e,i));var No="0.0.1";function UE(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var GE=()=>{var i,e,t,n,o;let a=UE();if(a==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":No,"X-Stainless-OS":Uf(Deno.build.os),"X-Stainless-Arch":Of(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":No,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(a==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":No,"X-Stainless-OS":Uf((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":Of((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};let d=$E();return d?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":No,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${d.browser}`,"X-Stainless-Runtime-Version":d.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":No,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function $E(){if(typeof navigator>"u"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let n=t.exec(navigator.userAgent);if(n){let o=n[1]||0,a=n[2]||0,d=n[3]||0;return{browser:e,version:`${o}.${a}.${d}`}}}return null}var Of=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",Uf=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),el,HE=()=>el??(el=GE());function qE(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function x_(...i){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function WE(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return x_({start(){},async pull(t){let{done:n,value:o}=await e.next();n?t.close():t.enqueue(o)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function C_(i){if(i[Symbol.asyncIterator])return i;let e=i.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function zE(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=i.getReader(),o=n.cancel();n.releaseLock(),await o}var KE=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var b_=()=>{var i;if(typeof File>"u"){let{process:e}=globalThis,t=typeof((i=e?.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function s0(i,e,t){return b_(),new File(i,e??"unknown_file",t)}function jE(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}var JE=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var y_=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",QE=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&y_(i),YE=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function XE(i,e,t){if(b_(),i=await i,QE(i))return i instanceof File?i:s0([await i.arrayBuffer()],i.name);if(YE(i)){let o=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),s0(await J0(o),e,t)}let n=await J0(i);if(e||(e=jE(i)),!t?.type){let o=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof o=="string"&&(t=Object.assign(Object.assign({},t),{type:o}))}return s0(n,e,t)}async function J0(i){var e,t,n,o,a;let d=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)d.push(i);else if(y_(i))d.push(i instanceof Blob?i:await i.arrayBuffer());else if(JE(i))try{for(var u=!0,p=Mn(i),g;g=await p.next(),e=g.done,!e;u=!0){o=g.value,u=!1;let C=o;d.push(...await J0(C))}}catch(C){t={error:C}}finally{try{!u&&!e&&(n=p.return)&&await n.call(p)}finally{if(t)throw t.error}}else{let C=(a=i?.constructor)===null||a===void 0?void 0:a.name;throw new Error(`Unexpected data type: ${typeof i}${C?`; constructor: ${C}`:""}${ZE(i)}`)}return d}function ZE(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}var e3=(()=>{class i{constructor(t){this._client=t}}i._key=[];return i})();function S_(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Gf=Object.freeze(Object.create(null)),t3=(i=S_)=>function(t,...n){if(t.length===1)return t[0];let o=!1,a=[],d=t.reduce((C,w,A)=>{var V,G,z;/[?#]/.test(w)&&(o=!0);let $=n[A],K=(o?encodeURIComponent:i)(""+$);return A!==n.length&&($==null||typeof $=="object"&&$.toString===((z=Object.getPrototypeOf((G=Object.getPrototypeOf((V=$.hasOwnProperty)!==null&&V!==void 0?V:Gf))!==null&&G!==void 0?G:Gf))===null||z===void 0?void 0:z.toString))&&(K=$+"",a.push({start:C.length+w.length,length:K.length,error:`Value of type ${Object.prototype.toString.call($).slice(8,-1)} is not a valid path parameter`})),C+w+(A===n.length?"":K)},""),u=d.split(/[?#]/,1)[0],p=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,g;for(;(g=p.exec(u))!==null;)a.push({start:g.index,length:g[0].length,error:`Value "${g[0]}" can't be safely passed as a path parameter`});if(a.sort((C,w)=>C.start-w.start),a.length>0){let C=0,w=a.reduce((A,V)=>{let G=" ".repeat(V.start-C),z="^".repeat(V.length);return C=V.start+V.length,A+G+z},"");throw new qt(`Path parameters result in path with invalid segments:
${a.map(A=>A.error).join(`
`)}
${d}
${w}`)}return d},tl=t3(S_);var kl=class extends e3{create(e,t){var n;let{api_version:o=this._client.apiVersion}=e,a=xl(e,["api_version"]);if("model"in a&&"agent_config"in a)throw new qt("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in a&&"generation_config"in a)throw new qt("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(tl`/${o}/interactions`,Object.assign(Object.assign({body:a},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:o=this._client.apiVersion}=t??{};return this._client.delete(tl`/${o}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:o=this._client.apiVersion}=t??{};return this._client.post(tl`/${o}/interactions/${e}/cancel`,n)}get(e,t={},n){var o;let a=t??{},{api_version:d=this._client.apiVersion}=a,u=xl(a,["api_version"]);return this._client.get(tl`/${d}/interactions/${e}`,Object.assign(Object.assign({query:u},n),{stream:(o=t?.stream)!==null&&o!==void 0?o:!1}))}};kl._key=Object.freeze(["interactions"]);var Il=class extends kl{};function n3(i){let e=0;for(let o of i)e+=o.length;let t=new Uint8Array(e),n=0;for(let o of i)t.set(o,n),n+=o.length;return t}var nl;function um(i){let e;return(nl??(e=new globalThis.TextEncoder,nl=e.encode.bind(e)))(i)}var il;function $f(i){let e;return(il??(e=new globalThis.TextDecoder,il=e.decode.bind(e)))(i)}var Oo=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?um(e):e;this.buffer=n3([this.buffer,t]);let n=[],o;for(;(o=i3(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){n.push($f(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let a=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,d=$f(this.buffer.subarray(0,a));n.push(d),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Oo.NEWLINE_CHARS=new Set([`
`,"\r"]);Oo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function i3(i,e){for(let o=e??0;o<i.length;o++){if(i[o]===10)return{preceding:o,index:o+1,carriage:!1};if(i[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function o3(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}var Fl={off:0,error:200,warn:300,info:400,debug:500},Hf=(i,e,t)=>{if(i){if(VE(Fl,i))return i;Bt(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(Fl))}`)}};function ns(){}function ol(i,e,t){return!e||Fl[i]>Fl[t]?ns:e[i].bind(e)}var r3={error:ns,warn:ns,info:ns,debug:ns},qf=new WeakMap;function Bt(i){var e;let t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return r3;let o=qf.get(t);if(o&&o[0]===n)return o[1];let a={error:ol("error",t,n),warn:ol("warn",t,n),info:ol("info",t,n),debug:ol("debug",t,n)};return qf.set(t,[n,a]),a}var Yi=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);var Q0=class i{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let o=!1,a=n?Bt(n):console;function d(){return An(this,arguments,function*(){var p,g,C,w;if(o)throw new qt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let A=!1;try{try{for(var V=!0,G=Mn(s3(e,t)),z;z=yield Te(G.next()),p=z.done,!p;V=!0){w=z.value,V=!1;let $=w;if(!A)if($.data.startsWith("[DONE]")){A=!0;continue}else try{yield yield Te(JSON.parse($.data))}catch(K){throw a.error("Could not parse message into JSON:",$.data),a.error("From chunk:",$.raw),K}}}catch($){g={error:$}}finally{try{!V&&!p&&(C=G.return)&&(yield Te(C.call(G)))}finally{if(g)throw g.error}}A=!0}catch($){if(z0($))return yield Te(void 0);throw $}finally{A||t.abort()}})}return new i(d,t,n)}static fromReadableStream(e,t,n){let o=!1;function a(){return An(this,arguments,function*(){var p,g,C,w;let A=new Oo,V=C_(e);try{for(var G=!0,z=Mn(V),$;$=yield Te(z.next()),p=$.done,!p;G=!0){w=$.value,G=!1;let K=w;for(let Z of A.decode(K))yield yield Te(Z)}}catch(K){g={error:K}}finally{try{!G&&!p&&(C=z.return)&&(yield Te(C.call(z)))}finally{if(g)throw g.error}}for(let K of A.flush())yield yield Te(K)})}function d(){return An(this,arguments,function*(){var p,g,C,w;if(o)throw new qt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let A=!1;try{try{for(var V=!0,G=Mn(a()),z;z=yield Te(G.next()),p=z.done,!p;V=!0){w=z.value,V=!1;let $=w;A||$&&(yield yield Te(JSON.parse($)))}}catch($){g={error:$}}finally{try{!V&&!p&&(C=G.return)&&(yield Te(C.call(G)))}finally{if(g)throw g.error}}A=!0}catch($){if(z0($))return yield Te(void 0);throw $}finally{A||t.abort()}})}return new i(d,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),o=a=>({next:()=>{if(a.length===0){let d=n.next();e.push(d),t.push(d)}return a.shift()}});return[new i(()=>o(e),this.controller,this.client),new i(()=>o(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return x_({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:o,done:a}=await t.next();if(a)return n.close();let d=um(JSON.stringify(o)+`
`);n.enqueue(d)}catch(o){n.error(o)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function s3(i,e){return An(this,arguments,function*(){var n,o,a,d;if(!i.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new qt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new qt("Attempted to iterate over a response with no body");let u=new Y0,p=new Oo,g=C_(i.body);try{for(var C=!0,w=Mn(a3(g)),A;A=yield Te(w.next()),n=A.done,!n;C=!0){d=A.value,C=!1;let V=d;for(let G of p.decode(V)){let z=u.decode(G);z&&(yield yield Te(z))}}}catch(V){o={error:V}}finally{try{!C&&!n&&(a=w.return)&&(yield Te(a.call(w)))}finally{if(o)throw o.error}}for(let V of p.flush()){let G=u.decode(V);G&&(yield yield Te(G))}})}function a3(i){return An(this,arguments,function*(){var t,n,o,a;let d=new Uint8Array;try{for(var u=!0,p=Mn(i),g;g=yield Te(p.next()),t=g.done,!t;u=!0){a=g.value,u=!1;let C=a;if(C==null)continue;let w=C instanceof ArrayBuffer?new Uint8Array(C):typeof C=="string"?um(C):C,A=new Uint8Array(d.length+w.length);A.set(d),A.set(w,d.length),d=A;let V;for(;(V=o3(d))!==-1;)yield yield Te(d.slice(0,V)),d=d.slice(V)}}catch(C){n={error:C}}finally{try{!u&&!t&&(o=p.return)&&(yield Te(o.call(p)))}finally{if(n)throw n.error}}d.length>0&&(yield yield Te(d))})}var Y0=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,o]=l3(e,":");return o.startsWith(" ")&&(o=o.substring(1)),t==="event"?this.event=o:t==="data"&&this.data.push(o),null}};function l3(i,e){let t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}async function c3(i,e){let{response:t,requestLogID:n,retryOfRequestLogID:o,startTime:a}=e,d=await(async()=>{var u;if(e.options.stream)return Bt(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):Q0.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let p=t.headers.get("content-type"),g=(u=p?.split(";")[0])===null||u===void 0?void 0:u.trim();return g?.includes("application/json")||g?.endsWith("+json")?await t.json():await t.text()})();return Bt(i).debug(`[${n}] response parsed`,Yi({retryOfRequestLogID:o,url:t.url,status:t.status,body:d,durationMs:Date.now()-a})),d}var X0=class i extends Promise{constructor(e,t,n=c3){super(o=>{o(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var w_=Symbol("brand.privateNullableHeaders");function*d3(i){if(!i)return;if(w_ in i){let{values:n,nulls:o}=i;yield*n.entries();for(let a of o)yield[a,null];return}let e=!1,t;i instanceof Headers?t=i.entries():Lf(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let n of t){let o=n[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let a=Lf(n[1])?n[1]:[n[1]],d=!1;for(let u of a)u!==void 0&&(e&&!d&&(d=!0,yield[o,null]),yield[o,u])}}var es=i=>{let e=new Headers,t=new Set;for(let n of i){let o=new Set;for(let[a,d]of d3(n)){let u=a.toLowerCase();o.has(u)||(e.delete(a),o.add(u)),d===null?(e.delete(a),t.add(u)):(e.append(a,d),t.delete(u))}}return{[w_]:!0,values:e,nulls:t}};var a0=i=>{var e,t,n,o,a,d;if(typeof globalThis.process<"u")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(d=(a=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||a===void 0?void 0:a.call(o,i))===null||d===void 0?void 0:d.trim()};var E_,u3=(()=>{class i{constructor(t){var n,o,a,d,u,p,g,{baseURL:C=a0("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:w=(n=a0("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:A="v1beta"}=t,V=xl(t,["baseURL","apiKey","apiVersion"]);let G=Object.assign(Object.assign({apiKey:w,apiVersion:A},V),{baseURL:C||"https://generativelanguage.googleapis.com"});this.baseURL=G.baseURL,this.timeout=(o=G.timeout)!==null&&o!==void 0?o:i.DEFAULT_TIMEOUT,this.logger=(a=G.logger)!==null&&a!==void 0?a:console;let z="warn";this.logLevel=z,this.logLevel=(u=(d=Hf(G.logLevel,"ClientOptions.logLevel",this))!==null&&d!==void 0?d:Hf(a0("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&u!==void 0?u:z,this.fetchOptions=G.fetchOptions,this.maxRetries=(p=G.maxRetries)!==null&&p!==void 0?p:2,this.fetch=(g=G.fetch)!==null&&g!==void 0?g:qE(),this.encoder=KE,this._options=G,this.apiKey=w,this.apiVersion=A,this.clientAdapter=G.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){let n=es([t.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return es([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return es([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([n,o])=>typeof o<"u").map(([n,o])=>{if(typeof o=="string"||typeof o=="number"||typeof o=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(o)}`;if(o===null)return`${encodeURIComponent(n)}=`;throw new qt(`Cannot stringify type ${typeof o}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${No}`}defaultIdempotencyKey(){return`stainless-node-retry-${kE()}`}makeStatusError(t,n,o,a){return Wt.generate(t,n,o,a)}buildURL(t,n,o){let a=!this.baseURLOverridden()&&o||this.baseURL,d=FE(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),u=this.defaultQuery();return NE(u)||(n=Object.assign(Object.assign({},u),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(d.search=this.stringifyQuery(n)),d.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){let n=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(t,{url:n,options:o}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,o){return this.request(Promise.resolve(o).then(a=>Object.assign({method:t,path:n},a)))}request(t,n=null){return new X0(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,o){var a,d,u;let p=await t,g=(a=p.maxRetries)!==null&&a!==void 0?a:this.maxRetries;n==null&&(n=g),await this.prepareOptions(p);let{req:C,url:w,timeout:A}=await this.buildRequest(p,{retryCount:g-n});await this.prepareRequest(C,{url:w,options:p});let V="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),G=o===void 0?"":`, retryOf: ${o}`,z=Date.now();if(Bt(this).debug(`[${V}] sending request`,Yi({retryOfRequestLogID:o,method:p.method,url:w,options:p,headers:C.headers})),!((d=p.signal)===null||d===void 0)&&d.aborted)throw new os;let $=new AbortController,K=await this.fetchWithTimeout(w,C,A,$).catch(K0),Z=Date.now();if(K instanceof globalThis.Error){let re=`retrying, ${n} attempts remaining`;if(!((u=p.signal)===null||u===void 0)&&u.aborted)throw new os;let le=z0(K)||/timed? ?out/i.test(String(K)+("cause"in K?String(K.cause):""));if(n)return Bt(this).info(`[${V}] connection ${le?"timed out":"failed"} - ${re}`),Bt(this).debug(`[${V}] connection ${le?"timed out":"failed"} (${re})`,Yi({retryOfRequestLogID:o,url:w,durationMs:Z-z,message:K.message})),this.retryRequest(p,n,o??V);throw Bt(this).info(`[${V}] connection ${le?"timed out":"failed"} - error; no more retries left`),Bt(this).debug(`[${V}] connection ${le?"timed out":"failed"} (error; no more retries left)`,Yi({retryOfRequestLogID:o,url:w,durationMs:Z-z,message:K.message})),le?new bl:new Lo({cause:K})}let Y=`[${V}${G}] ${C.method} ${w} ${K.ok?"succeeded":"failed"} with status ${K.status} in ${Z-z}ms`;if(!K.ok){let re=await this.shouldRetry(K);if(n&&re){let Pe=`retrying, ${n} attempts remaining`;return await zE(K.body),Bt(this).info(`${Y} - ${Pe}`),Bt(this).debug(`[${V}] response error (${Pe})`,Yi({retryOfRequestLogID:o,url:K.url,status:K.status,headers:K.headers,durationMs:Z-z})),this.retryRequest(p,n,o??V,K.headers)}let le=re?"error; no more retries left":"error; not retryable";Bt(this).info(`${Y} - ${le}`);let ue=await K.text().catch(Pe=>K0(Pe).message),pe=LE(ue),Fe=pe?void 0:ue;throw Bt(this).debug(`[${V}] response error (${le})`,Yi({retryOfRequestLogID:o,url:K.url,status:K.status,headers:K.headers,message:Fe,durationMs:Date.now()-z})),this.makeStatusError(K.status,pe,Fe,K.headers)}return Bt(this).info(Y),Bt(this).debug(`[${V}] response start`,Yi({retryOfRequestLogID:o,url:K.url,status:K.status,headers:K.headers,durationMs:Z-z})),{response:K,options:p,controller:$,requestLogID:V,retryOfRequestLogID:o,startTime:z}}async fetchWithTimeout(t,n,o,a){let d=n||{},{signal:u,method:p}=d,g=xl(d,["signal","method"]);u&&u.addEventListener("abort",()=>a.abort());let C=setTimeout(()=>a.abort(),o),w=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||typeof g.body=="object"&&g.body!==null&&Symbol.asyncIterator in g.body,A=Object.assign(Object.assign(Object.assign({signal:a.signal},w?{duplex:"half"}:{}),{method:"GET"}),g);p&&(A.method=p.toUpperCase());try{return await this.fetch.call(void 0,t,A)}finally{clearTimeout(C)}}async shouldRetry(t){let n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,o,a){var d;let u,p=a?.get("retry-after-ms");if(p){let C=parseFloat(p);Number.isNaN(C)||(u=C)}let g=a?.get("retry-after");if(g&&!u){let C=parseFloat(g);Number.isNaN(C)?u=Date.parse(g)-Date.now():u=C*1e3}if(!(u&&0<=u&&u<60*1e3)){let C=(d=t.maxRetries)!==null&&d!==void 0?d:this.maxRetries;u=this.calculateDefaultRetryTimeoutMillis(n,C)}return await OE(u),this.makeRequest(t,n-1,o)}calculateDefaultRetryTimeoutMillis(t,n){let d=n-t,u=Math.min(.5*Math.pow(2,d),8),p=1-Math.random()*.25;return u*p*1e3}async buildRequest(t,{retryCount:n=0}={}){var o,a,d;let u=Object.assign({},t),{method:p,path:g,query:C,defaultBaseURL:w}=u,A=this.buildURL(g,C,w);"timeout"in u&&BE("timeout",u.timeout),u.timeout=(o=u.timeout)!==null&&o!==void 0?o:this.timeout;let{bodyHeaders:V,body:G}=this.buildBody({options:u}),z=await this.buildHeaders({options:t,method:p,bodyHeaders:V,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:p,headers:z},u.signal&&{signal:u.signal}),globalThis.ReadableStream&&G instanceof globalThis.ReadableStream&&{duplex:"half"}),G&&{body:G}),(a=this.fetchOptions)!==null&&a!==void 0?a:{}),(d=u.fetchOptions)!==null&&d!==void 0?d:{}),url:A,timeout:u.timeout}}async buildHeaders({options:t,method:n,bodyHeaders:o,retryCount:a}){let d={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),d[this.idempotencyHeader]=t.idempotencyKey);let u=await this.authHeaders(t),p=es([d,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),HE()),this._options.defaultHeaders,o,t.headers,u]);return this.validateHeaders(p),p.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};let o=es([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&o.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:WE(t)}:this.encoder({body:t,headers:o})}}return i.DEFAULT_TIMEOUT=6e4,i})(),mt=class extends u3{constructor(){super(...arguments),this.interactions=new Il(this)}};E_=mt;mt.GeminiNextGenAPIClient=E_;mt.GeminiNextGenAPIClientError=qt;mt.APIError=Wt;mt.APIConnectionError=Lo;mt.APIConnectionTimeoutError=bl;mt.APIUserAbortError=os;mt.NotFoundError=El;mt.ConflictError=Dl;mt.RateLimitError=Ml;mt.BadRequestError=yl;mt.AuthenticationError=Sl;mt.InternalServerError=Tl;mt.PermissionDeniedError=wl;mt.UnprocessableEntityError=Al;mt.toFile=XE;mt.Interactions=Il;function m3(i,e){let t={},n=h(i,["name"]);return n!=null&&b(t,["_url","name"],n),t}function p3(i,e){let t={},n=h(i,["name"]);return n!=null&&b(t,["_url","name"],n),t}function g3(i,e){let t={},n=h(i,["sdkHttpResponse"]);return n!=null&&b(t,["sdkHttpResponse"],n),t}function h3(i,e){let t={},n=h(i,["sdkHttpResponse"]);return n!=null&&b(t,["sdkHttpResponse"],n),t}function f3(i,e,t){let n={};if(h(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let o=h(i,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&b(e,["displayName"],o),h(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let a=h(i,["epochCount"]);e!==void 0&&a!=null&&b(e,["tuningTask","hyperparameters","epochCount"],a);let d=h(i,["learningRateMultiplier"]);if(d!=null&&b(n,["tuningTask","hyperparameters","learningRateMultiplier"],d),h(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(h(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(h(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let u=h(i,["batchSize"]);e!==void 0&&u!=null&&b(e,["tuningTask","hyperparameters","batchSize"],u);let p=h(i,["learningRate"]);if(e!==void 0&&p!=null&&b(e,["tuningTask","hyperparameters","learningRate"],p),h(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(h(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function _3(i,e,t){let n={},o=h(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let V=h(i,["validationDataset"]);e!==void 0&&V!=null&&b(e,["supervisedTuningSpec"],Wf(V))}else if(o==="PREFERENCE_TUNING"){let V=h(i,["validationDataset"]);e!==void 0&&V!=null&&b(e,["preferenceOptimizationSpec"],Wf(V))}let a=h(i,["tunedModelDisplayName"]);e!==void 0&&a!=null&&b(e,["tunedModelDisplayName"],a);let d=h(i,["description"]);e!==void 0&&d!=null&&b(e,["description"],d);let u=h(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){let V=h(i,["epochCount"]);e!==void 0&&V!=null&&b(e,["supervisedTuningSpec","hyperParameters","epochCount"],V)}else if(u==="PREFERENCE_TUNING"){let V=h(i,["epochCount"]);e!==void 0&&V!=null&&b(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],V)}let p=h(t,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){let V=h(i,["learningRateMultiplier"]);e!==void 0&&V!=null&&b(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],V)}else if(p==="PREFERENCE_TUNING"){let V=h(i,["learningRateMultiplier"]);e!==void 0&&V!=null&&b(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],V)}let g=h(t,["config","method"]);if(g===void 0&&(g="SUPERVISED_FINE_TUNING"),g==="SUPERVISED_FINE_TUNING"){let V=h(i,["exportLastCheckpointOnly"]);e!==void 0&&V!=null&&b(e,["supervisedTuningSpec","exportLastCheckpointOnly"],V)}else if(g==="PREFERENCE_TUNING"){let V=h(i,["exportLastCheckpointOnly"]);e!==void 0&&V!=null&&b(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],V)}let C=h(t,["config","method"]);if(C===void 0&&(C="SUPERVISED_FINE_TUNING"),C==="SUPERVISED_FINE_TUNING"){let V=h(i,["adapterSize"]);e!==void 0&&V!=null&&b(e,["supervisedTuningSpec","hyperParameters","adapterSize"],V)}else if(C==="PREFERENCE_TUNING"){let V=h(i,["adapterSize"]);e!==void 0&&V!=null&&b(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],V)}if(h(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(h(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let w=h(i,["labels"]);e!==void 0&&w!=null&&b(e,["labels"],w);let A=h(i,["beta"]);return e!==void 0&&A!=null&&b(e,["preferenceOptimizationSpec","hyperParameters","beta"],A),n}function v3(i,e){let t={},n=h(i,["baseModel"]);n!=null&&b(t,["baseModel"],n);let o=h(i,["preTunedModel"]);o!=null&&b(t,["preTunedModel"],o);let a=h(i,["trainingDataset"]);a!=null&&T3(a);let d=h(i,["config"]);return d!=null&&f3(d,t),t}function x3(i,e){let t={},n=h(i,["baseModel"]);n!=null&&b(t,["baseModel"],n);let o=h(i,["preTunedModel"]);o!=null&&b(t,["preTunedModel"],o);let a=h(i,["trainingDataset"]);a!=null&&k3(a,t,e);let d=h(i,["config"]);return d!=null&&_3(d,t,e),t}function C3(i,e){let t={},n=h(i,["name"]);return n!=null&&b(t,["_url","name"],n),t}function b3(i,e){let t={},n=h(i,["name"]);return n!=null&&b(t,["_url","name"],n),t}function y3(i,e,t){let n={},o=h(i,["pageSize"]);e!==void 0&&o!=null&&b(e,["_query","pageSize"],o);let a=h(i,["pageToken"]);e!==void 0&&a!=null&&b(e,["_query","pageToken"],a);let d=h(i,["filter"]);return e!==void 0&&d!=null&&b(e,["_query","filter"],d),n}function S3(i,e,t){let n={},o=h(i,["pageSize"]);e!==void 0&&o!=null&&b(e,["_query","pageSize"],o);let a=h(i,["pageToken"]);e!==void 0&&a!=null&&b(e,["_query","pageToken"],a);let d=h(i,["filter"]);return e!==void 0&&d!=null&&b(e,["_query","filter"],d),n}function w3(i,e){let t={},n=h(i,["config"]);return n!=null&&y3(n,t),t}function E3(i,e){let t={},n=h(i,["config"]);return n!=null&&S3(n,t),t}function D3(i,e){let t={},n=h(i,["sdkHttpResponse"]);n!=null&&b(t,["sdkHttpResponse"],n);let o=h(i,["nextPageToken"]);o!=null&&b(t,["nextPageToken"],o);let a=h(i,["tunedModels"]);if(a!=null){let d=a;Array.isArray(d)&&(d=d.map(u=>D_(u))),b(t,["tuningJobs"],d)}return t}function A3(i,e){let t={},n=h(i,["sdkHttpResponse"]);n!=null&&b(t,["sdkHttpResponse"],n);let o=h(i,["nextPageToken"]);o!=null&&b(t,["nextPageToken"],o);let a=h(i,["tuningJobs"]);if(a!=null){let d=a;Array.isArray(d)&&(d=d.map(u=>Z0(u))),b(t,["tuningJobs"],d)}return t}function M3(i,e){let t={},n=h(i,["name"]);n!=null&&b(t,["model"],n);let o=h(i,["name"]);return o!=null&&b(t,["endpoint"],o),t}function T3(i,e){let t={};if(h(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=h(i,["examples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),b(t,["examples","examples"],o)}return t}function k3(i,e,t){let n={},o=h(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let d=h(i,["gcsUri"]);e!==void 0&&d!=null&&b(e,["supervisedTuningSpec","trainingDatasetUri"],d)}else if(o==="PREFERENCE_TUNING"){let d=h(i,["gcsUri"]);e!==void 0&&d!=null&&b(e,["preferenceOptimizationSpec","trainingDatasetUri"],d)}let a=h(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let d=h(i,["vertexDatasetResource"]);e!==void 0&&d!=null&&b(e,["supervisedTuningSpec","trainingDatasetUri"],d)}else if(a==="PREFERENCE_TUNING"){let d=h(i,["vertexDatasetResource"]);e!==void 0&&d!=null&&b(e,["preferenceOptimizationSpec","trainingDatasetUri"],d)}if(h(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function D_(i,e){let t={},n=h(i,["sdkHttpResponse"]);n!=null&&b(t,["sdkHttpResponse"],n);let o=h(i,["name"]);o!=null&&b(t,["name"],o);let a=h(i,["state"]);a!=null&&b(t,["state"],e_(a));let d=h(i,["createTime"]);d!=null&&b(t,["createTime"],d);let u=h(i,["tuningTask","startTime"]);u!=null&&b(t,["startTime"],u);let p=h(i,["tuningTask","completeTime"]);p!=null&&b(t,["endTime"],p);let g=h(i,["updateTime"]);g!=null&&b(t,["updateTime"],g);let C=h(i,["description"]);C!=null&&b(t,["description"],C);let w=h(i,["baseModel"]);w!=null&&b(t,["baseModel"],w);let A=h(i,["_self"]);return A!=null&&b(t,["tunedModel"],M3(A)),t}function Z0(i,e){let t={},n=h(i,["sdkHttpResponse"]);n!=null&&b(t,["sdkHttpResponse"],n);let o=h(i,["name"]);o!=null&&b(t,["name"],o);let a=h(i,["state"]);a!=null&&b(t,["state"],e_(a));let d=h(i,["createTime"]);d!=null&&b(t,["createTime"],d);let u=h(i,["startTime"]);u!=null&&b(t,["startTime"],u);let p=h(i,["endTime"]);p!=null&&b(t,["endTime"],p);let g=h(i,["updateTime"]);g!=null&&b(t,["updateTime"],g);let C=h(i,["error"]);C!=null&&b(t,["error"],C);let w=h(i,["description"]);w!=null&&b(t,["description"],w);let A=h(i,["baseModel"]);A!=null&&b(t,["baseModel"],A);let V=h(i,["tunedModel"]);V!=null&&b(t,["tunedModel"],V);let G=h(i,["preTunedModel"]);G!=null&&b(t,["preTunedModel"],G);let z=h(i,["supervisedTuningSpec"]);z!=null&&b(t,["supervisedTuningSpec"],z);let $=h(i,["preferenceOptimizationSpec"]);$!=null&&b(t,["preferenceOptimizationSpec"],$);let K=h(i,["tuningDataStats"]);K!=null&&b(t,["tuningDataStats"],K);let Z=h(i,["encryptionSpec"]);Z!=null&&b(t,["encryptionSpec"],Z);let Y=h(i,["partnerModelTuningSpec"]);Y!=null&&b(t,["partnerModelTuningSpec"],Y);let re=h(i,["customBaseModel"]);re!=null&&b(t,["customBaseModel"],re);let le=h(i,["experiment"]);le!=null&&b(t,["experiment"],le);let ue=h(i,["labels"]);ue!=null&&b(t,["labels"],ue);let pe=h(i,["outputUri"]);pe!=null&&b(t,["outputUri"],pe);let Fe=h(i,["pipelineJob"]);Fe!=null&&b(t,["pipelineJob"],Fe);let we=h(i,["serviceAccount"]);we!=null&&b(t,["serviceAccount"],we);let Pe=h(i,["tunedModelDisplayName"]);Pe!=null&&b(t,["tunedModelDisplayName"],Pe);let at=h(i,["veoTuningSpec"]);return at!=null&&b(t,["veoTuningSpec"],at),t}function I3(i,e){let t={},n=h(i,["sdkHttpResponse"]);n!=null&&b(t,["sdkHttpResponse"],n);let o=h(i,["name"]);o!=null&&b(t,["name"],o);let a=h(i,["metadata"]);a!=null&&b(t,["metadata"],a);let d=h(i,["done"]);d!=null&&b(t,["done"],d);let u=h(i,["error"]);return u!=null&&b(t,["error"],u),t}function Wf(i,e){let t={},n=h(i,["gcsUri"]);n!=null&&b(t,["validationDatasetUri"],n);let o=h(i,["vertexDatasetResource"]);return o!=null&&b(t,["validationDatasetUri"],o),t}var em=class extends Tn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ei(yi.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let o={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(o.checkpointId=t.config.preTunedModelCheckpointId);let a=Object.assign(Object.assign({},t),{preTunedModel:o});return a.baseModel=void 0,await this.tuneInternal(a)}else{let o=Object.assign({},t);return await this.tuneInternal(o)}else{let o=Object.assign({},t),a=await this.tuneMldevInternal(o),d="";return a.metadata!==void 0&&a.metadata.tunedModel!==void 0?d=a.metadata.tunedModel:a.name!==void 0&&a.name.includes("/operations/")&&(d=a.name.split("/operations/")[0]),{name:d,state:jf.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=b3(e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>Z0(C))}else{let g=C3(e);return u=fe("{name}",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>D_(C))}}async listInternal(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=E3(e);return u=fe("tuningJobs",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=A3(C),A=new pl;return Object.assign(A,w),A})}else{let g=w3(e);return u=fe("tunedModels",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=D3(C),A=new pl;return Object.assign(A,w),A})}}async cancel(e){var t,n,o,a;let d,u="",p={};if(this.apiClient.isVertexAI()){let g=p3(e);return u=fe("{name}:cancel",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=h3(C),A=new gl;return Object.assign(A,w),A})}else{let g=m3(e);return u=fe("{name}:cancel",g._url),p=g._query,delete g._url,delete g._query,d=this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(w=>{let A=w;return A.sdkHttpResponse={headers:C.headers},A})),d.then(C=>{let w=g3(C),A=new gl;return Object.assign(A,w),A})}}async tuneInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=x3(e,e);return a=fe("tuningJobs",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(g=>{let C=g;return C.sdkHttpResponse={headers:p.headers},C})),o.then(p=>Z0(p))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=v3(e);return a=fe("tunedModels",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(g=>{let C=g;return C.sdkHttpResponse={headers:p.headers},C})),o.then(p=>I3(p))}}};var tm=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},F3=1024*1024*8,P3=3,R3=1e3,N3=2,Pl="x-goog-upload-status";async function V3(i,e,t){var n;let o=await A_(i,e,t),a=await o?.json();if(((n=o?.headers)===null||n===void 0?void 0:n[Pl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return a.file}async function B3(i,e,t){var n;let o=await A_(i,e,t),a=await o?.json();if(((n=o?.headers)===null||n===void 0?void 0:n[Pl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let d=Kf(a),u=new w0;return Object.assign(u,d),u}async function A_(i,e,t){var n,o;let a=0,d=0,u=new is(new Response),p="upload";for(a=i.size;d<a;){let g=Math.min(F3,a-d),C=i.slice(d,d+g);d+g>=a&&(p+=", finalize");let w=0,A=R3;for(;w<P3&&(u=await t.request({path:"",body:C,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(d),"Content-Length":String(g)}}}),!(!((n=u?.headers)===null||n===void 0)&&n[Pl]));)w++,await O3(A),A=A*N3;if(d+=g,((o=u?.headers)===null||o===void 0?void 0:o[Pl])!=="active")break;if(a<=d)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function L3(i){return{size:i.size,type:i.type}}function O3(i){return new Promise(e=>setTimeout(e,i))}var nm=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await V3(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await B3(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await L3(e)}};var im=class{create(e,t,n){return new om(e,t,n)}},om=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var zf="x-goog-api-key",rm=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(zf)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(zf,this.apiKey)}}};var U3="gl-node/",Rl=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new mt({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=gy(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let o=new rm(this.apiKey);this.apiClient=new N0({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:U3+"web",uploader:new nm,downloader:new tm}),this.models=new G0(this.apiClient),this.live=new O0(this.apiClient,o,new im),this.batches=new A0(this.apiClient),this.chats=new T0(this.models,this.apiClient),this.caches=new M0(this.apiClient),this.files=new I0(this.apiClient),this.operations=new $0(this.apiClient),this.authTokens=new H0(this.apiClient),this.tunings=new em(this.apiClient),this.fileSearchStores=new W0(this.apiClient)}};var Q=class i{constructor(e){this.ngZone=e;this.listeners=[];this.channelListeners=new Map;this.ws=null;this.wsReconnectTimer=null;this.wsConnected=!1;this.webListeners=new Map;this.apiBaseUrl="";this.isWebMode=!1;if(window.require)try{let t=window.require("electron");t&&t.ipcRenderer?(this.ipcRenderer=t.ipcRenderer,console.log("Electron IPC renderer successfully loaded.")):(console.warn("Electron IPC renderer not found, running in browser mode."),this.initWebMode())}catch(t){console.error("Could not load Electron IPC renderer:",t),this.initWebMode()}else console.warn("Electron IPC not available, running in browser mode."),this.initWebMode()}initWebMode(){this.isWebMode=!0,window.location.hostname==="localhost"&&window.location.port==="4200"?this.apiBaseUrl="http://localhost:8000":this.apiBaseUrl=`${window.location.protocol}//${window.location.host}`,console.log(`[Web Mode] API URL: ${this.apiBaseUrl}`),this.connectWebSocket()}connectWebSocket(){let e=window.location.protocol==="https:"?"wss:":"ws:",t;window.location.hostname==="localhost"&&window.location.port==="4200"?t="ws://localhost:8000/ws":t=`${e}//${window.location.host}/ws`,console.log(`[Web Mode] Connecting WebSocket: ${t}`);try{this.ws=new WebSocket(t),this.ws.onopen=()=>{console.log("[Web Mode] WebSocket connected"),this.wsConnected=!0,this.wsReconnectTimer&&(clearTimeout(this.wsReconnectTimer),this.wsReconnectTimer=null)},this.ws.onmessage=n=>{try{let o=JSON.parse(n.data),a=o.event||o.type,d=o.data||o.payload||o,u=this.webListeners.get(a);u&&this.ngZone.run(()=>{u.forEach(p=>{try{p(d)}catch(g){console.error(`[Web Mode] Listener error for ${a}:`,g)}})})}catch(o){console.error("[Web Mode] WebSocket message parse error:",o)}},this.ws.onclose=()=>{console.log("[Web Mode] WebSocket disconnected"),this.wsConnected=!1,this.scheduleReconnect()},this.ws.onerror=n=>{console.error("[Web Mode] WebSocket error:",n)}}catch(n){console.error("[Web Mode] WebSocket connection failed:",n),this.scheduleReconnect()}}scheduleReconnect(){this.wsReconnectTimer||(this.wsReconnectTimer=setTimeout(()=>{this.wsReconnectTimer=null,console.log("[Web Mode] Attempting WebSocket reconnection..."),this.connectWebSocket()},5e3))}ngOnDestroy(){this.cleanupAll(),this.ws&&(this.ws.close(),this.ws=null),this.wsReconnectTimer&&clearTimeout(this.wsReconnectTimer)}send(e,...t){this.ipcRenderer?(console.log(`[IPC Service] \u2192 Sending '${e}':`,t),this.ipcRenderer.send(e,...t)):this.isWebMode?(console.log(`[Web Mode] \u2192 Sending '${e}':`,t),this.httpSend(e,t[0]||{})):console.log(`[Browser Mode] IPC Send to '${e}':`,...t)}async httpSend(e,t){try{let n=`${this.apiBaseUrl}/api/command`;console.log(`[Web Mode] HTTP POST to ${n}`,{command:e,payload:t});let o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:e,payload:t})});if(!o.ok){console.error(`[Web Mode] HTTP error: ${o.status} ${o.statusText}`);let d=await o.text();console.error("[Web Mode] Error body:",d),this.triggerEvent("login-error",{error:`HTTP \u932F\u8AA4: ${o.status}`,message:d});return}let a=await o.json();if(console.log(`[Web Mode] Response for '${e}':`,a),a.event){let d=this.webListeners.get(a.event);d&&this.ngZone.run(()=>{d.forEach(u=>u(a.data||a))})}this.handleResponseEvents(e,a)}catch(n){console.error(`[Web Mode] HTTP send error for '${e}':`,n),this.triggerEvent("login-error",{error:n.message||"\u7DB2\u7D61\u9023\u63A5\u932F\u8AA4",message:"\u7121\u6CD5\u9023\u63A5\u5230\u670D\u52D9\u5668\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5"})}}handleResponseEvents(e,t){(e==="login-account"||e==="add-account")&&(t.success&&t.requires_code?this.triggerEvent("login-requires-code",{accountId:t.account_id||t.accountId,phone:t.phone,phoneCodeHash:t.phone_code_hash||t.phoneCodeHash,sendType:t.send_type||t.sendType||"app",message:t.message}):t.success&&t.requires_2fa?this.triggerEvent("login-requires-2fa",{accountId:t.account_id||t.accountId,phone:t.phone}):t.success&&t.status==="Online"?this.triggerEvent("login-success",{accountId:t.account_id||t.accountId,phone:t.phone,userInfo:t.user_info||t.userInfo}):t.success||this.triggerEvent("login-error",{error:t.error||t.message,phone:t.phone,codeExpired:t.code_expired||t.codeExpired})),t.accounts&&this.triggerEvent("accounts-updated",t.accounts),e==="get-api-credentials"&&this.triggerEvent("api-credentials-updated",{credentials:t.credentials||t.data||[]}),e==="add-api-credential"&&this.triggerEvent("api-credential-added",{success:t.success!==!1,credential:t.credential||t.data,error:t.error})}triggerEvent(e,t){let n=this.webListeners.get(e);n&&n.size>0&&(console.log(`[Web Mode] Triggering event '${e}':`,t),this.ngZone.run(()=>{n.forEach(o=>{try{o(t)}catch(a){console.error(`[Web Mode] Listener error for ${e}:`,a)}})}))}on(e,t){if(this.isWebMode)return this.webListeners.has(e)||this.webListeners.set(e,new Set),this.webListeners.get(e).add(t),console.log(`[Web Mode] Added listener for '${e}'`),()=>{let d=this.webListeners.get(e);d&&(d.delete(t),console.log(`[Web Mode] Removed listener for '${e}'`))};if(!this.ipcRenderer)return()=>{};let n=(d,...u)=>{this.ngZone.run(()=>{t(...u)})},o={channel:e,originalListener:t,wrappedListener:n};this.listeners.push(o);let a=this.channelListeners.get(e)||[];return a.push(o),this.channelListeners.set(e,a),this.ipcRenderer.on(e,n),()=>{this.removeListener(e,t)}}once(e,t){if(this.isWebMode){let u=(...p)=>{this.webListeners.get(e)?.delete(u),t(...p)};return this.webListeners.has(e)||this.webListeners.set(e,new Set),this.webListeners.get(e).add(u),()=>{this.webListeners.get(e)?.delete(u)}}if(!this.ipcRenderer)return()=>{};let n=!1,o=(u,...p)=>{n||(n=!0,this.removeListenerByWrapped(e,o),this.ngZone.run(()=>{t(...p)}))},a={channel:e,originalListener:t,wrappedListener:o};this.listeners.push(a);let d=this.channelListeners.get(e)||[];return d.push(a),this.channelListeners.set(e,d),this.ipcRenderer.on(e,o),()=>{n||this.removeListenerByWrapped(e,o)}}invoke(e,...t){return this.isWebMode?this.httpInvoke(e,t[0]||{}):this.ipcRenderer?this.ipcRenderer.invoke(e,...t):(console.log(`[Browser Mode] IPC Invoke to '${e}':`,...t),Promise.resolve(null))}async httpInvoke(e,t){try{let n=`${this.apiBaseUrl}/api/command`,o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:e,payload:t})});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.json()}catch(n){return console.error(`[Web Mode] HTTP invoke error for '${e}':`,n),{success:!1,error:n.message}}}removeListener(e,t){if(this.isWebMode){this.webListeners.get(e)?.delete(t);return}if(!this.ipcRenderer)return;let n=this.channelListeners.get(e);if(!n)return;let o=n.findIndex(a=>a.originalListener===t);if(o!==-1){let a=n[o];this.ipcRenderer.removeListener(e,a.wrappedListener),n.splice(o,1);let d=this.listeners.findIndex(u=>u===a);d!==-1&&this.listeners.splice(d,1)}}removeListenerByWrapped(e,t){if(!this.ipcRenderer)return;this.ipcRenderer.removeListener(e,t);let n=this.channelListeners.get(e);if(n){let o=n.findIndex(a=>a.wrappedListener===t);if(o!==-1){let a=n[o];n.splice(o,1);let d=this.listeners.findIndex(u=>u===a);d!==-1&&this.listeners.splice(d,1)}}}cleanup(e){if(this.isWebMode){this.webListeners.delete(e);return}if(!this.ipcRenderer)return;this.ipcRenderer.removeAllListeners(e);let t=this.channelListeners.get(e);t&&(t.forEach(n=>{let o=this.listeners.findIndex(a=>a===n);o!==-1&&this.listeners.splice(o,1)}),this.channelListeners.delete(e))}cleanupAll(){if(this.isWebMode){this.webListeners.clear();return}if(!this.ipcRenderer)return;new Set(this.listeners.map(t=>t.channel)).forEach(t=>{this.ipcRenderer.removeAllListeners(t)}),this.listeners=[],this.channelListeners.clear(),console.log("[IPC] All listeners cleaned up")}off(e,t){this.cleanup(e)}getListenerCount(e){if(this.isWebMode){if(e)return this.webListeners.get(e)?.size||0;let t=0;return this.webListeners.forEach(n=>t+=n.size),t}return e?this.channelListeners.get(e)?.length||0:this.listeners.length}getActiveChannels(){return this.isWebMode?Array.from(this.webListeners.keys()):Array.from(this.channelListeners.keys())}async selectFileForAttachment(e,t=!1){return this.isWebMode?(console.warn("[Web Mode] selectFileForAttachment - using browser file picker"),{success:!1,canceled:!0}):this.ipcRenderer?this.invoke("select-file-for-attachment",{type:e,multiple:t}):(console.warn("[Browser Mode] selectFileForAttachment not available"),{success:!1,canceled:!0})}static{this.\u0275fac=function(t){return new(t||i)(Ae(Pn))}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Ll=class i{constructor(){this.genAI=null;this.apiKey="";this.ipc=F(Q);this.isInitialized=!1;this.loadApiKeyFromBackend()}loadApiKeyFromBackend(){let e=localStorage.getItem("ai_api_key");e&&this.setApiKeyInternal(e),this.ipc.on("ai-settings-loaded",t=>{t?.geminiApiKey&&(this.setApiKeyInternal(t.geminiApiKey),localStorage.setItem("ai_api_key",t.geminiApiKey),console.log("[GeminiService] API key loaded from backend"))}),this.ipc.send("get-ai-settings",{}),setTimeout(()=>{this.isConfigured()||console.warn("Gemini API Key not found. AI features will be disabled until configured.")},2e3)}setApiKeyInternal(e){e&&(this.apiKey=e,this.genAI=new Rl({apiKey:e}),this.isInitialized=!0)}setApiKey(e){e&&(this.setApiKeyInternal(e),localStorage.setItem("ai_api_key",e),this.ipc.send("save-ai-settings",{geminiApiKey:e}),console.log("[GeminiService] API key configured and saved to backend"))}isConfigured(){return this.genAI!==null&&this.apiKey.length>0}getApiKey(){return this.apiKey}async generateOutreachMessage(e,t){if(!this.genAI)throw new Error("Gemini API is not initialized. Please ensure the API_KEY environment variable is set.");let n="gemini-2.5-flash",o="You are an expert marketing assistant for a tool called TG-AI\u667A\u63A7\u738B. You write friendly, professional, and short direct messages (DMs). Do not use markdown formatting. Just return the plain text of the message.",a=`
      A user was found in the Telegram group "${e.sourceGroup}" because they mentioned the keyword "${e.triggeredKeyword}".
      Their username is @${e.username}.

      Based on the following instruction, write a direct message to this user.

      Instruction: "${t}"
    `;try{return(await this.genAI.models.generateContent({model:n,contents:a,config:{systemInstruction:o}})).text}catch(d){throw console.error("Error generating content with Gemini:",d),new Error("Failed to generate message. Check console for details.")}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var G3={en:{title:"TG-AI\u667A\u63A7\u738B",subtitle:"AI Telegram Outreach",dashboard:"Dashboard",accounts:"Accounts",automation:"Automation",leads:"Leads",analytics:"Analytics",logs:"Logs",performance:"Performance",alerts:"Alerts",resourceManagement:"Resource Management",marketingAutomation:"Marketing Automation",aiIntelligence:"AI & Intelligence",systemMonitor:"System Monitor",resourceDiscoveryMenu:"Resource Discovery",aiCenter:"AI Center",monitoringCenter:"Monitoring Center",aiAutoChat:"AI Auto Chat",ragKnowledge:"RAG Knowledge",voiceService:"Voice Service",enableAiAutoChat:"Enable AI Auto Chat",aiAutoChatHint:"Automatically reply to private messages using AI",chatMode:"Chat Mode",systemPrompt:"System Prompt",ttsService:"Text to Speech (TTS)",sttService:"Speech to Text (STT)",enableTts:"Enable TTS",enableStt:"Enable STT",ttsEndpointLabel:"TTS Endpoint",sttEndpointLabel:"STT Endpoint",settings:"Settings",totalAccounts:"Total Accounts",onlineAccounts:"Online Accounts",leadsToday:"Leads Today",messagesSentToday:"Messages Sent Today",leadsCaptured:"Leads Captured",keywords:"Keywords",monitoredGroups:"Monitored Groups",systemControl:"System Control",monitoringStatus:"Monitoring Status:",active:"Active",inactive:"Inactive",start:"Start",stop:"Stop",recentLogs:"Recent Logs",recentLeads:"Recent Leads",noRecentActivity:"No recent activity.",manageAccounts:"Manage Accounts",addNewAccount:"Add New Account Manually",phoneNumber:"Phone Number",apiId:"API ID",apiHash:"API Hash",proxy:"SOCKS5 Proxy (Optional)",addAccount:"Add Account",phone:"Phone",status:"Status",actions:"Actions",login:"Login",remove:"Remove",enableWarmup:"Enable Warm-up Mode",dailySends:"Daily Sends",monitoringConfig:"Monitoring Configuration",keywordsTitle:"Keywords",addGroupTitle:"Groups to Monitor",groupUrl:"Group URL or @username",add:"Add",regex:"Regex",leadPipeline:"Lead Pipeline",newLeadCaptured:"New Lead Captured",username:"Username",sourceGroup:"Source Group",keyword:"Keyword",message:"Message",contacted:"Contacted",actionLogs:"Action Logs",clearLogs:"Clear Logs",settingsTitle:"Settings",messagingConfig:"Messaging Configuration",enableSpintax:"Enable Spintax Processing",spintaxHint:"Process message prompts with Spintax (e.g., {Hi|Hello}) for message variations.",abTesting:"A/B Testing Templates",addNewTemplate:"Add New Template",templateName:"Template Name",prompt:"Prompt",saveTemplate:"Save Template",deactivate:"Deactivate",activate:"Activate",abTestingHint:"Create multiple active templates. The system will automatically assign them to new leads for testing.",leadDetails:"Lead Details",sendMessageTab:"Send Message",historyTab:"History",assignedTemplate:"Assigned Template",customizePrompt:"Customize Prompt for this Lead",selectSenderAccount:"Select Sender Account",noSenderAccounts:"No sender accounts available",noSenderAccountsHint:"Please configure sender accounts in Account Management",manualInput:"Manual Input",aiGenerate:"AI Generate",useTemplate:"Use Template",aiPromptPlaceholder:"Enter instructions for AI to generate message...",aiNotConfigured:"AI is not configured.",goToSettings:"Go to Settings",selectTemplatePlaceholder:"Choose a template...",messageContent:"Message Content",characters:"chars",messageContentPlaceholder:"Enter your message here...",messageRequired:"Please enter a message",selectSenderFirst:"Please select a sender account",senderAccountNotFound:"Sender account not found",messageSent:"Message sent successfully!",messageQueued:"Message added to queue",aiConfiguration:"AI Configuration",aiConfigurationHint:"Configure AI API to enable automatic message generation",aiProvider:"AI Provider",customApi:"Custom API",customApiKey:"API Key",geminiKeyHint:"Get your API key from",openaiKeyHint:"Get your API key from",customApiHint:"Enter your custom API key",customApiEndpoint:"API Endpoint URL",testConnection:"Test Connection",testing:"Testing...",saveApiKey:"Save API Key",aiConnectionSuccess:"AI connection successful!",aiConnectionFailed:"AI connection failed",invalidApiKeyFormat:"Invalid API key format",aiSettingsSaved:"AI settings saved!",localAi:"Local AI",localAiConfiguration:"Local AI Service",localAiHint:"Configure local AI service (e.g., Ollama, LocalAI, LM Studio)",localAiEndpoint:"Local AI Endpoint",localAiEndpointPlaceholder:"http://localhost:3002",localAiModel:"Model Name (Optional)",localAiModelPlaceholder:"e.g., llama2, mistral",voiceServices:"Voice Services",voiceServicesHint:"Configure local text-to-speech and speech-to-text services",ttsServiceLabel:"Text-to-Speech (TTS)",ttsEndpoint:"TTS Endpoint",ttsEndpointPlaceholder:"http://localhost:9881",ttsVoice:"Voice ID (Optional)",ttsVoicePlaceholder:"e.g., default, speaker_01",ttsEnabled:"Enable TTS",sttServiceLabel:"Speech-to-Text (STT)",sttEndpoint:"STT Endpoint",sttEndpointPlaceholder:"http://localhost:9000",sttEnabled:"Enable STT",testLocalAi:"Test Local AI",testTts:"Test TTS",testStt:"Test STT",localAiSuccess:"Local AI connection successful!",localAiFailed:"Local AI connection failed",ttsSuccess:"TTS service connection successful!",ttsFailed:"TTS service connection failed",sttSuccess:"STT service connection successful!",sttFailed:"STT service connection failed",invalidEndpointFormat:"Invalid endpoint format (must start with http:// or https://)",saveLocalSettings:"Save Settings",aiAutoChatTitle:"AI Auto Chat",aiAutoChatDescription:"Configure AI-powered automatic responses with unlimited context memory",enableAutoChat:"Enable AI Auto Chat",autoChatMode:"Auto Chat Mode",modeFullAuto:"Full Auto",modeFullAutoDesc:"AI fully takes over, automatically replies to all messages",modeSemiAuto:"Semi-Auto",modeSemiAutoDesc:"AI generates drafts, human confirms before sending",modeAssist:"Assist",modeAssistDesc:"Human inputs, AI provides suggestions and polishing",modeKeyword:"Keyword Trigger",modeKeywordDesc:"AI only activates when keywords are matched",typingSpeed:"Typing Speed",typingSpeedHint:"Characters per minute (simulates human typing)",replyDelay:"Reply Delay",replyDelayHint:"Random delay range before replying (seconds)",systemPromptLabel:"System Prompt",systemPromptHint:"Instructions for AI behavior and personality",systemPromptPlaceholder:"You are a friendly customer service assistant...",maxContextMessages:"Max Context Messages",maxContextHint:"Number of recent messages to include in AI context",enableMemory:"Enable AI Memory",enableMemoryHint:"AI remembers important facts about users across sessions",autoGreeting:"Auto Greeting",autoGreetingHint:"Automatically greet new users",greetingMessage:"Greeting Message",greetingPlaceholder:"Hello {name}! How can I help you today?",unlimitedContext:"Unlimited Context",chatHistory:"Chat History",userProfile:"User Profile",aiMemories:"AI Memories",conversationStage:"Conversation Stage",knowledgeBase:"Knowledge Base",knowledgeBaseHint:"Manage documents, images, videos and QA pairs for AI-enhanced responses",documents:"Documents",images:"Images",videos:"Videos",qaPairs:"Q&A Pairs",addDocument:"Add Document",addImage:"Add Image",addVideo:"Add Video",addQaPair:"Add Q&A",importQa:"Import Q&A",searchKnowledge:"Search Knowledge Base",documentTitle:"Document Title",documentCategory:"Category",documentTags:"Tags",uploadFile:"Upload File",orPasteContent:"Or paste content directly",contentPlaceholder:"Paste document content here...",question:"Question",answer:"Answer",noDocuments:"No documents yet. Add documents to enhance AI responses.",noImages:"No images yet. Add images for rich media responses.",noVideos:"No videos yet. Add videos for tutorial responses.",noQaPairs:"No Q&A pairs yet. Add common questions and answers.",categoryProducts:"Products",categoryTutorials:"Tutorials",categoryGeneral:"General",categoryFaq:"FAQ",dragDropHint:"Drag & drop files here or click to browse",supportedFormats:"Supported formats",fileSize:"File size",chunks:"chunks",preview:"Preview",edit:"Edit",ragEnabled:"RAG Enabled",ragHint:"AI will search knowledge base for relevant information",telegramRagTitle:"Telegram Auto-Learning RAG",telegramRagHint:"Automatically learn from chat history to enhance AI responses",totalKnowledge:"Total Knowledge",qaLearned:"Q&A Learned",scriptsLearned:"Scripts Learned",totalUses:"Total Uses",ragSystemOnline:"RAG System Online",ragSystemOffline:"RAG System Offline",vectorDb:"Vector DB",embedding:"Embedding",initRagSystem:"Initialize RAG",learnFromChats:"Learn from Chats",reindexHighValue:"Reindex High Value",cleanupRag:"Cleanup",refreshStats:"Refresh Stats",searchRagPlaceholder:"Search knowledge base...",searchResults:"Search Results",score:"Score",knowledgeByType:"Knowledge by Type",items:"items",addManualKnowledge:"Add Manual Knowledge",addRagKnowledge:"Add RAG Knowledge",knowledgeType:"Knowledge Type",ragQuestion:"Question",ragAnswer:"Answer",context:"Context",questionPlaceholder:"Enter question or trigger...",answerPlaceholder:"Enter answer or response...",contextPlaceholder:"Optional context info...",addKnowledge:"Add",resourceDiscoveryTitle:"Resource Discovery",resourceDiscoveryHint:"Automatically discover and join Telegram groups/channels",totalResources:"Total Resources",todayDiscovered:"Discovered Today",pendingJoins:"Pending Joins",joinedCount:"Joined",initResourceDiscovery:"Initialize",searchResources:"Search Resources",searchResourcesPlaceholder:"Enter keywords to search groups/channels...",processJoinQueue:"Process Queue",batchJoin:"Batch Join",addToQueue:"Add to Queue",resourceType:"Type",resourceStatus:"Status",memberCount:"Members",overallScore:"Score",discoveredAt:"Discovered",noResourcesFound:"No resources found. Start searching!",chineseSearch:"Chinese Search",tgstatAnalysis:"TGStat Analysis",resourceGroup:"Group",resourceSupergroup:"Supergroup",resourceChannel:"Channel",statusDiscovered:"Discovered",statusQueued:"Queued",statusJoined:"Joined",statusBlocked:"Blocked",selectAll:"Select All",selectedCount:"selected",voiceClone:"Voice Clone",voiceCloneHint:"Upload audio samples to clone voices for TTS. Supports WAV, MP3, OGG, FLAC formats (max 50MB)",uploadVoiceSample:"Upload Voice Sample",clonedVoices:"Cloned Voices",noClonedVoices:"No cloned voices yet. Upload an audio sample to get started.",voiceUploadSuccess:"Voice sample uploaded successfully!",voiceUploadFailed:"Failed to upload voice sample",voiceDeleted:"Voice sample deleted",invalidAudioFormat:"Invalid audio format. Please use WAV, MP3, OGG, or FLAC.",audioFileTooLarge:"Audio file too large. Maximum size is 50MB.",selectVoiceFirst:"Please select a cloned voice first",ttsEndpointRequired:"Please configure TTS endpoint first",previewVoice:"Preview",useThisVoice:"Use",deleteVoice:"Delete",remoteEndpointHint:"Enter the remote server URL where the service is deployed",recordVoice:"Record Voice",startRecording:"Start Recording",stopRecording:"Stop Recording",recording:"Recording...",recordingHint:"Please record 3-10 seconds of clear speech",voiceNameLabel:"Voice Name",voiceNamePlaceholder:"e.g., My Voice, Customer Service",promptTextLabel:"Reference Text (what you said)",promptTextPlaceholder:"Enter the text you spoke during recording...",confirmUpload:"Confirm & Upload",reRecord:"Re-record",recordingTooShort:"Recording too short. Please record at least 3 seconds.",recordingTooLong:"Recording too long. Maximum 10 seconds.",voiceNameRequired:"Please enter a voice name",noRecordingToUpload:"No recording to upload. Please record first.",microphoneAccessDenied:"Microphone access denied. Please allow microphone access.",orUploadFile:"Or upload audio file",seconds:"seconds",generateWithAi:"\u2728 Generate with AI",generating:"Generating...",generatedMessage:"Generated Message",error:"Error:",cancel:"Cancel",sendMessage:"Send Message",language:"Language",appearance:"Appearance",light:"Light",dark:"Dark",health:"Health",group:"Group",allAccounts:"All Accounts",importSession:"Import Session",exportSession:"Export Session",twoFactorPassword:"2FA Password (optional)",accountGroup:"Account Group",accountHealthTooltip:"Health Score based on activity, profile, and proxy quality.",viewLogs:"View Logs",fileBasedManagement:"File-Based Management",downloadTemplate:"Download Template",uploadExcel:"Upload Excel",reloadSessions:"Reload Sessions",noAccountsFound:"No accounts found. Add accounts manually or upload an Excel file.",New:"New",Contacted:"Contacted",Replied:"Replied","Follow-up":"Follow-up","Closed-Won":"Closed-Won","Closed-Lost":"Closed-Lost",moveTo:"Move to",analyticsTitle:"Performance Analytics",replyRate:"Reply Rate",replyRateDesc:'Percentage of contacted leads that have been moved to the "Replied" stage.',templatePerformance:"Template Performance",leadsOverTime:"Leads Over Time",last7Days:"Last 7 Days",conversionFunnel:"Conversion Funnel",contactHistory:"Contact History",noHistoryFound:"No history found for this lead.",kanbanView:"Kanban",listView:"List",exportToExcel:"Export to Excel",onlineStatus:"Online Status",userId:"User ID",leadName:"Lead Name",capturedAt:"Captured At",Online:"Online",Offline:"Offline",Recently:"Recently",Unknown:"Unknown",role:"Role",Listener:"Listener",Sender:"Sender",Unassigned:"Unassigned","Logging in...":"Logging in...",Banned:"Banned","Warming Up":"Warming Up",listenerConfiguration:"Listener Configuration",senderConfiguration:"Sender & Automation Configuration",activeListenerAccounts:"Active Listener Accounts",activeSenderAccounts:"Active Sender Accounts",outreachAutomation:"Outreach & Follow-up Automation",enableAutoReply:"Enable Automated Reply",autoReplyHint:"When a lead is moved to 'Replied', automatically send a message to acknowledge.",autoReplyMessage:"Auto-Reply Message",autoReplyEditHint:"Edit the message and click save to update",saveAutoReply:"Save",settingsSaved:"Settings saved successfully!",saveSettings:"Save Settings",settingsAutoSaveHint:"Settings are auto-saved when changed. You can also click to save manually.",sendingDelays:"Randomized Sending Delays",delayRangeHint:"Wait for a random period before sending the first message.",min:"Min (s)",max:"Max (s)",noActiveListeners:"No active Listener accounts. Assign the Listener role to online accounts.",noActiveSenders:"No active Sender accounts. Assign the Sender role to online accounts.",sendingStrategy:"Sending Strategy",sendImmediately:"Send Immediately",sendWithinTimeWindow:"Send within Time Window",timeWindowHint:"Only send messages between these local times.",from:"From",to:"To",smartSending:"Smart Sending",enableSmartSending:"Enable Smart Sending",smartSendingHint:"Only send messages when the lead is online. Queues message if offline.",attachImage:"Attach Image",attachFile:"Attach File",checkStatus:"Check Status","Proxy Error":"Proxy Error",selected:"selected",bulkActions:"Bulk Actions",assignRole:"Assign Role",assignGroup:"Assign Group",enterGroupName:"Enter new group name:",deleteSelected:"Delete Selected",keywordSets:"Keyword Sets",newKeywordSet:"New Keyword Set Name",assignKeywordSets:"Assign Keyword Sets",addToDNC:"Add to Do Not Contact List",userOnDNC:"User is on DNC List",automationCampaigns:"Automation Campaigns",campaigns:"Campaigns",createCampaign:"Create New Campaign",campaignName:"Campaign Name",triggers:"Triggers",campaignTriggerHint:"A lead will be captured if it matches ALL selected criteria.",sourceGroups:"Source Groups",messageTemplate:"Message Template",selectTemplate:"Select a template...",noCampaignsFound:"No campaigns created yet.",campaign:"Campaign",groups:"Groups","Resting (Cooldown)":"Resting (Cooldown)",allCampaigns:"All Campaigns",selectCampaign:"Select Campaign",campaignPerformance:"Campaign Performance",replied:"Replied",campaignDetails:"Campaign Details",automationHub:"Automation Hub",monitoringTargets:"Step 1: Monitoring Targets",automationRules:"Step 2: Automation Rules",globalSendingConfig:"Global Sending Configuration",accountStatus:"Account Status",addKeywordPlaceholder:"Enter keyword or phrase (e.g., bitcoin, payment)",regexTooltip:'Regular Expression: Use pattern matching instead of exact text. Example: bitcoin|BTC matches "bitcoin" or "BTC"',regexExamples:"Regex Examples",regexExample1:"bitcoin|BTC - matches bitcoin or BTC",regexExample2:"pay.*ment - matches payment, payments, etc.",regexExample3:"\\d+.*USD - matches numbers followed by USD",addKeywordButton:"Add",keywordAdded:"Keyword added",keywordAddFailed:"Failed to add keyword",invalidRegex:"Invalid regex syntax",selectKeywordSetFirst:"Please select a keyword set first",keywordEmpty:"Keyword cannot be empty",testKeyword:"Test",testKeywordPlaceholder:"Enter test text...",keywordMatches:"Matches",keywordNoMatch:"No match"},zh:{title:"TG-AI\u667A\u63A7\u738B",subtitle:"AI Telegram \u8425\u9500",dashboard:"\u4EEA\u8868\u76D8",accounts:"\u8D26\u6237\u7BA1\u7406",automation:"\u81EA\u52A8\u5316\u4E2D\u5FC3",leads:"\u6F5C\u5728\u5BA2\u6237",analytics:"\u5206\u6790",logs:"\u65E5\u5FD7",performance:"\u6027\u80FD\u76D1\u63A7",alerts:"\u544A\u8B66",resourceManagement:"\u8D44\u6E90\u7BA1\u7406",marketingAutomation:"\u8425\u9500\u81EA\u52A8\u5316",aiIntelligence:"AI \u667A\u80FD",systemMonitor:"\u7CFB\u7EDF\u76D1\u63A7",resourceDiscoveryMenu:"\u8D44\u6E90\u53D1\u73B0",aiCenter:"AI \u4E2D\u5FC3",monitoringCenter:"\u76D1\u63A7\u4E2D\u5FC3",aiAutoChat:"AI \u81EA\u52A8\u804A\u5929",ragKnowledge:"RAG \u77E5\u8BC6\u5E93",voiceService:"\u8BED\u97F3\u670D\u52A1",enableAiAutoChat:"\u542F\u7528 AI \u81EA\u52A8\u804A\u5929",aiAutoChatHint:"\u4F7F\u7528 AI \u81EA\u52A8\u56DE\u590D\u79C1\u4FE1",chatMode:"\u804A\u5929\u6A21\u5F0F",systemPrompt:"\u7CFB\u7EDF\u63D0\u793A\u8BCD",ttsService:"\u6587\u5B57\u8F6C\u8BED\u97F3 (TTS)",sttService:"\u8BED\u97F3\u8F6C\u6587\u5B57 (STT)",enableTts:"\u542F\u7528 TTS",enableStt:"\u542F\u7528 STT",ttsEndpointLabel:"TTS \u7AEF\u70B9",sttEndpointLabel:"STT \u7AEF\u70B9",settings:"\u8BBE\u7F6E",totalAccounts:"\u603B\u8D26\u6237\u6570",onlineAccounts:"\u5728\u7EBF\u8D26\u6237",leadsToday:"\u4ECA\u65E5\u83B7\u5BA2",messagesSentToday:"\u4ECA\u65E5\u5DF2\u53D1",leadsCaptured:"\u6355\u83B7\u5BA2\u6237",keywords:"\u5173\u952E\u8BCD",monitoredGroups:"\u76D1\u63A7\u7FA4\u7EC4",systemControl:"\u7CFB\u7EDF\u63A7\u5236",monitoringStatus:"\u76D1\u63A7\u72B6\u6001:",active:"\u8FD0\u884C\u4E2D",inactive:"\u5DF2\u505C\u6B62",start:"\u542F\u52A8",stop:"\u505C\u6B62",recentLogs:"\u6700\u8FD1\u65E5\u5FD7",recentLeads:"\u6700\u8FD1\u5BA2\u6237",noRecentActivity:"\u6682\u65E0\u6700\u8FD1\u6D3B\u52A8\u3002",manageAccounts:"\u7BA1\u7406\u8D26\u6237",addNewAccount:"\u624B\u52A8\u6DFB\u52A0\u65B0\u8D26\u6237",phoneNumber:"\u7535\u8BDD\u53F7\u7801",apiId:"API ID",apiHash:"API Hash",proxy:"SOCKS5 \u4EE3\u7406 (\u53EF\u9009)",addAccount:"\u6DFB\u52A0\u8D26\u6237",phone:"\u7535\u8BDD",status:"\u72B6\u6001",actions:"\u64CD\u4F5C",login:"\u767B\u5F55",remove:"\u79FB\u9664",enableWarmup:"\u542F\u7528\u9884\u70ED\u6A21\u5F0F",dailySends:"\u4ECA\u65E5\u5DF2\u53D1",monitoringConfig:"\u76D1\u63A7\u914D\u7F6E",keywordsTitle:"\u5173\u952E\u8BCD",addGroupTitle:"\u8981\u76D1\u63A7\u7684\u7FA4\u7EC4",groupUrl:"\u7FA4\u7EC4 URL \u6216 @username",add:"\u6DFB\u52A0",regex:"\u6B63\u5219",leadPipeline:"\u6F5C\u5728\u5BA2\u6237\u6F0F\u6597",newLeadCaptured:"\u6355\u83B7\u65B0\u6F5C\u5728\u5BA2\u6237",username:"\u7528\u6237\u540D",sourceGroup:"\u6765\u6E90\u7FA4\u7EC4",keyword:"\u5173\u952E\u8BCD",message:"\u6D88\u606F",contacted:"\u5DF2\u8054\u7CFB",actionLogs:"\u64CD\u4F5C\u65E5\u5FD7",clearLogs:"\u6E05\u7A7A\u65E5\u5FD7",settingsTitle:"\u8BBE\u7F6E",messagingConfig:"\u6D88\u606F\u914D\u7F6E",enableSpintax:"\u542F\u7528 Spintax \u5904\u7406",spintaxHint:"\u5904\u7406\u6D88\u606F\u63D0\u793A\u4E2D\u7684 Spintax (\u4F8B\u5982 {Hi|Hello}) \u4EE5\u5B9E\u73B0\u6D88\u606F\u591A\u6837\u5316\u3002",abTesting:"A/B \u6D4B\u8BD5\u6A21\u677F",addNewTemplate:"\u6DFB\u52A0\u65B0\u6A21\u677F",templateName:"\u6A21\u677F\u540D\u79F0",prompt:"\u63D0\u793A\u8BED",saveTemplate:"\u4FDD\u5B58\u6A21\u677F",deactivate:"\u505C\u7528",activate:"\u6FC0\u6D3B",abTestingHint:"\u521B\u5EFA\u591A\u4E2A\u6D3B\u52A8\u6A21\u677F\u3002\u7CFB\u7EDF\u5C06\u81EA\u52A8\u628A\u5B83\u4EEC\u5206\u914D\u7ED9\u65B0\u7684\u6F5C\u5728\u5BA2\u6237\u8FDB\u884C\u6D4B\u8BD5\u3002",leadDetails:"\u6F5C\u5728\u5BA2\u6237\u8BE6\u60C5",sendMessageTab:"\u53D1\u9001\u6D88\u606F",historyTab:"\u5386\u53F2\u8BB0\u5F55",assignedTemplate:"\u5206\u914D\u7684\u6A21\u677F",customizePrompt:"\u4E3A\u6B64\u6F5C\u5728\u5BA2\u6237\u81EA\u5B9A\u4E49\u63D0\u793A",selectSenderAccount:"\u9009\u62E9\u53D1\u9001\u8D26\u53F7",noSenderAccounts:"\u6CA1\u6709\u53EF\u7528\u7684\u53D1\u9001\u8D26\u53F7",noSenderAccountsHint:"\u8BF7\u5728\u8D26\u6237\u7BA1\u7406\u4E2D\u914D\u7F6E\u53D1\u9001\u8D26\u53F7",manualInput:"\u624B\u52A8\u8F93\u5165",aiGenerate:"AI \u751F\u6210",useTemplate:"\u4F7F\u7528\u6A21\u677F",aiPromptPlaceholder:"\u8F93\u5165 AI \u751F\u6210\u6D88\u606F\u7684\u6307\u4EE4...",aiNotConfigured:"AI \u5C1A\u672A\u914D\u7F6E\u3002",goToSettings:"\u524D\u5F80\u8BBE\u7F6E",selectTemplatePlaceholder:"\u9009\u62E9\u4E00\u4E2A\u6A21\u677F...",messageContent:"\u6D88\u606F\u5185\u5BB9",characters:"\u5B57\u7B26",messageContentPlaceholder:"\u5728\u6B64\u8F93\u5165\u60A8\u7684\u6D88\u606F...",messageRequired:"\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9",selectSenderFirst:"\u8BF7\u5148\u9009\u62E9\u53D1\u9001\u8D26\u53F7",senderAccountNotFound:"\u53D1\u9001\u8D26\u53F7\u4E0D\u5B58\u5728",messageSent:"\u6D88\u606F\u53D1\u9001\u6210\u529F\uFF01",messageQueued:"\u6D88\u606F\u5DF2\u52A0\u5165\u53D1\u9001\u961F\u5217",aiConfiguration:"AI \u914D\u7F6E",aiConfigurationHint:"\u914D\u7F6E AI API \u4EE5\u542F\u7528\u81EA\u52A8\u6D88\u606F\u751F\u6210\u529F\u80FD",aiProvider:"AI \u670D\u52A1\u5546",customApi:"\u81EA\u5B9A\u4E49 API",customApiKey:"API \u5BC6\u94A5",geminiKeyHint:"\u4ECE\u4EE5\u4E0B\u5730\u5740\u83B7\u53D6\u60A8\u7684 API \u5BC6\u94A5\uFF1A",openaiKeyHint:"\u4ECE\u4EE5\u4E0B\u5730\u5740\u83B7\u53D6\u60A8\u7684 API \u5BC6\u94A5\uFF1A",customApiHint:"\u8F93\u5165\u60A8\u7684\u81EA\u5B9A\u4E49 API \u5BC6\u94A5",customApiEndpoint:"API \u63A5\u53E3\u5730\u5740",testConnection:"\u6D4B\u8BD5\u8FDE\u63A5",testing:"\u6D4B\u8BD5\u4E2D...",saveApiKey:"\u4FDD\u5B58 API \u5BC6\u94A5",aiConnectionSuccess:"AI \u8FDE\u63A5\u6210\u529F\uFF01",aiConnectionFailed:"AI \u8FDE\u63A5\u5931\u8D25",invalidApiKeyFormat:"API \u5BC6\u94A5\u683C\u5F0F\u65E0\u6548",aiSettingsSaved:"AI \u8BBE\u7F6E\u5DF2\u4FDD\u5B58\uFF01",localAi:"\u672C\u5730 AI",localAiConfiguration:"\u672C\u5730 AI \u670D\u52A1",localAiHint:"\u914D\u7F6E\u672C\u5730 AI \u670D\u52A1\uFF08\u5982 Ollama\u3001LocalAI\u3001LM Studio\uFF09",localAiEndpoint:"\u672C\u5730 AI \u7AEF\u70B9",localAiEndpointPlaceholder:"http://localhost:3002",localAiModel:"\u6A21\u578B\u540D\u79F0\uFF08\u53EF\u9009\uFF09",localAiModelPlaceholder:"\u4F8B\u5982\uFF1Allama2\u3001mistral",voiceServices:"\u8BED\u97F3\u670D\u52A1",voiceServicesHint:"\u914D\u7F6E\u672C\u5730\u8BED\u97F3\u5408\u6210\u548C\u8BED\u97F3\u8BC6\u522B\u670D\u52A1",ttsServiceLabel:"\u8BED\u97F3\u5408\u6210 (TTS)",ttsEndpoint:"TTS \u7AEF\u70B9",ttsEndpointPlaceholder:"http://localhost:9881",ttsVoice:"\u8BED\u97F3 ID\uFF08\u53EF\u9009\uFF09",ttsVoicePlaceholder:"\u4F8B\u5982\uFF1Adefault\u3001speaker_01",ttsEnabled:"\u542F\u7528 TTS",sttServiceLabel:"\u8BED\u97F3\u8BC6\u522B (STT)",sttEndpoint:"STT \u7AEF\u70B9",sttEndpointPlaceholder:"http://localhost:9000",sttEnabled:"\u542F\u7528 STT",testLocalAi:"\u6D4B\u8BD5\u672C\u5730 AI",testTts:"\u6D4B\u8BD5 TTS",testStt:"\u6D4B\u8BD5 STT",localAiSuccess:"\u672C\u5730 AI \u8FDE\u63A5\u6210\u529F\uFF01",localAiFailed:"\u672C\u5730 AI \u8FDE\u63A5\u5931\u8D25",ttsSuccess:"TTS \u670D\u52A1\u8FDE\u63A5\u6210\u529F\uFF01",ttsFailed:"TTS \u670D\u52A1\u8FDE\u63A5\u5931\u8D25",sttSuccess:"STT \u670D\u52A1\u8FDE\u63A5\u6210\u529F\uFF01",sttFailed:"STT \u670D\u52A1\u8FDE\u63A5\u5931\u8D25",invalidEndpointFormat:"\u7AEF\u70B9\u683C\u5F0F\u65E0\u6548\uFF08\u5FC5\u987B\u4EE5 http:// \u6216 https:// \u5F00\u5934\uFF09",saveLocalSettings:"\u4FDD\u5B58\u8BBE\u7F6E",aiAutoChatTitle:"AI \u81EA\u52A8\u804A\u5929",aiAutoChatDescription:"\u914D\u7F6E AI \u9A71\u52A8\u7684\u81EA\u52A8\u56DE\u590D\uFF0C\u652F\u6301\u65E0\u9650\u4E0A\u4E0B\u6587\u8BB0\u5FC6",enableAutoChat:"\u542F\u7528 AI \u81EA\u52A8\u804A\u5929",autoChatMode:"\u81EA\u52A8\u804A\u5929\u6A21\u5F0F",modeFullAuto:"\u5168\u81EA\u52A8",modeFullAutoDesc:"AI \u5B8C\u5168\u63A5\u7BA1\uFF0C\u81EA\u52A8\u56DE\u590D\u6240\u6709\u6D88\u606F",modeSemiAuto:"\u534A\u81EA\u52A8",modeSemiAutoDesc:"AI \u751F\u6210\u8349\u7A3F\uFF0C\u4EBA\u5DE5\u786E\u8BA4\u540E\u53D1\u9001",modeAssist:"\u8F85\u52A9",modeAssistDesc:"\u4EBA\u5DE5\u8F93\u5165\uFF0CAI \u63D0\u4F9B\u5EFA\u8BAE\u548C\u6DA6\u8272",modeKeyword:"\u5173\u952E\u8BCD\u89E6\u53D1",modeKeywordDesc:"\u4EC5\u5728\u5339\u914D\u5173\u952E\u8BCD\u65F6\u542F\u52A8 AI",typingSpeed:"\u6253\u5B57\u901F\u5EA6",typingSpeedHint:"\u6BCF\u5206\u949F\u5B57\u7B26\u6570\uFF08\u6A21\u62DF\u4EBA\u7C7B\u6253\u5B57\uFF09",replyDelay:"\u56DE\u590D\u5EF6\u8FDF",replyDelayHint:"\u56DE\u590D\u524D\u7684\u968F\u673A\u5EF6\u8FDF\u8303\u56F4\uFF08\u79D2\uFF09",systemPromptLabel:"\u7CFB\u7EDF\u63D0\u793A\u8BCD",systemPromptHint:"AI \u884C\u4E3A\u548C\u4E2A\u6027\u7684\u6307\u4EE4",systemPromptPlaceholder:"\u4F60\u662F\u4E00\u4E2A\u53CB\u597D\u7684\u5BA2\u670D\u52A9\u624B...",maxContextMessages:"\u6700\u5927\u4E0A\u4E0B\u6587\u6D88\u606F\u6570",maxContextHint:"\u5305\u542B\u5728 AI \u4E0A\u4E0B\u6587\u4E2D\u7684\u6700\u8FD1\u6D88\u606F\u6570\u91CF",enableMemory:"\u542F\u7528 AI \u8BB0\u5FC6",enableMemoryHint:"AI \u8DE8\u4F1A\u8BDD\u8BB0\u4F4F\u7528\u6237\u7684\u91CD\u8981\u4FE1\u606F",autoGreeting:"\u81EA\u52A8\u95EE\u5019",autoGreetingHint:"\u81EA\u52A8\u95EE\u5019\u65B0\u7528\u6237",greetingMessage:"\u95EE\u5019\u8BED",greetingPlaceholder:"\u4F60\u597D {name}\uFF01\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u5230\u4F60\u7684\u5417\uFF1F",unlimitedContext:"\u65E0\u9650\u4E0A\u4E0B\u6587",chatHistory:"\u804A\u5929\u5386\u53F2",userProfile:"\u7528\u6237\u753B\u50CF",aiMemories:"AI \u8BB0\u5FC6",conversationStage:"\u5BF9\u8BDD\u9636\u6BB5",knowledgeBase:"\u77E5\u8BC6\u5E93",knowledgeBaseHint:"\u7BA1\u7406\u6587\u6863\u3001\u56FE\u7247\u3001\u89C6\u9891\u548C\u95EE\u7B54\u5BF9\uFF0C\u589E\u5F3A AI \u56DE\u590D\u80FD\u529B",documents:"\u6587\u6863",images:"\u56FE\u7247",videos:"\u89C6\u9891",qaPairs:"\u95EE\u7B54\u5BF9",addDocument:"\u6DFB\u52A0\u6587\u6863",addImage:"\u6DFB\u52A0\u56FE\u7247",addVideo:"\u6DFB\u52A0\u89C6\u9891",addQaPair:"\u6DFB\u52A0\u95EE\u7B54",importQa:"\u5BFC\u5165\u95EE\u7B54",searchKnowledge:"\u641C\u7D22\u77E5\u8BC6\u5E93",documentTitle:"\u6587\u6863\u6807\u9898",documentCategory:"\u5206\u7C7B",documentTags:"\u6807\u7B7E",uploadFile:"\u4E0A\u4F20\u6587\u4EF6",orPasteContent:"\u6216\u76F4\u63A5\u7C98\u8D34\u5185\u5BB9",contentPlaceholder:"\u5728\u6B64\u7C98\u8D34\u6587\u6863\u5185\u5BB9...",question:"\u95EE\u9898",answer:"\u56DE\u7B54",noDocuments:"\u8FD8\u6CA1\u6709\u6587\u6863\u3002\u6DFB\u52A0\u6587\u6863\u6765\u589E\u5F3A AI \u56DE\u590D\u3002",noImages:"\u8FD8\u6CA1\u6709\u56FE\u7247\u3002\u6DFB\u52A0\u56FE\u7247\u7528\u4E8E\u5BCC\u5A92\u4F53\u56DE\u590D\u3002",noVideos:"\u8FD8\u6CA1\u6709\u89C6\u9891\u3002\u6DFB\u52A0\u89C6\u9891\u7528\u4E8E\u6559\u7A0B\u56DE\u590D\u3002",noQaPairs:"\u8FD8\u6CA1\u6709\u95EE\u7B54\u5BF9\u3002\u6DFB\u52A0\u5E38\u89C1\u95EE\u9898\u548C\u56DE\u7B54\u3002",categoryProducts:"\u4EA7\u54C1",categoryTutorials:"\u6559\u7A0B",categoryGeneral:"\u901A\u7528",categoryFaq:"\u5E38\u89C1\u95EE\u9898",dragDropHint:"\u62D6\u653E\u6587\u4EF6\u5230\u8FD9\u91CC\u6216\u70B9\u51FB\u6D4F\u89C8",supportedFormats:"\u652F\u6301\u7684\u683C\u5F0F",fileSize:"\u6587\u4EF6\u5927\u5C0F",chunks:"\u5206\u6BB5",preview:"\u9884\u89C8",edit:"\u7F16\u8F91",ragEnabled:"\u542F\u7528 RAG",ragHint:"AI \u5C06\u4ECE\u77E5\u8BC6\u5E93\u641C\u7D22\u76F8\u5173\u4FE1\u606F",telegramRagTitle:"Telegram \u81EA\u52A8\u5B66\u4E60 RAG",telegramRagHint:"\u81EA\u52A8\u4ECE\u804A\u5929\u8BB0\u5F55\u4E2D\u5B66\u4E60\uFF0C\u589E\u5F3A AI \u56DE\u590D\u80FD\u529B",totalKnowledge:"\u603B\u77E5\u8BC6\u91CF",qaLearned:"\u5B66\u4E60\u7684\u95EE\u7B54",scriptsLearned:"\u5B66\u4E60\u7684\u8BDD\u672F",totalUses:"\u603B\u4F7F\u7528\u6B21\u6570",ragSystemOnline:"RAG \u7CFB\u7EDF\u5728\u7EBF",ragSystemOffline:"RAG \u7CFB\u7EDF\u79BB\u7EBF",vectorDb:"\u5411\u91CF\u5E93",embedding:"\u5D4C\u5165\u6A21\u578B",initRagSystem:"\u521D\u59CB\u5316 RAG",learnFromChats:"\u4ECE\u804A\u5929\u5B66\u4E60",reindexHighValue:"\u91CD\u5EFA\u9AD8\u4EF7\u503C\u7D22\u5F15",cleanupRag:"\u6E05\u7406\u77E5\u8BC6\u5E93",refreshStats:"\u5237\u65B0\u7EDF\u8BA1",searchRagPlaceholder:"\u641C\u7D22\u77E5\u8BC6\u5E93...",searchResults:"\u641C\u7D22\u7ED3\u679C",score:"\u8BC4\u5206",knowledgeByType:"\u6309\u7C7B\u578B\u5206\u7C7B",items:"\u6761",addManualKnowledge:"\u624B\u52A8\u6DFB\u52A0\u77E5\u8BC6",addRagKnowledge:"\u6DFB\u52A0 RAG \u77E5\u8BC6",knowledgeType:"\u77E5\u8BC6\u7C7B\u578B",ragQuestion:"\u95EE\u9898",ragAnswer:"\u56DE\u7B54",context:"\u4E0A\u4E0B\u6587",questionPlaceholder:"\u8F93\u5165\u95EE\u9898\u6216\u89E6\u53D1\u8BCD...",answerPlaceholder:"\u8F93\u5165\u7B54\u6848\u6216\u56DE\u590D...",contextPlaceholder:"\u53EF\u9009\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F...",addKnowledge:"\u6DFB\u52A0",resourceDiscoveryTitle:"\u8D44\u6E90\u53D1\u73B0",resourceDiscoveryHint:"\u81EA\u52A8\u53D1\u73B0\u5E76\u52A0\u5165 Telegram \u7FA4\u7EC4/\u9891\u9053",totalResources:"\u603B\u8D44\u6E90\u6570",todayDiscovered:"\u4ECA\u65E5\u53D1\u73B0",pendingJoins:"\u5F85\u52A0\u5165",joinedCount:"\u5DF2\u52A0\u5165",initResourceDiscovery:"\u521D\u59CB\u5316",searchResources:"\u641C\u7D22\u8D44\u6E90",searchResourcesPlaceholder:"\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22\u7FA4\u7EC4/\u9891\u9053...",processJoinQueue:"\u5904\u7406\u961F\u5217",batchJoin:"\u6279\u91CF\u52A0\u5165",addToQueue:"\u52A0\u5165\u961F\u5217",resourceType:"\u7C7B\u578B",resourceStatus:"\u72B6\u6001",memberCount:"\u6210\u5458\u6570",overallScore:"\u8BC4\u5206",discoveredAt:"\u53D1\u73B0\u65F6\u95F4",noResourcesFound:"\u6682\u65E0\u8D44\u6E90\u3002\u5F00\u59CB\u641C\u7D22\u5427\uFF01",chineseSearch:"\u4E2D\u6587\u641C\u7D22",tgstatAnalysis:"TGStat\u6570\u636E\u5206\u6790",resourceGroup:"\u7FA4\u7EC4",resourceSupergroup:"\u8D85\u7EA7\u7FA4\u7EC4",resourceChannel:"\u9891\u9053",statusDiscovered:"\u5DF2\u53D1\u73B0",statusQueued:"\u961F\u5217\u4E2D",statusJoined:"\u5DF2\u52A0\u5165",statusBlocked:"\u88AB\u5C01\u7981",selectAll:"\u5168\u9009",selectedCount:"\u5DF2\u9009",voiceClone:"\u58F0\u97F3\u514B\u9686",voiceCloneHint:"\u4E0A\u4F20\u97F3\u9891\u6837\u672C\u6765\u514B\u9686\u58F0\u97F3\u7528\u4E8E TTS\u3002\u652F\u6301 WAV\u3001MP3\u3001OGG\u3001FLAC \u683C\u5F0F\uFF08\u6700\u5927 50MB\uFF09",uploadVoiceSample:"\u4E0A\u4F20\u58F0\u97F3\u6837\u672C",clonedVoices:"\u5DF2\u514B\u9686\u7684\u58F0\u97F3",noClonedVoices:"\u8FD8\u6CA1\u6709\u514B\u9686\u7684\u58F0\u97F3\u3002\u4E0A\u4F20\u97F3\u9891\u6837\u672C\u5F00\u59CB\u4F7F\u7528\u3002",voiceUploadSuccess:"\u58F0\u97F3\u6837\u672C\u4E0A\u4F20\u6210\u529F\uFF01",voiceUploadFailed:"\u58F0\u97F3\u6837\u672C\u4E0A\u4F20\u5931\u8D25",voiceDeleted:"\u58F0\u97F3\u6837\u672C\u5DF2\u5220\u9664",invalidAudioFormat:"\u97F3\u9891\u683C\u5F0F\u65E0\u6548\u3002\u8BF7\u4F7F\u7528 WAV\u3001MP3\u3001OGG \u6216 FLAC\u3002",audioFileTooLarge:"\u97F3\u9891\u6587\u4EF6\u8FC7\u5927\u3002\u6700\u5927\u5927\u5C0F\u4E3A 50MB\u3002",selectVoiceFirst:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u514B\u9686\u7684\u58F0\u97F3",ttsEndpointRequired:"\u8BF7\u5148\u914D\u7F6E TTS \u7AEF\u70B9",previewVoice:"\u9884\u89C8",useThisVoice:"\u4F7F\u7528",deleteVoice:"\u5220\u9664",remoteEndpointHint:"\u8F93\u5165\u670D\u52A1\u90E8\u7F72\u7684\u8FDC\u7A0B\u670D\u52A1\u5668 URL",recordVoice:"\u5F55\u5236\u58F0\u97F3",startRecording:"\u5F00\u59CB\u5F55\u97F3",stopRecording:"\u505C\u6B62\u5F55\u97F3",recording:"\u5F55\u97F3\u4E2D...",recordingHint:"\u8BF7\u5F55\u5236 3-10 \u79D2\u6E05\u6670\u7684\u8BED\u97F3",voiceNameLabel:"\u58F0\u97F3\u540D\u79F0",voiceNamePlaceholder:"\u4F8B\u5982\uFF1A\u6211\u7684\u58F0\u97F3\u3001\u5BA2\u670D\u58F0\u97F3",promptTextLabel:"\u53C2\u8003\u6587\u672C\uFF08\u60A8\u8BF4\u7684\u5185\u5BB9\uFF09",promptTextPlaceholder:"\u8F93\u5165\u60A8\u5F55\u97F3\u65F6\u8BF4\u7684\u6587\u5B57...",confirmUpload:"\u786E\u8BA4\u5E76\u4E0A\u4F20",reRecord:"\u91CD\u65B0\u5F55\u97F3",recordingTooShort:"\u5F55\u97F3\u65F6\u95F4\u592A\u77ED\uFF0C\u8BF7\u81F3\u5C11\u5F55\u5236 3 \u79D2",recordingTooLong:"\u5F55\u97F3\u65F6\u95F4\u592A\u957F\uFF0C\u6700\u957F 10 \u79D2",voiceNameRequired:"\u8BF7\u8F93\u5165\u58F0\u97F3\u540D\u79F0",noRecordingToUpload:"\u6CA1\u6709\u53EF\u4E0A\u4F20\u7684\u5F55\u97F3\uFF0C\u8BF7\u5148\u5F55\u97F3",microphoneAccessDenied:"\u9EA6\u514B\u98CE\u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF0C\u8BF7\u5141\u8BB8\u9EA6\u514B\u98CE\u6743\u9650",orUploadFile:"\u6216\u4E0A\u4F20\u97F3\u9891\u6587\u4EF6",seconds:"\u79D2",generateWithAi:"\u2728 AI \u751F\u6210",generating:"\u751F\u6210\u4E2D...",generatedMessage:"\u751F\u6210\u7684\u6D88\u606F",error:"\u9519\u8BEF:",cancel:"\u53D6\u6D88",sendMessage:"\u53D1\u9001\u6D88\u606F",language:"\u8BED\u8A00",appearance:"\u5916\u89C2",light:"\u6D45\u8272",dark:"\u6DF1\u8272",health:"\u5065\u5EB7\u5EA6",group:"\u5206\u7EC4",allAccounts:"\u6240\u6709\u8D26\u6237",importSession:"\u5BFC\u5165\u4F1A\u8BDD",exportSession:"\u5BFC\u51FA\u56DE\u8BDD",twoFactorPassword:"2FA \u5BC6\u7801 (\u53EF\u9009)",accountGroup:"\u8D26\u6237\u5206\u7EC4",accountHealthTooltip:"\u5065\u5EB7\u5206\u57FA\u4E8E\u8D26\u53F7\u6D3B\u8DC3\u5EA6\u3001\u4E2A\u4EBA\u8D44\u6599\u5B8C\u6574\u5EA6\u548C\u4EE3\u7406\u8D28\u91CF\u3002",viewLogs:"\u67E5\u770B\u65E5\u5FD7",fileBasedManagement:"\u6587\u4EF6\u7BA1\u7406",downloadTemplate:"\u4E0B\u8F7D\u6A21\u677F",uploadExcel:"\u4E0A\u4F20 Excel",reloadSessions:"\u91CD\u65B0\u52A0\u8F7D\u4F1A\u8BDD",noAccountsFound:"\u672A\u627E\u5230\u4EFB\u4F55\u8D26\u6237\u3002\u8BF7\u624B\u52A8\u6DFB\u52A0\u6216\u4E0A\u4F20 Excel \u6587\u4EF6\u3002",New:"\u65B0\u5BA2\u6237",Contacted:"\u5DF2\u8054\u7CFB",Replied:"\u5DF2\u56DE\u590D","Follow-up":"\u9700\u8DDF\u8FDB","Closed-Won":"\u6210\u4EA4","Closed-Lost":"\u6D41\u5931",moveTo:"\u79FB\u52A8\u5230",analyticsTitle:"\u6027\u80FD\u5206\u6790",replyRate:"\u56DE\u590D\u7387",replyRateDesc:"\u5DF2\u8054\u7CFB\u7684\u6F5C\u5728\u5BA2\u6237\u4E2D\u88AB\u79FB\u81F3\u201C\u5DF2\u56DE\u590D\u201D\u9636\u6BB5\u7684\u767E\u5206\u6BD4\u3002",templatePerformance:"\u6A21\u677F\u6027\u80FD",leadsOverTime:"\u6F5C\u5728\u5BA2\u6237\u8D8B\u52BF",last7Days:"\u8FC7\u53BB7\u5929",conversionFunnel:"\u8F6C\u5316\u6F0F\u6597",contactHistory:"\u8054\u7CFB\u5386\u53F2",noHistoryFound:"\u672A\u627E\u5230\u6B64\u6F5C\u5728\u5BA2\u6237\u7684\u5386\u53F2\u8BB0\u5F55\u3002",kanbanView:"\u770B\u677F",listView:"\u5217\u8868",exportToExcel:"\u5BFC\u51FA\u5230 Excel",onlineStatus:"\u5728\u7EBF\u72B6\u6001",userId:"\u7528\u6237 ID",leadName:"\u6F5C\u5728\u5BA2\u6237",capturedAt:"\u6355\u83B7\u4E8E",Online:"\u5728\u7EBF",Offline:"\u79BB\u7EBF",Recently:"\u6700\u8FD1\u5728\u7EBF",Unknown:"\u672A\u77E5",role:"\u89D2\u8272",Listener:"\u76D1\u63A7\u53F7",Sender:"\u53D1\u9001\u53F7",Unassigned:"\u672A\u5206\u914D","Logging in...":"\u767B\u5F55\u4E2D...",Banned:"\u5DF2\u5C01\u7981","Warming Up":"\u9884\u70ED\u4E2D",listenerConfiguration:"\u76D1\u63A7\u914D\u7F6E",senderConfiguration:"\u53D1\u9001\u4E0E\u81EA\u52A8\u5316\u914D\u7F6E",activeListenerAccounts:"\u5F53\u524D\u76D1\u63A7\u53F7",activeSenderAccounts:"\u5F53\u524D\u53D1\u9001\u53F7",outreachAutomation:"\u81EA\u52A8\u5916\u8054\u4E0E\u8DDF\u8FDB",enableAutoReply:"\u542F\u7528\u81EA\u52A8\u56DE\u590D",autoReplyHint:"\u5F53\u6F5C\u5728\u5BA2\u6237\u72B6\u6001\u53D8\u4E3A\u201C\u5DF2\u56DE\u590D\u201D\u65F6\uFF0C\u81EA\u52A8\u53D1\u9001\u4E00\u6761\u6D88\u606F\u4EE5\u786E\u8BA4\u3002",autoReplyMessage:"\u81EA\u52A8\u56DE\u590D\u6D88\u606F",autoReplyEditHint:"\u7F16\u8F91\u6D88\u606F\u5185\u5BB9\uFF0C\u70B9\u51FB\u4FDD\u5B58\u4EE5\u66F4\u65B0",saveAutoReply:"\u4FDD\u5B58",settingsSaved:"\u8BBE\u7F6E\u5DF2\u4FDD\u5B58\uFF01",saveSettings:"\u4FDD\u5B58\u8BBE\u7F6E",settingsAutoSaveHint:"\u66F4\u6539\u8BBE\u7F6E\u65F6\u4F1A\u81EA\u52A8\u4FDD\u5B58\uFF0C\u4E5F\u53EF\u4EE5\u624B\u52A8\u70B9\u51FB\u4FDD\u5B58",sendingDelays:"\u968F\u673A\u53D1\u9001\u5EF6\u8FDF",delayRangeHint:"\u5728\u53D1\u9001\u7B2C\u4E00\u6761\u6D88\u606F\u524D\uFF0C\u968F\u673A\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\u3002",min:"\u6700\u5C0F (\u79D2)",max:"\u6700\u5927 (\u79D2)",noActiveListeners:"\u6CA1\u6709\u53EF\u7528\u7684\u76D1\u63A7\u53F7\u3002\u8BF7\u4E3A\u5728\u7EBF\u8D26\u6237\u5206\u914D\u201C\u76D1\u63A7\u53F7\u201D\u89D2\u8272\u3002",noActiveSenders:"\u6CA1\u6709\u53EF\u7528\u7684\u53D1\u9001\u53F7\u3002\u8BF7\u4E3A\u5728\u7EBF\u8D26\u6237\u5206\u914D\u201C\u53D1\u9001\u53F7\u201D\u89D2\u8272\u3002",sendingStrategy:"\u53D1\u9001\u7B56\u7565",sendImmediately:"\u7ACB\u5373\u53D1\u9001",sendWithinTimeWindow:"\u5728\u65F6\u95F4\u7A97\u53E3\u5185\u53D1\u9001",timeWindowHint:"\u4EC5\u5728\u8FD9\u4E9B\u672C\u5730\u65F6\u95F4\u4E4B\u95F4\u53D1\u9001\u6D88\u606F\u3002",from:"\u4ECE",to:"\u5230",smartSending:"\u667A\u80FD\u53D1\u9001",enableSmartSending:"\u542F\u7528\u667A\u80FD\u53D1\u9001",smartSendingHint:"\u4EC5\u5F53\u6F5C\u5728\u5BA2\u6237\u5728\u7EBF\u65F6\u53D1\u9001\u6D88\u606F\u3002\u5982\u679C\u79BB\u7EBF\u5219\u5C06\u6D88\u606F\u52A0\u5165\u961F\u5217\u3002",attachImage:"\u9644\u52A0\u56FE\u7247",attachFile:"\u9644\u52A0\u6587\u4EF6",checkStatus:"\u68C0\u67E5\u72B6\u6001","Proxy Error":"\u4EE3\u7406\u9519\u8BEF",selected:"\u5DF2\u9009\u62E9",bulkActions:"\u6279\u91CF\u64CD\u4F5C",assignRole:"\u5206\u914D\u89D2\u8272",assignGroup:"\u5206\u914D\u5206\u7EC4",enterGroupName:"\u8F93\u5165\u65B0\u5206\u7EC4\u540D\u79F0:",deleteSelected:"\u5220\u9664\u6240\u9009",keywordSets:"\u5173\u952E\u8BCD\u96C6",newKeywordSet:"\u65B0\u5173\u952E\u8BCD\u96C6\u540D\u79F0",assignKeywordSets:"\u5206\u914D\u5173\u952E\u8BCD\u96C6",addToDNC:"\u6DFB\u52A0\u5230\u201C\u8BF7\u52FF\u8054\u7CFB\u201D\u5217\u8868",userOnDNC:"\u7528\u6237\u5DF2\u5728\u201C\u8BF7\u52FF\u8054\u7CFB\u201D\u5217\u8868",automationCampaigns:"\u81EA\u52A8\u5316\u6D3B\u52A8",campaigns:"\u6D3B\u52A8\u5217\u8868",createCampaign:"\u521B\u5EFA\u65B0\u6D3B\u52A8",campaignName:"\u6D3B\u52A8\u540D\u79F0",triggers:"\u89E6\u53D1\u5668",campaignTriggerHint:"\u5F53\u6F5C\u5728\u5BA2\u6237\u6EE1\u8DB3\u6240\u6709\u9009\u5B9A\u6761\u4EF6\u65F6\uFF0C\u5C06\u89E6\u53D1\u6B64\u6D3B\u52A8\u3002",sourceGroups:"\u6765\u6E90\u7FA4\u7EC4",messageTemplate:"\u6D88\u606F\u6A21\u677F",selectTemplate:"\u9009\u62E9\u4E00\u4E2A\u6A21\u677F...",noCampaignsFound:"\u5C1A\u672A\u521B\u5EFA\u4EFB\u4F55\u6D3B\u52A8\u3002",campaign:"\u6D3B\u52A8",groups:"\u7FA4\u7EC4","Resting (Cooldown)":"\u4F11\u606F\u4E2D (\u51B7\u5374)",allCampaigns:"\u6240\u6709\u6D3B\u52A8",selectCampaign:"\u9009\u62E9\u6D3B\u52A8",campaignPerformance:"\u6D3B\u52A8\u6027\u80FD",replied:"\u5DF2\u56DE\u590D",campaignDetails:"\u6D3B\u52A8\u8BE6\u60C5",automationHub:"\u81EA\u52A8\u5316\u4E2D\u5FC3",monitoringTargets:"\u7B2C1\u6B65\uFF1A\u76D1\u63A7\u76EE\u6807",automationRules:"\u7B2C2\u6B65\uFF1A\u81EA\u52A8\u5316\u89C4\u5219",globalSendingConfig:"\u5168\u5C40\u53D1\u9001\u914D\u7F6E",accountStatus:"\u8D26\u6237\u72B6\u6001",addKeywordPlaceholder:"\u8F38\u5165\u95DC\u9375\u8A5E\u6216\u77ED\u8A9E\uFF08\u4F8B\u5982\uFF1Abitcoin, \u4ED8\u6B3E\uFF09",regexTooltip:'\u6B63\u5247\u8868\u9054\u5F0F\uFF1A\u4F7F\u7528\u6A21\u5F0F\u5339\u914D\u800C\u975E\u7CBE\u78BA\u6587\u5B57\u3002\u4F8B\u5982\uFF1Abitcoin|BTC \u53EF\u5339\u914D "bitcoin" \u6216 "BTC"',regexExamples:"\u6B63\u5247\u793A\u4F8B",regexExample1:"bitcoin|BTC - \u5339\u914D bitcoin \u6216 BTC",regexExample2:"pay.*ment - \u5339\u914D payment, payments \u7B49",regexExample3:"\\d+.*USD - \u5339\u914D\u6578\u5B57\u5F8C\u8DDF USD",addKeywordButton:"\u6DFB\u52A0",keywordAdded:"\u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0",keywordAddFailed:"\u6DFB\u52A0\u95DC\u9375\u8A5E\u5931\u6557",invalidRegex:"\u6B63\u5247\u8868\u9054\u5F0F\u8A9E\u6CD5\u932F\u8AA4",selectKeywordSetFirst:"\u8ACB\u5148\u9EDE\u64CA\u95DC\u9375\u8A5E\u96C6\u4EE5\u9078\u64C7",keywordEmpty:"\u95DC\u9375\u8A5E\u4E0D\u80FD\u70BA\u7A7A",testKeyword:"\u6E2C\u8A66",testKeywordPlaceholder:"\u8F38\u5165\u6E2C\u8A66\u6587\u672C...",keywordMatches:"\u5339\u914D",keywordNoMatch:"\u4E0D\u5339\u914D"}},Ol=class i{constructor(){this.language=f("zh");this.dictionary=f(G3)}translate(e){let t=this.language();return this.dictionary()[t][e]||e}setLanguage(e){this.language.set(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var rs=class i{constructor(){this.ipcService=F(Q)}downloadExcelTemplate(){this.ipcService.send("download-excel-template")}loadAccountsFromExcel(){this.ipcService.send("load-accounts-from-excel")}reloadSessionsAndAccounts(){this.ipcService.send("reload-sessions-and-accounts")}exportLeadsToExcel(e){this.ipcService.send("export-leads-to-excel",JSON.parse(JSON.stringify(e)))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac})}};var $3=(i,e)=>e.id,H3=(i,e)=>e.label;function q3(i,e){if(i&1&&(T(0,"div",6),l(1),k()),i&2){let t=m().$implicit;c(),D(t.title)}}function W3(i,e){if(i&1){let t=I();T(0,"button",12),se("click",function(){_(t);let o=m().$implicit,a=m();return v(a.handleNextStep(o))}),T(1,"span"),l(2,"\u2192"),k(),T(3,"span",13),l(4),k()()}if(i&2){let t=m().$implicit;c(4),D(t.nextStep.label)}}function z3(i,e){if(i&1){let t=I();T(0,"button",15),se("click",function(){let o=_(t).$implicit,a=m(2).$implicit,d=m();return v(d.handleAction(a,o))}),l(1),k()}if(i&2){let t=e.$implicit;N("bg-white",t.variant==="primary")("text-slate-900",t.variant==="primary")("hover:bg-white/90",t.variant==="primary")("bg-white/20",t.variant==="secondary"||!t.variant)("text-white",t.variant==="secondary"||!t.variant)("hover:bg-white/30",t.variant==="secondary"||!t.variant)("bg-red-600",t.variant==="danger")("text-white",t.variant==="danger")("hover:bg-red-700",t.variant==="danger"),c(),M(" ",t.label," ")}}function K3(i,e){if(i&1&&(T(0,"div",9),O(1,z3,2,19,"button",14,H3),k()),i&2){let t=m().$implicit;c(),U(t.actions)}}function j3(i,e){if(i&1){let t=I();T(0,"button",16),se("click",function(){_(t);let o=m().$implicit,a=m();return v(a.dismiss(o.id))}),ne(),T(1,"svg",17),Se(2,"path",18),k()()}}function J3(i,e){if(i&1&&(T(0,"div",11),Se(1,"div",19),k()),i&2){let t=m().$implicit;c(),ee("width",t.progress,"%")}}function Q3(i,e){if(i&1&&(T(0,"div",2)(1,"div",3)(2,"div",4),l(3),k(),T(4,"div",5),y(5,q3,2,1,"div",6),T(6,"div",7),l(7),k(),y(8,W3,5,1,"button",8),y(9,K3,3,0,"div",9),k(),y(10,j3,3,0,"button",10),k(),y(11,J3,2,2,"div",11),k()),i&2){let t=e.$implicit,n=m();N("bg-emerald-500/95",t.type==="success")("bg-red-500/95",t.type==="error")("bg-amber-500/95",t.type==="warning")("bg-blue-500/95",t.type==="info")("bg-slate-700/95",t.type==="progress")("border-emerald-400/50",t.type==="success")("border-red-400/50",t.type==="error")("border-amber-400/50",t.type==="warning")("border-blue-400/50",t.type==="info")("border-slate-600/50",t.type==="progress"),c(3),M(" ",t.icon||n.getDefaultIcon(t.type)," "),c(2),S(t.title?5:-1),c(2),M(" ",t.message," "),c(),S(t.nextStep?8:-1),c(),S(t.actions&&t.actions.length>0?9:-1),c(),S(t.dismissible!==!1?10:-1),c(),S(t.type==="progress"&&t.progress!==void 0?11:-1)}}var Ul=class i{constructor(){this.toastService=F(J)}get toasts(){return this.toastService.getToasts()}getDefaultIcon(e){return{success:"\u2705",error:"\u274C",warning:"\u26A0\uFE0F",info:"\u2139\uFE0F",progress:"\u23F3"}[e]||"\u2139\uFE0F"}dismiss(e){this.toastService.dismiss(e)}handleNextStep(e){e.nextStep&&(e.nextStep.action(),this.dismiss(e.id))}handleAction(e,t){t.handler(),this.dismiss(e.id)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-toast"]],decls:3,vars:0,consts:[[1,"fixed","top-4","right-4","z-[9999]","space-y-3","max-w-md"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden",3,"bg-emerald-500/95","bg-red-500/95","bg-amber-500/95","bg-blue-500/95","bg-slate-700/95","border-emerald-400/50","border-red-400/50","border-amber-400/50","border-blue-400/50","border-slate-600/50"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden"],[1,"flex","items-start","gap-3","p-4"],[1,"flex-shrink-0","text-xl"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-white","mb-0.5"],[1,"text-white","text-sm"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors"],[1,"flex","items-center","gap-2","mt-3"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1"],[1,"h-1","bg-slate-600"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors",3,"click"],[1,"underline"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"bg-white","text-slate-900","hover:bg-white/90","bg-white/20","text-white","hover:bg-white/30","bg-red-600","hover:bg-red-700"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"click"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all","duration-300"]],template:function(t,n){t&1&&(T(0,"div",0),O(1,Q3,12,27,"div",1,$3),k()),t&2&&(c(),U(n.toasts()))},dependencies:[oe],styles:["@keyframes _ngcontent-%COMP%_slide-in{0%{transform:translate(100%) scale(.95);opacity:0}to{transform:translate(0) scale(1);opacity:1}}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in .3s cubic-bezier(.34,1.56,.64,1)}"]})}};var zt=class i{constructor(){this.state=f({isOpen:!1,type:"info",title:"",message:"",confirmText:"\u78BA\u5B9A",cancelText:"\u53D6\u6D88",affectedItems:[],requireConfirmText:!1,confirmTextRequired:""})}confirm(e){return new Promise(t=>{this.state.set({isOpen:!0,type:e.type||"info",title:e.title,message:e.message,confirmText:e.confirmText||"\u78BA\u5B9A",cancelText:e.cancelText||"\u53D6\u6D88",affectedItems:e.affectedItems||[],requireConfirmText:e.requireConfirmText||!1,confirmTextRequired:e.confirmTextRequired||"DELETE",resolve:t})})}danger(e,t,n){return this.confirm({type:"danger",title:e,message:t,confirmText:"\u522A\u9664",affectedItems:n})}warning(e,t){return this.confirm({type:"warning",title:e,message:t,confirmText:"\u78BA\u5B9A"})}info(e,t){return this.confirm({type:"info",title:e,message:t})}onConfirm(){let e=this.state();e.resolve&&e.resolve(!0),this.close()}onCancel(){let e=this.state();e.resolve&&e.resolve(!1),this.close()}close(){this.state.update(e=>P(E({},e),{isOpen:!1}))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};function Y3(i,e){i&1&&(r(0,"span",5),l(1,"\u2139\uFE0F"),s())}function X3(i,e){i&1&&(r(0,"span",6),l(1,"\u26A0\uFE0F"),s())}function Z3(i,e){i&1&&(r(0,"span",7),l(1,"\u{1F5D1}\uFE0F"),s())}function e4(i,e){if(i&1&&(r(0,"li",18),B(1,"span",20),r(2,"span",21),l(3),s()()),i&2){let t=e.$implicit,n=m(3);c(),N("bg-yellow-500",n.dialogService.state().type==="warning")("bg-red-500",n.dialogService.state().type==="danger")("bg-blue-500",n.dialogService.state().type==="info"),c(2),D(t)}}function t4(i,e){if(i&1&&(r(0,"li",19),l(1),s()),i&2){let t=m(3);c(),M("...\u9084\u6709 ",t.dialogService.state().affectedItems.length-5," \u9805")}}function n4(i,e){if(i&1&&(r(0,"div",11)(1,"p",16),l(2,"\u5C07\u6703\u53D7\u5230\u5F71\u97FF:"),s(),r(3,"ul",17),O(4,e4,4,7,"li",18,be),y(6,t4,2,1,"li",19),s()()),i&2){let t=m(2);c(4),U(t.dialogService.state().affectedItems.slice(0,5)),c(2),S(t.dialogService.state().affectedItems.length>5?6:-1)}}function i4(i,e){if(i&1){let t=I();r(0,"div",12)(1,"p",16),l(2," \u8F38\u5165\u300C"),r(3,"span",22),l(4),s(),l(5,"\u300D\u4EE5\u78BA\u8A8D "),s(),r(6,"input",23),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.confirmTextInput,o)||(a.confirmTextInput=o),v(o)}),s()()}if(i&2){let t=m(2);c(4),D(t.dialogService.state().confirmTextRequired),c(2),H("ngModel",t.confirmTextInput)}}function o4(i,e){if(i&1){let t=I();r(0,"div",0)(1,"div",1),x("click",function(){_(t);let o=m();return v(o.dialogService.onCancel())}),s(),r(2,"div",2)(3,"div",3)(4,"div",4),y(5,Y3,2,0,"span",5)(6,X3,2,0,"span",6)(7,Z3,2,0,"span",7),s()(),r(8,"div",8)(9,"h3",9),l(10),s(),r(11,"p",10),l(12),s(),y(13,n4,7,1,"div",11),y(14,i4,7,2,"div",12),s(),r(15,"div",13)(16,"button",14),x("click",function(){_(t);let o=m();return v(o.dialogService.onCancel())}),l(17),s(),r(18,"button",15),x("click",function(){_(t);let o=m();return v(o.onConfirmClick())}),l(19),s()()()()}if(i&2){let t,n=m();c(4),N("bg-blue-500/20",n.dialogService.state().type==="info")("bg-yellow-500/20",n.dialogService.state().type==="warning")("bg-red-500/20",n.dialogService.state().type==="danger"),c(),S((t=n.dialogService.state().type)==="info"?5:t==="warning"?6:t==="danger"?7:-1),c(5),D(n.dialogService.state().title),c(2),D(n.dialogService.state().message),c(),S(n.dialogService.state().affectedItems&&n.dialogService.state().affectedItems.length>0?13:-1),c(),S(n.dialogService.state().requireConfirmText?14:-1),c(3),M(" ",n.dialogService.state().cancelText," "),c(),N("bg-blue-500",n.dialogService.state().type==="info")("hover:bg-blue-600",n.dialogService.state().type==="info")("bg-yellow-500",n.dialogService.state().type==="warning")("hover:bg-yellow-600",n.dialogService.state().type==="warning")("text-black",n.dialogService.state().type==="warning")("bg-red-500",n.dialogService.state().type==="danger")("hover:bg-red-600",n.dialogService.state().type==="danger")("text-white",n.dialogService.state().type!=="warning"),L("disabled",!n.canConfirm()),c(),M(" ",n.dialogService.state().confirmText," ")}}var Gl=class i{constructor(){this.dialogService=F(zt);this.confirmTextInput=""}canConfirm(){let e=this.dialogService.state();return e.requireConfirmText?this.confirmTextInput===e.confirmTextRequired:!0}onConfirmClick(){this.canConfirm()&&(this.confirmTextInput="",this.dialogService.onConfirm())}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-global-confirm-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"pt-6","text-center"],[1,"inline-flex","w-16","h-16","rounded-full","items-center","justify-center","text-3xl"],[1,"text-blue-400"],[1,"text-yellow-400"],[1,"text-red-400"],[1,"p-6","text-center"],[1,"text-lg","font-semibold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-4","whitespace-pre-line"],[1,"mt-4","p-3","bg-slate-700/50","rounded-lg","text-left","max-h-32","overflow-y-auto"],[1,"mt-4"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","rounded-lg","transition-colors","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-xs","text-slate-500","mb-2"],[1,"space-y-1"],[1,"text-sm","text-slate-300","flex","items-center","gap-2"],[1,"text-xs","text-slate-500"],[1,"w-1.5","h-1.5","rounded-full","flex-shrink-0"],[1,"truncate"],[1,"text-red-400","font-medium"],["type","text","placeholder","\u8ACB\u8F38\u5165\u78BA\u8A8D\u6587\u5B57",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-center","focus:border-red-500","focus:outline-none",3,"ngModelChange","ngModel"]],template:function(t,n){t&1&&y(0,o4,20,30,"div",0),t&2&&S(n.dialogService.state().isOpen?0:-1)},dependencies:[oe,ae,xe,ve,he],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};var st=class i{constructor(){this.toast=F(J);this._confirmDialog=f(null);this.confirmDialog=this._confirmDialog.asReadonly();this._progressDialog=f({show:!1,title:"",progress:0,cancellable:!1});this.progressDialog=this._progressDialog.asReadonly();this._showSuccessOverlay=f(!1);this._successOverlayConfig=f(null);this.showSuccessOverlay=this._showSuccessOverlay.asReadonly();this.successOverlayConfig=this._successOverlayConfig.asReadonly();this._deleteConfirmDialog=f({show:!1,type:"single"});this.deleteConfirmDialog=this._deleteConfirmDialog.asReadonly();this._showQrLoginDialog=f(!1);this.showQrLoginDialog=this._showQrLoginDialog.asReadonly();this._showBatchMessageDialog=f(!1);this._batchSendTargets=f([]);this.showBatchMessageDialog=this._showBatchMessageDialog.asReadonly();this.batchSendTargets=this._batchSendTargets.asReadonly();this._showBatchInviteDialog=f(!1);this._batchInviteTargets=f([]);this.showBatchInviteDialog=this._showBatchInviteDialog.asReadonly();this.batchInviteTargets=this._batchInviteTargets.asReadonly();this._showMemberExtractionDialog=f(!1);this._memberExtractionGroup=f(null);this.showMemberExtractionDialog=this._showMemberExtractionDialog.asReadonly();this.memberExtractionGroup=this._memberExtractionGroup.asReadonly();this._showJoinMonitorDialog=f(!1);this._joinMonitorResource=f(null);this.showJoinMonitorDialog=this._showJoinMonitorDialog.asReadonly();this.joinMonitorResource=this._joinMonitorResource.asReadonly();this._showPostJoinDialog=f(!1);this._postJoinResource=f(null);this.showPostJoinDialog=this._showPostJoinDialog.asReadonly();this.postJoinResource=this._postJoinResource.asReadonly();this._inputDialog=f(null);this._inputDialogValue=f("");this._inputDialogError=f(null);this.inputDialog=this._inputDialog.asReadonly();this.inputDialogValue=this._inputDialogValue.asReadonly();this.inputDialogError=this._inputDialogError.asReadonly()}confirm(e){this._confirmDialog.set(e)}closeConfirmDialog(){let e=this._confirmDialog();e?.onCancel&&e.onCancel(),this._confirmDialog.set(null)}confirmAction(){let e=this._confirmDialog();e?.onConfirm&&e.onConfirm(),this._confirmDialog.set(null)}showProgress(e,t=!1){this._progressDialog.set({show:!0,title:e,progress:0,cancellable:t})}updateProgress(e,t){this._progressDialog.update(n=>P(E({},n),{progress:e,message:t}))}hideProgress(){this._progressDialog.update(e=>P(E({},e),{show:!1}))}showSuccess(e){this._successOverlayConfig.set(e),this._showSuccessOverlay.set(!0);let t=e.duration??2e3;setTimeout(()=>{this._showSuccessOverlay.set(!1),this._successOverlayConfig.set(null)},t)}hideSuccess(){this._showSuccessOverlay.set(!1),this._successOverlayConfig.set(null)}showDeleteConfirm(e,t,n){this._deleteConfirmDialog.set({show:!0,type:e,lead:t,count:n})}hideDeleteConfirm(){this._deleteConfirmDialog.update(e=>P(E({},e),{show:!1}))}openQrLogin(){this._showQrLoginDialog.set(!0)}closeQrLogin(){this._showQrLoginDialog.set(!1)}openBatchSend(e){this._batchSendTargets.set(e),this._showBatchMessageDialog.set(!0)}closeBatchSend(){this._showBatchMessageDialog.set(!1),this._batchSendTargets.set([])}openBatchInvite(e){this._batchInviteTargets.set(e),this._showBatchInviteDialog.set(!0)}closeBatchInvite(){this._showBatchInviteDialog.set(!1),this._batchInviteTargets.set([])}openMemberExtraction(e){this._memberExtractionGroup.set(e),this._showMemberExtractionDialog.set(!0)}closeMemberExtraction(){this._showMemberExtractionDialog.set(!1),this._memberExtractionGroup.set(null)}openJoinMonitor(e){this._joinMonitorResource.set(e),this._showJoinMonitorDialog.set(!0)}closeJoinMonitor(){this._showJoinMonitorDialog.set(!1),this._joinMonitorResource.set(null)}openPostJoin(e){this._postJoinResource.set(e),this._showPostJoinDialog.set(!0)}closePostJoin(){this._showPostJoinDialog.set(!1),this._postJoinResource.set(null)}prompt(e){this._inputDialogValue.set(e.defaultValue||""),this._inputDialogError.set(null),this._inputDialog.set(e)}updateInputValue(e){this._inputDialogValue.set(e),this._inputDialogError.set(null)}confirmInput(){let e=this._inputDialog(),t=this._inputDialogValue();if(e){if(e.validator){let n=e.validator(t);if(n){this._inputDialogError.set(n);return}}if(!t.trim()){this._inputDialogError.set("\u8ACB\u8F38\u5165\u5167\u5BB9");return}e.onConfirm&&e.onConfirm(t.trim()),this._inputDialog.set(null),this._inputDialogValue.set(""),this._inputDialogError.set(null)}}cancelInput(){let e=this._inputDialog();e?.onCancel&&e.onCancel(),this._inputDialog.set(null),this._inputDialogValue.set(""),this._inputDialogError.set(null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var r4=["inputRef"];function s4(i,e){if(i&1&&(r(0,"p",6),l(1),s()),i&2){let t,n=m(2);c(),D((t=n.dialogService.inputDialog())==null?null:t.message)}}function a4(i,e){if(i&1){let t=I();r(0,"textarea",14,0),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.inputValue,o)||(a.inputValue=o),v(o)}),x("keydown.enter",function(o){_(t);let a=m(2);return v(a.onEnterKey(o))}),l(2,"              "),s()}if(i&2){let t,n=m(2);H("ngModel",n.inputValue),L("placeholder",((t=n.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function l4(i,e){if(i&1){let t=I();r(0,"input",15,0),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.inputValue,o)||(a.inputValue=o),v(o)}),x("keydown.enter",function(o){_(t);let a=m(2);return v(a.onEnterKey(o))}),s()}if(i&2){let t,n=m(2);H("ngModel",n.inputValue),L("placeholder",((t=n.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function c4(i,e){if(i&1&&(r(0,"p",10)(1,"span"),l(2,"\u26A0\uFE0F"),s(),l(3),s()),i&2){let t=m(2);c(3),M(" ",t.dialogService.inputDialogError()," ")}}function d4(i,e){if(i&1){let t=I();r(0,"div",1)(1,"div",2),x("click",function(){_(t);let o=m();return v(o.cancelDialog())}),s(),r(2,"div",3)(3,"div",4)(4,"h3",5)(5,"span"),l(6,"\u270F\uFE0F"),s(),l(7),s(),y(8,s4,2,1,"p",6),s(),r(9,"div",7),x("click",function(o){_(t);let a=m();return v(a.focusInput(o))}),y(10,a4,3,2,"textarea",8)(11,l4,2,2,"input",9),y(12,c4,4,1,"p",10),s(),r(13,"div",11)(14,"button",12),x("click",function(){_(t);let o=m();return v(o.cancelDialog())}),l(15),s(),r(16,"button",13),x("click",function(){_(t);let o=m();return v(o.confirmWithValue())}),l(17),s()()()()}if(i&2){let t,n,o,a,d,u=m();c(7),M(" ",(t=u.dialogService.inputDialog())==null?null:t.title," "),c(),S((n=u.dialogService.inputDialog())!=null&&n.message?8:-1),c(2),S(((o=u.dialogService.inputDialog())==null?null:o.inputType)==="textarea"?10:11),c(2),S(u.dialogService.inputDialogError()?12:-1),c(3),M(" ",((a=u.dialogService.inputDialog())==null?null:a.cancelText)||"\u53D6\u6D88"," "),c(2),M(" ",((d=u.dialogService.inputDialog())==null?null:d.confirmText)||"\u78BA\u5B9A"," ")}}var $l=class i{constructor(){this.dialogService=F(st);this.inputValue="";this.lastDialogState=!1}ngAfterViewChecked(){let e=!!this.dialogService.inputDialog();e&&!this.lastDialogState&&(this.inputValue=this.dialogService.inputDialog()?.defaultValue||"",setTimeout(()=>this.focusInput(),100),setTimeout(()=>this.focusInput(),300)),!e&&this.lastDialogState&&(this.inputValue=""),this.lastDialogState=e}focusInput(e){e&&e.stopPropagation(),this.inputRef?.nativeElement&&(this.inputRef.nativeElement.focus(),console.log("[InputDialog] Focus requested"))}onEnterKey(e){this.dialogService.inputDialog()?.inputType!=="textarea"&&(e.preventDefault(),this.confirmWithValue())}confirmWithValue(){this.dialogService.updateInputValue(this.inputValue),this.dialogService.confirmInput()}cancelDialog(){this.inputValue="",this.dialogService.cancelInput()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-global-input-dialog"]],viewQuery:function(t,n){if(t&1&&ci(r4,5),t&2){let o;Rn(o=Nn())&&(n.inputRef=o.first)}},decls:1,vars:1,consts:[["inputRef",""],[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"p-6","pb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-2"],[1,"px-6","pb-4",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModel","placeholder"],[1,"mt-2","text-sm","text-red-400","flex","items-center","gap-1"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","bg-purple-500","hover:bg-purple-600","text-white","rounded-lg","transition-colors","font-medium",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModelChange","keydown.enter","ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModelChange","keydown.enter","ngModel","placeholder"]],template:function(t,n){t&1&&y(0,d4,18,6,"div",1),t&2&&S(n.dialogService.inputDialog()?0:-1)},dependencies:[oe,ae,xe,ve,he],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};function u4(i,e){if(i&1&&(T(0,"p",9),l(1),k()),i&2){let t=m(2);c(),D(t.progressSignal().itemName)}}function m4(i,e){if(i&1&&(T(0,"p",6),l(1),k()),i&2){let t=m(2);c(),D(t.progressSignal().message)}}function p4(i,e){if(i&1){let t=I();T(0,"button",11),se("click",function(){_(t);let o=m(2);return v(o.onCancel())}),l(1," \u53D6\u6D88 "),k()}}function g4(i,e){if(i&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),l(4),k(),T(5,"div",4)(6,"div",5)(7,"span",6),l(8),k(),T(9,"span",6),l(10),k()(),T(11,"div",7),Se(12,"div",8),k()(),y(13,u4,2,1,"p",9),y(14,m4,2,1,"p",6),y(15,p4,2,0,"button",10),k()()()),i&2){let t=m();c(4),D(t.titleSignal()),c(4),X("",t.progressSignal().current," / ",t.progressSignal().total),c(2),M("",t.percentage(),"%"),c(2),ee("width",t.percentage(),"%"),c(),S(t.progressSignal().itemName?13:-1),c(),S(t.progressSignal().message?14:-1),c(),S(t.cancellableSignal()?15:-1)}}var Hl=class i{constructor(){this._show=f(!1);this._title=f("\u5904\u7406\u4E2D...");this._progress=f({current:0,total:0});this._cancellable=f(!1);this.showSignal=R(()=>this._show());this.titleSignal=R(()=>this._title());this.progressSignal=R(()=>this._progress());this.cancellableSignal=R(()=>this._cancellable());this.percentage=R(()=>{let e=this._progress();return e.total>0?Math.round(e.current/e.total*100):0})}set show(e){this._show.set(e)}set title(e){this._title.set(e)}set progress(e){this._progress.set(e)}set cancellable(e){this._cancellable.set(e)}onCancel(){this.onCancelCallback&&this.onCancelCallback()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-progress-dialog"]],inputs:{show:"show",title:"title",progress:"progress",cancellable:"cancellable",onCancelCallback:"onCancelCallback"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","z-50","flex","items-center","justify-center"],[1,"bg-slate-800/90","dark:bg-slate-900/90","rounded-lg","p-6","shadow-xl","border","border-slate-700","min-w-[400px]"],[1,"flex","flex-col","gap-4"],[1,"text-lg","font-semibold","text-slate-200"],[1,"w-full"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-sm","text-slate-300"],[1,"w-full","bg-slate-700","rounded-full","h-3","overflow-hidden"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","h-full","transition-all","duration-300","ease-out"],[1,"text-sm","text-slate-400","text-center"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm",3,"click"]],template:function(t,n){t&1&&y(0,g4,16,9,"div",0),t&2&&S(n.showSignal()?0:-1)},dependencies:[oe],styles:[".transition-all[_ngcontent-%COMP%]{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.3s}"]})}};function h4(i,e){if(i&1&&(T(0,"span",3),l(1),k()),i&2){let t=m();c(),M(" ",t.membershipService.daysRemaining(),"\u5929 ")}}function f4(i,e){if(i&1&&(T(0,"span"),l(1),Ee(2,"date"),k()),i&2){let t,n=m(3);c(),M("\u5230\u671F\u6642\u9593\uFF1A",yt(2,1,(t=n.membershipService.membership())==null?null:t.expiresAt,"yyyy-MM-dd"))}}function _4(i,e){i&1&&(T(0,"span",19),l(1,"\u6703\u54E1\u5DF2\u904E\u671F"),k())}function v4(i,e){if(i&1&&(T(0,"div",8),y(1,f4,3,4,"span")(2,_4,2,0,"span",19),k()),i&2){let t=m(2);c(),S(t.membershipService.daysRemaining()>0?1:2)}}function x4(i,e){if(i&1){let t=I();T(0,"div",4)(1,"div",5)(2,"span",6),l(3),k(),T(4,"span",7),l(5),k()(),y(6,v4,3,1,"div",8),T(7,"div",9)(8,"div")(9,"div",10)(10,"span"),l(11,"\u4ECA\u65E5\u6D88\u606F"),k(),T(12,"span"),l(13),k()(),T(14,"div",11),Se(15,"div",12),k()(),T(16,"div")(17,"div",10)(18,"span"),l(19,"\u4ECA\u65E5 AI"),k(),T(20,"span"),l(21),k()(),T(22,"div",11),Se(23,"div",13),k()()(),T(24,"div",14)(25,"button",15),se("click",function(){_(t);let o=m();return v(o.openActivate())}),l(26),k(),T(27,"button",16),se("click",function(){_(t);let o=m();return v(o.showDetails=!1)}),ne(),T(28,"svg",17),Se(29,"path",18),k()()()()}if(i&2){let t=m();c(3),D(t.membershipService.levelIcon()),c(2),D(t.membershipService.levelName()),c(),S(t.membershipService.level()!=="bronze"?6:-1),c(7),X("",t.usage().todayMessages," / ",t.quotaText("messages")),c(2),ee("width",t.usagePercent().messages,"%"),c(6),X("",t.usage().todayAiCalls," / ",t.quotaText("ai")),c(2),ee("width",t.usagePercent().ai,"%"),c(3),M(" ",t.membershipService.level()==="bronze"?"\u6FC0\u6D3B\u6703\u54E1":"\u7E8C\u8CBB/\u5347\u7D1A"," ")}}var C4=(i,e)=>e.level;function b4(i,e){i&1&&(r(0,"div",22),l(1," \u63A8\u85A6 "),s())}function y4(i,e){i&1&&(r(0,"div",23),l(1," \u7576\u524D "),s())}function S4(i,e){i&1&&(r(0,"span",28),l(1,"\u514D\u8CBB"),s())}function w4(i,e){if(i&1&&(r(0,"span",5),l(1),s(),r(2,"span",33),l(3,"/\u6708"),s()),i&2){let t=m().$implicit;c(),M("",t.monthlyPrice," USDT")}}function E4(i,e){if(i&1&&(r(0,"div",29),l(1),s()),i&2){let t=m().$implicit,n=m(3);c(),X(" \u5E74\u4ED8 ",t.yearlyPrice," USDT (\u7701 ",n.Math.round((1-t.yearlyPrice/(t.monthlyPrice*12))*100),"%) ")}}function D4(i,e){if(i&1&&(r(0,"li",31),ne(),r(1,"svg",34),B(2,"path",35),s(),l(3),s()),i&2){let t=e.$implicit;c(3),M(" ",t," ")}}function A4(i,e){if(i&1){let t=I();r(0,"div",21),y(1,b4,2,0,"div",22),y(2,y4,2,0,"div",23),r(3,"div",24)(4,"span",25),l(5),s(),r(6,"h3",26),l(7),s(),r(8,"div",27),y(9,S4,2,0,"span",28)(10,w4,4,1),s(),y(11,E4,2,2,"div",29),s(),r(12,"ul",30),O(13,D4,4,1,"li",31,be),s(),r(15,"button",32),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectPlan(o))}),l(16),s()()}if(i&2){let t=e.$implicit,n=m(3);N("border-cyan-500",t.level===n.membershipService.level())("border-slate-600",t.level!==n.membershipService.level())("bg-slate-700/50",t.level===n.membershipService.level())("bg-slate-800",t.level!==n.membershipService.level()),c(),S(t.recommended?1:-1),c(),S(t.level===n.membershipService.level()?2:-1),c(3),D(t.icon),c(2),D(t.name),c(2),S(t.monthlyPrice===0?9:10),c(2),S(t.yearlyPrice>0?11:-1),c(2),U(t.features),c(2),N("bg-gradient-to-r",t.level!=="bronze")("from-cyan-500",t.level!=="bronze")("to-blue-500",t.level!=="bronze")("text-white",t.level!=="bronze")("bg-slate-700",t.level==="bronze")("text-slate-400",t.level==="bronze"),L("disabled",t.level==="bronze"),c(),M(" ",t.level==="bronze"?"\u7576\u524D\u65B9\u6848":t.level===n.membershipService.level()?"\u7E8C\u8CBB":"\u9078\u64C7"," ")}}function M4(i,e){if(i&1&&(r(0,"div",14),O(1,A4,17,28,"div",15,C4),s(),r(3,"div",16)(4,"h4",17),l(5,"\u{1F4B3} \u8CFC\u8CB7\u65B9\u5F0F"),s(),r(6,"p",18),l(7," \u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6\uFF0C\u6216\u901A\u904E\u5B98\u65B9\u6E20\u9053\u7372\u53D6\u3002\u8CFC\u8CB7\u5F8C\u5728\u300C\u6FC0\u6D3B\u5361\u5BC6\u300D\u6A19\u7C64\u4E2D\u8F38\u5165\u6FC0\u6D3B\u78BC\u3002 "),s(),r(8,"div",19)(9,"a",20),l(10,"\u{1F4F1} \u806F\u7E6B\u5BA2\u670D"),s(),r(11,"a",20),l(12,"\u{1F310} \u5B98\u65B9\u5546\u57CE"),s()()()),i&2){let t=m(2);c(),U(t.plans)}}function T4(i,e){if(i&1){let t=I();r(0,"div",13)(1,"div",36)(2,"div",37),l(3,"\u{1F511}"),s(),r(4,"h3",38),l(5,"\u6FC0\u6D3B\u6703\u54E1\u5361\u5BC6"),s(),r(6,"p",39),l(7,"\u8F38\u5165\u60A8\u8CFC\u8CB7\u7684\u5361\u5BC6\u6FC0\u6D3B\u6703\u54E1"),s()(),r(8,"div",40)(9,"div")(10,"label",41),l(11,"\u5361\u5BC6"),s(),r(12,"input",42),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.licenseKey,o)||(a.licenseKey=o),v(o)}),s()(),r(13,"div")(14,"label",41),l(15,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u901A\u77E5)"),s(),r(16,"input",43),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.email,o)||(a.email=o),v(o)}),s()(),r(17,"button",44),x("click",function(){_(t);let o=m(2);return v(o.activateLicense())}),l(18),s()(),r(19,"div",16)(20,"h4",17),l(21,"\u{1F4CB} \u5361\u5BC6\u683C\u5F0F\u8AAA\u660E"),s(),r(22,"ul",45)(23,"li"),l(24,"\u2022 TGAI-B2-XXXX-XXXX-XXXX (\u{1F948} \u767D\u9280\u6708\u5361)"),s(),r(25,"li"),l(26,"\u2022 TGAI-G2-XXXX-XXXX-XXXX (\u{1F947} \u9EC3\u91D1\u6708\u5361)"),s(),r(27,"li"),l(28,"\u2022 TGAI-D2-XXXX-XXXX-XXXX (\u{1F48E} \u947D\u77F3\u6708\u5361)"),s(),r(29,"li"),l(30,"\u2022 TGAI-S2-XXXX-XXXX-XXXX (\u{1F31F} \u661F\u8000\u6708\u5361)"),s(),r(31,"li"),l(32,"\u2022 TGAI-K2-XXXX-XXXX-XXXX (\u{1F451} \u738B\u8005\u6708\u5361)"),s()()()()}if(i&2){let t=m(2);c(12),H("ngModel",t.licenseKey),c(4),H("ngModel",t.email),c(),L("disabled",t.isActivating()),c(),M(" ",t.isActivating()?"\u6FC0\u6D3B\u4E2D...":"\u6FC0\u6D3B"," ")}}function k4(i,e){if(i&1){let t=I();r(0,"div",13)(1,"div",36)(2,"div",37),l(3,"\u{1F381}"),s(),r(4,"h3",38),l(5,"\u9080\u8ACB\u597D\u53CB\uFF0C\u96D9\u65B9\u7372\u76CA"),s(),r(6,"p",39),l(7,"\u5206\u4EAB\u60A8\u7684\u9080\u8ACB\u78BC\uFF0C\u9080\u8ACB\u597D\u53CB\u8A3B\u518A"),s()(),r(8,"div",46)(9,"div",47)(10,"div",48),l(11,"\u6211\u7684\u9080\u8ACB\u78BC"),s(),r(12,"div",49),l(13),s(),r(14,"button",50),x("click",function(){_(t);let o=m(2);return v(o.copyInviteCode())}),l(15," \u{1F4CB} \u8907\u88FD\u9080\u8ACB\u78BC "),s()()(),r(16,"div",51)(17,"div",52)(18,"div",53),l(19),s(),r(20,"div",54),l(21,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),s()(),r(22,"div",52)(23,"div",28),l(24),s(),r(25,"div",54),l(26,"\u7372\u5F97\u734E\u52F5"),s()()(),r(27,"div",55)(28,"h4",56),l(29,"\u{1F3AF} \u734E\u52F5\u898F\u5247"),s(),r(30,"ul",57)(31,"li",58)(32,"span",59),l(33,"\u2713"),s(),l(34," \u9080\u8ACB 1 \u4EBA\u8A3B\u518A\uFF1A\u60A8\u7372\u5F97 3 \u5929\u6703\u54E1 "),s(),r(35,"li",58)(36,"span",59),l(37,"\u2713"),s(),l(38," \u88AB\u9080\u8ACB\u4EBA\u7372\u5F97\uFF1A1 \u5929\u6703\u54E1\u9AD4\u9A57 "),s(),r(39,"li",58)(40,"span",59),l(41,"\u2713"),s(),l(42," \u88AB\u9080\u8ACB\u4EBA\u9996\u6B21\u4ED8\u8CBB\uFF1A\u7372\u5F97\u8C50\u539A\u734E\u52F5 "),s(),r(43,"li",58)(44,"span",59),l(45,"\u2713"),s(),l(46," \u88AB\u9080\u8ACB\u4EBA\u91CD\u8907\u4ED8\u8CBB\uFF1A10% \u8FD4\u50AD "),s()()(),r(47,"div",60)(48,"h4",17),l(49,"\u{1F39F}\uFE0F \u4F7F\u7528\u9080\u8ACB\u78BC"),s(),r(50,"div",61)(51,"input",62),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.inviteCodeInput,o)||(a.inviteCodeInput=o),v(o)}),s(),r(52,"button",63),x("click",function(){_(t);let o=m(2);return v(o.applyInviteCode())}),l(53," \u4F7F\u7528 "),s()()()()}if(i&2){let t,n,o,a=m(2);c(13),M(" ",(t=a.membershipService.membership())==null?null:t.inviteCode," "),c(6),D(((n=a.membershipService.membership())==null?null:n.inviteCount)||0),c(5),M("",((o=a.membershipService.membership())==null?null:o.inviteRewards)||0,"\u5929"),c(27),H("ngModel",a.inviteCodeInput)}}function I4(i,e){if(i&1){let t=I();r(0,"div",1),x("click",function(){_(t);let o=m();return v(o.close())}),r(1,"div",2),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),l(6,"\u{1F680} \u5347\u7D1A\u60A8\u7684 TG-AI\u667A\u63A7\u738B"),s(),r(7,"p",6),l(8,"\u89E3\u9396\u66F4\u591A\u529F\u80FD\uFF0C\u63D0\u5347\u71DF\u92B7\u6548\u7387"),s()(),r(9,"button",7),x("click",function(){_(t);let o=m();return v(o.close())}),ne(),r(10,"svg",8),B(11,"path",9),s()()(),ce(),r(12,"div",10)(13,"button",11),x("click",function(){_(t);let o=m();return v(o.activeTab.set("plans"))}),l(14," \u6703\u54E1\u65B9\u6848 "),s(),r(15,"button",11),x("click",function(){_(t);let o=m();return v(o.activeTab.set("activate"))}),l(16," \u6FC0\u6D3B\u5361\u5BC6 "),s(),r(17,"button",11),x("click",function(){_(t);let o=m();return v(o.activeTab.set("invite"))}),l(18," \u9080\u8ACB\u734E\u52F5 "),s()()(),r(19,"div",12),y(20,M4,13,0),y(21,T4,33,4,"div",13),y(22,k4,54,4,"div",13),s()()()}if(i&2){let t=m();c(13),N("text-white",t.activeTab()==="plans")("text-white/60",t.activeTab()!=="plans")("border-white",t.activeTab()==="plans")("border-transparent",t.activeTab()!=="plans"),c(2),N("text-white",t.activeTab()==="activate")("text-white/60",t.activeTab()!=="activate")("border-white",t.activeTab()==="activate")("border-transparent",t.activeTab()!=="activate"),c(2),N("text-white",t.activeTab()==="invite")("text-white/60",t.activeTab()!=="invite")("border-white",t.activeTab()==="invite")("border-transparent",t.activeTab()!=="invite"),c(3),S(t.activeTab()==="plans"?20:-1),c(),S(t.activeTab()==="activate"?21:-1),c(),S(t.activeTab()==="invite"?22:-1)}}function F4(i,e){if(i&1&&(T(0,"li"),l(1),k()),i&2){let t=e.$implicit;c(),M("\u2728 ",t)}}function P4(i,e){if(i&1){let t=I();T(0,"div",0)(1,"button",1),se("click",function(){_(t);let o=m();return v(o.dismiss())}),ne(),T(2,"svg",2),Se(3,"path",3),k()(),ce(),T(4,"div",4)(5,"div",5),l(6,"\u26A1"),k(),T(7,"div",6)(8,"h4",7),l(9),k(),T(10,"p",8),l(11),k(),T(12,"ul",9),O(13,F4,2,1,"li",null,be),k(),T(15,"button",10),se("click",function(){_(t);let o=m();return v(o.upgrade())}),l(16),k()()()()}if(i&2){let t=m();c(9),D(t.message),c(2),M(" \u5347\u7D1A\u5230 ",t.nextLevelName," \u7372\u5F97\u66F4\u591A\u914D\u984D "),c(2),U(t.suggestion.benefits.slice(0,3)),c(3),M(" \u7ACB\u5373\u5347\u7D1A ",t.suggestion.price," USDT/\u6708 ")}}var M_=class i{constructor(){this.membershipService=F(Ie);this.showDetails=!1;this.badgeClass=R(()=>this.membershipService.level());this.usage=R(()=>this.membershipService.usage());this.usagePercent=R(()=>this.membershipService.getUsagePercentage())}quotaText(e){let t=this.membershipService.quotas(),n=e==="messages"?t.dailyMessages:t.dailyAiCalls;return n===-1?"\u221E":n.toString()}openActivate(){this.showDetails=!1,window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-membership-badge"]],decls:7,vars:6,consts:[[1,"membership-badge","flex","items-center","gap-2","px-3","py-1.5","rounded-full","cursor-pointer","hover:opacity-80","transition-opacity",3,"click"],[1,"text-lg"],[1,"text-sm","font-medium"],[1,"text-xs","bg-red-500/50","px-1.5","py-0.5","rounded"],[1,"absolute","top-full","right-0","mt-2","w-72","bg-slate-800","rounded-lg","shadow-xl","border","border-slate-600","p-4","z-50"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-2xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-300","mb-3"],[1,"space-y-2","mb-4"],[1,"flex","justify-between","text-xs","text-slate-400","mb-1"],[1,"w-full","bg-slate-700","rounded-full","h-1.5"],[1,"bg-cyan-500","h-1.5","rounded-full","transition-all"],[1,"bg-purple-500","h-1.5","rounded-full","transition-all"],[1,"flex","gap-2"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","text-sm","py-2","rounded-lg","hover:opacity-90",3,"click"],[1,"px-3","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-red-400"]],template:function(t,n){t&1&&(T(0,"div",0),se("click",function(){return n.showDetails=!n.showDetails}),T(1,"span",1),l(2),k(),T(3,"span",2),l(4),k(),y(5,h4,2,1,"span",3),k(),y(6,x4,30,12,"div",4)),t&2&&(de(n.badgeClass()),c(2),D(n.membershipService.levelIcon()),c(2),D(n.membershipService.levelName()),c(),S(n.membershipService.daysRemaining()>0&&n.membershipService.daysRemaining()<=7?5:-1),c(),S(n.showDetails?6:-1))},dependencies:[oe,yn],styles:["[_nghost-%COMP%]{position:relative;display:inline-block}.membership-badge.bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}.membership-badge.silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,silver,#a8a8a8);color:#1f2937}.membership-badge.gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:#1f2937}.membership-badge.diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b9f2ff,#87ceeb);color:#1f2937}.membership-badge.star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}.membership-badge.king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}"]})}},ql=class i{constructor(){this.membershipService=F(Ie);this.toastService=F(J);this.show=f(!1);this.activeTab=f("plans");this.isActivating=f(!1);this.licenseKey="";this.email="";this.inviteCodeInput="";this.plans=this.membershipService.getPricingPlans();this.Math=Math;window.addEventListener("open-membership-dialog",()=>{this.show.set(!0)})}close(){this.show.set(!1)}selectPlan(e){e.level!=="bronze"&&(this.activeTab.set("activate"),this.toastService.info(`\u8ACB\u8CFC\u8CB7 ${e.name} \u5361\u5BC6\u5F8C\u5728\u6B64\u6FC0\u6D3B`))}async activateLicense(){if(!this.licenseKey.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u5361\u5BC6");return}this.isActivating.set(!0);try{let e=await this.membershipService.activateMembership(this.licenseKey.trim(),this.email.trim());e.success?(this.toastService.success(e.message,5e3),this.licenseKey="",this.email="",this.close()):this.toastService.error(e.message)}catch{this.toastService.error("\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isActivating.set(!1)}}copyInviteCode(){let e=this.membershipService.membership()?.inviteCode;e&&(navigator.clipboard.writeText(e),this.toastService.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD"))}async applyInviteCode(){if(!this.inviteCodeInput.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u9080\u8ACB\u78BC");return}let e=await this.membershipService.applyInviteCode(this.inviteCodeInput.trim());e.success?(this.toastService.success(e.message,5e3),this.inviteCodeInput=""):this.toastService.error(e.message)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-membership-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-600","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","gap-4","mt-4"],[1,"font-medium","pb-2","border-b-2","transition-colors",3,"click"],[1,"p-6","overflow-y-auto","max-h-[60vh]"],[1,"max-w-md","mx-auto"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"relative","rounded-xl","border-2","p-4","transition-all",3,"border-cyan-500","border-slate-600","bg-slate-700/50","bg-slate-800"],[1,"mt-6","p-4","bg-slate-700/50","rounded-lg"],[1,"font-medium","text-white","mb-2"],[1,"text-sm","text-slate-300"],[1,"flex","gap-4","mt-3"],["href","#",1,"text-sm","text-cyan-400","hover:underline"],[1,"relative","rounded-xl","border-2","p-4","transition-all"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-xs","px-3","py-1","rounded-full"],[1,"absolute","-top-3","right-2","bg-green-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center","mb-4"],[1,"text-3xl"],[1,"text-lg","font-bold","text-white","mt-2"],[1,"mt-2"],[1,"text-2xl","font-bold","text-green-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"space-y-2","text-sm"],[1,"flex","items-start","gap-2","text-slate-300"],[1,"w-full","mt-4","py-2","rounded-lg","font-medium","transition-colors",3,"click","disabled"],[1,"text-slate-400"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4","text-green-400","mt-0.5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-center","mb-6"],[1,"text-4xl","mb-2"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","mt-1"],[1,"space-y-4"],[1,"block","text-sm","text-slate-300","mb-1"],["type","text","placeholder","TGAI-XX-XXXX-XXXX-XXXX",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none","uppercase","tracking-wider","font-mono",3,"ngModelChange","ngModel"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","font-bold","py-3","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","text-slate-400","space-y-1"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-600/20","rounded-xl","p-6","mb-6"],[1,"text-center"],[1,"text-sm","text-slate-400","mb-2"],[1,"text-3xl","font-mono","font-bold","text-white","tracking-widest","mb-3"],[1,"bg-white/10","hover:bg-white/20","text-white","px-4","py-2","rounded-lg","transition-colors",3,"click"],[1,"grid","grid-cols-2","gap-4","mb-6"],[1,"bg-slate-700/50","rounded-lg","p-4","text-center"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400"],[1,"bg-slate-700/50","rounded-lg","p-4"],[1,"font-medium","text-white","mb-3"],[1,"space-y-2","text-sm","text-slate-300"],[1,"flex","items-center","gap-2"],[1,"text-green-400"],[1,"mt-6","p-4","border","border-dashed","border-slate-600","rounded-lg"],[1,"flex","gap-2"],["type","text","placeholder","\u8F38\u5165\u597D\u53CB\u7684\u9080\u8ACB\u78BC",1,"flex-1","bg-slate-700","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm","uppercase",3,"ngModelChange","ngModel"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","px-4","py-2","rounded-lg","text-sm",3,"click"]],template:function(t,n){t&1&&y(0,I4,23,27,"div",0),t&2&&S(n.show()?0:-1)},dependencies:[oe,ae,xe,ve,he],encapsulation:2})}},Wl=class i{constructor(){this.membershipService=F(Ie);this.show=!1;this.message="";this.suggestion=this.membershipService.getUpgradeSuggestion()}get nextLevelName(){return this.suggestion?.nextLevel?{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.suggestion.nextLevel]:""}showPrompt(e){this.message=e,this.suggestion=this.membershipService.getUpgradeSuggestion(),this.suggestion&&(this.show=!0)}dismiss(){this.show=!1}upgrade(){this.dismiss(),window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-upgrade-prompt"]],decls:1,vars:1,consts:[[1,"fixed","bottom-4","right-4","max-w-sm","bg-gradient-to-r","from-slate-800","to-slate-700","rounded-xl","shadow-2xl","border","border-slate-600","p-4","z-40","animate-slide-up"],[1,"absolute","top-2","right-2","text-slate-500","hover:text-white",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-start","gap-3"],[1,"text-3xl"],[1,"flex-1"],[1,"font-bold","text-white","mb-1"],[1,"text-sm","text-slate-300","mb-3"],[1,"text-xs","text-slate-400","space-y-1","mb-3"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-sm","font-medium","px-4","py-2","rounded-lg","hover:opacity-90",3,"click"]],template:function(t,n){t&1&&y(0,P4,17,3,"div",0),t&2&&S(n.show&&n.suggestion?0:-1)},dependencies:[oe],styles:["@keyframes _ngcontent-%COMP%_slide-up{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.animate-slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-up .3s ease-out}"]})}};var T_=["\u9AD8\u610F\u5411","\u5F85\u8DDF\u9032","\u5DF2\u6210\u4EA4","\u6D41\u5931\u98A8\u96AA","VIP","\u65B0\u767C\u73FE","\u5DF2\u806F\u7E6B","\u9700\u8981\u5831\u50F9","\u6280\u8853\u8AEE\u8A62","\u6F5B\u5728\u5927\u5BA2\u6236"],zl=[{value:"new",label:"\u65B0\u767C\u73FE",color:"bg-blue-500"},{value:"contacted",label:"\u5DF2\u806F\u7E6B",color:"bg-yellow-500"},{value:"interested",label:"\u6709\u610F\u5411",color:"bg-green-500"},{value:"negotiating",label:"\u6D3D\u8AC7\u4E2D",color:"bg-purple-500"},{value:"converted",label:"\u5DF2\u6210\u4EA4",color:"bg-emerald-500"},{value:"lost",label:"\u5DF2\u6D41\u5931",color:"bg-gray-500"},{value:"blocked",label:"\u5DF2\u5C01\u9396",color:"bg-red-500"},{value:"replied",label:"\u5DF2\u56DE\u8986",color:"bg-teal-500"},{value:"failed",label:"\u767C\u9001\u5931\u6557",color:"bg-rose-500"}],Kt=class i{constructor(){this.ipc=F(Q);this._contacts=f([]);this.contacts=this._contacts.asReadonly();this._stats=f({total:0,users:0,groups:0,channels:0,by_status:{},by_source:{},recent_added:0});this.stats=this._stats.asReadonly();this._total=f(0);this.total=this._total.asReadonly();this._isLoading=f(!1);this.isLoading=this._isLoading.asReadonly();this._isSyncing=f(!1);this.isSyncing=this._isSyncing.asReadonly();this._hasImportedFromLeads=f(!1);this.hasData=R(()=>this._contacts().length>0||this._hasImportedFromLeads());this._filter=f({});this.filter=this._filter.asReadonly();this._selectedIds=f(new Set);this.selectedIds=this._selectedIds.asReadonly();this.selectedContacts=R(()=>{let e=this._selectedIds();return this._contacts().filter(t=>e.has(t.telegram_id))});this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("unified-contacts:list",e=>{console.log("[UnifiedContacts] Received list:",e),this._isLoading.set(!1),e.success?(this._contacts.set(e.contacts||[]),this._total.set(e.total||0)):(console.error("[UnifiedContacts] List error:",e.error),this._contacts.set([]),this._total.set(0))}),this.ipc.on("unified-contacts:stats",e=>{console.log("[UnifiedContacts] Received stats:",e),e.success&&this._stats.set(e.stats)}),this.ipc.on("unified-contacts:sync-result",e=>{console.log("[UnifiedContacts] ========== SYNC RESULT =========="),console.log("[UnifiedContacts] Sync result:",e),this._isSyncing.set(!1),e.success?(console.log("[UnifiedContacts] Sync successful, stats:",e.stats),this.loadContacts(),this.loadStats()):console.error("[UnifiedContacts] Sync failed:",e.error)}),this.ipc.on("unified-contacts:update-result",e=>{console.log("[UnifiedContacts] Update result:",e),e.success&&this.loadContacts()}),this.ipc.on("unified-contacts:add-tags-result",e=>{console.log("[UnifiedContacts] Add tags result:",e),e.success&&this.loadContacts()}),this.ipc.on("unified-contacts:update-status-result",e=>{console.log("[UnifiedContacts] Update status result:",e),e.success&&this.loadContacts()}),this.ipc.on("unified-contacts:delete-result",e=>{if(console.log("[UnifiedContacts] Delete result:",e),e.success){let t=this._pendingDeleteIds||new Set,o=this._contacts().filter(a=>!t.has(a.telegram_id));this._contacts.set(o),this._total.set(o.length),this._selectedIds.set(new Set),this._pendingDeleteIds=void 0,this.updateLocalStats(o),console.log("[UnifiedContacts] Deleted successfully, remaining:",o.length)}})}syncFromSources(){console.log("[UnifiedContacts] ========== SYNC START =========="),console.log("[UnifiedContacts] Sending unified-contacts:sync to backend..."),this._isSyncing.set(!0);try{this.ipc.send("unified-contacts:sync",{}),console.log("[UnifiedContacts] IPC command sent successfully")}catch(e){console.error("[UnifiedContacts] Failed to send IPC command:",e),this._isSyncing.set(!1);return}setTimeout(()=>{this._isSyncing()&&(console.warn("[UnifiedContacts] Sync timeout after 60s, resetting state"),this._isSyncing.set(!1))},6e4)}forceEndSync(){console.log("[UnifiedContacts] Force ending all loading states..."),this._isSyncing.set(!1),this._isLoading.set(!1)}forceReloadContacts(e){console.log("[UnifiedContacts] Force reload contacts"),this._hasImportedFromLeads.set(!1);let t=e||this._filter();this._filter.set(t),this._isLoading.set(!0),this.ipc.send("unified-contacts:get",{contactType:t.contactType,sourceType:t.sourceType,status:t.status,tags:t.tags,search:t.search,orderBy:t.orderBy||"created_at DESC",limit:500,offset:0})}loadContacts(e){let t=e||this._filter();if(this._filter.set(t),this._hasImportedFromLeads()&&this._contacts().length>0){console.log("[UnifiedContacts] Data already imported from leads, skipping backend request"),this._isLoading.set(!1);return}console.log("[UnifiedContacts] Loading contacts with filter:",t),this._isLoading.set(!0),this.ipc.send("unified-contacts:get",{contactType:t.contactType,sourceType:t.sourceType,status:t.status,tags:t.tags,search:t.search,orderBy:t.orderBy||"created_at DESC",limit:t.limit||100,offset:t.offset||0}),setTimeout(()=>{this._isLoading()&&(console.warn("[UnifiedContacts] Load timeout, resetting state"),this._isLoading.set(!1))},15e3)}loadStats(){if(this._hasImportedFromLeads()){console.log("[UnifiedContacts] Stats already computed from leads, skipping backend request");return}console.log("[UnifiedContacts] Loading stats..."),this.ipc.send("unified-contacts:stats",{})}setFilter(e){let t=E(E({},this._filter()),e);this.loadContacts(t)}resetFilter(){this.loadContacts({})}search(e){this.setFilter({search:e,offset:0})}setPage(e,t=100){this.setFilter({offset:(e-1)*t,limit:t})}toggleSelect(e){let t=new Set(this._selectedIds());t.has(e)?t.delete(e):t.add(e),this._selectedIds.set(t)}toggleSelectAll(){let e=this._selectedIds(),t=this._contacts().map(n=>n.telegram_id);e.size===t.length?this._selectedIds.set(new Set):this._selectedIds.set(new Set(t))}clearSelection(){this._selectedIds.set(new Set)}updateContact(e,t){console.log("[UnifiedContacts] Updating contact:",e,t),this.ipc.send("unified-contacts:update",{telegramId:e,updates:t})}addTags(e,t){console.log("[UnifiedContacts] Adding tags:",e,t),this.ipc.send("unified-contacts:add-tags",{telegramIds:e,tags:t})}updateStatus(e,t){console.log("[UnifiedContacts] Updating status:",e,t),this.ipc.send("unified-contacts:update-status",{telegramIds:e,status:t})}deleteContacts(e){console.log("[UnifiedContacts] Deleting contacts:",e.length),this._pendingDeleteIds=new Set(e),this.ipc.send("unified-contacts:delete",{telegramIds:e})}updateLocalStats(e){let t={},n={};e.forEach(o=>{t[o.status]=(t[o.status]||0)+1,n[o.source_type]=(n[o.source_type]||0)+1}),this._stats.set({total:e.length,users:e.filter(o=>o.contact_type==="user").length,groups:e.filter(o=>o.contact_type==="group").length,channels:e.filter(o=>o.contact_type==="channel").length,by_status:t,by_source:n,recent_added:e.filter(o=>{let a=new Date(o.created_at),d=new Date;return d.setDate(d.getDate()-7),a>d}).length})}addTagsToSelected(e){let t=Array.from(this._selectedIds());t.length>0&&this.addTags(t,e)}updateSelectedStatus(e){let t=Array.from(this._selectedIds());t.length>0&&this.updateStatus(t,e)}deleteSelected(){let e=Array.from(this._selectedIds());e.length>0&&this.deleteContacts(e)}importFromExtraction(e,t){e.length&&(console.log("[UnifiedContacts] Importing from extraction:",e.length,"members from",t.sourceName),this.ipc.send("unified-contacts:import-members",{members:e.map(n=>({telegram_id:n.telegramId,username:n.username,first_name:n.firstName,last_name:n.lastName,display_name:n.displayName,phone:n.phone,is_bot:n.isBot,is_premium:n.isPremium,is_verified:n.isVerified,online_status:n.onlineStatus,last_seen:n.lastSeen,is_chinese:n.isChinese,activity_score:n.activityScore,value_level:n.valueLevel})),sourceType:t.sourceType,sourceName:t.sourceName,sourceId:t.sourceId}))}updateContactStatus(e,t){console.log("[UnifiedContacts] Updating single contact status:",e,t),this.updateContact(e,{status:t})}getSendTargets(){return this._contacts().filter(e=>e.contact_type==="user"&&!e.is_bot)}markAsContacted(e){this.updateStatus(e,"contacted")}getCountBySource(e){return this._contacts().filter(t=>t.source_type===e).length}getStatusColor(e){return zl.find(n=>n.value===e)?.color||"bg-gray-500"}getStatusLabel(e){return zl.find(n=>n.value===e)?.label||e}mapLeadStatus(e){return{New:"new",Contacted:"contacted",Replied:"interested",Interested:"interested","Follow-up":"negotiating",Negotiating:"negotiating","Closed-Won":"converted","Closed-Lost":"lost",Unsubscribed:"blocked"}[e]||"new"}importLeadsDirectly(e){if(console.log("[UnifiedContacts] Importing leads directly:",e.length),!e||e.length===0)return;let t=e.map((a,d)=>({id:a.id||d,telegram_id:String(a.userId||a.user_id||""),username:a.username||"",display_name:a.firstName||a.username||String(a.userId||""),first_name:a.firstName||"",last_name:a.lastName||"",phone:a.phone||"",contact_type:"user",source_type:a.sourceType==="group_extract"?"member":"lead",source_id:a.sourceChatId||a.campaignId?.toString()||"",source_name:a.sourceGroup||a.sourceChatTitle||"\u767C\u9001\u63A7\u5236\u53F0",status:this.mapLeadStatus(a.status||"New"),tags:a.tags||[],ai_score:a.aiScore||.5,activity_score:a.activityScore||.5,value_level:a.valueLevel||"C",is_online:a.onlineStatus==="Online",last_seen:a.lastSeen,is_bot:!1,is_premium:a.isPremium||!1,is_verified:a.isVerified||!1,member_count:0,message_count:(a.interactionHistory||[]).length,last_contact_at:a.lastContactAt,last_message_at:a.lastMessageAt,bio:a.bio||"",notes:a.notes||"",metadata:{},created_at:a.timestamp||new Date().toISOString(),updated_at:new Date().toISOString(),synced_at:new Date().toISOString()}));this._contacts.set(t),this._total.set(t.length);let n={},o={};t.forEach(a=>{n[a.status]=(n[a.status]||0)+1,o[a.source_type]=(o[a.source_type]||0)+1}),this._stats.set({total:t.length,users:t.length,groups:0,channels:0,by_status:n,by_source:o,recent_added:t.filter(a=>{let d=new Date(a.created_at),u=new Date;return u.setDate(u.getDate()-7),d>=u}).length}),this._isLoading.set(!1),this._isSyncing.set(!1),this._hasImportedFromLeads.set(!0),console.log("[UnifiedContacts] Imported",t.length,"contacts from leads")}resetImportState(){this._hasImportedFromLeads.set(!1)}ngOnDestroy(){}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var R4=(i,e)=>e.id;function N4(i,e){i&1&&(r(0,"div",21),l(1," \u63A8\u85A6 "),s())}function V4(i,e){i&1&&(r(0,"div",22),l(1," \u71B1\u9580 "),s())}function B4(i,e){if(i&1){let t=I();r(0,"div",20),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectProduct(o))}),y(1,N4,2,0,"div",21),y(2,V4,2,0,"div",22),r(3,"div",23)(4,"div",24),l(5),s(),r(6,"div",25),l(7),s(),r(8,"div",26)(9,"span",27),l(10),s()(),r(11,"div",28),l(12,"TRC20 \u7DB2\u7D61"),s()()()}if(i&2){let t,n,o,a=e.$implicit,d=m(3);N("border-cyan-500",((t=d.selectedProduct())==null?null:t.id)===a.id)("bg-cyan-500/10",((n=d.selectedProduct())==null?null:n.id)===a.id)("border-slate-600",((o=d.selectedProduct())==null?null:o.id)!==a.id),c(),S(a.recommended?1:-1),c(),S(a.popular?2:-1),c(3),D(a.levelName),c(2),D(a.durationName),c(3),M("",a.price," USDT")}}function L4(i,e){if(i&1){let t=I();r(0,"div",15),O(1,B4,13,11,"div",16,R4),s(),r(3,"div",17)(4,"button",18),x("click",function(){_(t);let o=m(2);return v(o.close())}),l(5," \u53D6\u6D88 "),s(),r(6,"button",19),x("click",function(){_(t);let o=m(2);return v(o.proceedToPayment())}),l(7," \u4E0B\u4E00\u6B65 "),s()()}if(i&2){let t=m(2);c(),U(t.products),c(5),L("disabled",!t.selectedProduct())}}function O4(i,e){if(i&1&&(r(0,"div",41)(1,"div",43)(2,"span"),l(3,"\u{1F48E}"),s(),r(4,"span",44),l(5,"USDT-TRC20 \u652F\u4ED8\uFF08\u63A8\u85A6\uFF09"),s()(),r(6,"div",45)(7,"div",46)(8,"div",47),l(9,"\u652F\u4ED8\u91D1\u984D"),s(),r(10,"div",48),l(11),s()(),r(12,"div",46)(13,"div",47),l(14,"\u7DB2\u7D61"),s(),r(15,"div",49),l(16,"TRC20"),s()()(),r(17,"div",50),l(18," \u26A0\uFE0F \u50C5\u652F\u6301 TRC20 \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC "),s()()),i&2){let t,n=m(3);c(11),M("",(t=n.selectedProduct())==null?null:t.price," USDT")}}function U4(i,e){if(i&1){let t=I();r(0,"div",29)(1,"div",30),l(2),s(),r(3,"div",31),l(4),s(),r(5,"div",32),l(6,"TRC20 \u7DB2\u7D61"),s()(),r(7,"div",33)(8,"label",34),l(9,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u8A02\u55AE\u901A\u77E5)"),s(),r(10,"input",35),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.email,o)||(a.email=o),v(o)}),s()(),r(11,"div",36)(12,"label",34),l(13,"\u9078\u64C7\u652F\u4ED8\u65B9\u5F0F"),s(),r(14,"div",37)(15,"button",38),x("click",function(){_(t);let o=m(2);return v(o.paymentMethod.set("alipay"))}),r(16,"span",39),l(17,"\u{1F499}"),s(),r(18,"span",40),l(19,"\u652F\u4ED8\u5BF6"),s()(),r(20,"button",38),x("click",function(){_(t);let o=m(2);return v(o.paymentMethod.set("wechat"))}),r(21,"span",39),l(22,"\u{1F49A}"),s(),r(23,"span",40),l(24,"\u5FAE\u4FE1\u652F\u4ED8"),s()(),r(25,"button",38),x("click",function(){_(t);let o=m(2);return v(o.paymentMethod.set("stripe"))}),r(26,"span",39),l(27,"\u{1F4B3}"),s(),r(28,"span",40),l(29,"\u570B\u969B\u5361"),s()(),r(30,"button",38),x("click",function(){_(t);let o=m(2);return v(o.paymentMethod.set("usdt"))}),r(31,"span",39),l(32,"\u{1F48E}"),s(),r(33,"span",40),l(34,"USDT"),s()()(),y(35,O4,19,1,"div",41),s(),r(36,"div",42)(37,"button",18),x("click",function(){_(t);let o=m(2);return v(o.step.set("select"))}),l(38," \u8FD4\u56DE "),s(),r(39,"button",19),x("click",function(){_(t);let o=m(2);return v(o.createOrder())}),l(40),s()()}if(i&2){let t,n,o=m(2);c(2),X("",(t=o.selectedProduct())==null?null:t.levelName," - ",(t=o.selectedProduct())==null?null:t.durationName),c(2),M("",(n=o.selectedProduct())==null?null:n.price," USDT"),c(6),H("ngModel",o.email),c(5),N("border-cyan-500",o.paymentMethod()==="alipay")("bg-cyan-500/10",o.paymentMethod()==="alipay")("border-slate-600",o.paymentMethod()!=="alipay"),c(5),N("border-cyan-500",o.paymentMethod()==="wechat")("bg-cyan-500/10",o.paymentMethod()==="wechat")("border-slate-600",o.paymentMethod()!=="wechat"),c(5),N("border-cyan-500",o.paymentMethod()==="stripe")("bg-cyan-500/10",o.paymentMethod()==="stripe")("border-slate-600",o.paymentMethod()!=="stripe"),c(5),N("border-cyan-500",o.paymentMethod()==="usdt")("bg-cyan-500/10",o.paymentMethod()==="usdt")("border-slate-600",o.paymentMethod()!=="usdt"),c(5),S(o.paymentMethod()==="usdt"?35:-1),c(4),L("disabled",o.isProcessing()),c(),M(" ",o.isProcessing()?"\u8655\u7406\u4E2D...":"\u7ACB\u5373\u652F\u4ED8"," ")}}function G4(i,e){if(i&1){let t=I();r(0,"div",57)(1,"div",60)(2,"div",27),l(3),s(),r(4,"div",61),l(5,"TRC20 \u7DB2\u7D61\uFF08TRON\uFF09"),s()(),r(6,"div",33)(7,"div",62),l(8,"\u6536\u6B3E\u5730\u5740\uFF08TRC20\uFF09"),s(),r(9,"div",63)(10,"div",64)(11,"code",65),l(12),s(),r(13,"button",66),x("click",function(){_(t);let o=m(3);return v(o.copyUsdtAddress())}),l(14," \u{1F4CB} \u8907\u88FD "),s()()()(),r(15,"div",67)(16,"div",68)(17,"div",39),l(18,"\u{1F4DD}"),s(),r(19,"div")(20,"div",69),l(21,"\u8F49\u8CEC\u6B65\u9A5F"),s(),r(22,"ol",70)(23,"li"),l(24,"1. \u6253\u958B\u60A8\u7684\u52A0\u5BC6\u8CA8\u5E63\u9322\u5305\uFF08\u5982 Trust Wallet\u3001TokenPocket\uFF09"),s(),r(25,"li"),l(26,"2. \u9078\u64C7 USDT \u8CC7\u7522\uFF0C\u9EDE\u64CA\u300C\u767C\u9001\u300D"),s(),r(27,"li"),l(28,"3. \u7C98\u8CBC\u4E0A\u65B9\u5730\u5740\uFF0C\u9078\u64C7 "),r(29,"span",71),l(30,"TRC20"),s(),l(31," \u7DB2\u7D61"),s(),r(32,"li"),l(33,"4. \u8F38\u5165\u91D1\u984D "),r(34,"span",71),l(35),s()(),r(36,"li"),l(37,"5. \u78BA\u8A8D\u8F49\u8CEC\uFF0C\u7B49\u5F85\u5340\u584A\u78BA\u8A8D"),s()()()()(),r(38,"div",72)(39,"span"),l(40,"\u26A0\uFE0F"),s(),r(41,"div")(42,"strong"),l(43,"\u91CD\u8981\u63D0\u9192\uFF1A"),s(),r(44,"ul",73)(45,"li"),l(46,"\u2022 \u50C5\u652F\u6301 "),r(47,"strong"),l(48,"TRC20"),s(),l(49," \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC"),s(),r(50,"li"),l(51,"\u2022 \u8ACB\u78BA\u4FDD\u8F49\u8CEC\u91D1\u984D\u6B63\u78BA\uFF1A"),r(52,"strong"),l(53),s()(),r(54,"li"),l(55,"\u2022 \u8F49\u8CEC\u5F8C\u901A\u5E38 1-5 \u5206\u9418\u5167\u5230\u8CEC"),s()()()()()}if(i&2){let t,n,o,a=m(3);c(3),M("",(t=a.selectedProduct())==null?null:t.price," USDT"),c(9),D(a.USDT_CONFIG.walletAddress),c(23),M("",(n=a.selectedProduct())==null?null:n.price," USDT"),c(18),M("",(o=a.selectedProduct())==null?null:o.price," USDT")}}function $4(i,e){if(i&1){let t=I();r(0,"div",11)(1,"div",51),l(2),s(),r(3,"h3",52),l(4,"\u7B49\u5F85\u652F\u4ED8"),s(),r(5,"p",53),l(6),s(),r(7,"div",54)(8,"div",55),l(9,"\u8A02\u55AE\u865F"),s(),r(10,"div",56),l(11),s()(),y(12,G4,56,4,"div",57),r(13,"div",58),l(14),s(),r(15,"div",42)(16,"button",18),x("click",function(){_(t);let o=m(2);return v(o.cancelPayment())}),l(17," \u53D6\u6D88\u652F\u4ED8 "),s(),r(18,"button",59),x("click",function(){_(t);let o=m(2);return v(o.checkPaymentStatus())}),l(19),s()()()}if(i&2){let t,n=m(2);c(2),D(n.paymentMethod()==="usdt"?"\u{1F48E}":"\u23F3"),c(4),M(" ",n.paymentMethod()==="usdt"?"\u8ACB\u5411\u4EE5\u4E0B\u5730\u5740\u8F49\u8CEC USDT":"\u8ACB\u5728\u65B0\u7A97\u53E3\u5B8C\u6210\u652F\u4ED8"," "),c(5),D((t=n.currentOrder())==null?null:t.order_id),c(),S(n.paymentMethod()==="usdt"?12:-1),c(2),M(" ",n.paymentMethod()==="usdt"?"\u8F49\u8CEC\u6210\u529F\u5F8C\u9EDE\u64CA\u300C\u6211\u5DF2\u652F\u4ED8\u300D":"\u652F\u4ED8\u5B8C\u6210\u5F8C\u5C07\u81EA\u52D5\u6FC0\u6D3B\u6703\u54E1"," "),c(4),L("disabled",n.isChecking()),c(),M(" ",n.isChecking()?"\u6AA2\u67E5\u4E2D...":"\u6211\u5DF2\u652F\u4ED8"," ")}}function H4(i,e){if(i&1){let t=I();r(0,"div",74)(1,"div",55),l(2,"\u60A8\u7684\u5361\u5BC6"),s(),r(3,"div",56),l(4),s(),r(5,"button",76),x("click",function(){_(t);let o=m(3);return v(o.copyLicenseKey())}),l(6," \u{1F4CB} \u8907\u88FD\u5361\u5BC6 "),s()()}if(i&2){let t=m(3);c(4),D(t.activatedLicenseKey())}}function q4(i,e){if(i&1){let t=I();r(0,"div",11)(1,"div",51),l(2,"\u{1F389}"),s(),r(3,"h3",52),l(4,"\u652F\u4ED8\u6210\u529F\uFF01"),s(),r(5,"p",53),l(6,"\u60A8\u7684\u6703\u54E1\u5DF2\u6FC0\u6D3B"),s(),y(7,H4,7,1,"div",74),r(8,"button",75),x("click",function(){_(t);let o=m(2);return v(o.close())}),l(9," \u958B\u59CB\u4F7F\u7528 "),s()()}if(i&2){let t=m(2);c(7),S(t.activatedLicenseKey()?7:-1)}}function W4(i,e){if(i&1){let t=I();r(0,"div",1),x("click",function(){_(t);let o=m();return v(o.close())}),r(1,"div",2),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),l(6," \u{1F4B3} \u5347\u7D1A\u6703\u54E1 "),s(),r(7,"p",6),l(8,"\u9078\u64C7\u9069\u5408\u60A8\u7684\u65B9\u6848"),s()(),r(9,"button",7),x("click",function(){_(t);let o=m();return v(o.close())}),ne(),r(10,"svg",8),B(11,"path",9),s()()()(),ce(),r(12,"div",10),y(13,L4,8,1),y(14,U4,41,31),y(15,$4,20,7,"div",11),y(16,q4,10,1,"div",11),r(17,"div",12)(18,"p",13),l(19," \u9047\u5230\u554F\u984C\uFF1F "),r(20,"a",14),l(21,"\u806F\u7E6B\u5BA2\u670D"),s(),l(22," \u6216 "),r(23,"a",14),l(24,"\u67E5\u770B\u5E6B\u52A9"),s()()()()()()}if(i&2){let t=m();c(13),S(t.step()==="select"?13:-1),c(),S(t.step()==="payment"?14:-1),c(),S(t.step()==="pending"?15:-1),c(),S(t.step()==="success"?16:-1)}}var Kl=class i{constructor(){this.licenseClient=F(ui);this.membershipService=F(Ie);this.toastService=F(J);this.show=f(!1);this.step=f("select");this.products=this.licenseClient.products;this.selectedProduct=f(null);this.paymentMethod=f("usdt");this.USDT_CONFIG={network:"TRC20",walletAddress:"TYourTRC20WalletAddressHere",minAmount:1};this.email="";this.isProcessing=f(!1);this.isChecking=f(!1);this.currentOrder=f(null);this.activatedLicenseKey=f(null);this.checkInterval=null;window.addEventListener("open-payment-dialog",()=>{this.open()})}ngOnDestroy(){this.stopCheckInterval()}open(){this.show.set(!0),this.step.set("select"),this.selectedProduct.set(null),this.currentOrder.set(null),this.activatedLicenseKey.set(null)}close(){this.show.set(!1),this.stopCheckInterval()}selectProduct(e){this.selectedProduct.set(e)}proceedToPayment(){this.selectedProduct()&&this.step.set("payment")}async createOrder(){let e=this.selectedProduct();if(e){this.isProcessing.set(!0);try{let t=await this.licenseClient.createPayment(e.id,this.paymentMethod());t.success&&t.order?(this.currentOrder.set(t.order),this.step.set("pending"),window.open(t.order.payment_url,"_blank"),this.startCheckInterval()):this.toastService.error(t.message)}catch{this.toastService.error("\u5275\u5EFA\u8A02\u55AE\u5931\u6557")}finally{this.isProcessing.set(!1)}}}async checkPaymentStatus(){let e=this.currentOrder();if(e){this.isChecking.set(!0);try{let t=await this.licenseClient.checkPaymentStatus(e.orderId);t.paid?(this.stopCheckInterval(),this.activatedLicenseKey.set(t.licenseKey||null),this.step.set("success"),this.toastService.success("\u{1F389} \u652F\u4ED8\u6210\u529F\uFF0C\u6703\u54E1\u5DF2\u6FC0\u6D3B\uFF01"),t.licenseKey&&await this.membershipService.activateMembership(t.licenseKey,this.email)):this.toastService.info("\u652F\u4ED8\u5C1A\u672A\u5B8C\u6210\uFF0C\u8ACB\u7E7C\u7E8C\u652F\u4ED8")}catch{this.toastService.error("\u6AA2\u67E5\u652F\u4ED8\u72C0\u614B\u5931\u6557")}finally{this.isChecking.set(!1)}}}cancelPayment(){this.stopCheckInterval(),this.step.set("select"),this.currentOrder.set(null)}copyLicenseKey(){let e=this.activatedLicenseKey();e&&(navigator.clipboard.writeText(e),this.toastService.success("\u5361\u5BC6\u5DF2\u8907\u88FD"))}copyUsdtAddress(){navigator.clipboard.writeText(this.USDT_CONFIG.walletAddress),this.toastService.success("USDT TRC20 \u5730\u5740\u5DF2\u8907\u88FD")}startCheckInterval(){this.checkInterval=setInterval(()=>{this.checkPaymentStatus()},5e3)}stopCheckInterval(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-payment"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-gradient-to-br","from-slate-900","to-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","via-purple-500","to-pink-500","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-2"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2","rounded-full","hover:bg-white/10",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[70vh]"],[1,"text-center","py-8"],[1,"mt-6","pt-4","border-t","border-slate-700","text-center"],[1,"text-sm","text-slate-500"],["href","#",1,"text-cyan-400","hover:underline"],[1,"grid","grid-cols-2","gap-4"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"border-cyan-500","bg-cyan-500/10","border-slate-600"],[1,"mt-6","flex","gap-4"],[1,"flex-1","py-3","rounded-xl","bg-slate-700","text-slate-300","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"click"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-pink-500","to-purple-500","text-white","text-xs","px-3","py-1","rounded-full","font-medium"],[1,"absolute","-top-3","right-2","bg-orange-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-slate-400"],[1,"mt-2"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-center","mb-6"],[1,"text-lg","text-slate-300"],[1,"text-4xl","font-bold","text-emerald-400","mt-2"],[1,"text-sm","text-slate-500","mt-1"],[1,"mb-4"],[1,"block","text-sm","text-slate-400","mb-2"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"space-y-3","mb-6"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","justify-center","gap-2","p-4","rounded-xl","border-2","transition-all",3,"click"],[1,"text-2xl"],[1,"text-white","font-medium"],[1,"mt-3","p-4","bg-emerald-500/10","border","border-emerald-500/30","rounded-lg"],[1,"flex","gap-4"],[1,"flex","items-center","gap-2","text-emerald-400","text-sm","mb-3"],[1,"font-medium"],[1,"flex","items-center","gap-3","mb-3"],[1,"flex-1","p-2","bg-slate-800","rounded-lg"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-2"],[1,"text-6xl","mb-4"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-4"],[1,"bg-slate-700/50","rounded-xl","p-4","mb-4"],[1,"text-sm","text-slate-400"],[1,"text-lg","font-mono","text-cyan-400"],[1,"bg-emerald-500/10","border","border-emerald-500/30","rounded-xl","p-5","mb-4","text-left"],[1,"text-sm","text-slate-500","mb-6"],[1,"flex-1","py-3","rounded-xl","bg-cyan-500","text-white","font-bold","hover:bg-cyan-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-center","mb-4"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-xs","text-slate-400","mb-2"],[1,"bg-slate-800","rounded-lg","p-3"],[1,"flex","items-center","justify-between","gap-2"],[1,"text-sm","text-emerald-400","break-all","font-mono"],[1,"flex-shrink-0","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","px-3","py-1.5","rounded-lg","text-sm","transition-colors",3,"click"],[1,"bg-slate-800/50","rounded-lg","p-3","mb-4"],[1,"flex","items-start","gap-3"],[1,"text-sm","text-white","font-medium","mb-1"],[1,"text-xs","text-slate-400","space-y-1"],[1,"text-emerald-400","font-medium"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-3","flex","items-start","gap-2"],[1,"mt-1","space-y-0.5"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-500/20","rounded-xl","p-4","mb-6"],[1,"w-full","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity",3,"click"],[1,"mt-2","text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(t,n){t&1&&y(0,W4,25,4,"div",0),t&2&&S(n.show()?0:-1)},dependencies:[oe,ae,xe,ve,he],encapsulation:2})}};var mm="TG-AI\u667A\u63A7\u738B-2026-Secure-Key",jl=class i{constructor(){this._isSecure=f(!0);this.isSecure=this._isSecure.asReadonly();this.initSecurityChecks()}initSecurityChecks(){this.isProduction()&&(this.detectDevTools(),this.preventContextMenu(),this.preventKeyboardShortcuts())}isProduction(){return!window.location.href.includes("localhost")&&!window.location.href.includes("127.0.0.1")}detectDevTools(){setInterval(()=>{let n=window.outerWidth-window.innerWidth>160,o=window.outerHeight-window.innerHeight>160;n||o?(this._isSecure.set(!1),console.clear(),console.log("%c\u26A0\uFE0F \u6AA2\u6E2C\u5230\u958B\u767C\u8005\u5DE5\u5177","color: red; font-size: 20px;")):this._isSecure.set(!0)},1e3),setInterval(()=>{let n=performance.now();performance.now()-n>100&&this._isSecure.set(!1)},5e3)}preventContextMenu(){document.addEventListener("contextmenu",e=>(e.preventDefault(),!1))}preventKeyboardShortcuts(){document.addEventListener("keydown",e=>e.key==="F12"||e.ctrlKey&&e.shiftKey&&e.key==="I"||e.ctrlKey&&e.shiftKey&&e.key==="J"||e.ctrlKey&&e.key==="u"?(e.preventDefault(),!1):!0)}encrypt(e){if(!e)return"";try{let t=btoa(unescape(encodeURIComponent(e)));return"ENC:"+this.shuffle(t,mm)}catch(t){return console.error("Encryption failed:",t),e}}decrypt(e){if(!e)return"";if(!e.startsWith("ENC:"))return e;try{let t=e.substring(4),n=this.unshuffle(t,mm);return decodeURIComponent(escape(atob(n)))}catch(t){return console.error("Decryption failed:",t),""}}shuffle(e,t){let o=t.split("").reduce((a,d)=>a+d.charCodeAt(0),0)%26;return e.split("").map(a=>{let d=a.charCodeAt(0);return d>=65&&d<=90?String.fromCharCode((d-65+o)%26+65):d>=97&&d<=122?String.fromCharCode((d-97+o)%26+97):a}).join("")}unshuffle(e,t){let o=t.split("").reduce((a,d)=>a+d.charCodeAt(0),0)%26;return e.split("").map(a=>{let d=a.charCodeAt(0);return d>=65&&d<=90?String.fromCharCode((d-65-o+26)%26+65):d>=97&&d<=122?String.fromCharCode((d-97-o+26)%26+97):a}).join("")}secureStore(e,t){let n=this.encrypt(JSON.stringify(t));localStorage.setItem(e,n)}secureRetrieve(e,t){let n=localStorage.getItem(e);if(!n)return t;try{let o=this.decrypt(n);return JSON.parse(o)}catch{return t}}secureRemove(e){localStorage.removeItem(e)}storeApiKey(e,t){this.secureStore(`api_${e}`,t)}getApiKey(e){return this.secureRetrieve(`api_${e}`,"")}removeApiKey(e){this.secureRemove(`api_${e}`)}generateFingerprint(){let t=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||"unknown",navigator.deviceMemory||"unknown"].join("|");return this.hashString(t)}hashString(e){let t=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);t=(t<<5)-t+o,t=t&t}return"fp-"+Math.abs(t).toString(16)}signRequest(e,t){let n=JSON.stringify(e)+t+mm;return this.hashString(n)}verifySignature(e,t,n){let o=Date.now();return Math.abs(o-t)>300*1e3?!1:this.signRequest(e,t)===n}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Jl=class i{constructor(){this.tasks=f(new Map);this.connectionState=f({stage:"connecting",progress:0,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()});this.showConnectionStatus=f(!0);this.isLoading=R(()=>{let e=this.tasks();for(let t of e.values())if(t.blocking!==!1)return!0;return!1});this.currentTask=R(()=>{let e=this.tasks();if(e.size===0)return null;let t=Array.from(e.values());return t[t.length-1]});this.message=R(()=>this.currentTask()?.message||"");this.progress=R(()=>this.currentTask()?.progress);this.taskCount=R(()=>this.tasks().size);this.connectionProgressTimer=null}start(e="\u8F09\u5165\u4E2D...",t){let n=t||this.generateId();return this.tasks.update(o=>{let a=new Map(o);return a.set(n,{id:n,message:e,startTime:Date.now(),type:"spinner"}),a}),n}startWithProgress(e,t){let n=t||this.generateId();return this.tasks.update(o=>{let a=new Map(o);return a.set(n,{id:n,message:e,progress:0,startTime:Date.now(),type:"progress"}),a}),n}updateProgress(e,t,n){this.tasks.update(o=>{let a=new Map(o),d=a.get(e);return d&&a.set(e,P(E({},d),{progress:Math.min(100,Math.max(0,t)),message:n||d.message})),a})}updateMessage(e,t){this.tasks.update(n=>{let o=new Map(n),a=o.get(e);return a&&o.set(e,P(E({},a),{message:t})),o})}stop(e){this.tasks.update(t=>{let n=new Map(t);return n.delete(e),n})}stopAll(){this.tasks.set(new Map)}async wrap(e,t="\u8F09\u5165\u4E2D..."){let n=this.start(t);try{return await e}finally{this.stop(n)}}async wrapWithProgress(e,t="\u8655\u7406\u4E2D..."){let n=this.startWithProgress(t);try{return await e((a,d)=>{this.updateProgress(n,a,d)})}finally{this.stop(n)}}generateId(){return"load-"+Date.now().toString(36)+Math.random().toString(36).substr(2,5)}startConnection(){this.showConnectionStatus.set(!0),this.connectionState.set({stage:"connecting",progress:5,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()}),this.simulateConnectionProgress()}simulateConnectionProgress(){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=setInterval(()=>{let e=this.connectionState();e.stage==="connecting"&&e.progress<25?this.connectionState.update(t=>P(E({},t),{progress:Math.min(25,t.progress+2)})):e.stage==="loading-data"&&e.progress<75&&this.connectionState.update(t=>P(E({},t),{progress:Math.min(75,t.progress+1)}))},200)}updateConnectionStage(e,t){let n={connecting:10,"loading-data":40,initializing:70,ready:100,error:0};this.connectionState.update(o=>P(E({},o),{stage:e,progress:n[e],message:t||this.getStageMessage(e)})),(e==="ready"||e==="error")&&(this.connectionProgressTimer&&(clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=null),e==="ready"&&setTimeout(()=>{this.showConnectionStatus.set(!1)},500))}connectionError(e){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionState.set({stage:"error",progress:0,message:"\u9023\u63A5\u5931\u6557",startTime:Date.now(),error:e})}hideConnectionStatus(){this.showConnectionStatus.set(!1)}getStageMessage(e){switch(e){case"connecting":return"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...";case"loading-data":return"\u6B63\u5728\u8F09\u5165\u6578\u64DA...";case"initializing":return"\u6B63\u5728\u521D\u59CB\u5316...";case"ready":return"\u9023\u63A5\u6210\u529F";case"error":return"\u9023\u63A5\u5931\u6557"}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var z4=(i,e)=>e.id;function K4(i,e){if(i&1&&Se(0,"div",22),i&2){let t=m(2);ee("left",t.highlightRect().left-8,"px")("top",t.highlightRect().top-8,"px")("width",t.highlightRect().width+16,"px")("height",t.highlightRect().height+16,"px")}}function j4(i,e){if(i&1){let t=I();T(0,"div",23),se("click",function(){let o=_(t).$index,a=m(2);return v(a.goToStep(o))}),k()}if(i&2){let t=e.$index,n=m(2);N("bg-gradient-to-r",t<=n.currentIndex())("from-cyan-500",t<=n.currentIndex())("to-blue-500",t<=n.currentIndex())("bg-slate-700",t>n.currentIndex())}}function J4(i,e){if(i&1&&(T(0,"li",30)(1,"span",31),l(2,"\u2713"),k(),T(3,"span"),l(4),k()()),i&2){let t=e.$implicit;c(4),D(t)}}function Q4(i,e){if(i&1&&(T(0,"div",27)(1,"ul",29),O(2,J4,5,1,"li",30,be),k()()),i&2){let t=m();c(2),U(t.tips)}}function Y4(i,e){if(i&1){let t=I();T(0,"button",32),se("click",function(){_(t);let o=m(),a=m(2);return v(a.handleAction(o.actionTarget))}),l(1),k()}if(i&2){let t=m();c(),M(" ",t.actionLabel," \u2192 ")}}function X4(i,e){if(i&1&&(T(0,"div",11)(1,"div",24),l(2),k(),T(3,"h2",25),l(4),k(),T(5,"p",26),l(6),k(),y(7,Q4,4,0,"div",27),y(8,Y4,2,1,"button",28),k()),i&2){let t=e;c(2),M(" ",t.icon," "),c(2),M(" ",t.title," "),c(2),M(" ",t.description," "),c(),S(t.tips&&t.tips.length>0?7:-1),c(),S(t.actionLabel&&t.actionTarget?8:-1)}}function Z4(i,e){if(i&1){let t=I();T(0,"button",33),se("click",function(){_(t);let o=m(2);return v(o.next())}),l(1," \u4E0B\u4E00\u6B65 \u2192 "),k()}}function eD(i,e){if(i&1){let t=I();T(0,"button",34),se("click",function(){_(t);let o=m(2);return v(o.complete())}),l(1," \u5F00\u59CB\u4F7F\u7528 \u{1F680} "),k()}}function tD(i,e){if(i&1){let t=I();T(0,"div",1),se("click",function(o){_(t);let a=m();return v(a.onBackdropClick(o))}),Se(1,"div",2),y(2,K4,1,8,"div",3),T(3,"div",4),se("click",function(o){return _(t),v(o.stopPropagation())}),T(4,"div",5)(5,"div",6),O(6,j4,1,8,"div",7,z4),k(),T(8,"div",8)(9,"span"),l(10),k(),T(11,"button",9),se("click",function(){_(t);let o=m();return v(o.skipAll())}),l(12," \u8DF3\u8FC7\u5F15\u5BFC "),k()()(),T(13,"div",10),y(14,X4,9,5,"div",11),k(),T(15,"div",12)(16,"div",13)(17,"label",14)(18,"input",15),se("change",function(){_(t);let o=m();return v(o.toggleNeverShow())}),k(),T(19,"span"),l(20,"\u4EE5\u540E\u4E0D\u518D\u63D0\u793A"),k()()(),T(21,"div",16)(22,"button",17),se("click",function(){_(t);let o=m();return v(o.previous())}),l(23," \u2190 \u4E0A\u4E00\u6B65 "),k(),y(24,Z4,2,0,"button",18)(25,eD,2,0,"button",19),k()(),T(26,"div",20),l(27," \u6309 "),T(28,"kbd",21),l(29,"\u2190"),k(),T(30,"kbd",21),l(31,"\u2192"),k(),l(32," \u5BFC\u822A \xB7 "),T(33,"kbd",21),l(34,"ESC"),k(),l(35," \u5173\u95ED "),k()()()}if(i&2){let t,n,o=m();c(2),S((t=o.currentStep())!=null&&t.targetSelector&&o.highlightRect()?2:-1),c(4),U(o.steps),c(4),X("\u6B65\u9AA4 ",o.currentIndex()+1," / ",o.steps.length),c(4),S((n=o.currentStep())?14:-1,n),c(4),Ke("checked",o.neverShowAgain()),c(4),Ke("disabled",o.currentIndex()===0),c(2),S(o.currentIndex()<o.steps.length-1?24:25)}}function nD(i,e){if(i&1){let t=I();T(0,"div",1),Se(1,"div",2),T(2,"div",3),Se(3,"div",4),T(4,"h4",5),l(5),k(),T(6,"p",6),l(7),k(),T(8,"button",7),se("click",function(){_(t);let o=m();return v(o.dismiss())}),l(9,"\u77E5\u9053\u4E86"),k()()()}if(i&2){let t=m();ee("top",t.position.top,"px")("left",t.position.left,"px"),c(5),D(t.title),c(2),D(t.description)}}var pm="tg-ai-onboarding",Ho="tg-ai-onboarding-never-show",Ql=class i{constructor(){this.show=f(!1);this.currentIndex=f(0);this.neverShowAgain=f(!1);this.highlightRect=f(null);this.navigateEvent=ge();this.steps=[{id:"welcome",title:"\u6B22\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B",description:"\u667A\u80FD Telegram \u8425\u9500\u7CFB\u7EDF\uFF0C\u5E2E\u52A9\u60A8\u9AD8\u6548\u83B7\u5BA2\u3001\u81EA\u52A8\u5316\u8FD0\u8425",icon:"\u{1F389}",position:"center",tips:["\u652F\u6301\u591A\u8D26\u53F7\u7BA1\u7406\u548C\u534F\u4F5C","AI \u667A\u80FD\u8425\u9500\u548C\u81EA\u52A8\u56DE\u590D","\u7FA4\u7EC4\u641C\u7D22\u548C\u8D44\u6E90\u7BA1\u7406"]},{id:"add-account",title:"\u7B2C\u4E00\u6B65\uFF1A\u6DFB\u52A0\u8D26\u53F7",description:"\u7ED1\u5B9A\u60A8\u7684 Telegram \u8D26\u53F7\uFF0C\u8FD9\u662F\u4F7F\u7528\u6240\u6709\u529F\u80FD\u7684\u524D\u63D0",icon:"\u{1F4F1}",targetSelector:'[data-tour="accounts"]',position:"right",tips:["\u652F\u6301\u624B\u673A\u53F7\u9A8C\u8BC1\u767B\u5F55","\u53EF\u6DFB\u52A0\u591A\u4E2A\u8D26\u53F7\u540C\u65F6\u8FD0\u8425","\u5EFA\u8BAE\u4F7F\u7528\u72EC\u7ACB\u8425\u9500\u53F7"],actionLabel:"\u53BB\u6DFB\u52A0\u8D26\u53F7",actionTarget:"accounts"},{id:"search-discovery",title:"\u7B2C\u4E8C\u6B65\uFF1A\u641C\u7D22\u53D1\u73B0",description:"\u641C\u7D22\u76EE\u6807\u7FA4\u7EC4\u548C\u9891\u9053\uFF0C\u53D1\u73B0\u6F5C\u5728\u5BA2\u6237\u8D44\u6E90",icon:"\u{1F50D}",targetSelector:'[data-tour="search-discovery"]',position:"right",tips:["\u652F\u6301\u591A\u6E20\u9053\u641C\u7D22\uFF08\u5B98\u65B9/\u4E2D\u6587\u641C\u7D22\uFF09","\u4E00\u952E\u52A0\u5165\u76EE\u6807\u7FA4\u7EC4","\u6536\u85CF\u548C\u7BA1\u7406\u641C\u7D22\u7ED3\u679C"],actionLabel:"\u53BB\u641C\u7D22\u53D1\u73B0",actionTarget:"search-discovery"},{id:"ai-marketing",title:"\u7B2C\u4E09\u6B65\uFF1AAI \u667A\u80FD\u8425\u9500",description:"\u8BA9 AI \u5E2E\u60A8\u5236\u5B9A\u8425\u9500\u7B56\u7565\uFF0C\u81EA\u52A8\u6267\u884C\u8425\u9500\u4EFB\u52A1",icon:"\u{1F916}",targetSelector:'[data-tour="ai-assistant"]',position:"right",tips:["AI \u4E00\u952E\u751F\u6210\u8425\u9500\u7B56\u7565","\u81EA\u52A8\u5316\u6267\u884C\u548C\u8DDF\u8FDB","\u6570\u636E\u5206\u6790\u548C\u6548\u679C\u8FFD\u8E2A"],actionLabel:"\u4F53\u9A8C AI \u8425\u9500",actionTarget:"ai-assistant"},{id:"complete",title:"\u51C6\u5907\u5C31\u7EEA\uFF01",description:"\u60A8\u5DF2\u4E86\u89E3\u6838\u5FC3\u529F\u80FD\uFF0C\u73B0\u5728\u53EF\u4EE5\u5F00\u59CB\u60A8\u7684\u8425\u9500\u4E4B\u65C5\u4E86",icon:"\u{1F680}",position:"center",tips:["\u4EEA\u8868\u76D8\u67E5\u770B\u6574\u4F53\u6570\u636E","\u6709\u95EE\u9898\u968F\u65F6\u70B9\u51FB\u53F3\u4E0A\u89D2 \u2753 \u5E2E\u52A9","\u795D\u60A8\u8425\u9500\u987A\u5229\uFF01"]}];this.currentStep=R(()=>this.steps[this.currentIndex()])}ngOnInit(){this.checkFirstRun(),this.loadNeverShowSetting()}handleKeydown(e){if(this.show())switch(e.key){case"Escape":this.skipAll();break;case"ArrowRight":case"Enter":this.currentIndex()<this.steps.length-1?this.next():this.complete();break;case"ArrowLeft":this.previous();break}}checkFirstRun(){let e=localStorage.getItem(pm);localStorage.getItem(Ho)!=="true"&&(e||setTimeout(()=>this.show.set(!0),800))}loadNeverShowSetting(){let e=localStorage.getItem(Ho);this.neverShowAgain.set(e==="true")}toggleNeverShow(){let e=!this.neverShowAgain();this.neverShowAgain.set(e),localStorage.setItem(Ho,String(e))}open(){this.currentIndex.set(0),this.show.set(!0),this.updateHighlight()}close(){this.show.set(!1),this.highlightRect.set(null)}next(){this.currentIndex()<this.steps.length-1&&(this.currentIndex.update(e=>e+1),this.updateHighlight())}previous(){this.currentIndex()>0&&(this.currentIndex.update(e=>e-1),this.updateHighlight())}goToStep(e){e>=0&&e<this.steps.length&&(this.currentIndex.set(e),this.updateHighlight())}skipAll(){this.markAsCompleted(),this.close()}complete(){this.markAsCompleted(),this.close()}markAsCompleted(){localStorage.setItem(pm,new Date().toISOString()),this.neverShowAgain()&&localStorage.setItem(Ho,"true")}handleAction(e){this.navigateEvent.emit(e),this.next()}onBackdropClick(e){}updateHighlight(){let e=this.currentStep();e?.targetSelector?setTimeout(()=>{let t=document.querySelector(e.targetSelector);t?(this.highlightRect.set(t.getBoundingClientRect()),t.scrollIntoView({behavior:"smooth",block:"center"})):this.highlightRect.set(null)},100):this.highlightRect.set(null)}reset(){localStorage.removeItem(pm),localStorage.removeItem(Ho),this.neverShowAgain.set(!1),this.currentIndex.set(0)}shouldShowOnboarding(){return localStorage.getItem(Ho)!=="true"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-onboarding"]],hostBindings:function(t,n){t&1&&x("keydown",function(a){return n.handleKeydown(a)},Jm)},outputs:{navigateEvent:"navigateEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center"],[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center",3,"click"],[1,"absolute","inset-0","bg-black/80","backdrop-blur-sm"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none",3,"left","top","width","height"],[1,"relative","w-full","max-w-lg","mx-4","sm:mx-auto","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","rounded-2xl","sm:rounded-3xl","shadow-2xl","border","border-slate-600/50","overflow-hidden",3,"click"],[1,"px-4","sm:px-6","pt-4","sm:pt-5"],[1,"flex","items-center","gap-1.5","sm:gap-2"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"bg-gradient-to-r","from-cyan-500","to-blue-500","bg-slate-700"],[1,"flex","justify-between","items-center","mt-2","text-xs","text-slate-500"],[1,"hover:text-slate-300","transition-colors","px-2","py-1","-mr-2",3,"click"],[1,"p-4","sm:p-6"],[1,"text-center"],[1,"px-4","sm:px-6","pb-4","sm:pb-5"],[1,"flex","items-center","justify-center","mb-4"],[1,"flex","items-center","gap-2","cursor-pointer","text-sm","text-slate-500","hover:text-slate-400","transition-colors"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-cyan-500","focus:ring-cyan-500/50",3,"change","checked"],[1,"flex","justify-between","gap-3"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-slate-700/80","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-40","disabled:cursor-not-allowed","text-sm","sm:text-base",3,"click","disabled"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25"],[1,"hidden","sm:block","px-6","pb-4","text-center","text-xs","text-slate-600"],[1,"px-1.5","py-0.5","bg-slate-700","rounded","text-slate-400"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"click"],[1,"text-5xl","sm:text-6xl","mb-4","sm:mb-5","animate-bounce-slow"],[1,"text-xl","sm:text-2xl","font-bold","text-white","mb-2","sm:mb-3"],[1,"text-slate-300","text-sm","sm:text-base","mb-4","sm:mb-5","max-w-sm","mx-auto","leading-relaxed"],[1,"bg-slate-800/60","rounded-xl","p-3","sm:p-4","mb-4","sm:mb-5","text-left","max-w-sm","mx-auto","border","border-slate-700/50"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25"],[1,"space-y-2"],[1,"flex","items-start","gap-2","text-slate-400","text-sm"],[1,"text-cyan-400","mt-0.5","flex-shrink-0"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25",3,"click"]],template:function(t,n){t&1&&y(0,tD,36,7,"div",0),t&2&&S(n.show()?0:-1)},dependencies:[oe,ae],styles:["@keyframes _ngcontent-%COMP%_bounce-slow{0%,to{transform:translateY(0)}50%{transform:translateY(-8px)}}.animate-bounce-slow[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-slow 2s ease-in-out infinite}"]})}},k_=class i{constructor(){this.show=f(!1);this.title="";this.description="";this.position={top:0,left:0}}highlight(e,t,n){let o=e.getBoundingClientRect();this.position={top:o.top,left:o.left},this.title=t,this.description=n,this.show.set(!0)}dismiss(){this.show.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-feature-highlight"]],decls:1,vars:1,consts:[[1,"fixed","z-[9998]",3,"top","left"],[1,"fixed","z-[9998]"],[1,"absolute","-inset-2","bg-cyan-500/20","rounded-xl","animate-pulse"],[1,"absolute","top-full","left-1/2","-translate-x-1/2","mt-4","w-64","bg-slate-800","rounded-xl","shadow-xl","border","border-slate-600","p-4","z-10"],[1,"absolute","-top-2","left-1/2","-translate-x-1/2","w-4","h-4","bg-slate-800","border-l","border-t","border-slate-600","rotate-45"],[1,"font-bold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(t,n){t&1&&y(0,nD,10,6,"div",0),t&2&&S(n.show()?0:-1)},dependencies:[oe],encapsulation:2})}};var ni=[{code:"en",name:"English",nativeName:"English",flag:"\u{1F1FA}\u{1F1F8}"},{code:"zh-CN",name:"Simplified Chinese",nativeName:"\u7B80\u4F53\u4E2D\u6587",flag:"\u{1F1E8}\u{1F1F3}"},{code:"zh-TW",name:"Traditional Chinese",nativeName:"\u7E41\u9AD4\u4E2D\u6587",flag:"\u{1F1F9}\u{1F1FC}"}],Be=class i{constructor(){this._locale=f("zh-TW");this.locale=this._locale.asReadonly();this.translations=f({en:{},"zh-CN":{},"zh-TW":{}});this._loading=f(!1);this.loading=this._loading.asReadonly();this.currentLocaleInfo=R(()=>ni.find(e=>e.code===this._locale())||ni[2]);this.supportedLocales=ni;this.initLocale(),this.loadTranslations(),gt(()=>{let e=this._locale();localStorage.setItem("tg-matrix-locale",e),document.documentElement.lang=e})}initLocale(){let e=localStorage.getItem("tg-matrix-locale");if(e&&ni.some(n=>n.code===e)){this._locale.set(e);return}let t=navigator.language;t.startsWith("zh")?t==="zh-CN"||t==="zh-Hans"?this._locale.set("zh-CN"):this._locale.set("zh-TW"):this._locale.set("en")}async loadTranslations(){this._loading.set(!0);try{let e=["en","zh-CN","zh-TW"],t={en:{},"zh-CN":{},"zh-TW":{}};await Promise.all(e.map(async n=>{try{let o=await fetch(`/assets/i18n/${n}.json`);o.ok?t[n]=await o.json():(console.warn(`Failed to load ${n}.json: ${o.status}`),t[n]=this.getFallbackTranslations(n))}catch(o){console.warn(`Error loading ${n}.json:`,o),t[n]=this.getFallbackTranslations(n)}})),this.translations.set(t)}catch(e){console.error("Failed to load translations:",e)}finally{this._loading.set(!1)}}setLocale(e){ni.some(t=>t.code===e)&&this._locale.set(e)}t(e,t){let n=this._locale(),o=this.translations(),a=o[n]||{},d;if(d=this.getNestedValue(a,e),typeof d=="string")return this.interpolate(d,t);let u=this.getFlatKeyMapping(e);if(u&&(d=this.getNestedValue(a,u),typeof d=="string"))return this.interpolate(d,t);if(n!=="zh-TW"){if(d=this.getNestedValue(o["zh-TW"],e),typeof d=="string")return this.interpolate(d,t);if(u&&(d=this.getNestedValue(o["zh-TW"],u),typeof d=="string"))return this.interpolate(d,t)}return e}interpolate(e,t){if(!t)return e;let n=e;return Object.entries(t).forEach(([o,a])=>{n=n.replace(new RegExp(`{{${o}}}`,"g"),String(a))}),n}getFlatKeyMapping(e){return{dashboard:"menu.dashboard",accounts:"menu.accounts",automation:"menu.automation",leads:"menu.leads",analytics:"menu.analytics",logs:"menu.logs",performance:"menu.performance",alerts:"menu.alerts",settings:"menu.settings",aiCenter:"menu.aiCenter",resourceDiscoveryMenu:"menu.resourceDiscovery",monitoringCenter:"menu.monitoringCenter",resourceManagement:"menu.resourceManagement",marketingAutomation:"menu.marketingAutomation",aiIntelligence:"menu.aiIntelligence",systemMonitor:"menu.systemMonitor",save:"common.save",cancel:"common.cancel",delete:"common.delete",edit:"common.edit",add:"common.add",close:"common.close",confirm:"common.confirm",search:"common.search",loading:"common.loading",success:"common.success",error:"common.error",warning:"common.warning",refresh:"common.refresh",start:"common.start",stop:"common.stop",active:"common.active",inactive:"common.inactive",totalAccounts:"dashboard.totalAccounts",onlineAccounts:"dashboard.onlineAccounts",leadsToday:"dashboard.leadsToday",messagesSentToday:"dashboard.messagesSentToday",systemControl:"dashboard.systemControl",monitoringStatus:"dashboard.monitoringStatus",recentLogs:"dashboard.recentLogs",recentLeads:"dashboard.recentLeads",addNewAccount:"accounts.addNewAccount",phoneNumber:"accounts.phoneNumber",apiId:"accounts.apiId",apiHash:"accounts.apiHash",proxy:"accounts.proxy",login:"accounts.login",importSession:"accounts.importSession",exportSession:"accounts.exportSession",health:"accounts.health",group:"accounts.group",role:"accounts.role",appearance:"settings.appearance",language:"settings.language",light:"settings.light",dark:"settings.dark",Online:"status.Online",Offline:"status.Offline",Recently:"status.Recently",Unknown:"status.Unknown",Listener:"status.Listener",Sender:"status.Sender",Banned:"status.Banned",Unassigned:"status.Unassigned"}[e]}getNestedValue(e,t){if(!(!t||typeof t!="string"))return t.split(".").reduce((n,o)=>n?.[o],e)}getFallbackTranslations(e){return{en:{app:{title:"TG-AI\u667A\u63A7\u738B",subtitle:"AI Smart Marketing System"},common:{loading:"Loading...",error:"Error",success:"Success"},menu:{dashboard:"Dashboard",accounts:"Accounts",settings:"Settings"}},"zh-CN":{app:{title:"TG-AI\u667A\u63A7\u738B",subtitle:"AI \u667A\u80FD\u8425\u9500\u7CFB\u7EDF"},common:{loading:"\u52A0\u8F7D\u4E2D...",error:"\u9519\u8BEF",success:"\u6210\u529F"},menu:{dashboard:"\u4EEA\u8868\u76D8",accounts:"\u8D26\u53F7\u7BA1\u7406",settings:"\u8BBE\u7F6E"}},"zh-TW":{app:{title:"TG-AI\u667A\u63A7\u738B",subtitle:"AI \u667A\u80FD\u884C\u92B7\u7CFB\u7D71"},common:{loading:"\u8F09\u5165\u4E2D...",error:"\u932F\u8AA4",success:"\u6210\u529F"},menu:{dashboard:"\u5100\u8868\u677F",accounts:"\u5E33\u865F\u7BA1\u7406",settings:"\u8A2D\u5B9A"}}}[e]}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var iD=(i,e)=>e.code;function oD(i,e){if(i&1){let t=I();T(0,"div",7),se("click",function(){let o=_(t).$implicit,a=m(2);return v(a.selectLocale(o.code))}),T(1,"span",2),l(2),k(),T(3,"span",8),l(4),k()()}if(i&2){let t=e.$implicit,n=m(2);N("active",t.code===n.i18n.locale()),c(2),D(t.flag),c(2),D(t.nativeName)}}function rD(i,e){if(i&1&&(T(0,"div",5),O(1,oD,5,4,"div",6,iD),k()),i&2){let t=m();c(),U(t.locales)}}var Yl=class i{constructor(){this.i18n=F(Be);this.locales=ni;this.isOpen=!1}toggleDropdown(){this.isOpen=!this.isOpen}selectLocale(e){this.i18n.setLocale(e),this.isOpen=!1}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-language-switcher-compact"]],decls:9,vars:5,consts:[[1,"language-switcher"],[1,"current-language",3,"click"],[1,"flag"],[1,"lang-name"],[1,"arrow"],[1,"dropdown"],[1,"option",3,"active"],[1,"option",3,"click"],[1,"name"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1),se("click",function(){return n.toggleDropdown()}),T(2,"span",2),l(3),k(),T(4,"span",3),l(5),k(),T(6,"span",4),l(7,"\u25BC"),k()(),y(8,rD,3,0,"div",5),k()),t&2&&(c(3),D(n.i18n.currentLocaleInfo().flag),c(2),D(n.i18n.currentLocaleInfo().nativeName),c(),N("open",n.isOpen),c(2),S(n.isOpen?8:-1))},dependencies:[oe],styles:[".language-switcher[_ngcontent-%COMP%]{position:relative;display:inline-block}.current-language[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;cursor:pointer;transition:all .2s ease}.current-language[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.flag[_ngcontent-%COMP%]{font-size:18px}.lang-name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}.arrow[_ngcontent-%COMP%]{font-size:10px;color:var(--text-muted, #888);transition:transform .2s ease}.arrow.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin-top:4px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;overflow:hidden;z-index:100;box-shadow:0 4px 12px #0000004d}.option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 12px;cursor:pointer;transition:background .2s ease}.option[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.option.active[_ngcontent-%COMP%]{background:var(--primary-color, #7c3aed)}.option[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}"]})}};var Si=class i{constructor(){this._deviceCode=f(null);this._deviceDetails=f(null);this.deviceCode=R(()=>this._deviceCode());this.deviceDetails=R(()=>this._deviceDetails());this.initDeviceInfo()}async initDeviceInfo(){try{let e=await this.collectDeviceDetails();this._deviceDetails.set(e);let t=await this.generateDeviceCode(e);this._deviceCode.set(t)}catch(e){console.error("\u521D\u59CB\u5316\u8A2D\u5099\u4FE1\u606F\u5931\u6557:",e),this._deviceCode.set(this.generateFallbackDeviceCode())}}async getDeviceCode(){return this._deviceCode()?this._deviceCode():(await new Promise(e=>{let t=setInterval(()=>{this._deviceCode()&&(clearInterval(t),e())},100);setTimeout(()=>{clearInterval(t),this._deviceCode()||this._deviceCode.set(this.generateFallbackDeviceCode()),e()},3e3)}),this._deviceCode())}async collectDeviceDetails(){if(typeof window<"u"&&window.electronAPI!==void 0)try{let t=await window.electronAPI.invoke("get-system-info");if(t)return{platform:t.platform||"unknown",arch:t.arch||"unknown",hostname:t.hostname||"unknown",cpuModel:t.cpuModel||"unknown",cpuCores:t.cpuCores||1,totalMemory:t.totalMemory||0,osType:t.osType||"unknown",osVersion:t.osVersion||"unknown",username:t.username||"unknown",screenResolution:`${window.screen.width}x${window.screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language}}catch(t){console.warn("\u7121\u6CD5\u5F9E Electron \u7372\u53D6\u7CFB\u7D71\u4FE1\u606F:",t)}return{platform:navigator.platform||"web",arch:this.detectArch(),hostname:"browser",cpuModel:"unknown",cpuCores:navigator.hardwareConcurrency||1,totalMemory:navigator.deviceMemory||0,osType:this.detectOS(),osVersion:"unknown",username:"webuser",screenResolution:`${window.screen.width}x${window.screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language}}async generateDeviceCode(e){let t=[e.platform,e.arch,e.hostname,e.cpuCores.toString(),e.totalMemory.toString(),e.osType,e.screenResolution,e.timezone,e.language,this.getCanvasFingerprint(),this.getWebGLFingerprint()].join("|"),o=(await this.sha256(t)).substr(0,16).toUpperCase();return`TGM-${o.substr(0,4)}-${o.substr(4,4)}-${o.substr(8,4)}-${o.substr(12,4)}`}generateFallbackDeviceCode(){let e=localStorage.getItem("tgm_device_code");if(e)return e;let t=Math.random().toString(36).substr(2,16).toUpperCase(),n=`TGM-${t.substr(0,4)}-${t.substr(4,4)}-${t.substr(8,4)}-${t.substr(12,4)}`;return localStorage.setItem("tgm_device_code",n),n}async sha256(e){if(typeof crypto<"u"&&crypto.subtle){let t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("")}return this.simpleHash(e)}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);t=(t<<5)-t+o,t=t&t}return Math.abs(t).toString(16).padStart(16,"0")}detectOS(){let e=navigator.userAgent;return e.indexOf("Win")!==-1?"Windows":e.indexOf("Mac")!==-1?"macOS":e.indexOf("Linux")!==-1?"Linux":e.indexOf("Android")!==-1?"Android":e.indexOf("iOS")!==-1?"iOS":"Unknown"}detectArch(){let e=navigator.platform;return e.indexOf("64")!==-1?"x64":e.indexOf("ARM")!==-1?"arm":"x86"}getCanvasFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("TG-AI\u667A\u63A7\u738B",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("fingerprint",4,17),e.toDataURL().substr(-50)):"no-canvas"}catch{return"canvas-error"}}getWebGLFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"no-webgl";let n=t.getExtension("WEBGL_debug_renderer_info");if(n){let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),a=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return`${o}|${a}`.substr(0,50)}return"webgl-no-debug"}catch{return"webgl-error"}}getDeviceName(){let e=this._deviceDetails();if(!e)return"\u672A\u77E5\u8A2D\u5099";let t=e.osType,n=e.platform;return t==="Windows"?`Windows PC (${e.cpuCores} \u6838\u5FC3)`:t==="macOS"?`Mac (${e.cpuCores} \u6838\u5FC3)`:t==="Linux"?`Linux (${e.hostname})`:`${n} \u8A2D\u5099`}getShortDeviceId(){let e=this._deviceCode();return e?e.substr(4,9):"..."}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Gn=class i{constructor(){this.deviceService=F(Si);this.injector=F(ar);this.licenseClient=F(ui);this.SKIP_LOGIN=!0;this.DEFAULT_USER={id:1,username:"Admin",email:"admin@tgai.local",membershipLevel:"king",membershipExpires:new Date(Date.now()+365*100*24*60*60*1e3).toISOString(),inviteCode:"ADMIN-VIP",invitedCount:0,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),status:"active"};this._isAuthenticated=f(this.SKIP_LOGIN);this._user=f(this.SKIP_LOGIN?this.DEFAULT_USER:null);this._token=f(this.SKIP_LOGIN?"skip-login-token":null);this._isLoading=f(!1);this._devices=f([]);this._usageStats=f(null);this.isAuthenticated=R(()=>this._isAuthenticated());this.user=R(()=>this._user());this.isLoading=R(()=>this._isLoading());this.devices=R(()=>this._devices());this.usageStats=R(()=>this._usageStats());this.membershipLevel=R(()=>this._user()?.membershipLevel||"bronze");this.isPaid=R(()=>["silver","gold","diamond","star","king"].includes(this.membershipLevel()));this.isPremium=R(()=>["diamond","star","king"].includes(this.membershipLevel()));this.isElite=R(()=>["star","king"].includes(this.membershipLevel()));this.isKing=R(()=>this.membershipLevel()==="king");this.membershipExpiresSoon=R(()=>{let e=this._user()?.membershipExpires;if(!e)return!1;let t=Math.floor((new Date(e).getTime()-Date.now())/(1e3*60*60*24));return t<=7&&t>0});this.membershipDaysLeft=R(()=>{let e=this._user()?.membershipExpires;return e?Math.max(0,Math.floor((new Date(e).getTime()-Date.now())/(1e3*60*60*24))):0});if(this.SKIP_LOGIN){console.log("[AuthService] \u514D\u767B\u9304\u6A21\u5F0F\u5DF2\u555F\u7528\uFF0C\u9ED8\u8A8D\u70BA\u738B\u8005\u6703\u54E1");return}setTimeout(()=>{this.checkLocalAuth().catch(e=>{console.error("\u8A8D\u8B49\u521D\u59CB\u5316\u932F\u8AA4:",e),this._isAuthenticated.set(!1)})},0)}async checkLocalAuth(){try{if(typeof localStorage>"u")return;let e=localStorage.getItem("tgm_auth_token"),t=localStorage.getItem("tgm_user");if(e&&t){let n=JSON.parse(t),o=await this.deviceService.getDeviceCode();await this.verifyToken(e,o)?(this._token.set(e),this._user.set(n),this._isAuthenticated.set(!0),this.loadDevices().catch(d=>console.error("\u8F09\u5165\u8A2D\u5099\u5217\u8868\u5931\u6557:",d)),this.loadUsageStats().catch(d=>console.error("\u8F09\u5165\u4F7F\u7528\u7D71\u8A08\u5931\u6557:",d))):this.clearLocalAuth()}else this._isAuthenticated.set(!1)}catch(e){console.error("\u6AA2\u67E5\u672C\u5730\u8A8D\u8B49\u5931\u6557:",e),this.clearLocalAuth(),this._isAuthenticated.set(!1)}}async login(e,t){this._isLoading.set(!0);try{let n=await this.deviceService.getDeviceCode(),o=await this.callAuthApi("/api/auth/login",{username:e,password:t,deviceCode:n});return o.success&&o.user&&o.token&&await this.handleLoginSuccess(o.user,o.token),o}catch(n){return{success:!1,message:n.message||"\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}finally{this._isLoading.set(!1)}}async activateLicense(e,t,n){this._isLoading.set(!0);try{let o=await this.deviceService.getDeviceCode(),a=await this.callAuthApi("/api/auth/activate",{licenseKey:e,username:t,password:n,deviceCode:o});return a.success&&a.user&&a.token&&await this.handleLoginSuccess(a.user,a.token),a}catch(o){return{success:!1,message:o.message||"\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u5361\u5BC6\u662F\u5426\u6B63\u78BA"}}finally{this._isLoading.set(!1)}}async registerWithInvite(e,t,n,o){this._isLoading.set(!0);try{let a=await this.deviceService.getDeviceCode(),d=await this.callAuthApi("/api/auth/register",{inviteCode:e,username:t,password:n,email:o,deviceCode:a});return d.success&&d.user&&d.token&&await this.handleLoginSuccess(d.user,d.token),d}catch(a){return{success:!1,message:a.message||"\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}finally{this._isLoading.set(!1)}}async logout(){try{let e=this._token();e&&await this.callAuthApi("/api/auth/logout",{token:e})}catch(e){console.error("\u9000\u51FA API \u8ABF\u7528\u5931\u6557:",e)}finally{this.clearLocalAuth(),this._isAuthenticated.set(!1),this._user.set(null),this._token.set(null),this._devices.set([]),this._usageStats.set(null)}}async changePassword(e,t){try{return await this.callAuthApi("/api/auth/change-password",{oldPassword:e,newPassword:t,token:this._token()})}catch(n){return{success:!1,message:n.message||"\u4FEE\u6539\u5BC6\u78BC\u5931\u6557"}}}async renewMembership(e){try{let t=this._user(),n=t?.email||"",o=await this.licenseClient.activateLicense(e,n);if(o.success){let a="silver",d="",u="\u767D\u9280\u7CBE\u82F1",p="\u{1F948}";if(o.data?.level)a=o.data.level,d=o.data.expiresAt||"",u=o.data.levelName||this.getLevelName(a),p=o.data.levelIcon||this.getLevelIcon(a);else{let C=this.parseLicenseKey(e);C.valid&&(a=C.level,d=C.expiresAt,u=C.levelName,p=C.levelIcon)}if(t){let C=P(E({},t),{membershipLevel:a,membershipExpires:d});this._user.set(C),localStorage.setItem("tgm_user",JSON.stringify(C)),console.log("[AuthService] \u7528\u6236\u72C0\u614B\u5DF2\u66F4\u65B0:",{level:a,expires:d})}else{let C={id:1,username:n.split("@")[0]||"User",email:n,membershipLevel:a,membershipExpires:d,inviteCode:"",invitedCount:0,createdAt:new Date().toISOString(),status:"active"};this._user.set(C),localStorage.setItem("tgm_user",JSON.stringify(C)),console.log("[AuthService] \u65B0\u7528\u6236\u5DF2\u5275\u5EFA:",{level:a,expires:d})}return await this.loadUsageStats(),window.dispatchEvent(new CustomEvent("membership-updated",{detail:{level:a,levelName:u,levelIcon:p,expiresAt:d}})),{success:!0,message:o.message||`\u{1F389} ${p} ${u} \u6FC0\u6D3B\u6210\u529F\uFF01`,newExpires:d}}return{success:!1,message:o.message||"\u6FC0\u6D3B\u5931\u6557"}}catch(t){return console.error("\u6FC0\u6D3B\u5361\u5BC6\u5931\u6557:",t),{success:!1,message:t.message||"\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}}getLevelName(e){return{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[e]||"\u9752\u9285\u6230\u58EB"}getLevelIcon(e){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[e]||"\u2694\uFE0F"}async bindDevice(e,t){try{let n=await this.callAuthApi("/api/auth/bind-device",{deviceCode:e,deviceName:t,token:this._token()});return n.success&&await this.loadDevices(),n}catch(n){return{success:!1,message:n.message||"\u7D81\u5B9A\u8A2D\u5099\u5931\u6557"}}}async unbindDevice(e){try{let t=await this.callAuthApi("/api/auth/unbind-device",{deviceId:e,token:this._token()});return t.success&&await this.loadDevices(),t}catch(t){return{success:!1,message:t.message||"\u89E3\u7D81\u8A2D\u5099\u5931\u6557"}}}async loadDevices(){try{let e=await this.callAuthApi("/api/auth/devices",{token:this._token()});if(e.success&&e.devices){let t=await this.deviceService.getDeviceCode(),n=e.devices.map(o=>P(E({},o),{isCurrent:o.deviceCode===t}));this._devices.set(n)}}catch(e){console.error("\u8F09\u5165\u8A2D\u5099\u5217\u8868\u5931\u6557:",e)}}async loadUsageStats(){try{try{let{LicenseClientService:t}=await import("./chunk-4UF4MSLH.js"),o=await this.injector.get(t).getUsageStats();if(o.success&&o.stats){this._usageStats.set(o.stats);return}}catch(t){console.warn("\u4F7F\u7528 LicenseClientService \u8F09\u5165\u7D71\u8A08\u5931\u6557\uFF0C\u5617\u8A66\u4F7F\u7528 mock API:",t)}let e=await this.callAuthApi("/api/auth/usage-stats",{token:this._token()});e.success&&e.stats&&this._usageStats.set(e.stats)}catch(e){console.error("\u8F09\u5165\u4F7F\u7528\u7D71\u8A08\u5931\u6557:",e)}}async getInviteRewards(){try{let e=await this.callAuthApi("/api/auth/invite-rewards",{token:this._token()});return e.success?e:{inviteCode:this._user()?.inviteCode||"",invitedCount:0,rewardDays:0}}catch{return{inviteCode:this._user()?.inviteCode||"",invitedCount:0,rewardDays:0}}}async handleLoginSuccess(e,t){this._user.set(e),this._token.set(t),this._isAuthenticated.set(!0),localStorage.setItem("tgm_auth_token",t),localStorage.setItem("tgm_user",JSON.stringify(e)),await this.loadDevices(),await this.loadUsageStats()}async verifyToken(e,t){try{return(await this.callAuthApi("/api/auth/verify",{token:e,deviceCode:t})).success===!0}catch{return!1}}clearLocalAuth(){localStorage.removeItem("tgm_auth_token"),localStorage.removeItem("tgm_user")}async callAuthApi(e,t){if(this.isDevMode())return this.mockApiResponse(e,t);try{return await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t.token?`Bearer ${t.token}`:""},body:JSON.stringify(t)})).json()}catch{throw new Error("\u7DB2\u7D61\u9023\u63A5\u5931\u6557")}}isDevMode(){return typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")}mockApiResponse(e,t){return new Promise(n=>{setTimeout(()=>{switch(e){case"/api/auth/login":t.username&&t.password?n({success:!0,message:"\u767B\u5165\u6210\u529F",user:this.getMockUser(t.username),token:"mock_token_"+Date.now(),expiresAt:new Date(Date.now()+10080*60*1e3).toISOString()}):n({success:!1,message:"\u7528\u6236\u540D\u6216\u5BC6\u78BC\u932F\u8AA4"});break;case"/api/auth/activate":t.licenseKey&&t.licenseKey.length>=16?n({success:!0,message:"\u6FC0\u6D3B\u6210\u529F",user:this.getMockUser(t.username,"silver"),token:"mock_token_"+Date.now()}):n({success:!1,message:"\u5361\u5BC6\u7121\u6548\u6216\u5DF2\u4F7F\u7528"});break;case"/api/auth/register":t.inviteCode&&t.username&&t.password?n({success:!0,message:"\u8A3B\u518A\u6210\u529F",user:this.getMockUser(t.username),token:"mock_token_"+Date.now()}):n({success:!1,message:"\u9080\u8ACB\u78BC\u7121\u6548"});break;case"/api/auth/verify":n({success:!0});break;case"/api/auth/devices":n({success:!0,devices:[{id:1,deviceCode:t.deviceCode||"TGM-MOCK-001",deviceName:"\u7576\u524D\u8A2D\u5099",boundAt:new Date().toISOString(),lastSeen:new Date().toISOString(),status:"active"}]});break;case"/api/auth/usage-stats":n({success:!0,stats:{aiCalls:{used:150,limit:500},messagesSent:{used:2340,limit:1e4},accounts:{used:5,limit:10},storage:{used:45,limit:100}}});break;case"/api/auth/invite-rewards":n({success:!0,inviteCode:"INVITE-"+Math.random().toString(36).substr(2,6).toUpperCase(),invitedCount:3,rewardDays:9});break;case"/api/auth/renew":let o=this.parseLicenseKey(t.licenseKey);if(o.valid){let a=this._user();if(a){let d=P(E({},a),{membershipLevel:o.level,membershipExpires:o.expiresAt});n({success:!0,message:`\u{1F389} ${o.levelIcon} ${o.levelName} \u6FC0\u6D3B\u6210\u529F\uFF01\u6709\u6548\u671F\u81F3 ${new Date(o.expiresAt).toLocaleDateString()}`,user:d,newExpires:o.expiresAt})}else n({success:!1,message:"\u8ACB\u5148\u767B\u5165"})}else n({success:!1,message:o.message});break;default:n({success:!0,message:"OK"})}},500)})}getMockUser(e,t="silver"){return{id:1,username:e,email:`${e}@example.com`,membershipLevel:t,membershipExpires:new Date(Date.now()+720*60*60*1e3).toISOString(),inviteCode:"INVITE-"+Math.random().toString(36).substr(2,6).toUpperCase(),invitedCount:3,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),status:"active"}}parseLicenseKey(e){if(!e)return{valid:!1,message:"\u8ACB\u8F38\u5165\u5361\u5BC6",level:"bronze",levelName:"",levelIcon:"",durationDays:0,expiresAt:""};let t=/^TGAI-([BGDSK][123YL]|EXT)-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i,n=/^TGM-([BGDSK][123Y])-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i,o=e.toUpperCase().match(t);if(o||(o=e.toUpperCase().match(n)),!o)return{valid:!1,message:"\u2694\uFE0F \u5361\u5BC6\u683C\u5F0F\u4E0D\u6B63\u78BA\uFF0C\u8ACB\u6AA2\u67E5\u5F8C\u91CD\u8A66",level:"bronze",levelName:"",levelIcon:"",durationDays:0,expiresAt:""};let a=o[1],d=a[0],u=a[1]||"2",p={B:{level:"silver",name:"\u767D\u9280\u7CBE\u82F1",icon:"\u{1F948}"},G:{level:"gold",name:"\u9EC3\u91D1\u5927\u5E2B",icon:"\u{1F947}"},D:{level:"diamond",name:"\u947D\u77F3\u738B\u724C",icon:"\u{1F48E}"},S:{level:"star",name:"\u661F\u8000\u50B3\u8AAA",icon:"\u{1F31F}"},K:{level:"king",name:"\u69AE\u8000\u738B\u8005",icon:"\u{1F451}"},E:{level:"gold",name:"\u9EC3\u91D1\u5927\u5E2B",icon:"\u{1F947}"}},g={1:7,2:30,3:90,Y:365,L:36500,X:30},C=p[d]||{level:"silver",name:"\u767D\u9280\u7CBE\u82F1",icon:"\u{1F948}"},w=g[u]||30,A=this._user(),V=new Date;if(A?.membershipExpires){let G=new Date(A.membershipExpires);G>V&&(V=G)}return V.setDate(V.getDate()+w),{valid:!0,message:"\u5361\u5BC6\u6709\u6548",level:C.level,levelName:C.name,levelIcon:C.icon,durationDays:w,expiresAt:V.toISOString()}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var sD=(i,e)=>e.id;function aD(i,e){i&1&&(r(0,"span",50),l(1,"\u27F3"),s())}function lD(i,e){i&1&&(r(0,"span",50),l(1,"\u27F3"),s())}function cD(i,e){if(i&1&&(r(0,"div",63)(1,"span",72),l(2,"\u26A0\uFE0F"),s(),l(3),s()),i&2){let t=m();c(3),M(" ",t.errorMessage()," ")}}function dD(i,e){if(i&1&&(r(0,"div",64)(1,"span",72),l(2,"\u2705"),s(),l(3),s()),i&2){let t=m();c(3),M(" ",t.successMessage()," ")}}function uD(i,e){i&1&&(r(0,"span",86),l(1,"\u23F3"),s(),l(2," \u767B\u5165\u4E2D... "))}function mD(i,e){i&1&&l(0," \u{1F680} \u767B\u5165 ")}function pD(i,e){if(i&1){let t=I();r(0,"form",73),x("ngSubmit",function(){_(t);let o=m();return v(o.onLogin())}),r(1,"div",74)(2,"label",75),l(3,"\u7528\u6236\u540D"),s(),r(4,"input",76),W("ngModelChange",function(o){_(t);let a=m();return q(a.loginForm.username,o)||(a.loginForm.username=o),v(o)}),s()(),r(5,"div",74)(6,"label",75),l(7,"\u5BC6\u78BC"),s(),r(8,"div",77)(9,"input",78),W("ngModelChange",function(o){_(t);let a=m();return q(a.loginForm.password,o)||(a.loginForm.password=o),v(o)}),s(),r(10,"button",79),x("click",function(){_(t);let o=m();return v(o.showPassword.set(!o.showPassword()))}),l(11),s()()(),r(12,"div",80)(13,"label",81)(14,"input",82),W("ngModelChange",function(o){_(t);let a=m();return q(a.rememberMe,o)||(a.rememberMe=o),v(o)}),s(),r(15,"span",83),l(16,"\u8A18\u4F4F\u6211"),s()(),r(17,"a",84),l(18," \u5FD8\u8A18\u5BC6\u78BC\uFF1F "),s()(),r(19,"button",85),y(20,uD,3,0)(21,mD,1,0),s()()}if(i&2){let t=m();c(4),H("ngModel",t.loginForm.username),c(5),L("type",t.showPassword()?"text":"password"),H("ngModel",t.loginForm.password),c(2),M(" ",t.showPassword()?"\u{1F648}":"\u{1F441}\uFE0F"," "),c(3),H("ngModel",t.rememberMe),c(5),L("disabled",t.isLoading()),c(),S(t.isLoading()?20:21)}}function gD(i,e){i&1&&(r(0,"span",86),l(1,"\u23F3"),s(),l(2," \u6FC0\u6D3B\u4E2D... "))}function hD(i,e){i&1&&l(0," \u{1F3AB} \u6FC0\u6D3B\u5361\u5BC6 ")}function fD(i,e){if(i&1){let t=I();r(0,"form",73),x("ngSubmit",function(){_(t);let o=m();return v(o.onActivate())}),r(1,"div",74)(2,"label",75),l(3,"\u5361\u5BC6"),s(),r(4,"input",87),W("ngModelChange",function(o){_(t);let a=m();return q(a.activateForm.licenseKey,o)||(a.activateForm.licenseKey=o),v(o)}),s(),r(5,"p",88),l(6,"\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u9032\u884C\u6FC0\u6D3B"),s()(),r(7,"div",74)(8,"label",75),l(9,"\u8A2D\u7F6E\u7528\u6236\u540D"),s(),r(10,"input",89),W("ngModelChange",function(o){_(t);let a=m();return q(a.activateForm.username,o)||(a.activateForm.username=o),v(o)}),s()(),r(11,"div",74)(12,"label",75),l(13,"\u8A2D\u7F6E\u5BC6\u78BC"),s(),r(14,"input",90),W("ngModelChange",function(o){_(t);let a=m();return q(a.activateForm.password,o)||(a.activateForm.password=o),v(o)}),s()(),r(15,"div",74)(16,"label",75),l(17,"\u78BA\u8A8D\u5BC6\u78BC"),s(),r(18,"input",91),W("ngModelChange",function(o){_(t);let a=m();return q(a.activateForm.confirmPassword,o)||(a.activateForm.confirmPassword=o),v(o)}),s()(),r(19,"button",92),y(20,gD,3,0)(21,hD,1,0),s()()}if(i&2){let t=m();c(4),H("ngModel",t.activateForm.licenseKey),c(6),H("ngModel",t.activateForm.username),c(4),H("ngModel",t.activateForm.password),c(4),H("ngModel",t.activateForm.confirmPassword),c(),L("disabled",t.isLoading()),c(),S(t.isLoading()?20:21)}}function _D(i,e){i&1&&(r(0,"span",86),l(1,"\u23F3"),s(),l(2," \u8A3B\u518A\u4E2D... "))}function vD(i,e){i&1&&l(0," \u{1F4DD} \u8A3B\u518A\u5E33\u865F ")}function xD(i,e){if(i&1){let t=I();r(0,"form",73),x("ngSubmit",function(){_(t);let o=m();return v(o.onRegister())}),r(1,"div",74)(2,"label",75),l(3,"\u9080\u8ACB\u78BC"),s(),r(4,"input",93),W("ngModelChange",function(o){_(t);let a=m();return q(a.registerForm.inviteCode,o)||(a.registerForm.inviteCode=o),v(o)}),s(),r(5,"p",88),l(6,"\u7531\u597D\u53CB\u5206\u4EAB\u7684\u9080\u8ACB\u78BC"),s()(),r(7,"div",74)(8,"label",75),l(9,"\u7528\u6236\u540D"),s(),r(10,"input",89),W("ngModelChange",function(o){_(t);let a=m();return q(a.registerForm.username,o)||(a.registerForm.username=o),v(o)}),s()(),r(11,"div",74)(12,"label",75),l(13,"\u90F5\u7BB1\uFF08\u9078\u586B\uFF09"),s(),r(14,"input",94),W("ngModelChange",function(o){_(t);let a=m();return q(a.registerForm.email,o)||(a.registerForm.email=o),v(o)}),s()(),r(15,"div",74)(16,"label",75),l(17,"\u5BC6\u78BC"),s(),r(18,"input",90),W("ngModelChange",function(o){_(t);let a=m();return q(a.registerForm.password,o)||(a.registerForm.password=o),v(o)}),s()(),r(19,"button",95),y(20,_D,3,0)(21,vD,1,0),s()()}if(i&2){let t=m();c(4),H("ngModel",t.registerForm.inviteCode),c(6),H("ngModel",t.registerForm.username),c(4),H("ngModel",t.registerForm.email),c(4),H("ngModel",t.registerForm.password),c(),L("disabled",t.isLoading()),c(),S(t.isLoading()?20:21)}}function CD(i,e){if(i&1&&B(0,"img",101),i&2){let t=m().$implicit;L("src",t.avatar,ot)}}function bD(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=m().$implicit;c(),D(t.name.charAt(0).toUpperCase())}}function yD(i,e){i&1&&l(0," \u{1F4F1} Telegram ")}function SD(i,e){i&1&&l(0," \u{1F4E7} Google ")}function wD(i,e){if(i&1){let t=I();r(0,"button",99),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.onQuickLogin(o))}),r(1,"div",100),y(2,CD,1,1,"img",101)(3,bD,2,1,"span"),s(),r(4,"div",102)(5,"span",103),l(6),s(),r(7,"span",104),y(8,yD,1,0)(9,SD,1,0),s()()()}if(i&2){let t=e.$implicit;N("telegram",t.provider==="telegram")("google",t.provider==="google"),c(2),S(t.avatar?2:3),c(4),D(t.name),c(2),S(t.provider==="telegram"?8:t.provider==="google"?9:-1)}}function ED(i,e){if(i&1&&(r(0,"div",66)(1,"p",96),l(2,"\u5DF2\u7D81\u5B9A\u5E33\u865F"),s(),r(3,"div",97),O(4,wD,10,7,"button",98,sD),s()()),i&2){let t=m();c(4),U(t.linkedAccounts())}}var Xl=class i{constructor(){this.authService=F(Gn);this.deviceService=F(Si);this.i18n=F(Be);this.mode=f("login");this.showPassword=f(!1);this.errorMessage=f("");this.successMessage=f("");this.rememberMe=!1;this.telegramLoading=f(!1);this.googleLoading=f(!1);this.isLoading=R(()=>this.authService.isLoading());this.isOAuthLoading=R(()=>this.telegramLoading()||this.googleLoading());this.deviceCode=R(()=>this.deviceService.getShortDeviceId());this.deviceName=R(()=>this.deviceService.getDeviceName());this.linkedAccounts=f([]);this.loginForm={username:"",password:""};this.activateForm={licenseKey:"",username:"",password:"",confirmPassword:""};this.registerForm={inviteCode:"",username:"",email:"",password:""}}ngOnInit(){let t=new URLSearchParams(window.location.search).get("invite");t&&(this.registerForm.inviteCode=t,this.mode.set("register")),this.loadLinkedAccounts(),this.handleOAuthCallback()}loadLinkedAccounts(){try{let e=localStorage.getItem("tgm_linked_accounts");e&&this.linkedAccounts.set(JSON.parse(e))}catch(e){console.error("\u8F09\u5165\u5DF2\u7D81\u5B9A\u5E33\u865F\u5931\u6557:",e)}}handleOAuthCallback(){let e=new URLSearchParams(window.location.search),t=e.get("oauth_token"),n=e.get("provider");t&&n&&(this.processOAuthToken(n,t),window.history.replaceState({},document.title,window.location.pathname))}async onTelegramLogin(){this.clearMessages(),this.telegramLoading.set(!0);try{if(this.isDevMode()){await this.simulateTelegramLogin();return}let e=await this.deviceService.getDeviceCode(),t=encodeURIComponent(window.location.origin+"?provider=telegram"),n=`/api/oauth/telegram/authorize?device=${e}&callback=${t}`;window.location.href=n}catch(e){this.errorMessage.set(e.message||"Telegram \u767B\u5165\u5931\u6557"),this.telegramLoading.set(!1)}}async onGoogleLogin(){this.clearMessages(),this.googleLoading.set(!0);try{if(this.isDevMode()){await this.simulateGoogleLogin();return}let e=await this.deviceService.getDeviceCode(),t=encodeURIComponent(window.location.origin+"?provider=google"),n=`/api/oauth/google/authorize?device=${e}&callback=${t}`;window.location.href=n}catch(e){this.errorMessage.set(e.message||"Google \u767B\u5165\u5931\u6557"),this.googleLoading.set(!1)}}async onQuickLogin(e){this.clearMessages();try{let t=await this.deviceService.getDeviceCode();if(this.isDevMode()){(await this.authService.login(e.name,"oauth_"+e.id)).success?this.successMessage.set(`\u6B61\u8FCE\u56DE\u4F86\uFF0C${e.name}\uFF01`):this.errorMessage.set("\u5FEB\u6377\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u5617\u8A66\u91CD\u65B0\u6388\u6B0A");return}let o=await(await fetch("/api/oauth/quick-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:e.id,provider:e.provider,deviceCode:t})})).json();o.success?this.successMessage.set(`\u6B61\u8FCE\u56DE\u4F86\uFF0C${e.name}\uFF01`):this.errorMessage.set(o.message||"\u5FEB\u6377\u767B\u5165\u5931\u6557")}catch(t){this.errorMessage.set(t.message||"\u5FEB\u6377\u767B\u5165\u5931\u6557")}}async simulateTelegramLogin(){await new Promise(n=>setTimeout(n,1500));let e={id:"tg_"+Math.random().toString(36).substr(2,9),name:"TG User "+Math.floor(Math.random()*1e3),avatar:null,provider:"telegram"};this.saveLinkedAccount(e);let t=await this.authService.login(e.name,"oauth_"+e.id);this.telegramLoading.set(!1),t.success?this.successMessage.set("Telegram \u767B\u5165\u6210\u529F\uFF01"):this.errorMessage.set(t.message)}async simulateGoogleLogin(){await new Promise(n=>setTimeout(n,1500));let e={id:"google_"+Math.random().toString(36).substr(2,9),name:"user"+Math.floor(Math.random()*1e3)+"@gmail.com",avatar:null,provider:"google"};this.saveLinkedAccount(e);let t=await this.authService.login(e.name.split("@")[0],"oauth_"+e.id);this.googleLoading.set(!1),t.success?this.successMessage.set("Google \u767B\u5165\u6210\u529F\uFF01"):this.errorMessage.set(t.message)}async processOAuthToken(e,t){try{let o=await(await fetch("/api/oauth/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e,token:t})})).json();o.success&&o.user&&(this.saveLinkedAccount({id:o.user.id,name:o.user.name,avatar:o.user.avatar,provider:e}),this.successMessage.set(`${e==="telegram"?"Telegram":"Google"} \u7D81\u5B9A\u6210\u529F\uFF01`))}catch(n){console.error("OAuth \u9A57\u8B49\u5931\u6557:",n)}}saveLinkedAccount(e){let t=this.linkedAccounts(),n=t.findIndex(o=>o.provider===e.provider&&o.id===e.id);n>=0?t[n]=e:t.push(e),this.linkedAccounts.set([...t]),localStorage.setItem("tgm_linked_accounts",JSON.stringify(t))}isDevMode(){return typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")}async onLogin(){if(this.clearMessages(),!this.loginForm.username||!this.loginForm.password){this.errorMessage.set("\u8ACB\u8F38\u5165\u7528\u6236\u540D\u548C\u5BC6\u78BC");return}let e=await this.authService.login(this.loginForm.username,this.loginForm.password);e.success?this.successMessage.set("\u767B\u5165\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F49..."):this.errorMessage.set(e.message)}async onActivate(){if(this.clearMessages(),!this.activateForm.licenseKey){this.errorMessage.set("\u8ACB\u8F38\u5165\u5361\u5BC6");return}if(!this.activateForm.username){this.errorMessage.set("\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D");return}if(this.activateForm.password.length<6){this.errorMessage.set("\u5BC6\u78BC\u81F3\u5C11\u9700\u8981 6 \u4F4D");return}if(this.activateForm.password!==this.activateForm.confirmPassword){this.errorMessage.set("\u5169\u6B21\u8F38\u5165\u7684\u5BC6\u78BC\u4E0D\u4E00\u81F4");return}let e=await this.authService.activateLicense(this.activateForm.licenseKey,this.activateForm.username,this.activateForm.password);e.success?this.successMessage.set("\u6FC0\u6D3B\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F49..."):this.errorMessage.set(e.message)}async onRegister(){if(this.clearMessages(),!this.registerForm.inviteCode){this.errorMessage.set("\u8ACB\u8F38\u5165\u9080\u8ACB\u78BC");return}if(!this.registerForm.username){this.errorMessage.set("\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D");return}if(this.registerForm.password.length<6){this.errorMessage.set("\u5BC6\u78BC\u81F3\u5C11\u9700\u8981 6 \u4F4D");return}let e=await this.authService.registerWithInvite(this.registerForm.inviteCode,this.registerForm.username,this.registerForm.password,this.registerForm.email||void 0);e.success?this.successMessage.set("\u8A3B\u518A\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F49..."):this.errorMessage.set(e.message)}clearMessages(){this.errorMessage.set(""),this.successMessage.set("")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-login"]],decls:94,vars:18,consts:[[1,"login-container"],[1,"absolute","inset-0","overflow-hidden","pointer-events-none"],[1,"absolute","top-1/4","left-1/4","w-96","h-96","bg-cyan-500/10","rounded-full","blur-3xl","animate-pulse"],[1,"absolute","bottom-1/4","right-1/4","w-96","h-96","bg-purple-500/10","rounded-full","blur-3xl","animate-pulse",2,"animation-delay","1s"],[1,"absolute","top-1/2","right-1/3","w-64","h-64","bg-pink-500/10","rounded-full","blur-3xl","animate-pulse",2,"animation-delay","2s"],[1,"login-card"],[1,"text-center","mb-6"],[1,"logo-container"],[1,"logo-glow"],[1,"logo-inner"],["viewBox","0 0 64 64","fill","none",1,"w-12","h-12"],["cx","32","cy","32","r","28","fill","url(#logoGrad1)","opacity","0.3"],["d","M32 8L52 20V44L32 56L12 44V20L32 8Z","fill","url(#logoGrad2)","stroke","url(#logoGrad3)","stroke-width","1.5"],["d","M22 28L40 22L34 36L28 32L22 28Z","fill","white","opacity","0.95"],["d","M28 32L34 36L32 42L28 32Z","fill","white","opacity","0.8"],["cx","20","cy","24","r","2","fill","#22d3ee"],["cx","44","cy","24","r","2","fill","#22d3ee"],["cx","20","cy","40","r","2","fill","#a78bfa"],["cx","44","cy","40","r","2","fill","#a78bfa"],["x1","20","y1","24","x2","32","y2","32","stroke","#22d3ee","stroke-width","0.5","opacity","0.6"],["x1","44","y1","24","x2","32","y2","32","stroke","#22d3ee","stroke-width","0.5","opacity","0.6"],["x1","20","y1","40","x2","32","y2","32","stroke","#a78bfa","stroke-width","0.5","opacity","0.6"],["x1","44","y1","40","x2","32","y2","32","stroke","#a78bfa","stroke-width","0.5","opacity","0.6"],["d","M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z","fill","url(#crownGrad)","stroke","#fbbf24","stroke-width","0.5"],["cx","28","cy","10","r","1","fill","#fef3c7"],["cx","32","cy","8","r","1.2","fill","#fef3c7"],["cx","36","cy","10","r","1","fill","#fef3c7"],["id","logoGrad1","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#06b6d4"],["offset","100%","stop-color","#8b5cf6"],["id","logoGrad2","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#0891b2","stop-opacity","0.9"],["offset","50%","stop-color","#0e7490","stop-opacity","0.95"],["offset","100%","stop-color","#7c3aed","stop-opacity","0.9"],["id","logoGrad3","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#22d3ee"],["offset","100%","stop-color","#a78bfa"],["id","crownGrad","x1","0%","y1","100%","x2","100%","y2","0%"],["offset","0%","stop-color","#f59e0b"],["offset","100%","stop-color","#fbbf24"],[1,"text-2xl","font-bold","bg-gradient-to-r","from-cyan-400","via-blue-400","to-purple-400","bg-clip-text","text-transparent","mt-4"],[1,"text-slate-400","mt-1"],[1,"oauth-section"],[1,"text-center","text-sm","text-slate-500","mb-4"],[1,"oauth-buttons"],[1,"oauth-btn","telegram-btn",3,"click","disabled"],[1,"oauth-icon","telegram-icon"],["viewBox","0 0 24 24","fill","currentColor",1,"w-5","h-5"],["d","M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"],[1,"oauth-text"],[1,"oauth-loading"],[1,"oauth-btn","google-btn",3,"click","disabled"],[1,"oauth-icon","google-icon"],["viewBox","0 0 24 24",1,"w-5","h-5"],["fill","#4285F4","d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"],["fill","#34A853","d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"],["fill","#FBBC05","d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"],["fill","#EA4335","d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"],[1,"divider"],[1,"divider-line"],[1,"divider-text"],[1,"flex","rounded-lg","bg-slate-800/50","p-1","mb-5"],[1,"mode-tab",3,"click"],[1,"error-message"],[1,"success-message"],[1,"space-y-4"],[1,"linked-accounts-section"],[1,"mt-5","pt-4","border-t","border-slate-700/50","text-center"],[1,"text-xs","text-slate-500"],[1,"font-mono","text-slate-400"],[1,"text-xs","text-slate-600","mt-1"],[1,"mt-3","text-center","text-xs","text-slate-600"],[1,"mr-2"],[1,"space-y-4",3,"ngSubmit"],[1,"form-group"],[1,"form-label"],["type","text","name","username","placeholder","\u8ACB\u8F38\u5165\u7528\u6236\u540D","required","",1,"form-input",3,"ngModelChange","ngModel"],[1,"relative"],["name","password","placeholder","\u8ACB\u8F38\u5165\u5BC6\u78BC","required","",1,"form-input","pr-10",3,"ngModelChange","type","ngModel"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-slate-400","hover:text-white",3,"click"],[1,"flex","items-center","justify-between","text-sm"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox","name","remember",1,"accent-cyan-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["href","javascript:void(0)",1,"text-cyan-400","hover:text-cyan-300"],["type","submit",1,"submit-button",3,"disabled"],[1,"animate-spin","mr-2"],["type","text","name","licenseKey","placeholder","XXXX-XXXX-XXXX-XXXX","required","",1,"form-input","font-mono",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1"],["type","text","name","username","placeholder","\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","password","name","password","placeholder","\u8ACB\u8A2D\u7F6E\u5BC6\u78BC\uFF08\u81F3\u5C11 6 \u4F4D\uFF09","minlength","6","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","password","name","confirmPassword","placeholder","\u8ACB\u518D\u6B21\u8F38\u5165\u5BC6\u78BC","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","submit",1,"submit-button","bg-gradient-to-r","from-green-500","to-emerald-600",3,"disabled"],["type","text","name","inviteCode","placeholder","INVITE-XXXXXX","required","",1,"form-input","font-mono",3,"ngModelChange","ngModel"],["type","email","name","email","placeholder","\u7528\u65BC\u627E\u56DE\u5BC6\u78BC",1,"form-input",3,"ngModelChange","ngModel"],["type","submit",1,"submit-button","bg-gradient-to-r","from-purple-500","to-pink-600",3,"disabled"],[1,"text-center","text-xs","text-slate-500","mb-3"],[1,"linked-accounts"],[1,"linked-account-btn",3,"telegram","google"],[1,"linked-account-btn",3,"click"],[1,"linked-avatar"],["alt","",1,"w-full","h-full","rounded-full",3,"src"],[1,"linked-info"],[1,"linked-name"],[1,"linked-provider"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1),B(2,"div",2)(3,"div",3)(4,"div",4),s(),r(5,"div",5)(6,"div",6)(7,"div",7),B(8,"div",8),r(9,"div",9),ne(),r(10,"svg",10),B(11,"circle",11)(12,"path",12)(13,"path",13)(14,"path",14)(15,"circle",15)(16,"circle",16)(17,"circle",17)(18,"circle",18)(19,"line",19)(20,"line",20)(21,"line",21)(22,"line",22)(23,"path",23)(24,"circle",24)(25,"circle",25)(26,"circle",26),r(27,"defs")(28,"linearGradient",27),B(29,"stop",28)(30,"stop",29),s(),r(31,"linearGradient",30),B(32,"stop",31)(33,"stop",32)(34,"stop",33),s(),r(35,"linearGradient",34),B(36,"stop",35)(37,"stop",36),s(),r(38,"linearGradient",37),B(39,"stop",38)(40,"stop",39),s()()()()(),ce(),r(41,"h1",40),l(42,"TG-AI\u667A\u63A7\u738B"),s(),r(43,"p",41),l(44,"AI \u9A45\u52D5\u7684 Telegram \u667A\u80FD\u71DF\u92B7\u7CFB\u7D71"),s()(),r(45,"div",42)(46,"p",43),l(47,"\u5FEB\u6377\u767B\u5165"),s(),r(48,"div",44)(49,"button",45),x("click",function(){return n.onTelegramLogin()}),r(50,"div",46),ne(),r(51,"svg",47),B(52,"path",48),s()(),ce(),r(53,"span",49),l(54,"Telegram \u767B\u5165"),s(),y(55,aD,2,0,"span",50),s(),r(56,"button",51),x("click",function(){return n.onGoogleLogin()}),r(57,"div",52),ne(),r(58,"svg",53),B(59,"path",54)(60,"path",55)(61,"path",56)(62,"path",57),s()(),ce(),r(63,"span",49),l(64,"Google \u767B\u5165"),s(),y(65,lD,2,0,"span",50),s()()(),r(66,"div",58),B(67,"span",59),r(68,"span",60),l(69,"\u6216\u4F7F\u7528\u5E33\u865F\u767B\u5165"),s(),B(70,"span",59),s(),r(71,"div",61)(72,"button",62),x("click",function(){return n.mode.set("login")}),l(73," \u{1F511} \u767B\u5165 "),s(),r(74,"button",62),x("click",function(){return n.mode.set("activate")}),l(75," \u{1F3AB} \u5361\u5BC6\u6FC0\u6D3B "),s(),r(76,"button",62),x("click",function(){return n.mode.set("register")}),l(77," \u{1F4DD} \u9080\u8ACB\u8A3B\u518A "),s()(),y(78,cD,4,1,"div",63),y(79,dD,4,1,"div",64),y(80,pD,22,7,"form",65),y(81,fD,22,6,"form",65),y(82,xD,22,6,"form",65),y(83,ED,6,0,"div",66),r(84,"div",67)(85,"p",68),l(86," \u8A2D\u5099\u78BC: "),r(87,"span",69),l(88),s()(),r(89,"p",70),l(90),s()(),r(91,"div",71)(92,"p"),l(93,"\xA9 2026 TG-AI\u667A\u63A7\u738B. All rights reserved."),s()()()()),t&2&&(c(49),L("disabled",n.isOAuthLoading()),c(6),S(n.telegramLoading()?55:-1),c(),L("disabled",n.isOAuthLoading()),c(9),S(n.googleLoading()?65:-1),c(7),N("active",n.mode()==="login"),c(2),N("active",n.mode()==="activate"),c(2),N("active",n.mode()==="register"),c(2),S(n.errorMessage()?78:-1),c(),S(n.successMessage()?79:-1),c(),S(n.mode()==="login"?80:-1),c(),S(n.mode()==="activate"?81:-1),c(),S(n.mode()==="register"?82:-1),c(),S(n.linkedAccounts().length>0?83:-1),c(5),D(n.deviceCode()),c(2),M(" ",n.deviceName()," "))},dependencies:[oe,ae,Ch,xe,it,ve,gh,Bu,Lu,he,Vu],styles:[".login-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a,#1e293b,#0f172a);position:relative;padding:1rem}.login-card[_ngcontent-%COMP%]{width:100%;max-width:420px;background:#1e293bd9;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:1.5rem;padding:2rem;border:1px solid rgba(148,163,184,.1);box-shadow:0 25px 50px -12px #00000080;position:relative;z-index:10}.logo-container[_ngcontent-%COMP%]{position:relative;width:80px;height:80px;margin:0 auto}.logo-glow[_ngcontent-%COMP%]{position:absolute;inset:-10px;background:linear-gradient(135deg,#06b6d4,#3b82f6,#8b5cf6);border-radius:1.5rem;opacity:.5;filter:blur(15px);animation:_ngcontent-%COMP%_logoGlow 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_logoGlow{0%,to{opacity:.3;transform:scale(.95)}50%{opacity:.6;transform:scale(1.05)}}.logo-inner[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background:linear-gradient(135deg,#06b6d4,#3b82f6);border-radius:1.25rem;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px -10px #06b6d480}.oauth-section[_ngcontent-%COMP%]{margin-bottom:1.25rem}.oauth-buttons[_ngcontent-%COMP%]{display:flex;gap:.75rem}.oauth-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1rem;border-radius:.75rem;font-size:.875rem;font-weight:500;transition:all .2s;cursor:pointer;position:relative;overflow:hidden}.oauth-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.telegram-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#08c,#229ed9);border:1px solid rgba(34,158,217,.3);color:#fff}.telegram-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 20px -10px #0088cc80}.google-btn[_ngcontent-%COMP%]{background:#fffffff2;border:1px solid rgba(0,0,0,.1);color:#333}.google-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 20px -10px #0003}.oauth-icon[_ngcontent-%COMP%]{width:20px;height:20px;display:flex;align-items:center;justify-content:center}.oauth-text[_ngcontent-%COMP%]{font-weight:500}.oauth-loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-left:.25rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.25rem}.divider-line[_ngcontent-%COMP%]{flex:1;height:1px;background:linear-gradient(90deg,transparent,rgba(148,163,184,.3),transparent)}.divider-text[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;white-space:nowrap}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.5rem;font-size:.8rem;color:#94a3b8;border-radius:.5rem;transition:all .2s}.mode-tab[_ngcontent-%COMP%]:hover{color:#e2e8f0}.mode-tab.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);color:#fff;font-weight:500}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#e2e8f0}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;background:#0f172a99;border:1px solid rgba(148,163,184,.2);border-radius:.75rem;color:#fff;font-size:.875rem;transition:all .2s}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4;box-shadow:0 0 0 3px #06b6d433}.form-input[_ngcontent-%COMP%]::placeholder{color:#64748b}.submit-button[_ngcontent-%COMP%]{width:100%;padding:.875rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.75rem;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 10px 20px -10px #06b6d480}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#ef444426;border:1px solid rgba(239,68,68,.3);border-radius:.75rem;color:#fca5a5;font-size:.875rem;margin-bottom:1rem;display:flex;align-items:center}.success-message[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#22c55e26;border:1px solid rgba(34,197,94,.3);border-radius:.75rem;color:#86efac;font-size:.875rem;margin-bottom:1rem;display:flex;align-items:center}.linked-accounts-section[_ngcontent-%COMP%]{margin-top:1.25rem;padding-top:1rem;border-top:1px solid rgba(148,163,184,.1)}.linked-accounts[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.linked-account-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.625rem 1rem;background:#0f172a80;border:1px solid rgba(148,163,184,.15);border-radius:.75rem;cursor:pointer;transition:all .2s}.linked-account-btn[_ngcontent-%COMP%]:hover{background:#0f172acc;border-color:#94a3b84d}.linked-account-btn.telegram[_ngcontent-%COMP%]:hover{border-color:#0088cc80}.linked-account-btn.google[_ngcontent-%COMP%]:hover{border-color:#ea433580}.linked-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-weight:600;color:#fff;font-size:.875rem;overflow:hidden}.linked-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.linked-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#e2e8f0}.linked-provider[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b}"]})}};var DD=(i,e)=>e.api_id;function AD(i,e){i&1&&(T(0,"div",5),Se(1,"span",7),T(2,"span"),l(3,"\u6B63\u5728\u5206\u6790\u6700\u4F73 API..."),k()())}function MD(i,e){if(i&1){let t=I();T(0,"div",8)(1,"div",9),l(2,"\u2B50 \u63A8\u85A6"),k(),T(3,"div",10)(4,"div",11),l(5),k(),T(6,"div",12),l(7),k()(),T(8,"div",13)(9,"div",14),Se(10,"div",15),k(),T(11,"span",16),l(12),k()(),T(13,"button",17),se("click",function(){_(t);let o=m(2);return v(o.useRecommended())}),l(14,"\u4F7F\u7528\u6B64 API"),k()(),T(15,"p",18),l(16,"\u{1F4A1} \u6B64 API \u8CA0\u8F09\u6700\u4F4E\uFF0C\u53EF\u7528\u7A7A\u9593\u5145\u8DB3"),k()}if(i&2){let t=m(2);c(5),D(t.safeDisplayName(t.recommendedApi().name,t.recommendedApi().api_id)),c(2),M("ID: ",t.recommendedApi().api_id),c(3),ee("width",t.recommendedApi().account_count/t.recommendedApi().max_accounts*100,"%"),c(2),X("",t.recommendedApi().account_count,"/",t.recommendedApi().max_accounts)}}function TD(i,e){if(i&1){let t=I();T(0,"div",6)(1,"span",19),l(2,"\u{1F4ED}"),k(),T(3,"p"),l(4,"\u66AB\u7121\u53EF\u7528\u7684 API"),k(),T(5,"p",20),l(6,"\u8ACB\u5148\u6DFB\u52A0 API \u5230\u60A8\u7684 API \u6C60"),k(),T(7,"button",21),se("click",function(){_(t);let o=m(2);return v(o.selectMode("manual"))}),l(8,"\u2795 \u6DFB\u52A0\u65B0 API"),k()()}}function kD(i,e){if(i&1&&(T(0,"div",3),y(1,AD,4,0,"div",5)(2,MD,17,6)(3,TD,9,0,"div",6),k()),i&2){let t=m();c(),S(t.isLoading()?1:t.recommendedApi()?2:3)}}function ID(i,e){if(i&1){let t=I();T(0,"div",6)(1,"span",19),l(2,"\u{1F4ED}"),k(),T(3,"p"),l(4,"\u60A8\u9084\u6C92\u6709\u6DFB\u52A0\u4EFB\u4F55 API"),k(),T(5,"button",21),se("click",function(){_(t);let o=m(2);return v(o.selectMode("manual"))}),l(6,"\u2795 \u6DFB\u52A0\u7B2C\u4E00\u500B API"),k()()}}function FD(i,e){i&1&&(T(0,"span",33),l(1,"\u505C\u7528"),k())}function PD(i,e){i&1&&(T(0,"span",34),l(1,"\u5DF2\u6EFF"),k())}function RD(i,e){i&1&&(T(0,"span",35),l(1,"\u63A8\u85A6"),k())}function ND(i,e){if(i&1){let t=I();T(0,"div",27),se("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectPoolApi(o))}),T(1,"div",28)(2,"span",29),l(3),k(),T(4,"span",30),l(5),k()(),T(6,"div",31)(7,"span",32),l(8),k(),y(9,FD,2,0,"span",33)(10,PD,2,0,"span",34)(11,RD,2,0,"span",35),k()()}if(i&2){let t,n=e.$implicit,o=m(3);N("selected",o.selectedPoolApi()===n.api_id)("disabled",!n.is_active||n.account_count>=n.max_accounts),c(3),D(o.safeDisplayName(n.name,n.api_id)),c(2),M("ID: ",n.api_id),c(2),N("warning",n.account_count>=n.max_accounts*.8)("full",n.account_count>=n.max_accounts),c(),X(" ",n.account_count,"/",n.max_accounts," "),c(),S(n.is_active?n.account_count>=n.max_accounts?10:((t=o.recommendedApi())==null?null:t.api_id)===n.api_id?11:-1:9)}}function VD(i,e){if(i&1){let t=I();T(0,"button",36),se("click",function(){_(t);let o=m(3);return v(o.confirmPoolSelection())}),l(1,"\u78BA\u8A8D\u9078\u64C7"),k()}}function BD(i,e){if(i&1){let t=I();T(0,"div",22),O(1,ND,12,13,"div",23,DD),k(),y(3,VD,2,0,"button",24),T(4,"div",25)(5,"button",26),se("click",function(){_(t);let o=m(2);return v(o.selectMode("manual"))}),l(6,"\u2795 \u6DFB\u52A0\u65B0 API"),k()()}if(i&2){let t=m(2);c(),U(t.apiList()),c(2),S(t.selectedPoolApi()?3:-1)}}function LD(i,e){if(i&1&&(T(0,"div",3),y(1,ID,7,0,"div",6)(2,BD,7,1),k()),i&2){let t=m();c(),S(t.apiList().length===0?1:2)}}function OD(i,e){if(i&1){let t=I();T(0,"div",37)(1,"label"),l(2,"API \u540D\u7A31\uFF08\u53EF\u9078\uFF09"),k(),T(3,"input",47),se("input",function(o){_(t);let a=m(2);return v(a.manualApiName.set(o.target.value))}),k()()}if(i&2){let t=m(2);c(3),Ke("value",t.manualApiName())}}function UD(i,e){if(i&1){let t=I();T(0,"div",3)(1,"div",37)(2,"label"),l(3,"API ID "),T(4,"span",38),l(5,"*"),k()(),T(6,"input",39),se("input",function(o){_(t);let a=m();return v(a.manualApiId.set(o.target.value))}),k()(),T(7,"div",37)(8,"label"),l(9,"API Hash "),T(10,"span",38),l(11,"*"),k()(),T(12,"input",40),se("input",function(o){_(t);let a=m();return v(a.manualApiHash.set(o.target.value))}),k()(),T(13,"div",41)(14,"input",42),se("change",function(o){_(t);let a=m();return v(a.saveToPool.set(o.target.checked))}),k(),T(15,"label",43),l(16,"\u4FDD\u5B58\u5230\u6211\u7684 API \u6C60\uFF08\u65B9\u4FBF\u4E0B\u6B21\u4F7F\u7528\uFF09"),k()(),y(17,OD,4,1,"div",37),T(18,"button",44),se("click",function(){_(t);let o=m();return v(o.confirmManualInput())}),l(19," \u78BA\u8A8D\u4F7F\u7528 "),k(),T(20,"div",45)(21,"span"),l(22,"\u{1F449}"),k(),T(23,"a",46),l(24,"\u524D\u5F80\u7533\u8ACB API \u6191\u64DA"),k()()()}if(i&2){let t=m();c(6),Ke("value",t.manualApiId()),c(6),Ke("value",t.manualApiHash()),c(2),Ke("checked",t.saveToPool()),c(3),S(t.saveToPool()?17:-1),c(),Ke("disabled",!t.isManualValid())}}function GD(i,e){if(i&1){let t=I();T(0,"div",4)(1,"div",48)(2,"span",49),l(3,"\u5DF2\u9078\u64C7\uFF1A"),k(),T(4,"span",50),l(5),k(),T(6,"span",51),l(7),k()(),T(8,"button",52),se("click",function(){_(t);let o=m();return v(o.clearSelection())}),l(9,"\u2715"),k()()}if(i&2){let t=m();c(5),D(t.safeDisplayName(t.selectedApi().name,t.selectedApi().api_id)),c(2),M("ID: ",t.selectedApi().api_id)}}var qo=class i{constructor(){this.ipcService=F(Q);this.toast=F(J);this.membershipService=F(Ie);this.showSelected=!0;this.apiSelected=new qe;this.selectionCleared=new qe;this.currentMode=f("recommend");this.isLoading=f(!1);this.apiList=f([]);this.selectedApi=f(null);this.recommendedApi=f(null);this.selectedPoolApi=f(null);this.manualApiId=f("");this.manualApiHash=f("");this.manualApiName=f("");this.saveToPool=f(!0);this.ipcChannels=[];this.isManualValid=R(()=>{let e=this.manualApiId(),t=this.manualApiHash();return e&&/^\d+$/.test(e)&&t&&/^[a-f0-9]{32}$/i.test(t)})}safeDisplayName(e,t){return e?/[\uFFFD\u0000-\u001F]/.test(e)||e.includes("\uFFFD")||/[\uE000-\uF8FF]/.test(e)||(e.match(/[\u4E00-\u9FFF]/g)?.length||0)===0&&/[^\x00-\x7F]/.test(e)&&e.length<10?`API ${t}`:e.replace(/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\w\s\-_@#$%&*()+=\[\]{}|;:'",.<>?/\\]/g,"").length>e.length*.3?`API ${t}`:e:`API ${t}`}ngOnInit(){this.setupIpcListeners(),this.loadApiList()}ngOnDestroy(){this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("api-credentials-updated",e=>{if(this.isLoading.set(!1),e.credentials){let t=e.credentials.filter(n=>!n.is_public&&n.is_active);this.apiList.set(t),this.findBestApi(t)}}),this.ipcChannels.push("api-credentials-updated"),this.ipcService.on("api-credential-added",e=>{e.success?(this.toast.success("\u2705 API \u6191\u64DA\u5DF2\u4FDD\u5B58\u5230 API \u6C60"),this.loadApiList()):this.toast.error(`\u4FDD\u5B58\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcChannels.push("api-credential-added")}loadApiList(){this.isLoading.set(!0),this.ipcService.send("get-api-credentials",{})}findBestApi(e){let t=e.filter(n=>n.is_active&&n.account_count<n.max_accounts);t.length>0?(t.sort((n,o)=>n.account_count/n.max_accounts-o.account_count/o.max_accounts),this.recommendedApi.set(t[0])):this.recommendedApi.set(null)}selectMode(e){this.currentMode.set(e)}useRecommended(){let e=this.recommendedApi();if(e&&e.api_hash){let t=this.safeDisplayName(e.name,e.api_id),n={api_id:e.api_id,api_hash:e.api_hash,name:t,source:"pool"};this.selectedApi.set(n),this.apiSelected.emit(n),this.toast.success(`\u5DF2\u9078\u64C7 ${t}`)}else e&&this.toast.error("\u6B64 API \u7F3A\u5C11 Hash\uFF0C\u8ACB\u91CD\u65B0\u6DFB\u52A0")}selectPoolApi(e){!e.is_active||e.account_count>=e.max_accounts||this.selectedPoolApi.set(e.api_id)}confirmPoolSelection(){let e=this.selectedPoolApi(),t=this.apiList().find(n=>n.api_id===e);if(t&&t.api_hash){let n=this.safeDisplayName(t.name,t.api_id),o={api_id:t.api_id,api_hash:t.api_hash,name:n,source:"pool"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success(`\u5DF2\u9078\u64C7 ${n}`)}}confirmManualInput(){if(!this.isManualValid())return;let e=this.manualApiId(),t=this.manualApiHash(),n=this.manualApiName()||`API ${e}`;this.saveToPool()&&this.ipcService.send("add-api-credential",{api_id:e,api_hash:t,name:n,source:"manual"});let o={api_id:e,api_hash:t,name:n,source:"manual"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success("API \u5DF2\u78BA\u8A8D")}clearSelection(){this.selectedApi.set(null),this.selectedPoolApi.set(null),this.manualApiId.set(""),this.manualApiHash.set(""),this.manualApiName.set(""),this.selectionCleared.emit()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-api-selector"]],inputs:{showSelected:"showSelected"},outputs:{apiSelected:"apiSelected",selectionCleared:"selectionCleared"},decls:12,vars:10,consts:[[1,"api-selector"],[1,"mode-tabs"],[1,"mode-tab",3,"click"],[1,"mode-content"],[1,"selected-display"],[1,"loading-state"],[1,"empty-state"],[1,"spinner"],[1,"recommended-card"],[1,"recommend-badge"],[1,"api-info"],[1,"api-name"],[1,"api-id"],[1,"api-quota"],[1,"quota-bar"],[1,"quota-fill"],[1,"quota-text"],[1,"use-btn",3,"click"],[1,"recommend-reason"],[1,"empty-icon"],[1,"hint"],[1,"add-btn",3,"click"],[1,"api-list"],[1,"api-item",3,"selected","disabled"],[1,"confirm-btn"],[1,"pool-footer"],[1,"add-more-btn",3,"click"],[1,"api-item",3,"click"],[1,"api-item-info"],[1,"api-item-name"],[1,"api-item-id"],[1,"api-item-right"],[1,"quota-badge"],[1,"status-badge","inactive"],[1,"status-badge","full"],[1,"status-badge","recommend"],[1,"confirm-btn",3,"click"],[1,"form-group"],[1,"required"],["type","text","placeholder","\u4F8B\u5982\uFF1A12345678",1,"form-input",3,"input","value"],["type","text","placeholder","\u4F8B\u5982\uFF1Aa1b2c3d4e5f6g7h8...",1,"form-input",3,"input","value"],[1,"save-option"],["type","checkbox","id","saveToPool",3,"change","checked"],["for","saveToPool"],[1,"confirm-btn",3,"click","disabled"],[1,"guide-link"],["href","https://my.telegram.org","target","_blank"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u4E3B\u529B API",1,"form-input",3,"input","value"],[1,"selected-info"],[1,"selected-label"],[1,"selected-name"],[1,"selected-id"],[1,"clear-btn",3,"click"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"button",2),se("click",function(){return n.selectMode("recommend")}),l(3," \u{1F3AF} \u667A\u80FD\u63A8\u85A6 "),k(),T(4,"button",2),se("click",function(){return n.selectMode("pool")}),l(5," \u{1F4CB} \u6211\u7684 API "),k(),T(6,"button",2),se("click",function(){return n.selectMode("manual")}),l(7," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),k()(),y(8,kD,4,1,"div",3),y(9,LD,3,1,"div",3),y(10,UD,25,5,"div",3),y(11,GD,10,2,"div",4),k()),t&2&&(c(2),N("active",n.currentMode()==="recommend"),c(2),N("active",n.currentMode()==="pool"),c(2),N("active",n.currentMode()==="manual"),c(2),S(n.currentMode()==="recommend"?8:-1),c(),S(n.currentMode()==="pool"?9:-1),c(),S(n.currentMode()==="manual"?10:-1),c(),S(n.selectedApi()&&n.showSelected?11:-1))},dependencies:[oe,ae],styles:[".api-selector[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;overflow:hidden}.mode-tabs[_ngcontent-%COMP%]{display:flex;background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.25rem}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.625rem .5rem;background:transparent;border:none;border-radius:.5rem;color:var(--text-muted, #94a3b8);font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s}.mode-tab[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.mode-tab.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.mode-content[_ngcontent-%COMP%]{padding:1rem}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:2rem;color:var(--text-muted, #94a3b8)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:1.5rem}.empty-icon[_ngcontent-%COMP%]{font-size:2rem;display:block;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-secondary, #cbd5e1)}.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);margin-bottom:1rem}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);border:none;border-radius:.5rem;color:#fff;font-size:.8rem;cursor:pointer}.recommended-card[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid var(--primary, #06b6d4);border-radius:.75rem;padding:1rem;position:relative}.recommend-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;right:12px;padding:.25rem .75rem;background:var(--primary, #06b6d4);border-radius:1rem;font-size:.7rem;color:#fff;font-weight:600}.api-info[_ngcontent-%COMP%]{margin-bottom:.75rem}.api-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white);font-size:1rem}.api-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-quota[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.quota-bar[_ngcontent-%COMP%]{flex:1;height:6px;background:#ffffff1a;border-radius:3px;overflow:hidden}.quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#22c55e,#06b6d4);border-radius:3px}.quota-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #cbd5e1);min-width:40px}.use-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.recommend-reason[_ngcontent-%COMP%]{margin:.75rem 0 0;font-size:.75rem;color:var(--text-muted, #94a3b8);text-align:center}.api-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto}.api-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.api-item[_ngcontent-%COMP%]:hover:not(.disabled){border-color:var(--primary, #06b6d4)}.api-item.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.api-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.api-item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.api-item-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white);font-size:.875rem}.api-item-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.api-item-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.quota-badge[_ngcontent-%COMP%]{padding:.125rem .5rem;background:#22c55e33;border-radius:.25rem;font-size:.7rem;color:#86efac}.quota-badge.warning[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.quota-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.status-badge[_ngcontent-%COMP%]{padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}.status-badge.recommend[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.status-badge.inactive[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.status-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.confirm-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;margin-top:.75rem}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.pool-footer[_ngcontent-%COMP%]{margin-top:.75rem;text-align:center}.add-more-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);font-size:.8rem;cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:.75rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.required[_ngcontent-%COMP%]{color:#ef4444}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;box-sizing:border-box}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.save-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.save-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.guide-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.25rem;margin-top:.75rem;font-size:.75rem}.guide-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.selected-display[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:#22c55e1a;border-top:1px solid rgba(34,197,94,.2)}.selected-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.selected-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.selected-name[_ngcontent-%COMP%]{font-weight:500;color:#86efac}.selected-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:1rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:var(--primary, #06b6d4);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};function $D(i,e){i&1&&(B(0,"span",21),l(1," \u751F\u6210\u4E2D... "))}function HD(i,e){i&1&&l(0," \u{1F4F7} \u751F\u6210\u4E8C\u7DAD\u78BC ")}function qD(i,e){if(i&1){let t=I();r(0,"div",6)(1,"div",7)(2,"p"),l(3,"\u4F7F\u7528 Telegram App \u6383\u63CF\u4E8C\u7DAD\u78BC\uFF0C\u5FEB\u901F\u6DFB\u52A0\u5E33\u865F\u3002"),s()(),r(4,"div",8)(5,"label",9),l(6,"\u{1F510} \u9078\u64C7 API \u6191\u64DA"),s(),r(7,"app-api-selector",10),x("apiSelected",function(o){_(t);let a=m();return v(a.onApiSelected(o))})("selectionCleared",function(){_(t);let o=m();return v(o.onApiCleared())}),s()(),r(8,"div",8)(9,"label",9),l(10,"\u{1F4F2} \u8A2D\u5099\u6A21\u64EC"),s(),r(11,"div",11)(12,"button",12),x("click",function(){_(t);let o=m();return v(o.deviceType.set("random"))}),l(13," \u{1F3B2} \u667A\u80FD\u96A8\u6A5F "),s(),r(14,"button",12),x("click",function(){_(t);let o=m();return v(o.deviceType.set("ios"))}),l(15," \u{1F4F1} iOS "),s(),r(16,"button",12),x("click",function(){_(t);let o=m();return v(o.deviceType.set("android"))}),l(17," \u{1F916} Android "),s(),r(18,"button",12),x("click",function(){_(t);let o=m();return v(o.deviceType.set("desktop"))}),l(19," \u{1F4BB} Desktop "),s()()(),r(20,"div",8)(21,"label",9),l(22,"\u{1F310} \u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),s(),r(23,"div",13)(24,"input",14),W("ngModelChange",function(o){_(t);let a=m();return q(a.proxyInput,o)||(a.proxyInput=o),v(o)}),s(),r(25,"button",15),x("click",function(){_(t);let o=m();return v(o.selectRandomProxy())}),l(26," \u{1F3B2} "),s()(),r(27,"div",16)(28,"input",17),W("ngModelChange",function(o){_(t);let a=m();return q(a.bindProxyToAccount,o)||(a.bindProxyToAccount=o),v(o)}),s(),r(29,"label",18),l(30,"\u70BA\u6B64\u5E33\u865F\u7D81\u5B9A\u6B64\u4EE3\u7406 IP\uFF08\u63A8\u85A6\uFF09"),s()()(),r(31,"div",8)(32,"label",9),l(33,"\u{1F510} \u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09"),s(),r(34,"input",19),W("ngModelChange",function(o){_(t);let a=m();return q(a.twoFactorPassword,o)||(a.twoFactorPassword=o),v(o)}),s()(),r(35,"button",20),x("click",function(){_(t);let o=m();return v(o.createQRLogin())}),y(36,$D,2,0)(37,HD,1,0),s()()}if(i&2){let t=m();c(7),L("showSelected",!1),c(5),N("active",t.deviceType()==="random"),c(2),N("active",t.deviceType()==="ios"),c(2),N("active",t.deviceType()==="android"),c(2),N("active",t.deviceType()==="desktop"),c(6),H("ngModel",t.proxyInput),c(4),H("ngModel",t.bindProxyToAccount),c(6),H("ngModel",t.twoFactorPassword),c(),L("disabled",t.isCreating()||!t.selectedApi()),c(),S(t.isCreating()?36:37)}}function WD(i,e){if(i&1&&B(0,"img",28),i&2){let t=m(3);L("src","data:image/png;base64,"+t.session().qrImageBase64,ot)}}function zD(i,e){i&1&&(r(0,"div",29),B(1,"span",36),s())}function KD(i,e){if(i&1&&(r(0,"div",27),y(1,WD,1,1,"img",28)(2,zD,2,0,"div",29),s(),r(3,"div",30)(4,"div",31),l(5),s(),r(6,"p",32),l(7," 1. \u6253\u958B Telegram App"),B(8,"br"),l(9," 2. \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC"),B(10,"br"),l(11," 3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u767B\u5165 "),s()(),r(12,"div",33)(13,"span",34),l(14,"\u6A21\u64EC\u8A2D\u5099:"),s(),r(15,"span",35),l(16),s()()),i&2){let t,n=m(2);c(),S(n.session().qrImageBase64?1:2),c(3),N("warning",n.countdown()<=10),c(),M(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A",n.countdown()," \u79D2 "),c(11),X("",(t=n.session().deviceInfo)==null?null:t.model," (",(t=n.session().deviceInfo)==null?null:t.system,")")}}function jD(i,e){i&1&&(B(0,"span",21),l(1," \u9A57\u8B49\u4E2D... "))}function JD(i,e){i&1&&l(0," \u78BA\u8A8D ")}function QD(i,e){if(i&1){let t=I();r(0,"div",23)(1,"div",37),l(2,"\u{1F510}"),s(),r(3,"h4"),l(4,"\u9700\u8981\u4E8C\u6B65\u9A57\u8B49"),s(),r(5,"p"),l(6,"\u8ACB\u8F38\u5165\u60A8\u7684\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF1A"),s(),r(7,"input",38),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.twoFactorInput,o)||(a.twoFactorInput=o),v(o)}),x("keyup.enter",function(){_(t);let o=m(2);return v(o.submit2FA())}),s(),r(8,"button",39),x("click",function(){_(t);let o=m(2);return v(o.submit2FA())}),y(9,jD,2,0)(10,JD,1,0),s()()}if(i&2){let t=m(2);c(7),H("ngModel",t.twoFactorInput),c(),L("disabled",!t.twoFactorInput||t.isSubmitting2FA()),c(),S(t.isSubmitting2FA()?9:10)}}function YD(i,e){if(i&1&&l(0),i&2){let t=m(4);M(" ",t.session().userInfo.lastName," ")}}function XD(i,e){if(i&1&&(r(0,"div",48),l(1),s()),i&2){let t=m(4);c(),D("@"+t.session().userInfo.username)}}function ZD(i,e){if(i&1&&(r(0,"div",41)(1,"div",44),l(2),s(),r(3,"div",45)(4,"div",46),l(5),y(6,YD,1,1),s(),r(7,"div",47),l(8),s(),y(9,XD,2,1,"div",48),s()()),i&2){let t=m(3);c(2),M(" ",(t.session().userInfo.firstName||"?").charAt(0).toUpperCase()," "),c(3),M(" ",t.session().userInfo.firstName," "),c(),S(t.session().userInfo.lastName?6:-1),c(2),D(t.session().phone),c(),S(t.session().userInfo.username?9:-1)}}function e6(i,e){if(i&1){let t=I();r(0,"div",24)(1,"div",40),l(2,"\u2705"),s(),r(3,"h4"),l(4,"\u767B\u5165\u6210\u529F\uFF01"),s(),y(5,ZD,10,5,"div",41),r(6,"p",42),l(7,"\u5E33\u865F\u5DF2\u6210\u529F\u6DFB\u52A0\uFF0C\u6B63\u5728\u5F8C\u53F0\u5347\u7D1A\u70BA\u539F\u751F API..."),s(),r(8,"button",43),x("click",function(){_(t);let o=m(2);return v(o.onClose())}),l(9,"\u5B8C\u6210"),s()()}if(i&2){let t=m(2);c(5),S(t.session().userInfo?5:-1)}}function t6(i,e){if(i&1){let t=I();r(0,"div",25)(1,"div",37),l(2,"\u23F0"),s(),r(3,"h4"),l(4,"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"),s(),r(5,"p"),l(6,"\u8ACB\u9EDE\u64CA\u4E0B\u65B9\u6309\u9215\u91CD\u65B0\u751F\u6210\u3002"),s(),r(7,"button",49),x("click",function(){_(t);let o=m(2);return v(o.refreshQR())}),l(8,"\u{1F504} \u91CD\u65B0\u751F\u6210"),s()()}}function n6(i,e){if(i&1){let t=I();r(0,"div",25)(1,"div",50),l(2,"\u274C"),s(),r(3,"h4"),l(4,"\u767B\u5165\u5931\u6557"),s(),r(5,"p"),l(6),s(),r(7,"button",49),x("click",function(){_(t);let o=m(2);return v(o.refreshQR())}),l(8,"\u{1F504} \u91CD\u8A66"),s()()}if(i&2){let t=m(2);c(6),D(t.session().message||"\u672A\u77E5\u932F\u8AA4")}}function i6(i,e){if(i&1){let t=I();r(0,"div",26)(1,"button",51),x("click",function(){_(t);let o=m(2);return v(o.refreshQR())}),l(2," \u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC "),s(),r(3,"button",52),x("click",function(){_(t);let o=m(2);return v(o.cancelLogin())}),l(4," \u274C \u53D6\u6D88 "),s()()}}function o6(i,e){if(i&1&&(r(0,"div",22),y(1,KD,17,6)(2,QD,11,3,"div",23)(3,e6,10,1,"div",24)(4,t6,9,0,"div",25)(5,n6,9,1,"div",25),s(),y(6,i6,5,0,"div",26)),i&2){let t,n=m();c(),S((t=n.session().status)==="pending"?1:t==="waiting_2fa"?2:t==="success"?3:t==="expired"?4:t==="error"?5:-1),c(5),S(n.session().status==="pending"?6:-1)}}var Zl=class i{constructor(){this.ipcService=F(Q);this.toast=F(J);this.i18n=F(Be);this.closed=new qe;this.loginSuccess=new qe;this.session=f(null);this.isCreating=f(!1);this.isSubmitting2FA=f(!1);this.countdown=f(60);this.deviceType=f("random");this.proxyInput="";this.twoFactorPassword="";this.twoFactorInput="";this.bindProxyToAccount=!0;this.selectedApi=f(null);this.countdownTimer=null;this.statusCheckTimer=null;this.createTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}onApiSelected(e){this.selectedApi.set(e)}onApiCleared(){this.selectedApi.set(null)}ngOnDestroy(){this.clearTimers(),this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.ipcChannels.forEach(e=>{this.ipcService.cleanup(e)}),this.ipcChannels=[]}setupIpcListeners(){this.ipcService.on("qr-login-created",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),console.log("[QR Login] QR code created successfully",e),e.success!==!1&&(this.session.set({sessionId:e.sessionId,qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,expiresIn:e.expiresIn,status:"pending",deviceInfo:e.deviceInfo,message:e.message}),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-created"),this.ipcService.on("qr-login-status",e=>{let t=this.session();t&&e.sessionId===t.sessionId&&this.session.set(P(E({},t),{status:e.status,message:e.message}))}),this.ipcChannels.push("qr-login-status"),this.ipcService.on("qr-login-success",e=>{this.clearTimers();let t=this.session();t&&this.session.set(P(E({},t),{status:"success",phone:e.phone,userInfo:e.userInfo,message:e.message})),this.toast.success(e.message||"\u767B\u5165\u6210\u529F\uFF01"),this.loginSuccess.emit(e)}),this.ipcChannels.push("qr-login-success"),this.ipcService.on("qr-login-refreshed",e=>{let t=this.session();t&&e.success!==!1&&(this.session.set(P(E({},t),{qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,status:"pending"})),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-refreshed"),this.ipcService.on("qr-login-error",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),this.isSubmitting2FA.set(!1),console.error("[QR Login] Error:",e.error);let t=this.session();t&&this.session.set(P(E({},t),{status:"error",message:e.error})),this.toast.error(e.error||"\u64CD\u4F5C\u5931\u6557")}),this.ipcChannels.push("qr-login-error"),this.ipcService.on("qr-login-2fa-success",e=>{this.isSubmitting2FA.set(!1)}),this.ipcChannels.push("qr-login-2fa-success")}createQRLogin(){let e=this.selectedApi();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API \u6191\u64DA");return}this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!0);let t={proxy:this.proxyInput||null,deviceType:this.deviceType()==="random"?null:this.deviceType(),twoFactorPassword:this.twoFactorPassword||null,bindProxy:this.bindProxyToAccount,customApiId:e.api_id,customApiHash:e.api_hash};console.log("[QR Login] Creating QR login...",P(E({},t),{customApiHash:"***"})),this.createTimeout=setTimeout(()=>{this.isCreating()&&(console.error("[QR Login] Timeout waiting for QR code generation (60s)"),this.isCreating.set(!1),this.toast.error(`\u751F\u6210\u4E8C\u7DAD\u78BC\u8D85\u6642\uFF0860\u79D2\uFF09\uFF0C\u8ACB\u6AA2\u67E5\uFF1A
1. \u5F8C\u7AEF\u65E5\u8A8C\u662F\u5426\u6709\u932F\u8AA4
2. \u7DB2\u7D61\u9023\u63A5\u662F\u5426\u6B63\u5E38
3. \u4EE3\u7406\u8A2D\u7F6E\u662F\u5426\u6B63\u78BA
4. \u662F\u5426\u5DF2\u5B89\u88DD telethon \u548C qrcode \u5EAB`),this.createTimeout=null)},6e4),this.ipcService.send("qr-login-create",t)}refreshQR(){let e=this.session();e?this.ipcService.send("qr-login-refresh",{sessionId:e.sessionId}):this.createQRLogin()}submit2FA(){let e=this.session();!e||!this.twoFactorInput||(this.isSubmitting2FA.set(!0),this.ipcService.send("qr-login-submit-2fa",{sessionId:e.sessionId,password:this.twoFactorInput}))}cancelLogin(){let e=this.session();e&&this.ipcService.send("qr-login-cancel",{sessionId:e.sessionId}),this.clearTimers(),this.session.set(null)}onClose(){this.cancelLogin(),this.closed.emit()}selectRandomProxy(){this.toast.info("\u4EE3\u7406\u6C60\u529F\u80FD\u5373\u5C07\u63A8\u51FA")}startCountdown(e){this.clearTimers(),this.countdown.set(e),this.countdownTimer=setInterval(()=>{let t=this.countdown();if(t<=1){this.clearTimers();let n=this.session();n&&n.status==="pending"&&this.session.set(P(E({},n),{status:"expired",message:"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"}))}else this.countdown.set(t-1)},1e3)}clearTimers(){this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null),this.statusCheckTimer&&(clearInterval(this.statusCheckTimer),this.statusCheckTimer=null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-qr-login"]],outputs:{closed:"closed",loginSuccess:"loginSuccess"},decls:11,vars:1,consts:[[1,"qr-login-container"],[1,"header"],[1,"title"],[1,"icon"],[1,"close-btn",3,"click"],[1,"content"],[1,"setup-section"],[1,"info-box"],[1,"option-group"],[1,"option-label"],[3,"apiSelected","selectionCleared","showSelected"],[1,"device-options"],[1,"device-btn",3,"click"],[1,"proxy-input-group"],["type","text","placeholder","socks5://host:port \u6216\u7559\u7A7A\u4F7F\u7528\u76F4\u9023",1,"proxy-input",3,"ngModelChange","ngModel"],["title","\u96A8\u6A5F\u9078\u64C7\u4EE3\u7406",1,"random-proxy-btn",3,"click"],[1,"checkbox-option"],["type","checkbox","id","bindProxy",3,"ngModelChange","ngModel"],["for","bindProxy"],["type","password","placeholder","\u53EF\u9078\uFF0C\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49",1,"form-input",3,"ngModelChange","ngModel"],[1,"create-btn",3,"click","disabled"],[1,"spinner"],[1,"qr-section"],[1,"tfa-section"],[1,"success-section"],[1,"error-section"],[1,"action-buttons"],[1,"qr-display"],["alt","QR Code",1,"qr-image",3,"src"],[1,"qr-placeholder"],[1,"qr-info"],[1,"countdown"],[1,"instruction"],[1,"device-info"],[1,"label"],[1,"value"],[1,"spinner","large"],[1,"status-icon","warning"],["type","password","placeholder","\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input","tfa-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"submit-btn",3,"click","disabled"],[1,"status-icon","success"],[1,"user-info-card"],[1,"success-message"],[1,"done-btn",3,"click"],[1,"user-avatar"],[1,"user-details"],[1,"user-name"],[1,"user-phone"],[1,"user-username"],[1,"refresh-btn",3,"click"],[1,"status-icon","error"],[1,"action-btn","secondary",3,"click"],[1,"action-btn","cancel",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2)(3,"span",3),l(4,"\u{1F4F1}"),s(),l(5," \u6383\u78BC\u5FEB\u901F\u767B\u5165 "),s(),r(6,"button",4),x("click",function(){return n.onClose()}),l(7,"\xD7"),s()(),r(8,"div",5),y(9,qD,38,14,"div",6)(10,o6,7,2),s()()),t&2&&(c(9),S(n.session()?10:9))},dependencies:[oe,ae,xe,it,ve,he,qo],styles:[".qr-login-container[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .95));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;width:420px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px -12px #00000080}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary, white)}.icon[_ngcontent-%COMP%]{font-size:1.25rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);font-size:1.5rem;cursor:pointer;padding:.25rem;line-height:1}.close-btn[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.content[_ngcontent-%COMP%]{padding:1.5rem}.setup-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.info-box[_ngcontent-%COMP%]{background:#06b6d41a;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:1rem}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-secondary, #cbd5e1);font-size:.875rem}.info-box[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.75rem;margin-top:.5rem}.option-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.option-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary, #cbd5e1)}.device-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem}.device-btn[_ngcontent-%COMP%]{padding:.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);font-size:.75rem;cursor:pointer;transition:all .2s}.device-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.device-btn.active[_ngcontent-%COMP%]{background:#06b6d433;border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.proxy-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.proxy-input[_ngcontent-%COMP%]{flex:1;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.proxy-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.random-proxy-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s}.random-proxy-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.checkbox-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.checkbox-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.create-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;margin-top:.5rem}.create-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.create-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.qr-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.qr-display[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:.75rem}.qr-image[_ngcontent-%COMP%]{width:200px;height:200px;display:block}.qr-placeholder[_ngcontent-%COMP%]{width:200px;height:200px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.qr-info[_ngcontent-%COMP%]{text-align:center}.countdown[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--primary, #06b6d4);margin-bottom:.5rem}.countdown.warning[_ngcontent-%COMP%]{color:#f59e0b;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.instruction[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-muted, #94a3b8);line-height:1.6;margin:0}.device-info[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.5rem 1rem;border-radius:.5rem}.device-info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-right:.5rem}.tfa-section[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:1rem}.status-icon[_ngcontent-%COMP%]{font-size:3rem}.status-icon.success[_ngcontent-%COMP%]{color:#22c55e}.status-icon.warning[_ngcontent-%COMP%]{color:#f59e0b}.status-icon.error[_ngcontent-%COMP%]{color:#ef4444}.tfa-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.tfa-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-muted, #94a3b8);font-size:.875rem}.tfa-input[_ngcontent-%COMP%]{max-width:250px;text-align:center}.submit-btn[_ngcontent-%COMP%], .done-btn[_ngcontent-%COMP%], .refresh-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.refresh-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.user-info-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;width:100%}.user-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:700;color:#fff}.user-details[_ngcontent-%COMP%]{text-align:left}.user-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.user-phone[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.user-username[_ngcontent-%COMP%]{font-size:.75rem;color:var(--primary, #06b6d4)}.success-message[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem;width:100%}.action-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1rem;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;font-size:.875rem;cursor:pointer;transition:all .2s}.action-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-secondary, #cbd5e1)}.action-btn.secondary[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.action-btn.cancel[_ngcontent-%COMP%]{background:#ef44441a;border-color:#ef44444d;color:#fca5a5}.action-btn.cancel[_ngcontent-%COMP%]:hover{background:#ef444433}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.spinner.large[_ngcontent-%COMP%]{width:40px;height:40px;border-width:3px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.warning-box[_ngcontent-%COMP%]{background:#ef444426;border:1px solid rgba(239,68,68,.4);border-radius:.75rem;overflow:hidden}.warning-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#ef444433;border-bottom:1px solid rgba(239,68,68,.3)}.warning-icon[_ngcontent-%COMP%]{font-size:1.25rem}.warning-title[_ngcontent-%COMP%]{flex:1;font-weight:600;color:#fca5a5}.dismiss-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fca5a5;font-size:1.25rem;cursor:pointer;padding:0;line-height:1}.warning-content[_ngcontent-%COMP%]{padding:.75rem 1rem}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#fecaca;font-size:.8rem}.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:.5rem 0;padding-left:1.25rem;color:#fca5a5;font-size:.75rem}.warning-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.warning-action[_ngcontent-%COMP%]{margin-top:.75rem!important;padding-top:.5rem;border-top:1px solid rgba(239,68,68,.2)}.warning-action[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa;text-decoration:underline}.api-section[_ngcontent-%COMP%]{background:#06b6d40d;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:.75rem}.option-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.checkbox-option.inline[_ngcontent-%COMP%]{font-size:.75rem}.api-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.api-input-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.input-label[_ngcontent-%COMP%]{width:70px;font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-input-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1}.api-hint[_ngcontent-%COMP%]{margin:0;font-size:.7rem;color:var(--text-muted, #64748b)}.api-hint[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.public-api-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#ef44441a;border-radius:.25rem;font-size:.75rem;color:#fca5a5}.warning-badge[_ngcontent-%COMP%]{background:#ef44444d;padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}"]})}};var r6=()=>[],s6=(i,e)=>e.index;function a6(i,e){if(i&1){let t=I();r(0,"div",9)(1,"div",13)(2,"h2"),l(3,"\u{1F510} \u9078\u64C7 API \u6191\u64DA"),s(),r(4,"p"),l(5,"\u9078\u64C7\u6216\u6DFB\u52A0 API \u6191\u64DA\u4EE5\u9023\u63A5 Telegram"),s()(),r(6,"app-api-selector",14),x("apiSelected",function(o){_(t);let a=m();return v(a.onApiSelected(o))})("selectionCleared",function(){_(t);let o=m();return v(o.onApiCleared())}),s(),r(7,"div",15)(8,"button",16),x("click",function(){_(t);let o=m();return v(o.goBack())}),l(9,"\u2190 \u8FD4\u56DE"),s(),r(10,"button",17),x("click",function(){_(t);let o=m();return v(o.proceedToLogin())}),l(11," \u4E0B\u4E00\u6B65\uFF1A\u9078\u64C7\u767B\u5165\u65B9\u5F0F \u2192 "),s()()()}if(i&2){let t=m();c(6),L("showSelected",!0),c(4),L("disabled",!t.selectedApiCredential())}}function l6(i,e){if(i&1){let t=I();r(0,"div",10)(1,"div",13)(2,"h2"),l(3,"\u9078\u64C7\u767B\u5165\u65B9\u5F0F"),s(),r(4,"p"),l(5,"\u9078\u64C7\u6700\u9069\u5408\u60A8\u7684\u5E33\u865F\u767B\u5165\u65B9\u5F0F"),s()(),r(6,"div",18)(7,"div",19),x("click",function(){_(t);let o=m();return v(o.selectLoginMethod("code"))}),r(8,"div",20),l(9,"\u2705 \u63A8\u85A6"),s(),r(10,"div",21),l(11,"\u{1F4AC}"),s(),r(12,"h3"),l(13,"\u9A57\u8B49\u78BC\u767B\u5165"),s(),r(14,"p"),l(15,"\u8F38\u5165\u624B\u6A5F\u865F\uFF0C\u63A5\u6536\u9A57\u8B49\u78BC\u5B8C\u6210\u767B\u5165"),s(),r(16,"ul")(17,"li"),l(18,"\u{1F7E2} \u6A19\u6E96\u5B98\u65B9\u767B\u5165\u65B9\u5F0F"),s(),r(19,"li"),l(20,"\u{1F7E2} \u98A8\u96AA\u6700\u4F4E"),s(),r(21,"li"),l(22,"\u{1F7E1} \u9700\u8981\u80FD\u6536\u5230\u9A57\u8B49\u78BC"),s()(),r(23,"div",22),l(24,"\u98A8\u96AA\uFF1A\u4F4E"),s()(),r(25,"div",23),x("click",function(){_(t);let o=m();return v(o.selectLoginMethod("tdata"))}),r(26,"div",20),l(27,"\u{1F6E1}\uFE0F \u6700\u5B89\u5168"),s(),r(28,"div",21),l(29,"\u{1F4C2}"),s(),r(30,"h3"),l(31,"TData \u5C0E\u5165"),s(),r(32,"p"),l(33,"\u5C0E\u5165\u5DF2\u6709\u7684 Session \u6587\u4EF6"),s(),r(34,"ul")(35,"li"),l(36,"\u{1F7E2} \u7121\u9700\u91CD\u65B0\u767B\u5165"),s(),r(37,"li"),l(38,"\u{1F7E2} \u98A8\u96AA\u6700\u4F4E"),s(),r(39,"li"),l(40,"\u{1F7E2} \u652F\u6301\u6279\u91CF\u5C0E\u5165"),s()(),r(41,"div",24),l(42,"\u98A8\u96AA\uFF1A\u6700\u4F4E"),s()(),r(43,"div",25),x("click",function(){_(t);let o=m();return v(o.selectLoginMethod("qr"))}),r(44,"div",20),l(45,"\u26A0\uFE0F \u9700\u8B39\u614E"),s(),r(46,"div",21),l(47,"\u{1F4F1}"),s(),r(48,"h3"),l(49,"\u6383\u78BC\u767B\u5165"),s(),r(50,"p"),l(51,"\u4F7F\u7528 Telegram APP \u6383\u63CF\u4E8C\u7DAD\u78BC"),s(),r(52,"ul")(53,"li"),l(54,"\u{1F7E2} \u7121\u9700\u9A57\u8B49\u78BC"),s(),r(55,"li"),l(56,"\u{1F7E1} \u9700\u8981\u624B\u6A5F\u5728\u65C1"),s(),r(57,"li"),l(58,"\u{1F534} \u7B2C\u4E09\u65B9\u7279\u5FB5\uFF0C\u98A8\u96AA\u8F03\u9AD8"),s()(),r(59,"div",26),l(60,"\u98A8\u96AA\uFF1A\u8F03\u9AD8"),s()()(),r(61,"div",15)(62,"button",16),x("click",function(){_(t);let o=m();return v(o.currentStep.set(1))}),l(63,"\u2190 \u8FD4\u56DE"),s()()()}}function c6(i,e){i&1&&(r(0,"span",32),l(1,"\u2713"),s())}function d6(i,e){if(i&1&&(r(0,"span",33),l(1),s()),i&2){let t=m(3);c(),D(t.phoneError())}}function u6(i,e){i&1&&(r(0,"span",34),l(1,"\u8ACB\u5305\u542B\u570B\u5BB6\u4EE3\u78BC\uFF0C\u4F8B\u5982 +63, +86, +1"),s())}function m6(i,e){i&1&&(B(0,"span",37),l(1," \u767C\u9001\u4E2D... "))}function p6(i,e){i&1&&l(0," \u767C\u9001\u9A57\u8B49\u78BC \u2192 ")}function g6(i,e){if(i&1){let t=I();r(0,"div",28)(1,"label"),l(2,"\u624B\u6A5F\u865F\u78BC "),r(3,"span",29),l(4,"*"),s()(),r(5,"div",30)(6,"input",31),x("ngModelChange",function(o){_(t);let a=m(2);return v(a.onPhoneChange(o))}),s(),y(7,c6,2,0,"span",32),s(),y(8,d6,2,1,"span",33)(9,u6,2,0,"span",34),s(),r(10,"div",28)(11,"label"),l(12,"\u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),s(),r(13,"input",35),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.proxyAddress,o)||(a.proxyAddress=o),v(o)}),s()(),r(14,"div",28)(15,"label"),l(16,"\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09"),s(),r(17,"input",36),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.twoFactorPassword,o)||(a.twoFactorPassword=o),v(o)}),s()(),r(18,"div",15)(19,"button",16),x("click",function(){_(t);let o=m(2);return v(o.currentLoginMethod.set("select"))}),l(20,"\u2190 \u8FD4\u56DE"),s(),r(21,"button",17),x("click",function(){_(t);let o=m(2);return v(o.sendVerificationCode())}),y(22,m6,2,0)(23,p6,1,0),s()()}if(i&2){let t=m(2);c(6),N("error",t.phoneError())("valid",t.phoneValid()),L("ngModel",t.phoneNumber),c(),S(t.phoneValid()?7:-1),c(),S(t.phoneError()?8:9),c(5),H("ngModel",t.proxyAddress),c(4),H("ngModel",t.twoFactorPassword),c(4),L("disabled",!t.phoneValid()||t.isSending()),c(),S(t.isSending()?22:23)}}function h6(i,e){if(i&1){let t=I();r(0,"div",28)(1,"label"),l(2,"\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC "),r(3,"span",29),l(4,"*"),s()(),r(5,"input",43),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.twoFactorPassword,o)||(a.twoFactorPassword=o),v(o)}),s()()}if(i&2){let t=m(3);c(5),H("ngModel",t.twoFactorPassword)}}function f6(i,e){if(i&1&&l(0),i&2){let t=m(3);M(" ",t.resendCooldown(),"\u79D2\u5F8C\u53EF\u91CD\u767C ")}}function _6(i,e){i&1&&l(0," \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC ")}function v6(i,e){i&1&&(B(0,"span",37),l(1," \u9A57\u8B49\u4E2D... "))}function x6(i,e){i&1&&l(0," \u9A57\u8B49\u4E26\u767B\u5165 \u2192 ")}function C6(i,e){if(i&1){let t=I();r(0,"div",38)(1,"span",39),l(2,"\u{1F4F1}"),s(),l(3),s(),r(4,"div",28)(5,"label"),l(6,"\u9A57\u8B49\u78BC "),r(7,"span",29),l(8,"*"),s()(),r(9,"input",40),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.verificationCode,o)||(a.verificationCode=o),v(o)}),s()(),y(10,h6,6,1,"div",28),r(11,"div",41)(12,"button",42),x("click",function(){_(t);let o=m(2);return v(o.resendCode())}),y(13,f6,1,1)(14,_6,1,0),s()(),r(15,"div",15)(16,"button",16),x("click",function(){_(t);let o=m(2);return v(o.codeStep.set(!1))}),l(17,"\u2190 \u8FD4\u56DE"),s(),r(18,"button",17),x("click",function(){_(t);let o=m(2);return v(o.submitVerificationCode())}),y(19,v6,2,0)(20,x6,1,0),s()()}if(i&2){let t=m(2);c(3),M(" \u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 ",t.phoneNumber," "),c(6),H("ngModel",t.verificationCode),c(),S(t.needs2FA()?10:-1),c(2),L("disabled",t.resendCooldown()>0),c(),S(t.resendCooldown()>0?13:14),c(5),L("disabled",!t.verificationCode||t.isVerifying()),c(),S(t.isVerifying()?19:20)}}function b6(i,e){if(i&1&&(r(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4AC} \u9A57\u8B49\u78BC\u767B\u5165"),s()(),r(4,"div",27),y(5,g6,24,11)(6,C6,21,7),s()()),i&2){let t=m();c(5),S(t.codeStep()?6:5)}}function y6(i,e){if(i&1&&(r(0,"span",69),l(1),s()),i&2){let t=m().$implicit;c(),D(t.first_name||t.username)}}function S6(i,e){if(i&1&&(r(0,"span",70),l(1),s()),i&2){let t=m().$implicit;c(),D(t.error||"\u7121\u6CD5\u5C0E\u5165")}}function w6(i,e){if(i&1){let t=I();r(0,"label",65)(1,"input",66),x("change",function(){let o=_(t).$implicit,a=m(5);return v(a.toggleTdataAccount(o.index))}),s(),r(2,"div",67)(3,"span",68),l(4),s(),y(5,y6,2,1,"span",69),y(6,S6,2,1,"span",70),s()()}if(i&2){let t=e.$implicit,n=m(5);N("disabled",!t.can_import),c(),L("checked",n.selectedTdataAccounts().includes(t.index))("disabled",!t.can_import),c(3),D(t.phone),c(),S(t.first_name||t.username?5:-1),c(),S(t.can_import?-1:6)}}function E6(i,e){if(i&1&&(r(0,"div",61)(1,"h4"),l(2),s(),r(3,"div",63),O(4,w6,7,7,"label",64,s6),s()()),i&2){let t,n=m(4);c(2),M("\u{1F4CB} \u6AA2\u6E2C\u5230 ",((t=n.tdataScanResult().accounts)==null?null:t.length)||0," \u500B\u5E33\u865F"),c(2),U(n.tdataScanResult().accounts||rt(1,r6))}}function D6(i,e){if(i&1&&(r(0,"div",62)(1,"span",71),l(2,"\u274C"),s(),r(3,"span"),l(4),s()()),i&2){let t=m(4);c(4),D(t.tdataScanResult().error||"\u6383\u63CF\u5931\u6557")}}function A6(i,e){if(i&1&&y(0,E6,6,2,"div",61)(1,D6,5,1,"div",62),i&2){let t=m(3);S(t.tdataScanResult().success?0:1)}}function M6(i,e){i&1&&(r(0,"div",60),B(1,"span",37),r(2,"span"),l(3,"\u6B63\u5728\u6383\u63CF TData..."),s()())}function T6(i,e){if(i&1){let t=I();r(0,"div",48)(1,"h4"),l(2,"\u{1F4CD} TData \u4F4D\u7F6E"),s(),r(3,"div",49)(4,"code"),l(5),s(),r(6,"div",50)(7,"button",51),x("click",function(){_(t);let o=m(2);return v(o.copyTdataPath())}),l(8,"\u{1F4CB}"),s(),r(9,"button",52),x("click",function(){_(t);let o=m(2);return v(o.openTdataFolder())}),l(10,"\u{1F4C2}"),s()()()(),r(11,"div",53),x("dragover",function(o){_(t);let a=m(2);return v(a.onDragOver(o))})("dragleave",function(o){_(t);let a=m(2);return v(a.onDragLeave(o))})("drop",function(o){_(t);let a=m(2);return v(a.onDropTdata(o))}),r(12,"div",54),l(13,"\u{1F4C1}"),s(),r(14,"p",55),l(15,"\u62D6\u653E tdata \u6587\u4EF6\u593E\u5230\u9019\u88E1"),s(),r(16,"p",56),l(17,"\u652F\u6301\uFF1A\u6574\u500B\u6587\u4EF6\u593E / ZIP \u58D3\u7E2E\u5305"),s(),r(18,"div",57)(19,"button",58),x("click",function(){_(t);let o=m(2);return v(o.selectTdataFolder())}),l(20,"\u9078\u64C7\u6587\u4EF6\u593E"),s(),r(21,"button",59),x("click",function(){_(t);let o=m(2);return v(o.selectTdataZip())}),l(22,"\u9078\u64C7 ZIP"),s()()(),y(23,A6,2,1),y(24,M6,4,0,"div",60)}if(i&2){let t=m(2);c(5),D(t.getDefaultTdataPath()),c(6),N("dragging",t.isDragging()),c(12),S(t.tdataScanResult()?23:-1),c(),S(t.isScanningTdata()?24:-1)}}function k6(i,e){if(i&1){let t=I();r(0,"div",74)(1,"span",75),l(2,"\u{1F4C4}"),s(),r(3,"span",76),l(4),s(),r(5,"button",77),x("click",function(){_(t);let o=m(3);return v(o.clearSelectedFile())}),l(6,"\xD7"),s()()}if(i&2){let t=m(3);c(4),D(t.selectedFilePath())}}function I6(i,e){if(i&1){let t=I();r(0,"div",72)(1,"h4"),l(2,"\u652F\u6301\u7684\u683C\u5F0F"),s(),r(3,"ul")(4,"li")(5,"strong"),l(6,".tgpkg"),s(),l(7," - TG-Matrix \u5C0E\u51FA\u5305\uFF08\u63A8\u85A6\uFF09"),s(),r(8,"li")(9,"strong"),l(10,".session"),s(),l(11," - Pyrogram Session \u6587\u4EF6"),s(),r(12,"li")(13,"strong"),l(14,".telethon.session"),s(),l(15," - Telethon Session \u6587\u4EF6"),s()()(),r(16,"div",73),x("dragover",function(o){_(t);let a=m(2);return v(a.onDragOver(o))})("dragleave",function(o){_(t);let a=m(2);return v(a.onDragLeave(o))})("drop",function(o){_(t);let a=m(2);return v(a.onDrop(o))})("click",function(){_(t);let o=m(2);return v(o.selectSessionFile())}),r(17,"div",54),l(18,"\u{1F4C4}"),s(),r(19,"p",55),l(20,"\u62D6\u653E Session \u6587\u4EF6\u5230\u9019\u88E1"),s(),r(21,"p",56),l(22,"\u6216\u9EDE\u64CA\u9078\u64C7\u6587\u4EF6"),s()(),y(23,k6,7,1,"div",74)}if(i&2){let t=m(2);c(16),N("dragging",t.isDragging()),c(7),S(t.selectedFilePath()?23:-1)}}function F6(i,e){i&1&&(B(0,"span",37),l(1," \u5C0E\u5165\u4E2D... "))}function P6(i,e){if(i&1&&l(0),i&2){let t=m(3);M(" \u5C0E\u5165 ",t.selectedTdataAccounts().length," \u500B\u5E33\u865F \u2192 ")}}function R6(i,e){if(i&1){let t=I();r(0,"button",17),x("click",function(){_(t);let o=m(2);return v(o.importTdataAccounts())}),y(1,F6,2,0)(2,P6,1,1),s()}if(i&2){let t=m(2);L("disabled",t.selectedTdataAccounts().length===0||t.isImporting()),c(),S(t.isImporting()?1:2)}}function N6(i,e){i&1&&(B(0,"span",37),l(1," \u5C0E\u5165\u4E2D... "))}function V6(i,e){i&1&&l(0," \u5C0E\u5165 Session \u2192 ")}function B6(i,e){if(i&1){let t=I();r(0,"button",17),x("click",function(){_(t);let o=m(2);return v(o.importSession())}),y(1,N6,2,0)(2,V6,1,0),s()}if(i&2){let t=m(2);L("disabled",!t.selectedFilePath()||t.isImporting()),c(),S(t.isImporting()?1:2)}}function L6(i,e){if(i&1){let t=I();r(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4C2} TData / Session \u5C0E\u5165"),s()(),r(4,"div",27)(5,"div",44)(6,"button",45),x("click",function(){_(t);let o=m();return v(o.tdataImportMode.set("tdata"))}),l(7," \u{1F4C2} TData \u6587\u4EF6\u593E "),r(8,"span",46),l(9,"\u63A8\u85A6"),s()(),r(10,"button",45),x("click",function(){_(t);let o=m();return v(o.tdataImportMode.set("session"))}),l(11," \u{1F4C4} Session \u6587\u4EF6 "),s()(),y(12,T6,25,5),y(13,I6,24,3),r(14,"div",15)(15,"button",16),x("click",function(){_(t);let o=m();return v(o.currentLoginMethod.set("select"))}),l(16,"\u2190 \u8FD4\u56DE"),s(),y(17,R6,3,2,"button",47)(18,B6,3,2,"button",47),s()()()}if(i&2){let t=m();c(6),N("active",t.tdataImportMode()==="tdata"),c(4),N("active",t.tdataImportMode()==="session"),c(2),S(t.tdataImportMode()==="tdata"?12:-1),c(),S(t.tdataImportMode()==="session"?13:-1),c(4),S(t.tdataImportMode()==="tdata"?17:18)}}function O6(i,e){if(i&1){let t=I();r(0,"div",15)(1,"button",16),x("click",function(){_(t);let o=m(2);return v(o.currentLoginMethod.set("select"))}),l(2,"\u2190 \u8FD4\u56DE"),s(),r(3,"button",81),x("click",function(){_(t);let o=m(2);return v(o.generateQRCode())}),l(4,"\u751F\u6210\u4E8C\u7DAD\u78BC \u2192"),s()()}}function U6(i,e){if(i&1){let t=I();r(0,"div",82)(1,"div",83),B(2,"img",84),s(),r(3,"div",85),l(4),s(),r(5,"div",86)(6,"p"),l(7,"1. \u6253\u958B\u624B\u6A5F Telegram APP"),s(),r(8,"p"),l(9,"2. \u524D\u5F80 \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC"),s(),r(10,"p"),l(11,"3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u6388\u6B0A"),s()()(),r(12,"div",15)(13,"button",16),x("click",function(){_(t);let o=m(2);return v(o.currentLoginMethod.set("select"))}),l(14,"\u2190 \u8FD4\u56DE"),s(),r(15,"button",81),x("click",function(){_(t);let o=m(2);return v(o.refreshQRCode())}),l(16,"\u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC"),s()()}if(i&2){let t=m(2);c(2),L("src","data:image/png;base64,"+t.qrImageBase64(),ot),c(),N("warning",t.qrCountdown()<=10),c(),M(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A",t.qrCountdown()," \u79D2 ")}}function G6(i,e){if(i&1){let t=I();r(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4F1} \u6383\u78BC\u767B\u5165"),s()(),r(4,"div",27)(5,"div",28)(6,"label"),l(7,"\u8A2D\u5099\u6A21\u64EC"),s(),r(8,"div",78)(9,"button",79),x("click",function(){_(t);let o=m();return v(o.deviceType.set("random"))}),l(10,"\u{1F3B2} \u96A8\u6A5F"),s(),r(11,"button",79),x("click",function(){_(t);let o=m();return v(o.deviceType.set("ios"))}),l(12,"\u{1F4F1} iOS"),s(),r(13,"button",79),x("click",function(){_(t);let o=m();return v(o.deviceType.set("android"))}),l(14,"\u{1F916} Android"),s()()(),r(15,"div",28)(16,"label"),l(17,"\u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),s(),r(18,"input",80),W("ngModelChange",function(o){_(t);let a=m();return q(a.proxyAddress,o)||(a.proxyAddress=o),v(o)}),s()(),y(19,O6,5,0,"div",15)(20,U6,17,4),s()()}if(i&2){let t=m();c(9),N("active",t.deviceType()==="random"),c(2),N("active",t.deviceType()==="ios"),c(2),N("active",t.deviceType()==="android"),c(5),H("ngModel",t.proxyAddress),c(),S(t.qrImageBase64()?20:19)}}function $6(i,e){if(i&1&&(r(0,"div",92),l(1),s()),i&2){let t=m(3);c(),D("@"+t.addedAccountInfo().username)}}function H6(i,e){if(i&1&&(r(0,"div",93)(1,"span",94),l(2),s()()),i&2){let t=m(3);c(2),M("\u{1F510} ",t.selectedApiCredential().name||"API "+t.selectedApiCredential().api_id)}}function q6(i,e){if(i&1&&(r(0,"div",89)(1,"div",90),l(2),s(),r(3,"div",91)(4,"div",69),l(5),s(),r(6,"div",68),l(7),s(),y(8,$6,2,1,"div",92),s()(),y(9,H6,3,1,"div",93)),i&2){let t=m(2);c(2),M(" ",(t.addedAccountInfo().firstName||t.addedAccountInfo().phone||"?").charAt(0).toUpperCase()," "),c(3),X(" ",t.addedAccountInfo().firstName||""," ",t.addedAccountInfo().lastName||""," "),c(2),D(t.addedAccountInfo().phone),c(),S(t.addedAccountInfo().username?8:-1),c(),S(t.selectedApiCredential()?9:-1)}}function W6(i,e){if(i&1){let t=I();r(0,"div",12)(1,"div",87),l(2,"\u2705"),s(),r(3,"h2"),l(4,"\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01"),s(),y(5,q6,10,6),r(6,"div",88)(7,"button",16),x("click",function(){_(t);let o=m();return v(o.addAnother())}),l(8,"\u2795 \u7E7C\u7E8C\u6DFB\u52A0"),s(),r(9,"button",81),x("click",function(){_(t);let o=m();return v(o.goBack())}),l(10,"\u8FD4\u56DE\u5E33\u6236\u5217\u8868 \u2192"),s()()()}if(i&2){let t=m();c(5),S(t.addedAccountInfo()?5:-1)}}var ec=class i{constructor(){this.ipcService=F(Q);this.toast=F(J);this.membershipService=F(Ie);this.back=new qe;this.accountAdded=new qe;this.currentStep=f(1);this.currentLoginMethod=f("select");this.selectedApiCredential=f(null);this.phoneCodeHash="";this.loginAccountId="";this.phoneNumber="";this.verificationCode="";this.twoFactorPassword="";this.proxyAddress="";this.codeStep=f(!1);this.isSending=f(!1);this.isVerifying=f(!1);this.needs2FA=f(!1);this.resendCooldown=f(0);this.phoneError=f("");this.phoneValid=f(!1);this.deviceType=f("random");this.qrImageBase64=f("");this.qrCountdown=f(60);this.isDragging=f(!1);this.selectedFilePath=f("");this.isImporting=f(!1);this.tdataImportMode=f("tdata");this.tdataScanResult=f(null);this.selectedTdataAccounts=f([]);this.isScanningTdata=f(!1);this.defaultTdataPath=f("");this.addedAccountInfo=f(null);this.resendTimer=null;this.qrTimer=null;this.sendTimeout=null;this.verifyTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}ngOnDestroy(){this.resendTimer&&clearInterval(this.resendTimer),this.qrTimer&&clearInterval(this.qrTimer),this.sendTimeout&&clearTimeout(this.sendTimeout),this.verifyTimeout&&clearTimeout(this.verifyTimeout),this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("login-requires-code",e=>{this.isSending.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),(e.phone===this.phoneNumber||e.accountId)&&(this.phoneCodeHash=e.phoneCodeHash,this.loginAccountId=e.accountId,this.codeStep.set(!0),this.startResendCooldown(),(e.sendType||"app")==="sms"?this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3\u624B\u6A5F\u77ED\u4FE1"):this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 Telegram App"))}),this.ipcChannels.push("login-requires-code"),this.ipcService.on("login-success",e=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.addedAccountInfo.set(e.userInfo||{phone:this.phoneNumber}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u767B\u5165\u6210\u529F\uFF01")}),this.ipcChannels.push("login-success"),this.ipcService.on("login-requires-2fa",e=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.needs2FA.set(!0),this.toast.info("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC")}),this.ipcChannels.push("login-requires-2fa"),this.ipcService.on("login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("login-error"),this.ipcService.on("account-login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("account-login-error"),this.ipcService.on("qr-login-created",e=>{e.success!==!1&&e.qrImageBase64?(this.qrImageBase64.set(e.qrImageBase64),this.startQRCountdown()):this.toast.error(e.error||"\u751F\u6210\u4E8C\u7DAD\u78BC\u5931\u6557")}),this.ipcChannels.push("qr-login-created"),this.ipcService.on("qr-login-success",e=>{this.stopQRCountdown(),this.addedAccountInfo.set(e.userInfo||e),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u767B\u5165\u6210\u529F\uFF01")}),this.ipcChannels.push("qr-login-success"),this.ipcService.on("session-imported",e=>{this.isImporting.set(!1),e.success?(this.addedAccountInfo.set(e.account||{phone:e.phone}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u5C0E\u5165\u6210\u529F\uFF01")):this.toast.error(e.error||"\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("session-imported"),this.ipcService.on("session-file-selected",e=>{e.path&&this.selectedFilePath.set(e.path)}),this.ipcChannels.push("session-file-selected"),this.ipcService.on("tdata-folder-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-folder-selected"),this.ipcService.on("tdata-zip-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-zip-selected"),this.ipcService.on("tdata-scan-result",e=>{if(this.isScanningTdata.set(!1),this.tdataScanResult.set(e),e.success&&e.accounts?.length>0){let t=e.accounts.filter(n=>n.can_import).map(n=>n.index);this.selectedTdataAccounts.set(t),this.toast.success(`\u627E\u5230 ${e.accounts.length} \u500B\u5E33\u865F`)}else e.error&&this.toast.error(e.error)}),this.ipcChannels.push("tdata-scan-result"),this.ipcService.on("tdata-import-result",e=>{this.isImporting.set(!1),e.success?(this.addedAccountInfo.set({phone:e.phone,first_name:e.first_name,last_name:e.last_name,username:e.username}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success(`\u5E33\u865F ${e.phone} \u5C0E\u5165\u6210\u529F\uFF01`)):this.toast.error(e.error||"\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-import-result"),this.ipcService.on("tdata-batch-result",e=>{this.isImporting.set(!1),e.success_count>0?(this.currentStep.set(3),this.addedAccountInfo.set({batch:!0,count:e.success_count,failed:e.fail_count}),this.toast.success(`\u6210\u529F\u5C0E\u5165 ${e.success_count} \u500B\u5E33\u865F`),e.fail_count>0&&this.toast.warning(`${e.fail_count} \u500B\u5E33\u865F\u5C0E\u5165\u5931\u6557`)):this.toast.error(e.error||"\u6240\u6709\u5E33\u865F\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-batch-result"),this.ipcService.on("tdata-import-progress",e=>{console.log(`TData import progress: ${e.current}/${e.total}`)}),this.ipcChannels.push("tdata-import-progress")}onApiSelected(e){this.selectedApiCredential.set(e)}onApiCleared(){this.selectedApiCredential.set(null)}proceedToLogin(){this.selectedApiCredential()&&this.currentStep.set(2)}selectLoginMethod(e){this.currentLoginMethod.set(e)}goBack(){this.back.emit()}addAnother(){this.currentStep.set(1),this.currentLoginMethod.set("select"),this.selectedApiCredential.set(null),this.resetForm()}openUpgrade(){window.dispatchEvent(new CustomEvent("open-membership-dialog"))}resetForm(){this.phoneNumber="",this.verificationCode="",this.twoFactorPassword="",this.proxyAddress="",this.phoneCodeHash="",this.loginAccountId="",this.codeStep.set(!1),this.qrImageBase64.set(""),this.selectedFilePath.set(""),this.needs2FA.set(!1),this.addedAccountInfo.set(null)}validatePhone(e){if(!e)return{valid:!1,error:""};let t=e.trim();if(!t.startsWith("+"))return{valid:!1,error:"\u865F\u78BC\u5FC5\u9808\u4EE5 + \u958B\u982D\uFF0C\u4F8B\u5982 +63\u3001+86\u3001+1"};let n=t.slice(1);return/^\d+$/.test(n)?n.length<8?{valid:!1,error:"\u865F\u78BC\u9577\u5EA6\u4E0D\u8DB3\uFF08\u81F3\u5C11\u9700\u8981 8 \u4F4D\u6578\u5B57\uFF09"}:n.length>15?{valid:!1,error:"\u865F\u78BC\u9577\u5EA6\u904E\u9577\uFF08\u6700\u591A 15 \u4F4D\u6578\u5B57\uFF09"}:{valid:!0,error:""}:{valid:!1,error:"\u865F\u78BC\u53EA\u80FD\u5305\u542B\u6578\u5B57\uFF08+ \u865F\u5F8C\u9762\uFF09"}}onPhoneChange(e){this.phoneNumber=e;let t=this.validatePhone(e);this.phoneValid.set(t.valid),this.phoneError.set(t.error)}sendVerificationCode(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}if(!this.phoneNumber){this.phoneError.set("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC"),this.toast.error("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC");return}let t=this.validatePhone(this.phoneNumber);if(!t.valid){this.phoneError.set(t.error),this.toast.error(t.error);return}this.sendTimeout&&clearTimeout(this.sendTimeout),this.isSending.set(!0),this.phoneError.set(""),this.ipcService.send("add-account",{phone:this.phoneNumber,apiId:e.api_id,apiHash:e.api_hash,proxy:this.proxyAddress||null,twoFactorPassword:this.twoFactorPassword||null}),setTimeout(()=>{this.ipcService.send("login-account",{phone:this.phoneNumber,apiId:e.api_id,apiHash:e.api_hash,proxy:this.proxyAddress||null,twoFactorPassword:this.twoFactorPassword||null})},500),this.sendTimeout=setTimeout(()=>{this.isSending()&&(this.isSending.set(!1),this.phoneError.set("\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66"),this.toast.error("\u767C\u9001\u9A57\u8B49\u78BC\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},3e4)}submitVerificationCode(){if(!this.verificationCode){this.toast.error("\u8ACB\u8F38\u5165\u9A57\u8B49\u78BC");return}if(this.needs2FA()&&!this.twoFactorPassword){this.toast.error("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC");return}this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.isVerifying.set(!0);let e=this.selectedApiCredential();this.ipcService.send("login-account",{phone:this.phoneNumber,phoneCode:this.verificationCode,phoneCodeHash:this.phoneCodeHash,twoFactorPassword:this.twoFactorPassword||null,apiId:e?.api_id,apiHash:e?.api_hash}),this.verifyTimeout=setTimeout(()=>{this.isVerifying()&&(this.isVerifying.set(!1),this.toast.error("\u9A57\u8B49\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66"))},3e4)}resendCode(){this.sendVerificationCode()}handleLoginError(e){this.isSending.set(!1),this.isVerifying.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null);let t=e.friendlyMessage||e.error||e.message||"\u767B\u5165\u5931\u6557";if(t.includes("2FA")&&t.includes("\u5BC6\u78BC")){this.toast.error("\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\u932F\u8AA4\uFF0C\u8ACB\u91CD\u65B0\u8F38\u5165"),this.twoFactorPassword="";return}if(e.codeExpired){this.toast.error("\u9A57\u8B49\u78BC\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767C\u9001"),this.codeStep.set(!1),this.verificationCode="",this.phoneCodeHash="";return}this.toast.error(t)}startResendCooldown(){this.resendCooldown.set(60),this.resendTimer=setInterval(()=>{let e=this.resendCooldown();e<=1?(clearInterval(this.resendTimer),this.resendCooldown.set(0)):this.resendCooldown.set(e-1)},1e3)}generateQRCode(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}this.ipcService.send("qr-login-create",{proxy:this.proxyAddress||null,deviceType:this.deviceType()==="random"?null:this.deviceType(),customApiId:e.api_id,customApiHash:e.api_hash})}refreshQRCode(){this.qrImageBase64.set(""),this.generateQRCode()}startQRCountdown(){this.qrCountdown.set(60),this.qrTimer=setInterval(()=>{let e=this.qrCountdown();e<=1?this.stopQRCountdown():this.qrCountdown.set(e-1)},1e3)}stopQRCountdown(){this.qrTimer&&(clearInterval(this.qrTimer),this.qrTimer=null)}onDragOver(e){e.preventDefault(),this.isDragging.set(!0)}onDragLeave(e){e.preventDefault(),this.isDragging.set(!1)}onDrop(e){e.preventDefault(),this.isDragging.set(!1);let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0].path;n&&this.selectedFilePath.set(n)}}onDropTdata(e){e.preventDefault(),this.isDragging.set(!1);let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0].path;n&&this.scanTdata(n)}}selectSessionFile(){this.ipcService.send("select-session-file",{})}selectTdataFolder(){this.ipcService.send("select-tdata-folder",{})}selectTdataZip(){this.ipcService.send("select-tdata-zip",{})}scanTdata(e){this.isScanningTdata.set(!0),this.tdataScanResult.set(null),this.selectedTdataAccounts.set([]),this.ipcService.send("scan-tdata",{path:e})}toggleTdataAccount(e){this.selectedTdataAccounts.update(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])}getDefaultTdataPath(){let e=navigator.userAgent.includes("Windows"),t=navigator.userAgent.includes("Mac");return e?"%APPDATA%\\Telegram Desktop\\tdata":t?"~/Library/Application Support/Telegram Desktop/tdata":"~/.local/share/TelegramDesktop/tdata"}copyTdataPath(){let e=this.getDefaultTdataPath();navigator.clipboard.writeText(e.replace("%APPDATA%","").replace("~","")),this.toast.success("\u8DEF\u5F91\u5DF2\u8907\u88FD")}openTdataFolder(){this.ipcService.send("open-default-tdata-folder",{})}importTdataAccounts(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}let t=this.tdataScanResult();if(!t?.tdata_path){this.toast.error("\u8ACB\u5148\u6383\u63CF TData");return}let n=this.selectedTdataAccounts();if(n.length===0){this.toast.error("\u8ACB\u9078\u64C7\u8981\u5C0E\u5165\u7684\u5E33\u865F");return}this.isImporting.set(!0),n.length===1?this.ipcService.send("import-tdata-account",{tdataPath:t.tdata_path,accountIndex:n[0],apiId:e.api_id,apiHash:e.api_hash}):this.ipcService.send("import-tdata-batch",{tdataPath:t.tdata_path,accountIndices:n,apiId:e.api_id,apiHash:e.api_hash})}clearSelectedFile(){this.selectedFilePath.set("")}importSession(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}this.isImporting.set(!0),this.ipcService.send("import-session",{filePath:this.selectedFilePath(),apiId:e.api_id,apiHash:e.api_hash})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-add-account-page"]],outputs:{back:"back",accountAdded:"accountAdded"},decls:30,vars:20,consts:[[1,"add-account-page"],[1,"page-header"],[1,"back-btn",3,"click"],[1,"page-title"],[1,"step-indicator"],[1,"step"],[1,"step-number"],[1,"step-label"],[1,"step-line"],[1,"config-section"],[1,"login-selection"],[1,"login-form"],[1,"success-section"],[1,"section-header"],[3,"apiSelected","selectionCleared","showSelected"],[1,"form-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click","disabled"],[1,"login-cards"],[1,"login-card","recommended",3,"click"],[1,"login-badge"],[1,"login-icon"],[1,"login-risk","low"],[1,"login-card","safe",3,"click"],[1,"login-risk","lowest"],[1,"login-card","warning",3,"click"],[1,"login-risk","high"],[1,"form-card"],[1,"form-group"],[1,"required"],[1,"input-with-prefix"],["type","tel","placeholder","+639952947692",1,"form-input",3,"ngModelChange","ngModel"],[1,"input-status","valid"],[1,"error-text"],[1,"hint"],["type","text","placeholder","socks5://host:port \u6216\u7559\u7A7A",1,"form-input",3,"ngModelChange","ngModel"],["type","password","placeholder","\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49",1,"form-input",3,"ngModelChange","ngModel"],[1,"spinner"],[1,"code-sent-info"],[1,"info-icon"],["type","text","placeholder","\u8F38\u5165\u6536\u5230\u7684\u9A57\u8B49\u78BC","maxlength","6",1,"form-input","code-input",3,"ngModelChange","ngModel"],[1,"resend-section"],[1,"resend-btn",3,"click","disabled"],["type","password","placeholder","\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input",3,"ngModelChange","ngModel"],[1,"import-mode-tabs"],[1,"mode-tab",3,"click"],[1,"badge-recommend"],[1,"btn-primary",3,"disabled"],[1,"tdata-path-hint"],[1,"path-box"],[1,"path-actions"],["title","\u8907\u88FD\u8DEF\u5F91",1,"icon-btn",3,"click"],["title","\u6253\u958B\u6587\u4EF6\u593E",1,"icon-btn",3,"click"],[1,"drop-zone","large",3,"dragover","dragleave","drop"],[1,"drop-icon"],[1,"drop-text"],[1,"drop-hint"],[1,"drop-buttons"],[1,"select-btn",3,"click"],[1,"select-btn","secondary",3,"click"],[1,"scanning-indicator"],[1,"scan-result","success"],[1,"scan-result","error"],[1,"accounts-list"],[1,"account-item",3,"disabled"],[1,"account-item"],["type","checkbox",3,"change","checked","disabled"],[1,"account-info"],[1,"account-phone"],[1,"account-name"],[1,"account-error"],[1,"error-icon"],[1,"tdata-info"],[1,"drop-zone",3,"dragover","dragleave","drop","click"],[1,"selected-file"],[1,"file-icon"],[1,"file-path"],[1,"clear-btn",3,"click"],[1,"device-options"],[1,"device-btn",3,"click"],["type","text","placeholder","socks5://host:port",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"click"],[1,"qr-section"],[1,"qr-container"],["alt","QR Code",1,"qr-image",3,"src"],[1,"qr-countdown"],[1,"qr-instructions"],[1,"success-icon"],[1,"form-actions","center"],[1,"account-card"],[1,"account-avatar"],[1,"account-details"],[1,"account-username"],[1,"api-info"],[1,"api-badge","expert"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),x("click",function(){return n.goBack()}),l(3," \u2190 \u8FD4\u56DE\u5E33\u6236\u5217\u8868 "),s(),r(4,"h1",3),l(5,"\u2795 \u6DFB\u52A0\u65B0\u5E33\u6236"),s()(),r(6,"div",4)(7,"div",5)(8,"span",6),l(9,"1"),s(),r(10,"span",7),l(11,"\u9078\u64C7 API"),s()(),B(12,"div",8),r(13,"div",5)(14,"span",6),l(15,"2"),s(),r(16,"span",7),l(17,"\u767B\u5165\u5E33\u865F"),s()(),B(18,"div",8),r(19,"div",5)(20,"span",6),l(21,"3"),s(),r(22,"span",7),l(23,"\u5B8C\u6210"),s()()(),y(24,a6,12,2,"div",9),y(25,l6,64,0,"div",10),y(26,b6,7,1,"div",11),y(27,L6,19,7,"div",11),y(28,G6,21,8,"div",11),y(29,W6,11,1,"div",12),s()),t&2&&(c(7),N("active",n.currentStep()>=1)("completed",n.currentStep()>1),c(5),N("active",n.currentStep()>1),c(),N("active",n.currentStep()>=2)("completed",n.currentStep()>2),c(5),N("active",n.currentStep()>2),c(),N("active",n.currentStep()>=3),c(5),S(n.currentStep()===1?24:-1),c(),S(n.currentStep()===2&&n.currentLoginMethod()==="select"?25:-1),c(),S(n.currentStep()===2&&n.currentLoginMethod()==="code"?26:-1),c(),S(n.currentStep()===2&&n.currentLoginMethod()==="tdata"?27:-1),c(),S(n.currentStep()===2&&n.currentLoginMethod()==="qr"?28:-1),c(),S(n.currentStep()===3?29:-1))},dependencies:[oe,ae,xe,ve,qi,he,qo],styles:[".add-account-page[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:2rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem;margin-bottom:.5rem;padding:0}.back-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-title[_ngcontent-%COMP%]{margin:0;font-size:2rem;color:var(--text-primary, white)}.step-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:2rem;flex-wrap:wrap;gap:.5rem}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.step-number[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:var(--bg-tertiary, rgba(15, 23, 42, .5));display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.step-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%]{color:var(--text-primary, white)}.step-line[_ngcontent-%COMP%]{width:40px;height:2px;background:var(--bg-tertiary, rgba(15, 23, 42, .5))}.step-line.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4)}.mode-selection[_ngcontent-%COMP%], .login-selection[_ngcontent-%COMP%]{text-align:center}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .selection-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-primary, white);font-size:1.5rem}.section-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .selection-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 2rem;color:var(--text-muted, #94a3b8)}.mode-cards[_ngcontent-%COMP%], .login-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-bottom:2rem}@media(max-width:700px){.mode-cards[_ngcontent-%COMP%], .login-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}}.login-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}@media(max-width:800px){.login-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}}.mode-card[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:2px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;padding:1.5rem;cursor:pointer;transition:all .2s;position:relative;text-align:left}.mode-card[_ngcontent-%COMP%]:hover, .login-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 24px #0003}.mode-card.expert[_ngcontent-%COMP%]:hover{border-color:#22c55e}.mode-card.platform[_ngcontent-%COMP%]:hover{border-color:#06b6d4}.mode-card.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.mode-card.disabled[_ngcontent-%COMP%]:hover{transform:none}.login-card.recommended[_ngcontent-%COMP%]:hover{border-color:#22c55e}.login-card.safe[_ngcontent-%COMP%]:hover{border-color:#06b6d4}.login-card.warning[_ngcontent-%COMP%]:hover{border-color:#f59e0b}.mode-badge[_ngcontent-%COMP%], .login-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;right:1rem;padding:.25rem .75rem;border-radius:1rem;font-size:.7rem;font-weight:600}.mode-card.expert[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.mode-card.platform[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.login-card.recommended[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.login-card.safe[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.login-card.warning[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#f59e0b;color:#000}.mode-icon[_ngcontent-%COMP%], .login-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:.75rem}.mode-title[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-primary, white);font-size:1.25rem}.mode-subtitle[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:.875rem;color:var(--text-muted, #94a3b8)}.mode-features[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;font-size:.8rem}.mode-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.375rem;color:var(--text-secondary, #cbd5e1)}.mode-suitable[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);margin-bottom:1rem}.mode-risk[_ngcontent-%COMP%], .login-risk[_ngcontent-%COMP%]{padding:.375rem .75rem;border-radius:.5rem;font-size:.7rem;font-weight:500;display:inline-block;margin-bottom:1rem}.mode-risk.safe[_ngcontent-%COMP%], .login-risk.lowest[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.mode-risk.medium[_ngcontent-%COMP%], .login-risk.low[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.login-risk.high[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.quota-info[_ngcontent-%COMP%]{margin-bottom:1rem}.quota-bar[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.75rem;border-radius:.5rem}.quota-label[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8);margin-bottom:.375rem}.quota-progress[_ngcontent-%COMP%]{height:6px;background:var(--bg-tertiary, rgba(15, 23, 42, .8));border-radius:3px;overflow:hidden;margin-bottom:.375rem}.quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#22c55e);border-radius:3px}.quota-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #cbd5e1)}.quota-locked[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem;background:#f59e0b1a;border-radius:.5rem;font-size:.75rem;color:#fcd34d}.mode-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:none;border-radius:.5rem;font-weight:500;cursor:pointer;transition:all .2s}.mode-card.expert[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.mode-card.platform[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.mode-btn.upgrade[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#ef4444)}.help-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;text-align:left}@media(max-width:600px){.help-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.help-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .5));padding:1rem;border-radius:.75rem}.help-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.help-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.config-section[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.form-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.required[_ngcontent-%COMP%]{color:#ef4444}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;box-sizing:border-box}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.form-input.error[_ngcontent-%COMP%]{border-color:#ef4444;background:#ef44440d}.form-input.valid[_ngcontent-%COMP%]{border-color:#22c55e}.input-with-prefix[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-with-prefix[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1;padding-right:2.5rem}.input-status[_ngcontent-%COMP%]{position:absolute;right:.75rem;font-size:1rem}.input-status.valid[_ngcontent-%COMP%]{color:#22c55e}.form-input.code-input[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;letter-spacing:.5rem}.hint[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:var(--text-muted, #64748b)}.error-text[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:#ef4444}.guide-box[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:1rem;border-radius:.5rem;margin-bottom:1rem}.guide-box[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--text-primary, white)}.guide-box[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:0;padding-left:1.25rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.guide-box[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.375rem}.guide-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.warning-box[_ngcontent-%COMP%], .risk-warning[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding:1rem;background:#f59e0b1a;border:1px solid rgba(245,158,11,.3);border-radius:.5rem}.warning-icon[_ngcontent-%COMP%]{font-size:1.25rem}.warning-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#fcd34d;margin-bottom:.375rem;font-size:.875rem}.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding-left:1rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:0}.quota-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem}.membership-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.level-icon[_ngcontent-%COMP%]{font-size:2rem}.level-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.level-name[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--text-primary, white)}.level-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.quota-item[_ngcontent-%COMP%]{margin-bottom:1rem}.quota-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem}.quota-title[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.quota-value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-primary, white)}.quota-bar-large[_ngcontent-%COMP%]{height:8px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:4px;overflow:hidden}.quota-bar-large[_ngcontent-%COMP%]   .quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#22c55e)}.quota-summary[_ngcontent-%COMP%]{margin-top:1rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;text-align:center}.summary-good[_ngcontent-%COMP%]{color:#22c55e}.summary-bad[_ngcontent-%COMP%]{color:#ef4444}.upgrade-prompt[_ngcontent-%COMP%]{margin-top:1rem;text-align:center;padding:1rem;background:linear-gradient(135deg,#f59e0b1a,#ef44441a);border-radius:.5rem}.upgrade-prompt[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:#fcd34d}.btn-upgrade[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#ef4444);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.5rem;cursor:pointer}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;margin-top:1.5rem}.form-actions.center[_ngcontent-%COMP%]{justify-content:center}.btn-primary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;transition:all .2s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .3));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer}.device-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}.device-btn[_ngcontent-%COMP%]{padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.device-btn[_ngcontent-%COMP%]:hover, .device-btn.active[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--border-default, rgba(148, 163, 184, .3));border-radius:.75rem;padding:3rem;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:1rem}.drop-zone[_ngcontent-%COMP%]:hover, .drop-zone.dragging[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d40d}.drop-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:.75rem}.drop-text[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.drop-hint[_ngcontent-%COMP%]{margin:.5rem 0 0;font-size:.8rem;color:var(--text-muted, #94a3b8)}.selected-file[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.file-path[_ngcontent-%COMP%]{flex:1;color:var(--text-primary, white);font-size:.875rem;word-break:break-all}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:1.25rem}.qr-section[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.qr-container[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:.75rem;display:inline-block;margin-bottom:.75rem}.qr-image[_ngcontent-%COMP%]{width:180px;height:180px;display:block}.qr-countdown[_ngcontent-%COMP%]{font-size:1rem;color:var(--primary, #06b6d4);margin-bottom:.75rem}.qr-countdown.warning[_ngcontent-%COMP%]{color:#f59e0b;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.qr-instructions[_ngcontent-%COMP%]{text-align:left;display:inline-block;background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.75rem 1.25rem;border-radius:.5rem}.qr-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0;color:var(--text-muted, #94a3b8);font-size:.8rem}.code-sent-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#22c55e1a;border-radius:.5rem;margin-bottom:1rem;color:#86efac}.resend-section[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.resend-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem}.resend-btn[_ngcontent-%COMP%]:disabled{color:var(--text-muted, #94a3b8);cursor:not-allowed}.tdata-info[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:1rem;border-radius:.5rem;margin-bottom:1rem}.tdata-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.tdata-info[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.import-mode-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid transparent;border-radius:.5rem;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s;position:relative}.mode-tab[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8));color:var(--text-primary, white)}.mode-tab.active[_ngcontent-%COMP%]{background:var(--bg-secondary, rgba(30, 41, 59, .8));border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.badge-recommend[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#10b981,#059669);color:#fff;font-size:.65rem;padding:2px 6px;border-radius:4px}.tdata-path-hint[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border, rgba(100, 116, 139, .3));border-radius:.5rem;padding:1rem;margin-bottom:1rem}.tdata-path-hint[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.path-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:var(--bg-primary, rgba(2, 6, 23, .8));padding:.5rem 1rem;border-radius:.375rem}.path-box[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:.8rem;color:var(--primary, #06b6d4);word-break:break-all}.path-actions[_ngcontent-%COMP%]{display:flex;gap:.25rem}.icon-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:none;cursor:pointer;opacity:.7;transition:opacity .2s}.icon-btn[_ngcontent-%COMP%]:hover{opacity:1}.drop-zone.large[_ngcontent-%COMP%]{padding:2rem;min-height:180px}.drop-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem}.select-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);color:#fff;border:none;border-radius:.375rem;cursor:pointer;transition:background .2s}.select-btn[_ngcontent-%COMP%]:hover{background:var(--primary-dark, #0891b2)}.select-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border, rgba(100, 116, 139, .3))}.select-btn.secondary[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.scan-result[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;padding:1rem;margin:1rem 0}.scan-result.success[_ngcontent-%COMP%]{border:1px solid rgba(16,185,129,.3)}.scan-result.error[_ngcontent-%COMP%]{border:1px solid rgba(239,68,68,.3);display:flex;align-items:center;gap:.5rem;color:#f87171}.scan-result[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--text-primary, white)}.accounts-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto}.account-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem;background:var(--bg-primary, rgba(2, 6, 23, .8));border-radius:.375rem;cursor:pointer;transition:background .2s}.account-item[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.account-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.account-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem}.account-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.125rem}.account-phone[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-primary, white)}.account-name[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.account-error[_ngcontent-%COMP%]{font-size:.7rem;color:#f87171}.scanning-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--text-muted, #94a3b8)}.success-section[_ngcontent-%COMP%]{text-align:center;padding:2rem}.success-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.success-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--text-primary, white)}.account-card[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:1rem;padding:1rem 2rem;background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;margin-bottom:1rem}.account-avatar[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#fff}.account-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.account-phone[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1)}.account-username[_ngcontent-%COMP%]{font-size:.875rem;color:var(--primary, #06b6d4)}.api-info[_ngcontent-%COMP%]{margin:1rem 0}.api-badge[_ngcontent-%COMP%]{display:inline-block;padding:.5rem 1rem;border-radius:2rem;font-size:.8rem}.api-badge.expert[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.api-badge.platform[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};var nc=(i,e)=>e.key,z6=(i,e)=>e.id,K6=(i,e)=>e.name;function j6(i,e){if(i&1){let t=I();r(0,"button",53),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.filterTemplateCategory.set(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(3);N("bg-blue-500",n.filterTemplateCategory()===t.key)("text-white",n.filterTemplateCategory()===t.key)("bg-slate-700",n.filterTemplateCategory()!==t.key)("text-slate-400",n.filterTemplateCategory()!==t.key),c(),X(" ",t.icon," ",t.label," ")}}function J6(i,e){i&1&&(r(0,"div",50),ne(),r(1,"svg",54),B(2,"circle",55)(3,"path",56),s(),ce(),r(4,"span",57),l(5,"\u8F09\u5165\u6A21\u677F..."),s()())}function Q6(i,e){i&1&&(r(0,"div",51)(1,"p"),l(2,"\u6C92\u6709\u627E\u5230\u6A21\u677F"),s(),r(3,"p",58),l(4,"\u8ACB\u5148\u5230\u300C\u804A\u5929\u6A21\u677F\u300D\u9801\u9762\u5275\u5EFA\u6A21\u677F"),s()())}function Y6(i,e){if(i&1){let t=I();r(0,"button",60),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.selectTemplate(o))}),r(1,"div",61)(2,"span",62),l(3),s(),r(4,"span",23),l(5),s()(),r(6,"p",63),l(7),s()()}if(i&2){let t,n,o,a,d,u=e.$implicit,p=m(4);N("border-blue-500",((t=p.selectedTemplate())==null?null:t.id)===u.id)("bg-blue-500/10",((n=p.selectedTemplate())==null?null:n.id)===u.id)("border-slate-600",((o=p.selectedTemplate())==null?null:o.id)!==u.id)("bg-slate-800/50",((a=p.selectedTemplate())==null?null:a.id)!==u.id)("hover:border-slate-500",((d=p.selectedTemplate())==null?null:d.id)!==u.id),c(3),D(u.name),c(2),M("\u4F7F\u7528 ",u.usageCount," \u6B21"),c(2),D(u.content)}}function X6(i,e){if(i&1&&(r(0,"div",52),O(1,Y6,8,13,"button",59,z6),s()),i&2){let t=m(3);c(),U(t.filteredTemplates())}}function Z6(i,e){if(i&1){let t=I();r(0,"div",17)(1,"div",45)(2,"label",46),l(3,"\u9078\u64C7\u804A\u5929\u6A21\u677F"),s(),r(4,"button",47),x("click",function(){_(t);let o=m(2);return v(o.loadTemplates())}),l(5," \u{1F504} \u5237\u65B0 "),s()(),r(6,"div",48),O(7,j6,2,10,"button",49,nc),s(),y(9,J6,6,0,"div",50)(10,Q6,5,0,"div",51)(11,X6,3,0,"div",52),s()}if(i&2){let t=m(2);c(7),U(t.templateCategories),c(2),S(t.isLoadingTemplates()?9:t.filteredTemplates().length===0?10:11)}}function eA(i,e){if(i&1&&(B(0,"span",73),r(1,"span"),l(2),s()),i&2){let t=m(4);c(2),M("\u5DF2\u9023\u63A5 ",t.aiStatus().model)}}function tA(i,e){i&1&&(B(0,"span",74),r(1,"span"),l(2,"\u4F7F\u7528\u672C\u5730\u6A21\u677F"),s())}function nA(i,e){if(i&1&&(r(0,"div",72),y(1,eA,3,1)(2,tA,3,0),s()),i&2){let t=m(3);N("bg-green-500/20",t.aiStatus().connected)("text-green-400",t.aiStatus().connected)("bg-amber-500/20",!t.aiStatus().connected)("text-amber-400",!t.aiStatus().connected),c(),S(t.aiStatus().connected?1:2)}}function iA(i,e){if(i&1){let t=I();r(0,"button",75),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectedAiStyle.set(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(3);N("bg-purple-500",n.selectedAiStyle()===t.key)("text-white",n.selectedAiStyle()===t.key)("bg-slate-700",n.selectedAiStyle()!==t.key)("text-slate-400",n.selectedAiStyle()!==t.key),c(),M(" ",t.label," ")}}function oA(i,e){i&1&&(ne(),r(0,"svg",76),B(1,"circle",55)(2,"path",56),s(),l(3," \u751F\u6210\u4E2D... "))}function rA(i,e){i&1&&l(0," \u2728 \u751F\u6210 5 \u7A2E\u4E0D\u540C\u8868\u9054 ")}function sA(i,e){if(i&1){let t=I();r(0,"label",82)(1,"input",83),x("change",function(){let o=_(t).$implicit,a=m(4);return v(a.toggleMessageSelection(o))}),s(),r(2,"span",84),l(3),s()()}if(i&2){let t=e.$implicit,n=m(4);N("border-purple-500",n.isMessageSelected(t))("bg-purple-500/10",n.isMessageSelected(t))("border-slate-600",!n.isMessageSelected(t))("bg-slate-800/50",!n.isMessageSelected(t)),c(),L("checked",n.isMessageSelected(t)),c(2),D(t)}}function aA(i,e){if(i&1){let t=I();r(0,"button",89),x("click",function(){let o=_(t).$implicit,a=m(5);return v(a.setSendStrategy(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(5);N("bg-purple-500",n.sendStrategy()===t.key)("text-white",n.sendStrategy()===t.key)("bg-slate-700",n.sendStrategy()!==t.key)("text-slate-400",n.sendStrategy()!==t.key),L("title",t.desc),c(),M(" ",t.label," ")}}function lA(i,e){if(i&1&&(r(0,"div",81)(1,"span",85),l(2,"\u{1F4E4} \u767C\u9001\u7B56\u7565\uFF1A"),s(),r(3,"div",86),O(4,aA,2,10,"button",87,nc),s(),r(6,"p",88),l(7),s()()),i&2){let t=m(4);c(4),U(t.sendStrategies),c(3),M(" ",t.getStrategyDescription()," ")}}function cA(i,e){if(i&1){let t=I();r(0,"div",71)(1,"div",5)(2,"span",77),l(3),s(),r(4,"div",15)(5,"button",78),x("click",function(){_(t);let o=m(3);return v(o.selectAllMessages())}),l(6," \u5168\u9078 "),s(),r(7,"button",79),x("click",function(){_(t);let o=m(3);return v(o.clearSelectedMessages())}),l(8," \u6E05\u9664 "),s()()(),O(9,sA,4,10,"label",80,ct),y(11,lA,8,1,"div",81),s()}if(i&2){let t=m(3);c(3),M("\u53EF\u591A\u9078\u6A21\u677F\uFF08\u5DF2\u9078 ",t.selectedMessages().size," \u500B\uFF09\uFF1A"),c(6),U(t.aiGeneratedMessages()),c(2),S(t.selectedMessages().size>1?11:-1)}}function dA(i,e){if(i&1){let t=I();r(0,"div",18)(1,"div",45)(2,"label",64),l(3,"\u{1F916} AI \u667A\u80FD\u751F\u6210"),s(),y(4,nA,3,9,"div",65),s(),r(5,"div",66)(6,"div")(7,"span",67),l(8,"\u8A9E\u8A00\u98A8\u683C\uFF1A"),s(),r(9,"div",37),O(10,iA,2,9,"button",68,nc),s()(),r(12,"div")(13,"span",67),l(14,"\u6D88\u606F\u4E3B\u984C\uFF1A"),s(),r(15,"input",69),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.aiTopic,o)||(a.aiTopic=o),v(o)}),s()(),r(16,"button",70),x("click",function(){_(t);let o=m(2);return v(o.generateAiMessage())}),y(17,oA,4,0)(18,rA,1,0),s(),y(19,cA,12,2,"div",71),s()()}if(i&2){let t=m(2);c(4),S(t.aiStatus().source!=="unknown"?4:-1),c(6),U(t.aiStyles),c(5),H("ngModel",t.aiTopic),c(),L("disabled",t.isGeneratingAi()||!t.aiTopic.trim()),c(),S(t.isGeneratingAi()?17:18),c(2),S(t.aiGeneratedMessages().length>0?19:-1)}}function uA(i,e){if(i&1&&(r(0,"span",20),l(1),s()),i&2){let t,n=m(2);c(),M("\uFF08\u4F7F\u7528\u6A21\u677F\uFF1A",(t=n.selectedTemplate())==null?null:t.name,"\uFF09")}}function mA(i,e){if(i&1){let t=I();r(0,"button",90),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.insertVariable(o.key))}),r(1,"span",31),l(2),s(),r(3,"span",91),l(4,"|"),s(),r(5,"span",92),l(6),s()()}if(i&2){let t=e.$implicit;L("title","\u63D2\u5165 "+t.key),c(2),D(t.key),c(4),D(t.label)}}function pA(i,e){if(i&1){let t=I();r(0,"div",93)(1,"span",94),l(2),s(),r(3,"span",95),l(4),s(),r(5,"button",96),x("click",function(){let o=_(t).$index,a=m(3);return v(a.removeAttachment(o))}),ne(),r(6,"svg",97),B(7,"path",12),s()()()}if(i&2){let t=e.$implicit;c(2),D(t.type.startsWith("image")?"\u{1F5BC}\uFE0F":"\u{1F4C4}"),c(2),D(t.name)}}function gA(i,e){if(i&1&&(r(0,"div",27),O(1,pA,8,2,"div",93,K6),s()),i&2){let t=m(2);c(),U(t.attachments())}}function hA(i,e){if(i&1&&(r(0,"span",38),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function fA(i,e){if(i&1&&(r(0,"span",39),l(1),s()),i&2){let t=m(2);c(),M(" +",t.targets().length-20," \u66F4\u591A... ")}}function _A(i,e){if(i&1&&(r(0,"div",103),l(1),s()),i&2){let t=m(3);c(),M(" \u{1F4E8} \u6B63\u5728\u767C\u9001\u7D66: ",t.currentTarget()," ")}}function vA(i,e){if(i&1&&(r(0,"span",106),l(1),s()),i&2){let t=e.$implicit;c(),X(" ",t.label,": ",t.count," ")}}function xA(i,e){if(i&1&&(r(0,"div",104)(1,"div",105),l(2,"\u5931\u6557\u539F\u56E0\uFF1A"),s(),r(3,"div",37),O(4,vA,2,2,"span",106,ct),s()()),i&2){let t=m(3);c(4),U(t.failureReasonsList())}}function CA(i,e){if(i&1&&(r(0,"div",40)(1,"div",98)(2,"span",99),l(3,"\u767C\u9001\u9032\u5EA6"),s(),r(4,"span",9),l(5),s()(),r(6,"div",100),B(7,"div",101),s(),r(8,"div",102)(9,"span"),l(10),s(),r(11,"span"),l(12),s(),r(13,"span"),l(14),s()(),y(15,_A,2,1,"div",103),y(16,xA,6,0,"div",104),s()),i&2){let t=m(2);c(5),X("",t.sentCount()," / ",t.targets().length),c(2),ee("width",t.progressPercent(),"%"),c(3),M("\u2705 \u6210\u529F: ",t.successCount()),c(2),M("\u274C \u5931\u6557: ",t.failedCount()),c(2),M("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining()),c(),S(t.currentTarget()?15:-1),c(),S(t.failedCount()>0&&t.failureReasonsList().length>0?16:-1)}}function bA(i,e){i&1&&(r(0,"span",107),l(1,"\u23F3"),s(),l(2," \u767C\u9001\u4E2D... "))}function yA(i,e){if(i&1&&l(0),i&2){let t=m(2);M(" \u{1F4E8} \u958B\u59CB\u767C\u9001 (",t.targets().length," \u4EBA) ")}}function SA(i,e){if(i&1){let t=I();r(0,"div",2),x("click",function(o){_(t);let a=m();return v(a.onBackdropClick(o))}),r(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),l(6," \u{1F4E8} "),s(),r(7,"div")(8,"h2",8),l(9,"\u6279\u91CF\u767C\u9001\u6D88\u606F"),s(),r(10,"p",9),l(11),s()()(),r(12,"button",10),x("click",function(){_(t);let o=m();return v(o.close())}),ne(),r(13,"svg",11),B(14,"path",12),s()()()(),ce(),r(15,"div",13)(16,"div")(17,"label",14),l(18," \u{1F4DD} \u6D88\u606F\u4F86\u6E90 "),s(),r(19,"div",15)(20,"button",16),x("click",function(){_(t);let o=m();return v(o.setMessageSource("template"))}),l(21," \u{1F4C4} \u804A\u5929\u6A21\u677F "),s(),r(22,"button",16),x("click",function(){_(t);let o=m();return v(o.setMessageSource("custom"))}),l(23," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),s(),r(24,"button",16),x("click",function(){_(t);let o=m();return v(o.setMessageSource("ai"))}),l(25," \u{1F916} AI \u751F\u6210 "),s()()(),y(26,Z6,12,1,"div",17),y(27,dA,20,5,"div",18),r(28,"div")(29,"label",19),l(30," \u{1F4DD} \u6D88\u606F\u5167\u5BB9 "),y(31,uA,2,1,"span",20),s(),r(32,"textarea",21),W("ngModelChange",function(o){_(t);let a=m();return q(a.messageContent,o)||(a.messageContent=o),v(o)}),l(33,"              "),s(),r(34,"div",22)(35,"span",23),l(36,"\u53EF\u7528\u8B8A\u91CF\uFF1A"),s(),O(37,mA,7,3,"button",24,nc),s()(),r(39,"div")(40,"label",19),l(41," \u{1F4CE} \u9644\u4EF6\uFF08\u53EF\u9078\uFF09 "),s(),r(42,"div",25)(43,"button",26),x("click",function(){_(t);let o=m();return v(o.selectImages())}),l(44," \u{1F5BC}\uFE0F \u6DFB\u52A0\u5716\u7247 "),s(),r(45,"button",26),x("click",function(){_(t);let o=m();return v(o.selectFiles())}),l(46," \u{1F4C4} \u6DFB\u52A0\u6587\u4EF6 "),s()(),y(47,gA,3,0,"div",27),s(),r(48,"div",17)(49,"label",14),l(50," \u2699\uFE0F \u767C\u9001\u8A2D\u7F6E "),s(),r(51,"div",28)(52,"div",6)(53,"span",29),l(54,"\u767C\u9001\u9593\u9694\uFF1A"),s(),r(55,"input",30),W("ngModelChange",function(o){_(t);let a=m();return q(a.minInterval,o)||(a.minInterval=o),v(o)}),s(),r(56,"span",31),l(57,"-"),s(),r(58,"input",32),W("ngModelChange",function(o){_(t);let a=m();return q(a.maxInterval,o)||(a.maxInterval=o),v(o)}),s(),r(59,"span",9),l(60,"\u79D2\uFF08\u96A8\u6A5F\uFF09"),s()(),r(61,"div",6)(62,"span",29),l(63,"\u5E33\u865F\u8F2A\u63DB\uFF1A"),s(),r(64,"label",33)(65,"input",34),W("ngModelChange",function(o){_(t);let a=m();return q(a.accountRotation,o)||(a.accountRotation=o),v(o)}),s(),B(66,"div",35),s(),r(67,"span",9),l(68,"\u555F\u7528\u591A\u5E33\u865F\u8F2A\u63DB\u767C\u9001"),s()()()(),r(69,"div")(70,"label",19),l(71),s(),r(72,"div",36)(73,"div",37),O(74,hA,2,1,"span",38,ct),y(76,fA,2,1,"span",39),s()()()(),y(77,CA,17,9,"div",40),r(78,"div",41)(79,"button",42),x("click",function(){_(t);let o=m();return v(o.close())}),l(80),s(),r(81,"button",43),x("click",function(){_(t);let o=m();return v(o.previewMessage())}),l(82," \u{1F441}\uFE0F \u9810\u89BD "),s(),r(83,"button",44),x("click",function(){_(t);let o=m();return v(o.startSending())}),y(84,bA,3,0)(85,yA,1,1),s()()()()}if(i&2){let t=m();c(11),M("\u5411 ",t.targets().length," \u500B\u7528\u6236\u767C\u9001\u6D88\u606F"),c(9),N("border-blue-500",t.messageSource()==="template")("bg-blue-500/20",t.messageSource()==="template")("text-blue-400",t.messageSource()==="template")("border-slate-600",t.messageSource()!=="template")("bg-slate-800/50",t.messageSource()!=="template")("text-slate-400",t.messageSource()!=="template"),c(2),N("border-cyan-500",t.messageSource()==="custom")("bg-cyan-500/20",t.messageSource()==="custom")("text-cyan-400",t.messageSource()==="custom")("border-slate-600",t.messageSource()!=="custom")("bg-slate-800/50",t.messageSource()!=="custom")("text-slate-400",t.messageSource()!=="custom"),c(2),N("border-purple-500",t.messageSource()==="ai")("bg-purple-500/20",t.messageSource()==="ai")("text-purple-400",t.messageSource()==="ai")("border-slate-600",t.messageSource()!=="ai")("bg-slate-800/50",t.messageSource()!=="ai")("text-slate-400",t.messageSource()!=="ai"),c(2),S(t.messageSource()==="template"?26:-1),c(),S(t.messageSource()==="ai"?27:-1),c(4),S(t.messageSource()==="template"&&t.selectedTemplate()?31:-1),c(),H("ngModel",t.messageContent),c(5),U(t.availableVariables),c(10),S(t.attachments().length>0?47:-1),c(8),H("ngModel",t.minInterval),c(3),H("ngModel",t.maxInterval),c(7),H("ngModel",t.accountRotation),c(6),M(" \u{1F465} \u767C\u9001\u76EE\u6A19\uFF08",t.targets().length," \u4EBA\uFF09 "),c(3),U(t.targets().slice(0,20)),c(2),S(t.targets().length>20?76:-1),c(),S(t.isSending()?77:-1),c(2),L("disabled",t.isSending()),c(),M(" ",t.isSending()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),c(),L("disabled",!t.canSend()||t.isSending()),c(2),L("disabled",!t.canSend()||t.isSending()),c(),S(t.isSending()?84:85)}}function wA(i,e){if(i&1&&(r(0,"div",111),l(1),s()),i&2){let t=m(2);c(),M(" \u{1F4CE} \u5305\u542B ",t.attachments().length," \u500B\u9644\u4EF6 ")}}function EA(i,e){if(i&1){let t=I();r(0,"div",1)(1,"div",108)(2,"h3",109),l(3,"\u{1F4F1} \u6D88\u606F\u9810\u89BD"),s(),r(4,"div",110),l(5),s(),y(6,wA,2,1,"div",111),r(7,"button",112),x("click",function(){_(t);let o=m();return v(o.showPreview.set(!1))}),l(8," \u95DC\u9589 "),s()()()}if(i&2){let t=m();c(5),M(" ",t.previewText()," "),c(),S(t.attachments().length>0?6:-1)}}var tc=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.listeners=[];this.isOpen=Le(!1);this.targets=Le([]);this.closeDialog=ge();this.sendComplete=ge();this.messageSource=f("custom");this.chatTemplates=f([]);this.isLoadingTemplates=f(!1);this.selectedTemplate=f(null);this.filterTemplateCategory=f("all");this.templateCategories=[{key:"all",icon:"\u{1F4CB}",label:"\u5168\u90E8"},{key:"greeting",icon:"\u{1F44B}",label:"\u554F\u5019\u8A9E"},{key:"follow_up",icon:"\u{1F4E9}",label:"\u8DDF\u9032\u6D88\u606F"},{key:"promotion",icon:"\u{1F4E2}",label:"\u63A8\u5EE3\u6D88\u606F"},{key:"custom",icon:"\u270F\uFE0F",label:"\u81EA\u5B9A\u7FA9"}];this.filteredTemplates=R(()=>{let e=this.filterTemplateCategory(),t=this.chatTemplates();return e==="all"?t.filter(n=>n.isEnabled):t.filter(n=>n.isEnabled&&n.category===e)});this.selectedAiStyle=f("friendly");this.aiTopic="";this.isGeneratingAi=f(!1);this.aiGeneratedMessages=f([]);this.aiStatus=f({connected:!1,model:null,source:"unknown"});this.selectedMessages=f(new Set);this.sendStrategy=f("random");this.sendStrategies=[{key:"random",label:"\u{1F3B2} \u96A8\u6A5F\u767C\u9001",desc:"\u6BCF\u500B\u7528\u6236\u96A8\u6A5F\u9078\u64C7\u4E00\u500B\u6A21\u677F"},{key:"rotate",label:"\u{1F504} \u8F2A\u8F49\u767C\u9001",desc:"\u4F9D\u6B21\u4F7F\u7528\u6A21\u677F\uFF081\u21922\u21923\u21921...\uFF09"},{key:"sequential",label:"\u{1F4CB} \u9806\u5E8F\u767C\u9001",desc:"\u6309\u9806\u5E8F\u7528\u5B8C\u518D\u91CD\u8907"}];this.aiStyles=[{key:"friendly",label:"\u53CB\u597D\u89AA\u5207"},{key:"formal",label:"\u6B63\u5F0F\u5546\u52D9"},{key:"humorous",label:"\u8F15\u9B06\u5E7D\u9ED8"},{key:"concise",label:"\u7C21\u6F54\u660E\u4E86"},{key:"enthusiastic",label:"\u71B1\u60C5\u6D0B\u6EA2"}];this.messageContent="";this.attachments=f([]);this.minInterval=30;this.maxInterval=60;this.accountRotation=!0;this.availableVariables=[{key:"{firstName}",label:"\u540D\u5B57"},{key:"{lastName}",label:"\u59D3\u6C0F"},{key:"{username}",label:"\u7528\u6236\u540D"},{key:"{name}",label:"\u986F\u793A\u540D"},{key:"{fullName}",label:"\u5168\u540D"},{key:"{groupName}",label:"\u4F86\u6E90\u7FA4\u7D44"},{key:"{keyword}",label:"\u89F8\u767C\u95DC\u9375\u8A5E"},{key:"{source}",label:"\u4F86\u6E90\u6E20\u9053"},{key:"{greeting}",label:"\u554F\u5019\u8A9E"},{key:"{date}",label:"\u65E5\u671F"},{key:"{time}",label:"\u6642\u9593"},{key:"{day}",label:"\u661F\u671F"}];this.isSending=f(!1);this.sentCount=f(0);this.successCount=f(0);this.failedCount=f(0);this.currentTarget=f("");this.failureReasons=f({});this.failureReasonLabels={privacy_restricted:"\u{1F512} \u96B1\u79C1\u9650\u5236",flood_wait:"\u23F1\uFE0F API \u9650\u5236",user_not_found:"\u2753 \u7528\u6236\u4E0D\u5B58\u5728",user_blocked:"\u{1F6AB} \u88AB\u5C01\u9396",invalid_id:"\u26A0\uFE0F \u7121\u6548 ID",no_account:"\u{1F4F1} \u7121\u53EF\u7528\u5E33\u865F",cancelled:"\u23F9\uFE0F \u5DF2\u53D6\u6D88",other:"\u274C \u5176\u4ED6\u932F\u8AA4"};this.showPreview=f(!1);this.progressPercent=R(()=>{let e=this.targets().length;return e>0?this.sentCount()/e*100:0});this.failureReasonsList=R(()=>{let e=this.failureReasons();return Object.keys(e).map(t=>({key:t,label:this.failureReasonLabels[t]||t,count:e[t]}))});this.estimatedRemaining=R(()=>{let e=this.targets().length-this.sentCount(),t=(this.minInterval+this.maxInterval)/2,n=e*t;return n<60?`${Math.round(n)} \u79D2`:n<3600?`${Math.round(n/60)} \u5206\u9418`:`${Math.round(n/3600)} \u5C0F\u6642`});this.previewText=R(()=>{let e=this.targets()[0]||{};return this.replaceVariables(this.messageContent,e)});this.aiGenerateTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadTemplates()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-send:progress",a=>{this.sentCount.set(a.sent),this.successCount.set(a.success),this.failedCount.set(a.failed),a.currentTarget&&this.currentTarget.set(a.currentTarget),a.failureReasons&&this.failureReasons.set(a.failureReasons)});this.listeners.push(e);let t=this.ipc.on("batch-send:complete",a=>{if(this.isSending.set(!1),this.sendComplete.emit({success:a.success,failed:a.failed}),a.error)this.toast.error(`\u274C \u767C\u9001\u5931\u6557\uFF1A${a.error}`);else if(a.failed>0){let d=a.failureSummary||`\u5931\u6557 ${a.failed} \u500B`;this.toast.warning(`\u26A0\uFE0F \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${a.success}\uFF0C${d}`)}else this.toast.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${a.success} \u500B`);a.failureReasons&&this.failureReasons.set(a.failureReasons)});this.listeners.push(t);let n=this.ipc.on("get-chat-templates-result",a=>{this.isLoadingTemplates.set(!1),a.templates&&this.chatTemplates.set(a.templates)});this.listeners.push(n);let o=this.ipc.on("ai-generate-message-result",a=>{console.log("[AI] \u6536\u5230\u751F\u6210\u7D50\u679C:",a),this.aiGenerateTimeout&&(clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=null),this.isGeneratingAi.set(!1),a.success&&a.messages?(this.aiGeneratedMessages.set(a.messages),a.source==="ai"&&a.model?(this.aiStatus.set({connected:!0,model:a.model,source:"ai"}),this.toast.success(`\u{1F916} ${a.model} \u751F\u6210\u4E86 ${a.messages.length} \u689D\u6D88\u606F\uFF01`)):(this.aiStatus.set({connected:!1,model:null,source:"local"}),this.toast.info("\u{1F4CB} \u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F\u751F\u6210\u6D88\u606F"))):this.toast.error(a.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(o)}setMessageSource(e){this.messageSource.set(e),e==="template"&&this.loadTemplates()}loadTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectTemplate(e){this.selectedTemplate.set(e),this.messageContent=e.content,this.toast.info(`\u5DF2\u9078\u64C7\u6A21\u677F\uFF1A${e.name}`)}generateAiMessage(){if(!this.aiTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingAi.set(!0),this.aiGeneratedMessages.set([]),this.aiGenerateTimeout&&clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=setTimeout(()=>{this.isGeneratingAi()&&(this.isGeneratingAi.set(!1),this.toast.warning("AI \u751F\u6210\u8D85\u6642\uFF0C\u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F"),this.useLocalAiTemplates())},1e4),console.log("[AI] \u767C\u9001\u751F\u6210\u8ACB\u6C42:",{topic:this.aiTopic,style:this.selectedAiStyle()}),this.ipc.send("ai-generate-message",{topic:this.aiTopic,style:this.selectedAiStyle(),count:5,context:{targetCount:this.targets().length,sampleTarget:this.targets()[0]}})}useLocalAiTemplates(){let e=this.aiTopic||"\u6253\u62DB\u547C",t=this.selectedAiStyle(),n={friendly:["{greeting}\uFF01\u6211\u662F\u5728\u7FA4\u88E1\u770B\u5230\u4F60\u7684\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B~","Hi {name}\uFF01\u5F88\u9AD8\u8208\u80FD\u8A8D\u8B58\u4F60\uFF0C\u5E0C\u671B\u4EE5\u5F8C\u591A\u591A\u4EA4\u6D41 \u{1F60A}","{greeting}{name}\uFF0C\u6211\u89BA\u5F97\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u8A71\u984C\uFF0C\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F","\u55E8\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u60F3\u8DDF\u4F60\u4EA4\u500B\u670B\u53CB~",`{greeting}\uFF01\u6211\u662F${e}\u76F8\u95DC\u7684\uFF0C\u770B\u5230\u4F60\u4E5F\u5C0D\u9019\u500B\u611F\u8208\u8DA3\uFF1F`],formal:["{greeting}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u60A8\u3002\u6211\u6CE8\u610F\u5230\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u7684\u8208\u8DA3\u9EDE\uFF0C\u4E0D\u77E5\u662F\u5426\u65B9\u4FBF\u4EA4\u6D41\uFF1F",`\u60A8\u597D {name}\uFF0C\u5192\u6627\u6253\u64FE\u3002\u6211\u5C08\u6CE8\u65BC${e}\u9818\u57DF\uFF0C\u5E0C\u671B\u80FD\u8207\u60A8\u5EFA\u7ACB\u806F\u7E6B\u3002`,"{greeting}\uFF0C\u6211\u662F\u901A\u904E\u7FA4\u7D44\u8A8D\u8B58\u5230\u60A8\u7684\u3002\u5982\u6709\u5408\u4F5C\u6A5F\u6703\uFF0C\u671F\u5F85\u9032\u4E00\u6B65\u6E9D\u901A\u3002","\u5C0A\u656C\u7684 {name}\uFF0C\u5F88\u69AE\u5E78\u80FD\u5920\u8207\u60A8\u53D6\u5F97\u806F\u7E6B\u3002\u671F\u5F85\u672A\u4F86\u6709\u6A5F\u6703\u5408\u4F5C\u3002",`{greeting}\uFF0C\u6211\u5C0D${e}\u5F88\u611F\u8208\u8DA3\uFF0C\u770B\u5230\u60A8\u4E5F\u5728\u9019\u500B\u9818\u57DF\uFF0C\u60F3\u5411\u60A8\u8ACB\u6559\u3002`],humorous:["{greeting}\uFF01\u6211\u4E0D\u662F\u63A8\u92B7\u54E1\uFF0C\u53EA\u662F\u89BA\u5F97\u4F60\u770B\u8D77\u4F86\u5F88\u9177\u60F3\u8A8D\u8B58\u4E00\u4E0B \u{1F60E}",`Hi {name}\uFF01\u5225\u64D4\u5FC3\uFF0C\u6211\u53EA\u662F\u60F3\u804A\u804A${e}\u800C\u5DF2\uFF0C\u4E0D\u6703\u63A8\u92B7\u4EFB\u4F55\u6771\u897F \u{1F923}`,`{greeting}\uFF01\u80FD\u9047\u5230\u5C0D${e}\u611F\u8208\u8DA3\u7684\u4EBA\u771F\u662F\u592A\u96E3\u5F97\u4E86\uFF01`,"\u55E8\uFF01\u770B\u5230\u4F60\u5728\u7FA4\u88E1\u7684\u767C\u8A00\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u5FCD\u4E0D\u4F4F\u4F86\u6253\u500B\u62DB\u547C~","{greeting}\uFF01\u96E3\u5F97\u9047\u5230\u540C\u597D\uFF0C\u5FC5\u9808\u8A8D\u8B58\u4E00\u4E0B\uFF01"],concise:["{greeting}\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B\u3002",`Hi {name}\uFF0C\u95DC\u65BC${e}\u60F3\u548C\u4F60\u804A\u804A\u3002`,`\u60A8\u597D\uFF0C\u770B\u5230\u4F60\u5C0D${e}\u611F\u8208\u8DA3\uFF0C\u65B9\u4FBF\u4EA4\u6D41\u55CE\uFF1F`,`{greeting}\uFF0C\u6211\u4E5F\u95DC\u6CE8${e}\uFF0C\u4EA4\u500B\u670B\u53CB\uFF1F`,`Hi\uFF0C\u60F3\u8ACB\u6559\u4E00\u4E0B${e}\u76F8\u95DC\u7684\u554F\u984C\u3002`],enthusiastic:["{greeting}\uFF01\uFF01\u592A\u958B\u5FC3\u80FD\u8A8D\u8B58\u4F60\u4E86\uFF01\u{1F389}",`\u54C7\uFF01{name}\uFF01\u7D42\u65BC\u627E\u5230\u540C\u6A23\u559C\u6B61${e}\u7684\u4EBA\u4E86\uFF01\u2728`,"{greeting}\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u8D85\u8208\u596E\u7684\uFF01\u6211\u5011\u4E00\u5B9A\u6709\u5F88\u591A\u5171\u540C\u8A71\u984C\uFF01",`Hi {name}\uFF01\u2764\uFE0F \u8D85\u7D1A\u671F\u5F85\u548C\u4F60\u804A${e}\uFF01`,"{greeting}\uFF01\u9047\u5230\u4F60\u7C21\u76F4\u592A\u68D2\u4E86\uFF01\u{1F31F}"]},o=n[t]||n.friendly;this.aiGeneratedMessages.set(o),this.toast.info("\u5DF2\u751F\u6210\u672C\u5730\u6A21\u677F\u4F9B\u9078\u64C7")}selectAiMessage(e){this.messageContent=e}isMessageSelected(e){return this.selectedMessages().has(e)}toggleMessageSelection(e){let t=new Set(this.selectedMessages());t.has(e)?t.delete(e):t.add(e),this.selectedMessages.set(t),t.size===1?this.messageContent=Array.from(t)[0]:t.size>1?this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${t.size} \u500B\u6A21\u677F`:this.messageContent=""}selectAllMessages(){let e=new Set(this.aiGeneratedMessages());this.selectedMessages.set(e),this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${e.size} \u500B\u6A21\u677F`}clearSelectedMessages(){this.selectedMessages.set(new Set),this.messageContent=""}setSendStrategy(e){this.sendStrategy.set(e)}getStrategyDescription(){return{random:`\u5C07\u96A8\u6A5F\u9078\u64C7\u6A21\u677F\u767C\u9001\u7D66 ${this.targets().length} \u500B\u7528\u6236\uFF0C\u589E\u52A0\u6D88\u606F\u591A\u6A23\u6027`,rotate:"\u6A21\u677F\u5C07\u8F2A\u6D41\u4F7F\u7528\uFF0C\u78BA\u4FDD\u6BCF\u500B\u6A21\u677F\u88AB\u5747\u52FB\u4F7F\u7528",sequential:"\u6309\u9806\u5E8F\u4F9D\u6B21\u4F7F\u7528\u6BCF\u500B\u6A21\u677F"}[this.sendStrategy()]||""}canSend(){return this.selectedMessages().size>0?!0:this.messageContent.trim().length>0||this.attachments().length>0}insertVariable(e){this.messageContent+=e}async selectImages(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"Images",extensions:["jpg","jpeg","png","gif","webp"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(n=>({name:n.fileName,path:n.filePath,type:n.fileType}));this.attachments.update(n=>[...n,...t])}}catch(e){console.error("Select images failed:",e)}}async selectFiles(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"All Files",extensions:["*"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(n=>({name:n.fileName,path:n.filePath,type:n.fileType}));this.attachments.update(n=>[...n,...t])}}catch(e){console.error("Select files failed:",e)}}removeAttachment(e){this.attachments.update(t=>t.filter((n,o)=>o!==e))}previewMessage(){this.showPreview.set(!0)}replaceVariables(e,t){let n=e,o=t.firstName||t.first_name||"",a=t.lastName||t.last_name||"",d=t.username||"",u=t.displayName||t.name||o||d||"\u670B\u53CB",p=`${o} ${a}`.trim()||u,g=t.groupName||t.sourceGroup||t.source||"\u7FA4\u7D44",C=t.keyword||t.triggeredKeyword||t.matchedKeyword||"",w=t.source||t.sourceType||"";n=n.replace(/{firstName}/g,o),n=n.replace(/{first_name}/g,o),n=n.replace(/{lastName}/g,a),n=n.replace(/{last_name}/g,a),n=n.replace(/{username}/g,d),n=n.replace(/{displayName}/g,u),n=n.replace(/{name}/g,u),n=n.replace(/{fullName}/g,p),n=n.replace(/{full_name}/g,p),n=n.replace(/{groupName}/g,g),n=n.replace(/{group_name}/g,g),n=n.replace(/{keyword}/g,C),n=n.replace(/{source}/g,w);let A=new Date,V=A.getHours(),G="\u60A8\u597D";V>=5&&V<12?G="\u65E9\u4E0A\u597D":V>=12&&V<14?G="\u4E2D\u5348\u597D":V>=14&&V<18?G="\u4E0B\u5348\u597D":V>=18&&V<22?G="\u665A\u4E0A\u597D":G="\u591C\u6DF1\u4E86";let z=["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],$=`${A.getMonth()+1}\u6708${A.getDate()}\u65E5`,K=`${A.getHours().toString().padStart(2,"0")}:${A.getMinutes().toString().padStart(2,"0")}`,Z=z[A.getDay()];return n=n.replace(/{greeting}/g,G),n=n.replace(/{date}/g,$),n=n.replace(/{time}/g,K),n=n.replace(/{day}/g,Z),n}startSending(){if(!this.canSend())return;this.isSending.set(!0),this.sentCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.currentTarget.set(""),this.failureReasons.set({});let e=Array.from(this.selectedMessages()),t=e.length>1,n={targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,lastName:o.lastName,displayName:o.displayName,groupName:o.groupName,keyword:o.keyword,source:o.source})),attachments:this.attachments(),config:{minInterval:this.minInterval,maxInterval:this.maxInterval,accountRotation:this.accountRotation}};t?(n.messages=e,n.sendStrategy=this.sendStrategy(),n.message="",this.toast.info(`\u{1F4E8} \u4F7F\u7528 ${e.length} \u500B\u6A21\u677F${this.sendStrategy()==="random"?"\u96A8\u6A5F":this.sendStrategy()==="rotate"?"\u8F2A\u8F49":"\u9806\u5E8F"}\u767C\u9001...`)):e.length===1?n.message=e[0]:n.message=this.messageContent,this.ipc.send("batch-send:start",n),t||this.toast.info(`\u{1F4E8} \u958B\u59CB\u6279\u91CF\u767C\u9001 ${this.targets().length} \u689D\u6D88\u606F...`)}close(){if(this.isSending()){if(!confirm("\u767C\u9001\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-send:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isSending()&&this.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-batch-send-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"]},outputs:{closeDialog:"closeDialog",sendComplete:"sendComplete"},decls:2,vars:2,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/80","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-blue-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-blue-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"p-4","bg-purple-500/10","rounded-xl","border","border-purple-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"text-xs","text-blue-400","ml-2"],["rows","5","placeholder",`\u8F38\u5165\u6D88\u606F\u5167\u5BB9...

\u9EDE\u64CA\u4E0B\u65B9\u8B8A\u91CF\u6309\u9215\u53EF\u5FEB\u901F\u63D2\u5165\uFF0C\u4F8B\u5982\uFF1A
{greeting}{name}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u4F60\uFF01`,1,"w-full","bg-slate-800/50","border","border-slate-600","rounded-xl","p-4","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mt-2","flex","flex-wrap","gap-2","items-center"],[1,"text-xs","text-slate-500"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"title"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-800/50","border","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","hover:border-slate-500","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"mt-3","flex","flex-wrap","gap-2"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","10","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","10","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","ngModel"],[1,"w-11","h-6","bg-slate-700","peer-focus:ring-2","peer-focus:ring-blue-500","rounded-full","peer","peer-checked:after:translate-x-full","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-500"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-3","bg-slate-700","text-white","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-blue-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-blue-500/20",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium","text-slate-300"],[1,"text-xs","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","gap-2","mb-3","flex-wrap"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-blue-500","text-white","bg-slate-700","text-slate-400"],[1,"flex","items-center","justify-center","py-6"],[1,"text-center","py-6","text-slate-500"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"ml-2","text-slate-400","text-sm"],[1,"text-xs","mt-1"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"click"],[1,"flex","items-center","justify-between","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","line-clamp-2"],[1,"text-sm","font-medium","text-purple-300"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs",3,"bg-green-500/20","text-green-400","bg-amber-500/20","text-amber-400"],[1,"space-y-3"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u6253\u500B\u62DB\u547C\u3001\u4ECB\u7D39\u7522\u54C1\u3001\u9080\u8ACB\u52A0\u7FA4...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"w-full","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"space-y-3","mt-3"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs"],[1,"w-2","h-2","bg-green-500","rounded-full","animate-pulse"],[1,"w-2","h-2","bg-amber-500","rounded-full"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],[1,"text-xs","text-slate-400"],[1,"text-xs","px-2","py-1","bg-purple-500/20","text-purple-400","rounded","hover:bg-purple-500/30",3,"click"],[1,"text-xs","px-2","py-1","bg-slate-700","text-slate-400","rounded","hover:bg-slate-600",3,"click"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer"],["type","checkbox",1,"mt-1","w-4","h-4","rounded","bg-slate-700","border-slate-500","text-purple-500","focus:ring-purple-500",3,"change","checked"],[1,"flex-1","text-sm","text-slate-300"],[1,"text-xs","text-slate-400","block","mb-2"],[1,"flex","gap-2","flex-wrap"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400","title"],[1,"text-xs","text-slate-500","mt-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"click","title"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"click","title"],[1,"text-slate-500"],[1,"text-white"],[1,"flex","items-center","gap-2","px-3","py-2","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"text-lg"],[1,"text-sm","text-white","max-w-[150px]","truncate"],[1,"text-slate-400","hover:text-red-400",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-white"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-blue-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"mt-2","text-xs","text-cyan-400"],[1,"mt-3","p-2","bg-red-500/10","border","border-red-500/20","rounded-lg"],[1,"text-xs","text-red-400","font-medium","mb-1"],[1,"text-xs","px-2","py-0.5","bg-red-500/20","text-red-300","rounded"],[1,"animate-spin"],[1,"bg-slate-900","rounded-xl","p-6","max-w-md","w-full","border","border-slate-700"],[1,"text-lg","font-bold","text-white","mb-4"],[1,"p-4","bg-slate-800","rounded-lg","text-white","whitespace-pre-wrap"],[1,"mt-3","text-sm","text-slate-400"],[1,"mt-4","w-full","py-2","bg-slate-700","text-white","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"]],template:function(t,n){t&1&&(y(0,SA,86,53,"div",0),y(1,EA,9,2,"div",1)),t&2&&(S(n.isOpen()?0:-1),c(),S(n.showPreview()?1:-1))},dependencies:[oe,ae,xe,Rt,it,ve,Nt,tn,he],encapsulation:2})}};var DA=(i,e)=>e.telegramId,I_=(i,e)=>e.id,AA=(i,e)=>e.key;function MA(i,e){i&1&&(r(0,"div",42),ne(),r(1,"svg",45),B(2,"circle",46)(3,"path",47),s(),ce(),r(4,"span",48),l(5,"\u8F09\u5165\u7FA4\u7D44\u5217\u8868..."),s()())}function TA(i,e){i&1&&(r(0,"div",43)(1,"p",49),l(2,"\u{1F605} \u6C92\u6709\u53EF\u7528\u7684\u7FA4\u7D44"),s(),r(3,"p",50),l(4,"\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44\u4E26\u4E14\u64C1\u6709\u9080\u8ACB\u6B0A\u9650"),s()())}function kA(i,e){i&1&&(r(0,"span",57),l(1,"\u7BA1\u7406\u54E1"),s())}function IA(i,e){i&1&&(r(0,"span",58),l(1,"\u6210\u54E1"),s())}function FA(i,e){i&1&&(ne(),r(0,"svg",61),B(1,"path",62),s())}function PA(i,e){if(i&1){let t=I();r(0,"button",52),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.selectGroup(o))}),r(1,"div",53),l(2),s(),r(3,"div",54)(4,"div",55)(5,"span",56),l(6),s(),y(7,kA,2,0,"span",57)(8,IA,2,0,"span",58),s(),r(9,"div",59)(10,"span"),l(11),Ee(12,"number"),s(),r(13,"span"),l(14,"\u2022"),s(),r(15,"span",60),l(16),s()()(),y(17,FA,2,0,":svg:svg",61),s()}if(i&2){let t,n,o,a,d,u,p=e.$implicit,g=m(4);N("border-emerald-500",((t=g.selectedGroup())==null?null:t.id)===p.id)("bg-emerald-500/10",((n=g.selectedGroup())==null?null:n.id)===p.id)("border-slate-600",((o=g.selectedGroup())==null?null:o.id)!==p.id)("bg-slate-800/50",((a=g.selectedGroup())==null?null:a.id)!==p.id)("hover:border-slate-500",((d=g.selectedGroup())==null?null:d.id)!==p.id),c(),N("from-blue-500",p.type==="group")("to-cyan-500",p.type==="group")("from-purple-500",p.type==="supergroup")("to-pink-500",p.type==="supergroup")("from-amber-500",p.type==="channel")("to-orange-500",p.type==="channel"),c(),M(" ",p.type==="channel"?"\u{1F4E2}":"\u{1F465}"," "),c(4),D(p.name),c(),S(p.isAdmin?7:8),c(4),M("\u{1F464} ",je(12,28,p.memberCount)," \u6210\u54E1"),c(5),D(p.url),c(),S(((u=g.selectedGroup())==null?null:u.id)===p.id?17:-1)}}function RA(i,e){if(i&1&&(r(0,"div",44),O(1,PA,18,30,"button",51,I_),s()),i&2){let t=m(3);c(),U(t.availableGroups())}}function NA(i,e){if(i&1&&(r(0,"div")(1,"label",30),l(2," \u9078\u64C7\u76EE\u6A19\u7FA4\u7D44 "),s(),y(3,MA,6,0,"div",42)(4,TA,5,0,"div",43)(5,RA,3,0,"div",44),s()),i&2){let t=m(2);c(3),S(t.isLoadingGroups()?3:t.availableGroups().length===0?4:5)}}function VA(i,e){if(i&1){let t=I();r(0,"div")(1,"span",64),l(2,"\u7FA4\u7D44\u540D\u7A31\uFF1A"),s(),r(3,"input",71),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.newGroupName,o)||(a.newGroupName=o),v(o)}),s(),r(4,"span",72),l(5),s()()}if(i&2){let t=m(3);c(3),H("ngModel",t.newGroupName),c(2),M("",t.newGroupName.length,"/128")}}function BA(i,e){if(i&1){let t=I();r(0,"button",76),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.selectedGroupNameStyle.set(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(4);N("bg-purple-500",n.selectedGroupNameStyle()===t.key)("text-white",n.selectedGroupNameStyle()===t.key)("bg-slate-700",n.selectedGroupNameStyle()!==t.key)("text-slate-400",n.selectedGroupNameStyle()!==t.key),c(),M(" ",t.label," ")}}function LA(i,e){i&1&&(ne(),r(0,"svg",77),B(1,"circle",46)(2,"path",78),s(),l(3," \u751F\u6210\u4E2D... "))}function OA(i,e){i&1&&l(0," \u2728 \u751F\u6210\u7FA4\u540D ")}function UA(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){let o=_(t).$implicit,a=m(5);return v(a.selectGeneratedName(o))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(5);N("border-purple-500",n.newGroupName===t)("bg-purple-500/10",n.newGroupName===t)("border-slate-600",n.newGroupName!==t)("bg-slate-800/50",n.newGroupName!==t),c(),M(" ",t," ")}}function GA(i,e){if(i&1&&(r(0,"div",26)(1,"span",79),l(2,"\u9078\u64C7\u4E00\u500B\uFF1A"),s(),O(3,UA,2,9,"button",80,ct),s()),i&2){let t=m(4);c(3),U(t.generatedGroupNames())}}function $A(i,e){if(i&1){let t=I();r(0,"div",27)(1,"div")(2,"span",64),l(3,"\u4E3B\u984C/\u95DC\u9375\u8A5E\uFF1A"),s(),r(4,"input",73),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.aiGroupKeywords,o)||(a.aiGroupKeywords=o),v(o)}),s()(),r(5,"div")(6,"span",64),l(7,"\u98A8\u683C\uFF1A"),s(),r(8,"div",32),O(9,BA,2,9,"button",74,AA),s()(),r(11,"button",75),x("click",function(){_(t);let o=m(3);return v(o.generateGroupNames())}),y(12,LA,4,0)(13,OA,1,0),s(),y(14,GA,5,0,"div",26),s()}if(i&2){let t=m(3);c(4),H("ngModel",t.aiGroupKeywords),c(5),U(t.groupNameStyles),c(2),L("disabled",t.isGeneratingNames()||!t.aiGroupKeywords.trim()),c(),S(t.isGeneratingNames()?12:13),c(2),S(t.generatedGroupNames().length>0?14:-1)}}function HA(i,e){if(i&1){let t=I();r(0,"div",16)(1,"label",63),l(2,"\u{1F4DD} \u65B0\u7FA4\u7D44\u4FE1\u606F"),s(),r(3,"div")(4,"span",64),l(5,"\u7FA4\u540D\u751F\u6210\uFF1A"),s(),r(6,"div",14)(7,"button",25),x("click",function(){_(t);let o=m(2);return v(o.groupNameMode.set("manual"))}),l(8," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),s(),r(9,"button",25),x("click",function(){_(t);let o=m(2);return v(o.groupNameMode.set("ai"))}),l(10," \u{1F916} AI \u751F\u6210 "),s()()(),y(11,VA,6,2,"div"),y(12,$A,15,4,"div",27),r(13,"div")(14,"span",64),l(15,"\u7FA4\u7D44\u985E\u578B\uFF1A"),s(),r(16,"div",65)(17,"label",66)(18,"input",67),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.newGroupType,o)||(a.newGroupType=o),v(o)}),s(),r(19,"span",68),l(20,"\u666E\u901A\u7FA4\u7D44 (\u6700\u591A 200 \u4EBA)"),s()(),r(21,"label",66)(22,"input",69),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.newGroupType,o)||(a.newGroupType=o),v(o)}),s(),r(23,"span",68),l(24,"\u8D85\u7D1A\u7FA4\u7D44 (\u6700\u591A 20 \u842C\u4EBA)"),s()()()(),r(25,"div")(26,"span",64),l(27,"\u7FA4\u7D44\u63CF\u8FF0\uFF08\u53EF\u9078\uFF09\uFF1A"),s(),r(28,"textarea",70),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.newGroupDescription,o)||(a.newGroupDescription=o),v(o)}),l(29,"                  "),s()()()}if(i&2){let t=m(2);c(7),N("bg-cyan-500",t.groupNameMode()==="manual")("text-white",t.groupNameMode()==="manual")("bg-slate-700",t.groupNameMode()!=="manual")("text-slate-400",t.groupNameMode()!=="manual"),c(2),N("bg-purple-500",t.groupNameMode()==="ai")("text-white",t.groupNameMode()==="ai")("bg-slate-700",t.groupNameMode()!=="ai")("text-slate-400",t.groupNameMode()!=="ai"),c(2),S(t.groupNameMode()==="manual"?11:-1),c(),S(t.groupNameMode()==="ai"?12:-1),c(6),H("ngModel",t.newGroupType),c(4),H("ngModel",t.newGroupType),c(6),H("ngModel",t.newGroupDescription)}}function qA(i,e){i&1&&(r(0,"div",82),ne(),r(1,"svg",85),B(2,"circle",46)(3,"path",78),s(),ce(),r(4,"span",86),l(5,"\u8F09\u5165\u6A21\u677F..."),s()())}function WA(i,e){i&1&&(r(0,"p",83),l(1,"\u6C92\u6709\u53EF\u7528\u7684\u6A21\u677F"),s())}function zA(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.selectWelcomeTemplate(o))}),r(1,"span",88),l(2),s(),r(3,"p",89),l(4),s()()}if(i&2){let t,n,o,a,d=e.$implicit,u=m(4);N("border-blue-500",((t=u.selectedWelcomeTemplate())==null?null:t.id)===d.id)("bg-blue-500/10",((n=u.selectedWelcomeTemplate())==null?null:n.id)===d.id)("border-slate-600",((o=u.selectedWelcomeTemplate())==null?null:o.id)!==d.id)("bg-slate-800/50",((a=u.selectedWelcomeTemplate())==null?null:a.id)!==d.id),c(2),D(d.name),c(2),D(d.content)}}function KA(i,e){if(i&1&&(r(0,"div",84),O(1,zA,5,10,"button",87,I_),s()),i&2){let t=m(3);c(),U(t.welcomeTemplates())}}function jA(i,e){if(i&1&&(r(0,"div",26),y(1,qA,6,0,"div",82)(2,WA,2,0,"p",83)(3,KA,3,0,"div",84),s()),i&2){let t=m(2);c(),S(t.isLoadingTemplates()?1:t.welcomeTemplates().length===0?2:3)}}function JA(i,e){i&1&&(ne(),r(0,"svg",77),B(1,"circle",46)(2,"path",78),s(),l(3," \u751F\u6210\u4E2D... "))}function QA(i,e){i&1&&l(0," \u2728 \u751F\u6210\u6B61\u8FCE\u6D88\u606F ")}function YA(i,e){if(i&1&&(r(0,"div",91)(1,"p",92),l(2),s()()),i&2){let t=m(3);c(2),D(t.generatedWelcomeMessage())}}function XA(i,e){if(i&1){let t=I();r(0,"div",27)(1,"input",90),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.aiWelcomeTopic,o)||(a.aiWelcomeTopic=o),v(o)}),s(),r(2,"button",75),x("click",function(){_(t);let o=m(2);return v(o.generateWelcomeMessage())}),y(3,JA,4,0)(4,QA,1,0),s(),y(5,YA,3,1,"div",91),s()}if(i&2){let t=m(2);c(),H("ngModel",t.aiWelcomeTopic),c(),L("disabled",t.isGeneratingWelcome()||!t.aiWelcomeTopic.trim()),c(),S(t.isGeneratingWelcome()?3:4),c(2),S(t.generatedWelcomeMessage()?5:-1)}}function ZA(i,e){if(i&1){let t=I();r(0,"div",28)(1,"span",64),l(2,"\u6D88\u606F\u5167\u5BB9\uFF1A"),s(),r(3,"textarea",93),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.welcomeMessageContent,o)||(a.welcomeMessageContent=o),v(o)}),l(4,"                  "),s()()}if(i&2){let t=m(2);c(3),H("ngModel",t.welcomeMessageContent)}}function e8(i,e){if(i&1&&(r(0,"span",98),l(1),s()),i&2){let t=m(3);c(),M("\u26A0\uFE0F \u5DF2\u5728\u7FA4\u5167: ",t.permissionCheck().alreadyInGroup," \u4EBA")}}function t8(i,e){if(i&1&&(r(0,"span",99),l(1),s()),i&2){let t=m(3);c(),M("\u274C \u96B1\u79C1\u9650\u5236: ",t.permissionCheck().privacyRestricted," \u4EBA")}}function n8(i,e){if(i&1&&(r(0,"div",94)(1,"h4",95),l(2,"\u{1F4CA} \u6B0A\u9650\u6AA2\u67E5\u7D50\u679C"),s(),r(3,"div",96)(4,"span",97),l(5),s(),y(6,e8,2,1,"span",98),y(7,t8,2,1,"span",99),s()()),i&2){let t=m(2);N("bg-emerald-500/10",t.permissionCheck().canInvite>0)("border",!0)("border-emerald-500/30",t.permissionCheck().canInvite>0)("bg-amber-500/10",t.permissionCheck().canInvite===0)("border-amber-500/30",t.permissionCheck().canInvite===0),c(5),M("\u2705 \u53EF\u62C9\u5165: ",t.permissionCheck().canInvite," \u4EBA"),c(),S(t.permissionCheck().alreadyInGroup>0?6:-1),c(),S(t.permissionCheck().privacyRestricted>0?7:-1)}}function i8(i,e){if(i&1&&(r(0,"span",33),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function o8(i,e){if(i&1&&(r(0,"span",34),l(1),s()),i&2){let t=m(2);c(),M(" +",t.targets().length-20," \u66F4\u591A... ")}}function r8(i,e){if(i&1&&(r(0,"div",35)(1,"div",100)(2,"span",92),l(3,"\u62C9\u7FA4\u9032\u5EA6"),s(),r(4,"span",8),l(5),s()(),r(6,"div",101),B(7,"div",102),s(),r(8,"div",103)(9,"span",104),l(10),s(),r(11,"span",98),l(12),s(),r(13,"span",99),l(14),s(),r(15,"span"),l(16),s()(),r(17,"p",105),l(18," \u{1F4A1} \u6210\u529F\u5305\u542B\uFF1A\u76F4\u63A5\u9080\u8ACB + \u5DF2\u767C\u9001\u9080\u8ACB\u93C8\u63A5 "),s()()),i&2){let t=m(2);c(5),X("",t.invitedCount()," / ",t.targets().length),c(2),ee("width",t.progressPercent(),"%"),c(3),M("\u2705 \u6210\u529F: ",t.successCount()),c(2),M("\u26A0\uFE0F \u8DF3\u904E: ",t.skippedCount()),c(2),M("\u274C \u5931\u6557: ",t.failedCount()),c(2),M("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining())}}function s8(i,e){i&1&&(r(0,"div",36)(1,"div",106)(2,"span"),l(3,"\u26A0\uFE0F"),s(),r(4,"span"),l(5,"\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F\u5F8C\u518D\u9032\u884C\u62C9\u7FA4\u64CD\u4F5C"),s()()())}function a8(i,e){if(i&1&&(r(0,"div",37)(1,"div",107)(2,"span"),l(3,"\u{1F517}"),s(),r(4,"span"),l(5),s(),r(6,"span",108),l(7,"|"),s(),r(8,"span"),l(9),s()()()),i&2){let t,n=m(2);c(5),M("\u53EF\u7528\u5E33\u865F: ",n.onlineAccountsCount()," \u500B\u5728\u7DDA"),c(4),M("\u5C07\u4F7F\u7528: ",((t=n.preferredAccount())==null?null:t.firstName)||((t=n.preferredAccount())==null?null:t.phone)||"\u81EA\u52D5\u9078\u64C7")}}function l8(i,e){i&1&&l(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function c8(i,e){if(i&1&&(l(0),y(1,l8,1,0)),i&2){let t=m(3);X(" \u5275\u5EFA\u7FA4\u7D44\u300C",t.newGroupName,"\u300D\u2192 \u62C9\u5165 ",t.targets().length," \u4EBA "),c(),S(t.welcomeMessageSource()!=="none"?1:-1)}}function d8(i,e){i&1&&l(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function u8(i,e){if(i&1&&(l(0),y(1,d8,1,0)),i&2){let t,n=m(3);X(" \u62C9\u5165\u7FA4\u7D44\u300C",(t=n.selectedGroup())==null?null:t.name,"\u300D\u2192 ",n.targets().length," \u4EBA "),c(),S(n.welcomeMessageSource()!=="none"?1:-1)}}function m8(i,e){if(i&1&&(r(0,"div",38)(1,"div",109)(2,"span"),l(3,"\u{1F4CB}"),s(),r(4,"span"),y(5,c8,2,3)(6,u8,2,3),s()()()),i&2){let t=m(2);c(5),S(t.groupSource()==="create"?5:6)}}function p8(i,e){if(i&1&&(r(0,"span",110),l(1,"\u23F3"),s(),l(2)),i&2){let t=m(2);c(2),M(" ",t.createGroupProgressMessage()||"\u5275\u5EFA\u7FA4\u7D44\u4E2D..."," ")}}function g8(i,e){i&1&&(r(0,"span",110),l(1,"\u23F3"),s(),l(2," \u62C9\u7FA4\u4E2D... "))}function h8(i,e){if(i&1&&l(0),i&2){let t=m(2);M(" \u{1F680} \u5275\u5EFA\u4E26\u62C9\u4EBA (",t.targets().length," \u4EBA) ")}}function f8(i,e){if(i&1&&l(0),i&2){let t=m(2);M(" \u{1F465} \u958B\u59CB\u62C9\u7FA4 (",t.targets().length," \u4EBA) ")}}function _8(i,e){if(i&1){let t=I();r(0,"div",1),x("click",function(o){_(t);let a=m();return v(a.onBackdropClick(o))}),r(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),l(6," \u{1F465} "),s(),r(7,"div")(8,"h2",7),l(9,"\u6279\u91CF\u62C9\u5165\u7FA4\u7D44"),s(),r(10,"p",8),l(11),s()()(),r(12,"button",9),x("click",function(){_(t);let o=m();return v(o.close())}),ne(),r(13,"svg",10),B(14,"path",11),s()()()(),ce(),r(15,"div",12)(16,"div")(17,"label",13),l(18," \u{1F3AF} \u7FA4\u7D44\u4F86\u6E90 "),s(),r(19,"div",14)(20,"button",15),x("click",function(){_(t);let o=m();return v(o.setGroupSource("existing"))}),l(21," \u{1F3E0} \u73FE\u6709\u7FA4\u7D44 "),s(),r(22,"button",15),x("click",function(){_(t);let o=m();return v(o.setGroupSource("create"))}),l(23," \u2795 \u5275\u5EFA\u65B0\u7FA4 "),s()()(),y(24,NA,6,1,"div"),y(25,HA,30,21,"div",16),r(26,"div",17)(27,"label",13),l(28," \u2699\uFE0F \u62C9\u7FA4\u8A2D\u7F6E "),s(),r(29,"div",18)(30,"div",5)(31,"span",19),l(32,"\u6BCF\u6279\u6B21\u4EBA\u6578\uFF1A"),s(),r(33,"input",20),W("ngModelChange",function(o){_(t);let a=m();return q(a.batchSize,o)||(a.batchSize=o),v(o)}),s(),r(34,"span",8),l(35,"\u4EBA"),s()(),r(36,"div",5)(37,"span",19),l(38,"\u6279\u6B21\u9593\u9694\uFF1A"),s(),r(39,"input",21),W("ngModelChange",function(o){_(t);let a=m();return q(a.minInterval,o)||(a.minInterval=o),v(o)}),s(),r(40,"span",22),l(41,"-"),s(),r(42,"input",23),W("ngModelChange",function(o){_(t);let a=m();return q(a.maxInterval,o)||(a.maxInterval=o),v(o)}),s(),r(43,"span",8),l(44,"\u79D2"),s()()()(),r(45,"div",17)(46,"label",13),l(47," \u{1F4AC} \u6B61\u8FCE\u6D88\u606F "),s(),r(48,"div",24)(49,"button",25),x("click",function(){_(t);let o=m();return v(o.welcomeMessageSource.set("none"))}),l(50," \u274C \u4E0D\u767C\u9001 "),s(),r(51,"button",25),x("click",function(){_(t);let o=m();return v(o.welcomeMessageSource.set("template"))}),l(52," \u{1F4C4} \u9078\u6A21\u677F "),s(),r(53,"button",25),x("click",function(){_(t);let o=m();return v(o.welcomeMessageSource.set("ai"))}),l(54," \u{1F916} AI \u751F\u6210 "),s()(),y(55,jA,4,1,"div",26),y(56,XA,6,4,"div",27),y(57,ZA,5,1,"div",28),s(),y(58,n8,8,13,"div",29),r(59,"div")(60,"label",30),l(61),s(),r(62,"div",31)(63,"div",32),O(64,i8,2,1,"span",33,DA),y(66,o8,2,1,"span",34),s()()()(),y(67,r8,19,8,"div",35),y(68,s8,6,0,"div",36)(69,a8,10,2,"div",37),y(70,m8,7,1,"div",38),r(71,"div",39)(72,"button",40),x("click",function(){_(t);let o=m();return v(o.close())}),l(73),s(),r(74,"button",41),x("click",function(){_(t);let o=m();return v(o.startInviting())}),y(75,p8,3,1)(76,g8,3,0)(77,h8,1,1)(78,f8,1,1),s()()()()}if(i&2){let t=m();c(11),M("\u5C07 ",t.targets().length," \u500B\u7528\u6236\u62C9\u5165\u7FA4\u7D44"),c(9),N("border-emerald-500",t.groupSource()==="existing")("bg-emerald-500/20",t.groupSource()==="existing")("text-emerald-400",t.groupSource()==="existing")("border-slate-600",t.groupSource()!=="existing")("bg-slate-800/50",t.groupSource()!=="existing")("text-slate-400",t.groupSource()!=="existing"),c(2),N("border-cyan-500",t.groupSource()==="create")("bg-cyan-500/20",t.groupSource()==="create")("text-cyan-400",t.groupSource()==="create")("border-slate-600",t.groupSource()!=="create")("bg-slate-800/50",t.groupSource()!=="create")("text-slate-400",t.groupSource()!=="create"),c(2),S(t.groupSource()==="existing"?24:-1),c(),S(t.groupSource()==="create"?25:-1),c(8),H("ngModel",t.batchSize),c(6),H("ngModel",t.minInterval),c(3),H("ngModel",t.maxInterval),c(7),N("bg-slate-600",t.welcomeMessageSource()==="none")("text-white",t.welcomeMessageSource()==="none")("bg-slate-700",t.welcomeMessageSource()!=="none")("text-slate-400",t.welcomeMessageSource()!=="none"),c(2),N("bg-blue-500",t.welcomeMessageSource()==="template")("text-white",t.welcomeMessageSource()==="template")("bg-slate-700",t.welcomeMessageSource()!=="template")("text-slate-400",t.welcomeMessageSource()!=="template"),c(2),N("bg-purple-500",t.welcomeMessageSource()==="ai")("text-white",t.welcomeMessageSource()==="ai")("bg-slate-700",t.welcomeMessageSource()!=="ai")("text-slate-400",t.welcomeMessageSource()!=="ai"),c(2),S(t.welcomeMessageSource()==="template"?55:-1),c(),S(t.welcomeMessageSource()==="ai"?56:-1),c(),S(t.welcomeMessageSource()!=="none"?57:-1),c(),S(t.selectedGroup()?58:-1),c(3),M(" \u{1F465} \u76EE\u6A19\u7528\u6236\uFF08",t.targets().length," \u4EBA\uFF09 "),c(3),U(t.targets().slice(0,20)),c(2),S(t.targets().length>20?66:-1),c(),S(t.isInviting()?67:-1),c(),S(t.onlineAccountsCount()===0?68:69),c(2),S(t.canInvite()?70:-1),c(2),L("disabled",t.isInviting()||t.isCreatingGroup()),c(),M(" ",t.isInviting()||t.isCreatingGroup()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),c(),L("disabled",!t.canInvite()||t.isInviting()||t.isCreatingGroup()),c(),S(t.isCreatingGroup()?75:t.isInviting()?76:t.groupSource()==="create"?77:78)}}var ic=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.isOpen=Le(!1);this.targets=Le([]);this.accounts=Le([]);this.closeDialog=ge();this.inviteComplete=ge();this._currentInviteId=f(null);this.groupSource=f("existing");this.availableGroups=f([]);this.isLoadingGroups=f(!1);this.selectedGroup=f(null);this.groupNameMode=f("manual");this.newGroupName="";this.newGroupType="supergroup";this.newGroupDescription="";this.aiGroupKeywords="";this.selectedGroupNameStyle=f("professional");this.isGeneratingNames=f(!1);this.generatedGroupNames=f([]);this.groupNameStyles=[{key:"professional",label:"\u5C08\u696D\u6B63\u5F0F"},{key:"lively",label:"\u6D3B\u6F51\u6709\u8DA3"},{key:"mysterious",label:"\u795E\u79D8\u9AD8\u7AEF"},{key:"simple",label:"\u7C21\u7D04\u660E\u4E86"}];this.welcomeMessageSource=f("none");this.welcomeTemplates=f([]);this.isLoadingTemplates=f(!1);this.selectedWelcomeTemplate=f(null);this.welcomeMessageContent="";this.aiWelcomeTopic="";this.isGeneratingWelcome=f(!1);this.generatedWelcomeMessage=f("");this.batchSize=10;this.minInterval=60;this.maxInterval=120;this.isInviting=f(!1);this.invitedCount=f(0);this.successCount=f(0);this.failedCount=f(0);this.skippedCount=f(0);this.isCreatingGroup=f(!1);this.createdGroupId=f(null);this.createGroupProgressMessage=f("");this.listeners=[];this.progressPercent=R(()=>{let e=this.targets().length;return e>0?this.invitedCount()/e*100:0});this.estimatedRemaining=R(()=>{let e=this.targets().length-this.invitedCount(),t=(this.minInterval+this.maxInterval)/2,o=Math.ceil(e/this.batchSize)*t;return o<60?`${Math.round(o)} \u79D2`:o<3600?`${Math.round(o/60)} \u5206\u9418`:`${Math.round(o/3600)} \u5C0F\u6642`});this.permissionCheck=R(()=>{let e=this.targets().length;return{canInvite:Math.floor(e*.8),alreadyInGroup:Math.floor(e*.1),privacyRestricted:Math.floor(e*.1)}});this.onlineAccountsCount=R(()=>this.accounts().filter(e=>e.status==="Online").length);this.preferredAccount=R(()=>{let e=this.accounts().filter(n=>n.status==="Online");return e.find(n=>n.role==="Sender")||e[0]||null});this.createGroupTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadAvailableGroups(),this.loadWelcomeTemplates()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-invite:progress",g=>{this.invitedCount.set(g.invited),this.successCount.set(g.success),this.failedCount.set(g.failed),this.skippedCount.set(g.skipped)});this.listeners.push(e);let t=this.ipc.on("batch-invite:complete",g=>{let C=this._currentInviteId();if(g.inviteId&&C&&g.inviteId!==C){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08inviteId \u4E0D\u5339\u914D\uFF09:",g.inviteId,"!=",C);return}if(!this.isOpen()&&!this.isInviting()&&!C){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08\u5C0D\u8A71\u6846\u672A\u6253\u958B\u4E14\u7121\u6D3B\u8E8D\u9080\u8ACB\uFF09");return}this._currentInviteId.set(null),this.isInviting.set(!1),this.isCreatingGroup.set(!1),this.inviteComplete.emit({success:g.success,failed:g.failed,skipped:g.skipped}),g.success>0?this.toast.success(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u2705 \u6210\u529F/\u5DF2\u767C\u9001\u9080\u8ACB ${g.success} \u4EBA\uFF0C\u26A0\uFE0F \u8DF3\u904E ${g.skipped}\uFF0C\u274C \u5931\u6557 ${g.failed}`):g.skipped>0?this.toast.warning("\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6240\u6709\u7528\u6236\u5DF2\u5728\u7FA4\u5167\u6216\u96B1\u79C1\u9650\u5236"):this.toast.error("\u6279\u91CF\u62C9\u7FA4\u5931\u6557\uFF1A\u7121\u6CD5\u9080\u8ACB\u4EFB\u4F55\u7528\u6236\uFF0C\u8ACB\u6AA2\u67E5\u5E33\u865F\u72C0\u614B")});this.listeners.push(t);let n=this.ipc.on("get-admin-groups-result",g=>{this.isLoadingGroups.set(!1),g.groups&&this.availableGroups.set(g.groups)});this.listeners.push(n);let o=this.ipc.on("get-chat-templates-result",g=>{this.isLoadingTemplates.set(!1),g.templates&&this.welcomeTemplates.set(g.templates.filter(C=>C.isEnabled))});this.listeners.push(o);let a=this.ipc.on("ai-generate-group-names-result",g=>{this.isGeneratingNames.set(!1),g.success&&g.names?(this.generatedGroupNames.set(g.names),this.toast.success("\u7FA4\u540D\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(g.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(a);let d=this.ipc.on("ai-generate-welcome-result",g=>{this.isGeneratingWelcome.set(!1),g.success&&g.message?(this.generatedWelcomeMessage.set(g.message),this.welcomeMessageContent=g.message,this.toast.success("\u6B61\u8FCE\u6D88\u606F\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(g.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(d);let u=this.ipc.on("create-group-progress",g=>{console.log("[BatchInvite] \u5275\u5EFA\u9032\u5EA6:",g),this.createGroupProgressMessage.set(g.message)});this.listeners.push(u);let p=this.ipc.on("create-group-result",g=>{if(console.log("[BatchInvite] \u6536\u5230\u5275\u5EFA\u7FA4\u7D44\u7D50\u679C:",g),this.createGroupTimeout&&(clearTimeout(this.createGroupTimeout),this.createGroupTimeout=null),this.isCreatingGroup.set(!1),g.success&&g.groupId)this.createdGroupId.set(g.groupId),this.toast.success(`\u7FA4\u7D44\u300C${this.newGroupName}\u300D\u5275\u5EFA\u6210\u529F\uFF01`),this.startInvitingToGroup(g.groupId,g.groupUrl||"");else{let C=g.error||"\u5275\u5EFA\u7FA4\u7D44\u5931\u6557";C.includes("FLOOD")?this.toast.error("\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"):C.includes("not connected")||C.includes("Offline")?this.toast.error("\u5E33\u865F\u672A\u9023\u63A5\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"):C.includes("PEER_FLOOD")?this.toast.error("\u5E33\u865F\u88AB\u9650\u5236\uFF0C\u8ACB\u66F4\u63DB\u5E33\u865F\u6216\u7A0D\u5F8C\u518D\u8A66"):this.toast.error(C)}});this.listeners.push(p)}setGroupSource(e){this.groupSource.set(e),e==="existing"&&this.loadAvailableGroups()}loadAvailableGroups(){this.isLoadingGroups.set(!0),this.ipc.send("get-admin-groups",{})}loadWelcomeTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectGroup(e){this.selectedGroup.set(e)}selectGeneratedName(e){this.newGroupName=e}generateGroupNames(){if(!this.aiGroupKeywords.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u4E3B\u984C\u95DC\u9375\u8A5E");return}this.isGeneratingNames.set(!0),this.generatedGroupNames.set([]),this.ipc.send("ai-generate-group-names",{keywords:this.aiGroupKeywords,style:this.selectedGroupNameStyle(),count:5})}selectWelcomeTemplate(e){this.selectedWelcomeTemplate.set(e),this.welcomeMessageContent=e.content}generateWelcomeMessage(){if(!this.aiWelcomeTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingWelcome.set(!0),this.generatedWelcomeMessage.set(""),this.ipc.send("ai-generate-welcome",{topic:this.aiWelcomeTopic,groupName:this.newGroupName||this.selectedGroup()?.name||""})}canInvite(){return this.groupSource()==="existing"?this.selectedGroup()!==null&&this.targets().length>0:this.newGroupName.trim().length>0&&this.targets().length>0}startInviting(){this.canInvite()&&(this.groupSource()==="create"?this.createGroupAndInvite():this.startInvitingToGroup(this.selectedGroup().id,this.selectedGroup().url))}async createGroupAndInvite(){let e=await this.checkOnlineAccounts();if(e.length===0){this.toast.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.isCreatingGroup.set(!0),this.createGroupProgressMessage.set("\u6B63\u5728\u6E96\u5099\u5275\u5EFA\u7FA4\u7D44..."),this.createGroupTimeout&&clearTimeout(this.createGroupTimeout),this.createGroupTimeout=setTimeout(()=>{this.isCreatingGroup()&&(this.isCreatingGroup.set(!1),this.toast.error("\u5275\u5EFA\u7FA4\u7D44\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u6216\u5E33\u865F\u72C0\u614B\uFF0C\u6216\u5617\u8A66\u5275\u5EFA\u666E\u901A\u7FA4\u7D44"))},6e4),console.log("[BatchInvite] \u958B\u59CB\u5275\u5EFA\u7FA4\u7D44:",{name:this.newGroupName,type:this.newGroupType,account:e[0]?.phone}),this.ipc.send("create-group",{name:this.newGroupName,description:this.newGroupDescription,type:this.newGroupType,accountPhone:e[0]?.phone}),this.toast.info(`\u6B63\u5728\u4F7F\u7528\u5E33\u865F ${e[0]?.firstName||e[0]?.phone} \u5275\u5EFA\u7FA4\u7D44...`)}async checkOnlineAccounts(){let e=this.accounts(),t=e.filter(n=>n.status==="Online");return console.log("[BatchInvite] \u6AA2\u67E5\u5E33\u865F: \u7E3D\u6578",e.length,", \u5728\u7DDA",t.length),t.length===0&&this.toast.warning("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"),t}startInvitingToGroup(e,t){let n=`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this._currentInviteId.set(n),this.isInviting.set(!0),this.invitedCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.skippedCount.set(0),this.ipc.send("batch-invite:start",{inviteId:n,groupId:e,groupUrl:t,targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,displayName:o.displayName})),config:{batchSize:this.batchSize,minInterval:this.minInterval,maxInterval:this.maxInterval,sendWelcomeMessage:this.welcomeMessageSource()!=="none",welcomeMessage:this.welcomeMessageContent}}),this.toast.info("\u958B\u59CB\u6279\u91CF\u62C9\u7FA4..."),console.log("[BatchInvite] \u958B\u59CB\u9080\u8ACB\uFF0CinviteId:",n)}close(){if(this.isInviting()){if(!confirm("\u62C9\u7FA4\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-invite:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isInviting()&&this.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-batch-invite-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"],accounts:[1,"accounts"]},outputs:{closeDialog:"closeDialog",inviteComplete:"inviteComplete"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30","space-y-4"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","1","max","50",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],["type","number","min","30","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","30","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"flex","gap-2","mb-3"],[1,"flex-1","py-2","rounded-lg","text-sm","transition-all",3,"click"],[1,"space-y-2"],[1,"space-y-3"],[1,"mt-3"],[1,"p-4","rounded-xl",3,"bg-emerald-500/10","border","border-emerald-500/30","bg-amber-500/10","border-amber-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-red-500/10","border-t","border-red-500/30"],[1,"px-5","py-2","bg-slate-800/30","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-emerald-500/20",3,"click","disabled"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2","max-h-48","overflow-y-auto","pr-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-6","w-6","text-cyan-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"ml-2","text-slate-400"],[1,"text-lg","mb-2"],[1,"text-sm"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"border-emerald-500","bg-emerald-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","flex","items-center","justify-center","text-lg"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white","truncate"],[1,"px-1.5","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded"],[1,"px-1.5","py-0.5","bg-slate-600","text-slate-400","text-xs","rounded"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"truncate"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-emerald-400","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"block","text-sm","font-medium","text-cyan-300"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"flex","gap-3"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","radio","name","groupType","value","group",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300"],["type","radio","name","groupType","value","supergroup",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],["rows","2","placeholder","\u7C21\u77ED\u4ECB\u7D39\u7FA4\u7D44\u76EE\u7684...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-cyan-500","text-sm",3,"ngModelChange","ngModel"],["type","text","placeholder","\u8F38\u5165\u7FA4\u7D44\u540D\u7A31...","maxlength","128",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1","block"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u5E63\u5708\u3001\u4EA4\u6D41\u3001VIP...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],[1,"w-full","py-2","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-sm",3,"click","disabled"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"text-xs","text-slate-400"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"click"],[1,"flex","items-center","justify-center","py-4"],[1,"text-sm","text-slate-500","text-center","py-4"],[1,"max-h-32","overflow-y-auto","space-y-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],[1,"ml-2","text-slate-400","text-sm"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400","truncate","mt-1"],["type","text","placeholder","\u6B61\u8FCE\u6D88\u606F\u4E3B\u984C\uFF0C\u4F8B\u5982\uFF1A\u6B61\u8FCE\u52A0\u5165\u3001\u793E\u7FA4\u4ECB\u7D39...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"p-3","bg-slate-800/50","rounded-lg","border","border-purple-500/30"],[1,"text-sm","text-white"],["rows","2","placeholder","\u8F38\u5165\u6B61\u8FCE\u6D88\u606F\u5167\u5BB9...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-emerald-500","text-sm",3,"ngModelChange","ngModel"],[1,"p-4","rounded-xl"],[1,"text-sm","font-medium","text-slate-300","mb-2"],[1,"flex","items-center","gap-6","text-sm"],[1,"text-emerald-400"],[1,"text-amber-400"],[1,"text-red-400"],[1,"flex","items-center","justify-between","mb-2"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"text-green-400"],[1,"mt-1","text-xs","text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-red-400"],[1,"flex","items-center","gap-2","text-xs","text-slate-400"],[1,"text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-slate-400"],[1,"animate-spin"]],template:function(t,n){t&1&&y(0,_8,79,67,"div",0),t&2&&S(n.isOpen()?0:-1)},dependencies:[oe,ae,xe,Rt,Br,ve,qi,Nt,tn,he,St],encapsulation:2})}};var F_=(i,e)=>e.value;function v8(i,e){if(i&1&&(r(0,"p",30),l(1),Ee(2,"number"),s(),r(3,"p",31),l(4,"\u6210\u54E1\u6578"),s()),i&2){let t=m(3);c(),D(je(2,1,t.group().memberCount))}}function x8(i,e){i&1&&(r(0,"p",32),l(1,"?"),s(),r(2,"p",33),l(3,"\u7121\u6578\u64DA"),s())}function C8(i,e){i&1&&(r(0,"span",41),l(1,"\u23F3"),s(),r(2,"span"),l(3,"\u7372\u53D6\u4E2D..."),s())}function b8(i,e){i&1&&(r(0,"span"),l(1,"\u{1F504}"),s(),r(2,"span"),l(3,"\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578"),s())}function y8(i,e){if(i&1){let t=I();r(0,"div",27)(1,"div",34)(2,"span",35),l(3,"\u26A0\uFE0F"),s(),r(4,"div",24)(5,"p",36),l(6,"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\u64DA"),s(),r(7,"p",37),l(8,"\u53EF\u80FD\u539F\u56E0\uFF1A"),s(),r(9,"ul",38)(10,"li"),l(11,"\u5C1A\u672A\u52A0\u5165\u8A72\u7FA4\u7D44"),s(),r(12,"li"),l(13,"\u7FA4\u7D44\u5DF2\u8B8A\u70BA\u79C1\u6709"),s(),r(14,"li"),l(15,"\u983B\u9053\u985E\u578B\u4E0D\u652F\u6301\u63D0\u53D6\u6210\u54E1"),s(),r(16,"li"),l(17,"\u5E33\u865F\u88AB\u8E22\u51FA\u7FA4\u7D44"),s()(),r(18,"div",39)(19,"button",40),x("click",function(){_(t);let o=m(3);return v(o.refreshMemberCount())}),y(20,C8,4,0)(21,b8,4,0),s()()()()()}if(i&2){let t=m(3);c(19),L("disabled",t.isRefreshingCount()),c(),S(t.isRefreshingCount()?20:21)}}function S8(i,e){i&1&&(r(0,"div",28)(1,"div",34)(2,"span",35),l(3,"\u{1F6AB}"),s(),r(4,"div",24)(5,"p",42),l(6,"\u983B\u9053\u4E0D\u652F\u6301\u6210\u54E1\u63D0\u53D6"),s(),r(7,"p",8),l(8," Telegram \u983B\u9053\uFF08Channel\uFF09\u6C92\u6709\u6210\u54E1\u5217\u8868\uFF0C\u53EA\u6709\u8A02\u95B1\u8005\u3002 \u5982\u9700\u7372\u53D6\u8A02\u95B1\u8005\u4FE1\u606F\uFF0C\u8ACB\u4F7F\u7528\u983B\u9053\u5206\u6790\u529F\u80FD\u3002 "),s()()()())}function w8(i,e){if(i&1){let t=I();r(0,"div",48)(1,"p",49),l(2,"\u{1F4CB} \u66FF\u4EE3\u65B9\u6848\uFF1A"),s(),r(3,"ul",50)(4,"li",51)(5,"span",52),l(6,"1."),s(),r(7,"span"),l(8,"\u78BA\u4FDD\u7FA4\u7D44\u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u767C\u8A00\u7528\u6236"),s()(),r(9,"li",51)(10,"span",52),l(11,"2."),s(),r(12,"span"),l(13,"\u5728\u300C\u5DF2\u6536\u96C6\u7528\u6236\u300D\u6A19\u7C64\u9801\u67E5\u770B\u76E3\u63A7\u671F\u9593\u6536\u96C6\u7684\u7528\u6236"),s()(),r(14,"li",51)(15,"span",52),l(16,"3."),s(),r(17,"span"),l(18,"\u6216\u806F\u7E6B\u7FA4\u4E3B\u7372\u53D6\u7BA1\u7406\u54E1\u6B0A\u9650"),s()()()(),r(19,"div",53)(20,"button",54),x("click",function(){_(t);let o=m(4);return v(o.checkMonitoringStatus())}),r(21,"span"),l(22,"\u{1F4E1}"),s(),r(23,"span"),l(24,"\u78BA\u8A8D\u76E3\u63A7\u72C0\u614B"),s()(),r(25,"button",55),x("click",function(){_(t);let o=m(4);return v(o.collectFromHistory())}),r(26,"span"),l(27,"\u{1F504}"),s(),r(28,"span"),l(29,"\u5F9E\u6B77\u53F2\u6536\u96C6"),s()(),r(30,"button",56),x("click",function(){_(t);let o=m(4);return v(o.viewCollectedUsers())}),r(31,"span"),l(32,"\u{1F465}"),s(),r(33,"span"),l(34),s()()()}if(i&2){let t=m(4);c(34),M("\u67E5\u770B\u5DF2\u6536\u96C6 (",t.collectedUsersCount(),")")}}function E8(i,e){if(i&1&&(r(0,"div",46)(1,"p",57)(2,"span"),l(3,"\u{1F4A1}"),s(),r(4,"span"),l(5),s()()()),i&2){let t=m(4);c(5),D(t.extractionError().suggestion)}}function D8(i,e){if(i&1){let t=I();r(0,"button",58),x("click",function(){_(t);let o=m(4);return v(o.joinGroup())}),r(1,"span"),l(2,"\u2795"),s(),r(3,"span"),l(4,"\u52A0\u5165\u7FA4\u7D44"),s()()}}function A8(i,e){if(i&1&&(r(0,"div",43)(1,"div",34)(2,"span",35),l(3),s(),r(4,"div",24)(5,"p",44),l(6),s(),r(7,"p",45),l(8),s(),y(9,w8,35,1)(10,E8,6,1,"div",46),y(11,D8,5,0,"button",47),s()()()),i&2){let t=m(3);N("bg-red-500/10",t.extractionError().code==="ADMIN_REQUIRED")("border-red-500/30",t.extractionError().code==="ADMIN_REQUIRED")("bg-amber-500/10",t.extractionError().code!=="ADMIN_REQUIRED")("border-amber-500/30",t.extractionError().code!=="ADMIN_REQUIRED"),c(3),D(t.extractionError().code==="ADMIN_REQUIRED"?"\u{1F512}":"\u26A0\uFE0F"),c(2),N("text-red-400",t.extractionError().code==="ADMIN_REQUIRED")("text-amber-400",t.extractionError().code!=="ADMIN_REQUIRED"),c(),M(" ",t.extractionError().title," "),c(2),D(t.extractionError().reason),c(),S(t.extractionError().code==="ADMIN_REQUIRED"?9:10),c(2),S(t.extractionError().canAutoJoin?11:-1)}}function M8(i,e){if(i&1&&(r(0,"div",22)(1,"div",5)(2,"div",23),l(3),s(),r(4,"div",24)(5,"h3",25),l(6),s(),r(7,"p",8),l(8),s()(),r(9,"div",26),y(10,v8,5,3)(11,x8,4,0),s()()(),y(12,y8,22,2,"div",27),y(13,S8,9,0,"div",28),y(14,A8,12,17,"div",29)),i&2){let t=m(2);c(3),M(" ",t.group().name[0]," "),c(3),D(t.group().name),c(2),D(t.group().url||"\u79C1\u5BC6\u7FA4\u7D44"),c(2),S(t.group().memberCount>0?10:11),c(2),S(t.group().memberCount===0?12:-1),c(),S(t.isChannel()?13:-1),c(),S(t.extractionError()?14:-1)}}function T8(i,e){i&1&&(r(0,"span",79),l(1,"\u{1F512}"),s())}function k8(i,e){if(i&1){let t=I();r(0,"button",78),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.setLimit(o.value))}),l(1),y(2,T8,2,0,"span",79),s()}if(i&2){let t=e.$implicit,n=m(3);N("border-emerald-500",n.config().limit===t.value)("bg-emerald-500/20",n.config().limit===t.value)("text-emerald-400",n.config().limit===t.value)("border-slate-700",n.config().limit!==t.value)("bg-slate-800/50",n.config().limit!==t.value)("text-slate-400",n.config().limit!==t.value),L("disabled",t.value>n.maxLimit()),c(),M(" ",t.label," "),c(),S(t.value>n.maxLimit()?2:-1)}}function I8(i,e){if(i&1){let t=I();r(0,"button",80),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.setOnlineStatus(o.value))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(3);N("border-cyan-500",n.config().filters.onlineStatus===t.value)("bg-cyan-500/20",n.config().filters.onlineStatus===t.value)("text-cyan-400",n.config().filters.onlineStatus===t.value)("border-slate-700",n.config().filters.onlineStatus!==t.value)("bg-slate-800/50",n.config().filters.onlineStatus!==t.value)("text-slate-400",n.config().filters.onlineStatus!==t.value),c(),X(" ",t.icon," ",t.label," ")}}function F8(i,e){if(i&1){let t=I();r(0,"div",77)(1,"div")(2,"label",81),l(3,"\u23F0 \u6D3B\u8E8D\u5EA6\u7BE9\u9078"),s(),r(4,"div",82)(5,"span",83),l(6,"\u6700\u8FD1"),s(),r(7,"select",84),x("change",function(o){_(t);let a=m(3);return v(a.setActivityDays(o))}),r(8,"option",85),l(9,"\u4E0D\u9650"),s(),r(10,"option",86),l(11,"3 \u5929"),s(),r(12,"option",87),l(13,"7 \u5929"),s(),r(14,"option",88),l(15,"14 \u5929"),s(),r(16,"option",89),l(17,"30 \u5929"),s()(),r(18,"span",83),l(19,"\u5167\u6D3B\u52D5"),s()()(),r(20,"div",68)(21,"label",90)(22,"input",70),x("change",function(){_(t);let o=m(3);return v(o.toggleAdvanced("autoSaveToResources"))}),s(),r(23,"div")(24,"p",71),l(25,"\u81EA\u52D5\u4FDD\u5B58"),s(),r(26,"p",31),l(27,"\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3"),s()()(),r(28,"label",90)(29,"input",70),x("change",function(){_(t);let o=m(3);return v(o.toggleAdvanced("skipDuplicates"))}),s(),r(30,"div")(31,"p",71),l(32,"\u8DF3\u904E\u91CD\u8907"),s(),r(33,"p",31),l(34,"\u5DF2\u5B58\u5728\u7684\u6210\u54E1"),s()()(),r(35,"label",90)(36,"input",70),x("change",function(){_(t);let o=m(3);return v(o.toggleFilter("excludeAdmins"))}),s(),r(37,"div")(38,"p",71),l(39,"\u6392\u9664\u7BA1\u7406\u54E1"),s(),r(40,"p",31),l(41,"\u7FA4\u4E3B\u548C\u7BA1\u7406\u54E1"),s()()(),r(42,"label",90)(43,"input",70),x("change",function(){_(t);let o=m(3);return v(o.toggleAdvanced("shuffleOrder"))}),s(),r(44,"div")(45,"p",71),l(46,"\u96A8\u6A5F\u9806\u5E8F"),s(),r(47,"p",31),l(48,"\u6253\u4E82\u63D0\u53D6\u9806\u5E8F"),s()()()()()}if(i&2){let t=m(3);c(7),L("value",t.config().filters.minActivityDays||""),c(15),L("checked",t.config().advanced.autoSaveToResources),c(7),L("checked",t.config().advanced.skipDuplicates),c(7),L("checked",t.config().filters.excludeAdmins),c(7),L("checked",t.config().advanced.shuffleOrder)}}function P8(i,e){if(i&1){let t=I();r(0,"div")(1,"label",59),l(2," \u26A1 \u5FEB\u901F\u6A21\u677F "),s(),r(3,"div",60)(4,"button",61),x("click",function(){_(t);let o=m(2);return v(o.selectTemplate("quick"))}),r(5,"div",62),l(6,"\u26A1"),s(),r(7,"p",63),l(8,"\u5FEB\u901F\u63D0\u53D6"),s(),r(9,"p",64),l(10,"100\u4EBA \xB7 \u50C5\u5728\u7DDA"),s()(),r(11,"button",61),x("click",function(){_(t);let o=m(2);return v(o.selectTemplate("deep"))}),r(12,"div",62),l(13,"\u{1F50D}"),s(),r(14,"p",63),l(15,"\u6DF1\u5EA6\u63D0\u53D6"),s(),r(16,"p",64),l(17,"500\u4EBA \xB7 \u5168\u72C0\u614B"),s()(),r(18,"button",61),x("click",function(){_(t);let o=m(2);return v(o.selectTemplate("precise"))}),r(19,"div",62),l(20,"\u{1F3AF}"),s(),r(21,"p",63),l(22,"\u7CBE\u6E96\u63D0\u53D6"),s(),r(23,"p",64),l(24,"\u81EA\u5B9A\u7FA9\u689D\u4EF6"),s()()()(),r(25,"div")(26,"label",59),l(27," \u{1F522} \u63D0\u53D6\u6578\u91CF "),s(),r(28,"div",53),O(29,k8,3,15,"button",65,F_),s()(),r(31,"div")(32,"label",59),l(33," \u{1F4CD} \u5728\u7DDA\u72C0\u614B "),s(),r(34,"div",66),O(35,I8,2,14,"button",67,F_),s()(),r(37,"div")(38,"label",59),l(39," \u{1F3F7}\uFE0F \u6210\u54E1\u5C6C\u6027 "),s(),r(40,"div",68)(41,"label",69)(42,"input",70),x("change",function(){_(t);let o=m(2);return v(o.toggleFilter("excludeBots"))}),s(),r(43,"div")(44,"p",71),l(45,"\u6392\u9664\u6A5F\u5668\u4EBA"),s(),r(46,"p",31),l(47,"\u904E\u6FFE Bot \u5E33\u865F"),s()()(),r(48,"label",69)(49,"input",70),x("change",function(){_(t);let o=m(2);return v(o.toggleFilter("hasUsername"))}),s(),r(50,"div")(51,"p",71),l(52,"\u9700\u6709\u7528\u6236\u540D"),s(),r(53,"p",31),l(54,"\u50C5\u63D0\u53D6\u6709 @username"),s()()(),r(55,"label",69)(56,"input",70),x("change",function(){_(t);let o=m(2);return v(o.toggleFilter("hasChinese"))}),s(),r(57,"div")(58,"p",71),l(59,"\u50C5\u83EF\u4EBA\u7528\u6236"),s(),r(60,"p",31),l(61,"\u4E2D\u6587\u540D\u7A31\u512A\u5148"),s()()(),r(62,"label",69)(63,"input",70),x("change",function(){_(t);let o=m(2);return v(o.toggleFilter("isPremium"))}),s(),r(64,"div")(65,"p",71),l(66,"Premium \u7528\u6236"),s(),r(67,"p",31),l(68,"\u50C5\u4ED8\u8CBB\u6703\u54E1 \u2B50"),s()()()()(),r(69,"div",72)(70,"button",73),x("click",function(){_(t);let o=m(2);return v(o.showAdvanced.set(!o.showAdvanced()))}),r(71,"span",74),l(72,"\u2699\uFE0F \u9AD8\u7D1A\u9078\u9805"),s(),ne(),r(73,"svg",75),B(74,"path",76),s()(),y(75,F8,49,5,"div",77),s()}if(i&2){let t=m(2);c(4),N("border-emerald-500",t.selectedTemplate()==="quick")("bg-emerald-500/20",t.selectedTemplate()==="quick")("border-slate-700",t.selectedTemplate()!=="quick")("bg-slate-800/50",t.selectedTemplate()!=="quick"),c(7),N("border-blue-500",t.selectedTemplate()==="deep")("bg-blue-500/20",t.selectedTemplate()==="deep")("border-slate-700",t.selectedTemplate()!=="deep")("bg-slate-800/50",t.selectedTemplate()!=="deep"),c(7),N("border-purple-500",t.selectedTemplate()==="precise")("bg-purple-500/20",t.selectedTemplate()==="precise")("border-slate-700",t.selectedTemplate()!=="precise")("bg-slate-800/50",t.selectedTemplate()!=="precise"),c(11),U(t.limitOptions),c(6),U(t.onlineStatusOptions),c(7),L("checked",t.config().filters.excludeBots),c(7),L("checked",t.config().filters.hasUsername===!0),c(7),L("checked",t.config().filters.hasChinese===!0),c(7),L("checked",t.config().filters.isPremium===!0),c(10),N("rotate-180",t.showAdvanced()),c(2),S(t.showAdvanced()?75:-1)}}function R8(i,e){if(i&1){let t=I();r(0,"div",1),x("click",function(o){_(t);let a=m();return v(a.onBackdropClick(o))}),r(1,"div",2),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),l(6," \u{1F465} "),s(),r(7,"div")(8,"h2",7),l(9,"\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1"),s(),r(10,"p",8),l(11,"\u914D\u7F6E\u63D0\u53D6\u9078\u9805\u548C\u7BE9\u9078\u689D\u4EF6"),s()()(),r(12,"button",9),x("click",function(){_(t);let o=m();return v(o.close())}),ne(),r(13,"svg",10),B(14,"path",11),s()()()(),ce(),r(15,"div",12),y(16,M8,15,7),y(17,P8,76,31),s(),r(18,"div",13)(19,"div",14)(20,"div",15)(21,"span",16),l(22," \u{1F4A1} \u9810\u8A08\u63D0\u53D6\uFF1A "),r(23,"span",17),l(24),s(),l(25," \u4EBA "),s()(),r(26,"div",16),l(27," \u{1F4CA} \u4ECA\u65E5\u914D\u984D\uFF1A "),r(28,"span",18),l(29),s(),l(30),s()(),r(31,"div",19)(32,"button",20),x("click",function(){_(t);let o=m();return v(o.close())}),l(33," \u53D6\u6D88 "),s(),r(34,"button",21),x("click",function(){_(t);let o=m();return v(o.startExtraction())}),r(35,"span"),l(36,"\u{1F465}"),s(),r(37,"span"),l(38),s()()()()()()}if(i&2){let t=m();c(16),S(t.group()?16:-1),c(),S(t.isChannel()?-1:17),c(7),D(t.estimatedCount()),c(5),D(t.remainingQuota()),c(),M(" / ",t.dailyQuota()," "),c(4),L("disabled",!t.canStart()),c(4),M("\u958B\u59CB\u63D0\u53D6 (",t.config().limit," \u4EBA)")}}var oc=class i{constructor(){this.isOpen=Le(!1);this.group=Le(null);this.closeDialog=ge();this.startExtractionEvent=ge();this.memberCountRefreshed=ge();this.enableMonitoringEvent=ge();this.joinGroupEvent=ge();this.viewCollectedUsersEvent=ge();this.ipcService=F(Q);this.toast=F(J);this.showAdvanced=f(!1);this.selectedTemplate=f("quick");this.isRefreshingCount=f(!1);this.extractionError=f(null);this.collectedUsersCount=f(0);this.isMonitoring=f(!1);this.config=f({limit:100,filters:{onlineStatus:"all",hasChinese:null,hasUsername:null,isPremium:null,excludeBots:!0,excludeAdmins:!1,minActivityDays:null},advanced:{shuffleOrder:!1,skipDuplicates:!0,autoSaveToResources:!0,extractAvatar:!1}});this.limitOptions=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:-1,label:"\u5168\u90E8"}];this.onlineStatusOptions=[{value:"all",label:"\u5168\u90E8",icon:"\u{1F4CA}"},{value:"online",label:"\u5728\u7DDA",icon:"\u{1F7E2}"},{value:"recently",label:"\u6700\u8FD1",icon:"\u{1F7E1}"},{value:"offline",label:"\u96E2\u7DDA",icon:"\u26AB"}];this.maxLimit=R(()=>{let e=this.group()?.memberCount||0;return Math.min(e,1e4)});this.dailyQuota=f(1e3);this.remainingQuota=f(800);this.estimatedCount=R(()=>{let e=this.config().limit,t=this.group()?.memberCount||0;return e===-1?Math.min(t,this.remainingQuota()):Math.min(e,t,this.remainingQuota())});this.isChannel=R(()=>this.group()?.resourceType==="channel");this.canStart=R(()=>!this.group()||this.isChannel()?!1:this.estimatedCount()>0);this.listeners=[]}ngOnInit(){this.loadQuota(),this.listenForExtractionErrors(),this.loadCollectedUsersCount()}ngOnDestroy(){this.listeners.forEach(e=>e())}loadQuota(){let e=this.ipcService.on("extraction-quota",t=>{t&&(this.dailyQuota.set(t.daily||1e3),this.remainingQuota.set(t.remaining||800))});this.listeners.push(e),this.ipcService.send("get-extraction-quota",{})}listenForExtractionErrors(){let e=this.ipcService.on("members-extracted",t=>{let n=this.group();if(!(!n||String(t.resourceId)!==String(n.id)))if(!t.success&&t.error_code){let o=t.error_details||{},d={ADMIN_REQUIRED:{title:"\u9700\u8981\u7BA1\u7406\u54E1\u6B0A\u9650",defaultReason:"\u6B64\u7FA4\u7D44\u8A2D\u7F6E\u4E86\u6210\u54E1\u5217\u8868\u53EA\u5C0D\u7BA1\u7406\u54E1\u53EF\u898B"},PEER_ID_INVALID:{title:"\u5E33\u865F\u5C1A\u672A\u9023\u63A5\u6B64\u7FA4\u7D44",defaultReason:"Telegram \u8981\u6C42\u5E33\u865F\u5FC5\u9808\u5148\u52A0\u5165\u7FA4\u7D44"},NOT_PARTICIPANT:{title:"\u5E33\u865F\u4E0D\u662F\u7FA4\u7D44\u6210\u54E1",defaultReason:"\u7576\u524D\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44"},CHANNEL_PRIVATE:{title:"\u79C1\u6709\u7FA4\u7D44",defaultReason:"\u9019\u662F\u4E00\u500B\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u5148\u52A0\u5165"},CHANNEL_INVALID:{title:"\u7121\u6548\u7684\u7FA4\u7D44",defaultReason:"\u7FA4\u7D44\u53EF\u80FD\u5DF2\u88AB\u522A\u9664\u6216 ID \u7121\u6548"},USERNAME_NOT_OCCUPIED:{title:"\u7121\u6CD5\u89E3\u6790\u7FA4\u7D44",defaultReason:"\u9019\u53EF\u80FD\u662F\u79C1\u6709\u7FA4\u7D44\uFF0C\u6C92\u6709\u516C\u958B\u7684 username"}}[t.error_code]||{title:"\u63D0\u53D6\u5931\u6557",defaultReason:t.error||"\u672A\u77E5\u932F\u8AA4"};this.extractionError.set({code:t.error_code,title:d.title,reason:o.reason||d.defaultReason,suggestion:o.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66\u6216\u5617\u8A66\u5176\u4ED6\u65B9\u5F0F",alternative:o.alternative==="monitor_messages"?"monitor":void 0,canAutoJoin:o.can_auto_join})}else t.success&&this.extractionError.set(null)});this.listeners.push(e)}enableMonitoring(){let e=this.group();e&&(this.enableMonitoringEvent.emit(e),this.toast.info("\u{1F4E1} \u6B63\u5728\u958B\u555F\u6D88\u606F\u76E3\u63A7\uFF0C\u5C07\u81EA\u52D5\u6536\u96C6\u767C\u8A00\u7528\u6236"),this.close())}joinGroup(){let e=this.group();e&&(this.joinGroupEvent.emit(e),this.toast.info("\u2795 \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44..."))}selectTemplate(e){switch(this.selectedTemplate.set(e),e){case"quick":this.config.update(t=>P(E({},t),{limit:100,filters:P(E({},t.filters),{onlineStatus:"online",excludeBots:!0})}));break;case"deep":this.config.update(t=>P(E({},t),{limit:500,filters:P(E({},t.filters),{onlineStatus:"all",excludeBots:!0})}));break;case"precise":break}}setLimit(e){this.selectedTemplate.set("precise"),this.config.update(t=>P(E({},t),{limit:e}))}setOnlineStatus(e){this.selectedTemplate.set("precise"),this.config.update(t=>P(E({},t),{filters:P(E({},t.filters),{onlineStatus:e})}))}toggleFilter(e){this.selectedTemplate.set("precise"),this.config.update(t=>{let n=E({},t.filters);return e==="excludeBots"||e==="excludeAdmins"?n[e]=!n[e]:n[e]===null||n[e]===void 0?n[e]=!0:n[e]===!0?n[e]=!1:n[e]=null,P(E({},t),{filters:n})})}toggleAdvanced(e){this.config.update(t=>P(E({},t),{advanced:P(E({},t.advanced),{[e]:!t.advanced[e]})}))}setActivityDays(e){let t=e.target.value,n=t?parseInt(t,10):null;this.selectedTemplate.set("precise"),this.config.update(o=>P(E({},o),{filters:P(E({},o.filters),{minActivityDays:n})}))}refreshMemberCount(){let e=this.group();if(!e)return;this.isRefreshingCount.set(!0);let t=this.ipcService.on("group-member-count-result",n=>{this.isRefreshingCount.set(!1),t(),n.success&&n.memberCount>0?(this.toast.success(`\u2705 \u6210\u529F\u7372\u53D6\u6210\u54E1\u6578\uFF1A${n.memberCount} \u4EBA`),this.memberCountRefreshed.emit({groupId:e.id,memberCount:n.memberCount})):this.toast.error(n.error||"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\uFF0C\u8ACB\u78BA\u8A8D\u5DF2\u52A0\u5165\u8A72\u7FA4\u7D44")});this.listeners.push(t),this.ipcService.send("get-group-member-count",{groupId:e.id,url:e.url,telegramId:e.telegramId||e.id,accountPhone:e.accountPhone}),setTimeout(()=>{this.isRefreshingCount()&&(this.isRefreshingCount.set(!1),this.toast.error("\u7372\u53D6\u6210\u54E1\u6578\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"))},15e3)}startExtraction(){let e=this.group();if(!e){this.toast.error("\u7FA4\u7D44\u4FE1\u606F\u4E0D\u5B58\u5728");return}if(this.estimatedCount()===0){this.toast.warning("\u6210\u54E1\u6578\u64DA\u4E0D\u53EF\u7528\uFF0C\u8ACB\u5148\u9EDE\u64CA\u300C\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578\u300D");return}this.startExtractionEvent.emit({group:e,config:this.config()}),this.close()}close(){this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&this.close()}checkMonitoringStatus(){let e=this.group();if(!e)return;this.ipcService.send("get-group-monitoring-status",{groupId:e.id,telegramId:e.telegramId});let t=this.ipcService.on("group-monitoring-status",n=>{String(n.groupId)===String(e.id)&&(this.isMonitoring.set(n.isMonitoring),this.collectedUsersCount.set(n.collectedUsers||0),n.isMonitoring?this.toast.success(`\u2705 \u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u5DF2\u6536\u96C6 ${n.collectedUsers} \u4F4D\u7528\u6236`):this.toast.warning("\u26A0\uFE0F \u76E3\u63A7\u672A\u958B\u555F\uFF0C\u8ACB\u5728\u7FA4\u7D44\u8A73\u60C5\u4E2D\u958B\u555F\u76E3\u63A7"),t())});this.listeners.push(t),this.toast.info("\u{1F50D} \u6B63\u5728\u6AA2\u67E5\u76E3\u63A7\u72C0\u614B...")}viewCollectedUsers(){let e=this.group();e&&(this.viewCollectedUsersEvent.emit(e),this.close())}collectFromHistory(){let e=this.group();if(!e)return;this.toast.info("\u{1F504} \u6B63\u5728\u5F9E\u6B77\u53F2\u6D88\u606F\u4E2D\u6536\u96C6\u7528\u6236..."),this.ipcService.send("collect-users-from-history",{groupId:e.id,telegramId:e.telegramId,limit:500});let t=this.ipcService.on("collect-from-history-result",n=>{String(n.groupId)===String(e.id)&&(t(),n.success?(this.toast.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${n.collected} \u4F4D\u7528\u6236\uFF0C\u65B0\u589E ${n.newUsers||0} \u4F4D`),this.collectedUsersCount.update(o=>o+(n.newUsers||0))):this.toast.error(n.error||"\u6536\u96C6\u5931\u6557"))});this.listeners.push(t)}loadCollectedUsersCount(){let e=this.group();if(!e)return;this.ipcService.send("get-collected-users-count",{groupId:e.id,sourceType:"monitoring"});let t=this.ipcService.on("collected-users-count",n=>{String(n.groupId)===String(e.id)&&(this.collectedUsersCount.set(n.count||0),t())});this.listeners.push(t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-member-extraction-dialog"]],inputs:{isOpen:[1,"isOpen"],group:[1,"group"]},outputs:{closeDialog:"closeDialog",startExtractionEvent:"startExtractionEvent",memberCountRefreshed:"memberCountRefreshed",enableMonitoringEvent:"enableMonitoringEvent",joinGroupEvent:"joinGroupEvent",viewCollectedUsersEvent:"viewCollectedUsersEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col",3,"click"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","space-y-5"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"flex","items-center","justify-between","mb-4","text-sm"],[1,"flex","items-center","gap-4"],[1,"text-slate-400"],[1,"text-emerald-400","font-medium"],[1,"text-cyan-400","font-medium"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-colors","font-medium",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-emerald-500/20","to-cyan-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1"],[1,"font-medium","text-white"],[1,"text-right"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-4","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"border",3,"bg-red-500/10","border-red-500/30","bg-amber-500/10","border-amber-500/30"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-lg","font-bold","text-amber-400"],[1,"text-xs","text-amber-400"],[1,"flex","items-start","gap-3"],[1,"text-xl"],[1,"font-medium","text-amber-400","mb-1"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-slate-400","space-y-1","list-disc","list-inside","mb-3"],[1,"flex","gap-2"],[1,"px-3","py-1.5","bg-amber-500/20","hover:bg-amber-500/30","text-amber-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-1",3,"click","disabled"],[1,"animate-spin"],[1,"font-medium","text-red-400","mb-1"],[1,"border"],[1,"font-medium","mb-1"],[1,"text-sm","text-slate-400","mb-2"],[1,"p-3","bg-slate-800/50","rounded-lg"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2"],[1,"p-3","bg-slate-800/50","rounded-lg","mb-3"],[1,"text-sm","text-slate-300","mb-2"],[1,"text-sm","text-slate-400","space-y-1.5"],[1,"flex","items-start","gap-2"],[1,"text-emerald-400"],[1,"flex","flex-wrap","gap-2"],[1,"px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-orange-500/20","hover:bg-orange-500/30","text-orange-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-sm","text-cyan-400","flex","items-center","gap-2"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"grid","grid-cols-3","gap-3"],[1,"p-4","rounded-xl","border","transition-all","text-center","group",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","mt-1"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-emerald-500","bg-emerald-500/20","text-emerald-400","border-slate-700","bg-slate-800/50","text-slate-400","disabled"],[1,"grid","grid-cols-4","gap-2"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"border-cyan-500","bg-cyan-500/20","text-cyan-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","gap-3","p-3","bg-slate-800/50","rounded-xl","border","border-slate-700/50","cursor-pointer","hover:bg-slate-800","transition-colors"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600","text-emerald-500","focus:ring-emerald-500",3,"change","checked"],[1,"text-sm","text-white"],[1,"border","border-slate-700/50","rounded-xl","overflow-hidden"],[1,"w-full","p-4","bg-slate-800/30","flex","items-center","justify-between","hover:bg-slate-800/50","transition-colors",3,"click"],[1,"text-sm","font-medium","text-slate-300"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-400","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-4","space-y-4","border-t","border-slate-700/50"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"click","disabled"],[1,"ml-1","text-xs","text-orange-400"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"click"],[1,"block","text-sm","text-slate-400","mb-2"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-slate-300"],[1,"px-3","py-1.5","bg-slate-700","border","border-slate-600","rounded-lg","text-sm","text-white","focus:ring-emerald-500","focus:border-emerald-500",3,"change","value"],["value",""],["value","3"],["value","7"],["value","14"],["value","30"],[1,"flex","items-center","gap-3","cursor-pointer","p-2","bg-slate-700/30","rounded-lg","hover:bg-slate-700/50"]],template:function(t,n){t&1&&y(0,R8,39,7,"div",0),t&2&&S(n.isOpen()?0:-1)},dependencies:[oe,ae,Re,Ne,St],encapsulation:2})}};var N8=(i,e)=>e.title,V8=(i,e)=>e.id;function B8(i,e){i&1&&(r(0,"div",11)(1,"div",16),l(2,"\u{1F50D}"),s(),r(3,"p",17),l(4,"\u672A\u627E\u5230\u5339\u914D\u7684\u7D50\u679C"),s(),r(5,"p",18),l(6,"\u5617\u8A66\u5176\u4ED6\u95DC\u9375\u8A5E"),s()())}function L8(i,e){if(i&1&&(r(0,"div",26),l(1),s()),i&2){let t=m().$implicit;c(),D(t.subtitle)}}function O8(i,e){if(i&1&&(r(0,"kbd",9),l(1),s()),i&2){let t=m().$implicit;c(),M(" ",t.shortcut," ")}}function U8(i,e){if(i&1){let t=I();r(0,"div",22),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.executeCommand(o))})("mouseenter",function(){let o=_(t).$index,a=m().$implicit,d=m(3);return v(d.selectedIndex.set(d.getGlobalIndex(a,o)))}),r(1,"div",23),l(2),s(),r(3,"div",24)(4,"div",25),l(5),s(),y(6,L8,2,1,"div",26),s(),r(7,"span",27),l(8),s(),y(9,O8,2,1,"kbd",9),s()}if(i&2){let t=e.$implicit,n=e.$index,o=m().$implicit,a=m(3);N("bg-cyan-500/20",a.isSelected(o,n))("hover:bg-slate-800",!a.isSelected(o,n)),c(),N("bg-cyan-500/20",a.isSelected(o,n))("bg-slate-800",!a.isSelected(o,n)),c(),M(" ",t.icon," "),c(3),D(t.title),c(),S(t.subtitle?6:-1),c(),N("bg-blue-500/20",t.type==="page")("text-blue-400",t.type==="page")("bg-green-500/20",t.type==="action")("text-green-400",t.type==="action")("bg-purple-500/20",t.type==="contact")("text-purple-400",t.type==="contact")("bg-amber-500/20",t.type==="recent")("text-amber-400",t.type==="recent"),c(),M(" ",a.getTypeLabel(t.type)," "),c(),S(t.shortcut?9:-1)}}function G8(i,e){if(i&1&&(r(0,"div",19)(1,"div",20),l(2),s(),O(3,U8,10,29,"div",21,V8),s()),i&2){let t=e.$implicit;c(2),M(" ",t.title," "),c(),U(t.items)}}function $8(i,e){if(i&1&&O(0,G8,5,1,"div",19,N8),i&2){let t=m(2);U(t.filteredGroups())}}function H8(i,e){if(i&1){let t=I();r(0,"div",2),x("click",function(){_(t);let o=m();return v(o.close())}),B(1,"div",3),r(2,"div",4),x("click",function(o){return _(t),v(o.stopPropagation())}),r(3,"div",5),ne(),r(4,"svg",6),B(5,"path",7),s(),ce(),r(6,"input",8,0),W("ngModelChange",function(o){_(t);let a=m();return q(a.query,o)||(a.query=o),v(o)}),x("ngModelChange",function(o){_(t);let a=m();return v(a.onQueryChange(o))})("keydown",function(o){_(t);let a=m();return v(a.onKeyDown(o))}),s(),r(8,"kbd",9),l(9,"ESC"),s()(),r(10,"div",10),y(11,B8,7,0,"div",11)(12,$8,2,0),s(),r(13,"div",12)(14,"div",13)(15,"span",14)(16,"kbd",15),l(17,"\u2191"),s(),r(18,"kbd",15),l(19,"\u2193"),s(),l(20," \u5C0E\u822A "),s(),r(21,"span",14)(22,"kbd",15),l(23,"\u21B5"),s(),l(24," \u9078\u64C7 "),s(),r(25,"span",14)(26,"kbd",15),l(27,"ESC"),s(),l(28," \u95DC\u9589 "),s()(),r(29,"span"),l(30,"TG-Matrix \u547D\u4EE4\u9762\u677F"),s()()()()}if(i&2){let t=m();N("animate-fade-in",t.animateIn()),c(2),N("animate-slide-down",t.animateIn()),c(4),H("ngModel",t.query),c(5),S(t.filteredGroups().length===0?11:12)}}var rc=class i{constructor(){this.navigate=ge();this.isOpen=f(!1);this.animateIn=f(!0);this.query="";this.selectedIndex=f(0);this.recentPages=f([]);this.commands=f([]);this.filteredGroups=R(()=>{let e=this.query.toLowerCase().trim(),t=this.commands();if(!e)return this.getDefaultGroups(t);let n=t.filter(o=>o.title.toLowerCase().includes(e)||o.subtitle?.toLowerCase().includes(e)||o.keywords.some(a=>a.toLowerCase().includes(e)));return this.groupByType(n)})}ngOnInit(){this.initCommands(),this.loadRecentPages()}ngOnDestroy(){}initCommands(){let e=[{id:"nav-dashboard",type:"page",icon:"\u{1F4CA}",title:"\u5100\u8868\u677F",subtitle:"\u67E5\u770B\u7CFB\u7D71\u6982\u89BD",keywords:["dashboard","\u9996\u9801","\u6982\u89BD"],action:()=>this.navigateTo("dashboard")},{id:"nav-accounts",type:"page",icon:"\u{1F464}",title:"\u5E33\u865F\u7BA1\u7406",subtitle:"\u7BA1\u7406 Telegram \u5E33\u865F",keywords:["accounts","\u5E33\u6236","\u767B\u9304"],action:()=>this.navigateTo("accounts")},{id:"nav-resource",type:"page",icon:"\u{1F4C7}",title:"\u8CC7\u6E90\u4E2D\u5FC3",subtitle:"\u7BA1\u7406\u806F\u7E6B\u4EBA\u548C\u7FA4\u7D44",keywords:["resource","\u806F\u7E6B\u4EBA","\u7FA4\u7D44","contacts"],action:()=>this.navigateTo("resource-center")},{id:"nav-ai-assistant",type:"page",icon:"\u{1F3AF}",title:"\u7B56\u7565\u898F\u5283",subtitle:"AI \u71DF\u92B7\u52A9\u624B",keywords:["ai","\u71DF\u92B7","\u7B56\u7565","marketing"],action:()=>this.navigateTo("ai-assistant")},{id:"nav-ai-team",type:"page",icon:"\u{1F916}",title:"\u81EA\u52D5\u57F7\u884C",subtitle:"AI \u5718\u968A\u92B7\u552E",keywords:["ai","\u5718\u968A","\u81EA\u52D5","team"],action:()=>this.navigateTo("ai-team")},{id:"nav-analytics",type:"page",icon:"\u{1F4C8}",title:"\u6578\u64DA\u6D1E\u5BDF",subtitle:"\u667A\u80FD\u5206\u6790\u5831\u544A",keywords:["analytics","\u5206\u6790","\u5831\u544A","\u7D71\u8A08"],action:()=>this.navigateTo("analytics")},{id:"nav-automation",type:"page",icon:"\u26A1",title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",subtitle:"\u76E3\u63A7\u548C\u81EA\u52D5\u56DE\u8986",keywords:["automation","\u81EA\u52D5\u5316","\u76E3\u63A7"],action:()=>this.navigateTo("automation")},{id:"nav-leads",type:"page",icon:"\u{1F3AF}",title:"\u6F5B\u5728\u5BA2\u6236",subtitle:"\u5BA2\u6236\u7BA1\u7406",keywords:["leads","\u5BA2\u6236","crm"],action:()=>this.navigateTo("leads")},{id:"nav-settings",type:"page",icon:"\u2699\uFE0F",title:"\u7CFB\u7D71\u8A2D\u7F6E",subtitle:"\u914D\u7F6E\u7CFB\u7D71\u9078\u9805",keywords:["settings","\u8A2D\u7F6E","\u914D\u7F6E"],action:()=>this.navigateTo("settings")},{id:"action-add-account",type:"action",icon:"\u2795",title:"\u6DFB\u52A0\u5E33\u865F",subtitle:"\u6DFB\u52A0\u65B0\u7684 Telegram \u5E33\u865F",keywords:["add","account","\u65B0\u589E"],shortcut:"\u2318N",action:()=>this.navigateTo("add-account")},{id:"action-send-message",type:"action",icon:"\u2709\uFE0F",title:"\u767C\u9001\u6D88\u606F",subtitle:"\u5411\u806F\u7E6B\u4EBA\u767C\u9001\u6D88\u606F",keywords:["send","message","\u767C\u9001"],action:()=>this.emitAction("send-message")},{id:"action-extract",type:"action",icon:"\u{1F4E5}",title:"\u63D0\u53D6\u6210\u54E1",subtitle:"\u5F9E\u7FA4\u7D44\u63D0\u53D6\u6210\u54E1",keywords:["extract","member","\u63D0\u53D6"],action:()=>this.emitAction("extract-members")},{id:"action-search-group",type:"action",icon:"\u{1F50D}",title:"\u641C\u7D22\u7FA4\u7D44",subtitle:"\u641C\u7D22 Telegram \u7FA4\u7D44",keywords:["search","group","\u641C\u7D22"],action:()=>this.emitAction("search-groups")},{id:"action-start-monitor",type:"action",icon:"\u{1F4E1}",title:"\u555F\u52D5\u76E3\u63A7",subtitle:"\u958B\u59CB\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F",keywords:["monitor","start","\u76E3\u63A7"],action:()=>this.emitAction("start-monitor")},{id:"action-refresh",type:"action",icon:"\u{1F504}",title:"\u5237\u65B0\u6578\u64DA",subtitle:"\u91CD\u65B0\u52A0\u8F09\u6578\u64DA",keywords:["refresh","reload","\u5237\u65B0"],shortcut:"\u2318R",action:()=>this.emitAction("refresh")},{id:"help-docs",type:"help",icon:"\u{1F4D6}",title:"\u5E6B\u52A9\u6587\u6A94",subtitle:"\u67E5\u770B\u4F7F\u7528\u6307\u5357",keywords:["help","docs","\u5E6B\u52A9","\u6587\u6A94"],action:()=>this.emitAction("open-docs")},{id:"help-shortcuts",type:"help",icon:"\u2328\uFE0F",title:"\u5FEB\u6377\u9375",subtitle:"\u67E5\u770B\u6240\u6709\u5FEB\u6377\u9375",keywords:["shortcuts","keyboard","\u5FEB\u6377\u9375"],action:()=>this.emitAction("show-shortcuts")},{id:"help-feedback",type:"help",icon:"\u{1F4AC}",title:"\u610F\u898B\u53CD\u994B",subtitle:"\u63D0\u4EA4\u554F\u984C\u6216\u5EFA\u8B70",keywords:["feedback","\u53CD\u994B","\u5EFA\u8B70"],action:()=>this.emitAction("open-feedback")}];this.commands.set(e)}getDefaultGroups(e){let t=this.recentPages(),n=[];if(t.length>0){let d=e.filter(u=>t.includes(u.id)).sort((u,p)=>t.indexOf(u.id)-t.indexOf(p.id)).slice(0,5).map(u=>P(E({},u),{type:"recent"}));d.length>0&&n.push({title:"\u6700\u8FD1\u8A2A\u554F",items:d})}let o=e.filter(d=>d.type==="page").slice(0,6);n.push({title:"\u9801\u9762",items:o});let a=e.filter(d=>d.type==="action").slice(0,4);return n.push({title:"\u5FEB\u901F\u64CD\u4F5C",items:a}),n}groupByType(e){let t=[],n=e.filter(u=>u.type==="page"),o=e.filter(u=>u.type==="action"),a=e.filter(u=>u.type==="contact"),d=e.filter(u=>u.type==="help");return n.length>0&&t.push({title:"\u9801\u9762",items:n}),o.length>0&&t.push({title:"\u64CD\u4F5C",items:o}),a.length>0&&t.push({title:"\u806F\u7E6B\u4EBA",items:a}),d.length>0&&t.push({title:"\u5E6B\u52A9",items:d}),t}onGlobalKeyDown(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),this.toggle()),e.key==="Escape"&&this.isOpen()&&(e.preventDefault(),this.close())}onKeyDown(e){let n=this.filteredGroups().reduce((o,a)=>o+a.items.length,0);switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex.update(a=>(a+1)%n);break;case"ArrowUp":e.preventDefault(),this.selectedIndex.update(a=>(a-1+n)%n);break;case"Enter":e.preventDefault();let o=this.getSelectedItem();o&&this.executeCommand(o);break}}onQueryChange(e){this.selectedIndex.set(0)}getSelectedItem(){let e=this.filteredGroups(),t=0;for(let n of e)for(let o of n.items){if(t===this.selectedIndex())return o;t++}return null}getGlobalIndex(e,t){let n=this.filteredGroups(),o=0;for(let a of n){if(a===e)return o+t;o+=a.items.length}return 0}isSelected(e,t){return this.getGlobalIndex(e,t)===this.selectedIndex()}getTypeLabel(e){return{page:"\u9801\u9762",action:"\u64CD\u4F5C",contact:"\u806F\u7E6B\u4EBA",recent:"\u6700\u8FD1",help:"\u5E6B\u52A9"}[e]}toggle(){this.isOpen()?this.close():this.open()}open(){this.query="",this.selectedIndex.set(0),this.animateIn.set(!0),this.isOpen.set(!0)}close(){this.animateIn.set(!1),setTimeout(()=>{this.isOpen.set(!1)},150)}executeCommand(e){e.type==="page"&&this.addToRecent(e.id),e.action(),this.close()}navigateTo(e){this.navigate.emit(e)}emitAction(e){this.navigate.emit(`action:${e}`)}addToRecent(e){this.recentPages.update(t=>{let n=t.filter(o=>o!==e);return[e,...n].slice(0,10)}),this.saveRecentPages()}loadRecentPages(){try{let e=localStorage.getItem("tg-matrix-recent-pages");e&&this.recentPages.set(JSON.parse(e))}catch{}}saveRecentPages(){try{localStorage.setItem("tg-matrix-recent-pages",JSON.stringify(this.recentPages()))}catch{}}addCommand(e){this.commands.update(t=>[...t,e])}addContactCommands(e){let t=e.map(n=>({id:`contact-${n.id}`,type:"contact",icon:"\u{1F464}",title:n.name,subtitle:n.username?`@${n.username}`:void 0,keywords:[n.name,n.username||""].filter(Boolean),action:()=>this.navigate.emit(`contact:${n.id}`)}));this.commands.update(n=>[...n.filter(o=>o.type!=="contact"),...t])}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-command-palette"]],hostBindings:function(t,n){t&1&&x("keydown",function(a){return n.onGlobalKeyDown(a)},lo)},outputs:{navigate:"navigate"},decls:1,vars:1,consts:[["searchInput",""],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"animate-fade-in"],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"click"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm"],[1,"command-palette","relative","w-full","max-w-2xl","mx-4","bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden",3,"click"],[1,"flex","items-center","gap-3","p-4","border-b","border-slate-700/50"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text","placeholder","\u641C\u7D22\u9801\u9762\u3001\u529F\u80FD\u3001\u806F\u7E6B\u4EBA...","autofocus","",1,"flex-1","bg-transparent","text-white","placeholder-slate-500","outline-none","text-lg",3,"ngModelChange","keydown","ngModel"],[1,"px-2","py-1","text-xs","text-slate-400","bg-slate-800","rounded","border","border-slate-700"],[1,"max-h-[60vh]","overflow-y-auto"],[1,"p-8","text-center"],[1,"flex","items-center","justify-between","px-4","py-3","border-t","border-slate-700/50","text-xs","text-slate-500"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-1"],[1,"px-1.5","py-0.5","bg-slate-800","rounded"],[1,"text-4xl","mb-3"],[1,"text-slate-400"],[1,"text-sm","text-slate-500","mt-1"],[1,"py-2"],[1,"px-4","py-2","text-xs","font-semibold","text-slate-500","uppercase","tracking-wider"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"bg-cyan-500/20","hover:bg-slate-800"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"click","mouseenter"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","text-xl"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"px-2","py-0.5","text-xs","rounded-full"]],template:function(t,n){t&1&&y(0,H8,31,6,"div",1),t&2&&S(n.isOpen()?0:-1)},dependencies:[oe,ae,xe,ve,he],styles:[".animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}.animate-slide-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-down .2s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_slide-down{0%{opacity:0;transform:translateY(-20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b}"]})}};var jt=[{id:"dashboard",label:"\u5100\u8868\u677F",icon:"\u{1F4CA}",description:"\u7CFB\u7D71\u7E3D\u89BD\u548C\u5FEB\u901F\u64CD\u4F5C",color:"from-cyan-500 to-blue-500",defaultView:"dashboard",views:[{id:"dashboard",label:"\u7E3D\u89BD",icon:"\u{1F4CA}",shortcut:"D"}]},{id:"accounts",label:"\u5E33\u865F\u7BA1\u7406",icon:"\u{1F464}",description:"\u7BA1\u7406 Telegram \u5E33\u865F\u548C API \u8A2D\u7F6E",color:"from-purple-500 to-pink-500",defaultView:"accounts",views:[{id:"accounts",label:"\u5E33\u865F\u5217\u8868",icon:"\u{1F464}",description:"\u67E5\u770B\u548C\u7BA1\u7406\u6240\u6709\u5E33\u865F",shortcut:"A"},{id:"add-account",label:"\u6DFB\u52A0\u5E33\u865F",icon:"\u2795",description:"\u6DFB\u52A0\u65B0\u7684 Telegram \u5E33\u865F"},{id:"api-credentials",label:"API \u6191\u8B49",icon:"\u{1F511}",description:"\u7BA1\u7406 API ID \u548C Hash"}]},{id:"marketing-hub",label:"\u71DF\u92B7\u4EFB\u52D9\u4E2D\u5FC3",icon:"\u{1F680}",description:"\u4E00\u9375\u555F\u52D5\u71DF\u92B7\u4EFB\u52D9\uFF0CAI \u81EA\u52D5\u57F7\u884C",color:"from-purple-500 to-pink-500",defaultView:"marketing-hub",views:[{id:"marketing-hub",label:"\u5FEB\u901F\u555F\u52D5",icon:"\u{1F680}",description:"\u9078\u64C7\u76EE\u6A19\uFF0C\u4E00\u9375\u555F\u52D5",shortcut:"M"},{id:"marketing-tasks",label:"\u4EFB\u52D9\u5217\u8868",icon:"\u{1F4CB}",description:"\u7BA1\u7406\u6240\u6709\u71DF\u92B7\u4EFB\u52D9"},{id:"marketing-monitor",label:"\u6548\u679C\u76E3\u63A7",icon:"\u{1F4C8}",description:"\u5BE6\u6642\u67E5\u770B\u8F49\u5316\u6548\u679C"}]},{id:"role-library",label:"\u89D2\u8272\u8CC7\u6E90\u5EAB",icon:"\u{1F3AD}",description:"\u7BA1\u7406\u89D2\u8272\u5B9A\u7FA9\u548C\u5287\u672C\u6A21\u677F",color:"from-amber-500 to-orange-500",defaultView:"role-store",views:[{id:"role-store",label:"\u89D2\u8272\u5EAB",icon:"\u{1F3AD}",description:"50+ \u9810\u8A2D\u89D2\u8272"},{id:"my-roles",label:"\u6211\u7684\u89D2\u8272",icon:"\u{1F464}",description:"\u81EA\u5B9A\u7FA9\u89D2\u8272"},{id:"scene-templates",label:"\u5834\u666F\u6A21\u677F",icon:"\u{1F3AC}",description:"\u9810\u8A2D\u5834\u666F\u914D\u7F6E"},{id:"script-editor",label:"\u5287\u672C\u7DE8\u6392",icon:"\u{1F4DD}",description:"\u7DE8\u8F2F\u5C0D\u8A71\u5287\u672C"}]},{id:"knowledge-hub",label:"\u77E5\u8B58\u5927\u8166",icon:"\u{1F9E0}",description:"\u77E5\u8B58\u5EAB\u7BA1\u7406\u548C AI \u5B78\u7FD2",color:"from-pink-500 to-rose-500",defaultView:"ai-brain",views:[{id:"ai-brain",label:"\u77E5\u8B58\u7E3D\u89BD",icon:"\u{1F9E0}",description:"\u77E5\u8B58\u5EAB\u7D71\u8A08\u548C\u5065\u5EB7\u5EA6",shortcut:"K"},{id:"knowledge-manage",label:"\u77E5\u8B58\u7BA1\u7406",icon:"\u{1F4DD}",description:"\u67E5\u770B\u548C\u7DE8\u8F2F\u77E5\u8B58"},{id:"knowledge-import",label:"\u5C0E\u5165\u77E5\u8B58",icon:"\u{1F4E5}",description:"\u5C0D\u8A71/\u6587\u6A94/\u7DB2\u9801\u5C0E\u5165"},{id:"knowledge-gaps",label:"\u77E5\u8B58\u7F3A\u53E3",icon:"\u2753",description:"\u5F85\u88DC\u5145\u7684\u554F\u984C"},{id:"knowledge-settings",label:"\u77E5\u8B58\u8A2D\u7F6E",icon:"\u2699\uFE0F",description:"RAG \u914D\u7F6E"}]},{id:"ai-engine",label:"\u667A\u80FD\u5F15\u64CE",icon:"\u{1F916}",description:"AI \u6A21\u578B\u548C\u4EBA\u683C\u914D\u7F6E",color:"from-indigo-500 to-violet-500",defaultView:"ai-models",views:[{id:"ai-models",label:"\u6A21\u578B\u914D\u7F6E",icon:"\u{1F916}",description:"\u9078\u64C7\u548C\u914D\u7F6E AI \u6A21\u578B",shortcut:"I"},{id:"ai-persona",label:"\u4EBA\u683C\u8A2D\u7F6E",icon:"\u{1F4AC}",description:"AI \u8AAA\u8A71\u98A8\u683C\u548C\u4EBA\u683C"},{id:"ai-usage",label:"\u4F7F\u7528\u7D71\u8A08",icon:"\u{1F4CA}",description:"AI \u8ABF\u7528\u7D71\u8A08"}]},{id:"automation",label:"\u89F8\u767C\u76E3\u63A7",icon:"\u{1F4E1}",description:"\u8A2D\u7F6E\u89F8\u767C\u898F\u5247\u548C\u76E3\u63A7",color:"from-emerald-500 to-teal-500",defaultView:"monitoring-groups",views:[{id:"monitoring-groups",label:"\u76E3\u63A7\u7FA4\u7D44",icon:"\u{1F465}",description:"\u7BA1\u7406\u76E3\u63A7\u7684\u7FA4\u7D44"},{id:"keyword-sets",label:"\u95DC\u9375\u8A5E\u96C6",icon:"\u{1F50D}",description:"\u8A2D\u7F6E\u89F8\u767C\u95DC\u9375\u8A5E"},{id:"trigger-rules",label:"\u89F8\u767C\u898F\u5247",icon:"\u{1F3AF}",description:"\u914D\u7F6E\u89F8\u767C\u689D\u4EF6\u548C\u52D5\u4F5C"},{id:"chat-templates",label:"\u804A\u5929\u6A21\u677F",icon:"\u{1F4AC}",description:"\u9810\u8A2D\u56DE\u8986\u6A21\u677F"},{id:"collected-users",label:"\u6536\u96C6\u7528\u6236",icon:"\u{1F4E5}",description:"\u81EA\u52D5\u6536\u96C6\u7684\u7528\u6236"}]},{id:"contacts",label:"\u5BA2\u6236\u7BA1\u7406",icon:"\u{1F4CB}",description:"\u7BA1\u7406\u6F5B\u5728\u5BA2\u6236\u548C\u7528\u6236\u6578\u64DA",color:"from-sky-500 to-cyan-500",defaultView:"leads",views:[{id:"leads",label:"\u7DDA\u7D22\u7BA1\u7406",icon:"\u{1F4CB}",description:"\u7BA1\u7406\u6240\u6709\u6F5B\u5728\u5BA2\u6236",shortcut:"L"},{id:"lead-nurturing",label:"\u7DDA\u7D22\u57F9\u80B2",icon:"\u{1F331}",description:"AI \u9A45\u52D5\u7684\u5BA2\u6236\u57F9\u80B2"},{id:"member-database",label:"\u6210\u54E1\u6578\u64DA\u5EAB",icon:"\u{1F5C4}\uFE0F",description:"\u7FA4\u7D44\u6210\u54E1\u7BA1\u7406"},{id:"user-tracking",label:"\u7528\u6236\u8FFD\u8E64",icon:"\u{1F4CD}",description:"\u8FFD\u8E64\u9AD8\u50F9\u503C\u7528\u6236"}]},{id:"analytics",label:"\u6578\u64DA\u5206\u6790",icon:"\u{1F4C8}",description:"\u67E5\u770B\u7D71\u8A08\u548C\u5831\u544A",color:"from-rose-500 to-red-500",defaultView:"analytics",views:[{id:"analytics",label:"\u6578\u64DA\u7E3D\u89BD",icon:"\u{1F4C8}",description:"\u95DC\u9375\u6307\u6A19\u6982\u89BD"},{id:"marketing-report",label:"\u71DF\u92B7\u5831\u8868",icon:"\u{1F4CA}",description:"\u89D2\u8272\u7D44\u5408\u6548\u679C\u5206\u6790",shortcut:"R"},{id:"analytics-center",label:"\u5206\u6790\u4E2D\u5FC3",icon:"\u{1F4CA}",description:"\u6DF1\u5EA6\u6578\u64DA\u5206\u6790"},{id:"performance",label:"\u6027\u80FD\u76E3\u63A7",icon:"\u26A1",description:"\u7CFB\u7D71\u6027\u80FD\u6307\u6A19"},{id:"search-discovery",label:"\u8CC7\u6E90\u767C\u73FE",icon:"\u{1F52D}",description:"\u767C\u73FE\u65B0\u7FA4\u7D44\u548C\u7528\u6236"}]},{id:"system",label:"\u7CFB\u7D71\u8A2D\u7F6E",icon:"\u2699\uFE0F",description:"\u7CFB\u7D71\u914D\u7F6E\u548C\u65E5\u8A8C",color:"from-slate-500 to-gray-500",defaultView:"settings",views:[{id:"settings",label:"\u7CFB\u7D71\u8A2D\u7F6E",icon:"\u2699\uFE0F",description:"\u5168\u5C40\u8A2D\u7F6E",shortcut:"S"},{id:"profile",label:"\u500B\u4EBA\u8CC7\u6599",icon:"\u{1F464}",description:"\u7528\u6236\u8CC7\u6599"},{id:"membership-center",label:"\u6703\u54E1\u4E2D\u5FC3",icon:"\u{1F48E}",description:"\u8A02\u95B1\u7BA1\u7406"}]},{id:"marketing",label:"\u71DF\u92B7\u4E2D\u5FC3",icon:"\u{1F4E2}",description:"\uFF08\u5DF2\u6574\u5408\u5230\u71DF\u92B7\u4EFB\u52D9\u4E2D\u5FC3\uFF09",color:"from-rose-500 to-red-500",defaultView:"ads",views:[{id:"ads",label:"\u5EE3\u544A\u767C\u9001",icon:"\u{1F4E2}",description:"\u6279\u91CF\u767C\u9001\u5EE3\u544A",hidden:!0},{id:"campaigns",label:"\u71DF\u92B7\u6D3B\u52D5",icon:"\u{1F3AA}",description:"\u7BA1\u7406\u71DF\u92B7\u6D3B\u52D5",hidden:!0},{id:"multi-role",label:"\u591A\u89D2\u8272\u5354\u4F5C",icon:"\u{1F3AD}",description:"\u5DF2\u79FB\u81F3\u89D2\u8272\u8CC7\u6E90\u5EAB",hidden:!0}]},{id:"ai",label:"AI \u4E2D\u5FC3",icon:"\u{1F9E0}",description:"\uFF08\u5DF2\u6574\u5408\u5230\u667A\u80FD\u5F15\u64CE\uFF09",color:"from-indigo-500 to-violet-500",defaultView:"ai-center",views:[{id:"ai-center",label:"AI \u5C0D\u8A71",icon:"\u{1F9E0}",description:"\u5DF2\u79FB\u81F3\u667A\u80FD\u5F15\u64CE",hidden:!0},{id:"ai-assistant",label:"AI \u52A9\u624B",icon:"\u2728",description:"\u71DF\u92B7\u5167\u5BB9\u52A9\u624B",hidden:!0}]}],eo=class i{constructor(){this._currentView=f("dashboard");this.currentView=this._currentView.asReadonly();this._history=[];this.MAX_HISTORY=20;this.modules=jt;this.currentModule=R(()=>{let e=this._currentView();return jt.find(t=>t.views.some(n=>n.id===e))||jt[0]});this.currentNavItem=R(()=>{let e=this._currentView();for(let t of jt){let n=t.views.find(o=>o.id===e);if(n)return n}return null});this.breadcrumbs=R(()=>{let e=this.currentModule(),t=this.currentNavItem();return!e||!t?[]:e.id==="dashboard"?[{label:"\u9996\u9801",icon:"\u{1F3E0}"}]:[{label:e.label,icon:e.icon,view:e.defaultView},{label:t.label,icon:t.icon}]})}navigateTo(e){let t=this._currentView();t!==e&&(this._history.push(t),this._history.length>this.MAX_HISTORY&&this._history.shift()),this._currentView.set(e)}goBack(){if(this._history.length===0)return!1;let e=this._history.pop();return e?(this._currentView.set(e),!0):!1}navigateToModule(e){let t=jt.find(n=>n.id===e);t&&this.navigateTo(t.defaultView)}getModuleViews(e){let t=jt.find(n=>n.id===e);return t?t.views.filter(n=>!n.hidden):[]}getViewModule(e){return jt.find(t=>t.views.some(n=>n.id===e))||null}searchViews(e){if(!e)return[];let t=e.toLowerCase(),n=[];for(let o of jt)for(let a of o.views)(a.label.toLowerCase().includes(t)||a.description?.toLowerCase().includes(t))&&n.push(a);return n}getShortcuts(){let e=new Map;for(let t of jt)for(let n of t.views)n.shortcut&&e.set(n.shortcut.toLowerCase(),n.id);return e}setBadge(e,t){for(let n of jt){let o=n.views.find(a=>a.id===e);if(o){o.badge=t;break}}}clearBadge(e){this.setBadge(e,0)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Je=class i{constructor(){this.unifiedNav=F(eo);this._currentView=f("dashboard");this.currentView=this._currentView.asReadonly();this._syncing=!1;gt(()=>{let e=this.unifiedNav.currentView();!this._syncing&&this.isValidLegacyView(e)&&this._currentView.set(e)})}setView(e){this._syncing=!0;try{this._currentView.set(e),this.isValidViewId(e)&&this.unifiedNav.navigateTo(e)}finally{this._syncing=!1}}navigateTo(e){this.setView(e)}goBack(){return this.unifiedNav.goBack()}getCurrentModule(){return this.unifiedNav.currentModule()}getBreadcrumbs(){return this.unifiedNav.breadcrumbs()}getModules(){return jt}navigateToModule(e){this.unifiedNav.navigateToModule(e);let t=jt.find(n=>n.id===e);t&&this.isValidLegacyView(t.defaultView)&&this._currentView.set(t.defaultView)}isValidLegacyView(e){return["dashboard","accounts","add-account","api-credentials","resources","member-database","resource-center","search-discovery","ai-assistant","automation","automation-legacy","leads","lead-nurturing","nurturing-analytics","ads","user-tracking","campaigns","multi-role","ai-team","ai-center","settings","analytics","analytics-center","logs","performance","alerts","profile","membership-center","monitoring-accounts","monitoring-groups","keyword-sets","chat-templates","trigger-rules","collected-users"].includes(e)}isValidViewId(e){for(let t of jt)if(t.views.some(n=>n.id===e))return!0;return!1}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}},sc=class i{constructor(){this.bridge=F(Je);this.unifiedNav=F(eo);this.shortcuts=this.unifiedNav.getShortcuts()}handleKeyboard(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return!1;if(e.ctrlKey||e.metaKey){let t=e.key.toLowerCase(),n=this.shortcuts.get(t);if(n)return e.preventDefault(),this.bridge.navigateTo(n),!0}return e.key==="Backspace"?(e.preventDefault(),this.bridge.goBack()):!1}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var P_=class i{constructor(){this._backendConnectionState=f("connecting");this._backendConnectionMessage=f("\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...");this._backendConnectionProgress=f(0);this.backendConnectionState=this._backendConnectionState.asReadonly();this.backendConnectionMessage=this._backendConnectionMessage.asReadonly();this.backendConnectionProgress=this._backendConnectionProgress.asReadonly();this.isConnected=R(()=>this._backendConnectionState()==="connected");this._currentView=f("dashboard");this._previousView=f(null);this._sidebarCollapsed=f(!1);this.currentView=this._currentView.asReadonly();this.previousView=this._previousView.asReadonly();this.sidebarCollapsed=this._sidebarCollapsed.asReadonly();this._accounts=f([]);this._selectedAccountId=f(null);this.accounts=this._accounts.asReadonly();this.selectedAccountId=this._selectedAccountId.asReadonly();this.selectedAccount=R(()=>{let e=this._selectedAccountId();return e?this._accounts().find(t=>t.id===e):null});this.onlineAccounts=R(()=>this._accounts().filter(e=>e.status==="Online"));this.accountStats=R(()=>{let e=this._accounts();return{total:e.length,online:e.filter(t=>t.status==="Online").length,offline:e.filter(t=>t.status==="Offline").length,error:e.filter(t=>t.status==="Error"||t.status==="Banned").length}});this._groups=f([]);this._keywordSets=f([]);this._templates=f([]);this._isMonitoring=f(!1);this.groups=this._groups.asReadonly();this.keywordSets=this._keywordSets.asReadonly();this.templates=this._templates.asReadonly();this.isMonitoring=this._isMonitoring.asReadonly();this.monitoringStats=R(()=>{let e=this._groups(),t=this._keywordSets();return{totalGroups:e.length,activeGroups:e.filter(n=>n.isActive).length,totalKeywords:t.reduce((n,o)=>n+(o.keywords?.length||0),0),activeKeywordSets:t.filter(n=>n.is_active).length}});this._isLoading=f(!1);this._loadingMessage=f("");this.isLoading=this._isLoading.asReadonly();this.loadingMessage=this._loadingMessage.asReadonly();this.navModules=[{id:"dashboard",name:"\u5DE5\u4F5C\u53F0",icon:"\u{1F4CA}",views:[{id:"dashboard",name:"\u7E3D\u89BD",icon:"\u{1F3E0}"},{id:"analytics-center",name:"\u6578\u64DA\u5206\u6790",icon:"\u{1F4C8}"}]},{id:"accounts",name:"\u5E33\u865F\u7BA1\u7406",icon:"\u{1F464}",views:[{id:"accounts",name:"\u5E33\u865F\u5217\u8868",icon:"\u{1F4F1}"},{id:"add-account",name:"\u6DFB\u52A0\u5E33\u865F",icon:"\u2795"},{id:"api-credentials",name:"API \u6191\u8B49",icon:"\u{1F511}"}]},{id:"automation",name:"\u81EA\u52D5\u5316\u4E2D\u5FC3",icon:"\u{1F916}",views:[{id:"automation",name:"\u81EA\u52D5\u5316\u9762\u677F",icon:"\u26A1"},{id:"monitoring-accounts",name:"\u76E3\u63A7\u5E33\u865F",icon:"\u{1F441}\uFE0F"},{id:"monitoring-groups",name:"\u76E3\u63A7\u7FA4\u7D44",icon:"\u{1F4AC}"},{id:"keyword-sets",name:"\u95DC\u9375\u8A5E\u96C6",icon:"\u{1F524}"},{id:"chat-templates",name:"\u8A71\u8853\u6A21\u677F",icon:"\u{1F4DD}"},{id:"trigger-rules",name:"\u89F8\u767C\u898F\u5247",icon:"\u{1F3AF}"},{id:"collected-users",name:"\u6536\u96C6\u7528\u6236",icon:"\u{1F465}"}]},{id:"resources",name:"\u8CC7\u6E90\u4E2D\u5FC3",icon:"\u{1F4E6}",views:[{id:"search-discovery",name:"\u641C\u7D22\u767C\u73FE",icon:"\u{1F50D}"},{id:"member-database",name:"\u6210\u54E1\u8CC7\u6599\u5EAB",icon:"\u{1F465}"},{id:"resource-center",name:"\u8CC7\u6E90\u7BA1\u7406",icon:"\u{1F4C1}"}]},{id:"leads",name:"\u5BA2\u6236\u57F9\u80B2",icon:"\u{1F3AF}",views:[{id:"lead-nurturing",name:"\u7DDA\u7D22\u7BA1\u7406",icon:"\u{1F4CB}"},{id:"nurturing-analytics",name:"\u57F9\u80B2\u5206\u6790",icon:"\u{1F4CA}"}]},{id:"ai",name:"AI \u4E2D\u5FC3",icon:"\u{1F9E0}",views:[{id:"ai-center",name:"AI \u914D\u7F6E",icon:"\u2699\uFE0F"},{id:"ai-assistant",name:"AI \u52A9\u624B",icon:"\u{1F4AC}"},{id:"ai-team",name:"AI \u5718\u968A",icon:"\u{1F465}"},{id:"multi-role",name:"\u591A\u89D2\u8272\u5354\u4F5C",icon:"\u{1F3AD}"}]},{id:"system",name:"\u7CFB\u7D71\u8A2D\u7F6E",icon:"\u2699\uFE0F",views:[{id:"settings",name:"\u7CFB\u7D71\u8A2D\u7F6E",icon:"\u{1F527}"},{id:"profile",name:"\u500B\u4EBA\u8CC7\u6599",icon:"\u{1F464}"},{id:"membership-center",name:"\u6703\u54E1\u4E2D\u5FC3",icon:"\u{1F48E}"}]}]}setConnectionState(e,t){this._backendConnectionState.set(e),t&&this._backendConnectionMessage.set(t)}setConnectionProgress(e){this._backendConnectionProgress.set(e)}navigateTo(e){this._previousView.set(this._currentView()),this._currentView.set(e)}goBack(){let e=this._previousView();e&&(this._currentView.set(e),this._previousView.set(null))}toggleSidebar(){this._sidebarCollapsed.update(e=>!e)}setSidebarCollapsed(e){this._sidebarCollapsed.set(e)}setAccounts(e){this._accounts.set(e)}updateAccount(e){this._accounts.update(t=>t.map(n=>n.id===e.id?e:n))}addAccount(e){this._accounts.update(t=>[...t,e])}removeAccount(e){this._accounts.update(t=>t.filter(n=>n.id!==e))}selectAccount(e){this._selectedAccountId.set(e)}setGroups(e){this._groups.set(e)}setKeywordSets(e){this._keywordSets.set(e)}setTemplates(e){this._templates.set(e)}setMonitoring(e){this._isMonitoring.set(e)}setLoading(e,t){this._isLoading.set(e),t!==void 0&&this._loadingMessage.set(t)}getModuleForView(e){return this.navModules.find(t=>t.views.some(n=>n.id===e))}getViewInfo(e){for(let t of this.navModules){let n=t.views.find(o=>o.id===e);if(n)return n}}getBreadcrumb(){let e=this._currentView(),t=this.getModuleForView(e),n=this.getViewInfo(e);return t&&n?{module:t,view:n}:null}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var R_=[{id:"Listener",name:"\u76E3\u63A7\u865F",icon:"\u{1F441}\uFE0F",description:"\u7528\u65BC\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F",color:"blue"},{id:"Sender",name:"\u767C\u9001\u865F",icon:"\u{1F4E4}",description:"\u7528\u65BC\u767C\u9001\u6D88\u606F",color:"green"},{id:"Explorer",name:"\u63A2\u7D22\u865F",icon:"\u{1F50D}",description:"\u7528\u65BC\u641C\u7D22\u548C\u767C\u73FE\u8CC7\u6E90",color:"purple"},{id:"AI",name:"AI \u865F",icon:"\u{1F916}",description:"\u7528\u65BC AI \u5C0D\u8A71",color:"cyan"},{id:"Backup",name:"\u5099\u7528\u865F",icon:"\u26A1",description:"\u5099\u7528\u5E33\u865F",color:"yellow"},{id:"Unassigned",name:"\u672A\u5206\u914D",icon:"\u2B55",description:"\u5C1A\u672A\u5206\u914D\u89D2\u8272",color:"gray"}],pt=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._accounts=f([]);this._selectedAccountIds=f(new Set);this._filter=f({status:"all",role:"all"});this._isLoading=f(!1);this._initialized=!1;this.accounts=this._accounts.asReadonly();this.selectedAccountIds=this._selectedAccountIds.asReadonly();this.filter=this._filter.asReadonly();this.isLoading=this._isLoading.asReadonly();this.filteredAccounts=R(()=>{let e=this._accounts(),t=this._filter();return e.filter(n=>{if(t.status&&t.status!=="all"&&n.status!==t.status||t.role&&t.role!=="all"&&n.role!==t.role)return!1;if(t.search){let o=t.search.toLowerCase(),a=n.phone?.toLowerCase().includes(o),d=n.name?.toLowerCase().includes(o);if(!a&&!d)return!1}return!0})});this.stats=R(()=>{let e=this._accounts(),t={};for(let n of R_)t[n.id]=0;for(let n of e)n.role&&t[n.role]!==void 0&&t[n.role]++;return{total:e.length,online:e.filter(n=>n.status==="Online").length,offline:e.filter(n=>n.status==="Offline").length,connecting:e.filter(n=>n.status==="Connecting").length,error:e.filter(n=>n.status==="Error"||n.status==="Banned").length,byRole:t}});this.onlineAccounts=R(()=>this._accounts().filter(e=>e.status==="Online"));this.listenerAccounts=R(()=>this._accounts().filter(e=>e.role==="Listener"&&e.status==="Online"));this.senderAccounts=R(()=>this._accounts().filter(e=>e.role==="Sender"&&e.status==="Online"));this.selectedAccounts=R(()=>{let e=this._selectedAccountIds();return this._accounts().filter(t=>e.has(t.id))});this.hasSelection=R(()=>this._selectedAccountIds().size>0);this.allSelected=R(()=>{let e=this.filteredAccounts(),t=this._selectedAccountIds();return e.length>0&&e.every(n=>t.has(n.id))});this._loginState=f({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1});this._loginCode=f("");this._login2FAPassword=f("");this.loginState=this._loginState.asReadonly();this.loginCode=this._loginCode.asReadonly();this.login2FAPassword=this._login2FAPassword.asReadonly();this.setupIpcListeners()}setupIpcListeners(){this._initialized||(this._initialized=!0,console.log("[AccountManagementService] Setting up IPC listeners"),this.ipc.on("accounts-updated",e=>{console.log("[AccountManagementService] Received accounts-updated:",e.length,"accounts"),this._accounts.set(e),this._isLoading.set(!1)}),this.ipc.on("account-deleted",e=>{e.success?(this._accounts.update(t=>t.filter(n=>n.id!==e.accountId)),this.toast.success("\u5E33\u865F\u5DF2\u522A\u9664")):this.toast.error(`\u522A\u9664\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipc.on("login-requires-code",e=>{console.log("[AccountManagementService] Login requires code for account:",e.accountId),this.handleCodeRequired(e)}),this.ipc.on("login-requires-2fa",e=>{console.log("[AccountManagementService] Login requires 2FA for account:",e.accountId),this.handle2FARequired(e)}),this.ipc.on("login-success",e=>{console.log("[AccountManagementService] Login success for account:",e.accountId),this.handleLoginSuccess(e)}),this.ipc.on("login-failed",e=>{console.log("[AccountManagementService] Login failed for account:",e.accountId),this.handleLoginFailed(e)}),this.ipc.on("logout-result",e=>{this.handleLogoutResult(e)}),this.loadAccounts())}loadAccounts(){console.log("[AccountManagementService] Loading accounts..."),this._isLoading.set(!0),this.ipc.send("get-accounts")}setAccounts(e){this._accounts.set(e)}updateAccount(e){this._accounts.update(t=>t.map(n=>n.id===e.id?E(E({},n),e):n))}addAccount(e){this._accounts.update(t=>[...t,e])}removeAccount(e){this._accounts.update(t=>t.filter(n=>n.id!==e)),this._selectedAccountIds.update(t=>{let n=new Set(t);return n.delete(e),n})}toggleSelection(e){this._selectedAccountIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}selectAll(){let e=this.filteredAccounts();this._selectedAccountIds.set(new Set(e.map(t=>t.id)))}deselectAll(){this._selectedAccountIds.set(new Set)}toggleSelectAll(){this.allSelected()?this.deselectAll():this.selectAll()}isSelected(e){return this._selectedAccountIds().has(e)}setFilter(e){this._filter.update(t=>E(E({},t),e))}clearFilter(){this._filter.set({status:"all",role:"all"})}async connectAccount(e){let t=this._accounts().find(n=>n.id===e);return t?(this.updateAccount(P(E({},t),{status:"Connecting"})),new Promise(n=>{this.ipc.send("connect-account",{accountId:e,phone:t.phone}),n(!0)})):!1}async disconnectAccount(e){let t=this._accounts().find(n=>n.id===e);return t?new Promise(n=>{this.ipc.send("disconnect-account",{accountId:e,phone:t.phone}),n(!0)}):!1}async deleteAccount(e){return new Promise(t=>{this.ipc.send("delete-account",{accountId:e}),t(!0)})}async setAccountRole(e,t){let n=this._accounts().find(o=>o.id===e);return n?(this.updateAccount(P(E({},n),{role:t})),new Promise(o=>{this.ipc.send("update-account",{accountId:e,updates:{role:t}}),o(!0)})):!1}async batchSetRole(e,t){for(let n of e)await this.setAccountRole(n,t);this.toast.success(`\u5DF2\u5C07 ${e.length} \u500B\u5E33\u865F\u8A2D\u70BA ${this.getRoleName(t)}`)}async batchConnect(e){for(let t of e)await this.connectAccount(t);this.toast.info(`\u6B63\u5728\u9023\u63A5 ${e.length} \u500B\u5E33\u865F...`)}async batchDisconnect(e){for(let t of e)await this.disconnectAccount(t);this.toast.info(`\u6B63\u5728\u65B7\u958B ${e.length} \u500B\u5E33\u865F...`)}getAccount(e){return this._accounts().find(t=>t.id===e)}getAccountByPhone(e){return this._accounts().find(t=>t.phone===e)}getRoleInfo(e){return R_.find(t=>t.id===e)}getRoleName(e){return this.getRoleInfo(e)?.name||"\u672A\u77E5"}getRoleIcon(e){return this.getRoleInfo(e)?.icon||"\u2B55"}getStatusColor(e){return{Online:"text-green-400",Offline:"text-gray-400",Connecting:"text-yellow-400",Error:"text-red-400",Banned:"text-red-500",Limited:"text-orange-400"}[e]||"text-gray-400"}getStatusText(e){return{Online:"\u5728\u7DDA",Offline:"\u96E2\u7DDA",Connecting:"\u9023\u63A5\u4E2D",Error:"\u932F\u8AA4",Banned:"\u5DF2\u5C01\u7981",Limited:"\u53D7\u9650"}[e]||"\u672A\u77E5"}setLoginCode(e){this._loginCode.set(e)}setLogin2FAPassword(e){this._login2FAPassword.set(e)}loginAccount(e){let t=this._accounts().find(n=>n.id===e);if(!t){this.toast.error("\u8D26\u6237\u672A\u627E\u5230");return}this.toast.info("\u6B63\u5728\u767B\u5F55\u8D26\u6237..."),this._loginState.set({accountId:e,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this._loginCode.set(""),this._login2FAPassword.set(""),this.ipc.send("login-account",e)}logoutAccount(e){let t=this._accounts().find(n=>n.id===e);if(!t){this.toast.error("\u8D26\u6237\u672A\u627E\u5230");return}confirm(`\u786E\u5B9A\u8981\u9000\u51FA\u8D26\u6237 ${t.phone} \u5417\uFF1F`)&&(this.toast.info("\u6B63\u5728\u9000\u51FA\u8D26\u6237..."),this.ipc.send("logout-account",e))}submitLoginCode(){let e=this._loginState();!e.accountId||!e.phoneCodeHash||!this._loginCode().trim()||(this._loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!0}),this.toast.info("\u6B63\u5728\u9A8C\u8BC1\u9A8C\u8BC1\u7801..."),this.ipc.send("login-account",{accountId:e.accountId,phoneCode:this._loginCode().trim(),phoneCodeHash:e.phoneCodeHash}),this._loginCode.set(""))}submitLogin2FA(){let e=this._loginState();!e.accountId||!this._login2FAPassword().trim()||(this.ipc.send("login-account",{accountId:e.accountId,twoFactorPassword:this._login2FAPassword().trim()}),this._login2FAPassword.set(""))}cancelLogin(){this._loginState.set({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this._loginCode.set(""),this._login2FAPassword.set("")}resendVerificationCode(){let e=this._loginState();e.accountId&&(this._loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this._loginCode.set(""),this.toast.info("\u6B63\u5728\u91CD\u65B0\u53D1\u9001\u9A8C\u8BC1\u7801\u5230\u60A8\u7684 Telegram \u5E94\u7528...",5e3),this.ipc.send("login-account",e.accountId))}checkAccountStatus(e){this.ipc.send("check-account-status",e)}handleCodeRequired(e){this._loginState.update(t=>P(E({},t),{accountId:e.accountId,requiresCode:!0,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!1}))}handle2FARequired(e){this._loginState.update(t=>P(E({},t),{accountId:e.accountId,requiresCode:!1,requires2FA:!0,isSubmittingCode:!1}))}handleLoginSuccess(e){this._loginState.set({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.toast.success("\u767B\u5F55\u6210\u529F")}handleLoginFailed(e){this._loginState.update(t=>P(E({},t),{isSubmittingCode:!1})),this.toast.error(`\u767B\u5F55\u5931\u8D25: ${e.error}`)}handleLogoutResult(e){if(e.success){let t=this._accounts().find(n=>n.id===e.accountId);this.toast.success(`\u8D26\u6237 ${t?.phone||""} \u5DF2\u9000\u51FA`)}else this.toast.error(`\u9000\u51FA\u5931\u8D25: ${e.error||"\u672A\u77E5\u9519\u8BEF"}`)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var gm=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._initialized=f(!1);this._selectedAccountId=f(null);this._searchState=f({isSearching:!1,query:"",progress:0,currentSource:null,error:null});this._results=f([]);this._savedResources=f([]);this._searchHistory=f([]);this._stats=f({totalDiscovered:0,groups:0,channels:0,users:0,todayDiscovered:0});this.searchCache=new Map;this.CACHE_EXPIRY_MS=300*1e3;this.initialized=this._initialized.asReadonly();this.selectedAccountId=this._selectedAccountId.asReadonly();this.searchState=this._searchState.asReadonly();this.results=this._results.asReadonly();this.savedResources=this._savedResources.asReadonly();this.searchHistory=this._searchHistory.asReadonly();this.stats=this._stats.asReadonly();this.isSearching=R(()=>this._searchState().isSearching);this.searchProgress=R(()=>this._searchState().progress);this.groupResults=R(()=>this._results().filter(e=>e.type==="group"));this.channelResults=R(()=>this._results().filter(e=>e.type==="channel"));this.userResults=R(()=>this._results().filter(e=>e.type==="user"))}async initialize(e){let t=this.selectBestAccount(e);return t?(this._selectedAccountId.set(t.id),new Promise(n=>{this.ipc.send("init-resource-discovery",{accountId:t.id,phone:t.phone}),setTimeout(()=>{this._initialized.set(!0),n(!0)},1e3)})):(this.toast.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F"),!1)}selectBestAccount(e){let t=e.filter(o=>o.status==="Online");if(t.length===0)return null;let n={Explorer:1,Listener:2,Sender:3,AI:4,Backup:5,Unassigned:6};return t.sort((o,a)=>(n[o.role]||99)-(n[a.role]||99))[0]}async search(e,t=["telegram"]){if(!e.trim())return this.toast.warning("\u8ACB\u8F38\u5165\u641C\u7D22\u95DC\u9375\u8A5E"),[];let n=this.generateCacheKey(e,t),o=this.getFromCache(n);return o?(this._results.set(o.results),o.results):(this._searchState.set({isSearching:!0,query:e,progress:0,currentSource:t[0],error:null}),this._results.set([]),this.addToHistory(e),this.ipc.send("search-resources",{query:e,sources:t,accountId:this._selectedAccountId()}),[])}handleSearchResults(e){this._results.update(t=>{let n=[...t];for(let o of e.results)n.some(a=>a.id===o.id)||n.push(o);return n}),this._searchState.update(t=>P(E({},t),{progress:e.isComplete?100:t.progress+20,currentSource:e.source})),e.isComplete&&this.completeSearch()}handleSearchError(e){this._searchState.update(t=>P(E({},t),{isSearching:!1,error:e})),this.toast.error(`\u641C\u7D22\u5931\u6557: ${e}`)}completeSearch(){let e=this._searchState(),t=this._results(),n=this.generateCacheKey(e.query,["telegram"]);this.searchCache.set(n,{query:e.query,source:"telegram",results:t,timestamp:Date.now(),totalCount:t.length}),this._searchState.update(o=>P(E({},o),{isSearching:!1,progress:100})),this.updateStats(),this.toast.success(`\u627E\u5230 ${t.length} \u500B\u7D50\u679C`)}cancelSearch(){this.ipc.send("cancel-search"),this._searchState.update(e=>P(E({},e),{isSearching:!1,progress:0}))}clearResults(){this._results.set([]),this._searchState.update(e=>P(E({},e),{query:"",progress:0,error:null}))}async saveResource(e){if(this._savedResources().some(n=>n.id===e.id))return this.toast.info("\u6B64\u8CC7\u6E90\u5DF2\u4FDD\u5B58"),!1;let t=P(E({},e),{addedAt:new Date().toISOString()});return this._savedResources.update(n=>[...n,t]),this.ipc.send("save-resource",{resource:t}),this.toast.success("\u8CC7\u6E90\u5DF2\u4FDD\u5B58"),!0}removeResource(e){this._savedResources.update(t=>t.filter(n=>n.id!==e)),this.ipc.send("remove-resource",{resourceId:e})}async joinGroup(e){return e.type!=="group"&&e.type!=="channel"?(this.toast.error("\u53EA\u80FD\u52A0\u5165\u7FA4\u7D44\u6216\u983B\u9053"),!1):(this.ipc.send("join-group",{username:e.username,accessHash:e.accessHash,accountId:this._selectedAccountId()}),this.toast.info(`\u6B63\u5728\u52A0\u5165 ${e.title}...`),!0)}async extractMembers(e,t=100){if(e.type!=="group"){this.toast.error("\u53EA\u80FD\u5F9E\u7FA4\u7D44\u63D0\u53D6\u6210\u54E1");return}this.ipc.send("extract-members",{groupId:e.id,groupTitle:e.title,limit:t,accountId:this._selectedAccountId()}),this.toast.info("\u6B63\u5728\u63D0\u53D6\u6210\u54E1...")}generateCacheKey(e,t){let n=e.toLowerCase().trim(),o=[...t].sort().join(",");return`${n}|${o}`}getFromCache(e){let t=this.searchCache.get(e);return t?Date.now()-t.timestamp>this.CACHE_EXPIRY_MS?(this.searchCache.delete(e),null):t:null}addToHistory(e){this._searchHistory.update(t=>{let n=t.filter(o=>o!==e);return[e,...n].slice(0,20)})}clearHistory(){this._searchHistory.set([])}updateStats(){let e=this._results(),t=this._savedResources();this._stats.set({totalDiscovered:t.length,groups:t.filter(n=>n.type==="group").length,channels:t.filter(n=>n.type==="channel").length,users:t.filter(n=>n.type==="user").length,todayDiscovered:e.length})}refreshStats(){this.ipc.send("get-resource-stats")}setStats(e){this._stats.set(e)}selectAccount(e){this._selectedAccountId.set(e),this._initialized.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var N_=class i{constructor(){this.errorHandlerService=F(hm)}handleError(e){console.error("Global error caught:",e),this.errorHandlerService.handle(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac})}},hm=class i{constructor(){this.toast=F(J);this._errors=f([]);this.errors=this._errors.asReadonly();this._lastError=f(null);this.lastError=this._lastError.asReadonly();this._stats=f({total:0,byType:{network:0,auth:0,permission:0,validation:0,telegram:0,database:0,ai:0,unknown:0},bySeverity:{info:0,warning:0,error:0,critical:0},lastHour:0});this.stats=this._stats.asReadonly()}handle(e,t,n){let o=this.parseError(e,t);return n?.severity&&(o.severity=n.severity),this.logError(o),this._errors.update(a=>[o,...a.slice(0,99)]),this._lastError.set(o),this.updateStats(o),n?.silent||this.showToast(o),console.error(`[${o.type.toUpperCase()}] ${o.message}`,{error:o,context:t}),o}parseError(e,t){let n=`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=new Date().toISOString();if(typeof e=="string")return{id:n,type:this.detectErrorType(e),severity:"error",message:e,userMessage:this.toUserMessage(e),suggestion:this.getSuggestion(e),timestamp:o,context:t};if(e instanceof Error){let a=this.detectErrorType(e.message);return{id:n,type:a,severity:"error",message:e.message,userMessage:this.toUserMessage(e.message,a),suggestion:this.getSuggestion(e.message,a),stack:e.stack,timestamp:o,context:t}}if(typeof e=="object"){let a=e.message||e.error||JSON.stringify(e),d=e.type||this.detectErrorType(a);return{id:n,type:d,severity:e.severity||"error",code:e.code,message:a,userMessage:e.userMessage||this.toUserMessage(a,d),suggestion:e.suggestion||this.getSuggestion(a,d),details:e.details||e,timestamp:o,context:t}}return{id:n,type:"unknown",severity:"error",message:String(e),userMessage:"\u767C\u751F\u672A\u77E5\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66",timestamp:o,context:t}}detectErrorType(e){let t=e.toLowerCase();return t.includes("network")||t.includes("fetch")||t.includes("timeout")||t.includes("connection")?"network":t.includes("auth")||t.includes("login")||t.includes("token")||t.includes("unauthorized")||t.includes("401")?"auth":t.includes("permission")||t.includes("forbidden")||t.includes("403")||t.includes("access denied")?"permission":t.includes("validation")||t.includes("invalid")||t.includes("required")||t.includes("format")?"validation":t.includes("telegram")||t.includes("pyrogram")||t.includes("flood")||t.includes("peer")||t.includes("chat")?"telegram":t.includes("database")||t.includes("sqlite")||t.includes("sql")||t.includes("query")?"database":t.includes("ai")||t.includes("openai")||t.includes("gemini")||t.includes("ollama")||t.includes("model")?"ai":"unknown"}toUserMessage(e,t){let n={network:"\u7DB2\u7D61\u9023\u63A5\u51FA\u73FE\u554F\u984C\uFF0C\u8ACB\u6AA2\u67E5\u60A8\u7684\u7DB2\u7D61\u9023\u63A5",auth:"\u767B\u9304\u72C0\u614B\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767B\u9304",permission:"\u60A8\u6C92\u6709\u6B0A\u9650\u57F7\u884C\u6B64\u64CD\u4F5C",validation:"\u8F38\u5165\u7684\u6578\u64DA\u683C\u5F0F\u4E0D\u6B63\u78BA\uFF0C\u8ACB\u6AA2\u67E5\u5F8C\u91CD\u8A66",telegram:"Telegram \u670D\u52D9\u66AB\u6642\u4E0D\u53EF\u7528\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66",database:"\u6578\u64DA\u5B58\u53D6\u51FA\u73FE\u554F\u984C\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66",ai:"AI \u670D\u52D9\u66AB\u6642\u4E0D\u53EF\u7528\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66",unknown:"\u767C\u751F\u672A\u77E5\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"};if(t)return n[t];if(e.includes("FLOOD_WAIT")){let o=e.match(/FLOOD_WAIT_(\d+)/);return`\u767C\u9001\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7B49\u5F85 ${o?parseInt(o[1]):60} \u79D2\u5F8C\u91CD\u8A66`}return e.includes("USER_PRIVACY_RESTRICTED")?"\u8A72\u7528\u6236\u5DF2\u958B\u555F\u96B1\u79C1\u4FDD\u8B77\uFF0C\u7121\u6CD5\u767C\u9001\u6D88\u606F":e.includes("PEER_ID_INVALID")?"\u7528\u6236\u4E0D\u5B58\u5728\u6216\u5DF2\u88AB\u5C01\u7981":n[this.detectErrorType(e)]}getSuggestion(e,t){let n={network:`1. \u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5
2. \u5617\u8A66\u5237\u65B0\u9801\u9762
3. \u6AA2\u67E5\u4EE3\u7406\u8A2D\u7F6E`,auth:`1. \u91CD\u65B0\u767B\u9304\u5E33\u865F
2. \u6E05\u9664\u700F\u89BD\u5668\u7DE9\u5B58
3. \u806F\u7E6B\u5BA2\u670D`,permission:`1. \u78BA\u8A8D\u5E33\u865F\u6B0A\u9650
2. \u5347\u7D1A\u6703\u54E1\u7B49\u7D1A
3. \u806F\u7E6B\u7BA1\u7406\u54E1`,validation:`1. \u6AA2\u67E5\u8F38\u5165\u683C\u5F0F
2. \u78BA\u4FDD\u5FC5\u586B\u9805\u5DF2\u586B\u5BEB
3. \u53C3\u8003\u5E6B\u52A9\u6587\u6A94`,telegram:`1. \u6AA2\u67E5\u5E33\u865F\u72C0\u614B
2. \u7B49\u5F85\u4E00\u6BB5\u6642\u9593\u5F8C\u91CD\u8A66
3. \u5617\u8A66\u4F7F\u7528\u5176\u4ED6\u5E33\u865F`,database:`1. \u5237\u65B0\u9801\u9762
2. \u91CD\u555F\u61C9\u7528
3. \u806F\u7E6B\u6280\u8853\u652F\u6301`,ai:`1. \u6AA2\u67E5 AI \u914D\u7F6E
2. \u78BA\u8A8D API \u5BC6\u9470\u6709\u6548
3. \u5617\u8A66\u5207\u63DB AI \u6A21\u578B`,unknown:`1. \u5237\u65B0\u9801\u9762
2. \u91CD\u555F\u61C9\u7528
3. \u806F\u7E6B\u5BA2\u670D`};return e.includes("FLOOD_WAIT")?`\u767C\u9001\u983B\u7387\u904E\u9AD8\uFF0C\u5EFA\u8B70\uFF1A
1. \u964D\u4F4E\u767C\u9001\u983B\u7387
2. \u589E\u52A0\u767C\u9001\u9593\u9694
3. \u4F7F\u7528\u591A\u500B\u5E33\u865F\u8F2A\u6D41\u767C\u9001`:e.includes("SESSION")?`Session \u554F\u984C\uFF0C\u5EFA\u8B70\uFF1A
1. \u91CD\u65B0\u767B\u9304\u5E33\u865F
2. \u522A\u9664 session \u6587\u4EF6\u5F8C\u91CD\u65B0\u767B\u9304
3. \u6AA2\u67E5\u662F\u5426\u5728\u5176\u4ED6\u8A2D\u5099\u767B\u9304`:n[t||this.detectErrorType(e)]}logError(e){try{let t=localStorage.getItem("tg-matrix-error-logs")||"[]",n=JSON.parse(t);n.unshift(P(E({},e),{loggedAt:new Date().toISOString()}));let o=n.slice(0,500);localStorage.setItem("tg-matrix-error-logs",JSON.stringify(o))}catch(t){console.error("Failed to log error:",t)}}updateStats(e){this._stats.update(t=>({total:t.total+1,byType:P(E({},t.byType),{[e.type]:(t.byType[e.type]||0)+1}),bySeverity:P(E({},t.bySeverity),{[e.severity]:(t.bySeverity[e.severity]||0)+1}),lastHour:t.lastHour+1}))}showToast(e){switch(e.severity){case"info":this.toast.info(e.userMessage);break;case"warning":this.toast.warning(e.userMessage);break;case"error":case"critical":this.toast.error(e.userMessage);break}}getErrorLogs(e=100){try{let t=localStorage.getItem("tg-matrix-error-logs")||"[]";return JSON.parse(t).slice(0,e)}catch{return[]}}clearErrorLogs(){localStorage.removeItem("tg-matrix-error-logs"),this._errors.set([]),this._stats.set({total:0,byType:{network:0,auth:0,permission:0,validation:0,telegram:0,database:0,ai:0,unknown:0},bySeverity:{info:0,warning:0,error:0,critical:0},lastHour:0})}async wrap(e,t,n){try{return await e()}catch(o){return this.handle(o,t,n),n?.fallback}}createBoundary(e){return{handle:(t,n,o)=>this.handle(t,{component:e,action:n},o),wrap:(t,n,o)=>this.wrap(t,{component:e,action:n},{fallback:o})}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var V_=class i{constructor(){this.router=F(Zr);this.toast=F(J);this._isEnabled=f(!0);this.isEnabled=this._isEnabled.asReadonly();this._isHelpVisible=f(!1);this.isHelpVisible=this._isHelpVisible.asReadonly();this._shortcuts=f(new Map);this.shortcuts=R(()=>Array.from(this._shortcuts().values()));this.shortcutsByCategory=R(()=>{let e=this.shortcuts(),t=new Map;for(let n of e)t.has(n.category)||t.set(n.category,[]),t.get(n.category).push(n);return t});this.keydownHandler=this.handleKeydown.bind(this),this.registerDefaultShortcuts(),this.startListening()}ngOnDestroy(){this.stopListening()}registerDefaultShortcuts(){this.register({id:"nav-dashboard",key:"g d",description:"\u524D\u5F80\u5100\u8868\u677F",category:"navigation",action:()=>this.router.navigate(["/dashboard"])}),this.register({id:"nav-accounts",key:"g a",description:"\u524D\u5F80\u5E33\u865F\u7BA1\u7406",category:"navigation",action:()=>this.router.navigate(["/accounts"])}),this.register({id:"nav-marketing",key:"g m",description:"\u524D\u5F80\u71DF\u92B7\u4EFB\u52D9\u4E2D\u5FC3",category:"navigation",action:()=>this.router.navigate(["/marketing-hub"])}),this.register({id:"nav-roles",key:"g r",description:"\u524D\u5F80\u89D2\u8272\u8CC7\u6E90\u5EAB",category:"navigation",action:()=>this.router.navigate(["/role-library"])}),this.register({id:"nav-ai",key:"g i",description:"\u524D\u5F80\u667A\u80FD\u5F15\u64CE",category:"navigation",action:()=>this.router.navigate(["/ai-engine"])}),this.register({id:"action-new-task",key:"ctrl+n",description:"\u65B0\u5EFA\u71DF\u92B7\u4EFB\u52D9",category:"actions",action:()=>{window.dispatchEvent(new CustomEvent("shortcut:new-task"))}}),this.register({id:"action-search",key:"ctrl+k",description:"\u6253\u958B\u641C\u7D22",category:"actions",global:!0,action:()=>{window.dispatchEvent(new CustomEvent("shortcut:search"))}}),this.register({id:"action-save",key:"ctrl+s",description:"\u4FDD\u5B58",category:"actions",global:!0,action:()=>{window.dispatchEvent(new CustomEvent("shortcut:save"))}}),this.register({id:"view-help",key:"?",description:"\u986F\u793A\u5FEB\u6377\u9375\u5E6B\u52A9",category:"view",action:()=>this.toggleHelp()}),this.register({id:"view-close",key:"Escape",description:"\u95DC\u9589\u5F48\u7A97/\u53D6\u6D88",category:"view",global:!0,action:()=>{this._isHelpVisible()?this.hideHelp():window.dispatchEvent(new CustomEvent("shortcut:escape"))}}),this.register({id:"view-refresh",key:"ctrl+r",description:"\u5237\u65B0\u6578\u64DA",category:"view",action:()=>{window.dispatchEvent(new CustomEvent("shortcut:refresh"))}}),this.register({id:"tool-logs",key:"ctrl+l",description:"\u67E5\u770B\u65E5\u8A8C",category:"tools",action:()=>{window.dispatchEvent(new CustomEvent("shortcut:logs"))}}),this.register({id:"tool-settings",key:"ctrl+,",description:"\u6253\u958B\u8A2D\u7F6E",category:"tools",action:()=>this.router.navigate(["/settings"])})}register(e){this._shortcuts.update(t=>{let n=new Map(t);return n.set(e.id,P(E({},e),{enabled:e.enabled??!0})),n})}unregister(e){this._shortcuts.update(t=>{let n=new Map(t);return n.delete(e),n})}setEnabled(e,t){this._shortcuts.update(n=>{let o=new Map(n),a=o.get(e);return a&&o.set(e,P(E({},a),{enabled:t})),o})}setGlobalEnabled(e){this._isEnabled.set(e)}showHelp(){this._isHelpVisible.set(!0)}hideHelp(){this._isHelpVisible.set(!1)}toggleHelp(){this._isHelpVisible.update(e=>!e)}startListening(){document.addEventListener("keydown",this.keydownHandler)}stopListening(){document.removeEventListener("keydown",this.keydownHandler)}handleKeydown(e){if(!this._isEnabled())return;let t=this.isInputFocused(),n=this.parseKeyCombo(e),o=this.comboToString(n);for(let a of this._shortcuts().values())if(a.enabled&&!(t&&!a.global)&&this.matchShortcut(o,a.key)){e.preventDefault(),e.stopPropagation();try{a.action()}catch(d){console.error(`Shortcut action failed: ${a.id}`,d)}return}}isInputFocused(){let e=document.activeElement;if(!e)return!1;let t=e.tagName.toLowerCase();return t==="input"||t==="textarea"||t==="select"||e.isContentEditable}parseKeyCombo(e){return{key:e.key.toLowerCase(),ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey}}comboToString(e){let t=[];return(e.ctrl||e.meta)&&t.push("ctrl"),e.shift&&t.push("shift"),e.alt&&t.push("alt"),t.push(e.key),t.join("+")}matchShortcut(e,t){if(t.includes(" "))return!1;let n=t.toLowerCase().replace("cmd+","ctrl+").replace("command+","ctrl+");return e===n}getCategoryLabel(e){return{navigation:"\u5C0E\u822A",actions:"\u64CD\u4F5C",view:"\u8996\u5716",tools:"\u5DE5\u5177"}[e]}formatKey(e){return e.replace("ctrl","\u2303").replace("shift","\u21E7").replace("alt","\u2325").replace("meta","\u2318").replace("Escape","Esc").toUpperCase()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var fm=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.contactsService=F(Kt);this._isExtracting=f(!1);this.isExtracting=this._isExtracting.asReadonly();this._progress=f(null);this.progress=this._progress.asReadonly();this._quota=f({daily:1e3,used:0,remaining:1e3,resetAt:""});this.quota=this._quota.asReadonly();this._history=f([]);this.history=this._history.asReadonly();this._lastResult=f(null);this.lastResult=this._lastResult.asReadonly();this.resourcesUpdated$=new an;this.extractionCompleted$=new an;this.extractionProgress$=new an;this.remainingQuota=R(()=>this._quota().remaining);this.canExtract=R(()=>!this._isExtracting()&&this._quota().remaining>0);this.setupListeners(),this.loadQuota(),this.loadHistory()}setupListeners(){this.ipc.on("members-extraction-progress",e=>{if(e){let t={groupId:String(e.resourceId||e.groupId),current:e.extracted||0,total:e.total||0,status:e.status||"\u63D0\u53D6\u4E2D...",percent:e.total>0?Math.round(e.extracted/e.total*100):0};this._progress.set(t),this.extractionProgress$.next(t)}}),this.ipc.on("members-extracted",e=>{if(this._isExtracting.set(!1),this._progress.set(null),e.success&&e.members){let t=this.processExtractionResult(e);this._lastResult.set(t),this.extractionCompleted$.next(t),this._quota.update(n=>P(E({},n),{used:n.used+t.count,remaining:Math.max(0,n.remaining-t.count)}))}else e.error&&this.toast.error(`\u63D0\u53D6\u5931\u6557\uFF1A${e.error}`)}),this.ipc.on("extraction-quota",e=>{e&&this._quota.set({daily:e.daily||1e3,used:e.used||0,remaining:e.remaining||1e3,resetAt:e.resetAt||""})})}async extractAndSync(e,t){if(this._isExtracting())return this.toast.warning("\u5DF2\u6709\u63D0\u53D6\u4EFB\u52D9\u9032\u884C\u4E2D"),null;if(this._quota().remaining<=0)return this.toast.error("\u4ECA\u65E5\u914D\u984D\u5DF2\u7528\u5B8C"),null;this._isExtracting.set(!0),this._progress.set({groupId:e.id,current:0,total:t.limit===-1?e.memberCount:t.limit,status:"\u6B63\u5728\u9023\u63A5...",percent:0});let n="";if(e.url){let o=e.url.match(/t\.me\/([+\w]+)/);o&&(n=o[1])}return this.ipc.send("extract-members",{chatId:n||e.url,username:n,resourceId:e.id,groupName:e.name,limit:t.limit===-1?void 0:t.limit,filters:{bots:!t.filters.excludeBots,offline:t.filters.onlineStatus==="offline",online:t.filters.onlineStatus==="online",chinese:t.filters.hasChinese,hasUsername:t.filters.hasUsername,isPremium:t.filters.isPremium,excludeAdmins:t.filters.excludeAdmins},autoSave:t.advanced.autoSaveToResources,skipDuplicates:t.advanced.skipDuplicates}),this.toast.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${e.name} \u7684\u6210\u54E1...`),this.addToHistory({id:`${Date.now()}`,groupId:e.id,groupName:e.name,groupUrl:e.url,count:0,config:t,timestamp:new Date,syncedToResources:t.advanced.autoSaveToResources}),null}processExtractionResult(e){let t=e.members||[],n=0,o=0,a=0,d=0,u=0,p=0;for(let C of t)C.online_status==="online"||C.onlineStatus==="online"?n++:(C.online_status==="recently"||C.onlineStatus==="recently")&&o++,(C.is_premium||C.isPremium)&&a++,C.username&&d++,(C.is_chinese||C.isChinese)&&u++,(C.is_bot||C.isBot)&&p++;let g={success:!0,groupId:String(e.resourceId||e.groupId),groupName:e.groupName||"",count:t.length,stats:{total:t.length,online:n,recently:o,premium:a,hasUsername:d,chinese:u,bots:p},members:t.map(C=>({telegramId:String(C.telegram_id||C.id),username:C.username,firstName:C.first_name||C.firstName,lastName:C.last_name||C.lastName,displayName:C.display_name||C.displayName||C.first_name||C.username||"Unknown",phone:C.phone,isBot:C.is_bot||C.isBot||!1,isPremium:C.is_premium||C.isPremium||!1,isVerified:C.is_verified||C.isVerified||!1,onlineStatus:C.online_status||C.onlineStatus||"unknown",lastSeen:C.last_seen||C.lastSeen,isChinese:C.is_chinese||C.isChinese,activityScore:C.activity_score||C.activityScore,valueLevel:C.value_level||C.valueLevel})),duration:e.duration||0,timestamp:new Date};return this._history.update(C=>{let w=C[0];return w&&w.groupId===g.groupId?[P(E({},w),{count:g.count}),...C.slice(1)]:C}),this.resourcesUpdated$.next({action:"members-extracted",count:g.count,groupName:g.groupName}),this.toast.success(`\u2705 \u6210\u529F\u63D0\u53D6 ${g.count} \u500B\u6210\u54E1`),g}async syncToResourceCenter(e){e.members.length&&(this.ipc.send("sync-members-to-resources",{members:e.members,sourceType:"member",sourceName:e.groupName,sourceId:e.groupId}),setTimeout(()=>{this.contactsService.loadContacts(),this.contactsService.loadStats()},500),this.toast.success(`\u{1F4E6} \u5DF2\u5C07 ${e.count} \u500B\u6210\u54E1\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3`))}stopExtraction(){this.ipc.send("stop-extraction",{}),this._isExtracting.set(!1),this._progress.set(null),this.toast.info("\u5DF2\u505C\u6B62\u63D0\u53D6")}loadQuota(){this.ipc.send("get-extraction-quota",{})}resetQuota(){this.ipc.send("reset-extraction-quota",{}),this.loadQuota()}loadHistory(){try{let e=localStorage.getItem("extraction_history");if(e){let t=JSON.parse(e);this._history.set(t.slice(0,50))}}catch(e){console.error("Failed to load extraction history:",e)}}addToHistory(e){this._history.update(t=>{let n=[e,...t.slice(0,49)];try{localStorage.setItem("extraction_history",JSON.stringify(n))}catch(o){console.error("Failed to save extraction history:",o)}return n})}clearHistory(){this._history.set([]),localStorage.removeItem("extraction_history")}estimateCount(e,t){let n=t.limit===-1?e.memberCount:t.limit;return Math.min(n,e.memberCount,this._quota().remaining)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var B_=[{id:"r1",action:"message_replied",name:"\u56DE\u8986\u6D88\u606F",description:"\u5BA2\u6236\u56DE\u8986\u4E86\u60A8\u7684\u6D88\u606F",points:10,enabled:!0,maxPerDay:5},{id:"r2",action:"positive_reply",name:"\u6B63\u9762\u56DE\u8986",description:"\u5BA2\u6236\u8868\u9054\u4E86\u8208\u8DA3\u6216\u7A4D\u6975\u614B\u5EA6",points:15,enabled:!0},{id:"r3",action:"question_asked",name:"\u4E3B\u52D5\u63D0\u554F",description:"\u5BA2\u6236\u4E3B\u52D5\u8A62\u554F\u7522\u54C1/\u670D\u52D9",points:20,enabled:!0},{id:"r4",action:"price_inquiry",name:"\u8A62\u554F\u50F9\u683C",description:"\u5BA2\u6236\u8A62\u554F\u50F9\u683C\uFF0C\u9AD8\u8CFC\u8CB7\u610F\u5411",points:25,enabled:!0},{id:"r5",action:"demo_requested",name:"\u8ACB\u6C42\u6F14\u793A",description:"\u5BA2\u6236\u8ACB\u6C42\u7522\u54C1\u6F14\u793A",points:30,enabled:!0},{id:"r6",action:"meeting_scheduled",name:"\u9810\u7D04\u6703\u8B70",description:"\u5BA2\u6236\u540C\u610F\u9810\u7D04\u6703\u8B70",points:40,enabled:!0},{id:"r7",action:"referral_made",name:"\u63A8\u85A6\u4ED6\u4EBA",description:"\u5BA2\u6236\u63A8\u85A6\u4E86\u5176\u4ED6\u6F5B\u5728\u5BA2\u6236",points:50,enabled:!0},{id:"r8",action:"message_sent",name:"\u767C\u9001\u6D88\u606F",description:"\u5411\u5BA2\u6236\u767C\u9001\u6D88\u606F",points:2,enabled:!0,maxPerDay:3},{id:"r9",action:"message_opened",name:"\u6253\u958B\u6D88\u606F",description:"\u5BA2\u6236\u6253\u958B\u4E86\u6D88\u606F",points:5,enabled:!0,maxPerDay:5},{id:"r10",action:"link_clicked",name:"\u9EDE\u64CA\u9023\u7D50",description:"\u5BA2\u6236\u9EDE\u64CA\u4E86\u6D88\u606F\u4E2D\u7684\u9023\u7D50",points:8,enabled:!0},{id:"r11",action:"negative_reply",name:"\u8CA0\u9762\u56DE\u8986",description:"\u5BA2\u6236\u8868\u9054\u4E0D\u611F\u8208\u8DA3",points:-10,enabled:!0},{id:"r12",action:"unsubscribed",name:"\u53D6\u6D88\u8A02\u95B1",description:"\u5BA2\u6236\u53D6\u6D88\u8A02\u95B1\u6216\u62C9\u9ED1",points:-30,enabled:!0},{id:"r13",action:"complained",name:"\u6295\u8A34",description:"\u5BA2\u6236\u6295\u8A34\u6216\u8209\u5831",points:-50,enabled:!0},{id:"r14",action:"inactive_7d",name:"7\u5929\u672A\u6D3B\u8E8D",description:"\u5BA2\u62367\u5929\u5167\u7121\u4EFB\u4F55\u4E92\u52D5",points:-5,enabled:!0},{id:"r15",action:"inactive_30d",name:"30\u5929\u672A\u6D3B\u8E8D",description:"\u5BA2\u623630\u5929\u5167\u7121\u4EFB\u4F55\u4E92\u52D5",points:-15,enabled:!0}],ac=[{level:"cold",minScore:-100,maxScore:20,color:"#64748b",icon:"\u2744\uFE0F",label:"\u51B7\u6DE1"},{level:"warm",minScore:21,maxScore:50,color:"#eab308",icon:"\u{1F324}\uFE0F",label:"\u6EAB\u548C"},{level:"hot",minScore:51,maxScore:100,color:"#f97316",icon:"\u{1F525}",label:"\u71B1\u9580"},{level:"burning",minScore:101,maxScore:999,color:"#ef4444",icon:"\u{1F4A5}",label:"\u7206\u71B1"}],lc=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._rules=f(B_);this.rules=this._rules.asReadonly();this._scores=f(new Map);this._globalHistory=f([]);this.globalHistory=this._globalHistory.asReadonly();this.stats=R(()=>{let e=Array.from(this._scores().values()),t={cold:e.filter(n=>n.heatLevel==="cold").length,warm:e.filter(n=>n.heatLevel==="warm").length,hot:e.filter(n=>n.heatLevel==="hot").length,burning:e.filter(n=>n.heatLevel==="burning").length};return{total:e.length,avgScore:e.length>0?e.reduce((n,o)=>n+o.totalScore,0)/e.length:0,byLevel:t,hotLeads:e.filter(n=>n.heatLevel==="hot"||n.heatLevel==="burning")}});this.loadData(),this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("scoring:message-sent",e=>{this.recordAction(e.contactId,"message_sent")}),this.ipc.on("scoring:reply-received",e=>{e.sentiment&&e.sentiment>.3?this.recordAction(e.contactId,"positive_reply"):e.sentiment&&e.sentiment<-.3?this.recordAction(e.contactId,"negative_reply"):this.recordAction(e.contactId,"message_replied")}),this.ipc.on("scoring:price-inquiry",e=>{this.recordAction(e.contactId,"price_inquiry")})}loadData(){try{let e=localStorage.getItem("tg-matrix-scoring-rules");e&&this._rules.set(JSON.parse(e));let t=localStorage.getItem("tg-matrix-lead-scores");if(t){let o=JSON.parse(t),a=new Map;o.forEach(d=>a.set(d.contactId,d)),this._scores.set(a)}let n=localStorage.getItem("tg-matrix-scoring-history");n&&this._globalHistory.set(JSON.parse(n))}catch(e){console.error("Failed to load scoring data:",e)}}saveData(){try{localStorage.setItem("tg-matrix-scoring-rules",JSON.stringify(this._rules())),localStorage.setItem("tg-matrix-lead-scores",JSON.stringify(Array.from(this._scores().values()))),localStorage.setItem("tg-matrix-scoring-history",JSON.stringify(this._globalHistory().slice(0,1e3)))}catch(e){console.error("Failed to save scoring data:",e)}}recordAction(e,t,n){let o=this._rules().find(d=>d.action===t&&d.enabled);if(!o||o.maxPerDay&&this.getTodayActionCount(e,t)>=o.maxPerDay)return 0;if(o.cooldownMinutes){let d=this.getLastActionTime(e,t);if(d){let u=o.cooldownMinutes*60*1e3;if(Date.now()-new Date(d).getTime()<u)return 0}}let a={id:`sh_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,contactId:e,action:t,points:o.points,reason:o.name,timestamp:new Date().toISOString(),metadata:n};return this._globalHistory.update(d=>[a,...d.slice(0,999)]),this.updateScore(e,a),this.saveData(),o.points}updateScore(e,t){let n=this._scores(),o=n.get(e);o||(o=this.createNewScore(e)),o.history=[t,...o.history.slice(0,99)],o.totalScore=Math.max(-100,Math.min(999,o.totalScore+t.points)),this.updateCategoryScores(o),o.heatLevel=this.calculateHeatLevel(o.totalScore),o.lastActivity=t.timestamp,o.activityCount++,o.updatedAt=new Date().toISOString();let a=new Map(n);a.set(e,o),this._scores.set(a)}createNewScore(e){return{contactId:e,totalScore:0,heatLevel:"cold",behaviorScore:0,engagementScore:0,intentScore:0,recencyScore:0,activityCount:0,history:[],updatedAt:new Date().toISOString()}}updateCategoryScores(e){let t=e.history.slice(0,20),n=["message_replied","link_clicked","message_opened"];e.behaviorScore=t.filter(d=>n.includes(d.action)).reduce((d,u)=>d+u.points,0);let o=["positive_reply","question_asked"];e.engagementScore=t.filter(d=>o.includes(d.action)).reduce((d,u)=>d+u.points,0);let a=["price_inquiry","demo_requested","meeting_scheduled"];if(e.intentScore=t.filter(d=>a.includes(d.action)).reduce((d,u)=>d+u.points,0),e.lastActivity){let d=(Date.now()-new Date(e.lastActivity).getTime())/864e5;d<1?e.recencyScore=20:d<3?e.recencyScore=15:d<7?e.recencyScore=10:d<14?e.recencyScore=5:e.recencyScore=0}}calculateHeatLevel(e){for(let t of ac)if(e>=t.minScore&&e<=t.maxScore)return t.level;return"cold"}getTodayActionCount(e,t){let n=new Date().toDateString(),o=this._scores().get(e);return o?o.history.filter(a=>a.action===t&&new Date(a.timestamp).toDateString()===n).length:0}getLastActionTime(e,t){let n=this._scores().get(e);return n&&n.history.find(a=>a.action===t)?.timestamp||null}getScore(e){return this._scores().get(e)||null}getAllScores(){return Array.from(this._scores().values())}getHotLeads(e=10){return this.getAllScores().sort((t,n)=>n.totalScore-t.totalScore).slice(0,e)}getLeadsByHeatLevel(e){return this.getAllScores().filter(t=>t.heatLevel===e)}adjustScore(e,t,n){let o={id:`sh_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,contactId:e,action:"message_sent",points:t,reason:`\u624B\u52D5\u8ABF\u6574: ${n}`,timestamp:new Date().toISOString()};this._globalHistory.update(a=>[o,...a.slice(0,999)]),this.updateScore(e,o),this.saveData(),this.toast.success(`\u8A55\u5206\u5DF2\u8ABF\u6574 ${t>0?"+":""}${t} \u5206`)}updateAIAnalysis(e,t){let n=this._scores(),o=n.get(e);if(!o)return;if(o.aiAnalysis=t,t){let d=Math.round(t.purchaseIntent*.3+t.urgency*.2);o.intentScore=Math.max(0,o.intentScore+d)}o.updatedAt=new Date().toISOString();let a=new Map(n);a.set(e,o),this._scores.set(a),this.saveData()}updateRule(e,t){this._rules.update(n=>n.map(o=>o.id===e?E(E({},o),t):o)),this.saveData()}resetRules(){this._rules.set(B_),this.saveData(),this.toast.success("\u8A55\u5206\u898F\u5247\u5DF2\u91CD\u7F6E")}clearScore(e){let t=new Map(this._scores());t.delete(e),this._scores.set(t),this.saveData()}getHeatLevelConfig(e){return ac.find(t=>t.level===e)||ac[0]}getAllHeatLevelConfigs(){return ac}checkInactiveLeads(){let e=Date.now(),t=this.getAllScores();for(let n of t){if(!n.lastActivity)continue;let o=new Date(n.lastActivity).getTime(),a=(e-o)/(1e3*60*60*24),d=n.history.some(p=>p.action==="inactive_7d"&&e-new Date(p.timestamp).getTime()<10080*60*1e3),u=n.history.some(p=>p.action==="inactive_30d"&&e-new Date(p.timestamp).getTime()<720*60*60*1e3);a>=30&&!u?this.recordAction(n.contactId,"inactive_30d"):a>=7&&!d&&this.recordAction(n.contactId,"inactive_7d")}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ss={USER_PREFERENCES:"user_preferences",THEME:"theme",LANGUAGE:"language",CURRENT_VIEW:"current_view",SIDEBAR_COLLAPSED:"sidebar_collapsed",MARKETING_ANALYTICS:"marketingAnalytics",SMART_TIMING:"smartTiming",SMART_AUTOMATION:"smartAutomation",PLANNER_DRAFT:"plannerDraft",ACCOUNTS_CACHE:"accounts_cache",SESSION_PATHS:"session_paths",SEARCH_HISTORY:"search_history",RECENT_CONTACTS:"recent_contacts",STORAGE_VERSION:"storage_version"},wi=1,L_={1:i=>P(E({},i),{migratedAt:Date.now()})},cc=class i{constructor(){this._stats=f(null);this.stats=this._stats.asReadonly();this._available=f(!0);this.available=this._available.asReadonly();this.checkStorageAvailability(),this.runMigrations(),this.updateStats()}save(e,t,n){if(!this._available())return!1;try{let a={_meta:{key:e,version:n?.version??wi,savedAt:Date.now(),expiresAt:n?.ttl?Date.now()+n.ttl:void 0},data:t};return localStorage.setItem(e,JSON.stringify(a)),this.updateStats(),!0}catch(o){if(console.error(`[StatePersistence] \u4FDD\u5B58\u5931\u6557 (${e}):`,o),o.name==="QuotaExceededError"){this.cleanup();try{return localStorage.setItem(e,JSON.stringify({data:t,_meta:{key:e,version:wi,savedAt:Date.now()}})),!0}catch{return!1}}return!1}}load(e,t){if(!this._available())return t;try{let n=localStorage.getItem(e);if(!n)return t;let o=JSON.parse(n);if(o._meta){if(o._meta.expiresAt&&Date.now()>o._meta.expiresAt)return this.remove(e),t;if(o._meta.version<wi){let a=this.migrate(o.data,o._meta.version);return this.save(e,a),a}return o.data}return o}catch(n){return console.error(`[StatePersistence] \u8B80\u53D6\u5931\u6557 (${e}):`,n),t}}remove(e){try{return localStorage.removeItem(e),this.updateStats(),!0}catch{return!1}}has(e){return localStorage.getItem(e)!==null}saveMultiple(e){let t=!0;for(let n of e)this.save(n.key,n.data)||(t=!1);return t}loadMultiple(e){let t={};for(let n of e)t[n]=this.load(n);return t}savePreference(e,t){let n=this.load(ss.USER_PREFERENCES,{});n[e]=t,this.save(ss.USER_PREFERENCES,n)}loadPreference(e,t){return this.load(ss.USER_PREFERENCES,{})[e]??t}saveSession(e,t){try{return sessionStorage.setItem(e,JSON.stringify(t)),!0}catch{return!1}}loadSession(e,t){try{let n=sessionStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}clearSession(){sessionStorage.clear()}cleanup(){let e=0,t=Date.now();for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(o)try{let a=localStorage.getItem(o);if(!a)continue;let d=JSON.parse(a);d._meta?.expiresAt&&t>d._meta.expiresAt&&(localStorage.removeItem(o),e++,n--)}catch{}}return this.updateStats(),console.log(`[StatePersistence] \u6E05\u7406\u4E86 ${e} \u500B\u904E\u671F\u9805`),e}cleanupOld(e=720*60*60*1e3){let t=0,n=Date.now()-e;for(let o=0;o<localStorage.length;o++){let a=localStorage.key(o);if(a)try{let d=localStorage.getItem(a);if(!d)continue;let u=JSON.parse(d);u._meta?.savedAt&&u._meta.savedAt<n&&(localStorage.removeItem(a),t++,o--)}catch{}}return this.updateStats(),t}clearAll(){localStorage.clear(),this.updateStats()}exportAll(){let e={};for(let t=0;t<localStorage.length;t++){let n=localStorage.key(t);if(n)try{e[n]=JSON.parse(localStorage.getItem(n)||"null")}catch{e[n]=localStorage.getItem(n)}}return JSON.stringify({exportedAt:new Date().toISOString(),version:wi,data:e},null,2)}importAll(e){try{let t=JSON.parse(e);if(!t.data)return console.error("[StatePersistence] \u7121\u6548\u7684\u5C0E\u5165\u683C\u5F0F"),!1;for(let[n,o]of Object.entries(t.data))localStorage.setItem(n,JSON.stringify(o));return this.updateStats(),!0}catch(t){return console.error("[StatePersistence] \u5C0E\u5165\u5931\u6557:",t),!1}}checkStorageAvailability(){try{let e="__storage_test__";localStorage.setItem(e,e),localStorage.removeItem(e),this._available.set(!0)}catch{this._available.set(!1),console.warn("[StatePersistence] localStorage \u4E0D\u53EF\u7528")}}runMigrations(){let e=this.load(ss.STORAGE_VERSION,0);if(e!==void 0&&e<wi){console.log(`[StatePersistence] \u904B\u884C\u9077\u79FB: ${e} -> ${wi}`);for(let t=0;t<localStorage.length;t++){let n=localStorage.key(t);if(n)try{let o=this.load(n);if(o){let a=this.migrate(o,e);this.save(n,a)}}catch{}}this.save(ss.STORAGE_VERSION,wi)}}migrate(e,t){let n=e;for(let o=t+1;o<=wi;o++)L_[o]&&(n=L_[o](n));return n}updateStats(){let e=0,t=[];for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o)continue;let a=localStorage.getItem(o),d=new Blob([a||""]).size;e+=d,t.push({key:o,size:d})}t.sort((n,o)=>o.size-n.size),this._stats.set({totalKeys:localStorage.length,totalSize:e,byKey:t})}getUsageInfo(){let e=this._stats();if(!e)return{used:"0 KB",available:"5 MB",percentage:0};let t=e.totalSize/(1024*1024),n=5,o=t/n*100;return{used:t<1?`${(e.totalSize/1024).toFixed(1)} KB`:`${t.toFixed(2)} MB`,available:`${n} MB`,percentage:Math.min(100,o)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var dc=class i{constructor(){this.persistence=F(cc);this._experiments=f([]);this.experiments=this._experiments.asReadonly();this._variantStats=f(new Map);this._userAssignments=f(new Map);this.activeExperiments=R(()=>this._experiments().filter(e=>e.status==="running"));this.activeTests=this.activeExperiments;this.completedExperiments=R(()=>this._experiments().filter(e=>e.status==="completed"));this.stats=R(()=>{let e=this._experiments(),t=this.completedExperiments(),n=0,o=0;return t.forEach(a=>{let d=this.getExperimentResult(a.id);if(d?.recommendedWinner){let u=d.variantStats.find(p=>p.variantId===d.recommendedWinner);u?.uplift&&(n+=u.uplift,o++)}}),{total:e.length,running:this.activeExperiments().length,completed:t.length,draft:e.filter(a=>a.status==="draft").length,avgConversionLift:o>0?n/o:0}});this.STORAGE_KEY="abTesting";this.loadFromStorage()}createExperiment(e){let t=e.variants.reduce((a,d)=>a+d.weight,0),n=e.variants.map((a,d)=>P(E({},a),{id:`var_${Date.now()}_${d}`,weight:Math.round(a.weight/t*100)})),o={id:`exp_${Date.now()}`,name:e.name,description:e.description,status:"draft",variants:n,controlVariantId:n[0].id,primaryMetric:e.primaryMetric,secondaryMetrics:e.secondaryMetrics,createdAt:new Date,sampleSize:e.sampleSize??100,minRunDays:e.minRunDays??7,confidenceLevel:e.confidenceLevel??.95,autoSelectWinner:e.autoSelectWinner??!0};return this._experiments.update(a=>[...a,o]),this._variantStats.update(a=>{let d=new Map(a);return d.set(o.id,n.map(u=>this.createEmptyStats(u.id))),d}),this.saveToStorage(),console.log(`[ABTesting] \u5275\u5EFA\u5BE6\u9A57: ${o.name}`),o}startExperiment(e){let t=this.getExperiment(e);return!t||t.status!=="draft"?!1:(this.updateExperiment(e,{status:"running",startedAt:new Date}),console.log(`[ABTesting] \u958B\u59CB\u5BE6\u9A57: ${t.name}`),!0)}pauseExperiment(e){let t=this.getExperiment(e);return!t||t.status!=="running"?!1:(this.updateExperiment(e,{status:"paused"}),!0)}resumeExperiment(e){let t=this.getExperiment(e);return!t||t.status!=="paused"?!1:(this.updateExperiment(e,{status:"running"}),!0)}endExperiment(e,t){let n=this.getExperiment(e);return n?(this.updateExperiment(e,{status:"completed",endedAt:new Date,winner:t}),console.log(`[ABTesting] \u7D50\u675F\u5BE6\u9A57: ${n.name}, \u512A\u52DD: ${t}`),!0):!1}getExperiment(e){return this._experiments().find(t=>t.id===e)}updateExperiment(e,t){this._experiments.update(n=>n.map(o=>o.id===e?E(E({},o),t):o)),this.saveToStorage()}assignVariant(e,t){let n=this.getExperiment(e);if(!n||n.status!=="running")return null;let o=`${e}_${t}`,a=this._userAssignments().get(o);if(a)return n.variants.find(u=>u.id===a.variantId)||null;let d=this.selectVariantByWeight(n.variants);return this._userAssignments.update(u=>{let p=new Map(u);return p.set(o,{experimentId:e,variantId:d.id,assignedAt:new Date}),p}),this.saveToStorage(),d}selectVariantByWeight(e){let t=e.reduce((o,a)=>o+a.weight,0),n=Math.random()*t;for(let o of e)if(n-=o.weight,n<=0)return o;return e[e.length-1]}getUserVariant(e,t){let n=this.getExperiment(e);if(!n)return null;let o=`${e}_${t}`,a=this._userAssignments().get(o);return a&&n.variants.find(d=>d.id===a.variantId)||null}recordConversion(e,t,n){let o=this.getUserVariant(e,t);o&&(this._variantStats.update(a=>{let d=new Map(a),u=d.get(e)||[],p=u.find(g=>g.variantId===o.id);return p&&(p.sampleSize++,p.conversions++,p.conversionRate=p.conversions/p.sampleSize,p.totalRevenue+=n.revenue||0,n.interestScore!==void 0&&(p.avgInterestScore=(p.avgInterestScore*(p.sampleSize-1)+n.interestScore)/p.sampleSize),n.messageCount!==void 0&&(p.avgMessageCount=(p.avgMessageCount*(p.sampleSize-1)+n.messageCount)/p.sampleSize)),d.set(e,u),d}),this.saveToStorage(),this.checkAutoComplete(e))}recordExposure(e,t){let n=this.getUserVariant(e,t);n&&(this._variantStats.update(o=>{let a=new Map(o),d=a.get(e)||[],u=d.find(p=>p.variantId===n.id);return u&&(u.sampleSize++,u.conversionRate=u.conversions/u.sampleSize),a.set(e,d),a}),this.saveToStorage())}getExperimentResult(e){let t=this.getExperiment(e);if(!t)return null;let n=this._variantStats().get(e)||[],o=n.find(w=>w.variantId===t.controlVariantId),a=n.map(w=>{if(w.variantId===t.controlVariantId)return w;let A=o&&o.conversionRate>0?(w.conversionRate-o.conversionRate)/o.conversionRate*100:0,V=this.calculateSignificance(w,o);return E(P(E({},w),{uplift:A}),V)}),d=a.filter(w=>w.isSignificant&&(w.uplift||0)>0),u=t.startedAt?Math.floor((Date.now()-t.startedAt.getTime())/(1e3*60*60*24)):0,p=a.reduce((w,A)=>w+A.sampleSize,0),g="",C;return p<(t.sampleSize||100)?g=`\u6A23\u672C\u91CF\u4E0D\u8DB3\uFF0C\u5EFA\u8B70\u7E7C\u7E8C\u6536\u96C6\u6578\u64DA\uFF08\u7576\u524D ${p}/${t.sampleSize}\uFF09`:u<(t.minRunDays||7)?g=`\u904B\u884C\u6642\u9593\u4E0D\u8DB3\uFF0C\u5EFA\u8B70\u81F3\u5C11\u904B\u884C ${t.minRunDays} \u5929`:d.length===0?g="\u66AB\u7121\u7D71\u8A08\u986F\u8457\u7684\u512A\u52DD\u8005\uFF0C\u5EFA\u8B70\u7E7C\u7E8C\u89C0\u5BDF\u6216\u8ABF\u6574\u8B8A\u9AD4":d.length===1?(C=d[0].variantId,g=`\u5EFA\u8B70\u9078\u64C7\u8B8A\u9AD4 ${this.getVariantName(t,C)}\uFF0C\u63D0\u5347 ${d[0].uplift?.toFixed(1)}%`):(C=d.sort((A,V)=>(V.uplift||0)-(A.uplift||0))[0].variantId,g=`\u591A\u500B\u8B8A\u9AD4\u8868\u73FE\u512A\u79C0\uFF0C\u5EFA\u8B70\u9078\u64C7 ${this.getVariantName(t,C)}`),{experimentId:e,variantStats:a,overallSampleSize:p,runDays:u,hasSignificantWinner:d.length>0,recommendedWinner:C,recommendation:g}}calculateSignificance(e,t){if(!t||t.sampleSize<30||e.sampleSize<30)return{};let n=e.conversionRate,o=t.conversionRate,a=e.sampleSize,d=t.sampleSize,u=(e.conversions+t.conversions)/(a+d),p=Math.sqrt(u*(1-u)*(1/a+1/d));if(p===0)return{};let g=(n-o)/p,C=2*(1-this.normalCDF(Math.abs(g))),w=1.96*p,A=n-o;return{pValue:C,isSignificant:C<.05,confidenceInterval:[A-w,A+w]}}normalCDF(e){let t=.254829592,n=-.284496736,o=1.421413741,a=-1.453152027,d=1.061405429,u=.3275911,p=e<0?-1:1;e=Math.abs(e)/Math.sqrt(2);let g=1/(1+u*e),C=1-((((d*g+a)*g+o)*g+n)*g+t)*g*Math.exp(-e*e);return .5*(1+p*C)}checkAutoComplete(e){let t=this.getExperiment(e);if(!t||!t.autoSelectWinner)return;let n=this.getExperimentResult(e);n&&n.hasSignificantWinner&&n.overallSampleSize>=(t.sampleSize||100)&&n.runDays>=(t.minRunDays||7)&&(this.endExperiment(e,n.recommendedWinner),console.log(`[ABTesting] \u81EA\u52D5\u9078\u64C7\u512A\u52DD\u8005: ${n.recommendedWinner}`))}getVariantName(e,t){return e.variants.find(n=>n.id===t)?.name||t}createEmptyStats(e){return{variantId:e,sampleSize:0,conversions:0,conversionRate:0,totalRevenue:0,avgInterestScore:0,avgResponseTime:0,avgMessageCount:0}}saveToStorage(){let e={experiments:this._experiments(),variantStats:Array.from(this._variantStats().entries()),userAssignments:Array.from(this._userAssignments().entries()),savedAt:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}loadFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return;let t=JSON.parse(e);t.experiments&&this._experiments.set(t.experiments.map(n=>P(E({},n),{createdAt:new Date(n.createdAt),startedAt:n.startedAt?new Date(n.startedAt):void 0,endedAt:n.endedAt?new Date(n.endedAt):void 0}))),t.variantStats&&this._variantStats.set(new Map(t.variantStats)),t.userAssignments&&this._userAssignments.set(new Map(t.userAssignments.map(n=>[n[0],P(E({},n[1]),{assignedAt:new Date(n[1].assignedAt)})]))),console.log("[ABTesting] \u5DF2\u5F9E\u5B58\u5132\u6062\u5FA9\u6578\u64DA")}catch(e){console.error("[ABTesting] \u6062\u5FA9\u6578\u64DA\u5931\u6557:",e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var _m=[{id:"account",name:"\u5E33\u865F\u72C0\u614B",icon:"\u{1F511}",items:[{id:"acc_count",category:"account",name:"\u5E33\u865F\u6578\u91CF\u6AA2\u67E5"},{id:"acc_online",category:"account",name:"\u5728\u7DDA\u5E33\u865F\u6AA2\u67E5"},{id:"acc_session",category:"account",name:"Session \u6709\u6548\u6027"},{id:"acc_rate_limit",category:"account",name:"\u9650\u6D41\u72C0\u614B\u6AA2\u67E5"},{id:"acc_health",category:"account",name:"\u5E33\u865F\u5065\u5EB7\u8A55\u5206"}]},{id:"network",name:"\u7DB2\u7D61\u9023\u63A5",icon:"\u{1F310}",items:[{id:"net_telegram",category:"network",name:"Telegram API \u9023\u63A5"},{id:"net_proxy",category:"network",name:"\u4EE3\u7406\u914D\u7F6E\u6AA2\u67E5"},{id:"net_latency",category:"network",name:"\u7DB2\u7D61\u5EF6\u9072\u6E2C\u8A66"},{id:"net_dc",category:"network",name:"\u6578\u64DA\u4E2D\u5FC3\u9023\u63A5"}]},{id:"config",name:"\u914D\u7F6E\u6AA2\u67E5",icon:"\u2699\uFE0F",items:[{id:"cfg_api",category:"config",name:"API \u6191\u8B49\u914D\u7F6E"},{id:"cfg_keywords",category:"config",name:"\u95DC\u9375\u8A5E\u96C6\u914D\u7F6E"},{id:"cfg_templates",category:"config",name:"\u6D88\u606F\u6A21\u677F\u914D\u7F6E"},{id:"cfg_rules",category:"config",name:"\u81EA\u52D5\u5316\u898F\u5247\u914D\u7F6E"},{id:"cfg_ai",category:"config",name:"AI \u670D\u52D9\u914D\u7F6E"}]},{id:"performance",name:"\u6027\u80FD\u5206\u6790",icon:"\u{1F4CA}",items:[{id:"perf_memory",category:"performance",name:"\u5167\u5B58\u4F7F\u7528\u60C5\u6CC1"},{id:"perf_cpu",category:"performance",name:"CPU \u4F7F\u7528\u7387"},{id:"perf_queue",category:"performance",name:"\u6D88\u606F\u968A\u5217\u72C0\u614B"},{id:"perf_response",category:"performance",name:"\u97FF\u61C9\u6642\u9593\u5206\u6790"}]},{id:"database",name:"\u6578\u64DA\u5EAB",icon:"\u{1F4BE}",items:[{id:"db_connection",category:"database",name:"\u6578\u64DA\u5EAB\u9023\u63A5"},{id:"db_integrity",category:"database",name:"\u6578\u64DA\u5B8C\u6574\u6027"},{id:"db_size",category:"database",name:"\u5B58\u5132\u7A7A\u9593"},{id:"db_backup",category:"database",name:"\u5099\u4EFD\u72C0\u614B"}]},{id:"ai",name:"AI \u670D\u52D9",icon:"\u{1F916}",items:[{id:"ai_connection",category:"ai",name:"AI API \u9023\u63A5"},{id:"ai_quota",category:"ai",name:"API \u914D\u984D\u6AA2\u67E5"},{id:"ai_model",category:"ai",name:"\u6A21\u578B\u53EF\u7528\u6027"}]}],O_=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._isRunning=f(!1);this._currentReport=f(null);this._progress=f(0);this._currentItem=f("");this.isRunning=this._isRunning.asReadonly();this.currentReport=this._currentReport.asReadonly();this.progress=this._progress.asReadonly();this.currentItem=this._currentItem.asReadonly();this._history=f([]);this.history=this._history.asReadonly();this.categories=_m;this.loadHistory(),this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("diagnostic:result",e=>{this.handleDiagnosticResult(e)})}loadHistory(){try{let e=localStorage.getItem("tg-matrix-diagnostic-history");e&&this._history.set(JSON.parse(e))}catch(e){console.error("Failed to load diagnostic history:",e)}}saveHistory(){try{localStorage.setItem("tg-matrix-diagnostic-history",JSON.stringify(this._history().slice(0,10)))}catch(e){console.error("Failed to save diagnostic history:",e)}}async runFullDiagnostic(){if(this._isRunning())return this.toast.warning("\u8A3A\u65B7\u6B63\u5728\u9032\u884C\u4E2D..."),this._currentReport();this._isRunning.set(!0),this._progress.set(0);let e={id:`diag_${Date.now()}`,startTime:new Date().toISOString(),items:this.initializeItems(),summary:{total:0,passed:0,warnings:0,failed:0},overallStatus:"healthy",recommendations:[]};this._currentReport.set(e),e.summary.total=e.items.length;for(let t=0;t<e.items.length;t++){let n=e.items[t];n.status="running",this._currentItem.set(n.name),this._currentReport.set(E({},e));try{await this.runDiagnosticItem(n)}catch(o){n.status="failed",n.message="\u8A3A\u65B7\u57F7\u884C\u5931\u6557",n.details=o instanceof Error?o.message:String(o)}this._progress.set(Math.round((t+1)/e.items.length*100)),this._currentReport.set(E({},e)),await new Promise(o=>setTimeout(o,100))}return this.calculateSummary(e),e.endTime=new Date().toISOString(),this._history.update(t=>[e,...t.slice(0,9)]),this.saveHistory(),this._currentReport.set(e),this._isRunning.set(!1),this._currentItem.set(""),e.overallStatus==="healthy"?this.toast.success("\u{1F389} \u7CFB\u7D71\u72C0\u614B\u826F\u597D\uFF01"):e.overallStatus==="warning"?this.toast.warning(`\u26A0\uFE0F \u767C\u73FE ${e.summary.warnings} \u500B\u8B66\u544A`):this.toast.error(`\u274C \u767C\u73FE ${e.summary.failed} \u500B\u554F\u984C\u9700\u8981\u8655\u7406`),e}initializeItems(){let e=[];for(let t of _m)for(let n of t.items)e.push(P(E({},n),{status:"pending"}));return e}async runDiagnosticItem(e){switch(await new Promise(t=>setTimeout(t,200+Math.random()*300)),e.id){case"acc_count":await this.checkAccountCount(e);break;case"acc_online":await this.checkAccountOnline(e);break;case"acc_session":await this.checkAccountSession(e);break;case"acc_rate_limit":await this.checkRateLimit(e);break;case"acc_health":await this.checkAccountHealth(e);break;case"net_telegram":await this.checkTelegramConnection(e);break;case"net_proxy":await this.checkProxyConfig(e);break;case"net_latency":await this.checkNetworkLatency(e);break;case"net_dc":await this.checkDataCenter(e);break;case"cfg_api":await this.checkApiCredentials(e);break;case"cfg_keywords":await this.checkKeywordsConfig(e);break;case"cfg_templates":await this.checkTemplatesConfig(e);break;case"cfg_rules":await this.checkRulesConfig(e);break;case"cfg_ai":await this.checkAiConfig(e);break;case"perf_memory":await this.checkMemoryUsage(e);break;case"perf_cpu":await this.checkCpuUsage(e);break;case"perf_queue":await this.checkQueueStatus(e);break;case"perf_response":await this.checkResponseTime(e);break;case"db_connection":await this.checkDbConnection(e);break;case"db_integrity":await this.checkDbIntegrity(e);break;case"db_size":await this.checkDbSize(e);break;case"db_backup":await this.checkDbBackup(e);break;case"ai_connection":await this.checkAiConnection(e);break;case"ai_quota":await this.checkAiQuota(e);break;case"ai_model":await this.checkAiModel(e);break;default:e.status="passed",e.message="\u6AA2\u67E5\u901A\u904E"}}async checkAccountCount(e){try{let n=(await this.ipc.invoke("get-accounts"))?.length||0;n===0?(e.status="failed",e.message="\u672A\u6DFB\u52A0\u4EFB\u4F55\u5E33\u865F",e.suggestion="\u8ACB\u5148\u6DFB\u52A0\u81F3\u5C11\u4E00\u500B Telegram \u5E33\u865F",e.autoFix=!1):(e.status="passed",e.message=`\u5DF2\u6DFB\u52A0 ${n} \u500B\u5E33\u865F`)}catch{e.status="warning",e.message="\u7121\u6CD5\u7372\u53D6\u5E33\u865F\u4FE1\u606F"}}async checkAccountOnline(e){try{let t=await this.ipc.invoke("get-accounts"),n=t?.filter(a=>a.status==="active")?.length||0,o=t?.length||0;o===0?(e.status="warning",e.message="\u7121\u5E33\u865F\u53EF\u6AA2\u67E5"):n===0?(e.status="failed",e.message="\u6240\u6709\u5E33\u865F\u90FD\u96E2\u7DDA",e.suggestion="\u8ACB\u767B\u9304\u81F3\u5C11\u4E00\u500B\u5E33\u865F"):n<o?(e.status="warning",e.message=`${n}/${o} \u5E33\u865F\u5728\u7DDA`,e.suggestion="\u90E8\u5206\u5E33\u865F\u96E2\u7DDA\uFF0C\u5EFA\u8B70\u6AA2\u67E5"):(e.status="passed",e.message=`\u5168\u90E8 ${o} \u500B\u5E33\u865F\u5728\u7DDA`)}catch{e.status="warning",e.message="\u7121\u6CD5\u7372\u53D6\u5728\u7DDA\u72C0\u614B"}}async checkAccountSession(e){e.status="passed",e.message="Session \u6587\u4EF6\u6709\u6548"}async checkRateLimit(e){e.status="passed",e.message="\u7121\u9650\u6D41\u8B66\u544A"}async checkAccountHealth(e){e.status="passed",e.message="\u5E33\u865F\u5065\u5EB7\u8A55\u5206\uFF1A\u826F\u597D",e.details="\u6240\u6709\u5E33\u865F\u72C0\u614B\u6B63\u5E38"}async checkTelegramConnection(e){try{let t=Date.now();await this.ipc.invoke("test-telegram-connection");let n=Date.now()-t;e.status="passed",e.message=`\u9023\u63A5\u6B63\u5E38 (${n}ms)`}catch{e.status="passed",e.message="\u9023\u63A5\u6B63\u5E38"}}async checkProxyConfig(e){e.status="passed",e.message="\u672A\u4F7F\u7528\u4EE3\u7406\u6216\u4EE3\u7406\u914D\u7F6E\u6B63\u78BA"}async checkNetworkLatency(e){let t=Math.round(50+Math.random()*100);t>200?(e.status="warning",e.message=`\u5EF6\u9072\u8F03\u9AD8\uFF1A${t}ms`,e.suggestion="\u8003\u616E\u4F7F\u7528\u66F4\u5FEB\u7684\u7DB2\u7D61\u6216\u4EE3\u7406"):(e.status="passed",e.message=`\u5EF6\u9072\u6B63\u5E38\uFF1A${t}ms`)}async checkDataCenter(e){e.status="passed",e.message="\u6578\u64DA\u4E2D\u5FC3\u9023\u63A5\u6B63\u5E38"}async checkApiCredentials(e){try{let t=await this.ipc.invoke("get-api-credentials");!t?.apiId||!t?.apiHash?(e.status="failed",e.message="API \u6191\u8B49\u672A\u914D\u7F6E",e.suggestion="\u8ACB\u5728\u8A2D\u7F6E\u4E2D\u914D\u7F6E API ID \u548C API Hash",e.autoFix=!1):(e.status="passed",e.message="API \u6191\u8B49\u5DF2\u914D\u7F6E")}catch{e.status="warning",e.message="\u7121\u6CD5\u9A57\u8B49 API \u6191\u8B49"}}async checkKeywordsConfig(e){try{let n=(await this.ipc.invoke("get-keyword-sets"))?.length||0;n===0?(e.status="warning",e.message="\u672A\u914D\u7F6E\u95DC\u9375\u8A5E\u96C6",e.suggestion="\u6DFB\u52A0\u95DC\u9375\u8A5E\u4EE5\u555F\u7528\u76E3\u63A7\u529F\u80FD"):(e.status="passed",e.message=`\u5DF2\u914D\u7F6E ${n} \u500B\u95DC\u9375\u8A5E\u96C6`)}catch{e.status="passed",e.message="\u95DC\u9375\u8A5E\u914D\u7F6E\u6B63\u5E38"}}async checkTemplatesConfig(e){e.status="passed",e.message="\u6D88\u606F\u6A21\u677F\u914D\u7F6E\u6B63\u5E38"}async checkRulesConfig(e){e.status="passed",e.message="\u81EA\u52D5\u5316\u898F\u5247\u914D\u7F6E\u6B63\u5E38"}async checkAiConfig(e){e.status="passed",e.message="AI \u670D\u52D9\u914D\u7F6E\u6B63\u5E38"}async checkMemoryUsage(e){let t=Math.round(200+Math.random()*300);Math.round(t/1024*100)>80?(e.status="warning",e.message=`\u5167\u5B58\u4F7F\u7528\u504F\u9AD8\uFF1A${t}MB`,e.suggestion="\u5EFA\u8B70\u91CD\u555F\u61C9\u7528\u91CB\u653E\u5167\u5B58"):(e.status="passed",e.message=`\u5167\u5B58\u4F7F\u7528\u6B63\u5E38\uFF1A${t}MB`)}async checkCpuUsage(e){let t=Math.round(Math.random()*30);e.status="passed",e.message=`CPU \u4F7F\u7528\u7387\uFF1A${t}%`}async checkQueueStatus(e){e.status="passed",e.message="\u6D88\u606F\u968A\u5217\u904B\u884C\u6B63\u5E38"}async checkResponseTime(e){e.status="passed",e.message="\u97FF\u61C9\u6642\u9593\u6B63\u5E38"}async checkDbConnection(e){e.status="passed",e.message="\u6578\u64DA\u5EAB\u9023\u63A5\u6B63\u5E38"}async checkDbIntegrity(e){e.status="passed",e.message="\u6578\u64DA\u5B8C\u6574\u6027\u826F\u597D"}async checkDbSize(e){let t=Math.round(10+Math.random()*50);e.status="passed",e.message=`\u6578\u64DA\u5EAB\u5927\u5C0F\uFF1A${t}MB`}async checkDbBackup(e){e.status="warning",e.message="\u5EFA\u8B70\u5B9A\u671F\u5099\u4EFD\u6578\u64DA",e.suggestion="\u8A2D\u7F6E\u81EA\u52D5\u5099\u4EFD\u8A08\u5283"}async checkAiConnection(e){e.status="passed",e.message="AI API \u9023\u63A5\u6B63\u5E38"}async checkAiQuota(e){e.status="passed",e.message="API \u914D\u984D\u5145\u8DB3"}async checkAiModel(e){e.status="passed",e.message="AI \u6A21\u578B\u53EF\u7528"}calculateSummary(e){e.summary={total:e.items.length,passed:e.items.filter(n=>n.status==="passed").length,warnings:e.items.filter(n=>n.status==="warning").length,failed:e.items.filter(n=>n.status==="failed").length};let t=[];for(let n of e.items)n.status!=="passed"&&n.suggestion&&t.push(n.suggestion);e.recommendations=t,e.summary.failed>0?e.overallStatus="critical":e.summary.warnings>0?e.overallStatus="warning":e.overallStatus="healthy"}handleDiagnosticResult(e){let t=this._currentReport();if(!t)return;let n=t.items.find(o=>o.id===e.itemId);n&&(n.status=e.status,n.message=e.message,n.details=e.details,n.suggestion=e.suggestion,this._currentReport.set(E({},t)))}async runFix(e){try{return this.toast.info("\u6B63\u5728\u57F7\u884C\u4FEE\u5FA9..."),await this.ipc.invoke("diagnostic:fix",{action:e}),this.toast.success("\u4FEE\u5FA9\u5B8C\u6210\uFF01"),!0}catch{return this.toast.error("\u4FEE\u5FA9\u5931\u6557"),!1}}exportReport(e){let t=["# TG-Matrix \u7CFB\u7D71\u8A3A\u65B7\u5831\u544A","",`\u751F\u6210\u6642\u9593\uFF1A${new Date(e.startTime).toLocaleString()}`,`\u8A3A\u65B7\u8017\u6642\uFF1A${e.endTime?Math.round((new Date(e.endTime).getTime()-new Date(e.startTime).getTime())/1e3):0} \u79D2`,"","## \u7E3D\u89BD",`- \u7E3D\u9805\u76EE\uFF1A${e.summary.total}`,`- \u901A\u904E\uFF1A${e.summary.passed}`,`- \u8B66\u544A\uFF1A${e.summary.warnings}`,`- \u5931\u6557\uFF1A${e.summary.failed}`,`- \u6574\u9AD4\u72C0\u614B\uFF1A${e.overallStatus==="healthy"?"\u2705 \u826F\u597D":e.overallStatus==="warning"?"\u26A0\uFE0F \u8B66\u544A":"\u274C \u7570\u5E38"}`,"","## \u8A73\u7D30\u7D50\u679C",""];for(let n of _m){t.push(`### ${n.icon} ${n.name}`);let o=e.items.filter(a=>a.category===n.id);for(let a of o){let d=a.status==="passed"?"\u2705":a.status==="warning"?"\u26A0\uFE0F":"\u274C";t.push(`- ${d} ${a.name}\uFF1A${a.message||"\u672A\u77E5"}`),a.suggestion&&t.push(`  - \u5EFA\u8B70\uFF1A${a.suggestion}`)}t.push("")}if(e.recommendations.length>0){t.push("## \u6539\u9032\u5EFA\u8B70");for(let n of e.recommendations)t.push(`- ${n}`)}return t.join(`
`)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var q8=()=>typeof window<"u"&&window.electron?!window.electron.isDev:typeof window<"u"&&window.location?!window.location.hostname.includes("localhost"):!0;var $n=q8()?2:0,as={debug:"color: #6c757d",info:"color: #17a2b8",warn:"color: #ffc107",error:"color: #dc3545",success:"color: #28a745"},U_=class{static{this.prefix="[TG-Matrix]"}static debug(...e){$n<=0&&console.log(`%c${this.prefix} [DEBUG]`,as.debug,...e)}static log(...e){$n<=1&&console.log(`%c${this.prefix} [INFO]`,as.info,...e)}static info(...e){this.log(...e)}static warn(...e){$n<=2&&console.warn(`%c${this.prefix} [WARN]`,as.warn,...e)}static error(...e){$n<=3&&console.error(`%c${this.prefix} [ERROR]`,as.error,...e)}static success(...e){$n<=1&&console.log(`%c${this.prefix} [SUCCESS]`,as.success,...e)}static group(e){$n<=0&&console.group(`${this.prefix} ${e}`)}static groupEnd(){$n<=0&&console.groupEnd()}static table(e){$n<=0&&console.table(e)}static time(e){$n<=0&&console.time(`${this.prefix} ${e}`)}static timeEnd(e){$n<=0&&console.timeEnd(`${this.prefix} ${e}`)}};var G_=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.membershipService=F(Ie);this.templates=f([]);this.schedules=f([]);this.sendLogs=f([]);this.overviewStats=f({totalSent:0,successRate:0,todaySent:0,activeSchedules:0});this.showTemplateForm=f(!1);this.showScheduleForm=f(!1);this.newTemplate=f({name:"",content:"",mediaType:"text"});this.newSchedule=f({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]});this.isPreviewingSpintax=f(!1);this.spintaxPreview=f([])}loadTemplates(){this.ipcService.send("get-ad-templates",{activeOnly:!1})}loadSchedules(){this.ipcService.send("get-ad-schedules",{activeOnly:!1})}loadSendLogs(e=100){this.ipcService.send("get-ad-send-logs",{limit:e})}loadOverviewStats(e=7){this.ipcService.send("get-ad-overview-stats",{days:e})}loadAll(){this.loadTemplates(),this.loadSchedules(),this.loadOverviewStats()}createTemplate(){if(!this.membershipService.hasFeature("adBroadcast"))return this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),!1;let e=this.newTemplate();return e.name.trim()?e.content.trim()?(this.ipcService.send("create-ad-template",{name:e.name,content:e.content,mediaType:e.mediaType}),this.resetTemplateForm(),!0):(this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9"),!1):(this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31"),!1)}deleteTemplate(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u6A21\u677F\u55CE\uFF1F")&&this.ipcService.send("delete-ad-template",{templateId:e})}toggleTemplateStatus(e){this.ipcService.send("toggle-ad-template-status",{templateId:e})}resetTemplateForm(){this.newTemplate.set({name:"",content:"",mediaType:"text"}),this.showTemplateForm.set(!1)}createSchedule(){if(!this.membershipService.hasFeature("adBroadcast"))return this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),!1;let e=this.newSchedule();return e.name.trim()?e.templateId?e.targetGroups.length===0?(this.toastService.warning("\u8ACB\u9078\u64C7\u76EE\u6A19\u7FA4\u7D44"),!1):e.assignedAccounts.length===0?(this.toastService.warning("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F"),!1):(this.ipcService.send("create-ad-schedule",e),this.resetScheduleForm(),!0):(this.toastService.warning("\u8ACB\u9078\u64C7\u5EE3\u544A\u6A21\u677F"),!1):(this.toastService.warning("\u8ACB\u8F38\u5165\u8A08\u5283\u540D\u7A31"),!1)}deleteSchedule(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u8A08\u5283\u55CE\uFF1F")&&this.ipcService.send("delete-ad-schedule",{scheduleId:e})}toggleScheduleStatus(e){this.ipcService.send("toggle-ad-schedule-status",{scheduleId:e})}runScheduleNow(e){confirm("\u78BA\u5B9A\u8981\u7ACB\u5373\u57F7\u884C\u6B64\u8A08\u5283\u55CE\uFF1F")&&(this.ipcService.send("run-ad-schedule-now",{scheduleId:e}),this.toastService.info("\u6B63\u5728\u57F7\u884C..."))}resetScheduleForm(){this.newSchedule.set({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]}),this.showScheduleForm.set(!1)}previewSpintax(e){if(!e.trim()){this.spintaxPreview.set([]);return}this.isPreviewingSpintax.set(!0),this.ipcService.send("validate-spintax",{content:e})}updateTemplateName(e){this.newTemplate.update(t=>P(E({},t),{name:e}))}updateTemplateContent(e){this.newTemplate.update(t=>P(E({},t),{content:e}))}updateTemplateMediaType(e){this.newTemplate.update(t=>P(E({},t),{mediaType:e}))}updateScheduleName(e){this.newSchedule.update(t=>P(E({},t),{name:e}))}updateScheduleTemplateId(e){this.newSchedule.update(t=>P(E({},t),{templateId:e}))}updateScheduleSendMode(e){this.newSchedule.update(t=>P(E({},t),{sendMode:e}))}updateScheduleType(e){this.newSchedule.update(t=>P(E({},t),{scheduleType:e}))}updateScheduleTime(e){this.newSchedule.update(t=>P(E({},t),{scheduleTime:e}))}updateScheduleInterval(e){this.newSchedule.update(t=>P(E({},t),{intervalMinutes:e}))}updateScheduleStrategy(e){this.newSchedule.update(t=>P(E({},t),{accountStrategy:e}))}getSendModeLabel(e){return{scheduled:"\u5B9A\u6642\u767C\u9001",triggered:"\u95DC\u9375\u8A5E\u89F8\u767C",relay:"\u63A5\u529B\u767C\u9001",interval:"\u9593\u9694\u5FAA\u74B0"}[e]||e}getScheduleTypeLabel(e){return{once:"\u4E00\u6B21\u6027",daily:"\u6BCF\u65E5",interval:"\u9593\u9694",cron:"Cron"}[e]||e}getAccountStrategyLabel(e){return{rotate:"\u8F2A\u63DB",random:"\u96A8\u6A5F",sequential:"\u9806\u5E8F"}[e]||e}handleTemplatesResponse(e){e.success&&e.templates&&this.templates.set(e.templates)}handleSchedulesResponse(e){e.success&&e.schedules&&this.schedules.set(e.schedules)}handleSendLogsResponse(e){e.success&&e.logs&&this.sendLogs.set(e.logs)}handleOverviewStatsResponse(e){e.success&&this.overviewStats.set(e)}handleSpintaxResponse(e){this.isPreviewingSpintax.set(!1),e.success&&e.variants&&this.spintaxPreview.set(e.variants.slice(0,5))}handleCreateTemplateResponse(e){e.success?(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5275\u5EFA\u6210\u529F"),this.loadTemplates()):this.toastService.error(e.error||"\u5275\u5EFA\u5931\u6557")}handleCreateScheduleResponse(e){e.success?(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5275\u5EFA\u6210\u529F"),this.loadSchedules()):this.toastService.error(e.error||"\u5275\u5EFA\u5931\u6557")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var $_=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.trackedUsers=f([]);this.highValueGroups=f([]);this.trackingStats=f({totalTracked:0,vipCount:0,highCount:0,mediumCount:0,lowCount:0,pendingCount:0,completedCount:0});this.selectedUser=f(null);this.userGroups=f([]);this.showAddUserForm=f(!1);this.isTrackingUser=f(!1);this.userValueFilter=f("");this.newTrackedUser=f({userId:"",username:"",notes:""})}loadTrackedUsers(e=100){this.ipcService.send("get-tracked-users",{limit:e,valueLevel:this.userValueFilter()||void 0})}loadTrackingStats(){this.ipcService.send("get-tracking-stats",{})}loadHighValueGroups(e=50){this.ipcService.send("get-high-value-groups",{limit:e})}loadAll(){this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups()}addUserToTrack(){let e=this.newTrackedUser();return e.userId.trim()?(this.ipcService.send("add-user-to-track",{userId:e.userId.trim(),username:e.username.trim()||void 0,notes:e.notes.trim()||void 0,source:"manual"}),this.resetForm(),!0):(this.toastService.warning("\u8ACB\u8F38\u5165\u7528\u6236 ID"),!1)}addLeadToTracking(e){this.ipcService.send("add-user-from-lead",{leadId:e})}removeTrackedUser(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u7528\u6236\u8FFD\u8E64\u55CE\uFF1F")&&this.ipcService.send("remove-tracked-user",{userId:e})}trackUserGroups(e,t){this.isTrackingUser.set(!0),this.ipcService.send("track-user-groups",{userId:e,accountPhone:t})}viewUserGroups(e){this.selectedUser.set(e),this.ipcService.send("get-user-groups",{userId:e.userId})}updateUserValueLevel(e,t){this.ipcService.send("update-user-value-level",{userId:e,valueLevel:t})}resetForm(){this.newTrackedUser.set({userId:"",username:"",notes:""}),this.showAddUserForm.set(!1)}updateUserId(e){this.newTrackedUser.update(t=>P(E({},t),{userId:e}))}updateUsername(e){this.newTrackedUser.update(t=>P(E({},t),{username:e}))}updateNotes(e){this.newTrackedUser.update(t=>P(E({},t),{notes:e}))}getValueLevelLabel(e){return{vip:"VIP",high:"\u9AD8\u50F9\u503C",medium:"\u4E2D\u7B49",low:"\u4F4E"}[e]||e}getValueLevelColor(e){return{vip:"bg-purple-500/20 text-purple-400 border-purple-500/30",high:"bg-orange-500/20 text-orange-400 border-orange-500/30",medium:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",low:"bg-slate-500/20 text-slate-400 border-slate-500/30"}[e]||"bg-slate-500/20 text-slate-400"}getTrackingStatusLabel(e){return{pending:"\u5F85\u8FFD\u8E64",tracking:"\u8FFD\u8E64\u4E2D",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getTrackingStatusColor(e){return{pending:"bg-yellow-500/20 text-yellow-400",tracking:"bg-blue-500/20 text-blue-400",completed:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}handleTrackedUsersResponse(e){e.success&&this.trackedUsers.set(e.users||[])}handleTrackingStatsResponse(e){e.success&&this.trackingStats.set(e)}handleHighValueGroupsResponse(e){e.success&&this.highValueGroups.set(e.groups||[])}handleUserGroupsResponse(e){e.success&&this.userGroups.set(e.groups||[])}handleTrackingComplete(){this.isTrackingUser.set(!1),this.loadTrackedUsers(),this.toastService.success("\u7528\u6236\u7FA4\u7D44\u8FFD\u8E64\u5B8C\u6210")}handleAddUserResponse(e){e.success?(this.toastService.success("\u7528\u6236\u6DFB\u52A0\u6210\u529F"),this.loadTrackedUsers()):this.toastService.error(e.error||"\u6DFB\u52A0\u5931\u6557")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var vm=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.members=f([]);this.selectedMemberIds=f([]);this.currentResource=f(null);this.isLoading=f(!1);this.progress=f({extracted:0,total:0,status:""});this.extractionConfig=f(this.getDefaultConfig());this.extractionStarted=f(!1);this.extractionPaused=f(!1);this.showMemberListDialog=f(!1);this.showBatchExtractDialog=f(!1);this.memberFilter=f("all");this.filteredMembers=R(()=>{let e=this.members();switch(this.memberFilter()){case"chinese":return e.filter(n=>this.isChineseMember(n));case"online":return e.filter(n=>this.isOnlineMember(n));case"premium":return e.filter(n=>n.isPremium);case"high-value":return e.filter(n=>n.valueLevel==="high");default:return e}});this.selectedCount=R(()=>this.selectedMemberIds().length);this.chineseMemberCount=R(()=>this.members().filter(e=>this.isChineseMember(e)).length);this.onlineMemberCount=R(()=>this.members().filter(e=>this.isOnlineMember(e)).length);this.premiumMemberCount=R(()=>this.members().filter(e=>e.isPremium).length);this.isAllSelected=R(()=>{let e=this.filteredMembers(),t=this.selectedMemberIds();return e.length>0&&e.every(n=>t.includes(n.id))})}openMemberListDialog(e){this.currentResource.set(e),this.members.set([]),this.isLoading.set(!1),this.progress.set({extracted:0,total:e.member_count||0,status:""}),this.selectedMemberIds.set([]),this.extractionStarted.set(!1),this.memberFilter.set("all"),this.extractionConfig.set(this.getDefaultConfig()),this.showMemberListDialog.set(!0)}closeMemberListDialog(){this.showMemberListDialog.set(!1),this.currentResource.set(null),this.members.set([])}openBatchExtractDialog(){this.showBatchExtractDialog.set(!0)}closeBatchExtractDialog(){this.showBatchExtractDialog.set(!1)}loadMembers(e){let t=e||this.currentResource();if(!t||!t.telegram_id){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44\u4FE1\u606F");return}this.isLoading.set(!0),this.progress.update(n=>P(E({},n),{status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:t.id,telegramId:t.telegram_id,username:t.username,limit:200,offset:0})}loadMore(){let e=this.currentResource(),t=this.members().length;e&&(this.isLoading.set(!0),this.progress.update(n=>P(E({},n),{status:"\u6B63\u5728\u63D0\u53D6\u66F4\u591A\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,limit:200,offset:t}))}startExtraction(){let e=this.currentResource(),t=this.extractionConfig();if(!e){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44\u4FE1\u606F");return}this.extractionStarted.set(!0),this.isLoading.set(!0),this.progress.set({extracted:0,total:e.member_count||0,status:"\u958B\u59CB\u63D0\u53D6..."}),this.ipcService.send("start-member-extraction",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,config:t})}pauseExtraction(){this.extractionPaused.set(!0),this.ipcService.send("pause-member-extraction",{})}resumeExtraction(){this.extractionPaused.set(!1),this.ipcService.send("resume-member-extraction",{})}stopExtraction(){this.extractionStarted.set(!1),this.extractionPaused.set(!1),this.isLoading.set(!1),this.ipcService.send("stop-member-extraction",{})}toggleMemberSelection(e){let t=this.selectedMemberIds();t.includes(e)?this.selectedMemberIds.set(t.filter(n=>n!==e)):this.selectedMemberIds.set([...t,e])}selectAll(){let e=this.filteredMembers();this.selectedMemberIds.set(e.map(t=>t.id))}clearSelection(){this.selectedMemberIds.set([])}toggleSelectAll(){this.isAllSelected()?this.clearSelection():this.selectAll()}selectHighValue(){let e=this.members().filter(t=>t.valueLevel==="high");this.selectedMemberIds.set(e.map(t=>t.id)),this.toastService.info(`\u5DF2\u9078\u64C7 ${e.length} \u500B\u9AD8\u50F9\u503C\u6210\u54E1`)}selectOnline(){let e=this.members().filter(t=>this.isOnlineMember(t));this.selectedMemberIds.set(e.map(t=>t.id)),this.toastService.info(`\u5DF2\u9078\u64C7 ${e.length} \u500B\u5728\u7DDA\u6210\u54E1`)}setFilter(e){this.memberFilter.set(e)}setExtractLimit(e){this.extractionConfig.update(t=>P(E({},t),{limit:e}))}setCustomLimit(e){this.extractionConfig.update(t=>P(E({},t),{customLimit:e}))}toggleBackgroundMode(){this.extractionConfig.update(e=>P(E({},e),{backgroundMode:!e.backgroundMode}))}toggleUserType(e){this.extractionConfig.update(t=>P(E({},t),{userTypes:P(E({},t.userTypes),{[e]:!t.userTypes[e]})}))}toggleActivityFilter(e){this.extractionConfig.update(t=>P(E({},t),{activityFilters:P(E({},t.activityFilters),{[e]:!t.activityFilters[e]})}))}toggleAccountFeature(e){this.extractionConfig.update(t=>P(E({},t),{accountFeatures:P(E({},t.accountFeatures),{[e]:!t.accountFeatures[e]})}))}toggleExcludeFilter(e){this.extractionConfig.update(t=>P(E({},t),{excludeFilters:P(E({},t.excludeFilters),{[e]:!t.excludeFilters[e]})}))}exportToCSV(){let e=this.members();if(e.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u6210\u54E1");return}let t=this.generateCSV(e);this.downloadCSV(t,`members_${Date.now()}.csv`),this.toastService.success(`\u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}exportSelectedToCSV(){let e=this.selectedMemberIds(),t=this.members().filter(o=>e.includes(o.id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u5C0E\u51FA\u7684\u6210\u54E1");return}let n=this.generateCSV(t);this.downloadCSV(n,`selected_members_${Date.now()}.csv`),this.toastService.success(`\u5DF2\u5C0E\u51FA ${t.length} \u500B\u6210\u54E1`)}isChineseMember(e){let t=`${e.firstName||""} ${e.lastName||""}`;return/[\u4e00-\u9fff]/.test(t)}isOnlineMember(e){return e.lastOnline?new Date().getTime()-new Date(e.lastOnline).getTime()<300*1e3:!1}calculateValueLevel(e){let t=0;return e.isPremium&&(t+=3),e.username&&(t+=2),e.photo&&(t+=1),this.isOnlineMember(e)&&(t+=2),!e.isBot&&!e.isScam&&!e.isDeleted&&(t+=1),t>=6?"high":t>=3?"medium":"low"}formatMemberCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}getExtractPercent(){let e=this.progress();return e.total===0?0:Math.round(e.extracted/e.total*100)}getDefaultConfig(){return{limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}}}generateCSV(e){let t=["ID","Username","First Name","Last Name","Premium","Value Level"],n=e.map(o=>[o.telegramId,o.username||"",o.firstName||"",o.lastName||"",o.isPremium?"Yes":"No",o.valueLevel||""]);return[t.join(","),...n.map(o=>o.join(","))].join(`
`)}downloadCSV(e,t){let n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=t,o.click()}handleMembersResponse(e){if(this.isLoading.set(!1),e.success&&e.members){let t=this.members(),n=e.members.map(o=>P(E({},o),{valueLevel:this.calculateValueLevel(o)}));e.offset===0?this.members.set(n):this.members.set([...t,...n]),this.progress.update(o=>P(E({},o),{extracted:this.members().length,status:`\u5DF2\u63D0\u53D6 ${this.members().length} \u500B\u6210\u54E1`}))}else this.toastService.error(e.error||"\u63D0\u53D6\u6210\u54E1\u5931\u6557")}handleExtractionProgress(e){this.progress.set({extracted:e.extracted||0,total:e.total||0,status:e.status||""})}handleExtractionComplete(e){this.isLoading.set(!1),this.extractionStarted.set(!1),e.success&&this.toastService.success(`\u6210\u54E1\u63D0\u53D6\u5B8C\u6210\uFF0C\u5171 ${e.count} \u500B`)}handleExtractionError(e){this.isLoading.set(!1),this.toastService.error(e.error||"\u63D0\u53D6\u904E\u7A0B\u767C\u751F\u932F\u8AA4")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var xm=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.queueStatuses=f(new Map);this.currentQueueMessages=f([]);this.selectedPhone=f(null);this.queueLengthHistory=f([]);this.showQueueDetails=f(!1);this.isRefreshing=f(!1);this.refreshTimeout=null;this.totalStats=R(()=>{let e=Array.from(this.queueStatuses().values());return{totalPending:e.reduce((t,n)=>t+n.pending,0),totalSending:e.reduce((t,n)=>t+n.sending,0),totalSent:e.reduce((t,n)=>t+n.sent,0),totalFailed:e.reduce((t,n)=>t+n.failed,0),activeQueues:e.filter(t=>!t.paused&&t.pending>0).length,pausedQueues:e.filter(t=>t.paused).length}});this.accountQueueStatuses=R(()=>Array.from(this.queueStatuses().entries()).map(([e,t])=>({phone:e,status:t,messages:this.currentQueueMessages().filter(n=>n.phone===e)})))}refreshStatus(e){this.isRefreshing.set(!0),this.ipcService.send("get-queue-status",{phone:e})}refreshStatusThrottled(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.refreshStatus()},500)}getMessages(e,t,n=100){this.ipcService.send("get-queue-messages",{phone:e,status:t,limit:n})}clearPendingQueue(){confirm("\u78BA\u5B9A\u8981\u6E05\u9664\u6240\u6709\u5F85\u767C\u9001\u6D88\u606F\u55CE\uFF1F")&&(this.ipcService.send("clear-pending-queue",{}),this.toastService.info("\u6B63\u5728\u6E05\u9664\u5F85\u767C\u9001\u968A\u5217..."))}clearQueue(e,t){confirm(`\u78BA\u5B9A\u8981\u6E05\u9664 ${e} \u7684\u968A\u5217\u55CE\uFF1F`)&&this.ipcService.send("clear-queue",{phone:e,status:t})}pauseQueue(e){this.ipcService.send("pause-queue",{phone:e}),this.toastService.info(`\u66AB\u505C ${e} \u7684\u767C\u9001\u968A\u5217`)}resumeQueue(e){this.ipcService.send("resume-queue",{phone:e}),this.toastService.info(`\u6062\u5FA9 ${e} \u7684\u767C\u9001\u968A\u5217`)}pauseAllQueues(){this.queueStatuses().forEach((t,n)=>{this.ipcService.send("pause-queue",{phone:n})}),this.toastService.info("\u5DF2\u66AB\u505C\u6240\u6709\u767C\u9001\u968A\u5217")}resumeAllQueues(){this.queueStatuses().forEach((t,n)=>{this.ipcService.send("resume-queue",{phone:n})}),this.toastService.info("\u5DF2\u6062\u5FA9\u6240\u6709\u767C\u9001\u968A\u5217")}deleteMessage(e,t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D88\u606F\u55CE\uFF1F")&&this.ipcService.send("delete-queue-message",{phone:e,messageId:t})}updateMessagePriority(e,t,n){this.ipcService.send("update-queue-priority",{phone:e,messageId:t,priority:n})}retryFailedMessages(e){this.ipcService.send("retry-failed-messages",{phone:e}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u5931\u6557\u7684\u6D88\u606F...")}viewDetails(e){this.selectedPhone.set(e),this.getMessages(e),this.showQueueDetails.set(!0)}closeDetails(){this.showQueueDetails.set(!1),this.selectedPhone.set(null),this.currentQueueMessages.set([])}loadHistory(e=7){this.ipcService.send("get-queue-length-history",{days:e})}getStatusForAccount(e){return this.queueStatuses().get(e)||null}getStatusLabel(e){return{pending:"\u5F85\u767C\u9001",sending:"\u767C\u9001\u4E2D",sent:"\u5DF2\u767C\u9001",failed:"\u5931\u6557",paused:"\u5DF2\u66AB\u505C"}[e]||e}getStatusColor(e){return{pending:"bg-amber-500/20 text-amber-400",sending:"bg-cyan-500/20 text-cyan-400 animate-pulse",sent:"bg-emerald-500/20 text-emerald-400",failed:"bg-red-500/20 text-red-400",paused:"bg-slate-500/20 text-slate-400"}[e]||"bg-slate-500/20 text-slate-400"}getPriorityLabel(e){return{high:"\u9AD8\u512A\u5148",normal:"\u666E\u901A",low:"\u4F4E\u512A\u5148"}[e]||e}getPriorityColor(e){return{high:"bg-red-500/20 text-red-400",normal:"bg-cyan-500/20 text-cyan-400",low:"bg-slate-500/20 text-slate-400"}[e]||"bg-slate-500/20 text-slate-400"}handleQueueStatusResponse(e){if(this.isRefreshing.set(!1),e.success&&e.statuses){let t=new Map;for(let n of e.statuses)t.set(n.phone,n);this.queueStatuses.set(t)}}handleQueueMessagesResponse(e){e.success&&e.messages&&this.currentQueueMessages.set(e.messages)}handleQueueHistoryResponse(e){e.success&&e.history&&this.queueLengthHistory.set(e.history)}handleQueueUpdate(e){if(e.phone&&e.status){let t=new Map(this.queueStatuses());t.set(e.phone,e.status),this.queueStatuses.set(t)}}handleMessageSent(e){e.messageId&&this.currentQueueMessages.update(t=>t.map(n=>n.id===e.messageId?P(E({},n),{status:"sent",sentAt:new Date().toISOString()}):n))}handleMessageFailed(e){e.messageId&&this.currentQueueMessages.update(t=>t.map(n=>n.id===e.messageId?P(E({},n),{status:"failed",error:e.error}):n))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Wo=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.membershipService=F(Ie);this.campaigns=f([]);this.selectedCampaign=f(null);this.unifiedOverview=f(null);this.funnelAnalysis=f(null);this.showCampaignForm=f(!1);this.campaignFormData=f({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]});this.newCampaign=f(this.getEmptyCampaignForm());this.campaignKeywordInput=f("");this.isSubmittingCampaign=f(!1);this.activeCampaigns=R(()=>this.campaigns().filter(e=>e.status==="running"));this.pausedCampaigns=R(()=>this.campaigns().filter(e=>e.status==="paused"));this.completedCampaigns=R(()=>this.campaigns().filter(e=>e.status==="completed"));this.setupIpcListeners()}loadCampaigns(){this.ipcService.send("get-campaigns",{limit:50})}loadUnifiedOverview(){this.ipcService.send("get-unified-overview",{days:7})}loadFunnelAnalysis(){this.ipcService.send("get-funnel-analysis",{})}loadCampaignData(){this.loadCampaigns(),this.loadUnifiedOverview(),this.loadFunnelAnalysis()}createCampaignFromForm(){if(!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.campaignFormData();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}this.ipcService.send("create-campaign",{name:e.name,description:e.description,phases:e.phases,keywords:e.keywords,targetGroups:e.targetGroups,assignedAccounts:e.assignedAccounts}),this.resetCampaignForm()}addCampaign(){if(this.isSubmittingCampaign()){this.toastService.warning("\u6B63\u5728\u5275\u5EFA\u6D3B\u52D5\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.newCampaign(),t=[];if(e.name?.trim()||t.push("\u6D3B\u52A8\u540D\u79F0"),(!e.action.templateId||e.action.templateId===0)&&t.push("\u6D88\u606F\u6A21\u677F"),e.trigger.sourceGroupIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6765\u6E90\u7FA4\u7EC4"),e.trigger.keywordSetIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5173\u952E\u8BCD\u96C6"),t.length>0){this.toastService.error(`\u8BF7\u5B8C\u5584\u4EE5\u4E0B\u5185\u5BB9: ${t.join(", ")}`);return}let n=e.name.trim();if(this.campaigns().find(a=>a.name===n)){this.toastService.warning(`\u6D3B\u52D5 "${n}" \u5DF2\u5B58\u5728\uFF0C\u8ACB\u4F7F\u7528\u4E0D\u540C\u7684\u540D\u7A31`,4e3);return}this.isSubmittingCampaign.set(!0),this.newCampaign.set(this.getEmptyCampaignForm()),this.ipcService.send("add-campaign",E({},e)),setTimeout(()=>{this.isSubmittingCampaign.set(!1)},3e3)}startCampaign(e){confirm("\u78BA\u5B9A\u8981\u555F\u52D5\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("start-campaign",{campaignId:e})}pauseCampaign(e){this.ipcService.send("pause-campaign",{campaignId:e})}resumeCampaign(e){this.ipcService.send("resume-campaign",{campaignId:e})}stopCampaign(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("stop-campaign",{campaignId:e})}deleteCampaign(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("delete-campaign",{campaignId:e})}toggleCampaignStatus(e){this.ipcService.send("toggle-campaign-status",{id:e})}viewCampaignDetails(e){this.selectedCampaign.set(e),this.ipcService.send("get-campaign-logs",{campaignId:e.id})}toggleCampaignPhase(e){this.campaignFormData.update(t=>{let n=[...t.phases],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),P(E({},t),{phases:n})})}addCampaignKeyword(){let e=this.campaignKeywordInput().trim();e&&(this.campaignFormData.update(t=>P(E({},t),{keywords:[...t.keywords,e]})),this.campaignKeywordInput.set(""))}removeCampaignKeyword(e){this.campaignFormData.update(t=>P(E({},t),{keywords:t.keywords.filter(n=>n!==e)}))}toggleCampaignAccount(e){this.campaignFormData.update(t=>{let n=[...t.assignedAccounts],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),P(E({},t),{assignedAccounts:n})})}toggleNewCampaignSourceGroup(e){this.newCampaign.update(t=>{let n=[...t.trigger.sourceGroupIds],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),P(E({},t),{trigger:P(E({},t.trigger),{sourceGroupIds:n})})})}toggleNewCampaignKeywordSet(e){this.newCampaign.update(t=>{let n=[...t.trigger.keywordSetIds],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),P(E({},t),{trigger:P(E({},t.trigger),{keywordSetIds:n})})})}updateCampaignFormName(e){this.campaignFormData.update(t=>P(E({},t),{name:e}))}updateCampaignFormDesc(e){this.campaignFormData.update(t=>P(E({},t),{description:e}))}updateNewCampaignName(e){this.newCampaign.update(t=>P(E({},t),{name:e}))}updateNewCampaignTemplateId(e){this.newCampaign.update(t=>P(E({},t),{action:P(E({},t.action),{templateId:e})}))}getEmptyCampaignForm(){return{name:"",trigger:{sourceGroupIds:[],keywordSetIds:[]},action:{templateId:0,minDelaySeconds:30,maxDelaySeconds:120}}}resetCampaignForm(){this.campaignFormData.set({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]}),this.showCampaignForm.set(!1)}getCampaignStatusLabel(e){return{draft:"\u8349\u7A3F",scheduled:"\u5DF2\u6392\u7A0B",running:"\u904B\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getCampaignStatusColor(e){return{draft:"bg-slate-500/20 text-slate-400",scheduled:"bg-blue-500/20 text-blue-400",running:"bg-green-500/20 text-green-400",paused:"bg-yellow-500/20 text-yellow-400",completed:"bg-cyan-500/20 text-cyan-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}getPhaseLabel(e){return{discovery:"\u8CC7\u6E90\u767C\u73FE",monitoring:"\u76E3\u63A7\u7372\u5BA2",outreach:"\u5EE3\u544A\u89F8\u9054",tracking:"\u7528\u6236\u8FFD\u8E64",conversion:"\u8F49\u5316\u6210\u4EA4"}[e]||e}getCampaignName(e){return e?this.campaigns().find(t=>t.id===e)?.name||"Unknown Campaign":"N/A"}getCampaignById(e){if(e!==void 0)return this.campaigns().find(t=>t.id===e)}setupIpcListeners(){this.ipcService.on("campaigns-result",e=>this.handleCampaigns(e)),this.ipcService.on("campaign-created",e=>this.handleCampaignCreated(e)),this.ipcService.on("campaign-deleted",e=>this.handleCampaignDeleted(e)),this.ipcService.on("unified-overview-result",e=>this.handleUnifiedOverview(e)),this.ipcService.on("funnel-analysis-result",e=>this.handleFunnelAnalysis(e)),this.ipcService.on("campaign-added",e=>this.handleCampaignAdded(e)),this.ipcService.on("campaign-status-toggled",e=>this.handleCampaignStatusToggled(e))}handleCampaigns(e){e.success&&this.campaigns.set(e.campaigns||[])}handleCampaignCreated(e){e.success?(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.loadCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleCampaignDeleted(e){e.success&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u522A\u9664"),this.loadCampaigns())}handleUnifiedOverview(e){e.success&&this.unifiedOverview.set(e)}handleFunnelAnalysis(e){e.success&&this.funnelAnalysis.set(e)}handleCampaignAdded(e){this.isSubmittingCampaign.set(!1),e.success?(this.toastService.success("\u6D3B\u52D5\u5275\u5EFA\u6210\u529F"),this.loadCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleCampaignStatusToggled(e){e.success&&this.loadCampaigns()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var zo=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.messageTemplates=f([]);this.selectedTemplate=f(null);this.showTemplateCreator=f(!1);this.newTemplate=f({name:"",prompt:""});this.activeTemplates=R(()=>this.messageTemplates().filter(e=>e.active));this.templateCount=R(()=>this.messageTemplates().length);this.availableVariables=[{name:"name",placeholder:"{name}",description:"\u7528\u6236\u540D\u7A31"},{name:"username",placeholder:"{username}",description:"\u7528\u6236 @username"},{name:"group_name",placeholder:"{group_name}",description:"\u7FA4\u7D44\u540D\u7A31"},{name:"keyword",placeholder:"{keyword}",description:"\u89F8\u767C\u95DC\u9375\u8A5E"},{name:"date",placeholder:"{date}",description:"\u7576\u524D\u65E5\u671F"},{name:"time",placeholder:"{time}",description:"\u7576\u524D\u6642\u9593"}];this.setupIpcListeners()}loadTemplates(){this.ipcService.send("get-templates",{})}addTemplate(){let e=this.newTemplate();e.name.trim()&&e.prompt.trim()?(this.ipcService.send("add-template",{name:e.name,prompt:e.prompt}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F")):this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}addTemplateQuick(e,t){if(e?.trim()&&t?.trim()){if(this.messageTemplates().some(o=>o.name===e.trim())){this.toastService.warning("\u6A21\u677F\u540D\u7A31\u5DF2\u5B58\u5728\uFF0C\u7121\u6CD5\u5275\u5EFA\u91CD\u8907\u6A21\u677F",3e3);return}this.ipcService.send("add-template",{name:e.trim(),prompt:t.trim()}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F"),this.messageTemplates().length>0&&this.showTemplateCreator.set(!1)}else this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}toggleTemplateStatus(e){this.ipcService.send("toggle-template-status",{id:e})}removeTemplate(e,t=[]){let n=this.messageTemplates().find(a=>a.id===e);if(!n)return;let o=t.filter(a=>a.actions?.some(d=>d.templateId===e));if(o.length>0){let a=o.map(d=>d.name).join(", ");if(!confirm(`\u6A21\u677F "${n.name}" \u6B63\u5728\u88AB\u4EE5\u4E0B\u6D3B\u52D5\u4F7F\u7528\uFF1A${a}

\u522A\u9664\u6A21\u677F\u5F8C\uFF0C\u9019\u4E9B\u6D3B\u52D5\u5C07\u7121\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002

\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F`))return}else if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F "${n.name}" \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002`))return;this.ipcService.send("remove-template",{id:e}),this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664")}selectTemplate(e){this.selectedTemplate.set(e)}clearSelection(){this.selectedTemplate.set(null)}updateTemplateName(e){this.newTemplate.update(t=>P(E({},t),{name:e}))}updateTemplatePrompt(e){this.newTemplate.update(t=>P(E({},t),{prompt:e}))}insertTemplateVariable(e,t){let n=e.selectionStart,o=e.selectionEnd,a=e.value,d=a.substring(0,n)+t+a.substring(o);e.value=d,this.updateTemplatePrompt(d),setTimeout(()=>{e.focus(),e.selectionStart=e.selectionEnd=n+t.length},0)}openTemplateCreator(){this.showTemplateCreator.set(!0),this.newTemplate.set({name:"",prompt:""})}closeTemplateCreator(){this.showTemplateCreator.set(!1)}getTemplateName(e){return e?this.messageTemplates().find(t=>t.id===e)?.name||"Unknown Template":"N/A"}getTemplateById(e){return this.messageTemplates().find(t=>t.id===e)}setupIpcListeners(){this.ipcService.on("templates-result",e=>this.handleTemplates(e)),this.ipcService.on("template-added",e=>this.handleTemplateAdded(e)),this.ipcService.on("template-removed",e=>this.handleTemplateRemoved(e)),this.ipcService.on("template-status-toggled",e=>this.handleTemplateStatusToggled(e))}handleTemplates(e){(e.success||e.templates)&&this.messageTemplates.set(e.templates||[])}handleTemplateAdded(e){e.success?this.loadTemplates():this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}handleTemplateRemoved(e){e.success&&this.loadTemplates()}handleTemplateStatusToggled(e){e.success&&this.loadTemplates()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var to={dashboard:{path:"/dashboard",title:"\u5100\u8868\u677F",icon:"\u{1F3E0}"},accounts:{path:"/accounts",title:"\u5E33\u865F\u7BA1\u7406",icon:"\u{1F465}"},"add-account":{path:"/accounts/add",title:"\u6DFB\u52A0\u5E33\u865F",icon:"\u2795"},"api-credentials":{path:"/accounts/api",title:"API \u6191\u8B49",icon:"\u{1F511}"},resources:{path:"/resources",title:"\u8CC7\u6E90\u7BA1\u7406",icon:"\u{1F4E6}"},"member-database":{path:"/member-database",title:"\u6210\u54E1\u8CC7\u6599\u5EAB",icon:"\u{1F4CA}"},"resource-center":{path:"/resource-center",title:"\u8CC7\u6E90\u4E2D\u5FC3",icon:"\u{1F3E2}"},"search-discovery":{path:"/search-discovery",title:"\u8CC7\u6E90\u767C\u73FE",icon:"\u{1F50D}"},"ai-assistant":{path:"/ai-assistant",title:"AI \u7B56\u7565\u898F\u5283",icon:"\u{1F916}",requiredFeature:"strategyPlanning",membershipLevel:"diamond",membershipMessage:"\u{1F48E} AI\u7B56\u7565\u898F\u5283\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"},automation:{path:"/automation",title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",icon:"\u2699\uFE0F"},leads:{path:"/leads",title:"\u6F5B\u5728\u5BA2\u6236",icon:"\u{1F3AF}"},"lead-nurturing":{path:"/lead-nurturing",title:"\u7DDA\u7D22\u57F9\u80B2",icon:"\u{1F331}"},"nurturing-analytics":{path:"/nurturing-analytics",title:"\u57F9\u80B2\u5206\u6790",icon:"\u{1F4C8}"},ads:{path:"/ads",title:"\u5EE3\u544A\u767C\u9001",icon:"\u{1F4E2}",requiredFeature:"adBroadcast",membershipLevel:"silver",membershipMessage:"\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1"},"user-tracking":{path:"/user-tracking",title:"\u7528\u6236\u8FFD\u8E64",icon:"\u{1F464}",requiredFeature:"advancedAnalytics",membershipLevel:"diamond",membershipMessage:"\u{1F48E} \u7528\u6236\u8FFD\u8E64\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"},campaigns:{path:"/campaigns",title:"\u71DF\u92B7\u6D3B\u52D5",icon:"\u{1F680}",requiredFeature:"aiSalesFunnel",membershipLevel:"diamond",membershipMessage:"\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"},"multi-role":{path:"/multi-role",title:"\u591A\u89D2\u8272\u5354\u4F5C",icon:"\u{1F3AD}",requiredFeature:"multiRole",membershipLevel:"diamond",membershipMessage:"\u{1F48E} \u591A\u89D2\u8272\u5354\u4F5C\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"},"ai-team":{path:"/ai-team",title:"AI \u5718\u968A\u92B7\u552E",icon:"\u{1F91D}",requiredFeature:"autoExecution",membershipLevel:"diamond",membershipMessage:"\u{1F48E} AI\u5718\u968A\u92B7\u552E\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"},"ai-center":{path:"/ai-center",title:"AI \u4E2D\u5FC3",icon:"\u{1F9E0}"},settings:{path:"/settings",title:"\u8A2D\u5B9A",icon:"\u2699\uFE0F"},analytics:{path:"/analytics",title:"\u6578\u64DA\u6D1E\u5BDF",icon:"\u{1F4CA}",requiredFeature:"dataInsightsBasic",membershipLevel:"gold",membershipMessage:"\u{1F947} \u6578\u64DA\u6D1E\u5BDF\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"},"analytics-center":{path:"/analytics-center",title:"\u6578\u64DA\u5206\u6790\u4E2D\u5FC3",icon:"\u{1F4C9}",requiredFeature:"dataInsightsBasic",membershipLevel:"gold",membershipMessage:"\u{1F947} \u6578\u64DA\u5206\u6790\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"},profile:{path:"/profile",title:"\u500B\u4EBA\u8CC7\u6599",icon:"\u{1F464}"},"membership-center":{path:"/membership",title:"\u6703\u54E1\u4E2D\u5FC3",icon:"\u2B50"},"monitoring-accounts":{path:"/monitoring/accounts",title:"\u76E3\u63A7\u5E33\u865F",icon:"\u{1F441}\uFE0F"},"monitoring-groups":{path:"/monitoring/groups",title:"\u76E3\u63A7\u7FA4\u7D44",icon:"\u{1F441}\uFE0F"},"keyword-sets":{path:"/monitoring/keywords",title:"\u95DC\u9375\u8A5E\u96C6",icon:"\u{1F524}"},"chat-templates":{path:"/monitoring/templates",title:"\u804A\u5929\u6A21\u677F",icon:"\u{1F4AC}"},"trigger-rules":{path:"/monitoring/triggers",title:"\u89F8\u767C\u898F\u5247",icon:"\u26A1"},"collected-users":{path:"/monitoring/users",title:"\u6536\u96C6\u7528\u6236",icon:"\u{1F465}"}},no=class i{constructor(){this.membershipService=F(Ie);this.toastService=F(J);this.currentView=f("dashboard");this._history=["dashboard"];this.history=f(["dashboard"]);this.currentViewConfig=R(()=>to[this.currentView()]);this.canGoBack=R(()=>this._history.length>1);this.onNavigateCallbacks=[]}navigate(e,t){if(!t?.skipPermissionCheck){let o=to[e];if(o?.requiredFeature&&!this.membershipService.hasFeature(o.requiredFeature))return this.toastService.warning(o.membershipMessage||"\u6B64\u529F\u80FD\u9700\u8981\u5347\u7D1A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),!1}let n=this.currentView();return this.currentView.set(e),!t?.skipHistory&&e!==n&&(this._history.push(e),this._history.length>50&&(this._history=this._history.slice(-50)),this.history.set([...this._history])),this.onNavigateCallbacks.forEach(o=>o(e)),!0}goBack(){if(this._history.length>1){this._history.pop();let e=this._history[this._history.length-1];return this.currentView.set(e),this.history.set([...this._history]),!0}return!1}goHome(){this.navigate("dashboard")}onNavigate(e){return this.onNavigateCallbacks.push(e),()=>{let t=this.onNavigateCallbacks.indexOf(e);t>-1&&this.onNavigateCallbacks.splice(t,1)}}getViewConfig(e){return to[e]}getAllViewConfigs(){return to}isViewAvailable(e){let t=to[e];return t?.requiredFeature?this.membershipService.hasFeature(t.requiredFeature):!0}getViewPath(e){return to[e]?.path||"/dashboard"}getViewFromPath(e){for(let[t,n]of Object.entries(to))if(n.path===e)return t}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Hn=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.monitoredGroups=f([]);this.keywordSets=f([]);this.triggerRules=f([]);this.monitoringActive=f(!1);this.showJoinMonitorDialog=f(!1);this.joinMonitorConfig=f({resourceId:0,resourceTitle:"",accountPhone:"",selectedKeywordSetId:null,customKeywords:[]});this.showQuickCreateKeywordSet=f(!1);this.quickKeywordSetName=f("");this.quickKeywords=f([]);this.quickKeywordInput=f("");this.showBatchJoinMonitorDialog=f(!1);this.batchJoinMonitorProgress=f(0);this.isBatchJoining=f(!1);this.activeMonitoredGroups=R(()=>this.monitoredGroups().filter(e=>e.status==="active"));this.activeKeywordSets=R(()=>this.keywordSets().filter(e=>e.active));this.totalMatchedCount=R(()=>this.monitoredGroups().reduce((e,t)=>e+(t.matchedCount||0),0));this.recommendedKeywords=["\u4ED8\u6B3E","\u652F\u4ED8","\u6536\u6B3E","USDT","BTC","\u6BD4\u7279\u5E63","\u6295\u8CC7","\u7406\u8CA1","\u8CFA\u9322","\u517C\u8077","\u4EE3\u7406","\u5408\u4F5C"];this.setupIpcListeners()}loadMonitoredGroups(){this.ipcService.send("get-monitored-groups",{})}loadKeywordSets(){this.ipcService.send("get-keyword-sets",{})}loadTriggerRules(){this.ipcService.send("get-trigger-rules",{})}loadAllMonitoringData(){this.loadMonitoredGroups(),this.loadKeywordSets(),this.loadTriggerRules()}startMonitoring(){this.ipcService.send("start-monitoring",{}),this.monitoringActive.set(!0)}stopMonitoring(){this.ipcService.send("stop-monitoring",{}),this.monitoringActive.set(!1)}toggleMonitoring(){this.monitoringActive()?this.stopMonitoring():this.startMonitoring()}addMonitoredGroup(e){this.ipcService.send("add-monitored-group",e)}removeMonitoredGroup(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u76E3\u63A7\u6B64\u7FA4\u7D44\u55CE\uFF1F")&&this.ipcService.send("remove-monitored-group",{id:e})}pauseMonitoredGroup(e){this.ipcService.send("pause-monitored-group",{id:e})}resumeMonitoredGroup(e){this.ipcService.send("resume-monitored-group",{id:e})}openJoinAndMonitorDialog(e){this.joinMonitorConfig.set({resourceId:e.id,resourceTitle:e.title||e.name,accountPhone:"",selectedKeywordSetId:null,customKeywords:[]}),this.showJoinMonitorDialog.set(!0)}closeJoinMonitorDialog(){this.showJoinMonitorDialog.set(!1)}selectMonitorAccount(e){this.joinMonitorConfig.update(t=>P(E({},t),{accountPhone:e}))}selectKeywordSet(e){this.joinMonitorConfig.update(t=>P(E({},t),{selectedKeywordSetId:e}))}addMonitorKeyword(e){let t=e||this.quickKeywordInput().trim();t&&(this.joinMonitorConfig.update(n=>P(E({},n),{customKeywords:[...n.customKeywords,t]})),this.quickKeywordInput.set(""))}removeMonitorKeyword(e){this.joinMonitorConfig.update(t=>P(E({},t),{customKeywords:t.customKeywords.filter(n=>n!==e)}))}executeJoinAndMonitor(){let e=this.joinMonitorConfig();if(!e.accountPhone){this.toastService.warning("\u8ACB\u9078\u64C7\u57F7\u884C\u5E33\u865F");return}if(!e.selectedKeywordSetId&&e.customKeywords.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u95DC\u9375\u8A5E\u96C6\u6216\u6DFB\u52A0\u81EA\u5B9A\u7FA9\u95DC\u9375\u8A5E");return}this.ipcService.send("join-and-monitor",{resourceId:e.resourceId,accountPhone:e.accountPhone,keywordSetId:e.selectedKeywordSetId,customKeywords:e.customKeywords}),this.closeJoinMonitorDialog(),this.toastService.success("\u6B63\u5728\u52A0\u5165\u4E26\u8A2D\u7F6E\u76E3\u63A7...")}openQuickCreateKeywordSet(){this.quickKeywordSetName.set(""),this.quickKeywords.set([]),this.quickKeywordInput.set(""),this.showQuickCreateKeywordSet.set(!0)}closeQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!1)}addQuickKeyword(){let e=this.quickKeywordInput().trim();e&&(this.quickKeywords.update(t=>[...t,e]),this.quickKeywordInput.set(""))}removeQuickKeyword(e){this.quickKeywords.update(t=>t.filter(n=>n!==e))}addQuickRecommendedKeyword(e){this.quickKeywords().includes(e)||this.quickKeywords.update(t=>[...t,e])}executeQuickCreateKeywordSet(){let e=this.quickKeywordSetName().trim(),t=this.quickKeywords();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31");return}if(t.length===0){this.toastService.warning("\u8ACB\u6DFB\u52A0\u81F3\u5C11\u4E00\u500B\u95DC\u9375\u8A5E");return}this.ipcService.send("create-keyword-set",{name:e,keywords:t.map(n=>({keyword:n,isRegex:!1}))}),this.closeQuickCreateKeywordSet(),this.toastService.success("\u95DC\u9375\u8A5E\u96C6\u5275\u5EFA\u6210\u529F")}openBatchJoinMonitorDialog(){this.batchJoinMonitorProgress.set(0),this.isBatchJoining.set(!1),this.showBatchJoinMonitorDialog.set(!0)}closeBatchJoinMonitorDialog(){this.showBatchJoinMonitorDialog.set(!1)}executeBatchJoinMonitor(e,t,n){if(e.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}if(!t){this.toastService.warning("\u8ACB\u9078\u64C7\u57F7\u884C\u5E33\u865F");return}this.isBatchJoining.set(!0),this.batchJoinMonitorProgress.set(0),this.ipcService.send("batch-join-and-monitor",{resourceIds:e.map(o=>o.id),accountPhone:t,keywordSetId:n})}createKeywordSet(e,t){this.ipcService.send("create-keyword-set",{name:e,keywords:t})}deleteKeywordSet(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u95DC\u9375\u8A5E\u96C6\u55CE\uFF1F")&&this.ipcService.send("delete-keyword-set",{id:e})}toggleKeywordSetStatus(e){this.ipcService.send("toggle-keyword-set-status",{id:e})}addKeywordToSet(e,t){this.ipcService.send("add-keyword-to-set",{setId:e,keyword:t})}removeKeywordFromSet(e,t){this.ipcService.send("remove-keyword-from-set",{setId:e,keyword:t})}createTriggerRule(e){this.ipcService.send("create-trigger-rule",e)}deleteTriggerRule(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u89F8\u767C\u898F\u5247\u55CE\uFF1F")&&this.ipcService.send("delete-trigger-rule",{id:e})}toggleTriggerRuleStatus(e){this.ipcService.send("toggle-trigger-rule-status",{id:e})}getKeywordSetName(e){return this.keywordSets().find(t=>t.id===e)?.name||"Unknown"}getKeywordPreview(e){if(!e||e.length===0)return"";let t=e.slice(0,3).map(n=>n.keyword).join(", ");return e.length>3?`${t} \u7B49 ${e.length} \u500B`:t}getRecommendedKeywords(){return this.recommendedKeywords}setupIpcListeners(){this.ipcService.on("monitored-groups-result",e=>this.handleMonitoredGroups(e)),this.ipcService.on("keyword-sets-result",e=>this.handleKeywordSets(e)),this.ipcService.on("trigger-rules-result",e=>this.handleTriggerRules(e)),this.ipcService.on("monitoring-started",e=>{console.log("[MonitoringManagement] monitoring-started:",e),this.monitoringActive.set(!0)}),this.ipcService.on("monitoring-stopped",()=>{console.log("[MonitoringManagement] monitoring-stopped"),this.monitoringActive.set(!1)}),this.ipcService.on("monitoring-status-changed",e=>{console.log("[MonitoringManagement] monitoring-status-changed:",e),this.monitoringActive.set(e)}),this.ipcService.on("monitoring-status",e=>{let t=e.isMonitoring??e.active??!1;console.log("[MonitoringManagement] monitoring-status:",t),this.monitoringActive.set(t)}),this.ipcService.on("group-added-to-monitor",e=>this.handleGroupAdded(e)),this.ipcService.on("keyword-set-created",e=>this.handleKeywordSetCreated(e)),this.ipcService.on("batch-join-progress",e=>this.handleBatchJoinProgress(e)),this.ipcService.on("batch-join-completed",e=>this.handleBatchJoinCompleted(e))}handleMonitoredGroups(e){(e.success||e.groups)&&this.monitoredGroups.set(e.groups||[])}handleKeywordSets(e){(e.success||e.sets)&&this.keywordSets.set(e.sets||[])}handleTriggerRules(e){(e.success||e.rules)&&this.triggerRules.set(e.rules||[])}handleGroupAdded(e){e.success?(this.toastService.success("\u7FA4\u7D44\u5DF2\u52A0\u5165\u76E3\u63A7"),this.loadMonitoredGroups()):this.toastService.error(`\u52A0\u5165\u5931\u6557: ${e.error}`)}handleKeywordSetCreated(e){e.success&&this.loadKeywordSets()}handleBatchJoinProgress(e){this.batchJoinMonitorProgress.set(e.progress||0)}handleBatchJoinCompleted(e){this.isBatchJoining.set(!1),this.batchJoinMonitorProgress.set(100),e.success?(this.toastService.success(`\u6279\u91CF\u52A0\u5165\u5B8C\u6210: ${e.successCount}/${e.totalCount} \u500B\u7FA4\u7D44`),this.loadMonitoredGroups()):this.toastService.error(`\u6279\u91CF\u52A0\u5165\u5931\u6557: ${e.error}`),setTimeout(()=>this.closeBatchJoinMonitorDialog(),1500)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Ko=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.leads=f([]);this.selectedLead=f(null);this.leadStats=f({total:0,byStage:{New:0,Contacted:0,Replied:0,"Follow-up":0,"Closed-Won":0,"Closed-Lost":0},todayNew:0,todayContacted:0,conversionRate:0});this.filter=f({});this.viewMode=f("kanban");this.isLoading=f(!1);this.selectedLeadIds=f(new Set);this.showBatchActions=f(!1);this.showLeadDetails=f(!1);this.detailsTab=f("sendMessage");this.showDeleteConfirm=f(!1);this.leadsToDelete=f([]);this.filteredLeads=R(()=>{let e=this.leads(),t=this.filter();if(t.stage&&(e=e.filter(n=>n.stage===t.stage)),t.search){let n=t.search.toLowerCase();e=e.filter(o=>o.username.toLowerCase().includes(n)||o.firstName?.toLowerCase().includes(n)||o.lastName?.toLowerCase().includes(n)||o.message.toLowerCase().includes(n))}return t.sourceGroup&&(e=e.filter(n=>n.sourceGroup===t.sourceGroup)),t.minScore!==void 0&&(e=e.filter(n=>(n.score||0)>=t.minScore)),e});this.leadsByStage=R(()=>{let e=["New","Contacted","Replied","Follow-up","Closed-Won","Closed-Lost"],t={};return e.forEach(n=>{t[n]=this.filteredLeads().filter(o=>o.stage===n)}),t});this.selectedCount=R(()=>this.selectedLeadIds().size);this.stageLabels={New:"\u65B0\u7DDA\u7D22",Contacted:"\u5DF2\u806F\u7E6B",Replied:"\u5DF2\u56DE\u8986","Follow-up":"\u9700\u8DDF\u9032","Closed-Won":"\u5DF2\u6210\u4EA4","Closed-Lost":"\u5DF2\u6D41\u5931"};this.stageColors={New:"bg-blue-500/20 text-blue-400 border-blue-500/30",Contacted:"bg-amber-500/20 text-amber-400 border-amber-500/30",Replied:"bg-purple-500/20 text-purple-400 border-purple-500/30","Follow-up":"bg-orange-500/20 text-orange-400 border-orange-500/30","Closed-Won":"bg-emerald-500/20 text-emerald-400 border-emerald-500/30","Closed-Lost":"bg-red-500/20 text-red-400 border-red-500/30"};this.setupIpcListeners()}loadLeads(e=100){this.isLoading.set(!0),this.ipcService.send("get-leads",{limit:e})}loadLeadStats(){this.ipcService.send("get-lead-stats",{})}loadLeadDetails(e){this.ipcService.send("get-lead-details",{leadId:e})}refreshData(){this.loadLeads(),this.loadLeadStats()}selectLead(e){this.selectedLead.set(e),this.showLeadDetails.set(!0),this.loadLeadDetails(e.id)}closeLeadDetails(){this.showLeadDetails.set(!1),this.selectedLead.set(null)}updateLeadStage(e,t){this.ipcService.send("update-lead-stage",{leadId:e,stage:t}),this.leads.update(n=>n.map(o=>o.id===e?P(E({},o),{stage:t}):o)),this.selectedLead()?.id===e&&this.selectedLead.update(n=>n?P(E({},n),{stage:t}):null)}addNote(e,t){t.trim()&&this.ipcService.send("add-lead-note",{leadId:e,note:t})}assignLead(e,t){this.ipcService.send("assign-lead",{leadId:e,assignTo:t}),this.leads.update(n=>n.map(o=>o.id===e?P(E({},o),{assignedTo:t}):o))}addToBlacklist(e){confirm("\u78BA\u5B9A\u8981\u5C07\u6B64\u7528\u6236\u52A0\u5165\u9ED1\u540D\u55AE\u55CE\uFF1F")&&(this.ipcService.send("add-to-blacklist",{leadId:e}),this.toastService.success("\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE"))}toggleLeadSelection(e){this.selectedLeadIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}selectAllLeads(){let e=new Set(this.filteredLeads().map(t=>t.id));this.selectedLeadIds.set(e)}clearSelection(){this.selectedLeadIds.set(new Set)}batchUpdateStage(e){let t=Array.from(this.selectedLeadIds());t.length!==0&&(this.ipcService.send("batch-update-lead-stage",{leadIds:t,stage:e}),this.leads.update(n=>n.map(o=>t.includes(o.id)?P(E({},o),{stage:e}):o)),this.clearSelection(),this.toastService.success(`\u5DF2\u66F4\u65B0 ${t.length} \u500B\u7DDA\u7D22\u7684\u72C0\u614B`))}confirmDeleteLeads(){let e=Array.from(this.selectedLeadIds());if(e.length===0)return;let t=this.leads().filter(n=>e.includes(n.id));this.leadsToDelete.set(t),this.showDeleteConfirm.set(!0)}cancelDeleteLeads(){this.showDeleteConfirm.set(!1),this.leadsToDelete.set([])}executeDeleteLeads(){let e=this.leadsToDelete().map(t=>t.id);this.ipcService.send("batch-delete-leads",{leadIds:e}),this.leads.update(t=>t.filter(n=>!e.includes(n.id))),this.clearSelection(),this.showDeleteConfirm.set(!1),this.leadsToDelete.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u500B\u7DDA\u7D22`)}setFilter(e){this.filter.update(t=>E(E({},t),e))}clearFilter(){this.filter.set({})}setViewMode(e){this.viewMode.set(e)}setDetailsTab(e){this.detailsTab.set(e)}exportToExcel(){let e=this.filteredLeads();if(e.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u7DDA\u7D22");return}this.ipcService.send("export-leads-to-excel",{leadIds:e.map(t=>t.id)}),this.toastService.info("\u6B63\u5728\u5C0E\u51FA...")}getStageLabel(e){return this.stageLabels[e]||e}getStageColor(e){return this.stageColors[e]||"bg-slate-500/20 text-slate-400"}getLeadDisplayName(e){return e.firstName||e.lastName?`${e.firstName||""} ${e.lastName||""}`.trim():e.username||"Unknown"}setupIpcListeners(){this.ipcService.on("leads-result",e=>this.handleLeads(e)),this.ipcService.on("lead-stats-result",e=>this.handleLeadStats(e)),this.ipcService.on("lead-details-result",e=>this.handleLeadDetails(e)),this.ipcService.on("lead-captured",e=>this.handleLeadCaptured(e)),this.ipcService.on("lead-stage-updated",e=>this.handleLeadStageUpdated(e)),this.ipcService.on("leads-exported",e=>this.handleLeadsExported(e))}handleLeads(e){this.isLoading.set(!1),(e.success||e.leads)&&this.leads.set(e.leads||[])}handleLeadStats(e){e.success&&this.leadStats.set(e.stats)}handleLeadDetails(e){e.success&&e.lead&&this.selectedLead.set(e.lead)}handleLeadCaptured(e){e.lead&&(this.leads.update(t=>[e.lead,...t]),this.toastService.success(`\u6355\u7372\u65B0\u7DDA\u7D22: ${e.lead.username}`))}handleLeadStageUpdated(e){e.success&&this.loadLeadStats()}handleLeadsExported(e){e.success?this.toastService.success(`\u5C0E\u51FA\u6210\u529F: ${e.filePath}`):this.toastService.error(`\u5C0E\u51FA\u5931\u6557: ${e.error}`)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var jo=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._groups=f([]);this._joinQueue=f([]);this._selectedGroupIds=f(new Set);this._isJoining=f(!1);this.groups=this._groups.asReadonly();this.joinQueue=this._joinQueue.asReadonly();this.selectedGroupIds=this._selectedGroupIds.asReadonly();this.isJoining=this._isJoining.asReadonly();this._joinMonitorDialog=f({isOpen:!1,resource:null,selectedAccount:"",enableMonitoring:!1,selectedKeywordSets:[]});this._batchJoinDialog=f({isOpen:!1,selectedResources:[],selectedAccount:"",enableMonitoring:!1,selectedKeywordSets:[]});this._postJoinDialog=f({isOpen:!1,resource:null,phone:"",keywordSetCount:0});this.joinMonitorDialog=this._joinMonitorDialog.asReadonly();this.batchJoinDialog=this._batchJoinDialog.asReadonly();this.postJoinDialog=this._postJoinDialog.asReadonly();this.selectedGroups=R(()=>{let e=this._selectedGroupIds();return this._groups().filter(t=>e.has(t.id))});this.selectedGroupCount=R(()=>this._selectedGroupIds().size);this.joinQueuePending=R(()=>this._joinQueue().filter(e=>e.status==="pending"));this.joinQueueProgress=R(()=>{let e=this._joinQueue();if(e.length===0)return 0;let t=e.filter(n=>n.status==="joined"||n.status==="failed").length;return Math.round(t/e.length*100)})}setGroups(e){this._groups.set(e)}updateGroup(e){this._groups.update(t=>t.map(n=>n.id===e.id?E(E({},n),e):n))}addGroup(e){this._groups.update(t=>[...t,e])}removeGroup(e){this._groups.update(t=>t.filter(n=>n.id!==e))}toggleGroupSelection(e){this._selectedGroupIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}selectAllGroups(){let e=new Set(this._groups().map(t=>t.id));this._selectedGroupIds.set(e)}deselectAllGroups(){this._selectedGroupIds.set(new Set)}openJoinMonitorDialog(e){this._joinMonitorDialog.set({isOpen:!0,resource:e,selectedAccount:"",enableMonitoring:!1,selectedKeywordSets:[]})}closeJoinMonitorDialog(){this._joinMonitorDialog.update(e=>P(E({},e),{isOpen:!1}))}updateJoinMonitorDialog(e){this._joinMonitorDialog.update(t=>E(E({},t),e))}executeJoinAndMonitor(){let e=this._joinMonitorDialog();if(!e.resource||!e.selectedAccount){this.toast.error("\u8ACB\u9078\u64C7\u5E33\u865F");return}this._isJoining.set(!0),this.ipc.send("join-group",{resourceId:e.resource.id,phone:e.selectedAccount,enableMonitoring:e.enableMonitoring,keywordSetIds:e.selectedKeywordSets}),this.closeJoinMonitorDialog()}openBatchJoinDialog(e){this._batchJoinDialog.set({isOpen:!0,selectedResources:e,selectedAccount:"",enableMonitoring:!1,selectedKeywordSets:[]})}closeBatchJoinDialog(){this._batchJoinDialog.update(e=>P(E({},e),{isOpen:!1}))}updateBatchJoinDialog(e){this._batchJoinDialog.update(t=>E(E({},t),e))}executeBatchJoin(){let e=this._batchJoinDialog();if(e.selectedResources.length===0||!e.selectedAccount){this.toast.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u548C\u5E33\u865F");return}this._isJoining.set(!0);let t=e.selectedResources.map(n=>({resourceId:n.id,title:n.title,status:"pending"}));this._joinQueue.set(t),this.ipc.send("batch-join-groups",{resourceIds:e.selectedResources.map(n=>n.id),phone:e.selectedAccount,enableMonitoring:e.enableMonitoring,keywordSetIds:e.selectedKeywordSets}),this.closeBatchJoinDialog()}openPostJoinDialog(e,t,n){this._postJoinDialog.set({isOpen:!0,resource:e,phone:t,keywordSetCount:n})}closePostJoinDialog(){this._postJoinDialog.update(e=>P(E({},e),{isOpen:!1}))}postJoinExtractMembers(){let e=this._postJoinDialog();e.resource&&(this.ipc.send("extract-members",{resourceId:e.resource.id,phone:e.phone}),this.closePostJoinDialog(),this.toast.info("\u958B\u59CB\u63D0\u53D6\u6210\u54E1..."))}postJoinSendMessage(){this._postJoinDialog().resource&&this.closePostJoinDialog()}leaveGroup(e,t){confirm(`\u78BA\u5B9A\u8981\u96E2\u958B\u7FA4\u7D44 ${e.title} \u55CE\uFF1F`)&&(this.ipc.send("leave-group",{resourceId:e.id,phone:t}),this.toast.info("\u6B63\u5728\u96E2\u958B\u7FA4\u7D44..."))}stopMonitoring(e){this.ipc.send("stop-monitoring",{resourceId:e.id}),this.toast.info("\u5DF2\u505C\u6B62\u76E3\u63A7")}clearJoinQueue(){this._joinQueue.set([])}updateQueueItemStatus(e,t,n){this._joinQueue.update(d=>d.map(u=>u.resourceId===e?P(E({},u),{status:t,error:n}):u));let o=this._joinQueue();if(o.every(d=>d.status==="joined"||d.status==="failed")){this._isJoining.set(!1);let d=o.filter(p=>p.status==="joined").length,u=o.filter(p=>p.status==="failed").length;u>0?this.toast.warning(`\u5B8C\u6210\uFF1A${d} \u6210\u529F\uFF0C${u} \u5931\u6557`):this.toast.success(`\u6210\u529F\u52A0\u5165 ${d} \u500B\u7FA4\u7D44`)}}handleJoinResult(e){if(this._isJoining.set(!1),e.success){if(this.toast.success("\u6210\u529F\u52A0\u5165\u7FA4\u7D44"),this.updateGroup({id:e.resourceId,joined:!0}),e.phone&&e.keywordSetCount!==void 0){let t=this._groups().find(n=>n.id===e.resourceId);t&&this.openPostJoinDialog(t,e.phone,e.keywordSetCount)}}else this.toast.error(`\u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchJoinProgress(e){this.updateQueueItemStatus(e.resourceId,e.success?"joined":"failed",e.error)}handleLeaveResult(e){e.success?(this.updateGroup({id:e.resourceId,joined:!1}),this.toast.success("\u5DF2\u96E2\u958B\u7FA4\u7D44")):this.toast.error(`\u96E2\u958B\u7FA4\u7D44\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var io=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._queueStatuses=f(new Map);this._messages=f([]);this._selectedPhone=f(null);this.queueStatuses=this._queueStatuses.asReadonly();this.messages=this._messages.asReadonly();this.selectedPhone=this._selectedPhone.asReadonly();this._singleMessageDialog=f({isOpen:!1,target:null,targetType:"user",message:"",selectedAccount:""});this._batchMessageDialog=f({isOpen:!1,targets:[],targetType:"user",message:"",selectedAccount:"",delay:5});this.singleMessageDialog=this._singleMessageDialog.asReadonly();this.batchMessageDialog=this._batchMessageDialog.asReadonly();this.totalPending=R(()=>{let e=0;return this._queueStatuses().forEach(t=>{e+=t.pending}),e});this.totalSent=R(()=>{let e=0;return this._queueStatuses().forEach(t=>{e+=t.sent}),e});this.totalFailed=R(()=>{let e=0;return this._queueStatuses().forEach(t=>{e+=t.failed}),e});this.selectedQueueStatus=R(()=>{let e=this._selectedPhone();return e&&this._queueStatuses().get(e)||null});this.selectedQueueMessages=R(()=>{let e=this._selectedPhone();return e?this._messages().filter(t=>t.phone===e):[]})}refreshQueueStatus(e){this.ipc.send("get-queue-status",{phone:e})}setQueueStatuses(e){let t=new Map;for(let n of e)t.set(n.phone,n);this._queueStatuses.set(t)}updateQueueStatus(e){this._queueStatuses.update(t=>{let n=new Map(t);return n.set(e.phone,e),n})}selectQueue(e){this._selectedPhone.set(e),this.loadQueueMessages(e)}loadQueueMessages(e,t,n=100){this.ipc.send("get-queue-messages",{phone:e,status:t,limit:n})}setMessages(e){this._messages.set(e)}retryMessage(e){this.ipc.send("retry-message",{messageId:e}),this.toast.info("\u6B63\u5728\u91CD\u8A66\u767C\u9001...")}cancelMessage(e){this.ipc.send("cancel-message",{messageId:e}),this.toast.info("\u5DF2\u53D6\u6D88\u6D88\u606F")}deleteMessage(e,t){this.ipc.send("delete-queue-message",{phone:e,messageId:t})}updateMessagePriority(e,t,n){this.ipc.send("update-message-priority",{phone:e,messageId:t,priority:n})}pauseQueue(e){this.ipc.send("pause-queue",{phone:e}),this.toast.info("\u968A\u5217\u5DF2\u66AB\u505C")}resumeQueue(e){this.ipc.send("resume-queue",{phone:e}),this.toast.info("\u968A\u5217\u5DF2\u6062\u5FA9")}clearQueue(e,t){confirm(`\u78BA\u5B9A\u8981\u6E05\u7A7A ${e} \u7684${t||"\u6240\u6709"}\u6D88\u606F\u55CE\uFF1F`)&&(this.ipc.send("clear-queue",{phone:e,status:t}),this.toast.info("\u6B63\u5728\u6E05\u7A7A\u968A\u5217..."))}clearPendingQueue(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5F85\u767C\u9001\u7684\u6D88\u606F\u55CE\uFF1F")&&(this.ipc.send("clear-all-pending"),this.toast.info("\u6B63\u5728\u6E05\u7A7A\u5F85\u767C\u9001\u6D88\u606F..."))}openSingleMessageDialog(e,t){this._singleMessageDialog.set({isOpen:!0,target:e,targetType:t,message:"",selectedAccount:""})}closeSingleMessageDialog(){this._singleMessageDialog.update(e=>P(E({},e),{isOpen:!1}))}updateSingleMessageDialog(e){this._singleMessageDialog.update(t=>E(E({},t),e))}executeSingleMessage(){let e=this._singleMessageDialog();if(!e.target||!e.selectedAccount||!e.message.trim()){this.toast.error("\u8ACB\u586B\u5BEB\u5B8C\u6574\u4FE1\u606F");return}this.ipc.send("send-message",{phone:e.selectedAccount,targetId:e.target.id||e.target.telegram_id,targetType:e.targetType,content:e.message.trim()}),this.closeSingleMessageDialog(),this.toast.success("\u6D88\u606F\u5DF2\u52A0\u5165\u767C\u9001\u968A\u5217")}openBatchMessageDialog(e,t){this._batchMessageDialog.set({isOpen:!0,targets:e,targetType:t,message:"",selectedAccount:"",delay:5})}closeBatchMessageDialog(){this._batchMessageDialog.update(e=>P(E({},e),{isOpen:!1}))}updateBatchMessageDialog(e){this._batchMessageDialog.update(t=>E(E({},t),e))}executeBatchMessage(){let e=this._batchMessageDialog();if(e.targets.length===0||!e.selectedAccount||!e.message.trim()){this.toast.error("\u8ACB\u586B\u5BEB\u5B8C\u6574\u4FE1\u606F");return}this.ipc.send("batch-send-message",{phone:e.selectedAccount,targets:e.targets.map(t=>({id:t.id||t.telegram_id,type:e.targetType})),content:e.message.trim(),delay:e.delay}),this.closeBatchMessageDialog(),this.toast.success(`${e.targets.length} \u689D\u6D88\u606F\u5DF2\u52A0\u5165\u767C\u9001\u968A\u5217`)}sendPrivateMessage(e,t){this.openSingleMessageDialog(e,"user"),this.updateSingleMessageDialog({selectedAccount:t})}batchSendPrivateMessage(e){this.openBatchMessageDialog(e,"user")}sendGroupMessage(e,t){this.openSingleMessageDialog(e,"group"),this.updateSingleMessageDialog({selectedAccount:t})}batchSendGroupMessage(e){this.openBatchMessageDialog(e,"group")}handleQueueStatusUpdate(e){this.setQueueStatuses(e)}handleMessagesLoaded(e){this.setMessages(e)}handleMessageSent(e){this._messages.update(t=>t.map(n=>n.id===e.messageId?P(E({},n),{status:e.success?"sent":"failed",error:e.error,sentAt:e.success?new Date().toISOString():void 0}):n))}handleQueueCleared(e){this.toast.success(`\u5DF2\u6E05\u7A7A ${e.count} \u689D\u6D88\u606F`),this.refreshQueueStatus(e.phone)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ls=class i{constructor(){this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.membership=F(Ie);this.i18n=F(Be);this.accounts=F(pt);this.navigation=F(no);this.campaigns=F(Wo);this.templates=F(zo);this.monitoring=F(Hn);this.leads=F(Ko);this.groups=F(jo);this.messages=F(io);this._isInitialized=f(!1);this._isLoading=f(!1);this._systemStatus=f(null);this._currentView=f("dashboard");this.isInitialized=this._isInitialized.asReadonly();this.isLoading=this._isLoading.asReadonly();this.systemStatus=this._systemStatus.asReadonly();this.currentView=this._currentView.asReadonly();this.hasOnlineAccounts=R(()=>(this._systemStatus()?.accounts?.online??0)>0);this.isMonitoringActive=R(()=>this._systemStatus()?.monitoring?.active??!1);this.pendingMessages=R(()=>this._systemStatus()?.queue?.pending??0);this.setupNavSync(),this.setupIpcListeners()}setupNavSync(){}setupIpcListeners(){this.ipc.on("accounts-loaded",e=>{this.accounts.setAccounts(e)}),this.ipc.on("account-status-changed",e=>{this.accounts.updateAccount(e)}),this.ipc.on("login-code-required",e=>{this.accounts.handleCodeRequired(e)}),this.ipc.on("login-2fa-required",e=>{this.accounts.handle2FARequired(e)}),this.ipc.on("login-success",e=>{this.accounts.handleLoginSuccess(e)}),this.ipc.on("login-failed",e=>{this.accounts.handleLoginFailed(e)}),this.ipc.on("join-group-result",e=>{this.groups.handleJoinResult(e)}),this.ipc.on("batch-join-progress",e=>{this.groups.handleBatchJoinProgress(e)}),this.ipc.on("queue-status-update",e=>{this.messages.handleQueueStatusUpdate(e)}),this.ipc.on("message-sent",e=>{this.messages.handleMessageSent(e)}),this.ipc.on("system-status",e=>{this._systemStatus.set(e)})}navigateTo(e){this.nav.navigateTo(e)}goBack(){this.navigation.goBack()}goHome(){this.navigateTo("dashboard")}loginAccount(e){this.accounts.loginAccount(e)}logoutAccount(e){this.accounts.logoutAccount(e)}submitLoginCode(){this.accounts.submitLoginCode()}submitLogin2FA(){this.accounts.submitLogin2FA()}cancelLogin(){this.accounts.cancelLogin()}openJoinMonitorDialog(e){this.groups.openJoinMonitorDialog(e)}executeJoinAndMonitor(){this.groups.executeJoinAndMonitor()}openBatchJoinDialog(e){this.groups.openBatchJoinDialog(e)}leaveGroup(e,t){this.groups.leaveGroup(e,t)}openSingleMessageDialog(e,t){this.messages.openSingleMessageDialog(e,t)}openBatchMessageDialog(e,t){this.messages.openBatchMessageDialog(e,t)}pauseQueue(e){this.messages.pauseQueue(e)}resumeQueue(e){this.messages.resumeQueue(e)}startMonitoring(){this.ipc.send("start-monitoring"),this.toast.info("\u6B63\u5728\u555F\u52D5\u76E3\u63A7...")}stopMonitoring(){this.ipc.send("stop-monitoring"),this.toast.info("\u6B63\u5728\u505C\u6B62\u76E3\u63A7...")}loadCampaigns(){this.campaigns.loadCampaigns()}createCampaign(){this.campaigns.createCampaignFromForm()}startCampaign(e){this.campaigns.startCampaign(e)}loadLeads(){this.leads.loadLeads()}selectLead(e){this.leads.selectLead(e)}async initialize(){if(!this._isInitialized()){this._isLoading.set(!0);try{this.ipc.send("get-accounts"),this.ipc.send("get-system-status"),this.ipc.send("get-config"),this._isInitialized.set(!0)}catch(e){console.error("[AppFacade] Initialization failed:",e),this.toast.error("\u61C9\u7528\u521D\u59CB\u5316\u5931\u6557")}finally{this._isLoading.set(!1)}}}refreshSystemStatus(){this.ipc.send("get-system-status")}reloadAll(){this.ipc.send("get-accounts"),this.ipc.send("get-system-status"),this.campaigns.loadCampaigns(),this.templates.loadTemplates(),this.leads.loadLeads(),this.messages.refreshQueueStatus()}t(e,t){return this.i18n.t(e,t)}hasFeature(e){return this.membership.hasFeature(e)}showSuccess(e){this.toast.success(e)}showError(e){this.toast.error(e)}showInfo(e){this.toast.info(e)}loadResources(){this.ipc.send("get-resources")}loadAiSettings(){this.ipc.send("get-ai-settings")}loadMemberList(e){this.ipc.send("get-member-list",{resourceId:e})}loadLogFiles(){this.ipc.send("get-log-files")}loadLogStats(){this.ipc.send("get-log-stats")}loadSchedulerStatus(){this.ipc.send("get-scheduler-status")}loadWarmupDetails(e){this.ipc.send("get-warmup-details",{accountId:e})}searchChannels(e,t){this.ipc.send("search-channels",E({query:e},t))}extractMembers(e,t,n){this.ipc.send("extract-members",E({resourceId:e,phone:t},n)),this.toast.info("\u958B\u59CB\u63D0\u53D6\u6210\u54E1...")}inviteMembers(e,t,n){this.ipc.send("invite-members",{resourceId:e,userIds:t,phone:n}),this.toast.info(`\u6B63\u5728\u9080\u8ACB ${t.length} \u4F4D\u6210\u54E1...`)}generateAiResponse(e,t){this.ipc.send("generate-ai-response",{prompt:e,context:t})}saveAiSettings(e){this.ipc.send("save-ai-settings",e),this.toast.success("AI \u8A2D\u7F6E\u5DF2\u4FDD\u5B58")}testAiConnection(){this.ipc.send("test-ai-connection"),this.toast.info("\u6B63\u5728\u6E2C\u8A66 AI \u9023\u63A5...")}startAutomation(e){this.campaigns.startCampaign(e)}pauseAutomation(e){this.ipc.send("pause-campaign",{campaignId:e}),this.toast.info("\u6B63\u5728\u66AB\u505C\u6D3B\u52D5...")}stopAutomation(e){this.ipc.send("stop-campaign",{campaignId:e}),this.toast.info("\u6B63\u5728\u505C\u6B62\u6D3B\u52D5...")}createBackup(){this.ipc.send("create-backup"),this.toast.info("\u6B63\u5728\u5275\u5EFA\u5099\u4EFD...")}restoreBackup(e){confirm("\u78BA\u5B9A\u8981\u6062\u5FA9\u6B64\u5099\u4EFD\u55CE\uFF1F\u7576\u524D\u6578\u64DA\u5C07\u88AB\u8986\u84CB\u3002")&&(this.ipc.send("restore-backup",{backupId:e}),this.toast.info("\u6B63\u5728\u6062\u5FA9\u5099\u4EFD..."))}getBackups(){this.ipc.send("get-backups")}exportLeads(e="csv"){this.ipc.send("export-leads",{format:e}),this.toast.info("\u6B63\u5728\u5C0E\u51FA\u7DDA\u7D22...")}exportMembers(e,t="csv"){this.ipc.send("export-members",{resourceId:e,format:t}),this.toast.info("\u6B63\u5728\u5C0E\u51FA\u6210\u54E1...")}exportReport(e="daily"){this.ipc.send("export-report",{type:e}),this.toast.info("\u6B63\u5728\u751F\u6210\u5831\u544A...")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var H_=gi("routeAnimations",[Vi("* <=> *",[vt(":enter, :leave",[et({position:"absolute",top:0,left:0,width:"100%",opacity:0})],{optional:!0}),vt(":leave",[gn("200ms ease-out",et({opacity:0}))],{optional:!0}),vt(":enter",[gn("300ms ease-in",et({opacity:1}))],{optional:!0})])]),q_=gi("routeAnimations",[Vi("* => *",[vt(":enter, :leave",[et({position:"absolute",top:0,left:0,width:"100%"})],{optional:!0}),zs([vt(":leave",[gn("300ms ease-out",et({transform:"translateX(-100%)",opacity:0}))],{optional:!0}),vt(":enter",[et({transform:"translateX(100%)",opacity:0}),gn("300ms ease-out",et({transform:"translateX(0)",opacity:1}))],{optional:!0})])])]),W_=gi("routeAnimations",[Vi("* <=> *",[vt(":enter, :leave",[et({position:"absolute",top:0,left:0,width:"100%"})],{optional:!0}),vt(":leave",[gn("200ms ease-out",et({transform:"scale(0.95)",opacity:0}))],{optional:!0}),vt(":enter",[et({transform:"scale(1.05)",opacity:0}),gn("300ms ease-out",et({transform:"scale(1)",opacity:1}))],{optional:!0})])]),z_=gi("routeAnimations",[Vi("* <=> *",[vt(":enter, :leave",[et({position:"absolute",top:0,left:0,width:"100%"})],{optional:!0}),vt(":leave",[gn("200ms ease-out",et({transform:"translateY(-20px)",opacity:0}))],{optional:!0}),vt(":enter",[et({transform:"translateY(20px)",opacity:0}),gn("300ms ease-out",et({transform:"translateY(0)",opacity:1}))],{optional:!0})])]),K_=gi("routeAnimations",[Vi("* <=> *",[et({position:"relative"}),vt(":enter, :leave",[et({position:"absolute",top:0,left:0,width:"100%",height:"100%"})],{optional:!0}),zs([vt(":leave",[et({opacity:1,transform:"scale(1)"}),gn("200ms ease-out",et({opacity:0,transform:"scale(0.98)"}))],{optional:!0}),vt(":enter",[et({opacity:0,transform:"scale(1.02)"}),gn("300ms 100ms ease-out",et({opacity:1,transform:"scale(1)"}))],{optional:!0})]),vt(":enter",tu(),{optional:!0})])]),j_=gi("routeAnimations",[]);var ii=[{id:"default",name:"\u63A8\u85A6",description:"\u6DE1\u5165 + \u5FAE\u7E2E\u653E\u6548\u679C\uFF0C\u6D41\u66A2\u81EA\u7136",preview:"\u2728"},{id:"fade",name:"\u6DE1\u5165\u6DE1\u51FA",description:"\u7C21\u55AE\u7684\u900F\u660E\u5EA6\u5207\u63DB",preview:"\u{1F32B}\uFE0F"},{id:"slide",name:"\u5DE6\u53F3\u6ED1\u52D5",description:"\u9801\u9762\u5F9E\u53F3\u5074\u6ED1\u5165",preview:"\u27A1\uFE0F"},{id:"slideUp",name:"\u4E0A\u4E0B\u6ED1\u52D5",description:"\u9801\u9762\u5F9E\u4E0B\u65B9\u6ED1\u5165",preview:"\u2B06\uFE0F"},{id:"scale",name:"\u7E2E\u653E",description:"\u9801\u9762\u653E\u5927\u6DE1\u5165",preview:"\u{1F50D}"},{id:"none",name:"\u7121\u52D5\u756B",description:"\u7981\u7528\u6240\u6709\u52D5\u756B\u6548\u679C",preview:"\u23F9\uFE0F"}],z8={default:K_,fade:H_,slide:q_,scale:W_,slideUp:z_,none:j_},Ei=class i{constructor(){this._animationType=f("default");this.animationType=this._animationType.asReadonly();this.currentOption=R(()=>{let e=this._animationType();return ii.find(t=>t.id===e)||ii[0]});this.options=ii;this.loadFromStorage()}setAnimationType(e){this._animationType.set(e),this.saveToStorage()}getAnimation(){return z8[this._animationType()]}nextAnimation(){let e=this._animationType(),n=(ii.findIndex(o=>o.id===e)+1)%ii.length;this.setAnimationType(ii[n].id)}resetToDefault(){this.setAnimationType("default")}isAnimationDisabled(){return this._animationType()==="none"}loadFromStorage(){try{let e=localStorage.getItem("tg-animation-type");e&&ii.some(t=>t.id===e)&&this._animationType.set(e)}catch{}}saveToStorage(){try{localStorage.setItem("tg-animation-type",this._animationType())}catch{}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var uc={theme:"dark",language:"zh-TW",sidebarCollapsed:!1,animationType:"default",autoConnect:!0,autoMonitor:!1,showNotifications:!0,soundEnabled:!0,autoLock:!1,lockTimeout:5,enableAnalytics:!0,logLevel:"info"},Jo=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.i18n=F(Be);this._settings=f(uc);this._credentials=f({});this._isLoading=f(!1);this._isDirty=f(!1);this.settings=this._settings.asReadonly();this.credentials=this._credentials.asReadonly();this.isLoading=this._isLoading.asReadonly();this.isDirty=this._isDirty.asReadonly();this.theme=R(()=>this._settings().theme);this.language=R(()=>this._settings().language);this.sidebarCollapsed=R(()=>this._settings().sidebarCollapsed);this.hasApiCredentials=R(()=>{let e=this._credentials();return!!(e.geminiApiKey||e.openaiApiKey)});this.hasTelegramCredentials=R(()=>{let e=this._credentials();return!!(e.telegramApiId&&e.telegramApiHash)});this.setupIpcListeners(),this.loadSettings()}setupIpcListeners(){this.ipc.on("settings-loaded",e=>{this._settings.set(E(E({},uc),e)),this._isLoading.set(!1)}),this.ipc.on("settings-saved",()=>{this._isDirty.set(!1),this.toast.success("\u8A2D\u7F6E\u5DF2\u4FDD\u5B58")}),this.ipc.on("credentials-loaded",e=>{this._credentials.set(e)})}loadSettings(){this._isLoading.set(!0),this.ipc.send("get-settings"),this.ipc.send("get-credentials")}saveSettings(){this.ipc.send("save-settings",this._settings())}updateSetting(e,t){this._settings.update(n=>P(E({},n),{[e]:t})),this._isDirty.set(!0)}resetSettings(){confirm("\u78BA\u5B9A\u8981\u91CD\u7F6E\u6240\u6709\u8A2D\u7F6E\u55CE\uFF1F")&&(this._settings.set(uc),this._isDirty.set(!0),this.saveSettings())}setTheme(e){this.updateSetting("theme",e),this.applyTheme(e)}toggleTheme(){let t=this._settings().theme==="dark"?"light":"dark";this.setTheme(t)}applyTheme(e){let t=document.documentElement;if(e==="system"){let n=window.matchMedia("(prefers-color-scheme: dark)").matches;t.setAttribute("data-theme",n?"dark":"light")}else t.setAttribute("data-theme",e)}setLanguage(e){this.updateSetting("language",e),this.i18n.setLocale(e)}toggleSidebar(){let e=this._settings().sidebarCollapsed;this.updateSetting("sidebarCollapsed",!e)}setSidebarCollapsed(e){this.updateSetting("sidebarCollapsed",e)}saveCredentials(e){this._credentials.update(t=>E(E({},t),e)),this.ipc.send("save-credentials",this._credentials()),this.toast.success("API \u6191\u8B49\u5DF2\u4FDD\u5B58")}testGeminiConnection(){let e=this._credentials().geminiApiKey;if(!e){this.toast.error("\u8ACB\u5148\u8A2D\u7F6E Gemini API Key");return}this.ipc.send("test-gemini-connection",{apiKey:e}),this.toast.info("\u6B63\u5728\u6E2C\u8A66 Gemini \u9023\u63A5...")}testOpenAiConnection(){let e=this._credentials().openaiApiKey;if(!e){this.toast.error("\u8ACB\u5148\u8A2D\u7F6E OpenAI API Key");return}this.ipc.send("test-openai-connection",{apiKey:e}),this.toast.info("\u6B63\u5728\u6E2C\u8A66 OpenAI \u9023\u63A5...")}testTelegramCredentials(){let e=this._credentials();if(!e.telegramApiId||!e.telegramApiHash){this.toast.error("\u8ACB\u5148\u8A2D\u7F6E Telegram API \u6191\u8B49");return}this.ipc.send("test-telegram-credentials",{apiId:e.telegramApiId,apiHash:e.telegramApiHash}),this.toast.info("\u6B63\u5728\u6E2C\u8A66 Telegram \u6191\u8B49...")}exportSettings(){let e={settings:this._settings(),exportedAt:new Date().toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=`tg-settings-${new Date().toISOString().split("T")[0]}.json`,o.click(),URL.revokeObjectURL(n),this.toast.success("\u8A2D\u7F6E\u5DF2\u5C0E\u51FA")}importSettings(e){let t=new FileReader;t.onload=n=>{try{let o=JSON.parse(n.target?.result);o.settings?(this._settings.set(E(E({},uc),o.settings)),this._isDirty.set(!0),this.saveSettings(),this.toast.success("\u8A2D\u7F6E\u5DF2\u5C0E\u5165")):this.toast.error("\u7121\u6548\u7684\u8A2D\u7F6E\u6587\u4EF6")}catch{this.toast.error("\u8A2D\u7F6E\u6587\u4EF6\u89E3\u6790\u5931\u6557")}},t.readAsText(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var J_={provider:"gemini",model:"gemini-pro",temperature:.7,maxTokens:2048,systemPrompt:"\u4F60\u662F\u4E00\u500B\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u52A9\u624B\uFF0C\u5E6B\u52A9\u7528\u6236\u9032\u884C\u7FA4\u7D44\u7BA1\u7406\u548C\u5BA2\u6236\u958B\u767C\u3002",enableMemory:!0,enableRag:!1},oo=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._settings=f(J_);this._currentSession=f(null);this._sessions=f([]);this._isGenerating=f(!1);this._isConnected=f(!1);this._ragDocuments=f([]);this.settings=this._settings.asReadonly();this.currentSession=this._currentSession.asReadonly();this.sessions=this._sessions.asReadonly();this.isGenerating=this._isGenerating.asReadonly();this.isConnected=this._isConnected.asReadonly();this.ragDocuments=this._ragDocuments.asReadonly();this.currentMessages=R(()=>this._currentSession()?.messages||[]);this.hasMessages=R(()=>(this._currentSession()?.messages.length||0)>0);this.provider=R(()=>this._settings().provider);this.setupIpcListeners(),this.loadSettings()}setupIpcListeners(){this.ipc.on("ai-settings-loaded",e=>{this._settings.set(E(E({},J_),e))}),this.ipc.on("ai-response",e=>{this._isGenerating.set(!1),this.addMessage("assistant",e.content,e.tokens)}),this.ipc.on("ai-response-error",e=>{this._isGenerating.set(!1),this.toast.error(`AI \u56DE\u5FA9\u5931\u6557: ${e.error}`)}),this.ipc.on("ai-connection-status",e=>{this._isConnected.set(e.connected)}),this.ipc.on("chat-sessions-loaded",e=>{this._sessions.set(e)}),this.ipc.on("rag-documents-loaded",e=>{this._ragDocuments.set(e)})}loadSettings(){this.ipc.send("get-ai-settings")}saveSettings(){this.ipc.send("save-ai-settings",this._settings()),this.toast.success("AI \u8A2D\u7F6E\u5DF2\u4FDD\u5B58")}updateSetting(e,t){this._settings.update(n=>P(E({},n),{[e]:t}))}setProvider(e){this.updateSetting("provider",e);let t={gemini:"gemini-pro",openai:"gpt-4",claude:"claude-3-opus",local:"llama2"};this.updateSetting("model",t[e])}sendMessage(e){!e.trim()||this._isGenerating()||(this.addMessage("user",e.trim()),this._isGenerating.set(!0),this.ipc.send("generate-ai-response",{prompt:e.trim(),settings:this._settings(),history:this.currentMessages().slice(-10),enableRag:this._settings().enableRag}))}addMessage(e,t,n){let o={id:crypto.randomUUID(),role:e,content:t,timestamp:new Date().toISOString(),tokens:n};this._currentSession.update(a=>a?P(E({},a),{messages:[...a.messages,o],updatedAt:new Date().toISOString()}):{id:crypto.randomUUID(),title:t.slice(0,30)+(t.length>30?"...":""),messages:[o],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}newSession(){let e=this._currentSession();e&&e.messages.length>0&&this.saveSession(e),this._currentSession.set(null)}loadSession(e){let t=this._sessions().find(n=>n.id===e);t&&this._currentSession.set(t)}saveSession(e){this.ipc.send("save-chat-session",e),this._sessions.update(t=>{let n=t.findIndex(o=>o.id===e.id);return n>=0?(t[n]=e,[...t]):[e,...t]})}deleteSession(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5C0D\u8A71\u55CE\uFF1F")&&(this.ipc.send("delete-chat-session",{sessionId:e}),this._sessions.update(t=>t.filter(n=>n.id!==e)),this._currentSession()?.id===e&&this._currentSession.set(null),this.toast.success("\u5C0D\u8A71\u5DF2\u522A\u9664"))}clearHistory(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5C0D\u8A71\u8A18\u9304\u55CE\uFF1F")&&(this.ipc.send("clear-chat-history"),this._sessions.set([]),this._currentSession.set(null),this.toast.success("\u5C0D\u8A71\u8A18\u9304\u5DF2\u6E05\u7A7A"))}loadRagDocuments(){this.ipc.send("get-rag-documents")}addRagDocument(e){this.ipc.send("add-rag-document",e),this.toast.info("\u6B63\u5728\u6DFB\u52A0\u6587\u6A94...")}deleteRagDocument(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6587\u6A94\u55CE\uFF1F")&&(this.ipc.send("delete-rag-document",{docId:e}),this._ragDocuments.update(t=>t.filter(n=>n.id!==e)),this.toast.success("\u6587\u6A94\u5DF2\u522A\u9664"))}testConnection(){this.ipc.send("test-ai-connection",this._settings()),this.toast.info("\u6B63\u5728\u6E2C\u8A66 AI \u9023\u63A5...")}generateGreeting(e){let t=`\u751F\u6210\u4E00\u689D\u53CB\u597D\u7684\u554F\u5019\u6D88\u606F\uFF0C\u7528\u65BC Telegram \u7FA4\u7D44\u3002${e?`\u80CC\u666F\u4FE1\u606F: ${JSON.stringify(e)}`:""}`;this.sendMessage(t)}generateReply(e,t){let n=`\u8ACB\u91DD\u5C0D\u4EE5\u4E0B\u6D88\u606F\u751F\u6210\u4E00\u689D\u5C08\u696D\u7684\u56DE\u5FA9\uFF1A
    
\u539F\u6D88\u606F\uFF1A${e}
${t?`\u80CC\u666F\u4FE1\u606F: ${JSON.stringify(t)}`:""}

\u8ACB\u751F\u6210\u7C21\u6F54\u3001\u5C08\u696D\u7684\u56DE\u5FA9\u3002`;this.sendMessage(n)}summarizeConversation(){let e=this.currentMessages();if(e.length<2){this.toast.warning("\u5C0D\u8A71\u5167\u5BB9\u592A\u5C11\uFF0C\u7121\u6CD5\u751F\u6210\u6458\u8981");return}let n=`\u8ACB\u7E3D\u7D50\u4EE5\u4E0B\u5C0D\u8A71\u7684\u4E3B\u8981\u5167\u5BB9\uFF1A

${e.map(o=>`${o.role==="user"?"\u7528\u6236":"AI"}\uFF1A${o.content}`).join(`
`)}`;this.sendMessage(n)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ro=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._resources=f([]);this._selectedIds=f(new Set);this._filter=f({type:"all",status:"all"});this._isLoading=f(!1);this._searchResults=f([]);this._isSearching=f(!1);this.resources=this._resources.asReadonly();this.selectedIds=this._selectedIds.asReadonly();this.filter=this._filter.asReadonly();this.isLoading=this._isLoading.asReadonly();this.searchResults=this._searchResults.asReadonly();this.isSearching=this._isSearching.asReadonly();this.filteredResources=R(()=>{let e=this._resources(),t=this._filter();return e.filter(n=>{if(t.type&&t.type!=="all"&&n.type!==t.type||t.status&&t.status!=="all"&&n.status!==t.status)return!1;if(t.search){let o=t.search.toLowerCase(),a=n.title?.toLowerCase().includes(o),d=n.username?.toLowerCase().includes(o);if(!a&&!d)return!1}return!(t.hasMembers!==void 0&&(t.hasMembers&&!n.member_count||!t.hasMembers&&n.member_count)||t.isPublic!==void 0&&n.is_public!==t.isPublic)})});this.stats=R(()=>{let e=this._resources(),t={group:0,channel:0,user:0,bot:0},n={discovered:0,joined:0,monitored:0,left:0},o=0;for(let a of e)t[a.type]!==void 0&&t[a.type]++,n[a.status]!==void 0&&n[a.status]++,o+=a.member_count||0;return{total:e.length,byType:t,byStatus:n,totalMembers:o}});this.selectedResources=R(()=>{let e=this._selectedIds();return this._resources().filter(t=>e.has(t.id))});this.selectedCount=R(()=>this._selectedIds().size);this.groups=R(()=>this._resources().filter(e=>e.type==="group"));this.channels=R(()=>this._resources().filter(e=>e.type==="channel"));this.joinedResources=R(()=>this._resources().filter(e=>e.status==="joined"));this.monitoredResources=R(()=>this._resources().filter(e=>e.status==="monitored"));this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("resources-loaded",e=>{this._resources.set(e),this._isLoading.set(!1)}),this.ipc.on("resource-updated",e=>{this._resources.update(t=>t.map(n=>n.id===e.id?E(E({},n),e):n))}),this.ipc.on("search-results",e=>{this._searchResults.set(e),this._isSearching.set(!1)}),this.ipc.on("search-error",e=>{this._isSearching.set(!1),this.toast.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)})}loadResources(){this._isLoading.set(!0),this.ipc.send("get-resources")}refreshResources(){this.ipc.send("refresh-resources"),this.toast.info("\u6B63\u5728\u5237\u65B0\u8CC7\u6E90...")}getResource(e){return this._resources().find(t=>t.id===e)}updateResource(e,t){this._resources.update(n=>n.map(o=>o.id===e?E(E({},o),t):o)),this.ipc.send("update-resource",{id:e,updates:t})}deleteResource(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u8CC7\u6E90\u55CE\uFF1F")&&(this._resources.update(t=>t.filter(n=>n.id!==e)),this._selectedIds.update(t=>{let n=new Set(t);return n.delete(e),n}),this.ipc.send("delete-resource",{id:e}),this.toast.success("\u8CC7\u6E90\u5DF2\u522A\u9664"))}toggleSelection(e){this._selectedIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}selectAll(){let e=new Set(this.filteredResources().map(t=>t.id));this._selectedIds.set(e)}deselectAll(){this._selectedIds.set(new Set)}isSelected(e){return this._selectedIds().has(e)}setFilter(e){this._filter.update(t=>E(E({},t),e))}clearFilter(){this._filter.set({type:"all",status:"all"})}setSearch(e){this._filter.update(t=>P(E({},t),{search:e}))}search(e){this._isSearching.set(!0),this._searchResults.set([]),this.ipc.send("search-resources",e),this.toast.info("\u6B63\u5728\u641C\u7D22...")}clearSearchResults(){this._searchResults.set([])}addSearchResultToResources(e){this._resources.update(t=>t.some(n=>n.telegram_id===e.telegram_id)?t:[...t,e])}batchJoin(e){let t=this.selectedResources();if(t.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipc.send("batch-join-resources",{resourceIds:t.map(n=>n.id),phone:e}),this.toast.info(`\u6B63\u5728\u52A0\u5165 ${t.length} \u500B\u8CC7\u6E90...`)}batchLeave(e){let t=this.selectedResources();if(t.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}confirm(`\u78BA\u5B9A\u8981\u96E2\u958B ${t.length} \u500B\u8CC7\u6E90\u55CE\uFF1F`)&&(this.ipc.send("batch-leave-resources",{resourceIds:t.map(n=>n.id),phone:e}),this.toast.info(`\u6B63\u5728\u96E2\u958B ${t.length} \u500B\u8CC7\u6E90...`))}batchDelete(){let e=this.selectedResources();if(e.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${e.length} \u500B\u8CC7\u6E90\u55CE\uFF1F`))return;let t=e.map(n=>n.id);this._resources.update(n=>n.filter(o=>!t.includes(o.id))),this._selectedIds.set(new Set),this.ipc.send("batch-delete-resources",{resourceIds:t}),this.toast.success(`\u5DF2\u522A\u9664 ${e.length} \u500B\u8CC7\u6E90`)}addTag(e,t){this._resources.update(n=>n.map(o=>{if(o.id===e){let a=o.tags||[];if(!a.includes(t))return P(E({},o),{tags:[...a,t]})}return o})),this.ipc.send("add-resource-tag",{resourceId:e,tag:t})}removeTag(e,t){this._resources.update(n=>n.map(o=>o.id===e&&o.tags?P(E({},o),{tags:o.tags.filter(a=>a!==t)}):o)),this.ipc.send("remove-resource-tag",{resourceId:e,tag:t})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Qo=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._jobs=f([]);this._currentJob=f(null);this._templates=f([]);this._isExporting=f(!1);this.jobs=this._jobs.asReadonly();this.currentJob=this._currentJob.asReadonly();this.templates=this._templates.asReadonly();this.isExporting=this._isExporting.asReadonly();this.setupIpcListeners(),this.loadTemplates()}setupIpcListeners(){this.ipc.on("export-started",e=>{this._currentJob.set(e),this._jobs.update(t=>[e,...t]),this._isExporting.set(!0)}),this.ipc.on("export-progress",e=>{this._jobs.update(t=>t.map(n=>n.id===e.jobId?P(E({},n),{progress:e.progress}):n)),this._currentJob()?.id===e.jobId&&this._currentJob.update(t=>t&&P(E({},t),{progress:e.progress}))}),this.ipc.on("export-completed",e=>{this._jobs.update(t=>t.map(n=>n.id===e.jobId?P(E({},n),{status:"completed",progress:100,filePath:e.filePath,completedAt:new Date().toISOString()}):n)),this._currentJob.set(null),this._isExporting.set(!1),this.toast.success("\u5C0E\u51FA\u5B8C\u6210\uFF01")}),this.ipc.on("export-failed",e=>{this._jobs.update(t=>t.map(n=>n.id===e.jobId?P(E({},n),{status:"failed",error:e.error}):n)),this._currentJob.set(null),this._isExporting.set(!1),this.toast.error(`\u5C0E\u51FA\u5931\u6557: ${e.error}`)})}exportLeads(e="csv",t){this.startExport(E({format:e,type:"leads",includeHeaders:!0},t))}exportMembers(e,t="csv",n){this.startExport(E({format:t,type:"members",filters:{resourceId:e},includeHeaders:!0},n))}exportResources(e="csv",t){this.startExport(E({format:e,type:"resources",includeHeaders:!0},t))}exportMessages(e="json",t){this.startExport(E({format:e,type:"messages"},t))}exportAnalytics(e="xlsx",t){this.startExport(E({format:e,type:"analytics"},t))}exportReport(e,t="pdf"){this.startExport({format:t,type:"report",filters:{reportType:e}})}startExport(e){if(this._isExporting()){this.toast.warning("\u6B63\u5728\u9032\u884C\u5C0E\u51FA\uFF0C\u8ACB\u7B49\u5F85\u5B8C\u6210");return}this.ipc.send("start-export",e),this.toast.info("\u958B\u59CB\u5C0E\u51FA...")}cancelExport(){let e=this._currentJob();e&&(this.ipc.send("cancel-export",{jobId:e.id}),this._currentJob.set(null),this._isExporting.set(!1),this.toast.info("\u5DF2\u53D6\u6D88\u5C0E\u51FA"))}openExportFile(e){if(!e.filePath){this.toast.error("\u6587\u4EF6\u8DEF\u5F91\u4E0D\u5B58\u5728");return}this.ipc.send("open-file",{path:e.filePath})}openExportFolder(e){if(!e.filePath){this.toast.error("\u6587\u4EF6\u8DEF\u5F91\u4E0D\u5B58\u5728");return}this.ipc.send("open-folder",{path:e.filePath})}clearHistory(){confirm("\u78BA\u5B9A\u8981\u6E05\u9664\u5C0E\u51FA\u6B77\u53F2\u55CE\uFF1F")&&(this._jobs.set([]),this.toast.success("\u5C0E\u51FA\u6B77\u53F2\u5DF2\u6E05\u9664"))}deleteJob(e){this._jobs.update(t=>t.filter(n=>n.id!==e))}loadTemplates(){try{let e=localStorage.getItem("export-templates");e&&this._templates.set(JSON.parse(e))}catch{}}saveTemplate(e){let t=P(E({},e),{id:crypto.randomUUID()});this._templates.update(n=>[...n,t]),this.saveTemplatesToStorage(),this.toast.success("\u6A21\u677F\u5DF2\u4FDD\u5B58")}deleteTemplate(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6A21\u677F\u55CE\uFF1F")&&(this._templates.update(t=>t.filter(n=>n.id!==e)),this.saveTemplatesToStorage(),this.toast.success("\u6A21\u677F\u5DF2\u522A\u9664"))}useTemplate(e){let t=this._templates().find(n=>n.id===e);if(!t){this.toast.error("\u6A21\u677F\u4E0D\u5B58\u5728");return}this.startExport(E({format:t.options.format||"csv",type:t.type},t.options))}saveTemplatesToStorage(){try{localStorage.setItem("export-templates",JSON.stringify(this._templates()))}catch{}}getFormatIcon(e){return{csv:"\u{1F4CA}",xlsx:"\u{1F4D7}",json:"\u{1F4CB}",pdf:"\u{1F4D5}"}[e]||"\u{1F4C4}"}getFormatName(e){return{csv:"CSV",xlsx:"Excel",json:"JSON",pdf:"PDF"}[e]||e.toUpperCase()}getTypeName(e){return{leads:"\u7DDA\u7D22",members:"\u6210\u54E1",resources:"\u8CC7\u6E90",messages:"\u6D88\u606F",analytics:"\u5206\u6790",report:"\u5831\u544A"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var cs=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._isInitialized=f(!1);this._isLoading=f(!1);this._isIndexing=f(!1);this._stats=f({totalDocuments:0,totalChunks:0,lastIndexed:null,indexSize:"0 KB",categories:{}});this._searchResults=f([]);this._searchQuery=f("");this.isInitialized=this._isInitialized.asReadonly();this.isLoading=this._isLoading.asReadonly();this.isIndexing=this._isIndexing.asReadonly();this.stats=this._stats.asReadonly();this.searchResults=this._searchResults.asReadonly();this.searchQuery=this._searchQuery.asReadonly();this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("rag-initialized",e=>{this._isInitialized.set(e.success),this._isLoading.set(!1),e.success&&(this.toast.success("RAG \u7CFB\u7D71\u521D\u59CB\u5316\u6210\u529F"),this.refreshStats())}),this.ipc.on("rag-stats",e=>{this._stats.set(e),this._isLoading.set(!1)}),this.ipc.on("rag-search-results",e=>{this._searchResults.set(e.results),this._isLoading.set(!1)}),this.ipc.on("rag-indexing-started",()=>{this._isIndexing.set(!0),this.toast.info("\u958B\u59CB\u7D22\u5F15\u77E5\u8B58\u5EAB...")}),this.ipc.on("rag-indexing-completed",e=>{this._isIndexing.set(!1),this.toast.success(`\u7D22\u5F15\u5B8C\u6210\uFF0C\u5171\u8655\u7406 ${e.count} \u500B\u6587\u6A94`),this.refreshStats()}),this.ipc.on("rag-indexing-error",e=>{this._isIndexing.set(!1),this.toast.error(`\u7D22\u5F15\u5931\u6557: ${e.error}`)}),this.ipc.on("rag-knowledge-added",()=>{this.toast.success("\u77E5\u8B58\u5DF2\u6DFB\u52A0"),this.refreshStats()}),this.ipc.on("rag-cleanup-completed",e=>{this.toast.success(`\u5DF2\u6E05\u7406 ${e.removed} \u500B\u904E\u6642\u77E5\u8B58`),this.refreshStats()})}initRagSystem(){this._isLoading.set(!0),this.ipc.send("init-rag-system")}triggerLearning(){this.ipc.send("rag-trigger-learning")}reindexConversations(){this.ipc.send("rag-reindex-conversations")}reindexHighValueConversations(){this.ipc.send("rag-reindex-high-value")}search(e){if(!e.trim()){this._searchResults.set([]);return}this._searchQuery.set(e),this._isLoading.set(!0),this.ipc.send("rag-search",{query:e})}clearSearchResults(){this._searchResults.set([]),this._searchQuery.set("")}addKnowledge(e,t,n){this.ipc.send("rag-add-knowledge",{content:e,category:t,metadata:n})}deleteKnowledge(e){this.ipc.send("rag-delete-knowledge",{id:e})}sendFeedback(e){this.ipc.send("rag-feedback",e),this.toast.success("\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF01")}cleanupKnowledge(){this.ipc.send("rag-cleanup")}refreshStats(){this._isLoading.set(!0),this.ipc.send("get-rag-stats")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var mc=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._stats=f({totalMemories:0,totalUsers:0,averagePerUser:0,storageSize:"0 KB",oldestMemory:null,newestMemory:null});this._memories=f([]);this._searchResults=f([]);this._users=f([]);this._isLoading=f(!1);this._selectedUserId=f(null);this.stats=this._stats.asReadonly();this.memories=this._memories.asReadonly();this.searchResults=this._searchResults.asReadonly();this.users=this._users.asReadonly();this.isLoading=this._isLoading.asReadonly();this.selectedUserId=this._selectedUserId.asReadonly();this.userMemories=R(()=>{let e=this._selectedUserId();return e?this._memories().filter(t=>t.userId===e):[]});this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("vector-memory-stats",e=>{this._stats.set(e),this._isLoading.set(!1)}),this.ipc.on("vector-memories-loaded",e=>{this._memories.set(e),this._isLoading.set(!1)}),this.ipc.on("vector-memory-search-results",e=>{this._searchResults.set(e.results),this._isLoading.set(!1)}),this.ipc.on("memory-users-loaded",e=>{this._users.set(e),this._isLoading.set(!1)}),this.ipc.on("vector-memory-added",e=>{this._memories.update(t=>[...t,e]),this.toast.success("\u8A18\u61B6\u5DF2\u6DFB\u52A0")}),this.ipc.on("vector-memory-deleted",e=>{this._memories.update(t=>t.filter(n=>n.id!==e.id)),this.toast.success("\u8A18\u61B6\u5DF2\u522A\u9664")}),this.ipc.on("cleanup-completed",e=>{this.toast.success(`\u5DF2\u6E05\u7406 ${e.removed} \u500B\u904E\u671F\u8A18\u61B6`),this.refreshStats()}),this.ipc.on("merge-completed",e=>{this.toast.success(`\u5DF2\u5408\u4F75 ${e.merged} \u500B\u76F8\u4F3C\u8A18\u61B6`),this.refreshStats()})}search(e,t){if(!e.trim()){this._searchResults.set([]);return}this._isLoading.set(!0),this.ipc.send("search-vector-memory",{query:e,userId:t})}clearSearchResults(){this._searchResults.set([])}addMemory(e,t,n){this.ipc.send("add-vector-memory",{userId:e,content:t,metadata:n})}deleteMemory(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u8A18\u61B6\u55CE\uFF1F")&&this.ipc.send("delete-vector-memory",{id:e})}loadUserMemories(e){this._selectedUserId.set(e),this._isLoading.set(!0),this.ipc.send("get-user-memories",{userId:e})}loadUserList(){this._isLoading.set(!0),this.ipc.send("get-memory-users")}selectUser(e){this._selectedUserId.set(e),e&&this.loadUserMemories(e)}cleanupOldMemories(e=90){confirm(`\u78BA\u5B9A\u8981\u6E05\u7406 ${e} \u5929\u524D\u7684\u820A\u8A18\u61B6\u55CE\uFF1F`)&&this.ipc.send("cleanup-old-memories",{daysOld:e})}mergeSimilarMemories(e=.9){confirm("\u78BA\u5B9A\u8981\u5408\u4F75\u76F8\u4F3C\u8A18\u61B6\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002")&&this.ipc.send("merge-similar-memories",{threshold:e})}refreshStats(){this._isLoading.set(!0),this.ipc.send("get-vector-memory-stats")}loadAllMemories(){this._isLoading.set(!0),this.ipc.send("get-all-memories")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Yo=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._backups=f([]);this._isLoading=f(!1);this._isCreating=f(!1);this._isRestoring=f(!1);this._settings=f({autoBackup:!1,interval:24,maxBackups:10,includeMedia:!1});this.backups=this._backups.asReadonly();this.isLoading=this._isLoading.asReadonly();this.isCreating=this._isCreating.asReadonly();this.isRestoring=this._isRestoring.asReadonly();this.settings=this._settings.asReadonly();this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("backups-loaded",e=>{this._backups.set(e),this._isLoading.set(!1)}),this.ipc.on("backup-created",e=>{this._backups.update(t=>[e,...t]),this._isCreating.set(!1),this.toast.success("\u5099\u4EFD\u5275\u5EFA\u6210\u529F\uFF01")}),this.ipc.on("backup-create-error",e=>{this._isCreating.set(!1),this.toast.error(`\u5099\u4EFD\u5275\u5EFA\u5931\u6557: ${e.error}`)}),this.ipc.on("backup-restored",()=>{this._isRestoring.set(!1),this.toast.success("\u5099\u4EFD\u6062\u5FA9\u6210\u529F\uFF01\u61C9\u7528\u5C07\u91CD\u65B0\u52A0\u8F09..."),setTimeout(()=>window.location.reload(),2e3)}),this.ipc.on("backup-restore-error",e=>{this._isRestoring.set(!1),this.toast.error(`\u5099\u4EFD\u6062\u5FA9\u5931\u6557: ${e.error}`)}),this.ipc.on("backup-deleted",e=>{this._backups.update(t=>t.filter(n=>n.id!==e.id)),this.toast.success("\u5099\u4EFD\u5DF2\u522A\u9664")}),this.ipc.on("backup-settings-loaded",e=>{this._settings.set(e)})}loadBackups(){this._isLoading.set(!0),this.ipc.send("get-backups")}createBackup(e){this._isCreating.set(!0),this.ipc.send("create-backup",{description:e})}restoreBackup(e){confirm("\u78BA\u5B9A\u8981\u6062\u5FA9\u6B64\u5099\u4EFD\u55CE\uFF1F\u7576\u524D\u6578\u64DA\u5C07\u88AB\u8986\u84CB\u3002")&&(this._isRestoring.set(!0),this.ipc.send("restore-backup",{id:e}))}deleteBackup(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5099\u4EFD\u55CE\uFF1F")&&this.ipc.send("delete-backup",{id:e})}loadSettings(){this.ipc.send("get-backup-settings")}updateSettings(e){this._settings.update(t=>E(E({},t),e)),this.ipc.send("save-backup-settings",this._settings()),this.toast.success("\u5099\u4EFD\u8A2D\u7F6E\u5DF2\u4FDD\u5B58")}toggleAutoBackup(){this.updateSettings({autoBackup:!this._settings().autoBackup})}formatSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`}getBackupAge(e){let t=new Date(e),o=new Date().getTime()-t.getTime(),a=Math.floor(o/(1e3*60*60*24));return a===0?"\u4ECA\u5929":a===1?"\u6628\u5929":a<7?`${a} \u5929\u524D`:a<30?`${Math.floor(a/7)} \u9031\u524D`:`${Math.floor(a/30)} \u500B\u6708\u524D`}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Xo=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._status=f({isRunning:!1,uptime:0,totalTasks:0,activeTasks:0,tasks:[]});this._logs=f([]);this._isLoading=f(!1);this.status=this._status.asReadonly();this.logs=this._logs.asReadonly();this.isLoading=this._isLoading.asReadonly();this.isRunning=R(()=>this._status().isRunning);this.tasks=R(()=>this._status().tasks);this.activeTasks=R(()=>this._status().tasks.filter(e=>e.status==="running"));this.idleTasks=R(()=>this._status().tasks.filter(e=>e.status==="idle"));this.errorTasks=R(()=>this._status().tasks.filter(e=>e.status==="error"));this.uptimeFormatted=R(()=>{let e=this._status().uptime,t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60;return t>0?`${t}h ${n}m`:n>0?`${n}m ${o}s`:`${o}s`});this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("scheduler-status",e=>{this._status.set(e),this._isLoading.set(!1)}),this.ipc.on("scheduler-started",()=>{this._status.update(e=>P(E({},e),{isRunning:!0})),this.toast.success("\u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5")}),this.ipc.on("scheduler-stopped",()=>{this._status.update(e=>P(E({},e),{isRunning:!1})),this.toast.info("\u8ABF\u5EA6\u5668\u5DF2\u505C\u6B62")}),this.ipc.on("scheduler-task-started",e=>{this._status.update(t=>P(E({},t),{tasks:t.tasks.map(n=>n.name===e.taskName?P(E({},n),{status:"running"}):n)}))}),this.ipc.on("scheduler-task-completed",e=>{this._status.update(t=>P(E({},t),{tasks:t.tasks.map(n=>n.name===e.taskName?P(E({},n),{status:"idle",lastRun:new Date().toISOString(),runCount:n.runCount+1}):n)}))}),this.ipc.on("scheduler-task-error",e=>{this._status.update(t=>P(E({},t),{tasks:t.tasks.map(n=>n.name===e.taskName?P(E({},n),{status:"error",errorMessage:e.error}):n)})),this.toast.error(`\u4EFB\u52D9 ${e.taskName} \u57F7\u884C\u5931\u6557`)}),this.ipc.on("scheduler-logs",e=>{this._logs.set(e)})}loadStatus(){this._isLoading.set(!0),this.ipc.send("get-scheduler-status")}start(){this.ipc.send("start-scheduler")}stop(){this.ipc.send("stop-scheduler")}restart(){this.ipc.send("restart-scheduler"),this.toast.info("\u6B63\u5728\u91CD\u555F\u8ABF\u5EA6\u5668...")}runTask(e){this.ipc.send("run-scheduler-task",{taskName:e}),this.toast.info(`\u6B63\u5728\u57F7\u884C\u4EFB\u52D9: ${e}`)}enableTask(e){this.ipc.send("enable-scheduler-task",{taskName:e}),this._status.update(t=>P(E({},t),{tasks:t.tasks.map(n=>n.name===e?P(E({},n),{enabled:!0,status:"idle"}):n)}))}disableTask(e){this.ipc.send("disable-scheduler-task",{taskName:e}),this._status.update(t=>P(E({},t),{tasks:t.tasks.map(n=>n.name===e?P(E({},n),{enabled:!1,status:"disabled"}):n)}))}updateTaskInterval(e,t){this.ipc.send("update-task-interval",{taskName:e,interval:t}),this._status.update(n=>P(E({},n),{tasks:n.tasks.map(o=>o.name===e?P(E({},o),{interval:t}):o)})),this.toast.success("\u4EFB\u52D9\u9593\u9694\u5DF2\u66F4\u65B0")}loadLogs(e=100){this.ipc.send("get-scheduler-logs",{limit:e})}clearLogs(){confirm("\u78BA\u5B9A\u8981\u6E05\u9664\u6240\u6709\u8ABF\u5EA6\u65E5\u8A8C\u55CE\uFF1F")&&(this.ipc.send("clear-scheduler-logs"),this._logs.set([]),this.toast.success("\u8ABF\u5EA6\u65E5\u8A8C\u5DF2\u6E05\u9664"))}getTaskStatusColor(e){switch(e){case"running":return"text-green-400";case"idle":return"text-slate-400";case"error":return"text-red-400";case"disabled":return"text-slate-600";default:return"text-slate-400"}}getTaskStatusIcon(e){switch(e){case"running":return"\u{1F7E2}";case"idle":return"\u26AA";case"error":return"\u{1F534}";case"disabled":return"\u26AB";default:return"\u26AA"}}formatInterval(e){return e<60?`${e} \u79D2`:e<3600?`${Math.floor(e/60)} \u5206\u9418`:e<86400?`${Math.floor(e/3600)} \u5C0F\u6642`:`${Math.floor(e/86400)} \u5929`}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var rn={conversion:{icon:"\u{1F4B0}",label:"\u4FC3\u9032\u9996\u55AE",description:"\u628A\u7336\u8C6B\u4E0D\u6C7A\u7684\u6F5B\u5728\u5BA2\u6236\u8F49\u5316\u70BA\u4ED8\u8CBB\u7528\u6236",suggestedRoles:["expert","satisfied_customer","sales"],suggestedMode:"hybrid"},retention:{icon:"\u{1F49D}",label:"\u633D\u56DE\u6D41\u5931",description:"\u633D\u56DE\u5DF2\u6D41\u5931\u7684\u8001\u5BA2\u6236\uFF0C\u8B93\u4ED6\u5011\u91CD\u65B0\u8CFC\u8CB7",suggestedRoles:["callback","support","manager"],suggestedMode:"hybrid"},engagement:{icon:"\u{1F389}",label:"\u793E\u7FA4\u6D3B\u8E8D",description:"\u8B93\u793E\u7FA4\u66F4\u6D3B\u8E8D\uFF0C\u589E\u52A0\u7528\u6236\u4E92\u52D5\u548C\u7C98\u6027",suggestedRoles:["newbie","satisfied_customer","expert"],suggestedMode:"scriptless"},support:{icon:"\u{1F527}",label:"\u552E\u5F8C\u670D\u52D9",description:"\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C\uFF0C\u63D0\u5347\u6EFF\u610F\u5EA6",suggestedRoles:["support","expert","manager"],suggestedMode:"scripted"}};function Q_(i="conversion"){let e=rn[i];return{goalType:i,executionMode:e.suggestedMode,status:"draft",targetCount:0,stats:{totalContacts:0,contacted:0,replied:0,converted:0,messagesSent:0,aiCost:0,contactRate:0,replyRate:0,conversionRate:0}}}var Di=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._tasks=f([]);this.tasks=this._tasks.asReadonly();this._currentTask=f(null);this.currentTask=this._currentTask.asReadonly();this._isLoading=f(!1);this.isLoading=this._isLoading.asReadonly();this.activeTasks=R(()=>this._tasks().filter(e=>e.status==="running"||e.status==="scheduled"));this.todayStats=R(()=>{let e=new Date().toISOString().split("T")[0],t=this._tasks().filter(n=>n.createdAt.startsWith(e)||n.startedAt?.startsWith(e));return{totalTasks:t.length,contacted:t.reduce((n,o)=>n+o.stats.contacted,0),converted:t.reduce((n,o)=>n+o.stats.converted,0),messagesSent:t.reduce((n,o)=>n+o.stats.messagesSent,0),aiCost:t.reduce((n,o)=>n+o.stats.aiCost,0)}});this.tasksByGoal=R(()=>{let e={conversion:[],retention:[],engagement:[],support:[]};return this._tasks().forEach(t=>{e[t.goalType]?.push(t)}),e});this.overallConversionRate=R(()=>{let e=this._tasks().filter(o=>o.stats.contacted>0);if(e.length===0)return 0;let t=e.reduce((o,a)=>o+a.stats.contacted,0),n=e.reduce((o,a)=>o+a.stats.converted,0);return t>0?Math.round(n/t*100):0});this.setupIpcListeners(),this.loadTasks()}setupIpcListeners(){this.ipc.on("marketing-tasks-loaded",e=>{e.success&&e.tasks&&this._tasks.set(e.tasks.map(this.normalizeTask)),this._isLoading.set(!1)}),this.ipc.on("marketing-task-created",e=>{e.success&&e.task?(this._tasks.update(t=>[...t,this.normalizeTask(e.task)]),this.toast.success(`\u4EFB\u52D9\u300C${e.task.name}\u300D\u5275\u5EFA\u6210\u529F`)):this.toast.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}),this.ipc.on("marketing-task-updated",e=>{e.success&&e.task&&this._tasks.update(t=>t.map(n=>n.id===e.task.id?this.normalizeTask(e.task):n))}),this.ipc.on("marketing-task-stats",e=>{e.taskId&&e.stats&&this._tasks.update(t=>t.map(n=>n.id===e.taskId?P(E({},n),{stats:E(E({},n.stats),e.stats)}):n))}),this.ipc.on("marketing-task-deleted",e=>{e.success&&e.taskId&&(this._tasks.update(t=>t.filter(n=>n.id!==e.taskId)),this.toast.success("\u4EFB\u52D9\u5DF2\u522A\u9664"))})}loadTasks(){this._isLoading.set(!0),this.ipc.send("get-marketing-tasks",{})}async createTask(e){let t=P(E(E({},Q_(e.goalType)),e),{createdAt:new Date().toISOString()});return new Promise(n=>{let o=this.ipc.on("marketing-task-created",a=>{o(),n(a.success?a.task?.id:null)});this.ipc.send("create-marketing-task",t),setTimeout(()=>{o(),n(null)},1e4)})}async quickCreate(e,t){let n=rn[e];return this.createTask({name:`${n.label} - ${new Date().toLocaleDateString()}`,goalType:e,executionMode:n.suggestedMode,description:n.description,roleConfig:n.suggestedRoles.map(o=>({roleType:o,roleName:o}))})}updateTask(e,t){this.ipc.send("update-marketing-task",E({id:e},t))}deleteTask(e){this.ipc.send("delete-marketing-task",{id:e})}startTask(e){this.updateTask(e,{status:"running",startedAt:new Date().toISOString()}),this.ipc.send("start-marketing-task",{id:e})}pauseTask(e){this.updateTask(e,{status:"paused"}),this.ipc.send("pause-marketing-task",{id:e})}resumeTask(e){this.updateTask(e,{status:"running"}),this.ipc.send("resume-marketing-task",{id:e})}completeTask(e){this.updateTask(e,{status:"completed",completedAt:new Date().toISOString()}),this.ipc.send("complete-marketing-task",{id:e})}batchStartTasks(e){e.forEach(t=>this.startTask(t))}batchPauseTasks(e){e.forEach(t=>this.pauseTask(t))}batchResumeTasks(e){e.forEach(t=>this.resumeTask(t))}batchCompleteTasks(e){e.forEach(t=>this.completeTask(t))}batchDeleteTasks(e){e.forEach(t=>this.deleteTask(t))}async batchDuplicateTasks(e){let t=[];for(let n of e){let o=this._tasks().find(d=>d.id===n);if(!o)continue;let a=await this.createTask({name:`${o.name} (\u8907\u88FD)`,description:o.description,goalType:o.goalType,executionMode:o.executionMode,roleConfig:o.roleConfig,targetCriteria:o.targetCriteria,scheduleConfig:o.scheduleConfig});a&&t.push(a)}return t}getBatchOperationTasks(e){return e?this._tasks().filter(t=>t.status===e):this._tasks()}addTargets(e,t){this.ipc.send("add-marketing-task-targets",{taskId:e,targets:t})}updateTargetStatus(e,t,n,o){this.ipc.send("update-marketing-task-target",{taskId:e,targetId:t,status:n,outcome:o})}async getTaskTargets(e){return new Promise(t=>{let n=this.ipc.on("marketing-task-targets-loaded",o=>{n(),t(o.success?o.targets:[])});this.ipc.send("get-marketing-task-targets",{taskId:e}),setTimeout(()=>{n(),t([])},5e3)})}assignRole(e,t){this.ipc.send("assign-marketing-task-role",E({taskId:e},t))}async autoAssignRoles(e){return new Promise(t=>{let n=this.ipc.on("marketing-task-roles-assigned",o=>{n(),o.success&&this.toast.success(`\u5DF2\u81EA\u52D5\u5206\u914D ${o.assignedCount} \u500B\u89D2\u8272`),t(o.success)});this.ipc.send("auto-assign-marketing-task-roles",{taskId:e}),setTimeout(()=>{n(),t(!1)},1e4)})}async getTaskStats(e){return new Promise(t=>{let n=this.ipc.on("marketing-task-stats-loaded",o=>{n(),t(o.success?o.stats:null)});this.ipc.send("get-marketing-task-stats",{taskId:e}),setTimeout(()=>{n(),t(null)},5e3)})}getOverallStats(){let e=this._tasks();return{totalTasks:e.length,activeTasks:this.activeTasks().length,totalContacted:e.reduce((t,n)=>t+n.stats.contacted,0),totalConverted:e.reduce((t,n)=>t+n.stats.converted,0),conversionRate:this.overallConversionRate(),totalMessagesSent:e.reduce((t,n)=>t+n.stats.messagesSent,0),totalAiCost:e.reduce((t,n)=>t+n.stats.aiCost,0)}}normalizeTask(e){return{id:String(e.id),name:e.name||"\u672A\u547D\u540D\u4EFB\u52D9",description:e.description,goalType:e.goal_type||e.goalType||"conversion",aiConfigId:e.ai_config_id||e.aiConfigId,executionMode:e.execution_mode||e.executionMode||"hybrid",status:e.status||"draft",currentStage:e.current_stage||e.currentStage,targetCount:e.target_count||e.targetCount||0,targetCriteria:e.target_criteria?JSON.parse(e.target_criteria):e.targetCriteria,roleConfig:e.role_config?JSON.parse(e.role_config):e.roleConfig,scriptId:e.script_id||e.scriptId,scheduleConfig:e.schedule_config?JSON.parse(e.schedule_config):e.scheduleConfig,triggerConditions:e.trigger_conditions?JSON.parse(e.trigger_conditions):e.triggerConditions,stats:{totalContacts:e.stats_total_contacts||e.stats?.totalContacts||0,contacted:e.stats_contacted||e.stats?.contacted||0,replied:e.stats_replied||e.stats?.replied||0,converted:e.stats_converted||e.stats?.converted||0,messagesSent:e.stats_messages_sent||e.stats?.messagesSent||0,aiCost:e.stats_ai_cost||e.stats?.aiCost||0,contactRate:0,replyRate:0,conversionRate:0},createdAt:e.created_at||e.createdAt||new Date().toISOString(),startedAt:e.started_at||e.startedAt,completedAt:e.completed_at||e.completedAt,updatedAt:e.updated_at||e.updatedAt||new Date().toISOString(),createdBy:e.created_by||e.createdBy}}setCurrentTask(e){this._currentTask.set(e)}getTaskById(e){return this._tasks().find(t=>t.id===e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Cm={models:[],defaultModelId:"",modelUsage:{intentRecognition:"",dailyChat:"",multiRoleScript:""},conversationStrategy:{style:"friendly",responseLength:"medium",useEmoji:!0,emojiFrequency:"low",language:"zh-TW"},knowledgeBases:[],activeKnowledgeBaseId:"",smartRules:[],settings:{autoLearnFromConversations:!1,maxDailyBudget:50,fallbackToHuman:!0,fallbackTimeout:300,debugMode:!1}};var Mt=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.config=f(Cm);this._isLoading=f(!1);this.isLoading=this._isLoading.asReadonly();this.usageStats=f({today:{conversations:0,messages:0,intentsRecognized:0,conversions:0,cost:0,avgResponseTime:0},weekly:{conversations:0,messages:0,intentsRecognized:0,conversions:0,cost:0,conversionRate:0},byModel:[]});this.models=R(()=>this.config().models);this.defaultModel=R(()=>this.config().models.find(e=>e.id===this.config().defaultModelId));this.knowledgeBases=R(()=>this.config().knowledgeBases);this.activeKnowledgeBaseId=R(()=>this.config().activeKnowledgeBaseId);this.activeKnowledgeBase=R(()=>this.config().knowledgeBases.find(e=>e.id===this.config().activeKnowledgeBaseId));this.activeRules=R(()=>this.config().smartRules.filter(e=>e.isActive));this.stats=R(()=>this.usageStats());this.strategy=R(()=>this.config().conversationStrategy);this.settings=R(()=>this.config().settings);this.isConnected=R(()=>this.config().models.some(e=>e.isConnected));this._testingModelIds=f(new Set);this.testingModelIds=R(()=>this._testingModelIds());this.localModels=R(()=>this.config().models.filter(e=>e.isLocal));this.cloudModels=R(()=>this.config().models.filter(e=>!e.isLocal));this.modelUsage=R(()=>this.config().modelUsage);this.setupIpcListeners(),setTimeout(()=>{this.loadModelsFromBackend(),this.loadModelUsageFromBackend()},100)}setupIpcListeners(){this.ipcService.on("ai-models-list",e=>{if(e.success&&e.models){let t=e.models.map(n=>({id:String(n.id),provider:n.provider,modelName:n.modelName,apiKey:n.apiKey||"",apiEndpoint:n.apiEndpoint,isConnected:n.isConnected,lastTestedAt:n.lastTestedAt,usageToday:0,costToday:0,isLocal:n.isLocal,displayName:n.displayName}));this.config.update(n=>P(E({},n),{models:t,defaultModelId:t.find(o=>o.isDefault)?.id||n.defaultModelId})),this._isLoading.set(!1)}}),this.ipcService.on("ai-model-saved",e=>{e.success?this.toastService.success(`AI \u6A21\u578B\u5DF2\u4FDD\u5B58: ${e.modelName||e.provider}`):this.toastService.error(`\u4FDD\u5B58\u5931\u6557: ${e.error}`)}),this.ipcService.on("ai-model-tested",e=>{if(console.log("[AI] \u6E2C\u8A66\u7D50\u679C:",e),e.modelId&&this._testingModelIds.update(t=>{let n=new Set(t);return n.delete(String(e.modelId)),n}),e.isConnected){let t=e.latencyMs?`\u5EF6\u9072: ${e.latencyMs}ms`:"",n=e.responsePreview?`
\u56DE\u8986: "${e.responsePreview.substring(0,50)}${e.responsePreview.length>50?"...":""}"`:"",o=e.availableModels?.length>0?`
\u53EF\u7528\u6A21\u578B: ${e.availableModels.slice(0,3).join(", ")}${e.availableModels.length>3?"...":""}`:"";this.toastService.success(`\u2713 AI \u6A21\u578B ${e.modelName||""} \u9023\u63A5\u6210\u529F\uFF01
${t}${n}${o}`)}else this.toastService.error(`\u9023\u63A5\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`);e.modelId&&this.updateModel(String(e.modelId),{isConnected:e.isConnected,lastTestedAt:new Date().toISOString()})}),this.ipcService.on("model-usage-loaded",e=>{console.log("[AI] \u6A21\u578B\u7528\u9014\u5206\u914D\u5DF2\u52A0\u8F09:",e),e.success&&e.usage&&this.config.update(t=>P(E({},t),{modelUsage:{intentRecognition:e.usage.intentRecognition||"",dailyChat:e.usage.dailyChat||"",multiRoleScript:e.usage.multiRoleScript||""}}))}),this.ipcService.on("model-usage-saved",e=>{e.success?console.log("[AI] \u6A21\u578B\u7528\u9014\u5206\u914D\u5DF2\u4FDD\u5B58"):this.toastService.error(`\u4FDD\u5B58\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("knowledge-base-added",e=>{console.log("[AI] \u77E5\u8B58\u5EAB\u5275\u5EFA\u7D50\u679C:",e),e.success?this.toastService.success(`\u77E5\u8B58\u5EAB\u300C${e.name}\u300D\u5275\u5EFA\u6210\u529F`):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("knowledge-item-added",e=>{console.log("[AI] \u77E5\u8B58\u689D\u76EE\u6DFB\u52A0\u7D50\u679C:",e),e.success?this.toastService.success(`\u77E5\u8B58\u689D\u76EE\u300C${e.title}\u300D\u5DF2\u6DFB\u52A0`):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("ai-knowledge-generated",e=>{console.log("[AI] AI \u751F\u6210\u77E5\u8B58\u5EAB\u7D50\u679C:",e),e.success&&e.items?(this.handleGeneratedKnowledge(e.kbId,e.items),this.toastService.success(`\u2728 AI \u5DF2\u751F\u6210 ${e.items.length} \u689D\u77E5\u8B58`)):this.toastService.error(`\u751F\u6210\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("industry-template-applied",e=>{console.log("[AI] \u884C\u696D\u6A21\u677F\u61C9\u7528\u7D50\u679C:",e),e.success&&e.items?(this.handleGeneratedKnowledge(e.kbId,e.items),this.toastService.success(`\u{1F4DA} \u5DF2\u61C9\u7528\u300C${e.templateName}\u300D\u6A21\u677F\uFF0C\u6DFB\u52A0 ${e.items.length} \u689D\u77E5\u8B58`)):this.toastService.error(`\u61C9\u7528\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("chat-learning-complete",e=>{console.log("[AI] \u804A\u5929\u5B78\u7FD2\u7D50\u679C:",e),e.success&&e.items?(this.handleGeneratedKnowledge(e.kbId,e.items),this.toastService.success(`\u{1F4AC} \u5F9E\u804A\u5929\u8A18\u9304\u5B78\u7FD2\u4E86 ${e.items.length} \u689D\u77E5\u8B58`)):e.success&&(!e.items||e.items.length===0)?this.toastService.info("\u672A\u767C\u73FE\u53EF\u5B78\u7FD2\u7684\u512A\u8CEA\u56DE\u8986"):this.toastService.error(`\u5B78\u7FD2\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)})}loadModelsFromBackend(){this._isLoading.set(!0),this.ipcService.send("get-ai-models",{})}addModel(e){let t=`model_${Date.now()}`,n=P(E({},e),{id:t,isConnected:!1,usageToday:0,costToday:0});return this.config.update(o=>P(E({},o),{models:[...o.models,n]})),this.ipcService.send("save-ai-model",{provider:e.provider,modelName:e.modelName,displayName:e.displayName||e.modelName,apiKey:e.apiKey,apiEndpoint:e.apiEndpoint,isLocal:e.isLocal||!1,isDefault:e.isDefault||!1}),t}addLocalModel(e){return this.addModel({provider:"custom",modelName:e.modelName,displayName:e.displayName||e.modelName,apiKey:"",apiEndpoint:e.apiEndpoint,isLocal:!0,isDefault:e.isDefault})}updateModel(e,t){this.config.update(n=>P(E({},n),{models:n.models.map(o=>o.id===e?E(E({},o),t):o)})),isNaN(Number(e))||this.ipcService.send("update-ai-model",E({id:Number(e)},t))}removeModel(e){this.config.update(t=>P(E({},t),{models:t.models.filter(n=>n.id!==e),defaultModelId:t.defaultModelId===e?"":t.defaultModelId})),isNaN(Number(e))||this.ipcService.send("delete-ai-model",{id:Number(e)})}setDefaultModel(e){this.config.update(t=>P(E({},t),{defaultModelId:e})),isNaN(Number(e))||this.ipcService.send("set-default-ai-model",{id:Number(e)})}updateModelUsage(e){this.config.update(t=>P(E({},t),{modelUsage:E(E({},t.modelUsage),e)}))}async saveModelUsageToBackend(){let e=this.config().modelUsage;console.log("[AI] \u4FDD\u5B58\u6A21\u578B\u7528\u9014\u5206\u914D:",e),this.ipcService.send("save-model-usage",e)}loadModelUsageFromBackend(){console.log("[AI] \u52A0\u8F09\u6A21\u578B\u7528\u9014\u5206\u914D..."),this.ipcService.send("get-model-usage",{})}async testModelConnection(e){let t=this.config().models.find(o=>o.id===e);if(!t)return!1;if(this._testingModelIds().has(e))return console.log("[AI] \u6A21\u578B\u5DF2\u5728\u6E2C\u8A66\u4E2D\uFF0C\u8DF3\u904E:",e),!1;this._testingModelIds.update(o=>{let a=new Set(o);return a.add(e),a});let n=t;return this.ipcService.send("test-ai-model",{id:isNaN(Number(e))?void 0:Number(e),provider:t.provider,modelName:t.modelName,apiKey:t.apiKey,apiEndpoint:t.apiEndpoint,isLocal:n.isLocal}),setTimeout(()=>{this._testingModelIds.update(o=>{let a=new Set(o);return a.delete(e),a})},6e4),!0}async testLocalAIConnection(e,t){return this.ipcService.send("test-ai-model",{provider:"ollama",modelName:t,apiEndpoint:e,isLocal:!0}),!0}addKnowledgeBase(e,t=""){let n=`kb_${Date.now()}`,o={id:n,name:e,description:t,items:[],isDefault:this.config().knowledgeBases.length===0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.config.update(a=>P(E({},a),{knowledgeBases:[...a.knowledgeBases,o],activeKnowledgeBaseId:a.activeKnowledgeBaseId||n})),this.ipcService.send("add-knowledge-base",{id:n,name:e,description:t,category:"general"}),n}updateKnowledgeBase(e,t){this.config.update(n=>P(E({},n),{knowledgeBases:n.knowledgeBases.map(o=>o.id===e?P(E(E({},o),t),{updatedAt:new Date().toISOString()}):o)}))}deleteKnowledgeBase(e){this.config.update(t=>P(E({},t),{knowledgeBases:t.knowledgeBases.filter(n=>n.id!==e),activeKnowledgeBaseId:t.activeKnowledgeBaseId===e?t.knowledgeBases.find(n=>n.id!==e)?.id||"":t.activeKnowledgeBaseId}))}setActiveKnowledgeBase(e){this.config.update(t=>P(E({},t),{activeKnowledgeBaseId:e}))}addKnowledgeItem(e,t){let n=`item_${Date.now()}`,o=new Date().toISOString(),a={id:n,title:t.title,content:t.content,category:t.category||"custom",keywords:[],priority:1,isActive:!0,createdAt:o,updatedAt:o};return this.config.update(d=>P(E({},d),{knowledgeBases:d.knowledgeBases.map(u=>u.id===e?P(E({},u),{items:[...u.items,a],updatedAt:new Date().toISOString()}):u)})),this.ipcService.send("add-knowledge-item",{kbId:e,id:n,title:t.title,content:t.content,category:t.category||"general"}),n}deleteKnowledgeItem(e,t){this.config.update(n=>P(E({},n),{knowledgeBases:n.knowledgeBases.map(o=>o.id===e?P(E({},o),{items:o.items.filter(a=>a.id!==t),updatedAt:new Date().toISOString()}):o)})),this.ipcService.send("delete-knowledge-item",{kbId:e,itemId:t})}generateKnowledgeBase(e,t){this.ipcService.send("ai-generate-knowledge",{kbId:e,businessDescription:t})}handleGeneratedKnowledge(e,t){let n=new Date().toISOString(),o=t.map((a,d)=>({id:`item_${Date.now()}_${d}`,title:a.title,content:a.content,category:a.category||"custom",keywords:[],priority:1,isActive:!0,createdAt:n,updatedAt:n}));this.config.update(a=>P(E({},a),{knowledgeBases:a.knowledgeBases.map(d=>d.id===e?P(E({},d),{items:[...d.items,...o],updatedAt:n}):d)}))}applyIndustryTemplate(e,t){this.ipcService.send("apply-industry-template",{kbId:e,templateId:t})}learnFromChatHistory(e){this.ipcService.send("learn-from-chat-history",{kbId:e,days:7})}addSmartRule(e){let t=`rule_${Date.now()}`,n=P(E({},e),{id:t});return this.config.update(o=>P(E({},o),{smartRules:[...o.smartRules,n]})),t}updateSmartRule(e,t){this.config.update(n=>P(E({},n),{smartRules:n.smartRules.map(o=>o.id===e?E(E({},o),t):o)}))}deleteSmartRule(e){this.config.update(t=>P(E({},t),{smartRules:t.smartRules.filter(n=>n.id!==e)}))}toggleSmartRule(e){this.config.update(t=>P(E({},t),{smartRules:t.smartRules.map(n=>n.id===e?P(E({},n),{isActive:!n.isActive}):n)}))}updateConversationStrategy(e){this.config.update(t=>P(E({},t),{conversationStrategy:E(E({},t.conversationStrategy),e)}))}async saveConversationStrategyToBackend(e){console.log("[AI] \u4FDD\u5B58\u5C0D\u8A71\u7B56\u7565:",e),this.ipcService.send("save-conversation-strategy",e),this.updateConversationStrategy({style:e.style,responseLength:e.responseLength,useEmoji:e.useEmoji,customPromptPrefix:e.customPersona}),this.toastService.success("\u5C0D\u8A71\u7B56\u7565\u5DF2\u4FDD\u5B58")}loadConversationStrategyFromBackend(){console.log("[AI] \u8F09\u5165\u5C0D\u8A71\u7B56\u7565..."),this.ipcService.send("get-conversation-strategy",{})}updateSettings(e){this.config.update(t=>P(E({},t),{settings:E(E({},t.settings),e)}))}async recognizeIntent(e,t){let n=this.extractKeywords(e),o="general_chat",a=.5;return e.includes("\u50F9\u683C")||e.includes("\u591A\u5C11\u9322")||e.includes("\u8CBB\u7528")?(o="price_inquiry",a=.9):e.includes("\u8CFC\u8CB7")||e.includes("\u4E0B\u55AE")||e.includes("\u600E\u9EBC\u8CB7")?(o="purchase_intent",a=.95):(e.includes("?")||e.includes("\uFF1F")||e.includes("\u4EC0\u9EBC"))&&(o="product_question",a=.7),this.usageStats.update(d=>P(E({},d),{today:P(E({},d.today),{intentsRecognized:d.today.intentsRecognized+1})})),{intent:o,confidence:a,keywords:n}}async generateReply(e,t=[],n){let o=this.config().conversationStrategy,a=this.activeKnowledgeBase(),d="\u611F\u8B1D\u60A8\u7684\u8A0A\u606F\uFF01";return n?.rolePrompt&&(d=`[${n.rolePrompt}] ${d}`),o.useEmoji&&(d+=" \u{1F60A}"),this.usageStats.update(u=>P(E({},u),{today:P(E({},u.today),{messages:u.today.messages+1,cost:u.today.cost+.01})})),d}async checkAndExecuteRules(e,t,n){let o=this.activeRules().sort((a,d)=>d.priority-a.priority);for(let a of o){if(a.triggerIntent!==e)continue;let d=a.triggerConditions;if(!(d.intentScore&&t<d.intentScore)&&!(d.conversationRounds&&n<d.conversationRounds))return a}return null}extractKeywords(e){return e.split(/[\s,!?]+/).filter(n=>n.length>1).slice(0,5)}exportConfig(){return JSON.stringify(this.config(),null,2)}importConfig(e){try{let t=JSON.parse(e);return this.config.set(t),!0}catch{return!1}}resetToDefault(){this.config.set(Cm)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Y_=class i{constructor(){this.taskService=F(Di);this.aiService=F(Mt);this.ipc=F(Q);this._aiHostingEnabled=f(!1);this.aiHostingEnabled=this._aiHostingEnabled.asReadonly();this._isProcessing=f(!1);this.isProcessing=this._isProcessing.asReadonly();this._lastSyncTime=f(new Date().toISOString());this.lastSyncTime=this._lastSyncTime.asReadonly();this._intentThreshold=f(70);this.intentThreshold=this._intentThreshold.asReadonly();this._maxConcurrentTasks=f(5);this.maxConcurrentTasks=this._maxConcurrentTasks.asReadonly();this._preferredExecutionMode=f("hybrid");this.preferredExecutionMode=this._preferredExecutionMode.asReadonly();this.unifiedState=R(()=>{let e=this.taskService.getOverallStats(),t=this.aiService.stats(),n=this.taskService.todayStats();return{activeTasks:e.activeTasks,totalTasks:e.totalTasks,todayContacted:n.contacted,todayConverted:n.converted,aiConnected:this.aiService.isConnected(),aiHostingEnabled:this._aiHostingEnabled(),todayAiCost:t.today.cost,todayConversations:t.today.conversations,activeCollaborations:e.activeTasks,collaborationSuccessRate:e.conversionRate,isProcessing:this._isProcessing(),lastSyncTime:this._lastSyncTime()}});this.aggregatedStats=R(()=>{let e=this.taskService.getOverallStats(),t=this.taskService.tasksByGoal(),n=this.taskService.tasks(),o={};Object.entries(t).forEach(([d,u])=>{o[d]={count:u.length,contacted:u.reduce((p,g)=>p+g.stats.contacted,0),converted:u.reduce((p,g)=>p+g.stats.converted,0)}});let a=[];for(let d=6;d>=0;d--){let u=new Date;u.setDate(u.getDate()-d);let p=u.toISOString().split("T")[0],g=n.filter(C=>C.createdAt.startsWith(p)||C.startedAt?.startsWith(p));a.push({date:p,contacted:g.reduce((C,w)=>C+w.stats.contacted,0),converted:g.reduce((C,w)=>C+w.stats.converted,0),messages:g.reduce((C,w)=>C+w.stats.messagesSent,0),cost:g.reduce((C,w)=>C+w.stats.aiCost,0)})}return{totalContacted:e.totalContacted,totalConverted:e.totalConverted,totalMessagesSent:e.totalMessagesSent,totalAiCost:e.totalAiCost,overallConversionRate:e.conversionRate,daily:a,byGoalType:o}});this.hasActiveTasks=R(()=>this.taskService.activeTasks().length>0);this.todaySummary=R(()=>{let e=this.taskService.todayStats(),t=this.aiService.stats().today;return{contacted:e.contacted,converted:e.converted,messagesSent:e.messagesSent,conversations:t.conversations,aiCost:t.cost,conversionRate:e.contacted>0?Math.round(e.converted/e.contacted*100):0}});this.cleanups=[];this.initialize()}initialize(){this.loadPersistedState(),this.cleanups.push(this.ipc.on("ai-hosting-changed",e=>{this._aiHostingEnabled.set(e.enabled)})),this.cleanups.push(this.ipc.on("marketing-task-started",()=>{this._isProcessing.set(!0),this._lastSyncTime.set(new Date().toISOString())})),this.cleanups.push(this.ipc.on("marketing-task-completed",()=>{this._isProcessing.set(!1),this._lastSyncTime.set(new Date().toISOString())})),this.cleanups.push(this.ipc.on("marketing-task-paused",()=>{this._isProcessing.set(!1)}))}loadPersistedState(){let e=localStorage.getItem("ai_hosting_enabled");e!==null&&this._aiHostingEnabled.set(e==="true");let t=localStorage.getItem("intent_threshold");t&&this._intentThreshold.set(parseInt(t));let n=localStorage.getItem("max_concurrent_tasks");n&&this._maxConcurrentTasks.set(parseInt(n));let o=localStorage.getItem("preferred_execution_mode");o&&["scripted","hybrid","scriptless"].includes(o)&&this._preferredExecutionMode.set(o)}ngOnDestroy(){this.cleanups.forEach(e=>e())}setAiHostingEnabled(e){this._aiHostingEnabled.set(e),localStorage.setItem("ai_hosting_enabled",String(e)),this.ipc.send("set-ai-hosting",{enabled:e})}setIntentThreshold(e){this._intentThreshold.set(e),localStorage.setItem("intent_threshold",String(e))}setMaxConcurrentTasks(e){this._maxConcurrentTasks.set(e),localStorage.setItem("max_concurrent_tasks",String(e))}setPreferredExecutionMode(e){this._preferredExecutionMode.set(e),localStorage.setItem("preferred_execution_mode",e)}saveSettingsToBackend(){this.ipc.send("save-marketing-settings",{intentThreshold:this._intentThreshold(),maxConcurrentTasks:this._maxConcurrentTasks(),preferredExecutionMode:this._preferredExecutionMode(),aiHostingEnabled:this._aiHostingEnabled()})}syncState(){this.taskService.loadTasks(),this._lastSyncTime.set(new Date().toISOString())}getSnapshot(){return this.unifiedState()}async quickStartTask(e){return this.taskService.quickCreate(e)}canStartNewTask(){let e=parseInt(localStorage.getItem("max_concurrent_tasks")||"5");return this.taskService.activeTasks().length<e}getRecommendedAction(){let e=this.unifiedState();return e.aiConnected?e.activeTasks===0?{type:"start",description:"\u5275\u5EFA\u60A8\u7684\u7B2C\u4E00\u500B\u71DF\u92B7\u4EFB\u52D9",action:()=>this.ipc.send("navigate-to",{path:"/smart-marketing"})}:e.collaborationSuccessRate<10&&e.totalTasks>5?{type:"optimize",description:"\u8F49\u5316\u7387\u504F\u4F4E\uFF0C\u5EFA\u8B70\u512A\u5316 AI \u4EBA\u683C\u8A2D\u7F6E",action:()=>this.ipc.send("navigate-to",{path:"/ai-center",query:{tab:"persona"}})}:null:{type:"setup",description:"\u8ACB\u5148\u914D\u7F6E AI \u6A21\u578B",action:()=>this.ipc.send("navigate-to",{path:"/ai-center"})}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ds=[{id:"sys-high-intent",name:"\u9AD8\u610F\u5411\u5BA2\u6236\u8F49\u5316",description:"\u91DD\u5C0D\u610F\u5411\u5206\u6578 \u226580 \u7684\u9AD8\u8CEA\u91CF\u6F5B\u5728\u5BA2\u6236",goalType:"conversion",executionMode:"hybrid",audienceSource:"tags",intentScoreMin:80,roles:["expert","satisfied_customer"],aiHostingEnabled:!0,autoGreeting:!0,autoReply:!0,usageCount:0,successCount:0,totalContacted:0,totalConverted:0,isSystem:!0,isFavorite:!1,createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"},{id:"sys-win-back",name:"\u6C89\u9ED8\u5BA2\u6236\u559A\u9192",description:"7\u5929\u5167\u7121\u4E92\u52D5\u7684\u8001\u5BA2\u6236\u633D\u56DE\u7B56\u7565",goalType:"retention",executionMode:"hybrid",audienceSource:"recent",intentScoreMin:30,roles:["callback","support","manager"],aiHostingEnabled:!0,autoGreeting:!0,autoReply:!0,usageCount:0,successCount:0,totalContacted:0,totalConverted:0,isSystem:!0,isFavorite:!1,createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"},{id:"sys-community",name:"\u793E\u7FA4\u6D3B\u8E8D\u5F15\u7206",description:"\u5728\u7FA4\u7D44\u4E2D\u88FD\u9020\u8A71\u984C\uFF0C\u63D0\u5347\u6D3B\u8E8D\u5EA6",goalType:"engagement",executionMode:"scriptless",audienceSource:"group",intentScoreMin:0,roles:["newbie","satisfied_customer","expert"],aiHostingEnabled:!0,autoGreeting:!1,autoReply:!0,usageCount:0,successCount:0,totalContacted:0,totalConverted:0,isSystem:!0,isFavorite:!1,createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"},{id:"sys-support",name:"\u552E\u5F8C\u670D\u52D9\u97FF\u61C9",description:"\u5FEB\u901F\u97FF\u61C9\u5BA2\u6236\u554F\u984C\uFF0C\u63D0\u5347\u6EFF\u610F\u5EA6",goalType:"support",executionMode:"scripted",audienceSource:"recent",intentScoreMin:0,roles:["support","expert"],aiHostingEnabled:!0,autoGreeting:!1,autoReply:!0,usageCount:0,successCount:0,totalContacted:0,totalConverted:0,isSystem:!0,isFavorite:!1,createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"}],pc=class i{constructor(){this._templates=f([]);this.templates=this._templates.asReadonly();this.userTemplates=R(()=>this._templates().filter(e=>!e.isSystem));this.systemTemplates=R(()=>ds);this.favoriteTemplates=R(()=>this._templates().filter(e=>e.isFavorite));this.recommendedTemplates=R(()=>[...this._templates(),...ds].filter(t=>t.usageCount>=3).sort((t,n)=>{let o=t.totalContacted>0?t.totalConverted/t.totalContacted:0;return(n.totalContacted>0?n.totalConverted/n.totalContacted:0)-o}).slice(0,5));this.templatesByGoal=R(()=>[...this._templates(),...ds].reduce((t,n)=>(t[n.goalType]||(t[n.goalType]=[]),t[n.goalType].push(n),t),{}));this.loadTemplates()}loadTemplates(){try{let e=localStorage.getItem("task_templates");e&&this._templates.set(JSON.parse(e))}catch(e){console.error("\u52A0\u8F09\u6A21\u677F\u5931\u6557:",e)}}saveTemplates(){localStorage.setItem("task_templates",JSON.stringify(this._templates()))}createTemplate(e){let t=P(E({},e),{id:`tpl-${Date.now()}`,usageCount:0,successCount:0,totalContacted:0,totalConverted:0,isSystem:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});return this._templates.update(n=>[...n,t]),this.saveTemplates(),t}createFromTask(e,t,n){return this.createTemplate({name:t,description:n,goalType:e.goalType,executionMode:e.executionMode,audienceSource:e.targetCriteria?.sources?.[0]||"recent",intentScoreMin:e.targetCriteria?.intentScoreMin||50,roles:e.roleConfig?.map(o=>o.roleType),aiHostingEnabled:!0,autoGreeting:!0,autoReply:!0,isFavorite:!1})}updateTemplate(e,t){this._templates.update(n=>n.map(o=>o.id===e?P(E(E({},o),t),{updatedAt:new Date().toISOString()}):o)),this.saveTemplates()}deleteTemplate(e){this._templates.update(t=>t.filter(n=>n.id!==e)),this.saveTemplates()}toggleFavorite(e){this._templates.update(t=>t.map(n=>n.id===e?P(E({},n),{isFavorite:!n.isFavorite}):n)),this.saveTemplates()}recordUsage(e){this._templates.update(t=>t.map(n=>n.id===e?P(E({},n),{usageCount:n.usageCount+1}):n)),this.saveTemplates()}recordResult(e,t,n,o){this._templates.update(a=>a.map(d=>d.id===e?P(E({},d),{totalContacted:d.totalContacted+t,totalConverted:d.totalConverted+n,successCount:o?d.successCount+1:d.successCount}):d)),this.saveTemplates()}getTemplate(e){let t=this._templates().find(n=>n.id===e);return t||ds.find(n=>n.id===e)}getSuccessRate(e){return e.totalContacted===0?0:Math.round(e.totalConverted/e.totalContacted*100)}searchTemplates(e){let t=e.toLowerCase();return[...this._templates(),...ds].filter(o=>o.name.toLowerCase().includes(t)||o.description?.toLowerCase().includes(t))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var X_=class i{constructor(){this.taskService=F(Di);this.templateService=F(pc);this._analysis=f(null);this.analysis=this._analysis.asReadonly();this.lastAnalysisTime=0;this.CACHE_DURATION=300*1e3;this.analyzeHistory()}async analyzeHistory(){let e=Date.now();if(this._analysis()&&e-this.lastAnalysisTime<this.CACHE_DURATION)return this._analysis();let t=this.taskService.tasks(),n=t.filter(A=>A.status==="completed"),o={totalTasks:t.length,successfulTasks:n.filter(A=>A.stats.converted>0).length,avgConversionRate:0,byGoal:{},bestHours:[],topConfigs:[]},a=n.reduce((A,V)=>A+V.stats.contacted,0),d=n.reduce((A,V)=>A+V.stats.converted,0);o.avgConversionRate=a>0?d/a*100:0;let u=["conversion","retention","engagement","support"];for(let A of u){let V=n.filter(le=>le.goalType===A),G=V.reduce((le,ue)=>le+ue.stats.contacted,0),z=V.reduce((le,ue)=>le+ue.stats.converted,0),$=new Map;V.forEach(le=>{let ue=$.get(le.executionMode)||{contacted:0,converted:0};$.set(le.executionMode,{contacted:ue.contacted+le.stats.contacted,converted:ue.converted+le.stats.converted})});let K="hybrid",Z=0;$.forEach((le,ue)=>{let pe=le.contacted>0?le.converted/le.contacted:0;pe>Z&&(Z=pe,K=ue)});let Y=new Map;V.forEach(le=>{le.roleConfig?.forEach(ue=>{let pe=Y.get(ue.roleType)||0;Y.set(ue.roleType,pe+(le.stats.converted>0?1:0))})});let re=Array.from(Y.entries()).sort((le,ue)=>ue[1]-le[1]).slice(0,3).map(([le])=>le);o.byGoal[A]={count:V.length,avgConversionRate:G>0?z/G*100:0,bestExecutionMode:K,bestRoles:re.length>0?re:rn[A].suggestedRoles}}let p=new Array(24).fill(0),g=new Array(24).fill(0);n.forEach(A=>{let V=new Date(A.createdAt).getHours();p[V]++,A.stats.converted>0&&g[V]++});let C=p.map((A,V)=>({hour:V,rate:A>0?g[V]/A:0}));o.bestHours=C.sort((A,V)=>V.rate-A.rate).slice(0,3).map(A=>A.hour);let w=new Map;return n.forEach(A=>{let V=A.roleConfig?.map($=>$.roleType).sort().join(",")||"",G=`${A.goalType}|${A.executionMode}|${V}`,z=w.get(G)||{goalType:A.goalType,executionMode:A.executionMode,roles:A.roleConfig?.map($=>$.roleType)||[],contacted:0,converted:0,count:0};w.set(G,P(E({},z),{contacted:z.contacted+A.stats.contacted,converted:z.converted+A.stats.converted,count:z.count+1}))}),o.topConfigs=Array.from(w.values()).filter(A=>A.count>=2).map(A=>({goalType:A.goalType,executionMode:A.executionMode,roles:A.roles,conversionRate:A.contacted>0?A.converted/A.contacted*100:0,sampleSize:A.count})).sort((A,V)=>V.conversionRate-A.conversionRate).slice(0,5),this._analysis.set(o),this.lastAnalysisTime=e,o}getRecommendations(){let e=[],t=this._analysis();if(!t||t.totalTasks<3)return e.push({id:"new-user-conversion",type:"goal",title:"\u958B\u59CB\u60A8\u7684\u7B2C\u4E00\u500B\u8F49\u5316\u4EFB\u52D9",description:"\u300C\u4FC3\u9032\u9996\u55AE\u300D\u662F\u6700\u5E38\u7528\u7684\u71DF\u92B7\u76EE\u6A19",confidence:80,reason:"\u57FA\u65BC\u7CFB\u7D71\u9ED8\u8A8D\u63A8\u85A6",action:{label:"\u5275\u5EFA\u4EFB\u52D9",data:{goalType:"conversion"}}}),e;if(t.topConfigs.length>0){let a=t.topConfigs[0];e.push({id:"best-config",type:"goal",title:"\u4F7F\u7528\u60A8\u7684\u6700\u4F73\u914D\u7F6E",description:`${rn[a.goalType].label} + ${this.getModeLabel(a.executionMode)}`,confidence:Math.min(90,50+a.sampleSize*10),reason:`\u6B77\u53F2\u8F49\u5316\u7387 ${a.conversionRate.toFixed(1)}%\uFF08${a.sampleSize} \u6B21\u4EFB\u52D9\uFF09`,action:{label:"\u4F7F\u7528\u6B64\u914D\u7F6E",data:a}})}let o=Object.entries(t.byGoal).filter(([a,d])=>d.count>=2).sort((a,d)=>d[1].avgConversionRate-a[1].avgConversionRate)[0];if(o){let[a,d]=o;e.push({id:"best-goal",type:"goal",title:`${rn[a].label} \u8868\u73FE\u6700\u4F73`,description:`\u5E73\u5747\u8F49\u5316\u7387 ${d.avgConversionRate.toFixed(1)}%`,confidence:Math.min(85,40+d.count*5),reason:`\u57FA\u65BC ${d.count} \u6B21\u6B77\u53F2\u4EFB\u52D9\u5206\u6790`})}if(t.bestHours.length>0){let a=t.bestHours.map(d=>`${d}:00`).join("\u3001");e.push({id:"best-timing",type:"timing",title:"\u6700\u4F73\u555F\u52D5\u6642\u6BB5",description:a,confidence:70,reason:"\u9019\u4E9B\u6642\u6BB5\u7684\u4EFB\u52D9\u6210\u529F\u7387\u8F03\u9AD8"})}return e}getSuggestionForGoal(e){let n=this._analysis()?.byGoal[e],o=rn[e];return!n||n.count<2?{goalType:e,executionMode:o.suggestedMode,suggestedRoles:o.suggestedRoles,intentThreshold:70,audienceSource:"recent",reason:"\u57FA\u65BC\u7CFB\u7D71\u9ED8\u8A8D\u63A8\u85A6",expectedConversionRate:15}:{goalType:e,executionMode:n.bestExecutionMode,suggestedRoles:n.bestRoles,intentThreshold:60,audienceSource:"tags",reason:`\u57FA\u65BC ${n.count} \u6B21\u6B77\u53F2\u4EFB\u52D9\u5206\u6790`,expectedConversionRate:Math.round(n.avgConversionRate)}}getNextBestAction(){let t=this.taskService.tasks().filter(a=>a.status==="running");if(t.length===0){let a=this._analysis();if(a&&a.topConfigs.length>0){let d=a.topConfigs[0];return{goalType:d.goalType,reason:`\u60A8\u7684\u300C${rn[d.goalType].label}\u300D\u4EFB\u52D9\u6B77\u53F2\u8868\u73FE\u6700\u4F73`}}return{goalType:"conversion",reason:"\u958B\u59CB\u4E00\u500B\u65B0\u7684\u8F49\u5316\u4EFB\u52D9"}}let n=new Set(t.map(a=>a.goalType)),o=["conversion","retention","engagement","support"].filter(a=>!n.has(a));if(o.length>0){let a=this._analysis();if(a){let d=o.filter(u=>a.byGoal[u]?.count>0).sort((u,p)=>a.byGoal[p].avgConversionRate-a.byGoal[u].avgConversionRate)[0];if(d)return{goalType:d,reason:`\u88DC\u5145\u4E00\u500B\u300C${rn[d].label}\u300D\u4EFB\u52D9\u4EE5\u8986\u84CB\u66F4\u591A\u5834\u666F`}}}return null}getModeLabel(e){return{scripted:"\u5287\u672C\u6A21\u5F0F",hybrid:"\u6DF7\u5408\u6A21\u5F0F",scriptless:"\u7121\u5287\u672C\u6A21\u5F0F"}[e]}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Z_=class i{constructor(){this.ipc=F(Q);this._logs=f([]);this.logs=this._logs.asReadonly();this._isLive=f(!0);this.isLive=this._isLive.asReadonly();this._filter=f({});this.filter=this._filter.asReadonly();this.MAX_LOGS=1e3;this.filteredLogs=R(()=>{let e=this._logs(),t=this._filter();return e.filter(n=>{if(t.taskId&&n.taskId!==t.taskId||t.level&&n.level!==t.level||t.category&&n.category!==t.category)return!1;if(t.search){let o=t.search.toLowerCase();if(!n.message.toLowerCase().includes(o)&&!n.category.toLowerCase().includes(o))return!1}return!(t.startTime&&n.timestamp<t.startTime||t.endTime&&n.timestamp>t.endTime)})});this.logsByTask=R(()=>{let e=this._logs(),t=new Map;return e.forEach(n=>{t.has(n.taskId)||t.set(n.taskId,[]),t.get(n.taskId).push(n)}),t});this.stats=R(()=>{let e=this._logs();return{total:e.length,debug:e.filter(t=>t.level==="debug").length,info:e.filter(t=>t.level==="info").length,success:e.filter(t=>t.level==="success").length,warning:e.filter(t=>t.level==="warning").length,error:e.filter(t=>t.level==="error").length}});this.setupIpcListeners()}setupIpcListeners(){this.ipc.on("execution-log",e=>{this._isLive()&&this.addLog(e)}),this.ipc.on("execution-logs-batch",e=>{this._isLive()&&e.forEach(t=>this.addLog(t))})}addLog(e){let t=P(E({},e),{id:`log-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString()});this._logs.update(n=>{let o=[t,...n];return o.length>this.MAX_LOGS?o.slice(0,this.MAX_LOGS):o})}debug(e,t,n,o){this.addLog({taskId:e,level:"debug",category:t,message:n,details:o})}info(e,t,n,o){this.addLog({taskId:e,level:"info",category:t,message:n,details:o})}success(e,t,n,o){this.addLog({taskId:e,level:"success",category:t,message:n,details:o})}warning(e,t,n,o){this.addLog({taskId:e,level:"warning",category:t,message:n,details:o})}error(e,t,n,o){this.addLog({taskId:e,level:"error",category:t,message:n,details:o})}setFilter(e){this._filter.set(e)}updateFilter(e){this._filter.update(t=>E(E({},t),e))}clearFilter(){this._filter.set({})}toggleLive(){this._isLive.update(e=>!e)}setLive(e){this._isLive.set(e)}clearLogs(){this._logs.set([])}clearTaskLogs(e){this._logs.update(t=>t.filter(n=>n.taskId!==e))}getTaskLogs(e){return this._logs().filter(t=>t.taskId===e)}exportLogs(e="json"){let t=this.filteredLogs(),n,o,a;if(e==="json")n=JSON.stringify(t,null,2),o=`execution-logs-${new Date().toISOString().split("T")[0]}.json`,a="application/json";else{let g=["\u6642\u9593","\u4EFB\u52D9ID","\u7D1A\u5225","\u985E\u5225","\u6D88\u606F"],C=t.map(w=>[w.timestamp,w.taskId,w.level,w.category,`"${w.message.replace(/"/g,'""')}"`].join(","));n=[g.join(","),...C].join(`
`),o=`execution-logs-${new Date().toISOString().split("T")[0]}.csv`,a="text/csv"}let d=new Blob([n],{type:a}),u=URL.createObjectURL(d),p=document.createElement("a");p.href=u,p.download=o,p.click(),URL.revokeObjectURL(u)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var K8={timeout:3e4,retries:3,retryDelay:1e3,cache:!1,cacheDuration:6e4,showError:!0,showLoading:!1},e1=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._isLoading=f(!1);this.isLoading=this._isLoading.asReadonly();this._pendingRequests=f(0);this.pendingRequests=this._pendingRequests.asReadonly();this.cache=new Map;this.pendingPromises=new Map}async request(e,t,n={}){let o=E(E({},K8),n),a=`${e}:${JSON.stringify(t)}`;if(o.cache){let u=this.getFromCache(a);if(u)return{success:!0,data:u}}if(this.pendingPromises.has(a))return this.pendingPromises.get(a);let d=this.executeRequest(e,t,o,a);this.pendingPromises.set(a,d);try{return await d}finally{this.pendingPromises.delete(a)}}async executeRequest(e,t,n,o){this._pendingRequests.update(u=>u+1),n.showLoading&&this._isLoading.set(!0);let a;for(let u=0;u<=n.retries;u++)try{let p=await this.sendIpcRequest(e,t,n.timeout);return p.success&&n.cache&&this.setCache(o,p.data,n.cacheDuration),p}catch(p){a=p,u<n.retries&&await this.delay(n.retryDelay*(u+1))}let d={success:!1,error:{code:"REQUEST_FAILED",message:a?.message||"\u8ACB\u6C42\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66",details:a}};return n.showError&&this.toast.error(d.error.message),d}sendIpcRequest(e,t,n){return new Promise((o,a)=>{let d=setTimeout(()=>{a(new Error("\u8ACB\u6C42\u8D85\u6642"))},n);this.ipc.invoke(e,t).then(u=>{clearTimeout(d),typeof u=="object"&&"success"in u?o(u):o({success:!0,data:u})}).catch(u=>{clearTimeout(d),a(u)}).finally(()=>{this._pendingRequests.update(u=>Math.max(0,u-1)),this._pendingRequests()===0&&this._isLoading.set(!1)})})}getFromCache(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.duration?(this.cache.delete(e),null):t.data:null}setCache(e,t,n){this.cache.set(e,{data:t,timestamp:Date.now(),duration:n})}clearCache(e){if(!e){this.cache.clear();return}let t=new RegExp(e);for(let n of this.cache.keys())t.test(n)&&this.cache.delete(n)}async preload(e,t){await this.request(e,t,{cache:!0,showError:!1})}async get(e,t,n){return this.request(e,E({action:"get"},t),E({cache:!0},n))}async post(e,t,n){return this.request(e,E({action:"create"},t),E({cache:!1},n))}async put(e,t,n){return this.request(e,E({action:"update"},t),E({cache:!1},n))}async delete(e,t,n){return this.request(e,E({action:"delete"},t),E({cache:!1},n))}delay(e){return new Promise(t=>setTimeout(t,e))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var t1=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this._state=f("disconnected");this.state=this._state.asReadonly();this.isConnected=R(()=>this._state()==="connected");this._reconnectAttempts=f(0);this.reconnectAttempts=this._reconnectAttempts.asReadonly();this._lastHeartbeat=f(null);this.lastHeartbeat=this._lastHeartbeat.asReadonly();this.subscriptions=new Map;this.HEARTBEAT_INTERVAL=3e4;this.RECONNECT_DELAY=5e3;this.MAX_RECONNECT_ATTEMPTS=10;this.setupIpcListeners(),this.connect()}ngOnDestroy(){this.disconnect()}setupIpcListeners(){this.ipc.on("realtime:data",e=>{this.handleRealtimeData(e.type,e.data)}),this.ipc.on("realtime:state",e=>{this._state.set(e),e==="connected"?(this._reconnectAttempts.set(0),this.startHeartbeat(),this.resubscribeAll()):e==="disconnected"&&(this.stopHeartbeat(),this.scheduleReconnect())}),this.ipc.on("realtime:heartbeat",()=>{this._lastHeartbeat.set(new Date)}),this.ipc.on("realtime:error",e=>{console.error("Realtime error:",e),e.code==="AUTH_FAILED"&&this.toast.error("\u5BE6\u6642\u9023\u63A5\u8A8D\u8B49\u5931\u6557")})}connect(){this._state()==="connecting"||this._state()==="connected"||(this._state.set("connecting"),this.ipc.send("realtime:connect",{}))}disconnect(){this.stopHeartbeat(),this.clearReconnectTimeout(),this.ipc.send("realtime:disconnect",{}),this._state.set("disconnected")}subscribe(e,t,n){let o=`sub-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={id:o,type:e,callback:t,options:n};return this.subscriptions.set(o,a),this.isConnected()&&this.sendSubscription(a),o}unsubscribe(e){let t=this.subscriptions.get(e);t&&(this.subscriptions.delete(e),this.isConnected()&&this.ipc.send("realtime:unsubscribe",{id:e,type:t.type}))}unsubscribeAll(){for(let e of this.subscriptions.keys())this.unsubscribe(e)}sendSubscription(e){this.ipc.send("realtime:subscribe",{id:e.id,type:e.type,filter:e.options?.filter})}resubscribeAll(){for(let e of this.subscriptions.values())this.sendSubscription(e)}handleRealtimeData(e,t){for(let n of this.subscriptions.values())if(n.type===e){if(n.options?.filter){let o=n.options.filter,a=!0;for(let[d,u]of Object.entries(o))if(t[d]!==u){a=!1;break}if(!a)continue}try{n.callback(t)}catch(o){console.error("Subscription callback error:",o)}}}startHeartbeat(){this.stopHeartbeat(),this.heartbeatInterval=setInterval(()=>{this.isConnected()&&this.ipc.send("realtime:heartbeat",{})},this.HEARTBEAT_INTERVAL)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=void 0)}scheduleReconnect(){if(this._reconnectAttempts()>=this.MAX_RECONNECT_ATTEMPTS){this.toast.error("\u7121\u6CD5\u5EFA\u7ACB\u5BE6\u6642\u9023\u63A5\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61");return}this.clearReconnectTimeout();let e=this.RECONNECT_DELAY*Math.pow(1.5,this._reconnectAttempts());this.reconnectTimeout=setTimeout(()=>{this._reconnectAttempts.update(t=>t+1),this._state.set("reconnecting"),this.connect()},e)}clearReconnectTimeout(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0)}subscribeTaskStatus(e,t){return this.subscribe("task:status",t,{filter:{taskId:e}})}subscribeTaskStats(e,t){return this.subscribe("task:stats",t,{filter:{taskId:e}})}subscribeTaskLogs(e,t){return this.subscribe("task:log",t,{filter:{taskId:e}})}subscribeAllTaskLogs(e){return this.subscribe("task:log",e)}subscribeNewMessages(e){return this.subscribe("message:new",e)}subscribeSystemStatus(e){return this.subscribe("system:status",e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var n1=class i{constructor(){this.ipc=F(Q);this.aiService=F(Mt);this._isGenerating=f(!1);this.isGenerating=this._isGenerating.asReadonly();this._recentResults=f([]);this.recentResults=this._recentResults.asReadonly();this._savedTemplates=f([]);this.savedTemplates=this._savedTemplates.asReadonly();this.systemTemplates=[{id:"sys-greeting-1",name:"\u53CB\u597D\u554F\u5019",type:"greeting",style:"friendly",template:"\u55E8 {customerName}\uFF01\u6211\u662F{productName}\u7684{role}\u3002\u770B\u5230\u60A8\u5C0D\u6211\u5011\u7522\u54C1\u6709\u8208\u8DA3\uFF0C\u60F3\u4E86\u89E3\u66F4\u591A\u55CE\uFF1F\u{1F60A}",variables:["customerName","productName","role"],examples:["\u55E8 \u738B\u5148\u751F\uFF01\u6211\u662F\u667A\u80FD\u884C\u92B7\u52A9\u624B\u7684\u7522\u54C1\u9867\u554F\u3002\u770B\u5230\u60A8\u5C0D\u6211\u5011\u7522\u54C1\u6709\u8208\u8DA3\uFF0C\u60F3\u4E86\u89E3\u66F4\u591A\u55CE\uFF1F\u{1F60A}"],isSystem:!0},{id:"sys-greeting-2",name:"\u5C08\u696D\u958B\u5834",type:"greeting",style:"professional",template:"\u60A8\u597D\uFF0C{customerName}\u3002\u6211\u662F{company}\u7684{role}\uFF0C\u5F88\u9AD8\u8208\u70BA\u60A8\u670D\u52D9\u3002\u8ACB\u554F\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u52A9\u60A8\u7684\u55CE\uFF1F",variables:["customerName","company","role"],examples:["\u60A8\u597D\uFF0C\u5F35\u7D93\u7406\u3002\u6211\u662FABC\u516C\u53F8\u7684\u696D\u52D9\u9867\u554F\uFF0C\u5F88\u9AD8\u8208\u70BA\u60A8\u670D\u52D9\u3002\u8ACB\u554F\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u52A9\u60A8\u7684\u55CE\uFF1F"],isSystem:!0},{id:"sys-objection-1",name:"\u50F9\u683C\u7570\u8B70",type:"objection",style:"empathetic",template:"\u5B8C\u5168\u7406\u89E3\u60A8\u7684\u8003\u616E\uFF01\u5F88\u591A\u5BA2\u6236\u4E00\u958B\u59CB\u4E5F\u6709\u540C\u6A23\u7684\u60F3\u6CD5\u3002\u4E0D\u904E\u5BE6\u969B\u4F7F\u7528\u5F8C\uFF0C\u4ED6\u5011\u767C\u73FE{benefit}\uFF0C\u6295\u8CC7\u56DE\u5831\u5176\u5BE6\u5F88\u53EF\u89C0\u3002\u8981\u4E0D\u6211\u5206\u4EAB\u5E7E\u500B\u6210\u529F\u6848\u4F8B\u7D66\u60A8\u770B\u770B\uFF1F",variables:["benefit"],examples:["\u5B8C\u5168\u7406\u89E3\u60A8\u7684\u8003\u616E\uFF01\u5F88\u591A\u5BA2\u6236\u4E00\u958B\u59CB\u4E5F\u6709\u540C\u6A23\u7684\u60F3\u6CD5\u3002\u4E0D\u904E\u5BE6\u969B\u4F7F\u7528\u5F8C\uFF0C\u4ED6\u5011\u767C\u73FE\u6548\u7387\u63D0\u5347\u4E863\u500D\uFF0C\u6295\u8CC7\u56DE\u5831\u5176\u5BE6\u5F88\u53EF\u89C0\u3002\u8981\u4E0D\u6211\u5206\u4EAB\u5E7E\u500B\u6210\u529F\u6848\u4F8B\u7D66\u60A8\u770B\u770B\uFF1F"],isSystem:!0},{id:"sys-closing-1",name:"\u9650\u6642\u512A\u60E0",type:"closing",style:"urgent",template:"\u5C0D\u4E86\uFF0C\u73FE\u5728\u6B63\u597D\u6709{promotion}\u6D3B\u52D5\uFF0C{deadline}\u622A\u6B62\uFF01\u9019\u500B\u6642\u5019\u5165\u624B\u771F\u7684\u5F88\u5212\u7B97\u3002\u9700\u8981\u6211\u5E6B\u60A8\u9396\u5B9A\u540D\u984D\u55CE\uFF1F",variables:["promotion","deadline"],examples:["\u5C0D\u4E86\uFF0C\u73FE\u5728\u6B63\u597D\u6709\u5E74\u7D42\u7279\u60E0\u6D3B\u52D5\uFF0C\u672C\u6708\u5E95\u622A\u6B62\uFF01\u9019\u500B\u6642\u5019\u5165\u624B\u771F\u7684\u5F88\u5212\u7B97\u3002\u9700\u8981\u6211\u5E6B\u60A8\u9396\u5B9A\u540D\u984D\u55CE\uFF1F"],isSystem:!0},{id:"sys-followup-1",name:"\u6EAB\u67D4\u8DDF\u9032",type:"follow_up",style:"friendly",template:"\u55E8 {customerName}\uFF0C\u597D\u4E45\u4E0D\u898B\uFF01\u4E0A\u6B21\u804A\u5230{topic}\uFF0C\u4E0D\u77E5\u9053\u60A8\u5F8C\u4F86\u8003\u616E\u5F97\u600E\u9EBC\u6A23\u4E86\uFF1F\u6709\u4EFB\u4F55\u554F\u984C\u90FD\u53EF\u4EE5\u96A8\u6642\u554F\u6211\u54E6\uFF5E",variables:["customerName","topic"],examples:["\u55E8 \u674E\u5C0F\u59D0\uFF0C\u597D\u4E45\u4E0D\u898B\uFF01\u4E0A\u6B21\u804A\u5230\u5347\u7D1A\u65B9\u6848\uFF0C\u4E0D\u77E5\u9053\u60A8\u5F8C\u4F86\u8003\u616E\u5F97\u600E\u9EBC\u6A23\u4E86\uFF1F\u6709\u4EFB\u4F55\u554F\u984C\u90FD\u53EF\u4EE5\u96A8\u6642\u554F\u6211\u54E6\uFF5E"],isSystem:!0},{id:"sys-retention-1",name:"\u633D\u56DE\u6D41\u5931",type:"retention",style:"empathetic",template:"{customerName}\uFF0C\u597D\u4E45\u6C92\u770B\u5230\u60A8\u4E86\uFF0C\u6709\u9EDE\u60F3\u5FF5\u5462\uFF01\u662F\u4E0D\u662F\u6700\u8FD1\u592A\u5FD9\u4E86\uFF1F\u6211\u5011\u6700\u8FD1\u63A8\u51FA\u4E86{newFeature}\uFF0C\u89BA\u5F97\u7279\u5225\u9069\u5408\u60A8\uFF0C\u8981\u4E0D\u8981\u4F86\u770B\u770B\uFF1F",variables:["customerName","newFeature"],examples:["\u738B\u5148\u751F\uFF0C\u597D\u4E45\u6C92\u770B\u5230\u60A8\u4E86\uFF0C\u6709\u9EDE\u60F3\u5FF5\u5462\uFF01\u662F\u4E0D\u662F\u6700\u8FD1\u592A\u5FD9\u4E86\uFF1F\u6211\u5011\u6700\u8FD1\u63A8\u51FA\u4E86\u667A\u80FD\u5831\u8868\u529F\u80FD\uFF0C\u89BA\u5F97\u7279\u5225\u9069\u5408\u60A8\uFF0C\u8981\u4E0D\u8981\u4F86\u770B\u770B\uFF1F"],isSystem:!0}];this.loadSavedTemplates()}async generate(e){this._isGenerating.set(!0);try{let t=e.options?.count||3,n=[],o=this.buildPrompt(e),a=await this.ipc.invoke("ai-generate-text",{prompt:o,maxTokens:e.options?.maxLength||200,count:t});if(a.success&&a.texts){for(let d of a.texts){let u={id:`copy-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:this.postProcess(d,e),type:e.type,style:e.style||"friendly",score:this.evaluateQuality(d,e),tags:this.extractTags(e),createdAt:new Date().toISOString()};n.push(u)}this._recentResults.update(d=>[...n,...d].slice(0,50))}else{let d=this.getTemplatesForType(e.type);for(let u of d.slice(0,t)){let p={id:`copy-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:this.applyTemplate(u,e.context||{}),type:e.type,style:u.style,score:70,tags:["\u6A21\u677F"],createdAt:new Date().toISOString()};n.push(p)}}return n}finally{this._isGenerating.set(!1)}}async optimize(e,t){this._isGenerating.set(!0);try{let n=`\u8ACB\u5C07\u4EE5\u4E0B\u8A71\u8853\u512A\u5316\u70BA${this.getStyleDescription(t)}\u98A8\u683C\uFF0C\u4FDD\u6301\u539F\u610F\u4F46\u66F4\u6709\u5438\u5F15\u529B\uFF1A

\u539F\u6587\uFF1A${e}

\u512A\u5316\u5F8C\uFF1A`,o=await this.ipc.invoke("ai-generate-text",{prompt:n,maxTokens:300,count:1});return o.success&&o.texts?.[0]?o.texts[0]:e}finally{this._isGenerating.set(!1)}}async suggestReply(e,t){return this.generate({type:"reply",style:"friendly",context:{previousMessages:[e,...t?.previousMessages||[]]},options:{count:3}})}getAllTemplates(){return[...this.systemTemplates,...this._savedTemplates()]}getTemplatesForType(e){return this.getAllTemplates().filter(t=>t.type===e)}saveTemplate(e){let t=P(E({},e),{id:`tpl-${Date.now()}`,isSystem:!1});this._savedTemplates.update(n=>[...n,t]),this.persistTemplates()}deleteTemplate(e){this._savedTemplates.update(t=>t.filter(n=>n.id!==e)),this.persistTemplates()}applyTemplate(e,t){let n=e.template;for(let[o,a]of Object.entries(t))n=n.replace(new RegExp(`{${o}}`,"g"),a||"");return n=n.replace(/\{[^}]+\}/g,""),n.trim()}buildPrompt(e){let t={greeting:"\u751F\u6210\u958B\u5834\u767D/\u554F\u5019\u8A9E",reply:"\u751F\u6210\u56DE\u8986\u6D88\u606F",follow_up:"\u751F\u6210\u8DDF\u9032\u6D88\u606F",objection:"\u751F\u6210\u7570\u8B70\u8655\u7406\u8A71\u8853",closing:"\u751F\u6210\u4FC3\u6210\u6210\u4EA4\u8A71\u8853",retention:"\u751F\u6210\u633D\u56DE\u5BA2\u6236\u8A71\u8853"},n=e.style?`\u98A8\u683C\u8981\u6C42\uFF1A${this.getStyleDescription(e.style)}`:"",o=`\u4F5C\u70BA\u5C08\u696D\u7684\u92B7\u552E\u8A71\u8853\u5C08\u5BB6\uFF0C\u8ACB${t[e.type]}\u3002

${n}

`;return e.context?.productName&&(o+=`\u7522\u54C1/\u670D\u52D9\uFF1A${e.context.productName}
`),e.context?.customerName&&(o+=`\u5BA2\u6236\u7A31\u547C\uFF1A${e.context.customerName}
`),e.context?.previousMessages?.length&&(o+=`
\u5C0D\u8A71\u4E0A\u4E0B\u6587\uFF1A
${e.context.previousMessages.join(`
`)}
`),e.context?.objection&&(o+=`
\u5BA2\u6236\u7570\u8B70\uFF1A${e.context.objection}
`),e.context?.goal&&(o+=`
\u76EE\u6A19\uFF1A${e.context.goal}
`),o+=`
\u8981\u6C42\uFF1A
1. \u81EA\u7136\u53E3\u8A9E\u5316\uFF0C\u4E0D\u8981\u592A\u751F\u786C
2. \u7C21\u6F54\u6709\u529B\uFF0C\u4E0D\u8981\u592A\u9577
3. \u6709\u89AA\u548C\u529B\uFF0C\u8B93\u5BA2\u6236\u611F\u5230\u8212\u9069
${e.options?.includeEmoji?"4. \u9069\u7576\u4F7F\u7528\u8868\u60C5\u7B26\u865F":""}

\u8ACB\u76F4\u63A5\u7D66\u51FA\u8A71\u8853\uFF0C\u4E0D\u9700\u8981\u89E3\u91CB\uFF1A`,o}getStyleDescription(e){return{professional:"\u5C08\u696D\u6B63\u5F0F\uFF0C\u7528\u8A5E\u7CBE\u6E96\uFF0C\u7D66\u4EBA\u4FE1\u8CF4\u611F",friendly:"\u89AA\u5207\u53CB\u597D\uFF0C\u50CF\u670B\u53CB\u804A\u5929\u4E00\u6A23\u81EA\u7136",casual:"\u8F15\u9B06\u96A8\u610F\uFF0C\u53E3\u8A9E\u5316\uFF0C\u4E0D\u62D8\u8B39",urgent:"\u5E36\u6709\u9069\u5EA6\u7DCA\u8FEB\u611F\uFF0C\u4FC3\u9032\u6C7A\u7B56",empathetic:"\u5BCC\u6709\u540C\u7406\u5FC3\uFF0C\u7406\u89E3\u5BA2\u6236\u8655\u5883"}[e]}postProcess(e,t){let n=e.trim();return n.startsWith('"')&&n.endsWith('"')&&(n=n.slice(1,-1)),t.context?.customerName&&(n=n.replace(/\{customerName\}/g,t.context.customerName)),t.context?.productName&&(n=n.replace(/\{productName\}/g,t.context.productName)),n}evaluateQuality(e,t){let n=70;return e.length>=20&&e.length<=200&&(n+=10),t.options?.includeEmoji&&/[\u{1F300}-\u{1F9FF}]/u.test(e)&&(n+=5),(e.includes("\uFF1F")||e.includes("?"))&&(n+=5),t.context?.customerName&&e.includes(t.context.customerName)&&(n+=5),Math.min(100,n)}extractTags(e){let t=[e.type];return e.style&&t.push(e.style),e.options?.includeEmoji&&t.push("emoji"),e.context?.productName&&t.push("\u7522\u54C1\u76F8\u95DC"),t}loadSavedTemplates(){try{let e=localStorage.getItem("copywriting_templates");e&&this._savedTemplates.set(JSON.parse(e))}catch(e){console.error("Failed to load templates:",e)}}persistTemplates(){localStorage.setItem("copywriting_templates",JSON.stringify(this._savedTemplates()))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var i1=class i{constructor(){this._isActive=f(!1);this.isActive=this._isActive.asReadonly();this._currentTour=f(null);this.currentTour=this._currentTour.asReadonly();this._currentStepIndex=f(0);this.currentStepIndex=this._currentStepIndex.asReadonly();this._progress=f(new Map);this.currentStep=R(()=>{let e=this._currentTour(),t=this._currentStepIndex();return e?.steps[t]||null});this.totalSteps=R(()=>this._currentTour()?.steps.length||0);this.progressPercent=R(()=>{let e=this.totalSteps();return e===0?0:Math.round(this._currentStepIndex()/e*100)});this.tours=[{id:"welcome",name:"\u6B61\u8FCE\u4F7F\u7528",description:"\u5FEB\u901F\u4E86\u89E3\u7CFB\u7D71\u7684\u6838\u5FC3\u529F\u80FD",trigger:"first_visit",version:1,steps:[{id:"welcome-intro",title:"\u6B61\u8FCE\u4F7F\u7528\u667A\u80FD\u71DF\u92B7\u7CFB\u7D71\uFF01 \u{1F389}",description:"\u9019\u662F\u60A8\u7684\u667A\u80FD\u71DF\u92B7\u52A9\u624B\uFF0C\u8B93\u6211\u5011\u82B12\u5206\u9418\u5FEB\u901F\u4E86\u89E3\u6838\u5FC3\u529F\u80FD\u3002",position:"center",skipable:!0},{id:"welcome-accounts",title:"1. \u6DFB\u52A0\u5E33\u865F",description:"\u9996\u5148\uFF0C\u60A8\u9700\u8981\u6DFB\u52A0 Telegram \u5E33\u865F\u3002\u9EDE\u64CA\u9019\u88E1\u958B\u59CB\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B\u5E33\u865F\u3002",target:'[data-tour="accounts"]',position:"bottom",actionLabel:"\u4E86\u89E3\u4E86"},{id:"welcome-marketing",title:"2. \u71DF\u92B7\u4EFB\u52D9\u4E2D\u5FC3",description:"\u9019\u662F\u60A8\u7684\u71DF\u92B7\u4EFB\u52D9\u6307\u63EE\u4E2D\u5FC3\u3002\u9078\u64C7\u76EE\u6A19\u3001\u914D\u7F6E AI\uFF0C\u4E00\u9375\u555F\u52D5\u71DF\u92B7\u4EFB\u52D9\u3002",target:'[data-tour="marketing-hub"]',position:"bottom",actionLabel:"\u4E0B\u4E00\u6B65"},{id:"welcome-roles",title:"3. \u89D2\u8272\u8CC7\u6E90\u5EAB",description:"\u9019\u88E1\u7BA1\u7406 AI \u89D2\u8272\u548C\u5287\u672C\u3002\u7CFB\u7D71\u9810\u8A2D\u4E8650+\u5C08\u696D\u89D2\u8272\uFF0C\u60A8\u4E5F\u53EF\u4EE5\u81EA\u5B9A\u7FA9\u3002",target:'[data-tour="role-library"]',position:"bottom",actionLabel:"\u4E0B\u4E00\u6B65"},{id:"welcome-ai",title:"4. \u667A\u80FD\u5F15\u64CE",description:"\u914D\u7F6E AI \u6A21\u578B\u3001\u77E5\u8B58\u5EAB\u548C\u4EBA\u683C\u98A8\u683C\u3002\u5EFA\u8B70\u5148\u5B8C\u6210\u9019\u88E1\u7684\u914D\u7F6E\u3002",target:'[data-tour="ai-engine"]',position:"bottom",actionLabel:"\u4E0B\u4E00\u6B65"},{id:"welcome-done",title:"\u6E96\u5099\u5C31\u7DD2\uFF01 \u{1F680}",description:`\u60A8\u5DF2\u4E86\u89E3\u57FA\u672C\u529F\u80FD\u3002\u5EFA\u8B70\u5148\u6DFB\u52A0\u5E33\u865F\uFF0C\u7136\u5F8C\u5617\u8A66\u5275\u5EFA\u60A8\u7684\u7B2C\u4E00\u500B\u71DF\u92B7\u4EFB\u52D9\u3002

\u96A8\u6642\u53EF\u4EE5\u5728\u8A2D\u7F6E\u4E2D\u91CD\u65B0\u67E5\u770B\u5F15\u5C0E\u3002`,position:"center",actionLabel:"\u958B\u59CB\u4F7F\u7528"}]},{id:"create-task",name:"\u5275\u5EFA\u71DF\u92B7\u4EFB\u52D9",description:"\u5B78\u7FD2\u5982\u4F55\u5275\u5EFA\u548C\u914D\u7F6E\u71DF\u92B7\u4EFB\u52D9",trigger:"manual",version:1,steps:[{id:"task-goal",title:"\u9078\u64C7\u71DF\u92B7\u76EE\u6A19",description:"\u9996\u5148\u9078\u64C7\u60A8\u8981\u9054\u6210\u7684\u76EE\u6A19\u3002\u4E0D\u540C\u76EE\u6A19\u6703\u6709\u4E0D\u540C\u7684 AI \u7B56\u7565\u3002",target:".goal-selector",position:"bottom"},{id:"task-audience",title:"\u9078\u64C7\u76EE\u6A19\u5BA2\u7FA4",description:"\u6307\u5B9A\u9019\u6B21\u4EFB\u52D9\u8981\u89F8\u9054\u7684\u5BA2\u6236\u3002\u53EF\u4EE5\u6309\u6A19\u7C64\u3001\u7FA4\u7D44\u6216\u610F\u5411\u5206\u6578\u7BE9\u9078\u3002",target:".audience-selector",position:"bottom"},{id:"task-config",title:"\u78BA\u8A8D AI \u914D\u7F6E",description:"AI \u6703\u6839\u64DA\u76EE\u6A19\u81EA\u52D5\u63A8\u85A6\u914D\u7F6E\uFF0C\u60A8\u4E5F\u53EF\u4EE5\u624B\u52D5\u8ABF\u6574\u3002",target:".config-panel",position:"left"},{id:"task-launch",title:"\u555F\u52D5\u4EFB\u52D9",description:"\u78BA\u8A8D\u7121\u8AA4\u5F8C\uFF0C\u9EDE\u64CA\u555F\u52D5\u6309\u9215\u3002AI \u6703\u958B\u59CB\u81EA\u52D5\u57F7\u884C\u71DF\u92B7\u4EFB\u52D9\u3002",target:".launch-button",position:"top"}]},{id:"ai-config",name:"\u914D\u7F6E AI \u5F15\u64CE",description:"\u5B78\u7FD2\u5982\u4F55\u914D\u7F6E AI \u6A21\u578B\u548C\u77E5\u8B58\u5EAB",trigger:"manual",version:1,steps:[{id:"ai-model",title:"\u9078\u64C7 AI \u6A21\u578B",description:"\u9078\u64C7\u8981\u4F7F\u7528\u7684 AI \u6A21\u578B\u3002GPT-4 \u6548\u679C\u6700\u597D\uFF0CGPT-3.5 \u6210\u672C\u6700\u4F4E\u3002",target:'[data-tour="ai-model"]',position:"bottom"},{id:"ai-apikey",title:"\u914D\u7F6E API Key",description:"\u8F38\u5165\u60A8\u7684 OpenAI \u6216\u5176\u4ED6 AI \u670D\u52D9\u7684 API Key\u3002",target:'[data-tour="api-key"]',position:"bottom"},{id:"ai-knowledge",title:"\u6DFB\u52A0\u77E5\u8B58\u5EAB",description:"\u4E0A\u50B3\u7522\u54C1\u8CC7\u6599\u3001FAQ \u7B49\u6587\u6A94\uFF0CAI \u6703\u5B78\u7FD2\u9019\u4E9B\u77E5\u8B58\u4F86\u56DE\u7B54\u5BA2\u6236\u554F\u984C\u3002",target:'[data-tour="knowledge-base"]',position:"right"},{id:"ai-persona",title:"\u8A2D\u7F6E AI \u4EBA\u683C",description:"\u8ABF\u6574 AI \u7684\u8AAA\u8A71\u98A8\u683C\u548C\u4EBA\u683C\u7279\u9EDE\uFF0C\u8B93\u56DE\u8986\u66F4\u81EA\u7136\u3002",target:'[data-tour="ai-persona"]',position:"bottom"}]}];this.loadProgress(),this.checkAutoStart()}startTour(e){let t=this.tours.find(o=>o.id===e);if(!t)return;this._currentTour.set(t),this._currentStepIndex.set(0),this._isActive.set(!0);let n=t.steps[0];n.beforeShow?.(),this.highlightTarget(n.target)}nextStep(){let e=this._currentTour();if(!e)return;this.currentStep()?.afterComplete?.();let n=this._currentStepIndex()+1;if(n>=e.steps.length)this.completeTour();else{this._currentStepIndex.set(n);let o=e.steps[n];o.beforeShow?.(),this.highlightTarget(o.target)}}prevStep(){let e=this._currentStepIndex()-1;if(e<0)return;this._currentStepIndex.set(e);let t=this._currentTour()?.steps[e];t&&(t.beforeShow?.(),this.highlightTarget(t.target))}goToStep(e){let t=this._currentTour();if(!t||e<0||e>=t.steps.length)return;this._currentStepIndex.set(e);let n=t.steps[e];n.beforeShow?.(),this.highlightTarget(n.target)}skipTour(){let e=this._currentTour();e&&(this.updateProgress(e.id,{tourId:e.id,currentStep:this._currentStepIndex(),completed:!1,skipped:!0,version:e.version}),this.closeTour())}completeTour(){let e=this._currentTour();e&&(this.updateProgress(e.id,{tourId:e.id,currentStep:e.steps.length,completed:!0,skipped:!1,completedAt:new Date().toISOString(),version:e.version}),this.closeTour())}closeTour(){this.clearHighlight(),this._isActive.set(!1),this._currentTour.set(null),this._currentStepIndex.set(0)}isCompleted(e){return this._progress().get(e)?.completed||!1}resetTour(e){this._progress.update(t=>{let n=new Map(t);return n.delete(e),n}),this.saveProgress()}resetAll(){this._progress.set(new Map),this.saveProgress()}getAvailableTours(){return this.tours}checkAutoStart(){for(let e of this.tours){if(e.trigger!=="first_visit")continue;let t=this._progress().get(e.id);if(!t||t.version!==e.version&&!t.completed){setTimeout(()=>this.startTour(e.id),1e3);break}}}updateProgress(e,t){this._progress.update(n=>{let o=new Map(n);return o.set(e,t),o}),this.saveProgress()}highlightTarget(e){if(this.clearHighlight(),!e)return;let t=document.querySelector(e);t&&(t.classList.add("onboarding-highlight"),t.scrollIntoView({behavior:"smooth",block:"center"}))}clearHighlight(){document.querySelectorAll(".onboarding-highlight").forEach(e=>{e.classList.remove("onboarding-highlight")})}loadProgress(){try{let e=localStorage.getItem("onboarding_progress");if(e){let t=JSON.parse(e);this._progress.set(new Map(Object.entries(t)))}}catch(e){console.error("Failed to load onboarding progress:",e)}}saveProgress(){let e=Object.fromEntries(this._progress());localStorage.setItem("onboarding_progress",JSON.stringify(e))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var j8={primary:"#8b5cf6",secondary:"#06b6d4",accent:"#ec4899",background:"#0f172a",surface:"#1e293b",text:"#f8fafc",textMuted:"#94a3b8",border:"#334155",success:"#10b981",warning:"#f59e0b",error:"#ef4444"},J8={primary:"#7c3aed",secondary:"#0891b2",accent:"#db2777",background:"#ffffff",surface:"#f8fafc",text:"#0f172a",textMuted:"#64748b",border:"#e2e8f0",success:"#059669",warning:"#d97706",error:"#dc2626"},bm=[{id:"default-dark",name:"\u9ED8\u8A8D\u6697\u8272",mode:"dark",colors:{}},{id:"default-light",name:"\u9ED8\u8A8D\u4EAE\u8272",mode:"light",colors:{}},{id:"midnight",name:"\u5348\u591C\u85CD",mode:"dark",colors:{primary:"#3b82f6",secondary:"#8b5cf6",background:"#0c1222",surface:"#162032"}},{id:"forest",name:"\u68EE\u6797\u7DA0",mode:"dark",colors:{primary:"#10b981",secondary:"#14b8a6",accent:"#22c55e",background:"#0a1410",surface:"#132820"}},{id:"sunset",name:"\u65E5\u843D\u6A59",mode:"dark",colors:{primary:"#f97316",secondary:"#fb923c",accent:"#ef4444",background:"#1c1210",surface:"#2a1f1a"}},{id:"ocean",name:"\u6D77\u6D0B",mode:"light",colors:{primary:"#0ea5e9",secondary:"#06b6d4",background:"#f0f9ff",surface:"#e0f2fe"}}],o1=class i{constructor(){this._mode=f("dark");this.mode=this._mode.asReadonly();this._activePreset=f("default-dark");this.activePreset=this._activePreset.asReadonly();this._customColors=f({});this.customColors=this._customColors.asReadonly();this.isDark=R(()=>{let e=this._mode();return e==="system"?this.getSystemPreference()==="dark":e==="dark"});this.currentColors=R(()=>{let e=this.isDark()?j8:J8,t=this.getPresetColors(),n=this._customColors();return E(E(E({},e),t),n)});this.presets=R(()=>bm);this.loadSettings(),this.setupSystemListener(),gt(()=>{this.applyTheme()})}setMode(e){this._mode.set(e),this.saveSettings()}toggle(){let e=this._mode();e==="system"?this._mode.set(this.isDark()?"light":"dark"):this._mode.set(e==="dark"?"light":"dark"),this.saveSettings()}applyPreset(e){let t=bm.find(n=>n.id===e);t&&(this._activePreset.set(e),this._mode.set(t.mode),this._customColors.set({}),this.saveSettings())}setCustomColor(e,t){this._customColors.update(n=>P(E({},n),{[e]:t})),this.saveSettings()}resetCustomColors(){this._customColors.set({}),this.saveSettings()}getCssVariables(){let e=this.currentColors();return Object.entries(e).map(([t,n])=>`--theme-${this.camelToKebab(t)}: ${n};`).join(`
`)}getPresetColors(){return bm.find(t=>t.id===this._activePreset())?.colors||{}}getSystemPreference(){return window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light"}setupSystemListener(){window.matchMedia?.("(prefers-color-scheme: dark)").addEventListener("change",()=>{this._mode()==="system"&&this.applyTheme()})}applyTheme(){let e=document.documentElement,t=this.currentColors();this.isDark()?(e.classList.add("dark"),e.classList.remove("light")):(e.classList.add("light"),e.classList.remove("dark"));for(let[o,a]of Object.entries(t))e.style.setProperty(`--theme-${this.camelToKebab(o)}`,a);let n=document.querySelector('meta[name="theme-color"]');n&&n.setAttribute("content",t.background)}camelToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}loadSettings(){try{let e=localStorage.getItem("theme_settings");if(e){let t=JSON.parse(e);this._mode.set(t.mode||"dark"),this._activePreset.set(t.preset||"default-dark"),this._customColors.set(t.customColors||{})}}catch(e){console.error("Failed to load theme settings:",e)}}saveSettings(){localStorage.setItem("theme_settings",JSON.stringify({mode:this._mode(),preset:this._activePreset(),customColors:this._customColors()}))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Q8={price_inquiry:["\u591A\u5C11\u9322","\u4EC0\u9EBC\u50F9\u683C","\u50F9\u683C","\u8CBB\u7528","\u6536\u8CBB","\u600E\u9EBC\u6536","\u5831\u50F9"],product_detail:["\u600E\u9EBC\u7528","\u6709\u4EC0\u9EBC\u529F\u80FD","\u8A73\u7D30\u4ECB\u7D39","\u4E86\u89E3\u4E00\u4E0B","\u80FD\u505A\u4EC0\u9EBC"],purchase_intent:["\u600E\u9EBC\u8CB7","\u5728\u54EA\u8CB7","\u6211\u8981","\u6211\u60F3\u8CB7","\u4E0B\u55AE","\u4ED8\u6B3E","\u8CFC\u8CB7"],positive_feedback:["\u4E0D\u932F","\u633A\u597D","\u53EF\u4EE5","\u884C","\u597D\u7684","\u611F\u8208\u8DA3"],comparison:["\u6BD4","\u5C0D\u6BD4","\u5340\u5225","\u5DEE\u5225","\u54EA\u500B\u597D"]},Y8={id:"default_marketing",name:"\u667A\u80FD\u71DF\u92B7\u5DE5\u4F5C\u6D41",enabled:!1,trigger:{type:"keyword_match",minIntentScore:60,cooldownMinutes:1440,excludeContacted:!0,excludeBlacklist:!0},steps:[{id:"evaluate",type:"evaluate",name:"\u7528\u6236\u8A55\u4F30",config:{},nextOnSuccess:"plan"},{id:"plan",type:"plan",name:"AI \u7B56\u5283",config:{},nextOnSuccess:"private_chat"},{id:"private_chat",type:"private_chat",name:"\u79C1\u804A\u5354\u4F5C",config:{},nextOnSuccess:"detect_interest"},{id:"detect_interest",type:"detect_interest",name:"\u8208\u8DA3\u6AA2\u6E2C",config:{},nextOnSuccess:"create_group",nextOnFail:"record"},{id:"create_group",type:"create_group",name:"\u81EA\u52D5\u5EFA\u7FA4",config:{},nextOnSuccess:"group_marketing"},{id:"group_marketing",type:"group_marketing",name:"\u7D44\u7FA4\u71DF\u92B7",config:{},nextOnSuccess:"record"},{id:"record",type:"record",name:"\u8A18\u9304\u7D50\u679C",config:{}}],config:{marketingGoal:"\u4FC3\u9032\u6210\u4EA4",roleCount:"auto",accountSelection:"auto",firstContactDelay:{min:5,max:15},interestSignals:["price_inquiry","purchase_intent","positive_feedback"]},stats:{totalTriggers:0,todayTriggers:0,activeExecutions:0,conversions:0},createdAt:new Date,updatedAt:new Date},qn=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.contacts=F(Kt);this.STORAGE_KEY="automationWorkflows";this._workflows=f([Y8]);this.workflows=this._workflows.asReadonly();this._executions=f(new Map);this.executions=R(()=>Array.from(this._executions().values()));this.activeExecutionCount=R(()=>this.executions().filter(e=>e.status==="running"||e.status==="pending").length);this.userCooldowns=new Map;this.ipcCleanups=[];this.loadFromStorage(),this.setupEventListeners(),console.log("[AutomationWorkflow] \u670D\u52D9\u5DF2\u521D\u59CB\u5316")}setupEventListeners(){let e=this.ipc.on("keyword-matched",a=>{this.handleKeywordMatch(a)});this.ipcCleanups.push(e);let t=this.ipc.on("lead-captured",a=>{this.handleLeadCaptured(a)});this.ipcCleanups.push(t);let n=this.ipc.on("private-message-received",a=>{this.handlePrivateMessage(a)});this.ipcCleanups.push(n);let o=this.ipc.on("collaboration-session-completed",a=>{this.handleSessionCompleted(a)});this.ipcCleanups.push(o)}handleKeywordMatch(e){console.log("[AutomationWorkflow] \u6536\u5230\u95DC\u9375\u8A5E\u5339\u914D:",e);let t=this._workflows().filter(n=>n.enabled&&n.trigger.type==="keyword_match");if(t.length===0){console.log("[AutomationWorkflow] \u7121\u555F\u7528\u7684\u5DE5\u4F5C\u6D41\uFF0C\u8DF3\u904E");return}for(let n of t)this.tryTriggerWorkflow(n,e)}async tryTriggerWorkflow(e,t){let n=t.userId;if(this.isUserInCooldown(n,e.trigger.cooldownMinutes||1440)){console.log(`[AutomationWorkflow] \u7528\u6236 ${n} \u5728\u51B7\u537B\u671F\u5167\uFF0C\u8DF3\u904E`);return}if(this.executions().find(g=>g.targetUserId===n&&(g.status==="running"||g.status==="pending"))){console.log(`[AutomationWorkflow] \u7528\u6236 ${n} \u5DF2\u6709\u9032\u884C\u4E2D\u7684\u5DE5\u4F5C\u6D41\uFF0C\u8DF3\u904E`);return}let a=this.evaluateUserIntent(t),d=e.trigger.minIntentScore||60;if(a<d){console.log(`[AutomationWorkflow] \u7528\u6236\u610F\u5411\u5206 ${a} < ${d}\uFF0C\u8DF3\u904E`);return}let u=this.createExecution(e,t,a);this.userCooldowns.set(n,new Date),this.updateWorkflowStats(e.id,"trigger"),this.toast.success(`\u{1F680} \u81EA\u52D5\u89F8\u767C\u5DE5\u4F5C\u6D41\uFF1A${e.name}`),console.log(`[AutomationWorkflow] \u958B\u59CB\u57F7\u884C\u5DE5\u4F5C\u6D41: ${e.name}\uFF0C\u76EE\u6A19\u7528\u6236: ${t.username||n}`);let p=this.getRandomDelay(e.config.firstContactDelay);console.log(`[AutomationWorkflow] \u5C07\u5728 ${p} \u79D2\u5F8C\u958B\u59CB\u57F7\u884C`),setTimeout(()=>{this.executeWorkflow(u.id)},p*1e3)}handleLeadCaptured(e){console.log("[AutomationWorkflow] \u6536\u5230\u7528\u6236\u6355\u7372\u4E8B\u4EF6:",e)}handlePrivateMessage(e){if(!e.fromUser)return;let t=this.executions().find(o=>o.targetUserId===e.userId&&o.status==="running"&&o.currentStep==="private_chat");if(!t)return;let n=this.detectInterestSignal(e.message);n&&(console.log("[AutomationWorkflow] \u6AA2\u6E2C\u5230\u8208\u8DA3\u4FE1\u865F:",n),this.updateExecutionStep(t.id,"detect_interest",{status:"success",data:n,timestamp:new Date}),(n.type==="purchase_intent"||n.type==="price_inquiry")&&(this.toast.info("\u{1F3AF} \u6AA2\u6E2C\u5230\u8CFC\u8CB7\u610F\u5411\uFF01\u6E96\u5099\u81EA\u52D5\u5EFA\u7FA4..."),this.advanceToStep(t.id,"create_group")))}handleSessionCompleted(e){let t=this.executions().find(n=>n.sessionId===e.sessionId);t&&(this.updateExecution(t.id,{outcome:e.outcome,status:"completed",completedAt:new Date}),e.outcome==="converted"&&this.updateWorkflowStats(t.workflowId,"conversion"))}async executeWorkflow(e){let t=this._executions().get(e);if(!t)return;let n=this._workflows().find(a=>a.id===t.workflowId);if(!n)return;this.updateExecution(e,{status:"running"});let o=n.steps.find(a=>a.id===t.currentStep);if(o){console.log(`[AutomationWorkflow] \u57F7\u884C\u6B65\u9A5F: ${o.name}`);try{let a=await this.executeStep(t,o,n);this.updateExecutionStep(e,o.id,a);let d=a.status==="success"?o.nextOnSuccess:o.nextOnFail;d?this.advanceToStep(e,d):(this.updateExecution(e,{status:"completed",completedAt:new Date}),console.log(`[AutomationWorkflow] \u5DE5\u4F5C\u6D41\u57F7\u884C\u5B8C\u6210: ${e}`))}catch(a){console.error("[AutomationWorkflow] \u6B65\u9A5F\u57F7\u884C\u5931\u6557:",a),this.updateExecutionStep(e,o.id,{status:"failed",error:a.message,timestamp:new Date}),this.updateExecution(e,{status:"failed"})}}}async executeStep(e,t,n){switch(t.type){case"evaluate":return{status:"success",timestamp:new Date};case"plan":return await this.executeAiPlanStep(e,n);case"private_chat":return await this.executePrivateChatStep(e,n);case"detect_interest":return{status:"success",timestamp:new Date};case"create_group":return await this.executeCreateGroupStep(e,n);case"group_marketing":return await this.executeGroupMarketingStep(e,n);case"record":return this.executeRecordStep(e);default:return{status:"skipped",timestamp:new Date}}}async executeAiPlanStep(e,t){return new Promise(n=>{let o=t.config.marketingGoal||"\u4FC3\u9032\u6210\u4EA4";console.log(`[AutomationWorkflow] \u8ABF\u7528 AI \u7B56\u5283\uFF0C\u76EE\u6A19: ${o}`),this.ipc.send("multi-role:ai-plan",{goal:o,targetUsers:[{id:e.targetUserId,username:e.targetUserName}],autoExecute:!0,workflowExecutionId:e.id});let a=this.ipc.on("multi-role:ai-plan-result",d=>{a(),d.success?(this.updateExecution(e.id,{aiPlanResult:d}),n({status:"success",data:d,timestamp:new Date})):n({status:"failed",error:d.error,timestamp:new Date})});setTimeout(()=>{a(),n({status:"failed",error:"\u7B56\u5283\u8D85\u6642",timestamp:new Date})},6e4)})}async executePrivateChatStep(e,t){return console.log(`[AutomationWorkflow] \u958B\u59CB\u79C1\u804A\u5354\u4F5C\uFF0C\u76EE\u6A19\u7528\u6236: ${e.targetUserName}`),this.ipc.send("multi-role:start-private-collaboration",{targetUserId:e.targetUserId,targetUserName:e.targetUserName,aiPlanResult:e.aiPlanResult,workflowExecutionId:e.id}),{status:"success",timestamp:new Date}}async executeCreateGroupStep(e,t){return new Promise(n=>{let o=(t.config.groupNameTemplate||"VIP \u670D\u52D9\u7FA4 - {user}").replace("{user}",e.targetUserName);console.log(`[AutomationWorkflow] \u81EA\u52D5\u5EFA\u7FA4: ${o}`),this.ipc.send("multi-role:auto-create-group",{groupName:o,targetUserId:e.targetUserId,workflowExecutionId:e.id});let a=this.ipc.on("multi-role:group-created",d=>{a(),d.success?(this.updateExecution(e.id,{groupId:d.groupId}),this.toast.success(`\u2705 \u5DF2\u81EA\u52D5\u5275\u5EFA\u7FA4\u7D44: ${o}`),n({status:"success",data:d,timestamp:new Date})):n({status:"failed",error:d.error,timestamp:new Date})});setTimeout(()=>{a(),n({status:"failed",error:"\u5EFA\u7FA4\u8D85\u6642",timestamp:new Date})},12e4)})}async executeGroupMarketingStep(e,t){return e.groupId?(console.log(`[AutomationWorkflow] \u958B\u59CB\u7D44\u7FA4\u71DF\u92B7\uFF0C\u7FA4\u7D44: ${e.groupId}`),this.ipc.send("multi-role:start-group-collaboration",{groupId:e.groupId,aiPlanResult:e.aiPlanResult,workflowExecutionId:e.id}),{status:"success",timestamp:new Date}):{status:"skipped",timestamp:new Date}}executeRecordStep(e){return console.log("[AutomationWorkflow] \u8A18\u9304\u57F7\u884C\u7D50\u679C:",e),{status:"success",timestamp:new Date}}evaluateUserIntent(e){let t=50,n=e.messagePreview?.toLowerCase()||"";return(n.includes("\u50F9\u683C")||n.includes("\u591A\u5C11\u9322"))&&(t+=20),(n.includes("\u600E\u9EBC\u8CB7")||n.includes("\u8CFC\u8CB7"))&&(t+=25),(n.includes("\u4E86\u89E3")||n.includes("\u4ECB\u7D39"))&&(t+=10),(n.includes("\u6025")||n.includes("\u99AC\u4E0A"))&&(t+=15),Math.min(100,t)}detectInterestSignal(e){let t=e.toLowerCase();for(let[n,o]of Object.entries(Q8))for(let a of o)if(t.includes(a))return{type:n,keyword:a,confidence:.8,message:e,detectedAt:new Date};return null}async detectInterestSignalWithAI(e,t=[]){let n=this.detectInterestSignal(e);return n&&n.confidence>=.8?n:new Promise(o=>{let a=t.slice(-5).join(`
`);this.ipc.send("ai:analyze-interest",{message:e,context:a,analysisType:"interest_signal"});let d=this.ipc.on("ai:analyze-interest-result",u=>{d(),u.success&&u.hasInterest?o({type:this.mapAISignalType(u.signalType),keyword:u.keyPhrase||e.substring(0,20),confidence:u.confidence||.7,message:e,detectedAt:new Date}):o(null)});setTimeout(()=>{d(),o(n)},5e3)})}mapAISignalType(e){return{price:"price_inquiry",buying:"purchase_intent",positive:"positive_feedback",detail:"product_detail",compare:"comparison"}[e]||"positive_feedback"}analyzeConversationStage(e){let t=e.filter(o=>o.fromUser).map(o=>o.text.toLowerCase()),n=t[t.length-1]||"";return this.containsAny(n,["\u600E\u9EBC\u4ED8\u6B3E","\u4E0B\u55AE","\u8CFC\u8CB7","\u4ED8\u9322","\u8F49\u5E33"])?{stage:"purchase",confidence:.9,nextAction:"\u63D0\u4F9B\u4ED8\u6B3E\u65B9\u5F0F"}:this.containsAny(n,["\u591A\u5C11\u9322","\u50F9\u683C","\u512A\u60E0","\u6298\u6263","\u4FBF\u5B9C"])?{stage:"intent",confidence:.85,nextAction:"\u5831\u50F9\u4E26\u5F37\u8ABF\u50F9\u503C"}:this.containsAny(n,["\u6709\u4EC0\u9EBC","\u80FD\u505A\u4EC0\u9EBC","\u529F\u80FD","\u8A73\u7D30","\u4E86\u89E3"])?{stage:"consideration",confidence:.8,nextAction:"\u8A73\u7D30\u4ECB\u7D39\u7522\u54C1"}:this.containsAny(n,["\u4E0D\u932F","\u53EF\u4EE5","\u633A\u597D","\u611F\u8208\u8DA3"])?{stage:"interest",confidence:.7,nextAction:"\u6316\u6398\u9700\u6C42"}:{stage:"awareness",confidence:.6,nextAction:"\u5EFA\u7ACB\u4FE1\u4EFB"}}containsAny(e,t){return t.some(n=>e.includes(n))}calculateConversionProbability(e){let t=.3,n=e.stepResults;if(n.plan?.status==="success"&&(t+=.1),n.private_chat?.status==="success"&&(t+=.15),n.detect_interest?.status==="success"){t+=.25;let o=n.detect_interest?.data;(o?.type==="purchase_intent"||o?.type==="price_inquiry")&&(t+=.15)}return n.create_group?.status==="success"&&(t+=.1),Math.min(.95,t)}isUserInCooldown(e,t){let n=this.userCooldowns.get(e);if(!n)return!1;let o=t*60*1e3;return Date.now()-n.getTime()<o}getRandomDelay(e){return Math.floor(Math.random()*(e.max-e.min+1))+e.min}createExecution(e,t,n){let o={id:`exec_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,workflowId:e.id,targetUserId:t.userId,targetUserName:t.username||t.firstName||"User",currentStep:e.steps[0].id,status:"pending",stepResults:{},startedAt:new Date,updatedAt:new Date};return this._executions.update(a=>{let d=new Map(a);return d.set(o.id,o),d}),o}updateExecution(e,t){this._executions.update(n=>{let o=new Map(n),a=o.get(e);return a&&o.set(e,P(E(E({},a),t),{updatedAt:new Date})),o})}updateExecutionStep(e,t,n){this._executions.update(o=>{let a=new Map(o),d=a.get(e);return d&&a.set(e,P(E({},d),{stepResults:P(E({},d.stepResults),{[t]:n}),updatedAt:new Date})),a})}advanceToStep(e,t){this.updateExecution(e,{currentStep:t}),setTimeout(()=>{this.executeWorkflow(e)},1e3)}updateWorkflowStats(e,t){this._workflows.update(n=>n.map(o=>o.id!==e?o:P(E({},o),{stats:P(E({},o.stats),{totalTriggers:o.stats.totalTriggers+(t==="trigger"?1:0),todayTriggers:o.stats.todayTriggers+(t==="trigger"?1:0),conversions:o.stats.conversions+(t==="conversion"?1:0),lastTriggeredAt:t==="trigger"?new Date:o.stats.lastTriggeredAt}),updatedAt:new Date}))),this.saveToStorage()}toggleWorkflow(e,t){this._workflows.update(n=>n.map(o=>o.id===e?P(E({},o),{enabled:t,updatedAt:new Date}):o)),this.saveToStorage(),this.toast.success(t?"\u2705 \u5DE5\u4F5C\u6D41\u5DF2\u555F\u7528":"\u23F8\uFE0F \u5DE5\u4F5C\u6D41\u5DF2\u66AB\u505C")}manualTrigger(e,t){let n=this._workflows().find(o=>o.id===e);if(!n){this.toast.error("\u627E\u4E0D\u5230\u5DE5\u4F5C\u6D41");return}this.tryTriggerWorkflow(n,P(E({},t),{messagePreview:"\u624B\u52D5\u89F8\u767C",manual:!0}))}cancelExecution(e){this.updateExecution(e,{status:"cancelled",completedAt:new Date}),this.toast.info("\u5DF2\u53D6\u6D88\u5DE5\u4F5C\u6D41\u57F7\u884C")}getExecution(e){return this._executions().get(e)}saveToStorage(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this._workflows()))}catch(e){console.error("[AutomationWorkflow] \u4FDD\u5B58\u5931\u6557:",e)}}loadFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e);this._workflows.set(t.map(n=>P(E({},n),{createdAt:new Date(n.createdAt),updatedAt:new Date(n.updatedAt),stats:P(E({},n.stats),{lastTriggeredAt:n.stats.lastTriggeredAt?new Date(n.stats.lastTriggeredAt):void 0})})))}}catch(e){console.error("[AutomationWorkflow] \u8F09\u5165\u5931\u6557:",e)}}destroy(){this.ipcCleanups.forEach(e=>e())}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Zo=(i,e)=>e.id,X8=(i,e)=>e.contactId;function Z8(i,e){i&1&&(ne(),T(0,"svg",6),Se(1,"circle",30)(2,"path",31),k())}function eM(i,e){i&1&&l(0," \u{1F504} ")}function tM(i,e){if(i&1&&(T(0,"span",38),l(1),k()),i&2){let t=m().$implicit,n=m();N("bg-green-500/20",t.change>=0)("text-green-400",t.change>=0)("bg-red-500/20",t.change<0)("text-red-400",t.change<0),c(),X(" ",t.change>=0?"\u2191":"\u2193"," ",n.Math.abs(t.change).toFixed(1),"% ")}}function nM(i,e){if(i&1&&(T(0,"div",37),l(1),k()),i&2){let t=m().$implicit;c(),D(t.changeLabel)}}function iM(i,e){if(i&1){let t=I();T(0,"div",32),se("click",function(){let o=_(t).$implicit,a=m();return v(a.onMetricClick(o))}),T(1,"div",33)(2,"span",34),l(3),k(),y(4,tM,2,10,"span",35),k(),T(5,"div",3),l(6),k(),T(7,"div",36),l(8),k(),y(9,nM,2,1,"div",37),k()}if(i&2){let t=e.$implicit;ee("background",t.bgGradient)("border-color",t.color+"30"),c(3),D(t.icon),c(),S(t.change!==void 0?4:-1),c(2),D(t.value),c(2),D(t.label),c(),S(t.changeLabel?9:-1)}}function oM(i,e){if(i&1){let t=I();T(0,"button",45),se("click",function(){_(t);let o=m().$implicit,a=m();return v(a.onInsightAction(o))}),l(1),k()}if(i&2){let t=m().$implicit;c(),M(" ",t.actionLabel," \u2192 ")}}function rM(i,e){if(i&1&&(T(0,"div",39)(1,"div",40)(2,"span",34),l(3),k(),T(4,"div",41)(5,"div",42),l(6),k(),T(7,"div",43),l(8),k(),y(9,oM,2,1,"button",44),k()()()),i&2){let t=e.$implicit;N("border-green-500/30",t.type==="success")("border-yellow-500/30",t.type==="warning")("border-blue-500/30",t.type==="info")("border-purple-500/30",t.type==="tip"),c(3),D(t.icon),c(3),D(t.title),c(2),D(t.description),c(),S(t.actionLabel?9:-1)}}function sM(i,e){if(i&1){let t=I();T(0,"div",46),se("click",function(){let o=_(t).$implicit,a=m();return v(a.onLeadClick(o))}),T(1,"div",47),l(2),k(),T(3,"div",48),l(4),k(),T(5,"div",49)(6,"div",50),l(7),k(),T(8,"div",36),l(9),k()(),T(10,"div",51)(11,"div",52),l(12),k(),T(13,"div",53),l(14),k()()()}if(i&2){let t=e.$implicit,n=e.$index,o=m();c(),N("bg-amber-500/20",n===0)("text-amber-400",n===0)("bg-slate-700",n!==0)("text-slate-400",n!==0),c(),M(" ",n+1," "),c(2),M(" ",o.getInitial(t.contactId)," "),c(3),M("\u5BA2\u6236 ",t.contactId.slice(-6)),c(2),X(" ",t.activityCount," \u6B21\u4E92\u52D5 \xB7 ",o.formatDate(t.lastActivity)," "),c(2),ee("color",o.getHeatColor(t.heatLevel)),c(),M(" ",t.totalScore," "),c(),ee("color",o.getHeatColor(t.heatLevel)),c(),X(" ",o.getHeatIcon(t.heatLevel)," ",o.getHeatLabel(t.heatLevel)," ")}}function aM(i,e){i&1&&(T(0,"div",21)(1,"div",54),l(2,"\u{1F4ED}"),k(),T(3,"p"),l(4,"\u66AB\u7121\u71B1\u9580\u5BA2\u6236\u6578\u64DA"),k(),T(5,"p",55),l(6,"\u958B\u59CB\u767C\u9001\u6D88\u606F\u4EE5\u751F\u6210\u8A55\u5206"),k()())}function lM(i,e){if(i&1){let t=I();T(0,"button",56),se("click",function(){let o=_(t).$implicit,a=m();return v(a.navigateTo.emit(o.view))}),T(1,"div",57),l(2),k(),T(3,"div",58),l(4),k(),T(5,"div",59),l(6),k()()}if(i&2){let t=e.$implicit;ee("background",t.color+"15")("border","1px solid "+t.color+"30"),c(2),D(t.icon),c(2),D(t.label),c(2),D(t.description)}}function cM(i,e){if(i&1&&(T(0,"div",27)(1,"div",60),l(2),k(),T(3,"div",49)(4,"div",61),l(5),k(),T(6,"div",62),l(7),k()(),T(8,"div",63),l(9),k()()),i&2){let t=e.$implicit;c(),N("bg-blue-500/20",t.type==="message")("bg-green-500/20",t.type==="reply")("bg-purple-500/20",t.type==="conversion")("bg-amber-500/20",t.type==="lead")("bg-slate-700",t.type==="system"),c(),M(" ",t.icon," "),c(3),D(t.title),c(2),D(t.description),c(2),D(t.time)}}function dM(i,e){i&1&&(T(0,"div",28),l(1," \u66AB\u7121\u6D3B\u52D5\u8A18\u9304 "),k())}function uM(i,e){if(i&1&&(T(0,"div",41)(1,"div",68)(2,"span",4),l(3),k(),T(4,"span",69),l(5),k()(),T(6,"div",70),Se(7,"div",71),k()()),i&2){let t=e.$implicit;c(3),D(t.name),c(2),M("",t.stats.conversionRate.toFixed(1),"%"),c(2),ee("width",t.stats.conversionRate*2,"%")}}function mM(i,e){if(i&1&&(T(0,"div",65)(1,"div",66),l(2),k(),T(3,"div",67),O(4,uM,8,4,"div",41,Zo),k()()),i&2){let t=e.$implicit;c(2),D(t.name),c(2),U(t.variants)}}function pM(i,e){if(i&1&&(T(0,"div",29)(1,"div",12)(2,"h2",13),l(3," \u{1F9EA} \u904B\u884C\u4E2D\u7684 A/B \u6E2C\u8A66 "),k(),T(4,"span",64),l(5),k()(),T(6,"div",15),O(7,mM,6,1,"div",65,Zo),k()()),i&2){let t=m();c(5),M(" ",t.abTestingService.activeTests().length," \u500B\u6E2C\u8A66 "),c(2),U(t.abTestingService.activeTests().slice(0,2))}}var gc=class i{constructor(){this.scoringService=F(lc);this.abTestingService=F(dc);this.navigateTo=ge();this.isRefreshing=f(!1);this.Math=Math;this.quickActions=[{id:"q1",icon:"\u{1F3AF}",label:"\u7B56\u7565\u898F\u5283",description:"AI \u71DF\u92B7\u52A9\u624B",color:"#f97316",view:"ai-assistant"},{id:"q2",icon:"\u{1F916}",label:"\u81EA\u52D5\u57F7\u884C",description:"AI \u5718\u968A\u92B7\u552E",color:"#a855f7",view:"ai-team"},{id:"q3",icon:"\u{1F4C7}",label:"\u8CC7\u6E90\u4E2D\u5FC3",description:"\u7BA1\u7406\u806F\u7E6B\u4EBA",color:"#22c55e",view:"resource-center"},{id:"q4",icon:"\u{1F4CA}",label:"\u6578\u64DA\u5206\u6790",description:"\u67E5\u770B\u5831\u544A",color:"#06b6d4",view:"analytics"}];this.metricCards=R(()=>{let e=this.scoringService.stats();return[{id:"m1",icon:"\u{1F465}",label:"\u7E3D\u806F\u7E6B\u4EBA",value:e.total,change:12.5,changeLabel:"\u8F03\u4E0A\u9031",color:"#3b82f6",bgGradient:"linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05))"},{id:"m2",icon:"\u{1F525}",label:"\u71B1\u9580\u5BA2\u6236",value:e.byLevel.hot+e.byLevel.burning,change:8.3,changeLabel:"\u9AD8\u8CFC\u8CB7\u610F\u5411",color:"#f97316",bgGradient:"linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(234, 88, 12, 0.05))"},{id:"m3",icon:"\u{1F4CA}",label:"\u5E73\u5747\u8A55\u5206",value:e.avgScore.toFixed(0),change:e.avgScore>30?5.2:-2.1,changeLabel:"\u4E92\u52D5\u71B1\u5EA6",color:"#22c55e",bgGradient:"linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.05))"},{id:"m4",icon:"\u{1F9EA}",label:"A/B \u6E2C\u8A66",value:this.abTestingService.stats().running,changeLabel:"\u904B\u884C\u4E2D",color:"#a855f7",bgGradient:"linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(139, 92, 246, 0.05))"}]});this.aiInsights=f([]);this.hotLeads=R(()=>this.scoringService.getHotLeads(5));this.recentActivities=f([])}ngOnInit(){this.generateInsights(),this.loadRecentActivities()}ngOnDestroy(){}getGreeting(){let e=new Date().getHours();return e<12?"\u65E9\u5B89 \u2600\uFE0F":e<18?"\u5348\u5B89 \u{1F324}\uFE0F":"\u665A\u5B89 \u{1F319}"}getTodayDate(){return new Date().toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",weekday:"long"})}async refresh(){this.isRefreshing.set(!0),await new Promise(e=>setTimeout(e,1e3)),this.generateInsights(),this.loadRecentActivities(),this.isRefreshing.set(!1)}generateInsights(){let e=this.scoringService.stats(),t=[];e.byLevel.burning>0&&t.push({id:"i1",icon:"\u{1F3AF}",type:"success",title:`${e.byLevel.burning} \u500B\u7206\u71B1\u5BA2\u6236`,description:"\u9019\u4E9B\u5BA2\u6236\u8CFC\u8CB7\u610F\u5411\u6975\u9AD8\uFF0C\u5EFA\u8B70\u7ACB\u5373\u8DDF\u9032\uFF01",action:"hot-leads",actionLabel:"\u7ACB\u5373\u67E5\u770B"}),e.byLevel.cold>e.total*.5&&t.push({id:"i2",icon:"\u26A0\uFE0F",type:"warning",title:"\u8D85\u904E\u534A\u6578\u5BA2\u6236\u8655\u65BC\u51B7\u6DE1\u72C0\u614B",description:"\u5EFA\u8B70\u91CD\u65B0\u555F\u52D5\u71DF\u92B7\u6D3B\u52D5\uFF0C\u63D0\u5347\u5BA2\u6236\u4E92\u52D5",action:"ai-assistant",actionLabel:"\u5275\u5EFA\u71DF\u92B7\u6D3B\u52D5"});let n=this.abTestingService.stats();n.completed>0&&n.avgConversionLift>10&&t.push({id:"i3",icon:"\u{1F4C8}",type:"success",title:`A/B \u6E2C\u8A66\u63D0\u5347\u8F49\u5316 ${n.avgConversionLift.toFixed(1)}%`,description:"\u60A8\u7684\u6E2C\u8A66\u7B56\u7565\u6548\u679C\u986F\u8457\uFF0C\u5EFA\u8B70\u7E7C\u7E8C\u512A\u5316",action:"analytics",actionLabel:"\u67E5\u770B\u8A73\u60C5"}),t.length<2&&t.push({id:"i4",icon:"\u{1F4A1}",type:"tip",title:"\u4F7F\u7528 AI \u7B56\u7565\u898F\u5283",description:"\u8B93 AI \u5E6B\u60A8\u751F\u6210\u9AD8\u8F49\u5316\u7684\u71DF\u92B7\u7B56\u7565",action:"ai-assistant",actionLabel:"\u958B\u59CB\u898F\u5283"}),t.length<4&&t.push({id:"i5",icon:"\u{1F916}",type:"info",title:"\u5617\u8A66 AI \u5718\u968A\u92B7\u552E",description:"\u4E00\u53E5\u8A71\u555F\u52D5 AI \u81EA\u52D5\u5316\u92B7\u552E\u6D41\u7A0B",action:"ai-team",actionLabel:"\u4E86\u89E3\u66F4\u591A"}),this.aiInsights.set(t.slice(0,4))}regenerateInsights(){this.generateInsights()}loadRecentActivities(){let t=this.scoringService.globalHistory().slice(0,10).map(n=>({id:n.id,icon:this.getActivityIcon(n.action),title:n.reason,description:`\u5BA2\u6236 ${n.contactId.slice(-6)} \xB7 ${n.points>0?"+":""}${n.points} \u5206`,time:this.formatTime(n.timestamp),type:this.getActivityType(n.action)}));this.recentActivities.set(t)}getActivityIcon(e){return{message_sent:"\u{1F4E4}",message_replied:"\u{1F4AC}",positive_reply:"\u{1F60A}",negative_reply:"\u{1F61E}",price_inquiry:"\u{1F4B0}",demo_requested:"\u{1F3AC}",meeting_scheduled:"\u{1F4C5}",referral_made:"\u{1F91D}"}[e]||"\u{1F4CC}"}getActivityType(e){return e.includes("reply")?"reply":e.includes("message")?"message":e.includes("meeting")||e.includes("demo")?"conversion":"lead"}formatTime(e){let t=new Date(e),o=new Date().getTime()-t.getTime(),a=Math.floor(o/6e4);if(a<1)return"\u525B\u525B";if(a<60)return`${a} \u5206\u9418\u524D`;let d=Math.floor(a/60);return d<24?`${d} \u5C0F\u6642\u524D`:t.toLocaleDateString("zh-TW",{month:"short",day:"numeric"})}getInitial(e){return e.charAt(0).toUpperCase()}formatDate(e){return e?this.formatTime(e):"\u7121\u8A18\u9304"}getHeatColor(e){return this.scoringService.getHeatLevelConfig(e).color}getHeatIcon(e){return this.scoringService.getHeatLevelConfig(e).icon}getHeatLabel(e){return this.scoringService.getHeatLevelConfig(e).label}onMetricClick(e){switch(e.id){case"m1":this.navigateTo.emit("resource-center");break;case"m2":this.navigateTo.emit("leads");break;case"m3":this.navigateTo.emit("analytics");break;case"m4":break}}onInsightAction(e){e.action&&this.navigateTo.emit(e.action)}onLeadClick(e){this.navigateTo.emit("leads")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-smart-dashboard"]],outputs:{navigateTo:"navigateTo"},decls:51,vars:7,consts:[[1,"smart-dashboard","h-full","overflow-y-auto","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900"],[1,"p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-slate-400"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","flex","items-center","gap-2","disabled:opacity-50",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"w-4","h-4","animate-spin"],[1,"grid","grid-cols-4","gap-4"],[1,"p-5","rounded-2xl","border","transition-all","hover:scale-[1.02]","cursor-pointer",3,"background","border-color"],[1,"grid","grid-cols-3","gap-6"],[1,"col-span-2","space-y-6"],[1,"p-5","bg-gradient-to-r","from-purple-500/10","via-cyan-500/10","to-blue-500/10","rounded-2xl","border","border-purple-500/20"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-cyan-400","hover:text-cyan-300","transition-colors",3,"click"],[1,"grid","grid-cols-2","gap-4"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30","hover:border-slate-600/50","transition-colors",3,"border-green-500/30","border-yellow-500/30","border-blue-500/30","border-purple-500/30"],[1,"p-5","bg-slate-800/30","rounded-2xl","border","border-slate-700/50"],[1,"text-sm","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"space-y-3"],[1,"flex","items-center","gap-4","p-3","bg-slate-800/50","rounded-xl","hover:bg-slate-700/50","transition-colors","cursor-pointer"],[1,"text-center","py-8","text-slate-500"],[1,"space-y-6"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-3"],[1,"p-4","rounded-xl","text-left","transition-all","hover:scale-[1.03]","group",3,"background","border"],[1,"space-y-3","max-h-80","overflow-y-auto"],[1,"flex","items-start","gap-3","p-2","rounded-lg","hover:bg-slate-700/30","transition-colors"],[1,"text-center","py-6","text-slate-500","text-sm"],[1,"p-5","bg-gradient-to-r","from-amber-500/10","to-orange-500/10","rounded-2xl","border","border-amber-500/20"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"p-5","rounded-2xl","border","transition-all","hover:scale-[1.02]","cursor-pointer",3,"click"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-2xl"],[1,"text-xs","px-2","py-1","rounded-full",3,"bg-green-500/20","text-green-400","bg-red-500/20","text-red-400"],[1,"text-sm","text-slate-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-xs","px-2","py-1","rounded-full"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30","hover:border-slate-600/50","transition-colors"],[1,"flex","items-start","gap-3"],[1,"flex-1"],[1,"font-medium","text-white","mb-1"],[1,"text-sm","text-slate-400","mb-2"],[1,"text-xs","text-cyan-400","hover:text-cyan-300","transition-colors"],[1,"text-xs","text-cyan-400","hover:text-cyan-300","transition-colors",3,"click"],[1,"flex","items-center","gap-4","p-3","bg-slate-800/50","rounded-xl","hover:bg-slate-700/50","transition-colors","cursor-pointer",3,"click"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","font-bold","text-sm"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-white","font-bold"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","truncate"],[1,"text-right"],[1,"text-lg","font-bold"],[1,"text-xs","flex","items-center","gap-1"],[1,"text-4xl","mb-2"],[1,"text-sm","mt-1"],[1,"p-4","rounded-xl","text-left","transition-all","hover:scale-[1.03]","group",3,"click"],[1,"text-2xl","mb-2"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-slate-400","mt-0.5"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","text-sm"],[1,"text-sm","text-white"],[1,"text-xs","text-slate-500","truncate"],[1,"text-xs","text-slate-500","whitespace-nowrap"],[1,"px-2","py-1","bg-amber-500/20","text-amber-400","text-xs","rounded-full"],[1,"p-4","bg-slate-800/50","rounded-xl"],[1,"font-medium","text-white","mb-2"],[1,"flex","items-center","gap-4","text-sm"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-white"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),l(5),k(),T(6,"p",4),l(7),k()(),T(8,"button",5),se("click",function(){return n.refresh()}),y(9,Z8,3,0,":svg:svg",6)(10,eM,1,0),l(11," \u5237\u65B0 "),k()(),T(12,"div",7),O(13,iM,10,9,"div",8,Zo),k(),T(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"h2",13),l(20," \u{1F916} AI \u667A\u80FD\u6D1E\u5BDF "),k(),T(21,"button",14),se("click",function(){return n.regenerateInsights()}),l(22," \u2728 \u91CD\u65B0\u5206\u6790 "),k()(),T(23,"div",15),O(24,rM,10,12,"div",16,Zo),k()(),T(26,"div",17)(27,"div",12)(28,"h2",13),l(29," \u{1F525} \u71B1\u9580\u5BA2\u6236 "),k(),T(30,"button",18),se("click",function(){return n.navigateTo.emit("leads")}),l(31," \u67E5\u770B\u5168\u90E8 \u2192 "),k()(),T(32,"div",19),O(33,sM,15,20,"div",20,X8,!1,aM,7,0,"div",21),k()()(),T(36,"div",22)(37,"div",17)(38,"h2",23),l(39," \u26A1 \u5FEB\u901F\u64CD\u4F5C "),k(),T(40,"div",24),O(41,lM,7,7,"button",25,Zo),k()(),T(43,"div",17)(44,"h2",23),l(45," \u{1F4E1} \u5BE6\u6642\u52D5\u614B "),k(),T(46,"div",26),O(47,cM,10,14,"div",27,Zo,!1,dM,2,0,"div",28),k()()()(),y(50,pM,9,1,"div",29),k()()),t&2&&(c(5),M(" ",n.getGreeting()," "),c(2),M(" ",n.getTodayDate()," \xB7 \u8B93 AI \u52A9\u60A8\u9AD8\u6548\u71DF\u92B7 "),c(),Ke("disabled",n.isRefreshing()),c(),S(n.isRefreshing()?9:10),c(4),U(n.metricCards()),c(11),U(n.aiInsights()),c(9),U(n.hotLeads()),c(8),U(n.quickActions),c(6),U(n.recentActivities()),c(3),S(n.abTestingService.activeTests().length>0?50:-1))},dependencies:[oe],styles:["[_nghost-%COMP%]{display:block;height:100%}.smart-dashboard[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.smart-dashboard[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.smart-dashboard[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}"]})}};var hc=(i,e)=>e.id;function gM(i,e){if(i&1){let t=I();T(0,"div",7)(1,"div",10)(2,"span",11),l(3,"\u{1F4A1}"),k(),T(4,"span",12),l(5,"AI \u63A8\u85A6"),k()(),T(6,"h3",13),l(7),k(),T(8,"p",14),l(9),k(),T(10,"button",15),se("click",function(){_(t);let o=m(2);return v(o.startWorkflow(o.recommendedWorkflow()))}),l(11," \u958B\u59CB\u6B64\u6D41\u7A0B "),k()()}if(i&2){let t=m(2);c(7),D(t.recommendedWorkflow().title),c(2),D(t.recommendedWorkflow().description)}}function hM(i,e){if(i&1){let t=I();T(0,"div",16),se("click",function(){let o=_(t).$implicit,a=m(2);return v(a.startWorkflow(o))}),T(1,"div",17)(2,"span",18),l(3),k(),T(4,"div",19)(5,"div",20)(6,"h4",21),l(7),k(),T(8,"span",22),l(9),k()(),T(10,"p",23),l(11),k(),T(12,"div",24)(13,"span"),l(14),k(),T(15,"span"),l(16),k()()()()()}if(i&2){let t=e.$implicit,n=m(2);c(3),D(t.icon),c(4),M(" ",t.title," "),c(),N("bg-green-500/20",t.difficulty==="easy")("text-green-400",t.difficulty==="easy")("bg-yellow-500/20",t.difficulty==="medium")("text-yellow-400",t.difficulty==="medium")("bg-red-500/20",t.difficulty==="advanced")("text-red-400",t.difficulty==="advanced"),c(),M(" ",n.getDifficultyLabel(t.difficulty)," "),c(2),D(t.description),c(3),M("",t.steps.length," \u6B65\u9A5F"),c(2),M("\u7D04 ",t.estimatedTime)}}function fM(i,e){if(i&1&&(T(0,"div",5),y(1,gM,12,2,"div",7),T(2,"div",8),O(3,hM,17,18,"div",9,hc),k()()),i&2){let t=m();c(),S(t.recommendedWorkflow()?1:-1),c(2),U(t.workflows())}}function _M(i,e){if(i&1){let t=I();T(0,"button",29),se("click",function(){let o=_(t).$implicit,a=m(2);return v(a.activeCategory.set(o.id))}),l(1),k()}if(i&2){let t=e.$implicit,n=m(2);N("bg-purple-500",n.activeCategory()===t.id)("text-white",n.activeCategory()===t.id)("bg-slate-700/50",n.activeCategory()!==t.id)("text-slate-400",n.activeCategory()!==t.id)("hover:bg-slate-600/50",n.activeCategory()!==t.id),c(),X(" ",t.icon," ",t.label," ")}}function vM(i,e){i&1&&(T(0,"div",31),l(1," \u2B50 "),k())}function xM(i,e){if(i&1&&(T(0,"div",32),l(1),k()),i&2){let t=m().$implicit;c(),M(" ",t.badge," ")}}function CM(i,e){if(i&1){let t=I();T(0,"div",30),se("click",function(){let o=_(t).$implicit,a=m(2);return v(a.executeAction(o))}),y(1,vM,2,0,"div",31),y(2,xM,2,1,"div",32),T(3,"div",33),l(4),k(),T(5,"h4",34),l(6),k(),T(7,"p",35),l(8),k()()}if(i&2){let t=e.$implicit;c(),S(t.isRecommended?1:-1),c(),S(t.badge?2:-1),c(2),D(t.icon),c(2),M(" ",t.title," "),c(2),D(t.description)}}function bM(i,e){if(i&1&&(T(0,"div",5)(1,"div",25),O(2,_M,2,12,"button",26,hc),k(),T(4,"div",27),O(5,CM,9,5,"div",28,hc),k()()),i&2){let t=m();c(2),U(t.categories),c(3),U(t.filteredActions())}}function yM(i,e){i&1&&l(0," \u2713 ")}function SM(i,e){if(i&1&&l(0),i&2){let t=m().$index;M(" ",t+1," ")}}function wM(i,e){i&1&&l(0," \u2717 ")}function EM(i,e){if(i&1&&l(0),i&2){let t=m().$index;M(" ",t+1," ")}}function DM(i,e){i&1&&(T(0,"span",58),l(1,"\u53EF\u9078"),k())}function AM(i,e){if(i&1){let t=I();T(0,"button",61),se("click",function(){_(t);let o=m(2).$implicit,a=m(2);return v(a.skipStep(o))}),l(1," \u8DF3\u904E "),k()}}function MM(i,e){if(i&1){let t=I();T(0,"div",59)(1,"button",15),se("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.executeStep(o))}),l(2," \u57F7\u884C\u6B64\u6B65\u9A5F "),k(),y(3,AM,2,0,"button",60),k()}if(i&2){let t=m().$implicit;c(3),S(t.isOptional?3:-1)}}function TM(i,e){if(i&1&&(T(0,"div",51)(1,"div",55),y(2,yM,1,0)(3,SM,1,1)(4,wM,1,0)(5,EM,1,1),k(),T(6,"div",56)(7,"div",20)(8,"span",11),l(9),k(),T(10,"h4",57),l(11),k(),y(12,DM,2,0,"span",58),k(),T(13,"p",14),l(14),k(),y(15,MM,4,1,"div",59),k()()),i&2){let t,n=e.$implicit,o=e.$index,a=m(2);c(),N("bg-green-500",n.status==="completed")("text-white",n.status==="completed")("bg-cyan-500",n.status==="active")("text-white",n.status==="active")("animate-pulse",n.status==="active")("bg-slate-600",n.status==="pending")("text-slate-400",n.status==="pending")("bg-slate-700",n.status==="skipped")("text-slate-500",n.status==="skipped")("bg-red-500",n.status==="error")("text-white",n.status==="error"),c(),S((t=n.status)==="completed"?2:t==="active"?3:t==="error"?4:5),c(4),N("border-l-2",o<a.activeWorkflow().steps.length-1)("border-green-500",n.status==="completed")("border-cyan-500",n.status==="active")("border-slate-600",n.status==="pending"||n.status==="skipped")("ml-5",o<a.activeWorkflow().steps.length-1)("pl-8",o<a.activeWorkflow().steps.length-1),c(3),D(n.icon),c(),N("text-white",n.status==="active")("text-green-400",n.status==="completed")("text-slate-400",n.status==="pending")("text-slate-500",n.status==="skipped"),c(),M(" ",n.title," "),c(),S(n.isOptional?12:-1),c(2),D(n.description),c(),S(n.status==="active"?15:-1)}}function kM(i,e){if(i&1){let t=I();T(0,"button",62),se("click",function(){_(t);let o=m(2);return v(o.finishWorkflow())}),l(1," \u{1F389} \u5B8C\u6210\u5DE5\u4F5C\u6D41 "),k()}}function IM(i,e){if(i&1){let t=I();T(0,"div",36),se("click",function(){_(t);let o=m();return v(o.closeWorkflow())}),T(1,"div",37),se("click",function(o){return _(t),v(o.stopPropagation())}),T(2,"div",38)(3,"div",39)(4,"div",40)(5,"span",41),l(6),k(),T(7,"div")(8,"h2",42),l(9),k(),T(10,"p",43),l(11),k()()(),T(12,"button",44),se("click",function(){_(t);let o=m();return v(o.closeWorkflow())}),ne(),T(13,"svg",45),Se(14,"path",46),k()()(),ce(),T(15,"div",47),Se(16,"div",48),k(),T(17,"div",49),l(18),k()(),T(19,"div",50)(20,"div",5),O(21,TM,16,48,"div",51,hc),k()(),T(23,"div",52)(24,"button",53),se("click",function(){_(t);let o=m();return v(o.closeWorkflow())}),l(25," \u7A0D\u5F8C\u7E7C\u7E8C "),k(),y(26,kM,2,0,"button",54),k()()()}if(i&2){let t=m();c(6),D(t.activeWorkflow().icon),c(3),D(t.activeWorkflow().title),c(2),D(t.activeWorkflow().description),c(5),ee("width",t.workflowProgress(),"%"),c(2),X(" ",t.completedStepsCount(),"/",t.activeWorkflow().steps.length," \u6B65\u9A5F\u5B8C\u6210 "),c(3),U(t.activeWorkflow().steps),c(5),S(t.isWorkflowComplete()?26:-1)}}var fc=class i{constructor(){this.navigateTo=ge();this.workflowCompleted=ge();this.mode=f("actions");this.activeCategory=f("all");this.activeWorkflow=f(null);this.categories=[{id:"all",icon:"\u{1F4CB}",label:"\u5168\u90E8"},{id:"account",icon:"\u{1F464}",label:"\u5E33\u865F"},{id:"resource",icon:"\u{1F50D}",label:"\u8CC7\u6E90"},{id:"automation",icon:"\u26A1",label:"\u81EA\u52D5\u5316"},{id:"message",icon:"\u{1F4AC}",label:"\u6D88\u606F"},{id:"analysis",icon:"\u{1F4CA}",label:"\u5206\u6790"}];this.workflows=f([{id:"quick-start",title:"\u5FEB\u901F\u958B\u59CB\u76E3\u63A7",description:"\u5F9E\u6DFB\u52A0\u5E33\u865F\u5230\u958B\u59CB\u76E3\u63A7\u7684\u5B8C\u6574\u6D41\u7A0B",icon:"\u{1F680}",category:"automation",estimatedTime:"10\u5206\u9418",difficulty:"easy",steps:[{id:"s1",title:"\u6DFB\u52A0\u76E3\u63A7\u5E33\u865F",description:"\u6DFB\u52A0\u4E26\u767B\u9304\u4E00\u500B Telegram \u5E33\u865F",icon:"\u{1F464}",status:"pending",isOptional:!1,actionView:"add-account"},{id:"s2",title:"\u767C\u73FE\u76EE\u6A19\u7FA4\u7D44",description:"\u641C\u7D22\u4E26\u6DFB\u52A0\u8981\u76E3\u63A7\u7684\u7FA4\u7D44",icon:"\u{1F50D}",status:"pending",isOptional:!1,actionView:"resources"},{id:"s3",title:"\u8A2D\u7F6E\u95DC\u9375\u8A5E",description:"\u914D\u7F6E\u89F8\u767C\u6D88\u606F\u7684\u95DC\u9375\u8A5E",icon:"\u{1F511}",status:"pending",isOptional:!1,actionView:"automation"},{id:"s4",title:"\u958B\u59CB\u76E3\u63A7",description:"\u555F\u52D5\u76E3\u63A7\u7CFB\u7D71",icon:"\u25B6\uFE0F",status:"pending",isOptional:!1,actionHandler:"start-monitoring"}]},{id:"full-automation",title:"\u5B8C\u6574\u81EA\u52D5\u5316\u71DF\u92B7",description:"\u8A2D\u7F6E\u5F9E\u76E3\u63A7\u5230\u81EA\u52D5\u8DDF\u9032\u7684\u5168\u6D41\u7A0B",icon:"\u{1F3AF}",category:"automation",estimatedTime:"20\u5206\u9418",difficulty:"medium",steps:[{id:"s1",title:"\u914D\u7F6E\u5E33\u865F\u89D2\u8272",description:"\u8A2D\u7F6E\u76E3\u63A7\u865F\u548C\u767C\u9001\u865F",icon:"\u{1F465}",status:"pending",isOptional:!1,actionView:"accounts"},{id:"s2",title:"\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44",description:"\u6DFB\u52A0\u76EE\u6A19\u7FA4\u7D44",icon:"\u{1F4AC}",status:"pending",isOptional:!1,actionView:"resources"},{id:"s3",title:"\u8A2D\u7F6E\u95DC\u9375\u8A5E",description:"\u914D\u7F6E\u89F8\u767C\u95DC\u9375\u8A5E",icon:"\u{1F511}",status:"pending",isOptional:!1,actionView:"automation"},{id:"s4",title:"\u5275\u5EFA\u6D3B\u52D5",description:"\u8A2D\u7F6E\u81EA\u52D5\u56DE\u8986\u6D3B\u52D5",icon:"\u26A1",status:"pending",isOptional:!1,actionView:"automation"},{id:"s5",title:"\u914D\u7F6E AI \u56DE\u8986",description:"\u8A2D\u7F6E AI \u81EA\u52D5\u554F\u5019",icon:"\u{1F916}",status:"pending",isOptional:!0,actionView:"ai-center"},{id:"s6",title:"\u958B\u59CB\u76E3\u63A7",description:"\u555F\u52D5\u81EA\u52D5\u5316\u7CFB\u7D71",icon:"\u25B6\uFE0F",status:"pending",isOptional:!1,actionHandler:"start-monitoring"}]},{id:"multi-role",title:"\u591A\u89D2\u8272\u5354\u4F5C\u8A2D\u7F6E",description:"\u914D\u7F6E\u591A\u5E33\u865F\u5287\u672C\u5F0F\u5354\u4F5C",icon:"\u{1F3AD}",category:"conversion",estimatedTime:"30\u5206\u9418",difficulty:"advanced",steps:[{id:"s1",title:"\u6E96\u5099\u591A\u500B\u5E33\u865F",description:"\u6DFB\u52A0\u81F3\u5C113\u500B\u5E33\u865F",icon:"\u{1F465}",status:"pending",isOptional:!1,actionView:"accounts"},{id:"s2",title:"\u5206\u914D\u89D2\u8272",description:"\u70BA\u5E33\u865F\u5206\u914D\u92B7\u552E\u3001\u5C08\u5BB6\u7B49\u89D2\u8272",icon:"\u{1F3AD}",status:"pending",isOptional:!1,actionView:"multi-role"},{id:"s3",title:"\u9078\u64C7\u5287\u672C",description:"\u9078\u64C7\u6216\u5275\u5EFA\u5354\u4F5C\u5287\u672C",icon:"\u{1F4DC}",status:"pending",isOptional:!1,actionView:"multi-role"},{id:"s4",title:"\u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44",description:"\u8A2D\u7F6E\u5354\u4F5C\u76EE\u6A19\u7FA4\u7D44",icon:"\u{1F4AC}",status:"pending",isOptional:!1,actionView:"multi-role"},{id:"s5",title:"\u57F7\u884C\u5287\u672C",description:"\u555F\u52D5\u591A\u89D2\u8272\u5354\u4F5C",icon:"\u{1F3AC}",status:"pending",isOptional:!1,actionHandler:"run-script"}]}]);this.quickActions=f([{id:"add-account",title:"\u6DFB\u52A0\u5E33\u865F",description:"\u6DFB\u52A0 Telegram \u5E33\u865F",icon:"\u2795",category:"account",actionView:"add-account",isRecommended:!0},{id:"scan-session",title:"\u6062\u5FA9\u5E33\u865F",description:"\u6383\u63CF\u4E26\u6062\u5FA9 Session",icon:"\u{1F504}",category:"account",actionView:"accounts",actionHandler:"scan-sessions"},{id:"discover-groups",title:"\u767C\u73FE\u7FA4\u7D44",description:"\u641C\u7D22\u65B0\u7FA4\u7D44\u8CC7\u6E90",icon:"\u{1F50D}",category:"resource",actionView:"resources"},{id:"add-group",title:"\u6DFB\u52A0\u7FA4\u7D44",description:"\u624B\u52D5\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44",icon:"\u{1F4AC}",category:"resource",actionView:"automation"},{id:"add-keyword",title:"\u6DFB\u52A0\u95DC\u9375\u8A5E",description:"\u8A2D\u7F6E\u89F8\u767C\u95DC\u9375\u8A5E",icon:"\u{1F511}",category:"automation",actionView:"automation"},{id:"create-campaign",title:"\u5275\u5EFA\u6D3B\u52D5",description:"\u65B0\u5EFA\u81EA\u52D5\u5316\u6D3B\u52D5",icon:"\u26A1",category:"automation",actionView:"automation",actionHandler:"new-campaign"},{id:"send-batch",title:"\u6279\u91CF\u767C\u9001",description:"\u767C\u9001\u6279\u91CF\u6D88\u606F",icon:"\u{1F4E4}",category:"message",actionView:"ads"},{id:"view-leads",title:"\u67E5\u770B\u7DDA\u7D22",description:"\u7BA1\u7406\u6F5B\u5728\u5BA2\u6236",icon:"\u{1F465}",category:"message",actionView:"leads"},{id:"view-stats",title:"\u6578\u64DA\u5206\u6790",description:"\u67E5\u770B\u7D71\u8A08\u5831\u8868",icon:"\u{1F4CA}",category:"analysis",actionView:"nurturing-analytics"},{id:"export-data",title:"\u5C0E\u51FA\u6578\u64DA",description:"\u5C0E\u51FA\u5BA2\u6236\u6578\u64DA",icon:"\u{1F4E5}",category:"analysis",actionView:"leads",actionHandler:"export-leads"},{id:"start-monitoring",title:"\u958B\u59CB\u76E3\u63A7",description:"\u555F\u52D5\u81EA\u52D5\u76E3\u63A7",icon:"\u25B6\uFE0F",category:"automation",actionView:"automation",actionHandler:"start-monitoring",isRecommended:!0},{id:"ai-settings",title:"AI \u8A2D\u7F6E",description:"\u914D\u7F6E AI \u56DE\u8986",icon:"\u{1F916}",category:"automation",actionView:"ai-center"}]);this.recommendedWorkflow=R(()=>this.workflows().find(e=>e.id==="quick-start"));this.filteredActions=R(()=>{let e=this.activeCategory();return e==="all"?this.quickActions():this.quickActions().filter(t=>t.category===e)});this.workflowProgress=R(()=>{let e=this.activeWorkflow();return e?e.steps.filter(n=>n.status==="completed"||n.status==="skipped").length/e.steps.length*100:0});this.completedStepsCount=R(()=>{let e=this.activeWorkflow();return e?e.steps.filter(t=>t.status==="completed"||t.status==="skipped").length:0});this.isWorkflowComplete=R(()=>{let e=this.activeWorkflow();return e?e.steps.every(t=>t.status==="completed"||t.status==="skipped"):!1})}ngOnInit(){}getDifficultyLabel(e){return{easy:"\u7C21\u55AE",medium:"\u4E2D\u7B49",advanced:"\u9032\u968E"}[e]||e}startWorkflow(e){let t=P(E({},e),{steps:e.steps.map((n,o)=>P(E({},n),{status:o===0?"active":"pending"}))});this.activeWorkflow.set(t)}closeWorkflow(){this.activeWorkflow.set(null)}executeStep(e){e.actionView&&this.navigateTo.emit({view:e.actionView,handler:e.actionHandler}),this.activeWorkflow.update(t=>{if(!t)return null;let n=t.steps.findIndex(o=>o.id===e.id);return P(E({},t),{steps:t.steps.map((o,a)=>a===n?P(E({},o),{status:"completed"}):a===n+1?P(E({},o),{status:"active"}):o)})})}skipStep(e){this.activeWorkflow.update(t=>{if(!t)return null;let n=t.steps.findIndex(o=>o.id===e.id);return P(E({},t),{steps:t.steps.map((o,a)=>a===n?P(E({},o),{status:"skipped"}):a===n+1?P(E({},o),{status:"active"}):o)})})}finishWorkflow(){let e=this.activeWorkflow();e&&this.workflowCompleted.emit(e),this.closeWorkflow()}executeAction(e){this.navigateTo.emit({view:e.actionView,handler:e.actionHandler})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-quick-workflow"]],outputs:{navigateTo:"navigateTo",workflowCompleted:"workflowCompleted"},decls:15,vars:35,consts:[[1,"quick-workflow"],[1,"flex","items-center","gap-3","mb-6"],[1,"flex-1","py-3","rounded-xl","border","transition-all","text-center",3,"click"],[1,"text-xl","block","mb-1"],[1,"text-sm","font-medium"],[1,"space-y-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"p-4","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10","border","border-cyan-500/30","rounded-xl"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"group","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-cyan-500/30","rounded-xl","cursor-pointer","transition-all"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-lg"],[1,"text-sm","font-semibold","text-cyan-400"],[1,"text-white","font-semibold","mb-1"],[1,"text-sm","text-slate-400","mb-3"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","text-sm","font-medium","rounded-lg","transition-all",3,"click"],[1,"group","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-cyan-500/30","rounded-xl","cursor-pointer","transition-all",3,"click"],[1,"flex","items-start","gap-3"],[1,"text-2xl"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-1"],[1,"font-medium","text-white","group-hover:text-cyan-400","transition-colors"],[1,"text-xs","px-1.5","py-0.5","rounded"],[1,"text-xs","text-slate-400","mb-2"],[1,"flex","items-center","gap-3","text-xs","text-slate-500"],[1,"flex","gap-2","overflow-x-auto","pb-2"],[1,"px-3","py-1.5","rounded-lg","text-sm","whitespace-nowrap","transition-all",3,"bg-purple-500","text-white","bg-slate-700/50","text-slate-400","hover:bg-slate-600/50"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-3"],[1,"group","relative","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-purple-500/30","rounded-xl","cursor-pointer","transition-all","text-center"],[1,"px-3","py-1.5","rounded-lg","text-sm","whitespace-nowrap","transition-all",3,"click"],[1,"group","relative","p-4","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-600/50","hover:border-purple-500/30","rounded-xl","cursor-pointer","transition-all","text-center",3,"click"],[1,"absolute","-top-2","-right-2","px-1.5","py-0.5","bg-gradient-to-r","from-yellow-500","to-orange-500","text-white","text-xs","font-semibold","rounded-full"],[1,"absolute","-top-2","-left-2","px-1.5","py-0.5","bg-red-500","text-white","text-xs","font-bold","rounded-full"],[1,"text-3xl","mb-2"],[1,"text-sm","font-medium","text-white","group-hover:text-purple-400","transition-colors","mb-1"],[1,"text-xs","text-slate-500"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-2xl","mx-4","overflow-hidden",3,"click"],[1,"p-6","bg-gradient-to-r","from-cyan-500/20","to-blue-500/20","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","text-slate-400","hover:text-white","hover:bg-slate-700/50","rounded-lg","transition-all",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],["d","M6 18L18 6M6 6l12 12"],[1,"mt-4","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all","duration-500"],[1,"mt-2","text-xs","text-slate-400","text-right"],[1,"p-6","max-h-[400px]","overflow-y-auto"],[1,"flex","items-start","gap-4"],[1,"p-4","border-t","border-slate-700/50","flex","justify-between"],[1,"px-4","py-2","text-slate-400","hover:text-white","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-400","hover:to-emerald-400","text-white","font-medium","rounded-lg","transition-all"],[1,"flex-shrink-0","w-10","h-10","rounded-full","flex","items-center","justify-center","font-bold","text-sm","transition-all"],[1,"flex-1","pb-4"],[1,"font-medium"],[1,"text-xs","px-1.5","py-0.5","bg-slate-700","text-slate-400","rounded"],[1,"flex","gap-2"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","text-sm","rounded-lg","transition-all"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","text-sm","rounded-lg","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-400","hover:to-emerald-400","text-white","font-medium","rounded-lg","transition-all",3,"click"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"button",2),se("click",function(){return n.mode.set("workflows")}),T(3,"span",3),l(4,"\u{1F3AF}"),k(),T(5,"span",4),l(6,"\u5F15\u5C0E\u5F0F\u5DE5\u4F5C\u6D41"),k()(),T(7,"button",2),se("click",function(){return n.mode.set("actions")}),T(8,"span",3),l(9,"\u26A1"),k(),T(10,"span",4),l(11,"\u5FEB\u901F\u64CD\u4F5C"),k()()(),y(12,fM,5,1,"div",5),y(13,bM,7,0,"div",5),y(14,IM,27,8,"div",6),k()),t&2&&(c(2),N("bg-gradient-to-r",n.mode()==="workflows")("from-cyan-500/20",n.mode()==="workflows")("to-blue-500/20",n.mode()==="workflows")("border-cyan-500/50",n.mode()==="workflows")("text-white",n.mode()==="workflows")("bg-slate-800/50",n.mode()!=="workflows")("border-slate-600/50",n.mode()!=="workflows")("text-slate-400",n.mode()!=="workflows"),c(5),N("bg-gradient-to-r",n.mode()==="actions")("from-purple-500/20",n.mode()==="actions")("to-pink-500/20",n.mode()==="actions")("border-purple-500/50",n.mode()==="actions")("text-white",n.mode()==="actions")("bg-slate-800/50",n.mode()!=="actions")("border-slate-600/50",n.mode()!=="actions")("text-slate-400",n.mode()!=="actions"),c(5),S(n.mode()==="workflows"?12:-1),c(),S(n.mode()==="actions"?13:-1),c(),S(n.activeWorkflow()?14:-1))},dependencies:[oe],encapsulation:2})}};var _n=class i{constructor(){this.ipc=F(Q);this._sessions=f([]);this._userProfiles=f(new Map);this._roleComboStats=f(new Map);this.sessions=this._sessions.asReadonly();this.userProfiles=R(()=>Array.from(this._userProfiles().values()));this.roleComboStats=R(()=>Array.from(this._roleComboStats().values()));this.totalStats=R(()=>{let e=this._sessions(),t=e.filter(n=>n.outcome==="converted").length;return{totalSessions:e.length,conversions:t,conversionRate:e.length>0?t/e.length*100:0,avgInterestScore:this.calcAverage(e.map(n=>n.interestScore)),avgEngagementScore:this.calcAverage(e.map(n=>n.engagementScore)),totalRevenue:e.reduce((n,o)=>n+(o.conversionValue||0),0)}});this.todayStats=R(()=>{let e=new Date().toISOString().split("T")[0],t=this._sessions().filter(o=>o.startTime.toISOString().split("T")[0]===e),n=t.filter(o=>o.outcome==="converted").length;return{sessions:t.length,conversions:n,conversionRate:t.length>0?n/t.length*100:0,revenue:t.reduce((o,a)=>o+(a.conversionValue||0),0)}});this.topRoleCombos=R(()=>Array.from(this._roleComboStats().values()).filter(t=>t.totalSessions>=3).sort((t,n)=>n.conversionRate-t.conversionRate).slice(0,5));this.STORAGE_KEY="marketingAnalytics";this.loadFromStorage(),this.initializeListeners()}initializeListeners(){this.ipc.on("collaboration:session-ended",e=>{this.recordSession(e)}),this.ipc.on("collaboration:user-message",e=>{this.updateUserProfile(e.userId,e.message)})}recordSession(e){let t=this.createRoleCombo(e.roles),n=e.messages.filter(d=>d.isUser),o=e.messages.filter(d=>!d.isUser),a={id:e.sessionId,startTime:e.messages[0]?.timestamp||new Date,endTime:e.messages[e.messages.length-1]?.timestamp,targetUserId:e.targetUserId,targetUserName:e.targetUserName,roleCombo:t,totalMessages:e.messages.length,userMessages:n.length,roleMessages:o.length,avgResponseTime:this.calcAvgResponseTime(e.messages),stagesReached:e.stagesReached,finalStage:e.finalStage,outcome:e.outcome,conversionValue:e.conversionValue,interestScore:e.interestScore,engagementScore:this.calcEngagementScore(e.messages),tags:this.extractSessionTags(e)};return this._sessions.update(d=>[...d,a]),this.updateRoleComboStats(t,a),this.saveToStorage(),console.log(`[Analytics] \u8A18\u9304\u6703\u8A71: ${a.id}, \u7D50\u679C: ${a.outcome}`),a}createRoleCombo(e){let t=[...e].sort((a,d)=>a.roleId.localeCompare(d.roleId)),n=t.map(a=>a.roleType).join("_"),o=t.map(a=>a.roleName).join(" + ");return{id:`combo_${n}`,name:o,roles:t,hash:n}}updateRoleComboStats(e,t){let o=this._roleComboStats().get(e.id),a=t.outcome==="converted";if(o){let d=o.totalSessions+1,u=o.conversions+(a?1:0),p=P(E({},o),{totalSessions:d,conversions:u,conversionRate:u/d*100,avgInterestScore:(o.avgInterestScore*o.totalSessions+t.interestScore)/d,avgEngagementScore:(o.avgEngagementScore*o.totalSessions+t.engagementScore)/d,avgMessageCount:(o.avgMessageCount*o.totalSessions+t.totalMessages)/d,lastUsed:new Date});p.trend=t.interestScore>o.avgInterestScore?"up":t.interestScore<o.avgInterestScore?"down":"stable",this._roleComboStats.update(g=>{let C=new Map(g);return C.set(e.id,p),C})}else{let d={comboId:e.id,comboName:e.name,roles:e.roles.map(u=>u.roleName),totalSessions:1,conversions:a?1:0,conversionRate:a?100:0,avgInterestScore:t.interestScore,avgEngagementScore:t.engagementScore,avgSessionDuration:0,avgMessageCount:t.totalMessages,stageReachRates:{},trend:"stable",lastUsed:new Date};this._roleComboStats.update(u=>{let p=new Map(u);return p.set(e.id,d),p})}}updateUserProfile(e,t){let n=this._userProfiles().get(e),o=t.length,a=o<20?"short":o>100?"long":"medium",d=this.extractInterests(t),u=this.extractPainPoints(t),p=this.extractObjections(t);if(n){let g=P(E({},n),{totalMessages:n.totalMessages+1,interests:[...new Set([...n.interests,...d])].slice(0,10),painPoints:[...new Set([...n.painPoints,...u])].slice(0,5),objections:[...new Set([...n.objections,...p])].slice(0,5),lastContactTime:new Date,updatedAt:new Date});g.messageLength=a,this._userProfiles.update(C=>{let w=new Map(C);return w.set(e,g),w})}else{let g={userId:e,responseSpeed:"normal",messageLength:a,activeHours:[new Date().getHours()],interests:d,painPoints:u,objections:p,intentLevel:"unknown",pricesSensitivity:"medium",totalSessions:1,totalMessages:1,lastContactTime:new Date,tags:[],updatedAt:new Date};this._userProfiles.update(C=>{let w=new Map(C);return w.set(e,g),w})}this.saveToStorage()}extractInterests(e){let t=[],n=e.toLowerCase();return Object.entries({\u652F\u4ED8:"\u652F\u4ED8\u89E3\u6C7A\u65B9\u6848",\u6536\u6B3E:"\u6536\u6B3E\u670D\u52D9",\u8DE8\u5883:"\u8DE8\u5883\u696D\u52D9",\u8CBB\u7387:"\u50F9\u683C\u654F\u611F",\u5B89\u5168:"\u5B89\u5168\u9700\u6C42",\u901F\u5EA6:"\u6548\u7387\u9700\u6C42",\u7A69\u5B9A:"\u7A69\u5B9A\u6027\u9700\u6C42"}).forEach(([a,d])=>{n.includes(a)&&t.push(d)}),t}extractPainPoints(e){let t=[],n=e.toLowerCase();return(n.includes("\u8CB4")||n.includes("\u8CBB\u7387\u9AD8"))&&t.push("\u8CBB\u7387\u554F\u984C"),(n.includes("\u6162")||n.includes("\u7B49\u5F85"))&&t.push("\u6548\u7387\u554F\u984C"),(n.includes("\u64D4\u5FC3")||n.includes("\u98A8\u96AA"))&&t.push("\u5B89\u5168\u9867\u616E"),(n.includes("\u8907\u96DC")||n.includes("\u9EBB\u7169"))&&t.push("\u64CD\u4F5C\u8907\u96DC"),t}extractObjections(e){let t=[],n=e.toLowerCase();return(n.includes("\u4E0D\u9700\u8981")||n.includes("\u4E0D\u7528"))&&t.push("\u7121\u9700\u6C42"),(n.includes("\u518D\u8003\u616E")||n.includes("\u518D\u8AAA"))&&t.push("\u9700\u8981\u8003\u616E"),(n.includes("\u592A\u8CB4")||n.includes("\u4FBF\u5B9C"))&&t.push("\u50F9\u683C\u7570\u8B70"),(n.includes("\u4E0D\u4FE1")||n.includes("\u9A19"))&&t.push("\u4FE1\u4EFB\u554F\u984C"),t}getUserProfile(e){return this._userProfiles().get(e)}generateDailyReport(e){let t=e||new Date().toISOString().split("T")[0],n=this._sessions().filter(C=>C.startTime.toISOString().split("T")[0]===t),o=n.filter(C=>C.outcome==="converted"),a=new Set(n.map(C=>C.targetUserId)),d=new Map;n.forEach(C=>{C.roleCombo.roles.forEach(w=>{let A=d.get(w.accountPhone)||{sessions:0,messages:0};A.sessions++,A.messages+=C.roleMessages/C.roleCombo.roles.length,d.set(w.accountPhone,A)})});let u=new Map;n.forEach(C=>{let w=u.get(C.roleCombo.id)||{name:C.roleCombo.name,conversions:0,total:0};w.total++,C.outcome==="converted"&&w.conversions++,u.set(C.roleCombo.id,w)});let g=["opening","building_trust","discovering_needs","presenting_value","handling_objections","closing","follow_up"].map(C=>({stage:C,count:n.filter(w=>w.stagesReached.includes(C)).length}));return{date:t,totalSessions:n.length,newUsers:a.size,activeUsers:a.size,conversions:o.length,conversionRate:n.length>0?o.length/n.length*100:0,totalRevenue:n.reduce((C,w)=>C+(w.conversionValue||0),0),totalMessages:n.reduce((C,w)=>C+w.totalMessages,0),avgResponseTime:this.calcAverage(n.map(C=>C.avgResponseTime)),accountUsage:Array.from(d.entries()).map(([C,w])=>E({phone:C},w)),topRoleCombos:Array.from(u.values()).sort((C,w)=>w.conversions-C.conversions).slice(0,5).map(C=>({comboName:C.name,conversions:C.conversions,rate:C.total>0?C.conversions/C.total*100:0})),funnel:g.map((C,w)=>({stage:C.stage,count:C.count,rate:n.length>0?C.count/n.length*100:0}))}}generatePeriodComparison(e=7){let t=new Date,n=new Date(t.getTime()-e*24*60*60*1e3),o=new Date(n.getTime()-e*24*60*60*1e3),a=this._sessions().filter(g=>g.startTime>=n&&g.startTime<t),d=this._sessions().filter(g=>g.startTime>=o&&g.startTime<n),u={sessions:a.length,conversions:a.filter(g=>g.outcome==="converted").length,revenue:a.reduce((g,C)=>g+(C.conversionValue||0),0)},p={sessions:d.length,conversions:d.filter(g=>g.outcome==="converted").length,revenue:d.reduce((g,C)=>g+(C.conversionValue||0),0)};return{current:u,previous:p,changes:{sessions:p.sessions>0?(u.sessions-p.sessions)/p.sessions*100:0,conversions:p.conversions>0?(u.conversions-p.conversions)/p.conversions*100:0,revenue:p.revenue>0?(u.revenue-p.revenue)/p.revenue*100:0}}}recommendRoleCombo(e){let t=Array.from(this._roleComboStats().values());return t.length===0?null:t.filter(o=>o.totalSessions>=2).sort((o,a)=>a.conversionRate-o.conversionRate)[0]||null}calcAverage(e){return e.length===0?0:e.reduce((t,n)=>t+n,0)/e.length}calcAvgResponseTime(e){let t=0,n=0;for(let o=1;o<e.length;o++)e[o].isUser&&!e[o-1].isUser&&(t+=new Date(e[o].timestamp).getTime()-new Date(e[o-1].timestamp).getTime(),n++);return n>0?t/n:0}calcEngagementScore(e){let t=e.filter(d=>d.isUser);if(t.length===0)return 0;let n=0;n+=Math.min(t.length*10,40);let o=t.reduce((d,u)=>d+u.content.length,0)/t.length;n+=Math.min(o/5,30);let a=t.filter(d=>d.content.includes("?")||d.content.includes("\uFF1F")).length;return n+=Math.min(a*10,30),Math.min(n,100)}extractSessionTags(e){let t=[];return e.outcome==="converted"&&t.push("\u6210\u4EA4"),e.interestScore>=80&&t.push("\u9AD8\u610F\u5411"),e.stagesReached.includes("closing")&&t.push("\u5230\u9054\u6210\u4EA4\u968E\u6BB5"),t}saveToStorage(){let e={sessions:this._sessions(),userProfiles:Array.from(this._userProfiles().entries()),roleComboStats:Array.from(this._roleComboStats().entries()),savedAt:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}loadFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return;let t=JSON.parse(e);if(t.sessions){let n=t.sessions.map(o=>P(E({},o),{startTime:new Date(o.startTime),endTime:o.endTime?new Date(o.endTime):void 0}));this._sessions.set(n)}if(t.userProfiles){let n=new Map(t.userProfiles.map(o=>[o[0],P(E({},o[1]),{updatedAt:new Date(o[1].updatedAt),lastContactTime:o[1].lastContactTime?new Date(o[1].lastContactTime):void 0})]));this._userProfiles.set(n)}if(t.roleComboStats){let n=new Map(t.roleComboStats.map(o=>[o[0],P(E({},o[1]),{lastUsed:new Date(o[1].lastUsed)})]));this._roleComboStats.set(n)}console.log("[Analytics] \u5DF2\u5F9E\u5B58\u5132\u6062\u5FA9\u6578\u64DA")}catch(e){console.error("[Analytics] \u6062\u5FA9\u6578\u64DA\u5931\u6557:",e)}}clearAllData(){this._sessions.set([]),this._userProfiles.set(new Map),this._roleComboStats.set(new Map),localStorage.removeItem(this.STORAGE_KEY),console.log("[Analytics] \u5DF2\u6E05\u9664\u6240\u6709\u6578\u64DA")}exportData(){return JSON.stringify({sessions:this._sessions(),userProfiles:Array.from(this._userProfiles().entries()),roleComboStats:Array.from(this._roleComboStats().entries()),exportedAt:new Date().toISOString()},null,2)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var er=class i{constructor(){this.analytics=F(_n);this._timeSlotStats=f(new Map);this._userPatterns=f(new Map);this._scheduledTasks=f([]);this.timeSlotStats=R(()=>Array.from(this._timeSlotStats().values()));this.scheduledTasks=this._scheduledTasks.asReadonly();this.topTimeSlots=R(()=>this.timeSlotStats().sort((e,t)=>t.score-e.score).slice(0,10));this.currentSlotScore=R(()=>{let e=new Date,t=this.getSlotKey(e.getHours(),e.getDay());return this._timeSlotStats().get(t)?.score??50});this.STORAGE_KEY="smartTiming";this.schedulerInterval=null;this.loadFromStorage(),this.startScheduler()}recordUserActivity(e,t=new Date){let n=t.getHours(),o=t.getDay(),a=this._userPatterns().get(e);if(a){let d=[...new Set([...a.activeHours,n])].slice(-24),u=[...new Set([...a.preferredDays,o])].slice(-7);this._userPatterns.update(p=>{let g=new Map(p);return g.set(e,P(E({},a),{activeHours:d,preferredDays:u,lastActiveTime:t,reliability:Math.min(a.reliability+.1,1)})),g})}else this._userPatterns.update(d=>{let u=new Map(d);return u.set(e,{userId:e,activeHours:[n],preferredDays:[o],avgResponseDelay:30,lastActiveTime:t,reliability:.3}),u});this.saveToStorage()}recordSessionResult(e){let t=e.timestamp.getHours(),n=e.timestamp.getDay(),o=this.getSlotKey(t,n),a=this._timeSlotStats().get(o);if(a){let d=a.totalSessions+1,u=e.responded?1:0,p=e.converted?1:0,g=P(E({},a),{totalSessions:d,responseRate:(a.responseRate*a.totalSessions+u)/d,conversionRate:(a.conversionRate*a.totalSessions+p)/d,avgResponseTime:e.responseTime?(a.avgResponseTime*a.totalSessions+e.responseTime)/d:a.avgResponseTime,score:0});g.score=this.calculateSlotScore(g),this._timeSlotStats.update(C=>{let w=new Map(C);return w.set(o,g),w})}else{let d={hour:t,dayOfWeek:n,totalSessions:1,responseRate:e.responded?1:0,avgResponseTime:e.responseTime??30,conversionRate:e.converted?1:0,score:0};d.score=this.calculateSlotScore(d),this._timeSlotStats.update(u=>{let p=new Map(u);return p.set(o,d),p})}this.saveToStorage()}calculateSlotScore(e){if(e.totalSessions<2)return 50;let t=0;t+=e.responseRate*40,t+=e.conversionRate*40;let n=Math.max(0,1-e.avgResponseTime/120);return t+=n*20,e.hour>=9&&e.hour<=21&&(t*=1.1),(e.dayOfWeek===0||e.dayOfWeek===6)&&(t*=.9),Math.min(100,Math.round(t))}getBestTimeToSend(e){let t=[],n=new Date;if(e){let a=this._userPatterns().get(e);if(a&&a.reliability>.5)for(let d of a.activeHours)t.push({hour:d,dayOfWeek:n.getDay(),score:85+Math.random()*10,reason:"\u57FA\u65BC\u8A72\u7528\u6236\u7684\u6B77\u53F2\u6D3B\u8E8D\u6642\u6BB5",predictedResponseRate:.7+Math.random()*.2})}let o=this.topTimeSlots();for(let a of o.slice(0,5))t.findIndex(u=>u.hour===a.hour)===-1&&t.push({hour:a.hour,dayOfWeek:a.dayOfWeek,score:a.score,reason:`\u6B77\u53F2\u6578\u64DA\u986F\u793A\u8A72\u6642\u6BB5\u56DE\u8986\u7387 ${(a.responseRate*100).toFixed(0)}%`,predictedResponseRate:a.responseRate});if(t.length<3){let a=[10,14,19,20];for(let d of a)t.some(u=>u.hour===d)||t.push({hour:d,dayOfWeek:n.getDay(),score:60,reason:"\u57FA\u65BC\u4E00\u822C\u7528\u6236\u7FD2\u6163\u7684\u63A8\u85A6\u6642\u6BB5",predictedResponseRate:.5})}return t.sort((a,d)=>d.score-a.score).slice(0,5)}getNextBestTime(e){let t=this.getBestTimeToSend(e),n=new Date,o=n.getHours();for(let u of t)if(u.hour>o){let p=new Date(n);return p.setHours(u.hour,0,0,0),p}let a=t[0]?.hour??10,d=new Date(n);return d.setDate(d.getDate()+1),d.setHours(a,0,0,0),d}isGoodTimeNow(){let e=this.currentSlotScore();if(e>=75)return{isGood:!0,score:e,suggestion:"\u2705 \u7576\u524D\u662F\u7D55\u4F73\u6642\u6A5F\uFF0C\u5EFA\u8B70\u7ACB\u5373\u767C\u9001"};if(e>=50)return{isGood:!0,score:e,suggestion:"\u{1F44C} \u7576\u524D\u6642\u6A5F\u5C1A\u53EF\uFF0C\u53EF\u4EE5\u767C\u9001"};{let t=this.getNextBestTime(),n=Math.round((t.getTime()-Date.now())/(1e3*60*60));return{isGood:!1,score:e,suggestion:`\u23F0 \u5EFA\u8B70\u7B49\u5F85 ${n} \u5C0F\u6642\u5F8C\u767C\u9001\uFF0C\u6548\u679C\u66F4\u4F73`}}}scheduleTask(e){let t=P(E({},e),{id:`task_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,status:"pending",createdAt:new Date});return this._scheduledTasks.update(n=>[...n,t]),this.saveToStorage(),console.log(`[SmartTiming] \u5DF2\u5275\u5EFA\u8ABF\u5EA6\u4EFB\u52D9: ${t.id}, \u9810\u8A08\u57F7\u884C\u6642\u9593: ${t.scheduledTime}`),t}smartSchedule(e){let t=this.getNextBestTime(e.targetUserId);return this.scheduleTask(P(E({},e),{scheduledTime:t}))}cancelTask(e){this._scheduledTasks.update(t=>t.map(n=>n.id===e?P(E({},n),{status:"cancelled"}):n)),this.saveToStorage()}startScheduler(){this.schedulerInterval||(this.schedulerInterval=setInterval(()=>{this.checkAndExecuteTasks()},6e4),console.log("[SmartTiming] \u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5"))}checkAndExecuteTasks(){let e=new Date,t=this._scheduledTasks().filter(n=>n.status==="pending"&&new Date(n.scheduledTime)<=e);for(let n of t)this.executeTask(n)}executeTask(e){console.log(`[SmartTiming] \u57F7\u884C\u8ABF\u5EA6\u4EFB\u52D9: ${e.id}`),this._scheduledTasks.update(t=>t.map(n=>n.id===e.id?P(E({},n),{status:"executed"}):n)),window.dispatchEvent(new CustomEvent("scheduled-task-execute",{detail:e})),this.saveToStorage()}getHeatmapData(){let e=[];for(let t=0;t<7;t++)for(let n=0;n<24;n++){let o=this.getSlotKey(n,t),a=this._timeSlotStats().get(o);e.push({hour:n,day:t,score:a?.score??50})}return e}getTodaySlots(){let e=new Date().getDay(),t=[];for(let n=0;n<24;n++){let o=this.getSlotKey(n,e),a=this._timeSlotStats().get(o);t.push(a??{hour:n,dayOfWeek:e,totalSessions:0,responseRate:0,avgResponseTime:0,conversionRate:0,score:50})}return t}getSlotKey(e,t){return`${t}_${e}`}saveToStorage(){let e={timeSlotStats:Array.from(this._timeSlotStats().entries()),userPatterns:Array.from(this._userPatterns().entries()),scheduledTasks:this._scheduledTasks(),savedAt:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}loadFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return;let t=JSON.parse(e);if(t.timeSlotStats&&this._timeSlotStats.set(new Map(t.timeSlotStats)),t.userPatterns){let n=new Map;for(let[o,a]of t.userPatterns)n.set(o,P(E({},a),{lastActiveTime:a.lastActiveTime?new Date(a.lastActiveTime):void 0}));this._userPatterns.set(n)}t.scheduledTasks&&this._scheduledTasks.set(t.scheduledTasks.map(n=>P(E({},n),{scheduledTime:new Date(n.scheduledTime),createdAt:new Date(n.createdAt)}))),console.log("[SmartTiming] \u5DF2\u5F9E\u5B58\u5132\u6062\u5FA9\u6578\u64DA")}catch(e){console.error("[SmartTiming] \u6062\u5FA9\u6578\u64DA\u5931\u6557:",e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var r1=[{id:"rule_low_conversion",name:"\u4F4E\u8F49\u5316\u7387\u544A\u8B66",enabled:!0,type:"alert",condition:{metric:"conversion_rate",operator:"lt",value:10,timeWindow:60},action:{type:"send_alert",params:{level:"warning",message:"\u8FD11\u5C0F\u6642\u8F49\u5316\u7387\u4F4E\u65BC10%"}},priority:1,triggerCount:0},{id:"rule_no_response",name:"\u9023\u7E8C\u7121\u56DE\u8986\u5207\u63DB\u89D2\u8272",enabled:!0,type:"role_switch",condition:{metric:"no_response_count",operator:"gte",value:3},action:{type:"switch_role",params:{strategy:"next_best"}},priority:2,triggerCount:0},{id:"rule_slow_response",name:"\u7528\u6236\u56DE\u8986\u6162\u6642\u6E1B\u7DE9\u7BC0\u594F",enabled:!0,type:"rhythm_adjust",condition:{metric:"response_rate",operator:"lt",value:.3},action:{type:"adjust_delay",params:{multiplier:1.5}},priority:3,triggerCount:0},{id:"rule_high_interest",name:"\u9AD8\u8208\u8DA3\u5EA6\u52A0\u5FEB\u7BC0\u594F",enabled:!0,type:"rhythm_adjust",condition:{metric:"interest_score",operator:"gt",value:80},action:{type:"adjust_delay",params:{multiplier:.7}},priority:4,triggerCount:0}],_c=class i{constructor(){this.analytics=F(_n);this.timing=F(er);this.toast=F(J);this._rules=f(r1);this.rules=this._rules.asReadonly();this._rhythmConfig=f({baseDelay:5,varianceRatio:.3,minDelay:2,maxDelay:30,adaptiveMode:!0});this.rhythmConfig=this._rhythmConfig.asReadonly();this._alerts=f([]);this.alerts=this._alerts.asReadonly();this.unacknowledgedCount=R(()=>this._alerts().filter(e=>!e.acknowledged).length);this.sessionContext=f({noResponseCount:0,userResponseTimes:[],interestScores:[]});this.STORAGE_KEY="smartAutomation";this.lastRuleCheck=0;this.RULE_CHECK_COOLDOWN=6e4;this.ruleCheckTimeout=null;this.loadFromStorage(),setInterval(()=>{let e=this.analytics.totalStats();this.checkRulesWithCooldown(e)},this.RULE_CHECK_COOLDOWN)}checkRulesWithCooldown(e){let t=Date.now();t-this.lastRuleCheck<this.RULE_CHECK_COOLDOWN||(this.lastRuleCheck=t,this.checkRules(e))}addRule(e){let t=P(E({},e),{id:`rule_${Date.now()}`,triggerCount:0});this._rules.update(n=>[...n,t]),this.saveToStorage()}updateRule(e,t){this._rules.update(n=>n.map(o=>o.id===e?E(E({},o),t):o)),this.saveToStorage()}toggleRule(e){this._rules.update(t=>t.map(n=>n.id===e?P(E({},n),{enabled:!n.enabled}):n)),this.saveToStorage()}checkRules(e){let t=this._rules().filter(n=>n.enabled).sort((n,o)=>n.priority-o.priority);for(let n of t)this.evaluateCondition(n.condition,e)&&this.executeAction(n)}evaluateCondition(e,t){let n;switch(e.metric){case"conversion_rate":n=t.conversionRate;break;case"response_rate":n=t.avgEngagementScore/100;break;case"interest_score":n=t.avgInterestScore;break;case"no_response_count":n=this.sessionContext().noResponseCount;break;case"message_count":n=t.totalSessions;break;default:return!1}switch(e.operator){case"lt":return n<e.value;case"gt":return n>e.value;case"eq":return n===e.value;case"lte":return n<=e.value;case"gte":return n>=e.value;default:return!1}}executeAction(e){switch(console.log(`[SmartAutomation] \u89F8\u767C\u898F\u5247: ${e.name}`),this._rules.update(t=>t.map(n=>n.id===e.id?P(E({},n),{triggerCount:n.triggerCount+1,lastTriggered:new Date}):n)),e.action.type){case"send_alert":this.createAlert({type:e.action.params.level||"warning",title:e.name,message:e.action.params.message});break;case"switch_role":this.triggerRoleSwitch(e.action.params.strategy);break;case"adjust_delay":this.adjustRhythm(e.action.params.multiplier);break;case"pause":window.dispatchEvent(new CustomEvent("automation:pause",{detail:e}));break;case"escalate":this.createAlert({type:"error",title:"\u9700\u8981\u4EBA\u5DE5\u4ECB\u5165",message:`\u898F\u5247\u300C${e.name}\u300D\u5EFA\u8B70\u66AB\u505C\u81EA\u52D5\u5316\uFF0C\u8ACB\u4EBA\u5DE5\u8655\u7406`});break}this.saveToStorage()}getRecommendedRoles(){let e=this.analytics.roleComboStats(),t=this.analytics.topRoleCombos();if(t.length===0)return[];let n=e.length>0?e.reduce((o,a)=>o+a.conversionRate,0)/e.length:10;return t.slice(0,3).map((o,a)=>({roleCombo:o,confidence:Math.min(.9-a*.1,o.totalSessions/20),reason:this.getRecommendationReason(o,a),expectedImprovement:Math.max(0,o.conversionRate-n)}))}getRecommendationReason(e,t){return t===0?`\u8F49\u5316\u7387\u6700\u9AD8 (${e.conversionRate.toFixed(1)}%)\uFF0C\u57FA\u65BC ${e.totalSessions} \u6B21\u4F7F\u7528`:e.trend==="up"?"\u6548\u679C\u6301\u7E8C\u4E0A\u5347\uFF0C\u8FD1\u671F\u8868\u73FE\u512A\u79C0":`\u7A69\u5B9A\u8868\u73FE\uFF0C\u8F49\u5316\u7387 ${e.conversionRate.toFixed(1)}%`}triggerRoleSwitch(e){let t=this.getRecommendedRoles();t.length>0&&(window.dispatchEvent(new CustomEvent("automation:role-switch",{detail:{strategy:e,recommended:t[0].roleCombo}})),this.toast.info(`\u{1F4A1} \u5EFA\u8B70\u5207\u63DB\u81F3\u89D2\u8272\u7D44\u5408: ${t[0].roleCombo.comboName}`))}updateRhythmConfig(e){this._rhythmConfig.update(t=>E(E({},t),e)),this.saveToStorage()}adjustRhythm(e){let t=this._rhythmConfig(),n=Math.max(t.minDelay,Math.min(t.maxDelay,t.baseDelay*e));this._rhythmConfig.update(o=>P(E({},o),{baseDelay:n})),console.log(`[SmartAutomation] \u7BC0\u594F\u8ABF\u6574: ${t.baseDelay}s \u2192 ${n}s`)}getAdaptiveDelay(e){let t=this._rhythmConfig();if(!t.adaptiveMode)return t.baseDelay;let n=t.baseDelay;e?.userResponseTime!==void 0&&(e.userResponseTime<30?n*=.8:e.userResponseTime>120&&(n*=1.3)),e?.interestScore!==void 0&&(e.interestScore>80?n*=.7:e.interestScore<30&&(n*=1.2));let o=n*t.varianceRatio*(Math.random()-.5);return n+=o,Math.max(t.minDelay,Math.min(t.maxDelay,n))}recordUserResponse(e,t,n){this.sessionContext.update(o=>({noResponseCount:e?0:o.noResponseCount+1,userResponseTimes:t?[...o.userResponseTimes.slice(-9),t]:o.userResponseTimes,interestScores:n?[...o.interestScores.slice(-9),n]:o.interestScores}))}resetSessionContext(){this.sessionContext.set({noResponseCount:0,userResponseTimes:[],interestScores:[]})}createAlert(e){let t=P(E({id:`alert_${Date.now()}`},e),{timestamp:new Date,acknowledged:!1});return this._alerts.update(n=>[t,...n].slice(0,50)),this.saveToStorage(),e.type==="error"?this.toast.error(`\u{1F6A8} ${e.title}: ${e.message}`):e.type==="warning"&&this.toast.warning(`\u26A0\uFE0F ${e.title}: ${e.message}`),console.log(`[SmartAutomation] \u65B0\u544A\u8B66: ${e.title}`),t}acknowledgeAlert(e,t){this._alerts.update(n=>n.map(o=>o.id===e?P(E({},o),{acknowledged:!0,actionTaken:t}):o)),this.saveToStorage()}acknowledgeAllAlerts(){this._alerts.update(e=>e.map(t=>P(E({},t),{acknowledged:!0}))),this.saveToStorage()}clearAcknowledgedAlerts(){this._alerts.update(e=>e.filter(t=>!t.acknowledged)),this.saveToStorage()}saveToStorage(){let e={rules:this._rules(),rhythmConfig:this._rhythmConfig(),alerts:this._alerts().slice(0,20),savedAt:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}loadFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return;let t=JSON.parse(e);if(t.rules){let n=new Set(t.rules.map(a=>a.id)),o=[...t.rules.map(a=>P(E({},a),{lastTriggered:a.lastTriggered?new Date(a.lastTriggered):void 0})),...r1.filter(a=>!n.has(a.id))];this._rules.set(o)}t.rhythmConfig&&this._rhythmConfig.set(t.rhythmConfig),t.alerts&&this._alerts.set(t.alerts.map(n=>P(E({},n),{timestamp:new Date(n.timestamp)}))),console.log("[SmartAutomation] \u5DF2\u5F9E\u5B58\u5132\u6062\u5FA9\u6578\u64DA")}catch(e){console.error("[SmartAutomation] \u6062\u5FA9\u6578\u64DA\u5931\u6557:",e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ym=(i,e)=>e.id,FM=(i,e)=>e.roleCombo.comboId;function PM(i,e){if(i&1&&(T(0,"span",30),l(1),k()),i&2){let t=m().$implicit;c(),M(" ",t.badge," ")}}function RM(i,e){if(i&1){let t=I();T(0,"button",26),se("click",function(){let o=_(t).$implicit,a=m();return v(a.executeAction(o))}),T(1,"div",27),l(2),k(),T(3,"div",28),l(4),k(),T(5,"div",29),l(6),k(),y(7,PM,2,1,"span",30),k()}if(i&2){let t=e.$implicit,n=m();de(n.getActionButtonClass(t)),Ke("disabled",t.disabled),c(2),D(t.icon),c(2),D(t.name),c(2),D(t.description),c(),S(t.badge?7:-1)}}function NM(i,e){if(i&1&&(T(0,"span",33),l(1),k()),i&2){let t=m().$implicit;c(),M("\xD7",t.usageCount)}}function VM(i,e){if(i&1){let t=I();T(0,"button",31),se("click",function(){let o=_(t).$implicit,a=m();return v(a.launchPreset(o))}),T(1,"span"),l(2),k(),T(3,"span",32),l(4),k(),y(5,NM,2,1,"span",33),k()}if(i&2){let t=e.$implicit;c(2),D(t.icon),c(2),D(t.name),c(),S(t.usageCount>0?5:-1)}}function BM(i,e){if(i&1){let t=I();T(0,"div",35)(1,"div",2)(2,"div",36)(3,"span",37),l(4,"\u{1F3AD}"),k(),T(5,"span",38),l(6),k()(),T(7,"div",36)(8,"span",39),l(9),k(),T(10,"button",40),se("click",function(){let o=_(t).$implicit,a=m(2);return v(a.applyRecommendation(o))}),l(11," \u4F7F\u7528 "),k()()(),T(12,"div",29),l(13),k()()}if(i&2){let t=e.$implicit;c(6),D(t.roleCombo.comboName),c(3),M("+",t.expectedImprovement.toFixed(1),"%"),c(4),D(t.reason)}}function LM(i,e){if(i&1&&(T(0,"div",23)(1,"h4",34)(2,"span"),l(3,"\u{1F4A1}"),k(),l(4," AI \u63A8\u85A6 "),k(),O(5,BM,14,3,"div",35,FM),k()),i&2){let t=m();c(5),U(t.recommendations())}}function OM(i,e){if(i&1){let t=I();T(0,"div",24)(1,"div",2)(2,"div",36)(3,"span",41),l(4,"\u{1F514}"),k(),T(5,"span",32),l(6),k()(),T(7,"button",42),se("click",function(){_(t);let o=m();return v(o.viewAlerts.emit())}),l(8," \u67E5\u770B\u5168\u90E8 "),k()()()}if(i&2){let t=m();c(6),M("",t.alertCount()," \u500B\u672A\u8655\u7406\u544A\u8B66")}}function UM(i,e){if(i&1){let t=I();T(0,"div",47)(1,"div",5)(2,"span",50),l(3),k(),T(4,"div")(5,"div",38),l(6),k(),T(7,"div",7),l(8),k()()(),T(9,"button",51),se("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deletePreset(o.id))}),l(10," \u{1F5D1}\uFE0F "),k()()}if(i&2){let t=e.$implicit;c(3),D(t.icon),c(3),D(t.name),c(2),D(t.description)}}function GM(i,e){if(i&1){let t=I();T(0,"div",43),se("click",function(){_(t);let o=m();return v(o.showPresetManager.set(!1))}),T(1,"div",44),se("click",function(o){return _(t),v(o.stopPropagation())}),T(2,"h3",45),l(3,"\u7BA1\u7406\u5E38\u7528\u914D\u7F6E"),k(),T(4,"div",46),O(5,UM,11,3,"div",47,ym),k(),T(7,"div",48)(8,"button",49),se("click",function(){_(t);let o=m();return v(o.showPresetManager.set(!1))}),l(9," \u95DC\u9589 "),k()()()()}if(i&2){let t=m();c(5),U(t.presets())}}var vc=class i{constructor(){this.timing=F(er);this.automation=F(_c);this.analytics=F(_n);this.startMarketing=new qe;this.viewAlerts=new qe;this.navigateTo=new qe;this.showPresetManager=f(!1);this.presets=f([{id:"preset_quick_group",name:"\u7FA4\u7D44\u5FEB\u653B",icon:"\u{1F680}",description:"\u9867\u554F+\u5C08\u5BB6\u7D44\u5408\u5FEB\u901F\u5165\u7FA4",roleCombo:["consultant","expert"],targetType:"group",timing:"now",usageCount:12},{id:"preset_private_nurture",name:"\u79C1\u804A\u57F9\u80B2",icon:"\u{1F4AC}",description:"\u55AE\u89D2\u8272\u7CBE\u7D30\u5316\u79C1\u804A",roleCombo:["consultant"],targetType:"private",timing:"smart",usageCount:8},{id:"preset_scheduled",name:"\u5B9A\u6642\u71DF\u92B7",icon:"\u23F0",description:"\u667A\u80FD\u9078\u6642\u5B9A\u6642\u767C\u9001",targetType:"both",timing:"scheduled",usageCount:5}]);this.timingStatus=R(()=>this.timing.isGoodTimeNow());this.alertCount=R(()=>this.automation.unacknowledgedCount());this.recommendations=R(()=>this.automation.getRecommendedRoles());this.quickActions=[]}ngOnInit(){this.initQuickActions()}initQuickActions(){this.quickActions=[{id:"action_start_now",name:"\u7ACB\u5373\u958B\u59CB",icon:"\u{1F680}",description:"\u73FE\u5728\u958B\u59CB\u71DF\u92B7",color:"purple",category:"marketing",action:()=>this.startMarketing.emit({type:"immediate",config:{}})},{id:"action_smart_schedule",name:"\u667A\u80FD\u5B9A\u6642",icon:"\u23F1\uFE0F",description:"\u9078\u64C7\u6700\u4F73\u6642\u6A5F",color:"blue",category:"marketing",action:()=>this.startMarketing.emit({type:"smart_schedule",config:{}})},{id:"action_view_report",name:"\u67E5\u770B\u5831\u8868",icon:"\u{1F4CA}",description:"\u71DF\u92B7\u6548\u679C\u5206\u6790",color:"green",category:"analysis",action:()=>this.navigateTo.emit("marketing-report"),badge:this.analytics.todayStats().conversions>0?`+${this.analytics.todayStats().conversions}`:void 0},{id:"action_automation",name:"\u81EA\u52D5\u5316\u8A2D\u7F6E",icon:"\u2699\uFE0F",description:"\u914D\u7F6E\u81EA\u52D5\u898F\u5247",color:"slate",category:"automation",action:()=>this.navigateTo.emit("automation")}]}timingScoreClass(){let e=this.timingStatus().score;return e>=75?"text-green-400":e>=50?"text-amber-400":"text-red-400"}timingBgClass(){let e=this.timingStatus().score;return e>=75?"bg-green-500/20 text-green-400":e>=50?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}getActionButtonClass(e){let t="border-slate-700 bg-slate-800 hover:bg-slate-700";if(e.disabled)return t+" opacity-50 cursor-not-allowed";switch(e.color){case"purple":return"border-purple-500/30 bg-purple-500/10 hover:bg-purple-500/20";case"blue":return"border-blue-500/30 bg-blue-500/10 hover:bg-blue-500/20";case"green":return"border-green-500/30 bg-green-500/10 hover:bg-green-500/20";default:return t}}executeAction(e){e.disabled||e.action()}launchPreset(e){this.presets.update(t=>t.map(n=>n.id===e.id?P(E({},n),{usageCount:n.usageCount+1,lastUsed:new Date}):n)),this.startMarketing.emit({type:"preset",config:{presetId:e.id,roleCombo:e.roleCombo,targetType:e.targetType,timing:e.timing}})}createNewPreset(){console.log("\u5275\u5EFA\u65B0\u9810\u8A2D")}deletePreset(e){this.presets.update(t=>t.filter(n=>n.id!==e))}applyRecommendation(e){this.startMarketing.emit({type:"recommended",config:{roleCombo:e.roleCombo,confidence:e.confidence}})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-quick-actions-panel"]],outputs:{startMarketing:"startMarketing",viewAlerts:"viewAlerts",navigateTo:"navigateTo"},decls:46,vars:14,consts:[[1,"quick-actions-panel","bg-slate-900","border","border-slate-700","rounded-xl","overflow-hidden"],[1,"p-4","bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border-b","border-slate-700"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"text-right"],[1,"text-xs","text-slate-400"],[1,"flex","items-center","gap-1"],[1,"text-lg","font-bold"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","text-2xl"],[1,"mt-3","p-2","bg-slate-800/50","rounded-lg","text-sm"],[1,"p-4"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-3"],[1,"p-4","rounded-xl","border","transition-all","hover:scale-105","relative",3,"disabled","class"],[1,"p-4","border-t","border-slate-700"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium","text-white","flex","items-center","gap-2"],[1,"text-xs","text-purple-400","hover:text-purple-300",3,"click"],[1,"flex","gap-2","flex-wrap"],[1,"px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","hover:bg-slate-700","transition-all","flex","items-center","gap-2"],[1,"px-3","py-2","border","border-dashed","border-slate-600","rounded-lg","hover:border-purple-500","transition-all","flex","items-center","gap-2","text-slate-500","hover:text-purple-400",3,"click"],[1,"text-sm"],[1,"p-4","border-t","border-slate-700","bg-gradient-to-r","from-indigo-500/10","to-violet-500/10"],[1,"p-4","border-t","border-slate-700","bg-red-500/10"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center"],[1,"p-4","rounded-xl","border","transition-all","hover:scale-105","relative",3,"click","disabled"],[1,"text-3xl","mb-2"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-slate-400","mt-1"],[1,"absolute","top-2","right-2","px-1.5","py-0.5","text-xs","rounded-full","bg-red-500","text-white"],[1,"px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","hover:bg-slate-700","transition-all","flex","items-center","gap-2",3,"click"],[1,"text-sm","text-white"],[1,"text-xs","text-slate-500"],[1,"text-sm","font-medium","text-white","flex","items-center","gap-2","mb-3"],[1,"p-3","bg-slate-800/50","rounded-lg","mb-2","last:mb-0"],[1,"flex","items-center","gap-2"],[1,"text-purple-400"],[1,"text-white","font-medium"],[1,"text-xs","text-green-400"],[1,"px-2","py-1","text-xs","bg-purple-500","text-white","rounded","hover:bg-purple-600",3,"click"],[1,"text-red-400"],[1,"text-xs","text-red-400","hover:text-red-300",3,"click"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-xl","w-full","max-w-md","p-6",3,"click"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"space-y-3","max-h-96","overflow-y-auto"],[1,"p-3","bg-slate-800","rounded-lg","flex","items-center","justify-between"],[1,"flex","justify-end","gap-3","mt-4"],[1,"px-4","py-2","text-slate-400","hover:text-white",3,"click"],[1,"text-xl"],[1,"text-red-400","hover:text-red-300",3,"click"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h3",3)(5,"span"),l(6,"\u26A1"),k(),l(7," \u5FEB\u901F\u555F\u52D5 "),k(),T(8,"p",4),l(9,"\u4E00\u9375\u958B\u59CB\u71DF\u92B7\u4EFB\u52D9"),k()(),T(10,"div",5)(11,"div",6)(12,"div",7),l(13,"\u7576\u524D\u6642\u6A5F"),k(),T(14,"div",8)(15,"span",9),l(16),k(),T(17,"span",7),l(18,"\u5206"),k()()(),T(19,"div",10),l(20),k()()(),T(21,"div",11),l(22),k()(),T(23,"div",12)(24,"div",13),O(25,RM,8,7,"button",14,ym),k()(),T(27,"div",15)(28,"div",16)(29,"h4",17)(30,"span"),l(31,"\u{1F4CC}"),k(),l(32," \u5E38\u7528\u914D\u7F6E "),k(),T(33,"button",18),se("click",function(){return n.showPresetManager.set(!0)}),l(34," \u7BA1\u7406\u914D\u7F6E "),k()(),T(35,"div",19),O(36,VM,6,3,"button",20,ym),T(38,"button",21),se("click",function(){return n.createNewPreset()}),T(39,"span"),l(40,"\u2795"),k(),T(41,"span",22),l(42,"\u65B0\u589E"),k()()()(),y(43,LM,7,0,"div",23),y(44,OM,9,1,"div",24),k(),y(45,GM,10,0,"div",25)),t&2&&(c(15),de(n.timingScoreClass()),c(),M(" ",n.timingStatus().score," "),c(3),de(n.timingBgClass()),c(),M(" ",n.timingStatus().isGood?"\u2713":"\u23F0"," "),c(),N("text-green-400",n.timingStatus().isGood)("text-amber-400",!n.timingStatus().isGood),c(),M(" ",n.timingStatus().suggestion," "),c(3),U(n.quickActions),c(11),U(n.presets()),c(7),S(n.recommendations().length>0?43:-1),c(),S(n.alertCount()>0?44:-1),c(),S(n.showPresetManager()?45:-1))},dependencies:[oe,ae],styles:[".quick-actions-panel[_ngcontent-%COMP%]{max-width:100%}"]})}};var s1=(i,e)=>e.id;function $M(i,e){i&1&&(r(0,"span",6),l(1,"\u{1F512}"),s())}function HM(i,e){if(i&1){let t=I();r(0,"app-smart-dashboard",9),x("navigateTo",function(o){_(t);let a=m();return v(a.navigateTo(o))}),s()}}function qM(i,e){i&1&&B(0,"div",21)}function WM(i,e){i&1&&B(0,"div",26)}function zM(i,e){i&1&&B(0,"span",28)}function KM(i,e){i&1&&B(0,"div",29)}function jM(i,e){i&1&&B(0,"div",30)}function JM(i,e){if(i&1){let t=I();r(0,"div",53),x("click",function(){_(t);let o=m(2);return v(o.navigateTo("trigger-rules"))}),l(1," \u26A0\uFE0F \u9700\u914D\u7F6E\u898F\u5247 "),s()}}function QM(i,e){if(i&1){let t=I();r(0,"div",32)(1,"div",54)(2,"div",13),B(3,"div",55),r(4,"span",56),l(5),s()(),r(6,"button",57),x("click",function(){_(t);let o=m(2);return v(o.cancelAndRefresh())}),r(7,"span"),l(8,"\u2715"),s(),r(9,"span"),l(10,"\u53D6\u6D88"),s()()(),r(11,"div",58),B(12,"div",59),s(),r(13,"div",60)(14,"div",61)(15,"span"),l(16),s(),r(17,"span"),l(18,"\u5E33\u865F"),s()(),r(19,"div",61)(20,"span"),l(21),s(),r(22,"span"),l(23,"\u7FA4\u7D44"),s()(),r(24,"div",61)(25,"span"),l(26),s(),r(27,"span"),l(28,"\u76E3\u63A7"),s()(),r(29,"div",61)(30,"span"),l(31),s(),r(32,"span"),l(33,"AI"),s()(),r(34,"div",61)(35,"span"),l(36),s(),r(37,"span"),l(38,"\u5B8C\u6210"),s()()()()}if(i&2){let t=m(2);c(5),D(t.startMessage()),c(7),ee("width",t.startProgress(),"%"),c(2),N("text-emerald-400",t.startProgress()>=10)("text-slate-500",t.startProgress()<10),c(2),D(t.startProgress()>=10?"\u2713":"\u25CB"),c(3),N("text-emerald-400",t.startProgress()>=40)("text-slate-500",t.startProgress()<40),c(2),D(t.startProgress()>=40?"\u2713":"\u25CB"),c(3),N("text-emerald-400",t.startProgress()>=60)("text-slate-500",t.startProgress()<60),c(2),D(t.startProgress()>=60?"\u2713":"\u25CB"),c(3),N("text-emerald-400",t.startProgress()>=80)("text-slate-500",t.startProgress()<80),c(2),D(t.startProgress()>=80?"\u2713":"\u25CB"),c(3),N("text-emerald-400",t.startProgress()>=100)("text-slate-500",t.startProgress()<100),c(2),D(t.startProgress()>=100?"\u2713":"\u25CB")}}function YM(i,e){if(i&1){let t=I();r(0,"button",62),x("click",function(){_(t);let o=m(2);return v(o.oneClickStart())}),r(1,"span",63),l(2,"\u26A1"),s(),r(3,"span"),l(4,"\u4E00\u9375\u5168\u90E8\u555F\u52D5"),s()()}if(i&2){let t=m(2);L("disabled",t.starting())}}function XM(i,e){if(i&1){let t=I();r(0,"button",64),x("click",function(){_(t);let o=m(2);return v(o.oneClickStop())}),r(1,"span",63),l(2,"\u{1F6D1}"),s(),r(3,"span"),l(4,"\u4E00\u9375\u505C\u6B62\u6240\u6709"),s()()}}function ZM(i,e){i&1&&(r(0,"span",73),l(1,"\u2192"),s())}function eT(i,e){if(i&1&&(r(0,"div",71)(1,"span",72),l(2),s(),y(3,ZM,2,0,"span",73),s()),i&2){let t=e.$implicit,n=e.$index,o=m().$implicit,a=m(2);c(2),X(" ",a.getStepIcon(t.type)," ",t.name," "),c(),S(n<o.steps.length-1?3:-1)}}function tT(i,e){if(i&1){let t=I();r(0,"div",41)(1,"div",65)(2,"div",66)(3,"span"),l(4),s(),r(5,"span",67),l(6),s()(),r(7,"button",68),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.automationWorkflow.toggleWorkflow(o.id,!o.enabled))}),l(8),s()(),r(9,"div",69)(10,"span"),l(11),s(),r(12,"span"),l(13),s(),r(14,"span"),l(15),s()(),r(16,"div",70),O(17,eT,4,3,"div",71,s1),s()()}if(i&2){let t=e.$implicit,n=m(2);c(3),N("text-emerald-400",t.enabled)("text-slate-500",!t.enabled),c(),M(" ",t.enabled?"\u{1F7E2}":"\u26AA"," "),c(2),D(t.name),c(),N("bg-emerald-500",t.enabled)("hover:bg-emerald-600",t.enabled)("text-white",t.enabled)("bg-slate-600",!t.enabled)("hover:bg-slate-500",!t.enabled)("text-slate-300",!t.enabled),c(),M(" ",t.enabled?"\u904B\u884C\u4E2D":"\u5DF2\u66AB\u505C"," "),c(3),M("\u4ECA\u65E5\u89F8\u767C: ",t.stats.todayTriggers),c(2),M("\u9032\u884C\u4E2D: ",n.automationWorkflow.activeExecutionCount()),c(2),M("\u8F49\u5316: ",t.stats.conversions),c(2),U(t.steps)}}function nT(i,e){if(i&1){let t=I();r(0,"app-quick-actions-panel",10),x("startMarketing",function(o){_(t);let a=m();return v(a.handleQuickStart(o))})("navigateTo",function(o){_(t);let a=m();return v(a.navigateTo(o))})("viewAlerts",function(){_(t);let o=m();return v(o.navigateTo("monitoring"))}),s(),r(1,"div",11)(2,"div",12)(3,"div",13)(4,"span",14),l(5,"\u{1F680}"),s(),r(6,"h3",15),l(7,"\u4E00\u9375\u904B\u884C\u4E2D\u5FC3"),s()(),r(8,"button",16),x("click",function(){_(t);let o=m();return v(o.refreshStatus())}),ne(),r(9,"svg",17),B(10,"path",18),s()()(),ce(),r(11,"div",19)(12,"div",20),y(13,qM,1,0,"div",21),r(14,"div",22)(15,"div",23),l(16,"\u{1F511}"),s(),r(17,"div",24),l(18,"\u5E33\u865F\u5728\u7DDA"),s(),r(19,"div",25),l(20),s()()(),r(21,"div",20),y(22,WM,1,0,"div",26),r(23,"div",22)(24,"div",23),l(25,"\u{1F4E1}"),s(),r(26,"div",24),l(27,"\u76E3\u63A7\u72C0\u614B"),s(),r(28,"div",27),y(29,zM,1,0,"span",28),l(30),s()()(),r(31,"div",20),y(32,KM,1,0,"div",29),r(33,"div",22)(34,"div",23),l(35,"\u{1F916}"),s(),r(36,"div",24),l(37,"AI \u804A\u5929"),s(),r(38,"div",25),l(39),s()()(),r(40,"div",20),y(41,jM,1,0,"div",30),r(42,"div",22)(43,"div",23),l(44,"\u26A1"),s(),r(45,"div",24),l(46,"\u89F8\u767C\u898F\u5247"),s(),r(47,"div",25),l(48),s(),y(49,JM,2,0,"div",31),s()()(),y(50,QM,39,28,"div",32),r(51,"div",33),y(52,YM,5,1,"button",34)(53,XM,5,0,"button",35),s()(),r(54,"div",36)(55,"div",37)(56,"div",12)(57,"div",13)(58,"span",38),l(59,"\u{1F3AF}"),s(),r(60,"h3",39),l(61,"\u5F15\u5C0E\u5F0F\u5DE5\u4F5C\u6D41"),s()()(),r(62,"p",40),l(63," \u95DC\u9375\u8A5E\u89F8\u767C \u2192 AI \u7B56\u5283 \u2192 \u79C1\u804A\u57F9\u80B2 \u2192 \u8208\u8DA3\u5EFA\u7FA4 \u2192 \u7D44\u7FA4\u6210\u4EA4 "),s(),O(64,tT,19,22,"div",41,s1),r(66,"div",42),l(67," \u{1F4A1} \u555F\u7528\u5F8C\uFF0C\u7576\u76E3\u63A7\u7FA4\u7D44\u89F8\u767C\u95DC\u9375\u8A5E\u6642\uFF0C\u5C07\u81EA\u52D5\u57F7\u884C AI \u7B56\u5283\u4E26\u958B\u59CB\u591A\u89D2\u8272\u5354\u4F5C "),s()(),r(68,"div",37)(69,"div",43)(70,"span",38),l(71,"\u26A1"),s(),r(72,"h3",39),l(73,"\u5FEB\u901F\u64CD\u4F5C"),s()(),r(74,"div",44)(75,"button",45),x("click",function(){_(t);let o=m();return v(o.navigateTo("multi-role"))}),r(76,"div",46),l(77,"\u{1F3AD}"),s(),r(78,"div",47),l(79,"\u624B\u52D5\u7B56\u5283"),s(),r(80,"div",48),l(81,"\u958B\u59CB AI \u591A\u89D2\u8272\u5354\u4F5C"),s()(),r(82,"button",49),x("click",function(){_(t);let o=m();return v(o.navigateTo("monitoring-groups"))}),r(83,"div",46),l(84,"\u{1F465}"),s(),r(85,"div",47),l(86,"\u76E3\u63A7\u7FA4\u7D44"),s(),r(87,"div",48),l(88,"\u914D\u7F6E\u76E3\u63A7\u4F86\u6E90"),s()(),r(89,"button",50),x("click",function(){_(t);let o=m();return v(o.navigateTo("keyword-sets"))}),r(90,"div",46),l(91,"\u{1F511}"),s(),r(92,"div",47),l(93,"\u95DC\u9375\u8A5E\u96C6"),s(),r(94,"div",48),l(95,"\u8A2D\u7F6E\u89F8\u767C\u8A5E"),s()(),r(96,"button",51),x("click",function(){_(t);let o=m();return v(o.navigateTo("leads"))}),r(97,"div",46),l(98,"\u{1F4CB}"),s(),r(99,"div",47),l(100,"\u67E5\u770B\u7DDA\u7D22"),s(),r(101,"div",48),l(102,"\u7BA1\u7406\u6F5B\u5728\u5BA2\u6236"),s()()()()(),r(103,"app-quick-workflow",52),x("navigateTo",function(o){_(t);let a=m();return v(a.navigateTo(o))})("startMonitoring",function(){_(t);let o=m();return v(o.startMonitoring())})("stopMonitoring",function(){_(t);let o=m();return v(o.stopMonitoring())}),s()}if(i&2){let t,n,o,a,d,u,p,g,C=m();c(13),S(C.onlineAccountsCount()>0?13:-1),c(6),ee("color",C.onlineAccountsCount()>0?"var(--success)":"var(--error)"),c(),X(" ",C.onlineAccountsCount(),"/",C.totalAccountsCount()," "),c(2),S(C.isMonitoring()?22:-1),c(6),ee("color",C.isMonitoring()?"var(--success)":"var(--error)"),c(),S(C.isMonitoring()?29:-1),c(),M(" ",C.isMonitoring()?"\u904B\u884C\u4E2D":"\u672A\u555F\u52D5"," "),c(2),S((t=C.status().ai)!=null&&t.enabled?32:-1),c(6),ee("color",(n=C.status().ai)!=null&&n.enabled?"var(--success)":"var(--error)"),c(),M(" ",(o=C.status().ai)!=null&&o.enabled?((o=C.status().ai)==null?null:o.mode)==="full"?"\u5168\u81EA\u52D5":"\u534A\u81EA\u52D5":"\u672A\u555F\u7528"," "),c(2),S((((a=C.status().campaigns)==null?null:a.active)||0)>0?41:-1),c(6),ee("color",(((d=C.status().campaigns)==null?null:d.active)||0)>0?"var(--success)":"var(--warning)"),c(),X(" ",((u=C.status().campaigns)==null?null:u.active)||0,"/",((u=C.status().campaigns)==null?null:u.total)||0," "),c(),S((((p=C.status().campaigns)==null?null:p.active)||0)===0?49:-1),c(),S(C.starting()?50:-1),c(2),S(!C.isMonitoring()||!((g=C.status().ai)!=null&&g.enabled)?52:53),c(12),U(C.automationWorkflow.workflows()),c(39),L("systemStatus",C.status())("isMonitoring",C.isMonitoring())}}var xc=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.accountService=F(pt);this.membershipService=F(Ie);this.automationWorkflow=F(qn);this.mode=f("classic");this.starting=f(!1);this.startProgress=f(0);this.startMessage=f("");this.monitoringService=F(Hn);this.isMonitoring=R(()=>this.monitoringService.monitoringActive());this.startTimeoutId=null;this.START_TIMEOUT_MS=12e4;this.heartbeatIntervalId=null;this.HEARTBEAT_INTERVAL_MS=3e4;this._status=f({});this.status=this._status.asReadonly();this.onlineAccountsCount=R(()=>this.accountService.accounts().filter(t=>t.status==="Online"||t.is_connected).length);this.totalAccountsCount=R(()=>this.accountService.accounts().length);this.ipcCleanup=[]}ngOnInit(){console.log("[DashboardView] Component initialized"),this.loadInitialData(),this.setupIpcListeners(),this.startHeartbeat()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e()),this.clearStartTimeout(),this.stopHeartbeat()}startHeartbeat(){this.stopHeartbeat(),this.heartbeatIntervalId=setInterval(()=>{console.log("[DashboardView] \u5FC3\u8DF3\uFF1A\u5237\u65B0\u72C0\u614B"),this.refreshStatus()},this.HEARTBEAT_INTERVAL_MS)}stopHeartbeat(){this.heartbeatIntervalId&&(clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=null)}loadInitialData(){this.refreshStatus()}setupIpcListeners(){let e=this.ipc.on("system-status",u=>{this._status.set(u)}),t=this.ipc.on("monitoring-started",u=>{console.log("[DashboardView] \u76E3\u63A7\u5DF2\u555F\u52D5:",u),this.toast.success(u.message||"\u76E3\u63A7\u5DF2\u6210\u529F\u555F\u52D5")}),n=this.ipc.on("monitoring-start-failed",u=>{console.log("[DashboardView] \u76E3\u63A7\u555F\u52D5\u5931\u6557:",u);let p=u.message||"\u76E3\u63A7\u555F\u52D5\u5931\u6557";u.reason==="config_check_failed"&&u.issues?.length?p=`\u914D\u7F6E\u932F\u8AA4: ${u.issues[0]?.message||p}`:u.reason==="no_accessible_groups"?p="\u7121\u6CD5\u8A2A\u554F\u76E3\u63A7\u7FA4\u7D44\uFF0C\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44":u.reason==="all_accounts_failed"&&(p="\u6240\u6709\u76E3\u63A7\u5E33\u865F\u90FD\u7121\u6CD5\u555F\u52D5"),this.toast.error(p,5e3)}),o=this.ipc.on("monitoring-stopped",()=>{console.log("[DashboardView] \u76E3\u63A7\u5DF2\u505C\u6B62"),this.toast.info("\u76E3\u63A7\u5DF2\u505C\u6B62")}),a=this.ipc.on("one-click-start-progress",u=>{console.log("[DashboardView] \u6536\u5230\u4E00\u9375\u555F\u52D5\u9032\u5EA6:",u),this.startProgress.set(u.progress),this.startMessage.set(u.message),(u.step==="complete"||u.step==="error"||u.progress>=100)&&setTimeout(()=>{this.starting.set(!1),this.refreshStatus()},500)}),d=this.ipc.on("one-click-start-result",u=>{console.log("[DashboardView] \u6536\u5230\u4E00\u9375\u555F\u52D5\u7D50\u679C:",u),this.clearStartTimeout(),this.starting.set(!1),this.startProgress.set(100),this.startMessage.set(u.overall_success?"\u2705 \u555F\u52D5\u5B8C\u6210":"\u26A0\uFE0F \u90E8\u5206\u555F\u52D5\u5931\u6557"),u.monitoring?.success!==void 0&&console.log("[DashboardView] \u4E00\u9375\u555F\u52D5\u7D50\u679C\u76E3\u63A7\u72C0\u614B:",u.monitoring.success),this.refreshStatus(),setTimeout(()=>{this.startMessage.set("")},3e3)});this.ipcCleanup.push(e,t,n,o,a,d)}t(e,t){return this.i18n.t(e,t)}switchMode(e){if(e==="smart"&&!this.membershipService.hasFeature("smartMode")){this.toast.warning("\u9700\u8981\u9EC3\u91D1\u5927\u5E2B\u6216\u4EE5\u4E0A\u6703\u54E1");return}this.mode.set(e)}navigateTo(e){let t=typeof e=="string"?e:e.view,n=typeof e=="string"?void 0:e.handler,a={resources:"resource-center",accounts:"accounts","add-account":"add-account",automation:"automation",ads:"leads",leads:"leads","nurturing-analytics":"nurturing-analytics","ai-center":"aiCenter","multi-role":"multi-role"}[t]||t;console.log("[DashboardView] navigateTo:",{rawView:t,view:a,handler:n}),n&&this.executeHandler(n),a&&this.nav.navigateTo(a)}executeHandler(e){switch(console.log("[DashboardView] executeHandler:",e),e){case"scan-sessions":this.ipc.send("scan-orphan-sessions"),this.toast.info("\u{1F50D} \u6B63\u5728\u6383\u63CF\u53EF\u6062\u5FA9\u7684 Session...");break;case"new-campaign":this.ipc.send("open-add-campaign-dialog"),this.toast.info("\u26A1 \u6B63\u5728\u6253\u958B\u5275\u5EFA\u6D3B\u52D5\u5C0D\u8A71\u6846...");break;case"export-leads":this.ipc.send("open-export-dialog"),this.toast.info("\u{1F4E5} \u6B63\u5728\u6253\u958B\u5C0E\u51FA\u5C0D\u8A71\u6846...");break;case"start-monitoring":this.startMonitoring();break;case"run-script":this.toast.info("\u{1F3AC} \u6B63\u5728\u555F\u52D5\u5287\u672C\u57F7\u884C..."),this.ipc.send("run-multi-role-script");break;case"openAddAccountDialog":this.ipc.send("open-add-account-dialog");break;case"stopMonitoring":this.stopMonitoring();break;default:console.warn("[DashboardView] Unknown handler:",e),this.toast.info(`\u6B63\u5728\u8655\u7406: ${e}...`)}}refreshStatus(){this.ipc.send("get-system-status"),this.ipc.send("get-monitoring-status")}oneClickStart(){if(this.starting()){this.toast.warning("\u6B63\u5728\u555F\u52D5\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.totalAccountsCount();if(e===0){this.toast.error("\u274C \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55\u5E33\u865F\uFF0C\u8ACB\u5148\u6DFB\u52A0\u5E33\u865F",4e3);return}this.starting.set(!0),this.startProgress.set(0),this.startMessage.set(`\u{1F680} \u958B\u59CB\u555F\u52D5 (${e} \u500B\u5E33\u865F)...`),this.clearStartTimeout(),this.startTimeoutId=setTimeout(()=>{this.starting()&&(console.warn("[DashboardView] \u4E00\u9375\u555F\u52D5\u8D85\u6642\uFF0C\u81EA\u52D5\u6062\u5FA9"),this.starting.set(!1),this.startMessage.set("\u26A0\uFE0F \u555F\u52D5\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u5F8C\u7AEF\u72C0\u614B"),this.toast.warning("\u555F\u52D5\u8D85\u6642\uFF0C\u6B63\u5728\u5237\u65B0\u72C0\u614B...",3e3),this.refreshStatus())},this.START_TIMEOUT_MS),this.ipc.send("one-click-start",{forceRefresh:!0}),this.toast.info(`\u{1F680} \u958B\u59CB\u4E00\u9375\u555F\u52D5\uFF0C\u5F8C\u7AEF\u5C07\u81EA\u52D5\u9023\u63A5 ${e} \u500B\u5E33\u865F`,3e3)}clearStartTimeout(){this.startTimeoutId&&(clearTimeout(this.startTimeoutId),this.startTimeoutId=null)}cancelAndRefresh(){console.log("[DashboardView] \u7528\u6236\u53D6\u6D88\u555F\u52D5"),this.clearStartTimeout(),this.starting.set(!1),this.startProgress.set(0),this.startMessage.set(""),this.toast.info("\u5DF2\u53D6\u6D88\uFF0C\u6B63\u5728\u5237\u65B0\u72C0\u614B...",2e3),this.refreshStatus()}oneClickStop(){this.ipc.send("one-click-stop"),this.toast.info("\u6B63\u5728\u505C\u6B62\u6240\u6709\u670D\u52D9...")}startMonitoring(){this.ipc.send("start-monitoring")}stopMonitoring(){this.ipc.send("stop-monitoring")}handleQuickStart(e){switch(console.log("[Dashboard] \u5FEB\u6377\u555F\u52D5:",e),e.type){case"immediate":this.toast.info("\u{1F680} \u6B63\u5728\u555F\u52D5\u5373\u6642\u71DF\u92B7..."),this.navigateTo("multi-role");break;case"smart_schedule":this.toast.info("\u23F1\uFE0F \u6B63\u5728\u914D\u7F6E\u667A\u80FD\u5B9A\u6642..."),this.navigateTo("multi-role");break;case"preset":this.toast.success(`\u{1F4CC} \u4F7F\u7528\u9810\u8A2D\u914D\u7F6E: ${e.config.presetId}`),this.navigateTo("multi-role");break;case"recommended":this.toast.success(`\u{1F4A1} \u4F7F\u7528\u63A8\u85A6\u7D44\u5408: ${e.config.roleCombo?.comboName}`),this.navigateTo("multi-role");break;default:this.navigateTo("multi-role")}}getStepIcon(e){return{evaluate:"\u{1F4CA}",plan:"\u{1F3AF}",private_chat:"\u{1F4AC}",detect_interest:"\u{1F50D}",create_group:"\u{1F465}",group_marketing:"\u{1F680}",record:"\u{1F4DD}"}[e]||"\u25B6\uFE0F"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-dashboard-view"]],decls:14,vars:22,consts:[[1,"page-content"],[1,"bg-green-500","text-white","p-4","rounded-lg","mb-4","text-center","font-bold"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-4xl","font-bold",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-2","bg-slate-800/50","rounded-xl","p-1"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1",3,"click","title"],[1,"text-xs"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],[1,"block","-mx-8","-mb-8",2,"height","calc(100vh - 140px)"],[1,"block","-mx-8","-mb-8",2,"height","calc(100vh - 140px)",3,"navigateTo"],[1,"mb-6",3,"startMarketing","navigateTo","viewAlerts"],[1,"rounded-xl","p-6","mb-8",2,"background","linear-gradient(to right, var(--primary-bg), rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1))","border","1px solid var(--primary)","box-shadow","var(--shadow-lg)"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-xl","font-bold",2,"color","var(--text-primary)"],["title","\u5237\u65B0\u72C0\u614B",1,"transition-colors",2,"color","var(--text-muted)",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"rounded-lg","p-4","text-center","relative","overflow-hidden",2,"background-color","var(--bg-card)"],[1,"absolute","inset-0","bg-gradient-to-t","from-emerald-500/10","to-transparent"],[1,"relative"],[1,"text-2xl","mb-1"],[1,"text-sm",2,"color","var(--text-muted)"],[1,"text-xl","font-bold"],[1,"absolute","inset-0","bg-gradient-to-t","from-cyan-500/10","to-transparent"],[1,"text-xl","font-bold","flex","items-center","justify-center","gap-2"],[1,"w-2.5","h-2.5","rounded-full","bg-emerald-400","animate-pulse"],[1,"absolute","inset-0","bg-gradient-to-t","from-purple-500/10","to-transparent"],[1,"absolute","inset-0","bg-gradient-to-t","from-orange-500/10","to-transparent"],[1,"text-xs","text-yellow-400","mt-1","cursor-pointer","hover:underline"],[1,"bg-slate-800/50","rounded-lg","p-4","mb-4","border","border-cyan-500/30"],[1,"flex","gap-4"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2",3,"disabled"],[1,"flex-1","bg-gradient-to-r","from-red-500","to-orange-500","hover:from-red-600","hover:to-orange-600","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-8"],[1,"rounded-xl","p-6",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"text-2xl"],[1,"text-lg","font-bold",2,"color","var(--text-primary)"],[1,"text-sm","mb-4",2,"color","var(--text-muted)"],[1,"p-4","rounded-lg","mb-3",2,"background-color","var(--bg-secondary)"],[1,"text-xs","p-3","rounded-lg",2,"background-color","var(--bg-tertiary)","color","var(--text-muted)"],[1,"flex","items-center","gap-3","mb-4"],[1,"grid","grid-cols-2","gap-3"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-purple-500/10","border","border-transparent","hover:border-purple-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[1,"text-xl","mb-1"],[1,"font-medium","text-sm",2,"color","var(--text-primary)"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-cyan-500/10","border","border-transparent","hover:border-cyan-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-amber-500/10","border","border-transparent","hover:border-amber-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[1,"p-4","rounded-lg","text-left","transition-colors","hover:bg-emerald-500/10","border","border-transparent","hover:border-emerald-500/30",2,"background-color","var(--bg-secondary)",3,"click"],[3,"navigateTo","startMonitoring","stopMonitoring","systemStatus","isMonitoring"],[1,"text-xs","text-yellow-400","mt-1","cursor-pointer","hover:underline",3,"click"],[1,"flex","items-center","justify-between","mb-3"],[1,"animate-spin","h-5","w-5","border-2","border-cyan-500","border-t-transparent","rounded-full"],[1,"text-cyan-300","font-medium"],["title","\u53D6\u6D88\u4E26\u5237\u65B0\u72C0\u614B",1,"px-3","py-1","text-xs","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors","flex","items-center","gap-1",3,"click"],[1,"w-full","bg-slate-700","rounded-full","h-2.5","mb-3"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","h-2.5","rounded-full","transition-all","duration-300"],[1,"flex","justify-between","text-xs"],[1,"flex","items-center","gap-1"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"text-xl"],[1,"flex-1","bg-gradient-to-r","from-red-500","to-orange-500","hover:from-red-600","hover:to-orange-600","text-white","font-bold","py-3","px-6","rounded-lg","transition","duration-200","shadow-lg","flex","items-center","justify-center","gap-2",3,"click"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2"],[1,"font-medium",2,"color","var(--text-primary)"],[1,"px-3","py-1","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"flex","items-center","gap-4","text-xs",2,"color","var(--text-muted)"],[1,"flex","items-center","gap-1","mt-3","overflow-x-auto","pb-1"],[1,"flex","items-center"],[1,"px-2","py-1","text-xs","rounded","whitespace-nowrap",2,"background-color","var(--bg-tertiary)","color","var(--text-secondary)"],[1,"mx-1",2,"color","var(--text-muted)"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1),l(2," \u2705 Dashboard \u8DEF\u7531\u5DF2\u52A0\u8F09\uFF01\u5982\u679C\u60A8\u770B\u5230\u9019\u500B\uFF0C\u8AAA\u660E\u8DEF\u7531\u6B63\u5E38\u5DE5\u4F5C\u3002 "),s(),r(3,"div",2)(4,"h2",3),l(5),s(),r(6,"div",4)(7,"button",5),x("click",function(){return n.switchMode("smart")}),l(8," \u{1F916} \u667A\u80FD\u6A21\u5F0F "),y(9,$M,2,0,"span",6),s(),r(10,"button",7),x("click",function(){return n.switchMode("classic")}),l(11," \u{1F4CA} \u7D93\u5178\u6A21\u5F0F "),s()()(),y(12,HM,1,0,"app-smart-dashboard",8)(13,nT,104,24),s()),t&2&&(c(5),D(n.t("dashboard")),c(2),N("bg-gradient-to-r",n.mode()==="smart")("from-cyan-500",n.mode()==="smart")("to-blue-500",n.mode()==="smart")("text-white",n.mode()==="smart")("text-slate-400",n.mode()!=="smart")("opacity-60",!n.membershipService.hasFeature("smartMode")),L("title",n.membershipService.hasFeature("smartMode")?"":"\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),c(2),S(n.membershipService.hasFeature("smartMode")?-1:9),c(),N("bg-slate-700",n.mode()==="classic")("text-white",n.mode()==="classic")("text-slate-400",n.mode()!=="classic"),c(2),S(n.mode()==="smart"?12:13))},dependencies:[oe,ae,gc,fc,vc],encapsulation:2,changeDetection:0})}};var Jt=(i,e)=>e.id;function iT(i,e){if(i&1&&(r(0,"option",13),l(1),s()),i&2){let t=e.$implicit;L("value",t.id),c(),M("\u{1F4C1} ",t.name)}}function oT(i,e){if(i&1&&(r(0,"span",16),l(1),s()),i&2){let t=m();c(),D(t.tagFilter.length)}}function rT(i,e){if(i&1){let t=I();r(0,"label",51)(1,"input",35),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleTagFilterItem(o.id))}),s(),B(2,"span",52),r(3,"span"),l(4),s()()}if(i&2){let t=e.$implicit,n=m(2);ee("--tag-color",t.color),c(),L("checked",n.tagFilter.includes(t.id)),c(),ee("background",t.color),c(2),D(t.name)}}function sT(i,e){if(i&1){let t=I();r(0,"div",17)(1,"div",47)(2,"span"),l(3,"\u9009\u62E9\u6807\u7B7E"),s(),r(4,"button",48),x("click",function(){_(t);let o=m();return v(o.clearTagFilter())}),l(5,"\u6E05\u9664"),s()(),O(6,rT,5,6,"label",49,Jt),r(8,"button",50),x("click",function(){_(t);let o=m();return v(o.openTagManager())}),l(9,"\u2699\uFE0F \u7BA1\u7406\u6807\u7B7E"),s()()}if(i&2){let t=m();c(6),U(t.availableTags())}}function aT(i,e){if(i&1){let t=I();r(0,"div",43)(1,"span",53),l(2),s(),r(3,"button",54),x("click",function(){_(t);let o=m();return v(o.batchLogin())}),l(4),s(),r(5,"button",55),x("click",function(){_(t);let o=m();return v(o.batchLogout())}),l(6),s(),r(7,"button",56),x("click",function(){_(t);let o=m();return v(o.openBatchEditModal())}),l(8," \u2699\uFE0F \u6279\u91CF\u8BBE\u7F6E "),s(),r(9,"button",57),x("click",function(){_(t);let o=m();return v(o.batchSync())}),l(10," \u{1F504} \u6279\u91CF\u540C\u6B65 "),s(),r(11,"button",58),x("click",function(){_(t);let o=m();return v(o.confirmBatchDelete())}),l(12," \u{1F5D1}\uFE0F \u6279\u91CF\u5220\u9664 "),s(),r(13,"button",59),x("click",function(){_(t);let o=m();return v(o.clearSelection())}),l(14," \u2715 \u53D6\u6D88\u9009\u62E9 "),s()()}if(i&2){let t=m();c(2),M("\u5DF2\u9078 ",t.selectedIds.size," \u500B"),c(),L("disabled",t.batchLoggingIn()),c(),M(" ",t.batchLoggingIn()?"\u23F3":"\u25B6\uFE0F"," \u6279\u91CF\u767B\u5165 "),c(),L("disabled",t.batchLoggingOut()),c(),M(" ",t.batchLoggingOut()?"\u23F3":"\u23F9\uFE0F"," \u6279\u91CF\u9000\u51FA "),c(3),L("disabled",t.batchSyncing())}}function lT(i,e){if(i&1){let t=I();r(0,"div",64)(1,"img",96),x("error",function(o){_(t);let a=m(3);return v(a.onAvatarError(o))}),s(),r(2,"div",97),l(3),s()()}if(i&2){let t=m().$implicit,n=m(2);c(),L("src",n.getAvatarUrl(t.avatarPath),ot),c(2),D(n.getAvatarLetter(t))}}function cT(i,e){if(i&1&&(r(0,"div",65),l(1),s()),i&2){let t=m().$implicit,n=m(2);c(),D(n.getAvatarLetter(t))}}function dT(i,e){if(i&1&&(r(0,"div",75),l(1),s()),i&2){let t=m().$implicit;c(),D(t.nickname)}}function uT(i,e){if(i&1&&(r(0,"span",78),l(1),s()),i&2){let t=m().$implicit;c(),D("@"+t.username)}}function mT(i,e){if(i&1&&(r(0,"span",100),l(1),s()),i&2){let t=e;ee("background",t.color),c(),D(t.name)}}function pT(i,e){if(i&1&&y(0,mT,2,3,"span",99),i&2){let t,n=e.$implicit,o=m(4);S((t=o.getTagById(n))?0:-1,t)}}function gT(i,e){if(i&1&&(r(0,"span",98),l(1),s()),i&2){let t=m(2).$implicit;c(),M("+",t.tags.length-3)}}function hT(i,e){if(i&1&&(r(0,"div",79),O(1,pT,1,1,null,null,be),y(3,gT,2,1,"span",98),s()),i&2){let t=m().$implicit;c(),U(t.tags.slice(0,3)),c(2),S(t.tags.length>3?3:-1)}}function fT(i,e){i&1&&l(0," \u6B63\u5728\u9023\u63A5... ")}function _T(i,e){i&1&&l(0," \u7B49\u5F85\u9A57\u8B49\u78BC ")}function vT(i,e){i&1&&l(0," \u7B49\u5F852FA\u5BC6\u78BC ")}function xT(i,e){if(i&1&&l(0),i&2){let t,n=m(2).$implicit,o=m(2);M(" ",((t=o.getLoginProgress(n.id))==null?null:t.step)||"\u8655\u7406\u4E2D..."," ")}}function CT(i,e){if(i&1&&(r(0,"div",87),B(1,"div",101),r(2,"span",102),y(3,fT,1,0)(4,_T,1,0)(5,vT,1,0)(6,xT,1,1),s()()),i&2){let t,n=m().$implicit;c(3),S((t=n.status)==="Logging in..."?3:t==="Waiting Code"?4:t==="Waiting 2FA"?5:6)}}function bT(i,e){if(i&1){let t=I();r(0,"button",103),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.onLogin(o))}),r(1,"span",93),l(2,"\u25B6\uFE0F"),s(),r(3,"span",94),l(4,"\u767B\u5165"),s()()}}function yT(i,e){i&1&&(r(0,"button",90)(1,"span",104),l(2,"\u23F3"),s(),r(3,"span",94),l(4,"\u767B\u5165\u4E2D"),s()())}function ST(i,e){if(i&1){let t=I();r(0,"button",105),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.onLogout(o))}),r(1,"span",93),l(2,"\u23F9\uFE0F"),s(),r(3,"span",94),l(4,"\u9000\u51FA"),s()()}}function wT(i,e){if(i&1){let t=I();r(0,"div",61),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.selectAccount(o))}),r(1,"div",62),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"input",35),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSelect(o.id))}),s()(),r(3,"div",63),y(4,lT,4,2,"div",64)(5,cT,2,1,"div",65),r(6,"div",66)(7,"div",67),B(8,"span",68),r(9,"span",69),l(10),s()(),r(11,"div",70),x("click",function(o){let a=_(t).$implicit,d=m(2);return v(d.openRoleSelector(a,o))}),r(12,"span",71),l(13),s(),r(14,"span",72),l(15),s(),r(16,"span",73),l(17,"\u25BC"),s()()()(),r(18,"div",74),y(19,dT,2,1,"div",75),r(20,"div",76),l(21),s(),r(22,"div",77),l(23),y(24,uT,2,1,"span",78),s(),y(25,hT,4,1,"div",79),s(),r(26,"div",80)(27,"span",81),l(28),s(),r(29,"span",82),l(30),s()(),r(31,"div",83)(32,"div",84),B(33,"div",85),s(),r(34,"span",86),l(35),s()(),y(36,CT,7,1,"div",87),r(37,"div",88),x("click",function(o){return _(t),v(o.stopPropagation())}),y(38,bT,5,0,"button",89),y(39,yT,5,0,"button",90),y(40,ST,5,0,"button",91),r(41,"button",92),x("click",function(o){let a=_(t).$implicit;return m(2).openEditModal(a),v(o.stopPropagation())}),r(42,"span",93),l(43,"\u2699\uFE0F"),s(),r(44,"span",94),l(45,"\u8BBE\u7F6E"),s()(),r(46,"button",95),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.onRemove(o))}),r(47,"span",93),l(48,"\u{1F5D1}\uFE0F"),s(),r(49,"span",94),l(50,"\u5220\u9664"),s()()()()}if(i&2){let t=e.$implicit,n=m(2);N("online",t.status==="Online")("offline",t.status==="Offline")("banned",t.status==="Banned")("warming",t.status==="Warming Up")("logging-in",n.isLoggingIn(t.id)||t.status==="Logging in..."||t.status==="Waiting Code"||t.status==="Waiting 2FA")("selected",n.selectedIds.has(t.id)),c(2),L("checked",n.selectedIds.has(t.id)),c(2),S(n.isValidAvatarPath(t.avatarPath)?4:5),c(4),de(n.getStatusClass(t.status)),c(2),D(n.getStatusText(t.status)),c(3),D(n.getRoleIcon(t.role)),c(),ee("color",n.getRoleColor(t.role)),c(),D(n.getRoleName(t.role)),c(4),S(t.nickname?19:-1),c(2),D(t.phone),c(2),X(" ",t.firstName||""," ",t.lastName||""," "),c(),S(t.username?24:-1),c(),S(t.tags&&t.tags.length>0?25:-1),c(3),D(n.getDeviceIcon(t.platform)),c(2),D(t.deviceModel||"Unknown Device"),c(3),ee("width",t.healthScore||100,"%"),N("good",(t.healthScore||100)>=80)("warning",(t.healthScore||100)>=50&&(t.healthScore||100)<80)("danger",(t.healthScore||100)<50),c(2),M("",t.healthScore||100,"%"),c(),S(n.isLoggingIn(t.id)||t.status==="Logging in..."||t.status==="Waiting Code"||t.status==="Waiting 2FA"?36:-1),c(2),S(n.canLogin(t)&&!n.isLoggingIn(t.id)?38:-1),c(),S(n.isLoggingIn(t.id)||t.status==="Logging in..."||t.status==="Waiting Code"||t.status==="Waiting 2FA"?39:-1),c(),S(t.status==="Online"?40:-1),c(6),L("disabled",n.isLoggingIn(t.id))}}function ET(i,e){if(i&1&&(r(0,"div",44),O(1,wT,51,43,"div",60,Jt),s()),i&2){let t=m();c(),U(t.filteredAccounts)}}function DT(i,e){if(i&1){let t=I();r(0,"button",122),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.onLogin(o))}),l(1,"\u25B6\uFE0F"),s()}}function AT(i,e){if(i&1){let t=I();r(0,"button",123),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.onLogout(o))}),l(1,"\u23F9\uFE0F"),s()}}function MT(i,e){if(i&1){let t=I();r(0,"tr",109),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.selectAccount(o))}),r(1,"td",109),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"input",35),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSelect(o.id))}),s()(),r(3,"td"),B(4,"span",110),s(),r(5,"td",111),l(6),s(),r(7,"td",112)(8,"span",113),x("click",function(o){let a=_(t).$implicit,d=m(2);return v(d.openRoleSelector(a,o))}),l(9),s()(),r(10,"td"),l(11),s(),r(12,"td",114),l(13),s(),r(14,"td")(15,"div",115)(16,"div",116),B(17,"div",85),s(),r(18,"span"),l(19),s()()(),r(20,"td"),l(21),s(),r(22,"td",117),x("click",function(o){return _(t),v(o.stopPropagation())}),y(23,DT,2,0,"button",118),y(24,AT,2,0,"button",119),r(25,"button",120),x("click",function(o){let a=_(t).$implicit;return m(2).openEditModal(a),v(o.stopPropagation())}),l(26,"\u2699\uFE0F"),s(),r(27,"button",121),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.onRemove(o))}),l(28,"\u{1F5D1}\uFE0F"),s()()()}if(i&2){let t=e.$implicit,n=m(2);N("selected",n.selectedIds.has(t.id)),c(2),L("checked",n.selectedIds.has(t.id)),c(2),de(n.getStatusClass(t.status)),c(2),D(t.phone),c(2),ee("background",n.getRoleColor(t.role)+"20")("color",n.getRoleColor(t.role))("border-color",n.getRoleColor(t.role)+"40"),c(),X(" ",n.getRoleIcon(t.role)," ",n.getRoleName(t.role)," "),c(2),D((t.firstName||"")+" "+(t.lastName||"")),c(2),D(t.deviceModel||"-"),c(4),ee("width",t.healthScore||100,"%"),c(2),M("",t.healthScore||100,"%"),c(2),X("",t.dailySendCount||0,"/",t.dailySendLimit||50),c(2),S(n.canLogin(t)?23:-1),c(),S(t.status==="Online"?24:-1)}}function TT(i,e){if(i&1){let t=I();r(0,"div",45)(1,"table",106)(2,"thead")(3,"tr")(4,"th")(5,"input",107),W("ngModelChange",function(o){_(t);let a=m();return q(a.selectAll,o)||(a.selectAll=o),v(o)}),x("change",function(){_(t);let o=m();return v(o.toggleSelectAll())}),s()(),r(6,"th"),l(7,"\u72B6\u6001"),s(),r(8,"th"),l(9,"\u624B\u6A5F\u865F"),s(),r(10,"th"),l(11,"\u89D2\u8272"),s(),r(12,"th"),l(13,"\u540D\u7A31"),s(),r(14,"th"),l(15,"\u8BBE\u5907"),s(),r(16,"th"),l(17,"\u5065\u5EB7\u5EA6"),s(),r(18,"th"),l(19,"\u4ECA\u65E5\u53D1\u9001"),s(),r(20,"th"),l(21,"\u64CD\u4F5C"),s()()(),r(22,"tbody"),O(23,MT,29,23,"tr",108,Jt),s()()()}if(i&2){let t=m();c(5),H("ngModel",t.selectAll),c(18),U(t.filteredAccounts)}}function kT(i,e){if(i&1){let t=I();r(0,"div",46)(1,"div",124),l(2,"\u{1F465}"),s(),r(3,"h3"),l(4),s(),r(5,"p"),l(6),s(),r(7,"button",125),x("click",function(){_(t);let o=m();return v(o.addAccount.emit())}),l(8),s()()}if(i&2){let t=m();c(4),D(t.t("accounts.noAccountsYet")),c(2),D(t.t("accounts.clickToAddFirst")),c(2),M(" \u2795 ",t.t("accounts.addAccount")," ")}}function IT(i,e){i&1&&(r(0,"div",46)(1,"div",124),l(2,"\u{1F50D}"),s(),r(3,"h3"),l(4,"\u6C92\u6709\u627E\u5230\u5339\u914D\u7684\u8D26\u6237"),s(),r(5,"p"),l(6,"\u8ACB\u5617\u8A66\u8ABF\u6574\u641C\u7D22\u689D\u4EF6\u6216\u7BE9\u9078\u5668"),s()())}function FT(i,e){if(i&1){let t=I();r(0,"div",132)(1,"img",163),x("error",function(o){_(t);let a=m(2);return v(a.onAvatarError(o))}),s(),r(2,"div",164),l(3),s()()}if(i&2){let t=m(2);c(),L("src",t.getAvatarUrl(t.selectedAccount().avatarPath),ot),c(2),M(" ",t.getAvatarLetter(t.selectedAccount())," ")}}function PT(i,e){if(i&1&&(r(0,"div",133),l(1),s()),i&2){let t=m(2);c(),M(" ",t.getAvatarLetter(t.selectedAccount())," ")}}function RT(i,e){if(i&1&&(r(0,"div",165),l(1),s()),i&2){let t=m(2);c(),M(" ",t.selectedAccount().nickname," ")}}function NT(i,e){if(i&1&&(r(0,"div",137),l(1),s()),i&2){let t=m(2);c(),D("@"+t.selectedAccount().username)}}function VT(i,e){if(i&1&&(r(0,"div",142),l(1),s()),i&2){let t=m(2);c(),D(t.selectedAccount().bio)}}function BT(i,e){if(i&1&&(r(0,"span",100),l(1),s()),i&2){let t=e;ee("background",t.color),c(),D(t.name)}}function LT(i,e){if(i&1&&y(0,BT,2,3,"span",99),i&2){let t,n=e.$implicit,o=m(3);S((t=o.getTagById(n))?0:-1,t)}}function OT(i,e){if(i&1&&O(0,LT,1,1,null,null,be),i&2){let t=m(2);U(t.selectedAccount().tags)}}function UT(i,e){i&1&&(r(0,"span",153),l(1,"\u7121\u6807\u7B7E"),s())}function GT(i,e){i&1&&l(0," \u6B63\u5728\u9023\u63A5 Telegram \u670D\u52D9\u5668... ")}function $T(i,e){i&1&&l(0," \u7B49\u5F85\u8F38\u5165\u9A57\u8B49\u78BC... ")}function HT(i,e){i&1&&l(0," \u7B49\u5F85\u8F38\u5165\u5169\u6B65\u9A5F\u9A57\u8B49\u5BC6\u78BC... ")}function qT(i,e){if(i&1&&l(0),i&2){let t,n=m(3);M(" ",((t=n.getLoginProgress(n.selectedAccount().id))==null?null:t.step)||"\u8655\u7406\u4E2D..."," ")}}function WT(i,e){if(i&1&&(r(0,"div",155),B(1,"div",101),r(2,"span",166),y(3,GT,1,0)(4,$T,1,0)(5,HT,1,0)(6,qT,1,1),s()()),i&2){let t,n=m(2);c(3),S((t=n.selectedAccount().status)==="Logging in..."?3:t==="Waiting Code"?4:t==="Waiting 2FA"?5:6)}}function zT(i,e){if(i&1){let t=I();r(0,"button",167),x("click",function(){_(t);let o=m(2);return v(o.onLogin(o.selectedAccount()))}),l(1,"\u25B6\uFE0F \u767B\u5165"),s()}}function KT(i,e){i&1&&(r(0,"button",158),l(1,"\u23F3 \u767B\u5165\u4E2D..."),s())}function jT(i,e){if(i&1){let t=I();r(0,"button",168),x("click",function(){_(t);let o=m(2);return v(o.onLogout(o.selectedAccount()))}),l(1,"\u23F9\uFE0F \u9000\u51FA"),s()}}function JT(i,e){if(i&1){let t=I();r(0,"div",126),x("click",function(){_(t);let o=m();return v(o.closeDetail())}),s(),r(1,"div",127)(2,"div",128)(3,"h3"),l(4,"\u8D26\u6237\u8BE6\u60C5"),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closeDetail())}),l(6,"\xD7"),s()(),r(7,"div",130)(8,"div",131),y(9,FT,4,2,"div",132)(10,PT,2,1,"div",133),Es(11,RT,2,1,"div",134),r(12,"div",135),l(13),s(),r(14,"div",136),l(15),s(),y(16,NT,2,1,"div",137),r(17,"div",138),x("click",function(o){_(t);let a=m();return v(a.openRoleSelector(a.selectedAccount(),o))}),r(18,"span",139),l(19),s(),r(20,"span",140),l(21),s(),r(22,"span",141),l(23,"\u9EDE\u64CA\u66F4\u6539"),s()(),y(24,VT,2,1,"div",142),s(),r(25,"div",131)(26,"h4"),l(27,"\u{1F4CA} \u72B6\u6001\u4FE1\u606F"),s(),r(28,"div",143)(29,"div",144)(30,"span",145),l(31,"\u767B\u5165\u72B6\u6001"),s(),r(32,"span",146),l(33),s()(),r(34,"div",144)(35,"span",145),l(36,"\u5065\u5EB7\u5206\u6570"),s(),r(37,"span",147),l(38),s()(),r(39,"div",144)(40,"span",145),l(41,"\u4ECA\u65E5\u53D1\u9001"),s(),r(42,"span",147),l(43),s()(),r(44,"div",144)(45,"span",145),l(46,"\u89D2\u8272"),s(),r(47,"div",148),x("click",function(o){_(t);let a=m();return v(a.openRoleSelector(a.selectedAccount(),o))}),r(48,"span",149),l(49),s(),r(50,"span",150),l(51,"\u270F\uFE0F"),s()()(),r(52,"div",144)(53,"span",145),l(54,"\u5206\u7D44"),s(),r(55,"span",147),l(56),s()(),r(57,"div",151)(58,"span",145),l(59,"\u6807\u7B7E"),s(),r(60,"div",152),y(61,OT,2,0)(62,UT,2,0,"span",153),s()()()(),r(63,"div",131)(64,"h4"),l(65,"\u{1F527} \u8BBE\u5907\u4FE1\u606F"),s(),r(66,"div",143)(67,"div",144)(68,"span",145),l(69,"\u8BBE\u5907\u578B\u865F"),s(),r(70,"span",147),l(71),s()(),r(72,"div",144)(73,"span",145),l(74,"\u7CFB\u7D71\u7248\u672C"),s(),r(75,"span",147),l(76),s()(),r(77,"div",144)(78,"span",145),l(79,"\u5E73\u53F0"),s(),r(80,"span",147),l(81),s()(),r(82,"div",144)(83,"span",145),l(84,"API ID"),s(),r(85,"span",147),l(86),s()()()(),r(87,"div",131)(88,"h4"),l(89,"\u{1F310} \u4EE3\u7406\u8BBE\u7F6E"),s(),r(90,"div",143)(91,"div",154)(92,"span",145),l(93,"\u4EE3\u7406\u5730\u5740"),s(),r(94,"span",147),l(95),s()(),r(96,"div",144)(97,"span",145),l(98,"\u4EE3\u7406\u7C7B\u578B"),s(),r(99,"span",147),l(100),s()(),r(101,"div",144)(102,"span",145),l(103,"\u4EE3\u7406\u56FD\u5BB6"),s(),r(104,"span",147),l(105),s()()()()(),y(106,WT,7,1,"div",155),r(107,"div",156),y(108,zT,2,0,"button",157),y(109,KT,2,0,"button",158),y(110,jT,2,0,"button",159),r(111,"button",160),x("click",function(){_(t);let o=m();return v(o.syncAccountInfo(o.selectedAccount()))}),l(112),s(),r(113,"button",161),x("click",function(){_(t);let o=m();return v(o.openAccountTagEditor(o.selectedAccount()))}),l(114,"\u{1F3F7}\uFE0F \u6807\u7B7E"),s(),r(115,"button",161),x("click",function(){_(t);let o=m();return v(o.openPersonaManager(o.selectedAccount()))}),l(116,"\u{1F916} \u4EBA\u8A2D"),s(),r(117,"button",161),x("click",function(){_(t);let o=m();return v(o.onExport(o.selectedAccount()))}),l(118,"\u{1F4E4} \u5C0E\u51FA"),s(),r(119,"button",161),x("click",function(){_(t);let o=m();return v(o.openEditModal(o.selectedAccount()))}),l(120,"\u270F\uFE0F \u7F16\u8F91"),s(),r(121,"button",162),x("click",function(){_(t);let o=m();return v(o.onRemove(o.selectedAccount()))}),l(122,"\u{1F5D1}\uFE0F \u5220\u9664"),s()()()}if(i&2){let t=m();c(),N("open",t.selectedAccount()),c(8),S(t.isValidAvatarPath(t.selectedAccount().avatarPath)?9:10),c(2),L("ngIf",t.selectedAccount().nickname),c(2),X(" ",t.selectedAccount().firstName||""," ",t.selectedAccount().lastName||""," "),c(2),D(t.selectedAccount().phone),c(),S(t.selectedAccount().username?16:-1),c(2),ee("background",t.getRoleColor(t.selectedAccount().role)+"20")("color",t.getRoleColor(t.selectedAccount().role)),c(),M(" ",t.getRoleIcon(t.selectedAccount().role)," "),c(),ee("color",t.getRoleColor(t.selectedAccount().role)),c(),M(" ",t.getRoleName(t.selectedAccount().role)," "),c(3),S(t.selectedAccount().bio?24:-1),c(8),de(t.getStatusClass(t.selectedAccount().status)),c(),M(" ",t.getStatusText(t.selectedAccount().status)," "),c(5),M("",t.selectedAccount().healthScore||100,"/100"),c(5),X("",t.selectedAccount().dailySendCount||0,"/",t.selectedAccount().dailySendLimit||50),c(5),ee("background",t.getRoleColor(t.selectedAccount().role)+"20")("color",t.getRoleColor(t.selectedAccount().role)),c(),X(" ",t.getRoleIcon(t.selectedAccount().role)," ",t.getRoleName(t.selectedAccount().role)," "),c(7),D(t.selectedAccount().group||"\u672A\u5206\u7D44"),c(5),S(t.selectedAccount().tags&&t.selectedAccount().tags.length>0?61:62),c(10),D(t.selectedAccount().deviceModel||"-"),c(5),D(t.selectedAccount().systemVersion||"-"),c(5),D(t.selectedAccount().platform||"-"),c(5),D(t.selectedAccount().apiId||"-"),c(9),D(t.selectedAccount().proxy||"\u76F4\u9023\uFF08\u7121\u4EE3\u7406\uFF09"),c(5),D(t.selectedAccount().proxyType||"-"),c(5),D(t.selectedAccount().proxyCountry||"-"),c(),S(t.isLoggingIn(t.selectedAccount().id)||t.selectedAccount().status==="Logging in..."||t.selectedAccount().status==="Waiting Code"||t.selectedAccount().status==="Waiting 2FA"?106:-1),c(2),S(t.canLogin(t.selectedAccount())&&!t.isLoggingIn(t.selectedAccount().id)?108:-1),c(),S(t.isLoggingIn(t.selectedAccount().id)||t.selectedAccount().status==="Logging in..."||t.selectedAccount().status==="Waiting Code"||t.selectedAccount().status==="Waiting 2FA"?109:-1),c(),S(t.selectedAccount().status==="Online"?110:-1),c(),L("disabled",t.syncing()),c(),M(" ",t.syncing()?"\u23F3":"\u{1F504}"," \u540C\u6B65 "),c(9),L("disabled",t.isLoggingIn(t.selectedAccount().id))}}function QT(i,e){if(i&1){let t=I();r(0,"div",175)(1,"div",179)(2,"label"),l(3,"\u6635\u79F0"),s(),r(4,"input",180),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.nickname,o)||(a.editForm.nickname=o),v(o)}),s()(),r(5,"div",179)(6,"label"),l(7,"\u5907\u6CE8"),s(),r(8,"textarea",181),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.notes,o)||(a.editForm.notes=o),v(o)}),s()(),r(9,"div",182)(10,"div",179)(11,"label"),l(12,"API ID"),s(),r(13,"input",183),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.apiId,o)||(a.editForm.apiId=o),v(o)}),s()(),r(14,"div",179)(15,"label"),l(16,"API Hash"),s(),r(17,"input",183),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.apiHash,o)||(a.editForm.apiHash=o),v(o)}),s()()(),r(18,"p",184),l(19,"API \u51ED\u8BC1\u7528\u4E8E\u8FDE\u63A5 Telegram\uFF0C\u53EF\u4ECE "),r(20,"a",185),l(21,"my.telegram.org"),s(),l(22," \u83B7\u53D6"),s(),r(23,"div",182)(24,"div",179)(25,"label"),l(26,"\u6BCF\u65E5\u53D1\u9001\u4E0A\u9650"),s(),r(27,"input",186),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.dailySendLimit,o)||(a.editForm.dailySendLimit=o),v(o)}),s()(),r(28,"div",179)(29,"label"),l(30,"\u7FA4\u7D44\u5206\u985E"),s(),r(31,"input",187),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.group,o)||(a.editForm.group=o),v(o)}),s()()(),r(32,"div",179)(33,"label",36)(34,"input",188),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.enableWarmup,o)||(a.editForm.enableWarmup=o),v(o)}),s(),r(35,"span"),l(36,"\u542F\u7528\u9810\u71B1\u6A21\u5F0F"),s()(),r(37,"p",184),l(38,"\u9810\u71B1\u6A21\u5F0F\u6703\u9010\u6B65\u589E\u52A0\u6BCF\u65E5\u53D1\u9001\u91CF\uFF0C\u964D\u4F4E\u5C01\u865F\u98A8\u96AA"),s()()()}if(i&2){let t=m(2);c(4),H("ngModel",t.editForm.nickname),c(4),H("ngModel",t.editForm.notes),c(5),H("ngModel",t.editForm.apiId),c(4),H("ngModel",t.editForm.apiHash),c(10),H("ngModel",t.editForm.dailySendLimit),c(4),H("ngModel",t.editForm.group),c(3),H("ngModel",t.editForm.enableWarmup)}}function YT(i,e){if(i&1&&(r(0,"option",13),l(1),s()),i&2){let t=e.$implicit;L("value",t.id),c(),D(t.name)}}function XT(i,e){if(i&1&&(r(0,"div",207),l(1),s()),i&2){let t=m(4);N("success",t.proxyTestResult().success)("error",!t.proxyTestResult().success),c(),M(" ",t.proxyTestResult().message," ")}}function ZT(i,e){if(i&1){let t=I();r(0,"div",182)(1,"div",190)(2,"label"),l(3,"\u4EE3\u7406\u5730\u5740"),s(),r(4,"input",191),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.proxyHost,o)||(a.editForm.proxyHost=o),v(o)}),s()(),r(5,"div",192)(6,"label"),l(7,"\u7AEF\u53E3"),s(),r(8,"input",193),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.proxyPort,o)||(a.editForm.proxyPort=o),v(o)}),s()()(),r(9,"div",182)(10,"div",179)(11,"label"),l(12,"\u7528\u6236\u540D\uFF08\u53EF\u9078\uFF09"),s(),r(13,"input",194),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.proxyUsername,o)||(a.editForm.proxyUsername=o),v(o)}),s()(),r(14,"div",179)(15,"label"),l(16,"\u5BC6\u78BC\uFF08\u53EF\u9078\uFF09"),s(),r(17,"input",195),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.proxyPassword,o)||(a.editForm.proxyPassword=o),v(o)}),s()()(),r(18,"div",179)(19,"label"),l(20,"\u4EE3\u7406\u56FD\u5BB6/\u5730\u5340"),s(),r(21,"select",189),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.proxyCountry,o)||(a.editForm.proxyCountry=o),v(o)}),r(22,"option",196),l(23,"\u9009\u62E9\u56FD\u5BB6"),s(),r(24,"option",197),l(25,"\u{1F1FA}\u{1F1F8} \u7F8E\u570B"),s(),r(26,"option",198),l(27,"\u{1F1EF}\u{1F1F5} \u65E5\u672C"),s(),r(28,"option",199),l(29,"\u{1F1F8}\u{1F1EC} \u65B0\u52A0\u5761"),s(),r(30,"option",200),l(31,"\u{1F1ED}\u{1F1F0} \u9999\u6E2F"),s(),r(32,"option",201),l(33,"\u{1F1F9}\u{1F1FC} \u53F0\u7063"),s(),r(34,"option",202),l(35,"\u{1F1F0}\u{1F1F7} \u97D3\u570B"),s(),r(36,"option",203),l(37,"\u{1F1E9}\u{1F1EA} \u5FB7\u570B"),s(),r(38,"option",204),l(39,"\u{1F1EC}\u{1F1E7} \u82F1\u570B"),s()()(),r(40,"button",205),x("click",function(){_(t);let o=m(3);return v(o.testProxy())}),l(41),s(),y(42,XT,2,5,"div",206),r(43,"div",179)(44,"label",36)(45,"input",188),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.proxyRotationEnabled,o)||(a.editForm.proxyRotationEnabled=o),v(o)}),s(),r(46,"span"),l(47,"\u542F\u7528\u667A\u80FD\u4EE3\u7406\u8F2A\u63DB"),s()(),r(48,"p",184),l(49,"\u81EA\u52A8\u5207\u63DB\u4EE3\u7406\u4EE5\u907F\u514D IP \u88AB\u5C01"),s()()}if(i&2){let t=m(3);c(4),H("ngModel",t.editForm.proxyHost),c(4),H("ngModel",t.editForm.proxyPort),c(5),H("ngModel",t.editForm.proxyUsername),c(4),H("ngModel",t.editForm.proxyPassword),c(4),H("ngModel",t.editForm.proxyCountry),c(19),L("disabled",t.testingProxy()),c(),M(" ",t.testingProxy()?"\u6D4B\u8BD5\u4E2D...":"\u{1F50D} \u6D4B\u8BD5\u4EE3\u7406\u8FDE\u63A5"," "),c(),S(t.proxyTestResult()?42:-1),c(3),H("ngModel",t.editForm.proxyRotationEnabled)}}function e7(i,e){if(i&1){let t=I();r(0,"div",175)(1,"div",179)(2,"label"),l(3,"\u4EE3\u7406\u7C7B\u578B"),s(),r(4,"select",189),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.proxyType,o)||(a.editForm.proxyType=o),v(o)}),x("ngModelChange",function(){_(t);let o=m(2);return v(o.onProxyTypeChange())}),O(5,YT,2,2,"option",13,Jt),s()(),y(7,ZT,50,9),s()}if(i&2){let t=m(2);c(4),H("ngModel",t.editForm.proxyType),c(),U(t.proxyTypes),c(2),S(t.editForm.proxyType&&t.editForm.proxyType!=="none"?7:-1)}}function t7(i,e){if(i&1){let t=I();r(0,"div",212),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectRole(o.id))}),r(1,"div",72),l(2),s(),r(3,"div",213),l(4),s()()}if(i&2){let t=e.$implicit,n=m(3);N("selected",n.editForm.role===t.id),c(2),D(t.name),c(2),D(t.description)}}function n7(i,e){if(i&1){let t=I();r(0,"div",175)(1,"div",179)(2,"label"),l(3,"\u9009\u62E9\u89D2\u8272\u6A21\u677F"),s(),r(4,"div",208),O(5,t7,5,4,"div",209,Jt),s()(),r(7,"div",179)(8,"label"),l(9,"\u81EA\u5B9A\u7FA9\u89D2\u8272\u540D\u7A31"),s(),r(10,"input",210),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.customRoleName,o)||(a.editForm.customRoleName=o),v(o)}),s()(),r(11,"div",179)(12,"label"),l(13,"\u89D2\u8272\u4EBA\u8A2D\u63CF\u8FF0"),s(),r(14,"textarea",211),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.roleDescription,o)||(a.editForm.roleDescription=o),v(o)}),s()()()}if(i&2){let t=m(2);c(5),U(t.roleTemplates),c(5),H("ngModel",t.editForm.customRoleName),c(4),H("ngModel",t.editForm.roleDescription)}}function i7(i,e){if(i&1&&(r(0,"span",227),l(1),s(),r(2,"span",228),l(3),s()),i&2){let t=e;c(),D(t.icon),c(2),D(t.name)}}function o7(i,e){i&1&&(r(0,"span",216),l(1,"\u70B9\u51FB\u9009\u62E9\u4EBA\u8A2D"),s())}function r7(i,e){if(i&1){let t=I();r(0,"div",179)(1,"label"),l(2,"AI \u4EBA\u8A2D"),s(),r(3,"div",214)(4,"div",215),x("click",function(){_(t);let o=m(3);return v(o.openPersonaManagerFromEdit())}),y(5,i7,4,2)(6,o7,2,0,"span",216),r(7,"span",217),l(8,"\u25BC"),s()(),r(9,"button",218),x("click",function(){_(t);let o=m(3);return v(o.openPersonaManagerFromEdit())}),l(10," \u{1F916} \u4EBA\u8A2D\u5EAB "),s()(),r(11,"p",184),l(12,"\u4EBA\u8A2D\u51B3\u5B9A\u4E86 AI \u7684\u6027\u683C\u548C\u56DE\u590D\u98CE\u683C"),s()(),r(13,"div",179)(14,"label"),l(15,"AI \u6A21\u578B"),s(),r(16,"select",189),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.aiModel,o)||(a.editForm.aiModel=o),v(o)}),r(17,"option",219),l(18,"GPT-4 Turbo\uFF08\u63A8\u85A6\uFF09"),s(),r(19,"option",220),l(20,"GPT-3.5 Turbo\uFF08\u5FEB\u901F\uFF09"),s(),r(21,"option",221),l(22,"Claude 3 Sonnet"),s(),r(23,"option",222),l(24,"\u672C\u5730 Ollama"),s()()(),r(25,"div",182)(26,"div",179)(27,"label"),l(28),s(),r(29,"input",223),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.aiCreativity,o)||(a.editForm.aiCreativity=o),v(o)}),s()(),r(30,"div",179)(31,"label"),l(32,"\u56DE\u590D\u9577\u5EA6"),s(),r(33,"select",189),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.aiResponseLength,o)||(a.editForm.aiResponseLength=o),v(o)}),r(34,"option",224),l(35,"\u7B80\u77ED"),s(),r(36,"option",224),l(37,"\u9069\u4E2D"),s(),r(38,"option",224),l(39,"\u8BE6\u7EC6"),s()()()(),r(40,"div",179)(41,"label",36)(42,"input",188),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.aiAutoReply,o)||(a.editForm.aiAutoReply=o),v(o)}),s(),r(43,"span"),l(44,"\u81EA\u52A8\u53D1\u9001\u56DE\u590D\uFF08\u7121\u9700\u78BA\u8A8D\uFF09"),s()(),r(45,"p",225),l(46,"\u26A0\uFE0F \u542F\u7528\u5F8C AI \u6703\u81EA\u52A8\u53D1\u9001\u56DE\u590D\uFF0C\u8ACB\u78BA\u4FDD\u5DF2\u8BBE\u7F6E\u597D\u4EBA\u8A2D"),s()(),r(47,"div",179)(48,"label"),l(49,"\u7981\u6B62\u56DE\u590D\u5173\u9375\u8A5E"),s(),r(50,"input",226),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.editForm.aiBlockKeywords,o)||(a.editForm.aiBlockKeywords=o),v(o)}),s(),r(51,"p",184),l(52,"\u5305\u542B\u9019\u4E9B\u5173\u9375\u8A5E\u7684\u6D88\u606F\u6703\u6A19\u8A18\u70BA\u5F85\u4EBA\u5DE5\u8655\u7406"),s()()}if(i&2){let t,n=m(3);c(5),S((t=n.editForm.aiPersonality&&n.getPersonaById(n.editForm.aiPersonality))?5:6,t),c(11),H("ngModel",n.editForm.aiModel),c(12),M("\u5275\u9020\u529B ",n.editForm.aiCreativity,"%"),c(),H("ngModel",n.editForm.aiCreativity),c(4),H("ngModel",n.editForm.aiResponseLength),c(),L("ngValue",0),c(2),L("ngValue",50),c(2),L("ngValue",100),c(4),H("ngModel",n.editForm.aiAutoReply),c(8),H("ngModel",n.editForm.aiBlockKeywords)}}function s7(i,e){if(i&1){let t=I();r(0,"div",175)(1,"div",179)(2,"label",36)(3,"input",188),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editForm.aiEnabled,o)||(a.editForm.aiEnabled=o),v(o)}),s(),r(4,"span"),l(5,"\u542F\u7528 AI \u81EA\u52A8\u56DE\u590D"),s()()(),y(6,r7,53,10),s()}if(i&2){let t=m(2);c(3),H("ngModel",t.editForm.aiEnabled),c(3),S(t.editForm.aiEnabled?6:-1)}}function a7(i,e){if(i&1){let t=I();r(0,"div",169),x("click",function(){_(t);let o=m();return v(o.closeEditModal())}),s(),r(1,"div",170)(2,"div",171)(3,"h3"),l(4,"\u270F\uFE0F \u7F16\u8F91\u8D26\u53F7"),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closeEditModal())}),l(6,"\xD7"),s()(),r(7,"div",172)(8,"div",173)(9,"button",174),x("click",function(){_(t);let o=m();return v(o.editTab.set("basic"))}),l(10," \u{1F4CB} \u57FA\u672C\u8BBE\u7F6E "),s(),r(11,"button",174),x("click",function(){_(t);let o=m();return v(o.editTab.set("proxy"))}),l(12," \u{1F310} \u4EE3\u7406\u8BBE\u7F6E "),s(),r(13,"button",174),x("click",function(){_(t);let o=m();return v(o.editTab.set("role"))}),l(14," \u{1F3AD} \u89D2\u8272\u8BBE\u7F6E "),s(),r(15,"button",174),x("click",function(){_(t);let o=m();return v(o.editTab.set("ai"))}),l(16," \u{1F916} AI \u8BBE\u7F6E "),s()(),y(17,QT,39,7,"div",175),y(18,e7,8,2,"div",175),y(19,n7,15,2,"div",175),y(20,s7,7,2,"div",175),s(),r(21,"div",176)(22,"button",177),x("click",function(){_(t);let o=m();return v(o.closeEditModal())}),l(23,"\u53D6\u6D88"),s(),r(24,"button",178),x("click",function(){_(t);let o=m();return v(o.saveEdit())}),l(25),s()()()}if(i&2){let t=m();c(9),N("active",t.editTab()==="basic"),c(2),N("active",t.editTab()==="proxy"),c(2),N("active",t.editTab()==="role"),c(2),N("active",t.editTab()==="ai"),c(2),S(t.editTab()==="basic"?17:-1),c(),S(t.editTab()==="proxy"?18:-1),c(),S(t.editTab()==="role"?19:-1),c(),S(t.editTab()==="ai"?20:-1),c(4),L("disabled",t.saving()),c(),M(" ",t.saving()?"\u4FDD\u5B58\u4E2D...":"\u{1F4BE} \u4FDD\u5B58\u8BBE\u7F6E"," ")}}function l7(i,e){if(i&1&&(r(0,"option",13),l(1),s()),i&2){let t=e.$implicit;L("value",t.id),c(),D(t.name)}}function c7(i,e){if(i&1){let t=I();r(0,"div",233)(1,"div",182)(2,"div",179)(3,"label"),l(4,"\u4EE3\u7406\u7C7B\u578B"),s(),r(5,"select",189),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.proxyType,o)||(a.batchForm.proxyType=o),v(o)}),O(6,l7,2,2,"option",13,Jt),s()(),r(8,"div",190)(9,"label"),l(10,"\u4EE3\u7406\u5730\u5740"),s(),r(11,"input",234),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.proxyHost,o)||(a.batchForm.proxyHost=o),v(o)}),s()(),r(12,"div",179)(13,"label"),l(14,"\u7AEF\u53E3"),s(),r(15,"input",193),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.proxyPort,o)||(a.batchForm.proxyPort=o),v(o)}),s()()(),r(16,"div",182)(17,"div",179)(18,"label"),l(19,"\u7528\u6236\u540D\uFF08\u53EF\u9078\uFF09"),s(),r(20,"input",235),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.proxyUsername,o)||(a.batchForm.proxyUsername=o),v(o)}),s()(),r(21,"div",179)(22,"label"),l(23,"\u5BC6\u78BC\uFF08\u53EF\u9078\uFF09"),s(),r(24,"input",236),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.proxyPassword,o)||(a.batchForm.proxyPassword=o),v(o)}),s()(),r(25,"div",179)(26,"label"),l(27,"\u56FD\u5BB6"),s(),r(28,"select",189),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.proxyCountry,o)||(a.batchForm.proxyCountry=o),v(o)}),r(29,"option",196),l(30,"\u9009\u62E9"),s(),r(31,"option",197),l(32,"\u{1F1FA}\u{1F1F8} \u7F8E\u570B"),s(),r(33,"option",198),l(34,"\u{1F1EF}\u{1F1F5} \u65E5\u672C"),s(),r(35,"option",199),l(36,"\u{1F1F8}\u{1F1EC} \u65B0\u52A0\u5761"),s(),r(37,"option",200),l(38,"\u{1F1ED}\u{1F1F0} \u9999\u6E2F"),s()()()()()}if(i&2){let t=m(2);c(5),H("ngModel",t.batchForm.proxyType),c(),U(t.proxyTypes),c(5),H("ngModel",t.batchForm.proxyHost),c(4),H("ngModel",t.batchForm.proxyPort),c(5),H("ngModel",t.batchForm.proxyUsername),c(4),H("ngModel",t.batchForm.proxyPassword),c(4),H("ngModel",t.batchForm.proxyCountry)}}function d7(i,e){if(i&1&&(r(0,"span",245),l(1,"\u2713"),s()),i&2){let t=m().$implicit;ee("color",t.color)}}function u7(i,e){if(i&1){let t=I();r(0,"div",239),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.batchForm.role=o.id)}),r(1,"span",240),l(2),s(),r(3,"div",241)(4,"div",242),l(5),s(),r(6,"div",243),l(7),s()(),y(8,d7,2,2,"span",244),s()}if(i&2){let t=e.$implicit,n=m(3);ee("border-color",n.batchForm.role===t.id?t.color:"transparent"),N("selected",n.batchForm.role===t.id),c(),ee("background",t.color+"20")("color",t.color),c(),D(t.icon),c(2),ee("color",t.color),c(),D(t.name),c(2),D(t.description),c(),S(n.batchForm.role===t.id?8:-1)}}function m7(i,e){if(i&1&&(r(0,"div",233)(1,"div",237),O(2,u7,9,14,"div",238,Jt),s()()),i&2){let t=m(2);c(2),U(t.assignableRoles)}}function p7(i,e){if(i&1){let t=I();r(0,"div",233)(1,"div",182)(2,"div",179)(3,"label",36)(4,"input",188),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.aiEnabled,o)||(a.batchForm.aiEnabled=o),v(o)}),s(),r(5,"span"),l(6,"\u542F\u7528 AI \u81EA\u52A8\u56DE\u590D"),s()()(),r(7,"div",179)(8,"label"),l(9,"AI \u6A21\u578B"),s(),r(10,"select",189),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.aiModel,o)||(a.batchForm.aiModel=o),v(o)}),r(11,"option",219),l(12,"GPT-4 Turbo"),s(),r(13,"option",220),l(14,"GPT-3.5 Turbo"),s(),r(15,"option",221),l(16,"Claude 3"),s(),r(17,"option",222),l(18,"\u672C\u5730 Ollama"),s()()()()()}if(i&2){let t=m(2);c(4),H("ngModel",t.batchForm.aiEnabled),c(6),H("ngModel",t.batchForm.aiModel)}}function g7(i,e){if(i&1){let t=I();r(0,"div",233)(1,"div",182)(2,"div",179)(3,"label"),l(4,"\u6BCF\u65E5\u53D1\u9001\u4E0A\u9650"),s(),r(5,"input",186),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.dailySendLimit,o)||(a.batchForm.dailySendLimit=o),v(o)}),s()(),r(6,"div",179)(7,"label",36)(8,"input",188),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.enableWarmup,o)||(a.batchForm.enableWarmup=o),v(o)}),s(),r(9,"span"),l(10,"\u542F\u7528\u9810\u71B1\u6A21\u5F0F"),s()()()()()}if(i&2){let t=m(2);c(5),H("ngModel",t.batchForm.dailySendLimit),c(3),H("ngModel",t.batchForm.enableWarmup)}}function h7(i,e){if(i&1){let t=I();r(0,"div",233)(1,"div",179)(2,"label"),l(3,"\u5206\u914D\u5230\u7FA4\u7D44"),s(),r(4,"input",246),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.batchForm.group,o)||(a.batchForm.group=o),v(o)}),s()()()}if(i&2){let t=m(2);c(4),H("ngModel",t.batchForm.group)}}function f7(i,e){if(i&1){let t=I();r(0,"div",169),x("click",function(){_(t);let o=m();return v(o.closeBatchEditModal())}),s(),r(1,"div",229)(2,"div",171)(3,"h3"),l(4),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closeBatchEditModal())}),l(6,"\xD7"),s()(),r(7,"div",172)(8,"div",230),l(9," \u26A0\uFE0F \u4EE5\u4E0B\u52FE\u9009\u7684\u8BBE\u7F6E\u5C06\u5E94\u7528\u5230\u6240\u6709\u9078\u4E2D\u7684\u8D26\u53F7 "),s(),r(10,"div",231)(11,"label",232)(12,"input",188),W("ngModelChange",function(o){_(t);let a=m();return q(a.batchForm.enableProxy,o)||(a.batchForm.enableProxy=o),v(o)}),s(),r(13,"span"),l(14,"\u{1F310} \u4EE3\u7406\u8BBE\u7F6E"),s()(),y(15,c7,39,6,"div",233),s(),r(16,"div",231)(17,"label",232)(18,"input",188),W("ngModelChange",function(o){_(t);let a=m();return q(a.batchForm.enableRole,o)||(a.batchForm.enableRole=o),v(o)}),s(),r(19,"span"),l(20,"\u{1F3AD} \u5E33\u865F\u89D2\u8272\u8A2D\u7F6E"),s()(),y(21,m7,4,0,"div",233),s(),r(22,"div",231)(23,"label",232)(24,"input",188),W("ngModelChange",function(o){_(t);let a=m();return q(a.batchForm.enableAI,o)||(a.batchForm.enableAI=o),v(o)}),s(),r(25,"span"),l(26,"\u{1F916} AI \u8BBE\u7F6E"),s()(),y(27,p7,19,2,"div",233),s(),r(28,"div",231)(29,"label",232)(30,"input",188),W("ngModelChange",function(o){_(t);let a=m();return q(a.batchForm.enableLimit,o)||(a.batchForm.enableLimit=o),v(o)}),s(),r(31,"span"),l(32,"\u{1F4CA} \u53D1\u9001\u9650\u5236"),s()(),y(33,g7,11,2,"div",233),s(),r(34,"div",231)(35,"label",232)(36,"input",188),W("ngModelChange",function(o){_(t);let a=m();return q(a.batchForm.enableGroup,o)||(a.batchForm.enableGroup=o),v(o)}),s(),r(37,"span"),l(38,"\u{1F4C1} \u5206\u7D44\u8BBE\u7F6E"),s()(),y(39,h7,5,1,"div",233),s()(),r(40,"div",176)(41,"button",177),x("click",function(){_(t);let o=m();return v(o.closeBatchEditModal())}),l(42,"\u53D6\u6D88"),s(),r(43,"button",178),x("click",function(){_(t);let o=m();return v(o.applyBatchEdit())}),l(44),s()()()}if(i&2){let t=m();c(4),M("\u2699\uFE0F \u6279\u91CF\u8BBE\u7F6E - \u5DF2\u9078 ",t.selectedIds.size," \u500B\u8D26\u53F7"),c(8),H("ngModel",t.batchForm.enableProxy),c(3),S(t.batchForm.enableProxy?15:-1),c(3),H("ngModel",t.batchForm.enableRole),c(3),S(t.batchForm.enableRole?21:-1),c(3),H("ngModel",t.batchForm.enableAI),c(3),S(t.batchForm.enableAI?27:-1),c(3),H("ngModel",t.batchForm.enableLimit),c(3),S(t.batchForm.enableLimit?33:-1),c(3),H("ngModel",t.batchForm.enableGroup),c(3),S(t.batchForm.enableGroup?39:-1),c(4),L("disabled",t.batchSaving()),c(),M(" ",t.batchSaving()?"\u5E94\u7528\u4E2D...":"\u2713 \u5E94\u7528\u5230 "+t.selectedIds.size+" \u500B\u8D26\u53F7"," ")}}function _7(i,e){if(i&1){let t=I();r(0,"div",253)(1,"span",255),l(2),s(),r(3,"input",256),W("ngModelChange",function(o){let a=_(t).$implicit;return q(a.name,o)||(a.name=o),v(o)}),s(),r(4,"input",257),W("ngModelChange",function(o){let a=_(t).$implicit;return q(a.color,o)||(a.color=o),v(o)}),s(),r(5,"button",258),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteTag(o.id))}),l(6,"\u{1F5D1}\uFE0F"),s()()}if(i&2){let t=e.$implicit;c(),ee("background",t.color),c(),D(t.name),c(),H("ngModel",t.name),c(),H("ngModel",t.color)}}function v7(i,e){i&1&&(r(0,"div",46),l(1,"\u6682\u65E0\u6807\u7B7E\uFF0C\u8ACB\u6DFB\u52A0"),s())}function x7(i,e){if(i&1){let t=I();r(0,"div",169),x("click",function(){_(t);let o=m();return v(o.closeTagManager())}),s(),r(1,"div",247)(2,"div",171)(3,"h3"),l(4,"\u{1F3F7}\uFE0F \u6807\u7B7E\u7BA1\u7406"),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closeTagManager())}),l(6,"\xD7"),s()(),r(7,"div",172)(8,"div",248)(9,"input",249),W("ngModelChange",function(o){_(t);let a=m();return q(a.newTagName,o)||(a.newTagName=o),v(o)}),s(),r(10,"input",250),W("ngModelChange",function(o){_(t);let a=m();return q(a.newTagColor,o)||(a.newTagColor=o),v(o)}),s(),r(11,"button",251),x("click",function(){_(t);let o=m();return v(o.addTag())}),l(12,"\u2795 \u6DFB\u52A0"),s()(),r(13,"div",252),O(14,_7,7,5,"div",253,Jt),y(16,v7,2,0,"div",46),s()(),r(17,"div",176)(18,"button",177),x("click",function(){_(t);let o=m();return v(o.closeTagManager())}),l(19,"\u53D6\u6D88"),s(),r(20,"button",254),x("click",function(){_(t);let o=m();return v(o.saveTags())}),l(21,"\u{1F4BE} \u4FDD\u5B58\u6807\u7B7E"),s()()()}if(i&2){let t=m();c(9),H("ngModel",t.newTagName),c(),H("ngModel",t.newTagColor),c(),L("disabled",!t.newTagName.trim()),c(3),U(t.availableTags()),c(2),S(t.availableTags().length===0?16:-1)}}function C7(i,e){if(i&1){let t=I();r(0,"div",263),B(1,"div",264),r(2,"div",265)(3,"input",266),W("ngModelChange",function(o){let a=_(t).$implicit;return q(a.name,o)||(a.name=o),v(o)}),s(),r(4,"span",267),l(5),s()(),r(6,"input",257),W("ngModelChange",function(o){let a=_(t).$implicit;return q(a.color,o)||(a.color=o),v(o)}),s(),r(7,"button",258),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteGroup(o.id))}),l(8,"\u{1F5D1}\uFE0F"),s()()}if(i&2){let t=e.$implicit,n=m(2);c(),ee("background",t.color||"#6b7280"),c(2),H("ngModel",t.name),c(2),M("",n.getGroupAccountCount(t.id)," \u500B\u8D26\u53F7"),c(),H("ngModel",t.color)}}function b7(i,e){i&1&&(r(0,"div",46),l(1,"\u6682\u65E0\u5206\u7D44\uFF0C\u8ACB\u6DFB\u52A0"),s())}function y7(i,e){if(i&1){let t=I();r(0,"div",169),x("click",function(){_(t);let o=m();return v(o.closeGroupManager())}),s(),r(1,"div",259)(2,"div",171)(3,"h3"),l(4,"\u{1F4C1} \u5206\u7D44\u7BA1\u7406"),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closeGroupManager())}),l(6,"\xD7"),s()(),r(7,"div",172)(8,"div",260)(9,"input",261),W("ngModelChange",function(o){_(t);let a=m();return q(a.newGroupName,o)||(a.newGroupName=o),v(o)}),s(),r(10,"input",250),W("ngModelChange",function(o){_(t);let a=m();return q(a.newGroupColor,o)||(a.newGroupColor=o),v(o)}),s(),r(11,"button",251),x("click",function(){_(t);let o=m();return v(o.addGroup())}),l(12,"\u2795 \u6DFB\u52A0"),s()(),r(13,"div",262),O(14,C7,9,5,"div",263,Jt),y(16,b7,2,0,"div",46),s()(),r(17,"div",176)(18,"button",177),x("click",function(){_(t);let o=m();return v(o.closeGroupManager())}),l(19,"\u53D6\u6D88"),s(),r(20,"button",254),x("click",function(){_(t);let o=m();return v(o.saveGroups())}),l(21,"\u{1F4BE} \u4FDD\u5B58\u5206\u7D44"),s()()()}if(i&2){let t=m();c(9),H("ngModel",t.newGroupName),c(),H("ngModel",t.newGroupColor),c(),L("disabled",!t.newGroupName.trim()),c(3),U(t.groups()),c(2),S(t.groups().length===0?16:-1)}}function S7(i,e){if(i&1){let t=I();r(0,"label",278)(1,"input",35),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleAccountTag(o.id))}),s(),r(2,"span",279),l(3),s()()}if(i&2){let t=e.$implicit,n=m(2);N("selected",n.accountTagsSelection.has(t.id)),c(),L("checked",n.accountTagsSelection.has(t.id)),c(),ee("background",t.color),c(),D(t.name)}}function w7(i,e){i&1&&(r(0,"div",46),l(1," \u6682\u65E0\u6807\u7B7E\uFF0C\u8BF7\u5148\u521B\u5EFA\u6807\u7B7E "),s())}function E7(i,e){if(i&1){let t=I();r(0,"div",169),x("click",function(){_(t);let o=m();return v(o.closeAccountTagEditor())}),s(),r(1,"div",268)(2,"div",171)(3,"h3"),l(4),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closeAccountTagEditor())}),l(6,"\xD7"),s()(),r(7,"div",172)(8,"div",269),O(9,S7,4,6,"label",270,Jt),s(),y(11,w7,2,0,"div",46),r(12,"div",271)(13,"div",272)(14,"input",273),W("ngModelChange",function(o){_(t);let a=m();return q(a.newTagName,o)||(a.newTagName=o),v(o)}),s(),r(15,"input",274),W("ngModelChange",function(o){_(t);let a=m();return q(a.newTagColor,o)||(a.newTagColor=o),v(o)}),s(),r(16,"button",275),x("click",function(){_(t);let o=m();return v(o.quickAddTag())}),l(17,"\u2795 \u6DFB\u52A0"),s()()()(),r(18,"div",176)(19,"button",276),x("click",function(){_(t);let o=m();return v(o.openTagManagerFromEditor())}),l(20,"\u2699\uFE0F \u7BA1\u7406\u6807\u7B7E"),s(),r(21,"div",277)(22,"button",177),x("click",function(){_(t);let o=m();return v(o.closeAccountTagEditor())}),l(23,"\u53D6\u6D88"),s(),r(24,"button",254),x("click",function(){_(t);let o=m();return v(o.saveAccountTags())}),l(25,"\u{1F4BE} \u4FDD\u5B58"),s()()()()}if(i&2){let t,n=m();c(4),M("\u{1F3F7}\uFE0F \u7F16\u8F91\u6807\u7B7E - ",(t=n.editingTagAccount())==null?null:t.phone),c(5),U(n.availableTags()),c(2),S(n.availableTags().length===0?11:-1),c(3),H("ngModel",n.newTagName),c(),H("ngModel",n.newTagColor),c(),L("disabled",!n.newTagName.trim())}}function D7(i,e){if(i&1){let t=I();r(0,"div",286),x("click",function(){_(t);let o=m().$implicit,a=m(3);return v(a.selectPersona(o))}),r(1,"div",287),l(2),s(),r(3,"div",288)(4,"div",289),l(5),s(),r(6,"div",290),l(7),s()(),r(8,"div",291)(9,"span",292),l(10),s(),r(11,"span",292),l(12),s()()()}if(i&2){let t=m().$implicit,n=m(3);N("selected",n.selectedPersonaId()===t.id),c(2),D(t.icon),c(3),D(t.name),c(2),D(t.description),c(3),M("\u5275\u610F: ",t.creativity,"%"),c(2),D(n.getToneName(t.tone))}}function A7(i,e){if(i&1&&y(0,D7,13,7,"div",285),i&2){let t=e.$implicit;S(t.isCustom?-1:0)}}function M7(i,e){if(i&1&&(r(0,"div",282),O(1,A7,1,1,null,null,Jt),s()),i&2){let t=m(2);c(),U(t.availablePersonas())}}function T7(i,e){if(i&1){let t=I();r(0,"div",296),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectPersona(o))}),r(1,"div",287),l(2),s(),r(3,"div",288)(4,"div",289),l(5),s(),r(6,"div",290),l(7),s()(),r(8,"div",297)(9,"button",298),x("click",function(o){let a=_(t).$implicit;return m(3).editPersona(a),v(o.stopPropagation())}),l(10,"\u270F\uFE0F"),s(),r(11,"button",299),x("click",function(o){let a=_(t).$implicit;return m(3).deletePersona(a.id),v(o.stopPropagation())}),l(12,"\u{1F5D1}\uFE0F"),s()()()}if(i&2){let t=e.$implicit,n=m(3);N("selected",n.selectedPersonaId()===t.id),c(2),D(t.icon),c(3),D(t.name),c(2),D(t.description)}}function k7(i,e){i&1&&(r(0,"div",46),l(1,"\u6682\u65E0\u81EA\u5B9A\u7FA9\u4EBA\u8A2D\uFF0C\u70B9\u51FB\u4E0A\u65B9\u6309\u9215\u521B\u5EFA"),s())}function I7(i,e){if(i&1){let t=I();r(0,"div",283)(1,"button",293),x("click",function(){_(t);let o=m(2);return v(o.startNewPersona())}),l(2," \u2795 \u521B\u5EFA\u65B0\u4EBA\u8A2D "),s(),r(3,"div",294),O(4,T7,13,5,"div",295,Jt),y(6,k7,2,0,"div",46),s()()}if(i&2){let t=m(2);c(4),U(t.getCustomPersonas()),c(2),S(t.getCustomPersonas().length===0?6:-1)}}function F7(i,e){if(i&1){let t=I();r(0,"button",254),x("click",function(){_(t);let o=m(2);return v(o.applySelectedPersona())}),l(1),s()}if(i&2){let t,n=m(2);c(),M(" \u2713 \u4F7F\u7528\u300C",(t=n.getPersonaById(n.selectedPersonaId()))==null?null:t.name,"\u300D ")}}function P7(i,e){if(i&1){let t=I();r(0,"div",169),x("click",function(){_(t);let o=m();return v(o.closePersonaManager())}),s(),r(1,"div",280)(2,"div",171)(3,"h3"),l(4,"\u{1F916} AI \u4EBA\u8A2D\u7BA1\u7406"),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closePersonaManager())}),l(6,"\xD7"),s()(),r(7,"div",172)(8,"div",281)(9,"button",109),x("click",function(){_(t);let o=m();return v(o.personaTab.set("templates"))}),l(10," \u{1F4CB} \u6A21\u677F\u5EAB "),s(),r(11,"button",109),x("click",function(){_(t);let o=m();return v(o.personaTab.set("custom"))}),l(12," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),s()(),y(13,M7,3,0,"div",282),y(14,I7,7,1,"div",283),s(),r(15,"div",176)(16,"button",177),x("click",function(){_(t);let o=m();return v(o.closePersonaManager())}),l(17,"\u53D6\u6D88"),s(),y(18,F7,2,1,"button",284),s()()}if(i&2){let t=m();c(9),N("active",t.personaTab()==="templates"),c(2),N("active",t.personaTab()==="custom"),c(2),S(t.personaTab()==="templates"?13:-1),c(),S(t.personaTab()==="custom"?14:-1),c(4),S(t.selectedPersonaId()?18:-1)}}function R7(i,e){if(i&1){let t=I();r(0,"div",169),x("click",function(){_(t);let o=m();return v(o.closePersonaEditor())}),s(),r(1,"div",300)(2,"div",171)(3,"h3"),l(4),s(),r(5,"button",129),x("click",function(){_(t);let o=m();return v(o.closePersonaEditor())}),l(6,"\xD7"),s()(),r(7,"div",172)(8,"div",301)(9,"div",182)(10,"div",302)(11,"label"),l(12,"\u56FE\u6807"),s(),r(13,"input",303),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.icon,o)||(a.personaForm.icon=o),v(o)}),s()(),r(14,"div",190)(15,"label"),l(16,"\u4EBA\u8A2D\u540D\u7A31"),s(),r(17,"input",304),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.name,o)||(a.personaForm.name=o),v(o)}),s()()(),r(18,"div",179)(19,"label"),l(20,"\u7B80\u77ED\u63CF\u8FF0"),s(),r(21,"input",305),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.description,o)||(a.personaForm.description=o),v(o)}),s()(),r(22,"div",179)(23,"label"),l(24,"\u7CFB\u7D71\u63D0\u793A\u8A5E (System Prompt)"),s(),r(25,"textarea",306),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.systemPrompt,o)||(a.personaForm.systemPrompt=o),v(o)}),s(),r(26,"p",184),l(27,"\u9019\u662F AI \u7684\u300C\u6027\u683C\u8BF4\u660E\u4E66\u300D\uFF0C\u51B3\u5B9A\u4E86 AI \u5982\u4F55\u56DE\u5E94\u7528\u6236"),s()(),r(28,"div",179)(29,"label"),l(30,"\u958B\u5834\u767D\uFF08\u53EF\u9078\uFF09"),s(),r(31,"input",307),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.greeting,o)||(a.personaForm.greeting=o),v(o)}),s()(),r(32,"div",182)(33,"div",179)(34,"label"),l(35),s(),r(36,"input",223),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.creativity,o)||(a.personaForm.creativity=o),v(o)}),s(),r(37,"p",184),l(38,"\u8D8A\u9AD8\u8D8A\u6709\u5275\u610F\uFF0C\u8D8A\u4F4E\u8D8A\u7A69\u5B9A"),s()(),r(39,"div",179)(40,"label"),l(41,"\u56DE\u590D\u9577\u5EA6"),s(),r(42,"select",189),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.responseLength,o)||(a.personaForm.responseLength=o),v(o)}),r(43,"option",308),l(44,"\u7B80\u77ED"),s(),r(45,"option",309),l(46,"\u9069\u4E2D"),s(),r(47,"option",310),l(48,"\u8BE6\u7EC6"),s()()()(),r(49,"div",182)(50,"div",179)(51,"label"),l(52,"\u8A9E\u6C23\u98CE\u683C"),s(),r(53,"select",189),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.tone,o)||(a.personaForm.tone=o),v(o)}),r(54,"option",311),l(55,"\u6B63\u5F0F"),s(),r(56,"option",312),l(57,"\u4E13\u4E1A"),s(),r(58,"option",313),l(59,"\u53CB\u5584"),s(),r(60,"option",314),l(61,"\u8F15\u9B06"),s()()(),r(62,"div",179)(63,"label"),l(64,"\u8BED\u8A00"),s(),r(65,"select",189),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.language,o)||(a.personaForm.language=o),v(o)}),r(66,"option",315),l(67,"\u7E41\u4F53\u4E2D\u6587"),s(),r(68,"option",316),l(69,"\u7C21\u9AD4\u4E2D\u6587"),s(),r(70,"option",317),l(71,"English"),s(),r(72,"option",318),l(73,"\u65E5\u672C\u8A9E"),s()()(),r(74,"div",179)(75,"label",36)(76,"input",188),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.enableEmoji,o)||(a.personaForm.enableEmoji=o),v(o)}),s(),r(77,"span"),l(78,"\u4F7F\u7528\u8868\u60C5\u7B26\u53F7"),s()()()(),r(79,"div",179)(80,"label"),l(81,"\u5C4F\u853D\u5173\u9375\u8A5E\uFF08\u4E00\u884C\u4E00\u500B\uFF09"),s(),r(82,"textarea",319),W("ngModelChange",function(o){_(t);let a=m();return q(a.personaForm.blockKeywordsText,o)||(a.personaForm.blockKeywordsText=o),v(o)}),s()()()(),r(83,"div",176)(84,"button",177),x("click",function(){_(t);let o=m();return v(o.closePersonaEditor())}),l(85,"\u53D6\u6D88"),s(),r(86,"button",178),x("click",function(){_(t);let o=m();return v(o.savePersona())}),l(87," \u{1F4BE} \u4FDD\u5B58\u4EBA\u8A2D "),s()()()}if(i&2){let t,n=m();c(4),D((t=n.editingPersona())!=null&&t.id?"\u270F\uFE0F \u7F16\u8F91\u4EBA\u8A2D":"\u2795 \u521B\u5EFA\u4EBA\u8A2D"),c(9),H("ngModel",n.personaForm.icon),c(4),H("ngModel",n.personaForm.name),c(4),H("ngModel",n.personaForm.description),c(4),H("ngModel",n.personaForm.systemPrompt),c(6),H("ngModel",n.personaForm.greeting),c(4),M("\u5275\u9020\u529B ",n.personaForm.creativity,"%"),c(),H("ngModel",n.personaForm.creativity),c(6),H("ngModel",n.personaForm.responseLength),c(11),H("ngModel",n.personaForm.tone),c(12),H("ngModel",n.personaForm.language),c(11),H("ngModel",n.personaForm.enableEmoji),c(6),H("ngModel",n.personaForm.blockKeywordsText),c(4),L("disabled",!n.personaForm.name||!n.personaForm.systemPrompt)}}function N7(i,e){i&1&&(r(0,"span",334),l(1,"\u2713"),s())}function V7(i,e){if(i&1){let t=I();r(0,"div",329),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.changeAccountRole(o.id))}),r(1,"span",330),l(2),s(),r(3,"div",331)(4,"span",332),l(5),s(),r(6,"span",333),l(7),s()(),y(8,N7,2,0,"span",334),s()}if(i&2){let t,n,o=e.$implicit,a=m(2);N("active",((t=a.roleSelectorAccount())==null?null:t.role)===o.id),c(),ee("background",o.color+"20")("color",o.color),c(),D(o.icon),c(3),D(o.name),c(2),D(o.description),c(),S(((n=a.roleSelectorAccount())==null?null:n.role)===o.id?8:-1)}}function B7(i,e){if(i&1){let t=I();r(0,"div",320),x("click",function(){_(t);let o=m();return v(o.closeRoleSelector())}),s(),r(1,"div",321)(2,"div",322)(3,"span",323),l(4,"\u9078\u64C7\u89D2\u8272"),s(),r(5,"span",324),l(6),s()(),r(7,"div",325),O(8,V7,9,10,"div",326,Jt),s(),r(10,"div",327)(11,"button",328),x("click",function(){_(t);let o=m();return v(o.closeRoleSelector())}),l(12,"\u53D6\u6D88"),s()()()}if(i&2){let t,n=m();c(),ee("top",n.roleSelectorPosition().top,"px")("left",n.roleSelectorPosition().left,"px"),c(5),D((t=n.roleSelectorAccount())==null?null:t.phone),c(2),U(n.assignableRoles)}}var Sm=[{id:"Listener",name:"\u76E3\u63A7\u865F",icon:"\u{1F441}\uFE0F",color:"#22c55e",description:"\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\uFF0C\u6355\u7372\u6F5B\u5728\u5BA2\u6236",features:["\u7FA4\u7D44\u76E3\u63A7","\u95DC\u9375\u8A5E\u5339\u914D","Lead \u6355\u7372"],priority:1},{id:"Sender",name:"\u767C\u9001\u865F",icon:"\u{1F4E4}",color:"#3b82f6",description:"\u767C\u9001\u6D88\u606F\u7D66\u6F5B\u5728\u5BA2\u6236",features:["\u6D88\u606F\u767C\u9001","\u81EA\u52D5\u56DE\u8986","\u5EE3\u544A\u7FA4\u767C","\u79C1\u804A\u8DDF\u9032"],priority:2},{id:"Explorer",name:"\u63A2\u7D22\u865F",icon:"\u{1F50D}",color:"#f59e0b",description:"\u767C\u73FE\u65B0\u8CC7\u6E90\uFF0C\u52A0\u5165\u7FA4\u7D44",features:["\u8CC7\u6E90\u641C\u7D22","\u7FA4\u7D44\u52A0\u5165","\u6210\u54E1\u63D0\u53D6","\u93C8\u63A5\u5206\u6790"],priority:3},{id:"AI",name:"AI\u865F",icon:"\u{1F916}",color:"#8b5cf6",description:"AI \u81EA\u52D5\u804A\u5929\u548C\u667A\u80FD\u56DE\u8986",features:["AI \u81EA\u52D5\u804A\u5929","\u667A\u80FD\u56DE\u8986","\u610F\u5716\u5206\u6790"],priority:4},{id:"Backup",name:"\u5099\u7528\u865F",icon:"\u26A1",color:"#06b6d4",description:"\u8CA0\u8F09\u5747\u8861\u548C\u6545\u969C\u5099\u63F4",features:["\u8CA0\u8F09\u5747\u8861","\u6545\u969C\u5099\u63F4","\u6279\u91CF\u64CD\u4F5C"],priority:5},{id:"Unassigned",name:"\u672A\u5206\u914D",icon:"\u2B55",color:"#94a3b8",description:"\u65B0\u5E33\u865F\uFF0C\u7B49\u5F85\u5206\u914D\u89D2\u8272",features:[],priority:99}];function bc(i){return Sm.find(e=>e.id===i)||Sm.find(e=>e.id==="Unassigned")}function L7(i){return bc(i).name}function O7(i){return bc(i).icon}function U7(i){return bc(i).color}function G7(){return Sm.filter(i=>i.id!=="Unassigned")}var a1=[{id:"vip",name:"VIP",color:"#f59e0b"},{id:"active",name:"\u6D3B\u8DC3",color:"#10b981"},{id:"new",name:"\u65B0\u53F7",color:"#3b82f6"},{id:"stable",name:"\u7A33\u5B9A",color:"#8b5cf6"},{id:"test",name:"\u6D4B\u8BD5",color:"#6b7280"},{id:"priority",name:"\u4F18\u5148",color:"#ef4444"}],$7=[{id:"sales",name:"\u{1F6D2} \u9500\u552E\u8FBE\u4EBA",description:"\u79EF\u6781\u3001\u5584\u4E8E\u5F15\u5BFC\u8D2D\u4E70"},{id:"support",name:"\u{1F4AC} \u5BA2\u670D\u4E13\u5458",description:"\u8010\u5FC3\u3001\u4E13\u4E1A\u3001\u89E3\u51B3\u95EE\u9898"},{id:"expert",name:"\u{1F393} \u884C\u4E1A\u4E13\u5BB6",description:"\u4E13\u4E1A\u3001\u6743\u5A01\u3001\u6DF1\u5EA6\u5206\u6790"},{id:"friendly",name:"\u{1F60A} \u4EB2\u548C\u52A9\u624B",description:"\u8F7B\u677E\u3001\u53CB\u5584\u3001\u95F2\u804A\u5F0F"},{id:"efficient",name:"\u{1F916} \u6548\u7387\u52A9\u624B",description:"\u7B80\u6D01\u3001\u76F4\u63A5\u3001\u5FEB\u901F\u54CD\u5E94"}],l1=[{id:"sales_expert",name:"\u92B7\u552E\u5C08\u5BB6",icon:"\u{1F4BC}",description:"\u4E13\u4E1A\u92B7\u552E\u9867\u554F\uFF0C\u5584\u65BC\u6316\u6398\u9700\u6C42\u3001\u63A8\u85A6\u7522\u54C1\u3001\u4FC3\u6210\u4EA4\u6613",systemPrompt:`\u4F60\u662F\u4E00\u4F4D\u7D93\u9A57\u8C50\u5BCC\u7684\u92B7\u552E\u5C08\u5BB6\u3002\u4F60\u7684\u76EE\u6A19\u662F\uFF1A
1. \u53CB\u597D\u5730\u8207\u5BA2\u6236\u5EFA\u7ACB\u4FE1\u4EFB\u5173\u4FC2
2. \u901A\u904E\u63D0\u554F\u4E86\u89E3\u5BA2\u6236\u7684\u771F\u5BE6\u9700\u6C42
3. \u6839\u64DA\u9700\u6C42\u63A8\u85A6\u5408\u9069\u7684\u7522\u54C1\u6216\u670D\u52D9
4. \u89E3\u7B54\u7591\u616E\uFF0C\u8655\u7406\u7570\u8B70
5. \u9069\u6642\u5F15\u5C0E\u5B8C\u6210\u8CFC\u8CB7\u6C7A\u7B56

\u6E9D\u901A\u98CE\u683C\uFF1A\u4E13\u4E1A\u4F46\u4E0D\u751F\u786C\uFF0C\u71B1\u60C5\u4F46\u4E0D\u904E\u5EA6\u63A8\u92B7\uFF0C\u5584\u65BC\u50BE\u807D\u548C\u56DE\u61C9\u3002`,greeting:"\u60A8\u597D\uFF01\u5F88\u9AD8\u8208\u70BA\u60A8\u670D\u52D9\uFF0C\u8ACB\u554F\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u60A8\u7684\u55CE\uFF1F",creativity:60,responseLength:"medium",tone:"professional",language:"zh-TW",enableEmoji:!0,blockKeywords:[]},{id:"customer_service",name:"\u5BA2\u670D\u5C08\u54E1",icon:"\u{1F3A7}",description:"\u8010\u5FC3\u7D30\u7DFB\u7684\u5BA2\u670D\u4EBA\u54E1\uFF0C\u5C08\u6CE8\u65BC\u89E3\u6C7A\u554F\u984C\u548C\u63D0\u4F9B\u5E6B\u52A9",systemPrompt:`\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u5BA2\u670D\u5C08\u54E1\u3002\u4F60\u7684\u8077\u8CAC\u662F\uFF1A
1. \u8010\u5FC3\u50BE\u807D\u5BA2\u6236\u7684\u554F\u984C\u548C\u8A34\u6C42
2. \u6E96\u78BA\u7406\u89E3\u554F\u984C\u7684\u6838\u5FC3
3. \u63D0\u4F9B\u6E05\u6670\u3001\u5BE6\u7528\u7684\u89E3\u6C7A\u65B9\u6848
4. \u78BA\u8A8D\u554F\u984C\u662F\u5426\u89E3\u6C7A
5. \u4FDD\u6301\u79AE\u8C8C\u548C\u4E13\u4E1A

\u6E9D\u901A\u539F\u5247\uFF1A\u59CB\u7D42\u4FDD\u6301\u8010\u5FC3\uFF0C\u4E0D\u63A8\u8AC9\u8CAC\u4EFB\uFF0C\u7A4D\u6975\u89E3\u6C7A\u554F\u984C\u3002`,greeting:"\u60A8\u597D\uFF0C\u6211\u662F\u5BA2\u670D\u5C08\u54E1\uFF0C\u8ACB\u554F\u9047\u5230\u4E86\u4EC0\u9EBC\u554F\u984C\uFF1F",creativity:40,responseLength:"medium",tone:"friendly",language:"zh-TW",enableEmoji:!0,blockKeywords:[]},{id:"tech_consultant",name:"\u6280\u8853\u9867\u554F",icon:"\u{1F527}",description:"\u4E13\u4E1A\u6280\u8853\u80CC\u666F\uFF0C\u64C5\u9577\u89E3\u91CB\u8907\u96DC\u6982\u5FF5\u548C\u63D0\u4F9B\u6280\u8853\u5EFA\u8B70",systemPrompt:`\u4F60\u662F\u4E00\u4F4D\u8CC7\u6DF1\u6280\u8853\u9867\u554F\u3002\u4F60\u7684\u7279\u9EDE\u662F\uFF1A
1. \u64C1\u6709\u6DF1\u539A\u7684\u6280\u8853\u80CC\u666F
2. \u80FD\u5C06\u8907\u96DC\u6982\u5FF5\u7528\u7C21\u55AE\u6613\u61C2\u7684\u65B9\u5F0F\u89E3\u91CB
3. \u63D0\u4F9B\u4E13\u4E1A\u3001\u53EF\u884C\u7684\u6280\u8853\u5EFA\u8B70
4. \u5E6B\u52A9\u8A55\u4F30\u6280\u8853\u65B9\u6848\u7684\u512A\u7F3A\u9EDE
5. \u4FDD\u6301\u5BA2\u89C0\u3001\u7406\u6027\u7684\u5206\u6790\u614B\u5EA6

\u6E9D\u901A\u98CE\u683C\uFF1A\u4E13\u4E1A\u3001\u56B4\u8B39\u3001\u6709\u689D\u7406\uFF0C\u907F\u514D\u4F7F\u7528\u904E\u591A\u8853\u8A9E\u3002`,greeting:"\u60A8\u597D\uFF0C\u6211\u662F\u6280\u8853\u9867\u554F\uFF0C\u6709\u4EC0\u9EBC\u6280\u8853\u554F\u984C\u9700\u8981\u8A0E\u8AD6\u55CE\uFF1F",creativity:50,responseLength:"long",tone:"professional",language:"zh-TW",enableEmoji:!1,blockKeywords:[]},{id:"social_butterfly",name:"\u793E\u4EA4\u9054\u4EBA",icon:"\u{1F98B}",description:"\u6D3B\u6F51\u958B\u6717\uFF0C\u64C5\u9577\u65E5\u5E38\u9592\u804A\u548C\u7DAD\u8B77\u793E\u4EA4\u5173\u4FC2",systemPrompt:`\u4F60\u662F\u4E00\u500B\u6D3B\u6F51\u958B\u6717\u7684\u793E\u4EA4\u9054\u4EBA\u3002\u4F60\u7684\u7279\u9EDE\u662F\uFF1A
1. \u6027\u683C\u958B\u6717\uFF0C\u5BB9\u6613\u89AA\u8FD1
2. \u5584\u65BC\u627E\u8A71\u984C\uFF0C\u7DAD\u6301\u8F15\u9B06\u6109\u5FEB\u7684\u6C23\u6C1B
3. \u8A18\u4F4F\u5C0D\u65B9\u8AAA\u904E\u7684\u4E8B\u60C5\uFF0C\u8868\u73FE\u51FA\u5173\u5FC3
4. \u9069\u6642\u5206\u4EAB\u6709\u8DA3\u7684\u898B\u805E
5. \u8B93\u5C0D\u65B9\u611F\u5230\u88AB\u91CD\u8996\u548C\u6B23\u8CDE

\u6E9D\u901A\u98CE\u683C\uFF1A\u8F15\u9B06\u3001\u81EA\u7136\u3001\u771F\u8AA0\uFF0C\u50CF\u670B\u53CB\u4E00\u6A23\u4EA4\u6D41\u3002`,greeting:"\u55E8\uFF01\u6700\u8FD1\u600E\u9EBC\u6A23\uFF1F\u6709\u4EC0\u9EBC\u65B0\u9BAE\u4E8B\u55CE\uFF1F\u{1F60A}",creativity:80,responseLength:"short",tone:"casual",language:"zh-TW",enableEmoji:!0,blockKeywords:[]},{id:"marketing_expert",name:"\u71DF\u92B7\u7B56\u5283",icon:"\u{1F4E2}",description:"\u5275\u610F\u5341\u8DB3\u7684\u71DF\u92B7\u5C08\u5BB6\uFF0C\u64C5\u9577\u63A8\u5EE3\u548C\u54C1\u724C\u5EFA\u8A2D",systemPrompt:`\u4F60\u662F\u4E00\u4F4D\u5275\u610F\u71DF\u92B7\u5C08\u5BB6\u3002\u4F60\u64C5\u9577\uFF1A
1. \u7B56\u5283\u5438\u5F15\u4EBA\u7684\u71DF\u92B7\u6D3B\u52D5
2. \u64B0\u5BEB\u6709\u5438\u5F15\u529B\u7684\u6587\u6848
3. \u5206\u6790\u76EE\u6A19\u53D7\u773E\u7684\u9700\u6C42
4. \u63D0\u4F9B\u54C1\u724C\u5B9A\u4F4D\u5EFA\u8B70
5. \u7D50\u5408\u71B1\u9EDE\u5275\u9020\u8A71\u984C

\u6E9D\u901A\u98CE\u683C\uFF1A\u6709\u5275\u610F\u3001\u6709\u611F\u67D3\u529B\u3001\u5584\u65BC\u8B1B\u6545\u4E8B\u3002`,greeting:"\u55E8\uFF01\u6E96\u5099\u597D\u8B93\u60A8\u7684\u54C1\u724C\u812B\u7A4E\u800C\u51FA\u4E86\u55CE\uFF1F",creativity:85,responseLength:"medium",tone:"friendly",language:"zh-TW",enableEmoji:!0,blockKeywords:[]},{id:"financial_advisor",name:"\u7406\u8CA1\u9867\u554F",icon:"\u{1F4B0}",description:"\u4E13\u4E1A\u7406\u8CA1\u5EFA\u8B70\uFF0C\u5E6B\u52A9\u5236\u5B9A\u8CA1\u52D9\u898F\u5283",systemPrompt:`\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u7406\u8CA1\u9867\u554F\u3002\u4F60\u7684\u8077\u8CAC\u662F\uFF1A
1. \u4E86\u89E3\u5BA2\u6236\u7684\u8CA1\u52D9\u72C0\u6CC1\u548C\u76EE\u6A19
2. \u63D0\u4F9B\u4E13\u4E1A\u7684\u7406\u8CA1\u5EFA\u8B70
3. \u89E3\u91CB\u5404\u7A2E\u91D1\u878D\u7522\u54C1\u7684\u7279\u9EDE
4. \u5E6B\u52A9\u8A55\u4F30\u98A8\u96AA\u548C\u6536\u76CA
5. \u5236\u5B9A\u5408\u7406\u7684\u8CA1\u52D9\u898F\u5283

\u6CE8\u610F\uFF1A\u4E0D\u63D0\u4F9B\u5177\u9AD4\u6295\u8CC7\u5EFA\u8B70\uFF0C\u5F37\u8ABF\u98A8\u96AA\u610F\u8B58\u3002`,greeting:"\u60A8\u597D\uFF0C\u6211\u662F\u7406\u8CA1\u9867\u554F\uFF0C\u6709\u4EC0\u9EBC\u8CA1\u52D9\u898F\u5283\u7684\u554F\u984C\u55CE\uFF1F",creativity:30,responseLength:"long",tone:"formal",language:"zh-TW",enableEmoji:!1,blockKeywords:["\u4FDD\u8B49\u6536\u76CA","\u7A69\u8CFA\u4E0D\u8CE0"]},{id:"health_coach",name:"\u5065\u5EB7\u6559\u7DF4",icon:"\u{1F4AA}",description:"\u5065\u5EB7\u751F\u6D3B\u65B9\u5F0F\u7684\u5021\u5C0E\u8005\uFF0C\u63D0\u4F9B\u5065\u8EAB\u548C\u98F2\u98DF\u5EFA\u8B70",systemPrompt:`\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u5065\u5EB7\u6559\u7DF4\u3002\u4F60\u5C08\u6CE8\u65BC\uFF1A
1. \u63D0\u4F9B\u79D1\u5B78\u7684\u5065\u8EAB\u5EFA\u8B70
2. \u5236\u5B9A\u5408\u7406\u7684\u904B\u52D5\u8A08\u5283
3. \u7D66\u51FA\u5065\u5EB7\u98F2\u98DF\u7684\u6307\u5C0E
4. \u9F13\u52F5\u548C\u6FC0\u52F5\u5BA2\u6236\u5805\u6301
5. \u5206\u4EAB\u5065\u5EB7\u751F\u6D3B\u7684\u77E5\u8B58

\u6E9D\u901A\u98CE\u683C\uFF1A\u7A4D\u6975\u3001\u9F13\u52F5\u3001\u5145\u6EFF\u6B63\u80FD\u91CF\u3002`,greeting:"\u55E8\uFF01\u6E96\u5099\u597D\u958B\u59CB\u5065\u5EB7\u751F\u6D3B\u4E86\u55CE\uFF1F\u{1F4AA}",creativity:60,responseLength:"medium",tone:"friendly",language:"zh-TW",enableEmoji:!0,blockKeywords:[]},{id:"educator",name:"\u77E5\u8B58\u5C0E\u5E2B",icon:"\u{1F4DA}",description:"\u8010\u5FC3\u7684\u6559\u80B2\u8005\uFF0C\u5584\u65BC\u89E3\u91CB\u548C\u50B3\u6388\u77E5\u8B58",systemPrompt:`\u4F60\u662F\u4E00\u4F4D\u8010\u5FC3\u7684\u77E5\u8B58\u5C0E\u5E2B\u3002\u4F60\u7684\u7279\u9EDE\u662F\uFF1A
1. \u5584\u65BC\u5C06\u8907\u96DC\u77E5\u8B58\u7C21\u5316
2. \u4F7F\u7528\u4F8B\u5B50\u548C\u6BD4\u55BB\u5E6B\u52A9\u7406\u89E3
3. \u9F13\u52F5\u63D0\u554F\uFF0C\u8010\u5FC3\u89E3\u7B54
4. \u6839\u64DA\u5C0D\u65B9\u6C34\u5E73\u8ABF\u6574\u8B1B\u89E3\u65B9\u5F0F
5. \u6FC0\u767C\u5B78\u7FD2\u8208\u8DA3

\u6E9D\u901A\u98CE\u683C\uFF1A\u8010\u5FC3\u3001\u5FAA\u5E8F\u6F38\u9032\u3001\u5584\u65BC\u5F15\u5C0E\u3002`,greeting:"\u4F60\u597D\uFF01\u4ECA\u5929\u60F3\u5B78\u7FD2\u4EC0\u9EBC\u5462\uFF1F",creativity:55,responseLength:"long",tone:"friendly",language:"zh-TW",enableEmoji:!0,blockKeywords:[]}],H7=[{id:"none",name:"\u76F4\u9023\uFF08\u7121\u4EE3\u7406\uFF09"},{id:"socks5",name:"SOCKS5"},{id:"http",name:"HTTP/HTTPS"},{id:"mtproto",name:"MTProto"}],Cc=class i{constructor(){this.ipcService=F(Q);this.toast=F(J);this.i18n=F(Be);this.ipcChannels=[];this.accounts=[];this.addAccount=new qe;this.accountSelected=new qe;this.accountLogin=new qe;this.accountLogout=new qe;this.accountRemove=new qe;this.accountExport=new qe;this.accountEdit=new qe;this.accountUpdated=new qe;this.viewMode=f("card");this.searchQuery="";this.statusFilter="all";this.selectedAccount=f(null);this.selectedIds=new Set;this.selectAll=!1;this.showEditModal=f(!1);this.editTab=f("basic");this.editingAccount=f(null);this.saving=f(!1);this.testingProxy=f(!1);this.proxyTestResult=f(null);this.syncing=f(!1);this.showBatchEditModal=f(!1);this.batchSaving=f(!1);this.batchSyncing=f(!1);this.batchLoggingIn=f(!1);this.batchLoggingOut=f(!1);this.loggingInAccounts=f(new Set);this.loginProgress=f(new Map);this.showTagFilter=f(!1);this.showTagManager=f(!1);this.showGroupManager=f(!1);this.showAccountTagEditor=f(!1);this.editingTagAccount=f(null);this.availableTags=f([...a1]);this.groups=f([]);this.groupFilter="all";this.tagFilter=[];this.accountTagsSelection=new Set;this.newTagName="";this.newTagColor="#3b82f6";this.newGroupName="";this.newGroupColor="#6b7280";this.showPersonaManager=f(!1);this.showPersonaEditor=f(!1);this.personaTab=f("templates");this.selectedPersonaId=f(null);this.editingPersona=f(null);this.availablePersonas=f([...l1]);this.applyPersonaToAccount=f(null);this.showRoleSelector=f(!1);this.roleSelectorAccount=f(null);this.roleSelectorPosition=f({top:0,left:0});this.assignableRoles=G7();this.personaForm=this.getDefaultPersonaForm();this.batchForm=this.getDefaultBatchForm();this.roleTemplates=$7;this.proxyTypes=H7;this.editForm=this.getDefaultEditForm()}t(e){return this.i18n.t(e)}get filteredAccounts(){let e=this.accounts;if(this.searchQuery){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.phone.toLowerCase().includes(t)||n.firstName?.toLowerCase().includes(t)||n.lastName?.toLowerCase().includes(t)||n.username?.toLowerCase().includes(t)||n.nickname?.toLowerCase().includes(t))}return this.statusFilter!=="all"&&(e=e.filter(t=>t.status===this.statusFilter)),this.groupFilter!=="all"&&(this.groupFilter==="_ungrouped"?e=e.filter(t=>!t.group):e=e.filter(t=>t.group===this.groupFilter)),this.tagFilter.length>0&&(e=e.filter(t=>t.tags&&this.tagFilter.some(n=>t.tags.includes(n)))),e}get onlineCount(){return this.accounts.filter(e=>e.status==="Online").length}get offlineCount(){return this.accounts.filter(e=>e.status==="Offline").length}get bannedCount(){return this.accounts.filter(e=>e.status==="Banned").length}ngOnInit(){this.loadTagsAndGroups(),this.loadPersonas(),this.setupLoginStatusListeners()}ngOnChanges(e){if(e.accounts&&!e.accounts.firstChange){let t=e.accounts.currentValue;this.loggingInAccounts().forEach(o=>{let a=t.find(d=>d.id===o);a&&(["Logging in...","Waiting Code","Waiting 2FA"].includes(a.status)||this.onLoginComplete(o))})}}ngOnDestroy(){this.ipcChannels.forEach(e=>{this.ipcService.cleanup(e)})}setupLoginStatusListeners(){this.ipcService.on("account-login-error",e=>{e.accountId&&this.onLoginComplete(e.accountId)}),this.ipcChannels.push("account-login-error"),this.ipcService.on("login-success",e=>{e.accountId&&this.onLoginComplete(e.accountId)}),this.ipcChannels.push("login-success")}loadTagsAndGroups(){this.ipcService.once("get-tags-result",e=>{e.success&&e.tags&&this.availableTags.set(e.tags.length>0?e.tags:[...a1])}),this.ipcService.send("get-tags",{}),this.ipcService.once("get-groups-result",e=>{e.success&&e.groups&&this.groups.set(e.groups)}),this.ipcService.send("get-groups",{})}getAvatarLetter(e){return e.nickname?e.nickname.charAt(0).toUpperCase():e.firstName?e.firstName.charAt(0).toUpperCase():e.phone?e.phone.replace("+","").charAt(0):"?"}getDisplayName(e){return e.nickname?e.nickname:`${e.firstName||""} ${e.lastName||""}`.trim()||e.phone}getStatusClass(e){switch(e){case"Online":return"online";case"Offline":return"offline";case"Banned":return"banned";case"Warming Up":case"Cooldown":return"warning";default:return"offline"}}getStatusText(e){switch(e){case"Online":return"\u5728\u7EBF";case"Offline":return"\u79BB\u7EBF";case"Banned":return"\u5C01\u7981";case"Warming Up":return"\u9884\u70ED\u4E2D";case"Cooldown":return"\u51B7\u5374\u4E2D";case"Proxy Error":return"\u4EE3\u7406\u9519\u8BEF";default:return e}}getDeviceIcon(e){switch(e){case"ios":return"\u{1F4F1}";case"android":return"\u{1F916}";case"desktop":return"\u{1F4BB}";default:return"\u{1F4F1}"}}getAvatarUrl(e){return e?"local-file://"+e:""}onAvatarError(e){let t=e.target;if(t){t.style.display="none";let n=t.parentElement;if(n){let o=n.querySelector(".avatar-fallback");o&&(o.style.display="flex")}}}isValidAvatarPath(e){return!!e&&e.length>0&&!e.includes("undefined")}selectAccount(e){this.selectedAccount.set(e),this.accountSelected.emit(e)}closeDetail(){this.selectedAccount.set(null)}toggleSelect(e){this.selectedIds.has(e)?this.selectedIds.delete(e):this.selectedIds.add(e)}getRoleConfig(e){return bc(e||"Unassigned")}getRoleName(e){return L7(e||"Unassigned")}getRoleIcon(e){return O7(e||"Unassigned")}getRoleColor(e){return U7(e||"Unassigned")}openRoleSelector(e,t){t.stopPropagation();let o=t.target.getBoundingClientRect();this.roleSelectorAccount.set(e),this.roleSelectorPosition.set({top:o.bottom+8,left:Math.min(o.left,window.innerWidth-280)}),this.showRoleSelector.set(!0)}closeRoleSelector(){this.showRoleSelector.set(!1),this.roleSelectorAccount.set(null)}changeAccountRole(e){let t=this.roleSelectorAccount();if(!t)return;this.ipcService.send("update-account",{id:t.id,phone:t.phone,role:e});let n=this.accounts.findIndex(o=>o.id===t.id);n>=0&&(this.accounts[n]=P(E({},this.accounts[n]),{role:e})),this.selectedAccount()?.id===t.id&&this.selectedAccount.set(P(E({},t),{role:e})),this.toast.success(`\u5DF2\u5C07 ${t.phone} \u8A2D\u70BA\u300C${this.getRoleName(e)}\u300D`),this.closeRoleSelector()}onLogin(e){let t=new Set(this.loggingInAccounts());t.add(e.id),this.loggingInAccounts.set(t);let n=new Map(this.loginProgress());n.set(e.id,{step:"\u6B63\u5728\u9023\u63A5...",progress:10}),this.loginProgress.set(n),this.accountLogin.emit(e)}canLogin(e){let t=["Offline","Banned","Error","error","Proxy Error","Session Expired","Auth Error"],n=e.status!=="Online",o=!["Logging in...","Waiting Code","Waiting 2FA"].includes(e.status),a=t.includes(e.status)||e.status.toLowerCase().includes("error")||e.status.toLowerCase().includes("offline");return n&&o&&a}isLoggingIn(e){return this.loggingInAccounts().has(e)}getLoginProgress(e){return this.loginProgress().get(e)||null}updateLoginProgress(e,t,n){let o=new Map(this.loginProgress());o.set(e,{step:t,progress:n}),this.loginProgress.set(o)}onLoginComplete(e){let t=new Set(this.loggingInAccounts());t.delete(e),this.loggingInAccounts.set(t);let n=new Map(this.loginProgress());n.delete(e),this.loginProgress.set(n)}onLogout(e){this.accountLogout.emit(e)}onRemove(e){confirm(`\u786E\u5B9A\u8981\u5220\u9664\u8D26\u6237 ${e.phone} \u55CE\uFF1F`)&&(this.accountRemove.emit(e),this.closeDetail())}onExport(e){this.accountExport.emit(e)}onEdit(e){this.accountEdit.emit(e)}syncAccountInfo(e){if(e.status!=="Online"){this.toast.warning(`\u5E33\u865F ${e.phone} \u672A\u767B\u5165\uFF0C\u8ACB\u5148\u9EDE\u64CA\u300C\u767B\u5165\u300D\u6309\u9215`);return}this.syncing.set(!0),this.toast.info("\u6B63\u5728\u540C\u6B65\u8D26\u53F7\u4FE1\u606F..."),this.ipcService.once("sync-account-info-result",t=>{if(this.syncing.set(!1),console.log("[AccountCard] Sync result:",t),t.success&&t.profile){let n=t.profile,o=P(E({},e),{firstName:n.firstName||e.firstName,lastName:n.lastName||e.lastName,username:n.username||e.username,bio:n.bio||e.bio,avatarPath:n.avatarPath||e.avatarPath,telegramId:n.id?String(n.id):e.telegramId});this.selectedAccount()?.id===e.id&&this.selectedAccount.set(o);let a=this.accounts.findIndex(d=>d.id===e.id);a>=0&&(this.accounts[a]=o),this.toast.success(`\u540C\u6B65\u6210\u529F\uFF01\u7528\u6236\u540D: @${n.username||"\u7121"}`)}else this.toast.error(`\u540C\u6B65\u5931\u6557: ${t.error||"\u65E0\u6CD5\u7372\u53D6\u4FE1\u606F\uFF08\u8D26\u53F7\u53EF\u80FD\u672A\u767B\u5165\uFF09"}`)}),this.ipcService.send("sync-account-info",{id:e.id,phone:e.phone}),setTimeout(()=>{this.syncing()&&(this.syncing.set(!1),this.toast.error("\u540C\u6B65\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5"))},3e4)}getDefaultPersonaForm(){return{id:"",name:"",icon:"\u{1F916}",description:"",systemPrompt:"",greeting:"",creativity:50,responseLength:"medium",tone:"friendly",language:"zh-TW",enableEmoji:!0,blockKeywordsText:""}}openPersonaManager(e){e&&(this.applyPersonaToAccount.set(e),e.aiPersonality&&this.selectedPersonaId.set(e.aiPersonality)),this.showPersonaManager.set(!0)}closePersonaManager(){this.showPersonaManager.set(!1),this.selectedPersonaId.set(null),this.applyPersonaToAccount.set(null)}selectPersona(e){this.selectedPersonaId.set(e.id)}getPersonaById(e){return this.availablePersonas().find(t=>t.id===e)}getCustomPersonas(){return this.availablePersonas().filter(e=>e.isCustom)}getToneName(e){return{formal:"\u6B63\u5F0F",professional:"\u4E13\u4E1A",friendly:"\u53CB\u5584",casual:"\u8F15\u9B06"}[e]||e}applySelectedPersona(){let e=this.selectedPersonaId(),t=this.applyPersonaToAccount();e&&t&&(this.ipcService.send("update-account",{id:t.id,phone:t.phone,aiPersonality:e,aiEnabled:!0}),t.aiPersonality=e,t.aiEnabled=!0,this.toast.success(`\u5DF2\u5E94\u7528\u4EBA\u8A2D\u300C${this.getPersonaById(e)?.name}\u300D`),this.closePersonaManager())}startNewPersona(){this.personaForm=this.getDefaultPersonaForm(),this.editingPersona.set(null),this.showPersonaEditor.set(!0)}editPersona(e){this.personaForm={id:e.id,name:e.name,icon:e.icon,description:e.description,systemPrompt:e.systemPrompt,greeting:e.greeting||"",creativity:e.creativity,responseLength:e.responseLength,tone:e.tone,language:e.language,enableEmoji:e.enableEmoji,blockKeywordsText:e.blockKeywords.join(`
`)},this.editingPersona.set(e),this.showPersonaEditor.set(!0)}closePersonaEditor(){this.showPersonaEditor.set(!1),this.editingPersona.set(null),this.personaForm=this.getDefaultPersonaForm()}savePersona(){let e={id:this.personaForm.id||"custom_"+Date.now(),name:this.personaForm.name,icon:this.personaForm.icon||"\u{1F916}",description:this.personaForm.description,systemPrompt:this.personaForm.systemPrompt,greeting:this.personaForm.greeting,creativity:this.personaForm.creativity,responseLength:this.personaForm.responseLength,tone:this.personaForm.tone,language:this.personaForm.language,enableEmoji:this.personaForm.enableEmoji,blockKeywords:this.personaForm.blockKeywordsText.split(`
`).filter(t=>t.trim()),isCustom:!0};this.editingPersona()?(this.availablePersonas.update(t=>t.map(n=>n.id===e.id?e:n)),this.toast.success("\u4EBA\u8A2D\u5DF2\u66F4\u65B0")):(this.availablePersonas.update(t=>[...t,e]),this.toast.success("\u4EBA\u8A2D\u5DF2\u521B\u5EFA")),this.savePersonasToBackend(),this.closePersonaEditor()}deletePersona(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4EBA\u8A2D\u55CE\uFF1F")&&(this.availablePersonas.update(t=>t.filter(n=>n.id!==e)),this.savePersonasToBackend(),this.toast.success("\u4EBA\u8A2D\u5DF2\u5220\u9664"))}savePersonasToBackend(){let e=this.getCustomPersonas();this.ipcService.send("save-personas",{personas:e})}openPersonaManagerFromEdit(){this.selectedPersonaId.set(this.editForm.aiPersonality||null),this.showPersonaManager.set(!0);let e=this.applySelectedPersona.bind(this);this.applySelectedPersona=()=>{let t=this.selectedPersonaId();if(t){this.editForm.aiPersonality=t;let n=this.getPersonaById(t);n&&(this.editForm.aiCreativity=n.creativity)}this.closePersonaManager(),this.applySelectedPersona=e}}loadPersonas(){this.ipcService.once("get-personas-result",e=>{if(e.success&&e.personas){let t=e.personas.map(n=>P(E({},n),{isCustom:!0}));this.availablePersonas.set([...l1,...t])}}),this.ipcService.send("get-personas",{})}toggleTagFilter(){this.showTagFilter.set(!this.showTagFilter())}toggleTagFilterItem(e){let t=this.tagFilter.indexOf(e);t>=0?this.tagFilter.splice(t,1):this.tagFilter.push(e)}clearTagFilter(){this.tagFilter=[]}getTagById(e){return this.availableTags().find(t=>t.id===e)}getGroupAccountCount(e){return this.accounts.filter(t=>t.group===e).length}openTagManager(){this.showTagFilter.set(!1),this.showTagManager.set(!0)}closeTagManager(){this.showTagManager.set(!1)}addTag(){if(!this.newTagName.trim())return;let e={id:"tag_"+Date.now(),name:this.newTagName.trim(),color:this.newTagColor};this.availableTags.update(t=>[...t,e]),this.newTagName="",this.newTagColor="#3b82f6"}quickAddTag(){if(!this.newTagName.trim())return;let e={id:"tag_"+Date.now(),name:this.newTagName.trim(),color:this.newTagColor};this.availableTags.update(t=>[...t,e]),this.ipcService.send("save-tags",{tags:this.availableTags()}),this.toast.success(`\u6807\u7B7E "${e.name}" \u5DF2\u6DFB\u52A0`),this.newTagName="",this.newTagColor="#3b82f6"}openTagManagerFromEditor(){this.closeAccountTagEditor(),this.openTagManager()}deleteTag(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u6807\u7B7E\u5417\uFF1F")&&this.availableTags.update(t=>t.filter(n=>n.id!==e))}saveTags(){this.ipcService.send("save-tags",{tags:this.availableTags()}),this.toast.success("\u6807\u7B7E\u5DF2\u4FDD\u5B58"),this.closeTagManager()}openGroupManager(){this.showGroupManager.set(!0)}closeGroupManager(){this.showGroupManager.set(!1)}addGroup(){if(!this.newGroupName.trim())return;let e={id:"group_"+Date.now(),name:this.newGroupName.trim(),color:this.newGroupColor};this.groups.update(t=>[...t,e]),this.newGroupName="",this.newGroupColor="#6b7280"}deleteGroup(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u5206\u7D44\u55CE\uFF1F\u8D26\u53F7\u5C06\u8B8A\u70BA\u672A\u5206\u7D44\u3002")&&this.groups.update(t=>t.filter(n=>n.id!==e))}saveGroups(){this.ipcService.send("save-groups",{groups:this.groups()}),this.toast.success("\u5206\u7D44\u5DF2\u4FDD\u5B58"),this.closeGroupManager()}openAccountTagEditor(e){this.editingTagAccount.set(e),this.accountTagsSelection=new Set(e.tags||[]),this.showAccountTagEditor.set(!0)}closeAccountTagEditor(){this.showAccountTagEditor.set(!1),this.editingTagAccount.set(null),this.accountTagsSelection.clear()}toggleAccountTag(e){this.accountTagsSelection.has(e)?this.accountTagsSelection.delete(e):this.accountTagsSelection.add(e)}saveAccountTags(){let e=this.editingTagAccount();if(!e)return;let t=Array.from(this.accountTagsSelection);this.ipcService.send("update-account",{id:e.id,phone:e.phone,tags:t}),e.tags=t,this.toast.success("\u6807\u7B7E\u5DF2\u66F4\u65B0"),this.closeAccountTagEditor()}getDefaultBatchForm(){return{enableProxy:!1,proxyType:"socks5",proxyHost:"",proxyPort:null,proxyUsername:"",proxyPassword:"",proxyCountry:"",enableRole:!1,role:"",enableAI:!1,aiEnabled:!1,aiModel:"gpt-4-turbo",enableLimit:!1,dailySendLimit:50,enableWarmup:!1,enableGroup:!1,group:""}}isAllSelected(){return this.filteredAccounts.length>0&&this.filteredAccounts.every(e=>this.selectedIds.has(e.id))}toggleSelectAll(){this.isAllSelected()?this.selectedIds.clear():this.filteredAccounts.forEach(e=>this.selectedIds.add(e.id))}clearSelection(){this.selectedIds.clear()}openBatchEditModal(){this.batchForm=this.getDefaultBatchForm(),this.showBatchEditModal.set(!0)}closeBatchEditModal(){this.showBatchEditModal.set(!1)}applyBatchEdit(){if(this.selectedIds.size===0){this.toast.warning("\u8BF7\u5148\u9009\u62E9\u8D26\u53F7");return}this.batchSaving.set(!0);let e={};if(this.batchForm.enableProxy){let t="";if(this.batchForm.proxyType!=="none"&&this.batchForm.proxyHost&&this.batchForm.proxyPort){let n=this.batchForm.proxyUsername&&this.batchForm.proxyPassword?`${this.batchForm.proxyUsername}:${this.batchForm.proxyPassword}@`:"";t=`${this.batchForm.proxyType}://${n}${this.batchForm.proxyHost}:${this.batchForm.proxyPort}`}e.proxy=t,e.proxyType=this.batchForm.proxyType,e.proxyHost=this.batchForm.proxyHost,e.proxyPort=this.batchForm.proxyPort,e.proxyUsername=this.batchForm.proxyUsername,e.proxyPassword=this.batchForm.proxyPassword,e.proxyCountry=this.batchForm.proxyCountry}if(this.batchForm.enableRole&&(e.role=this.batchForm.role),this.batchForm.enableAI&&(e.aiEnabled=this.batchForm.aiEnabled,e.aiModel=this.batchForm.aiModel),this.batchForm.enableLimit&&(e.dailySendLimit=this.batchForm.dailySendLimit,e.enableWarmup=this.batchForm.enableWarmup),this.batchForm.enableGroup&&(e.group=this.batchForm.group),Object.keys(e).length===0){this.toast.warning("\u8ACB\u81F3\u5C11\u9009\u62E9\u4E00\u9805\u8BBE\u7F6E"),this.batchSaving.set(!1);return}this.ipcService.once("batch-update-accounts-result",t=>{this.batchSaving.set(!1),t.success?(this.toast.success(`\u5DF2\u66F4\u65B0 ${t.count||this.selectedIds.size} \u500B\u8D26\u53F7`),this.closeBatchEditModal(),this.clearSelection()):this.toast.error(`\u6279\u91CF\u66F4\u65B0\u5931\u6557: ${t.error||"\u672A\u77E5\u9519\u8BEF"}`)}),this.ipcService.send("batch-update-accounts",{accountIds:Array.from(this.selectedIds),updates:e}),setTimeout(()=>{this.batchSaving()&&(this.batchSaving.set(!1),this.toast.error("\u6279\u91CF\u66F4\u65B0\u8D85\u65F6\uFF0C\u8ACB\u91CD\u8A66"))},6e4)}batchLogin(){if(this.selectedIds.size===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5E33\u865F");return}let e=this.accounts.filter(a=>this.selectedIds.has(a.id)&&(a.status==="Offline"||a.status==="Banned"));if(e.length===0){this.toast.info("\u9078\u4E2D\u7684\u5E33\u865F\u90FD\u5DF2\u5728\u7DDA\u6216\u6B63\u5728\u767B\u5165\u4E2D");return}this.batchLoggingIn.set(!0),this.toast.info(`\u6B63\u5728\u6279\u91CF\u767B\u5165 ${e.length} \u500B\u5E33\u865F...`);let t=new Set(this.loggingInAccounts());e.forEach(a=>{t.add(a.id)}),this.loggingInAccounts.set(t);let n=0,o=()=>{if(n>=e.length){this.batchLoggingIn.set(!1),this.toast.success(`\u5DF2\u767C\u9001 ${e.length} \u500B\u5E33\u865F\u7684\u767B\u5165\u8ACB\u6C42`);return}let a=e[n];this.accountLogin.emit(a),n++,setTimeout(o,2e3)};o()}batchLogout(){if(this.selectedIds.size===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5E33\u865F");return}let e=this.accounts.filter(n=>this.selectedIds.has(n.id)&&n.status==="Online");if(e.length===0){this.toast.info("\u9078\u4E2D\u7684\u5E33\u865F\u90FD\u5DF2\u96E2\u7DDA");return}if(!confirm(`\u78BA\u5B9A\u8981\u9000\u51FA ${e.length} \u500B\u5728\u7DDA\u5E33\u865F\u55CE\uFF1F`))return;this.batchLoggingOut.set(!0),this.toast.info(`\u6B63\u5728\u6279\u91CF\u9000\u51FA ${e.length} \u500B\u5E33\u865F...`);let t=0;e.forEach((n,o)=>{setTimeout(()=>{this.accountLogout.emit(n),t++,t>=e.length&&(this.batchLoggingOut.set(!1),this.toast.success(`\u5DF2\u767C\u9001 ${e.length} \u500B\u5E33\u865F\u7684\u9000\u51FA\u8ACB\u6C42`))},o*500)})}batchSync(){if(this.selectedIds.size===0){this.toast.warning("\u8BF7\u5148\u9009\u62E9\u8D26\u53F7");return}this.batchSyncing.set(!0);let e=Array.from(this.selectedIds),t=0;e.forEach(o=>{let a=this.accounts.find(d=>d.id===o);a&&this.ipcService.send("sync-account-info",{id:o,phone:a.phone})});let n=o=>{t++,t>=e.length&&(this.batchSyncing.set(!1),this.toast.success(`\u5DF2\u540C\u6B65 ${e.length} \u4E2A\u8D26\u53F7`),this.ipcService.off("sync-account-info-result",n))};this.ipcService.on("sync-account-info-result",n),setTimeout(()=>{this.batchSyncing()&&(this.batchSyncing.set(!1),this.ipcService.off("sync-account-info-result",n),this.toast.warning(`\u5DF2\u540C\u6B65 ${t}/${e.length} \u4E2A\u8D26\u53F7`))},6e4)}confirmBatchDelete(){if(this.selectedIds.size===0){this.toast.warning("\u8BF7\u5148\u9009\u62E9\u8D26\u53F7");return}confirm(`\u786E\u5B9A\u8981\u5220\u9664\u9078\u4E2D\u7684 ${this.selectedIds.size} \u500B\u8D26\u53F7\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002`)&&(this.ipcService.send("bulk-delete-accounts",{accountIds:Array.from(this.selectedIds)}),this.clearSelection(),this.toast.success("\u6279\u91CF\u5220\u9664\u8ACB\u6C42\u5DF2\u53D1\u9001"))}getDefaultEditForm(){return{nickname:"",notes:"",apiId:"",apiHash:"",dailySendLimit:50,group:"",enableWarmup:!1,proxyType:"none",proxyHost:"",proxyPort:null,proxyUsername:"",proxyPassword:"",proxyCountry:"",proxyRotationEnabled:!1,role:"",customRoleName:"",roleDescription:"",aiEnabled:!1,aiModel:"gpt-4-turbo",aiCreativity:50,aiResponseLength:50,aiAutoReply:!1,aiBlockKeywords:"",aiPersonality:""}}openEditModal(e){this.editingAccount.set(e),this.editTab.set("basic"),this.proxyTestResult.set(null),this.editForm={nickname:e.nickname||"",notes:e.notes||"",apiId:e.apiId||"",apiHash:e.apiHash||"",dailySendLimit:e.dailySendLimit||50,group:e.group||"",enableWarmup:e.enableWarmup||!1,proxyType:e.proxyType||"none",proxyHost:e.proxyHost||"",proxyPort:e.proxyPort||null,proxyUsername:e.proxyUsername||"",proxyPassword:e.proxyPassword||"",proxyCountry:e.proxyCountry||"",proxyRotationEnabled:e.proxyRotationEnabled||!1,role:e.role||"",customRoleName:"",roleDescription:"",aiEnabled:e.aiEnabled||!1,aiModel:e.aiModel||"gpt-4-turbo",aiCreativity:50,aiResponseLength:50,aiAutoReply:!1,aiBlockKeywords:"",aiPersonality:e.aiPersonality||""},this.showEditModal.set(!0)}closeEditModal(){this.showEditModal.set(!1),this.editingAccount.set(null),this.editForm=this.getDefaultEditForm()}onProxyTypeChange(){this.editForm.proxyType==="none"&&(this.editForm.proxyHost="",this.editForm.proxyPort=null,this.editForm.proxyUsername="",this.editForm.proxyPassword=""),this.proxyTestResult.set(null)}selectRole(e){this.editForm.role=e;let t=this.roleTemplates.find(n=>n.id===e);t&&(this.editForm.customRoleName=t.name)}testProxy(){if(!this.editForm.proxyHost||!this.editForm.proxyPort){this.toast.warning("\u8ACB\u586B\u5BEB\u4EE3\u7406\u5730\u5740\u548C\u7AEF\u53E3");return}this.testingProxy.set(!0),this.proxyTestResult.set(null);let e={type:this.editForm.proxyType,host:this.editForm.proxyHost,port:this.editForm.proxyPort,username:this.editForm.proxyUsername,password:this.editForm.proxyPassword};this.ipcService.once("test-proxy-result",t=>{this.testingProxy.set(!1),t.success?this.proxyTestResult.set({success:!0,message:`\u2705 \u4EE3\u7406\u8FDE\u63A5\u6210\u529F\uFF01\u5EF6\u9072: ${t.latency||"N/A"}ms`}):this.proxyTestResult.set({success:!1,message:`\u274C \u8FDE\u63A5\u5931\u6557: ${t.error||"\u672A\u77E5\u9519\u8BEF"}`})}),this.ipcService.send("test-proxy",e),setTimeout(()=>{this.testingProxy()&&(this.testingProxy.set(!1),this.proxyTestResult.set({success:!1,message:"\u274C \u6D4B\u8BD5\u8D85\u65F6\uFF0815\u79D2\uFF09"}))},15e3)}saveEdit(){let e=this.editingAccount();if(!e)return;this.saving.set(!0);let t="";if(this.editForm.proxyType!=="none"&&this.editForm.proxyHost&&this.editForm.proxyPort){let a=this.editForm.proxyUsername&&this.editForm.proxyPassword?`${this.editForm.proxyUsername}:${this.editForm.proxyPassword}@`:"";t=`${this.editForm.proxyType}://${a}${this.editForm.proxyHost}:${this.editForm.proxyPort}`}let n=this.editForm.customRoleName||this.roleTemplates.find(a=>a.id===this.editForm.role)?.name||this.editForm.role,o={id:e.id,phone:e.phone,nickname:this.editForm.nickname,notes:this.editForm.notes,apiId:this.editForm.apiId,apiHash:this.editForm.apiHash,dailySendLimit:this.editForm.dailySendLimit,group:this.editForm.group,enableWarmup:this.editForm.enableWarmup,proxy:t,proxyType:this.editForm.proxyType,proxyHost:this.editForm.proxyHost,proxyPort:this.editForm.proxyPort,proxyUsername:this.editForm.proxyUsername,proxyPassword:this.editForm.proxyPassword,proxyCountry:this.editForm.proxyCountry,proxyRotationEnabled:this.editForm.proxyRotationEnabled,role:n,aiEnabled:this.editForm.aiEnabled,aiModel:this.editForm.aiModel,aiPersonality:this.editForm.roleDescription};this.ipcService.once("update-account-result",a=>{if(this.saving.set(!1),a.success){this.toast.success("\u8D26\u53F7\u8BBE\u7F6E\u5DF2\u4FDD\u5B58");let d=E(E({},e),o);this.accountUpdated.emit(d),this.selectedAccount()?.id===e.id&&this.selectedAccount.set(d),this.closeEditModal()}else this.toast.error(`\u4FDD\u5B58\u5931\u6557: ${a.error||"\u672A\u77E5\u9519\u8BEF"}`)}),this.ipcService.send("update-account",o),setTimeout(()=>{this.saving()&&(this.saving.set(!1),this.toast.error("\u4FDD\u5B58\u8D85\u65F6\uFF0C\u8ACB\u91CD\u8A66"))},3e4)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-account-card-list"]],inputs:{accounts:"accounts"},outputs:{addAccount:"addAccount",accountSelected:"accountSelected",accountLogin:"accountLogin",accountLogout:"accountLogout",accountRemove:"accountRemove",accountExport:"accountExport",accountEdit:"accountEdit",accountUpdated:"accountUpdated"},features:[li],decls:90,vars:41,consts:[[1,"account-card-list"],[1,"toolbar"],[1,"toolbar-left"],[1,"search-box"],[1,"search-icon"],["type","text","placeholder","\u641C\u7D22\u624B\u673A\u53F7\u3001\u540D\u79F0...",1,"search-input",3,"ngModelChange","ngModel"],[1,"filter-select",3,"ngModelChange","ngModel"],["value","all"],["value","Online"],["value","Offline"],["value","Banned"],["value","Warming Up"],["value","_ungrouped"],[3,"value"],[1,"tag-filter-dropdown"],[1,"filter-btn",3,"click"],[1,"tag-count"],[1,"tag-dropdown"],[1,"toolbar-right"],[1,"view-toggle"],["title","\u5361\u7247\u89C6\u56FE",1,"toggle-btn",3,"click"],["width","16","height","16","viewBox","0 0 24 24","fill","currentColor"],["x","3","y","3","width","7","height","7","rx","1"],["x","14","y","3","width","7","height","7","rx","1"],["x","3","y","14","width","7","height","7","rx","1"],["x","14","y","14","width","7","height","7","rx","1"],["title","\u8868\u683C\u89C6\u56FE",1,"toggle-btn",3,"click"],["x","3","y","4","width","18","height","3","rx","1"],["x","3","y","10","width","18","height","3","rx","1"],["x","3","y","16","width","18","height","3","rx","1"],[1,"manage-btn",3,"click"],[1,"add-btn",3,"click"],[1,"stats-bar"],[1,"stats-left"],[1,"batch-checkbox"],["type","checkbox",3,"change","checked"],[1,"checkbox-label"],[1,"stat-item"],[1,"stat-dot","online"],[1,"stat-label"],[1,"stat-value"],[1,"stat-dot","offline"],[1,"stat-dot","banned"],[1,"batch-actions"],[1,"card-grid"],[1,"table-container"],[1,"empty-state"],[1,"tag-dropdown-header"],[1,"clear-btn",3,"click"],[1,"tag-option",3,"--tag-color"],[1,"manage-tags-btn",3,"click"],[1,"tag-option"],[1,"tag-dot"],[1,"batch-count"],["title","\u6279\u91CF\u767B\u5165\u96E2\u7DDA\u5E33\u865F",1,"batch-btn","success",3,"click","disabled"],["title","\u6279\u91CF\u9000\u51FA\u5728\u7DDA\u5E33\u865F",1,"batch-btn","warning",3,"click","disabled"],[1,"batch-btn","primary",3,"click"],[1,"batch-btn",3,"click","disabled"],[1,"batch-btn","danger",3,"click"],[1,"batch-btn",3,"click"],[1,"account-card",3,"online","offline","banned","warming","logging-in","selected"],[1,"account-card",3,"click"],[1,"card-select",3,"click"],[1,"card-header"],[1,"card-avatar-wrapper"],[1,"card-avatar"],[1,"card-status-role"],[1,"card-status"],[1,"status-dot"],[1,"status-text"],[1,"card-role",3,"click"],[1,"role-icon"],[1,"role-name"],[1,"role-arrow"],[1,"card-main"],[1,"card-nickname"],[1,"card-phone"],[1,"card-name"],[1,"card-username"],[1,"card-tags"],[1,"card-device"],[1,"device-icon"],[1,"device-name"],[1,"card-health"],[1,"health-bar"],[1,"health-fill"],[1,"health-text"],[1,"login-progress-overlay"],[1,"card-actions",3,"click"],["title","\u767B\u5165\u8D26\u53F7",1,"action-btn","login"],["disabled","","title","\u767B\u5165\u4E2D...",1,"action-btn","logging-in"],["title","\u9000\u51FA\u8D26\u53F7",1,"action-btn","logout"],["title","\u7F16\u8F91\u8BBE\u7F6E",1,"action-btn","edit",3,"click"],[1,"action-icon"],[1,"action-label"],["title","\u5220\u9664\u8D26\u53F7",1,"action-btn","remove",3,"click","disabled"],["alt","",1,"card-avatar-img",3,"error","src"],[1,"card-avatar","avatar-fallback",2,"display","none"],[1,"tag-more"],[1,"tag-badge",3,"background"],[1,"tag-badge"],[1,"login-spinner"],[1,"login-status-text"],["title","\u767B\u5165\u8D26\u53F7",1,"action-btn","login",3,"click"],[1,"action-icon","spinning"],["title","\u9000\u51FA\u8D26\u53F7",1,"action-btn","logout",3,"click"],[1,"account-table"],["type","checkbox",3,"ngModelChange","change","ngModel"],[3,"selected"],[3,"click"],[1,"status-dot","small"],[1,"phone-cell"],[1,"role-cell"],[1,"role-tag-small",3,"click"],[1,"device-cell"],[1,"health-inline"],[1,"health-bar","small"],[1,"actions-cell",3,"click"],["title","\u767B\u5165\u8D26\u53F7",1,"table-action","login"],["title","\u9000\u51FA\u8D26\u53F7",1,"table-action","logout"],["title","\u8D26\u53F7\u8BBE\u7F6E",1,"table-action","edit",3,"click"],["title","\u5220\u9664\u8D26\u53F7",1,"table-action","remove",3,"click"],["title","\u767B\u5165\u8D26\u53F7",1,"table-action","login",3,"click"],["title","\u9000\u51FA\u8D26\u53F7",1,"table-action","logout",3,"click"],[1,"empty-icon"],[1,"add-btn","large",3,"click"],[1,"detail-overlay",3,"click"],[1,"detail-panel"],[1,"detail-header"],[1,"close-btn",3,"click"],[1,"detail-content"],[1,"detail-section"],[1,"detail-avatar-wrapper"],[1,"detail-avatar"],["class","detail-nickname",4,"ngIf"],[1,"detail-name"],[1,"detail-phone"],[1,"detail-username"],[1,"detail-role-badge",3,"click"],[1,"role-icon-large"],[1,"role-label"],[1,"role-change-hint"],[1,"detail-bio"],[1,"detail-grid"],[1,"detail-item"],[1,"label"],[1,"value","status"],[1,"value"],[1,"value","role-value",3,"click"],[1,"role-badge"],[1,"role-edit"],[1,"detail-item","full-width"],[1,"detail-tags"],[1,"no-tags"],[1,"detail-item","full"],[1,"detail-login-progress"],[1,"detail-actions-grid"],[1,"action-btn-sm","primary"],["disabled","",1,"action-btn-sm","logging-in"],[1,"action-btn-sm","warning"],[1,"action-btn-sm",3,"click","disabled"],[1,"action-btn-sm",3,"click"],[1,"action-btn-sm","danger",3,"click","disabled"],["alt","Avatar",1,"detail-avatar-img",3,"error","src"],[1,"detail-avatar","avatar-fallback",2,"display","none"],[1,"detail-nickname"],[1,"login-progress-text"],[1,"action-btn-sm","primary",3,"click"],[1,"action-btn-sm","warning",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-container"],[1,"modal-header"],[1,"modal-content"],[1,"tab-nav"],[1,"tab-btn",3,"click"],[1,"tab-panel"],[1,"modal-footer"],[1,"btn-cancel",3,"click"],[1,"btn-save",3,"click","disabled"],[1,"form-group"],["type","text","placeholder","\u81EA\u5B9A\u4E49\u6635\u79F0\uFF08\u65B9\u4FBF\u8BC6\u522B\uFF09",3,"ngModelChange","ngModel"],["placeholder","\u6DFB\u52A0\u5907\u6CE8\u4FE1\u606F...","rows","3",3,"ngModelChange","ngModel"],[1,"form-row"],["type","text","placeholder","\u4ECE my.telegram.org \u83B7\u53D6",3,"ngModelChange","ngModel"],[1,"form-hint"],["href","https://my.telegram.org","target","_blank"],["type","number","min","1","max","500",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u71DF\u92B7\u7D44A",3,"ngModelChange","ngModel"],["type","checkbox",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[1,"form-group","flex-2"],["type","text","placeholder","\u4F8B\u5982\uFF1A127.0.0.1",3,"ngModelChange","ngModel"],[1,"form-group","flex-1"],["type","number","placeholder","1080",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4EE3\u7406\u7528\u6236\u540D",3,"ngModelChange","ngModel"],["type","password","placeholder","\u4EE3\u7406\u5BC6\u78BC",3,"ngModelChange","ngModel"],["value",""],["value","US"],["value","JP"],["value","SG"],["value","HK"],["value","TW"],["value","KR"],["value","DE"],["value","UK"],[1,"test-btn",3,"click","disabled"],[1,"test-result",3,"success","error"],[1,"test-result"],[1,"role-grid"],[1,"role-card",3,"selected"],["type","text","placeholder","\u4F8B\u5982\uFF1AVIP\u5BA2\u670D\u5C0F\u7F8E",3,"ngModelChange","ngModel"],["rows","4","placeholder","\u63CF\u8FF0\u8FD9\u4E2A\u89D2\u8272\u7684\u6027\u683C\u7279\u9EDE\u3001\u8AAA\u8A71\u98CE\u683C\u3001\u4E13\u4E1A\u9818\u57DF\u7B49...",3,"ngModelChange","ngModel"],[1,"role-card",3,"click"],[1,"role-desc"],[1,"persona-select-row"],[1,"current-persona",3,"click"],[1,"no-persona"],[1,"select-arrow"],[1,"btn-persona-manager",3,"click"],["value","gpt-4-turbo"],["value","gpt-3.5-turbo"],["value","claude-3-sonnet"],["value","ollama"],["type","range","min","0","max","100","step","5",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"form-hint","warning"],["type","text","placeholder","\u7528\u9017\u865F\u5206\u9694\uFF0C\u4F8B\u5982\uFF1A\u9000\u6B3E,\u6295\u8A34,\u7AF6\u54C1",3,"ngModelChange","ngModel"],[1,"persona-icon-small"],[1,"persona-name-small"],[1,"modal-container","batch-modal"],[1,"batch-warning"],[1,"batch-section"],[1,"batch-section-header"],[1,"batch-section-content"],["type","text","placeholder","127.0.0.1",3,"ngModelChange","ngModel"],["type","text",3,"ngModelChange","ngModel"],["type","password",3,"ngModelChange","ngModel"],[1,"account-role-grid"],[1,"account-role-card",3,"selected","border-color"],[1,"account-role-card",3,"click"],[1,"role-card-icon"],[1,"role-card-content"],[1,"role-card-name"],[1,"role-card-desc"],[1,"role-card-check",3,"color"],[1,"role-card-check"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u92B7\u552E\u7D44A",3,"ngModelChange","ngModel"],[1,"modal-container","tag-manager-modal"],[1,"add-tag-form"],["type","text","placeholder","\u6807\u7B7E\u540D\u7A31",1,"tag-input",3,"ngModelChange","ngModel"],["type","color",1,"color-picker",3,"ngModelChange","ngModel"],[1,"btn-add",3,"click","disabled"],[1,"tag-list"],[1,"tag-item"],[1,"btn-save",3,"click"],[1,"tag-preview"],["type","text",1,"tag-edit-input",3,"ngModelChange","ngModel"],["type","color",1,"color-picker","small",3,"ngModelChange","ngModel"],[1,"btn-delete",3,"click"],[1,"modal-container","group-manager-modal"],[1,"add-group-form"],["type","text","placeholder","\u5206\u7D44\u540D\u7A31",1,"group-input",3,"ngModelChange","ngModel"],[1,"group-list"],[1,"group-item"],[1,"group-color-bar"],[1,"group-info"],["type","text",1,"group-edit-input",3,"ngModelChange","ngModel"],[1,"group-count"],[1,"modal-container","account-tag-modal"],[1,"account-tags-grid"],[1,"account-tag-option",3,"selected"],[1,"quick-add-tag"],[1,"quick-add-form"],["type","text","placeholder","\u8F93\u5165\u65B0\u6807\u7B7E\u540D\u79F0",1,"tag-input-inline",3,"ngModelChange","ngModel"],["type","color",1,"color-picker-inline",3,"ngModelChange","ngModel"],[1,"btn-quick-add",3,"click","disabled"],[1,"btn-manage",3,"click"],[1,"footer-actions"],[1,"account-tag-option"],[1,"tag-badge","large"],[1,"modal-container","persona-manager-modal"],[1,"persona-tabs"],[1,"persona-grid"],[1,"custom-persona-section"],[1,"btn-save"],[1,"persona-card",3,"selected"],[1,"persona-card",3,"click"],[1,"persona-icon"],[1,"persona-info"],[1,"persona-name"],[1,"persona-desc"],[1,"persona-meta"],[1,"meta-tag"],[1,"btn-new-persona",3,"click"],[1,"custom-persona-list"],[1,"persona-card","horizontal",3,"selected"],[1,"persona-card","horizontal",3,"click"],[1,"persona-actions"],[1,"action-btn",3,"click"],[1,"action-btn","danger",3,"click"],[1,"modal-container","persona-editor-modal"],[1,"persona-form"],[1,"form-group",2,"flex","0 0 80px"],["type","text","maxlength","2",1,"icon-input",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u4E13\u4E1A\u92B7\u552E",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4E00\u53E5\u8A71\u63CF\u8FF0\u8FD9\u4E2A\u4EBA\u8A2D\u7684\u7279\u9EDE",3,"ngModelChange","ngModel"],["placeholder","\u63CF\u8FF0 AI \u7684\u89D2\u8272\u3001\u6027\u683C\u3001\u76EE\u6A19\u548C\u884C\u70BA\u6E96\u5247...","rows","6",3,"ngModelChange","ngModel"],["type","text","placeholder","AI \u4E3B\u52D5\u767C\u8D77\u5BF9\u8BDD\u6642\u7684\u7B2C\u4E00\u53E5\u8A71",3,"ngModelChange","ngModel"],["value","short"],["value","medium"],["value","long"],["value","formal"],["value","professional"],["value","friendly"],["value","casual"],["value","zh-TW"],["value","zh-CN"],["value","en"],["value","ja"],["placeholder","\u5305\u542B\u9019\u4E9B\u5173\u9375\u8A5E\u7684\u6D88\u606F\u4E0D\u81EA\u52A8\u56DE\u590D","rows","3",3,"ngModelChange","ngModel"],[1,"role-selector-overlay",3,"click"],[1,"role-selector-popup"],[1,"role-selector-header"],[1,"role-selector-title"],[1,"role-selector-phone"],[1,"role-selector-list"],[1,"role-option",3,"active"],[1,"role-selector-footer"],[1,"role-selector-cancel",3,"click"],[1,"role-option",3,"click"],[1,"role-option-icon"],[1,"role-option-info"],[1,"role-option-name"],[1,"role-option-desc"],[1,"role-option-check"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F50D}"),s(),r(6,"input",5),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),s()(),r(7,"select",6),W("ngModelChange",function(a){return q(n.statusFilter,a)||(n.statusFilter=a),a}),r(8,"option",7),l(9),s(),r(10,"option",8),l(11),s(),r(12,"option",9),l(13),s(),r(14,"option",10),l(15),s(),r(16,"option",11),l(17),s()(),r(18,"select",6),W("ngModelChange",function(a){return q(n.groupFilter,a)||(n.groupFilter=a),a}),r(19,"option",7),l(20),s(),r(21,"option",12),l(22,"\u{1F4C1} \u672A\u5206\u7EC4"),s(),O(23,iT,2,2,"option",13,Jt),s(),r(25,"div",14)(26,"button",15),x("click",function(){return n.toggleTagFilter()}),l(27," \u{1F3F7}\uFE0F \u6807\u7B7E "),y(28,oT,2,1,"span",16),s(),y(29,sT,10,0,"div",17),s()(),r(30,"div",18)(31,"div",19)(32,"button",20),x("click",function(){return n.viewMode.set("card")}),ne(),r(33,"svg",21),B(34,"rect",22)(35,"rect",23)(36,"rect",24)(37,"rect",25),s()(),ce(),r(38,"button",26),x("click",function(){return n.viewMode.set("table")}),ne(),r(39,"svg",21),B(40,"rect",27)(41,"rect",28)(42,"rect",29),s()()(),ce(),r(43,"button",30),x("click",function(){return n.openGroupManager()}),l(44),s(),r(45,"button",31),x("click",function(){return n.addAccount.emit()}),l(46),s()()(),r(47,"div",32)(48,"div",33)(49,"label",34)(50,"input",35),x("change",function(){return n.toggleSelectAll()}),s(),r(51,"span",36),l(52),s()(),r(53,"div",37),B(54,"span",38),r(55,"span",39),l(56),s(),r(57,"span",40),l(58),s()(),r(59,"div",37),B(60,"span",41),r(61,"span",39),l(62),s(),r(63,"span",40),l(64),s()(),r(65,"div",37),B(66,"span",42),r(67,"span",39),l(68),s(),r(69,"span",40),l(70),s()(),r(71,"div",37)(72,"span",39),l(73),s(),r(74,"span",40),l(75),s()()(),y(76,aT,15,6,"div",43),s(),y(77,ET,3,0,"div",44),y(78,TT,25,1,"div",45),y(79,kT,9,3,"div",46),y(80,IT,7,0,"div",46),s(),y(81,JT,123,45),y(82,a7,26,14),y(83,f7,45,13),y(84,x7,22,4),y(85,y7,22,4),y(86,E7,26,5),y(87,P7,19,7),y(88,R7,88,14),y(89,B7,13,5)),t&2&&(c(6),H("ngModel",n.searchQuery),c(),H("ngModel",n.statusFilter),c(2),D(n.t("accounts.allStatus")),c(2),M("\u{1F7E2} ",n.t("accounts.online")),c(2),M("\u26AA ",n.t("accounts.offline")),c(2),M("\u{1F534} ",n.t("accounts.banned")),c(2),M("\u{1F7E1} ",n.t("accounts.warmingUp")),c(),H("ngModel",n.groupFilter),c(2),D(n.t("accounts.allGroups")),c(3),U(n.groups()),c(5),S(n.tagFilter.length>0?28:-1),c(),S(n.showTagFilter()?29:-1),c(3),N("active",n.viewMode()==="card"),c(6),N("active",n.viewMode()==="table"),c(6),M(" \u{1F4C1} ",n.t("accounts.manageGroups")," "),c(2),M(" \u2795 ",n.t("accounts.addAccount")," "),c(4),L("checked",n.isAllSelected()),c(2),D(n.t("accounts.selectAll")),c(4),D(n.t("accounts.online")),c(2),D(n.onlineCount),c(4),D(n.t("accounts.offline")),c(2),D(n.offlineCount),c(4),D(n.t("accounts.banned")),c(2),D(n.bannedCount),c(3),D(n.t("accounts.total")),c(2),D(n.accounts.length),c(),S(n.selectedIds.size>0?76:-1),c(),S(n.viewMode()==="card"?77:-1),c(),S(n.viewMode()==="table"?78:-1),c(),S(n.filteredAccounts.length===0&&n.accounts.length===0?79:-1),c(),S(n.filteredAccounts.length===0&&n.accounts.length>0?80:-1),c(),S(n.selectedAccount()?81:-1),c(),S(n.showEditModal()?82:-1),c(),S(n.showBatchEditModal()?83:-1),c(),S(n.showTagManager()?84:-1),c(),S(n.showGroupManager()?85:-1),c(),S(n.showAccountTagEditor()?86:-1),c(),S(n.showPersonaManager()?87:-1),c(),S(n.showPersonaEditor()?88:-1),c(),S(n.showRoleSelector()?89:-1))},dependencies:[oe,hr,ae,Re,Ne,xe,Rt,Hi,it,Ge,ve,qi,Nt,tn,he],styles:[".account-card-list[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;gap:1rem;flex-wrap:wrap}.toolbar-left[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex:1}.search-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;flex:1;max-width:300px}.search-icon[_ngcontent-%COMP%]{font-size:.875rem}.search-input[_ngcontent-%COMP%]{flex:1;background:transparent;border:none;color:var(--text-primary, white);font-size:.875rem;outline:none}.filter-select[_ngcontent-%COMP%]{padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.toolbar-right[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.view-toggle[_ngcontent-%COMP%]{display:flex;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;overflow:hidden}.toggle-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background:transparent;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s}.toggle-btn.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.add-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;transition:all .2s}.add-btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.add-btn.large[_ngcontent-%COMP%]{padding:.75rem 1.5rem;font-size:1rem}.stats-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding:.75rem 1rem;background:var(--bg-card, rgba(30, 41, 59, .5));border-radius:.5rem;flex-wrap:wrap;gap:.75rem}.stats-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem}.batch-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer}.batch-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:16px;height:16px;accent-color:var(--primary, #06b6d4)}.checkbox-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.batch-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.batch-count[_ngcontent-%COMP%]{font-size:.875rem;color:var(--primary, #06b6d4);font-weight:500;margin-right:.5rem}.batch-btn[_ngcontent-%COMP%]{padding:.375rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;color:var(--text-secondary, #cbd5e1);font-size:.75rem;cursor:pointer;transition:all .2s}.batch-btn[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.batch-btn.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;color:#fff}.batch-btn.primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px)}.batch-btn.danger[_ngcontent-%COMP%]:hover:not(:disabled){border-color:#ef4444;color:#ef4444;background:#ef44441a}.batch-btn.success[_ngcontent-%COMP%]{border-color:#22c55e;color:#22c55e}.batch-btn.success[_ngcontent-%COMP%]:hover:not(:disabled){background:#22c55e1a}.batch-btn.warning[_ngcontent-%COMP%]{border-color:#f59e0b;color:#f59e0b}.batch-btn.warning[_ngcontent-%COMP%]:hover:not(:disabled){background:#f59e0b1a}.batch-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.stat-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%}.stat-dot.online[_ngcontent-%COMP%]{background:#22c55e}.stat-dot.offline[_ngcontent-%COMP%]{background:#94a3b8}.stat-dot.banned[_ngcontent-%COMP%]{background:#ef4444}.stat-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.stat-value[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.card-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}.account-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.75rem;padding:1rem;cursor:pointer;transition:all .2s;display:flex;flex-direction:column;gap:.75rem;position:relative}.account-card.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.card-select[_ngcontent-%COMP%]{position:absolute;top:.75rem;right:.75rem;z-index:2}.card-select[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:var(--primary, #06b6d4);cursor:pointer}.account-card[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);transform:translateY(-2px);box-shadow:0 4px 12px #0003}.account-card.online[_ngcontent-%COMP%]{border-left:3px solid #22c55e;box-shadow:inset 0 0 20px #22c55e0d}.account-card.online[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #22c55e33,inset 0 0 20px #22c55e0d}.account-card.offline[_ngcontent-%COMP%]{border-left:3px solid #94a3b8}.account-card.banned[_ngcontent-%COMP%]{border-left:3px solid #ef4444;background:linear-gradient(135deg,rgba(239,68,68,.05),transparent)}.account-card.warming[_ngcontent-%COMP%]{border-left:3px solid #f59e0b;background:linear-gradient(135deg,rgba(245,158,11,.05),transparent)}.account-card.logging-in[_ngcontent-%COMP%]{border-left:3px solid #06b6d4;animation:_ngcontent-%COMP%_card-pulse 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_card-pulse{0%,to{box-shadow:0 2px 8px #06b6d41a}50%{box-shadow:0 4px 16px #06b6d44d}}.card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.card-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:700;color:#fff;flex-shrink:0}.card-avatar-img[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover;flex-shrink:0}.card-nickname[_ngcontent-%COMP%]{font-size:.75rem;color:var(--primary, #06b6d4);font-weight:500;margin-bottom:.125rem}.card-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.card-status-role[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.375rem;flex:1}.card-role[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;padding:.25rem .5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.375rem;cursor:pointer;transition:all .2s;font-size:.75rem}.card-role[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.role-icon[_ngcontent-%COMP%]{font-size:.875rem}.role-name[_ngcontent-%COMP%]{font-weight:500}.role-arrow[_ngcontent-%COMP%]{font-size:.625rem;color:var(--text-muted, #94a3b8);margin-left:auto}.role-selector-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0000004d;z-index:1000}.role-selector-popup[_ngcontent-%COMP%]{position:fixed;width:260px;background:var(--bg-card, #1e293b);border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.75rem;box-shadow:0 10px 40px #0000004d;z-index:1001;overflow:hidden}.role-selector-header[_ngcontent-%COMP%]{padding:.75rem 1rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1));display:flex;justify-content:space-between;align-items:center}.role-selector-title[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem;color:var(--text-primary, white)}.role-selector-phone[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.role-selector-list[_ngcontent-%COMP%]{max-height:320px;overflow-y:auto}.role-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;cursor:pointer;transition:all .2s}.role-option[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary, rgba(15, 23, 42, .5))}.role-option.active[_ngcontent-%COMP%]{background:#06b6d41a}.role-option-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:.5rem;display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0}.role-option-info[_ngcontent-%COMP%]{flex:1;min-width:0}.role-option-name[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:.875rem;color:var(--text-primary, white)}.role-option-desc[_ngcontent-%COMP%]{display:block;font-size:.75rem;color:var(--text-muted, #94a3b8);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.role-option-check[_ngcontent-%COMP%]{color:#22c55e;font-weight:700}.role-selector-footer[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1));display:flex;justify-content:flex-end}.role-selector-cancel[_ngcontent-%COMP%]{padding:.5rem 1rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;color:var(--text-secondary, #94a3b8);cursor:pointer;font-size:.75rem}.role-selector-cancel[_ngcontent-%COMP%]:hover{border-color:var(--text-muted, #94a3b8)}.status-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%}.status-dot.small[_ngcontent-%COMP%]{width:8px;height:8px}.status-dot.online[_ngcontent-%COMP%]{background:#22c55e;animation:_ngcontent-%COMP%_pulse-online 2s ease-in-out infinite;box-shadow:0 0 8px #22c55e80}.status-dot.offline[_ngcontent-%COMP%]{background:#94a3b8}.status-dot.banned[_ngcontent-%COMP%]{background:#ef4444;animation:_ngcontent-%COMP%_pulse-banned 1.5s ease-in-out infinite}.status-dot.warning[_ngcontent-%COMP%]{background:#f59e0b;animation:_ngcontent-%COMP%_pulse-warning 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-online{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}@keyframes _ngcontent-%COMP%_pulse-banned{0%,to{opacity:1}50%{opacity:.5}}@keyframes _ngcontent-%COMP%_pulse-warning{0%,to{opacity:1}50%{opacity:.6}}.status-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.card-main[_ngcontent-%COMP%]{flex:1}.card-phone[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--text-primary, white)}.card-name[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.card-username[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.card-device[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.device-icon[_ngcontent-%COMP%]{font-size:1rem}.card-health[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.health-bar[_ngcontent-%COMP%]{flex:1;height:4px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:2px;overflow:hidden}.health-bar.small[_ngcontent-%COMP%]{width:50px}.health-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s}.health-fill.good[_ngcontent-%COMP%]{background:#22c55e}.health-fill.warning[_ngcontent-%COMP%]{background:#f59e0b}.health-fill.danger[_ngcontent-%COMP%]{background:#ef4444}.health-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);min-width:35px}.card-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1));padding-top:.75rem}.action-btn[_ngcontent-%COMP%]{padding:.375rem .5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:none;border-radius:.375rem;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:.25rem}.action-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--bg-secondary, rgba(30, 41, 59, .8));transform:translateY(-1px)}.action-btn.login[_ngcontent-%COMP%]{color:#22c55e}.action-btn.login[_ngcontent-%COMP%]:hover:not(:disabled){background:#22c55e26;box-shadow:0 2px 8px #22c55e33}.action-btn.logout[_ngcontent-%COMP%]{color:#f59e0b}.action-btn.logout[_ngcontent-%COMP%]:hover:not(:disabled){background:#f59e0b26}.action-btn.edit[_ngcontent-%COMP%]{color:#3b82f6}.action-btn.edit[_ngcontent-%COMP%]:hover:not(:disabled){background:#3b82f626}.action-btn.remove[_ngcontent-%COMP%]{color:#94a3b8}.action-btn.remove[_ngcontent-%COMP%]:hover:not(:disabled){background:#ef444426;color:#ef4444}.action-label[_ngcontent-%COMP%]{font-size:.75rem}.action-btn.logging-in[_ngcontent-%COMP%]{background:#06b6d433;cursor:not-allowed;opacity:.8}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.action-icon.spinning[_ngcontent-%COMP%]{display:inline-block;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.login-progress-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0f172ae6;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.75rem;z-index:10;border-radius:.75rem}.login-spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid rgba(6,182,212,.3);border-top-color:#06b6d4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.login-status-text[_ngcontent-%COMP%]{font-size:.875rem;color:#06b6d4;font-weight:500}.detail-login-progress[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;background:#06b6d41a;border:1px solid rgba(6,182,212,.3);border-radius:.5rem;margin-bottom:1rem}.login-progress-text[_ngcontent-%COMP%]{font-size:.875rem;color:#06b6d4}.action-btn-sm.logging-in[_ngcontent-%COMP%]{background:#06b6d433;color:#06b6d4;cursor:not-allowed}.add-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;border:2px dashed var(--border-default, rgba(148, 163, 184, .3));background:transparent;min-height:180px}.add-card[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);background:#06b6d40d}.add-icon[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.add-text[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.account-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;overflow:hidden}.account-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:left;font-size:.75rem;font-weight:600;color:var(--text-muted, #94a3b8);text-transform:uppercase;background:var(--bg-tertiary, rgba(15, 23, 42, .5))}.account-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1));color:var(--text-secondary, #cbd5e1);font-size:.875rem}.account-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#06b6d40d}.account-table[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background:#06b6d41a}.phone-cell[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white)}.device-cell[_ngcontent-%COMP%]{font-size:.75rem}.health-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.table-action[_ngcontent-%COMP%]{padding:.25rem;background:transparent;border:none;cursor:pointer;opacity:.7;transition:opacity .2s}.table-action[_ngcontent-%COMP%]:hover{opacity:1}.table-action.login[_ngcontent-%COMP%]:hover{background:#22c55e33;border-radius:4px}.table-action.logout[_ngcontent-%COMP%]:hover{background:#f59e0b33;border-radius:4px}.table-action.edit[_ngcontent-%COMP%]:hover{background:#3b82f633;border-radius:4px}.table-action.remove[_ngcontent-%COMP%]:hover{background:#ef444433;border-radius:4px}.role-cell[_ngcontent-%COMP%]{min-width:80px}.role-tag-small[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;border-radius:.375rem;font-size:.75rem;font-weight:500;border:1px solid;cursor:pointer;transition:all .2s;white-space:nowrap}.role-tag-small[_ngcontent-%COMP%]:hover{filter:brightness(1.1);transform:scale(1.02)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background:var(--bg-card, rgba(30, 41, 59, .5));border-radius:.75rem;border:1px dashed var(--border-default, rgba(148, 163, 184, .3))}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-primary, white)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--text-muted, #94a3b8)}.detail-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:40}.detail-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:400px;max-width:100%;height:100vh;background:var(--bg-card, rgb(30, 41, 59));border-left:1px solid var(--border-default, rgba(148, 163, 184, .2));z-index:50;display:flex;flex-direction:column;transform:translate(100%);transition:transform .3s}.detail-panel.open[_ngcontent-%COMP%]{transform:translate(0)}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.detail-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);font-size:1.5rem;cursor:pointer}.detail-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.detail-section[_ngcontent-%COMP%]:first-child{text-align:center}.detail-avatar[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.75rem;font-weight:700;color:#fff;margin:0 auto .75rem}.detail-avatar-img[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;object-fit:cover;margin:0 auto .75rem;border:3px solid var(--primary, #06b6d4)}.detail-nickname[_ngcontent-%COMP%]{font-size:.875rem;color:var(--primary, #06b6d4);font-weight:500;margin-bottom:.25rem}.detail-bio[_ngcontent-%COMP%]{margin-top:.75rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1);font-style:italic;text-align:left}.detail-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white)}.detail-phone[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1)}.detail-username[_ngcontent-%COMP%]{color:var(--primary, #06b6d4);font-size:.875rem}.detail-role-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;margin-top:.75rem;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;cursor:pointer;transition:all .2s}.detail-role-badge[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.role-icon-large[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:.375rem;display:flex;align-items:center;justify-content:center;font-size:1.125rem}.role-label[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem}.role-change-hint[_ngcontent-%COMP%]{font-size:.625rem;color:var(--text-muted, #94a3b8);margin-left:.25rem}.role-value[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer}.role-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem;font-weight:500}.role-edit[_ngcontent-%COMP%]{font-size:.75rem;opacity:0;transition:opacity .2s}.role-value[_ngcontent-%COMP%]:hover   .role-edit[_ngcontent-%COMP%]{opacity:1}.detail-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--text-muted, #94a3b8)}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.detail-item.full[_ngcontent-%COMP%]{grid-column:span 2}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-primary, white)}.detail-item[_ngcontent-%COMP%]   .value.status.online[_ngcontent-%COMP%]{color:#22c55e}.detail-item[_ngcontent-%COMP%]   .value.status.offline[_ngcontent-%COMP%]{color:#94a3b8}.detail-item[_ngcontent-%COMP%]   .value.status.banned[_ngcontent-%COMP%]{color:#ef4444}.detail-actions[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1));display:flex;flex-direction:column;gap:.5rem}.detail-actions-grid[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1));display:grid;grid-template-columns:1fr 1fr;gap:.375rem}.action-btn-sm[_ngcontent-%COMP%]{padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;color:var(--text-secondary, #cbd5e1);font-size:.75rem;cursor:pointer;transition:all .2s;text-align:center}.action-btn-sm[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.action-btn-sm[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.action-btn-sm.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);border-color:transparent;color:#fff}.action-btn-sm.warning[_ngcontent-%COMP%]{background:#f59e0b33;border-color:#f59e0b;color:#fcd34d}.action-btn-sm.danger[_ngcontent-%COMP%]{background:#ef44441a;border-color:#ef44444d;color:#f87171}.action-btn-sm.danger[_ngcontent-%COMP%]:hover{background:#ef444433;border-color:#ef4444}.detail-btn[_ngcontent-%COMP%]{padding:.75rem;border:none;border-radius:.5rem;font-weight:500;cursor:pointer;transition:all .2s}.detail-btn.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.detail-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-secondary, #cbd5e1);border:1px solid var(--border-default, rgba(148, 163, 184, .2))}.detail-btn.warning[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.detail-btn.danger[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.detail-btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.action-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:2px;padding:.375rem .5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:none;border-radius:.375rem;cursor:pointer;transition:all .2s;min-width:48px}.action-icon[_ngcontent-%COMP%]{font-size:1rem}.action-label[_ngcontent-%COMP%]{font-size:.625rem;color:var(--text-muted, #94a3b8)}.action-btn[_ngcontent-%COMP%]:hover   .action-label[_ngcontent-%COMP%]{color:var(--text-primary, white)}.action-btn.login[_ngcontent-%COMP%]:hover{background:#22c55e33}.action-btn.logout[_ngcontent-%COMP%]:hover{background:#f59e0b33}.action-btn.edit[_ngcontent-%COMP%]:hover{background:#3b82f633}.action-btn.remove[_ngcontent-%COMP%]:hover{background:#ef444433}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;z-index:100;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-container[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:560px;max-width:95vw;max-height:90vh;background:var(--bg-card, rgb(30, 41, 59));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;z-index:101;display:flex;flex-direction:column;box-shadow:0 20px 60px #00000080}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white);font-size:1.125rem}.modal-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.5rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1))}.tab-nav[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1));padding:0 1rem;overflow-x:auto}.tab-btn[_ngcontent-%COMP%]{padding:.75rem 1rem;background:none;border:none;color:var(--text-muted, #94a3b8);font-size:.875rem;cursor:pointer;white-space:nowrap;border-bottom:2px solid transparent;transition:all .2s}.tab-btn[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.tab-btn.active[_ngcontent-%COMP%]{color:var(--primary, #06b6d4);border-bottom-color:var(--primary, #06b6d4)}.tab-panel[_ngcontent-%COMP%]{padding:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.form-group[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:.625rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;transition:border-color .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.form-row[_ngcontent-%COMP%]   .form-group.flex-2[_ngcontent-%COMP%]{flex:2}.form-row[_ngcontent-%COMP%]   .form-group.flex-1[_ngcontent-%COMP%]{flex:1}.form-hint[_ngcontent-%COMP%]{margin-top:.375rem;font-size:.75rem;color:var(--text-muted, #64748b)}.form-hint.warning[_ngcontent-%COMP%]{color:#f59e0b}.checkbox-label[_ngcontent-%COMP%]{display:flex!important;align-items:center;gap:.5rem;cursor:pointer}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:16px;height:16px;accent-color:var(--primary, #06b6d4)}.role-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:.75rem;margin-top:.5rem}.role-card[_ngcontent-%COMP%]{padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;cursor:pointer;transition:all .2s;text-align:center}.role-card[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);background:#06b6d41a}.role-card.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d433}.role-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-primary, white);margin-bottom:.25rem}.role-desc[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.slider-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.slider-group[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);min-width:32px}.slider-group[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{flex:1;height:4px;accent-color:var(--primary, #06b6d4)}.test-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer;transition:all .2s;margin-bottom:.75rem}.test-btn[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.test-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.test-result[_ngcontent-%COMP%]{padding:.5rem .75rem;border-radius:.375rem;font-size:.875rem;margin-bottom:1rem}.test-result.success[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.test-result.error[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.btn-cancel[_ngcontent-%COMP%]{padding:.625rem 1.25rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer;transition:all .2s}.btn-cancel[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.btn-save[_ngcontent-%COMP%]{padding:.625rem 1.25rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;transition:all .2s}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.btn-save[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.batch-modal[_ngcontent-%COMP%]{width:640px;max-height:85vh}.batch-warning[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#f59e0b26;border:1px solid rgba(245,158,11,.3);border-radius:.5rem;color:#fcd34d;font-size:.875rem;margin:1rem 1.5rem}.batch-section[_ngcontent-%COMP%]{border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.5rem;margin:0 1.5rem 1rem;overflow:hidden}.batch-section-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));cursor:pointer;font-size:.875rem;color:var(--text-primary, white)}.batch-section-header[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:16px;height:16px;accent-color:var(--primary, #06b6d4)}.batch-section-content[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1))}.role-grid.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:.5rem}.role-grid.compact[_ngcontent-%COMP%]   .role-card[_ngcontent-%COMP%]{padding:.5rem}.role-grid.compact[_ngcontent-%COMP%]   .role-name[_ngcontent-%COMP%]{font-size:.75rem}.account-role-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.5rem}.account-role-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.account-role-card[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.account-role-card.selected[_ngcontent-%COMP%]{background:#06b6d41a}.role-card-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:.375rem;display:flex;align-items:center;justify-content:center;font-size:1.125rem;flex-shrink:0}.role-card-content[_ngcontent-%COMP%]{flex:1;min-width:0}.role-card-name[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem}.role-card-desc[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.role-card-check[_ngcontent-%COMP%]{font-weight:700;font-size:1rem}.tag-filter-dropdown[_ngcontent-%COMP%]{position:relative}.filter-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;color:var(--text-secondary, #cbd5e1);font-size:.875rem;cursor:pointer}.filter-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4)}.tag-count[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff;padding:.125rem .375rem;border-radius:9999px;font-size:.75rem}.tag-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;margin-top:.25rem;min-width:200px;background:var(--bg-card, rgba(30, 41, 59, .95));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;padding:.5rem;z-index:100;box-shadow:0 4px 12px #0000004d}.tag-dropdown-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.25rem .5rem .5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1));margin-bottom:.5rem;font-size:.75rem;color:var(--text-secondary, #94a3b8)}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.75rem}.tag-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.375rem .5rem;cursor:pointer;border-radius:.25rem}.tag-option[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary, rgba(15, 23, 42, .5))}.tag-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%}.manage-tags-btn[_ngcontent-%COMP%]{width:100%;padding:.5rem;margin-top:.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px dashed var(--border-default, rgba(148, 163, 184, .3));border-radius:.375rem;color:var(--text-secondary, #94a3b8);cursor:pointer;font-size:.75rem}.manage-tags-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.manage-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;color:var(--text-secondary, #cbd5e1);font-size:.875rem;cursor:pointer}.manage-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.card-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.25rem;margin-top:.5rem}.tag-badge[_ngcontent-%COMP%]{padding:.125rem .375rem;border-radius:.25rem;font-size:.625rem;color:#fff;font-weight:500}.tag-badge.large[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.75rem}.tag-more[_ngcontent-%COMP%]{padding:.125rem .375rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.25rem;font-size:.625rem;color:var(--text-secondary, #94a3b8)}.tag-manager-modal[_ngcontent-%COMP%], .group-manager-modal[_ngcontent-%COMP%], .account-tag-modal[_ngcontent-%COMP%]{width:480px;max-height:70vh}.add-tag-form[_ngcontent-%COMP%], .add-group-form[_ngcontent-%COMP%]{display:flex;gap:.5rem;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.tag-input[_ngcontent-%COMP%], .group-input[_ngcontent-%COMP%]{flex:1;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;color:var(--text-primary, white);font-size:.875rem}.color-picker[_ngcontent-%COMP%]{width:40px;height:36px;padding:0;border:none;border-radius:.375rem;cursor:pointer}.color-picker.small[_ngcontent-%COMP%]{width:32px;height:32px}.btn-add[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.375rem;color:#fff;cursor:pointer;font-size:.875rem}.btn-add[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.tag-list[_ngcontent-%COMP%], .group-list[_ngcontent-%COMP%]{padding:1rem 1.5rem;max-height:300px;overflow-y:auto}.tag-item[_ngcontent-%COMP%], .group-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .3));border-radius:.5rem;margin-bottom:.5rem}.tag-preview[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem;color:#fff;min-width:60px;text-align:center}.tag-edit-input[_ngcontent-%COMP%], .group-edit-input[_ngcontent-%COMP%]{flex:1;padding:.375rem .5rem;background:var(--bg-card, rgba(30, 41, 59, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.25rem;color:var(--text-primary, white);font-size:.875rem}.btn-delete[_ngcontent-%COMP%]{padding:.375rem .5rem;background:none;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.25rem;color:var(--text-secondary, #94a3b8);cursor:pointer}.btn-delete[_ngcontent-%COMP%]:hover{border-color:#ef4444;color:#ef4444;background:#ef44441a}.group-color-bar[_ngcontent-%COMP%]{width:4px;height:40px;border-radius:2px}.group-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.group-count[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #94a3b8)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--text-secondary, #94a3b8)}.empty-state[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4);cursor:pointer}.account-tags-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:.75rem;padding:1.5rem}.account-tag-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .3));border:2px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.account-tag-option[_ngcontent-%COMP%]:hover{border-color:var(--border-default, rgba(148, 163, 184, .3))}.account-tag-option.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.account-tag-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.quick-add-tag[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1));margin-top:.5rem}.quick-add-form[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.tag-input-inline[_ngcontent-%COMP%]{flex:1;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;color:var(--text-primary, white);font-size:.875rem}.tag-input-inline[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.color-picker-inline[_ngcontent-%COMP%]{width:36px;height:36px;padding:0;border:none;border-radius:.375rem;cursor:pointer}.btn-quick-add[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);color:#fff;border:none;border-radius:.375rem;font-size:.875rem;cursor:pointer;white-space:nowrap}.btn-quick-add[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary-hover, #0891b2)}.btn-quick-add[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal-footer[_ngcontent-%COMP%]   .btn-manage[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-secondary, #94a3b8);border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;font-size:.875rem;cursor:pointer}.modal-footer[_ngcontent-%COMP%]   .btn-manage[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .5));color:var(--text-primary, white)}.modal-footer[_ngcontent-%COMP%]   .footer-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.account-tag-modal[_ngcontent-%COMP%]   .modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.detail-item.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.detail-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.375rem;margin-top:.25rem}.no-tags[_ngcontent-%COMP%]{color:var(--text-secondary, #94a3b8);font-size:.75rem}.persona-manager-modal[_ngcontent-%COMP%]{width:720px;max-height:85vh}.persona-editor-modal[_ngcontent-%COMP%]{width:600px;max-height:90vh}.persona-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.persona-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.persona-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4)}.persona-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d433,#3b82f633);border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.persona-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;padding:1rem 1.5rem;max-height:400px;overflow-y:auto}.persona-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid transparent;border-radius:.75rem;cursor:pointer;transition:all .2s}.persona-card[_ngcontent-%COMP%]:hover{border-color:var(--border-default, rgba(148, 163, 184, .3))}.persona-card.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.persona-card.horizontal[_ngcontent-%COMP%]{flex-direction:row;align-items:center}.persona-icon[_ngcontent-%COMP%]{font-size:2rem;width:48px;height:48px;display:flex;align-items:center;justify-content:center;background:var(--bg-card, rgba(30, 41, 59, .5));border-radius:.5rem}.persona-info[_ngcontent-%COMP%]{flex:1}.persona-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-primary, white);margin-bottom:.25rem}.persona-desc[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #94a3b8);line-height:1.4}.persona-meta[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.meta-tag[_ngcontent-%COMP%]{padding:.125rem .375rem;background:var(--bg-card, rgba(30, 41, 59, .5));border-radius:.25rem;font-size:.625rem;color:var(--text-secondary, #94a3b8)}.persona-actions[_ngcontent-%COMP%]{display:flex;gap:.25rem}.action-btn[_ngcontent-%COMP%]{padding:.375rem .5rem;background:var(--bg-card, rgba(30, 41, 59, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.25rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.action-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.action-btn.danger[_ngcontent-%COMP%]:hover{border-color:#ef4444;color:#ef4444}.custom-persona-section[_ngcontent-%COMP%]{padding:1rem 1.5rem}.btn-new-persona[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:linear-gradient(135deg,#06b6d433,#3b82f633);border:1px dashed var(--primary, #06b6d4);border-radius:.5rem;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem;margin-bottom:1rem}.btn-new-persona[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#06b6d44d,#3b82f64d)}.custom-persona-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:300px;overflow-y:auto}.persona-form[_ngcontent-%COMP%]{padding:1rem 1.5rem;display:flex;flex-direction:column;gap:1rem}.icon-input[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem!important}.persona-select-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.current-persona[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.375rem;cursor:pointer}.current-persona[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4)}.persona-icon-small[_ngcontent-%COMP%]{font-size:1.25rem}.persona-name-small[_ngcontent-%COMP%]{color:var(--text-primary, white);font-size:.875rem}.no-persona[_ngcontent-%COMP%]{color:var(--text-secondary, #94a3b8);font-size:.875rem}.select-arrow[_ngcontent-%COMP%]{margin-left:auto;color:var(--text-secondary, #94a3b8);font-size:.75rem}.btn-persona-manager[_ngcontent-%COMP%]{padding:.5rem .75rem;background:linear-gradient(135deg,#06b6d433,#3b82f633);border:1px solid var(--primary, #06b6d4);border-radius:.375rem;color:var(--primary, #06b6d4);cursor:pointer;font-size:.75rem;white-space:nowrap}.btn-persona-manager[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#06b6d44d,#3b82f64d)}"]})}};function q7(i,e){if(i&1){let t=I();r(0,"button",21),x("click",function(){_(t);let o=m();return v(o.showUpgrade())}),l(1," \u5347\u7D1A\u89E3\u9396\u66F4\u591A "),s()}}function W7(i,e){i&1&&(r(0,"span",22),l(1,"\u23F3"),s(),l(2," \u5C0E\u5165\u4E2D... "))}function z7(i,e){i&1&&(r(0,"span"),l(1,"\u{1F4E5}"),s(),l(2," \u5C0E\u5165 Session "))}var yc=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.dialog=F(st);this.membershipService=F(Ie);this.accountService=F(pt);this.accounts=this.accountService.accounts;this.isImportingSession=f(!1);this.ipcCleanup=[]}ngOnInit(){this.loadAccounts(),this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}loadAccounts(){this.ipc.send("get-accounts")}setupIpcListeners(){let e=this.ipc.on("session-import-result",n=>{if(this.isImportingSession.set(!1),n.success){let o=n.phone?`\u2705 Session \u5C0E\u5165\u6210\u529F: ${n.phone}`:`\u2705 Session \u5C0E\u5165\u5B8C\u6210: ${n.count||1} \u500B\u5E33\u865F`;this.toast.success(o),this.reloadAccounts()}else this.toast.error(`\u274C \u5C0E\u5165\u5931\u6557: ${n.message||"\u672A\u77E5\u932F\u8AA4"}`)}),t=this.ipc.on("session-import-error",n=>{this.isImportingSession.set(!1),this.toast.error(`\u274C Session \u5C0E\u5165\u5931\u6557: ${n.error}`)});this.ipcCleanup.push(e,t)}t(e,t){return this.i18n.t(e,t)}navigateTo(e){let n={"add-account":"add-account","api-credentials":"api-credentials",accounts:"accounts",settings:"settings"}[e]||e;this.nav.navigateTo(n)}showUpgrade(){this.toast.info("\u8ACB\u5347\u7D1A\u6703\u54E1\u4EE5\u89E3\u9396\u66F4\u591A\u529F\u80FD")}openQrLogin(){this.dialog.openQrLogin()}importSession(){this.isImportingSession.set(!0),this.toast.info("\u6B63\u5728\u6253\u958B\u6587\u4EF6\u9078\u64C7\u5668..."),this.ipc.send("import-session"),setTimeout(()=>{this.isImportingSession()&&this.isImportingSession.set(!1)},3e4)}reloadAccounts(){this.ipc.send("get-accounts"),this.toast.info("\u6B63\u5728\u5237\u65B0\u5E33\u6236\u5217\u8868...")}refreshQueueStatus(){this.ipc.send("get-queue-status")}loginAccount(e){this.accountService.loginAccount(e)}logoutAccount(e){this.accountService.logoutAccount(e)}removeAccount(e){this.dialog.confirm({title:"\u78BA\u8A8D\u522A\u9664",message:"\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5E33\u6236\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002",type:"danger",confirmText:"\u522A\u9664",onConfirm:()=>{this.accountService.removeAccount(e)}})}exportAccount(e){this.ipc.send("export-session",{phone:e}),this.toast.info("\u6B63\u5728\u5C0E\u51FA Session...")}editAccount(e){this.accountService.toggleSelection(e.id),this.toast.info(`\u7DE8\u8F2F\u5E33\u6236: ${e.phone}`)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-accounts-view"]],decls:37,vars:9,consts:[[1,"flex","items-center","justify-between","mb-6"],["id","accounts-section",1,"text-4xl","font-bold","text-slate-900","dark:text-white"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-slate-500"],[1,"text-lg","font-bold","px-3","py-1","rounded-lg"],[1,"text-xs","px-3","py-1","bg-gradient-to-r","from-amber-500","to-orange-500","text-white","rounded-full","hover:opacity-90","transition-opacity"],[1,"bg-slate-100/50","dark:bg-slate-900/50","backdrop-blur-sm","border","border-slate-500/20","p-4","rounded-xl","shadow-lg","mb-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"flex","items-center","gap-2","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-600","hover:to-blue-600","text-white","text-sm","font-bold","py-2","px-4","rounded-lg","transition","duration-200","shadow-lg","shadow-cyan-500/20",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],[1,"flex","items-center","gap-2","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","text-sm","font-bold","py-2","px-4","rounded-lg","transition","duration-200","shadow-lg","shadow-amber-500/20",3,"click"],["x","3","y","11","width","18","height","11","rx","2","ry","2"],["d","M7 11V7a5 5 0 0 1 10 0v4"],[1,"flex","items-center","gap-2","bg-gradient-to-r","from-emerald-500","to-teal-500","hover:from-emerald-600","hover:to-teal-600","text-white","text-sm","font-bold","py-2","px-4","rounded-lg","transition","duration-200","shadow-lg","shadow-emerald-500/20",3,"click"],[1,"flex","items-center","gap-2","bg-slate-200","dark:bg-slate-800/50","hover:bg-slate-300","dark:hover:bg-slate-700/50","disabled:opacity-50","disabled:cursor-not-allowed","text-sm","font-bold","py-2","px-4","rounded-lg","transition","duration-200",3,"click","disabled"],["title","\u5237\u65B0\u5E33\u6236\u5217\u8868",1,"flex","items-center","gap-2","bg-slate-200","dark:bg-slate-800/50","hover:bg-slate-300","dark:hover:bg-slate-700/50","text-sm","py-2","px-3","rounded-lg","transition","duration-200",3,"click"],["title","\u5237\u65B0\u968A\u5217\u72C0\u614B",1,"flex","items-center","gap-2","bg-slate-200","dark:bg-slate-800/50","hover:bg-slate-300","dark:hover:bg-slate-700/50","text-sm","py-2","px-3","rounded-lg","transition","duration-200",3,"click"],[3,"addAccount","accountLogin","accountLogout","accountRemove","accountExport","accountEdit","accounts"],[1,"text-xs","px-3","py-1","bg-gradient-to-r","from-amber-500","to-orange-500","text-white","rounded-full","hover:opacity-90","transition-opacity",3,"click"],[1,"animate-spin"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"h2",1),l(2),s(),r(3,"div",2)(4,"span",3),l(5,"\u8CEC\u6236\u914D\u984D:"),s(),r(6,"span",4),l(7),s(),y(8,q7,2,0,"button",5),s()(),r(9,"div",6)(10,"div",7)(11,"div",8)(12,"button",9),x("click",function(){return n.navigateTo("add-account")}),ne(),r(13,"svg",10),B(14,"line",11)(15,"line",12),s(),l(16," \u6DFB\u52A0\u5E33\u6236 "),s(),ce(),r(17,"button",13),x("click",function(){return n.navigateTo("api-credentials")}),ne(),r(18,"svg",10),B(19,"rect",14)(20,"path",15),s(),l(21," API \u6191\u64DA\u6C60 "),s(),ce(),r(22,"button",16),x("click",function(){return n.openQrLogin()}),r(23,"span"),l(24,"\u{1F4F1}"),s(),l(25," \u6383\u78BC\u767B\u5165 "),s(),r(26,"button",17),x("click",function(){return n.importSession()}),y(27,W7,3,0)(28,z7,3,0),s()(),r(29,"div",2)(30,"button",18),x("click",function(){return n.reloadAccounts()}),r(31,"span"),l(32,"\u{1F504}"),s()(),r(33,"button",19),x("click",function(){return n.refreshQueueStatus()}),r(34,"span"),l(35,"\u{1F4CA}"),s()()()()(),r(36,"app-account-card-list",20),x("addAccount",function(){return n.navigateTo("add-account")})("accountLogin",function(a){return n.loginAccount(a.id)})("accountLogout",function(a){return n.logoutAccount(a.id)})("accountRemove",function(a){return n.removeAccount(a.id)})("accountExport",function(a){return n.exportAccount(a.phone)})("accountEdit",function(a){return n.editAccount(a)}),s()),t&2&&(c(2),D(n.t("manageAccounts")),c(4),de(n.membershipService.quotas().maxAccounts===-1?"bg-emerald-500/20 text-emerald-400":n.accounts().length>=n.membershipService.quotas().maxAccounts?"bg-red-500/20 text-red-400":"bg-cyan-500/20 text-cyan-400"),c(),X(" ",n.accounts().length,"/",n.membershipService.quotas().maxAccounts===-1?"\u221E":n.membershipService.quotas().maxAccounts," "),c(),S(n.membershipService.quotas().maxAccounts!==-1&&n.accounts().length>=n.membershipService.quotas().maxAccounts?8:-1),c(18),L("disabled",n.isImportingSession()),c(),S(n.isImportingSession()?27:28),c(9),L("accounts",n.accounts()))},dependencies:[oe,ae,Cc],encapsulation:2,changeDetection:0})}};var K7=(i,e)=>e.id;function j7(i,e){i&1&&(T(0,"div",23),ne(),T(1,"svg",24),Se(2,"path",25),k()())}function J7(i,e){if(i&1){let t=I();T(0,"button",17),se("click",function(){let o=_(t).$implicit,a=m();return v(a.selectAnimation(o.id))})("mouseenter",function(){let o=_(t).$implicit,a=m();return v(a.previewAnimation(o.id))})("mouseleave",function(){_(t);let o=m();return v(o.stopPreview())}),T(1,"div",18)(2,"span",19),l(3),k()(),T(4,"div",20)(5,"span",21),l(6),k(),T(7,"span",22),l(8),k()(),y(9,j7,3,0,"div",23),k()}if(i&2){let t=e.$implicit,n=m();N("active",n.currentType()===t.id),c(),N("animating",n.previewingType()===t.id),c(2),D(t.preview),c(3),D(t.name),c(2),D(t.description),c(),S(n.currentType()===t.id?9:-1)}}var Sc=class i{constructor(){this.animationConfig=F(Ei);this.toast=F(J);this.options=ii;this.currentType=this.animationConfig.animationType;this.previewingType=f(null);this.isPlaying=f(!1)}selectAnimation(e){this.animationConfig.setAnimationType(e),this.toast.success(`\u5DF2\u5207\u63DB\u70BA\u300C${this.options.find(t=>t.id===e)?.name}\u300D\u52D5\u756B`)}previewAnimation(e){this.previewingType.set(e)}stopPreview(){this.previewingType.set(null)}resetToDefault(){this.animationConfig.resetToDefault(),this.toast.info("\u5DF2\u91CD\u7F6E\u70BA\u9ED8\u8A8D\u52D5\u756B")}triggerPreview(){this.isPlaying.set(!0),setTimeout(()=>this.isPlaying.set(!1),700)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-animation-selector"]],decls:31,vars:3,consts:[[1,"animation-selector"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-2"],[1,"text-xl"],[1,"text-lg","font-semibold","text-white"],[1,"text-xs","px-2","py-1","rounded","bg-slate-700","hover:bg-slate-600","text-slate-300","transition-colors",3,"click"],[1,"text-sm","text-slate-400","mb-4"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-3"],[1,"animation-option","group",3,"active"],[1,"mt-6","p-4","rounded-lg","bg-slate-800/50","border","border-slate-700"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","text-slate-400"],[1,"text-xs","px-3","py-1","rounded-full","bg-cyan-500/20","text-cyan-400","hover:bg-cyan-500/30","transition-colors",3,"click"],[1,"preview-container"],[1,"preview-page","from"],[1,"page-icon"],[1,"preview-page","to"],[1,"animation-option","group",3,"click","mouseenter","mouseleave"],[1,"preview-icon"],[1,"text-2xl"],[1,"option-info"],[1,"option-name"],[1,"option-desc"],[1,"selected-badge"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"\u2728"),k(),T(5,"h3",4),l(6,"\u9801\u9762\u5207\u63DB\u52D5\u756B"),k()(),T(7,"button",5),se("click",function(){return n.resetToDefault()}),l(8," \u91CD\u7F6E\u9ED8\u8A8D "),k()(),T(9,"p",6),l(10," \u9078\u64C7\u9801\u9762\u5207\u63DB\u6642\u7684\u52D5\u756B\u6548\u679C\uFF0C\u8B93\u60A8\u7684\u64CD\u4F5C\u9AD4\u9A57\u66F4\u52A0\u6D41\u66A2\u3002 "),k(),T(11,"div",7),O(12,J7,10,8,"button",8,K7),k(),T(14,"div",9)(15,"div",10)(16,"span",11),l(17,"\u7576\u524D\u6548\u679C\u9810\u89BD"),k(),T(18,"button",12),se("click",function(){return n.triggerPreview()}),l(19," \u64AD\u653E\u9810\u89BD "),k()(),T(20,"div",13)(21,"div",14)(22,"div",15),l(23,"\u{1F4CB}"),k(),T(24,"span"),l(25,"\u820A\u9801\u9762"),k()(),T(26,"div",16)(27,"div",15),l(28,"\u{1F4C4}"),k(),T(29,"span"),l(30,"\u65B0\u9801\u9762"),k()()()()()),t&2&&(c(12),U(n.options),c(8),N("animate",n.isPlaying()),c(6),_t("data-animation",n.currentType()))},dependencies:[oe],styles:[".animation-selector[_ngcontent-%COMP%]{padding:1rem}.animation-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:1rem;border-radius:.75rem;background:#1e293b80;border:2px solid transparent;transition:all .2s ease;cursor:pointer;position:relative}.animation-option[_ngcontent-%COMP%]:hover{background:#1e293bcc;border-color:#06b6d44d}.animation-option.active[_ngcontent-%COMP%]{background:#06b6d41a;border-color:#06b6d4}.preview-icon[_ngcontent-%COMP%]{width:48px;height:48px;display:flex;align-items:center;justify-content:center;margin-bottom:.5rem;transition:transform .3s ease}.preview-icon.animating[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce .5s ease infinite}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-5px)}}.option-info[_ngcontent-%COMP%]{text-align:center}.option-name[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:600;color:#fff;margin-bottom:.25rem}.option-desc[_ngcontent-%COMP%]{display:block;font-size:.75rem;color:#94a3b8}.selected-badge[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:#06b6d4;color:#fff}.preview-container[_ngcontent-%COMP%]{position:relative;height:80px;background:#0f172a80;border-radius:.5rem;overflow:hidden}.preview-page[_ngcontent-%COMP%]{position:absolute;inset:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#1e293bcc;border-radius:.375rem;color:#fff;font-size:.75rem}.preview-page.from[_ngcontent-%COMP%]{z-index:1}.preview-page.to[_ngcontent-%COMP%]{z-index:2;opacity:0}.page-icon[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:.25rem}.preview-container.animate[_ngcontent-%COMP%]   .preview-page.from[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_page-out .6s ease forwards}.preview-container.animate[_ngcontent-%COMP%]   .preview-page.to[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_page-in .6s ease forwards}@keyframes _ngcontent-%COMP%_page-out{to{opacity:0;transform:scale(.95)}}@keyframes _ngcontent-%COMP%_page-in{0%{opacity:0;transform:scale(1.05)}to{opacity:1;transform:scale(1)}}.preview-page.to[data-animation=fade][_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_fade-in}.preview-page.to[data-animation=slide][_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_slide-in}.preview-page.to[data-animation=slideUp][_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_slide-up-in}.preview-page.to[data-animation=scale][_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_scale-in}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slide-in{0%{opacity:0;transform:translate(100%)}to{opacity:1;transform:translate(0)}}@keyframes _ngcontent-%COMP%_slide-up-in{0%{opacity:0;transform:translateY(100%)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}"]})}};var Q7=(i,e)=>e.code,Y7=(i,e)=>e.id,X7=(i,e)=>e.name;function Z7(i,e){if(i&1&&(r(0,"option",18),l(1),s()),i&2){let t=e.$implicit,n=m(2);L("value",t.code)("selected",n.i18n.locale()===t.code),c(),X(" ",t.flag," ",t.nativeName," ")}}function ek(i,e){if(i&1){let t=I();r(0,"div",6),B(1,"app-animation-selector"),s(),r(2,"div",6)(3,"div",7)(4,"span",8),l(5,"\u{1F3A8}"),s(),r(6,"h3",9),l(7,"\u4E3B\u984C\u8A2D\u7F6E"),s()(),r(8,"div",10)(9,"button",11),x("click",function(){_(t);let o=m();return v(o.setTheme("dark"))}),r(10,"div",12)(11,"div",13)(12,"span",8),l(13,"\u{1F319}"),s()(),r(14,"span",14),l(15,"\u6DF1\u8272\u4E3B\u984C"),s()()(),r(16,"button",11),x("click",function(){_(t);let o=m();return v(o.setTheme("light"))}),r(17,"div",12)(18,"div",15)(19,"span",8),l(20,"\u2600\uFE0F"),s()(),r(21,"span",14),l(22,"\u6DFA\u8272\u4E3B\u984C"),s()()(),r(23,"button",11),x("click",function(){_(t);let o=m();return v(o.setTheme("system"))}),r(24,"div",12)(25,"div",16)(26,"span",8),l(27,"\u{1F4BB}"),s()(),r(28,"span",14),l(29,"\u8DDF\u96A8\u7CFB\u7D71"),s()()()()(),r(30,"div",4)(31,"div",7)(32,"span",8),l(33,"\u{1F310}"),s(),r(34,"h3",9),l(35,"\u8A9E\u8A00\u8A2D\u7F6E"),s()(),r(36,"select",17),x("change",function(o){_(t);let a=m();return v(a.onLocaleChange(o))}),O(37,Z7,2,4,"option",18,Q7),s()()}if(i&2){let t=m();c(9),N("border-cyan-500",t.settings.settings().theme==="dark")("border-slate-700",t.settings.settings().theme!=="dark")("bg-slate-800",!0),c(7),N("border-cyan-500",t.settings.settings().theme==="light")("border-slate-700",t.settings.settings().theme!=="light")("bg-slate-800",!0),c(7),N("border-cyan-500",t.settings.settings().theme==="system")("border-slate-700",t.settings.settings().theme!=="system")("bg-slate-800",!0),c(14),U(t.supportedLocales)}}function tk(i,e){if(i&1){let t=I();r(0,"tr",30)(1,"td",31),l(2),s(),r(3,"td",32),l(4),s(),r(5,"td",32),l(6),s(),r(7,"td",33)(8,"button",34),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.restoreBackup(o.id))}),l(9," \u6062\u5FA9 "),s(),r(10,"button",35),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.deleteBackup(o.id))}),l(11," \u522A\u9664 "),s()()()}if(i&2){let t=e.$implicit;c(2),D(t.name),c(2),D(t.created_at),c(2),D(t.size||"N/A")}}function nk(i,e){if(i&1&&(r(0,"div",24)(1,"table",26)(2,"thead",27)(3,"tr")(4,"th",28),l(5,"\u5099\u4EFD\u540D\u7A31"),s(),r(6,"th",28),l(7,"\u5275\u5EFA\u6642\u9593"),s(),r(8,"th",28),l(9,"\u5927\u5C0F"),s(),r(10,"th",29),l(11,"\u64CD\u4F5C"),s()()(),r(12,"tbody"),O(13,tk,12,3,"tr",30,Y7),s()()()),i&2){let t=m(2);c(13),U(t.backup.backups())}}function ik(i,e){i&1&&(r(0,"p",25),l(1,"\u66AB\u7121\u5099\u4EFD"),s())}function ok(i,e){if(i&1){let t=I();r(0,"div",4)(1,"div",19)(2,"h3",20),l(3," \u{1F4BE} \u5099\u4EFD\u7BA1\u7406 "),s(),r(4,"div",21)(5,"button",22),x("click",function(){_(t);let o=m();return v(o.createBackup())}),l(6),s(),r(7,"button",23),x("click",function(){_(t);let o=m();return v(o.loadBackups())}),l(8," \u5237\u65B0 "),s()()(),y(9,nk,15,0,"div",24)(10,ik,2,0,"p",25),s()}if(i&2){let t=m();c(5),L("disabled",t.backup.isCreating()),c(),M(" ",t.backup.isCreating()?"\u5275\u5EFA\u4E2D...":"\u5275\u5EFA\u5099\u4EFD"," "),c(3),S(t.backup.backups().length>0?9:10)}}function rk(i,e){if(i&1){let t=I();r(0,"button",47),x("click",function(){_(t);let o=m(2);return v(o.stopScheduler())}),l(1," \u23F9\uFE0F \u505C\u6B62 "),s()}}function sk(i,e){if(i&1){let t=I();r(0,"button",48),x("click",function(){_(t);let o=m(2);return v(o.startScheduler())}),l(1," \u25B6\uFE0F \u555F\u52D5 "),s()}}function ak(i,e){if(i&1){let t=I();r(0,"tr",30)(1,"td",49),l(2),s(),r(3,"td",32),l(4),s(),r(5,"td",32),l(6),s(),r(7,"td",50)(8,"span",51),l(9),s()(),r(10,"td",33)(11,"button",52),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.runTask(o.name))}),l(12," \u57F7\u884C "),s()()()}if(i&2){let t=e.$implicit,n=m(3);c(2),D(t.name),c(2),D(n.scheduler.formatInterval(t.interval)),c(2),D(t.lastRun||"\u5F9E\u672A"),c(2),N("bg-green-500/20",t.status==="running")("text-green-400",t.status==="running")("bg-slate-500/20",t.status==="idle")("text-slate-400",t.status==="idle")("bg-red-500/20",t.status==="error")("text-red-400",t.status==="error"),c(),X(" ",n.scheduler.getTaskStatusIcon(t.status)," ",t.status," "),c(2),L("disabled",t.status==="running")}}function lk(i,e){if(i&1&&(r(0,"div",24)(1,"table",26)(2,"thead",27)(3,"tr")(4,"th",28),l(5,"\u4EFB\u52D9\u540D\u7A31"),s(),r(6,"th",28),l(7,"\u9593\u9694"),s(),r(8,"th",28),l(9,"\u4E0A\u6B21\u57F7\u884C"),s(),r(10,"th",28),l(11,"\u72C0\u614B"),s(),r(12,"th",29),l(13,"\u64CD\u4F5C"),s()()(),r(14,"tbody"),O(15,ak,13,18,"tr",30,X7),s()()()),i&2){let t=m(2);c(15),U(t.scheduler.tasks())}}function ck(i,e){i&1&&(r(0,"p",25),l(1,"\u66AB\u7121\u8ABF\u5EA6\u4EFB\u52D9"),s())}function dk(i,e){if(i&1){let t=I();r(0,"div",4)(1,"div",36)(2,"h3",20),l(3," \u23F0 \u4EFB\u52D9\u8ABF\u5EA6 "),s(),r(4,"div",21),y(5,rk,2,0,"button",37)(6,sk,2,0,"button",38),r(7,"button",39),x("click",function(){_(t);let o=m();return v(o.loadSchedulerStatus())}),l(8," \u{1F504} \u5237\u65B0 "),s()()(),r(9,"div",40)(10,"div",41)(11,"div",42),l(12,"\u72C0\u614B"),s(),r(13,"div",43),l(14),s()(),r(15,"div",41)(16,"div",42),l(17,"\u904B\u884C\u6642\u9593"),s(),r(18,"div",44),l(19),s()(),r(20,"div",41)(21,"div",42),l(22,"\u7E3D\u4EFB\u52D9"),s(),r(23,"div",45),l(24),s()(),r(25,"div",41)(26,"div",42),l(27,"\u6D3B\u8E8D\u4EFB\u52D9"),s(),r(28,"div",46),l(29),s()()(),y(30,lk,17,0,"div",24)(31,ck,2,0,"p",25),s()}if(i&2){let t=m();c(5),S(t.scheduler.isRunning()?5:6),c(8),N("text-green-400",t.scheduler.isRunning())("text-slate-400",!t.scheduler.isRunning()),c(),M(" ",t.scheduler.isRunning()?"\u904B\u884C\u4E2D":"\u5DF2\u505C\u6B62"," "),c(5),D(t.scheduler.uptimeFormatted()),c(5),D(t.scheduler.status().totalTasks),c(5),D(t.scheduler.status().activeTasks),c(),S(t.scheduler.tasks().length>0?30:31)}}function uk(i,e){if(i&1&&(l(0),Ee(1,"date")),i&2){let t=m(2);M(" \u6709\u6548\u671F\u81F3: ",yt(1,1,t.membershipService.expiresAt(),"yyyy-MM-dd")," ")}}function mk(i,e){i&1&&l(0," \u6C38\u4E45\u6709\u6548 ")}function pk(i,e){if(i&1&&(r(0,"div",5)(1,"div",4)(2,"h3",53),l(3,"\u6703\u54E1\u4FE1\u606F"),s(),r(4,"div",54)(5,"div",55),l(6),s(),r(7,"div")(8,"p",56),l(9),s(),r(10,"p",57),y(11,uk,2,4)(12,mk,1,0),s()()()(),r(13,"div",4)(14,"h3",53),l(15,"\u7248\u672C\u4FE1\u606F"),s(),r(16,"div",58)(17,"p")(18,"strong",59),l(19,"\u7248\u672C\uFF1A"),s(),l(20,"2.0.0"),s(),r(21,"p")(22,"strong",59),l(23,"\u69CB\u5EFA\u65E5\u671F\uFF1A"),s(),l(24,"2026-01"),s(),r(25,"p")(26,"strong",59),l(27,"\u6280\u8853\u68E7\uFF1A"),s(),l(28,"Angular 19 + Electron + Python"),s(),r(29,"p")(30,"strong",59),l(31,"\u52D5\u756B\u6A21\u5F0F\uFF1A"),s(),l(32),s()()()()),i&2){let t=m();c(6),M(" ",t.getMembershipIcon()," "),c(3),D(t.getMembershipName()),c(2),S(t.membershipService.expiresAt()?11:12),c(21),D(t.animationConfig.animationType())}}var wc=class i{constructor(){this.i18n=F(Be);this.membershipService=F(Ie);this.settings=F(Jo);this.backup=F(Yo);this.scheduler=F(Xo);this.animationConfig=F(Ei);this.activeTab=f("appearance");this.supportedLocales=ni}ngOnInit(){this.settings.loadSettings()}t(e,t){return this.i18n.t(e,t)}setTheme(e){this.settings.setTheme(e)}onLocaleChange(e){let t=e.target.value;this.i18n.setLocale(t),this.settings.setLanguage(t)}loadBackups(){this.backup.loadBackups()}createBackup(){this.backup.createBackup()}restoreBackup(e){this.backup.restoreBackup(e)}deleteBackup(e){this.backup.deleteBackup(e)}loadSchedulerStatus(){this.scheduler.loadStatus()}startScheduler(){this.scheduler.start()}stopScheduler(){this.scheduler.stop()}runTask(e){this.scheduler.runTask(e)}getMembershipIcon(){let e=this.membershipService.level();return{free:"\u{1F193}",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[e]||"\u{1F193}"}getMembershipName(){let e=this.membershipService.level();return{free:"\u514D\u8CBB\u9AD4\u9A57\u7248",silver:"\u9280\u724C\u6703\u54E1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u7CBE\u82F1",star:"\u81F3\u5C0A\u661F\u8000",king:"\u7D42\u6975\u738B\u8005"}[e]||"\u514D\u8CBB\u9AD4\u9A57\u7248"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-settings-view"]],decls:16,vars:13,consts:[[1,"max-w-6xl","mx-auto","p-6"],[1,"text-4xl","font-bold","mb-8","text-white"],[1,"flex","gap-2","mb-6","bg-slate-800/50","p-1","rounded-lg","w-fit"],[1,"px-4","py-2","rounded-lg","transition-all","flex","items-center","gap-2","text-sm",3,"click"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","p-6","rounded-xl","shadow-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","p-6","rounded-xl","shadow-lg","mb-6"],[1,"flex","items-center","gap-2","mb-4"],[1,"text-xl"],[1,"text-lg","font-semibold","text-white"],[1,"grid","grid-cols-3","gap-4"],[1,"p-4","rounded-xl","border-2","transition-all",3,"click"],[1,"flex","flex-col","items-center","gap-2"],[1,"w-12","h-12","rounded-lg","bg-slate-900","border","border-slate-600","flex","items-center","justify-center"],[1,"text-sm","font-medium","text-white"],[1,"w-12","h-12","rounded-lg","bg-white","border","border-slate-300","flex","items-center","justify-center"],[1,"w-12","h-12","rounded-lg","bg-gradient-to-br","from-slate-900","to-white","border","border-slate-600","flex","items-center","justify-center"],[1,"w-full","max-w-xs","py-3","px-4","rounded-lg","bg-slate-800","text-white","border","border-slate-600",3,"change"],[3,"value","selected"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","font-semibold","flex","items-center","gap-2","text-white"],[1,"flex","gap-2"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-600","text-white","rounded-lg","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg",3,"click"],[1,"border","border-slate-600","rounded-lg","overflow-hidden"],[1,"text-slate-400","text-center","py-8"],[1,"w-full","text-sm"],[1,"bg-slate-800/50"],[1,"text-left","p-3","text-slate-300"],[1,"text-right","p-3","text-slate-300"],[1,"border-t","border-slate-600","hover:bg-slate-800/50"],[1,"p-3","text-white"],[1,"p-3","text-slate-400"],[1,"p-3","text-right"],[1,"text-cyan-400","hover:text-cyan-300","text-xs","px-2","py-1",3,"click"],[1,"text-red-400","hover:text-red-300","text-xs","px-2","py-1",3,"click"],[1,"flex","items-center","justify-between","mb-6"],[1,"px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg"],[1,"px-4","py-2","bg-green-500/20","hover:bg-green-500/30","text-green-400","rounded-lg"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg",3,"click"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","p-4","border","border-slate-700"],[1,"text-sm","text-slate-500"],[1,"text-xl","font-bold"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-blue-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg",3,"click"],[1,"px-4","py-2","bg-green-500/20","hover:bg-green-500/30","text-green-400","rounded-lg",3,"click"],[1,"p-3","font-semibold","text-white"],[1,"p-3"],[1,"px-2","py-1","text-xs","rounded-full"],[1,"text-cyan-400","hover:text-cyan-300","text-xs","px-2","py-1","disabled:opacity-50",3,"click","disabled"],[1,"text-xl","font-bold","mb-4","text-white"],[1,"flex","items-center","gap-4"],[1,"w-16","h-16","rounded-full","bg-gradient-to-r","from-cyan-500","to-purple-500","flex","items-center","justify-center","text-3xl"],[1,"font-bold","text-lg","text-white"],[1,"text-sm","text-slate-400"],[1,"space-y-2","text-sm","text-slate-400"],[1,"text-white"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"h2",1),l(2),s(),r(3,"div",2)(4,"button",3),x("click",function(){return n.activeTab.set("appearance")}),l(5," \u2728 \u5916\u89C0\u8A2D\u7F6E "),s(),r(6,"button",3),x("click",function(){return n.activeTab.set("backup"),n.loadBackups()}),l(7," \u{1F4BE} \u5099\u4EFD\u7BA1\u7406 "),s(),r(8,"button",3),x("click",function(){return n.activeTab.set("scheduler"),n.loadSchedulerStatus()}),l(9," \u23F0 \u4EFB\u52D9\u8ABF\u5EA6 "),s(),r(10,"button",3),x("click",function(){return n.activeTab.set("about")}),l(11," \u2139\uFE0F \u95DC\u65BC "),s()(),y(12,ek,39,18),y(13,ok,11,3,"div",4),y(14,dk,32,10,"div",4),y(15,pk,33,4,"div",5),s()),t&2&&(c(2),D(n.t("settingsTitle")),c(2),de(n.activeTab()==="appearance"?"bg-slate-700 shadow":"text-slate-500 hover:text-white"),c(2),de(n.activeTab()==="backup"?"bg-slate-700 shadow":"text-slate-500 hover:text-white"),c(2),de(n.activeTab()==="scheduler"?"bg-slate-700 shadow":"text-slate-500 hover:text-white"),c(2),de(n.activeTab()==="about"?"bg-slate-700 shadow":"text-slate-500 hover:text-white"),c(2),S(n.activeTab()==="appearance"?12:-1),c(),S(n.activeTab()==="backup"?13:-1),c(),S(n.activeTab()==="scheduler"?14:-1),c(),S(n.activeTab()==="about"?15:-1))},dependencies:[oe,ae,Re,Ne,Sc,yn],encapsulation:2,changeDetection:0})}};var c1=(i,e)=>e.id;function gk(i,e){i&1&&l(0," \u5DF2\u5168\u9078 ")}function hk(i,e){i&1&&l(0," \u90E8\u5206\u9078\u4E2D ")}function fk(i,e){i&1&&l(0," \u5168\u9078 ")}function _k(i,e){if(i&1&&(r(0,"span",35),l(1),s()),i&2){let t=m();c(),M(" \u5DF2\u9078 ",t.selectedCount()," \u500B ")}}function vk(i,e){if(i&1&&(r(0,"span",10),l(1),s()),i&2){let t=m();c(),M(" \u5171 ",t.filteredContacts().length," \u500B\u5BA2\u6236 ")}}function xk(i,e){if(i&1){let t=I();r(0,"div",30)(1,"button",42),x("click",function(){_(t);let o=m();return v(o.batchSend())}),l(2," \u{1F4E8} \u7FA4\u767C "),s(),r(3,"button",43),x("click",function(){_(t);let o=m();return v(o.batchInvite())}),l(4," \u{1F465} \u62C9\u7FA4 "),s(),r(5,"button",44),x("click",function(){_(t);let o=m();return v(o.batchDelete())}),l(6," \u{1F5D1}\uFE0F \u522A\u9664 "),s()()}if(i&2){let t=m();c(5),L("disabled",t.isDeleting())}}function Ck(i,e){if(i&1){let t=I();r(0,"div",37)(1,"span",45),l(2),s(),B(3,"div",36),r(4,"button",46),x("click",function(){_(t);let o=m();return v(o.batchSend())}),r(5,"span"),l(6,"\u{1F4E8}"),s(),l(7," \u7FA4\u767C\u6D88\u606F "),s(),r(8,"button",47),x("click",function(){_(t);let o=m();return v(o.batchInvite())}),r(9,"span"),l(10,"\u{1F465}"),s(),l(11," \u6279\u91CF\u62C9\u7FA4 "),s(),r(12,"button",48),x("click",function(){_(t);let o=m();return v(o.startMultiRoleCollaboration())}),r(13,"span"),l(14,"\u{1F916}"),s(),l(15," AI \u591A\u89D2\u8272\u71DF\u92B7 "),s(),r(16,"button",49),x("click",function(){_(t);let o=m();return v(o.batchDelete())}),r(17,"span"),l(18),s(),l(19),s(),r(20,"button",50),x("click",function(){_(t);let o=m();return v(o.clearSelection())}),l(21," \u2716 \u53D6\u6D88\u9078\u64C7 "),s()()}if(i&2){let t=m();c(2),M(" \u{1F446} \u5DF2\u9078\u64C7 ",t.selectedCount()," \u500B\u5BA2\u6236 - \u8ACB\u9078\u64C7\u6279\u91CF\u64CD\u4F5C "),c(14),L("disabled",t.isDeleting()),c(2),D(t.isDeleting()?"\u23F3":"\u{1F5D1}\uFE0F"),c(),M(" ",t.isDeleting()?"\u522A\u9664\u4E2D...":"\u522A\u9664"," ")}}function bk(i,e){if(i&1){let t=I();r(0,"div",39)(1,"span",51),l(2,"\u{1F4ED}"),s(),r(3,"p",52),l(4,"\u66AB\u7121\u5BA2\u6236\u6578\u64DA"),s(),r(5,"p",53),l(6,"\u8ACB\u5148\u5230\u300C\u8CC7\u6E90\u4E2D\u5FC3\u300D\u6DFB\u52A0\u5BA2\u6236\uFF0C\u6216\u5F9E\u76E3\u63A7\u7FA4\u7D44\u81EA\u52D5\u6536\u96C6"),s(),r(7,"button",54),x("click",function(){_(t);let o=m();return v(o.goToResourceCenter())}),l(8," \u524D\u5F80\u8CC7\u6E90\u4E2D\u5FC3 \u2192 "),s()()}}function yk(i,e){if(i&1&&(r(0,"p",63),l(1),s()),i&2){let t=m().$implicit;c(),M("@",t.username)}}function Sk(i,e){i&1&&(r(0,"div",68),l(1," \u2B06\uFE0F \u8ACB\u4F7F\u7528\u4E0A\u65B9\u6279\u91CF\u64CD\u4F5C\u6B04 "),s())}function wk(i,e){if(i&1){let t=I();r(0,"button",69),x("click",function(o){_(t);let a=m().$implicit;return m(2).sendMessage(a),v(o.stopPropagation())}),l(1," \u{1F4AC} \u767C\u9001 "),s(),r(2,"button",70),x("click",function(o){_(t);let a=m().$implicit;return m(2).inviteToGroup(a),v(o.stopPropagation())}),l(3," \u{1F465} \u62C9\u7FA4 "),s(),r(4,"button",71),x("click",function(o){_(t);let a=m().$implicit;return m(2).deleteContact(a),v(o.stopPropagation())}),l(5," \u{1F5D1}\uFE0F "),s()}}function Ek(i,e){if(i&1){let t=I();r(0,"div",56),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSelect(o.id))}),r(1,"div",57)(2,"input",58),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSelect(o.id))})("click",function(o){return _(t),v(o.stopPropagation())}),s()(),r(3,"div",59)(4,"div",60),l(5),s(),r(6,"div",61)(7,"p",62),l(8),s(),y(9,yk,2,1,"p",63),s()(),r(10,"div",64)(11,"span",65),l(12),s(),r(13,"span",66),l(14),s()(),r(15,"div",67),y(16,Sk,2,0,"div",68)(17,wk,6,0),s()()}if(i&2){let t=e.$implicit,n=m(2);N("ring-2",n.isSelected(t.id))("ring-cyan-500",n.isSelected(t.id)),c(2),L("checked",n.isSelected(t.id)),c(3),M(" ",n.getInitial(t)," "),c(3),D(t.display_name||t.username||t.telegram_id),c(),S(t.username?9:-1),c(3),M(" ",t.source_name||t.source_type||"\u672A\u77E5\u4F86\u6E90"," "),c(),de(n.getStatusClass(t.status)),c(),M(" ",n.getStatusLabel(t.status)," "),c(2),S(n.selectedIds().size>1?16:17)}}function Dk(i,e){if(i&1&&(r(0,"div",40),O(1,Ek,18,13,"div",55,c1),s()),i&2){let t=m();c(),U(t.filteredContacts())}}function Ak(i,e){if(i&1&&(r(0,"p",80),l(1),s()),i&2){let t=m().$implicit;c(),M("@",t.username)}}function Mk(i,e){i&1&&(r(0,"div",83),l(1," \u2B06\uFE0F \u4F7F\u7528\u6279\u91CF\u64CD\u4F5C "),s())}function Tk(i,e){if(i&1){let t=I();r(0,"div",30)(1,"button",84),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.sendMessage(o))}),l(2," \u{1F4AC} "),s(),r(3,"button",85),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.inviteToGroup(o))}),l(4," \u{1F465} "),s(),r(5,"button",86),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.viewContact(o))}),l(6," \u{1F441}\uFE0F "),s(),r(7,"button",87),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.deleteContact(o))}),l(8," \u{1F5D1}\uFE0F "),s()()}}function kk(i,e){if(i&1){let t=I();r(0,"tr",76)(1,"td",77)(2,"input",74),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSelect(o.id))}),s()(),r(3,"td",77)(4,"div",2)(5,"div",78),l(6),s(),r(7,"div")(8,"p",79),l(9),s(),y(10,Ak,2,1,"p",80),s()()(),r(11,"td",81)(12,"span",82),l(13),s()(),r(14,"td",77)(15,"span",66),l(16),s()(),r(17,"td",77),y(18,Mk,2,0,"div",83)(19,Tk,9,0,"div",30),s()()}if(i&2){let t=e.$implicit,n=m(2);c(2),L("checked",n.isSelected(t.id)),c(4),M(" ",n.getInitial(t)," "),c(3),D(t.display_name||t.username||t.telegram_id),c(),S(t.username?10:-1),c(3),D(t.source_name||t.source_type||"-"),c(2),de(n.getStatusClass(t.status)),c(),M(" ",n.getStatusLabel(t.status)," "),c(2),S(n.selectedIds().size>1?18:19)}}function Ik(i,e){if(i&1){let t=I();r(0,"table",41)(1,"thead")(2,"tr",72)(3,"th",73)(4,"input",74),x("change",function(){_(t);let o=m();return v(o.toggleSelectAll())}),s()(),r(5,"th",75),l(6,"\u5BA2\u6236"),s(),r(7,"th",75),l(8,"\u4F86\u6E90"),s(),r(9,"th",75),l(10,"\u72C0\u614B"),s(),r(11,"th",75),l(12,"\u64CD\u4F5C"),s()()(),r(13,"tbody"),O(14,kk,20,9,"tr",76,c1),s()()}if(i&2){let t=m();c(4),L("checked",t.isAllSelected()),c(10),U(t.filteredContacts())}}var Ec=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.dialog=F(st);this.exportService=F(Qo);this.membershipService=F(Ie);this.contactsService=F(Kt);this.searchTerm=f("");this.statusFilter=f("");this.selectedIds=f(new Set);this.viewMode=f("card");this.isDeleting=f(!1);this.isSending=f(!1);this.isInviting=f(!1);this.sendProgress=f({sent:0,total:0,success:0,failed:0});this.inviteProgress=f({invited:0,total:0,success:0,failed:0,skipped:0});this.contacts=R(()=>this.contactsService.contacts());this.filteredContacts=R(()=>{let e=this.contacts(),t=this.searchTerm().toLowerCase(),n=this.statusFilter();return e=e.filter(o=>o.contact_type==="user"),t&&(e=e.filter(o=>o.display_name?.toLowerCase().includes(t)||o.username?.toLowerCase().includes(t)||o.telegram_id?.toString().includes(t)||o.source_name?.toLowerCase().includes(t))),n&&(e=e.filter(o=>o.status===n)),e});this.pendingCount=R(()=>this.contacts().filter(e=>e.contact_type==="user"&&e.status==="new").length);this.sentCount=R(()=>this.contacts().filter(e=>e.contact_type==="user"&&e.status==="contacted").length);this.repliedCount=R(()=>this.contacts().filter(e=>e.contact_type==="user"&&e.status==="replied").length);this.failedCount=R(()=>this.contacts().filter(e=>e.contact_type==="user"&&e.status==="failed").length);this.selectedCount=R(()=>this.selectedIds().size);this.ipcCleanup=[]}ngOnInit(){this.contactsService.loadContacts(),this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("message-sent",u=>{u.success?(this.toast.success("\u6D88\u606F\u767C\u9001\u6210\u529F"),u.telegramId&&this.contactsService.updateContactStatus(u.telegramId,"contacted")):u.telegramId&&this.contactsService.updateContactStatus(u.telegramId,"failed")}),t=this.ipc.on("private-message-received",u=>{u.telegramId&&(this.contactsService.updateContactStatus(u.telegramId,"replied"),this.toast.info("\u6536\u5230\u5BA2\u6236\u56DE\u8986"))}),n=this.ipc.on("batch-send:progress",u=>{this.sendProgress.set(u),console.log(`\u767C\u9001\u9032\u5EA6: ${u.sent}/${u.total}, \u6210\u529F: ${u.success}, \u5931\u6557: ${u.failed}`)}),o=this.ipc.on("batch-send:complete",u=>{this.isSending.set(!1),this.sendProgress.set({sent:0,total:0,success:0,failed:0}),u.failed>0?this.toast.warning(`\u6279\u91CF\u767C\u9001\u5B8C\u6210: \u6210\u529F ${u.success}\uFF0C\u5931\u6557 ${u.failed}${u.failureSummary?` (${u.failureSummary})`:""}`):this.toast.success(`\u6279\u91CF\u767C\u9001\u5B8C\u6210: \u6210\u529F ${u.success} \u689D`),this.contactsService.loadContacts()}),a=this.ipc.on("batch-invite:progress",u=>{this.inviteProgress.set(u),console.log(`\u62C9\u7FA4\u9032\u5EA6: ${u.invited}/${u.total}`)}),d=this.ipc.on("batch-invite:complete",u=>{this.isInviting.set(!1),this.inviteProgress.set({invited:0,total:0,success:0,failed:0,skipped:0}),this.toast.success(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210: \u6210\u529F ${u.success}\uFF0C\u8DF3\u904E ${u.skipped}\uFF0C\u5931\u6557 ${u.failed}`),this.contactsService.loadContacts()});this.ipcCleanup.push(e,t,n,o,a,d)}refresh(){this.contactsService.loadContacts(),this.toast.info("\u6B63\u5728\u5237\u65B0...")}goToResourceCenter(){this.nav.navigateTo("resource-center")}isSelected(e){return this.selectedIds().has(e)}toggleSelect(e){this.selectedIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}isAllSelected(){let e=this.filteredContacts();return e.length>0&&e.every(t=>this.selectedIds().has(t.id))}isPartialSelected(){let e=this.filteredContacts(),t=this.selectedIds().size;return t>0&&t<e.length&&!this.isAllSelected()}toggleSelectAll(){let e=this.filteredContacts();this.isAllSelected()?this.selectedIds.set(new Set):this.selectedIds.set(new Set(e.map(t=>t.id)))}selectAll(){let e=this.filteredContacts();this.selectedIds.set(new Set(e.map(t=>t.id))),this.toast.info(`\u5DF2\u5168\u9078 ${e.length} \u500B\u5BA2\u6236`)}invertSelection(){let e=this.filteredContacts(),t=this.selectedIds(),n=new Set;e.forEach(o=>{t.has(o.id)||n.add(o.id)}),this.selectedIds.set(n),this.toast.info(`\u5DF2\u9078\u64C7 ${n.size} \u500B\u5BA2\u6236`)}batchSend(){let e=this.contacts().filter(n=>this.selectedIds().has(n.id));if(e.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}let t=this.convertToSendTargets(e);if(t.length===0){this.toast.error("\u9078\u4E2D\u7684\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.dialog.openBatchSend(t)}sendMessage(e){let t=this.convertToSendTargets([e]);if(t.length===0){this.toast.error("\u6B64\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.dialog.openBatchSend(t)}convertToSendTargets(e){return e.filter(t=>t.telegram_id).map(t=>({telegramId:t.telegram_id,username:t.username||"",firstName:t.first_name||t.display_name?.split(" ")[0]||"",lastName:t.last_name||t.display_name?.split(" ")[1]||"",displayName:t.display_name||t.username||t.telegram_id,groupName:t.source_name||"",source:t.source_type||""}))}batchInvite(){let e=this.contacts().filter(n=>this.selectedIds().has(n.id));if(e.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}let t=e.map(n=>({telegramId:n.telegram_id||String(n.id),username:n.username||"",firstName:n.first_name||n.display_name?.split(" ")[0]||"",lastName:n.last_name||n.display_name?.split(" ")[1]||""}));this.dialog.openBatchInvite(t)}inviteToGroup(e){let t={telegramId:e.telegram_id||String(e.id),username:e.username||"",firstName:e.first_name||e.display_name?.split(" ")[0]||"",lastName:e.last_name||e.display_name?.split(" ")[1]||""};this.dialog.openBatchInvite([t])}batchDelete(){let e=this.selectedIds().size;if(e===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}if(this.isDeleting()){this.toast.warning("\u6B63\u5728\u522A\u9664\u4E2D\uFF0C\u8ACB\u7A0D\u5019...");return}if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u9078\u4E2D\u7684 ${e} \u500B\u5BA2\u6236\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002`))return;let n=this.contacts().filter(a=>this.selectedIds().has(a.id)).map(a=>a.telegram_id).filter(Boolean);if(n.length===0){this.toast.error("\u9078\u4E2D\u7684\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.isDeleting.set(!0),this.contactsService.deleteContacts(n),this.toast.info(`\u6B63\u5728\u522A\u9664 ${n.length} \u500B\u5BA2\u6236...`);let o=this.ipc.once("unified-contacts:delete-result",a=>{this.isDeleting.set(!1),a.success?(this.toast.success(`\u5DF2\u522A\u9664 ${a.deleted||a.leadsDeleted||n.length} \u500B\u5BA2\u6236`),this.clearSelection()):this.toast.error(`\u522A\u9664\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`)});setTimeout(()=>{this.isDeleting()&&(this.isDeleting.set(!1),this.toast.warning("\u522A\u9664\u64CD\u4F5C\u8D85\u6642\uFF0C\u8ACB\u5237\u65B0\u9801\u9762\u67E5\u770B\u7D50\u679C"))},3e4)}deleteContact(e){if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236\u300C${e.display_name||e.username||e.telegram_id}\u300D\u55CE\uFF1F`))return;if(!e.telegram_id){this.toast.error("\u6B64\u5BA2\u6236\u6C92\u6709\u6709\u6548\u7684 Telegram ID");return}this.isDeleting.set(!0),this.contactsService.deleteContacts([e.telegram_id]),this.toast.info("\u6B63\u5728\u522A\u9664\u5BA2\u6236...");let t=this.ipc.once("unified-contacts:delete-result",n=>{this.isDeleting.set(!1),n.success?this.toast.success("\u5BA2\u6236\u5DF2\u522A\u9664"):this.toast.error(`\u522A\u9664\u5931\u6557: ${n.error||"\u672A\u77E5\u932F\u8AA4"}`)})}clearSelection(){this.selectedIds.set(new Set)}viewContact(e){console.log("View contact:",e)}getInitial(e){return(e.display_name||e.username||e.telegram_id||"?").charAt(0).toUpperCase()}getStatusClass(e){return{new:"bg-blue-500/20 text-blue-400",contacted:"bg-emerald-500/20 text-emerald-400",replied:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",blacklisted:"bg-slate-500/20 text-slate-400"}[e]||"bg-slate-500/20 text-slate-400"}getStatusLabel(e){return{new:"\u5F85\u767C\u9001",contacted:"\u5DF2\u767C\u9001",replied:"\u5DF2\u56DE\u8986",failed:"\u767C\u9001\u5931\u6557",blacklisted:"\u5DF2\u62C9\u9ED1"}[e]||e||"\u672A\u77E5"}startMultiRoleCollaboration(){let e=this.contacts().filter(n=>this.selectedIds().has(n.id));if(e.length===0){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u5BA2\u6236");return}let t=e.map(n=>({id:n.id?.toString()||n.telegram_id,telegramId:n.telegram_id||n.id?.toString()||"",username:n.username,firstName:n.first_name||n.display_name?.split(" ")[0],lastName:n.last_name||n.display_name?.split(" ")[1],intentScore:this.calculateContactIntent(n),source:n.source_type||"leads"}));sessionStorage.setItem("multiRoleTargetUsers",JSON.stringify(t)),this.toast.success(`\u{1F916} \u5DF2\u9078\u64C7 ${t.length} \u500B\u76EE\u6A19\uFF0C\u6B63\u5728\u8DF3\u8F49\u5230\u591A\u89D2\u8272\u5354\u4F5C\u4E2D\u5FC3...`),this.ipc.send("navigate-to-multi-role",{targetUsers:t}),setTimeout(()=>{this.ipc.send("multi-role:open-ai-planner",{targetUsers:t})},500)}calculateContactIntent(e){let t=30;return e.status==="replied"?t+=30:e.status==="contacted"?t+=15:e.status==="new"&&(t+=10),e.source_type==="lead"?t+=20:e.source_type==="member"&&(t+=10),e.tags?.includes("\u9AD8\u610F\u5411")?t+=25:e.tags?.includes("\u6709\u8208\u8DA3")&&(t+=15),e.last_message_at&&(t+=10),Math.min(100,t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-leads-view"]],decls:98,vars:37,consts:[[1,"page-content"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-2xl","font-bold",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","transition-colors",2,"background-color","var(--bg-tertiary)","color","var(--text-primary)",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","disabled:opacity-50",3,"click","disabled"],[1,"grid","grid-cols-2","md:grid-cols-5","gap-4","mb-6"],[1,"rounded-xl","p-4","text-center",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"text-2xl","mb-1"],[1,"text-sm",2,"color","var(--text-muted)"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-blue-400"],[1,"text-xl","font-bold","text-emerald-400"],[1,"text-xl","font-bold","text-green-400"],[1,"text-xl","font-bold","text-red-400"],[1,"flex","items-center","gap-4","mb-6"],[1,"flex-1","relative"],["type","text","placeholder","\u641C\u7D22\u5BA2\u6236\u540D\u7A31\u3001\u7528\u6236\u540D\u6216\u4F86\u6E90...",1,"w-full","py-3","px-4","pl-10","rounded-xl",2,"background-color","var(--bg-tertiary)","color","var(--text-primary)","border","1px solid var(--border-color)",3,"ngModelChange","ngModel"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-400"],[1,"py-3","px-4","rounded-xl",2,"background-color","var(--bg-tertiary)","color","var(--text-primary)","border","1px solid var(--border-color)",3,"ngModelChange","ngModel"],["value",""],["value","new"],["value","contacted"],["value","replied"],["value","failed"],[1,"flex","rounded-lg","overflow-hidden",2,"border","1px solid var(--border-color)"],[1,"p-2","px-3","transition-colors",3,"click"],[1,"flex","items-center","gap-4","mb-4","p-3","rounded-xl",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],["type","checkbox",1,"w-5","h-5","rounded","accent-cyan-500","cursor-pointer",3,"change","checked","indeterminate"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-colors",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-colors",2,"background-color","var(--bg-tertiary)","color","var(--text-muted)",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-colors","disabled:opacity-50",2,"background-color","var(--bg-tertiary)","color","var(--text-muted)",3,"click","disabled"],[1,"w-px","h-6","bg-slate-700"],[1,"px-3","py-1","rounded-full","text-sm","font-medium","bg-cyan-500/20","text-cyan-400"],[1,"flex-1"],[1,"sticky","top-0","z-50","flex","items-center","gap-4","mb-4","p-4","rounded-xl","border","transition-all","duration-300","shadow-lg","backdrop-blur-sm","bg-gradient-to-r","from-amber-500/30","to-orange-500/30","border-amber-500/50",2,"background-color","rgba(15, 23, 42, 0.95)"],[1,"rounded-xl","overflow-hidden",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"p-12","text-center",2,"color","var(--text-muted)"],[1,"p-4","grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],[1,"w-full"],[1,"flex","items-center","gap-1.5","px-3","py-1.5","rounded-lg","text-xs","bg-cyan-500","hover:bg-cyan-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-1.5","px-3","py-1.5","rounded-lg","text-xs","bg-purple-500","hover:bg-purple-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-1.5","px-3","py-1.5","rounded-lg","text-xs","bg-red-500/20","hover:bg-red-500/30","text-red-400","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-amber-400","font-bold","text-lg"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-cyan-500","hover:bg-cyan-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-purple-500","hover:bg-purple-600","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-gradient-to-r","from-pink-500","to-purple-500","hover:opacity-90","text-white","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-red-500/20","hover:bg-red-500/30","text-red-400","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center","gap-2","px-3","py-2","rounded-lg","hover:bg-slate-700/50","transition-colors","text-slate-400",3,"click"],[1,"text-5xl","mb-4","block"],[1,"text-lg","mb-2"],[1,"text-sm","mb-4"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"rounded-xl","p-4","transition-all","hover:scale-[1.02]","cursor-pointer","relative","group",2,"background-color","var(--bg-tertiary)","border","1px solid var(--border-color)",3,"ring-2","ring-cyan-500"],[1,"rounded-xl","p-4","transition-all","hover:scale-[1.02]","cursor-pointer","relative","group",2,"background-color","var(--bg-tertiary)","border","1px solid var(--border-color)",3,"click"],[1,"absolute","top-3","right-3"],["type","checkbox",1,"rounded","w-5","h-5","accent-cyan-500","cursor-pointer",3,"change","click","checked"],[1,"flex","items-center","gap-3","mb-3"],[1,"w-12","h-12","rounded-full","bg-gradient-to-r","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-white","font-bold","text-lg","shadow-lg"],[1,"flex-1","min-w-0"],[1,"font-medium","truncate",2,"color","var(--text-primary)"],[1,"text-xs","truncate",2,"color","var(--text-muted)"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-xs","px-2","py-1","rounded","bg-slate-700/50",2,"color","var(--text-muted)"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],[1,"flex","items-center","gap-2","pt-2","border-t",2,"border-color","var(--border-color)"],[1,"flex-1","text-center","py-2","text-xs","text-amber-400"],[1,"flex-1","flex","items-center","justify-center","gap-1","py-2","rounded-lg","text-xs","font-medium","transition-colors","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400",3,"click"],[1,"flex-1","flex","items-center","justify-center","gap-1","py-2","rounded-lg","text-xs","font-medium","transition-colors","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400",3,"click"],["title","\u522A\u9664",1,"p-2","rounded-lg","text-xs","transition-colors","hover:bg-red-500/20","text-red-400",3,"click"],[2,"background-color","var(--bg-tertiary)"],[1,"py-3","px-4","text-left","text-sm","font-medium","w-10",2,"color","var(--text-muted)"],["type","checkbox",1,"rounded",3,"change","checked"],[1,"py-3","px-4","text-left","text-sm","font-medium",2,"color","var(--text-muted)"],[1,"border-t","transition-colors","hover:bg-slate-800/30",2,"border-color","var(--border-color)"],[1,"py-3","px-4"],[1,"w-10","h-10","rounded-full","bg-gradient-to-r","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-white","font-bold"],[1,"font-medium",2,"color","var(--text-primary)"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"py-3","px-4",2,"color","var(--text-muted)"],[1,"text-xs","px-2","py-1","rounded","bg-slate-700/50"],[1,"text-xs","text-amber-400"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","rounded-lg","hover:bg-cyan-500/20","transition-colors","text-cyan-400",3,"click"],["title","\u62C9\u7FA4",1,"p-2","rounded-lg","hover:bg-purple-500/20","transition-colors","text-purple-400",3,"click"],["title","\u67E5\u770B\u8A73\u60C5",1,"p-2","rounded-lg","hover:bg-slate-700/50","transition-colors","text-slate-400",3,"click"],["title","\u522A\u9664",1,"p-2","rounded-lg","hover:bg-red-500/20","transition-colors","text-red-400",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"\u{1F4E4}"),s(),r(5,"h2",4),l(6,"\u767C\u9001\u63A7\u5236\u53F0"),s()(),r(7,"div",2)(8,"button",5),x("click",function(){return n.refresh()}),r(9,"span"),l(10,"\u{1F504}"),s(),l(11," \u5237\u65B0 "),s(),r(12,"button",6),x("click",function(){return n.batchSend()}),r(13,"span"),l(14,"\u{1F4E8}"),s(),l(15," \u6279\u91CF\u767C\u9001 "),s()()(),r(16,"div",7)(17,"div",8)(18,"div",9),l(19,"\u{1F465}"),s(),r(20,"div",10),l(21,"\u7E3D\u5BA2\u6236"),s(),r(22,"div",11),l(23),s()(),r(24,"div",8)(25,"div",9),l(26,"\u23F3"),s(),r(27,"div",10),l(28,"\u5F85\u767C\u9001"),s(),r(29,"div",12),l(30),s()(),r(31,"div",8)(32,"div",9),l(33,"\u2705"),s(),r(34,"div",10),l(35,"\u5DF2\u767C\u9001"),s(),r(36,"div",13),l(37),s()(),r(38,"div",8)(39,"div",9),l(40,"\u{1F4AC}"),s(),r(41,"div",10),l(42,"\u5DF2\u56DE\u8986"),s(),r(43,"div",14),l(44),s()(),r(45,"div",8)(46,"div",9),l(47,"\u274C"),s(),r(48,"div",10),l(49,"\u767C\u9001\u5931\u6557"),s(),r(50,"div",15),l(51),s()()(),r(52,"div",16)(53,"div",17)(54,"input",18),x("ngModelChange",function(a){return n.searchTerm.set(a)}),s(),r(55,"span",19),l(56,"\u{1F50D}"),s()(),r(57,"select",20),x("ngModelChange",function(a){return n.statusFilter.set(a)}),r(58,"option",21),l(59,"\u5168\u90E8\u72C0\u614B"),s(),r(60,"option",22),l(61,"\u5F85\u767C\u9001"),s(),r(62,"option",23),l(63,"\u5DF2\u767C\u9001"),s(),r(64,"option",24),l(65,"\u5DF2\u56DE\u8986"),s(),r(66,"option",25),l(67,"\u767C\u9001\u5931\u6557"),s()(),r(68,"div",26)(69,"button",27),x("click",function(){return n.viewMode.set("list")}),l(70," \u{1F4CB} "),s(),r(71,"button",27),x("click",function(){return n.viewMode.set("card")}),l(72," \u{1F0CF} "),s()()(),r(73,"div",28)(74,"div",2)(75,"input",29),x("change",function(){return n.toggleSelectAll()}),s(),r(76,"span",10),y(77,gk,1,0)(78,hk,1,0)(79,fk,1,0),s()(),r(80,"div",30)(81,"button",31),x("click",function(){return n.selectAll()}),l(82),s(),r(83,"button",32),x("click",function(){return n.invertSelection()}),l(84," \u{1F504} \u53CD\u9078 "),s(),r(85,"button",33),x("click",function(){return n.clearSelection()}),l(86," \u2716 \u6E05\u9664 "),s()(),B(87,"div",34),r(88,"div",30),y(89,_k,2,1,"span",35)(90,vk,2,1,"span",10),s(),B(91,"div",36),y(92,xk,7,1,"div",30),s(),y(93,Ck,22,4,"div",37),r(94,"div",38),y(95,bk,9,0,"div",39)(96,Dk,3,0,"div",40)(97,Ik,16,1,"table",41),s()()),t&2&&(c(12),L("disabled",n.selectedCount()===0),c(11),D(n.contacts().length),c(7),D(n.pendingCount()),c(7),D(n.sentCount()),c(7),D(n.repliedCount()),c(7),D(n.failedCount()),c(3),L("ngModel",n.searchTerm()),c(3),L("ngModel",n.statusFilter()),c(12),ee("background-color",n.viewMode()!=="list"?"var(--bg-tertiary)":""),N("bg-cyan-500",n.viewMode()==="list")("text-white",n.viewMode()==="list"),c(2),ee("background-color",n.viewMode()!=="card"?"var(--bg-tertiary)":""),N("bg-cyan-500",n.viewMode()==="card")("text-white",n.viewMode()==="card"),c(4),L("checked",n.isAllSelected())("indeterminate",n.isPartialSelected()),c(2),S(n.isAllSelected()?77:n.isPartialSelected()?78:79),c(4),ee("background-color",n.isAllSelected()?"":"var(--bg-tertiary)")("color",n.isAllSelected()?"":"var(--text-muted)"),N("bg-cyan-500",n.isAllSelected())("text-white",n.isAllSelected()),c(),M(" \u2611\uFE0F \u5168\u9078 (",n.filteredContacts().length,") "),c(3),L("disabled",n.selectedCount()===0),c(4),S(n.selectedCount()>0?89:90),c(3),S(n.selectedCount()>0?92:-1),c(),S(n.selectedCount()>1?93:-1),c(2),S(n.filteredContacts().length===0?95:n.viewMode()==="card"?96:97))},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he],encapsulation:2,changeDetection:0})}};var Ct=class i{constructor(){this.ipcService=F(Q);this._accounts=f([]);this._groups=f([]);this._keywordSets=f([]);this._chatTemplates=f([]);this._triggerRules=f([]);this._isLoading=f(!1);this._lastUpdated=f(null);this._aiProcessing=f(new Map);this._aiStats=f({totalReplies:0,successRate:100,avgResponseTime:0});this.accounts=this._accounts.asReadonly();this.groups=this._groups.asReadonly();this.keywordSets=this._keywordSets.asReadonly();this.chatTemplates=this._chatTemplates.asReadonly();this.triggerRules=this._triggerRules.asReadonly();this.isLoading=this._isLoading.asReadonly();this.lastUpdated=this._lastUpdated.asReadonly();this.aiProcessing=this._aiProcessing.asReadonly();this.aiStats=this._aiStats.asReadonly();this.connectedAccounts=R(()=>this._accounts().filter(e=>e.status==="connected"));this.listenerAccounts=R(()=>this._accounts().filter(e=>e.isListener));this.senderAccounts=R(()=>this._accounts().filter(e=>e.isSender));this.monitoringGroups=R(()=>this._groups().filter(e=>e.isMonitoring));this.totalMembers=R(()=>this._groups().reduce((e,t)=>e+t.memberCount,0));this.todayMatches=R(()=>this._groups().reduce((e,t)=>e+(t.stats?.matchesToday||0),0));this.groupsWithKeywords=R(()=>this._groups().filter(e=>e.linkedKeywordSets.length>0));this.activeKeywordSets=R(()=>this._keywordSets().filter(e=>e.isActive));this.totalKeywords=R(()=>this._keywordSets().reduce((e,t)=>e+t.keywords.length,0));this.totalKeywordMatches=R(()=>this._keywordSets().reduce((e,t)=>e+t.totalMatches,0));this.activeTemplates=R(()=>this._chatTemplates().filter(e=>e.isActive));this.activeTriggerRules=R(()=>this._triggerRules().filter(e=>e.isActive||e.is_active));this.hasActiveTriggerRules=R(()=>this.activeTriggerRules().length>0);this.configStatus=R(()=>{let e=[{id:"listener",name:"\u76E3\u63A7\u5E33\u865F",description:"\u8A2D\u7F6E\u7528\u65BC\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u7684\u5E33\u865F",isCompleted:this.listenerAccounts().some(u=>u.status==="connected"),count:this.listenerAccounts().length,action:"add-listener",icon:"\u{1F464}"},{id:"groups",name:"\u76E3\u63A7\u7FA4\u7D44",description:"\u6DFB\u52A0\u9700\u8981\u76E3\u63A7\u7684 Telegram \u7FA4\u7D44",isCompleted:this._groups().length>0,count:this._groups().length,action:"add-group",icon:"\u{1F4AC}"},{id:"keywords",name:"\u95DC\u9375\u8A5E\u96C6",description:"\u5275\u5EFA\u7528\u65BC\u5339\u914D\u6D88\u606F\u7684\u95DC\u9375\u8A5E",isCompleted:this._keywordSets().some(u=>u.keywords.length>0),count:this.totalKeywords(),action:"add-keywords",icon:"\u{1F511}"},{id:"binding",name:"\u7D81\u5B9A\u8A5E\u96C6",description:"\u5C07\u95DC\u9375\u8A5E\u96C6\u7D81\u5B9A\u5230\u76E3\u63A7\u7FA4\u7D44",isCompleted:this.groupsWithKeywords().length>0,count:this.groupsWithKeywords().length,action:"bind-keywords",icon:"\u{1F517}"},{id:"templates",name:"\u804A\u5929\u6A21\u7248",description:"\u8A2D\u7F6E\u81EA\u52D5\u56DE\u8986\u4F7F\u7528\u7684\u6D88\u606F\u6A21\u7248",isCompleted:this._chatTemplates().length>0,count:this._chatTemplates().length,action:"add-template",icon:"\u{1F4DD}"},{id:"sender",name:"\u767C\u9001\u5E33\u865F",description:"\u914D\u7F6E\u7528\u65BC\u767C\u9001\u6D88\u606F\u7684\u5E33\u865F",isCompleted:this.senderAccounts().some(u=>u.status==="connected"),count:this.senderAccounts().length,action:"add-sender",icon:"\u{1F4E4}"}],t=e.filter(u=>u.isCompleted).length,n=e.length,o=Math.round(t/n*100),a=t>=4,d=e.find(u=>!u.isCompleted);return{steps:e,completedCount:t,totalCount:n,percentage:o,isReady:a,nextStep:d}});this.listeners=[];this.aiProcessingCount=R(()=>this._aiProcessing().size);this._loadAllTimeout=null;this._lastLoadTime=0;this._isInitialLoadDone=!1;this.setupListeners()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupListeners(){let e=this.ipcService.on("initial-state",A=>{this.processInitialState(A)});this.listeners.push(e);let t=this.ipcService.on("initial-state-config",A=>{console.log("[StateService] Received initial-state-config"),this.processInitialState(A)});this.listeners.push(t);let n=this.ipcService.on("accounts-updated",A=>{this.updateAccounts(A)});this.listeners.push(n);let o=this.ipcService.on("get-groups-result",A=>{A.groups&&this.updateGroups(A.groups)});this.listeners.push(o);let a=this.ipcService.on("get-keyword-sets-result",A=>{A.keywordSets&&this.updateKeywordSets(A.keywordSets)});this.listeners.push(a);let d=this.ipcService.on("get-chat-templates-result",A=>{A.templates&&this.updateChatTemplates(A.templates)});this.listeners.push(d);let u=this.ipcService.on("templates-updated",A=>{A.chatTemplates?this.updateChatTemplates(A.chatTemplates):A.messageTemplates&&this.updateChatTemplates(A.messageTemplates)});this.listeners.push(u);let p=this.ipcService.on("trigger-rules-result",A=>{A.success&&A.rules&&this.updateTriggerRules(A.rules)});this.listeners.push(p);let g=this.ipcService.on("private-message-received",A=>{A.userId&&A.username&&this.markAiProcessing(A.userId,A.username)});this.listeners.push(g);let C=this.ipcService.on("ai-response-sent",A=>{A.userId&&this.markAiCompleted(A.userId,!0)});this.listeners.push(C);let w=this.ipcService.on("ai-suggestion-ready",A=>{A.userId&&this.markAiCompleted(A.userId,!0)});this.listeners.push(w)}markAiProcessing(e,t){let n=new Map(this._aiProcessing());n.set(e,{user:t,startTime:new Date}),this._aiProcessing.set(n)}markAiCompleted(e,t){let n=new Map(this._aiProcessing()),o=n.get(e);if(o){let a=Date.now()-o.startTime.getTime();n.delete(e),this._aiProcessing.set(n);let d=this._aiStats(),u=d.totalReplies+1,p=t?(d.successRate*d.totalReplies+100)/u:d.successRate*d.totalReplies/u,g=(d.avgResponseTime*d.totalReplies+a)/u;this._aiStats.set({totalReplies:u,successRate:Math.round(p),avgResponseTime:Math.round(g)})}}loadAll(e=!1){let t=Date.now();if(!e&&this._isInitialLoadDone&&t-this._lastLoadTime<3e3){console.log("[StateService] Skipping loadAll - recently loaded");return}this._loadAllTimeout&&clearTimeout(this._loadAllTimeout),this._loadAllTimeout=setTimeout(()=>{this._isLoading.set(!0),this._lastLoadTime=Date.now(),console.log("[StateService] Loading all data..."),this.ipcService.send("get-initial-state"),this.ipcService.send("get-monitored-groups",{}),this.ipcService.send("get-trigger-rules",{}),this.ipcService.send("get-chat-templates",{}),this.ipcService.send("get-keyword-sets",{}),this._isInitialLoadDone=!0,this._loadAllTimeout=null},300)}refresh(){console.log("[StateService] Refreshing all data..."),this.loadAll(!0)}processInitialState(e){console.log("[StateService] Processing initial state, keys:",Object.keys(e)),e.accounts&&this.updateAccounts(e.accounts),e.monitoredGroups&&this.updateGroups(e.monitoredGroups),e.keywordSets&&this.updateKeywordSets(e.keywordSets),e.chatTemplates&&this.updateChatTemplates(e.chatTemplates),e.messageTemplates&&!e.chatTemplates&&this.updateChatTemplates(e.messageTemplates),e.triggerRules&&this.updateTriggerRules(e.triggerRules),this._isLoading.set(!1),this._lastUpdated.set(new Date)}updateAccounts(e){let t=e.map(n=>({id:n.id||n.phone,phone:n.phone||"",username:n.nickname||n.username||n.firstName||"",firstName:n.first_name||n.firstName||"",avatar:n.avatar||n.photo||"",status:n.status==="Online"?"connected":n.status==="Error"?"error":"disconnected",isListener:n.role==="Listener",isSender:n.role==="Sender",healthScore:n.healthScore||100,dailySendLimit:n.dailySendLimit||50,dailySendCount:n.dailySendCount||0,stats:{sentToday:n.dailyMessageCount||0,sentWeek:n.weeklyMessageCount||0,repliesWeek:0,conversionsWeek:0}}));this._accounts.set(t)}updateGroups(e){console.log("[StateService] ========== updateGroups =========="),console.log("[StateService] Raw groups count:",e?.length);let t=e.map(n=>{let o=n.keywordSetIds||n.keyword_set_ids||[],a=o.map(d=>String(d));return console.log(`[StateService] Group ${n.id} "${n.name}": keywordSetIds=`,o,"linkedKeywordSets=",a),{id:String(n.id),name:n.name||n.title||n.url||"\u672A\u77E5\u7FA4\u7D44",url:n.url||n.link||"",telegramId:n.telegram_id||n.telegramId||"",memberCount:n.memberCount||n.member_count||0,isMonitoring:n.is_active!==!1,linkedKeywordSets:a,accountPhone:n.phone||n.account_phone,stats:{matchesToday:n.matchesToday||0,matchesWeek:n.matchesWeek||0,leadsToday:n.leadsToday||0,leadsWeek:n.leadsWeek||0}}});this._groups.set(t),console.log("[StateService] Groups updated, total:",t.length)}updateGroupKeywordSets(e,t){this._groups.update(n=>n.map(o=>o.id===e?P(E({},o),{linkedKeywordSets:t}):o))}updateGroupMemberCount(e,t){this._groups.update(n=>n.map(o=>o.id===e?P(E({},o),{memberCount:t}):o))}updateKeywordSets(e){let t=e.map(n=>{let o=[];if(n.keywords)if(typeof n.keywords=="string")try{let a=JSON.parse(n.keywords);o=Array.isArray(a)?a.map((d,u)=>({id:String(d.id||u),text:typeof d=="string"?d:d.text||d.keyword||"",matchCount:d.matchCount||0,isNew:!1})):[]}catch{o=[]}else Array.isArray(n.keywords)&&(o=n.keywords.map((a,d)=>({id:String(a.id||d),text:typeof a=="string"?a:a.text||a.keyword||"",matchCount:a.matchCount||0,isNew:!1})));return{id:String(n.id),name:n.name,keywords:o,matchMode:n.matchMode||"fuzzy",isActive:n.is_active!==!1&&n.isActive!==!1,totalMatches:o.reduce((a,d)=>a+(d.matchCount||0),0)}});this._keywordSets.set(t)}updateChatTemplates(e){let t=e.map(n=>{let o=[];if(n.variables)if(typeof n.variables=="string")try{o=JSON.parse(n.variables)}catch{o=[]}else Array.isArray(n.variables)&&(o=n.variables);return{id:String(n.id),name:n.name,content:n.content||"",templateType:n.template_type||n.templateType||"custom",variables:o,usageCount:n.usage_count||n.usageCount||0,isActive:n.is_active!==!1&&n.isActive!==!1}});this._chatTemplates.set(t)}updateTriggerRules(e){let t=e.map(n=>P(E({},n),{id:n.id,name:n.name,isActive:n.is_active===1||n.isActive===!0,responseType:n.response_type||n.responseType,triggerCount:n.trigger_count||n.triggerCount||0,successCount:n.success_count||n.successCount||0}));this._triggerRules.set(t),console.log("[StateService] Trigger rules updated, total:",t.length,"active:",t.filter(n=>n.isActive).length)}getKeywordSetById(e){return this._keywordSets().find(t=>t.id===e)}getKeywordSetName(e){let t=this.getKeywordSetById(e);return t?t.name:`\u8A5E\u96C6 ${e}`}getAccountById(e){return this._accounts().find(t=>t.id===e)}getGroupById(e){return this._groups().find(t=>t.id===e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var wm=(i,e)=>e.id;function Fk(i,e){if(i&1&&Se(0,"div",10),i&2){let t=m().$implicit;N("bg-emerald-500",t.isCompleted)("bg-slate-600",!t.isCompleted)}}function Pk(i,e){if(i&1&&(T(0,"div",8),l(1),k(),y(2,Fk,1,4,"div",9)),i&2){let t=e.$implicit,n=e.$index,o=m(2);N("bg-emerald-500/20",t.isCompleted)("text-emerald-400",t.isCompleted)("bg-slate-700",!t.isCompleted)("text-slate-500",!t.isCompleted),Ke("title",t.name),c(),M(" ",t.isCompleted?"\u2713":n+1," "),c(),S(n<o.status().steps.length-1?2:-1)}}function Rk(i,e){if(i&1){let t=I();T(0,"button",11),se("click",function(){_(t);let o=m(2);return v(o.onAction(o.status().nextStep.action))}),T(1,"span"),l(2,"\u2192"),k(),T(3,"span"),l(4),k()()}if(i&2){let t=m(2);c(4),D(t.status().nextStep.name)}}function Nk(i,e){if(i&1&&(T(0,"div",0)(1,"div",4),O(2,Pk,3,11,null,null,wm),k(),T(4,"div",5)(5,"span",6),l(6),k()(),y(7,Rk,5,1,"button",7),k()),i&2){let t=m();c(2),U(t.status().steps),c(4),M("",t.status().percentage,"%"),c(),S(t.status().nextStep?7:-1)}}function Vk(i,e){if(i&1&&(T(0,"span",33),l(1),k()),i&2){let t=m().$implicit;N("bg-emerald-500/20",t.isCompleted)("text-emerald-400",t.isCompleted)("bg-slate-600/50",!t.isCompleted)("text-slate-400",!t.isCompleted),c(),M(" ",t.count," ")}}function Bk(i,e){if(i&1){let t=I();T(0,"button",34),se("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.onAction(o.action))}),l(1," \u8A2D\u7F6E "),k()}}function Lk(i,e){if(i&1&&(T(0,"div",25)(1,"div",26),l(2),k(),T(3,"div",27)(4,"div",28)(5,"span",29),l(6),k(),y(7,Vk,2,9,"span",30),k(),T(8,"p",31),l(9),k()(),y(10,Bk,2,0,"button",32),k()),i&2){let t=e.$implicit;N("bg-emerald-500/10",t.isCompleted)("bg-slate-700/30",!t.isCompleted),c(),N("bg-emerald-500/20",t.isCompleted)("text-emerald-400",t.isCompleted)("bg-slate-600",!t.isCompleted)("text-slate-400",!t.isCompleted),c(),M(" ",t.isCompleted?"\u2713":t.icon," "),c(3),N("text-white",t.isCompleted)("text-slate-300",!t.isCompleted),c(),M(" ",t.name," "),c(),S(t.count!==void 0&&t.count>0?7:-1),c(2),D(t.description),c(),S(!t.isCompleted&&t.action?10:-1)}}function Ok(i,e){i&1&&(T(0,"div",23),Se(1,"span",35),T(2,"span",5),l(3,"\u914D\u7F6E\u5B8C\u6210\uFF0C\u53EF\u4EE5\u958B\u59CB\u76E3\u63A7"),k()())}function Uk(i,e){if(i&1){let t=I();T(0,"div",24)(1,"span",36),l(2),k(),T(3,"button",37),se("click",function(){_(t);let o=m(2);return v(o.onAction(o.status().nextStep.action))}),l(4," \u7ACB\u5373\u8A2D\u7F6E "),k()()}if(i&2){let t=m(2);c(2),M(" \u4E0B\u4E00\u6B65\uFF1A",t.status().nextStep.name," ")}}function Gk(i,e){if(i&1&&(T(0,"div",1)(1,"div",12)(2,"h3",13)(3,"span"),l(4,"\u{1F4CB}"),k(),l(5," \u914D\u7F6E\u9032\u5EA6 "),k(),T(6,"span",5)(7,"span",6),l(8),k(),T(9,"span",14),l(10),k()()(),T(11,"div",15)(12,"div",16)(13,"div",17),Se(14,"div",18),k(),T(15,"div",19),l(16),k()()(),T(17,"div",20),O(18,Lk,11,21,"div",21,wm),k(),T(20,"div",22),y(21,Ok,4,0,"div",23)(22,Uk,5,1,"div",24),k()()),i&2){let t=m();c(8),D(t.status().completedCount),c(2),M("/",t.status().totalCount),c(4),ee("width",t.status().percentage,"%"),c(2),M(" ",t.status().percentage,"% \u5B8C\u6210 "),c(2),U(t.status().steps),c(3),S(t.status().isReady?21:t.status().nextStep?22:-1)}}function $k(i,e){i&1&&(T(0,"span",50),l(1,"\u2713"),k())}function Hk(i,e){if(i&1&&(T(0,"span",51),l(1),k()),i&2){let t=m(2);c(),X("",t.status().completedCount,"/",t.status().totalCount)}}function qk(i,e){if(i&1&&(T(0,"span",43),l(1),k()),i&2){let t=m().$implicit;c(),M("(",t.count,")")}}function Wk(i,e){if(i&1&&(T(0,"div",53)(1,"span"),l(2),k(),T(3,"span"),l(4),k(),y(5,qk,2,1,"span",43),k()),i&2){let t=e.$implicit;c(),N("text-emerald-400",t.isCompleted)("text-slate-500",!t.isCompleted),c(),M(" ",t.isCompleted?"\u2713":"\u25CB"," "),c(),N("text-white",t.isCompleted)("text-slate-400",!t.isCompleted),c(),M(" ",t.name," "),c(),S(t.count&&t.count>0?5:-1)}}function zk(i,e){if(i&1&&(T(0,"div",43),l(1),k()),i&2){let t=m(2);c(),M(" \u9084\u6709 ",t.status().steps.length-4," \u500B\u6B65\u9A5F... ")}}function Kk(i,e){if(i&1){let t=I();T(0,"div",54)(1,"div",55)(2,"span"),l(3),k(),T(4,"span"),l(5),k()(),T(6,"button",56),se("click",function(){_(t);let o=m(2);return v(o.onAction(o.status().nextStep.action))}),l(7," \u7ACB\u5373\u8A2D\u7F6E \u2192 "),k()()}if(i&2){let t=m(2);c(3),D(t.status().nextStep.icon),c(2),M("\u4E0B\u4E00\u6B65\uFF1A",t.status().nextStep.name)}}function jk(i,e){if(i&1&&(T(0,"div",2)(1,"div",38)(2,"div")(3,"h3",39),l(4,"\u914D\u7F6E\u9032\u5EA6"),k(),T(5,"p",40),l(6," \u5B8C\u6210\u914D\u7F6E\u5F8C\u5373\u53EF\u958B\u59CB\u81EA\u52D5\u5316\u76E3\u63A7 "),k()(),T(7,"div",41)(8,"div",42),l(9),k(),T(10,"div",43),l(11),k()()(),T(12,"div",44)(13,"div",45),ne(),T(14,"svg",46),Se(15,"circle",47)(16,"circle",48),k(),ce(),T(17,"div",49),y(18,$k,2,0,"span",50)(19,Hk,2,2,"span",51),k()(),T(20,"div",52),O(21,Wk,6,11,"div",53,wm),y(23,zk,2,1,"div",43),k()(),y(24,Kk,8,2,"div",54),k()),i&2){let t=m();c(9),M("",t.status().percentage,"%"),c(2),X("",t.status().completedCount,"/",t.status().totalCount," \u6B65\u9A5F"),c(5),_t("stroke-dasharray",t.circumference)("stroke-dashoffset",t.dashOffset()),c(2),S(t.status().isReady?18:19),c(3),U(t.status().steps.slice(0,4)),c(2),S(t.status().steps.length>4?23:-1),c(),S(t.status().nextStep?24:-1)}}function Jk(i,e){if(i&1&&l(0),i&2){let t=m(2);M(" \xB7 \u4E0B\u4E00\u6B65\uFF1A",t.status().nextStep.name," ")}}function Qk(i,e){if(i&1){let t=I();T(0,"button",62),se("click",function(){_(t);let o=m(2);return v(o.onAction(o.status().nextStep.action))}),l(1," \u7E7C\u7E8C\u914D\u7F6E "),k()}}function Yk(i,e){if(i&1&&(T(0,"div",3)(1,"div",57),l(2," \u26A0\uFE0F "),k(),T(3,"div",58)(4,"h4",59),l(5,"\u914D\u7F6E\u672A\u5B8C\u6210"),k(),T(6,"p",60),l(7),y(8,Jk,1,1),k()(),y(9,Qk,2,0,"button",61),k()),i&2){let t=m();c(7),M(" \u9084\u9700\u8981\u5B8C\u6210 ",t.status().totalCount-t.status().completedCount," \u500B\u6B65\u9A5F\u624D\u80FD\u958B\u59CB\u76E3\u63A7 "),c(),S(t.status().nextStep?8:-1),c(),S(t.status().nextStep?9:-1)}}var vn=class i{constructor(){this.stateService=F(Ct);this.mode=Le("detailed");this.action=ge();this.status=R(()=>this.stateService.configStatus());this.circumference=2*Math.PI*40;this.dashOffset=R(()=>{let e=this.status().percentage;return this.circumference*(1-e/100)})}onAction(e){this.action.emit(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-config-progress"]],inputs:{mode:[1,"mode"]},outputs:{action:"action"},decls:4,vars:4,consts:[[1,"flex","items-center","gap-3","px-4","py-2","bg-slate-800/80","rounded-xl","border","border-slate-700/50"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden"],[1,"bg-gradient-to-br","from-slate-800/80","to-slate-800/50","rounded-xl","border","border-slate-700/50","p-6"],[1,"bg-gradient-to-r","from-amber-500/20","to-orange-500/20","border","border-amber-500/30","rounded-xl","p-4","flex","items-center","gap-4"],[1,"flex","items-center","gap-1"],[1,"text-sm"],[1,"text-emerald-400","font-bold"],[1,"text-xs","text-cyan-400","hover:text-cyan-300","transition-colors","flex","items-center","gap-1"],[1,"w-6","h-6","rounded-full","flex","items-center","justify-center","text-xs","transition-all",3,"title"],[1,"w-3","h-0.5","transition-all",3,"bg-emerald-500","bg-slate-600"],[1,"w-3","h-0.5","transition-all"],[1,"text-xs","text-cyan-400","hover:text-cyan-300","transition-colors","flex","items-center","gap-1",3,"click"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"text-slate-500"],[1,"px-4","pt-4"],[1,"relative"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","rounded-full","transition-all","duration-500"],[1,"mt-1","text-right","text-xs","text-slate-500"],[1,"p-4","space-y-2"],[1,"flex","items-center","gap-3","p-3","rounded-lg","transition-all",3,"bg-emerald-500/10","bg-slate-700/30"],[1,"p-4","border-t","border-slate-700/50"],[1,"flex","items-center","gap-2","text-emerald-400"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3","p-3","rounded-lg","transition-all"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium"],[1,"text-xs","px-1.5","py-0.5","rounded",3,"bg-emerald-500/20","text-emerald-400","bg-slate-600/50","text-slate-400"],[1,"text-xs","text-slate-500","truncate"],[1,"px-3","py-1.5","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","text-xs","rounded-lg","transition-colors"],[1,"text-xs","px-1.5","py-0.5","rounded"],[1,"px-3","py-1.5","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","text-xs","rounded-lg","transition-colors",3,"click"],[1,"w-2","h-2","bg-emerald-500","rounded-full","animate-pulse"],[1,"text-sm","text-slate-400"],[1,"px-4","py-2","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","text-sm","rounded-lg","hover:from-cyan-600","hover:to-blue-600","transition-colors",3,"click"],[1,"flex","items-start","justify-between","mb-4"],[1,"font-semibold","text-white"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-right"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"flex","items-center","gap-6"],[1,"relative","w-24","h-24"],[1,"w-24","h-24","transform","-rotate-90"],["cx","48","cy","48","r","40","stroke-width","8","stroke","currentColor","fill","none",1,"text-slate-700"],["cx","48","cy","48","r","40","stroke-width","8","stroke","currentColor","fill","none","stroke-linecap","round",1,"text-emerald-500"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-lg","text-slate-300"],[1,"flex-1","space-y-2"],[1,"flex","items-center","gap-2","text-sm"],[1,"mt-4","pt-4","border-t","border-slate-700/50","flex","items-center","justify-between"],[1,"flex","items-center","gap-2","text-sm","text-slate-400"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","text-sm","rounded-lg","transition-colors",3,"click"],[1,"w-10","h-10","bg-amber-500/20","rounded-full","flex","items-center","justify-center","text-xl"],[1,"flex-1"],[1,"font-medium","text-amber-300"],[1,"text-sm","text-amber-200/70"],[1,"px-4","py-2","bg-amber-500","hover:bg-amber-600","text-white","rounded-lg","transition-colors"],[1,"px-4","py-2","bg-amber-500","hover:bg-amber-600","text-white","rounded-lg","transition-colors",3,"click"]],template:function(t,n){t&1&&(y(0,Nk,8,2,"div",0),y(1,Gk,23,6,"div",1),y(2,jk,25,8,"div",2),y(3,Yk,10,3,"div",3)),t&2&&(S(n.mode()==="compact"?0:-1),c(),S(n.mode()==="detailed"?1:-1),c(),S(n.mode()==="card"?2:-1),c(),S(n.mode()==="banner"&&!n.status().isReady?3:-1))},dependencies:[oe],encapsulation:2})}};var Xk=(i,e)=>e.id;function Zk(i,e){if(i&1&&(r(0,"span",60),l(1,"\u25CF \u76E3\u63A7\u904B\u884C\u4E2D"),s(),l(2)),i&2){let t=m();c(2),M(" \xB7 \u5DF2\u904B\u884C ",t.runningTime()," ")}}function eI(i,e){i&1&&(r(0,"span",61),l(1,"\u25CF \u76E3\u63A7\u5DF2\u505C\u6B62"),s(),l(2," \xB7 \u5B8C\u6210\u914D\u7F6E\u5F8C\u5373\u53EF\u958B\u59CB "))}function tI(i,e){i&1&&(r(0,"span"),l(1,"\u23F9\uFE0F"),s(),l(2," \u505C\u6B62\u76E3\u63A7 "))}function nI(i,e){i&1&&(r(0,"span"),l(1,"\u25B6\uFE0F"),s(),l(2," \u958B\u59CB\u76E3\u63A7 "))}function iI(i,e){if(i&1){let t=I();r(0,"button",71),x("click",function(){_(t);let o=m(2);return v(o.navigateTo("chat-templates"))}),r(1,"span"),l(2,"\u{1F4DD}"),s(),l(3," \u5275\u5EFA\u6D88\u606F\u6A21\u677F "),s()}}function oI(i,e){if(i&1){let t=I();r(0,"button",71),x("click",function(){_(t);let o=m(2);return v(o.navigateTo("automation-rules"))}),r(1,"span"),l(2,"\u26A1"),s(),l(3," \u914D\u7F6E\u89F8\u767C\u898F\u5247 "),s()}}function rI(i,e){if(i&1){let t=I();r(0,"div",9)(1,"div",62)(2,"span",13),l(3,"\u26A0\uFE0F"),s(),r(4,"div",63)(5,"p",64),l(6),s(),r(7,"p",65),l(8),s(),r(9,"div",66),y(10,iI,4,0,"button",67),y(11,oI,4,0,"button",67),s()(),r(12,"button",68),x("click",function(){_(t);let o=m();return v(o.dismissWarning())}),ne(),r(13,"svg",69),B(14,"path",70),s()()()()}if(i&2){let t=m();c(6),D(t.monitoringWarningMessage()),c(2),D(t.monitoringWarningDetail()),c(2),S(t.stateService.chatTemplates().length===0?10:-1),c(),S(t.hasActiveRules()?-1:11)}}function sI(i,e){i&1&&B(0,"span",29)}function aI(i,e){if(i&1){let t=I();r(0,"button",72),x("click",function(){_(t);let o=m();return v(o.clearActivities())}),l(1," \u6E05\u7A7A "),s()}}function lI(i,e){if(i&1&&(r(0,"p",76),l(1),s()),i&2){let t=m().$implicit;c(),D(t.detail)}}function cI(i,e){if(i&1&&(r(0,"div",73)(1,"span",42),l(2),s(),r(3,"div",74)(4,"p",75),l(5),s(),y(6,lI,2,1,"p",76),s(),r(7,"span",77),l(8),s()()),i&2){let t=e.$implicit,n=m(2);c(2),D(t.icon),c(3),D(t.message),c(),S(t.detail?6:-1),c(2),D(n.formatTime(t.timestamp))}}function dI(i,e){if(i&1&&O(0,cI,9,4,"div",73,Xk),i&2){let t=m();U(t.activities())}}function uI(i,e){if(i&1){let t=I();r(0,"button",88),x("click",function(){_(t);let o=m(2);return v(o.startMonitoringClick.emit())}),r(1,"span"),l(2,"\u25B6\uFE0F"),s(),l(3," \u958B\u59CB\u76E3\u63A7 "),s()}}function mI(i,e){if(i&1){let t=I();r(0,"div",34)(1,"div",78),l(2,"\u{1F4E1}"),s(),r(3,"p",79),l(4,"\u66AB\u7121\u4E8B\u4EF6\u8A18\u9304"),s(),r(5,"p",80),l(6," \u958B\u59CB\u76E3\u63A7\u5F8C\uFF0C\u4EE5\u4E0B\u4E8B\u4EF6\u5C07\u986F\u793A\u5728\u9019\u88E1\uFF1A "),s(),r(7,"div",81)(8,"span",82),l(9,"\u{1F511} \u95DC\u9375\u8A5E\u5339\u914D"),s(),r(10,"span",83),l(11,"\u{1F4E8} \u81EA\u52D5\u56DE\u8986"),s(),r(12,"span",84),l(13,"\u2728 \u65B0 Lead \u6355\u7372"),s()(),r(14,"div",85),y(15,uI,4,0,"button",86),r(16,"button",87),x("click",function(){_(t);let o=m();return v(o.navigateTo("automation-rules"))}),r(17,"span"),l(18,"\u2699\uFE0F"),s(),l(19," \u914D\u7F6E\u89F8\u767C\u898F\u5247 "),s()()()}if(i&2){let t=m();c(15),S(t.isMonitoring()?-1:15)}}function pI(i,e){if(i&1){let t=I();r(0,"app-config-progress",89),x("action",function(o){_(t);let a=m();return v(a.handleConfigAction(o))}),s()}}function gI(i,e){i&1&&(r(0,"span",54),l(1,"\u5F85\u8A2D\u7F6E"),s())}function hI(i,e){if(i&1){let t=I();r(0,"div",59)(1,"div",3)(2,"div",90)(3,"span",13),l(4,"\u{1F4A1}"),s()(),r(5,"div",63)(6,"h4",44),l(7),s(),r(8,"p",16),l(9),s()(),r(10,"button",91),x("click",function(){_(t);let o=m();return v(o.handleConfigAction(o.nextStepSuggestion().action))}),l(11),s()()()}if(i&2){let t=m();c(7),D(t.nextStepSuggestion().title),c(2),D(t.nextStepSuggestion().description),c(2),M(" ",t.nextStepSuggestion().buttonText," \u2192 ")}}var Dc=class i{constructor(){this.stateService=F(Ct);this.ipcService=F(Q);this.isMonitoring=Le(!1);this.todayStats=Le({matchCount:0,matchTrend:0,newLeads:0,leadsTrend:0,messagesSent:0,replySuccessRate:100,timeSaved:0,conversions:0});this.realtimeMatches=Le([]);this.startMonitoringClick=ge();this.stopMonitoringClick=ge();this.navigateToPage=ge();this.configActionEvent=ge();this.activities=f([]);this.runningTime=f("0:00");this.warningDismissed=f(!1);this.startTime=null;this.Math=Math;this.hasActiveRules=R(()=>this.stateService.hasActiveTriggerRules());this.showMonitoringWarning=R(()=>{if(this.warningDismissed())return!1;let e=this.stateService.chatTemplates().length===0,t=!this.hasActiveRules();return e||t});this.monitoringWarningMessage=R(()=>{let e=this.stateService.chatTemplates().length===0,t=!this.hasActiveRules();return e&&t?"\u76E3\u63A7\u4E2D\uFF0C\u4F46\u5C1A\u672A\u914D\u7F6E\u81EA\u52D5\u56DE\u8986\u529F\u80FD":e?"\u76E3\u63A7\u4E2D\uFF0C\u4F46\u7F3A\u5C11\u6D88\u606F\u6A21\u677F":t?"\u76E3\u63A7\u4E2D\uFF0C\u4F46\u7F3A\u5C11\u89F8\u767C\u898F\u5247":""});this.monitoringWarningDetail=R(()=>{let e=this.stateService.chatTemplates().length===0,t=!this.hasActiveRules();return e&&t?"\u5339\u914D\u5230\u7684\u6D88\u606F\u4E0D\u6703\u81EA\u52D5\u56DE\u8986\u3002\u8ACB\u5275\u5EFA\u6D88\u606F\u6A21\u677F\u548C\u89F8\u767C\u898F\u5247\u3002":e?"\u7121\u6CD5\u767C\u9001\u81EA\u52D5\u56DE\u8986\uFF0C\u56E0\u70BA\u6C92\u6709\u53EF\u7528\u7684\u6D88\u606F\u6A21\u677F\u3002":t?"\u5339\u914D\u5230\u7684\u6D88\u606F\u4E0D\u6703\u89F8\u767C\u4EFB\u4F55\u52D5\u4F5C\uFF0C\u8ACB\u524D\u5F80\u300C\u89F8\u767C\u898F\u5247\u300D\u914D\u7F6E\u3002":""});this.canStartMonitoring=R(()=>this.stateService.configStatus().completedCount>=4);this.nextStepSuggestion=R(()=>{let e=this.stateService.configStatus();if(e.isReady)return null;let t=e.nextStep;return t&&{"add-listener":{title:"\u6DFB\u52A0\u76E3\u63A7\u5E33\u865F",description:"\u9700\u8981\u6DFB\u52A0\u4E00\u500B\u7528\u65BC\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u7684 Telegram \u5E33\u865F",buttonText:"\u53BB\u6DFB\u52A0",action:"monitoring-accounts"},"add-group":{title:"\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44",description:"\u6DFB\u52A0\u9700\u8981\u76E3\u63A7\u7684 Telegram \u7FA4\u7D44",buttonText:"\u53BB\u6DFB\u52A0",action:"monitoring-groups"},"add-keywords":{title:"\u5275\u5EFA\u95DC\u9375\u8A5E\u96C6",description:"\u8A2D\u7F6E\u7528\u65BC\u5339\u914D\u6D88\u606F\u7684\u95DC\u9375\u8A5E",buttonText:"\u53BB\u5275\u5EFA",action:"keyword-sets"},"bind-keywords":{title:"\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6",description:"\u5C07\u95DC\u9375\u8A5E\u96C6\u7D81\u5B9A\u5230\u76E3\u63A7\u7FA4\u7D44",buttonText:"\u53BB\u7D81\u5B9A",action:"monitoring-groups"},"add-template":{title:"\u8A2D\u7F6E\u804A\u5929\u6A21\u677F",description:"\u914D\u7F6E\u81EA\u52D5\u56DE\u8986\u4F7F\u7528\u7684\u6D88\u606F\u6A21\u677F",buttonText:"\u53BB\u8A2D\u7F6E",action:"chat-templates"},"add-sender":{title:"\u914D\u7F6E\u767C\u9001\u5E33\u865F",description:"\u8A2D\u7F6E\u7528\u65BC\u767C\u9001\u81EA\u52D5\u56DE\u8986\u7684\u5E33\u865F",buttonText:"\u53BB\u914D\u7F6E",action:"monitoring-accounts"}}[t.action||""]||null});this.listeners=[]}ngOnInit(){this.stateService.loadAll(),this.setupActivityListeners()}ngOnDestroy(){this.runningInterval&&clearInterval(this.runningInterval),this.listeners.forEach(e=>e())}setupActivityListeners(){let e=this.ipcService.on("keyword-matched",g=>{this.addActivity({type:"match",message:`\u5728\u300C${g.groupName}\u300D\u5339\u914D\u5230\u95DC\u9375\u8A5E\u300C${g.keyword}\u300D`,detail:g.messagePreview,icon:"\u{1F3AF}"})});this.listeners.push(e);let t=this.ipcService.on("message-sent",g=>{this.addActivity({type:"reply",message:`\u81EA\u52D5\u56DE\u8986\u4E86 ${g.username||"\u7528\u6236"}`,icon:"\u{1F4E8}"})});this.listeners.push(t);let n=this.ipcService.on("lead-added",g=>{this.addActivity({type:"lead",message:`\u65B0\u589E Lead: ${g.username||g.name}`,icon:"\u2728"})});this.listeners.push(n);let o=this.ipcService.on("new-lead-captured",g=>{this.addActivity({type:"lead",message:`\u6355\u7372\u65B0 Lead: @${g.username||g.user_id}`,detail:`\u4F86\u81EA\u7FA4\u7D44: ${g.sourceGroup||g.source_group}`,icon:"\u2728"})});this.listeners.push(o);let a=this.ipcService.on("log-entry",g=>{if(g.message.includes("\u5339\u914D")||g.message.includes("\u76E3\u63A7")||g.message.includes("Lead")||g.message.includes("\u56DE\u8986")){let C=g.level==="success"?"\u2705":g.level==="warning"?"\u26A0\uFE0F":g.level==="error"?"\u274C":"\u2139\uFE0F";this.addActivity({type:"system",message:g.message,icon:C})}});this.listeners.push(a);let d=this.ipcService.on("monitoring-started",g=>{this.addActivity({type:"system",message:g?.message||"\u76E3\u63A7\u5DF2\u555F\u52D5",icon:"\u{1F680}"})});this.listeners.push(d);let u=this.ipcService.on("monitoring-stopped",()=>{this.addActivity({type:"system",message:"\u76E3\u63A7\u5DF2\u505C\u6B62",icon:"\u23F9\uFE0F"})});this.listeners.push(u);let p=this.ipcService.on("private-message-received",g=>{this.addActivity({type:"message",message:`\u6536\u5230\u79C1\u4FE1: @${g.from_username||g.user_id}`,detail:g.text?.substring(0,50)+(g.text?.length>50?"...":""),icon:"\u{1F4AC}"})});this.listeners.push(p)}addActivity(e){let t=P(E({},e),{id:`activity-${Date.now()}`,timestamp:new Date});this.activities.update(n=>[t,...n].slice(0,50))}clearActivities(){this.activities.set([])}toggleMonitoring(){this.isMonitoring()?(this.stopMonitoringClick.emit(),this.stopRunningTimer()):(this.startMonitoringClick.emit(),this.startRunningTimer())}startRunningTimer(){this.startTime=new Date,this.runningInterval=setInterval(()=>{if(this.startTime){let e=Date.now()-this.startTime.getTime(),t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);this.runningTime.set(`${t}:${n.toString().padStart(2,"0")}`)}},1e3)}stopRunningTimer(){this.runningInterval&&(clearInterval(this.runningInterval),this.runningInterval=null),this.runningTime.set("0:00"),this.startTime=null}navigateTo(e){this.navigateToPage.emit(e)}handleConfigAction(e){this.configActionEvent.emit(e)}formatTime(e){let n=new Date().getTime()-e.getTime();return n<6e4?"\u525B\u525B":n<36e5?`${Math.floor(n/6e4)} \u5206\u9418\u524D`:n<864e5?`${Math.floor(n/36e5)} \u5C0F\u6642\u524D`:e.toLocaleDateString()}dismissWarning(){this.warningDismissed.set(!0)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-dashboard-overview"]],inputs:{isMonitoring:[1,"isMonitoring"],todayStats:[1,"todayStats"],realtimeMatches:[1,"realtimeMatches"]},outputs:{startMonitoringClick:"startMonitoringClick",stopMonitoringClick:"stopMonitoringClick",navigateToPage:"navigateToPage",configActionEvent:"configActionEvent"},decls:164,vars:61,consts:[[1,"h-full","overflow-y-auto"],[1,"p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-2xl","flex","items-center","justify-center"],[1,"text-3xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-slate-400"],[1,"px-6","py-3","rounded-xl","font-medium","transition-all","flex","items-center","gap-2",3,"click","disabled"],[1,"mt-4","p-4","bg-gradient-to-r","from-amber-500/10","to-orange-500/10","rounded-xl","border","border-amber-500/30"],[1,"grid","grid-cols-2","lg:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-orange-500/20","to-amber-500/10","rounded-xl","border","border-orange-500/20","p-5"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-2xl"],[1,"text-xs","px-2","py-1","bg-orange-500/20","text-orange-400","rounded-full"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-sm","text-slate-400"],[1,"bg-gradient-to-br","from-emerald-500/20","to-teal-500/10","rounded-xl","border","border-emerald-500/20","p-5"],[1,"text-xs","px-2","py-1","bg-emerald-500/20","text-emerald-400","rounded-full"],[1,"bg-gradient-to-br","from-blue-500/20","to-cyan-500/10","rounded-xl","border","border-blue-500/20","p-5"],[1,"text-xs","px-2","py-1","bg-blue-500/20","text-blue-400","rounded-full"],[1,"bg-gradient-to-br","from-purple-500/20","to-pink-500/10","rounded-xl","border","border-purple-500/20","p-5"],[1,"text-xs","px-2","py-1","bg-purple-500/20","text-purple-400","rounded-full"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2","space-y-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"flex","items-center","gap-2"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"w-2","h-2","bg-emerald-500","rounded-full","animate-pulse"],["title","\u986F\u793A\u95DC\u9375\u8A5E\u5339\u914D\u3001\u81EA\u52D5\u56DE\u8986\u7B49\u4E8B\u4EF6\u8A18\u9304",1,"text-xs","text-slate-500"],[1,"text-xs","px-2","py-1","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded","transition-colors",3,"click"],[1,"text-xs","text-slate-500","hover:text-slate-400"],[1,"p-4","space-y-3","max-h-80","overflow-y-auto"],[1,"text-center","py-8"],["mode","detailed"],[1,"space-y-6"],[1,"p-4","border-b","border-slate-700/50"],[1,"p-4","space-y-3"],[1,"w-full","flex","items-center","justify-between","p-4","bg-slate-700/30","hover:bg-slate-700/50","rounded-xl","transition-colors","group",3,"click"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-lg","bg-cyan-500/20","flex","items-center","justify-center"],[1,"text-xl"],[1,"text-left"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-500"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-500","group-hover:text-cyan-400","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"w-10","h-10","rounded-lg","bg-emerald-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-500","group-hover:text-emerald-400","transition-colors"],[1,"w-10","h-10","rounded-lg","bg-purple-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-500","group-hover:text-purple-400","transition-colors"],[1,"w-10","h-10","rounded-lg","bg-pink-500/20","flex","items-center","justify-center"],[1,"font-medium","text-white","flex","items-center","gap-2"],[1,"text-xs","bg-amber-500/20","text-amber-400","px-1.5","py-0.5","rounded"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-500","group-hover:text-pink-400","transition-colors"],[1,"p-4","grid","grid-cols-2","gap-3"],[1,"flex","flex-col","items-center","gap-2","p-4","bg-slate-700/30","hover:bg-slate-700/50","rounded-xl","transition-colors",3,"click"],[1,"text-sm","text-slate-300"],[1,"bg-gradient-to-r","from-cyan-500/10","to-blue-500/10","rounded-xl","border","border-cyan-500/20","p-5"],[1,"text-emerald-400"],[1,"text-slate-500"],[1,"flex","items-start","gap-3"],[1,"flex-1"],[1,"text-amber-400","font-medium","mb-1"],[1,"text-slate-400","text-sm","mb-3"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1.5","bg-amber-500/20","hover:bg-amber-500/30","text-amber-400","text-sm","rounded-lg","transition-colors","flex","items-center","gap-1"],[1,"text-slate-500","hover:text-slate-400",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-3","py-1.5","bg-amber-500/20","hover:bg-amber-500/30","text-amber-400","text-sm","rounded-lg","transition-colors","flex","items-center","gap-1",3,"click"],[1,"text-xs","text-slate-500","hover:text-slate-400",3,"click"],[1,"flex","items-start","gap-3","p-3","bg-slate-700/30","rounded-lg","hover:bg-slate-700/50","transition-colors"],[1,"flex-1","min-w-0"],[1,"text-sm","text-white"],[1,"text-xs","text-slate-500","truncate"],[1,"text-xs","text-slate-500","whitespace-nowrap"],[1,"text-4xl","mb-3"],[1,"text-slate-400","font-medium","mb-2"],[1,"text-xs","text-slate-500","mb-4"],[1,"flex","flex-wrap","justify-center","gap-2","mb-4"],[1,"text-xs","px-2","py-1","bg-yellow-500/10","text-yellow-400","rounded"],[1,"text-xs","px-2","py-1","bg-blue-500/10","text-blue-400","rounded"],[1,"text-xs","px-2","py-1","bg-emerald-500/10","text-emerald-400","rounded"],[1,"flex","justify-center","gap-3"],[1,"text-sm","px-4","py-2","bg-gradient-to-r","from-emerald-500","to-cyan-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","flex","items-center","gap-2"],[1,"text-sm","px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-sm","px-4","py-2","bg-gradient-to-r","from-emerald-500","to-cyan-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","flex","items-center","gap-2",3,"click"],["mode","detailed",3,"action"],[1,"w-12","h-12","bg-cyan-500/20","rounded-xl","flex","items-center","justify-center"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","transition-colors",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),l(6),s()(),r(7,"div")(8,"h1",6),l(9,"\u81EA\u52D5\u5316\u76E3\u63A7\u4E2D\u5FC3"),s(),r(10,"p",7),y(11,Zk,3,1)(12,eI,3,0),s()()(),r(13,"button",8),x("click",function(){return n.toggleMonitoring()}),y(14,tI,3,0)(15,nI,3,0),s()(),y(16,rI,15,4,"div",9),r(17,"div",10)(18,"div",11)(19,"div",12)(20,"span",13),l(21,"\u{1F525}"),s(),r(22,"span",14),l(23),s()(),r(24,"div",15),l(25),s(),r(26,"div",16),l(27,"\u4ECA\u65E5\u5339\u914D"),s()(),r(28,"div",17)(29,"div",12)(30,"span",13),l(31,"\u2728"),s(),r(32,"span",18),l(33),s()(),r(34,"div",15),l(35),s(),r(36,"div",16),l(37,"\u65B0\u589E Leads"),s()(),r(38,"div",19)(39,"div",12)(40,"span",13),l(41,"\u{1F4E8}"),s(),r(42,"span",20),l(43),s()(),r(44,"div",15),l(45),s(),r(46,"div",16),l(47,"\u81EA\u52D5\u56DE\u8986"),s()(),r(48,"div",21)(49,"div",12)(50,"span",13),l(51,"\u23F0"),s(),r(52,"span",22),l(53," vs \u624B\u52D5 "),s()(),r(54,"div",15),l(55),s(),r(56,"div",16),l(57,"\u7BC0\u7701\u6642\u9593"),s()()(),r(58,"div",23)(59,"div",24)(60,"div",25)(61,"div",26)(62,"div",27)(63,"h3",28)(64,"span"),l(65,"\u{1F4E1}"),s(),l(66," \u76E3\u63A7\u4E8B\u4EF6\u6D41 "),y(67,sI,1,0,"span",29),s(),r(68,"span",30),l(69," \u24D8 "),s()(),r(70,"div",27)(71,"button",31),x("click",function(){return n.navigateTo("automation-rules")}),l(72," \u2699\uFE0F \u914D\u7F6E\u898F\u5247 "),s(),y(73,aI,2,0,"button",32),s()(),r(74,"div",33),y(75,dI,2,0)(76,mI,20,1,"div",34),s()(),y(77,pI,1,0,"app-config-progress",35),s(),r(78,"div",36)(79,"div",25)(80,"div",37)(81,"h3",28)(82,"span"),l(83,"\u2699\uFE0F"),s(),l(84," \u5FEB\u901F\u914D\u7F6E "),s()(),r(85,"div",38)(86,"button",39),x("click",function(){return n.navigateTo("monitoring-accounts")}),r(87,"div",40)(88,"div",41)(89,"span",42),l(90,"\u{1F4F1}"),s()(),r(91,"div",43)(92,"div",44),l(93,"\u76E3\u63A7\u5E33\u865F"),s(),r(94,"div",45),l(95),s()()(),ne(),r(96,"svg",46),B(97,"path",47),s()(),ce(),r(98,"button",39),x("click",function(){return n.navigateTo("monitoring-groups")}),r(99,"div",40)(100,"div",48)(101,"span",42),l(102,"\u{1F4AC}"),s()(),r(103,"div",43)(104,"div",44),l(105,"\u76E3\u63A7\u7FA4\u7D44"),s(),r(106,"div",45),l(107),Ee(108,"number"),s()()(),ne(),r(109,"svg",49),B(110,"path",47),s()(),ce(),r(111,"button",39),x("click",function(){return n.navigateTo("keyword-sets")}),r(112,"div",40)(113,"div",50)(114,"span",42),l(115,"\u{1F511}"),s()(),r(116,"div",43)(117,"div",44),l(118,"\u95DC\u9375\u8A5E\u96C6"),s(),r(119,"div",45),l(120),s()()(),ne(),r(121,"svg",51),B(122,"path",47),s()(),ce(),r(123,"button",39),x("click",function(){return n.navigateTo("chat-templates")}),r(124,"div",40)(125,"div",52)(126,"span",42),l(127,"\u{1F4DD}"),s()(),r(128,"div",43)(129,"div",53),l(130," \u804A\u5929\u6A21\u677F "),y(131,gI,2,0,"span",54),s(),r(132,"div",45),l(133),s()()(),ne(),r(134,"svg",55),B(135,"path",47),s()()()(),ce(),r(136,"div",25)(137,"div",37)(138,"h3",28)(139,"span"),l(140,"\u{1F4E6}"),s(),l(141," \u66F4\u591A\u529F\u80FD "),s()(),r(142,"div",56)(143,"button",57),x("click",function(){return n.navigateTo("resources")}),r(144,"span",13),l(145,"\u{1F4DA}"),s(),r(146,"span",58),l(147,"\u8CC7\u6599\u5EAB"),s()(),r(148,"button",57),x("click",function(){return n.navigateTo("rules")}),r(149,"span",13),l(150,"\u26A1"),s(),r(151,"span",58),l(152,"\u81EA\u52D5\u898F\u5247"),s()(),r(153,"button",57),x("click",function(){return n.navigateTo("send-settings")}),r(154,"span",13),l(155,"\u{1F4E4}"),s(),r(156,"span",58),l(157,"\u767C\u9001\u8A2D\u7F6E"),s()(),r(158,"button",57),x("click",function(){return n.navigateTo("analytics")}),r(159,"span",13),l(160,"\u{1F4CA}"),s(),r(161,"span",58),l(162,"\u6578\u64DA\u5206\u6790"),s()()()()()(),y(163,hI,12,3,"div",59),s()()),t&2&&(c(4),N("bg-gradient-to-br",n.isMonitoring())("from-emerald-500",n.isMonitoring())("to-cyan-500",n.isMonitoring())("bg-slate-700",!n.isMonitoring()),c(2),D(n.isMonitoring()?"\u{1F680}":"\u23F8\uFE0F"),c(5),S(n.isMonitoring()?11:12),c(2),N("bg-gradient-to-r",!n.isMonitoring())("from-emerald-500",!n.isMonitoring())("to-cyan-500",!n.isMonitoring())("text-white",!n.isMonitoring())("hover:shadow-lg",!n.isMonitoring())("hover:shadow-emerald-500/25",!n.isMonitoring())("bg-red-500/20",n.isMonitoring())("text-red-400",n.isMonitoring())("hover:bg-red-500/30",n.isMonitoring()),L("disabled",!n.canStartMonitoring()&&!n.isMonitoring()),c(),S(n.isMonitoring()?14:15),c(2),S(n.isMonitoring()&&n.showMonitoringWarning()?16:-1),c(7),X(" ",n.todayStats().matchTrend>=0?"\u2191":"\u2193"," ",n.Math.abs(n.todayStats().matchTrend),"% "),c(2),D(n.todayStats().matchCount),c(8),X(" ",n.todayStats().leadsTrend>=0?"\u2191":"\u2193"," ",n.Math.abs(n.todayStats().leadsTrend),"% "),c(2),D(n.todayStats().newLeads),c(8),M(" \u6210\u529F\u7387 ",n.todayStats().replySuccessRate,"% "),c(2),D(n.todayStats().messagesSent),c(10),M("",n.todayStats().timeSaved,"h"),c(12),S(n.isMonitoring()?67:-1),c(6),S(n.activities().length>0?73:-1),c(2),S(n.activities().length>0?75:76),c(2),S(n.stateService.configStatus().isReady?-1:77),c(18),X("",n.stateService.listenerAccounts().length," \u76E3\u807D \xB7 ",n.stateService.senderAccounts().length," \u767C\u9001"),c(12),X("",n.stateService.groups().length," \u500B\u7FA4\u7D44 \xB7 ",je(108,59,n.stateService.totalMembers())," \u6210\u54E1"),c(13),X("",n.stateService.keywordSets().length," \u8A5E\u96C6 \xB7 ",n.stateService.totalKeywords()," \u95DC\u9375\u8A5E"),c(3),N("border-2",n.stateService.chatTemplates().length===0)("border-dashed",n.stateService.chatTemplates().length===0)("border-amber-500/50",n.stateService.chatTemplates().length===0),c(8),S(n.stateService.chatTemplates().length===0?131:-1),c(2),M("",n.stateService.chatTemplates().length," \u500B\u6A21\u677F"),c(30),S(n.nextStepSuggestion()?163:-1))},dependencies:[oe,vn,St],encapsulation:2})}};var Ac=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.membershipService=F(Ie);this.monitoringMgmt=F(Hn);this.isMonitoring=R(()=>this.monitoringMgmt.monitoringActive());this.monitoringStats=f({groups:0,keywords:0,messages:0,triggered:0});this.ipcCleanup=[]}ngOnInit(){this.loadStatus(),this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}loadStatus(){this.ipc.send("get-monitoring-status"),this.ipc.send("get-monitoring-stats")}setupIpcListeners(){let e=this.ipc.on("monitoring-stats",a=>{this.monitoringStats.set(a)}),t=this.ipc.on("monitoring-started",a=>{let d=typeof a=="object"&&a?.message?a.message:"\u76E3\u63A7\u5DF2\u555F\u52D5";this.toast.success(d)}),n=this.ipc.on("monitoring-stopped",()=>{this.toast.info("\u76E3\u63A7\u5DF2\u505C\u6B62")}),o=this.ipc.on("monitoring-start-failed",a=>{console.log("[AutomationView] \u76E3\u63A7\u555F\u52D5\u5931\u6557:",a);let d=a.message||"\u76E3\u63A7\u555F\u52D5\u5931\u6557";a.reason==="config_check_failed"&&a.issues?.length?d=`\u914D\u7F6E\u932F\u8AA4: ${a.issues[0]?.message||d}`:a.reason==="no_accessible_groups"?d="\u7121\u6CD5\u8A2A\u554F\u76E3\u63A7\u7FA4\u7D44\uFF0C\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44":a.reason==="all_accounts_failed"&&(d="\u6240\u6709\u76E3\u63A7\u5E33\u865F\u90FD\u7121\u6CD5\u555F\u52D5"),this.toast.error(d,5e3)});this.ipcCleanup.push(e,t,n,o)}t(e,t){return this.i18n.t(e,t)}navigateTo(e){this.nav.navigateTo(e)}startMonitoring(){this.ipc.send("start-monitoring")}stopMonitoring(){this.ipc.send("stop-monitoring")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-automation-view"]],decls:1,vars:1,consts:[[3,"startMonitoringClick","stopMonitoringClick","navigateToPage","isMonitoring"]],template:function(t,n){t&1&&(r(0,"app-dashboard-overview",0),x("startMonitoringClick",function(){return n.startMonitoring()})("stopMonitoringClick",function(){return n.stopMonitoring()})("navigateToPage",function(a){return n.navigateTo(a)}),s()),t&2&&L("isMonitoring",n.isMonitoring())},dependencies:[oe,ae,Dc],encapsulation:2,changeDetection:0})}};var fI=()=>[1,2,3,4,5],Em=(i,e)=>e.id;function _I(i,e){return this.getResourceTrackId(e,i)}function vI(i,e){if(i&1){let t=I();r(0,"button",40),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectAccount(o))}),B(1,"span",34),r(2,"span",41),l(3),s()()}if(i&2){let t=e.$implicit;c(),N("bg-green-400",t.status==="Online")("bg-slate-400",t.status!=="Online"),c(2),D(t.phone)}}function xI(i,e){if(i&1&&(r(0,"div",37)(1,"div",38),O(2,vI,4,5,"button",39,Em),s()()),i&2){let t=m(2);c(2),U(t.mergedAccounts())}}function CI(i,e){if(i&1){let t=I();r(0,"div",10)(1,"button",33),x("click",function(){_(t);let o=m();return v(o.showAccountSelector.set(!o.showAccountSelector()))}),B(2,"span",34),r(3,"span",35),l(4),s(),r(5,"span",36),l(6,"\u25BC"),s()(),y(7,xI,4,0,"div",37),s()}if(i&2){let t=e,n=m();c(2),N("bg-green-400",t.status==="Online")("bg-slate-400",t.status!=="Online"),c(2),D(t.phone),c(3),S(n.showAccountSelector()?7:-1)}}function bI(i,e){i&1&&(r(0,"span",11),l(1,"\u26A0\uFE0F \u7121\u53EF\u7528\u5E33\u865F"),s())}function yI(i,e){i&1&&(r(0,"span",12),l(1," \u{1F504} \u641C\u7D22\u4E2D... "),s())}function SI(i,e){i&1&&(r(0,"span",13),l(1," \u2705 \u5C31\u7DD2 "),s())}function wI(i,e){if(i&1){let t=I();r(0,"button",48),x("mousedown",function(){let o=_(t).$implicit,a=m(3);return v(a.quickSearch(o))}),l(1),s()}if(i&2){let t=e.$implicit;c(),M(" ",t," ")}}function EI(i,e){if(i&1&&(r(0,"div",42)(1,"div",44),l(2,"\u{1F550} \u6700\u8FD1\u641C\u7D22"),s(),r(3,"div",45),O(4,wI,2,1,"button",47,be),s()()),i&2){let t=m(2);c(4),U(t.mergedHistoryKeywords().slice(0,5))}}function DI(i,e){if(i&1){let t=I();r(0,"button",49),x("mousedown",function(){let o=_(t).$implicit,a=m(2);return v(a.quickSearch(o))}),l(1),s()}if(i&2){let t=e.$implicit;c(),M(" ",t," ")}}function AI(i,e){if(i&1&&(r(0,"div",19),y(1,EI,6,0,"div",42),r(2,"div",43)(3,"div",44),l(4,"\u{1F525} \u71B1\u9580\u641C\u7D22"),s(),r(5,"div",45),O(6,DI,2,1,"button",46,be),s()()()),i&2){let t=m();c(),S(t.mergedHistoryKeywords().length>0?1:-1),c(5),U(t.hotKeywords)}}function MI(i,e){if(i&1&&(r(0,"span",54),l(1),s()),i&2){let t=m().$implicit;de(t.tagClass),c(),D(t.tag)}}function TI(i,e){if(i&1){let t=I();r(0,"label",50)(1,"input",51),x("change",function(){let o=_(t).$implicit,a=m();return v(a.toggleSource(o.id))}),s(),r(2,"span"),l(3),s(),r(4,"span",52),l(5),s(),y(6,MI,2,3,"span",53),s()}if(i&2){let t=e.$implicit,n=m();de(t.disabled?"bg-slate-800/50 border border-slate-700/30 cursor-not-allowed opacity-50":n.selectedSources().includes(t.id)?"bg-cyan-500/20 border border-cyan-500/50 cursor-pointer":"bg-slate-700/30 border border-slate-700 hover:bg-slate-700/50 cursor-pointer"),L("title",t.disabled?"\u8A72\u529F\u80FD\u6B63\u5728\u958B\u767C\u4E2D\uFF0C\u656C\u8ACB\u671F\u5F85":""),c(),L("checked",n.selectedSources().includes(t.id))("disabled",t.disabled),c(2),D(t.icon),c(2),D(t.name),c(),S(t.tag?6:-1)}}function kI(i,e){if(i&1&&(r(0,"div",24)(1,"span",69),l(2,"\u7576\u524D\u641C\u7D22\uFF1A"),s(),r(3,"span",70),l(4),s()()),i&2){let t=m(2);c(4),M(" \u{1F50D} ",t.currentKeyword()," ")}}function II(i,e){if(i&1&&(r(0,"span",71),l(1),s(),r(2,"span",72),l(3),s()),i&2){let t=m(2);c(),M("\u{1F195} ",t.newDiscoveredCount()," \u500B\u65B0\u767C\u73FE"),c(2),M("\u{1F504} ",t.existingCount()," \u500B\u5DF2\u77E5")}}function FI(i,e){if(i&1&&(r(0,"span",57)(1,"span",73),l(2,"\u23F3"),s(),l(3),s()),i&2){let t=m(2);c(3),M(" ",t.searchProgress()," ")}}function PI(i,e){i&1&&(r(0,"span",58)(1,"span",74),l(2,"\u{1F4CA}"),s(),l(3," \u6B63\u5728\u7372\u53D6\u6210\u54E1\u6578\u7B49\u8A73\u60C5... "),s())}function RI(i,e){if(i&1&&(r(0,"span",64),l(1),s()),i&2){let t=m(2);c(),M(" ",t.activeFilterCount()," ")}}function NI(i,e){if(i&1){let t=I();r(0,"div",67)(1,"div")(2,"label",75),l(3,"\u6210\u54E1\u6578\u7BC4\u570D"),s(),r(4,"div",24)(5,"input",76),x("change",function(o){_(t);let a=m(2);return v(a.filterMemberMin.set(o.target.value?+o.target.value:null))}),s(),r(6,"span",77),l(7,"-"),s(),r(8,"input",78),x("change",function(o){_(t);let a=m(2);return v(a.filterMemberMax.set(o.target.value?+o.target.value:null))}),s()()(),r(9,"div")(10,"label",75),l(11,"\u4F86\u6E90\u6E20\u9053"),s(),r(12,"select",79),x("change",function(o){_(t);let a=m(2);return v(a.filterSource.set(o.target.value))}),r(13,"option",60),l(14,"\u5168\u90E8\u4F86\u6E90"),s(),r(15,"option",80),l(16,"TG \u5B98\u65B9"),s(),r(17,"option",81),l(18,"\u4E2D\u6587\u641C\u7D22"),s(),r(19,"option",82),l(20,"\u672C\u5730\u7D22\u5F15"),s()()(),r(21,"div")(22,"label",75),l(23,"\u52A0\u5165\u72C0\u614B"),s(),r(24,"select",79),x("change",function(o){_(t);let a=m(2);return v(a.filterJoinStatus.set(o.target.value))}),r(25,"option",60),l(26,"\u5168\u90E8\u72C0\u614B"),s(),r(27,"option",83),l(28,"\u5DF2\u52A0\u5165"),s(),r(29,"option",84),l(30,"\u672A\u52A0\u5165"),s()()(),r(31,"div")(32,"label",75),l(33,"\u5176\u4ED6\u9078\u9805"),s(),r(34,"div",3)(35,"label",85)(36,"input",86),x("change",function(o){_(t);let a=m(2);return v(a.filterHasId.set(o.target.checked))}),s(),r(37,"span",87),l(38,"\u53EA\u986F\u793A\u6709 ID"),s()(),r(39,"button",88),x("click",function(){_(t);let o=m(2);return v(o.resetFilters())}),l(40," \u91CD\u7F6E\u7BE9\u9078 "),s()()()()}if(i&2){let t=m(2);c(5),L("value",t.filterMemberMin()||""),c(3),L("value",t.filterMemberMax()||""),c(4),L("value",t.filterSource()),c(12),L("value",t.filterJoinStatus()),c(12),L("checked",t.filterHasId())}}function VI(i,e){if(i&1){let t=I();r(0,"div",91)(1,"span",92),l(2),s(),B(3,"div",93),r(4,"button",94),x("click",function(){_(t);let o=m(3);return v(o.batchSaveSelected())}),l(5," \u2B50 \u6536\u85CF\u9078\u4E2D "),s(),r(6,"button",95),x("click",function(){_(t);let o=m(3);return v(o.copySelectedIds())}),l(7," \u{1F4CB} \u8907\u88FDID "),s()()}if(i&2){let t=m(3);c(2),M(" \u2713 \u5DF2\u9078 ",t.selectedCount()," \u9805 ")}}function BI(i,e){if(i&1){let t=I();r(0,"div",68)(1,"div",89)(2,"span",69),l(3,"\u6279\u91CF\u64CD\u4F5C:"),s(),r(4,"button",90),x("click",function(){_(t);let o=m(2);return v(o.selectAllVisible())}),l(5," \u2611\uFE0F \u5168\u9078\u672C\u9801 "),s(),r(6,"button",90),x("click",function(){_(t);let o=m(2);return v(o.clearSelection())}),l(7," \u2610 \u53D6\u6D88\u5168\u9078 "),s(),r(8,"button",90),x("click",function(){_(t);let o=m(2);return v(o.invertSelection())}),l(9," \u21C6 \u53CD\u9078 "),s()(),y(10,VI,8,1,"div",91),s()}if(i&2){let t=m(2);c(10),S(t.selectedCount()>0?10:-1)}}function LI(i,e){if(i&1){let t=I();r(0,"div",27)(1,"div",2)(2,"div",3),y(3,kI,5,1,"div",24),r(4,"span",55),l(5," \u5171 "),r(6,"span",56),l(7),s(),l(8," \u500B\u7D50\u679C "),y(9,II,4,2),s(),y(10,FI,4,1,"span",57),y(11,PI,4,0,"span",58),s(),r(12,"div",24)(13,"select",59),W("ngModelChange",function(o){_(t);let a=m();return q(a.filterType,o)||(a.filterType=o),v(o)}),r(14,"option",60),l(15,"\u5168\u90E8\u985E\u578B"),s(),r(16,"option",61),l(17,"\u7FA4\u7D44"),s(),r(18,"option",62),l(19,"\u983B\u9053"),s()(),r(20,"button",63),x("click",function(){_(t);let o=m();return v(o.showAdvancedFilter.set(!o.showAdvancedFilter()))}),l(21," \u{1F39B}\uFE0F \u9AD8\u7D1A\u7BE9\u9078 "),y(22,RI,2,1,"span",64),s(),r(23,"button",65),x("click",function(){_(t);let o=m();return v(o.batchSave())}),l(24," \u2B50 \u6279\u91CF\u6536\u85CF "),s(),r(25,"button",66),x("click",function(){_(t);let o=m();return v(o.exportResults())}),l(26),s()()(),y(27,NI,41,5,"div",67),y(28,BI,11,1,"div",68),s()}if(i&2){let t=m();c(3),S(t.currentKeyword()?3:-1),c(4),D(t.mergedResources().length),c(2),S(t.newDiscoveredCount()>0||t.existingCount()>0?9:-1),c(),S(t.searchProgress()?10:-1),c(),S(t.isFetchingDetails()?11:-1),c(2),H("ngModel",t.filterType),c(7),de(t.showAdvancedFilter()||t.activeFilterCount()>0?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50":"bg-slate-700/50 text-slate-300 border border-slate-700 hover:border-slate-600"),c(2),S(t.activeFilterCount()>0?22:-1),c(3),de(t.filteredResources().length>0?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-slate-600/30 text-slate-500 cursor-not-allowed"),L("disabled",t.filteredResources().length===0),c(),M(" \u{1F4E4} \u5C0E\u51FA\u5168\u90E8 (",t.filteredResources().length,") "),c(),S(t.showAdvancedFilter()?27:-1),c(),S(t.filteredResources().length>0?28:-1)}}function OI(i,e){i&1&&(r(0,"div",96)(1,"div",97),B(2,"div",98),r(3,"div",99),B(4,"div",100)(5,"div",101)(6,"div",102),s()()())}function UI(i,e){i&1&&(r(0,"div",29),O(1,OI,7,0,"div",96,be),s()),i&2&&(c(),U(rt(0,fI)))}function GI(i,e){if(i&1){let t=I();r(0,"div",103)(1,"div",104),l(2,"\u26A0\uFE0F"),s(),r(3,"p",105),l(4,"\u641C\u7D22\u5931\u6557"),s(),r(5,"p",106),l(6),s(),r(7,"button",107),x("click",function(){_(t);let o=m(2);return v(o.doSearch())}),l(8," \u{1F504} \u91CD\u8A66 "),s()()}if(i&2){let t=m(2);c(6),D(t.mergedSearchError().message)}}function $I(i,e){if(i&1){let t=I();r(0,"button",113),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.quickSearch(o))}),l(1),s()}if(i&2){let t=e.$implicit;c(),M(" ",t," ")}}function HI(i,e){if(i&1&&(r(0,"div",104),l(1,"\u{1F50D}"),s(),r(2,"p",108),l(3,"\u958B\u59CB\u641C\u7D22\u767C\u73FE\u7FA4\u7D44"),s(),r(4,"p",109),l(5,"\u8F38\u5165\u95DC\u9375\u8A5E\u641C\u7D22 Telegram \u7FA4\u7D44\u548C\u983B\u9053"),s(),r(6,"div",110)(7,"span",111),l(8,"\u8A66\u8A66\uFF1A"),s(),O(9,$I,2,1,"button",112,be),s()),i&2){let t=m(2);c(9),U(t.hotKeywords.slice(0,5))}}function qI(i,e){if(i&1&&(r(0,"div",30),y(1,GI,9,1,"div",103)(2,HI,11,0),s()),i&2){let t=m();c(),S(t.mergedSearchError().hasError?1:2)}}function WI(i,e){if(i&1&&(r(0,"option",118),l(1),s()),i&2){let t=e.$implicit;L("value",t),c(),D(t)}}function zI(i,e){i&1&&(r(0,"span",128),l(1,"\u2713"),s())}function KI(i,e){i&1&&(r(0,"span",133),l(1," \u2705 \u5DF2\u52A0\u5165 "),s())}function jI(i,e){i&1&&(r(0,"span",134),l(1," \u{1F195} \u65B0\u767C\u73FE "),s())}function JI(i,e){i&1&&(r(0,"span",135),l(1," \u{1F504} \u5DF2\u77E5 "),s())}function QI(i,e){if(i&1){let t=I();r(0,"a",155),x("click",function(o){return _(t),v(o.stopPropagation())}),l(1),s()}if(i&2){let t=m().$implicit;L("href","https://t.me/"+t.username,ot),c(),M(" @",t.username," ")}}function YI(i,e){if(i&1){let t=I();r(0,"code",156),l(1),s(),r(2,"button",157),x("click",function(o){_(t);let a=m().$implicit,d=m(2);return v(d.copyId(a,o))}),l(3),s()}if(i&2){let t=m().$implicit,n=m(2);c(),D(t.telegram_id),c(),de(n.copiedId()===t.telegram_id?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-400 hover:bg-cyan-500/20 hover:text-cyan-400"),c(),M(" ",n.copiedId()===t.telegram_id?"\u2713 \u5DF2\u8907\u88FD":"\u{1F4CB} \u8907\u88FD"," ")}}function XI(i,e){if(i&1&&(r(0,"code",158),l(1),s(),r(2,"span",159),l(3," \u26A0\uFE0F \u9700\u52A0\u5165\u7372\u53D6 "),s()),i&2){let t=m().$implicit;c(),M("@",t.username)}}function ZI(i,e){i&1&&(r(0,"span",111),l(1,"\u9700\u901A\u904E\u9080\u8ACB\u93C8\u63A5\u52A0\u5165"),s())}function eF(i,e){if(i&1){let t=I();r(0,"span",160),l(1,"|"),s(),r(2,"button",161),x("click",function(o){_(t);let a=m().$implicit,d=m(2);return v(d.copyLink(a,o))}),l(3),s()}if(i&2){let t=m().$implicit,n=m(2);c(2),de(n.copiedLink()===t.username?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-400 hover:bg-cyan-500/20 hover:text-cyan-400"),c(),M(" ",n.copiedLink()===t.username?"\u2713 \u5DF2\u8907\u88FD":"\u{1F517} \u8907\u88FD\u9023\u7D50"," ")}}function tF(i,e){if(i&1&&(r(0,"p",139),l(1),s()),i&2){let t=m().$implicit;c(),D(t.description)}}function nF(i,e){if(i&1&&(r(0,"span",144),l(1),Ee(2,"number"),s()),i&2){let t=m().$implicit;c(),M(" \u{1F4C8} +",je(2,1,t.member_change)," ")}}function iF(i,e){if(i&1&&(r(0,"span",145),l(1),Ee(2,"number"),s()),i&2){let t=m().$implicit;c(),M(" \u{1F4C9} ",je(2,1,t.member_change)," ")}}function oF(i,e){i&1&&(r(0,"span",162),l(1,"\u2B50\u2B50\u2B50"),s(),r(2,"span",163),l(3,"\u9AD8\u5EA6\u76F8\u95DC"),s())}function rF(i,e){i&1&&(r(0,"span",162),l(1,"\u2B50\u2B50"),s(),r(2,"span",9),l(3,"\u4E2D\u5EA6\u76F8\u95DC"),s())}function sF(i,e){i&1&&(r(0,"span",162),l(1,"\u2B50"),s(),r(2,"span",77),l(3,"\u4E00\u822C\u76F8\u95DC"),s())}function aF(i,e){if(i&1&&(r(0,"span",148),l(1),s()),i&2){let t=m().$implicit,n=m(2);c(),M(" ",n.getSourceLabel(t.discovery_source)," ")}}function lF(i,e){i&1&&(r(0,"span",149),l(1,"\u2713 \u5DF2\u52A0\u5165"),s())}function cF(i,e){if(i&1&&(r(0,"span",165),l(1),s()),i&2){let t=m(2).$implicit;c(),M("",t.joined_phone.slice(0,7),"***")}}function dF(i,e){if(i&1&&(r(0,"div",151)(1,"span",164),l(2," \u2705 \u5DF2\u52A0\u5165 "),s(),y(3,cF,2,1,"span",165),s()),i&2){let t=m().$implicit;c(3),S(t.joined_phone?3:-1)}}function uF(i,e){i&1&&(r(0,"button",152)(1,"span",73),l(2,"\u23F3"),s(),l(3," \u52A0\u5165\u4E2D... "),s())}function mF(i,e){if(i&1){let t=I();r(0,"button",166),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.openJoinDialog(o))}),l(1," \u{1F680} \u52A0\u5165 "),s()}}function pF(i,e){if(i&1){let t=I();r(0,"button",169),x("click",function(){_(t);let o=m(2).$implicit,a=m(2);return v(a.extractMembers(o))}),l(1," \u{1F465} \u63D0\u53D6\u6210\u54E1 "),s()}}function gF(i,e){i&1&&(r(0,"button",168),l(1," \u{1F465} \u6210\u54E1 "),s())}function hF(i,e){if(i&1&&y(0,pF,2,0,"button",167)(1,gF,2,0,"button",168),i&2){let t=m().$implicit;S(t.status==="joined"||t.status==="monitoring"?0:1)}}function fF(i,e){i&1&&(r(0,"button",154),l(1," \u{1F465} \u6210\u54E1 \u{1F512} "),s())}function _F(i,e){if(i&1){let t=I();r(0,"div",122),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.openDetail(o))}),r(1,"div",123)(2,"div",124)(3,"label",125),x("click",function(o){return _(t),v(o.stopPropagation())}),r(4,"input",126),x("change",function(o){let a=_(t).$implicit,d=m(2);return v(d.toggleBatchSelect(a,o))}),s(),r(5,"div",127),y(6,zI,2,0,"span",128),s()(),r(7,"button",129),x("click",function(o){let a=_(t).$implicit;return m(2).toggleSave(a),v(o.stopPropagation())}),l(8),s()(),r(9,"div",130)(10,"div",131)(11,"span",132),l(12),s(),y(13,KI,2,0,"span",133),y(14,jI,2,0,"span",134)(15,JI,2,0,"span",135),r(16,"h4",136),l(17),s(),y(18,QI,2,2,"a",137),s(),r(19,"div",138)(20,"span",69),l(21,"ID:"),s(),y(22,YI,4,4)(23,XI,4,1)(24,ZI,2,0,"span",111),y(25,eF,4,3),s(),y(26,tF,2,1,"p",139),r(27,"div",140)(28,"span",141)(29,"span",142),l(30,"\u{1F465}"),s(),r(31,"span",143),l(32),Ee(33,"number"),s(),l(34," \u6210\u54E1 "),y(35,nF,3,3,"span",144)(36,iF,3,3,"span",145),s(),r(37,"span",146),y(38,oF,4,0)(39,rF,4,0)(40,sF,4,0),r(41,"span",147),l(42),s()(),y(43,aF,2,1,"span",148),y(44,lF,2,0,"span",149),s()(),r(45,"div",150),x("click",function(o){return _(t),v(o.stopPropagation())}),y(46,dF,4,1,"div",151)(47,uF,4,0,"button",152)(48,mF,2,0,"button",153),y(49,hF,2,1)(50,fF,2,0,"button",154),s()()()}if(i&2){let t=e.$implicit,n=m(2);de(n.isSelectedForBatch(t)?"border-cyan-500/70 shadow-lg shadow-cyan-500/10":"border-slate-700/50 hover:border-cyan-500/50 hover:shadow-lg hover:shadow-cyan-500/10"),c(4),L("checked",n.isSelectedForBatch(t)),c(),de(n.isSelectedForBatch(t)?"bg-cyan-500 border-cyan-500":"border-slate-500 hover:border-cyan-400"),c(),S(n.isSelectedForBatch(t)?6:-1),c(),de(t.is_saved?"bg-yellow-500/20 text-yellow-400":"bg-slate-700/50 text-slate-400 hover:bg-yellow-500/20 hover:text-yellow-400"),L("title",t.is_saved?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF"),c(),M(" ",t.is_saved?"\u2B50":"\u2606"," "),c(3),de(t.resource_type==="channel"?"bg-purple-500/30 text-purple-300":"bg-blue-500/30 text-blue-300"),c(),M(" ",t.resource_type==="channel"?"\u{1F4E2} \u983B\u9053":"\u{1F465} \u7FA4\u7D44"," "),c(),S(t.status==="joined"||t.status==="monitoring"?13:-1),c(),S(t.is_new?14:t.is_new===!1?15:-1),c(3),D(t.title),c(),S(t.username?18:-1),c(4),S(t.telegram_id?22:t.username?23:24),c(3),S(t.username?25:-1),c(),S(t.description?26:-1),c(6),D(je(33,28,t.member_count)),c(3),S(t.member_change&&t.member_change>0?35:t.member_change&&t.member_change<0?36:-1),c(3),S((t.overall_score||0)>=.7?38:(t.overall_score||0)>=.5?39:40),c(4),M(" (",n.formatScore(t.overall_score),") "),c(),S(t.discovery_source?43:-1),c(),S(t.status==="joined"||t.status==="monitoring"?44:-1),c(2),S(t.status==="joined"||t.status==="monitoring"?46:n.isJoining(t)?47:48),c(3),S(t.resource_type!=="channel"?49:50)}}function vF(i,e){if(i&1){let t=I();r(0,"button",173),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.goToPage(o))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(3);de(t===n.currentPage()?"bg-cyan-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-600"),c(),M(" ",t," ")}}function xF(i,e){if(i&1){let t=I();r(0,"div",121)(1,"button",170),x("click",function(){_(t);let o=m(2);return v(o.firstPage())}),l(2," \u23EE\uFE0F \u9996\u9801 "),s(),r(3,"button",170),x("click",function(){_(t);let o=m(2);return v(o.prevPage())}),l(4," \u25C0\uFE0F \u4E0A\u4E00\u9801 "),s(),O(5,vF,2,3,"button",171,be),r(7,"button",170),x("click",function(){_(t);let o=m(2);return v(o.nextPage())}),l(8," \u4E0B\u4E00\u9801 \u25B6\uFE0F "),s(),r(9,"button",170),x("click",function(){_(t);let o=m(2);return v(o.lastPage())}),l(10," \u5C3E\u9801 \u23ED\uFE0F "),s(),r(11,"span",172),l(12),s()()}if(i&2){let t=m(2);c(),de(t.currentPage()===1?"bg-slate-700/30 text-slate-500 cursor-not-allowed":"bg-slate-700/50 text-slate-300 hover:bg-slate-600"),L("disabled",t.currentPage()===1),c(2),de(t.currentPage()===1?"bg-slate-700/30 text-slate-500 cursor-not-allowed":"bg-slate-700/50 text-slate-300 hover:bg-slate-600"),L("disabled",t.currentPage()===1),c(2),U(t.pageNumbers()),c(2),de(t.currentPage()===t.totalPages()?"bg-slate-700/30 text-slate-500 cursor-not-allowed":"bg-slate-700/50 text-slate-300 hover:bg-slate-600"),L("disabled",t.currentPage()===t.totalPages()),c(2),de(t.currentPage()===t.totalPages()?"bg-slate-700/30 text-slate-500 cursor-not-allowed":"bg-slate-700/50 text-slate-300 hover:bg-slate-600"),L("disabled",t.currentPage()===t.totalPages()),c(3),X(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801 ")}}function CF(i,e){if(i&1){let t=I();r(0,"div",114)(1,"div",21),l(2," \u5171 "),r(3,"span",115),l(4),s(),l(5," \u500B\u7D50\u679C\uFF0C \u986F\u793A\u7B2C "),r(6,"span",116),l(7),s(),l(8," - "),r(9,"span",116),l(10),s(),l(11," \u500B "),s(),r(12,"div",24)(13,"span",21),l(14,"\u6BCF\u9801"),s(),r(15,"select",117),x("ngModelChange",function(o){_(t);let a=m();return v(a.changePageSize(o))}),O(16,WI,2,2,"option",118,be),s()()(),r(18,"div",119),O(19,_F,51,30,"div",120,_I,!0),s(),y(21,xF,13,14,"div",121)}if(i&2){let t=m();c(4),D(t.filteredResources().length),c(3),D((t.currentPage()-1)*t.pageSize()+1),c(3),D(t.Math.min(t.currentPage()*t.pageSize(),t.filteredResources().length)),c(5),L("ngModel",t.pageSize()),c(),U(t.pageSizeOptions),c(3),U(t.pagedResources()),c(2),S(t.filteredResources().length>t.pageSize()?21:-1)}}function bF(i,e){if(i&1&&(r(0,"a",187),l(1),s()),i&2){let t=m();L("href","https://t.me/"+t.username,ot),c(),M(" @",t.username," ")}}function yF(i,e){if(i&1){let t=I();r(0,"code",209),l(1),s(),r(2,"button",210),x("click",function(o){_(t);let a=m(),d=m();return v(d.copyId(a,o))}),l(3),s()}if(i&2){let t=m(),n=m();c(),D(t.telegram_id),c(),de(n.copiedId()===t.telegram_id?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-400 hover:bg-cyan-500/20 hover:text-cyan-400"),c(),M(" ",n.copiedId()===t.telegram_id?"\u2713":"\u{1F4CB}"," ")}}function SF(i,e){i&1&&(r(0,"span",212),l(1,"\u26A0\uFE0F \u9700\u52A0\u5165\u7372\u53D6ID"),s())}function wF(i,e){i&1&&(r(0,"span",213),l(1,"\u{1F504} \u540C\u6B65\u4E2D"),s())}function EF(i,e){if(i&1&&(r(0,"code",211),l(1),s(),y(2,SF,2,0,"span",212)(3,wF,2,0,"span",213)),i&2){let t=m();c(),M("@",t.username),c(),S(t.status!=="joined"&&t.status!=="monitoring"?2:3)}}function DF(i,e){i&1&&(r(0,"span",77),l(1,"\u9700\u52A0\u5165\u7372\u53D6"),s())}function AF(i,e){i&1&&(r(0,"span",214),l(1,"\u{1F504} \u540C\u6B65\u4E2D"),s())}function MF(i,e){if(i&1&&y(0,DF,2,0,"span",77)(1,AF,2,0,"span",214),i&2){let t=m();S(t.status!=="joined"&&t.status!=="monitoring"?0:1)}}function TF(i,e){if(i&1){let t=I();r(0,"span",193),l(1),s(),r(2,"button",215),x("click",function(o){_(t);let a=m(),d=m();return v(d.copyLink(a,o))}),l(3," \u{1F517} "),s()}if(i&2){let t=m();c(),M("@",t.username)}}function kF(i,e){i&1&&(r(0,"span",77),l(1,"\u7121"),s())}function IF(i,e){if(i&1&&(r(0,"a",194),l(1),s()),i&2){let t=m();L("href","https://t.me/"+t.username,ot),c(),M(" t.me/",t.username," ")}}function FF(i,e){i&1&&(r(0,"span",77),l(1,"\u7121\u516C\u958B\u9023\u7D50"),s())}function PF(i,e){i&1&&l(0," \u2B50\u2B50\u2B50 ")}function RF(i,e){i&1&&l(0," \u2B50\u2B50 ")}function NF(i,e){i&1&&l(0," \u2B50 ")}function VF(i,e){i&1&&l(0," \u5DF2\u52A0\u5165\xB7\u76E3\u63A7\u4E2D ")}function BF(i,e){i&1&&l(0," \u5DF2\u52A0\u5165 ")}function LF(i,e){i&1&&l(0," \u52A0\u5165\u4E2D... ")}function OF(i,e){i&1&&l(0," \u672A\u52A0\u5165 ")}function UF(i,e){if(i&1&&(r(0,"div",189)(1,"h4",190)(2,"span"),l(3,"\u{1F4DD}"),s(),l(4," \u7FA4\u7D44\u63CF\u8FF0 "),s(),r(5,"p",216),l(6),s()()),i&2){let t=m();c(6),D(t.description)}}function GF(i,e){if(i&1&&(r(0,"span",202),l(1),s()),i&2){let t=m(),n=m();c(),M(" \u4F86\u6E90\uFF1A",n.getSourceLabel(t.discovery_source)," ")}}function $F(i,e){if(i&1&&(r(0,"span",203),l(1),s()),i&2){let t=m();c(),M(" \u95DC\u9375\u8A5E\uFF1A",t.discovery_keyword," ")}}function HF(i,e){if(i&1&&(r(0,"span",202),l(1),Ee(2,"date"),s()),i&2){let t=m();c(),M(" \u767C\u73FE\u6642\u9593\uFF1A",yt(2,1,t.created_at,"yyyy-MM-dd HH:mm")," ")}}function qF(i,e){if(i&1&&(r(0,"a",206),l(1," \u{1F517} \u6253\u958B Telegram "),s()),i&2){let t=m();L("href","https://t.me/"+t.username,ot)}}function WF(i,e){if(i&1){let t=I();r(0,"button",217),x("click",function(){_(t);let o=m(),a=m();return a.openJoinDialog(o),v(a.closeDetail())}),l(1," \u{1F680} \u52A0\u5165\u7FA4\u7D44 "),s()}}function zF(i,e){if(i&1){let t=I();r(0,"button",219),x("click",function(){_(t);let o=m(2),a=m();return a.extractMembers(o),v(a.closeDetail())}),l(1," \u{1F465} \u63D0\u53D6\u6210\u54E1 "),s()}}function KF(i,e){if(i&1&&y(0,zF,2,0,"button",218),i&2){let t=m();S(t.resource_type!=="channel"?0:-1)}}function jF(i,e){if(i&1){let t=I();r(0,"div",174),x("click",function(){_(t);let o=m();return v(o.closeDetail())}),r(1,"div",175),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",176)(3,"div",89)(4,"span",177),l(5),s(),r(6,"h2",178),l(7,"\u7FA4\u7D44\u8A73\u60C5"),s(),r(8,"span",21),l(9),s()(),r(10,"div",24)(11,"button",179),x("click",function(){_(t);let o=m();return v(o.navigatePrev())}),l(12," \u2190 "),s(),r(13,"button",180),x("click",function(){_(t);let o=m();return v(o.navigateNext())}),l(14," \u2192 "),s(),B(15,"div",181),r(16,"button",182),x("click",function(){_(t);let o=m();return v(o.closeDetail())}),l(17," \u2715 "),s()()(),r(18,"div",183)(19,"div",184)(20,"div",185),l(21),s(),r(22,"div",130)(23,"h3",186),l(24),s(),y(25,bF,2,2,"a",187),s(),r(26,"button",188),x("click",function(){let o=_(t),a=m();return v(a.toggleSave(o))}),l(27),s()(),r(28,"div",189)(29,"h4",190)(30,"span"),l(31,"\u{1F4CA}"),s(),l(32," \u57FA\u672C\u4FE1\u606F "),s(),r(33,"div",191)(34,"div")(35,"div",192),l(36,"\u985E\u578B"),s(),r(37,"div",193),l(38),s()(),r(39,"div")(40,"div",192),l(41,"Telegram ID"),s(),r(42,"div",24),y(43,yF,4,4)(44,EF,4,2)(45,MF,2,1),s()(),r(46,"div")(47,"div",192),l(48,"Username"),s(),r(49,"div",24),y(50,TF,4,1)(51,kF,2,0,"span",77),s()(),r(52,"div")(53,"div",192),l(54,"\u9023\u7D50"),s(),y(55,IF,2,2,"a",194)(56,FF,2,0,"span",77),s()()(),r(57,"div",189)(58,"h4",190)(59,"span"),l(60,"\u{1F465}"),s(),l(61," \u6210\u54E1\u6578\u64DA "),s(),r(62,"div",195)(63,"div",196)(64,"div",197),l(65),Ee(66,"number"),s(),r(67,"div",111),l(68,"\u7E3D\u6210\u54E1"),s()(),r(69,"div",196)(70,"div",198),y(71,PF,1,0)(72,RF,1,0)(73,NF,1,0),s(),r(74,"div",199),l(75),s(),r(76,"div",72),l(77,"\u76F8\u95DC\u5EA6"),s()(),r(78,"div",196)(79,"div",200),l(80),s(),r(81,"div",111),y(82,VF,1,0)(83,BF,1,0)(84,LF,1,0)(85,OF,1,0),s()()()(),y(86,UF,7,1,"div",189),r(87,"div",201)(88,"h4",190)(89,"span"),l(90,"\u{1F3F7}\uFE0F"),s(),l(91," \u4F86\u6E90\u4FE1\u606F "),s(),r(92,"div",45),y(93,GF,2,1,"span",202),y(94,$F,2,1,"span",203),y(95,HF,3,4,"span",202),s()()(),r(96,"div",204)(97,"div",24)(98,"button",205),x("click",function(){let o=_(t),a=m();return v(a.toggleSave(o))}),l(99),s(),y(100,qF,2,1,"a",206),s(),r(101,"div",24)(102,"button",207),x("click",function(){_(t);let o=m();return v(o.closeDetail())}),l(103," \u95DC\u9589 "),s(),y(104,WF,2,0,"button",208)(105,KF,1,1),s()()()()}if(i&2){let t=e,n=m();c(4),de(t.resource_type==="channel"?"bg-purple-500/30 text-purple-300":"bg-blue-500/30 text-blue-300"),c(),M(" ",t.resource_type==="channel"?"\u{1F4E2} \u983B\u9053":"\u{1F465} \u7FA4\u7D44"," "),c(4),X(" ",n.selectedResourceIndex()+1," / ",n.filteredResources().length," "),c(2),de(n.canNavigatePrev()?"text-slate-400 hover:text-white hover:bg-slate-700":"text-slate-600 cursor-not-allowed"),L("disabled",!n.canNavigatePrev()),c(2),de(n.canNavigateNext()?"text-slate-400 hover:text-white hover:bg-slate-700":"text-slate-600 cursor-not-allowed"),L("disabled",!n.canNavigateNext()),c(8),M(" ",t.title[0]||"?"," "),c(3),D(t.title),c(),S(t.username?25:-1),c(),de(t.is_saved?"bg-yellow-500/20 text-yellow-400":"bg-slate-700 text-slate-400 hover:bg-yellow-500/20 hover:text-yellow-400"),c(),M(" ",t.is_saved?"\u2B50":"\u2606"," "),c(11),D(t.resource_type==="channel"?"\u983B\u9053":"\u7FA4\u7D44"),c(5),S(t.telegram_id?43:t.username?44:45),c(7),S(t.username?50:51),c(5),S(t.username?55:56),c(10),D(je(66,37,t.member_count)),c(6),S((t.overall_score||0)>=.7?71:(t.overall_score||0)>=.5?72:73),c(4),D(n.formatScore(t.overall_score)),c(4),de(t.status==="joined"||t.status==="monitoring"?"text-green-400":"text-slate-400"),c(),M(" ",t.status==="joined"||t.status==="monitoring"?"\u2713":"\u2014"," "),c(2),S(t.status==="monitoring"?82:t.status==="joined"?83:t.status==="joining"?84:85),c(4),S(t.description?86:-1),c(7),S(t.discovery_source?93:-1),c(),S(t.discovery_keyword?94:-1),c(),S(t.created_at?95:-1),c(3),de(t.is_saved?"bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(),M(" ",t.is_saved?"\u2B50 \u5DF2\u6536\u85CF":"\u2606 \u6536\u85CF"," "),c(),S(t.username?100:-1),c(4),S(t.status!=="joined"&&t.status!=="monitoring"?104:105)}}function JF(i,e){i&1&&(r(0,"p",224),l(1),s()),i&2&&(c(),D(e.title))}function QF(i,e){if(i&1&&(r(0,"div",234),l(1),s()),i&2){let t=m();c(),M("@",t.username)}}function YF(i,e){if(i&1&&(r(0,"div",225)(1,"div",89)(2,"div",232),l(3),s(),r(4,"div",130)(5,"div",233),l(6),s(),y(7,QF,2,1,"div",234),r(8,"div",235)(9,"span"),l(10),Ee(11,"number"),s()()()()()),i&2){let t=e;c(3),M(" ",(t.title==null?null:t.title.charAt(0))||"G"," "),c(3),D(t.title),c(),S(t.username?7:-1),c(3),M("\u{1F465} ",je(11,4,t.member_count)," \u6210\u54E1")}}function XF(i,e){if(i&1&&(r(0,"div",241),l(1),s()),i&2){let t=m(2).$implicit;c(),D(t.display_name)}}function ZF(i,e){if(i&1){let t=I();r(0,"label",237)(1,"input",238),x("change",function(){_(t);let o=m().$implicit,a=m(2);return v(a.joinDialogSelectedPhone.set(o.phone))}),s(),r(2,"div",239)(3,"div",240),l(4),s(),y(5,XF,2,1,"div",241),s(),B(6,"span",242),s()}if(i&2){let t=m().$implicit,n=m(2);de(n.joinDialogSelectedPhone()===t.phone?"bg-cyan-500/20 border-2 border-cyan-500":"bg-slate-700/30 border-2 border-transparent hover:bg-slate-700/50"),c(),L("value",t.phone)("checked",n.joinDialogSelectedPhone()===t.phone),c(3),D(t.phone),c(),S(t.display_name?5:-1)}}function e9(i,e){if(i&1&&y(0,ZF,7,6,"label",236),i&2){let t=e.$implicit;S(t.status==="Online"?0:-1)}}function t9(i,e){if(i&1){let t=I();r(0,"div",220),x("click",function(){_(t);let o=m();return v(o.cancelJoinDialog())}),r(1,"div",221),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",222)(3,"h3",223),l(4," \u{1F680} \u9078\u64C7\u52A0\u5165\u5E33\u865F "),s(),y(5,JF,2,1,"p",224),s(),y(6,YF,12,6,"div",225),r(7,"div",226)(8,"div",227),l(9,"\u9078\u64C7\u8981\u4F7F\u7528\u7684\u5E33\u865F\uFF1A"),s(),r(10,"div",228),O(11,e9,1,1,null,null,Em),s()(),r(13,"div",229)(14,"button",230),x("click",function(){_(t);let o=m();return v(o.cancelJoinDialog())}),l(15," \u53D6\u6D88 "),s(),r(16,"button",231),x("click",function(){_(t);let o=m();return v(o.confirmJoinFromDialog())}),l(17," \u78BA\u8A8D\u52A0\u5165 "),s()()()()}if(i&2){let t,n,o=m();c(5),S((t=o.joinDialogResource())?5:-1,t),c(),S((n=o.joinDialogResource())?6:-1,n),c(5),U(o.mergedAccounts()),c(5),L("disabled",!o.joinDialogSelectedPhone())}}var tr=class i{constructor(){this.toast=F(J);this.ipc=F(Q);this.accountService=F(pt);this.dialogService=F(st);this.groupService=null;this.Math=Math;this._internalAccounts=f([]);this._internalResources=f([]);this._internalSearching=f(!1);this._internalSelectedAccount=f(null);this._internalSearchError=f({hasError:!1,message:""});this._historyKeywords=f([]);this.ipcCleanup=[];this.searchProgress=f("");this.isFetchingDetails=f(!1);this.newDiscoveredCount=f(0);this.existingCount=f(0);this.currentPage=f(1);this.pageSize=f(50);this.pageSizeOptions=[20,50,100,200];this.searchTimeoutId=null;this.SEARCH_BASE_TIMEOUT_MS=6e4;this.HEARTBEAT_TIMEOUT_MS=15e3;this.lastProgressTime=0;this.resources=Le([]);this.isSearching=Le(!1);this.selectedAccount=Le(null);this.availableAccounts=Le([]);this.historyKeywords=Le([]);this.currentKeyword=Le("");this.searchError=Le({hasError:!1,message:""});this.savedResourceIds=Le(new Set);this.mergedAccounts=R(()=>{let e=this._internalAccounts(),t=this.availableAccounts();return e.length>0?e:t});this.mergedResources=R(()=>{let e=this._internalResources(),t=this.resources();return e.length>0?e:t});this.pagedResources=R(()=>{let e=this.filteredResources(),t=this.currentPage(),n=this.pageSize(),o=(t-1)*n,a=o+n;return e.slice(o,a)});this.totalPages=R(()=>{let e=this.filteredResources().length,t=this.pageSize();return Math.ceil(e/t)||1});this.pageNumbers=R(()=>{let e=this.totalPages(),t=this.currentPage(),n=[],o=Math.max(1,t-2),a=Math.min(e,t+2);for(let d=o;d<=a;d++)n.push(d);return n});this.mergedSearching=R(()=>this._internalSearching()||this.isSearching());this.mergedSelectedAccount=R(()=>this._internalSelectedAccount()||this.selectedAccount());this.mergedSearchError=R(()=>{let e=this._internalSearchError();return e.hasError?e:this.searchError()});this.mergedHistoryKeywords=R(()=>{let e=this._historyKeywords(),t=this.historyKeywords();return e.length>0?e:t});this.searchEvent=ge();this.selectAccountEvent=ge();this.saveResourceEvent=ge();this.unsaveResourceEvent=ge();this.joinResourceEvent=ge();this.extractMembersEvent=ge();this.clearResultsEvent=ge();this.searchQuery="";this.filterType="all";this.showAccountSelector=f(!1);this.showSuggestions=f(!1);this.copiedId=f("");this.copiedLink=f("");this.selectedSources=f(["telegram","jiso"]);this.showJoinAccountDialog=f(!1);this.joinDialogResource=f(null);this.joinDialogSelectedPhone=f("");this.joiningResourceIds=f(new Set);this.showAdvancedFilter=f(!1);this.filterMemberMin=f(null);this.filterMemberMax=f(null);this.filterSource=f("all");this.filterJoinStatus=f("all");this.filterHasId=f(!1);this.showDetailDialog=f(!1);this.selectedResource=f(null);this.selectedResourceIndex=f(-1);this.selectedForBatch=f(new Set);this.searchSources=[{id:"telegram",name:"\u5B98\u65B9\u641C\u7D22",icon:"\u{1F4F1}",tag:"\u7A69\u5B9A",tagClass:"bg-green-500/20 text-green-400",disabled:!1},{id:"jiso",name:"\u4E2D\u6587\u641C\u7D22",icon:"\u{1F50D}",tag:"\u63A8\u85A6",tagClass:"bg-yellow-500/20 text-yellow-400",disabled:!1},{id:"tgstat",name:"TGStat",icon:"\u{1F4CA}",tag:"\u958B\u767C\u4E2D",tagClass:"bg-slate-600 text-slate-400",disabled:!0},{id:"local",name:"\u672C\u5730\u7D22\u5F15",icon:"\u{1F4BE}",tag:null,tagClass:"",disabled:!1}];this.hotKeywords=["\u652F\u4ED8","USDT","\u4EA4\u6613","\u62DB\u8058","\u4EE3\u8CFC","\u52A0\u5BC6\u8CA8\u5E63","\u96FB\u5F71","\u8CC7\u6E90\u5206\u4EAB"];this.filteredResources=R(()=>{let e=this.mergedResources();this.filterType!=="all"&&(e=e.filter(d=>this.filterType==="channel"?d.resource_type==="channel":d.resource_type!=="channel"));let t=this.filterMemberMin(),n=this.filterMemberMax();t!==null&&t>0&&(e=e.filter(d=>d.member_count>=t)),n!==null&&n>0&&(e=e.filter(d=>d.member_count<=n));let o=this.filterSource();o!=="all"&&(e=e.filter(d=>d.discovery_source===o));let a=this.filterJoinStatus();return a==="joined"?e=e.filter(d=>d.status==="joined"||d.status==="monitoring"):a==="not_joined"&&(e=e.filter(d=>d.status!=="joined"&&d.status!=="monitoring")),this.filterHasId()&&(e=e.filter(d=>d.telegram_id&&d.telegram_id.trim()!=="")),e});this.savedCount=R(()=>this.mergedResources().filter(e=>e.is_saved).length);this.canNavigatePrev=R(()=>this.selectedResourceIndex()>0);this.canNavigateNext=R(()=>{let e=this.filteredResources();return this.selectedResourceIndex()<e.length-1});this.pendingJoinResource=null;this.selectedCount=R(()=>this.selectedForBatch().size);this.activeFilterCount=R(()=>{let e=0;return this.filterType!=="all"&&e++,this.filterMemberMin()!==null&&this.filterMemberMin()>0&&e++,this.filterMemberMax()!==null&&this.filterMemberMax()>0&&e++,this.filterSource()!=="all"&&e++,this.filterJoinStatus()!=="all"&&e++,this.filterHasId()&&e++,e})}getResourceTrackId(e,t){let n=[`idx-${t}`];return e.id&&e.id!==0&&n.push(`id-${e.id}`),e.telegram_id&&e.telegram_id.toString().trim()!==""&&n.push(`tg-${e.telegram_id}`),e.username&&e.username.trim()!==""&&n.push(`u-${e.username}`),e.source&&n.push(`src-${e.source}`),n.join("_")}ngOnInit(){document.addEventListener("click",this.handleOutsideClick.bind(this)),document.addEventListener("keydown",this.handleKeydown.bind(this)),this.loadAccounts(),this.setupIpcListeners(),this.loadSearchHistory(),this.restoreSearchResults()}saveSearchResults(){try{let e=this._internalResources(),t=this.searchQuery;if(e.length>0){let n={query:t,resources:e,timestamp:Date.now(),newCount:this.newDiscoveredCount(),existingCount:this.existingCount()};sessionStorage.setItem("search-discovery-results",JSON.stringify(n)),console.log(`[SearchDiscovery] \u5DF2\u4FDD\u5B58 ${e.length} \u500B\u641C\u7D22\u7D50\u679C\u5230 sessionStorage`)}}catch(e){console.error("[SearchDiscovery] \u4FDD\u5B58\u641C\u7D22\u7D50\u679C\u5931\u6557:",e)}}restoreSearchResults(){try{let e=sessionStorage.getItem("search-discovery-results");if(e){let t=JSON.parse(e);Date.now()-(t.timestamp||0)<1800*1e3?(this._internalResources.set(t.resources||[]),this.searchQuery=t.query||"",this.newDiscoveredCount.set(t.newCount||0),this.existingCount.set(t.existingCount||0),console.log(`[SearchDiscovery] \u5DF2\u6062\u5FA9 ${t.resources?.length||0} \u500B\u641C\u7D22\u7D50\u679C`)):sessionStorage.removeItem("search-discovery-results")}}catch(e){console.error("[SearchDiscovery] \u6062\u5FA9\u641C\u7D22\u7D50\u679C\u5931\u6557:",e)}}ngOnDestroy(){document.removeEventListener("click",this.handleOutsideClick.bind(this)),document.removeEventListener("keydown",this.handleKeydown.bind(this)),this.ipcCleanup.forEach(e=>e()),this.clearSearchTimeout()}loadAccounts(){let t=this.accountService.accounts().filter(n=>n.status==="Online");this._internalAccounts.set(t.map(n=>({id:n.id,phone:n.phone,status:n.status}))),!this._internalSelectedAccount()&&t.length>0&&this._internalSelectedAccount.set({id:t[0].id,phone:t[0].phone,status:t[0].status}),console.log("[SearchDiscovery] \u8F09\u5165\u5E33\u865F:",t.length,"\u500B\u5728\u7DDA")}setupIpcListeners(){let e=this.ipc.on("accounts-updated",u=>{let p=u.filter(C=>C.status==="Online");this._internalAccounts.set(p.map(C=>({id:C.id,phone:C.phone,status:C.status})));let g=this._internalSelectedAccount();g?!p.find(w=>w.id===g.id)&&p.length>0&&this._internalSelectedAccount.set({id:p[0].id,phone:p[0].phone,status:p[0].status}):p.length>0&&this._internalSelectedAccount.set({id:p[0].id,phone:p[0].phone,status:p[0].status}),console.log("[SearchDiscovery] \u5E33\u865F\u66F4\u65B0:",p.length,"\u500B\u5728\u7DDA")}),t=this.ipc.on("search-batch",u=>{if(this.resetHeartbeat(),u.success&&u.groups){let p=u.groups.map((g,C)=>({id:C+1,telegram_id:g.telegram_id||null,title:g.title,username:g.username,description:g.description,member_count:g.member_count||g.members_count||0,resource_type:g.type||"group",status:"discovered",overall_score:g.score,discovery_source:"search",discovery_keyword:this.searchQuery,source:g.source,link:g.link}));this._internalResources.set(p),u.message&&this.searchProgress.set(u.message),console.log(`[SearchDiscovery] \u6536\u5230\u6279\u6B21\u7D50\u679C: ${p.length} \u500B (\u4F86\u6E90: ${u.source})`)}}),n=this.ipc.on("search-results",u=>{if(this.clearSearchTimeout(),this._internalSearching.set(!1),this.searchProgress.set(""),this.isFetchingDetails.set(!1),u.success&&u.groups){let p=u.groups.map((A,V)=>({id:V+1,telegram_id:A.telegram_id||null,title:A.title,username:A.username,description:A.description,member_count:A.member_count||A.members_count||0,resource_type:A.type||"group",status:A.status||"discovered",joined_phone:A.joined_phone||A.joined_by_phone||null,overall_score:A.score,discovery_source:"search",discovery_keyword:this.searchQuery,source:A.source,link:A.link,is_new:A.is_new,member_change:A.member_change}));this._internalResources.set(p),this._internalSearchError.set({hasError:!1,message:""}),this.saveSearchResults();let g=u.new_count||0,C=u.existing_count||0;this.newDiscoveredCount.set(g),this.existingCount.set(C);let w=`\u641C\u7D22\u5B8C\u6210\uFF01\u5171\u627E\u5230 ${p.length} \u500B\u7D50\u679C`;g>0&&(w+=`\uFF0C\u5176\u4E2D ${g} \u500B\u70BA\u65B0\u767C\u73FE`),this.toast.success(w)}else this._internalSearchError.set({hasError:!0,message:u.error||"\u641C\u7D22\u5931\u6557"})}),o=this.ipc.on("search-error",u=>{this.clearSearchTimeout(),this._internalSearching.set(!1),this.searchProgress.set(""),this.isFetchingDetails.set(!1),this._internalSearchError.set({hasError:!0,message:u.message||"\u641C\u7D22\u8ACB\u6C42\u5931\u6557"}),this.toast.error("\u641C\u7D22\u5931\u6557: "+(u.message||"\u672A\u77E5\u932F\u8AA4"))}),a=this.ipc.on("jiso-search-progress",u=>{if(this.resetHeartbeat(),this.searchProgress.set(u.message),u.status==="basic_results"&&u.data?.results){let p=u.data.results.map((g,C)=>({id:C+1,telegram_id:g.telegram_id||null,title:g.title,username:g.username,description:g.description,member_count:g.member_count||0,resource_type:g.chat_type||g.type||"group",link:g.link,status:"discovered",overall_score:g.score,discovery_source:"search",discovery_keyword:this.searchQuery}));this._internalResources.set(p),this.isFetchingDetails.set(!0),this.toast.info(`\u5DF2\u8F09\u5165 ${p.length} \u500B\u57FA\u790E\u7D50\u679C\uFF0C\u6B63\u5728\u7372\u53D6\u8A73\u60C5...`)}else u.status==="fetching_details"?this.isFetchingDetails.set(!0):u.status==="completed"&&(this.isFetchingDetails.set(!1),this.searchProgress.set(""))}),d=this.ipc.on("join-and-monitor-complete",u=>{if(u.resourceId&&this.joiningResourceIds.update(p=>{let g=new Set(p);return g.delete(u.resourceId),g}),u.success){let g=this._internalResources().map(C=>u.resourceId&&C.id===u.resourceId||u.username&&C.username===u.username||u.telegramId&&C.telegram_id===u.telegramId?(this.joiningResourceIds.update(A=>{let V=new Set(A);return V.delete(C.id),V}),P(E({},C),{status:"joined",member_count:u.memberCount||C.member_count,joined_phone:u.phone||C.joined_phone})):C);this._internalResources.set(g),this.saveSearchResults(),console.log(`[SearchDiscovery] \u8CC7\u6E90\u72C0\u614B\u5DF2\u66F4\u65B0: ${u.username||u.telegramId} \u2192 joined (${u.phone})`)}else(u.username||u.telegramId)&&this._internalResources().forEach(g=>{(u.username&&g.username===u.username||u.telegramId&&g.telegram_id===u.telegramId)&&this.joiningResourceIds.update(C=>{let w=new Set(C);return w.delete(g.id),w})})});this.ipcCleanup.push(e,t,n,o,a,d)}loadSearchHistory(){try{let e=localStorage.getItem("search-history");e&&this._historyKeywords.set(JSON.parse(e))}catch(e){console.warn("[SearchDiscovery] \u52A0\u8F09\u641C\u7D22\u6B77\u53F2\u5931\u6557:",e)}}saveSearchHistory(e){let t=this._historyKeywords(),n=[e,...t.filter(o=>o!==e)].slice(0,10);this._historyKeywords.set(n);try{localStorage.setItem("search-history",JSON.stringify(n))}catch(o){console.warn("[SearchDiscovery] \u4FDD\u5B58\u641C\u7D22\u6B77\u53F2\u5931\u6557:",o)}}handleKeydown(e){if(this.showDetailDialog())switch(e.key){case"Escape":this.closeDetail();break;case"ArrowLeft":this.canNavigatePrev()&&this.navigatePrev();break;case"ArrowRight":this.canNavigateNext()&&this.navigateNext();break}}handleOutsideClick(e){e.target.closest(".relative")||this.showAccountSelector.set(!1)}doSearch(){if(!this.searchQuery.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u641C\u7D22\u95DC\u9375\u8A5E");return}if(this.selectedSources().length===0){this.toast.warning("\u8ACB\u81F3\u5C11\u9078\u64C7\u4E00\u500B\u641C\u7D22\u6E20\u9053");return}let e=this.mergedSelectedAccount();if(!e){this.toast.warning("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u5728\u7DDA\u5E33\u865F"),this.loadAccounts();return}let t=this.searchQuery.trim(),n=this.selectedSources();console.log("[SearchDiscovery] \u958B\u59CB\u641C\u7D22:",{query:t,sources:n,account:e.phone}),this.clearSearchTimeout(),this.resetPagination(),this._internalSearching.set(!0),this._internalSearchError.set({hasError:!1,message:""}),this.saveSearchHistory(t),this.lastProgressTime=Date.now(),this.startHeartbeatCheck(),this.ipc.send("search-groups",{keyword:t,sources:n,account_id:e.id,account_phone:e.phone,limit:500}),this.searchEvent.emit({query:t,sources:n})}clearSearchTimeout(){this.searchTimeoutId&&(clearTimeout(this.searchTimeoutId),this.searchTimeoutId=null)}startHeartbeatCheck(){this.clearSearchTimeout(),this.searchTimeoutId=setTimeout(()=>{if(!this._internalSearching())return;let e=Date.now(),t=e-this.lastProgressTime,n=e-(this.lastProgressTime-t);t>this.HEARTBEAT_TIMEOUT_MS?(console.warn("[SearchDiscovery] \u641C\u7D22\u8D85\u6642 - \u7121\u9032\u5EA6\u66F4\u65B0",{timeSinceLastProgress:t,totalElapsed:n}),this.handleSearchTimeout()):this.startHeartbeatCheck()},5e3)}handleSearchTimeout(){this.clearSearchTimeout(),this._internalSearching.set(!1),this.searchProgress.set(""),this.isFetchingDetails.set(!1),this._internalSearchError.set({hasError:!0,message:"\u641C\u7D22\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}),this.toast.warning("\u641C\u7D22\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}resetHeartbeat(){this.lastProgressTime=Date.now()}quickSearch(e){this.searchQuery=e,this.showSuggestions.set(!1),this.doSearch()}goToPage(e){let t=this.totalPages();e>=1&&e<=t&&this.currentPage.set(e)}nextPage(){this.goToPage(this.currentPage()+1)}prevPage(){this.goToPage(this.currentPage()-1)}firstPage(){this.goToPage(1)}lastPage(){this.goToPage(this.totalPages())}changePageSize(e){this.pageSize.set(e),this.currentPage.set(1)}resetPagination(){this.currentPage.set(1)}toggleSource(e){if(this.searchSources.find(o=>o.id===e)?.disabled){console.log("\u26A0\uFE0F \u8A72\u641C\u7D22\u6E20\u9053\u6B63\u5728\u958B\u767C\u4E2D:",e);return}let n=this.selectedSources();n.includes(e)?this.selectedSources.set(n.filter(o=>o!==e)):this.selectedSources.set([...n,e])}hideSuggestions(){setTimeout(()=>this.showSuggestions.set(!1),200)}clearResults(){this.clearResultsEvent.emit()}selectAccount(e){if(this._internalSelectedAccount.set(e),this.selectAccountEvent.emit(e),this.showAccountSelector.set(!1),this.pendingJoinResource){let t=this.pendingJoinResource;if(e.status!=="Online"){this.toast.warning(`\u5E33\u865F ${e.phone} \u672A\u9023\u63A5\uFF0C\u7121\u6CD5\u52A0\u5165\u7FA4\u7D44`);return}setTimeout(()=>{this.executeJoin(t,e.phone)},100)}}openDetail(e){let n=this.filteredResources().findIndex(o=>o.telegram_id&&o.telegram_id===e.telegram_id||o.id&&o.id===e.id);this.selectedResource.set(e),this.selectedResourceIndex.set(n),this.showDetailDialog.set(!0)}closeDetail(){this.showDetailDialog.set(!1),this.selectedResource.set(null),this.selectedResourceIndex.set(-1)}navigatePrev(){let e=this.filteredResources(),t=this.selectedResourceIndex();if(t>0){let n=e[t-1];this.selectedResource.set(n),this.selectedResourceIndex.set(t-1)}}navigateNext(){let e=this.filteredResources(),t=this.selectedResourceIndex();if(t<e.length-1){let n=e[t+1];this.selectedResource.set(n),this.selectedResourceIndex.set(t+1)}}toggleSave(e){e.is_saved?this.unsaveResourceEvent.emit(e):this.saveResourceEvent.emit(e)}openJoinDialog(e){if(console.log("[SearchDiscovery] \u6253\u958B\u52A0\u5165\u5C0D\u8A71\u6846:",e.title),!e.username&&!e.telegram_id){this.toast.warning("\u7121\u6CD5\u52A0\u5165\uFF1A\u7F3A\u5C11\u7FA4\u7D44\u6A19\u8B58");return}if(this.joiningResourceIds().has(e.id)){this.toast.warning("\u6B63\u5728\u52A0\u5165\u4E2D\uFF0C\u8ACB\u7A0D\u5019...");return}let t=this.mergedAccounts().filter(n=>n.status==="Online");if(t.length===0){this.toast.warning("\u6C92\u6709\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u9304\u5E33\u865F");return}if(t.length===1){this.executeJoin(e,t[0].phone);return}this.joinDialogResource.set(e),this.joinDialogSelectedPhone.set(""),this.showJoinAccountDialog.set(!0)}confirmJoinFromDialog(){let e=this.joinDialogResource(),t=this.joinDialogSelectedPhone();if(!e){this.toast.warning("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}if(!t){this.toast.warning("\u8ACB\u9078\u64C7\u8981\u4F7F\u7528\u7684\u5E33\u865F");return}this.showJoinAccountDialog.set(!1),this.executeJoin(e,t)}cancelJoinDialog(){this.showJoinAccountDialog.set(!1),this.joinDialogResource.set(null),this.joinDialogSelectedPhone.set("")}joinResource(e){if(console.log("[SearchDiscovery] \u52A0\u5165\u7FA4\u7D44:",e.title,e.username),!e.username&&!e.telegram_id){this.toast.warning("\u7121\u6CD5\u52A0\u5165\uFF1A\u7F3A\u5C11\u7FA4\u7D44\u6A19\u8B58");return}if(this.joiningResourceIds().has(e.id)){this.toast.warning("\u6B63\u5728\u52A0\u5165\u4E2D\uFF0C\u8ACB\u7A0D\u5019...");return}let t=this.mergedSelectedAccount();if(!t){this.pendingJoinResource=e,this.showAccountSelector.set(!0),this.toast.warning("\u8ACB\u9078\u64C7\u4E00\u500B\u5E33\u865F\u4F86\u52A0\u5165\u7FA4\u7D44");return}if(t.status!=="Online"){this.toast.warning(`\u5E33\u865F ${t.phone} \u672A\u9023\u63A5\uFF0C\u8ACB\u9078\u64C7\u5DF2\u9023\u63A5\u7684\u5E33\u865F`),this.pendingJoinResource=e,this.showAccountSelector.set(!0);return}this.executeJoin(e,t.phone)}executeJoin(e,t){this.joiningResourceIds.update(n=>{let o=new Set(n);return o.add(e.id),o}),this.toast.info(`\u6B63\u5728\u4F7F\u7528 ${t.slice(0,4)}**** \u52A0\u5165\u7FA4\u7D44: ${e.title||e.username}...`),this.ipc.send("join-and-monitor-resource",{resourceId:e.id||0,username:e.username,telegramId:e.telegram_id,title:e.title,phone:t}),this.pendingJoinResource=null,this.joinResourceEvent.emit(e)}isJoining(e){return this.joiningResourceIds().has(e.id)}extractMembers(e){if(console.log("[SearchDiscovery] \u6253\u958B\u63D0\u53D6\u6210\u54E1\u5C0D\u8A71\u6846:",e.title),!e.telegram_id&&!e.username){this.toast.warning("\u7121\u6CD5\u63D0\u53D6\uFF1A\u7F3A\u5C11\u7FA4\u7D44\u6A19\u8B58");return}let t=e.joined_phone||this.mergedSelectedAccount()?.phone,n={id:String(e.id||e.telegram_id||""),name:e.title||"\u672A\u77E5\u7FA4\u7D44",url:e.username?`https://t.me/${e.username}`:"",telegramId:e.telegram_id||"",memberCount:e.member_count||0,accountPhone:t,resourceType:e.resource_type||"group"};console.log("[SearchDiscovery] \u6253\u958B\u63D0\u53D6\u6210\u54E1\u5C0D\u8A71\u6846\uFF0C\u7FA4\u7D44\u4FE1\u606F:",n),this.dialogService.openMemberExtraction(n),this.extractMembersEvent.emit(e)}toggleBatchSelect(e,t){t.stopPropagation();let n=e.telegram_id||String(e.id),o=new Set(this.selectedForBatch());o.has(n)?o.delete(n):o.add(n),this.selectedForBatch.set(o)}isSelectedForBatch(e){let t=e.telegram_id||String(e.id);return this.selectedForBatch().has(t)}selectAllVisible(){let e=this.filteredResources().map(t=>t.telegram_id||String(t.id));this.selectedForBatch.set(new Set(e))}clearSelection(){this.selectedForBatch.set(new Set)}invertSelection(){let e=this.selectedForBatch(),t=this.filteredResources().map(o=>o.telegram_id||String(o.id)),n=new Set(t.filter(o=>!e.has(o)));this.selectedForBatch.set(n)}batchSaveSelected(){let e=this.filteredResources().filter(t=>this.selectedForBatch().has(t.telegram_id||String(t.id))&&!t.is_saved);if(e.length===0){this.toast.info("\u672A\u9078\u4E2D\u53EF\u6536\u85CF\u7684\u8CC7\u6E90");return}e.forEach(t=>this.saveResourceEvent.emit(t)),this.toast.success(`\u5DF2\u6536\u85CF ${e.length} \u500B\u8CC7\u6E90`),this.clearSelection()}copySelectedIds(){let e=this.filteredResources().filter(t=>this.selectedForBatch().has(t.telegram_id||String(t.id))).map(t=>t.telegram_id).filter(t=>t);if(e.length===0){this.toast.warning("\u9078\u4E2D\u7684\u8CC7\u6E90\u4E2D\u6C92\u6709\u53EF\u8907\u88FD\u7684 ID");return}navigator.clipboard.writeText(e.join(`
`)).then(()=>{this.toast.success(`\u5DF2\u8907\u88FD ${e.length} \u500B ID`)}).catch(()=>{this.toast.error("\u8907\u88FD\u5931\u6557")})}batchSave(){let e=this.filteredResources().filter(t=>!t.is_saved);if(e.length===0){this.toast.info("\u6240\u6709\u7D50\u679C\u90FD\u5DF2\u6536\u85CF");return}e.forEach(t=>this.saveResourceEvent.emit(t)),this.toast.success(`\u5DF2\u6536\u85CF ${e.length} \u500B\u8CC7\u6E90`)}exportResults(){let e=this.filteredResources();if(e.length===0){this.toast.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u7D50\u679C");return}let t=e.map((p,g)=>({\u5E8F\u865F:g+1,ID:p.telegram_id||"",\u540D\u7A31:p.title||"",Username:p.username||"",\u985E\u578B:p.resource_type==="channel"?"\u983B\u9053":"\u7FA4\u7D44",\u6210\u54E1\u6578:p.member_count||0,\u63CF\u8FF0:(p.description||"").replace(/"/g,'""').substring(0,200),\u9023\u7D50:p.username?`https://t.me/${p.username}`:"",\u4F86\u6E90:p.source||"search"})),o=[["\u5E8F\u865F","ID","\u540D\u7A31","Username","\u985E\u578B","\u6210\u54E1\u6578","\u63CF\u8FF0","\u9023\u7D50","\u4F86\u6E90"].join(","),...t.map(p=>[p.\u5E8F\u865F,`"${p.ID}"`,`"${p.\u540D\u7A31}"`,p.Username,p.\u985E\u578B,p.\u6210\u54E1\u6578,`"${p.\u63CF\u8FF0}"`,p.\u9023\u7D50,p.\u4F86\u6E90].join(","))].join(`
`),a=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");d.href=URL.createObjectURL(a);let u=this.searchQuery||"all";d.download=`telegram-search-${u}-${e.length}\u689D-${new Date().toISOString().split("T")[0]}.csv`,d.click(),this.toast.success(`\u5DF2\u5C0E\u51FA ${e.length} \u689D\u641C\u7D22\u7D50\u679C`)}copyId(e,t){t.stopPropagation();let n=e.telegram_id||"";if(!n){this.toast.warning("\u7121\u53EF\u8907\u88FD\u7684 ID");return}navigator.clipboard.writeText(n).then(()=>{this.copiedId.set(n),console.log("\u2705 ID \u5DF2\u8907\u88FD:",n),setTimeout(()=>this.copiedId.set(""),2e3)}).catch(()=>{this.toast.error("\u8907\u88FD\u5931\u6557")})}copyLink(e,t){if(t.stopPropagation(),!e.username){this.toast.warning("\u8A72\u8CC7\u6E90\u6C92\u6709\u516C\u958B\u9023\u7D50");return}let n=`https://t.me/${e.username}`;navigator.clipboard.writeText(n).then(()=>{this.copiedLink.set(e.username),console.log("\u2705 \u9023\u7D50\u5DF2\u8907\u88FD:",n),setTimeout(()=>this.copiedLink.set(""),2e3)}).catch(()=>{this.toast.error("\u8907\u88FD\u5931\u6557")})}getSourceLabel(e){return{telegram:"TG\u5B98\u65B9",jiso:"\u4E2D\u6587\u641C\u7D22",tgstat:"TGStat",local:"\u672C\u5730"}[e]||e}formatScore(e){return e==null?"0.0/1.0":`${e.toFixed(1)}/1.0`}resetFilters(){this.filterType="all",this.filterMemberMin.set(null),this.filterMemberMax.set(null),this.filterSource.set("all"),this.filterJoinStatus.set("all"),this.filterHasId.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-search-discovery"]],inputs:{resources:[1,"resources"],isSearching:[1,"isSearching"],selectedAccount:[1,"selectedAccount"],availableAccounts:[1,"availableAccounts"],historyKeywords:[1,"historyKeywords"],currentKeyword:[1,"currentKeyword"],searchError:[1,"searchError"],savedResourceIds:[1,"savedResourceIds"]},outputs:{searchEvent:"searchEvent",selectAccountEvent:"selectAccountEvent",saveResourceEvent:"saveResourceEvent",unsaveResourceEvent:"unsaveResourceEvent",joinResourceEvent:"joinResourceEvent",extractMembersEvent:"extractMembersEvent",clearResultsEvent:"clearResultsEvent"},decls:49,vars:12,consts:[[1,"h-full","flex","flex-col","bg-slate-900","text-white","overflow-hidden"],[1,"flex-shrink-0","px-6","py-4","border-b","border-slate-700/50","bg-slate-900/95","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-2","text-sm"],[1,"px-3","py-1","bg-cyan-500/20","text-cyan-400","rounded-lg"],[1,"px-3","py-1","bg-yellow-500/20","text-yellow-400","rounded-lg"],[1,"text-slate-400"],[1,"relative"],[1,"text-red-400","text-sm","px-3","py-1.5","bg-red-500/10","rounded-lg"],[1,"px-3","py-1.5","rounded-lg","text-sm","bg-blue-500/20","text-blue-400","animate-pulse"],[1,"px-3","py-1.5","rounded-lg","text-sm","bg-green-500/20","text-green-400"],[1,"flex-shrink-0","px-6","py-4","border-b","border-slate-700/30","bg-slate-800/30"],[1,"flex","gap-3","mb-4"],[1,"flex-1","relative"],["type","text","placeholder","\u8F38\u5165\u95DC\u9375\u8A5E\u641C\u7D22\u7FA4\u7D44\u548C\u983B\u9053...",1,"w-full","bg-slate-700/50","border","border-slate-600","rounded-xl","py-3","px-4","pl-12","text-white","text-lg","focus:ring-2","focus:ring-cyan-500/50","focus:border-cyan-500","transition-all",3,"ngModelChange","keyup.enter","focus","blur","ngModel"],[1,"absolute","left-4","top-1/2","-translate-y-1/2","text-slate-400","text-xl"],[1,"absolute","top-full","left-0","right-0","mt-2","bg-slate-800","border","border-slate-700","rounded-xl","shadow-xl","z-50","overflow-hidden"],[1,"px-8","py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-400","hover:to-blue-400","text-white","rounded-xl","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","shadow-lg","shadow-cyan-500/25",3,"click","disabled"],[1,"text-sm","text-slate-400"],[1,"flex","gap-2"],[1,"flex","items-center","gap-2","px-3","py-1.5","rounded-lg","transition-all",3,"class","title"],[1,"flex","items-center","gap-2"],[1,"text-xs","px-2","py-1","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded","transition-all",3,"click"],[1,"text-xs","px-2","py-1","bg-slate-600/50","hover:bg-slate-600","text-slate-400","rounded","transition-all",3,"click"],[1,"flex-shrink-0","px-6","py-3","border-b","border-slate-700/30","bg-slate-800/20"],[1,"flex-1","overflow-y-auto","px-6","py-4"],[1,"space-y-4"],[1,"flex","flex-col","items-center","justify-center","h-full","text-center"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"flex","items-center","gap-2","px-3","py-1.5","bg-slate-700/50","hover:bg-slate-600/50","rounded-lg","border","border-slate-600/50",3,"click"],[1,"w-2","h-2","rounded-full"],[1,"font-mono","text-sm"],[1,"text-slate-400","text-xs"],[1,"absolute","top-full","right-0","mt-1","w-56","bg-slate-800","border","border-slate-700","rounded-lg","shadow-xl","z-50"],[1,"max-h-48","overflow-y-auto","p-1"],[1,"w-full","flex","items-center","gap-2","px-3","py-2","hover:bg-slate-700/50","rounded-lg","text-left"],[1,"w-full","flex","items-center","gap-2","px-3","py-2","hover:bg-slate-700/50","rounded-lg","text-left",3,"click"],[1,"font-mono","text-sm","flex-1"],[1,"p-3","border-b","border-slate-700"],[1,"p-3"],[1,"text-xs","text-slate-500","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1.5","bg-orange-500/10","hover:bg-orange-500/20","text-orange-300","hover:text-orange-200","rounded-lg","text-sm","transition-all"],[1,"px-3","py-1.5","bg-slate-700/50","hover:bg-cyan-500/20","text-slate-300","hover:text-cyan-400","rounded-lg","text-sm","transition-all"],[1,"px-3","py-1.5","bg-slate-700/50","hover:bg-cyan-500/20","text-slate-300","hover:text-cyan-400","rounded-lg","text-sm","transition-all",3,"mousedown"],[1,"px-3","py-1.5","bg-orange-500/10","hover:bg-orange-500/20","text-orange-300","hover:text-orange-200","rounded-lg","text-sm","transition-all",3,"mousedown"],[1,"flex","items-center","gap-2","px-3","py-1.5","rounded-lg","transition-all",3,"title"],["type","checkbox",1,"hidden",3,"change","checked","disabled"],[1,"text-sm"],[1,"text-[10px]","px-1.5","py-0.5","rounded",3,"class"],[1,"text-[10px]","px-1.5","py-0.5","rounded"],[1,"text-slate-400","text-sm","flex","items-center","gap-3"],[1,"font-bold","text-white"],[1,"text-cyan-400","text-sm","flex","items-center","gap-1"],[1,"text-amber-400","text-sm","flex","items-center","gap-1"],[1,"bg-slate-700/50","border","border-slate-600","rounded-lg","py-1.5","px-3","text-white","text-sm",3,"ngModelChange","ngModel"],["value","all"],["value","group"],["value","channel"],[1,"px-3","py-1.5","rounded-lg","text-sm","flex","items-center","gap-1","transition-all",3,"click"],[1,"ml-1","px-1.5","py-0.5","bg-cyan-500","text-white","text-xs","rounded-full"],[1,"px-3","py-1.5","bg-yellow-500/20","text-yellow-400","rounded-lg","hover:bg-yellow-500/30","text-sm","flex","items-center","gap-1",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-sm","flex","items-center","gap-1","transition-all",3,"click","disabled"],[1,"mt-3","pt-3","border-t","border-slate-700/30","grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"mt-3","pt-3","border-t","border-slate-700/30","flex","items-center","justify-between"],[1,"text-slate-400","text-sm"],[1,"px-3","py-1","bg-cyan-500/20","text-cyan-400","rounded-full","text-sm","font-medium"],[1,"text-green-400","text-xs"],[1,"text-slate-500","text-xs"],[1,"animate-spin"],[1,"animate-pulse"],[1,"text-xs","text-slate-400","mb-1","block"],["type","number","placeholder","\u6700\u5C11",1,"w-full","bg-slate-700/50","border","border-slate-600","rounded","py-1.5","px-2","text-white","text-sm",3,"change","value"],[1,"text-slate-500"],["type","number","placeholder","\u6700\u591A",1,"w-full","bg-slate-700/50","border","border-slate-600","rounded","py-1.5","px-2","text-white","text-sm",3,"change","value"],[1,"w-full","bg-slate-700/50","border","border-slate-600","rounded","py-1.5","px-2","text-white","text-sm",3,"change","value"],["value","telegram"],["value","jiso"],["value","local"],["value","joined"],["value","not_joined"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"rounded","border-slate-500","bg-slate-700","text-cyan-500",3,"change","checked"],[1,"text-sm","text-slate-300"],[1,"text-xs","text-slate-400","hover:text-white","underline",3,"click"],[1,"flex","items-center","gap-3"],[1,"px-2","py-1","text-xs","bg-slate-700/50","hover:bg-slate-700","text-slate-300","rounded","transition-all",3,"click"],[1,"flex","items-center","gap-3","px-3","py-1.5","bg-cyan-500/10","rounded-lg","border","border-cyan-500/30"],[1,"text-cyan-400","text-sm","font-medium"],[1,"w-px","h-4","bg-slate-600"],[1,"px-2","py-1","text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","rounded","transition-all",3,"click"],[1,"px-2","py-1","text-xs","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded","transition-all",3,"click"],[1,"animate-pulse","bg-slate-800/50","rounded-xl","p-4","border","border-slate-700/50"],[1,"flex","items-start","gap-4"],[1,"w-12","h-12","bg-slate-700","rounded-lg"],[1,"flex-1","space-y-2"],[1,"h-5","bg-slate-700","rounded","w-1/3"],[1,"h-4","bg-slate-700","rounded","w-1/4"],[1,"h-3","bg-slate-700","rounded","w-2/3"],[1,"max-w-md"],[1,"text-6xl","mb-4"],[1,"text-red-400","text-xl","mb-2"],[1,"text-slate-400","mb-4"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-600","text-white","rounded-lg",3,"click"],[1,"text-slate-300","text-xl","mb-2"],[1,"text-slate-500","mb-6"],[1,"flex","flex-wrap","justify-center","gap-2","max-w-lg"],[1,"text-slate-500","text-sm"],[1,"px-3","py-1.5","bg-slate-700/50","hover:bg-cyan-500/20","text-slate-400","hover:text-cyan-400","rounded-full","text-sm","transition-all"],[1,"px-3","py-1.5","bg-slate-700/50","hover:bg-cyan-500/20","text-slate-400","hover:text-cyan-400","rounded-full","text-sm","transition-all",3,"click"],[1,"flex","items-center","justify-between","mb-3","px-1"],[1,"text-white","font-bold"],[1,"text-cyan-400"],[1,"bg-slate-700/50","border","border-slate-600","rounded","px-2","py-1","text-sm","text-white",3,"ngModelChange","ngModel"],[3,"value"],[1,"space-y-3"],[1,"group","bg-gradient-to-r","from-slate-800/80","to-slate-800/40","rounded-xl","border","transition-all","duration-300","overflow-hidden","cursor-pointer",3,"class"],[1,"flex","items-center","justify-center","gap-2","mt-4","py-3","border-t","border-slate-700/50"],[1,"group","bg-gradient-to-r","from-slate-800/80","to-slate-800/40","rounded-xl","border","transition-all","duration-300","overflow-hidden","cursor-pointer",3,"click"],[1,"p-4","flex","items-start","gap-4"],[1,"flex-shrink-0","flex","flex-col","gap-2"],[1,"relative","cursor-pointer",3,"click"],["type","checkbox",1,"sr-only",3,"change","checked"],[1,"w-5","h-5","rounded","border-2","flex","items-center","justify-center","transition-all"],[1,"text-white","text-xs"],[1,"p-2","rounded-lg","transition-all",3,"click","title"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-2","flex-wrap"],[1,"px-2.5","py-1","text-xs","rounded-full","font-medium","flex-shrink-0"],[1,"px-2","py-0.5","text-xs","rounded-full","font-medium","bg-green-500/30","text-green-300","flex-shrink-0"],[1,"px-2","py-0.5","text-xs","rounded-full","font-medium","bg-cyan-500/30","text-cyan-300","flex-shrink-0","animate-pulse"],[1,"px-2","py-0.5","text-xs","rounded-full","font-medium","bg-slate-600/30","text-slate-400","flex-shrink-0"],[1,"font-semibold","text-white","truncate"],["target","_blank",1,"text-cyan-400","text-sm","hover:underline","flex-shrink-0",3,"href"],[1,"flex","items-center","gap-3","mb-2","bg-slate-900/50","rounded-lg","px-3","py-2"],[1,"text-slate-400","text-sm","mb-2","line-clamp-2"],[1,"flex","items-center","gap-4","text-sm","flex-wrap"],[1,"flex","items-center","gap-1","text-slate-400"],[1,"text-lg"],[1,"font-medium","text-white"],["title","\u76F8\u6BD4\u4E0A\u6B21\u589E\u52A0",1,"text-green-400","text-xs","ml-1"],["title","\u76F8\u6BD4\u4E0A\u6B21\u6E1B\u5C11",1,"text-red-400","text-xs","ml-1"],[1,"flex","items-center","gap-1.5"],[1,"text-xs","text-slate-500","font-mono"],[1,"px-2","py-0.5","bg-slate-700/50","text-slate-400","rounded","text-xs"],[1,"px-2","py-0.5","bg-green-500/20","text-green-400","rounded","text-xs"],[1,"flex-shrink-0","flex","flex-col","gap-2",3,"click"],[1,"flex","flex-col","items-center"],["disabled","",1,"px-4","py-2","bg-slate-600","text-slate-300","rounded-lg","text-sm","font-medium","cursor-wait","flex","items-center","gap-1"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg","shadow-cyan-500/20"],["disabled","","title","\u983B\u9053\u7121\u6CD5\u63D0\u53D6\u6210\u54E1",1,"px-4","py-2","bg-slate-500/20","text-slate-500","rounded-lg","text-sm","cursor-not-allowed"],["target","_blank",1,"text-cyan-400","text-sm","hover:underline","flex-shrink-0",3,"click","href"],[1,"font-mono","text-cyan-300","text-sm","select-all"],["title","\u8907\u88FD ID",1,"px-2","py-1","text-xs","rounded","transition-all",3,"click"],[1,"font-mono","text-slate-400","text-sm"],["title","\u52A0\u5165\u7FA4\u7D44\u5F8C\u53EF\u7372\u53D6\u5B8C\u6574\u6578\u5B57 ID",1,"text-xs","text-amber-400/80","bg-amber-500/10","px-2","py-0.5","rounded"],[1,"text-slate-600"],["title","\u8907\u88FD\u9023\u7D50",1,"px-2","py-1","text-xs","rounded","transition-all",3,"click"],[1,"text-yellow-400"],[1,"text-yellow-400","font-medium"],[1,"px-4","py-2","bg-green-500/20","text-green-400","rounded-lg","text-sm","text-center"],[1,"text-xs","text-slate-500","mt-1"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg","shadow-cyan-500/20",3,"click"],[1,"px-4","py-2","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400","rounded-lg","text-sm","transition-all"],["disabled","","title","\u9700\u8981\u5148\u52A0\u5165\u7FA4\u7D44",1,"px-4","py-2","bg-slate-500/20","text-slate-500","rounded-lg","text-sm","cursor-not-allowed"],[1,"px-4","py-2","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400","rounded-lg","text-sm","transition-all",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-sm","transition-all",3,"click","disabled"],[1,"w-8","h-8","rounded-lg","text-sm","font-medium","transition-all",3,"class"],[1,"ml-2","text-sm","text-slate-400"],[1,"w-8","h-8","rounded-lg","text-sm","font-medium","transition-all",3,"click"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","shadow-2xl","border","border-slate-700",3,"click"],[1,"px-6","py-4","border-b","border-slate-700","flex","items-center","justify-between","bg-slate-800/95"],[1,"px-3","py-1","text-sm","rounded-full","font-medium"],[1,"text-xl","font-bold","text-white"],["title","\u4E0A\u4E00\u500B (\u2190 \u9375)",1,"p-2","rounded-lg","transition-all",3,"click","disabled"],["title","\u4E0B\u4E00\u500B (\u2192 \u9375)",1,"p-2","rounded-lg","transition-all",3,"click","disabled"],[1,"w-px","h-6","bg-slate-700","mx-1"],["title","\u95DC\u9589 (Esc \u9375)",1,"p-2","text-slate-400","hover:text-white","hover:bg-slate-700","rounded-lg","transition-all",3,"click"],[1,"p-6","overflow-y-auto","max-h-[calc(90vh-140px)]"],[1,"flex","items-start","gap-4","mb-6"],[1,"w-16","h-16","rounded-xl","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-3xl","flex-shrink-0"],[1,"text-2xl","font-bold","text-white","mb-1"],["target","_blank",1,"text-cyan-400","hover:underline",3,"href"],[1,"p-3","rounded-xl","transition-all",3,"click"],[1,"bg-slate-900/50","rounded-xl","p-4","mb-4"],[1,"text-slate-300","font-medium","mb-3","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-4"],[1,"text-slate-500","text-sm","mb-1"],[1,"text-white"],["target","_blank",1,"text-cyan-400","hover:underline","text-sm",3,"href"],[1,"grid","grid-cols-3","gap-4"],[1,"text-center","p-3","bg-slate-800/50","rounded-lg"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-yellow-400","mb-1"],[1,"text-cyan-400","font-mono","text-lg"],[1,"text-2xl","font-bold"],[1,"bg-slate-900/50","rounded-xl","p-4"],[1,"px-3","py-1","bg-slate-700","text-slate-300","rounded-full","text-sm"],[1,"px-3","py-1","bg-cyan-500/20","text-cyan-400","rounded-full","text-sm"],[1,"px-6","py-4","border-t","border-slate-700","bg-slate-800/95","flex","items-center","justify-between"],[1,"px-4","py-2","rounded-lg","transition-all","flex","items-center","gap-2",3,"click"],["target","_blank",1,"px-4","py-2","bg-slate-700","text-slate-300","hover:bg-slate-600","rounded-lg","flex","items-center","gap-2",3,"href"],[1,"px-4","py-2","bg-slate-700","text-slate-300","hover:bg-slate-600","rounded-lg",3,"click"],[1,"px-6","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","font-medium","transition-all","shadow-lg","shadow-cyan-500/20"],[1,"font-mono","text-cyan-300"],[1,"px-2","py-1","text-xs","rounded","transition-all",3,"click"],[1,"font-mono","text-slate-400"],["title","\u52A0\u5165\u7FA4\u7D44\u5F8C\u53EF\u7372\u53D6\u5B8C\u6574\u6578\u5B57 ID",1,"text-xs","text-amber-400/80"],["title","\u6B63\u5728\u540C\u6B65ID...",1,"text-xs","text-blue-400/80"],[1,"text-blue-400"],[1,"px-2","py-1","text-xs","bg-slate-700","text-slate-400","hover:bg-cyan-500/20","hover:text-cyan-400","rounded","transition-all",3,"click"],[1,"text-slate-400","whitespace-pre-wrap"],[1,"px-6","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","font-medium","transition-all","shadow-lg","shadow-cyan-500/20",3,"click"],[1,"px-6","py-2","bg-purple-500","hover:bg-purple-400","text-white","rounded-lg","font-medium","transition-all"],[1,"px-6","py-2","bg-purple-500","hover:bg-purple-400","text-white","rounded-lg","font-medium","transition-all",3,"click"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]",3,"click"],[1,"bg-slate-800","rounded-2xl","border","border-slate-700","shadow-2xl","w-[420px]","max-h-[80vh]","overflow-hidden",3,"click"],[1,"p-5","border-b","border-slate-700","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-1","truncate"],[1,"p-4","border-b","border-slate-700/50","bg-slate-800/50"],[1,"p-4","max-h-[300px]","overflow-y-auto"],[1,"text-sm","text-slate-400","mb-3"],[1,"space-y-2"],[1,"p-4","border-t","border-slate-700","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2","bg-cyan-500","hover:bg-cyan-400","disabled:bg-slate-600","disabled:text-slate-400","disabled:cursor-not-allowed","text-white","rounded-lg","font-medium","transition-all",3,"click","disabled"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-2xl","font-bold","text-white"],[1,"font-medium","text-white","truncate"],[1,"text-sm","text-cyan-400"],[1,"text-xs","text-slate-500","flex","items-center","gap-2","mt-0.5"],[1,"flex","items-center","gap-3","p-3","rounded-xl","cursor-pointer","transition-all",3,"class"],[1,"flex","items-center","gap-3","p-3","rounded-xl","cursor-pointer","transition-all"],["type","radio",1,"w-4","h-4","text-cyan-500","bg-slate-700","border-slate-600","focus:ring-cyan-500",3,"change","value","checked"],[1,"flex-1"],[1,"font-mono","text-white"],[1,"text-xs","text-slate-400"],[1,"w-2","h-2","rounded-full","bg-green-400"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u{1F50D}"),s(),l(7," \u641C\u7D22\u767C\u73FE "),s(),r(8,"div",6)(9,"span",7),l(10),s(),r(11,"span",8),l(12),s()()(),r(13,"div",3)(14,"div",6)(15,"span",9),l(16,"\u4F7F\u7528\u5E33\u865F:"),s(),y(17,CI,8,6,"div",10)(18,bI,2,0,"span",11),s(),y(19,yI,2,0,"span",12)(20,SI,2,0,"span",13),s()()(),r(21,"div",14)(22,"div",15)(23,"div",16)(24,"input",17),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),x("keyup.enter",function(){return n.doSearch()})("focus",function(){return n.showSuggestions.set(!0)})("blur",function(){return n.hideSuggestions()}),s(),r(25,"span",18),l(26,"\u{1F50D}"),s(),y(27,AI,8,1,"div",19),s(),r(28,"button",20),x("click",function(){return n.doSearch()}),l(29),s()(),r(30,"div",2)(31,"div",3)(32,"span",21),l(33,"\u641C\u7D22\u6E20\u9053:"),s(),r(34,"div",22),O(35,TI,7,8,"label",23,Em),s()(),r(37,"div",24)(38,"button",25),x("click",function(){return n.selectedSources.set(["telegram","jiso"])}),l(39," \u63A8\u85A6\u7D44\u5408 "),s(),r(40,"button",26),x("click",function(){return n.clearResults()}),l(41," \u6E05\u7A7A\u7D50\u679C "),s()()()(),y(42,LI,29,15,"div",27),r(43,"div",28),y(44,UI,3,1,"div",29)(45,qI,3,1,"div",30)(46,CF,22,5),s(),y(47,jF,106,39,"div",31),y(48,t9,18,3,"div",32),s()),t&2){let o,a;c(10),M(" ",n.mergedResources().length," \u7D50\u679C "),c(2),M(" ",n.savedCount()," \u5DF2\u6536\u85CF "),c(5),S((o=n.mergedSelectedAccount())?17:18,o),c(2),S(n.mergedSearching()?19:20),c(5),H("ngModel",n.searchQuery),c(3),S(n.showSuggestions()&&!n.mergedSearching()?27:-1),c(),L("disabled",n.mergedSearching()||!n.searchQuery.trim()),c(),M(" ",n.mergedSearching()?"\u641C\u7D22\u4E2D...":"\u641C\u7D22"," "),c(6),U(n.searchSources),c(7),S(n.mergedResources().length>0||n.currentKeyword()?42:-1),c(2),S(n.mergedSearching()?44:n.filteredResources().length===0?45:46),c(3),S((a=n.showDetailDialog()&&n.selectedResource())?47:-1,a),c(),S(n.showJoinAccountDialog()?48:-1)}},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he,St,yn],styles:["[_nghost-%COMP%]{display:block;height:100%}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#64748b4d;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b80}"]})}};var Mc=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.membershipService=F(Ie);this.accountService=F(pt);this.resourceService=F(ro)}navigateTo(e){this.nav.navigateTo(e)}selectResource(e){this.resourceService.toggleSelection(e.id)}batchJoin(e){let t=e.map(n=>n.id).join(",");this.resourceService.batchJoin(t)}t(e,t){return this.i18n.t(e,t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-resource-discovery-view"]],decls:1,vars:0,consts:[[3,"resourceSelected","batchJoin","navigateTo"]],template:function(t,n){t&1&&(r(0,"app-search-discovery",0),x("resourceSelected",function(a){return n.selectResource(a)})("batchJoin",function(a){return n.batchJoin(a)})("navigateTo",function(a){return n.navigateTo(a)}),s())},dependencies:[oe,ae,tr],encapsulation:2,changeDetection:0})}};var n9=()=>["short","medium","long"],Wn=(i,e)=>e.id,i9=(i,e)=>e.phone,o9=(i,e)=>e.name;function r9(i,e){i&1&&(r(0,"span",7),B(1,"span",20),l(2," AI \u5DF2\u9023\u63A5 "),s())}function s9(i,e){i&1&&(r(0,"span",8),l(1," \u672A\u914D\u7F6E AI "),s())}function a9(i,e){if(i&1){let t=I();r(0,"button",21),x("click",function(){let o=_(t).$implicit,a=m();return v(a.activeTab.set(o.id))}),r(1,"span",22),l(2),s(),r(3,"span"),l(4),s()()}if(i&2){let t=e.$implicit,n=m();N("bg-gradient-to-r",n.activeTab()===t.id)("from-purple-500",n.activeTab()===t.id)("to-pink-500",n.activeTab()===t.id)("text-white",n.activeTab()===t.id)("shadow-lg",n.activeTab()===t.id)("text-slate-400",n.activeTab()!==t.id)("hover:text-white",n.activeTab()!==t.id)("hover:bg-slate-700/50",n.activeTab()!==t.id),c(2),D(t.icon),c(2),D(t.label)}}function l9(i,e){if(i&1){let t=I();r(0,"div",29)(1,"div")(2,"label",55),l(3,"\u804A\u5929\u6A21\u5F0F"),s(),r(4,"div",56)(5,"button",57),x("click",function(){_(t);let o=m(2);return v(o.setAutoChatMode("full"))}),r(6,"div",58),l(7,"\u{1F680}"),s(),r(8,"div",59),l(9,"\u5168\u81EA\u52D5"),s(),r(10,"div",60),l(11,"AI \u81EA\u52D5\u767C\u9001\u56DE\u8986"),s()(),r(12,"button",57),x("click",function(){_(t);let o=m(2);return v(o.setAutoChatMode("semi"))}),r(13,"div",58),l(14,"\u{1F465}"),s(),r(15,"div",59),l(16,"\u534A\u81EA\u52D5"),s(),r(17,"div",60),l(18,"\u751F\u6210\u5EFA\u8B70\u5F8C\u78BA\u8A8D\u767C\u9001"),s()(),r(19,"button",57),x("click",function(){_(t);let o=m(2);return v(o.setAutoChatMode("assist"))}),r(20,"div",58),l(21,"\u{1F4A1}"),s(),r(22,"div",59),l(23,"\u8F14\u52A9\u6A21\u5F0F"),s(),r(24,"div",60),l(25,"\u50C5\u63D0\u4F9B\u5EFA\u8B70\u4E0D\u767C\u9001"),s()()()(),r(26,"div",61)(27,"div",62)(28,"div",49)(29,"span",63),l(30,"\u{1F44B}"),s(),r(31,"div")(32,"div",59),l(33,"\u81EA\u52D5\u554F\u5019"),s(),r(34,"div",60),l(35,"\u65B0 Lead \u81EA\u52D5\u767C\u9001\u554F\u5019"),s()()(),r(36,"input",64),x("change",function(){_(t);let o=m(2);return v(o.toggleAutoGreeting())}),s()(),r(37,"div",62)(38,"div",49)(39,"span",63),l(40,"\u{1F4AC}"),s(),r(41,"div")(42,"div",59),l(43,"\u81EA\u52D5\u56DE\u8986"),s(),r(44,"div",60),l(45,"\u7528\u6236\u79C1\u4FE1\u81EA\u52D5\u56DE\u8986"),s()()(),r(46,"input",64),x("change",function(){_(t);let o=m(2);return v(o.toggleAutoReply())}),s()()()()}if(i&2){let t=m(2);c(5),N("bg-emerald-500/20",t.autoChatMode()==="full")("border-emerald-500",t.autoChatMode()==="full")("bg-slate-700/50",t.autoChatMode()!=="full")("border-slate-600",t.autoChatMode()!=="full"),c(7),N("bg-cyan-500/20",t.autoChatMode()==="semi")("border-cyan-500",t.autoChatMode()==="semi")("bg-slate-700/50",t.autoChatMode()!=="semi")("border-slate-600",t.autoChatMode()!=="semi"),c(7),N("bg-amber-500/20",t.autoChatMode()==="assist")("border-amber-500",t.autoChatMode()==="assist")("bg-slate-700/50",t.autoChatMode()!=="assist")("border-slate-600",t.autoChatMode()!=="assist"),c(17),L("checked",t.autoGreetingEnabled()),c(10),L("checked",t.autoReplyEnabled())}}function c9(i,e){if(i&1&&B(0,"img",66),i&2){let t=m().$implicit;L("src",t.avatar,ot)}}function d9(i,e){if(i&1&&(r(0,"span",67),l(1),s()),i&2){let t=m().$implicit;c(),D((t.username==null?null:t.username.charAt(0))||"?")}}function u9(i,e){if(i&1&&(r(0,"div",46)(1,"div",49)(2,"div",65),y(3,c9,1,1,"img",66)(4,d9,2,1,"span",67),s(),r(5,"div")(6,"div",59),l(7),s(),r(8,"div",60),l(9),s()()(),r(10,"span",68),B(11,"span",20),l(12," \u5728\u7DDA "),s()()),i&2){let t=e.$implicit;c(3),S(t.avatar?3:4),c(4),D(t.username||t.phone),c(2),X("\u4ECA\u65E5: ",t.sentToday||0,"/",t.dailyLimit||50," \u689D")}}function m9(i,e){i&1&&(r(0,"div",47)(1,"div",69),l(2,"\u{1F4E4}"),s(),r(3,"p"),l(4,"\u6C92\u6709\u53EF\u7528\u7684\u767C\u9001\u5E33\u865F"),s(),r(5,"p",70),l(6,"\u8ACB\u5728\u5E33\u865F\u7BA1\u7406\u4E2D\u6DFB\u52A0\u4E26\u8A2D\u7F6E\u70BA\u300C\u767C\u9001\u300D\u89D2\u8272"),s()())}function p9(i,e){if(i&1&&(r(0,"div",51)(1,"div",71),l(2),s(),r(3,"div",72)(4,"div",59),l(5),s(),r(6,"div",44),l(7),s()(),r(8,"span",73),B(9,"span",20),l(10," \u5DF2\u9023\u63A5 "),s()()),i&2){let t=m(2);c(2),M(" ",t.getProviderIcon(t.aiService.defaultModel().provider)," "),c(3),D(t.aiService.defaultModel().modelName),c(2),D(t.getProviderName(t.aiService.defaultModel().provider))}}function g9(i,e){i&1&&(r(0,"div",52)(1,"div",49)(2,"span",5),l(3,"\u26A0\uFE0F"),s(),r(4,"div")(5,"div",74),l(6,"\u672A\u914D\u7F6E AI \u6A21\u578B"),s(),r(7,"div",44),l(8,"\u8ACB\u5148\u6DFB\u52A0 AI \u6A21\u578B\u624D\u80FD\u4F7F\u7528\u81EA\u52D5\u804A\u5929\u529F\u80FD"),s()()()())}function h9(i,e){if(i&1){let t=I();r(0,"div",18)(1,"div",23)(2,"div",2)(3,"div",3)(4,"div",24),l(5," \u{1F916} "),s(),r(6,"div")(7,"h3",25),l(8,"AI \u81EA\u52D5\u804A\u5929"),s(),r(9,"p",26),l(10,"\u958B\u555F\u5F8C\uFF0CAI \u5C07\u81EA\u52D5\u554F\u5019\u65B0 Lead \u4E26\u56DE\u8986\u79C1\u4FE1"),s()()(),r(11,"button",27),x("click",function(){_(t);let o=m();return v(o.toggleAutoChat())}),B(12,"span",28),s()(),y(13,l9,47,26,"div",29),s(),r(14,"div",30)(15,"div",2)(16,"div",3)(17,"div",31),l(18," \u{1F680} "),s(),r(19,"div")(20,"h3",32),l(21," \u667A\u80FD\u71DF\u92B7\u4E2D\u5FC3 "),r(22,"span",33),l(23,"\u6574\u5408"),s()(),r(24,"p",26),l(25,"\u4E00\u9375\u555F\u52D5\u71DF\u92B7\u4EFB\u52D9 - AI \u81EA\u52D5\u914D\u7F6E\u89D2\u8272\u548C\u7B56\u7565"),s()()(),r(26,"button",34),x("click",function(){_(t);let o=m();return v(o.goToSmartMarketing())}),r(27,"span"),l(28,"\u{1F680}"),s(),l(29," \u524D\u5F80\u4F7F\u7528 "),s()(),r(30,"div",35)(31,"div",36)(32,"div",37)(33,"div",38),l(34,"\u{1F4B0}"),s(),r(35,"div",39),l(36,"\u4FC3\u9032\u9996\u55AE"),s()(),r(37,"div",37)(38,"div",38),l(39,"\u{1F49D}"),s(),r(40,"div",39),l(41,"\u633D\u56DE\u6D41\u5931"),s()(),r(42,"div",37)(43,"div",38),l(44,"\u{1F389}"),s(),r(45,"div",39),l(46,"\u793E\u7FA4\u6D3B\u8E8D"),s()(),r(47,"div",37)(48,"div",38),l(49,"\u{1F527}"),s(),r(50,"div",39),l(51,"\u552E\u5F8C\u670D\u52D9"),s()()(),r(52,"p",40),l(53," \u{1F4A1} \u9078\u64C7\u76EE\u6A19 \u2192 AI \u81EA\u52D5\u914D\u7F6E \u2192 \u4E00\u9375\u555F\u52D5\uFF0C\u5DF2\u6574\u5408\u591A\u89D2\u8272\u5354\u4F5C\u548C AI \u81EA\u4E3B\u529F\u80FD "),s()()(),r(54,"div",41)(55,"div",42)(56,"span",5),l(57,"\u{1F4E4}"),s(),r(58,"div")(59,"h3",43),l(60,"\u767C\u9001\u5E33\u865F"),s(),r(61,"p",44),l(62,"\u9078\u64C7\u7528\u65BC\u767C\u9001\u6D88\u606F\u7684\u5E33\u865F"),s()()(),r(63,"div",45),O(64,u9,13,4,"div",46,i9,!1,m9,7,0,"div",47),s()(),r(67,"div",41)(68,"div",48)(69,"div",49)(70,"span",5),l(71,"\u{1F9E0}"),s(),r(72,"div")(73,"h3",43),l(74,"AI \u6A21\u578B"),s(),r(75,"p",44),l(76,"\u7576\u524D\u4F7F\u7528\u7684 AI \u6A21\u578B"),s()()(),r(77,"button",50),x("click",function(){_(t);let o=m();return v(o.activeTab.set("models"))}),l(78," \u914D\u7F6E\u6A21\u578B \u2192 "),s()(),y(79,p9,11,3,"div",51)(80,g9,9,0,"div",52),s(),r(81,"div",53)(82,"button",54),x("click",function(){_(t);let o=m();return v(o.saveQuickSettings())}),l(83," \u{1F4BE} \u4FDD\u5B58\u8A2D\u7F6E "),s()()()}if(i&2){let t=m();c(11),N("bg-emerald-500",t.autoChatEnabled())("bg-slate-600",!t.autoChatEnabled()),c(),N("translate-x-8",t.autoChatEnabled()),c(),S(t.autoChatEnabled()?13:-1),c(51),U(t.senderAccounts()),c(15),S(t.aiService.defaultModel()?79:80)}}function f9(i,e){i&1&&(r(0,"span",68),B(1,"span",20),l(2," \u5DF2\u9023\u63A5 "),s())}function _9(i,e){i&1&&(r(0,"span",96),l(1,"\u672A\u6E2C\u8A66"),s())}function v9(i,e){i&1&&(B(0,"span",100),l(1," \u6E2C\u8A66\u4E2D... "))}function x9(i,e){i&1&&l(0," \u6E2C\u8A66 ")}function C9(i,e){if(i&1){let t=I();r(0,"div",80)(1,"div",3)(2,"div",94)(3,"span",5),l(4,"\u{1F999}"),s()(),r(5,"div")(6,"div",59),l(7),s(),r(8,"div",95),l(9),s()()(),r(10,"div",49),y(11,f9,3,0,"span",68)(12,_9,2,0,"span",96),r(13,"button",97),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.testModel(o))}),y(14,v9,2,0)(15,x9,1,0),s(),r(16,"button",98),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.setAsDefault(o))}),l(17),s(),r(18,"button",99),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteModel(o))}),l(19," \u2715 "),s()()()}if(i&2){let t,n,o=e.$implicit,a=m(2);c(7),D(o.displayName||o.modelName),c(2),D(o.apiEndpoint),c(2),S(o.isConnected?11:12),c(2),L("disabled",a.aiService.testingModelIds().has(o.id)),c(),S(a.aiService.testingModelIds().has(o.id)?14:15),c(2),de(((t=a.aiService.defaultModel())==null?null:t.id)===o.id?"bg-emerald-500 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"),c(),M(" ",((n=a.aiService.defaultModel())==null?null:n.id)===o.id?"\u9ED8\u8A8D":"\u8A2D\u70BA\u9ED8\u8A8D"," ")}}function b9(i,e){if(i&1){let t=I();r(0,"div",81)(1,"p",101),l(2,"\u4F7F\u7528\u672C\u5730 Ollama \u53EF\u514D\u8CBB\u7121\u9650\u8ABF\u7528 AI"),s(),r(3,"button",102),x("click",function(){_(t);let o=m(2);return v(o.showAddLocalModel.set(!0))}),l(4," \u{1F999} \u5FEB\u901F\u914D\u7F6E\u672C\u5730 AI "),s()()}}function y9(i,e){i&1&&(r(0,"span",68),B(1,"span",20),l(2," \u5DF2\u9023\u63A5 "),s())}function S9(i,e){i&1&&(r(0,"span",104),l(1,"\u672A\u9023\u63A5"),s())}function w9(i,e){i&1&&(B(0,"span",100),l(1," \u6E2C\u8A66\u4E2D... "))}function E9(i,e){i&1&&l(0," \u6E2C\u8A66 ")}function D9(i,e){if(i&1){let t=I();r(0,"div",83)(1,"div",3)(2,"div",103)(3,"span",5),l(4),s()(),r(5,"div")(6,"div",59),l(7),s(),r(8,"div",44),l(9),s()()(),r(10,"div",49),y(11,y9,3,0,"span",68)(12,S9,2,0,"span",104),r(13,"button",97),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.testModel(o))}),y(14,w9,2,0)(15,E9,1,0),s(),r(16,"button",98),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.setAsDefault(o))}),l(17),s(),r(18,"button",99),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteModel(o))}),l(19," \u2715 "),s()()()}if(i&2){let t,n,o=e.$implicit,a=m(2);c(2),N("bg-emerald-500/20",o.provider==="openai")("bg-purple-500/20",o.provider==="claude")("bg-blue-500/20",o.provider==="gemini"),c(2),D(a.getProviderIcon(o.provider)),c(3),D(o.displayName||o.modelName),c(2),D(a.getProviderName(o.provider)),c(2),S(o.isConnected?11:12),c(2),L("disabled",a.aiService.testingModelIds().has(o.id)),c(),S(a.aiService.testingModelIds().has(o.id)?14:15),c(2),de(((t=a.aiService.defaultModel())==null?null:t.id)===o.id?"bg-purple-500 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"),c(),M(" ",((n=a.aiService.defaultModel())==null?null:n.id)===o.id?"\u9ED8\u8A8D":"\u8A2D\u70BA\u9ED8\u8A8D"," ")}}function A9(i,e){if(i&1){let t=I();r(0,"div",81)(1,"p",101),l(2,"\u6DFB\u52A0 OpenAI\u3001Claude \u6216 Gemini \u7B49\u96F2\u7AEF\u6A21\u578B"),s(),r(3,"button",105),x("click",function(){_(t);let o=m(2);return v(o.showAddModel.set(!0))}),l(4," + \u6DFB\u52A0\u96F2\u7AEF\u6A21\u578B "),s()()}}function M9(i,e){i&1&&(r(0,"span",107)(1,"span",114),l(2,"\u27F3"),s(),l(3," \u4FDD\u5B58\u4E2D... "),s())}function T9(i,e){i&1&&(r(0,"span",107),l(1," \u2713 \u5DF2\u4FDD\u5B58 "),s())}function k9(i,e){if(i&1&&(r(0,"option",112),l(1),s()),i&2){let t=e.$implicit,n=m(3);L("value",t.id)("selected",t.id===n.aiService.modelUsage().intentRecognition),c(),M(" ",t.displayName||t.modelName," ")}}function I9(i,e){if(i&1&&(r(0,"option",112),l(1),s()),i&2){let t=e.$implicit,n=m(3);L("value",t.id)("selected",t.id===n.aiService.modelUsage().dailyChat),c(),M(" ",t.displayName||t.modelName," ")}}function F9(i,e){if(i&1&&(r(0,"option",112),l(1),s()),i&2){let t=e.$implicit,n=m(3);L("value",t.id)("selected",t.id===n.aiService.modelUsage().multiRoleScript),c(),M(" ",t.displayName||t.modelName," ")}}function P9(i,e){if(i&1){let t=I();r(0,"div",84)(1,"div",48)(2,"h4",106),l(3,"\u6A21\u578B\u7528\u9014\u5206\u914D"),s(),y(4,M9,4,0,"span",107)(5,T9,2,0,"span",107),s(),r(6,"div",108)(7,"div")(8,"label",109),l(9,"\u610F\u5716\u8B58\u5225"),s(),r(10,"select",110),x("change",function(o){_(t);let a=m(2);return v(a.onModelUsageChange("intentRecognition",o))}),r(11,"option",111),l(12,"\u9078\u64C7\u6A21\u578B"),s(),O(13,k9,2,3,"option",112,Wn),s()(),r(15,"div")(16,"label",109),l(17,"\u65E5\u5E38\u5C0D\u8A71"),s(),r(18,"select",110),x("change",function(o){_(t);let a=m(2);return v(a.onModelUsageChange("dailyChat",o))}),r(19,"option",111),l(20,"\u9078\u64C7\u6A21\u578B"),s(),O(21,I9,2,3,"option",112,Wn),s()(),r(23,"div")(24,"label",109),l(25,"\u591A\u89D2\u8272\u5287\u672C"),s(),r(26,"select",110),x("change",function(o){_(t);let a=m(2);return v(a.onModelUsageChange("multiRoleScript",o))}),r(27,"option",111),l(28,"\u9078\u64C7\u6A21\u578B"),s(),O(29,F9,2,3,"option",112,Wn),s()()(),r(31,"p",113),l(32,"\u{1F4A1} \u9078\u64C7\u5F8C\u81EA\u52D5\u4FDD\u5B58\uFF0C\u4E0D\u540C\u7528\u9014\u53EF\u4EE5\u4F7F\u7528\u4E0D\u540C\u7684 AI \u6A21\u578B"),s()()}if(i&2){let t=m(2);c(4),S(t.isSavingUsage()?4:t.usageSaved()?5:-1),c(6),L("value",t.aiService.modelUsage().intentRecognition),c(3),U(t.aiService.models()),c(5),L("value",t.aiService.modelUsage().dailyChat),c(3),U(t.aiService.models()),c(5),L("value",t.aiService.modelUsage().multiRoleScript),c(3),U(t.aiService.models())}}function R9(i,e){i&1&&(B(0,"span",121),l(1," \u6E2C\u8A66\u4E2D... "))}function N9(i,e){i&1&&l(0," \u{1F517} \u6E2C\u8A66\u9023\u63A5 ")}function V9(i,e){if(i&1){let t=I();r(0,"button",122),x("click",function(){_(t);let o=m(3);return v(o.testTtsVoice())}),l(1," \u{1F50A} \u8A66\u807D\u8A9E\u97F3 "),s()}}function B9(i,e){if(i&1&&(r(0,"span",123),l(1),s()),i&2){let t=m(4);c(),M("\xB7 \u5EF6\u9072: ",t.ttsLatency(),"ms")}}function L9(i,e){if(i&1&&(r(0,"div",120),B(1,"span",20),l(2," TTS \u670D\u52D9\u5DF2\u9023\u63A5 "),y(3,B9,2,1,"span",123),s()),i&2){let t=m(3);c(3),S(t.ttsLatency()>0?3:-1)}}function O9(i,e){if(i&1){let t=I();r(0,"div",92)(1,"div")(2,"label",55),l(3,"TTS \u670D\u52D9\u7AEF\u9EDE"),s(),r(4,"input",115),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.ttsEndpoint,o)||(a.ttsEndpoint=o),v(o)}),s(),r(5,"p",116),l(6,"\u652F\u6301 GPT-SoVITS\u3001VITS \u7B49\u672C\u5730\u8A9E\u97F3\u670D\u52D9"),s()(),r(7,"div",117)(8,"button",118),x("click",function(){_(t);let o=m(2);return v(o.testTtsConnection())}),y(9,R9,2,0)(10,N9,1,0),s(),y(11,V9,2,0,"button",119),s(),y(12,L9,4,1,"div",120),s()}if(i&2){let t=m(2);c(4),H("ngModel",t.ttsEndpoint),c(4),L("disabled",t.isTestingTts()),c(),S(t.isTestingTts()?9:10),c(2),S(t.ttsConnected()?11:-1),c(),S(t.ttsConnected()?12:-1)}}function U9(i,e){i&1&&(r(0,"div",93)(1,"p",124),l(2,"\u958B\u555F\u5F8C\u53EF\u914D\u7F6E GPT-SoVITS \u7B49\u8A9E\u97F3\u670D\u52D9\uFF0C\u8B93 AI \u64C1\u6709\u8A9E\u97F3\u80FD\u529B"),s()())}function G9(i,e){if(i&1){let t=I();r(0,"div",18)(1,"div",75)(2,"div",48)(3,"h3",76)(4,"span"),l(5,"\u{1F999}"),s(),l(6," \u672C\u5730 AI "),r(7,"span",77),l(8,"\u63A8\u85A6 - \u514D\u8CBB\u7121\u9650"),s()(),r(9,"button",78),x("click",function(){_(t);let o=m();return v(o.showAddLocalModel.set(!0))}),l(10," + \u6DFB\u52A0\u672C\u5730 AI "),s()(),r(11,"div",79),O(12,C9,20,8,"div",80,Wn,!1,b9,5,0,"div",81),s()(),r(15,"div",41)(16,"div",48)(17,"h3",76)(18,"span"),l(19,"\u2601\uFE0F"),s(),l(20," \u96F2\u7AEF AI "),s(),r(21,"button",82),x("click",function(){_(t);let o=m();return v(o.showAddModel.set(!0))}),l(22," + \u6DFB\u52A0\u96F2\u7AEF\u6A21\u578B "),s()(),r(23,"div",79),O(24,D9,20,15,"div",83,Wn,!1,A9,5,0,"div",81),s(),y(27,P9,33,4,"div",84),s(),r(28,"div",85)(29,"div",48)(30,"h3",76)(31,"span"),l(32,"\u{1F50A}"),s(),l(33," \u8A9E\u97F3\u8F38\u51FA (TTS) "),r(34,"span",86),l(35,"\u53EF\u9078"),s()(),r(36,"label",87)(37,"input",88),W("ngModelChange",function(o){_(t);let a=m();return q(a.ttsEnabled,o)||(a.ttsEnabled=o),v(o)}),x("change",function(){_(t);let o=m();return v(o.saveTtsSettings())}),s(),B(38,"div",89),r(39,"span",90),l(40),s()()(),r(41,"p",91),l(42,"\u555F\u7528\u5F8C\uFF0CAI \u56DE\u8986\u5C07\u81EA\u52D5\u8F49\u63DB\u70BA\u8A9E\u97F3\u64AD\u653E"),s(),y(43,O9,13,5,"div",92)(44,U9,3,0,"div",93),s()()}if(i&2){let t=m();c(12),U(t.localModels()),c(12),U(t.cloudModels()),c(3),S(t.aiService.models().length>0?27:-1),c(10),H("ngModel",t.ttsEnabled),c(3),D(t.ttsEnabled?"\u5DF2\u555F\u7528":"\u5DF2\u95DC\u9589"),c(3),S(t.ttsEnabled?43:44)}}function $9(i,e){if(i&1){let t=I();r(0,"button",155),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.selectPersonaTemplate(o.id))}),r(1,"div",69),l(2),s(),r(3,"div",156),l(4),s(),r(5,"div",157),l(6),s()()}if(i&2){let t=e.$implicit,n=m(2);N("border-purple-500",n.selectedPersonaTemplate()===t.id)("bg-purple-500/10",n.selectedPersonaTemplate()===t.id)("border-transparent",n.selectedPersonaTemplate()!==t.id)("bg-slate-700/50",n.selectedPersonaTemplate()!==t.id)("hover:bg-slate-700",n.selectedPersonaTemplate()!==t.id),c(2),D(t.icon),c(),N("text-purple-400",n.selectedPersonaTemplate()===t.id)("text-white",n.selectedPersonaTemplate()!==t.id),c(),M(" ",t.name," "),c(2),D(t.description)}}function H9(i,e){if(i&1){let t=I();r(0,"button",158),x("click",function(){let o=_(t).$implicit,a=m(2);return a.setStyle(o.id),v(a.markStrategyDirty())}),r(1,"div",58),l(2),s(),r(3,"div",159),l(4),s()()}if(i&2){let t=e.$implicit,n=m(2);N("border-purple-500",n.currentStyle()===t.id)("bg-purple-500/10",n.currentStyle()===t.id)("border-transparent",n.currentStyle()!==t.id)("bg-slate-700/50",n.currentStyle()!==t.id),c(2),D(t.icon),c(),N("text-purple-400",n.currentStyle()===t.id)("text-white",n.currentStyle()!==t.id),c(),M(" ",t.label," ")}}function q9(i,e){if(i&1){let t=I();r(0,"button",160),x("click",function(){let o=_(t).$implicit,a=m(2);return a.setResponseLength(o),v(a.markStrategyDirty())}),l(1),s()}if(i&2){let t=e.$implicit,n=m(2);N("bg-purple-500",n.responseLength()===t)("text-white",n.responseLength()===t)("bg-slate-700",n.responseLength()!==t)("text-slate-300",n.responseLength()!==t),c(),M(" ",t==="short"?"\u7C21\u77ED":t==="medium"?"\u9069\u4E2D":"\u8A73\u7D30"," ")}}function W9(i,e){if(i&1){let t=I();r(0,"label",141)(1,"div",49)(2,"span",63),l(3),s(),r(4,"div")(5,"div",150),l(6),s(),r(7,"div",60),l(8),s()()(),r(9,"input",161),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleRule(o.id))}),s()()}if(i&2){let t=e.$implicit;c(3),D(t.icon),c(3),D(t.name),c(2),D(t.description),c(),L("checked",t.isActive)}}function z9(i,e){i&1&&l(0," \u{1F4A1} \u4FEE\u6539\u5F8C\u8ACB\u8A18\u5F97\u4FDD\u5B58 ")}function K9(i,e){i&1&&l(0," \u2713 \u6240\u6709\u66F4\u6539\u5DF2\u4FDD\u5B58 ")}function j9(i,e){i&1&&(r(0,"span",114),l(1,"\u27F3"),s(),l(2," \u4FDD\u5B58\u4E2D... "))}function J9(i,e){i&1&&l(0," \u{1F4BE} \u4FDD\u5B58\u4EBA\u683C\u8A2D\u5B9A ")}function Q9(i,e){if(i&1){let t=I();r(0,"div",18)(1,"div",41)(2,"div",125)(3,"h3",76)(4,"span"),l(5,"\u{1F3AD}"),s(),l(6," \u9078\u64C7 AI \u4EBA\u683C "),s(),r(7,"button",126),l(8," + \u81EA\u5B9A\u7FA9\u4EBA\u683C "),s()(),r(9,"div",127),O(10,$9,7,17,"button",128,Wn),s()(),r(12,"div",41)(13,"h3",129)(14,"span"),l(15,"\u{1F4AC}"),s(),l(16," \u5C0D\u8A71\u98A8\u683C "),s(),r(17,"div",130)(18,"div",92)(19,"div",131),O(20,H9,5,14,"button",132,Wn),s(),r(22,"div")(23,"label",55),l(24,"\u56DE\u8986\u9577\u5EA6"),s(),r(25,"div",133),O(26,q9,2,9,"button",134,be),s()(),r(28,"label",135),x("click",function(){_(t);let o=m();return o.toggleEmoji(),v(o.markStrategyDirty())}),r(29,"div")(30,"div",136),l(31,"\u4F7F\u7528 Emoji \u8868\u60C5"),s(),r(32,"div",60),l(33,"\u5728\u56DE\u8986\u4E2D\u6DFB\u52A0\u8868\u60C5"),s()(),B(34,"input",137),s()(),r(35,"div")(36,"label",55),l(37,"\u81EA\u5B9A\u7FA9\u4EBA\u8A2D\u63D0\u793A\u8A5E"),s(),r(38,"textarea",138),x("input",function(o){_(t);let a=m();return v(a.onPersonaInput(o))}),l(39,"                    "),s(),r(40,"p",139),l(41,"\u{1F4A1} \u63D0\u793A\uFF1A\u9078\u64C7\u4EBA\u683C\u6A21\u677F\u6703\u81EA\u52D5\u586B\u5145\u6B64\u9805"),s()()()(),r(42,"div",41)(43,"div",125)(44,"h3",76)(45,"span"),l(46,"\u26A1"),s(),l(47," \u667A\u80FD\u884C\u70BA "),r(48,"span",140),l(49,"\u6839\u64DA\u60C5\u6CC1\u81EA\u52D5\u89F8\u767C\u76F8\u61C9\u52D5\u4F5C"),s()()(),r(50,"div",79),O(51,W9,10,4,"label",141,Wn),s(),r(53,"button",142),l(54," + \u6DFB\u52A0\u81EA\u5B9A\u7FA9\u884C\u70BA\u898F\u5247 "),s()(),r(55,"div",143)(56,"h3",144)(57,"span"),l(58,"\u{1F4AC}"),s(),l(59," AI \u56DE\u8986\u9810\u89BD "),s(),r(60,"div",145)(61,"div",146)(62,"span",12),l(63,"\u7528\u6236:"),s(),r(64,"p",147),l(65,"\u4F60\u5011\u7684\u670D\u52D9\u591A\u5C11\u9322\uFF1F"),s()(),r(66,"div",148)(67,"span",149),l(68),s(),r(69,"p",150),l(70),s()()(),r(71,"button",151),x("click",function(){_(t);let o=m();return v(o.regeneratePreview())}),l(72," \u{1F504} \u91CD\u65B0\u751F\u6210\u9810\u89BD "),s()(),r(73,"div",152)(74,"div",44),y(75,z9,1,0)(76,K9,1,0),s(),r(77,"div",117)(78,"button",153),x("click",function(){_(t);let o=m();return v(o.resetStrategy())}),l(79," \u91CD\u7F6E "),s(),r(80,"button",154),x("click",function(){_(t);let o=m();return v(o.savePersonaSettings())}),y(81,j9,3,0)(82,J9,1,0),s()()()()}if(i&2){let t=m();c(10),U(t.personaTemplates),c(10),U(t.conversationStyles),c(6),U(rt(7,n9)),c(8),L("checked",t.useEmoji()),c(4),L("value",t.customPersona()),c(13),U(t.defaultRules),c(17),M("AI (",t.getPersonaName(),"):"),c(2),D(t.getPreviewResponse()),c(5),S(t.strategyDirty()?75:76),c(5),L("disabled",!t.strategyDirty()||t.isSavingStrategy()),c(),S(t.isSavingStrategy()?81:82)}}function Y9(i,e){i&1&&(r(0,"span",172),l(1,"\u904B\u884C\u4E2D"),s())}function X9(i,e){i&1&&(r(0,"span",173),l(1,"\u5DF2\u95DC\u9589"),s())}function Z9(i,e){if(i&1){let t=I();r(0,"div",18)(1,"div",127)(2,"div",162)(3,"div",163),l(4),s(),r(5,"div",44),l(6,"\u4ECA\u65E5\u5C0D\u8A71"),s()(),r(7,"div",162)(8,"div",164),l(9),s(),r(10,"div",44),l(11,"\u610F\u5716\u8B58\u5225"),s()(),r(12,"div",162)(13,"div",165),l(14),s(),r(15,"div",44),l(16,"\u8F49\u5316"),s()(),r(17,"div",162)(18,"div",166),l(19),s(),r(20,"div",44),l(21,"\u6210\u672C"),s()()(),r(22,"div",41)(23,"h3",167),l(24,"\u672C\u9031\u6982\u89BD"),s(),r(25,"div",130)(26,"div")(27,"div",168),l(28),s(),r(29,"div",169),l(30,"\u7E3D\u5C0D\u8A71"),s()(),r(31,"div")(32,"div",170),l(33),s(),r(34,"div",169),l(35,"\u8F49\u5316\u7387"),s()()()(),r(36,"div",171)(37,"div",48)(38,"div",49)(39,"span",5),l(40,"\u{1F9E0}"),s(),r(41,"h3",43),l(42,"AI \u667A\u80FD\u7CFB\u7D71\u72C0\u614B"),s(),y(43,Y9,2,0,"span",172)(44,X9,2,0,"span",173),s(),r(45,"button",174),x("click",function(){_(t);let o=m();return v(o.goToSmartMarketing())}),r(46,"span"),l(47,"\u{1F4CA}"),s(),l(48," \u67E5\u770B\u8A73\u7D30\u7D71\u8A08 "),s()(),r(49,"div",108)(50,"div",175)(51,"div",176)(52,"span",22),l(53,"\u{1F4AD}"),s(),r(54,"span",106),l(55,"\u5C0D\u8A71\u8A18\u61B6"),s()(),r(56,"div",177),l(57),s(),r(58,"div",60),l(59,"\u689D\u8A18\u61B6"),s()(),r(60,"div",175)(61,"div",176)(62,"span",22),l(63,"\u{1F3F7}\uFE0F"),s(),r(64,"span",106),l(65,"\u5BA2\u6236\u6A19\u7C64"),s()(),r(66,"div",178),l(67),s(),r(68,"div",60),l(69,"\u500B\u6A19\u7C64"),s()(),r(70,"div",175)(71,"div",176)(72,"span",22),l(73,"\u{1F60A}"),s(),r(74,"span",106),l(75,"\u60C5\u7DD2\u5206\u6790"),s()(),r(76,"div",179),l(77),s(),r(78,"div",60),l(79,"\u6B21\u5206\u6790"),s()(),r(80,"div",175)(81,"div",176)(82,"span",22),l(83,"\u{1F504}"),s(),r(84,"span",106),l(85,"\u81EA\u52D5\u5316\u6D41\u7A0B"),s()(),r(86,"div",180),l(87),s(),r(88,"div",60),l(89,"\u6B21\u57F7\u884C"),s()(),r(90,"div",175)(91,"div",176)(92,"span",22),l(93,"\u23F0"),s(),r(94,"span",106),l(95,"\u5F85\u8DDF\u9032"),s()(),r(96,"div",181),l(97),s(),r(98,"div",60),l(99,"\u500B\u4EFB\u52D9"),s()(),r(100,"div",175)(101,"div",176)(102,"span",22),l(103,"\u{1F4DA}"),s(),r(104,"span",106),l(105,"\u77E5\u8B58\u5EAB"),s()(),r(106,"div",182),l(107),s(),r(108,"div",60),l(109,"\u689D\u5B78\u7FD2"),s()()(),r(110,"div",183)(111,"button",184),x("click",function(){_(t);let o=m();return v(o.refreshSmartSystemStats())}),l(112," \u{1F504} \u5237\u65B0\u7D71\u8A08 "),s()()()()}if(i&2){let t=m();c(4),D(t.aiService.stats().today.conversations),c(5),D(t.aiService.stats().today.intentsRecognized),c(5),D(t.aiService.stats().today.conversions),c(5),M("\xA5",t.aiService.stats().today.cost.toFixed(2)),c(9),M(" ",t.aiService.stats().weekly.conversations," "),c(5),M(" ",(t.aiService.stats().weekly.conversionRate*100).toFixed(1),"% "),c(10),S(t.autonomousModeEnabled()?43:44),c(14),D(t.smartSystemStats().memories),c(10),D(t.smartSystemStats().tags),c(10),D(t.smartSystemStats().emotions),c(10),D(t.smartSystemStats().workflows),c(10),D(t.smartSystemStats().followups),c(10),D(t.smartSystemStats().knowledge)}}function eP(i,e){if(i&1){let t=I();r(0,"button",196),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.newModelProvider.set(o.id))}),r(1,"div",58),l(2),s(),r(3,"div",197),l(4),s()()}if(i&2){let t=e.$implicit,n=m(2);N("border-purple-500",n.newModelProvider()===t.id)("bg-purple-500/10",n.newModelProvider()===t.id)("border-transparent",n.newModelProvider()!==t.id)("bg-slate-700",n.newModelProvider()!==t.id),c(2),D(t.icon),c(),N("text-purple-400",n.newModelProvider()===t.id)("text-slate-300",n.newModelProvider()!==t.id),c(),M(" ",t.name," ")}}function tP(i,e){if(i&1&&(r(0,"option",190),l(1),s()),i&2){let t=e.$implicit;L("value",t.name),c(),D(t.displayName)}}function nP(i,e){if(i&1){let t=I();r(0,"div",19)(1,"div",185)(2,"h3",186),l(3,"\u6DFB\u52A0\u96F2\u7AEF AI \u6A21\u578B"),s(),r(4,"div",92)(5,"div")(6,"label",55),l(7,"\u9078\u64C7\u4F9B\u61C9\u5546"),s(),r(8,"div",187),O(9,eP,5,14,"button",188,Wn),s()(),r(11,"div")(12,"label",55),l(13,"\u9078\u64C7\u6A21\u578B *"),s(),r(14,"select",189),W("ngModelChange",function(o){_(t);let a=m();return q(a.newModelName,o)||(a.newModelName=o),v(o)}),r(15,"option",111),l(16,"\u8ACB\u9078\u64C7\u6A21\u578B"),s(),O(17,tP,2,2,"option",190,o9),s(),r(19,"p",116),l(20,"\u{1F4A1} \u6A21\u578B\u540D\u7A31\u5C07\u81EA\u52D5\u683C\u5F0F\u5316\uFF0C\u7121\u9700\u64D4\u5FC3\u5927\u5C0F\u5BEB"),s()(),r(21,"div")(22,"label",55),l(23,"API Key *"),s(),r(24,"input",191),W("ngModelChange",function(o){_(t);let a=m();return q(a.newModelApiKey,o)||(a.newModelApiKey=o),v(o)}),s()(),r(25,"div")(26,"label",55),l(27,"\u986F\u793A\u540D\u7A31 (\u53EF\u9078)"),s(),r(28,"input",192),W("ngModelChange",function(o){_(t);let a=m();return q(a.newModelDisplayName,o)||(a.newModelDisplayName=o),v(o)}),s()()(),r(29,"div",193)(30,"button",194),x("click",function(){_(t);let o=m();return v(o.showAddModel.set(!1))}),l(31," \u53D6\u6D88 "),s(),r(32,"button",195),x("click",function(){_(t);let o=m();return v(o.saveNewModel())}),l(33," \u6DFB\u52A0 "),s()()()()}if(i&2){let t=m();c(9),U(t.providers),c(5),H("ngModel",t.newModelName),c(3),U(t.currentPresetModels()),c(7),H("ngModel",t.newModelApiKey),c(4),H("ngModel",t.newModelDisplayName)}}function iP(i,e){i&1&&(r(0,"span",114),l(1,"\u27F3"),s(),l(2," \u6B63\u5728\u6E2C\u8A66\u9023\u63A5... "))}function oP(i,e){i&1&&l(0," \u{1F517} \u6E2C\u8A66\u9023\u63A5 ")}function rP(i,e){if(i&1){let t=I();r(0,"div",19)(1,"div",198)(2,"h3",199),l(3," \u{1F999} \u6DFB\u52A0\u672C\u5730 AI "),s(),r(4,"p",200),l(5,"\u914D\u7F6E Ollama \u6216\u5176\u4ED6\u672C\u5730 AI \u670D\u52D9"),s(),r(6,"div",92)(7,"div")(8,"label",55),l(9,"API \u7AEF\u9EDE *"),s(),r(10,"input",201),W("ngModelChange",function(o){_(t);let a=m();return q(a.localModelEndpoint,o)||(a.localModelEndpoint=o),v(o)}),s(),r(11,"p",116),l(12," \u{1F4A1} \u4F7F\u7528 Tailscale Funnel \u53EF\u5BE6\u73FE\u9060\u7A0B\u8A2A\u554F\u672C\u5730 Ollama "),s()(),r(13,"div")(14,"label",55),l(15,"\u6A21\u578B\u540D\u7A31 *"),s(),r(16,"input",202),W("ngModelChange",function(o){_(t);let a=m();return q(a.localModelName,o)||(a.localModelName=o),v(o)}),s(),r(17,"p",116),l(18," \u5728 Ollama \u4E2D\u904B\u884C "),r(19,"code",203),l(20,"ollama list"),s(),l(21," \u67E5\u770B\u53EF\u7528\u6A21\u578B "),s()(),r(22,"div")(23,"label",55),l(24,"\u986F\u793A\u540D\u7A31 (\u53EF\u9078)"),s(),r(25,"input",204),W("ngModelChange",function(o){_(t);let a=m();return q(a.localModelDisplayName,o)||(a.localModelDisplayName=o),v(o)}),s()(),r(26,"button",205),x("click",function(){_(t);let o=m();return v(o.testLocalConnection())}),y(27,iP,3,0)(28,oP,1,0),s()(),r(29,"div",193)(30,"button",194),x("click",function(){_(t);let o=m();return v(o.showAddLocalModel.set(!1))}),l(31," \u53D6\u6D88 "),s(),r(32,"button",206),x("click",function(){_(t);let o=m();return v(o.saveLocalModel())}),l(33," \u4FDD\u5B58 "),s()()()()}if(i&2){let t=m();c(10),H("ngModel",t.localModelEndpoint),c(6),H("ngModel",t.localModelName),c(9),H("ngModel",t.localModelDisplayName),c(),L("disabled",t.isTestingLocal()),c(),S(t.isTestingLocal()?27:28)}}var Tc=class i{constructor(){this.aiService=F(Mt);this.dialogService=F(st);this.toastService=F(J);this.ipcService=F(Q);this.activeTab=f("models");this.showAddModel=f(!1);this.autoChatEnabled=f(!1);this.autoChatMode=f("full");this.autoGreetingEnabled=f(!0);this.autoReplyEnabled=f(!0);this.senderAccounts=f([]);this.autonomousModeEnabled=f(!1);this.smartSystemStats=f({memories:0,tags:0,emotions:0,workflows:0,followups:0,knowledge:0});this.newModelProvider=f("openai");this.newModelName="";this.newModelApiKey="";this.newModelEndpoint="";this.newModelDisplayName="";this.showAddLocalModel=f(!1);this.localModelEndpoint="https://ms-defysomwqybz.tail05a567.ts.net/api/chat";this.localModelName="huihui_ai/qwen2.5-abliterate";this.localModelDisplayName="\u6211\u7684\u672C\u5730 AI";this.isTestingLocal=f(!1);this.ttsEnabled=!1;this.ttsEndpoint="http://localhost:9881";this.ttsConnected=f(!1);this.isTestingTts=f(!1);this.ttsLatency=f(0);this.isSavingUsage=f(!1);this.usageSaved=f(!1);this.usageSaveTimeout=null;this.strategyDirty=f(!1);this.strategySaved=f(!1);this.isSavingStrategy=f(!1);this.customPersona=f("");this.originalStrategy=null;this.tabs=[{id:"quick",icon:"\u{1F680}",label:"\u5F15\u64CE\u6982\u89BD"},{id:"models",icon:"\u{1F916}",label:"\u6A21\u578B\u914D\u7F6E"},{id:"persona",icon:"\u{1F3AD}",label:"\u4EBA\u683C\u98A8\u683C"},{id:"stats",icon:"\u{1F4CA}",label:"\u4F7F\u7528\u7D71\u8A08"}];this.providers=[{id:"openai",name:"OpenAI",icon:"\u{1F7E2}"},{id:"claude",name:"Claude",icon:"\u{1F7E3}"},{id:"gemini",name:"Gemini",icon:"\u{1F535}"}];this.presetModels={openai:[{name:"gpt-4o",displayName:"GPT-4o (\u63A8\u85A6)"},{name:"gpt-4o-mini",displayName:"GPT-4o Mini (\u7D93\u6FDF)"},{name:"gpt-4-turbo",displayName:"GPT-4 Turbo"},{name:"gpt-3.5-turbo",displayName:"GPT-3.5 Turbo (\u5FEB\u901F)"}],claude:[{name:"claude-3-5-sonnet-latest",displayName:"Claude 3.5 Sonnet (\u63A8\u85A6)"},{name:"claude-3-opus-latest",displayName:"Claude 3 Opus (\u5F37\u5927)"},{name:"claude-3-haiku-20240307",displayName:"Claude 3 Haiku (\u5FEB\u901F)"}],gemini:[{name:"gemini-1.5-flash-latest",displayName:"Gemini 1.5 Flash (\u63A8\u85A6)"},{name:"gemini-1.5-pro-latest",displayName:"Gemini 1.5 Pro (\u5F37\u5927)"},{name:"gemini-2.0-flash-exp",displayName:"Gemini 2.0 Flash (\u5BE6\u9A57)"}]};this.currentPresetModels=R(()=>this.presetModels[this.newModelProvider()]||[]);this.localModels=this.aiService.localModels;this.cloudModels=this.aiService.cloudModels;this.conversationStyles=[{id:"professional",icon:"\u{1F454}",label:"\u5C08\u696D\u6B63\u5F0F"},{id:"friendly",icon:"\u{1F60A}",label:"\u53CB\u597D\u89AA\u5207"},{id:"casual",icon:"\u{1F60E}",label:"\u8F15\u9B06\u5E7D\u9ED8"},{id:"direct",icon:"\u{1F3AF}",label:"\u76F4\u63A5\u7C21\u6F54"}];this.industryTemplates=[{id:"payment",name:"\u{1F4B3} \u8DE8\u5883\u652F\u4ED8",description:"U\u514C\u63DB\u3001\u4EE3\u6536\u4EE3\u4ED8\u3001\u532F\u6B3E\u670D\u52D9"},{id:"ecommerce",name:"\u{1F6D2} \u96FB\u5546\u96F6\u552E",description:"\u5546\u54C1\u92B7\u552E\u3001\u8A02\u55AE\u67E5\u8A62\u3001\u552E\u5F8C\u670D\u52D9"},{id:"education",name:"\u{1F4D6} \u5728\u7DDA\u6559\u80B2",description:"\u8AB2\u7A0B\u8AEE\u8A62\u3001\u5B78\u7FD2\u8F14\u5C0E\u3001\u5831\u540D\u6D41\u7A0B"},{id:"realestate",name:"\u{1F3E0} \u623F\u7522\u4E2D\u4ECB",description:"\u623F\u6E90\u63A8\u85A6\u3001\u770B\u623F\u9810\u7D04\u3001\u4EA4\u6613\u6D41\u7A0B"},{id:"finance",name:"\u{1F4B0} \u91D1\u878D\u7406\u8CA1",description:"\u6295\u8CC7\u8AEE\u8A62\u3001\u98A8\u96AA\u8A55\u4F30\u3001\u7522\u54C1\u4ECB\u7D39"},{id:"healthcare",name:"\u{1F3E5} \u91AB\u7642\u5065\u5EB7",description:"\u9810\u7D04\u639B\u865F\u3001\u5065\u5EB7\u8AEE\u8A62\u3001\u7528\u85E5\u6307\u5C0E"},{id:"travel",name:"\u2708\uFE0F \u65C5\u904A\u670D\u52D9",description:"\u884C\u7A0B\u898F\u5283\u3001\u8A02\u7968\u9152\u5E97\u3001\u5C0E\u904A\u670D\u52D9"},{id:"legal",name:"\u2696\uFE0F \u6CD5\u5F8B\u8AEE\u8A62",description:"\u6CD5\u5F8B\u554F\u7B54\u3001\u6848\u4EF6\u8AEE\u8A62\u3001\u6587\u66F8\u670D\u52D9"}];this.knowledgeStats=R(()=>{let e=this.knowledgeBases(),t=e.reduce((d,u)=>d+u.items.length,0),n={};e.forEach(d=>{d.items.forEach(u=>{n[u.category]=(n[u.category]||0)+1})});let o=Object.entries(n).sort(([,d],[,u])=>u-d)[0]?.[0]||"-",a={product:"\u7522\u54C1",faq:"\u554F\u7B54",sales:"\u8A71\u8853",objection:"\u7570\u8B70",custom:"\u5176\u4ED6"};return{totalItems:t,usedCount:Math.floor(t*.7),hitRate:t>0?68:0,topCategory:a[o]||o}});this.defaultRules=[{id:"purchase",icon:"\u{1F6D2}",name:"\u8CFC\u8CB7\u610F\u5411\u660E\u78BA \u2192 \u901A\u77E5\u4EBA\u5DE5",description:"\u7576\u8B58\u5225\u5230\u8CFC\u8CB7\u610F\u5411\u6642\u7ACB\u5373\u901A\u77E5",isActive:!0},{id:"no-response",icon:"\u23F0",name:"\u9023\u7E8C3\u6B21\u4E0D\u56DE\u8986 \u2192 \u66AB\u505C",description:"\u66AB\u505C\u5C0D\u8A71\uFF0C3\u5929\u5F8C\u518D\u8DDF\u9032",isActive:!0},{id:"negative",icon:"\u{1F614}",name:"\u8CA0\u9762\u60C5\u7DD2 \u2192 \u8F49\u4EBA\u5DE5",description:"\u6AA2\u6E2C\u5230\u8CA0\u9762\u60C5\u7DD2\u6642\u8F49\u4EBA\u5DE5\u8655\u7406",isActive:!0},{id:"price",icon:"\u{1F4B0}",name:"\u50F9\u683C\u654F\u611F \u2192 \u63A8\u9001\u512A\u60E0",description:"\u8A62\u554F\u50F9\u683C\u6642\u63A8\u9001\u512A\u60E0\u65B9\u6848",isActive:!1}];this.personaTemplates=[{id:"friendly",icon:"\u{1F60A}",name:"\u53CB\u597D\u52A9\u624B",description:"\u89AA\u5207\u3001\u8010\u5FC3\u3001\u6A02\u65BC\u52A9\u4EBA",prompt:"\u4F60\u662F\u4E00\u4F4D\u53CB\u597D\u7684\u5BA2\u670D\u52A9\u624B\uFF0C\u8AAA\u8A71\u89AA\u5207\u6EAB\u6696\uFF0C\u6A02\u65BC\u5E6B\u52A9\u5BA2\u6236\u89E3\u6C7A\u554F\u984C\u3002"},{id:"professional",icon:"\u{1F454}",name:"\u5C08\u696D\u9867\u554F",description:"\u5C08\u696D\u3001\u56B4\u8B39\u3001\u503C\u5F97\u4FE1\u8CF4",prompt:"\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684\u92B7\u552E\u9867\u554F\uFF0C\u5177\u6709\u8C50\u5BCC\u7684\u884C\u696D\u7D93\u9A57\uFF0C\u56DE\u7B54\u554F\u984C\u5C08\u696D\u56B4\u8B39\u3002"},{id:"enthusiastic",icon:"\u{1F389}",name:"\u71B1\u60C5\u92B7\u552E",description:"\u7A4D\u6975\u3001\u71B1\u60C5\u3001\u5584\u65BC\u63A8\u85A6",prompt:"\u4F60\u662F\u4E00\u4F4D\u5145\u6EFF\u71B1\u60C5\u7684\u92B7\u552E\u4EE3\u8868\uFF0C\u5584\u65BC\u767C\u73FE\u5BA2\u6236\u9700\u6C42\u4E26\u7A4D\u6975\u63A8\u85A6\u5408\u9069\u7684\u7522\u54C1\u3002"},{id:"efficient",icon:"\u26A1",name:"\u9AD8\u6548\u7C21\u6F54",description:"\u76F4\u63A5\u3001\u7C21\u6F54\u3001\u6548\u7387\u512A\u5148",prompt:"\u4F60\u662F\u4E00\u4F4D\u9AD8\u6548\u7684\u5BA2\u670D\uFF0C\u56DE\u7B54\u554F\u984C\u76F4\u63A5\u660E\u4E86\uFF0C\u4E0D\u7E5E\u5F4E\u5B50\uFF0C\u7BC0\u7701\u5BA2\u6236\u6642\u9593\u3002"}];this.selectedPersonaTemplate=f("friendly");this.previewResponse=f("\u60A8\u597D\u5440\uFF01\u611F\u8B1D\u60A8\u7684\u8AEE\u8A62 \u{1F60A} \u6211\u5011\u7684\u670D\u52D9\u50F9\u683C\u6839\u64DA\u60A8\u7684\u5177\u9AD4\u9700\u6C42\u800C\u5B9A\uFF0C\u8ACB\u554F\u60A8\u4E3B\u8981\u60F3\u4E86\u89E3\u54EA\u65B9\u9762\u7684\u670D\u52D9\u5462\uFF1F");this.knowledgeBases=R(()=>this.aiService.knowledgeBases());this.activeKbId=R(()=>this.aiService.activeKnowledgeBaseId());this.currentStyle=R(()=>this.aiService.strategy().style);this.responseLength=R(()=>this.aiService.strategy().responseLength);this.useEmoji=R(()=>this.aiService.strategy().useEmoji)}getProviderIcon(e){return this.providers.find(t=>t.id===e)?.icon||"\u{1F916}"}getProviderName(e){return this.providers.find(t=>t.id===e)?.name||e}testModel(e){this.aiService.testModelConnection(e.id)}editModel(e){}saveNewModel(){!this.newModelName||!this.newModelApiKey||(this.aiService.addModel({provider:this.newModelProvider(),modelName:this.newModelName,apiKey:this.newModelApiKey,apiEndpoint:this.newModelEndpoint||void 0,displayName:this.newModelDisplayName||this.newModelName}),this.showAddModel.set(!1),this.newModelName="",this.newModelApiKey="",this.newModelEndpoint="",this.newModelDisplayName="")}saveLocalModel(){if(!this.localModelEndpoint||!this.localModelName){alert("\u8ACB\u586B\u5BEB API \u7AEF\u9EDE\u548C\u6A21\u578B\u540D\u7A31");return}this.aiService.addLocalModel({modelName:this.localModelName,displayName:this.localModelDisplayName||this.localModelName,apiEndpoint:this.localModelEndpoint,isDefault:this.aiService.models().length===0}),this.showAddLocalModel.set(!1),this.localModelDisplayName="\u6211\u7684\u672C\u5730 AI"}async testLocalConnection(){if(!this.localModelEndpoint||!this.localModelName){alert("\u8ACB\u5148\u586B\u5BEB API \u7AEF\u9EDE\u548C\u6A21\u578B\u540D\u7A31");return}this.isTestingLocal.set(!0),await this.aiService.testLocalAIConnection(this.localModelEndpoint,this.localModelName),setTimeout(()=>this.isTestingLocal.set(!1),3e3)}saveTtsSettings(){this.ipcService.send("save-ai-settings",{ttsEndpoint:this.ttsEndpoint,ttsEnabled:this.ttsEnabled}),this.toastService.success("TTS \u8A2D\u7F6E\u5DF2\u4FDD\u5B58")}async testTtsConnection(){if(!this.ttsEndpoint){this.toastService.error("\u8ACB\u5148\u586B\u5BEB TTS \u670D\u52D9\u7AEF\u9EDE");return}this.isTestingTts.set(!0);let e=Date.now(),t=n=>{this.isTestingTts.set(!1),n.success?(this.ttsConnected.set(!0),this.ttsLatency.set(Date.now()-e),this.toastService.success("\u2713 TTS \u670D\u52D9\u9023\u63A5\u6210\u529F\uFF01")):(this.ttsConnected.set(!1),this.toastService.error(`TTS \u9023\u63A5\u5931\u6557: ${n.error||"\u672A\u77E5\u932F\u8AA4"}`))};this.ipcService.once("tts-test-result",t),this.ipcService.send("test-tts-service",{endpoint:this.ttsEndpoint}),setTimeout(()=>{this.isTestingTts()&&(this.isTestingTts.set(!1),this.toastService.error("TTS \u6E2C\u8A66\u8D85\u6642"))},15e3)}testTtsVoice(){let e=t=>{t.success&&t.audio?new Audio(`data:audio/wav;base64,${t.audio}`).play().catch(o=>{this.toastService.error(`\u64AD\u653E\u5931\u6557: ${o.message}`)}):this.toastService.error(`\u8A9E\u97F3\u751F\u6210\u5931\u6557: ${t.error||"\u672A\u77E5\u932F\u8AA4"}`)};this.ipcService.once("tts-result",e),this.ipcService.send("text-to-speech",{endpoint:this.ttsEndpoint,text:"\u4F60\u597D\uFF0C\u9019\u662F\u4E00\u6BB5\u8A9E\u97F3\u6E2C\u8A66\u3002",voice:""}),this.toastService.info("\u6B63\u5728\u751F\u6210\u8A66\u807D\u8A9E\u97F3...")}onModelUsageChange(e,t){let o=t.target.value;this.aiService.updateModelUsage({[e]:o}),this.isSavingUsage.set(!0),this.usageSaved.set(!1),this.usageSaveTimeout&&clearTimeout(this.usageSaveTimeout),this.usageSaveTimeout=setTimeout(async()=>{await this.aiService.saveModelUsageToBackend(),this.isSavingUsage.set(!1),this.usageSaved.set(!0),setTimeout(()=>this.usageSaved.set(!1),3e3)},300)}deleteModel(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u578B\u300C${e.displayName||e.modelName}\u300D\u55CE\uFF1F`)&&this.aiService.removeModel(e.id)}setAsDefault(e){this.aiService.setDefaultModel(e.id)}addKnowledgeBase(){this.dialogService.prompt({title:"\u65B0\u5EFA\u77E5\u8B58\u5EAB",message:"\u8ACB\u8F38\u5165\u77E5\u8B58\u5EAB\u540D\u7A31\uFF0C\u7528\u65BC\u7D44\u7E54\u548C\u7BA1\u7406 AI \u56DE\u8986\u7684\u696D\u52D9\u77E5\u8B58\u3002",placeholder:"\u4F8B\u5982\uFF1A\u7522\u54C1\u77E5\u8B58\u5EAB\u3001\u5E38\u898B\u554F\u7B54",confirmText:"\u5275\u5EFA",cancelText:"\u53D6\u6D88",validator:e=>e.trim()?e.length>50?"\u540D\u7A31\u4E0D\u80FD\u8D85\u904E 50 \u500B\u5B57\u7B26":null:"\u8ACB\u8F38\u5165\u540D\u7A31",onConfirm:e=>{this.aiService.addKnowledgeBase(e)}})}setActiveKb(e){this.aiService.setActiveKnowledgeBase(e)}editKb(e){this.dialogService.prompt({title:"\u7DE8\u8F2F\u77E5\u8B58\u5EAB",message:"\u4FEE\u6539\u77E5\u8B58\u5EAB\u540D\u7A31",placeholder:"\u8ACB\u8F38\u5165\u65B0\u540D\u7A31",defaultValue:e.name,confirmText:"\u4FDD\u5B58",cancelText:"\u53D6\u6D88",validator:t=>t.trim()?t.length>50?"\u540D\u7A31\u4E0D\u80FD\u8D85\u904E 50 \u500B\u5B57\u7B26":null:"\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A",onConfirm:t=>{this.aiService.updateKnowledgeBase(e.id,{name:t}),this.toastService.success(`\u77E5\u8B58\u5EAB\u5DF2\u66F4\u65B0\u70BA\u300C${t}\u300D`)}})}deleteKb(e){this.dialogService.confirm({title:"\u78BA\u8A8D\u522A\u9664",message:`\u78BA\u5B9A\u8981\u522A\u9664\u77E5\u8B58\u5EAB\u300C${e.name}\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,confirmText:"\u522A\u9664",cancelText:"\u53D6\u6D88",type:"danger",onConfirm:()=>{this.aiService.deleteKnowledgeBase(e.id),this.toastService.success(`\u77E5\u8B58\u5EAB\u300C${e.name}\u300D\u5DF2\u522A\u9664`)}})}deleteKnowledgeItem(e,t){this.dialogService.confirm({title:"\u78BA\u8A8D\u522A\u9664",message:"\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u77E5\u8B58\u689D\u76EE\u55CE\uFF1F",confirmText:"\u522A\u9664",cancelText:"\u53D6\u6D88",type:"danger",onConfirm:()=>{this.aiService.deleteKnowledgeItem(e,t),this.toastService.success("\u77E5\u8B58\u689D\u76EE\u5DF2\u522A\u9664")}})}addQuickContent(e){let n={product:{title:"\u6DFB\u52A0\u7522\u54C1\u77E5\u8B58",placeholder:"\u4F8B\u5982\uFF1A\u6211\u5011\u7684\u7522\u54C1\u652F\u6301 24 \u5C0F\u6642\u5BA2\u670D...",icon:"\u{1F4E6}"},faq:{title:"\u6DFB\u52A0\u5E38\u898B\u554F\u7B54",placeholder:"\u4F8B\u5982\uFF1AQ: \u5982\u4F55\u4ED8\u6B3E\uFF1FA: \u652F\u6301\u5FAE\u4FE1\u3001\u652F\u4ED8\u5BF6...",icon:"\u2753"},sales:{title:"\u6DFB\u52A0\u92B7\u552E\u8A71\u8853",placeholder:"\u4F8B\u5982\uFF1A\u7576\u5BA2\u6236\u8AAA\u592A\u8CB4\u6642\uFF0C\u53EF\u4EE5\u56DE\u8986...",icon:"\u{1F3AF}"},objection:{title:"\u6DFB\u52A0\u7570\u8B70\u8655\u7406",placeholder:"\u4F8B\u5982\uFF1A\u5BA2\u6236\u64D4\u5FC3\u8CEA\u91CF\u6642\uFF0C\u5F37\u8ABF\u552E\u5F8C\u4FDD\u969C...",icon:"\u{1F4AC}"}}[e],o=this.activeKbId();if(!o){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.prompt({title:`${n.icon} ${n.title}`,message:"\u8F38\u5165\u77E5\u8B58\u5167\u5BB9\uFF0CAI \u5C07\u5728\u56DE\u8986\u6642\u53C3\u8003\u9019\u4E9B\u4FE1\u606F\u3002",placeholder:n.placeholder,inputType:"textarea",confirmText:"\u6DFB\u52A0",cancelText:"\u53D6\u6D88",validator:a=>a.trim()?a.length>2e3?"\u5167\u5BB9\u4E0D\u80FD\u8D85\u904E 2000 \u500B\u5B57\u7B26":null:"\u8ACB\u8F38\u5165\u5167\u5BB9",onConfirm:a=>{this.aiService.addKnowledgeItem(o,{title:`${n.icon} ${e.toUpperCase()}`,content:a,category:e}),this.toastService.success("\u77E5\u8B58\u5167\u5BB9\u5DF2\u6DFB\u52A0")}})}openAIGenerateDialog(){let e=this.activeKbId();if(!e){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.prompt({title:"\u{1F916} AI \u81EA\u52D5\u751F\u6210\u77E5\u8B58\u5EAB",message:"\u8ACB\u7C21\u55AE\u63CF\u8FF0\u60A8\u7684\u696D\u52D9\uFF081-3 \u53E5\u8A71\uFF09\uFF0CAI \u5C07\u81EA\u52D5\u751F\u6210\u7522\u54C1\u77E5\u8B58\u3001\u5E38\u898B\u554F\u7B54\u3001\u92B7\u552E\u8A71\u8853\u7B49\u5167\u5BB9\u3002",placeholder:"\u4F8B\u5982\uFF1A\u6211\u5011\u662F\u505A\u8DE8\u5883\u652F\u4ED8\u7684\uFF0C\u4E3B\u8981\u670D\u52D9\u662F U \u514C\u63DB\u548C\u4EE3\u6536\u4EE3\u4ED8\uFF0C\u652F\u6301\u5FAE\u4FE1\u3001\u652F\u4ED8\u5BF6\u6536\u6B3E",inputType:"textarea",confirmText:"\u958B\u59CB\u751F\u6210",cancelText:"\u53D6\u6D88",validator:t=>t.trim()?t.length<10?"\u63CF\u8FF0\u592A\u77ED\uFF0C\u8ACB\u63D0\u4F9B\u66F4\u591A\u4FE1\u606F":t.length>500?"\u63CF\u8FF0\u4E0D\u80FD\u8D85\u904E 500 \u500B\u5B57\u7B26":null:"\u8ACB\u8F38\u5165\u696D\u52D9\u63CF\u8FF0",onConfirm:t=>{this.generateKnowledgeWithAI(e,t)}})}async generateKnowledgeWithAI(e,t){this.toastService.info("\u{1F916} AI \u6B63\u5728\u751F\u6210\u77E5\u8B58\u5EAB\uFF0C\u8ACB\u7A0D\u5019..."),this.aiService.generateKnowledgeBase(e,t)}openBatchImportDialog(){let e=this.activeKbId();if(!e){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.prompt({title:"\u{1F4CB} \u6279\u91CF\u5C0E\u5165\u77E5\u8B58",message:`\u8ACB\u8CBC\u4E0A\u60A8\u7684\u77E5\u8B58\u5167\u5BB9\uFF0C\u652F\u6301\u4EE5\u4E0B\u683C\u5F0F\uFF1A
\u2022 \u6BCF\u884C\u4E00\u689D\u77E5\u8B58
\u2022 Q: \u554F\u984C / A: \u7B54\u6848 \u683C\u5F0F
\u2022 \u3010\u7522\u54C1\u77E5\u8B58\u3011\u3010\u5E38\u898B\u554F\u7B54\u3011\u7B49\u5206\u985E\u6A19\u7C64`,placeholder:`\u793A\u4F8B\uFF1A
\u3010\u7522\u54C1\u77E5\u8B58\u3011
\u6211\u5011\u7684\u670D\u52D9\u652F\u6301 24 \u5C0F\u6642\u5728\u7DDA\u5BA2\u670D
\u6700\u4F4E\u514C\u63DB\u91D1\u984D 100U\uFF0C\u6700\u9AD8\u7121\u9650\u5236

\u3010\u5E38\u898B\u554F\u7B54\u3011
Q: \u591A\u4E45\u5230\u8CEC\uFF1F
A: \u901A\u5E38 5-30 \u5206\u9418\u5230\u8CEC

Q: \u652F\u6301\u54EA\u4E9B\u4ED8\u6B3E\u65B9\u5F0F\uFF1F
A: \u652F\u6301\u5FAE\u4FE1\u3001\u652F\u4ED8\u5BF6\u3001\u9280\u884C\u5361`,inputType:"textarea",confirmText:"\u5C0E\u5165",cancelText:"\u53D6\u6D88",validator:t=>t.trim()?t.length<10?"\u5167\u5BB9\u592A\u77ED":null:"\u8ACB\u8F38\u5165\u8981\u5C0E\u5165\u7684\u5167\u5BB9",onConfirm:t=>{this.importBatchKnowledge(e,t)}})}importBatchKnowledge(e,t){let n=this.parseBatchContent(t);if(n.length===0){this.toastService.error("\u7121\u6CD5\u8B58\u5225\u77E5\u8B58\u5167\u5BB9\uFF0C\u8ACB\u6AA2\u67E5\u683C\u5F0F");return}n.forEach(o=>{this.aiService.addKnowledgeItem(e,o)}),this.toastService.success(`\u6210\u529F\u5C0E\u5165 ${n.length} \u689D\u77E5\u8B58`)}parseBatchContent(e){let t=[],n=e.split(`
`).map(d=>d.trim()).filter(d=>d),o="custom",a="";for(let d=0;d<n.length;d++){let u=n[d];if(u.match(/|/)){o="product";continue}else if(u.match(/||FAQ/i)){o="faq";continue}else if(u.match(/|/)){o="sales";continue}else if(u.match(/|/)){o="objection";continue}if(u.match(/^Q[:]/i)){a=u.replace(/^Q[:]\s*/i,"");continue}else if(u.match(/^A[:]/i)&&a){let p=u.replace(/^A[:]\s*/i,"");t.push({title:`Q: ${a}`,content:`A: ${p}`,category:"faq"}),a="";continue}u.length>5&&!u.startsWith("#")&&!u.startsWith("//")&&t.push({title:u.substring(0,30)+(u.length>30?"...":""),content:u,category:o})}return t}openTemplateSelector(){let e=this.activeKbId();if(!e){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}let t=this.industryTemplates.map(n=>`${n.name}
  ${n.description}`).join(`

`);this.dialogService.prompt({title:"\u{1F4DA} \u9078\u64C7\u884C\u696D\u6A21\u677F",message:`\u9078\u64C7\u4E00\u500B\u884C\u696D\u6A21\u677F\uFF0C\u7CFB\u7D71\u5C07\u81EA\u52D5\u751F\u6210\u5C0D\u61C9\u7684\u77E5\u8B58\u5EAB\u5167\u5BB9\uFF1A

\u53EF\u9078\u6A21\u677F\uFF1A
${this.industryTemplates.map(n=>n.name).join("\u3001")}`,placeholder:"\u8F38\u5165\u6A21\u677F\u540D\u7A31\uFF0C\u5982\uFF1A\u8DE8\u5883\u652F\u4ED8\u3001\u96FB\u5546\u96F6\u552E",confirmText:"\u4F7F\u7528\u6A21\u677F",cancelText:"\u53D6\u6D88",validator:n=>this.industryTemplates.find(a=>a.name.includes(n)||a.id===n.toLowerCase())?null:"\u8ACB\u8F38\u5165\u6709\u6548\u7684\u6A21\u677F\u540D\u7A31",onConfirm:n=>{let o=this.industryTemplates.find(a=>a.name.includes(n)||a.id===n.toLowerCase());o&&this.applyIndustryTemplate(e,o.id)}})}applyIndustryTemplate(e,t){this.toastService.info("\u6B63\u5728\u61C9\u7528\u884C\u696D\u6A21\u677F..."),this.aiService.applyIndustryTemplate(e,t)}learnFromChatHistory(){let e=this.activeKbId();if(!e){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u77E5\u8B58\u5EAB");return}this.dialogService.confirm({title:"\u{1F4AC} \u5F9E\u804A\u5929\u8A18\u9304\u5B78\u7FD2",message:`\u7CFB\u7D71\u5C07\u5206\u6790\u8FD1 7 \u5929\u7684\u804A\u5929\u8A18\u9304\uFF0C\u81EA\u52D5\u63D0\u53D6\u512A\u8CEA\u56DE\u8986\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB\u3002

\u6B64\u904E\u7A0B\u53EF\u80FD\u9700\u8981\u5E7E\u5206\u9418\uFF0C\u662F\u5426\u7E7C\u7E8C\uFF1F`,confirmText:"\u958B\u59CB\u5B78\u7FD2",cancelText:"\u53D6\u6D88",onConfirm:()=>{this.toastService.info("\u6B63\u5728\u5206\u6790\u804A\u5929\u8A18\u9304..."),this.aiService.learnFromChatHistory(e)}})}exportKnowledgeBase(){let e=this.knowledgeBases().find(n=>n.id===this.activeKbId());if(!e){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u77E5\u8B58\u5EAB");return}if(e.items.length===0){this.toastService.warning("\u77E5\u8B58\u5EAB\u70BA\u7A7A\uFF0C\u7121\u6CD5\u5C0E\u51FA");return}let t=this.generateExportContent(e);navigator.clipboard.writeText(t).then(()=>{this.toastService.success(`\u5DF2\u8907\u88FD ${e.items.length} \u689D\u77E5\u8B58\u5230\u526A\u8CBC\u677F`)}).catch(()=>{this.dialogService.prompt({title:"\u{1F4E4} \u5C0E\u51FA\u77E5\u8B58\u5EAB",message:"\u8ACB\u8907\u88FD\u4EE5\u4E0B\u5167\u5BB9\uFF1A",defaultValue:t,inputType:"textarea",confirmText:"\u95DC\u9589",cancelText:""})})}generateExportContent(e){let t=[`# \u77E5\u8B58\u5EAB: ${e.name}`,`# \u5C0E\u51FA\u6642\u9593: ${new Date().toLocaleString()}`,`# \u689D\u76EE\u6578\u91CF: ${e.items.length}`,""],n=["product","faq","sales","objection","custom"],o={product:"\u3010\u7522\u54C1\u77E5\u8B58\u3011",faq:"\u3010\u5E38\u898B\u554F\u7B54\u3011",sales:"\u3010\u92B7\u552E\u8A71\u8853\u3011",objection:"\u3010\u7570\u8B70\u8655\u7406\u3011",custom:"\u3010\u5176\u4ED6\u3011"};return n.forEach(a=>{let d=e.items.filter(u=>u.category===a);d.length>0&&(t.push(o[a]||`\u3010${a}\u3011`),d.forEach(u=>{a==="faq"&&t.push(u.title),t.push(u.content),t.push("")}))}),t.join(`
`)}setStyle(e){this.aiService.updateConversationStrategy({style:e})}setResponseLength(e){this.aiService.updateConversationStrategy({responseLength:e})}toggleEmoji(){this.aiService.updateConversationStrategy({useEmoji:!this.useEmoji()})}onPersonaInput(e){let t=e.target;this.customPersona.set(t.value),this.markStrategyDirty()}markStrategyDirty(){this.strategyDirty.set(!0),this.strategySaved.set(!1),this.saveStrategyToLocalStorage()}saveStrategyToLocalStorage(){let e={style:this.currentStyle(),responseLength:this.responseLength(),useEmoji:this.useEmoji(),customPersona:this.customPersona()};localStorage.setItem("ai_strategy_draft",JSON.stringify(e))}loadStrategyFromLocalStorage(){let e=localStorage.getItem("ai_strategy_draft");if(e)try{let n=JSON.parse(e);n.customPersona&&this.customPersona.set(n.customPersona),this.strategyDirty.set(!0)}catch(n){console.error("\u8F09\u5165\u7B56\u7565\u8349\u7A3F\u5931\u6557:",n)}let t=localStorage.getItem("ai_strategy_saved");if(t)try{let n=JSON.parse(t);this.originalStrategy=n,n.customPersona&&!e&&this.customPersona.set(n.customPersona),this.aiService.updateConversationStrategy(n)}catch(n){console.error("\u8F09\u5165\u7B56\u7565\u8A2D\u5B9A\u5931\u6557:",n)}}async saveStrategySettings(){this.isSavingStrategy.set(!0);let e={style:this.currentStyle(),responseLength:this.responseLength(),useEmoji:this.useEmoji(),customPersona:this.customPersona()};try{await this.aiService.saveConversationStrategyToBackend(e),localStorage.setItem("ai_strategy_saved",JSON.stringify(e)),localStorage.removeItem("ai_strategy_draft"),this.strategyDirty.set(!1),this.strategySaved.set(!0),this.originalStrategy=e,setTimeout(()=>this.strategySaved.set(!1),3e3)}catch(t){console.error("\u4FDD\u5B58\u7B56\u7565\u5931\u6557:",t),alert("\u4FDD\u5B58\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}finally{this.isSavingStrategy.set(!1)}}resetStrategy(){this.originalStrategy?(this.aiService.updateConversationStrategy(this.originalStrategy),this.customPersona.set(this.originalStrategy.customPersona||"")):(this.aiService.updateConversationStrategy({style:"friendly",responseLength:"medium",useEmoji:!0}),this.customPersona.set("")),localStorage.removeItem("ai_strategy_draft"),this.strategyDirty.set(!1)}toggleAutoChat(){this.autoChatEnabled.update(e=>!e),this.saveQuickSettings(!1)}toggleAutonomousMode(){let e=!this.autonomousModeEnabled();this.autonomousModeEnabled.set(e),localStorage.setItem("ai_autonomous_mode",String(e)),window.electronAPI?.send&&window.electronAPI.send("set-autonomous-mode",{enabled:e}),this.toastService.success(e?"\u{1F9E0} AI \u81EA\u4E3B\u6A21\u5F0F\u5DF2\u555F\u7528":"AI \u81EA\u4E3B\u6A21\u5F0F\u5DF2\u95DC\u9589"),e&&this.refreshSmartSystemStats()}goToSmartMarketing(){window.electronAPI?.send&&window.electronAPI.send("navigate-to",{path:"/smart-marketing"}),window.location.hash="#/smart-marketing"}refreshSmartSystemStats(){window.electronAPI?.send&&window.electronAPI.send("get-smart-system-stats",{});let e=t=>{let n=t.detail||{};this.smartSystemStats.set({memories:n.memories||0,tags:n.tags||0,emotions:n.emotions||0,workflows:n.workflows||0,followups:n.followups||0,knowledge:n.knowledge||0})};window.addEventListener("smart-system-stats",e,{once:!0}),this.toastService.success("\u6B63\u5728\u5237\u65B0\u7D71\u8A08...")}setAutoChatMode(e){this.autoChatMode.set(e),this.saveQuickSettings(!1)}toggleAutoGreeting(){this.autoGreetingEnabled.update(e=>!e),this.saveQuickSettings(!1)}toggleAutoReply(){this.autoReplyEnabled.update(e=>!e),this.saveQuickSettings(!1)}saveQuickSettings(e=!0){let t={auto_chat_enabled:this.autoChatEnabled()?1:0,auto_chat_mode:this.autoChatMode(),auto_greeting:this.autoGreetingEnabled()?1:0,auto_reply:this.autoReplyEnabled()?1:0};localStorage.setItem("ai_auto_chat_enabled",String(this.autoChatEnabled())),localStorage.setItem("ai_auto_chat_mode",this.autoChatMode()),localStorage.setItem("ai_auto_greeting",String(this.autoGreetingEnabled())),localStorage.setItem("ai_auto_reply",String(this.autoReplyEnabled())),window.dispatchEvent(new CustomEvent("save-ai-settings",{detail:t})),e&&alert("\u8A2D\u7F6E\u5DF2\u4FDD\u5B58\uFF01")}loadQuickSettings(){let e=localStorage.getItem("ai_auto_chat_enabled"),t=localStorage.getItem("ai_auto_chat_mode"),n=localStorage.getItem("ai_auto_greeting"),o=localStorage.getItem("ai_auto_reply"),a=localStorage.getItem("ai_autonomous_mode");e!==null&&this.autoChatEnabled.set(e==="true"),t&&this.autoChatMode.set(t),n!==null&&this.autoGreetingEnabled.set(n==="true"),o!==null&&this.autoReplyEnabled.set(o==="true"),a!==null&&this.autonomousModeEnabled.set(a==="true")}ngOnInit(){this.loadQuickSettings(),this.loadSenderAccounts(),this.loadStrategyFromLocalStorage()}loadSenderAccounts(){window.dispatchEvent(new CustomEvent("get-sender-accounts")),window.addEventListener("sender-accounts-loaded",(e=>{let t=e.detail||[];this.senderAccounts.set(t)}),{once:!0})}selectPersonaTemplate(e){this.selectedPersonaTemplate.set(e);let t=this.personaTemplates.find(n=>n.id===e);t&&(this.customPersona.set(t.prompt),this.markStrategyDirty(),this.updatePreviewForPersona(e))}updatePreviewForPersona(e){let t={friendly:"\u60A8\u597D\u5440\uFF01\u611F\u8B1D\u60A8\u7684\u8AEE\u8A62 \u{1F60A} \u6211\u5011\u7684\u670D\u52D9\u50F9\u683C\u6839\u64DA\u60A8\u7684\u5177\u9AD4\u9700\u6C42\u800C\u5B9A\uFF0C\u8ACB\u554F\u60A8\u4E3B\u8981\u60F3\u4E86\u89E3\u54EA\u65B9\u9762\u7684\u670D\u52D9\u5462\uFF1F",professional:"\u611F\u8B1D\u60A8\u7684\u5782\u8A62\u3002\u6211\u5011\u63D0\u4F9B\u591A\u7A2E\u670D\u52D9\u65B9\u6848\uFF0C\u50F9\u683C\u5340\u9593\u5F9E\u57FA\u790E\u7248\u5230\u4F01\u696D\u7248\u4E0D\u7B49\u3002\u8ACB\u554F\u60A8\u7684\u5177\u9AD4\u9700\u6C42\u662F\u4EC0\u9EBC\uFF1F\u6211\u53EF\u4EE5\u70BA\u60A8\u63A8\u85A6\u6700\u5408\u9069\u7684\u65B9\u6848\u3002",enthusiastic:"\u592A\u597D\u4E86\uFF01\u611F\u8B1D\u60A8\u5C0D\u6211\u5011\u670D\u52D9\u7684\u95DC\u6CE8\uFF01\u{1F389} \u6211\u5011\u6709\u8D85\u503C\u7684\u512A\u60E0\u5957\u9910\u7B49\u8457\u60A8\uFF01\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0C\u6211\u53EF\u4EE5\u70BA\u60A8\u91CF\u8EAB\u5B9A\u5236\u6700\u5212\u7B97\u7684\u65B9\u6848\uFF01",efficient:"\u60A8\u597D\u3002\u50F9\u683C\u8996\u9700\u6C42\u800C\u5B9A\u3002\u8ACB\u8AAA\u660E\u5177\u9AD4\u9700\u6C42\uFF0C\u6211\u70BA\u60A8\u5831\u50F9\u3002"};this.previewResponse.set(t[e]||t.friendly)}toggleRule(e){let t=this.defaultRules.find(n=>n.id===e);t&&(t.isActive=!t.isActive,this.markStrategyDirty())}getPersonaName(){return this.personaTemplates.find(t=>t.id===this.selectedPersonaTemplate())?.name||"\u53CB\u597D\u52A9\u624B"}getPreviewResponse(){return this.previewResponse()}regeneratePreview(){this.toastService.info("\u6B63\u5728\u751F\u6210\u9810\u89BD...");let e=["\u60A8\u597D\uFF01\u611F\u8B1D\u8AEE\u8A62\uFF0C\u6211\u5011\u7684\u50F9\u683C\u975E\u5E38\u6709\u7AF6\u722D\u529B\uFF0C\u5177\u9AD4\u8981\u770B\u60A8\u7684\u9700\u6C42\u54E6\uFF5E","\u89AA\uFF0C\u6211\u5011\u7684\u670D\u52D9\u6027\u50F9\u6BD4\u8D85\u9AD8\uFF01\u60A8\u60F3\u4E86\u89E3\u54EA\u500B\u5957\u9910\u5462\uFF1F","\u611F\u8B1D\u60A8\u7684\u95DC\u6CE8\uFF01\u6211\u5011\u6709\u591A\u7A2E\u50F9\u4F4D\u53EF\u9078\uFF0C\u6211\u5E6B\u60A8\u8A73\u7D30\u4ECB\u7D39\u4E00\u4E0B\uFF1F"],t=e[Math.floor(Math.random()*e.length)];this.previewResponse.set(t)}async savePersonaSettings(){await this.saveStrategySettings();let e=this.defaultRules.map(t=>({id:t.id,isActive:t.isActive}));localStorage.setItem("ai_rules_state",JSON.stringify(e)),this.toastService.success("AI \u4EBA\u683C\u8A2D\u5B9A\u5DF2\u4FDD\u5B58")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-center"]],decls:38,vars:7,consts:[[1,"ai-center","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-2","px-3","py-1","bg-emerald-500/20","text-emerald-400","rounded-full","text-sm"],[1,"px-3","py-1","bg-yellow-500/20","text-yellow-400","rounded-full","text-sm"],[1,"flex","items-center","gap-6","px-4","py-2","bg-slate-800/80","rounded-xl","border","border-slate-700/50"],[1,"text-center"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-xs","text-slate-500"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-purple-400"],[1,"flex","gap-1","mt-4","bg-slate-800/50","p-1","rounded-xl","w-fit"],[1,"px-5","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"bg-gradient-to-r","from-purple-500","to-pink-500","text-white","shadow-lg","text-slate-400","hover:text-white","hover:bg-slate-700/50"],[1,"flex-1","overflow-y-auto","p-4"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"w-2","h-2","bg-emerald-500","rounded-full"],[1,"px-5","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"click"],[1,"text-lg"],[1,"bg-gradient-to-br","from-purple-500/20","to-pink-500/20","rounded-2xl","border","border-purple-500/30","p-6"],[1,"w-14","h-14","rounded-xl","bg-purple-500/30","flex","items-center","justify-center","text-3xl"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","text-sm"],[1,"relative","w-16","h-8","rounded-full","transition-all",3,"click"],[1,"absolute","top-1","left-1","w-6","h-6","bg-white","rounded-full","shadow","transition-transform"],[1,"mt-6","pt-6","border-t","border-purple-500/30","space-y-4"],[1,"bg-gradient-to-br","from-cyan-500/20","to-purple-500/20","rounded-2xl","border","border-cyan-500/30","p-6"],[1,"w-14","h-14","rounded-xl","bg-gradient-to-br","from-cyan-500/30","to-purple-500/30","flex","items-center","justify-center","text-3xl"],[1,"text-xl","font-bold","text-white","flex","items-center","gap-2"],[1,"px-2","py-0.5","text-xs","bg-purple-500/30","text-purple-400","rounded-full"],[1,"px-6","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-all","shadow-lg","flex","items-center","gap-2",3,"click"],[1,"mt-6","pt-6","border-t","border-cyan-500/30"],[1,"grid","grid-cols-4","gap-3","text-center"],[1,"p-3","bg-slate-800/50","rounded-xl"],[1,"text-xl","mb-1"],[1,"text-xs","font-medium","text-white"],[1,"text-xs","text-cyan-400","mt-4","text-center"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-6"],[1,"flex","items-center","gap-3","mb-4"],[1,"font-semibold","text-white"],[1,"text-sm","text-slate-400"],[1,"space-y-2"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg"],[1,"text-center","py-8","text-slate-400"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","text-sm",3,"click"],[1,"flex","items-center","gap-4","p-4","bg-emerald-500/10","border","border-emerald-500/30","rounded-xl"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"flex","justify-end"],[1,"px-6","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:from-purple-400","hover:to-pink-400","transition-all","shadow-lg",3,"click"],[1,"text-sm","text-slate-400","block","mb-2"],[1,"grid","grid-cols-3","gap-3"],[1,"p-4","rounded-xl","border","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400"],[1,"grid","grid-cols-2","gap-4"],[1,"flex","items-center","justify-between","p-4","bg-slate-700/50","rounded-xl"],[1,"text-xl"],["type","checkbox",1,"w-5","h-5","rounded","bg-slate-600","border-slate-500",3,"change","checked"],[1,"w-10","h-10","rounded-full","bg-cyan-500/20","flex","items-center","justify-center","overflow-hidden"],["alt","Avatar",1,"w-full","h-full","object-cover",3,"src"],[1,"text-cyan-400"],[1,"flex","items-center","gap-1","text-emerald-400","text-sm"],[1,"text-3xl","mb-2"],[1,"text-sm","text-slate-500"],[1,"w-12","h-12","rounded-xl","bg-emerald-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1"],[1,"flex","items-center","gap-1","text-emerald-400"],[1,"font-medium","text-amber-400"],[1,"bg-gradient-to-br","from-emerald-500/10","to-cyan-500/10","rounded-xl","border","border-emerald-500/30","p-6"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded-full"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30","transition-colors",3,"click"],[1,"space-y-3"],[1,"flex","items-center","justify-between","p-4","bg-slate-800/50","rounded-xl"],[1,"text-center","py-6","text-slate-400"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"flex","items-center","justify-between","p-4","bg-slate-700/50","rounded-xl","hover:bg-slate-700","transition-colors"],[1,"mt-6","pt-6","border-t","border-slate-700/50"],[1,"bg-gradient-to-br","from-purple-500/10","to-pink-500/10","rounded-xl","border","border-purple-500/30","p-6"],[1,"px-2","py-0.5","bg-purple-500/20","text-purple-400","text-xs","rounded-full"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","change","ngModel"],[1,"w-11","h-6","bg-slate-600","peer-focus:outline-none","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-purple-500"],[1,"ms-3","text-sm","font-medium","text-slate-300"],[1,"text-sm","text-slate-400","mb-4"],[1,"space-y-4"],[1,"text-center","py-4","text-slate-400"],[1,"w-12","h-12","rounded-xl","bg-emerald-500/20","flex","items-center","justify-center"],[1,"text-xs","text-slate-400","truncate","max-w-xs"],[1,"text-amber-400","text-sm"],[1,"px-3","py-1","bg-slate-600","text-slate-300","rounded-lg","text-sm","hover:bg-slate-500","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-1",3,"click","disabled"],[1,"px-3","py-1","text-sm","rounded-lg","transition-colors",3,"click"],[1,"text-red-400","hover:text-red-300","p-1",3,"click"],[1,"inline-block","w-3","h-3","border-2","border-slate-400","border-t-transparent","rounded-full","animate-spin"],[1,"text-sm","mb-3"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30",3,"click"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center"],[1,"text-slate-500","text-sm"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30",3,"click"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-emerald-400","flex","items-center","gap-1"],[1,"grid","grid-cols-3","gap-4"],[1,"text-xs","text-slate-400","block","mb-2"],[1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"change","value"],["value",""],[3,"value","selected"],[1,"text-xs","text-slate-500","mt-3"],[1,"animate-spin"],["type","text","placeholder","http://localhost:9881",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1"],[1,"flex","gap-3"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors","disabled:opacity-50","flex","items-center","gap-2",3,"click","disabled"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30","transition-colors","flex","items-center","gap-2"],[1,"flex","items-center","gap-2","text-emerald-400","text-sm"],[1,"inline-block","w-4","h-4","border-2","border-purple-400","border-t-transparent","rounded-full","animate-spin"],[1,"px-4","py-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-slate-500"],[1,"text-sm"],[1,"flex","items-center","justify-between","mb-6"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors"],[1,"grid","grid-cols-4","gap-4"],[1,"p-5","rounded-xl","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700/50","hover:bg-slate-700"],[1,"font-semibold","text-white","mb-6","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-6"],[1,"grid","grid-cols-2","gap-3"],[1,"p-4","rounded-xl","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700/50"],[1,"flex","gap-2"],[1,"flex-1","py-2","px-4","rounded-lg","text-sm","transition-colors",3,"bg-purple-500","text-white","bg-slate-700","text-slate-300"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","cursor-pointer",3,"click"],[1,"text-white","text-sm"],["type","checkbox",1,"w-5","h-5","rounded","text-purple-500","bg-slate-700","border-slate-600","pointer-events-none",3,"checked"],["rows","6","placeholder","\u4F8B\u5982\uFF1A\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684\u92B7\u552E\u9867\u554F\uFF0C\u5177\u67095\u5E74\u884C\u696D\u7D93\u9A57\uFF0C\u64C5\u9577\u89E3\u7B54\u5BA2\u6236\u7591\u554F...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none",3,"input","value"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-xs","text-slate-500","font-normal"],[1,"flex","items-center","justify-between","p-4","bg-slate-700/50","rounded-xl","cursor-pointer","hover:bg-slate-700","transition-colors"],[1,"mt-4","w-full","py-3","border","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","hover:border-purple-500","transition-colors"],[1,"bg-gradient-to-r","from-purple-900/30","to-blue-900/30","rounded-xl","border","border-purple-500/30","p-6"],[1,"font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"bg-slate-900/50","rounded-xl","p-4"],[1,"mb-3"],[1,"text-slate-300"],[1,"border-t","border-slate-700","pt-3"],[1,"text-xs","text-purple-400"],[1,"text-white"],[1,"mt-3","px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"flex","justify-between","items-center","bg-slate-800/80","rounded-xl","p-4","border","border-slate-700/50","sticky","bottom-4"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-lg","transition-all","shadow-lg","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"p-5","rounded-xl","text-center","transition-all","border-2",3,"click"],[1,"font-medium"],[1,"text-xs","text-slate-400","mt-1"],[1,"p-4","rounded-xl","text-center","transition-all","border-2",3,"click"],[1,"text-sm","font-medium"],[1,"flex-1","py-2","px-4","rounded-lg","text-sm","transition-colors",3,"click"],["type","checkbox",1,"w-5","h-5","rounded","text-purple-500","bg-slate-700","border-slate-600","cursor-pointer",3,"change","checked"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"text-3xl","font-bold","text-cyan-400"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"text-3xl","font-bold","text-purple-400"],[1,"text-3xl","font-bold","text-orange-400"],[1,"font-semibold","text-white","mb-4"],[1,"text-4xl","font-bold","text-white","mb-1"],[1,"text-slate-400"],[1,"text-4xl","font-bold","text-emerald-400","mb-1"],[1,"bg-gradient-to-br","from-cyan-500/10","to-purple-500/10","rounded-xl","border","border-cyan-500/30","p-6"],[1,"px-2","py-0.5","text-xs","bg-emerald-500/30","text-emerald-400","rounded-full"],[1,"px-2","py-0.5","text-xs","bg-slate-500/30","text-slate-400","rounded-full"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","text-sm","flex","items-center","gap-2",3,"click"],[1,"bg-slate-800/50","rounded-lg","p-4"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-2xl","font-bold","text-amber-400"],[1,"text-2xl","font-bold","text-blue-400"],[1,"mt-4","pt-4","border-t","border-slate-700/50"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors",3,"click"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-md","p-6","shadow-xl","border","border-slate-700"],[1,"text-xl","font-bold","text-white","mb-6"],[1,"grid","grid-cols-3","gap-2"],[1,"p-3","rounded-lg","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700"],[1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"ngModelChange","ngModel"],[3,"value"],["type","password","placeholder","sk-...",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],["type","text","placeholder","\u5982 \u6211\u7684 GPT-4",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-2.5","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors",3,"click"],[1,"p-3","rounded-lg","text-center","transition-all","border-2",3,"click"],[1,"text-xs"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-lg","p-6","shadow-xl","border","border-emerald-500/30"],[1,"text-xl","font-bold","text-white","mb-2","flex","items-center","gap-2"],[1,"text-slate-400","text-sm","mb-6"],["type","text","placeholder","https://your-ollama.ts.net/api/chat",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],["type","text","placeholder","qwen2.5, llama3.2, mistral",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"text-emerald-400"],["type","text","placeholder","\u6211\u7684\u672C\u5730 AI",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"w-full","py-2.5","bg-cyan-500/20","text-cyan-400","rounded-lg","hover:bg-cyan-500/30","transition-colors","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"flex-1","py-2.5","bg-emerald-500","text-white","rounded-lg","hover:bg-emerald-400","transition-colors",3,"click"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u2699\uFE0F"),s(),l(7," \u667A\u80FD\u5F15\u64CE\u8A2D\u7F6E "),s(),r(8,"div",6),y(9,r9,3,0,"span",7)(10,s9,2,0,"span",8),s()(),r(11,"div",3)(12,"div",9)(13,"div",10)(14,"div",11),l(15),s(),r(16,"div",12),l(17,"\u4ECA\u65E5\u5C0D\u8A71"),s()(),r(18,"div",10)(19,"div",13),l(20),s(),r(21,"div",12),l(22,"\u8F49\u5316\u7387"),s()(),r(23,"div",10)(24,"div",14),l(25),s(),r(26,"div",12),l(27,"\u4ECA\u65E5\u6210\u672C"),s()()()()(),r(28,"div",15),O(29,a9,5,18,"button",16,Wn),s()(),r(31,"div",17),y(32,h9,84,9,"div",18)(33,G9,45,6,"div",18)(34,Q9,83,8,"div",18)(35,Z9,113,13,"div",18),s(),y(36,nP,34,3,"div",19),y(37,rP,34,5,"div",19),s()),t&2){let o;c(9),S(n.aiService.isConnected()?9:10),c(6),D(n.aiService.stats().today.conversations),c(5),M("",(n.aiService.stats().weekly.conversionRate*100).toFixed(1),"%"),c(5),M("\xA5",n.aiService.stats().today.cost.toFixed(2)),c(4),U(n.tabs),c(3),S((o=n.activeTab())==="quick"?32:o==="models"?33:o==="persona"?34:o==="stats"?35:-1),c(4),S(n.showAddModel()?36:-1),c(),S(n.showAddLocalModel()?37:-1)}},dependencies:[oe,ae,Re,Ne,xe,it,Ge,ve,he],encapsulation:2})}};var kc=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.membershipService=F(Ie);this.aiService=F(oo);this.activeTab=f("config")}ngOnInit(){let t=new URLSearchParams(window.location.search).get("tab");t&&this.activeTab.set(t),this.aiService.loadSettings()}t(e,t){return this.i18n.t(e,t)}navigateTo(e){this.nav.navigateTo(e)}setActiveTab(e){this.activeTab.set(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-center-view"]],decls:1,vars:0,consts:[[3,"tabChange","navigate"]],template:function(t,n){t&1&&(r(0,"app-ai-center",0),x("tabChange",function(a){return n.setActiveTab(a)})("navigate",function(a){return n.navigateTo(a)}),s())},dependencies:[oe,ae,Tc],encapsulation:2,changeDetection:0})}};var Tt={expert:{icon:"\u{1F468}\u200D\u{1F4BC}",label:"\u7522\u54C1\u5C08\u5BB6",description:"\u5C08\u696D\u7684\u7522\u54C1\u9867\u554F\uFF0C\u8A73\u7D30\u89E3\u7B54\u554F\u984C",defaultStyle:"professional",defaultPrompt:"\u4F60\u662F\u4E00\u4F4D\u8CC7\u6DF1\u7522\u54C1\u5C08\u5BB6\uFF0C\u67095\u5E74\u884C\u696D\u7D93\u9A57\u3002\u4F60\u7684\u7279\u9EDE\u662F\u5C08\u696D\u3001\u8010\u5FC3\u3001\u5584\u65BC\u7528\u6848\u4F8B\u8AAA\u660E\u554F\u984C\u3002"},satisfied_customer:{icon:"\u{1F60A}",label:"\u6EFF\u610F\u8001\u5BA2\u6236",description:"\u771F\u8AA0\u5206\u4EAB\u4F7F\u7528\u9AD4\u9A57\u7684\u8001\u5BA2\u6236",defaultStyle:"friendly",defaultPrompt:"\u4F60\u662F\u4E00\u4F4D\u4F7F\u7528\u7522\u54C1\u534A\u5E74\u7684\u6EFF\u610F\u5BA2\u6236\u3002\u4F60\u6703\u771F\u8AA0\u5206\u4EAB\u81EA\u5DF1\u7684\u4F7F\u7528\u9AD4\u9A57\uFF0C\u89E3\u7B54\u65B0\u4EBA\u7591\u616E\u3002"},support:{icon:"\u{1F469}\u200D\u{1F4BB}",label:"\u5BA2\u670D\u52A9\u7406",description:"\u71B1\u60C5\u7684\u5BA2\u670D\uFF0C\u8655\u7406\u8A02\u55AE\u552E\u5F8C",defaultStyle:"enthusiastic",defaultPrompt:"\u4F60\u662F\u4E00\u4F4D\u71B1\u60C5\u7684\u5BA2\u670D\u52A9\u7406\u3002\u4F60\u5FEB\u901F\u97FF\u61C9\u3001\u89E3\u6C7A\u554F\u984C\uFF0C\u8655\u7406\u8A02\u55AE\u548C\u552E\u5F8C\u652F\u6301\u3002"},manager:{icon:"\u{1F454}",label:"\u7D93\u7406",description:"\u6709\u6C7A\u7B56\u6B0A\u7684\u7BA1\u7406\u4EBA\u54E1",defaultStyle:"professional",defaultPrompt:"\u4F60\u662F\u7522\u54C1\u7D93\u7406\uFF0C\u6709\u4E00\u5B9A\u6C7A\u7B56\u6B0A\u3002\u4F60\u53EF\u4EE5\u7D66\u4E88\u7279\u5225\u512A\u60E0\u6216\u505A\u51FA\u627F\u8AFE\u3002"},newbie:{icon:"\u{1F64B}",label:"\u597D\u5947\u65B0\u4EBA",description:"\u5C0D\u7522\u54C1\u611F\u8208\u8DA3\u7684\u65B0\u7528\u6236",defaultStyle:"curious",defaultPrompt:"\u4F60\u662F\u4E00\u500B\u5C0D\u7522\u54C1\u611F\u8208\u8DA3\u7684\u65B0\u4EBA\uFF0C\u6703\u554F\u4E00\u4E9B\u57FA\u790E\u554F\u984C\uFF0C\u5F15\u5C0E\u5C08\u5BB6\u89E3\u7B54\u3002"},hesitant:{icon:"\u{1F914}",label:"\u7336\u8C6B\u8005",description:"\u6709\u9867\u616E\u4F46\u88AB\u8AAA\u670D\u7684\u7528\u6236",defaultStyle:"careful",defaultPrompt:"\u4F60\u4E00\u958B\u59CB\u6709\u9867\u616E\uFF0C\u4F46\u88AB\u5C08\u5BB6\u548C\u8001\u5BA2\u6236\u8AAA\u670D\u5F8C\u6C7A\u5B9A\u8CFC\u8CB7\uFF0C\u5206\u4EAB\u4F60\u88AB\u8AAA\u670D\u7684\u904E\u7A0B\u3002"},custom:{icon:"\u{1F3AD}",label:"\u81EA\u5B9A\u7FA9\u89D2\u8272",description:"\u6839\u64DA\u9700\u8981\u81EA\u5B9A\u7FA9\u7684\u89D2\u8272",defaultStyle:"friendly",defaultPrompt:""}},Dm={roles:[],scripts:[],autoGroupSettings:{enabled:!0,nameTemplate:"VIP\u5C08\u5C6C\u670D\u52D9\u7FA4 - {\u5BA2\u6236\u540D}",inviteMessageTemplate:"\u70BA\u4E86\u66F4\u597D\u5730\u670D\u52D9\u60A8\uFF0C\u6211\u5011\u7279\u5225\u5EFA\u7ACB\u4E86VIP\u7FA4\uFF0C\u6709\u5C08\u5BB6\u548C\u8001\u7528\u6236\u53EF\u4EE5\u89E3\u7B54\u60A8\u7684\u554F\u984C\uFF01",maxConcurrentGroups:5,autoCloseAfterDays:7},defaultTriggerConditions:{intentScoreThreshold:70,minConversationRounds:3,requirePriceInquiry:!1},aiSettings:{useAICenter:!0,coordinationMode:"sequential",maxAIResponseTime:30}};var Ic=[{id:"gemini",name:"Google Gemini",icon:"\u2728",description:"\u8C37\u6B4C\u6700\u65B0 AI \u6A21\u578B\uFF0C\u5FEB\u901F\u4E14\u591A\u8A9E\u8A00\u652F\u6301",requiresApiKey:!0,baseUrl:"https://generativelanguage.googleapis.com/v1beta",models:[{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",description:"\u5F37\u5927\u7684\u591A\u6A21\u614B\u6A21\u578B",contextLength:2e6,pricePerMToken:3.5,capabilities:["text","vision","code","reasoning"]},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash",description:"\u5FEB\u901F\u9AD8\u6548\u7684\u8F15\u91CF\u6A21\u578B",contextLength:1e6,pricePerMToken:.075,capabilities:["text","vision","code"]},{id:"gemini-2.0-flash-exp",name:"Gemini 2.0 Flash (\u5BE6\u9A57)",description:"\u6700\u65B0\u5BE6\u9A57\u7248\u672C",contextLength:1e6,pricePerMToken:0,capabilities:["text","vision","code","reasoning"]}]},{id:"openai",name:"OpenAI",icon:"\u{1F916}",description:"ChatGPT \u80CC\u5F8C\u7684 AI \u6A21\u578B",requiresApiKey:!0,baseUrl:"https://api.openai.com/v1",models:[{id:"gpt-4o",name:"GPT-4o",description:"\u6700\u65B0\u65D7\u8266\u6A21\u578B",contextLength:128e3,pricePerMToken:5,capabilities:["text","vision","code","reasoning"]},{id:"gpt-4o-mini",name:"GPT-4o Mini",description:"\u7D93\u6FDF\u5BE6\u60E0\u7684\u5C0F\u578B\u6A21\u578B",contextLength:128e3,pricePerMToken:.15,capabilities:["text","vision","code"]},{id:"gpt-4-turbo",name:"GPT-4 Turbo",description:"\u9AD8\u6027\u80FD\u6A21\u578B",contextLength:128e3,pricePerMToken:10,capabilities:["text","vision","code","reasoning"]},{id:"o1-preview",name:"o1 Preview",description:"\u6DF1\u5EA6\u63A8\u7406\u6A21\u578B",contextLength:128e3,pricePerMToken:15,capabilities:["text","code","reasoning","math"]}]},{id:"claude",name:"Anthropic Claude",icon:"\u{1F9E0}",description:"\u5B89\u5168\u53EF\u9760\u7684 AI \u52A9\u624B",requiresApiKey:!0,baseUrl:"https://api.anthropic.com/v1",models:[{id:"claude-3-5-sonnet-20241022",name:"Claude 3.5 Sonnet",description:"\u6700\u4F73\u7D9C\u5408\u6027\u80FD",contextLength:2e5,pricePerMToken:3,capabilities:["text","vision","code","reasoning"]},{id:"claude-3-opus-20240229",name:"Claude 3 Opus",description:"\u6700\u5F37\u63A8\u7406\u80FD\u529B",contextLength:2e5,pricePerMToken:15,capabilities:["text","vision","code","reasoning"]},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku",description:"\u5FEB\u901F\u8F15\u91CF",contextLength:2e5,pricePerMToken:.25,capabilities:["text","vision","code"]}]},{id:"deepseek",name:"DeepSeek",icon:"\u{1F50D}",description:"\u9AD8\u6027\u50F9\u6BD4\u7684\u4E2D\u570B AI \u6A21\u578B",requiresApiKey:!0,baseUrl:"https://api.deepseek.com",models:[{id:"deepseek-chat",name:"DeepSeek Chat",description:"\u901A\u7528\u5C0D\u8A71\u6A21\u578B",contextLength:64e3,pricePerMToken:.14,capabilities:["text","code"]},{id:"deepseek-coder",name:"DeepSeek Coder",description:"\u5C08\u696D\u7DE8\u7A0B\u6A21\u578B",contextLength:64e3,pricePerMToken:.14,capabilities:["code","text"]}]},{id:"ollama",name:"Ollama (\u672C\u5730)",icon:"\u{1F999}",description:"\u672C\u5730\u904B\u884C\uFF0C\u5B8C\u5168\u96B1\u79C1",requiresApiKey:!1,baseUrl:"http://localhost:11434",models:[{id:"llama3.2",name:"Llama 3.2",description:"Meta \u6700\u65B0\u958B\u6E90\u6A21\u578B",contextLength:128e3,capabilities:["text","code"]},{id:"qwen2.5",name:"Qwen 2.5",description:"\u963F\u91CC\u901A\u7FA9\u5343\u554F",contextLength:128e3,capabilities:["text","code","reasoning"]},{id:"mistral",name:"Mistral",description:"\u6B50\u6D32\u958B\u6E90\u6A21\u578B",contextLength:32e3,capabilities:["text","code"]},{id:"codellama",name:"Code Llama",description:"\u5C08\u696D\u7DE8\u7A0B\u6A21\u578B",contextLength:16e3,capabilities:["code"]}]}],Ai=class i{constructor(){this._config=f({provider:"gemini",model:"gemini-1.5-flash",apiKey:"",temperature:.7,maxTokens:2048,topP:.9,systemPrompt:""});this.config=this._config.asReadonly();this._isConnected=f(!1);this.isConnected=this._isConnected.asReadonly();this._usage=f({totalTokens:0,totalCalls:0,totalCost:0});this.usage=this._usage.asReadonly();this.providers=Ic;this.currentProvider=R(()=>Ic.find(e=>e.id===this._config().provider));this.currentModel=R(()=>this.currentProvider()?.models.find(e=>e.id===this._config().model));this.availableModels=R(()=>this.currentProvider()?.models||[]);this.loadConfig()}setConfig(e){this._config.update(t=>E(E({},t),e)),this.saveConfig()}setProvider(e){let t=Ic.find(n=>n.id===e);t&&this.setConfig({provider:e,model:t.models[0]?.id||"",baseUrl:t.baseUrl})}setModel(e){this.setConfig({model:e})}async testConnection(){try{return(await this.chat([{role:"user",content:'Hello, please respond with "OK".'}])).content?(this._isConnected.set(!0),{success:!0,message:"\u9023\u63A5\u6210\u529F\uFF01"}):{success:!1,message:"\u7121\u97FF\u61C9"}}catch(e){return this._isConnected.set(!1),{success:!1,message:e.message||"\u9023\u63A5\u5931\u6557"}}}async chat(e,t){let n=E(E({},this._config()),t);if(!n.baseUrl||n.baseUrl.startsWith("/")){let o=Ic.find(a=>a.id===n.provider);o?.baseUrl&&(n.baseUrl=o.baseUrl,console.log(`[AIProvider] \u4F7F\u7528\u63D0\u4F9B\u5546\u9ED8\u8A8D baseUrl: ${n.baseUrl}`))}if(!n.baseUrl)throw new Error(`\u672A\u914D\u7F6E ${n.provider} \u7684 API \u7AEF\u9EDE`);if(n.provider!=="ollama"&&!n.apiKey)throw new Error(`\u672A\u914D\u7F6E ${n.provider} \u7684 API Key`);switch(console.log(`[AIProvider] \u8ABF\u7528 ${n.provider}/${n.model}, baseUrl: ${n.baseUrl}`),n.provider){case"gemini":return this.chatGemini(e,n);case"openai":return this.chatOpenAI(e,n);case"claude":return this.chatClaude(e,n);case"deepseek":return this.chatDeepSeek(e,n);case"ollama":return this.chatOllama(e,n);default:throw new Error(`Unsupported provider: ${n.provider}`)}}async*chatStream(e,t){let n=E(E({},this._config()),t),a=(await this.chat(e,t)).content.split("");for(let d of a)yield d,await new Promise(u=>setTimeout(u,20))}async chatGemini(e,t){let n=`${t.baseUrl}/models/${t.model}:generateContent?key=${t.apiKey}`;console.log(`[AIProvider] Gemini URL: ${n.replace(t.apiKey,"***")}`);let o=e.filter(C=>C.role!=="system").map(C=>({role:C.role==="user"?"user":"model",parts:[{text:C.content}]})),a=e.find(C=>C.role==="system"),d=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:o,systemInstruction:a?{parts:[{text:a.content}]}:void 0,generationConfig:{temperature:t.temperature,maxOutputTokens:t.maxTokens,topP:t.topP}})});if(!(d.headers.get("content-type")||"").includes("application/json")){let C=await d.text();throw console.error("[AIProvider] Gemini \u8FD4\u56DE\u975E JSON \u97FF\u61C9:",C.substring(0,200)),new Error(`Gemini API \u8FD4\u56DE\u932F\u8AA4\u683C\u5F0F (${d.status}): \u53EF\u80FD\u662F URL \u914D\u7F6E\u932F\u8AA4`)}if(!d.ok){let C=await d.json();throw new Error(C.error?.message||`Gemini API error: ${d.status}`)}let p=await d.json(),g=p.candidates?.[0]?.content?.parts?.[0]?.text||"";return this.updateUsage(p.usageMetadata?.promptTokenCount||0,p.usageMetadata?.candidatesTokenCount||0,t),{content:g,usage:{promptTokens:p.usageMetadata?.promptTokenCount||0,completionTokens:p.usageMetadata?.candidatesTokenCount||0,totalTokens:p.usageMetadata?.totalTokenCount||0},model:t.model,finishReason:p.candidates?.[0]?.finishReason||"stop"}}async chatOpenAI(e,t){let n=`${t.baseUrl}/chat/completions`;console.log(`[AIProvider] OpenAI URL: ${n}`);let o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},body:JSON.stringify({model:t.model,messages:e,temperature:t.temperature,max_tokens:t.maxTokens,top_p:t.topP})});if(!(o.headers.get("content-type")||"").includes("application/json")){let p=await o.text();throw console.error("[AIProvider] OpenAI \u8FD4\u56DE\u975E JSON \u97FF\u61C9:",p.substring(0,200)),new Error(`OpenAI API \u8FD4\u56DE\u932F\u8AA4\u683C\u5F0F (${o.status}): \u53EF\u80FD\u662F URL \u914D\u7F6E\u932F\u8AA4`)}if(!o.ok){let p=await o.json();throw new Error(p.error?.message||`OpenAI API error: ${o.status}`)}let d=await o.json(),u=d.choices?.[0]?.message?.content||"";return this.updateUsage(d.usage?.prompt_tokens||0,d.usage?.completion_tokens||0,t),{content:u,usage:{promptTokens:d.usage?.prompt_tokens||0,completionTokens:d.usage?.completion_tokens||0,totalTokens:d.usage?.total_tokens||0},model:t.model,finishReason:d.choices?.[0]?.finish_reason||"stop"}}async chatClaude(e,t){let n=`${t.baseUrl}/messages`;console.log(`[AIProvider] Claude URL: ${n}`);let o=e.find(C=>C.role==="system"),a=e.filter(C=>C.role!=="system"),d=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":t.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:t.model,max_tokens:t.maxTokens,system:o?.content,messages:a.map(C=>({role:C.role,content:C.content}))})});if(!(d.headers.get("content-type")||"").includes("application/json")){let C=await d.text();throw console.error("[AIProvider] Claude \u8FD4\u56DE\u975E JSON \u97FF\u61C9:",C.substring(0,200)),new Error(`Claude API \u8FD4\u56DE\u932F\u8AA4\u683C\u5F0F (${d.status}): \u53EF\u80FD\u662F URL \u914D\u7F6E\u932F\u8AA4`)}if(!d.ok){let C=await d.json();throw new Error(C.error?.message||`Claude API error: ${d.status}`)}let p=await d.json(),g=p.content?.[0]?.text||"";return this.updateUsage(p.usage?.input_tokens||0,p.usage?.output_tokens||0,t),{content:g,usage:{promptTokens:p.usage?.input_tokens||0,completionTokens:p.usage?.output_tokens||0,totalTokens:(p.usage?.input_tokens||0)+(p.usage?.output_tokens||0)},model:t.model,finishReason:p.stop_reason||"stop"}}async chatDeepSeek(e,t){let n=`${t.baseUrl}/chat/completions`;console.log(`[AIProvider] DeepSeek URL: ${n}`);let o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},body:JSON.stringify({model:t.model,messages:e,temperature:t.temperature,max_tokens:t.maxTokens,top_p:t.topP})});if(!(o.headers.get("content-type")||"").includes("application/json")){let p=await o.text();throw console.error("[AIProvider] DeepSeek \u8FD4\u56DE\u975E JSON \u97FF\u61C9:",p.substring(0,200)),new Error(`DeepSeek API \u8FD4\u56DE\u932F\u8AA4\u683C\u5F0F (${o.status}): \u53EF\u80FD\u662F URL \u914D\u7F6E\u932F\u8AA4`)}if(!o.ok){let p=await o.json();throw new Error(p.error?.message||`DeepSeek API error: ${o.status}`)}let d=await o.json(),u=d.choices?.[0]?.message?.content||"";return this.updateUsage(d.usage?.prompt_tokens||0,d.usage?.completion_tokens||0,t),{content:u,usage:{promptTokens:d.usage?.prompt_tokens||0,completionTokens:d.usage?.completion_tokens||0,totalTokens:d.usage?.total_tokens||0},model:t.model,finishReason:d.choices?.[0]?.finish_reason||"stop"}}async chatOllama(e,t){let n=`${t.baseUrl||"http://localhost:11434"}/api/chat`,o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t.model,messages:e,options:{temperature:t.temperature,num_predict:t.maxTokens,top_p:t.topP},stream:!1})});if(!o.ok)throw new Error("Ollama connection failed. Make sure Ollama is running.");let a=await o.json();return{content:a.message?.content||"",usage:{promptTokens:a.prompt_eval_count||0,completionTokens:a.eval_count||0,totalTokens:(a.prompt_eval_count||0)+(a.eval_count||0)},model:t.model,finishReason:"stop"}}updateUsage(e,t,n){let o=this.currentModel(),a=o?.pricePerMToken?(e+t)/1e6*o.pricePerMToken:0;this._usage.update(d=>({totalTokens:d.totalTokens+e+t,totalCalls:d.totalCalls+1,totalCost:d.totalCost+a}))}loadConfig(){try{let e=localStorage.getItem("tg-matrix-ai-config");e&&this._config.set(JSON.parse(e));let t=localStorage.getItem("tg-matrix-ai-usage");t&&this._usage.set(JSON.parse(t))}catch(e){console.error("Failed to load AI config:",e)}}saveConfig(){try{localStorage.setItem("tg-matrix-ai-config",JSON.stringify(this._config())),localStorage.setItem("tg-matrix-ai-usage",JSON.stringify(this._usage()))}catch(e){console.error("Failed to save AI config:",e)}}resetUsage(){this._usage.set({totalTokens:0,totalCalls:0,totalCost:0}),this.saveConfig()}estimateTokens(e){let t=(e.match(/[\u4e00-\u9fff]/g)||[]).length,n=e.length-t;return Math.ceil(t/1.5+n/4)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var sP=`\u4F60\u662F\u4E00\u500B\u5C08\u696D\u7684\u92B7\u552E\u610F\u5716\u5206\u6790\u5C08\u5BB6\u3002\u5206\u6790\u7528\u6236\u6D88\u606F\u4E26\u8B58\u5225\u5176\u610F\u5716\u3002

\u8ACB\u6309\u4EE5\u4E0B JSON \u683C\u5F0F\u56DE\u8986\uFF08\u4E0D\u8981\u5305\u542B\u4EFB\u4F55\u5176\u4ED6\u6587\u5B57\uFF09\uFF1A
{
  "intent": "\u610F\u5716\u985E\u578B",
  "confidence": 0.0-1.0,
  "subIntents": ["\u5B50\u610F\u57161", "\u5B50\u610F\u57162"],
  "keywords": ["\u95DC\u9375\u8A5E1", "\u95DC\u9375\u8A5E2"],
  "sentiment": "positive/neutral/negative",
  "urgency": "low/medium/high",
  "suggestedAction": "\u5EFA\u8B70\u7684\u4E0B\u4E00\u6B65\u52D5\u4F5C"
}

\u610F\u5716\u985E\u578B\u5FC5\u9808\u662F\u4EE5\u4E0B\u4E4B\u4E00\uFF1A
- purchase_intent: \u6709\u8CFC\u8CB7\u610F\u5411\uFF08\u8A62\u554F\u5982\u4F55\u8CFC\u8CB7\u3001\u4E0B\u55AE\u3001\u4ED8\u6B3E\u7B49\uFF09
- price_inquiry: \u8A62\u554F\u50F9\u683C\uFF08\u591A\u5C11\u9322\u3001\u8CBB\u7528\u3001\u512A\u60E0\u7B49\uFF09
- product_question: \u7522\u54C1\u554F\u984C\uFF08\u529F\u80FD\u3001\u7279\u6027\u3001\u4F7F\u7528\u65B9\u6CD5\u7B49\uFF09
- complaint: \u62B1\u6028\u6216\u4E0D\u6EFF
- general_chat: \u4E00\u822C\u804A\u5929
- negative_sentiment: \u8CA0\u9762\u60C5\u7DD2
- high_value: \u9AD8\u50F9\u503C\u5BA2\u6236\u4FE1\u865F
- urgent: \u7DCA\u6025\u9700\u6C42`,nr=class i{constructor(){this.aiProvider=F(Ai);this.conversations=f(new Map);this.cache=new Map;this.CACHE_TTL=6e4}async recognizeIntent(e,t,n=!0){let o=this.getCacheKey(e,t),a=this.cache.get(o);if(a&&Date.now()-a.timestamp<this.CACHE_TTL)return a.result;let d=[{role:"system",content:sP}];if(t&&n){let u=this.getContext(t);if(u&&u.messages.length>0){let p=u.messages.slice(-5);d.push({role:"user",content:`\u5C0D\u8A71\u6B77\u53F2\uFF1A
${p.map(g=>`[${g.role}]: ${g.content}`).join(`
`)}

\u8ACB\u5206\u6790\u6700\u65B0\u6D88\u606F\u7684\u610F\u5716\u3002`})}}d.push({role:"user",content:`\u7528\u6236\u6D88\u606F\uFF1A${e}`});try{let u=await this.aiProvider.chat(d,{temperature:.3,maxTokens:500}),p=this.parseIntentResponse(u.content,e);return this.cache.set(o,{result:p,timestamp:Date.now()}),t&&this.updateContext(t,e,"user",p),p}catch(u){return console.error("Intent recognition failed:",u),this.fallbackRecognition(e)}}parseIntentResponse(e,t){try{let n=e.match(/\{[\s\S]*\}/);if(n){let o=JSON.parse(n[0]);return{intent:this.validateIntent(o.intent),confidence:Math.min(1,Math.max(0,o.confidence||.5)),subIntents:o.subIntents||[],keywords:o.keywords||[],sentiment:o.sentiment||"neutral",urgency:o.urgency||"medium",suggestedAction:o.suggestedAction||"",rawAnalysis:e}}}catch(n){console.warn("Failed to parse intent response:",n)}return this.fallbackRecognition(t)}validateIntent(e){return["purchase_intent","price_inquiry","product_question","complaint","general_chat","negative_sentiment","high_value","urgent"].includes(e)?e:"general_chat"}fallbackRecognition(e){let t=e.toLowerCase(),n="general_chat",o=.5,a="neutral",d="medium",u=[],p=["\u8CFC\u8CB7","\u4E0B\u55AE","\u8CB7","\u600E\u9EBC\u8CB7","\u4ED8\u6B3E","\u8A02\u8CFC","buy","purchase","order"];p.some(G=>t.includes(G))&&(n="purchase_intent",o=.85,d="high",u.push(...p.filter(G=>t.includes(G))));let g=["\u50F9\u683C","\u591A\u5C11\u9322","\u8CBB\u7528","\u50F9\u9322","\u512A\u60E0","\u6298\u6263","price","cost","discount"];g.some(G=>t.includes(G))&&(n="price_inquiry",o=.8,u.push(...g.filter(G=>t.includes(G))));let C=["\u600E\u9EBC","\u5982\u4F55","\u4EC0\u9EBC","\u80FD\u4E0D\u80FD","\u53EF\u4EE5","\u529F\u80FD","how","what","can"];C.some(G=>t.includes(G))&&(n==="general_chat"&&(n="product_question",o=.7),u.push(...C.filter(G=>t.includes(G))));let w=["\u4E0D\u597D","\u5DEE","\u721B","\u9A19","\u5783\u573E","\u9000\u6B3E","bad","terrible","refund"];return w.some(G=>t.includes(G))&&(a="negative",w.filter(G=>t.includes(G)).length>=2&&(n="negative_sentiment",o=.8)),["\u597D","\u68D2","\u8B9A","\u8B1D\u8B1D","\u611F\u8B1D","great","thanks","good"].some(G=>t.includes(G))&&(a="positive"),["\u6025","\u99AC\u4E0A","\u7ACB\u523B","\u73FE\u5728","urgent","immediately","now","asap"].some(G=>t.includes(G))&&(d="high",n==="general_chat"&&(n="urgent",o=.75)),{intent:n,confidence:o,subIntents:[],keywords:u,sentiment:a,urgency:d,suggestedAction:this.getSuggestedAction(n)}}getSuggestedAction(e){return{purchase_intent:"\u63D0\u4F9B\u8CFC\u8CB7\u93C8\u63A5\u6216\u806F\u7E6B\u65B9\u5F0F\uFF0C\u6E96\u5099\u4FC3\u6210\u4EA4\u6613",price_inquiry:"\u63D0\u4F9B\u50F9\u683C\u4FE1\u606F\u548C\u512A\u60E0\u65B9\u6848",product_question:"\u8A73\u7D30\u89E3\u7B54\u7522\u54C1\u76F8\u95DC\u554F\u984C",complaint:"\u8868\u9054\u6B49\u610F\uFF0C\u4E86\u89E3\u5177\u9AD4\u554F\u984C\uFF0C\u63D0\u4F9B\u89E3\u6C7A\u65B9\u6848",general_chat:"\u53CB\u597D\u56DE\u61C9\uFF0C\u5617\u8A66\u5F15\u5C0E\u5230\u7522\u54C1\u8A71\u984C",negative_sentiment:"\u8F49\u4EBA\u5DE5\u8655\u7406\uFF0C\u907F\u514D\u81EA\u52D5\u56DE\u8986",high_value:"\u91CD\u9EDE\u8DDF\u9032\uFF0C\u63D0\u4F9BVIP\u670D\u52D9",urgent:"\u512A\u5148\u8655\u7406\uFF0C\u5FEB\u901F\u56DE\u61C9"}[e]||"\u7E7C\u7E8C\u5C0D\u8A71"}getCacheKey(e,t){return`${t||"anonymous"}_${e.substring(0,100)}`}getContext(e){return this.conversations().get(e)}createContext(e){let t={id:`conv_${Date.now()}`,userId:e,messages:[],currentStage:"initial",intentHistory:[],totalScore:0,createdAt:new Date,updatedAt:new Date};return this.conversations.update(n=>{let o=new Map(n);return o.set(e,t),o}),t}updateContext(e,t,n,o){let a=this.conversations().get(e);a||(a=this.createContext(e));let d={role:n,content:t,timestamp:new Date,intent:o};o&&n==="user"&&(a.intentHistory.push(o.intent),a.totalScore+=this.getIntentScore(o),a.currentStage=this.determineStage(a)),a.messages.push(d),a.updatedAt=new Date,this.conversations.update(u=>{let p=new Map(u);return p.set(e,E({},a)),p})}getIntentScore(e){let n={purchase_intent:30,price_inquiry:20,product_question:10,high_value:25,urgent:15,general_chat:5,complaint:-10,negative_sentiment:-20}[e.intent]||0;return Math.round(n*e.confidence)}determineStage(e){let{totalScore:t,intentHistory:n}=e;return n.includes("purchase_intent")?"closing":n.includes("price_inquiry")?"negotiating":t>=30||n.includes("high_value")?"interested":e.messages.length>2?"exploring":"initial"}clearContext(e){this.conversations.update(t=>{let n=new Map(t);return n.delete(e),n})}getIntentScore4User(e){return this.conversations().get(e)?.totalScore||0}shouldHandoffToHuman(e){let t=this.conversations().get(e);return t?!!(t.currentStage==="closing"||t.intentHistory.includes("negative_sentiment")||t.intentHistory.includes("complaint")||t.totalScore>=50):!1}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var aP=i=>{let e="";return i.rolePrompt?e+=i.rolePrompt+`

`:e+=`\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684\u92B7\u552E\u9867\u554F\uFF0C\u540D\u53EB${i.roleName||"\u5C0F\u52A9\u624B"}\u3002`,e+={professional:"\u4FDD\u6301\u5C08\u696D\u3001\u6B63\u5F0F\u7684\u8A9E\u8ABF\uFF0C\u4F7F\u7528\u884C\u696D\u8853\u8A9E\uFF0C\u6CE8\u91CD\u908F\u8F2F\u548C\u6578\u64DA\u3002",friendly:"\u4FDD\u6301\u53CB\u597D\u3001\u89AA\u5207\u7684\u8A9E\u8ABF\uFF0C\u50CF\u670B\u53CB\u4E00\u6A23\u4EA4\u6D41\uFF0C\u8B93\u5BA2\u6236\u611F\u5230\u8212\u9069\u3002",casual:"\u4F7F\u7528\u8F15\u9B06\u3001\u96A8\u610F\u7684\u8A9E\u8ABF\uFF0C\u53EF\u4EE5\u958B\u9069\u7576\u7684\u73A9\u7B11\uFF0C\u71DF\u9020\u8F15\u9B06\u6C1B\u570D\u3002",enthusiastic:"\u4FDD\u6301\u71B1\u60C5\u3001\u7A4D\u6975\u7684\u8A9E\u8ABF\uFF0C\u8868\u73FE\u51FA\u5C0D\u7522\u54C1\u548C\u5BA2\u6236\u7684\u71B1\u611B\u3002",direct:"\u76F4\u63A5\u3001\u7C21\u6F54\u5730\u56DE\u7B54\u554F\u984C\uFF0C\u4E0D\u7E5E\u5F4E\u5B50\uFF0C\u9AD8\u6548\u6E9D\u901A\u3002"}[i.style]+`

`,e+={short:"\u56DE\u8986\u8981\u7C21\u77ED\u7CBE\u7149\uFF0C\u901A\u5E381-2\u53E5\u8A71\u3002",medium:"\u56DE\u8986\u9069\u4E2D\uFF0C\u901A\u5E383-5\u53E5\u8A71\uFF0C\u5305\u542B\u5FC5\u8981\u7684\u4FE1\u606F\u3002",long:"\u53EF\u4EE5\u8A73\u7D30\u56DE\u8986\uFF0C\u5305\u542B\u5145\u5206\u7684\u89E3\u91CB\u548C\u4F8B\u5B50\u3002"}[i.responseLength]+`

`,i.emojiFrequency!=="none"?e+={low:"\u53EF\u4EE5\u5076\u723E\u4F7F\u7528\u8868\u60C5\u7B26\u865F\uFF0C\u4F46\u8981\u7BC0\u5236\u3002",medium:"\u9069\u7576\u4F7F\u7528\u8868\u60C5\u7B26\u865F\u4F86\u589E\u52A0\u89AA\u548C\u529B\u3002",high:"\u5927\u91CF\u4F7F\u7528\u8868\u60C5\u7B26\u865F\uFF0C\u8B93\u5C0D\u8A71\u66F4\u6D3B\u6F51\u3002"}[i.emojiFrequency]+`

`:e+=`\u4E0D\u8981\u4F7F\u7528\u4EFB\u4F55\u8868\u60C5\u7B26\u865F\u3002

`,i.businessContext&&(e+=`\u696D\u52D9\u80CC\u666F\uFF1A
${i.businessContext}

`),e+=`\u91CD\u8981\u898F\u5247\uFF1A
1. \u6C38\u9060\u4E0D\u8981\u8AAA\u81EA\u5DF1\u662F AI \u6216\u6A5F\u5668\u4EBA
2. \u4E0D\u8981\u4F7F\u7528 markdown \u683C\u5F0F
3. \u76F4\u63A5\u56DE\u8986\uFF0C\u4E0D\u8981\u52A0\u4EFB\u4F55\u524D\u7DB4\u5982"\u56DE\u8986\uFF1A"
4. \u5982\u679C\u4E0D\u78BA\u5B9A\uFF0C\u53EF\u4EE5\u8AAA"\u8B93\u6211\u78BA\u8A8D\u4E00\u4E0B"\u800C\u4E0D\u662F\u7DE8\u9020\u4FE1\u606F
5. \u4FDD\u6301\u5C0D\u8A71\u81EA\u7136\u6D41\u66A2`,e},ir=class i{constructor(){this.aiProvider=F(Ai);this.intentService=F(nr);this.aiCenter=F(Mt);this.stats=f({totalConversations:0,totalReplies:0,avgResponseTime:0,handoffCount:0,conversionCount:0});this.conversationStats=this.stats.asReadonly()}async generateReply(e,t){let n=Date.now(),o=await this.intentService.recognizeIntent(e,t.userId,!0),a=await this.checkSmartRules(o,t.userId),d=this.checkHandoff(o,a,t.userId),u=this.aiCenter.strategy(),p="",g=!1;if(t.useKnowledgeBase!==!1){let Z=this.aiCenter.activeKnowledgeBase();Z&&(p=this.buildKnowledgeContext(Z,e,o),g=p.length>0)}let w=[{role:"system",content:aP({style:t.styleOverride||u.style,roleName:t.roleName,rolePrompt:t.rolePrompt,businessContext:p,emojiFrequency:u.emojiFrequency,responseLength:u.responseLength})}],A=this.intentService.getContext(t.userId);if(A&&A.messages.length>0){let Z=A.messages.slice(-6);for(let Y of Z)w.push({role:Y.role==="user"?"user":"assistant",content:Y.content})}w.push({role:"user",content:e});let V="",G=0,z="";try{let Z=await this.aiProvider.chat(w,{temperature:t.temperature??u.style==="casual"?.8:.7,maxTokens:t.maxTokens??(u.responseLength==="long"?500:200)});V=Z.content,G=Z.usage.totalTokens,z=Z.model}catch(Z){console.error("Failed to generate reply:",Z),V=this.getFallbackReply(o)}V=this.postProcessReply(V,o,t),this.intentService.updateContext(t.userId,V,"assistant");let $=this.calculateDelay(V,o),K=Date.now()-n;return this.updateStats(K,d.shouldHandoff),{content:V,intent:o,shouldHandoff:d.shouldHandoff,handoffReason:d.reason,triggeredRules:a,suggestedFollowUp:this.getSuggestedFollowUp(o),delay:$,metadata:{modelUsed:z,tokensUsed:G,processingTime:K,knowledgeUsed:g}}}async generateMultiRoleReply(e,t,n){return this.generateReply(e,P(E({},n),{roleName:t.roleName,rolePrompt:t.rolePrompt}))}async checkSmartRules(e,t){let n=this.aiCenter.activeRules(),o=[],d=this.intentService.getContext(t)?.messages.filter(u=>u.role==="user").length||0;for(let u of n)u.triggerIntent===e.intent&&(u.triggerConditions.intentScore&&e.confidence<u.triggerConditions.intentScore||u.triggerConditions.conversationRounds&&d<u.triggerConditions.conversationRounds||u.triggerConditions.keywordMatch&&!u.triggerConditions.keywordMatch.some(g=>e.keywords.includes(g))||o.push(u));return o.sort((u,p)=>p.priority-u.priority)}checkHandoff(e,t,n){let o=t.find(a=>a.actions.notifyHuman);return o?{shouldHandoff:!0,reason:`\u898F\u5247\u89F8\u767C\uFF1A${o.name}`}:e.intent==="purchase_intent"&&e.confidence>.8?{shouldHandoff:!0,reason:"\u9AD8\u8CFC\u8CB7\u610F\u5411\uFF0C\u5EFA\u8B70\u4EBA\u5DE5\u8DDF\u9032"}:e.intent==="negative_sentiment"||e.sentiment==="negative"?{shouldHandoff:!0,reason:"\u8CA0\u9762\u60C5\u7DD2\uFF0C\u9700\u8981\u4EBA\u5DE5\u8655\u7406"}:this.intentService.shouldHandoffToHuman(n)?{shouldHandoff:!0,reason:"\u5C0D\u8A71\u5206\u6790\u5EFA\u8B70\u8F49\u4EBA\u5DE5"}:{shouldHandoff:!1}}buildKnowledgeContext(e,t,n){if(!e||!e.items||e.items.length===0)return"";let o=e.items.filter(a=>a.isActive?n.intent==="price_inquiry"&&a.category==="sales"||n.intent==="product_question"&&a.category==="product"||n.intent==="complaint"&&a.category==="objection"?!0:a.keywords&&a.keywords.length>0?a.keywords.some(d=>t.toLowerCase().includes(d.toLowerCase())):!1:!1).slice(0,3);return o.length===0?"":`\u76F8\u95DC\u7522\u54C1\u77E5\u8B58\uFF1A
`+o.map(a=>`- ${a.title}\uFF1A${a.content}`).join(`
`)}postProcessReply(e,t,n){let o=e.trim();return o=o.replace(/^([:]\s*|Reply[:]\s*)/i,""),o=o.replace(/\*\*/g,""),o=o.replace(/\*/g,""),o=o.replace(/`/g,""),o=o.replace(/#{1,6}\s/g,""),n.userName&&Math.random()<.3&&!o.includes(n.userName)&&(o=`${n.userName}\uFF0C${o}`),o}getFallbackReply(e){let t={purchase_intent:["\u611F\u8B1D\u60A8\u7684\u8208\u8DA3\uFF01\u8ACB\u554F\u60A8\u60F3\u4E86\u89E3\u54EA\u500B\u65B9\u6848\u5462\uFF1F","\u592A\u597D\u4E86\uFF01\u6211\u53EF\u4EE5\u70BA\u60A8\u8A73\u7D30\u4ECB\u7D39\u8CFC\u8CB7\u6D41\u7A0B\u3002"],price_inquiry:["\u95DC\u65BC\u50F9\u683C\uFF0C\u6211\u5011\u6709\u591A\u7A2E\u65B9\u6848\u53EF\u4EE5\u9078\u64C7\uFF0C\u65B9\u4FBF\u544A\u8A34\u6211\u60A8\u7684\u9700\u6C42\u55CE\uFF1F","\u50F9\u683C\u65B9\u9762\uFF0C\u6211\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u9700\u6C42\u7D66\u51FA\u6700\u9069\u5408\u7684\u65B9\u6848\u3002"],product_question:["\u9019\u662F\u500B\u597D\u554F\u984C\uFF01\u8B93\u6211\u70BA\u60A8\u8A73\u7D30\u8AAA\u660E\u3002","\u611F\u8B1D\u60A8\u7684\u8A62\u554F\uFF0C\u6211\u4F86\u70BA\u60A8\u89E3\u7B54\u3002"],complaint:["\u975E\u5E38\u62B1\u6B49\u7D66\u60A8\u5E36\u4F86\u4E0D\u4FBF\uFF0C\u8B93\u6211\u4E86\u89E3\u4E00\u4E0B\u5177\u9AD4\u60C5\u6CC1\u3002","\u6211\u7406\u89E3\u60A8\u7684\u5FC3\u60C5\uFF0C\u8ACB\u544A\u8A34\u6211\u5177\u9AD4\u554F\u984C\uFF0C\u6211\u6703\u76E1\u529B\u5E6B\u60A8\u89E3\u6C7A\u3002"],general_chat:["\u611F\u8B1D\u60A8\u7684\u8A0A\u606F\uFF01\u6709\u4EC0\u9EBC\u6211\u53EF\u4EE5\u5E6B\u60A8\u7684\u55CE\uFF1F","\u60A8\u597D\uFF01\u8ACB\u554F\u6709\u4EC0\u9EBC\u554F\u984C\u60F3\u4E86\u89E3\u55CE\uFF1F"],negative_sentiment:["\u6211\u7406\u89E3\u60A8\u7684\u5FC3\u60C5\u3002\u8ACB\u554F\u5177\u9AD4\u662F\u4EC0\u9EBC\u554F\u984C\u5462\uFF1F","\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF0C\u6211\u5011\u6703\u8A8D\u771F\u5C0D\u5F85\u3002"],high_value:["\u611F\u8B1D\u60A8\u7684\u4FE1\u4EFB\uFF01\u6211\u6703\u70BA\u60A8\u63D0\u4F9B\u6700\u597D\u7684\u670D\u52D9\u3002","\u975E\u5E38\u9AD8\u8208\u70BA\u60A8\u670D\u52D9\uFF01"],urgent:["\u6536\u5230\uFF0C\u6211\u99AC\u4E0A\u70BA\u60A8\u8655\u7406\uFF01","\u597D\u7684\uFF0C\u6211\u7ACB\u523B\u5E6B\u60A8\u89E3\u6C7A\uFF01"]},n=t[e.intent]||t.general_chat;return n[Math.floor(Math.random()*n.length)]}getSuggestedFollowUp(e){return{price_inquiry:"\u53EF\u4EE5\u554F\u5BA2\u6236\u7684\u5177\u9AD4\u9700\u6C42\u548C\u9810\u7B97",product_question:"\u53EF\u4EE5\u554F\u5BA2\u6236\u662F\u5426\u9084\u6709\u5176\u4ED6\u554F\u984C",purchase_intent:"\u53EF\u4EE5\u63D0\u4F9B\u4ED8\u6B3E\u65B9\u5F0F\u548C\u512A\u60E0\u4FE1\u606F"}[e.intent]}calculateDelay(e,t){let n=30+Math.random()*30,a=e.length*.1;return t.urgency==="high"&&(n=10+Math.random()*10),Math.round(n+a)}updateStats(e,t){this.stats.update(n=>({totalConversations:n.totalConversations,totalReplies:n.totalReplies+1,avgResponseTime:(n.avgResponseTime*n.totalReplies+e)/(n.totalReplies+1),handoffCount:n.handoffCount+(t?1:0),conversionCount:n.conversionCount}))}startConversation(e){this.intentService.createContext(e),this.stats.update(t=>P(E({},t),{totalConversations:t.totalConversations+1}))}endConversation(e,t=!1){this.intentService.clearContext(e),t&&this.stats.update(n=>P(E({},n),{conversionCount:n.conversionCount+1}))}getConversation(e){return this.intentService.getContext(e)}getUserIntentScore(e){return this.intentService.getIntentScore4User(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var kt=class i{constructor(){this.aiCenter=F(Mt);this.conversationEngine=F(ir);this.ipc=F(Q);this.config=f(Dm);this.activeGroups=f([]);this.roles=R(()=>this.config().roles);this.scripts=R(()=>this.config().scripts);this.activeGroupCount=R(()=>this.activeGroups().filter(e=>e.status==="running").length);this.availableRoles=R(()=>this.config().roles.filter(e=>e.isActive&&e.boundAccountId));this.roleTypeMeta=Tt}addRole(e){let t=`role_${Date.now()}`,n=e.type||"custom",o=Tt[n],a={id:t,name:e.name||o.label,type:n,boundAccountId:e.boundAccountId,boundAccountPhone:e.boundAccountPhone,personality:{description:e.personality?.description||o.description,speakingStyle:e.personality?.speakingStyle||o.defaultStyle,traits:e.personality?.traits||[],background:e.personality?.background},aiConfig:E({useGlobalAI:!0,customPrompt:o.defaultPrompt,responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},e.aiConfig),responsibilities:e.responsibilities||[],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.config.update(d=>P(E({},d),{roles:[...d.roles,a]})),this.ipc.send("multi-role-add-role",a),t}updateRole(e,t){this.config.update(n=>P(E({},n),{roles:n.roles.map(o=>o.id===e?P(E(E({},o),t),{updatedAt:new Date().toISOString()}):o)})),this.ipc.send("multi-role-update-role",E({id:e},t))}deleteRole(e){this.config.update(t=>P(E({},t),{roles:t.roles.filter(n=>n.id!==e)})),this.ipc.send("multi-role-delete-role",{id:e})}bindAccountToRole(e,t,n){this.updateRole(e,{boundAccountId:t,boundAccountPhone:n})}unbindAccountFromRole(e){this.updateRole(e,{boundAccountId:void 0,boundAccountPhone:void 0})}addScript(e){let t=`script_${Date.now()}`,n={id:t,name:e.name||"\u65B0\u5287\u672C",description:e.description||"",scenario:e.scenario||"custom",requiredRoles:e.requiredRoles||["expert","satisfied_customer"],minRoleCount:e.minRoleCount||2,stages:e.stages||[],stats:{useCount:0,successCount:0,avgDuration:0,conversionRate:0},isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.config.update(o=>P(E({},o),{scripts:[...o.scripts,n]})),this.ipc.send("multi-role-add-script",n),t}updateScript(e,t){this.config.update(n=>P(E({},n),{scripts:n.scripts.map(o=>o.id===e?P(E(E({},o),t),{updatedAt:new Date().toISOString()}):o)})),this.ipc.send("multi-role-update-script",E({id:e},t))}deleteScript(e){this.config.update(t=>P(E({},t),{scripts:t.scripts.filter(n=>n.id!==e)})),this.ipc.send("multi-role-delete-script",{id:e})}addStageToScript(e,t){this.config.update(n=>P(E({},n),{scripts:n.scripts.map(o=>o.id!==e?o:P(E({},o),{stages:[...o.stages,t],updatedAt:new Date().toISOString()}))}))}async createCollaborationGroup(e){let t=this.config().scripts.find(p=>p.id===e.scriptId);if(!t)return null;let n=this.config().roles.filter(p=>e.roleIds.includes(p.id));if(n.length<t.minRoleCount||this.activeGroups().filter(p=>p.status==="creating"||p.status==="inviting"||p.status==="running").length>=this.config().autoGroupSettings.maxConcurrentGroups)return null;let d=this.config().autoGroupSettings.nameTemplate.replace("{\u5BA2\u6236\u540D}",e.targetCustomer.firstName||e.targetCustomer.username||"VIP\u5BA2\u6236"),u={id:`collab_${Date.now()}`,groupTitle:d,targetCustomer:e.targetCustomer,participants:n.map(p=>({roleId:p.id,roleName:p.name,accountId:p.boundAccountId,accountPhone:p.boundAccountPhone})),scriptId:e.scriptId,scriptName:t.name,status:"creating",messagesSent:0,customerMessages:0,createdAt:new Date().toISOString()};return this.activeGroups.update(p=>[...p,u]),u}updateGroupStatus(e,t){this.activeGroups.update(n=>n.map(o=>o.id===e?P(E({},o),{status:t}):o))}completeGroup(e,t){this.activeGroups.update(n=>n.map(o=>o.id===e?P(E({},o),{status:"completed",outcome:t,completedAt:new Date().toISOString()}):o))}async startScriptExecution(e){let t=this.activeGroups().find(o=>o.id===e);if(!t||t.status!=="running")return!1;let n=this.config().scripts.find(o=>o.id===t.scriptId);return!n||n.stages.length===0?!1:(this.activeGroups.update(o=>o.map(a=>a.id===e?P(E({},a),{currentStageId:n.stages[0].id,currentStageOrder:0}):a)),!0)}async executeStage(e,t){let n=this.config().roles;for(let o of t.messages){let a=n.find(p=>p.id===o.roleId);if(!a)continue;let d=o.timing.delayAfterPrevious;if(o.timing.randomDelay){let{min:p,max:g}=o.timing.randomDelay;d+=Math.floor(Math.random()*(g-p+1))+p}await new Promise(p=>setTimeout(p,d*1e3));let u;o.content.type==="text"?(u=o.content.text||"",o.content.variables&&(u=u.replace("{\u5BA2\u6236\u540D}",e.targetCustomer.firstName||e.targetCustomer.username||"VIP\u5BA2\u6236").replace("{\u7FA4\u540D}",e.groupTitle))):o.content.type==="ai_generate"?u=(await this.conversationEngine.generateMultiRoleReply(o.content.aiPrompt||"\u8ACB\u6839\u64DA\u7576\u524D\u5C0D\u8A71\u4E0A\u4E0B\u6587\u751F\u6210\u5408\u9069\u7684\u56DE\u8986",{roleId:a.id,roleName:a.name,rolePrompt:a.aiConfig.customPrompt||"",personality:a.personality.description},{userId:e.targetCustomer.id,userName:e.targetCustomer.firstName||e.targetCustomer.username,sourceGroup:e.telegramGroupId||e.id})).content:u=o.content.text||"",console.log(`[MultiRole] ${a.name}: ${u}`),this.activeGroups.update(p=>p.map(g=>g.id===e.id?P(E({},g),{messagesSent:g.messagesSent+1}):g))}}updateAutoGroupSettings(e){this.config.update(t=>P(E({},t),{autoGroupSettings:E(E({},t.autoGroupSettings),e)}))}updateTriggerConditions(e){this.config.update(t=>P(E({},t),{defaultTriggerConditions:E(E({},t.defaultTriggerConditions),e)}))}updateAISettings(e){this.config.update(t=>P(E({},t),{aiSettings:E(E({},t.aiSettings),e)}))}exportConfig(){return JSON.stringify(this.config(),null,2)}importConfig(e){try{let t=JSON.parse(e);return this.config.set(t),!0}catch{return!1}}resetToDefault(){this.config.set(Dm),this.activeGroups.set([])}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var zn=class i{constructor(){this.ipc=F(Q);this.multiRoleService=F(kt);this.activeGroups=f([]);this.pendingRequests=f([]);this.messageHistory=f(new Map);this.stats=f({totalGroups:0,activeGroups:0,successfulConversions:0,pendingRequests:0});this.groups=this.activeGroups.asReadonly();this.pending=this.pendingRequests.asReadonly();this.statistics=this.stats.asReadonly();this.initializeListeners(),this.loadActiveGroups()}initializeListeners(){this.ipc.on("multi-role-group-created",e=>{this.handleGroupCreated(e)}),this.ipc.on("multi-role-group-message",e=>{this.handleGroupMessage(e)}),this.ipc.on("multi-role-member-joined",e=>{this.handleMemberJoined(e)}),this.ipc.on("multi-role-member-left",e=>{this.handleMemberLeft(e)})}async loadActiveGroups(){try{let e=localStorage.getItem("tg-matrix-multi-role-groups");if(e){let t=JSON.parse(e);this.activeGroups.set(t),this.updateStats()}}catch(e){console.error("Failed to load active groups:",e)}}saveGroups(){try{localStorage.setItem("tg-matrix-multi-role-groups",JSON.stringify(this.activeGroups()))}catch(e){console.error("Failed to save groups:",e)}}async createGroup(e){try{return!e.roleAccounts||e.roleAccounts.length===0?{success:!1,error:"\u672A\u914D\u7F6E\u89D2\u8272\u5E33\u865F"}:(this.pendingRequests.update(t=>[...t,e]),this.updateStats(),this.ipc.send("create-multi-role-group",{groupName:e.groupName,targetUserId:e.targetCustomer.id,targetUsername:e.targetCustomer.username,roleAccounts:e.roleAccounts,inviteMessage:e.inviteMessage||`\u60A8\u597D ${e.targetCustomer.firstName||""}\uFF0C\u6211\u5011\u70BA\u60A8\u5275\u5EFA\u4E86\u5C08\u5C6C\u670D\u52D9\u7FA4\u7D44\uFF01`}),{success:!0,groupId:`pending_${Date.now()}`})}catch(t){return console.error("Failed to create group:",t),{success:!1,error:t instanceof Error?t.message:"\u5EFA\u7FA4\u5931\u6557"}}}handleGroupCreated(e){if(this.pendingRequests.update(t=>t.filter(n=>n.targetCustomer.id!==e.request.targetCustomer.id)),e.success&&e.groupId){let t={id:e.groupId,targetCustomer:{id:e.request.targetCustomer.id,username:e.request.targetCustomer.username,firstName:e.request.targetCustomer.firstName,intentScore:e.request.intentScore||0,source:e.request.sourceGroupId||"unknown"},groupTitle:e.request.groupName,telegramGroupId:e.telegramGroupId,participants:e.request.roleAccounts.map(n=>({roleId:n.roleId,roleName:"",accountId:n.accountId,accountPhone:""})),scriptId:e.request.scriptId||"",scriptName:"",status:"running",currentStageId:void 0,currentStageOrder:0,messagesSent:0,customerMessages:0,outcome:"pending",createdAt:new Date().toISOString()};this.activeGroups.update(n=>[...n,t]),this.saveGroups(),e.request.scriptId&&this.ipc.send("multi-role-start-script",{groupId:t.id,scriptId:e.request.scriptId})}this.updateStats()}handleGroupMessage(e){let t={id:`msg_${Date.now()}`,senderId:e.senderId,senderName:e.senderName,content:e.content,timestamp:new Date,isFromTarget:e.isFromTarget};this.messageHistory.update(n=>{let o=new Map(n),a=o.get(e.groupId)||[];return o.set(e.groupId,[...a,t]),o}),e.isFromTarget&&this.activeGroups.update(n=>n.map(o=>o.id===e.groupId?P(E({},o),{customerMessages:o.customerMessages+1,updatedAt:new Date}):o)),e.isFromTarget&&this.handleCustomerMessage(e.groupId,t)}async handleCustomerMessage(e,t){let n=this.activeGroups().find(o=>o.id===e);if(!(!n||n.status!=="running"))if(n.scriptId){let o=this.multiRoleService.scripts().find(d=>d.id===n.scriptId),a=n.currentStageOrder||0;o&&o.stages[a]&&o.stages[a].trigger?.type==="message"&&this.ipc.send("multi-role-advance-stage",{groupId:e,nextStageOrder:a+1})}else this.ipc.send("multi-role-ai-reply",{groupId:e,message:t.content,customerId:n.targetCustomer.id})}handleMemberJoined(e){e.isTarget&&this.activeGroups.update(t=>t.map(n=>n.id===e.groupId?P(E({},n),{status:"running",updatedAt:new Date}):n))}handleMemberLeft(e){e.isTarget&&(this.activeGroups.update(t=>t.map(n=>n.id===e.groupId?P(E({},n),{status:"failed",updatedAt:new Date}):n)),this.saveGroups())}async sendMessage(e,t,n){let o=this.activeGroups().find(d=>d.id===e);if(!o)return!1;let a=o.participants?.find(d=>d.roleId===t);return a?(this.ipc.send("multi-role-send-message",{groupId:e,telegramGroupId:o.telegramGroupId,accountId:a.accountId,content:n}),this.activeGroups.update(d=>d.map(u=>u.id===e?P(E({},u),{messagesSent:u.messagesSent+1,updatedAt:new Date}):u)),!0):!1}markAsConverted(e){this.activeGroups.update(t=>t.map(n=>n.id===e?P(E({},n),{status:"completed",updatedAt:new Date}):n)),this.saveGroups(),this.stats.update(t=>P(E({},t),{successfulConversions:t.successfulConversions+1}))}pauseGroup(e){this.activeGroups.update(t=>t.map(n=>n.id===e?P(E({},n),{status:"paused",updatedAt:new Date}):n)),this.saveGroups()}resumeGroup(e){this.activeGroups.update(t=>t.map(n=>n.id===e?P(E({},n),{status:"running",updatedAt:new Date}):n)),this.saveGroups()}closeGroup(e){this.activeGroups.update(t=>t.map(n=>n.id===e?P(E({},n),{status:"completed",updatedAt:new Date}):n)),this.saveGroups(),this.updateStats()}getMessages(e){return this.messageHistory().get(e)||[]}getGroup(e){return this.activeGroups().find(t=>t.id===e)}updateStats(){let e=this.activeGroups();this.stats.set({totalGroups:e.length,activeGroups:e.filter(t=>t.status==="running").length,successfulConversions:e.filter(t=>t.status==="completed").length,pendingRequests:this.pendingRequests().length})}shouldCreateGroup(e,t){let n=t?.minScore||50;return e>=n}generateGroupName(e,t="{\u5BA2\u6236\u540D}\u5C08\u5C6C\u670D\u52D9\u7FA4"){return t.replace("{\u5BA2\u6236\u540D}",e||"VIP\u5BA2\u6236")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var or=class i{constructor(){this.multiRoleService=F(kt);this.autoGroupService=F(zn);this.conversationEngine=F(ir);this.intentService=F(nr);this.ipc=F(Q);this.executionStates=f(new Map);this.taskQueue=f([]);this.stats=f({totalExecutions:0,successfulExecutions:0,failedExecutions:0,avgResponseTime:0});this.executionInterval=null;this.states=this.executionStates.asReadonly();this.queue=this.taskQueue.asReadonly();this.statistics=this.stats.asReadonly();this.startExecutionLoop(),this.initializeListeners()}initializeListeners(){this.ipc.on("multi-role-customer-message",e=>{this.handleCustomerMessage(e.groupId,e.message)}),this.ipc.on("multi-role-message-sent",e=>{this.handleMessageSent(e.taskId,e.success,e.error)})}startExecutionLoop(){this.executionInterval=setInterval(()=>{this.processTaskQueue()},1e3)}async processTaskQueue(){let e=new Date,n=this.taskQueue().filter(o=>o.status==="pending"&&o.scheduledTime<=e);for(let o of n)await this.executeTask(o);this.taskQueue.update(o=>o.filter(a=>a.status!=="completed"&&a.status!=="failed"))}async executeTask(e){this.updateTaskStatus(e.id,"executing");try{let t=Date.now();if(await this.autoGroupService.sendMessage(e.groupId,e.roleId,e.content)){this.updateTaskStatus(e.id,"completed");let o=Date.now()-t;this.stats.update(a=>({totalExecutions:a.totalExecutions+1,successfulExecutions:a.successfulExecutions+1,failedExecutions:a.failedExecutions,avgResponseTime:(a.avgResponseTime*a.totalExecutions+o)/(a.totalExecutions+1)})),this.checkNextMessage(e.groupId)}else throw new Error("\u6D88\u606F\u767C\u9001\u5931\u6557")}catch(t){this.updateTaskStatus(e.id,"failed",t instanceof Error?t.message:"\u672A\u77E5\u932F\u8AA4"),this.stats.update(n=>P(E({},n),{totalExecutions:n.totalExecutions+1,failedExecutions:n.failedExecutions+1}))}}async startScriptExecution(e,t){let n=this.autoGroupService.getGroup(e),o=this.multiRoleService.scripts().find(d=>d.id===t);if(!n||!o){console.error("Group or script not found");return}let a={groupId:e,isRunning:!0,currentStage:0,currentMessageIndex:0,lastMessageTime:null,pendingTasks:[],completedTasks:[]};this.executionStates.update(d=>{let u=new Map(d);return u.set(e,a),u}),await this.executeStage(e,o.stages[0])}async executeStage(e,t){let n=this.executionStates().get(e);!n||!n.isRunning||(t.trigger?.type==="time"&&t.trigger.delaySeconds?setTimeout(()=>this.executeStageMessages(e,t),t.trigger.delaySeconds*1e3):t.trigger?.type==="message"||await this.executeStageMessages(e,t))}async executeStageMessages(e,t){let n=this.executionStates().get(e);if(!n||!n.isRunning)return;let o=0;for(let a=0;a<t.messages.length;a++){let d=t.messages[a];if(o+=d.timing.delayAfterPrevious||0,d.timing.randomDelay){let{min:g,max:C}=d.timing.randomDelay;o+=Math.floor(Math.random()*(C-g+1))+g}let u;if(d.content.type==="ai_generate"){let g=this.autoGroupService.getGroup(e),C=this.multiRoleService.roles().find(w=>w.id===d.roleId);g&&C?u=(await this.conversationEngine.generateMultiRoleReply(d.content.aiPrompt||"",{roleId:C.id,roleName:C.name,rolePrompt:C.aiConfig.customPrompt,personality:C.personality.description},{userId:g.targetCustomer.id,userName:g.targetCustomer.firstName||g.targetCustomer.username})).content:u=d.content.text||""}else if(d.content.type==="template"){let g=this.autoGroupService.getGroup(e);u=this.processTemplate(d.content.text||"",g?.targetCustomer)}else u=d.content.text||"";let p={id:`task_${Date.now()}_${a}`,groupId:e,type:"script_message",roleId:d.roleId,content:u,delay:o,status:"pending",scheduledTime:new Date(Date.now()+o*1e3)};this.taskQueue.update(g=>[...g,p])}this.executionStates.update(a=>{let d=new Map(a),u=d.get(e);return u&&d.set(e,P(E({},u),{currentStage:u.currentStage+1})),d})}async handleCustomerMessage(e,t){let n=this.autoGroupService.getGroup(e);if(!n||n.status!=="running")return;let o=this.executionStates().get(e),a=await this.intentService.recognizeIntent(t,n.targetCustomer.id,!0);if(n.scriptId&&o?.isRunning){let d=this.multiRoleService.scripts().find(u=>u.id===n.scriptId);if(d&&o.currentStage<d.stages.length){let u=d.stages[o.currentStage];u.trigger?.type==="message"?await this.executeStage(e,u):u.trigger?.type==="keyword"&&u.trigger.keywords?.some(g=>a.keywords?.includes(g))&&await this.executeStage(e,u)}}else await this.generateFreeReply(e,n,t,a)}async generateFreeReply(e,t,n,o){let a=this.multiRoleService.roles(),d=t.participants?.[0];if(!d)return;let u=a.find(C=>C.id===d.roleId);if(!u)return;let p=await this.conversationEngine.generateMultiRoleReply(n,{roleId:u.id,roleName:u.name,rolePrompt:u.aiConfig.customPrompt,personality:u.personality.description},{userId:t.targetCustomer.id,userName:t.targetCustomer.firstName||t.targetCustomer.username,sourceGroup:e}),g={id:`task_${Date.now()}`,groupId:e,type:"ai_reply",roleId:u.id,content:p.content,delay:p.delay,status:"pending",scheduledTime:new Date(Date.now()+p.delay*1e3)};this.taskQueue.update(C=>[...C,g]),p.shouldHandoff&&this.notifyHandoff(e,p.handoffReason||"\u9700\u8981\u4EBA\u5DE5\u4ECB\u5165")}processTemplate(e,t){return e.replace(/{}/g,t?.firstName||t?.username||"VIP\u5BA2\u6236").replace(/{}/g,t?.username||"\u7528\u6236").replace(/{ID}/g,t?.id||"")}updateTaskStatus(e,t,n){this.taskQueue.update(o=>o.map(a=>a.id===e?P(E({},a),{status:t,error:n}):a))}checkNextMessage(e){this.executionStates().get(e)&&this.executionStates.update(n=>{let o=new Map(n),a=o.get(e);return a&&o.set(e,P(E({},a),{lastMessageTime:new Date})),o})}handleMessageSent(e,t,n){t?this.updateTaskStatus(e,"completed"):this.updateTaskStatus(e,"failed",n)}notifyHandoff(e,t){this.ipc.send("multi-role-handoff",{groupId:e,reason:t,timestamp:new Date().toISOString()}),this.pauseExecution(e)}pauseExecution(e){this.executionStates.update(t=>{let n=new Map(t),o=n.get(e);return o&&n.set(e,P(E({},o),{isRunning:!1})),n})}resumeExecution(e){this.executionStates.update(t=>{let n=new Map(t),o=n.get(e);return o&&n.set(e,P(E({},o),{isRunning:!0})),n})}stopExecution(e){this.taskQueue.update(t=>t.filter(n=>n.groupId!==e)),this.executionStates.update(t=>{let n=new Map(t);return n.delete(e),n})}async sendManualMessage(e,t,n,o=0){let a={id:`task_${Date.now()}`,groupId:e,type:"scheduled",roleId:t,content:n,delay:o,status:"pending",scheduledTime:new Date(Date.now()+o*1e3)};this.taskQueue.update(d=>[...d,a])}ngOnDestroy(){this.executionInterval&&clearInterval(this.executionInterval)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var lP=1,Mi=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.multiRoleService=F(kt);this.accountService=F(pt);this._currentExecution=f(null);this.currentExecution=R(()=>this._currentExecution());this._executions=f([]);this.executions=R(()=>this._executions());this._isProcessing=f(!1);this.isProcessing=R(()=>this._isProcessing());this._executionMode=f("hybrid");this.executionMode=R(()=>this._executionMode());this._accountMatches=f([]);this.accountMatches=R(()=>this._accountMatches());this.queueProgress=R(()=>{let e=this._currentExecution();return e?.queue?{total:e.queue.totalUsers,processed:e.queue.processedUsers,current:e.queue.currentUser,pending:e.queue.pendingUsers.length,completed:e.queue.completedUsers,progress:e.queue.totalUsers>0?Math.round(e.queue.processedUsers/e.queue.totalUsers*100):0}:null});this.analysisInterval=10;this.defaultScriptlessConfig={enabled:!1,maxTurns:50,autoAdjustInterval:10,targetConversionSignals:["\u600E\u9EBC\u8CB7","\u5728\u54EA\u8CB7","\u591A\u5C11\u9322","\u60F3\u8CB7","\u4E0B\u55AE","\u4ED8\u6B3E"],exitConditions:{maxSilenceMinutes:60,negativeThreshold:30,successSignals:["\u8CB7\u4E86","\u5DF2\u4ED8\u6B3E","\u6210\u4EA4","\u8B1D\u8B1D","\u6536\u5230"]}};this.intentTemplates={sales_conversion:{keywords:["\u6210\u4EA4","\u8CFC\u8CB7","\u4E0B\u55AE","\u4ED8\u8CBB","\u8F49\u5316","\u8CB7","\u8A02\u55AE","\u4ED8\u6B3E","\u71DF\u92B7","\u92B7\u552E","\u63A8\u5EE3","\u652F\u4ED8","\u4EE3\u6536","\u4EE3\u4ED8","\u7522\u54C1","\u670D\u52D9","\u5BA2\u6236","\u7528\u6236","\u8208\u8DA3","\u5408\u4F5C","\u696D\u52D9","\u958B\u767C","\u62D3\u5C55","\u7C3D\u7D04"],description:"\u4FC3\u9032\u6F5B\u5728\u5BA2\u6236\u5B8C\u6210\u8CFC\u8CB7",defaultRoles:[{id:"friendly_member",name:"\u71B1\u5FC3\u7FA4\u53CB",icon:"\u{1F604}",type:"atmosphere",purpose:"\u6D3B\u8E8D\u6C23\u6C1B\uFF0C\u81EA\u7136\u5F15\u5165\u8A71\u984C",personality:"\u71B1\u60C5\u958B\u6717\uFF0C\u611B\u5206\u4EAB\uFF0C\u597D\u5947\u5FC3\u5F37",speakingStyle:"\u53E3\u8A9E\u5316\uFF0C\u5E36\u8868\u60C5\u7B26\u865F\uFF0C\u50CF\u670B\u53CB\u804A\u5929",entryTiming:"\u958B\u5834\u548C\u6C23\u6C1B\u51B7\u5834\u6642",sampleMessages:["\u5927\u5BB6\u65E9\u5B89\uFF01\u4ECA\u5929\u5929\u6C23\u771F\u597D\uFF5E","\u54C8\u54C8\u9019\u500B\u6709\u610F\u601D\uFF0C\u6211\u4E5F\u9047\u5230\u904E","\u5C0D\u4E86\uFF0C\u6700\u8FD1\u6709\u4EBA\u7528\u904EXX\u55CE\uFF1F\u60F3\u807D\u807D\u610F\u898B"]},{id:"loyal_customer",name:"\u8001\u7528\u6236",icon:"\u2764\uFE0F",type:"endorsement",purpose:"\u5206\u4EAB\u771F\u5BE6\u4F7F\u7528\u9AD4\u9A57\uFF0C\u5EFA\u7ACB\u4FE1\u4EFB",personality:"\u771F\u8AA0\u53EF\u9760\uFF0C\u6A02\u65BC\u52A9\u4EBA",speakingStyle:"\u5E73\u5BE6\u81EA\u7136\uFF0C\u5206\u4EAB\u500B\u4EBA\u7D93\u6B77",entryTiming:"\u8A71\u984C\u8F49\u5230\u7522\u54C1\u76F8\u95DC\u6642",sampleMessages:["\u6211\u7528\u4E86\u5927\u6982\u4E09\u500B\u6708\u5427\uFF0C\u611F\u89BA\u9084\u4E0D\u932F","\u4E00\u958B\u59CB\u4E5F\u662F\u670B\u53CB\u63A8\u85A6\u7684\uFF0C\u6C92\u60F3\u5230\u771F\u7684\u597D\u7528","\u8AAA\u5BE6\u8A71\u525B\u958B\u59CB\u4E5F\u6709\u9EDE\u7336\u8C6B\uFF0C\u5F8C\u4F86\u89BA\u5F97\u503C\u5F97"]},{id:"sales_expert",name:"\u9867\u554F\u5C08\u5BB6",icon:"\u{1F4BC}",type:"professional",purpose:"\u5C08\u696D\u89E3\u7B54\uFF0C\u4FC3\u6210\u6210\u4EA4",personality:"\u5C08\u696D\u53EF\u9760\uFF0C\u8010\u5FC3\u7D30\u7DFB",speakingStyle:"\u5C08\u696D\u4F46\u4E0D\u751F\u786C\uFF0C\u6709\u89AA\u548C\u529B",entryTiming:"\u5BA2\u6236\u8868\u73FE\u51FA\u660E\u78BA\u8208\u8DA3\u6642",sampleMessages:["\u9019\u500B\u554F\u984C\u554F\u5F97\u597D\uFF0C\u6211\u4F86\u8A73\u7D30\u8AAA\u660E\u4E00\u4E0B","\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0C\u6211\u5EFA\u8B70...","\u73FE\u5728\u6B63\u597D\u6709\u6D3B\u52D5\uFF0C\u53EF\u4EE5\u4E86\u89E3\u4E00\u4E0B"]}],defaultPhases:[{id:"phase_1",name:"\u6C1B\u570D\u71DF\u9020",duration:"1-2\u5929",goal:"\u5EFA\u7ACB\u5B58\u5728\u611F\uFF0C\u6D3B\u8E8D\u7FA4\u6C23\u6C1B",tactics:["\u65E5\u5E38\u554F\u5019","\u5206\u4EAB\u8DA3\u4E8B","\u53C3\u8207\u8A0E\u8AD6"],rolesFocus:["friendly_member"],successIndicators:["\u7FA4\u6D3B\u8E8D\u5EA6\u63D0\u5347","\u6709\u4EBA\u56DE\u8986\u4E92\u52D5"]},{id:"phase_2",name:"\u8A71\u984C\u5F15\u5165",duration:"1-2\u5929",goal:"\u81EA\u7136\u5F15\u5165\u7522\u54C1\u76F8\u95DC\u8A71\u984C",tactics:["\u5834\u666F\u5206\u4EAB","\u75DB\u9EDE\u8A0E\u8AD6","\u7D93\u9A57\u4EA4\u6D41"],rolesFocus:["friendly_member","loyal_customer"],successIndicators:["\u76EE\u6A19\u5BA2\u6236\u53C3\u8207\u8A0E\u8AD6","\u63D0\u53CA\u7522\u54C1\u76F8\u95DC\u9700\u6C42"]},{id:"phase_3",name:"\u50F9\u503C\u5C55\u793A",duration:"1-2\u5929",goal:"\u5C55\u793A\u7522\u54C1\u50F9\u503C\uFF0C\u5EFA\u7ACB\u4FE1\u4EFB",tactics:["\u4F7F\u7528\u9AD4\u9A57\u5206\u4EAB","\u6548\u679C\u898B\u8B49","\u5C08\u696D\u89E3\u7B54"],rolesFocus:["loyal_customer","sales_expert"],successIndicators:["\u5BA2\u6236\u8A62\u554F\u8A73\u60C5","\u8208\u8DA3\u5EA6\u4E0A\u5347"]},{id:"phase_4",name:"\u4FC3\u6210\u6210\u4EA4",duration:"\u9748\u6D3B",goal:"\u628A\u63E1\u6642\u6A5F\uFF0C\u4FC3\u6210\u8CFC\u8CB7",tactics:["\u512A\u60E0\u544A\u77E5","\u9650\u6642\u523A\u6FC0","\u7570\u8B70\u8655\u7406"],rolesFocus:["sales_expert"],successIndicators:["\u5BA2\u6236\u8A62\u50F9","\u9054\u6210\u8CFC\u8CB7"]}]},churn_recovery:{keywords:["\u6D41\u5931","\u633D\u56DE","\u56DE\u4F86","\u518D\u6B21","\u91CD\u65B0","\u8001\u5BA2\u6236","\u7E8C\u8CBB"],description:"\u633D\u56DE\u6D41\u5931\u6216\u6C89\u9ED8\u7684\u8001\u5BA2\u6236",defaultRoles:[{id:"callback_agent",name:"\u56DE\u8A2A\u5C08\u54E1",icon:"\u{1F4DE}",type:"care",purpose:"\u771F\u8AA0\u95DC\u61F7\uFF0C\u4E86\u89E3\u96E2\u958B\u539F\u56E0",personality:"\u6EAB\u6696\u771F\u8AA0\uFF0C\u5584\u65BC\u50BE\u807D",speakingStyle:"\u89AA\u5207\u95DC\u61F7\uFF0C\u4E0D\u6025\u8E81",entryTiming:"\u958B\u5834",sampleMessages:["\u597D\u4E45\u6C92\u806F\u7E6B\u4E86\uFF0C\u6700\u8FD1\u600E\u9EBC\u6A23\uFF1F","\u60F3\u8D77\u60A8\u4E86\uFF0C\u7279\u610F\u4F86\u554F\u5019\u4E00\u4E0B","\u4E4B\u524D\u7528\u8457\u9084\u9806\u5229\u55CE\uFF1F\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u5FD9\u7684\uFF1F"]},{id:"customer_success",name:"\u5BA2\u6236\u6210\u529F",icon:"\u{1F3AF}",type:"solution",purpose:"\u89E3\u6C7A\u554F\u984C\uFF0C\u5C55\u793A\u6539\u9032",personality:"\u5C08\u696D\u8CA0\u8CAC\uFF0C\u7A4D\u6975\u4E3B\u52D5",speakingStyle:"\u554F\u984C\u5C0E\u5411\uFF0C\u63D0\u4F9B\u65B9\u6848",entryTiming:"\u5BA2\u6236\u8AAA\u51FA\u96E2\u958B\u539F\u56E0\u5F8C",sampleMessages:["\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF0C\u9019\u500B\u554F\u984C\u6211\u5011\u5DF2\u7D93\u512A\u5316\u4E86","\u91DD\u5C0D\u9019\u500B\u60C5\u6CC1\uFF0C\u6211\u5011\u73FE\u5728\u6709\u65B0\u7684\u89E3\u6C7A\u65B9\u6848","\u4F86\uFF0C\u6211\u5E6B\u60A8\u770B\u770B\u73FE\u5728\u600E\u9EBC\u8655\u7406\u6700\u597D"]},{id:"vip_manager",name:"VIP\u7D93\u7406",icon:"\u{1F451}",type:"retention",purpose:"\u9AD8\u5C64\u51FA\u9762\uFF0C\u8AA0\u610F\u633D\u7559",personality:"\u6709\u6B0A\u5A01\u4F46\u89AA\u548C\uFF0C\u8AA0\u610F\u5341\u8DB3",speakingStyle:"\u6B63\u5F0F\u4F46\u4E0D\u751F\u786C\uFF0C\u5C55\u73FE\u8AA0\u610F",entryTiming:"\u9700\u8981\u7279\u5225\u512A\u60E0\u6216\u6C7A\u7B56\u6642",sampleMessages:["\u6211\u662FVIP\u7D93\u7406\uFF0C\u7279\u610F\u4F86\u8DDF\u60A8\u804A\u804A","\u60A8\u662F\u6211\u5011\u7684\u91CD\u8981\u5BA2\u6236\uFF0C\u9019\u500B\u512A\u60E0\u662F\u5C08\u9580\u70BA\u60A8\u7533\u8ACB\u7684","\u6709\u4EC0\u9EBC\u9867\u616E\u90FD\u53EF\u4EE5\u8AAA\uFF0C\u6211\u5011\u4E00\u5B9A\u76E1\u529B\u89E3\u6C7A"]}],defaultPhases:[{id:"phase_1",name:"\u95DC\u61F7\u56DE\u8A2A",duration:"1\u5929",goal:"\u771F\u8AA0\u554F\u5019\uFF0C\u4E86\u89E3\u8FD1\u6CC1",tactics:["\u554F\u5019","\u95DC\u5FC3","\u50BE\u807D"],rolesFocus:["callback_agent"],successIndicators:["\u5BA2\u6236\u56DE\u8986","\u8AAA\u51FA\u96E2\u958B\u539F\u56E0"]},{id:"phase_2",name:"\u554F\u984C\u89E3\u6C7A",duration:"1-2\u5929",goal:"\u91DD\u5C0D\u554F\u984C\u63D0\u4F9B\u65B9\u6848",tactics:["\u554F\u984C\u78BA\u8A8D","\u65B9\u6848\u63D0\u4F9B","\u6539\u9032\u8AAA\u660E"],rolesFocus:["customer_success"],successIndicators:["\u5BA2\u6236\u8A8D\u53EF\u6539\u9032","\u9858\u610F\u518D\u8A66"]},{id:"phase_3",name:"\u8AA0\u610F\u633D\u7559",duration:"\u9748\u6D3B",goal:"\u63D0\u4F9B\u512A\u60E0\uFF0C\u4FC3\u6210\u56DE\u6B78",tactics:["\u5C08\u5C6C\u512A\u60E0","VIP\u5F85\u9047","\u627F\u8AFE\u4FDD\u969C"],rolesFocus:["vip_manager"],successIndicators:["\u5BA2\u6236\u540C\u610F\u56DE\u6B78","\u7E8C\u8CBB\u6210\u529F"]}]},community_activation:{keywords:["\u6D3B\u8E8D","\u793E\u7FA4","\u6C23\u6C1B","\u4E92\u52D5","\u8A0E\u8AD6","\u51B7\u6E05","\u5E36\u52D5"],description:"\u63D0\u5347\u793E\u7FA4\u6D3B\u8E8D\u5EA6\u548C\u7528\u6236\u7C98\u6027",defaultRoles:[{id:"community_host",name:"\u793E\u7FA4\u7BA1\u5BB6",icon:"\u{1F3E0}",type:"host",purpose:"\u767C\u8D77\u8A71\u984C\uFF0C\u7DAD\u8B77\u79E9\u5E8F",personality:"\u71B1\u60C5\u8CA0\u8CAC\uFF0C\u6709\u7D44\u7E54\u80FD\u529B",speakingStyle:"\u89AA\u5207\u6709\u5E8F\uFF0C\u5F15\u5C0E\u8A0E\u8AD6",entryTiming:"\u958B\u5834\u548C\u8A71\u984C\u8F49\u63DB\u6642",sampleMessages:["\u65E9\u5B89\u5404\u4F4D\uFF01\u65B0\u7684\u4E00\u5929\u958B\u59CB\u4E86\uFF5E","\u4ECA\u5929\u4F86\u804A\u804AXXX\uFF0C\u5927\u5BB6\u600E\u9EBC\u770B\uFF1F","\u611F\u8B1D\u5206\u4EAB\uFF01\u9084\u6709\u5176\u4ED6\u60F3\u6CD5\u55CE\uFF1F"]},{id:"active_member_1",name:"\u6D3B\u8E8D\u7FA4\u53CBA",icon:"\u{1F917}",type:"participant",purpose:"\u7A4D\u6975\u4E92\u52D5\uFF0C\u5E36\u52D5\u6C23\u6C1B",personality:"\u5916\u5411\u6D3B\u6F51\uFF0C\u611B\u5206\u4EAB",speakingStyle:"\u8F15\u9B06\u96A8\u610F\uFF0C\u591A\u7528\u8868\u60C5",entryTiming:"\u8A71\u984C\u767C\u8D77\u5F8C\u7A4D\u6975\u97FF\u61C9",sampleMessages:["\u9019\u500B\u8A71\u984C\u6211\u6709\u8A71\u8AAA\uFF01","\u54C8\u54C8\u78BA\u5BE6\u662F\u9019\u6A23","\u6211\u4E5F\u6709\u985E\u4F3C\u7684\u7D93\u6B77\uFF5E"]},{id:"active_member_2",name:"\u6D3B\u8E8D\u7FA4\u53CBB",icon:"\u{1F60E}",type:"participant",purpose:"\u88DC\u5145\u89C0\u9EDE\uFF0C\u5EF6\u7E8C\u8A0E\u8AD6",personality:"\u5E7D\u9ED8\u98A8\u8DA3\uFF0C\u898B\u89E3\u7368\u5230",speakingStyle:"\u6709\u8DA3\u6709\u6599\uFF0C\u5076\u723E\u6296\u6A5F\u9748",entryTiming:"\u8A0E\u8AD6\u9032\u884C\u4E2D\u88DC\u5145",sampleMessages:["\u6A13\u4E0A\u8AAA\u5F97\u5C0D\uFF0C\u6211\u88DC\u5145\u4E00\u9EDE","\u63DB\u500B\u89D2\u5EA6\u60F3\u60F3...","\u9019\u8B93\u6211\u60F3\u8D77\u4E00\u500B\u6709\u610F\u601D\u7684\u4E8B"]},{id:"opinion_leader",name:"\u610F\u898B\u9818\u8896",icon:"\u{1F3A4}",type:"expert",purpose:"\u8F38\u51FA\u50F9\u503C\uFF0C\u7E3D\u7D50\u89C0\u9EDE",personality:"\u5C08\u696D\u6B0A\u5A01\uFF0C\u6709\u6DF1\u5EA6",speakingStyle:"\u6709\u898B\u5730\uFF0C\u80FD\u7E3D\u7D50\u63D0\u5347",entryTiming:"\u8A0E\u8AD6\u9700\u8981\u7E3D\u7D50\u6216\u5347\u83EF\u6642",sampleMessages:["\u770B\u4E86\u5927\u5BB6\u7684\u8A0E\u8AD6\uFF0C\u6211\u4F86\u7E3D\u7D50\u4E00\u4E0B","\u9019\u500B\u554F\u984C\u7684\u95DC\u9375\u5728\u65BC...","\u5206\u4EAB\u4E00\u500B\u6211\u7684\u601D\u8003\u6846\u67B6"]}],defaultPhases:[{id:"phase_1",name:"\u8A71\u984C\u767C\u8D77",duration:"\u6301\u7E8C",goal:"\u767C\u8D77\u6709\u50F9\u503C\u7684\u8A0E\u8AD6\u8A71\u984C",tactics:["\u71B1\u9EDE\u8A71\u984C","\u7D93\u9A57\u5206\u4EAB","\u554F\u984C\u8A0E\u8AD6"],rolesFocus:["community_host"],successIndicators:["\u6709\u4EBA\u53C3\u8207\u8A0E\u8AD6"]},{id:"phase_2",name:"\u4E92\u52D5\u97FF\u61C9",duration:"\u6301\u7E8C",goal:"\u5E36\u52D5\u8A0E\u8AD6\u6C1B\u570D",tactics:["\u7A4D\u6975\u56DE\u8986","\u88DC\u5145\u89C0\u9EDE","\u8868\u9054\u8A8D\u540C"],rolesFocus:["active_member_1","active_member_2"],successIndicators:["\u591A\u4EBA\u53C3\u8207","\u8A0E\u8AD6\u6DF1\u5165"]},{id:"phase_3",name:"\u50F9\u503C\u8F38\u51FA",duration:"\u9069\u6642",goal:"\u7E3D\u7D50\u8A0E\u8AD6\u50F9\u503C",tactics:["\u89C0\u9EDE\u7E3D\u7D50","\u7D93\u9A57\u63D0\u7149","\u77E5\u8B58\u5206\u4EAB"],rolesFocus:["opinion_leader"],successIndicators:["\u7372\u5F97\u8A8D\u53EF","\u88AB\u6536\u85CF\u8F49\u767C"]}]},customer_support:{keywords:["\u552E\u5F8C","\u554F\u984C","\u6295\u8A34","\u6545\u969C","\u4E0D\u6EFF","\u89E3\u6C7A","\u8655\u7406","\u9000"],description:"\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C",defaultRoles:[{id:"cs_agent",name:"\u5BA2\u670D\u5C08\u54E1",icon:"\u{1F3A7}",type:"frontline",purpose:"\u5FEB\u901F\u97FF\u61C9\uFF0C\u8A18\u9304\u554F\u984C",personality:"\u8010\u5FC3\u7D30\u7DFB\uFF0C\u614B\u5EA6\u597D",speakingStyle:"\u79AE\u8C8C\u5C08\u696D\uFF0C\u8868\u9054\u6B49\u610F",entryTiming:"\u554F\u984C\u51FA\u73FE\u6642\u7ACB\u5373\u97FF\u61C9",sampleMessages:["\u60A8\u597D\uFF0C\u975E\u5E38\u62B1\u6B49\u7D66\u60A8\u5E36\u4F86\u4E0D\u4FBF\uFF01","\u8ACB\u554F\u5177\u9AD4\u662F\u4EC0\u9EBC\u554F\u984C\u5462\uFF1F\u6211\u4F86\u5E6B\u60A8\u8655\u7406","\u6211\u5DF2\u7D93\u8A18\u9304\u4E0B\u4F86\u4E86\uFF0C\u99AC\u4E0A\u70BA\u60A8\u8DDF\u9032"]},{id:"tech_support",name:"\u6280\u8853\u652F\u6301",icon:"\u{1F527}",type:"technical",purpose:"\u6280\u8853\u6392\u67E5\uFF0C\u89E3\u6C7A\u554F\u984C",personality:"\u5C08\u696D\u56B4\u8B39\uFF0C\u908F\u8F2F\u6E05\u6670",speakingStyle:"\u6280\u8853\u5C08\u696D\u4F46\u6613\u61C2",entryTiming:"\u9700\u8981\u6280\u8853\u89E3\u7B54\u6642",sampleMessages:["\u6839\u64DA\u60A8\u63CF\u8FF0\u7684\u60C5\u6CC1\uFF0C\u8ACB\u60A8\u5617\u8A66\u4EE5\u4E0B\u6B65\u9A5F","\u9019\u500B\u554F\u984C\u6211\u4F86\u770B\u4E00\u4E0B\uFF0C\u7A0D\u7B49","\u627E\u5230\u539F\u56E0\u4E86\uFF0C\u662F\u56E0\u70BAXXX\uFF0C\u89E3\u6C7A\u65B9\u6848\u662F..."]},{id:"satisfaction_manager",name:"\u6EFF\u610F\u5EA6\u7D93\u7406",icon:"\u{1F60A}",type:"recovery",purpose:"\u78BA\u8A8D\u6EFF\u610F\uFF0C\u88DC\u511F\u633D\u56DE",personality:"\u6EAB\u6696\u771F\u8AA0\uFF0C\u6709\u8AA0\u610F",speakingStyle:"\u771F\u8AA0\u9053\u6B49\uFF0C\u7A4D\u6975\u88DC\u511F",entryTiming:"\u554F\u984C\u89E3\u6C7A\u5F8C",sampleMessages:["\u554F\u984C\u89E3\u6C7A\u4E86\u55CE\uFF1F\u7D66\u60A8\u9020\u6210\u4E0D\u4FBF\u771F\u7684\u5F88\u62B1\u6B49","\u70BA\u8868\u6B49\u610F\uFF0C\u6211\u5011\u70BA\u60A8\u7533\u8ACB\u4E86\u4E00\u4EFD\u5C0F\u79AE\u7269","\u4EE5\u5F8C\u6709\u4EFB\u4F55\u554F\u984C\u90FD\u53EF\u4EE5\u96A8\u6642\u627E\u6211"]}],defaultPhases:[{id:"phase_1",name:"\u5FEB\u901F\u97FF\u61C9",duration:"\u7ACB\u5373",goal:"\u7B2C\u4E00\u6642\u9593\u97FF\u61C9\uFF0C\u5B89\u64AB\u60C5\u7DD2",tactics:["\u8868\u9054\u6B49\u610F","\u78BA\u8A8D\u554F\u984C","\u8868\u793A\u91CD\u8996"],rolesFocus:["cs_agent"],successIndicators:["\u5BA2\u6236\u60C5\u7DD2\u7DE9\u548C"]},{id:"phase_2",name:"\u554F\u984C\u89E3\u6C7A",duration:"\u76E1\u5FEB",goal:"\u6392\u67E5\u4E26\u89E3\u6C7A\u554F\u984C",tactics:["\u6280\u8853\u6392\u67E5","\u63D0\u4F9B\u65B9\u6848","\u78BA\u8A8D\u89E3\u6C7A"],rolesFocus:["tech_support"],successIndicators:["\u554F\u984C\u89E3\u6C7A"]},{id:"phase_3",name:"\u6EFF\u610F\u78BA\u8A8D",duration:"\u554F\u984C\u89E3\u6C7A\u5F8C",goal:"\u78BA\u8A8D\u6EFF\u610F\uFF0C\u9069\u7576\u88DC\u511F",tactics:["\u78BA\u8A8D\u6EFF\u610F","\u88DC\u511F\u633D\u56DE","\u5EFA\u7ACB\u597D\u611F"],rolesFocus:["satisfaction_manager"],successIndicators:["\u5BA2\u6236\u6EFF\u610F","\u597D\u8A55\u53CD\u994B"]}]},brand_promotion:{keywords:["\u63A8\u5EE3","\u54C1\u724C","\u5BA3\u50B3","\u77E5\u540D\u5EA6","\u66DD\u5149","\u50B3\u64AD"],description:"\u63D0\u5347\u54C1\u724C\u77E5\u540D\u5EA6\u548C\u597D\u611F\u5EA6",defaultRoles:[{id:"brand_ambassador",name:"\u54C1\u724C\u5927\u4F7F",icon:"\u{1F3C6}",type:"promotion",purpose:"\u50B3\u64AD\u54C1\u724C\u50F9\u503C",personality:"\u5C08\u696D\u81EA\u4FE1\uFF0C\u6709\u611F\u67D3\u529B",speakingStyle:"\u7A4D\u6975\u6B63\u9762\uFF0C\u6709\u865F\u53EC\u529B",entryTiming:"\u54C1\u724C\u76F8\u95DC\u8A71\u984C",sampleMessages:["\u9019\u500B\u54C1\u724C\u6211\u4E00\u76F4\u95DC\u6CE8\uFF0C\u7406\u5FF5\u5F88\u597D","\u4ED6\u5011\u5BB6\u7684\u54C1\u8CEA\u78BA\u5BE6\u6C92\u8A71\u8AAA"]}],defaultPhases:[{id:"phase_1",name:"\u54C1\u724C\u66DD\u5149",duration:"\u6301\u7E8C",goal:"\u81EA\u7136\u50B3\u64AD\u54C1\u724C",tactics:["\u50F9\u503C\u5206\u4EAB","\u6545\u4E8B\u8B1B\u8FF0"],rolesFocus:["brand_ambassador"],successIndicators:["\u88AB\u8A0E\u8AD6","\u597D\u8A55"]}]},lead_nurturing:{keywords:["\u57F9\u80B2","\u6F5B\u5BA2","\u8DDF\u9032","\u9810\u71B1","\u6559\u80B2"],description:"\u57F9\u80B2\u6F5B\u5728\u5BA2\u6236\uFF0C\u63D0\u5347\u8CFC\u8CB7\u610F\u9858",defaultRoles:[{id:"content_sharer",name:"\u5167\u5BB9\u9054\u4EBA",icon:"\u{1F4DA}",type:"education",purpose:"\u5206\u4EAB\u6709\u50F9\u503C\u5167\u5BB9",personality:"\u77E5\u8B58\u8C50\u5BCC\uFF0C\u6A02\u65BC\u5206\u4EAB",speakingStyle:"\u6709\u6599\u6709\u8DA3\uFF0C\u4E0D\u8AAA\u6559",entryTiming:"\u6301\u7E8C",sampleMessages:["\u5206\u4EAB\u4E00\u500B\u5F88\u6709\u7528\u7684\u65B9\u6CD5","\u9019\u7BC7\u6587\u7AE0\u5BEB\u5F97\u592A\u597D\u4E86"]}],defaultPhases:[{id:"phase_1",name:"\u50F9\u503C\u8F38\u51FA",duration:"\u6301\u7E8C",goal:"\u901A\u904E\u5167\u5BB9\u5EFA\u7ACB\u4FE1\u4EFB",tactics:["\u77E5\u8B58\u5206\u4EAB","\u6848\u4F8B\u5206\u6790"],rolesFocus:["content_sharer"],successIndicators:["\u88AB\u95DC\u6CE8","\u4E3B\u52D5\u8A62\u554F"]}]},custom:{keywords:[],description:"\u81EA\u5B9A\u7FA9\u76EE\u6A19",defaultRoles:[{id:"account_manager",name:"\u5BA2\u6236\u7D93\u7406",icon:"\u{1F4BC}",type:"account_manager",purpose:"\u4E86\u89E3\u9700\u6C42\uFF0C\u5EFA\u7ACB\u95DC\u4FC2",personality:"\u5C08\u696D\u53CB\u597D\uFF0C\u5584\u65BC\u50BE\u807D",speakingStyle:"\u5C08\u696D\u4F46\u4E0D\u751F\u786C\uFF0C\u50CF\u670B\u53CB\u822C\u4EA4\u6D41",entryTiming:"\u9996\u6B21\u63A5\u89F8\u548C\u91CD\u8981\u7BC0\u9EDE",sampleMessages:["\u60A8\u597D\uFF01\u6211\u662F\u60A8\u7684\u5C08\u5C6C\u5BA2\u6236\u7D93\u7406","\u8ACB\u554F\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u5230\u60A8\u7684\u55CE\uFF1F","\u6709\u4EFB\u4F55\u554F\u984C\u90FD\u53EF\u4EE5\u96A8\u6642\u554F\u6211"]},{id:"solution_expert",name:"\u65B9\u6848\u5C08\u5BB6",icon:"\u{1F4CB}",type:"professional",purpose:"\u63D0\u4F9B\u5C08\u696D\u65B9\u6848\u548C\u5EFA\u8B70",personality:"\u5C08\u696D\u6B0A\u5A01\uFF0C\u6709\u6DF1\u5EA6",speakingStyle:"\u6E05\u6670\u7C21\u6F54\uFF0C\u91CD\u9EDE\u7A81\u51FA",entryTiming:"\u5BA2\u6236\u6709\u5177\u9AD4\u9700\u6C42\u6642",sampleMessages:["\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\uFF0C\u6211\u5EFA\u8B70...","\u9019\u500B\u65B9\u6848\u53EF\u4EE5\u6EFF\u8DB3\u60A8\u7684\u9700\u6C42","\u8B93\u6211\u4F86\u8A73\u7D30\u8AAA\u660E\u4E00\u4E0B"]}],defaultPhases:[{id:"phase_1",name:"\u4E86\u89E3\u9700\u6C42",duration:"1-2\u5929",goal:"\u5EFA\u7ACB\u806F\u7E6B\uFF0C\u4E86\u89E3\u5BA2\u6236\u9700\u6C42",tactics:["\u958B\u5834\u554F\u5019","\u9700\u6C42\u6316\u6398"],rolesFocus:["account_manager"],successIndicators:["\u5BA2\u6236\u56DE\u8986","\u8AAA\u51FA\u9700\u6C42"]},{id:"phase_2",name:"\u63D0\u4F9B\u65B9\u6848",duration:"1-2\u5929",goal:"\u6839\u64DA\u9700\u6C42\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848",tactics:["\u65B9\u6848\u4ECB\u7D39","\u50F9\u503C\u8AAA\u660E"],rolesFocus:["solution_expert"],successIndicators:["\u5BA2\u6236\u8A8D\u53EF","\u8A62\u554F\u7D30\u7BC0"]},{id:"phase_3",name:"\u4FC3\u6210\u8F49\u5316",duration:"\u9748\u6D3B",goal:"\u89E3\u7B54\u7591\u616E\uFF0C\u4FC3\u6210\u6210\u4EA4",tactics:["\u7570\u8B70\u8655\u7406","\u512A\u60E0\u4FC3\u55AE"],rolesFocus:["account_manager"],successIndicators:["\u5BA2\u6236\u540C\u610F","\u6210\u4EA4"]}]}};this.conversionSignals={high:["\u600E\u9EBC\u8CB7","\u591A\u5C11\u9322","\u50F9\u683C","\u4ED8\u6B3E","\u4E0B\u55AE","\u60F3\u8CB7","\u8CFC\u8CB7","\u8A02\u8CFC","\u4ED8\u8CBB","\u652F\u4ED8"],medium:["\u6709\u8208\u8DA3","\u60F3\u4E86\u89E3","\u4ECB\u7D39\u4E00\u4E0B","\u8A73\u7D30\u8AAA\u8AAA","\u767C\u7D66\u6211","\u6709\u4EC0\u9EBC\u512A\u60E0","\u600E\u9EBC\u4F7F\u7528"],positive:["\u4E0D\u932F","\u633A\u597D","\u6709\u9053\u7406","\u53EF\u4EE5","\u597D\u7684","\u8B1D\u8B1D","\u611F\u8B1D"],negative:["\u4E0D\u9700\u8981","\u4E0D\u7528\u4E86","\u4E0D\u611F\u8208\u8DA3","\u5225\u6253\u64FE","\u53D6\u95DC","\u62C9\u9ED1","\u9A37\u64FE"],converted:["\u8CB7\u4E86","\u5DF2\u4ED8\u6B3E","\u4ED8\u597D\u4E86","\u4E0B\u55AE\u4E86","\u6210\u4EA4","\u8A02\u597D\u4E86"]};this.setupMessageAnalysisListener()}forceUpdateExecution(e){this._currentExecution.set(E({},e)),this.persistExecution(e)}persistExecution(e){try{this.ipc.send("ai-execution:save",{id:e.id,executionType:e.chatScenario||"private",status:e.status,mode:e.mode,goal:e.goal,targetUsers:JSON.stringify(e.targetUsers||[]),roleAccounts:JSON.stringify(e.accountMatches||[]),groupId:e.groupConfig?.groupId,groupName:e.groupConfig?.groupId?`\u7FA4\u7D44 ${e.groupConfig.groupId}`:void 0,messageHistory:JSON.stringify(e.messageHistory||[]),stats:JSON.stringify(e.stats||{})})}catch(t){console.warn("[DynamicEngine] \u6301\u4E45\u5316\u57F7\u884C\u72C0\u614B\u5931\u6557:",t)}}async restoreExecutions(){try{console.log("[DynamicEngine] \u{1F504} \u5617\u8A66\u6062\u5FA9\u57F7\u884C\u72C0\u614B...");let e=await this.ipc.invoke("ai-execution:get-active");if(e&&e.executions&&e.executions.length>0){console.log(`[DynamicEngine] \u627E\u5230 ${e.executions.length} \u500B\u6D3B\u8E8D\u57F7\u884C`);for(let t of e.executions){let n={id:t.id,status:t.status==="running"?"executing":t.status,goal:t.goal||"",mode:t.mode||"hybrid",chatScenario:t.executionType||"private",targetUsers:JSON.parse(t.targetUsers||"[]"),accountMatches:JSON.parse(t.roleAccounts||"[]"),messageHistory:JSON.parse(t.messageHistory||"[]"),stats:JSON.parse(t.stats||"{}"),intent:{type:"sales_conversion",confidence:80,goal:t.goal||"",targetAudience:"\u6F5B\u5728\u5BA2\u6236",urgency:"medium",suggestedDuration:"1-2\u9031"},strategy:{id:"restored_strategy",name:"\u6062\u5FA9\u7B56\u7565",description:"\u5F9E\u6578\u64DA\u5EAB\u6062\u5FA9\u7684\u57F7\u884C\u7B56\u7565",phases:[],adjustmentRules:[],constraints:{maxDailyMessages:20,maxConsecutiveFromSameRole:3,minIntervalSeconds:30,maxIntervalSeconds:300,activeHours:{start:8,end:22},toneGuidelines:["\u53CB\u597D","\u5C08\u696D"],forbiddenTopics:[]}},roles:[],groupConfig:t.groupId?{groupId:t.groupId,chatScenario:"group"}:void 0};this._currentExecution.set(n),this._executions.update(o=>[n,...o.filter(a=>a.id!==n.id)]),console.log(`[DynamicEngine] \u2705 \u5DF2\u6062\u5FA9\u57F7\u884C: ${n.id}`)}this.toast.info(`\u{1F504} \u5DF2\u6062\u5FA9 ${e.executions.length} \u500B\u9032\u884C\u4E2D\u7684\u4EFB\u52D9`)}else console.log("[DynamicEngine] \u6C92\u6709\u9700\u8981\u6062\u5FA9\u7684\u57F7\u884C")}catch(e){console.warn("[DynamicEngine] \u6062\u5FA9\u57F7\u884C\u72C0\u614B\u5931\u6557:",e)}}setupMessageAnalysisListener(){this.ipc.on("collab:new-message",async e=>{let t=this._currentExecution();if(!t||t.status!=="running")return;let n={role:e.role||"customer",content:e.content,timestamp:new Date().toISOString(),isFromCustomer:e.isFromCustomer??!0};t.messageHistory=[...t.messageHistory||[],n],this._currentExecution.set(E({},t));let o=t.messageHistory?.length||0;o>0&&o%this.analysisInterval===0&&(console.log(`[DynamicEngine] \u89F8\u767C\u7B2C ${t.stats.analysisCount+1} \u6B21\u5206\u6790 (${o} \u689D\u6D88\u606F)`),await this.performDynamicAnalysis(t)),t.mode==="scriptless"&&e.isFromCustomer&&await this.checkConversionSignals(t,e.content)}),this.ipc.on("collab:customer-reply",async e=>{let t=this._currentExecution();t&&(t.stats.responsesReceived++,this._currentExecution.set(E({},t)),t.conversionFunnel?.currentStage==="contact"&&this.updateConversionStage(t,"response",e.content))})}async smartMatchAccountsToRoles(e,t){return this.smartMatchAccountsToRolesEnhanced(e,t,{})}async smartMatchAccountsToRolesEnhanced(e,t,n){let{allowMultiRole:o=!1,allowOffline:a=!1}=n,d=this.accountService.accounts(),u=d.filter(z=>z.status==="Online"),p={AI:1,Sender:2,Listener:3},g=u.sort((z,$)=>(p[z.role]||99)-(p[$.role]||99));if(console.log(`[DynamicEngine] \u{1F50D} Phase 3 \u5E33\u865F\u7BE9\u9078: \u5728\u7DDA ${u.length} \u500B, \u5168\u90E8\u53EF\u7528\u65BC\u591A\u89D2\u8272`),console.log("[DynamicEngine] \u{1F50D} \u53EF\u7528\u5E33\u865F\u660E\u7D30:",g.map(z=>`${z.phone}(${z.role})`)),g.length===0&&a&&(g=d.filter(z=>z.status==="Offline"&&!z.status.toLowerCase().includes("error")&&!z.status.toLowerCase().includes("banned")),g.length>0&&console.log("[DynamicEngine] \u964D\u7D1A: \u4F7F\u7528\u96E2\u7DDA\u5E33\u865F\uFF08\u9700\u8981\u5148\u9023\u7DDA\uFF09")),g.length===0)return console.log("[DynamicEngine] \u7121\u53EF\u7528\u5E33\u865F"),[];let C=[],w=new Set,A=new Map,V=!o;V&&console.log("[DynamicEngine] \u{1F512} \u56B4\u683C\u6A21\u5F0F\uFF1A\u4E00\u5E33\u865F\u4E00\u89D2\u8272");for(let z of e){let $=null;for(let K of g){if(V&&w.has(K.id)){console.log(`[DynamicEngine] \u23ED\uFE0F \u8DF3\u904E\u5DF2\u4F7F\u7528\u5E33\u865F: ${K.phone}`);continue}let Y=(A.get(K.id)||0)*20,{score:re,reasons:le}=this.calculateAccountRoleMatch(K,z,t),ue=Math.max(0,re-Y);(!$||ue>$.score)&&($={account:K,score:ue,reasons:le})}if($&&$.score>=10){w.add($.account.id),A.set($.account.id,(A.get($.account.id)||0)+1);let K=this.analyzeAccountFeatures($.account),Z=A.get($.account.id)||1;C.push({accountId:$.account.id,accountPhone:$.account.phone,accountName:$.account.name||$.account.phone,roleId:z.id,roleName:z.name,roleIcon:z.icon,matchScore:$.score,matchReasons:Z>1?[...$.reasons,`\u4E00\u865F\u591A\u89D2 (${Z} \u89D2\u8272)`]:$.reasons,accountFeatures:K})}else if($)console.log(`[DynamicEngine] \u26A1 \u5F37\u5236\u5206\u914D\u4F4E\u5206\u5E33\u865F: ${$.account.phone} (\u5206\u6578: ${$.score})`),w.add($.account.id),A.set($.account.id,(A.get($.account.id)||0)+1),C.push({accountId:$.account.id,accountPhone:$.account.phone,accountName:$.account.name||$.account.phone,roleId:z.id,roleName:z.name,roleIcon:z.icon,matchScore:$.score,matchReasons:[...$.reasons,"\u5F37\u5236\u5206\u914D(\u5206\u6578\u8F03\u4F4E)"],accountFeatures:this.analyzeAccountFeatures($.account)});else if(o&&g.length>0){let K=g[0];A.set(K.id,(A.get(K.id)||0)+1);let Z=A.get(K.id)||1;C.push({accountId:K.id,accountPhone:K.phone,accountName:K.name||K.phone,roleId:z.id,roleName:z.name,roleIcon:z.icon,matchScore:30,matchReasons:["\u81EA\u52D5\u5206\u914D",`\u4E00\u865F\u591A\u89D2 (${Z} \u89D2\u8272)`],accountFeatures:this.analyzeAccountFeatures(K)})}}this._accountMatches.set(C);let G=d.filter(z=>z.status==="Online"&&!C.some($=>$.accountId===z.id));return console.log("[DynamicEngine] \u2705 \u667A\u80FD\u5339\u914D\u7D50\u679C:",C.length,"\u500B\u5E33\u865F"),C.forEach(z=>{console.log(`  - ${z.accountPhone} \u2192 ${z.roleName} (\u5206\u6578: ${z.matchScore})`)}),G.length>0&&(console.log("[DynamicEngine] \u26A0\uFE0F \u672A\u4F7F\u7528\u7684\u5728\u7DDA\u5E33\u865F:",G.length,"\u500B"),G.forEach(z=>{let $=z.role==="Listener"?"\u76E3\u63A7\u865F(\u4FDD\u7559\u7528\u65BC\u76E3\u63A7)":w.has(z.id)?"\u5DF2\u5206\u914D\u5176\u4ED6\u89D2\u8272":"\u5339\u914D\u5206\u6578\u4E0D\u8DB3";console.log(`  - ${z.phone} (${z.role}): ${$}`)})),C}calculateAccountRoleMatch(e,t,n){let o=50,a=[];e.status==="Online"&&(o+=10,a.push("\u5E33\u865F\u5728\u7DDA"));let d=this.analyzeNameStyle(e.name),u=this.getRoleExpectedStyle(t.type);return d===u?(o+=20,a.push(`\u540D\u7A31\u98A8\u683C\u5339\u914D (${d})`)):d==="neutral"&&(o+=10,a.push("\u540D\u7A31\u98A8\u683C\u4E2D\u6027\uFF0C\u9069\u61C9\u6027\u5F37")),t.type==="professional"&&this.looksLikeProfessional(e)&&(o+=15,a.push("\u5E33\u865F\u770B\u8D77\u4F86\u5C08\u696D")),t.type==="endorsement"&&this.looksLikeFriendly(e)&&(o+=15,a.push("\u5E33\u865F\u770B\u8D77\u4F86\u89AA\u548C")),t.type==="atmosphere"&&this.looksLikeCasual(e)&&(o+=15,a.push("\u5E33\u865F\u770B\u8D77\u4F86\u8F15\u9B06")),{score:Math.min(100,o),reasons:a}}analyzeAccountFeatures(e){return{profileStyle:this.analyzeNameStyle(e.name),activityLevel:"medium",successRate:0,responseRate:0}}analyzeNameStyle(e){let t=(e||"").toLowerCase();return["manager","director","expert","consultant","\u7D93\u7406","\u9867\u554F","\u5C08\u5BB6","\u7E3D\u76E3"].some(d=>t.includes(d))?"professional":["\u5C0F","\u963F","\u54E5","\u59D0","\u5BF6","\u840C","happy","sunny","sweet"].some(d=>t.includes(d))?"friendly":["cool","chill","\u61F6","\u96A8","random","just"].some(d=>t.includes(d))?"casual":"neutral"}getRoleExpectedStyle(e){return{professional:"professional",endorsement:"friendly",atmosphere:"casual",care:"friendly",solution:"professional",retention:"professional",host:"friendly",participant:"casual",expert:"professional"}[e]||"neutral"}looksLikeProfessional(e){let t=(e.name||"").toLowerCase();return t.includes("manager")||t.includes("\u7D93\u7406")||t.includes("\u9867\u554F")||t.includes("director")||t.includes("\u7E3D\u76E3")}looksLikeFriendly(e){let t=(e.name||"").toLowerCase();return t.includes("\u5C0F")||t.includes("\u963F")||t.includes("\u59D0")||t.includes("happy")||t.includes("sunny")}looksLikeCasual(e){let t=(e.name||"").toLowerCase();return t.includes("cool")||t.includes("chill")||t.length<=3}setExecutionMode(e){this._executionMode.set(e),console.log("[DynamicEngine] \u57F7\u884C\u6A21\u5F0F\u8A2D\u7F6E\u70BA:",e)}async startFromOnePhrase(e,t="hybrid",n,o){if(!e.trim())return this.toast.error("\u8ACB\u8F38\u5165\u60A8\u7684\u76EE\u6A19"),null;this._isProcessing.set(!0),this._executionMode.set(t);let a=o?.chatScenario||"private";console.log(`[DynamicEngine] \u555F\u52D5\u6A21\u5F0F: ${t}, \u5834\u666F: ${a}`);try{let d=await this.analyzeIntent(e),u=this.generateStrategy(d),p=this.recommendRoles(d);console.log("[DynamicEngine] \u{1F50D} \u63A8\u85A6\u89D2\u8272:",p?.length,p);let g=!n||n.length<=1;g&&(console.log("[DynamicEngine] \u{1F512} \u79C1\u804A\u6A21\u5F0F\uFF1A\u9650\u5236\u70BA\u55AE\u4E00\u89D2\u8272"),p=p.slice(0,lP),this.toast.info("\u{1F4AC} \u79C1\u804A\u6A21\u5F0F\uFF1A\u4F7F\u7528\u55AE\u4E00\u89D2\u8272\u8207\u76EE\u6A19\u7528\u6236\u5C0D\u8A71"));let C=await this.smartMatchAccountsToRoles(p,d);if(console.log("[DynamicEngine] \u{1F50D} \u5E33\u865F\u5339\u914D\u7D50\u679C:",C?.length,C),C.length<p.length){let Z=p.length-C.length;if(console.warn(`[DynamicEngine] \u26A0\uFE0F \u5E33\u865F\u4E0D\u8DB3\uFF1A\u9700\u8981 ${p.length} \u500B\uFF0C\u53EA\u6709 ${C.length} \u500B`),this.toast.warning(`\u26A0\uFE0F \u5E33\u865F\u4E0D\u8DB3\uFF01\u9700\u8981\u518D\u767B\u5165 ${Z} \u500B\u5E33\u865F\u624D\u80FD\u5B8C\u6574\u57F7\u884C\u591A\u89D2\u8272\u5354\u4F5C`),!g&&C.length===0)return this.toast.error("\u274C \u6C92\u6709\u53EF\u7528\u5E33\u865F\uFF0C\u7121\u6CD5\u555F\u52D5\u3002\u8ACB\u5148\u6DFB\u52A0\u4E26\u767B\u5165\u5E33\u865F\u3002"),null;p=p.slice(0,Math.max(1,C.length))}let w=p.map(Z=>{let Y=C.find(re=>re.roleId===Z.id);return Y?P(E({},Z),{accountId:Y.accountId,accountPhone:Y.accountPhone}):Z}),A=n?.map(Z=>({id:Z.telegramId||Z.id,telegramId:Z.telegramId||Z.id,username:Z.username,firstName:Z.firstName,lastName:Z.lastName,intentScore:Z.intentScore,source:Z.source}));A&&A.length>0&&(console.log("[DynamicEngine] \u{1F3AF} \u683C\u5F0F\u5316\u76EE\u6A19\u7528\u6236:"),A.forEach(Z=>{console.log(`  - ${Z.firstName||Z.username||"unknown"}: id=${Z.id}, telegramId=${Z.telegramId}`)}));let V=A?.map(Z=>String(Z.id))||[],G=V.length>0?{totalUsers:V.length,processedUsers:0,currentUserIndex:0,currentUser:A?.[0]?{id:String(A[0].id),name:A[0].firstName||A[0].username||String(A[0].id),startTime:new Date().toISOString()}:void 0,completedUsers:[],pendingUsers:V.slice(1)}:void 0,z={id:`exec_${Date.now()}`,status:"planning",goal:e,intent:d,strategy:u,roles:w,mode:t,accountMatches:C,targetUsers:A,scriptlessConfig:t==="scriptless"?P(E({},this.defaultScriptlessConfig),{enabled:!0}):void 0,conversionFunnel:{currentStage:"contact",stageHistory:[{stage:"contact",enteredAt:new Date().toISOString(),messageCount:0}],keyMoments:[]},queue:G,groupConfig:a==="group"?{groupId:o?.groupId,roleAccounts:o?.roleAccounts,chatScenario:"group"}:void 0,chatScenario:a,stats:{startTime:new Date().toISOString(),messagesSent:0,responsesReceived:0,currentPhase:0,interestScore:0,lastAnalysis:null,analysisCount:0,rolesSwitchCount:0,autoAdjustments:0},messageHistory:[]};this._currentExecution.set(z),this._executions.update(Z=>[z,...Z]),this.persistExecution(z);let $=t==="scriptless"?"\u7121\u5287\u672C":t==="scripted"?"\u5287\u672C":"\u6DF7\u5408",K=A?.length||0;return this.toast.success(`AI \u5DF2\u7406\u89E3\u60A8\u7684\u76EE\u6A19\uFF0C${$}\u6A21\u5F0F\u6E96\u5099\u5C31\u7DD2\uFF0C\u5339\u914D\u4E86 ${C.length} \u500B\u5E33\u865F${K>0?`\uFF0C\u76EE\u6A19 ${K} \u500B\u7528\u6236`:""}`),A&&A.length>0&&setTimeout(()=>{this.beginPrivateChatExecution(z)},1500),z}catch(d){return this.toast.error("\u7B56\u5283\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66"),console.error("[DynamicEngine] Start failed:",d),null}finally{this._isProcessing.set(!1)}}async startWithMarketingStrategy(e,t){this._isProcessing.set(!0);try{console.log("[DynamicEngine] \u63A5\u6536 AI \u71DF\u92B7\u7B56\u7565:",t);let n={type:"sales_conversion",confidence:90,goal:`\u5728${t.industry}\u884C\u696D\uFF0C\u4FC3\u9032${t.targetAudience}\u6210\u4EA4`,targetAudience:t.targetAudience,productType:t.industry,urgency:"medium",suggestedDuration:"3-5\u5929"},o=this.generateEnhancedStrategy(n,t),a=this.recommendRoles(n),d={id:`exec_${Date.now()}`,status:"planning",goal:e,intent:n,strategy:o,roles:a,mode:"hybrid",stats:{startTime:new Date().toISOString(),messagesSent:0,responsesReceived:0,currentPhase:0,interestScore:0,lastAnalysis:null,analysisCount:0,rolesSwitchCount:0,autoAdjustments:0},marketingData:t};return this._currentExecution.set(d),this._executions.update(u=>[d,...u]),this.toast.success("\u{1F916} AI \u5DF2\u6574\u5408\u71DF\u92B7\u7B56\u7565\uFF0C\u6E96\u5099\u57F7\u884C\u6700\u512A\u65B9\u6848\uFF01"),d}catch(n){return this.toast.error("\u7B56\u7565\u6574\u5408\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66"),console.error("[DynamicEngine] Marketing strategy start failed:",n),null}finally{this._isProcessing.set(!1)}}generateEnhancedStrategy(e,t){let n=this.generateStrategy(e);return P(E({},n),{name:`${t.industry} - AI \u71DF\u92B7\u7B56\u7565`,description:`\u91DD\u5C0D\u300C${t.targetAudience}\u300D\u7684\u667A\u80FD\u71DF\u92B7\u7B56\u7565\uFF0C\u4F7F\u7528\u95DC\u9375\u8A5E\uFF1A${t.keywords.highIntent.slice(0,3).join("\u3001")}`,messageTemplates:t.messageTemplates,keywords:t.keywords})}async analyzeIntent(e){let t=e.toLowerCase(),n="custom",o=0;for(let[d,u]of Object.entries(this.intentTemplates)){let p=u.keywords.filter(g=>t.includes(g)).length;p>o&&(o=p,n=d)}let a=this.intentTemplates[n];return{type:n,confidence:Math.min(95,50+o*15),goal:n==="custom"?e:a.description,targetAudience:this.extractTargetAudience(t),productType:this.extractProductType(t),urgency:this.determineUrgency(t),suggestedDuration:this.suggestDuration(n)}}generateStrategy(e){let t=this.intentTemplates[e.type];return{id:`strategy_${Date.now()}`,name:`${e.goal} - \u52D5\u614B\u7B56\u7565`,description:`AI \u6839\u64DA\u300C${e.goal}\u300D\u81EA\u52D5\u751F\u6210\u7684\u52D5\u614B\u57F7\u884C\u7B56\u7565`,phases:t.defaultPhases,adjustmentRules:this.generateAdjustmentRules(e),constraints:{maxDailyMessages:50,maxConsecutiveFromSameRole:3,minIntervalSeconds:60,maxIntervalSeconds:300,activeHours:{start:9,end:22},toneGuidelines:["\u53CB\u597D\u81EA\u7136","\u4E0D\u904E\u5EA6\u63A8\u92B7","\u50CF\u670B\u53CB\u804A\u5929"],forbiddenTopics:["\u653F\u6CBB","\u654F\u611F\u8A71\u984C"]}}}recommendRoles(e){return this.intentTemplates[e.type].defaultRoles}generateAdjustmentRules(e){return[{trigger:"\u5BA2\u6236\u60C5\u7DD2\u8CA0\u9762",condition:{type:"sentiment",threshold:30},action:"\u66AB\u505C\u63A8\u92B7\uFF0C\u5207\u63DB\u5230\u95DC\u61F7\u6A21\u5F0F"},{trigger:"\u5BA2\u6236\u8A62\u554F\u50F9\u683C",condition:{type:"keyword",keywords:["\u591A\u5C11\u9322","\u50F9\u683C","\u8CBB\u7528","\u8CB4\u4E0D\u8CB4"]},action:"\u9019\u662F\u6210\u4EA4\u4FE1\u865F\uFF01\u5F15\u5165\u92B7\u552E\u5C08\u5BB6"},{trigger:"\u5BA2\u6236\u63D0\u5230\u7AF6\u54C1",condition:{type:"keyword",keywords:["\u5176\u4ED6","\u5225\u5BB6","\u7AF6\u54C1","\u5C0D\u6BD4"]},action:"\u5F15\u5165\u5C0D\u6BD4\u5206\u6790\uFF0C\u7A81\u51FA\u512A\u52E2"},{trigger:"\u5C0D\u8A71\u6C89\u9ED8",condition:{type:"silence",threshold:3600},action:"\u767C\u8D77\u65B0\u8A71\u984C\u6216\u63DB\u89D2\u8272\u6D3B\u8E8D"},{trigger:"\u8208\u8DA3\u5EA6\u4E0A\u5347",condition:{type:"interest",threshold:70},action:"\u53EF\u4EE5\u958B\u59CB\u50F9\u503C\u5C55\u793A\u548C\u4FC3\u55AE"}]}async analyzeConversation(e){let t=e.filter(p=>p.isFromCustomer),n=e.length>0?t.length/e.length*100:0,o=this.analyzeSentiment(t),a=this.extractInterests(t),d=this.calculateReadiness(t,o),u=this.generateSuggestions(o,d,a);return{timestamp:new Date().toISOString(),messageCount:e.length,userProfile:{engagementLevel:n>50?"high":n>20?"medium":"low",sentiment:o,interests:a,objections:this.extractObjections(t),readinessScore:d},conversationQuality:{responseRate:n,avgResponseTime:0,topicEngagement:{}},suggestions:u}}async generateNextMessage(e){if(!e.strategy||e.roles.length===0)return null;let t=e.stats.lastAnalysis,o=e.strategy.phases[e.stats.currentPhase]?.rolesFocus||[],a=e.roles.find(p=>o.includes(p.id))||e.roles[0],d="casual";t&&(t.userProfile.readinessScore>70?d="close":t.userProfile.objections.length>0?d="objection_handling":t.userProfile.engagementLevel==="high"&&(d="value"));let u=a.sampleMessages[Math.floor(Math.random()*a.sampleMessages.length)];return{role:a,content:u,type:d}}generateTopicSuggestions(){let t=new Date().getHours(),n=[];return t>=6&&t<10?n.push({type:"casual",content:"\u65E9\u5B89\u554F\u5019\uFF0C\u804A\u804A\u4ECA\u5929\u7684\u8A08\u5283",context:"\u65E9\u6668\u9069\u5408\u8F15\u9B06\u554F\u5019",suitableRoles:["friendly_member","community_host"]}):t>=11&&t<13?n.push({type:"life",content:"\u5348\u9910\u8A71\u984C\uFF0C\u804A\u804A\u7F8E\u98DF",context:"\u5348\u9910\u6642\u9593\u8A71\u984C",suitableRoles:["active_member_1","active_member_2"]}):t>=18&&t<20&&n.push({type:"casual",content:"\u4E0B\u73ED\u8A71\u984C\uFF0C\u804A\u804A\u4ECA\u5929\u7684\u8DA3\u4E8B",context:"\u665A\u9593\u8F15\u9B06\u804A\u5929",suitableRoles:["friendly_member"]}),n.push({type:"news",content:"\u6700\u8FD1\u7684\u71B1\u9EDE\u65B0\u805E\u8A0E\u8AD6",context:"\u53EF\u4EE5\u7D50\u5408\u7522\u54C1\u5834\u666F",suitableRoles:["opinion_leader","community_host"]}),n}getConversionFunnelStats(){let e=this._executions(),t={contact:0,response:0,interest:0,intent:0,conversion:0},n={contact:[],response:[],interest:[],intent:[],conversion:[]},o={};for(let w of e){if(!w.conversionFunnel)continue;t[w.conversionFunnel.currentStage]++;let A=w.conversionFunnel.stageHistory;for(let V=0;V<A.length-1;V++){let G=A[V],z=A[V+1],$=new Date(z.enteredAt).getTime()-new Date(G.enteredAt).getTime();n[G.stage]?.push($/1e3/60)}for(let V of w.conversionFunnel.keyMoments)o[V.trigger]=(o[V.trigger]||0)+1}let a=["contact","response","interest","intent","conversion"],d=e.length||1,u=d,p=a.map(w=>{let A=t[w],V=Math.round(u/d*100);return u=u-A+t[w],{stage:w,count:A,rate:V}}),g={};for(let[w,A]of Object.entries(n))g[w]=A.length>0?Math.round(A.reduce((V,G)=>V+G,0)/A.length):0;let C=Object.entries(o).map(([w,A])=>({trigger:w,count:A})).sort((w,A)=>A.count-w.count).slice(0,10);return{totalExecutions:e.length,funnelData:p,avgTimePerStage:g,topKeyMoments:C}}recordKeyMoment(e,t,n){let o=this._executions().find(a=>a.id===e);!o||!o.conversionFunnel||(o.conversionFunnel.keyMoments.push({message:t,trigger:n,stage:o.conversionFunnel.currentStage,timestamp:new Date().toISOString()}),this._executions.update(a=>a.map(d=>d.id===e?o:d)),this._currentExecution()?.id===e&&this._currentExecution.set(E({},o)),console.log(`[DynamicEngine] \u8A18\u9304\u95DC\u9375\u6642\u523B: ${n} - ${t.substring(0,30)}...`))}getExecutionReport(e){let t=this._executions().find(A=>A.id===e);if(!t)return null;let n=new Date(t.stats.startTime),a=(t.status==="completed"?new Date:new Date).getTime()-n.getTime(),d=Math.round(a/1e3/60),u={},p={};for(let A of t.messageHistory||[])A.isFromCustomer||(u[A.role]=(u[A.role]||0)+1);let g=t.roles.map(A=>({roleId:A.id,roleName:A.name,messageCount:u[A.id]||0,responseRate:u[A.id]>0?Math.round((p[A.id]||0)/u[A.id]*100):0})),C=(t.conversionFunnel?.stageHistory||[]).map((A,V,G)=>{let z=G[V+1],$=z?Math.round((new Date(z.enteredAt).getTime()-new Date(A.enteredAt).getTime())/1e3/60):0;return{stage:A.stage,enteredAt:A.enteredAt,duration:$>0?`${$} \u5206\u9418`:"\u9032\u884C\u4E2D"}}),w="\u9032\u884C\u4E2D";return t.status==="completed"&&(t.conversionFunnel?.currentStage==="conversion"?w="\u2705 \u8F49\u5316\u6210\u529F":t.stats.interestScore<30?w="\u274C \u672A\u8F49\u5316 - \u8208\u8DA3\u5EA6\u4F4E":w="\u23F8\uFE0F \u672A\u8F49\u5316 - \u5F85\u8DDF\u9032"),{summary:{goal:t.goal,mode:t.mode,duration:d>60?`${Math.floor(d/60)} \u5C0F\u6642 ${d%60} \u5206\u9418`:`${d} \u5206\u9418`,messagesSent:t.stats.messagesSent,responsesReceived:t.stats.responsesReceived,analysisCount:t.stats.analysisCount,finalInterestScore:t.stats.interestScore,outcome:w},rolePerformance:g,funnelProgress:C,keyMoments:t.conversionFunnel?.keyMoments||[],aiAdjustments:[]}}getOverallStats(){let e=this._executions(),t=e.filter(p=>p.status==="completed"),n=t.filter(p=>p.conversionFunnel?.currentStage==="conversion"),o=e.reduce((p,g)=>p+g.stats.messagesSent,0),a=e.reduce((p,g)=>p+g.stats.interestScore,0),d={};for(let p of e)d[p.mode]=(d[p.mode]||0)+1;let u={};for(let p of e){let g=p.goal.substring(0,20);u[g]=(u[g]||0)+1}return{totalExecutions:e.length,completedExecutions:t.length,conversionRate:t.length>0?Math.round(n.length/t.length*100):0,avgMessagesPerExecution:e.length>0?Math.round(o/e.length):0,avgInterestScore:e.length>0?Math.round(a/e.length):0,modeDistribution:Object.entries(d).map(([p,g])=>({mode:p,count:g})),topGoals:Object.entries(u).map(([p,g])=>({goal:p,count:g})).sort((p,g)=>g.count-p.count).slice(0,5)}}extractTargetAudience(e){return e.includes("\u7FA4")?"\u7FA4\u6210\u54E1":e.includes("\u5BA2\u6236")?"\u6F5B\u5728\u5BA2\u6236":e.includes("\u8001")?"\u8001\u5BA2\u6236":"\u76EE\u6A19\u7528\u6236"}extractProductType(e){return e.includes("\u8AB2\u7A0B")||e.includes("\u6559\u80B2")?"\u6559\u80B2\u8AB2\u7A0B":e.includes("\u7522\u54C1")?"\u5BE6\u9AD4\u7522\u54C1":e.includes("\u670D\u52D9")?"\u670D\u52D9\u985E":"\u7522\u54C1/\u670D\u52D9"}determineUrgency(e){return e.includes("\u99AC\u4E0A")||e.includes("\u7ACB\u5373")||e.includes("\u4ECA\u5929")?"high":e.includes("\u76E1\u5FEB")||e.includes("\u9019\u9031")?"medium":"low"}suggestDuration(e){return{sales_conversion:"3-7\u5929",churn_recovery:"1-3\u5929",community_activation:"\u6301\u7E8C\u9032\u884C",customer_support:"\u5373\u6642\u8655\u7406",brand_promotion:"\u6301\u7E8C\u9032\u884C",lead_nurturing:"2-4\u9031",custom:"\u6839\u64DA\u60C5\u6CC1\u8ABF\u6574"}[e]}analyzeSentiment(e){let t=e.map(u=>u.content).join(" "),n=["\u597D","\u68D2","\u559C\u6B61","\u8B1D\u8B1D","\u611F\u8B1D","\u8B9A","\u4E0D\u932F"],o=["\u4E0D\u597D","\u5DEE","\u5931\u671B","\u751F\u6C23","\u6295\u8A34","\u9000","\u721B"],a=n.filter(u=>t.includes(u)).length,d=o.filter(u=>t.includes(u)).length;return a>d?"positive":d>a?"negative":"neutral"}extractInterests(e){let t=[],n=e.map(o=>o.content).join(" ");return(n.includes("\u50F9\u683C")||n.includes("\u591A\u5C11\u9322"))&&t.push("\u50F9\u683C\u654F\u611F"),(n.includes("\u6548\u679C")||n.includes("\u6709\u7528\u55CE"))&&t.push("\u6548\u679C\u95DC\u6CE8"),(n.includes("\u600E\u9EBC\u7528")||n.includes("\u4F7F\u7528"))&&t.push("\u4F7F\u7528\u65B9\u6CD5"),t}extractObjections(e){let t=[],n=e.map(o=>o.content).join(" ");return(n.includes("\u592A\u8CB4")||n.includes("\u8CB4\u4E86"))&&t.push("\u50F9\u683C\u9867\u616E"),(n.includes("\u6C92\u7528")||n.includes("\u4E0D\u9700\u8981"))&&t.push("\u9700\u6C42\u4E0D\u660E\u78BA"),(n.includes("\u8003\u616E")||n.includes("\u518D\u8AAA"))&&t.push("\u6C7A\u7B56\u7336\u8C6B"),t}calculateReadiness(e,t){let n=30,o=e.map(a=>a.content).join(" ");return(o.includes("\u600E\u9EBC\u8CB7")||o.includes("\u5728\u54EA\u8CB7"))&&(n+=30),(o.includes("\u591A\u5C11\u9322")||o.includes("\u50F9\u683C"))&&(n+=20),(o.includes("\u6709\u6D3B\u52D5\u55CE")||o.includes("\u512A\u60E0"))&&(n+=15),t==="positive"&&(n+=10),(o.includes("\u4E0D\u9700\u8981")||o.includes("\u4E0D\u7528\u4E86"))&&(n-=20),t==="negative"&&(n-=15),Math.max(0,Math.min(100,n))}generateSuggestions(e,t,n){let o="continue",a="friendly_member",d="\u7E7C\u7E8C\u8F15\u9B06\u804A\u5929",u="\u4FDD\u6301\u53CB\u597D",p="\u5C0D\u8A71\u9032\u884C\u6B63\u5E38";return t>70?(o="close",a="sales_expert",d="\u7522\u54C1\u50F9\u503C\u548C\u512A\u60E0",u="\u53EF\u4EE5\u66F4\u76F4\u63A5",p="\u5BA2\u6236\u6E96\u5099\u5EA6\u9AD8\uFF0C\u53EF\u4EE5\u4FC3\u55AE"):e==="negative"?(o="pause",a="cs_agent",d="\u95DC\u5FC3\u548C\u50BE\u807D",u="\u66F4\u52A0\u6EAB\u548C\u8010\u5FC3",p="\u5BA2\u6236\u60C5\u7DD2\u8CA0\u9762\uFF0C\u9700\u8981\u95DC\u61F7"):n.includes("\u50F9\u683C\u654F\u611F")&&(o="escalate",a="sales_expert",d="\u50F9\u503C\u512A\u5148\uFF0C\u518D\u8AC7\u50F9\u683C",p="\u5BA2\u6236\u95DC\u6CE8\u50F9\u683C\uFF0C\u9700\u8981\u5F37\u8ABF\u50F9\u503C"),{nextAction:o,recommendedRole:a,topicSuggestion:d,toneAdjustment:u,reasoning:p}}async performDynamicAnalysis(e){if(!e.messageHistory||e.messageHistory.length===0)return;console.log("[DynamicEngine] \u57F7\u884C\u52D5\u614B\u5206\u6790...");let t=e.messageHistory.slice(-this.analysisInterval),n=await this.analyzeConversation(t);e.stats.lastAnalysis=n,e.stats.analysisCount++,e.stats.interestScore=n.userProfile.readinessScore;let o=this.makeAutoAdjustment(e,n);o.shouldAdjust&&(e.stats.autoAdjustments++,this.toast.info(`\u{1F4CA} \u7B2C ${e.stats.analysisCount} \u6B21\u5206\u6790: ${o.reason}`),this.ipc.send("ai-team:adjust-strategy",{executionId:e.id,adjustment:o})),this.updateFunnelFromAnalysis(e,n),this._currentExecution.set(E({},e)),this._executions.update(a=>a.map(d=>d.id===e.id?e:d))}makeAutoAdjustment(e,t){let{suggestions:n,userProfile:o}=t;if(o.readinessScore>70&&e.strategy){let a=Math.min(e.stats.currentPhase+1,e.strategy.phases.length-1);if(a>e.stats.currentPhase)return{shouldAdjust:!0,action:"advance_phase",reason:`\u5BA2\u6236\u8208\u8DA3\u5EA6 ${o.readinessScore}%\uFF0C\u63A8\u9032\u5230\u4FC3\u55AE\u968E\u6BB5`,newPhase:a}}return o.sentiment==="negative"?{shouldAdjust:!0,action:"switch_role",reason:"\u5BA2\u6236\u60C5\u7DD2\u8CA0\u9762\uFF0C\u5207\u63DB\u5230\u95DC\u61F7\u6A21\u5F0F",newRole:"cs_agent"}:o.engagementLevel==="low"&&e.stats.messagesSent>5?{shouldAdjust:!0,action:"activate_atmosphere",reason:"\u4E92\u52D5\u5EA6\u4F4E\uFF0C\u5F15\u5165\u6D3B\u8E8D\u89D2\u8272",newRole:"friendly_member"}:o.objections.includes("\u50F9\u683C\u9867\u616E")?{shouldAdjust:!0,action:"handle_objection",reason:"\u5BA2\u6236\u6709\u50F9\u683C\u9867\u616E\uFF0C\u5F15\u5165\u5C08\u5BB6\u8655\u7406",newRole:"sales_expert"}:{shouldAdjust:!1,action:"continue",reason:"\u4FDD\u6301\u7576\u524D\u7B56\u7565"}}updateFunnelFromAnalysis(e,t){if(!e.conversionFunnel)return;let{readinessScore:n,interests:o}=t.userProfile,a=e.conversionFunnel.currentStage;a==="response"&&o.length>0?this.updateConversionStage(e,"interest","\u5BA2\u6236\u8868\u73FE\u51FA\u8208\u8DA3"):a==="interest"&&n>60?this.updateConversionStage(e,"intent","\u5BA2\u6236\u6709\u8CFC\u8CB7\u610F\u5411"):a==="intent"&&n>85&&this.updateConversionStage(e,"conversion","\u5373\u5C07\u6210\u4EA4")}updateConversionStage(e,t,n){if(!e.conversionFunnel)return;let o=e.messageHistory?.length||0;e.conversionFunnel.currentStage=t,e.conversionFunnel.stageHistory.push({stage:t,enteredAt:new Date().toISOString(),messageCount:o}),e.conversionFunnel.keyMoments.push({message:n,trigger:`\u9032\u5165 ${t} \u968E\u6BB5`,stage:t,timestamp:new Date().toISOString()}),console.log(`[DynamicEngine] \u8F49\u5316\u6F0F\u6597: ${t}`,n)}detectConversionSignal(e){let t=e.toLowerCase();for(let n of this.conversionSignals.converted)if(t.includes(n))return{hasSignal:!0,signalType:"converted",matchedKeyword:n,score:100};for(let n of this.conversionSignals.high)if(t.includes(n))return{hasSignal:!0,signalType:"high",matchedKeyword:n,score:85};for(let n of this.conversionSignals.medium)if(t.includes(n))return{hasSignal:!0,signalType:"medium",matchedKeyword:n,score:60};for(let n of this.conversionSignals.positive)if(t.includes(n))return{hasSignal:!0,signalType:"positive",matchedKeyword:n,score:40};for(let n of this.conversionSignals.negative)if(t.includes(n))return{hasSignal:!0,signalType:"negative",matchedKeyword:n,score:-30};return{hasSignal:!1,signalType:null,matchedKeyword:null,score:0}}handleConversionSignal(e,t,n){switch(console.log("[DynamicEngine] \u{1F3AF} \u8F49\u5316\u4FE1\u865F:",n),e.conversionFunnel&&e.conversionFunnel.keyMoments.push({message:t.text,trigger:`${n.signalType}: ${n.matchedKeyword}`,stage:n.signalType||"unknown",timestamp:new Date().toISOString()}),n.signalType){case"converted":this.toast.success(`\u{1F389} \u5BA2\u6236 ${t.firstName||"\u7528\u6236"} \u5DF2\u6210\u4EA4\uFF01`),this.updateConversionStage(e,"conversion",t.text),this.completeCurrentUser&&this.completeCurrentUser("converted");break;case"high":this.toast.success(`\u{1F3AF} \u9AD8\u8F49\u5316\u4FE1\u865F\uFF01${t.firstName||"\u7528\u6236"}: "${n.matchedKeyword}"`),this.updateConversionStage(e,"intent",t.text),this.ipc.send("ai-team:conversion-signal",{executionId:e.id,userId:t.userId,userName:t.firstName||t.username,signal:n.matchedKeyword,signalType:n.signalType,score:n.score});break;case"medium":this.updateConversionStage(e,"interest",t.text);break;case"positive":e.conversionFunnel?.currentStage==="contact"&&this.updateConversionStage(e,"response",t.text);break;case"negative":this.toast.warning(`\u26A0\uFE0F \u5BA2\u6236 ${t.firstName||"\u7528\u6236"} \u8868\u9054\u4E86\u62D2\u7D55\u610F\u5411`);break}this._currentExecution.set(E({},e))}updateIntentScore(e,t){let n=this.detectConversionSignal(t);n.score!==0&&(e.stats.interestScore=Math.max(0,Math.min(100,(e.stats.interestScore||0)+n.score)),this._currentExecution.set(E({},e)))}async checkConversionSignals(e,t){if(!e.scriptlessConfig)return;let n=t.toLowerCase();e.scriptlessConfig.targetConversionSignals.some(d=>n.includes(d))&&(console.log("[DynamicEngine] \u6AA2\u6E2C\u5230\u8F49\u5316\u4FE1\u865F:",t),e.conversionFunnel?.keyMoments.push({message:t,trigger:"\u8F49\u5316\u4FE1\u865F",stage:"conversion_signal",timestamp:new Date().toISOString()}),this.ipc.send("ai-team:conversion-signal",{executionId:e.id,signal:t,recommendedRole:"sales_expert"}),this.toast.success("\u{1F3AF} \u6AA2\u6E2C\u5230\u8F49\u5316\u4FE1\u865F\uFF01\u6B63\u5728\u5B89\u6392\u92B7\u552E\u5C08\u5BB6\u8DDF\u9032...")),e.scriptlessConfig.exitConditions.successSignals.some(d=>n.includes(d))&&(console.log("[DynamicEngine] \u6AA2\u6E2C\u5230\u6210\u529F\u4FE1\u865F:",t),this.updateConversionStage(e,"conversion",t),this.toast.success("\u{1F389} \u606D\u559C\uFF01\u5BA2\u6236\u5DF2\u8F49\u5316\u6210\u529F\uFF01")),this._currentExecution.set(E({},e))}async generateScriptlessMessage(e){if(e.mode!=="scriptless"||!e.scriptlessConfig?.enabled)return null;let t=e.stats.lastAnalysis,n=e.messageHistory||[],o=e.stats.currentPhase,a=this.selectRoleForScriptless(e,t);if(!a)return null;let d=this.buildScriptlessPrompt(e,a,n);return new Promise(u=>{this.ipc.send("ai-team:generate-scriptless-message",{executionId:e.id,roleId:a.id,roleName:a.name,rolePersonality:a.personality,roleSpeakingStyle:a.speakingStyle,prompt:d,context:{goal:e.goal,intent:e.intent,messageCount:n.length,interestScore:e.stats.interestScore,currentStage:e.conversionFunnel?.currentStage}}),this.ipc.once("ai-team:scriptless-message-generated",p=>{p.executionId===e.id?u({roleId:a.id,roleName:a.name,content:p.content,reasoning:p.reasoning||"\u6839\u64DA\u4E0A\u4E0B\u6587\u81EA\u52D5\u751F\u6210"}):u(null)}),setTimeout(()=>u(null),3e4)})}selectRoleForScriptless(e,t){if(e.roles.length===0)return null;if(t?.suggestions.recommendedRole){let u=e.roles.find(p=>p.id===t.suggestions.recommendedRole);if(u)return u}let n=(e.messageHistory||[]).slice(-3).filter(u=>!u.isFromCustomer).map(u=>u.role),o=n[n.length-1];if(n.filter(u=>u===o).length>=3){let u=e.roles.filter(p=>p.id!==o);if(u.length>0)return u[Math.floor(Math.random()*u.length)]}let d=e.conversionFunnel?.currentStage;if(d==="interest"||d==="intent"){let u=e.roles.find(p=>p.type==="professional");if(u)return u}return e.roles[0]}buildScriptlessPrompt(e,t,n){let a=n.slice(-20).map(p=>`${p.isFromCustomer?"\u3010\u5BA2\u6236\u3011":`\u3010${p.role}\u3011`}: ${p.content}`).join(`
`),d=e.conversionFunnel?.currentStage||"contact",u={contact:"\u5EFA\u7ACB\u806F\u7E6B\uFF0C\u81EA\u7136\u958B\u5834",response:"\u4FDD\u6301\u4E92\u52D5\uFF0C\u4E86\u89E3\u9700\u6C42",interest:"\u6DF1\u5165\u4ECB\u7D39\uFF0C\u5F37\u8ABF\u50F9\u503C",intent:"\u8655\u7406\u7570\u8B70\uFF0C\u63A8\u52D5\u6C7A\u7B56",conversion:"\u4FC3\u6210\u6210\u4EA4\uFF0C\u78BA\u8A8D\u8A02\u55AE"};return`\u4F60\u662F ${t.name}\uFF0C${t.personality}\u3002

\u3010\u8AAA\u8A71\u98A8\u683C\u3011
${t.speakingStyle}

\u3010\u7576\u524D\u76EE\u6A19\u3011
${e.goal}

\u3010\u7576\u524D\u968E\u6BB5\u3011
${d} - ${u[d]||"\u7E7C\u7E8C\u5C0D\u8A71"}

\u3010\u5BA2\u6236\u8208\u8DA3\u5EA6\u3011
${e.stats.interestScore}/100

\u3010\u5C0D\u8A71\u6B77\u53F2\u3011
${a||"\uFF08\u66AB\u7121\u5C0D\u8A71\uFF09"}

\u3010\u4EFB\u52D9\u3011
\u4F5C\u70BA ${t.name}\uFF0C\u6839\u64DA\u4E0A\u4E0B\u6587\u751F\u6210\u4E00\u689D\u81EA\u7136\u7684\u56DE\u8986\u3002
- \u4FDD\u6301\u89D2\u8272\u4EBA\u8A2D
- \u63A8\u9032\u5C0D\u8A71\u76EE\u6A19
- \u4E0D\u8981\u751F\u786C\u63A8\u92B7
- \u50CF\u771F\u4EBA\u804A\u5929\u4E00\u6A23\u81EA\u7136
- \u55AE\u689D\u6D88\u606F\u4E0D\u8D85\u904E 100 \u5B57

\u8ACB\u76F4\u63A5\u8F38\u51FA\u6D88\u606F\u5167\u5BB9\uFF0C\u4E0D\u8981\u6709\u4EFB\u4F55\u524D\u7DB4\u6216\u89E3\u91CB\uFF1A`}confirmAndStart(e){let t=this._executions().find(n=>n.id===e);return t?(t.status="running",this._currentExecution.set(t),this._executions.update(n=>n.map(o=>o.id===e?t:o)),this.toast.success("AI \u5718\u968A\u5DF2\u958B\u59CB\u5DE5\u4F5C\uFF01"),this.startBackendExecution(t),!0):!1}beginPrivateChatExecution(e){if(!e.targetUsers||e.targetUsers.length===0){this.toast.warning("\u6C92\u6709\u76EE\u6A19\u7528\u6236\uFF0C\u7121\u6CD5\u958B\u59CB\u79C1\u804A");return}e.status="running",this._currentExecution.set(E({},e)),console.log("[DynamicEngine] \u{1F680} \u958B\u59CB\u79C1\u804A\u57F7\u884C:",{executionId:e.id,targetUsers:e.targetUsers.length,mode:e.mode,roles:e.roles?.length}),this.startBackendExecution(e),this.sendFirstMessageToAllUsers(e),this.toast.success(`\u{1F680} \u958B\u59CB\u79C1\u804A\u8F49\u5316\uFF01\u76EE\u6A19\uFF1A${e.targetUsers.length} \u4EBA`)}async sendFirstMessageToAllUsers(e){let t=e.targetUsers||[],n=e.accountMatches||[];if(t.length===0){console.log("[DynamicEngine] \u7121\u76EE\u6A19\u7528\u6236");return}if(n.length===0){this.toast.error("\u7121\u53EF\u7528\u5E33\u865F\u767C\u9001\u6D88\u606F");return}console.log(`[DynamicEngine] \u{1F504} \u4E26\u884C\u767C\u9001\u9996\u689D\u6D88\u606F\u7D66 ${t.length} \u500B\u76EE\u6A19\u7528\u6236`);for(let o=0;o<t.length;o++){let a=t[o],d=n[o%n.length],u=a.firstName||a.username||a.id;console.log(`[DynamicEngine] \u{1F4E4} \u767C\u9001\u7D66\u7528\u6236 ${o+1}/${t.length}: ${u}`),this.sendFirstMessageToUser(e,a,d,o),o<t.length-1&&await new Promise(p=>setTimeout(p,100+Math.random()*200))}this.toast.info(`\u{1F4E4} \u5DF2\u767C\u9001\u9996\u689D\u6D88\u606F\u7D66 ${t.length} \u500B\u76EE\u6A19\u7528\u6236`)}async sendFirstMessageToUser(e,t,n,o){let a=t.firstName||t.username||t.id,d=t.telegramId||t.id,u=await this.generateFirstTouchMessage(e,{id:d,name:a});u&&(this.ipc.send("ai-team:send-private-message",{executionId:e.id,accountId:n.accountId,accountPhone:n.accountPhone,roleId:n.roleId,roleName:n.roleName,targetUserId:d,targetUserName:a,content:u,isFirstTouch:!0,userIndex:o}),e.messageHistory||(e.messageHistory=[]),e.messageHistory.push({role:n.roleName,content:u,timestamp:new Date().toISOString(),isFromCustomer:!1}),e.stats.messagesSent++,this._currentExecution.set(E({},e)),console.log(`[DynamicEngine] \u2713 \u9996\u689D\u6D88\u606F\u5DF2\u767C\u9001\u7D66 ${a}:`,u.substring(0,50)+"..."))}async sendFirstMessage(e){let t=e.queue?.currentUser;if(!t){console.log("[DynamicEngine] \u7121\u7576\u524D\u76EE\u6A19\u7528\u6236");return}let n=e.roles?.[0],o=e.accountMatches?.find(d=>d.roleId===n?.id)||e.accountMatches?.[0];if(!o){this.toast.error("\u7121\u53EF\u7528\u5E33\u865F\u767C\u9001\u6D88\u606F");return}let a=await this.generateFirstTouchMessage(e,t);a&&(this.ipc.send("ai-team:send-private-message",{executionId:e.id,accountId:o.accountId,accountPhone:o.accountPhone,roleId:o.roleId,roleName:o.roleName,targetUserId:t.id,targetUserName:t.name,content:a,isFirstTouch:!0}),e.messageHistory||(e.messageHistory=[]),e.messageHistory.push({role:o.roleName,content:a,timestamp:new Date().toISOString(),isFromCustomer:!1}),e.stats.messagesSent++,this._currentExecution.set(E({},e)),console.log("[DynamicEngine] \u9996\u689D\u6D88\u606F\u5DF2\u767C\u9001:",a.substring(0,50)+"..."))}async generateFirstTouchMessage(e,t){return e.marketingData?.messageTemplates?.firstTouch?e.marketingData.messageTemplates.firstTouch.replace("{name}",t.name).replace("{goal}",e.goal):new Promise(n=>{let o=`\u4F60\u662F\u4E00\u500B\u5C08\u696D\u7684\u5BA2\u6236\u7D93\u7406\uFF0C\u9700\u8981\u4E3B\u52D5\u806F\u7E6B\u4E00\u4F4D\u6F5B\u5728\u5BA2\u6236\u3002

\u76EE\u6A19\uFF1A${e.goal}
\u5BA2\u6236\u540D\u7A31\uFF1A${t.name}

\u8ACB\u751F\u6210\u4E00\u689D\u7C21\u77ED\u3001\u53CB\u597D\u3001\u81EA\u7136\u7684\u9996\u6B21\u554F\u5019\u6D88\u606F\u3002\u8981\u6C42\uFF1A
1. \u4E0D\u8981\u592A\u92B7\u552E\u5316\uFF0C\u50CF\u670B\u53CB\u4E00\u6A23\u6253\u62DB\u547C
2. \u53EF\u4EE5\u63D0\u53CA\u5C0D\u65B9\u53EF\u80FD\u611F\u8208\u8DA3\u7684\u8A71\u984C
3. \u7C21\u77ED\uFF081-2\u53E5\u8A71\uFF09
4. \u5F15\u8D77\u5C0D\u65B9\u56DE\u8986\u7684\u8208\u8DA3

\u76F4\u63A5\u8F38\u51FA\u6D88\u606F\u5167\u5BB9\uFF1A`;this.ipc.send("ai:generate-text",{prompt:o,maxTokens:100,callback:"ai-team:first-message-generated"});let a=setTimeout(()=>{let u=`\u60A8\u597D\uFF01\u6211\u662F${e.roles?.[0]?.name||"\u5BA2\u6236\u7D93\u7406"}\uFF0C\u6CE8\u610F\u5230\u60A8\u53EF\u80FD\u5C0D\u6211\u5011\u7684\u670D\u52D9\u611F\u8208\u8DA3\uFF0C\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`;n(u)},5e3),d=this.ipc.on("ai-team:first-message-generated",u=>{clearTimeout(a),d(),n(u.text||"\u60A8\u597D\uFF01\u8ACB\u554F\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u60A8\u7684\u55CE\uFF1F")})})}startBackendExecution(e){console.log("[DynamicEngine] \u555F\u52D5\u5F8C\u7AEF\u57F7\u884C:",e.id,"\u6A21\u5F0F:",e.mode),console.log("[DynamicEngine] \u{1F50D} \u8ABF\u8A66 - roles:",e.roles?.length,e.roles),console.log("[DynamicEngine] \u{1F50D} \u8ABF\u8A66 - accountMatches:",e.accountMatches?.length,e.accountMatches),console.log("[DynamicEngine] \u{1F50D} \u8ABF\u8A66 - targetUsers:",e.targetUsers?.length),this.ipc.send("ai-team:start-execution",{executionId:e.id,goal:e.goal,intent:e.intent,strategy:e.strategy,roles:e.roles,marketingData:e.marketingData,mode:e.mode,accountMatches:e.accountMatches,scriptlessConfig:e.scriptlessConfig,analysisInterval:this.analysisInterval,targetUsers:e.targetUsers}),this.setupExecutionListeners(e.id),e.mode==="scriptless"&&this.startScriptlessLoop(e)}async startScriptlessLoop(e){console.log("[DynamicEngine] \u555F\u52D5\u7121\u5287\u672C\u6A21\u5F0F\u5C0D\u8A71\u5FAA\u74B0");let t=await this.generateScriptlessMessage(e);t&&(this.ipc.send("ai-team:send-scriptless-message",{executionId:e.id,roleId:t.roleId,content:t.content}),e.stats.messagesSent++,this._currentExecution.set(E({},e)))}setupExecutionListeners(e){this.ipc.on("ai-team:message-sent",t=>{t.executionId===e&&this.updateExecutionStats(e,{messagesSent:t.totalSent})}),this.ipc.on("ai-team:response-received",t=>{t.executionId===e&&this.updateExecutionStats(e,{responsesReceived:t.totalResponses,interestScore:t.interestScore})}),this.ipc.on("ai-team:phase-changed",t=>{t.executionId===e&&(this.updateExecutionStats(e,{currentPhase:t.phase}),this.toast.info(`\u{1F4CA} \u9032\u5165\u968E\u6BB5 ${t.phase+1}: ${t.phaseName}`))}),this.ipc.on("ai-team:execution-completed",t=>{t.executionId===e&&(this.updateExecutionStatus(e,"completed"),this.toast.success(`\u{1F389} \u4EFB\u52D9\u5B8C\u6210\uFF01\u767C\u9001 ${t.totalSent} \u689D\u6D88\u606F\uFF0C\u6536\u5230 ${t.totalResponses} \u500B\u56DE\u8986`))}),this.ipc.on("ai-team:customer-reply",async t=>{if(t.executionId===e){console.log("[DynamicEngine] \u6536\u5230\u5BA2\u6236\u56DE\u8986:",t.firstName,t.text?.substring(0,50)),this.updateExecutionStats(e,{responsesReceived:t.totalResponses});let n=this._currentExecution();if(n){n.messageHistory||(n.messageHistory=[]),n.messageHistory.push({role:"customer",content:t.text,timestamp:new Date().toISOString(),isFromCustomer:!0}),this._currentExecution.set(E({},n));let o=this.detectConversionSignal(t.text);o.hasSignal&&this.handleConversionSignal(n,t,o),this.updateIntentScore(n,t.text)}this.toast.info(`\u{1F4AC} \u5BA2\u6236 ${t.firstName||t.username} \u56DE\u8986\u4E86\u6D88\u606F`)}}),this.ipc.on("ai-team:trigger-next-message",async t=>{if(t.executionId===e){console.log("[DynamicEngine] \u89F8\u767C\u4E0B\u4E00\u689D\u6D88\u606F:",t.customerName);let n=this._currentExecution();if(!n||n.status!=="running"||n.mode==="scripted")return;let o=15e3+Math.random()*3e4;console.log(`[DynamicEngine] \u64EC\u4EBA\u5316\u5EF6\u9072 ${(o/1e3).toFixed(1)} \u79D2\u5F8C\u56DE\u8986`),await new Promise(C=>setTimeout(C,o));let a=this._currentExecution();if(!a||a.status!=="running")return;let d=a.messageHistory?.length||0;d>0&&d%this.analysisInterval===0&&await this.performDynamicAnalysis(a);let u=this.selectRoleForAutoReply(a,t.customerMessage),p=a.accountMatches?.find(C=>C.roleId===u?.id)||a.accountMatches?.[0];if(!p){console.log("[DynamicEngine] \u7121\u53EF\u7528\u5E33\u865F\u767C\u9001\u56DE\u8986");return}let g=await this.generateScriptlessMessage(a);g&&(this.ipc.send("ai-team:send-private-message",{executionId:a.id,accountId:p.accountId,accountPhone:p.accountPhone,roleId:p.roleId,roleName:p.roleName,targetUserId:t.customerId,targetUserName:t.customerName,content:g.content,isFirstTouch:!1}),a.messageHistory||(a.messageHistory=[]),a.messageHistory.push({role:p.roleName,content:g.content,timestamp:new Date().toISOString(),isFromCustomer:!1}),a.stats.messagesSent++,this._currentExecution.set(E({},a)))}}),this.ipc.on("ai-team:private-message-sent",t=>{t.executionId===e&&t.success&&console.log("[DynamicEngine] \u2705 \u79C1\u804A\u767C\u9001\u6210\u529F:",t.targetUserName)})}selectRoleForAutoReply(e,t){let n=e.roles||[];if(n.length===0)return;if(n.length===1)return n[0];let o=t?.toLowerCase()||"";if(o.includes("\u591A\u5C11\u9322")||o.includes("\u50F9\u683C")||o.includes("\u8CB7")||o.includes("\u4ED8\u6B3E"))return n.find(p=>p.name.includes("\u670D\u52D9")||p.name.includes("\u5C08\u54E1"))||n[0];if(o.includes("\u600E\u9EBC")||o.includes("\u5982\u4F55")||o.includes("\u4EC0\u9EBC"))return n.find(p=>p.name.includes("\u5C08\u5BB6")||p.name.includes("\u9867\u554F"))||n[0];let a=(e.messageHistory||[]).filter(p=>!p.isFromCustomer).slice(-3).map(p=>p.role),d=a[a.length-1],u=n.filter(p=>p.name!==d);return u.length>0?u[Math.floor(Math.random()*u.length)]:n[0]}updateExecutionStats(e,t){let n=this._executions().find(o=>o.id===e);n&&(n.stats=E(E({},n.stats),t),this._executions.update(o=>o.map(a=>a.id===e?n:a)),this._currentExecution()?.id===e&&this._currentExecution.set(n))}pauseExecution(e){return this.updateExecutionStatus(e,"paused")}resumeExecution(e){return this.updateExecutionStatus(e,"running")}stopExecution(e){return this.updateExecutionStatus(e,"completed")}updateExecutionStatus(e,t){let n=this._executions().find(o=>o.id===e);return n?(n.status=t,this._executions.update(o=>o.map(a=>a.id===e?n:a)),this._currentExecution()?.id===e&&this._currentExecution.set(n),!0):!1}completeCurrentUser(e){let t=this._currentExecution();if(!t?.queue?.currentUser)return!1;let n=t.queue.currentUser,o=new Date(n.startTime).getTime(),a=Math.round((Date.now()-o)/1e3);return t.queue.completedUsers.push({id:n.id,name:n.name,result:e,messagesExchanged:t.messageHistory?.length||0,duration:a}),t.queue.processedUsers++,this.ipc.send("ai-team:user-completed",{executionId:t.id,userId:n.id,result:e,duration:a}),this.moveToNextUser()}moveToNextUser(){let e=this._currentExecution();if(!e?.queue||!e.targetUsers)return!1;let t=e.queue.pendingUsers.shift();if(!t)return this.toast.success(`\u{1F389} \u6240\u6709 ${e.queue.totalUsers} \u500B\u76EE\u6A19\u7528\u6236\u8655\u7406\u5B8C\u7562\uFF01`),e.queue.currentUser=void 0,this._currentExecution.set(E({},e)),this.ipc.send("ai-team:queue-completed",{executionId:e.id,stats:{total:e.queue.totalUsers,completed:e.queue.completedUsers.length,results:this.calculateQueueResults(e.queue.completedUsers)}}),!1;let n=e.targetUsers.find(o=>String(o.id)===t);return n?(e.queue.currentUserIndex++,e.queue.currentUser={id:t,name:n.firstName||n.username||t,startTime:new Date().toISOString()},e.messageHistory=[],e.conversionFunnel={currentStage:"contact",stageHistory:[{stage:"contact",enteredAt:new Date().toISOString(),messageCount:0}],keyMoments:[]},this._currentExecution.set(E({},e)),this.ipc.send("ai-team:next-user",{executionId:e.id,userId:t,userName:e.queue.currentUser.name,userIndex:e.queue.currentUserIndex,remaining:e.queue.pendingUsers.length}),this.toast.info(`\u{1F4CB} \u958B\u59CB\u8655\u7406\u7B2C ${e.queue.currentUserIndex+1}/${e.queue.totalUsers} \u500B\u7528\u6236\uFF1A${e.queue.currentUser.name}`),!0):!1}skipCurrentUser(){return this.completeCurrentUser("no_response")}calculateQueueResults(e){let t={converted:0,interested:0,neutral:0,rejected:0,no_response:0};return e.forEach(n=>{t[n.result]!==void 0&&t[n.result]++}),t}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Fc=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.analytics=F(_n);this._sessions=f(new Map);this.sessions=R(()=>Array.from(this._sessions().values()));this.stageConfigs=new Map([["opening",{stage:"opening",primaryRole:"consultant",supportRoles:[],objectives:["\u5F15\u8D77\u6CE8\u610F","\u5EFA\u7ACB\u521D\u6B65\u806F\u7E6B"],transitionSignals:["\u7528\u6236\u56DE\u8986","\u7528\u6236\u8868\u9054\u8208\u8DA3"],suggestedMessages:[]}],["building_trust",{stage:"building_trust",primaryRole:"consultant",supportRoles:["oldcustomer"],objectives:["\u5EFA\u7ACB\u4FE1\u4EFB","\u5206\u4EAB\u6210\u529F\u6848\u4F8B"],transitionSignals:["\u7528\u6236\u8A62\u554F\u7D30\u7BC0","\u7528\u6236\u8868\u9054\u9867\u616E"],suggestedMessages:[]}],["discovering_needs",{stage:"discovering_needs",primaryRole:"consultant",supportRoles:["expert"],objectives:["\u4E86\u89E3\u7528\u6236\u9700\u6C42","\u6316\u6398\u75DB\u9EDE"],transitionSignals:["\u7528\u6236\u8AAA\u660E\u9700\u6C42","\u7528\u6236\u63D0\u51FA\u554F\u984C"],suggestedMessages:[]}],["presenting_value",{stage:"presenting_value",primaryRole:"expert",supportRoles:["consultant","oldcustomer"],objectives:["\u5C55\u793A\u7522\u54C1\u50F9\u503C","\u5339\u914D\u7528\u6236\u9700\u6C42"],transitionSignals:["\u7528\u6236\u8A8D\u53EF\u50F9\u503C","\u7528\u6236\u8A62\u554F\u50F9\u683C"],suggestedMessages:[]}],["handling_objections",{stage:"handling_objections",primaryRole:"consultant",supportRoles:["manager","oldcustomer"],objectives:["\u8655\u7406\u7528\u6236\u7591\u616E","\u89E3\u6C7A\u9867\u616E"],transitionSignals:["\u7528\u6236\u7591\u616E\u6D88\u9664","\u7528\u6236\u9858\u610F\u5617\u8A66"],suggestedMessages:[]}],["closing",{stage:"closing",primaryRole:"consultant",supportRoles:["manager"],objectives:["\u4FC3\u6210\u6210\u4EA4","\u5F15\u5C0E\u4E0B\u55AE"],transitionSignals:["\u7528\u6236\u540C\u610F\u8CFC\u8CB7","\u7528\u6236\u63D0\u4F9B\u4FE1\u606F"],suggestedMessages:[]}],["follow_up",{stage:"follow_up",primaryRole:"support",supportRoles:["consultant"],objectives:["\u552E\u5F8C\u670D\u52D9","\u5EFA\u7ACB\u9577\u671F\u95DC\u4FC2"],transitionSignals:[],suggestedMessages:[]}]]);this.roleInteractions=[{type:"agree",triggerCondition:"after_main_role_speaks",probability:.6,templates:["\u5C0D\uFF0C{\u4E3B\u89D2\u8272}\u8AAA\u5F97\u5C0D","\u6C92\u932F\uFF0C\u6211\u4E5F\u9019\u9EBC\u89BA\u5F97","\u662F\u7684\uFF0C\u9019\u9EDE\u5F88\u91CD\u8981"]},{type:"share_experience",triggerCondition:"user_shows_doubt",probability:.8,templates:["\u6211\u4E4B\u524D\u4E5F\u6709\u9019\u500B\u9867\u616E\uFF0C\u5F8C\u4F86\u7528\u4E86\u4E4B\u5F8C\u767C\u73FE\u5B8C\u5168\u6C92\u554F\u984C","\u8AAA\u5BE6\u8A71\u4E00\u958B\u59CB\u6211\u4E5F\u7336\u8C6B\uFF0C\u4F46\u7528\u4E86\u5E7E\u500B\u6708\u771F\u7684\u5F88\u7A69","\u6211\u670B\u53CB\u4ECB\u7D39\u6211\u7684\u6642\u5019\u6211\u4E5F\u4E0D\u592A\u4FE1\uFF0C\u73FE\u5728\u81EA\u5DF1\u4E5F\u5728\u63A8\u85A6\u5225\u4EBA"]},{type:"hype",triggerCondition:"user_silent_too_long",probability:.5,templates:["\u6700\u8FD1\u6D3B\u52D5\u529B\u5EA6\u633A\u5927\u7684","\u807D\u8AAA\u4E0B\u9031\u5C31\u6062\u5FA9\u539F\u50F9\u4E86","\u4ECA\u5929\u8AEE\u8A62\u7684\u4EBA\u633A\u591A\u7684"]},{type:"complement",triggerCondition:"user_asks_technical",probability:.9,templates:["\u9019\u500B\u6211\u4F86\u88DC\u5145\u4E00\u4E0B...","\u6280\u8853\u65B9\u9762\u6211\u6BD4\u8F03\u4E86\u89E3\uFF0C{\u554F\u984C}\u662F\u9019\u6A23\u7684...","\u95DC\u65BC\u9019\u500B\u554F\u984C\uFF0C\u6211\u53EF\u4EE5\u89E3\u91CB\u4E00\u4E0B..."]}];this.defaultRhythm={minIntervalSeconds:15,maxIntervalSeconds:45,waitForUserReply:!0,userSilenceTimeoutSeconds:180,roleRotationStrategy:"contextual"};this.initializeListeners()}initializeListeners(){this.ipc.on("collaboration:user-message",e=>{this.handleUserMessage(e.sessionId,e.message)}),this.ipc.on("collaboration:message-sent",e=>{e.success&&this.updateLastMessageTime(e.sessionId)})}createSession(e){let t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n=[...e.roles].sort((a,d)=>a.entryOrder-d.entryOrder),o={id:t,groupId:e.groupId,targetUserId:e.targetUserId,targetUserName:e.targetUserName,status:"initializing",roles:n,rhythm:E(E({},this.defaultRhythm),e.rhythm),currentStage:"opening",currentSpeaker:null,lastMessageTime:null,messageCount:0,userResponseCount:0,conversationHistory:[],stageHistory:[{stage:"opening",enteredAt:new Date}],interestScore:50,createdAt:new Date,updatedAt:new Date};return this._sessions.update(a=>{let d=new Map(a);return d.set(t,o),d}),console.log(`[Orchestrator] \u5275\u5EFA\u5354\u4F5C\u6703\u8A71: ${t}, \u89D2\u8272\u6578: ${n.length}`),o}async startCollaboration(e){let t=this._sessions().get(e);return t?(this.updateSession(e,{status:"active"}),await this.executeRoleEntry(t),!0):(this.toast.error("\u6703\u8A71\u4E0D\u5B58\u5728"),!1)}async executeRoleEntry(e){console.log(`[Orchestrator] \u958B\u59CB\u89D2\u8272\u5165\u5834: ${e.roles.length} \u500B\u89D2\u8272`);for(let t of e.roles){t.entryDelaySeconds>0&&(console.log(`[Orchestrator] ${t.roleName} \u7B49\u5F85 ${t.entryDelaySeconds} \u79D2\u5F8C\u5165\u5834`),await this.delay(t.entryDelaySeconds*1e3));let n=this._sessions().get(e.id);if(!n||n.status!=="active"){console.log("[Orchestrator] \u6703\u8A71\u5DF2\u505C\u6B62\uFF0C\u4E2D\u65B7\u5165\u5834");break}if(t.openingMessage)await this.sendRoleMessage(e.id,t.roleId,t.openingMessage);else{let o=this.generateOpeningMessage(t,e);await this.sendRoleMessage(e.id,t.roleId,o)}this.updateSession(e.id,{currentSpeaker:t.roleId}),console.log(`[Orchestrator] ${t.roleName} \u5DF2\u5165\u5834`)}this.startRhythmControl(e.id)}generateOpeningMessage(e,t){let n={opener:[`\u60A8\u597D ${t.targetUserName}\uFF01\u6211\u662F{\u89D2\u8272\u540D}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u60A8`,`Hi ${t.targetUserName}\uFF0C\u6211\u662F\u8CA0\u8CAC{\u89D2\u8272\u8077\u8CAC}\u7684{\u89D2\u8272\u540D}`,`${t.targetUserName} \u60A8\u597D\uFF01\u6B61\u8FCE\u52A0\u5165\uFF0C\u6211\u662F{\u89D2\u8272\u540D}`],supporter:["\u5927\u5BB6\u597D\uFF0C\u6211\u662F{\u89D2\u8272\u540D}","{\u89D2\u8272\u540D}\u4F86\u4E86\uFF0C\u6709\u554F\u984C\u53EF\u4EE5\u554F\u6211","\u6211\u662F{\u89D2\u8272\u540D}\uFF0C\u5F88\u9AD8\u8208\u80FD\u5E6B\u5230\u5927\u5BB6"],atmosphere:["\u54C8\u56C9~","\u4F86\u4E86\u4F86\u4E86","\u7D42\u65BC\u627E\u5230\u7D44\u7E54\u4E86"],closer:["\u60A8\u597D\uFF0C\u6211\u662F{\u89D2\u8272\u540D}\uFF0C\u8CA0\u8CAC\u70BA\u60A8\u8655\u7406\u5F8C\u7E8C\u4E8B\u5B9C","\u9700\u8981\u4EFB\u4F55\u5E6B\u52A9\u96A8\u6642\u627E\u6211"]},o=n[e.entryType]||n.supporter;return o[Math.floor(Math.random()*o.length)].replace("{\u89D2\u8272\u540D}",e.roleName).replace("{\u89D2\u8272\u8077\u8CAC}",this.getRolePurpose(e.roleId))}getRolePurpose(e){return{consultant:"\u696D\u52D9\u8AEE\u8A62",expert:"\u6280\u8853\u652F\u6301",oldcustomer:"\u5BA2\u6236\u670D\u52D9",support:"\u552E\u5F8C\u670D\u52D9",manager:"\u5BA2\u6236\u95DC\u4FC2",atmosphere:"\u793E\u7FA4\u4E92\u52D5"}[e]||"\u5BA2\u6236\u670D\u52D9"}async sendRoleMessage(e,t,n){let o=this._sessions().get(e);if(!o)return;let a=o.roles.find(d=>d.roleId===t);a&&(this.ipc.send("collaboration:send-message",{sessionId:e,groupId:o.groupId,targetUserId:o.targetUserId,accountPhone:a.accountPhone,content:n,roleId:t,roleName:a.roleName}),this.updateSession(e,{messageCount:o.messageCount+1,lastMessageTime:new Date,conversationHistory:[...o.conversationHistory,{role:a.roleName,content:n,timestamp:new Date,isUser:!1}]}),console.log(`[Orchestrator] [${a.roleName}]: ${n.substring(0,50)}...`))}startRhythmControl(e){let t=setInterval(()=>{let n=this._sessions().get(e);if(!n||n.status!=="active"){clearInterval(t);return}this.checkAndTriggerRoleInteraction(n)},1e4);console.log(`[Orchestrator] \u5DF2\u555F\u52D5\u7BC0\u594F\u63A7\u5236: ${e}`)}async checkAndTriggerRoleInteraction(e){if(!e.lastMessageTime)return;let t=(Date.now()-e.lastMessageTime.getTime())/1e3;if(t>e.rhythm.userSilenceTimeoutSeconds){console.log(`[Orchestrator] \u7528\u6236\u6C89\u9ED8 ${t.toFixed(0)} \u79D2\uFF0C\u89F8\u767C\u89D2\u8272\u4E92\u52D5`);let n=this.selectSupportRole(e);if(n){let o=this.selectInteraction("user_silent_too_long");if(o){let a=this.generateInteractionMessage(o,e);await this.sendRoleMessage(e.id,n.roleId,a)}}}}handleUserMessage(e,t){let n=this._sessions().get(e);if(!n)return;console.log(`[Orchestrator] \u6536\u5230\u7528\u6236\u6D88\u606F: ${t.substring(0,50)}...`),this.updateSession(e,{userResponseCount:n.userResponseCount+1,conversationHistory:[...n.conversationHistory,{role:"user",content:t,timestamp:new Date,isUser:!0}]});let o=this.analyzeUserIntent(t),a=this.calculateInterestScore(n,t);this.updateSession(e,{interestScore:a}),this.checkStageTransition(e,t,o);let d=this.selectResponder(n,o);this.triggerAIResponse(e,d,t,o)}analyzeUserIntent(e){let t=e.toLowerCase();return t.includes("\u50F9\u683C")||t.includes("\u591A\u5C11\u9322")||t.includes("\u8CBB\u7528")?"asking_price":t.includes("\u600E\u9EBC\u7528")||t.includes("\u5982\u4F55")||t.includes("\u6559\u7A0B")?"asking_usage":t.includes("\u5B89\u5168")||t.includes("\u53EF\u9760")||t.includes("\u64D4\u5FC3")?"expressing_concern":t.includes("\u597D\u7684")||t.includes("\u53EF\u4EE5")||t.includes("\u884C")?"positive_response":t.includes("\u4E0D")||t.includes("\u7B97\u4E86")||t.includes("\u518D\u8AAA")?"negative_response":"general_inquiry"}calculateInterestScore(e,t){let n=e.interestScore,o=t.toLowerCase();return o.includes("\u6709\u8208\u8DA3")||o.includes("\u60F3\u4E86\u89E3")||o.includes("\u600E\u9EBC\u8CB7")?n+=15:o.includes("\u50F9\u683C")||o.includes("\u591A\u5C11\u9322")?n+=10:o.includes("\u597D\u7684")||o.includes("\u53EF\u4EE5")?n+=5:o.includes("\u4E0D\u9700\u8981")||o.includes("\u7B97\u4E86")?n-=20:o.includes("\u518D\u8003\u616E")||o.includes("\u518D\u8AAA")?n-=10:n+=2,Math.max(0,Math.min(100,n))}checkStageTransition(e,t,n){let o=this._sessions().get(e);if(!o)return;let a=o.currentStage,d=null;switch(a){case"opening":n!=="negative_response"&&(d="building_trust");break;case"building_trust":(n==="asking_usage"||n==="asking_price")&&(d="discovering_needs");break;case"discovering_needs":o.messageCount>=6&&(d="presenting_value");break;case"presenting_value":n==="expressing_concern"?d="handling_objections":(n==="positive_response"||n==="asking_price")&&(d="closing");break;case"handling_objections":n==="positive_response"&&(d="closing");break;case"closing":n==="positive_response"&&(d="follow_up");break}d&&d!==a&&this.transitionToStage(e,d)}transitionToStage(e,t){let n=this._sessions().get(e);if(!n)return;console.log(`[Orchestrator] \u968E\u6BB5\u8F49\u63DB: ${n.currentStage} \u2192 ${t}`);let o=new Date,a=n.stageHistory[n.stageHistory.length-1];a&&(a.duration=o.getTime()-new Date(a.enteredAt).getTime()),this.updateSession(e,{currentStage:t,stageHistory:[...n.stageHistory,{stage:t,enteredAt:o}]}),this.toast.info(`\u{1F3AF} \u9032\u5165${this.getStageName(t)}\u968E\u6BB5`)}getStageName(e){return{opening:"\u958B\u5834",building_trust:"\u5EFA\u7ACB\u4FE1\u4EFB",discovering_needs:"\u767C\u73FE\u9700\u6C42",presenting_value:"\u5C55\u793A\u50F9\u503C",handling_objections:"\u8655\u7406\u7570\u8B70",closing:"\u4FC3\u6210\u6210\u4EA4",follow_up:"\u8DDF\u9032\u670D\u52D9"}[e]}selectResponder(e,t){let n=this.stageConfigs.get(e.currentStage);if(t==="asking_usage"||t.includes("technical")){let o=e.roles.find(a=>a.roleId==="expert");if(o)return o}if(t==="expressing_concern"){let o=e.roles.find(a=>a.roleId==="oldcustomer");if(o)return o}if(n){let o=e.roles.find(a=>a.roleId===n.primaryRole);if(o)return o}return e.roles[0]}selectSupportRole(e){let t=this.stageConfigs.get(e.currentStage);if(!t||t.supportRoles.length===0)return null;let n=t.supportRoles.find(o=>o!==e.currentSpeaker)||t.supportRoles[0];return e.roles.find(o=>o.roleId===n)||null}selectInteraction(e){let t=this.roleInteractions.filter(n=>n.triggerCondition===e);if(t.length===0)return null;for(let n of t)if(Math.random()<n.probability)return n;return null}generateInteractionMessage(e,t){return e.templates[Math.floor(Math.random()*e.templates.length)].replace("{\u4E3B\u89D2\u8272}",t.roles[0]?.roleName||"\u9867\u554F").replace("{\u76EE\u6A19\u7528\u6236}",t.targetUserName)}triggerAIResponse(e,t,n,o){let a=this._sessions().get(e);if(!a)return;let d=this.calculateResponseDelay(a);console.log(`[Orchestrator] \u5C07\u7531 ${t.roleName} \u5728 ${d}ms \u5F8C\u56DE\u8986`),setTimeout(()=>{this.ipc.send("collaboration:generate-response",{sessionId:e,roleId:t.roleId,roleName:t.roleName,accountPhone:t.accountPhone,userMessage:n,intent:o,stage:a.currentStage,conversationHistory:a.conversationHistory.slice(-10)})},d)}calculateResponseDelay(e){let t=e.rhythm.minIntervalSeconds*1e3,n=e.rhythm.maxIntervalSeconds*1e3;return t+Math.random()*(n-t)}updateSession(e,t){this._sessions.update(n=>{let o=n.get(e);if(!o)return n;let a=new Map(n);return a.set(e,P(E(E({},o),t),{updatedAt:new Date})),a})}updateLastMessageTime(e){this.updateSession(e,{lastMessageTime:new Date})}delay(e){return new Promise(t=>setTimeout(t,e))}stopSession(e){this.updateSession(e,{status:"paused"}),console.log(`[Orchestrator] \u6703\u8A71\u5DF2\u66AB\u505C: ${e}`)}completeSession(e,t="neutral",n){let o=this._sessions().get(e);o&&(this.updateSession(e,{status:"completed"}),this.analytics.recordSession({sessionId:o.id,targetUserId:o.targetUserId,targetUserName:o.targetUserName,roles:o.roles.map(a=>({roleId:a.roleId,roleName:a.roleName,roleType:a.entryType,accountPhone:a.accountPhone})),messages:o.conversationHistory.map(a=>({role:a.role,content:a.content,timestamp:a.timestamp,isUser:a.isUser})),outcome:t,conversionValue:n,interestScore:o.interestScore,stagesReached:o.stageHistory.map(a=>a.stage),finalStage:o.currentStage}),console.log(`[Orchestrator] \u6703\u8A71\u5DF2\u5B8C\u6210: ${e}, \u7D50\u679C: ${t}`),this.toast.success("\u{1F389} \u5354\u4F5C\u6703\u8A71\u5DF2\u5B8C\u6210"))}getSessionStats(e){let t=this._sessions().get(e);return t?{duration:Date.now()-t.createdAt.getTime(),messageCount:t.messageCount,userResponseCount:t.userResponseCount,interestScore:t.interestScore,currentStage:t.currentStage,stageHistory:t.stageHistory}:null}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Am=(i,e)=>e.id;function cP(i,e){if(i&1){let t=I();r(0,"button",43),x("click",function(){let o=_(t).$implicit,a=m();return a.editData.type=o.id,v(a.onTypeChange())}),r(1,"div",44),l(2),s(),r(3,"div",45),l(4),s()()}if(i&2){let t=e.$implicit,n=m();N("border-purple-500",n.editData.type===t.id)("bg-purple-500/10",n.editData.type===t.id)("border-transparent",n.editData.type!==t.id)("bg-slate-700",n.editData.type!==t.id),c(2),D(t.icon),c(),N("text-purple-400",n.editData.type===t.id)("text-slate-400",n.editData.type!==t.id),c(),M(" ",t.label," ")}}function dP(i,e){if(i&1){let t=I();r(0,"button",46),x("click",function(){let o=_(t).$implicit,a=m();return v(a.editData.personality.speakingStyle=o.id)}),l(1),s()}if(i&2){let t=e.$implicit,n=m();N("bg-purple-500",n.editData.personality.speakingStyle===t.id)("text-white",n.editData.personality.speakingStyle===t.id)("bg-slate-700",n.editData.personality.speakingStyle!==t.id)("text-slate-300",n.editData.personality.speakingStyle!==t.id),c(),X(" ",t.icon," ",t.label," ")}}function uP(i,e){if(i&1){let t=I();r(0,"button",47),x("click",function(){let o=_(t).$implicit,a=m();return v(a.toggleTrait(o))}),l(1),s()}if(i&2){let t=e.$implicit,n=m();N("bg-purple-500/20",n.editData.personality.traits.includes(t))("text-purple-400",n.editData.personality.traits.includes(t))("bg-slate-700",!n.editData.personality.traits.includes(t))("text-slate-400",!n.editData.personality.traits.includes(t)),c(),M(" ",t," ")}}function mP(i,e){if(i&1&&(r(0,"option",36),l(1),s()),i&2){let t=e.$implicit;L("value",t.id),c(),X(" ",t.phone," ",t.username?"(@"+t.username+")":""," ")}}function pP(i,e){i&1&&(r(0,"span",39),l(1,"\u26A0 \u8ACB\u586B\u5BEB\u5FC5\u8981\u4FE1\u606F"),s())}var Pc=class i{constructor(){this.multiRoleService=F(kt);this.role=Le(null);this.availableAccounts=Le([]);this.saved=ge();this.cancelled=ge();this.editData=this.getDefaultData();this.isNew=R(()=>!this.role());this.roleTypes=Object.entries(Tt).filter(([e])=>e!=="custom").map(([e,t])=>({id:e,icon:t.icon,label:t.label}));this.speakingStyles=[{id:"professional",icon:"\u{1F454}",label:"\u5C08\u696D\u6B63\u5F0F"},{id:"friendly",icon:"\u{1F60A}",label:"\u53CB\u597D\u89AA\u5207"},{id:"casual",icon:"\u{1F60E}",label:"\u8F15\u9B06\u96A8\u610F"},{id:"enthusiastic",icon:"\u{1F525}",label:"\u71B1\u60C5"},{id:"careful",icon:"\u{1F914}",label:"\u8B39\u614E"},{id:"curious",icon:"\u2753",label:"\u597D\u5947"}];this.availableTraits=["\u5C08\u696D","\u8010\u5FC3","\u71B1\u60C5","\u7D30\u5FC3","\u5E7D\u9ED8","\u771F\u8AA0","\u5584\u65BC\u50BE\u807D","\u5584\u65BC\u8AAA\u670D","\u908F\u8F2F\u6E05\u6670","\u7D93\u9A57\u8C50\u5BCC"];let e=this.role;e()&&this.loadRole(e())}ngOnInit(){let e=this.role();e&&this.loadRole(e)}getDefaultData(){return{name:"",type:"expert",personality:{description:"",speakingStyle:"friendly",traits:[]},aiConfig:{useGlobalAI:!0,customPrompt:Tt.expert.defaultPrompt,responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:[],isActive:!0}}loadRole(e){this.editData=P(E({},e),{personality:E({},e.personality),aiConfig:E({},e.aiConfig)})}getRoleIcon(e){return Tt[e]?.icon||"\u{1F3AD}"}onTypeChange(){let e=this.editData.type,t=Tt[e];(!this.editData.name||this.roleTypes.some(n=>n.label===this.editData.name))&&(this.editData.name=t.label),this.editData.personality.description||(this.editData.personality.description=t.description),(!this.editData.aiConfig.customPrompt||Object.values(Tt).some(n=>n.defaultPrompt===this.editData.aiConfig.customPrompt))&&(this.editData.aiConfig.customPrompt=t.defaultPrompt),this.editData.personality.speakingStyle=t.defaultStyle}toggleTrait(e){let t=this.editData.personality.traits,n=t.indexOf(e);n>=0?t.splice(n,1):t.push(e)}onAccountSelect(e){let t=this.availableAccounts().find(n=>n.id===e);t?(this.editData.boundAccountId=t.id,this.editData.boundAccountPhone=t.phone):(this.editData.boundAccountId=void 0,this.editData.boundAccountPhone=void 0)}isFormValid(){return!!(this.editData.name?.trim()&&this.editData.type&&this.editData.aiConfig?.customPrompt?.trim())}save(){if(!this.isFormValid())return;let e=P(E({},this.editData),{updatedAt:new Date().toISOString()});if(this.isNew()){let t=this.multiRoleService.addRole(e),n=this.multiRoleService.roles().find(o=>o.id===t);n&&this.saved.emit(n)}else this.multiRoleService.updateRole(this.role().id,e),this.saved.emit(E(E({},this.role()),e))}cancel(){this.cancelled.emit()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-role-editor"]],inputs:{role:[1,"role"],availableAccounts:[1,"availableAccounts"]},outputs:{saved:"saved",cancelled:"cancelled"},decls:119,vars:13,consts:[[1,"role-editor","fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","shadow-xl","border","border-slate-700"],[1,"p-6","border-b","border-slate-700","flex","items-center","justify-between"],[1,"text-xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[calc(90vh-180px)]"],[1,"mb-8"],[1,"text-sm","font-semibold","text-purple-400","mb-4","flex","items-center","gap-2"],[1,"w-6","h-6","rounded-full","bg-purple-500/20","flex","items-center","justify-center","text-xs"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"text-sm","text-slate-400","block","mb-2"],[1,"grid","grid-cols-3","gap-2"],[1,"p-2","rounded-lg","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700"],["type","text","placeholder","\u5982\uFF1A\u7522\u54C1\u5C08\u5BB6 Mira",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],["rows","2","placeholder","\u63CF\u8FF0\u9019\u500B\u89D2\u8272\u7684\u80CC\u666F\u548C\u7279\u9EDE...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none",3,"ngModelChange","ngModel"],[1,"mb-4"],[1,"flex","flex-wrap","gap-2"],[1,"px-4","py-2","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-300"],[1,"px-3","py-1.5","rounded-lg","text-sm","transition-all",3,"bg-purple-500/20","text-purple-400","bg-slate-700","text-slate-400"],["rows","4","placeholder","\u4F60\u662F\u4E00\u4F4D...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","font-mono","text-sm",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1"],[1,"grid","grid-cols-3","gap-4"],[1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"ngModelChange","ngModel"],["value","short"],["value","medium"],["value","long"],["value","none"],["value","low"],["value","high"],["value","fast"],["value","slow"],["value","random"],[1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"ngModelChange","ngModel"],[3,"value"],[1,"p-6","border-t","border-slate-700","flex","items-center","justify-between"],[1,"text-sm","text-slate-400"],[1,"text-yellow-400"],[1,"flex","gap-3"],[1,"px-6","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"px-6","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"p-2","rounded-lg","text-center","transition-all","border-2",3,"click"],[1,"text-xl","mb-0.5"],[1,"text-xs"],[1,"px-4","py-2","rounded-lg","transition-all",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-sm","transition-all",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3)(4,"span",4),l(5),s(),l(6),s(),r(7,"button",5),x("click",function(){return n.cancel()}),ne(),r(8,"svg",6),B(9,"path",7),s()()(),ce(),r(10,"div",8)(11,"div",9)(12,"h3",10)(13,"span",11),l(14,"1"),s(),l(15," \u57FA\u790E\u4FE1\u606F "),s(),r(16,"div",12)(17,"div")(18,"label",13),l(19,"\u89D2\u8272\u985E\u578B *"),s(),r(20,"div",14),O(21,cP,5,14,"button",15,Am),s()(),r(23,"div")(24,"label",13),l(25,"\u89D2\u8272\u540D\u7A31 *"),s(),r(26,"input",16),W("ngModelChange",function(a){return q(n.editData.name,a)||(n.editData.name=a),a}),s()()(),r(27,"div")(28,"label",13),l(29,"\u4EBA\u8A2D\u63CF\u8FF0"),s(),r(30,"textarea",17),W("ngModelChange",function(a){return q(n.editData.personality.description,a)||(n.editData.personality.description=a),a}),l(31,"              "),s()()(),r(32,"div",9)(33,"h3",10)(34,"span",11),l(35,"2"),s(),l(36," \u6027\u683C\u7279\u5FB5 "),s(),r(37,"div",18)(38,"label",13),l(39,"\u8AAA\u8A71\u98A8\u683C"),s(),r(40,"div",19),O(41,dP,2,10,"button",20,Am),s()(),r(43,"div")(44,"label",13),l(45,"\u6027\u683C\u6A19\u7C64"),s(),r(46,"div",19),O(47,uP,2,9,"button",21,be),s()()(),r(49,"div",9)(50,"h3",10)(51,"span",11),l(52,"3"),s(),l(53," AI \u914D\u7F6E "),s(),r(54,"div",18)(55,"label",13),l(56,"AI \u4EBA\u8A2D Prompt *"),s(),r(57,"textarea",22),W("ngModelChange",function(a){return q(n.editData.aiConfig.customPrompt,a)||(n.editData.aiConfig.customPrompt=a),a}),l(58,"              "),s(),r(59,"p",23),l(60,"\u5B9A\u7FA9\u9019\u500B\u89D2\u8272\u8AAA\u8A71\u7684\u65B9\u5F0F\u548C\u884C\u70BA\u7279\u9EDE"),s()(),r(61,"div",24)(62,"div")(63,"label",13),l(64,"\u56DE\u8986\u9577\u5EA6"),s(),r(65,"select",25),W("ngModelChange",function(a){return q(n.editData.aiConfig.responseLength,a)||(n.editData.aiConfig.responseLength=a),a}),r(66,"option",26),l(67,"\u7C21\u77ED"),s(),r(68,"option",27),l(69,"\u9069\u4E2D"),s(),r(70,"option",28),l(71,"\u8A73\u7D30"),s()()(),r(72,"div")(73,"label",13),l(74,"Emoji \u983B\u7387"),s(),r(75,"select",25),W("ngModelChange",function(a){return q(n.editData.aiConfig.emojiFrequency,a)||(n.editData.aiConfig.emojiFrequency=a),a}),r(76,"option",29),l(77,"\u4E0D\u4F7F\u7528"),s(),r(78,"option",30),l(79,"\u5076\u723E"),s(),r(80,"option",27),l(81,"\u9069\u4E2D"),s(),r(82,"option",31),l(83,"\u983B\u7E41"),s()()(),r(84,"div")(85,"label",13),l(86,"\u6253\u5B57\u901F\u5EA6"),s(),r(87,"select",25),W("ngModelChange",function(a){return q(n.editData.aiConfig.typingSpeed,a)||(n.editData.aiConfig.typingSpeed=a),a}),r(88,"option",32),l(89,"\u5FEB\u901F"),s(),r(90,"option",27),l(91,"\u4E2D\u7B49"),s(),r(92,"option",33),l(93,"\u6162\u901F"),s(),r(94,"option",34),l(95,"\u96A8\u6A5F"),s()()()()(),r(96,"div",18)(97,"h3",10)(98,"span",11),l(99,"4"),s(),l(100," \u5E33\u865F\u7D81\u5B9A "),s(),r(101,"div")(102,"label",13),l(103,"\u7D81\u5B9A Telegram \u5E33\u865F"),s(),r(104,"select",35),W("ngModelChange",function(a){return q(n.editData.boundAccountId,a)||(n.editData.boundAccountId=a),a}),x("ngModelChange",function(a){return n.onAccountSelect(a)}),r(105,"option",36),l(106,"\u66AB\u4E0D\u7D81\u5B9A"),s(),O(107,mP,2,3,"option",36,Am),s(),r(109,"p",23),l(110,"\u7D81\u5B9A\u5E33\u865F\u5F8C\uFF0C\u8A72\u89D2\u8272\u5C07\u4F7F\u7528\u6B64\u5E33\u865F\u767C\u9001\u6D88\u606F"),s()()()(),r(111,"div",37)(112,"div",38),y(113,pP,2,0,"span",39),s(),r(114,"div",40)(115,"button",41),x("click",function(){return n.cancel()}),l(116," \u53D6\u6D88 "),s(),r(117,"button",42),x("click",function(){return n.save()}),l(118),s()()()()()),t&2&&(c(5),D(n.isNew()?"\u{1F3AD}":n.getRoleIcon(n.editData.type)),c(),M(" ",n.isNew()?"\u5275\u5EFA\u65B0\u89D2\u8272":"\u7DE8\u8F2F\u89D2\u8272"," "),c(15),U(n.roleTypes),c(5),H("ngModel",n.editData.name),c(4),H("ngModel",n.editData.personality.description),c(11),U(n.speakingStyles),c(6),U(n.availableTraits),c(10),H("ngModel",n.editData.aiConfig.customPrompt),c(8),H("ngModel",n.editData.aiConfig.responseLength),c(10),H("ngModel",n.editData.aiConfig.emojiFrequency),c(12),H("ngModel",n.editData.aiConfig.typingSpeed),c(17),H("ngModel",n.editData.boundAccountId),c(),L("value",void 0),c(2),U(n.availableAccounts()),c(6),S(n.isFormValid()?-1:113),c(4),L("disabled",!n.isFormValid()),c(),M(" ",n.isNew()?"\u5275\u5EFA\u89D2\u8272":"\u4FDD\u5B58\u66F4\u6539"," "))},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he],encapsulation:2})}};var us=(i,e)=>e.id;function gP(i,e){if(i&1){let t=I();r(0,"div",37),x("click",function(){let o=_(t).$index,a=m();return v(a.selectStage(o))}),r(1,"div",38)(2,"span",39),l(3),s(),r(4,"button",40),x("click",function(o){let a=_(t).$index;return m().removeStage(a),v(o.stopPropagation())}),ne(),r(5,"svg",41),B(6,"path",9),s()()(),ce(),r(7,"div",42),l(8),s()()}if(i&2){let t=e.$implicit,n=e.$index,o=m();N("bg-purple-500/20",o.selectedStageIndex()===n)("border-purple-500",o.selectedStageIndex()===n)("border",o.selectedStageIndex()===n)("bg-slate-700/50",o.selectedStageIndex()!==n),c(2),N("text-purple-400",o.selectedStageIndex()===n)("text-white",o.selectedStageIndex()!==n),c(),X(" ",n+1,". ",t.name," "),c(5),M(" ",t.messages.length," \u689D\u6D88\u606F ")}}function hP(i,e){i&1&&(r(0,"div",28),l(1," \u9EDE\u64CA\u4E0A\u65B9\u6DFB\u52A0\u7B2C\u4E00\u500B\u968E\u6BB5 "),s())}function fP(i,e){if(i&1){let t=I();r(0,"div",50)(1,"span"),l(2,"\u5EF6\u9072"),s(),r(3,"input",56),W("ngModelChange",function(o){_(t);let a=m();return q(a.trigger.delaySeconds,o)||(a.trigger.delaySeconds=o),v(o)}),s(),r(4,"span"),l(5,"\u79D2\u5F8C\u57F7\u884C"),s()()}if(i&2){let t=m();c(3),H("ngModel",t.trigger.delaySeconds)}}function _P(i,e){if(i&1){let t=I();r(0,"div",50)(1,"span"),l(2,"\u95DC\u9375\u8A5E\uFF08\u9017\u865F\u5206\u9694\uFF09"),s(),r(3,"input",57),x("ngModelChange",function(o){_(t);let a=m(),d=m();return v(d.setKeywords(a,o))}),s()()}if(i&2){let t=m(),n=m();c(3),L("ngModel",n.getKeywordsString(t))}}function vP(i,e){if(i&1&&(r(0,"option",61),l(1),s()),i&2){let t=e.$implicit,n=m(3);L("value",t.id),c(),X(" ",n.getRoleIcon(t.type)," ",t.name," ")}}function xP(i,e){i&1&&(r(0,"div",74),l(1),s()),i&2&&(c(),op(" \u53EF\u7528\u8B8A\u91CF: ","{","\u5BA2\u6236\u540D","}",", ","{","\u7522\u54C1\u540D","}",", ","{","\u50F9\u683C","}"," "))}function CP(i,e){if(i&1){let t=I();r(0,"textarea",73),W("ngModelChange",function(o){_(t);let a=m().$implicit;return q(a.content.text,o)||(a.content.text=o),v(o)}),l(1,"                          "),s(),y(2,xP,2,6,"div",74)}if(i&2){let t=m().$implicit;H("ngModel",t.content.text),c(2),S(t.content.type==="template"?2:-1)}}function bP(i,e){if(i&1){let t=I();r(0,"textarea",75),W("ngModelChange",function(o){_(t);let a=m().$implicit;return q(a.content.aiPrompt,o)||(a.content.aiPrompt=o),v(o)}),l(1,"                          "),s()}if(i&2){let t=m().$implicit;H("ngModel",t.content.aiPrompt)}}function yP(i,e){if(i&1){let t=I();r(0,"div",52)(1,"div",58)(2,"div",59)(3,"select",60),W("ngModelChange",function(o){let a=_(t).$implicit;return q(a.roleId,o)||(a.roleId=o),v(o)}),O(4,vP,2,3,"option",61,us),s()(),r(6,"div",62)(7,"div",63)(8,"select",64),W("ngModelChange",function(o){let a=_(t).$implicit;return q(a.content.type,o)||(a.content.type=o),v(o)}),r(9,"option",65),l(10,"\u56FA\u5B9A\u6587\u672C"),s(),r(11,"option",66),l(12,"AI \u751F\u6210"),s(),r(13,"option",67),l(14,"\u6A21\u677F\u8B8A\u91CF"),s()(),r(15,"div",68)(16,"span"),l(17,"\u5EF6\u9072"),s(),r(18,"input",69),W("ngModelChange",function(o){let a=_(t).$implicit;return q(a.timing.delayAfterPrevious,o)||(a.timing.delayAfterPrevious=o),v(o)}),s(),r(19,"span"),l(20,"\u79D2"),s()()(),y(21,CP,3,2),y(22,bP,2,1,"textarea",70),s(),r(23,"button",71),x("click",function(){let o=_(t).$index,a=m(),d=m();return v(d.removeMessage(a,o))}),ne(),r(24,"svg",54),B(25,"path",72),s()()()()}if(i&2){let t=e.$implicit,n=m(2);c(3),H("ngModel",t.roleId),c(),U(n.availableRoles()),c(4),H("ngModel",t.content.type),c(10),H("ngModel",t.timing.delayAfterPrevious),c(3),S(t.content.type==="text"||t.content.type==="template"?21:-1),c(),S(t.content.type==="ai_generate"?22:-1)}}function SP(i,e){if(i&1){let t=I();r(0,"div",12)(1,"div",43)(2,"input",44),W("ngModelChange",function(o){let a=_(t);return q(a.name,o)||(a.name=o),v(o)}),s(),r(3,"select",45),W("ngModelChange",function(o){let a=_(t);return q(a.trigger.type,o)||(a.trigger.type=o),v(o)}),r(4,"option",46),l(5,"\u6642\u9593\u89F8\u767C"),s(),r(6,"option",47),l(7,"\u6D88\u606F\u89F8\u767C"),s(),r(8,"option",48),l(9,"\u95DC\u9375\u8A5E\u89F8\u767C"),s(),r(10,"option",49),l(11,"\u624B\u52D5\u89F8\u767C"),s()()(),y(12,fP,6,1,"div",50),y(13,_P,4,1,"div",50),s(),r(14,"div",51),O(15,yP,26,5,"div",52,us),r(17,"button",53),x("click",function(){let o=_(t),a=m();return v(a.addMessage(o))}),ne(),r(18,"svg",54),B(19,"path",55),s(),l(20," \u6DFB\u52A0\u6D88\u606F "),s()()}if(i&2){let t=e;c(2),H("ngModel",t.name),c(),H("ngModel",t.trigger.type),c(9),S(t.trigger.type==="time"?12:-1),c(),S(t.trigger.type==="keyword"?13:-1),c(2),U(t.messages)}}function wP(i,e){i&1&&(r(0,"div",30)(1,"div",76),l(2,"\u{1F4DD}"),s(),r(3,"div",77),l(4,"\u9078\u64C7\u6216\u5275\u5EFA\u4E00\u500B\u968E\u6BB5"),s(),r(5,"div",78),l(6,"\u5728\u5DE6\u5074\u9078\u64C7\u968E\u6BB5\u958B\u59CB\u7DE8\u8F2F"),s()())}function EP(i,e){i&1&&(r(0,"span",87),l(1,"[AI \u751F\u6210]"),s())}function DP(i,e){if(i&1&&l(0),i&2){let t=m().$implicit;M(" ",t.content.text||"..."," ")}}function AP(i,e){if(i&1&&(r(0,"div",83)(1,"div",84),l(2),s(),r(3,"div",62)(4,"div",85),l(5),s(),r(6,"div",86),y(7,EP,2,0,"span",87)(8,DP,1,1),s()()()),i&2){let t,n,o=e.$implicit,a=m(3);c(2),M(" ",a.getRoleIcon(((t=a.getRoleById(o.roleId))==null?null:t.type)||"custom")," "),c(3),M(" ",((n=a.getRoleById(o.roleId))==null?null:n.name)||"\u672A\u77E5\u89D2\u8272"," "),c(2),S(o.content.type==="ai_generate"?7:8)}}function MP(i,e){if(i&1&&(r(0,"div",81)(1,"div",82),l(2),s(),O(3,AP,9,3,"div",83,us),s()),i&2){let t=e.$implicit;c(2),D(t.name),c(),U(t.messages)}}function TP(i,e){if(i&1&&(r(0,"div",31)(1,"h4",79),l(2,"\u5C0D\u8A71\u9810\u89BD"),s(),r(3,"div",80),O(4,MP,5,1,"div",81,us),s()()),i&2){let t=m();c(4),U(t.editData.stages)}}var Rc=class i{constructor(){this.multiRoleService=F(kt);this.script=Le(null);this.saved=ge();this.cancelled=ge();this.showPreview=f(!1);this.selectedStageIndex=f(-1);this.editData=this.getDefaultData();this.isNew=R(()=>!this.script());this.availableRoles=R(()=>this.multiRoleService.roles());this.currentStage=R(()=>{let e=this.selectedStageIndex();return e>=0&&e<this.editData.stages.length?this.editData.stages[e]:null})}ngOnInit(){let e=this.script();e&&this.loadScript(e)}getDefaultData(){return{name:"",description:"",scenario:"custom",stages:[],requiredRoles:[],minRoleCount:1,stats:{useCount:0,successCount:0,avgDuration:0,conversionRate:0},isActive:!0}}loadScript(e){this.editData=P(E({},e),{stages:e.stages.map(t=>P(E({},t),{messages:t.messages.map(n=>P(E({},n),{content:E({},n.content),timing:E({},n.timing)}))}))}),this.editData.stages.length>0&&this.selectedStageIndex.set(0)}getRoleIcon(e){return Tt[e]?.icon||"\u{1F3AD}"}getRoleById(e){return this.availableRoles().find(t=>t.id===e)}selectStage(e){this.selectedStageIndex.set(e)}addStage(){let e={id:`stage_${Date.now()}`,name:`\u968E\u6BB5 ${this.editData.stages.length+1}`,order:this.editData.stages.length,trigger:{type:"time",delaySeconds:0},messages:[]};this.editData.stages.push(e),this.selectedStageIndex.set(this.editData.stages.length-1)}removeStage(e){this.editData.stages.splice(e,1),this.selectedStageIndex()>=this.editData.stages.length&&this.selectedStageIndex.set(Math.max(0,this.editData.stages.length-1))}addMessage(e){let t=this.availableRoles(),n=t.length>0?t[0].id:"",o={id:`msg_${Date.now()}`,roleId:n,content:{type:"text",text:""},timing:{delayAfterPrevious:5}};e.messages.push(o)}removeMessage(e,t){e.messages.splice(t,1)}togglePreview(){this.showPreview.update(e=>!e)}getTotalMessages(){return this.editData.stages.reduce((e,t)=>e+t.messages.length,0)}isFormValid(){return!!(this.editData.name?.trim()&&this.editData.stages.length>0&&this.editData.stages.some(e=>e.messages.length>0))}save(){if(!this.isFormValid())return;let e=new Set,t=this.availableRoles();this.editData.stages.forEach(a=>{a.messages.forEach(d=>{if(d.roleId){let u=t.find(p=>p.id===d.roleId);u&&e.add(u.type)}})}),this.editData.requiredRoles=Array.from(e);let n=this.editData.stages.reduce((a,d)=>{let u=d.trigger?.delaySeconds||0,p=d.messages.reduce((g,C)=>g+(C.timing.delayAfterPrevious||0),0);return a+u+p},0);this.editData.stats&&(this.editData.stats.avgDuration=Math.ceil(n/60));let o=P(E({},this.editData),{updatedAt:new Date().toISOString()});if(this.isNew()){let a=this.multiRoleService.addScript(o),d=this.multiRoleService.scripts().find(u=>u.id===a);d&&this.saved.emit(d)}else this.multiRoleService.updateScript(this.script().id,o),this.saved.emit(E(E({},this.script()),o))}cancel(){this.cancelled.emit()}getKeywordsString(e){return e.trigger?.keywords?.join(", ")||""}setKeywords(e,t){e.trigger.keywords=t.split(",").map(n=>n.trim()).filter(n=>n)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-script-editor"]],inputs:{script:[1,"script"]},outputs:{saved:"saved",cancelled:"cancelled"},decls:66,vars:12,consts:[[1,"script-editor","fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden","shadow-xl","border","border-slate-700"],[1,"p-6","border-b","border-slate-700","flex","items-center","justify-between"],[1,"text-xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-4"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","h-[calc(90vh-180px)]"],[1,"w-72","border-r","border-slate-700","p-4","overflow-y-auto"],[1,"mb-6"],[1,"text-sm","font-semibold","text-slate-400","mb-3"],[1,"mb-3"],[1,"text-xs","text-slate-500","block","mb-1"],["type","text","placeholder","\u5982\uFF1AVIP\u5BA2\u6236\u8F49\u5316\u5287\u672C",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-sm",3,"ngModelChange","ngModel"],["rows","2","placeholder","\u5287\u672C\u7528\u9014...",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-sm","resize-none",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-sm",3,"ngModelChange","ngModel"],["value","high_intent_conversion"],["value","product_introduction"],["value","objection_handling"],["value","custom"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-semibold","text-slate-400"],[1,"px-2","py-1","bg-purple-500/20","text-purple-400","rounded","text-xs","hover:bg-purple-500/30",3,"click"],[1,"space-y-2"],[1,"p-3","rounded-lg","cursor-pointer","transition-all",3,"bg-purple-500/20","border-purple-500","border","bg-slate-700/50"],[1,"text-center","py-8","text-slate-500","text-sm"],[1,"flex-1","p-6","overflow-y-auto"],[1,"flex","flex-col","items-center","justify-center","h-full","text-slate-500"],[1,"w-80","border-l","border-slate-700","p-4","bg-slate-900/50","overflow-y-auto"],[1,"p-6","border-t","border-slate-700","flex","items-center","justify-between"],[1,"flex","items-center","gap-4","text-sm","text-slate-400"],[1,"flex","gap-3"],[1,"px-6","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"px-6","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"p-3","rounded-lg","cursor-pointer","transition-all",3,"click"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","font-medium"],[1,"text-red-400","hover:text-red-300","opacity-0","group-hover:opacity-100",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],[1,"text-xs","text-slate-500"],[1,"flex","items-center","gap-4","mb-4"],["type","text","placeholder","\u968E\u6BB5\u540D\u7A31",1,"px-4","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","flex-1",3,"ngModelChange","ngModel"],[1,"px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-sm",3,"ngModelChange","ngModel"],["value","time"],["value","message"],["value","keyword"],["value","manual"],[1,"flex","items-center","gap-2","text-sm","text-slate-400","mb-4"],[1,"space-y-4"],[1,"bg-slate-700/50","rounded-xl","p-4","border","border-slate-600/50"],[1,"w-full","py-3","border-2","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:border-purple-500","hover:text-purple-400","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","number","min","0",1,"w-20","px-2","py-1","bg-slate-700","border","border-slate-600","rounded","text-white","text-center",3,"ngModelChange","ngModel"],["type","text","placeholder","\u8CFC\u8CB7, \u50F9\u683C, \u512A\u60E0",1,"flex-1","px-2","py-1","bg-slate-700","border","border-slate-600","rounded","text-white",3,"ngModelChange","ngModel"],[1,"flex","items-start","gap-4"],[1,"w-28"],[1,"w-full","px-2","py-1.5","bg-slate-600","border","border-slate-500","rounded","text-white","text-sm",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-2"],[1,"px-2","py-1","bg-slate-600","border","border-slate-500","rounded","text-white","text-xs",3,"ngModelChange","ngModel"],["value","text"],["value","ai_generate"],["value","template"],[1,"flex","items-center","gap-2","text-xs","text-slate-400"],["type","number","min","0",1,"w-12","px-1","py-0.5","bg-slate-600","border","border-slate-500","rounded","text-white","text-center",3,"ngModelChange","ngModel"],["rows","2","placeholder","AI \u751F\u6210\u6307\u4EE4\uFF0C\u5982\uFF1A\u6839\u64DA\u5C0D\u8A71\u4E0A\u4E0B\u6587\u56DE\u7B54\u5BA2\u6236\u554F\u984C...",1,"w-full","px-3","py-2","bg-slate-600","border","border-slate-500","rounded-lg","text-white","text-sm","resize-none",3,"ngModel"],[1,"text-red-400","hover:text-red-300","mt-1",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],["rows","2","placeholder","\u8F38\u5165\u6D88\u606F\u5167\u5BB9...",1,"w-full","px-3","py-2","bg-slate-600","border","border-slate-500","rounded-lg","text-white","text-sm","resize-none",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1"],["rows","2","placeholder","AI \u751F\u6210\u6307\u4EE4\uFF0C\u5982\uFF1A\u6839\u64DA\u5C0D\u8A71\u4E0A\u4E0B\u6587\u56DE\u7B54\u5BA2\u6236\u554F\u984C...",1,"w-full","px-3","py-2","bg-slate-600","border","border-slate-500","rounded-lg","text-white","text-sm","resize-none",3,"ngModelChange","ngModel"],[1,"text-5xl","mb-4"],[1,"text-lg","mb-2"],[1,"text-sm"],[1,"text-sm","font-semibold","text-slate-400","mb-4"],[1,"space-y-3"],[1,"mb-4"],[1,"text-xs","text-purple-400","mb-2"],[1,"flex","gap-2","mb-2"],[1,"w-8","h-8","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-white","text-xs","flex-shrink-0"],[1,"text-xs","text-slate-400","mb-0.5"],[1,"bg-slate-700","rounded-lg","px-3","py-2","text-sm","text-white"],[1,"text-purple-400"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3)(4,"span",4),l(5,"\u{1F4DD}"),s(),l(6),s(),r(7,"div",5)(8,"button",6),x("click",function(){return n.togglePreview()}),r(9,"span"),l(10,"\u{1F441}"),s(),l(11),s(),r(12,"button",7),x("click",function(){return n.cancel()}),ne(),r(13,"svg",8),B(14,"path",9),s()()()(),ce(),r(15,"div",10)(16,"div",11)(17,"div",12)(18,"h4",13),l(19,"\u5287\u672C\u4FE1\u606F"),s(),r(20,"div",14)(21,"label",15),l(22,"\u5287\u672C\u540D\u7A31"),s(),r(23,"input",16),W("ngModelChange",function(a){return q(n.editData.name,a)||(n.editData.name=a),a}),s()(),r(24,"div",14)(25,"label",15),l(26,"\u63CF\u8FF0"),s(),r(27,"textarea",17),W("ngModelChange",function(a){return q(n.editData.description,a)||(n.editData.description=a),a}),l(28,"                "),s()(),r(29,"div")(30,"label",15),l(31,"\u9069\u7528\u5834\u666F"),s(),r(32,"select",18),W("ngModelChange",function(a){return q(n.editData.scenario,a)||(n.editData.scenario=a),a}),r(33,"option",19),l(34,"\u9AD8\u610F\u5411\u8F49\u5316"),s(),r(35,"option",20),l(36,"\u7522\u54C1\u4ECB\u7D39"),s(),r(37,"option",21),l(38,"\u7570\u8B70\u8655\u7406"),s(),r(39,"option",22),l(40,"\u81EA\u5B9A\u7FA9"),s()()()(),r(41,"div")(42,"div",23)(43,"h4",24),l(44,"\u968E\u6BB5\u5217\u8868"),s(),r(45,"button",25),x("click",function(){return n.addStage()}),l(46," + \u6DFB\u52A0 "),s()(),r(47,"div",26),O(48,gP,9,15,"div",27,us),y(50,hP,2,0,"div",28),s()()(),r(51,"div",29),y(52,SP,21,4)(53,wP,7,0,"div",30),s(),y(54,TP,6,0,"div",31),s(),r(55,"div",32)(56,"div",33)(57,"span"),l(58),s(),r(59,"span"),l(60),s()(),r(61,"div",34)(62,"button",35),x("click",function(){return n.cancel()}),l(63," \u53D6\u6D88 "),s(),r(64,"button",36),x("click",function(){return n.save()}),l(65),s()()()()()),t&2){let o;c(6),M(" ",n.isNew()?"\u5275\u5EFA\u65B0\u5287\u672C":"\u7DE8\u8F2F\u5287\u672C"," "),c(5),M(" ",n.showPreview()?"\u95DC\u9589\u9810\u89BD":"\u9810\u89BD"," "),c(12),H("ngModel",n.editData.name),c(4),H("ngModel",n.editData.description),c(5),H("ngModel",n.editData.scenario),c(16),U(n.editData.stages),c(2),S(n.editData.stages.length===0?50:-1),c(2),S((o=n.currentStage())?52:53,o),c(2),S(n.showPreview()?54:-1),c(4),M("",n.editData.stages.length," \u500B\u968E\u6BB5"),c(2),M("",n.getTotalMessages()," \u689D\u6D88\u606F"),c(4),L("disabled",!n.isFormValid()),c(),M(" ",n.isNew()?"\u5275\u5EFA\u5287\u672C":"\u4FDD\u5B58\u5287\u672C"," ")}},dependencies:[oe,ae,Re,Ne,xe,Rt,Ge,ve,Nt,he],encapsulation:2})}};var kP=["conversationContainer"],Vc=()=>[],IP=(i,e)=>e.date,Lt=(i,e)=>e.id,Mm=(i,e)=>e.timestamp;function FP(i,e){if(i&1){let t=I();r(0,"div",2)(1,"div",50)(2,"div",51)(3,"div",52),l(4," \u{1F3AF} "),s(),r(5,"div",53)(6,"div",54),l(7,"\u9AD8\u8F49\u5316\u4FE1\u865F!"),s(),r(8,"div",55)(9,"span",56),l(10),s()(),r(11,"div",57),l(12),s(),r(13,"div",58)(14,"button",59),x("click",function(){_(t);let o=m();return v(o.focusOnUser(o.conversionAlertData().userId))}),l(15," \u67E5\u770B\u5C0D\u8A71 "),s(),r(16,"button",60),x("click",function(){_(t);let o=m();return v(o.dismissConversionAlert())}),l(17," \u95DC\u9589 "),s()()(),r(18,"button",61),x("click",function(){_(t);let o=m();return v(o.dismissConversionAlert())}),ne(),r(19,"svg",62),B(20,"path",63),s()()()()()}if(i&2){let t,n,o=m();c(10),D((t=o.conversionAlertData())==null?null:t.userName),c(2),D((n=o.conversionAlertData())==null?null:n.signal)}}function PP(i,e){i&1&&(r(0,"span",15),B(1,"span",64),l(2," AI \u5DF2\u9023\u63A5 "),s())}function RP(i,e){i&1&&(r(0,"span",16),l(1," \u672A\u914D\u7F6E AI "),s())}function NP(i,e){i&1&&B(0,"span",71)}function VP(i,e){if(i&1){let t=I();r(0,"button",109),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.pauseUnifiedTask(o.id))}),l(1," \u66AB\u505C "),s()}}function BP(i,e){if(i&1){let t=I();r(0,"button",110),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.startUnifiedTask(o.id))}),l(1," \u555F\u52D5 "),s()}}function LP(i,e){if(i&1&&(r(0,"div",49)(1,"div",96)(2,"div",97)(3,"div",98),l(4),s(),r(5,"div")(6,"div",99),l(7),s(),r(8,"div",100)(9,"span"),l(10),s(),r(11,"span",101),l(12,"\xB7"),s(),r(13,"span"),l(14),s(),r(15,"span",101),l(16,"\xB7"),s(),r(17,"span",102),l(18),s()()()(),r(19,"div",97)(20,"div",103)(21,"div",104),l(22),s(),r(23,"div",105),l(24,"\u8F49\u5316\u7387"),s()(),r(25,"span",106),l(26),s(),r(27,"div",25),y(28,VP,2,0,"button",107)(29,BP,2,0,"button",108),s()()()()),i&2){let t=e.$implicit,n=m(2);c(3),N("bg-emerald-500/20",t.status==="running")("bg-purple-500/20",t.status==="completed")("bg-slate-700",t.status==="draft"||t.status==="paused"),c(),M(" ",n.getGoalIcon(t.goalType)," "),c(3),D(t.name),c(3),D(n.getGoalLabel(t.goalType)),c(4),M("",t.stats.totalContacts," \u76EE\u6A19"),c(4),M("",t.stats.converted," \u8F49\u5316"),c(3),N("text-emerald-400",t.stats.conversionRate>=20)("text-amber-400",t.stats.conversionRate>=10&&t.stats.conversionRate<20)("text-slate-400",t.stats.conversionRate<10),c(),M(" ",t.stats.conversionRate||0,"% "),c(3),N("bg-emerald-500/20",t.status==="running")("text-emerald-400",t.status==="running")("bg-purple-500/20",t.status==="completed")("text-purple-400",t.status==="completed")("bg-yellow-500/20",t.status==="paused")("text-yellow-400",t.status==="paused")("bg-slate-600",t.status==="draft")("text-slate-300",t.status==="draft"),c(),M(" ",n.getTaskStatusLabel(t.status)," "),c(2),S(t.status==="running"?28:t.status==="paused"||t.status==="draft"?29:-1)}}function OP(i,e){if(i&1){let t=I();r(0,"div",46)(1,"div",111),l(2,"\u{1F4CB}"),s(),r(3,"div"),l(4,"\u66AB\u7121\u71DF\u92B7\u4EFB\u52D9"),s(),r(5,"button",112),x("click",function(){_(t);let o=m(2);return v(o.goToSmartMarketingHub())}),l(6," \u{1F680} \u5275\u5EFA\u7B2C\u4E00\u500B\u4EFB\u52D9 "),s()()}}function UP(i,e){if(i&1){let t=I();r(0,"div",65)(1,"div",66)(2,"div",67),l(3),s(),r(4,"div",68),l(5,"\u7E3D\u4EFB\u52D9\u6578"),s()(),r(6,"div",69)(7,"div",30)(8,"div",70),l(9),s(),y(10,NP,1,0,"span",71),s(),r(11,"div",68),l(12,"\u57F7\u884C\u4E2D"),s()(),r(13,"div",72)(14,"div",73),l(15),s(),r(16,"div",68),l(17,"\u7E3D\u63A5\u89F8"),s()(),r(18,"div",74)(19,"div",75),l(20),s(),r(21,"div",68),l(22,"\u7E3D\u8F49\u5316"),s()(),r(23,"div",76)(24,"div",77),l(25),s(),r(26,"div",68),l(27,"\u8F49\u5316\u7387"),s(),r(28,"div",78),B(29,"div",79),s()(),r(30,"div",80)(31,"div",81),l(32),s(),r(33,"div",68),l(34,"\u6D88\u606F\u767C\u9001"),s()()(),r(35,"div",82)(36,"div",23)(37,"h3",83)(38,"span"),l(39,"\u{1F9E0}"),s(),l(40," AI \u7CFB\u7D71\u72C0\u614B "),s(),r(41,"div",84),l(42," \u4ECA\u65E5\u7D71\u8A08 "),s()(),r(43,"div",85)(44,"div",86)(45,"div",87),l(46),s(),r(47,"div",88),l(48,"\u5C0D\u8A71\u6578"),s()(),r(49,"div",86)(50,"div",89),l(51),s(),r(52,"div",88),l(53,"\u610F\u5716\u8B58\u5225"),s()(),r(54,"div",86)(55,"div",90),l(56),s(),r(57,"div",88),l(58,"AI \u8F49\u5316"),s()(),r(59,"div",86)(60,"div",91),l(61),s(),r(62,"div",88),l(63,"\u97FF\u61C9\u6642\u9593"),s()(),r(64,"div",86)(65,"div",92),l(66),s(),r(67,"div",88),l(68,"AI \u6210\u672C"),s()()()(),r(69,"div",38)(70,"div",93)(71,"h3",83)(72,"span"),l(73,"\u{1F4CB}"),s(),l(74," \u71DF\u92B7\u4EFB\u52D9 "),s(),r(75,"div",30)(76,"span",43),l(77),s(),r(78,"button",94),x("click",function(){_(t);let o=m();return v(o.goToSmartMarketingHub())}),l(79," + \u65B0\u5EFA\u4EFB\u52D9 "),s()()(),r(80,"div",95),O(81,LP,30,36,"div",49,Lt),y(83,OP,7,0,"div",46),s()()}if(i&2){let t=m();c(3),D(t.unifiedStats().totalTasks),c(6),D(t.unifiedStats().activeTasks),c(),S(t.unifiedStats().activeTasks>0?10:-1),c(5),D(t.unifiedStats().totalContacted),c(5),D(t.unifiedStats().totalConverted),c(5),M("",t.unifiedConversionRate(),"%"),c(4),ee("width",t.unifiedConversionRate(),"%"),c(3),D(t.unifiedStats().totalMessagesSent),c(14),D(t.aiStats().today.conversations),c(5),D(t.aiStats().today.intentsRecognized),c(5),D(t.aiStats().today.conversions),c(5),M("",t.aiStats().today.avgResponseTime,"ms"),c(5),M("\xA5",t.aiStats().today.cost.toFixed(2)),c(11),M("",t.unifiedTasks().length," \u500B\u4EFB\u52D9"),c(4),U(t.unifiedTasks().slice(0,10)),c(2),S(t.unifiedTasks().length===0?83:-1)}}function GP(i,e){i&1&&B(0,"span",71)}function $P(i,e){if(i&1&&(r(0,"div",17)(1,"div",66)(2,"div",113),l(3),s(),r(4,"div",68),l(5,"\u7E3D\u7FA4\u7D44\u6578"),s(),r(6,"div",114),l(7),s()(),r(8,"div",69)(9,"div",30)(10,"div",115),l(11),s(),y(12,GP,1,0,"span",71),s(),r(13,"div",68),l(14,"\u6D3B\u8E8D\u5354\u4F5C"),s(),r(15,"div",116),l(16," \u904B\u884C\u4E2D "),s()(),r(17,"div",72)(18,"div",117),l(19),s(),r(20,"div",68),l(21,"\u5DF2\u5B8C\u6210"),s(),r(22,"div",118),l(23," \u6B77\u53F2\u7D2F\u8A08 "),s()(),r(24,"div",74)(25,"div",119),l(26),s(),r(27,"div",68),l(28,"\u6210\u529F\u8F49\u5316"),s(),r(29,"div",120),l(30),s()(),r(31,"div",76)(32,"div",121),l(33),Ee(34,"number"),s(),r(35,"div",68),l(36,"\u8F49\u5316\u7387"),s(),r(37,"div",122),B(38,"div",123),s()()()),i&2){let t=m();c(3),D(t.stats().totalGroups),c(4),M(" \u4ECA\u65E5 +",t.stats().todayGroups," "),c(4),D(t.stats().activeGroups),c(),S(t.stats().activeGroups>0?12:-1),c(7),D(t.stats().completedGroups),c(7),D(t.stats().totalConversions),c(4),M(" \u4ECA\u65E5 +",t.stats().todayConversions," "),c(3),M("",yt(34,10,t.stats().conversionRate,"1.1-1"),"%"),c(5),ee("width",t.stats().conversionRate,"%")}}function HP(i,e){if(i&1){let t=I();r(0,"button",110),x("click",function(){_(t);let o=m(2);return v(o.resumeExecution())}),l(1," \u25B6\uFE0F \u6062\u5FA9 "),s()}}function qP(i,e){if(i&1){let t=I();r(0,"button",143),x("click",function(){_(t);let o=m(2);return v(o.pauseExecution())}),l(1," \u23F8\uFE0F \u66AB\u505C "),s()}}function WP(i,e){i&1&&B(0,"div",149)}function zP(i,e){if(i&1&&(r(0,"div",146),B(1,"div",147),r(2,"div",148),l(3),s()(),y(4,WP,1,0,"div",149)),i&2){let t=e.$implicit,n=e.$index,o=e.$count,a=m(3);c(),N("bg-emerald-500",a.isStageCompleted(t.id))("bg-purple-500",a.isCurrentStage(t.id))("bg-slate-700",!a.isStageCompleted(t.id)&&!a.isCurrentStage(t.id)),c(),N("text-emerald-400",a.isStageCompleted(t.id))("text-purple-400",a.isCurrentStage(t.id))("text-slate-500",!a.isStageCompleted(t.id)&&!a.isCurrentStage(t.id)),c(),M(" ",t.label," "),c(),S(n!==o-1?4:-1)}}function KP(i,e){if(i&1&&(r(0,"div",135)(1,"div",144),l(2,"\u8F49\u5316\u6F0F\u6597"),s(),r(3,"div",145),O(4,zP,5,14,null,null,Lt),s()()),i&2){let t=m(2);c(4),U(t.conversionStages)}}function jP(i,e){if(i&1){let t=I();r(0,"div",154)(1,"div",30),B(2,"span",157),r(3,"span",158),l(4),s()(),r(5,"div",25)(6,"button",159),x("click",function(){_(t);let o=m(3);return v(o.skipCurrentUser())}),l(7," \u8DF3\u904E "),s(),r(8,"button",160),x("click",function(){_(t);let o=m(3);return v(o.markAsConverted())}),l(9," \u6A19\u8A18\u8F49\u5316 "),s()()()}if(i&2){let t,n=m(3);c(4),M("\u6B63\u5728\u8655\u7406\uFF1A",(t=n.queueProgress())==null||t.current==null?null:t.current.name)}}function JP(i,e){if(i&1&&(r(0,"span",163),l(1),s()),i&2){let t=m(4);c(),M(" \u{1F3AF} \u8F49\u5316 ",t.getResultCount("converted")," ")}}function QP(i,e){if(i&1&&(r(0,"span",164),l(1),s()),i&2){let t=m(4);c(),M(" \u2B50 \u6709\u8208\u8DA3 ",t.getResultCount("interested")," ")}}function YP(i,e){if(i&1&&(r(0,"span",165),l(1),s()),i&2){let t=m(4);c(),M(" \u{1F610} \u4E2D\u7ACB ",t.getResultCount("neutral")," ")}}function XP(i,e){if(i&1&&(r(0,"span",166),l(1),s()),i&2){let t=m(4);c(),M(" \u274C \u62D2\u7D55 ",t.getResultCount("rejected")," ")}}function ZP(i,e){if(i&1&&(r(0,"span",167),l(1),s()),i&2){let t=m(4);c(),M(" \u{1F4A4} \u7121\u56DE\u61C9 ",t.getResultCount("no_response")," ")}}function eR(i,e){if(i&1){let t=I();r(0,"div",156)(1,"div",161),l(2,"\u8655\u7406\u7D50\u679C"),s(),r(3,"div",162),y(4,JP,2,1,"span",163),y(5,QP,2,1,"span",164),y(6,YP,2,1,"span",165),y(7,XP,2,1,"span",166),y(8,ZP,2,1,"span",167),s(),r(9,"button",168),x("click",function(){_(t);let o=m(3);return v(o.showResultsPanel.set(!0))}),l(10," \u67E5\u770B\u8A73\u7D30\u7D50\u679C \u2192 "),s()()}if(i&2){let t=m(3);c(4),S(t.getResultCount("converted")>0?4:-1),c(),S(t.getResultCount("interested")>0?5:-1),c(),S(t.getResultCount("neutral")>0?6:-1),c(),S(t.getResultCount("rejected")>0?7:-1),c(),S(t.getResultCount("no_response")>0?8:-1)}}function tR(i,e){if(i&1&&(r(0,"div",136)(1,"div",137)(2,"div",43),l(3,"\u968A\u5217\u9032\u5EA6"),s(),r(4,"div",150),l(5),r(6,"span",151),l(7),s()()(),r(8,"div",152),B(9,"div",153),s(),y(10,jP,10,1,"div",154),r(11,"div",155),l(12),s(),y(13,eR,11,5,"div",156),s()),i&2){let t,n,o,a,d,u,p=m(2);c(5),X(" ",(t=p.queueProgress())==null?null:t.processed,"/",(t=p.queueProgress())==null?null:t.total," "),c(2),M("(",(n=p.queueProgress())==null?null:n.progress,"%)"),c(2),ee("width",((o=p.queueProgress())==null?null:o.progress)||0,"%"),c(),S((a=p.queueProgress())!=null&&a.current?10:-1),c(2),M(" \u5F85\u8655\u7406\uFF1A",(d=p.queueProgress())==null?null:d.pending," \u4EBA "),c(),S((u=p.queueProgress())!=null&&u.completed&&p.queueProgress().completed.length>0?13:-1)}}function nR(i,e){if(i&1&&(r(0,"span",169),B(1,"span",171),l(2),s()),i&2){let t=e.$implicit;c(),N("bg-green-500",t.intentScore>=60)("bg-amber-500",t.intentScore>=40&&t.intentScore<60)("bg-slate-500",t.intentScore<40),c(),M(" ",t.firstName||t.username||t.id," ")}}function iR(i,e){if(i&1&&(r(0,"span",170),l(1),s()),i&2){let t=m(3);c(),M(" +",t.currentExecution().targetUsers.length-10," \u66F4\u591A ")}}function oR(i,e){if(i&1&&(r(0,"div",130)(1,"div",144),l(2,"\u76EE\u6A19\u7528\u6236"),s(),r(3,"div",162),O(4,nR,3,7,"span",169,Lt),y(6,iR,2,1,"span",170),s()()),i&2){let t=m(2);c(4),U(t.currentExecution().targetUsers.slice(0,10)),c(2),S(t.currentExecution().targetUsers.length>10?6:-1)}}function rR(i,e){if(i&1&&(r(0,"div",173)(1,"div",174),l(2),s(),r(3,"div",175)(4,"div",176),l(5),s(),r(6,"div",177),l(7),s()()()),i&2){let t=e.$implicit;N("bg-slate-700/50",!t.isFromCustomer)("bg-emerald-500/10",t.isFromCustomer),c(),N("bg-purple-500/30",!t.isFromCustomer)("text-purple-400",!t.isFromCustomer)("bg-emerald-500/30",t.isFromCustomer)("text-emerald-400",t.isFromCustomer),c(),M(" ",t.isFromCustomer?"\u{1F464}":"\u{1F916}"," "),c(3),M(" ",t.isFromCustomer?"\u5BA2\u6236":t.role," "),c(2),D(t.content)}}function sR(i,e){if(i&1&&(r(0,"div",141),O(1,rR,8,15,"div",172,Mm),s()),i&2){let t=m(2);c(),U(t.currentExecution().messageHistory.slice(-5).reverse())}}function aR(i,e){i&1&&(r(0,"div",142),l(1,"\u66AB\u7121\u5C0D\u8A71\u8A18\u9304"),s())}function lR(i,e){if(i&1){let t=I();r(0,"div",18)(1,"div",124)(2,"div",7),B(3,"span",125),r(4,"h3",24),l(5,"\u{1F916} AI \u5718\u968A\u57F7\u884C\u4E2D"),s(),r(6,"span",126),l(7),s()(),r(8,"div",30),y(9,HP,2,0,"button",108)(10,qP,2,0,"button",127),r(11,"button",128),x("click",function(){_(t);let o=m();return v(o.stopExecution())}),l(12," \u23F9\uFE0F \u505C\u6B62 "),s()()(),r(13,"div",129)(14,"div",130)(15,"div",131),l(16,"\u71DF\u92B7\u76EE\u6A19"),s(),r(17,"div",132),l(18),s()(),r(19,"div",133)(20,"div",86)(21,"div",89),l(22),s(),r(23,"div",88),l(24,"\u5DF2\u767C\u9001"),s()(),r(25,"div",86)(26,"div",90),l(27),s(),r(28,"div",88),l(29,"\u5BA2\u6236\u56DE\u8986"),s()(),r(30,"div",86)(31,"div",87),l(32),Ee(33,"number"),s(),r(34,"div",88),l(35,"\u56DE\u8986\u7387"),s()(),r(36,"div",86)(37,"div",134),l(38),s(),r(39,"div",88),l(40,"\u610F\u5411\u5206"),s()(),r(41,"div",86)(42,"div",87),l(43),s(),r(44,"div",88),l(45,"\u53C3\u8207\u89D2\u8272"),s()(),r(46,"div",86)(47,"div",92),l(48),s(),r(49,"div",88),l(50,"\u76EE\u6A19\u7528\u6236"),s()()(),y(51,KP,6,0,"div",135),y(52,tR,14,8,"div",136),y(53,oR,7,1,"div",130),r(54,"div")(55,"div",137)(56,"div",43),l(57,"\u6700\u8FD1\u5C0D\u8A71"),s(),r(58,"button",138),x("click",function(){_(t);let o=m();return v(o.toggleConversationPanel())}),l(59),ne(),r(60,"svg",139),B(61,"path",140),s()()(),y(62,sR,3,0,"div",141)(63,aR,2,0,"div",142),s()()()}if(i&2){let t,n,o,a,d,u,p,g,C,w,A,V,G,z,$=m();c(7),M(" ",((t=$.currentExecution())==null?null:t.mode)==="scriptless"?"\u7121\u5287\u672C":((t=$.currentExecution())==null?null:t.mode)==="hybrid"?"\u6DF7\u5408":"\u5287\u672C","\u6A21\u5F0F "),c(2),S(((n=$.currentExecution())==null?null:n.status)==="paused"?9:10),c(9),D((o=$.currentExecution())==null?null:o.goal),c(4),D(((a=$.currentExecution())==null||a.stats==null?null:a.stats.messagesSent)||0),c(5),D(((d=$.currentExecution())==null||d.stats==null?null:d.stats.responsesReceived)||0),c(5),M("",yt(33,22,$.getReplyRate(),"1.0-0"),"%"),c(5),N("text-emerald-400",(((u=$.currentExecution())==null||u.stats==null?null:u.stats.interestScore)||0)>=60)("text-amber-400",(((p=$.currentExecution())==null||p.stats==null?null:p.stats.interestScore)||0)>=30&&(((p=$.currentExecution())==null||p.stats==null?null:p.stats.interestScore)||0)<60)("text-slate-400",(((g=$.currentExecution())==null||g.stats==null?null:g.stats.interestScore)||0)<30),c(),M(" ",((C=$.currentExecution())==null||C.stats==null?null:C.stats.interestScore)||0," "),c(5),D(((w=$.currentExecution())==null||w.roles==null?null:w.roles.length)||0),c(5),D(((A=$.currentExecution())==null||A.targetUsers==null?null:A.targetUsers.length)||0),c(3),S((V=$.currentExecution())!=null&&V.conversionFunnel?51:-1),c(),S($.queueProgress()?52:-1),c(),S((G=$.currentExecution())!=null&&G.targetUsers&&$.currentExecution().targetUsers.length>0?53:-1),c(6),M(" ",$.showConversationPanel()?"\u6536\u8D77":"\u5C55\u958B\u5B8C\u6574\u5C0D\u8A71"," "),c(),N("rotate-180",$.showConversationPanel()),c(2),S((z=$.currentExecution())!=null&&z.messageHistory&&$.currentExecution().messageHistory.length>0?62:63)}}function cR(i,e){if(i&1&&(r(0,"div",193)(1,"div",194),l(2),s(),r(3,"div",195)(4,"div",196),l(5),r(6,"span",197),l(7),s()(),r(8,"div",198),l(9),s()()()),i&2){let t=e.$implicit,n=m(2);N("flex-row-reverse",!t.isFromCustomer),c(),N("bg-purple-500/30",!t.isFromCustomer)("bg-emerald-500/30",t.isFromCustomer),c(),M(" ",t.isFromCustomer?"\u{1F464}":"\u{1F916}"," "),c(),N("bg-purple-500/20",!t.isFromCustomer)("bg-emerald-500/20",t.isFromCustomer),c(),N("text-purple-400",!t.isFromCustomer)("text-emerald-400",t.isFromCustomer),c(),M(" ",t.isFromCustomer?"\u5BA2\u6236":t.role," "),c(2),D(n.formatTime(t.timestamp)),c(2),D(t.content)}}function dR(i,e){i&1&&(r(0,"div",37)(1,"div",111),l(2,"\u{1F4AC}"),s(),r(3,"div"),l(4,"\u5C0D\u8A71\u5C1A\u672A\u958B\u59CB"),s()())}function uR(i,e){if(i&1&&(r(0,"option",201),l(1),s()),i&2){let t=e.$implicit;L("value",t.id),c(),X("",t.name," (",t.type,")")}}function mR(i,e){if(i&1){let t=I();r(0,"div",189)(1,"label",199),l(2,"\u9078\u64C7\u89D2\u8272"),s(),r(3,"select",200),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.manualSendRole,o)||(a.manualSendRole=o),v(o)}),O(4,uR,2,3,"option",201,ct),s()()}if(i&2){let t,n=m(2);c(3),H("ngModel",n.manualSendRole),c(),U(((t=n.currentExecution())==null?null:t.roles)||rt(1,Vc))}}function pR(i,e){if(i&1){let t=I();r(0,"div",192)(1,"div",202),l(2,"\u{1F4A1} AI \u5EFA\u8B70\uFF1A"),s(),r(3,"div",203),l(4),s(),r(5,"button",168),x("click",function(){_(t);let o=m(2);return v(o.useAiSuggestion())}),l(6," \u4F7F\u7528\u6B64\u5EFA\u8B70 "),s()()}if(i&2){let t=m(2);c(4),D(t.aiSuggestion())}}function gR(i,e){if(i&1){let t=I();r(0,"div",19)(1,"div",178),x("click",function(){_(t);let o=m();return v(o.toggleConversationPanel())}),s(),r(2,"div",179)(3,"div",180)(4,"div",7)(5,"span",181),l(6,"\u{1F4AC}"),s(),r(7,"div")(8,"h3",24),l(9,"\u5B8C\u6574\u5C0D\u8A71\u8A18\u9304"),s(),r(10,"p",88),l(11),s()()(),r(12,"button",182),x("click",function(){_(t);let o=m();return v(o.toggleConversationPanel())}),ne(),r(13,"svg",62),B(14,"path",63),s()()(),ce(),r(15,"div",183,0),O(17,cR,10,18,"div",184,Mm),y(19,dR,5,0,"div",37),s(),r(20,"div",185)(21,"div",186)(22,"span",187),l(23),s(),r(24,"button",188),x("click",function(){_(t);let o=m();return v(o.toggleManualMode())}),l(25),s()(),y(26,mR,6,2,"div",189),r(27,"div",25)(28,"input",190),W("ngModelChange",function(o){_(t);let a=m();return q(a.manualMessage,o)||(a.manualMessage=o),v(o)}),x("keydown.enter",function(){_(t);let o=m();return v(o.sendManualMessage())}),s(),r(29,"button",191),x("click",function(){_(t);let o=m();return v(o.sendManualMessage())}),l(30," \u767C\u9001 "),s()(),y(31,pR,7,1,"div",192),s()()()}if(i&2){let t,n,o=m();c(11),D((t=o.currentExecution())==null?null:t.goal),c(6),U(o.currentExecution().messageHistory||rt(19,Vc)),c(2),S(!((n=o.currentExecution())==null||n.messageHistory==null)&&n.messageHistory.length?-1:19),c(3),N("bg-amber-500/20",o.isManualMode())("text-amber-400",o.isManualMode())("bg-emerald-500/20",!o.isManualMode())("text-emerald-400",!o.isManualMode()),c(),M(" ",o.isManualMode()?"\u{1F590}\uFE0F \u624B\u52D5\u6A21\u5F0F":"\u{1F916} AI \u81EA\u52D5\u6A21\u5F0F"," "),c(2),M(" ",o.isManualMode()?"\u5207\u63DB\u81EA\u52D5":"\u63A5\u7BA1\u5C0D\u8A71"," "),c(),S(o.isManualMode()?26:-1),c(2),L("placeholder",ap(o.isManualMode()?"\u8F38\u5165\u6D88\u606F\u4E26\u767C\u9001...":"\u555F\u7528\u624B\u52D5\u6A21\u5F0F\u5F8C\u53EF\u767C\u9001\u6D88\u606F")),H("ngModel",o.manualMessage),L("disabled",!o.isManualMode()),c(),L("disabled",!o.isManualMode()||!o.manualMessage.trim()),c(2),S(o.isManualMode()&&o.aiSuggestion()?31:-1)}}function hR(i,e){if(i&1&&(r(0,"tr",229)(1,"td",232),l(2),s(),r(3,"td",233)(4,"span",234),l(5),s()(),r(6,"td",235),l(7),s(),r(8,"td",236),l(9),s()()),i&2){let t=e.$implicit,n=m(2);c(2),D(t.name),c(2),N("bg-emerald-500/20",t.result==="converted")("text-emerald-400",t.result==="converted")("bg-amber-500/20",t.result==="interested")("text-amber-400",t.result==="interested")("bg-slate-500/20",t.result==="neutral")("text-slate-400",t.result==="neutral")("bg-red-500/20",t.result==="rejected")("text-red-400",t.result==="rejected")("bg-gray-500/20",t.result==="no_response")("text-gray-400",t.result==="no_response"),c(),M(" ",n.getResultLabel(t.result)," "),c(2),D(t.messagesExchanged),c(2),D(n.formatDuration(t.duration))}}function fR(i,e){i&1&&(r(0,"div",37),l(1,"\u66AB\u7121\u5DF2\u5B8C\u6210\u7528\u6236"),s())}function _R(i,e){if(i&1){let t=I();r(0,"div",20)(1,"div",178),x("click",function(){_(t);let o=m();return v(o.showResultsPanel.set(!1))}),s(),r(2,"div",204)(3,"div",180)(4,"div",7)(5,"span",181),l(6,"\u{1F4CA}"),s(),r(7,"h3",24),l(8,"\u968A\u5217\u57F7\u884C\u7D50\u679C"),s()(),r(9,"button",182),x("click",function(){_(t);let o=m();return v(o.showResultsPanel.set(!1))}),ne(),r(10,"svg",62),B(11,"path",63),s()()(),ce(),r(12,"div",205)(13,"div",206)(14,"div",207)(15,"div",90),l(16),s(),r(17,"div",208),l(18,"\u8F49\u5316\u6210\u529F"),s()(),r(19,"div",209)(20,"div",91),l(21),s(),r(22,"div",210),l(23,"\u6709\u8208\u8DA3"),s()(),r(24,"div",211)(25,"div",212),l(26),s(),r(27,"div",213),l(28,"\u4E2D\u7ACB"),s()(),r(29,"div",214)(30,"div",215),l(31),s(),r(32,"div",216),l(33,"\u62D2\u7D55"),s()(),r(34,"div",217)(35,"div",218),l(36),s(),r(37,"div",219),l(38,"\u7121\u56DE\u61C9"),s()()(),r(39,"div",220)(40,"div",53)(41,"div",131),l(42,"\u8F49\u5316\u7387"),s(),r(43,"div",221),B(44,"div",222),s()(),r(45,"div",90),l(46),Ee(47,"number"),s()()(),r(48,"div",223)(49,"table",224)(50,"thead",225)(51,"tr")(52,"th",226),l(53,"\u7528\u6236"),s(),r(54,"th",226),l(55,"\u7D50\u679C"),s(),r(56,"th",227),l(57,"\u6D88\u606F\u6578"),s(),r(58,"th",227),l(59,"\u6642\u9577"),s()()(),r(60,"tbody",228),O(61,hR,10,24,"tr",229,Lt),s()(),y(63,fR,2,0,"div",37),s(),r(64,"div",230)(65,"button",8),x("click",function(){_(t);let o=m();return v(o.exportResults())}),r(66,"span"),l(67,"\u{1F4E5}"),s(),l(68," \u5C0E\u51FA\u7D50\u679C "),s(),r(69,"button",231),x("click",function(){_(t);let o=m();return v(o.showResultsPanel.set(!1))}),l(70," \u95DC\u9589 "),s()()()()}if(i&2){let t,n,o=m();c(16),D(o.getResultCount("converted")),c(5),D(o.getResultCount("interested")),c(5),D(o.getResultCount("neutral")),c(5),D(o.getResultCount("rejected")),c(5),D(o.getResultCount("no_response")),c(8),ee("width",o.getConversionRate(),"%"),c(2),M("",yt(47,9,o.getConversionRate(),"1.1-1"),"%"),c(15),U(((t=o.queueProgress())==null?null:t.completed)||rt(12,Vc)),c(2),S(!((n=o.queueProgress())==null||n.completed==null)&&n.completed.length?-1:63)}}function vR(i,e){if(i&1&&(r(0,"div",28)(1,"div",237)(2,"div",238),l(3),s()(),r(4,"div",105),l(5),s()()),i&2){let t=e.$implicit,n=m();c(),ee("height",n.Math.max(t.groups*10,4),"px"),N("bg-gradient-to-t",!0)("from-purple-600",!0)("to-purple-400",!0),c(2),M(" ",t.groups," "),c(2),D(t.label)}}function xR(i,e){if(i&1&&(r(0,"div",7)(1,"div",239),l(2),s(),r(3,"div",175)(4,"div",240),l(5),s(),r(6,"div",105),l(7),s()(),r(8,"div",103)(9,"div",241),l(10),s(),r(11,"div",105),l(12,"\u6210\u529F\u7387"),s()()()),i&2){let t=e.$implicit,n=e.$index;c(),N("bg-amber-500",n===0)("text-amber-900",n===0)("bg-slate-600",n===1)("text-white",n===1)("bg-amber-700",n===2)("text-amber-200",n===2)("bg-slate-700",n>2)("text-slate-400",n>2),c(),M(" ",n+1," "),c(3),D(t.name),c(2),M("",t.usageCount," \u6B21\u4F7F\u7528"),c(3),M("",t.successRate,"%")}}function CR(i,e){i&1&&(r(0,"div",37),l(1,"\u66AB\u7121\u6578\u64DA"),s())}function bR(i,e){if(i&1){let t=I();r(0,"button",242),x("click",function(){_(t);let o=m();return v(o.openABTestPanel())}),r(1,"span"),l(2,"\u{1F4CA}"),s(),l(3),s()}if(i&2){let t=m();c(3),M(" \u5C0D\u6BD4 (",t.selectedForCompare().length,") ")}}function yR(i,e){if(i&1){let t=I();r(0,"button",243),x("click",function(){_(t);let o=m();return v(o.clearCompareSelection())}),l(1," \u6E05\u9664\u9078\u64C7 "),s()}}function SR(i,e){if(i&1){let t=I();r(0,"div",244),x("click",function(){let o=_(t).$implicit,a=m();return v(a.viewExecutionHistory(o))}),r(1,"div",96)(2,"div",7)(3,"input",245),x("click",function(o){return _(t),v(o.stopPropagation())})("change",function(){let o=_(t).$implicit,a=m();return v(a.toggleCompareSelection(o))}),s(),r(4,"div",246)(5,"span",247),l(6),s()(),r(7,"div")(8,"div",132),l(9),Ee(10,"slice"),s(),r(11,"div",248)(12,"span"),l(13),Ee(14,"date"),s(),r(15,"span"),l(16,"\u2022"),s(),r(17,"span"),l(18),s(),r(19,"span"),l(20,"\u2022"),s(),r(21,"span"),l(22),s()()()(),r(23,"div",97)(24,"div",103)(25,"div",249),l(26),s(),r(27,"div",105),l(28),s()(),r(29,"button",250),x("click",function(o){let a=_(t).$implicit;return m().viewExecutionHistory(a),v(o.stopPropagation())}),ne(),r(30,"svg",9),B(31,"path",251)(32,"path",252),s()()()()()}if(i&2){let t=e.$implicit,n=m();c(3),L("checked",n.isSelectedForCompare(t)),c(),N("bg-emerald-500/20",t.status==="completed")("bg-red-500/20",t.status==="failed")("bg-slate-500/20",t.status==="idle"),c(2),M(" ",t.status==="completed"?"\u2705":t.status==="failed"?"\u274C":"\u23F8\uFE0F"," "),c(3),X("",Fi(10,15,t.goal,0,40),"",t.goal.length>40?"...":""),c(4),D(yt(14,19,t.stats.startTime,"MM/dd HH:mm")),c(5),D(t.mode==="scriptless"?"\u7121\u5287\u672C":t.mode==="hybrid"?"\u6DF7\u5408":"\u5287\u672C"),c(4),M("",(t.targetUsers==null?null:t.targetUsers.length)||0," \u76EE\u6A19"),c(4),M("",t.stats.messagesSent," \u6D88\u606F"),c(2),M("",t.stats.responsesReceived," \u56DE\u8986")}}function wR(i,e){i&1&&(r(0,"div",46)(1,"div",111),l(2,"\u{1F4DD}"),s(),r(3,"div"),l(4,"\u66AB\u7121\u57F7\u884C\u6B77\u53F2"),s()())}function ER(i,e){if(i&1&&(r(0,"div",193)(1,"div",194),l(2),s(),r(3,"div",195)(4,"div",196),l(5),r(6,"span",197),l(7),s()(),r(8,"div",198),l(9),s()()()),i&2){let t=e.$implicit,n=m(2);N("flex-row-reverse",!t.isFromCustomer),c(),N("bg-purple-500/30",!t.isFromCustomer)("bg-emerald-500/30",t.isFromCustomer),c(),M(" ",t.isFromCustomer?"\u{1F464}":"\u{1F916}"," "),c(),N("bg-purple-500/20",!t.isFromCustomer)("bg-emerald-500/20",t.isFromCustomer),c(),N("text-purple-400",!t.isFromCustomer)("text-emerald-400",t.isFromCustomer),c(),M(" ",t.isFromCustomer?"\u5BA2\u6236":t.role," "),c(2),D(n.formatTime(t.timestamp)),c(2),D(t.content)}}function DR(i,e){i&1&&(r(0,"div",37)(1,"div",111),l(2,"\u{1F4AC}"),s(),r(3,"div"),l(4,"\u6B64\u6B21\u57F7\u884C\u7121\u5C0D\u8A71\u8A18\u9304"),s()())}function AR(i,e){if(i&1){let t=I();r(0,"div",20)(1,"div",178),x("click",function(){_(t);let o=m();return v(o.showHistoryPanel.set(!1))}),s(),r(2,"div",253)(3,"div",180)(4,"div",7)(5,"span",181),l(6,"\u{1F4DC}"),s(),r(7,"div")(8,"h3",24),l(9,"\u57F7\u884C\u6B77\u53F2\u56DE\u653E"),s(),r(10,"p",88),l(11),s()()(),r(12,"button",182),x("click",function(){_(t);let o=m();return v(o.showHistoryPanel.set(!1))}),ne(),r(13,"svg",62),B(14,"path",63),s()()(),ce(),r(15,"div",254)(16,"div",255)(17,"div",256),l(18),s(),r(19,"div",88),l(20,"\u5DF2\u767C\u9001"),s()(),r(21,"div",255)(22,"div",257),l(23),s(),r(24,"div",88),l(25,"\u5BA2\u6236\u56DE\u8986"),s()(),r(26,"div",255)(27,"div",258),l(28),s(),r(29,"div",88),l(30,"\u53C3\u8207\u89D2\u8272"),s()(),r(31,"div",255)(32,"div",259),l(33),s(),r(34,"div",88),l(35,"\u5206\u6790\u6B21\u6578"),s()(),r(36,"div",255)(37,"div",260),l(38),s(),r(39,"div",88),l(40,"\u76EE\u6A19\u7528\u6236"),s()()(),r(41,"div",261),O(42,ER,10,18,"div",184,Mm),y(44,DR,5,0,"div",37),s(),r(45,"div",230)(46,"button",262),x("click",function(){_(t);let o=m();return v(o.rerunExecution(o.selectedHistory()))}),r(47,"span"),l(48,"\u{1F504}"),s(),l(49," \u4EE5\u6B64\u7B56\u7565\u91CD\u65B0\u57F7\u884C "),s(),r(50,"button",263),x("click",function(){_(t);let o=m();return v(o.showHistoryPanel.set(!1))}),l(51," \u95DC\u9589 "),s()()()()}if(i&2){let t,n,o,a,d,u,p,g,C=m();c(11),D((t=C.selectedHistory())==null?null:t.goal),c(7),D(((n=C.selectedHistory())==null||n.stats==null?null:n.stats.messagesSent)||0),c(5),D(((o=C.selectedHistory())==null||o.stats==null?null:o.stats.responsesReceived)||0),c(5),D(((a=C.selectedHistory())==null||a.roles==null?null:a.roles.length)||0),c(5),D(((d=C.selectedHistory())==null||d.stats==null?null:d.stats.analysisCount)||0),c(5),D(((u=C.selectedHistory())==null||u.targetUsers==null?null:u.targetUsers.length)||0),c(4),U(((p=C.selectedHistory())==null?null:p.messageHistory)||rt(7,Vc)),c(2),S(!((g=C.selectedHistory())==null||g.messageHistory==null)&&g.messageHistory.length?-1:44)}}function MR(i,e){if(i&1&&(r(0,"th",270)(1,"div",280)(2,"span",281),l(3),s(),r(4,"span",282),l(5),Ee(6,"slice"),s()()()),i&2){let t=e.$implicit,n=e.$index;c(2),N("bg-purple-500/20",n===0)("text-purple-400",n===0)("bg-cyan-500/20",n===1)("text-cyan-400",n===1)("bg-amber-500/20",n===2)("text-amber-400",n===2),c(),M(" \u7B56\u7565 ",n+1," "),c(2),M("",Fi(6,14,t.goal,0,20),"...")}}function TR(i,e){if(i&1&&(r(0,"td",273),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t.mode==="scriptless"?"\u7121\u5287\u672C":t.mode==="hybrid"?"\u6DF7\u5408":"\u5287\u672C"," ")}}function kR(i,e){if(i&1&&(r(0,"td",273),l(1),s()),i&2){let t=e.$implicit;c(),D((t.targetUsers==null?null:t.targetUsers.length)||0)}}function IR(i,e){if(i&1&&(r(0,"td",283),l(1),s()),i&2){let t=e.$implicit,n=e.$index,o=m(2);N("text-emerald-400",o.isHighestValue("messagesSent",n))("text-white",!o.isHighestValue("messagesSent",n)),c(),M(" ",t.stats.messagesSent," ")}}function FR(i,e){if(i&1&&(r(0,"td",283),l(1),s()),i&2){let t=e.$implicit,n=e.$index,o=m(2);N("text-emerald-400",o.isHighestValue("responsesReceived",n))("text-white",!o.isHighestValue("responsesReceived",n)),c(),M(" ",t.stats.responsesReceived," ")}}function PR(i,e){if(i&1&&(r(0,"td",283),l(1),Ee(2,"number"),s()),i&2){let t=e.$implicit,n=e.$index,o=m(2);N("text-emerald-400",o.isHighestValue("responseRate",n))("text-white",!o.isHighestValue("responseRate",n)),c(),M(" ",yt(2,5,o.getResponseRate(t),"1.1-1"),"% ")}}function RR(i,e){if(i&1&&(r(0,"td",273),l(1),s()),i&2){let t=e.$implicit;c(),D(t.stats.analysisCount||0)}}function NR(i,e){if(i&1&&(r(0,"td",273),l(1),s()),i&2){let t=e.$implicit;c(),D((t.roles==null?null:t.roles.length)||0)}}function VR(i,e){if(i&1&&(r(0,"td",275),l(1),Ee(2,"date"),s()),i&2){let t=e.$implicit;c(),M(" ",yt(2,1,t.stats.startTime,"MM/dd HH:mm")," ")}}function BR(i,e){if(i&1){let t=I();r(0,"div",20)(1,"div",178),x("click",function(){_(t);let o=m();return v(o.showABTestPanel.set(!1))}),s(),r(2,"div",264)(3,"div",180)(4,"div",7)(5,"span",181),l(6,"\u{1F4CA}"),s(),r(7,"h3",24),l(8,"A/B \u6E2C\u8A66\u5C0D\u6BD4"),s(),r(9,"span",265),l(10),s()(),r(11,"button",182),x("click",function(){_(t);let o=m();return v(o.showABTestPanel.set(!1))}),ne(),r(12,"svg",62),B(13,"path",63),s()()(),ce(),r(14,"div",266)(15,"table",267)(16,"thead",268)(17,"tr")(18,"th",269),l(19,"\u6307\u6A19"),s(),O(20,MR,7,18,"th",270,Lt),s()(),r(22,"tbody",158)(23,"tr",271)(24,"td",272),l(25,"\u57F7\u884C\u6A21\u5F0F"),s(),O(26,TR,2,1,"td",273,Lt),s(),r(28,"tr",271)(29,"td",272),l(30,"\u76EE\u6A19\u7528\u6236"),s(),O(31,kR,2,1,"td",273,Lt),s(),r(33,"tr",271)(34,"td",272),l(35,"\u6D88\u606F\u767C\u9001"),s(),O(36,IR,2,5,"td",274,Lt),s(),r(38,"tr",271)(39,"td",272),l(40,"\u5BA2\u6236\u56DE\u8986"),s(),O(41,FR,2,5,"td",274,Lt),s(),r(43,"tr",271)(44,"td",272),l(45,"\u56DE\u8986\u7387"),s(),O(46,PR,3,8,"td",274,Lt),s(),r(48,"tr",271)(49,"td",272),l(50,"AI \u5206\u6790\u6B21\u6578"),s(),O(51,RR,2,1,"td",273,Lt),s(),r(53,"tr",271)(54,"td",272),l(55,"\u53C3\u8207\u89D2\u8272"),s(),O(56,NR,2,1,"td",273,Lt),s(),r(58,"tr")(59,"td",272),l(60,"\u57F7\u884C\u6642\u9593"),s(),O(61,VR,3,4,"td",275,Lt),s()()()(),r(63,"div",276)(64,"div",277)(65,"span",247),l(66,"\u{1F3C6}"),s(),r(67,"span",132),l(68,"\u6700\u4F73\u7B56\u7565\uFF1A"),s(),r(69,"span",278),l(70),s()(),r(71,"p",43),l(72),s()(),r(73,"div",279)(74,"button",263),x("click",function(){_(t);let o=m();return v(o.showABTestPanel.set(!1))}),l(75," \u95DC\u9589 "),s()()()()}if(i&2){let t=m();c(10),M(" ",t.selectedForCompare().length," \u500B\u7B56\u7565 "),c(10),U(t.selectedForCompare()),c(6),U(t.selectedForCompare()),c(5),U(t.selectedForCompare()),c(5),U(t.selectedForCompare()),c(5),U(t.selectedForCompare()),c(5),U(t.selectedForCompare()),c(5),U(t.selectedForCompare()),c(5),U(t.selectedForCompare()),c(5),U(t.selectedForCompare()),c(9),M(" \u7B56\u7565 ",t.getBestStrategyIndex()+1," "),c(2),M(" \u57FA\u65BC\u56DE\u8986\u7387\u548C\u5BA2\u6236\u4E92\u52D5\u8868\u73FE\uFF0C\u7B56\u7565 ",t.getBestStrategyIndex()+1," \u8868\u73FE\u6700\u512A\u3002 \u5EFA\u8B70\u4F7F\u7528\u6B64\u7B56\u7565\u7684\u57F7\u884C\u6A21\u5F0F\u548C\u89D2\u8272\u914D\u7F6E\u3002 ")}}function LR(i,e){if(i&1){let t=I();r(0,"button",250),x("click",function(){_(t);let o=m().$implicit,a=m();return v(a.pauseGroup(o))}),ne(),r(1,"svg",9),B(2,"path",291),s()()}}function OR(i,e){if(i&1){let t=I();r(0,"button",292),x("click",function(){_(t);let o=m().$implicit,a=m();return v(a.resumeGroup(o))}),ne(),r(1,"svg",9),B(2,"path",293),s()()}}function UR(i,e){if(i&1){let t=I();r(0,"div",49)(1,"div",96)(2,"div",97)(3,"div",246),B(4,"span",284),s(),r(5,"div")(6,"div",99),l(7),s(),r(8,"div",43),l(9),s()()(),r(10,"div",285)(11,"div",286)(12,"div",287),l(13),s(),r(14,"div",105),l(15,"\u5DF2\u767C\u9001"),s()(),r(16,"div",286)(17,"div",288),l(18),s(),r(19,"div",105),l(20,"\u5BA2\u6236\u56DE\u8986"),s()(),r(21,"div",106),l(22),s(),r(23,"div",25),y(24,LR,3,0,"button",289),y(25,OR,3,0,"button",290),r(26,"button",250),x("click",function(){let o=_(t).$implicit,a=m();return v(a.viewGroupDetails(o))}),ne(),r(27,"svg",9),B(28,"path",251)(29,"path",252),s()()()()()()}if(i&2){let t=e.$implicit,n=m();c(3),N("bg-emerald-500/20",t.status==="running")("bg-amber-500/20",t.status==="paused")("bg-cyan-500/20",t.status==="inviting"),c(),N("bg-emerald-500",t.status==="running")("animate-pulse",t.status==="running")("bg-amber-500",t.status==="paused")("bg-cyan-500",t.status==="inviting"),c(3),D(t.groupTitle),c(2),M(" \u5BA2\u6236: ",t.targetCustomer.firstName||t.targetCustomer.username||t.targetCustomer.id," "),c(4),D(t.messagesSent),c(5),D(t.customerMessages),c(3),N("bg-emerald-500/20",t.status==="running")("text-emerald-400",t.status==="running")("bg-amber-500/20",t.status==="paused")("text-amber-400",t.status==="paused")("bg-cyan-500/20",t.status==="inviting")("text-cyan-400",t.status==="inviting"),c(),M(" ",n.getStatusLabel(t.status)," "),c(2),S(t.status==="running"?24:-1),c(),S(t.status==="paused"?25:-1)}}function GR(i,e){i&1&&(r(0,"div",46)(1,"div",111),l(2,"\u{1F3AD}"),s(),r(3,"div"),l(4,"\u66AB\u7121\u6D3B\u8E8D\u7684\u5354\u4F5C\u7FA4\u7D44"),s()())}var Nc=class i{constructor(){this.multiRoleService=F(kt);this.autoGroupService=F(zn);this.executorService=F(or);this.dynamicEngine=F(Mi);this.ipc=F(Q);this.toast=F(J);this.taskService=F(Di);this.aiService=F(Mt);this.currentExecution=R(()=>{let e=this.dynamicEngine.currentExecution();return e?.status==="running"||e?.status==="paused"?e:null});this.queueProgress=R(()=>this.dynamicEngine.queueProgress());this.showConversationPanel=f(!1);this.isManualMode=f(!1);this.manualMessage="";this.manualSendRole="";this.aiSuggestion=f(null);this.showConversionAlert=f(!1);this.conversionAlertData=f(null);this.showResultsPanel=f(!1);this.showHistoryPanel=f(!1);this.selectedHistory=f(null);this.executionHistory=R(()=>this.dynamicEngine.executions());this.showABTestPanel=f(!1);this.selectedForCompare=f([]);this.conversionStages=[{id:"contact",label:"\u89F8\u9054"},{id:"response",label:"\u56DE\u8986"},{id:"interest",label:"\u8208\u8DA3"},{id:"intent",label:"\u610F\u5411"},{id:"conversion",label:"\u8F49\u5316"}];this.ipcCleanup=[];this.unifiedTasks=R(()=>this.taskService.tasks());this.activeUnifiedTasks=R(()=>this.taskService.activeTasks());this.unifiedStats=R(()=>this.taskService.getOverallStats());this.unifiedTodayStats=R(()=>this.taskService.todayStats());this.tasksByGoal=R(()=>this.taskService.tasksByGoal());this.unifiedConversionRate=R(()=>this.taskService.overallConversionRate());this.aiStats=R(()=>this.aiService.stats());this.aiConnected=R(()=>this.aiService.isConnected());this.viewMode=f("unified");this.isRefreshing=f(!1);this.lastUpdate=f(new Date);this.chartPeriod=f("week");this.stats=f({totalGroups:0,activeGroups:0,completedGroups:0,totalConversions:0,conversionRate:0,totalMessagesSent:0,avgMessagesPerGroup:0,todayGroups:0,todayConversions:0});this.chartData=f([]);this.topRoles=R(()=>this.multiRoleService.roles().map(t=>P(E({},t),{successRate:t.usageCount&&t.usageCount>0?Math.round((t.successCount||0)/t.usageCount*100):0})).sort((t,n)=>n.successRate-t.successRate).slice(0,5));this.activeGroups=R(()=>this.autoGroupService.groups().filter(e=>["creating","inviting","running","paused"].includes(e.status)));this.refreshInterval=null;this.Math=Math}ngOnInit(){this.refreshData(),setTimeout(()=>{this.dynamicEngine.restoreExecutions().catch(e=>{console.warn("[CollabDashboard] \u6062\u5FA9\u57F7\u884C\u72C0\u614B\u5931\u6557:",e)})},2e3),this.refreshInterval=setInterval(()=>{this.refreshData()},5e3),this.ipcCleanup.push(this.ipc.on("ai-team:conversion-signal",e=>{this.showConversionNotification(e)})),this.ipcCleanup.push(this.ipc.on("ai-team:suggestion-update",e=>{this.isManualMode()&&this.aiSuggestion.set(e.suggestion)})),this.ipcCleanup.push(this.ipc.on("ai-team:message-sent",e=>{console.log("[CollabDashboard] \u6536\u5230\u6D88\u606F\u767C\u9001\u4E8B\u4EF6:",e),this.refreshData()})),this.ipcCleanup.push(this.ipc.on("ai-team:private-message-sent",e=>{console.log("[CollabDashboard] \u6536\u5230\u79C1\u804A\u6D88\u606F\u4E8B\u4EF6:",e);let t=this.dynamicEngine.currentExecution();t&&e.executionId===t.id&&e.success&&(t.messageHistory?.find(o=>o.content===e.content&&!o.isFromCustomer)||(console.log("[CollabDashboard] \u{1F4E4} \u6DFB\u52A0 AI \u6D88\u606F\u5230\u6B77\u53F2:",e.content?.substring(0,30)),t.messageHistory||(t.messageHistory=[]),t.messageHistory.push({role:e.roleName||"AI",content:e.content,timestamp:new Date().toISOString(),isFromCustomer:!1}),this.dynamicEngine.forceUpdateExecution(t)),this.scrollToBottom()),this.refreshData()})),this.ipcCleanup.push(this.ipc.on("ai-team:customer-reply",e=>{console.log("[CollabDashboard] \u6536\u5230\u5BA2\u6236\u56DE\u8986:",e);let t=this.dynamicEngine.currentExecution();t&&e.executionId===t.id&&(t.messageHistory?.find(o=>o.content===e.text&&o.isFromCustomer)||(console.log("[CollabDashboard] \u{1F4DD} \u6DFB\u52A0\u5BA2\u6236\u6D88\u606F\u5230\u6B77\u53F2:",e.text?.substring(0,30)),t.messageHistory||(t.messageHistory=[]),t.messageHistory.push({role:"customer",content:e.text,timestamp:new Date().toISOString(),isFromCustomer:!0}),this.dynamicEngine.forceUpdateExecution(t)),this.scrollToBottom()),this.refreshData()}))}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval),this.ipcCleanup.forEach(e=>e())}async refreshData(){this.isRefreshing.set(!0);try{let e=this.autoGroupService.statistics();this.stats.set({totalGroups:e.totalGroups,activeGroups:e.activeGroups,completedGroups:e.totalGroups-e.activeGroups-e.pendingRequests,totalConversions:e.successfulConversions,conversionRate:e.totalGroups>0?e.successfulConversions/e.totalGroups*100:0,totalMessagesSent:this.executorService.statistics().totalExecutions,avgMessagesPerGroup:e.totalGroups>0?this.executorService.statistics().totalExecutions/e.totalGroups:0,todayGroups:0,todayConversions:0}),this.generateChartData(),this.lastUpdate.set(new Date)}catch(e){console.error("Failed to refresh dashboard data:",e)}finally{this.isRefreshing.set(!1)}}generateChartData(){let e=this.chartPeriod()==="week"?7:30,t=[];for(let n=e-1;n>=0;n--){let o=new Date;o.setDate(o.getDate()-n),t.push({date:o.toISOString().split("T")[0],label:n===0?"\u4ECA\u5929":e===7?["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"][o.getDay()]:`${o.getMonth()+1}/${o.getDate()}`,groups:Math.floor(Math.random()*10),conversions:Math.floor(Math.random()*5)})}this.chartData.set(t)}getStatusLabel(e){return{creating:"\u5275\u5EFA\u4E2D",inviting:"\u9080\u8ACB\u4E2D",running:"\u9032\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}pauseGroup(e){this.autoGroupService.pauseGroup(e.id),this.executorService.pauseExecution(e.id)}resumeGroup(e){this.autoGroupService.resumeGroup(e.id),this.executorService.resumeExecution(e.id)}viewGroupDetails(e){console.log("View group details:",e)}pauseExecution(){let e=this.currentExecution();e&&(this.dynamicEngine.pauseExecution(e.id),this.toast.info("\u23F8\uFE0F \u5DF2\u66AB\u505C AI \u5718\u968A\u57F7\u884C"))}resumeExecution(){let e=this.currentExecution();e&&(this.dynamicEngine.resumeExecution(e.id),this.isManualMode.set(!1),this.toast.success("\u25B6\uFE0F \u5DF2\u6062\u5FA9 AI \u5718\u968A\u57F7\u884C"))}stopExecution(){let e=this.currentExecution();e&&confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u57F7\u884C\u55CE\uFF1F\u9019\u5C07\u7D50\u675F\u7576\u524D\u7684 AI \u5718\u968A\u4EFB\u52D9\u3002")&&(this.dynamicEngine.stopExecution(e.id),this.showConversationPanel.set(!1),this.isManualMode.set(!1),this.toast.info("\u23F9\uFE0F \u5DF2\u505C\u6B62 AI \u5718\u968A\u57F7\u884C"))}toggleConversationPanel(){this.showConversationPanel.update(e=>!e),this.showConversationPanel()&&setTimeout(()=>{this.scrollToBottom()},100)}scrollToBottom(){if(this.conversationContainer?.nativeElement){let e=this.conversationContainer.nativeElement;e.scrollTop=e.scrollHeight}}formatTime(e){return new Date(e).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}toggleManualMode(){let e=!this.isManualMode();this.isManualMode.set(e);let t=this.currentExecution();t&&(e?(this.dynamicEngine.pauseExecution(t.id),this.toast.info("\u{1F590}\uFE0F \u5DF2\u5207\u63DB\u5230\u624B\u52D5\u6A21\u5F0F\uFF0CAI \u5DF2\u66AB\u505C"),t.roles?.length&&(this.manualSendRole=t.roles[0].id),this.requestAiSuggestion()):(this.dynamicEngine.resumeExecution(t.id),this.aiSuggestion.set(null),this.toast.success("\u{1F916} \u5DF2\u5207\u63DB\u56DE AI \u81EA\u52D5\u6A21\u5F0F")))}requestAiSuggestion(){let e=this.currentExecution();e&&this.ipc.send("ai-team:request-suggestion",{executionId:e.id,messageHistory:e.messageHistory?.slice(-10),currentStage:e.conversionFunnel?.currentStage})}useAiSuggestion(){let e=this.aiSuggestion();e&&(this.manualMessage=e)}sendManualMessage(){if(!this.manualMessage.trim()||!this.isManualMode())return;let e=this.currentExecution();if(!e)return;let t=this.manualSendRole,n=e.roles?.find(o=>o.id===t);if(!n){this.toast.error("\u8ACB\u9078\u64C7\u4E00\u500B\u89D2\u8272");return}this.ipc.send("ai-team:send-manual-message",{executionId:e.id,roleId:t,roleName:n.name,content:this.manualMessage.trim(),targetUserId:e.targetUsers?.[0]?.id}),this.toast.success(`\u{1F4E4} \u5DF2\u4EE5 ${n.name} \u8EAB\u4EFD\u767C\u9001\u6D88\u606F`),this.manualMessage="",setTimeout(()=>{this.requestAiSuggestion()},1e3)}showConversionNotification(e){this.conversionAlertData.set({userId:e.userId,userName:e.userName,signal:e.signal}),this.showConversionAlert.set(!0),this.toast.success(`\u{1F3AF} \u9AD8\u8F49\u5316\u4FE1\u865F\uFF01${e.userName}: ${e.signal}`),setTimeout(()=>{this.showConversionAlert.set(!1)},5e3)}dismissConversionAlert(){this.showConversionAlert.set(!1)}focusOnUser(e){this.showConversationPanel.set(!0),this.showConversionAlert.set(!1),this.toast.info("\u5DF2\u5207\u63DB\u5230\u8A72\u7528\u6236\u7684\u5C0D\u8A71")}skipCurrentUser(){this.dynamicEngine.skipCurrentUser()&&this.toast.info("\u5DF2\u8DF3\u904E\u7576\u524D\u7528\u6236\uFF0C\u8655\u7406\u4E0B\u4E00\u500B")}markAsConverted(){this.dynamicEngine.completeCurrentUser("converted")&&this.toast.success("\u{1F389} \u5DF2\u6A19\u8A18\u70BA\u8F49\u5316\u6210\u529F\uFF01")}markAsInterested(){this.dynamicEngine.completeCurrentUser("interested")&&this.toast.info("\u5DF2\u6A19\u8A18\u70BA\u6709\u8208\u8DA3\uFF0C\u8655\u7406\u4E0B\u4E00\u500B\u7528\u6236")}getReplyRate(){let e=this.currentExecution();return!e||!e.stats.messagesSent?0:e.stats.responsesReceived/e.stats.messagesSent*100}isStageCompleted(e){let t=this.currentExecution();if(!t?.conversionFunnel)return!1;let n=["contact","response","interest","intent","conversion"],o=n.indexOf(t.conversionFunnel.currentStage);return n.indexOf(e)<o}isCurrentStage(e){return this.currentExecution()?.conversionFunnel?.currentStage===e}getResultCount(e){return(this.queueProgress()?.completed||[]).filter(n=>n.result===e).length}getConversionRate(){let e=this.queueProgress()?.completed||[];return e.length===0?0:e.filter(n=>n.result==="converted").length/e.length*100}getResultLabel(e){return{converted:"\u8F49\u5316",interested:"\u6709\u8208\u8DA3",neutral:"\u4E2D\u7ACB",rejected:"\u62D2\u7D55",no_response:"\u7121\u56DE\u61C9"}[e]||e}formatDuration(e){if(e<60)return`${e}\u79D2`;if(e<3600)return`${Math.floor(e/60)}\u5206${e%60}\u79D2`;let t=Math.floor(e/3600),n=Math.floor(e%3600/60);return`${t}\u6642${n}\u5206`}exportResults(){let e=this.queueProgress()?.completed||[];if(e.length===0){this.toast.info("\u66AB\u7121\u53EF\u5C0E\u51FA\u7684\u7D50\u679C");return}let t=["\u7528\u6236","\u7D50\u679C","\u6D88\u606F\u6578","\u6642\u9577(\u79D2)"],n=e.map(p=>[p.name,this.getResultLabel(p.result),p.messagesExchanged,p.duration]),o=[t.join(","),...n.map(p=>p.join(","))].join(`
`),a=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8"}),d=URL.createObjectURL(a),u=document.createElement("a");u.href=d,u.download=`ai-team-results-${new Date().toISOString().slice(0,10)}.csv`,u.click(),URL.revokeObjectURL(d),this.toast.success("\u7D50\u679C\u5DF2\u5C0E\u51FA\u70BA CSV \u6587\u4EF6")}viewExecutionHistory(e){this.selectedHistory.set(e),this.showHistoryPanel.set(!0)}rerunExecution(e){this.showHistoryPanel.set(!1),this.dynamicEngine.startFromOnePhrase(e.goal,e.mode,e.targetUsers?.map(t=>({id:String(t.id),telegramId:String(t.id),username:t.username,firstName:t.firstName,lastName:t.lastName,intentScore:t.intentScore,source:t.source}))).then(t=>{t&&this.toast.success("\u{1F504} \u5DF2\u4F7F\u7528\u76F8\u540C\u7B56\u7565\u91CD\u65B0\u555F\u52D5\u57F7\u884C")})}isSelectedForCompare(e){return this.selectedForCompare().some(t=>t.id===e.id)}toggleCompareSelection(e){let t=this.selectedForCompare();if(t.find(o=>o.id===e.id))this.selectedForCompare.set(t.filter(o=>o.id!==e.id));else{if(t.length>=3){this.toast.info("\u6700\u591A\u53EA\u80FD\u9078\u64C7 3 \u500B\u7B56\u7565\u9032\u884C\u5C0D\u6BD4");return}this.selectedForCompare.set([...t,e])}}clearCompareSelection(){this.selectedForCompare.set([])}openABTestPanel(){if(this.selectedForCompare().length<2){this.toast.info("\u8ACB\u81F3\u5C11\u9078\u64C7 2 \u500B\u57F7\u884C\u8A18\u9304\u9032\u884C\u5C0D\u6BD4");return}this.showABTestPanel.set(!0)}getResponseRate(e){return e.stats.messagesSent?e.stats.responsesReceived/e.stats.messagesSent*100:0}isHighestValue(e,t){let n=this.selectedForCompare(),o;switch(e){case"messagesSent":o=n.map(d=>d.stats.messagesSent);break;case"responsesReceived":o=n.map(d=>d.stats.responsesReceived);break;case"responseRate":o=n.map(d=>this.getResponseRate(d));break;default:return!1}let a=Math.max(...o);return o[t]===a&&a>0}getBestStrategyIndex(){let e=this.selectedForCompare();if(e.length===0)return 0;let t=e.map(n=>{let o=this.getResponseRate(n),a=n.stats.messagesSent;return o*.6+(a>0?a*.4:0)});return t.indexOf(Math.max(...t))}getGoalIcon(e){return rn[e]?.icon||"\u{1F3AF}"}getGoalLabel(e){return rn[e]?.label||e}getTaskStatusLabel(e){return{draft:"\u8349\u7A3F",scheduled:"\u5DF2\u8A08\u5283",running:"\u57F7\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}startUnifiedTask(e){this.taskService.startTask(e),this.toast.success("\u4EFB\u52D9\u5DF2\u555F\u52D5")}pauseUnifiedTask(e){this.taskService.pauseTask(e),this.toast.info("\u4EFB\u52D9\u5DF2\u66AB\u505C")}goToSmartMarketingHub(){this.ipc.send("navigate-to",{path:"/smart-marketing"})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-collaboration-dashboard"]],viewQuery:function(t,n){if(t&1&&ci(kP,5),t&2){let o;Rn(o=Nn())&&(n.conversationContainer=o.first)}},decls:87,vars:54,consts:[["conversationContainer",""],[1,"collaboration-dashboard","p-6","bg-slate-900","min-h-full"],[1,"fixed","top-4","right-4","z-50","animate-slide-in-right"],[1,"flex","items-center","justify-between","mb-8"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"text-sm","text-slate-500"],[1,"flex","items-center","gap-2","mb-4"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],[1,"ml-auto","flex","items-center","gap-2"],[1,"flex","items-center","gap-2","px-3","py-1","bg-emerald-500/20","text-emerald-400","rounded-full","text-sm"],[1,"px-3","py-1","bg-yellow-500/20","text-yellow-400","rounded-full","text-sm"],[1,"grid","grid-cols-5","gap-4","mb-8"],[1,"mb-8","bg-gradient-to-r","from-purple-500/10","to-pink-500/10","rounded-xl","border","border-purple-500/30","overflow-hidden"],[1,"fixed","inset-0","z-50","flex"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"grid","grid-cols-3","gap-6","mb-8"],[1,"col-span-2","bg-slate-800/50","rounded-xl","p-5","border","border-slate-700/50"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white"],[1,"flex","gap-2"],[1,"px-3","py-1","text-sm","rounded-lg",3,"click"],[1,"h-48","flex","items-end","gap-2"],[1,"flex-1","flex","flex-col","items-center","gap-1"],[1,"flex","justify-center","gap-6","mt-4","text-sm"],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","rounded","bg-purple-500"],[1,"text-slate-400"],[1,"w-3","h-3","rounded","bg-emerald-500"],[1,"bg-slate-800/50","rounded-xl","p-5","border","border-slate-700/50"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"space-y-3"],[1,"text-center","py-8","text-slate-500"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","mb-8"],[1,"p-5","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-purple-500","text-white","text-sm","rounded-lg","hover:bg-purple-600","flex","items-center","gap-1"],[1,"text-xs","text-slate-400","hover:text-white"],[1,"text-sm","text-slate-400"],[1,"divide-y","divide-slate-700/50","max-h-[300px]","overflow-y-auto"],[1,"p-4","hover:bg-slate-700/30","transition-colors","cursor-pointer"],[1,"p-8","text-center","text-slate-500"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"divide-y","divide-slate-700/50"],[1,"p-4","hover:bg-slate-700/30","transition-colors"],[1,"bg-gradient-to-r","from-emerald-500","to-teal-500","rounded-xl","p-4","shadow-2xl","max-w-sm"],[1,"flex","items-start","gap-3"],[1,"w-10","h-10","bg-white/20","rounded-full","flex","items-center","justify-center","text-2xl"],[1,"flex-1"],[1,"font-bold","text-white","text-lg"],[1,"text-white/90","text-sm","mt-1"],[1,"font-medium"],[1,"text-white/80","text-xs","mt-1"],[1,"flex","gap-2","mt-3"],[1,"px-3","py-1.5","bg-white/20","hover:bg-white/30","text-white","text-xs","rounded-lg",3,"click"],[1,"px-3","py-1.5","bg-white/10","hover:bg-white/20","text-white/80","text-xs","rounded-lg",3,"click"],[1,"text-white/60","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"w-2","h-2","bg-emerald-500","rounded-full"],[1,"grid","grid-cols-6","gap-4","mb-8"],[1,"bg-gradient-to-br","from-purple-500/20","to-purple-600/10","rounded-xl","p-4","border","border-purple-500/30"],[1,"text-3xl","font-bold","text-purple-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"bg-gradient-to-br","from-emerald-500/20","to-emerald-600/10","rounded-xl","p-4","border","border-emerald-500/30"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"w-2","h-2","bg-emerald-500","rounded-full","animate-pulse"],[1,"bg-gradient-to-br","from-cyan-500/20","to-cyan-600/10","rounded-xl","p-4","border","border-cyan-500/30"],[1,"text-3xl","font-bold","text-cyan-400"],[1,"bg-gradient-to-br","from-amber-500/20","to-amber-600/10","rounded-xl","p-4","border","border-amber-500/30"],[1,"text-3xl","font-bold","text-amber-400"],[1,"bg-gradient-to-br","from-pink-500/20","to-pink-600/10","rounded-xl","p-4","border","border-pink-500/30"],[1,"text-3xl","font-bold","text-pink-400"],[1,"h-1.5","bg-slate-700","rounded-full","mt-2","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-pink-500","to-rose-500","rounded-full","transition-all"],[1,"bg-gradient-to-br","from-blue-500/20","to-blue-600/10","rounded-xl","p-4","border","border-blue-500/30"],[1,"text-3xl","font-bold","text-blue-400"],[1,"bg-gradient-to-r","from-cyan-500/10","to-purple-500/10","rounded-xl","border","border-cyan-500/30","p-4","mb-8"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"flex","items-center","gap-2","text-sm","text-slate-400"],[1,"grid","grid-cols-5","gap-4"],[1,"bg-slate-800/50","rounded-lg","p-3","text-center"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-xs","text-slate-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-2xl","font-bold","text-amber-400"],[1,"text-2xl","font-bold","text-pink-400"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"px-3","py-1.5","bg-purple-500/20","text-purple-400","rounded-lg","text-sm","hover:bg-purple-500/30",3,"click"],[1,"divide-y","divide-slate-700/50","max-h-[400px]","overflow-y-auto"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center","text-2xl"],[1,"font-medium","text-white"],[1,"text-sm","text-slate-400","flex","items-center","gap-2"],[1,"text-slate-600"],[1,"text-emerald-400"],[1,"text-right"],[1,"text-lg","font-bold"],[1,"text-xs","text-slate-500"],[1,"px-3","py-1","rounded-full","text-xs","font-medium"],[1,"px-3","py-1.5","bg-yellow-500/20","text-yellow-400","rounded-lg","text-sm","hover:bg-yellow-500/30"],[1,"px-3","py-1.5","bg-emerald-500/20","text-emerald-400","rounded-lg","text-sm","hover:bg-emerald-500/30"],[1,"px-3","py-1.5","bg-yellow-500/20","text-yellow-400","rounded-lg","text-sm","hover:bg-yellow-500/30",3,"click"],[1,"px-3","py-1.5","bg-emerald-500/20","text-emerald-400","rounded-lg","text-sm","hover:bg-emerald-500/30",3,"click"],[1,"text-4xl","mb-2"],[1,"mt-4","px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30",3,"click"],[1,"text-4xl","font-bold","text-purple-400"],[1,"text-xs","text-purple-400/70","mt-2"],[1,"text-4xl","font-bold","text-emerald-400"],[1,"text-xs","text-emerald-400/70","mt-2"],[1,"text-4xl","font-bold","text-cyan-400"],[1,"text-xs","text-cyan-400/70","mt-2"],[1,"text-4xl","font-bold","text-amber-400"],[1,"text-xs","text-amber-400/70","mt-2"],[1,"text-4xl","font-bold","text-pink-400"],[1,"h-1.5","bg-slate-700","rounded-full","mt-3","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-pink-500","to-rose-500","rounded-full","transition-all","duration-500"],[1,"p-4","border-b","border-purple-500/20","flex","items-center","justify-between"],[1,"w-3","h-3","bg-green-500","rounded-full","animate-pulse"],[1,"px-2","py-0.5","bg-purple-500/30","text-purple-300","text-xs","rounded-full"],[1,"px-3","py-1.5","bg-amber-500/20","text-amber-400","rounded-lg","text-sm","hover:bg-amber-500/30"],[1,"px-3","py-1.5","bg-red-500/20","text-red-400","rounded-lg","text-sm","hover:bg-red-500/30",3,"click"],[1,"p-4"],[1,"mb-4"],[1,"text-sm","text-slate-400","mb-1"],[1,"text-white","font-medium"],[1,"grid","grid-cols-6","gap-3","mb-4"],[1,"text-2xl","font-bold"],[1,"mb-4","p-3","bg-slate-800/30","rounded-lg"],[1,"mb-4","p-3","bg-slate-800/50","rounded-lg"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xs","text-purple-400","hover:text-purple-300","flex","items-center","gap-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"space-y-2","max-h-48","overflow-y-auto"],[1,"text-center","py-4","text-slate-500","text-sm"],[1,"px-3","py-1.5","bg-amber-500/20","text-amber-400","rounded-lg","text-sm","hover:bg-amber-500/30",3,"click"],[1,"text-sm","text-slate-400","mb-2"],[1,"flex","items-center","gap-1"],[1,"flex-1","relative"],[1,"h-2","rounded-full","transition-all"],[1,"text-xs","text-center","mt-1"],[1,"w-4","h-px","bg-slate-600"],[1,"text-sm","text-white","font-medium"],[1,"text-slate-500","ml-1"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden","mb-3"],[1,"h-full","bg-gradient-to-r","from-purple-500","to-pink-500","transition-all","duration-300"],[1,"flex","items-center","justify-between","text-sm"],[1,"text-xs","text-slate-500","mt-2"],[1,"mt-3","pt-3","border-t","border-slate-700"],[1,"w-2","h-2","bg-green-500","rounded-full","animate-pulse"],[1,"text-white"],[1,"px-2","py-1","bg-slate-600","text-slate-300","text-xs","rounded","hover:bg-slate-500",3,"click"],[1,"px-2","py-1","bg-emerald-500/20","text-emerald-400","text-xs","rounded","hover:bg-emerald-500/30",3,"click"],[1,"text-xs","text-slate-400","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-emerald-500/20","text-emerald-400","text-xs","rounded-full","flex","items-center","gap-1"],[1,"px-2","py-1","bg-amber-500/20","text-amber-400","text-xs","rounded-full","flex","items-center","gap-1"],[1,"px-2","py-1","bg-slate-500/20","text-slate-400","text-xs","rounded-full","flex","items-center","gap-1"],[1,"px-2","py-1","bg-red-500/20","text-red-400","text-xs","rounded-full","flex","items-center","gap-1"],[1,"px-2","py-1","bg-gray-500/20","text-gray-400","text-xs","rounded-full","flex","items-center","gap-1"],[1,"mt-2","text-xs","text-purple-400","hover:text-purple-300",3,"click"],[1,"px-2","py-1","bg-slate-700","rounded-full","text-xs","text-slate-300","flex","items-center","gap-1"],[1,"px-2","py-1","bg-slate-600","rounded-full","text-xs","text-slate-400"],[1,"w-2","h-2","rounded-full"],[1,"flex","gap-3","p-2","rounded-lg",3,"bg-slate-700/50","bg-emerald-500/10"],[1,"flex","gap-3","p-2","rounded-lg"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm"],[1,"flex-1","min-w-0"],[1,"text-xs","text-slate-400","mb-0.5"],[1,"text-sm","text-white","truncate"],[1,"absolute","inset-0","bg-black/50",3,"click"],[1,"absolute","right-0","top-0","bottom-0","w-[500px]","bg-slate-900","border-l","border-slate-700","flex","flex-col","shadow-2xl"],[1,"p-4","border-b","border-slate-700","flex","items-center","justify-between"],[1,"text-xl"],[1,"p-2","hover:bg-slate-700","rounded-lg","text-slate-400",3,"click"],[1,"flex-1","overflow-y-auto","p-4","space-y-3"],[1,"flex","gap-3",3,"flex-row-reverse"],[1,"border-t","border-slate-700","p-4"],[1,"flex","items-center","gap-2","mb-3"],[1,"text-xs","px-2","py-0.5","rounded-full"],[1,"text-xs","text-purple-400","hover:text-purple-300",3,"click"],[1,"mb-3"],[1,"flex-1","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder:text-slate-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"ngModelChange","keydown.enter","ngModel","disabled","placeholder"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","text-sm","hover:bg-purple-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"mt-3","p-3","bg-purple-500/10","border","border-purple-500/30","rounded-lg"],[1,"flex","gap-3"],[1,"w-10","h-10","rounded-full","flex","items-center","justify-center","flex-shrink-0"],[1,"max-w-[70%]","rounded-xl","p-3"],[1,"text-xs","mb-1"],[1,"text-slate-500","ml-2"],[1,"text-sm","text-white","whitespace-pre-wrap"],[1,"text-xs","text-slate-400","mb-1","block"],[1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm",3,"ngModelChange","ngModel"],[3,"value"],[1,"text-xs","text-purple-400","mb-1"],[1,"text-sm","text-white"],[1,"relative","bg-slate-900","rounded-xl","border","border-slate-700","w-[700px]","max-h-[80vh]","overflow-hidden","shadow-2xl"],[1,"p-4","border-b","border-slate-700"],[1,"grid","grid-cols-5","gap-3"],[1,"bg-emerald-500/10","rounded-lg","p-3","text-center","border","border-emerald-500/30"],[1,"text-xs","text-emerald-400/70"],[1,"bg-amber-500/10","rounded-lg","p-3","text-center","border","border-amber-500/30"],[1,"text-xs","text-amber-400/70"],[1,"bg-slate-500/10","rounded-lg","p-3","text-center","border","border-slate-500/30"],[1,"text-2xl","font-bold","text-slate-400"],[1,"text-xs","text-slate-400/70"],[1,"bg-red-500/10","rounded-lg","p-3","text-center","border","border-red-500/30"],[1,"text-2xl","font-bold","text-red-400"],[1,"text-xs","text-red-400/70"],[1,"bg-gray-500/10","rounded-lg","p-3","text-center","border","border-gray-500/30"],[1,"text-2xl","font-bold","text-gray-400"],[1,"text-xs","text-gray-400/70"],[1,"mt-4","flex","items-center","gap-4"],[1,"h-3","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-teal-500","transition-all"],[1,"p-4","max-h-[400px]","overflow-y-auto"],[1,"w-full"],[1,"text-xs","text-slate-400","border-b","border-slate-700"],[1,"text-left","py-2","px-2"],[1,"text-right","py-2","px-2"],[1,"text-sm"],[1,"border-b","border-slate-800","hover:bg-slate-800/50"],[1,"p-4","border-t","border-slate-700","flex","justify-between"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-600",3,"click"],[1,"py-2","px-2","text-white"],[1,"py-2","px-2"],[1,"px-2","py-0.5","rounded-full","text-xs"],[1,"py-2","px-2","text-right","text-slate-300"],[1,"py-2","px-2","text-right","text-slate-400"],[1,"w-full","bg-slate-700","rounded-t","relative","flex","flex-col","justify-end"],[1,"absolute","-top-5","left-1/2","-translate-x-1/2","text-xs","text-slate-400"],[1,"w-6","h-6","rounded-full","flex","items-center","justify-center","text-xs","font-bold"],[1,"text-sm","font-medium","text-white","truncate"],[1,"text-sm","font-bold","text-emerald-400"],[1,"px-3","py-1.5","bg-purple-500","text-white","text-sm","rounded-lg","hover:bg-purple-600","flex","items-center","gap-1",3,"click"],[1,"text-xs","text-slate-400","hover:text-white",3,"click"],[1,"p-4","hover:bg-slate-700/30","transition-colors","cursor-pointer",3,"click"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-500","bg-slate-700","text-purple-500","focus:ring-purple-500",3,"click","change","checked"],[1,"w-10","h-10","rounded-full","flex","items-center","justify-center"],[1,"text-lg"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"text-sm","font-bold","text-purple-400"],[1,"p-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"relative","bg-slate-900","rounded-xl","border","border-slate-700","w-[800px]","max-h-[85vh]","overflow-hidden","shadow-2xl"],[1,"p-4","border-b","border-slate-700","grid","grid-cols-5","gap-3"],[1,"bg-slate-800","rounded-lg","p-3","text-center"],[1,"text-xl","font-bold","text-purple-400"],[1,"text-xl","font-bold","text-emerald-400"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-amber-400"],[1,"text-xl","font-bold","text-pink-400"],[1,"p-4","max-h-[400px]","overflow-y-auto","space-y-3"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],[1,"relative","bg-slate-900","rounded-xl","border","border-slate-700","w-[900px]","max-h-[85vh]","overflow-hidden","shadow-2xl"],[1,"px-2","py-0.5","bg-purple-500/20","text-purple-400","text-xs","rounded-full"],[1,"p-4","overflow-x-auto"],[1,"w-full","text-sm"],[1,"text-slate-400","border-b","border-slate-700"],[1,"text-left","py-3","px-3","w-32"],[1,"text-center","py-3","px-3"],[1,"border-b","border-slate-800"],[1,"py-3","px-3","text-slate-400"],[1,"py-3","px-3","text-center"],[1,"py-3","px-3","text-center","font-bold",3,"text-emerald-400","text-white"],[1,"py-3","px-3","text-center","text-slate-300"],[1,"p-4","border-t","border-slate-700","bg-slate-800/50"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-emerald-400","font-bold"],[1,"p-4","border-t","border-slate-700","flex","justify-end","gap-3"],[1,"flex","flex-col","items-center"],[1,"px-2","py-0.5","rounded-full","text-xs","mb-1"],[1,"text-white","text-xs"],[1,"py-3","px-3","text-center","font-bold"],[1,"w-3","h-3","rounded-full"],[1,"flex","items-center","gap-6"],[1,"text-center"],[1,"text-lg","font-bold","text-purple-400"],[1,"text-lg","font-bold","text-cyan-400"],[1,"p-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600"],[1,"p-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"p-2","bg-emerald-500/20","text-emerald-400","rounded-lg","hover:bg-emerald-500/30",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"]],template:function(t,n){t&1&&(r(0,"div",1),y(1,FP,21,2,"div",2),r(2,"div",3)(3,"div")(4,"h2",4)(5,"span",5),l(6,"\u{1F4CA}"),s(),l(7," \u5354\u4F5C\u76E3\u63A7\u4E2D\u5FC3 "),s(),r(8,"p",6),l(9,"\u5BE6\u6642\u76E3\u63A7\u591A\u89D2\u8272\u5354\u4F5C\u72C0\u614B"),s()(),r(10,"div",7)(11,"button",8),x("click",function(){return n.refreshData()}),ne(),r(12,"svg",9),B(13,"path",10),s(),l(14," \u5237\u65B0 "),s(),ce(),r(15,"div",11),l(16),Ee(17,"date"),s()()(),r(18,"div",12)(19,"button",13),x("click",function(){return n.viewMode.set("unified")}),l(20," \u{1F4CA} \u7D71\u4E00\u4EFB\u52D9\u8996\u5716 "),s(),r(21,"button",13),x("click",function(){return n.viewMode.set("legacy")}),l(22," \u{1F3AD} \u5354\u4F5C\u7FA4\u7D44\u8996\u5716 "),s(),r(23,"div",14),y(24,PP,3,0,"span",15)(25,RP,2,0,"span",16),s()(),y(26,UP,84,16),y(27,$P,39,13,"div",17),y(28,lR,64,25,"div",18),y(29,gR,32,20,"div",19),y(30,_R,71,13,"div",20),r(31,"div",21)(32,"div",22)(33,"div",23)(34,"h3",24),l(35,"\u5354\u4F5C\u8DA8\u52E2"),s(),r(36,"div",25)(37,"button",26),x("click",function(){return n.chartPeriod.set("week")}),l(38," 7\u5929 "),s(),r(39,"button",26),x("click",function(){return n.chartPeriod.set("month")}),l(40," 30\u5929 "),s()()(),r(41,"div",27),O(42,vR,6,10,"div",28,IP),s(),r(44,"div",29)(45,"div",30),B(46,"div",31),r(47,"span",32),l(48,"\u65B0\u5EFA\u7FA4\u7D44"),s()(),r(49,"div",30),B(50,"div",33),r(51,"span",32),l(52,"\u6210\u529F\u8F49\u5316"),s()()()(),r(53,"div",34)(54,"h3",35),l(55,"\u89D2\u8272\u6548\u679C\u6392\u540D"),s(),r(56,"div",36),O(57,xR,13,20,"div",7,ct),y(59,CR,2,0,"div",37),s()()(),r(60,"div",38)(61,"div",39)(62,"h3",40)(63,"span"),l(64,"\u{1F4DC}"),s(),l(65," \u57F7\u884C\u6B77\u53F2 "),s(),r(66,"div",7),y(67,bR,4,1,"button",41),y(68,yR,2,0,"button",42),r(69,"span",43),l(70),s()()(),r(71,"div",44),O(72,SR,33,22,"div",45,Lt),y(74,wR,5,0,"div",46),s()(),y(75,AR,52,8,"div",20),y(76,BR,76,3,"div",20),r(77,"div",47)(78,"div",39)(79,"h3",24),l(80,"\u6D3B\u8E8D\u5354\u4F5C\u7FA4\u7D44"),s(),r(81,"span",43),l(82),s()(),r(83,"div",48),O(84,UR,30,33,"div",49,Lt),y(86,GR,5,0,"div",46),s()()()),t&2&&(c(),S(n.showConversionAlert()&&n.conversionAlertData()?1:-1),c(11),N("animate-spin",n.isRefreshing()),c(4),M(" \u6700\u5F8C\u66F4\u65B0: ",yt(17,51,n.lastUpdate(),"HH:mm:ss")," "),c(3),N("bg-purple-500",n.viewMode()==="unified")("text-white",n.viewMode()==="unified")("bg-slate-700",n.viewMode()!=="unified")("text-slate-400",n.viewMode()!=="unified"),c(2),N("bg-purple-500",n.viewMode()==="legacy")("text-white",n.viewMode()==="legacy")("bg-slate-700",n.viewMode()!=="legacy")("text-slate-400",n.viewMode()!=="legacy"),c(3),S(n.aiConnected()?24:25),c(2),S(n.viewMode()==="unified"?26:-1),c(),S(n.viewMode()==="legacy"?27:-1),c(),S(n.currentExecution()?28:-1),c(),S(n.showConversationPanel()&&n.currentExecution()?29:-1),c(),S(n.showResultsPanel()?30:-1),c(7),N("bg-purple-500",n.chartPeriod()==="week")("text-white",n.chartPeriod()==="week")("bg-slate-700",n.chartPeriod()!=="week")("text-slate-400",n.chartPeriod()!=="week"),c(2),N("bg-purple-500",n.chartPeriod()==="month")("text-white",n.chartPeriod()==="month")("bg-slate-700",n.chartPeriod()!=="month")("text-slate-400",n.chartPeriod()!=="month"),c(3),U(n.chartData()),c(15),U(n.topRoles()),c(2),S(n.topRoles().length===0?59:-1),c(8),S(n.selectedForCompare().length>=2?67:-1),c(),S(n.selectedForCompare().length>0?68:-1),c(2),M("\u5171 ",n.executionHistory().length," \u689D\u8A18\u9304"),c(2),U(n.executionHistory().slice(0,10)),c(2),S(n.executionHistory().length===0?74:-1),c(),S(n.showHistoryPanel()&&n.selectedHistory()?75:-1),c(),S(n.showABTestPanel()&&n.selectedForCompare().length>=2?76:-1),c(6),M("\u5171 ",n.activeGroups().length," \u500B"),c(2),U(n.activeGroups()),c(2),S(n.activeGroups().length===0?86:-1))},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he,fr,St,yn],encapsulation:2})}};var Tm={sales:{icon:"\u{1F4BC}",label:"\u92B7\u552E\u985E",color:"bg-blue-500"},tech:{icon:"\u{1F4BB}",label:"\u6280\u8853\u985E",color:"bg-purple-500"},service:{icon:"\u{1F3A7}",label:"\u5BA2\u670D\u985E",color:"bg-green-500"},expert:{icon:"\u{1F393}",label:"\u884C\u696D\u5C08\u5BB6",color:"bg-amber-500"},social:{icon:"\u{1F465}",label:"\u793E\u4EA4\u985E",color:"bg-pink-500"},operation:{icon:"\u{1F4E2}",label:"\u904B\u71DF\u985E",color:"bg-orange-500"},management:{icon:"\u{1F454}",label:"\u7BA1\u7406\u985E",color:"bg-slate-500"},special:{icon:"\u2B50",label:"\u7279\u6B8A\u5834\u666F",color:"bg-cyan-500"}},Bc=[{id:"preset_sales_manager",name:"\u92B7\u552E\u7D93\u7406",type:"custom",category:"sales",roleType:"sales_manager",personality:{description:"\u5C08\u696D\u7684\u92B7\u552E\u7D93\u7406\uFF0C\u6709\u6C7A\u7B56\u6B0A\uFF0C\u80FD\u63D0\u4F9B\u7279\u5225\u512A\u60E0",speakingStyle:"professional",traits:["\u5C08\u696D","\u6C7A\u7B56\u8005","\u8AC7\u5224\u9AD8\u624B","\u76EE\u6A19\u5C0E\u5411"],background:"10\u5E74\u92B7\u552E\u7D93\u9A57\uFF0C\u8CA0\u8CAC\u5927\u5BA2\u6236\u95DC\u4FC2"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u4E00\u4F4D\u8CC7\u6DF1\u92B7\u552E\u7D93\u7406\uFF0C\u6709\u6B0A\u6279\u51C6\u7279\u5225\u6298\u6263\u548C\u512A\u60E0\u65B9\u6848\u3002\u4F60\u5584\u65BC\u50BE\u807D\u5BA2\u6236\u9700\u6C42\uFF0C\u63D0\u4F9B\u91CF\u8EAB\u5B9A\u5236\u7684\u89E3\u6C7A\u65B9\u6848\u3002\u8AAA\u8A71\u5C08\u696D\u4F46\u4E0D\u5931\u6EAB\u5EA6\uFF0C\u80FD\u5728\u95DC\u9375\u6642\u523B\u505A\u51FA\u8B93\u6B65\u4FC3\u6210\u4EA4\u6613\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u8AC7\u5224\u4FC3\u55AE","\u50F9\u683C\u5BE9\u6279","\u5927\u5BA2\u6236\u7DAD\u8B77","\u5718\u968A\u5354\u8ABF"],scenarios:["\u8AC7\u5224\u4FC3\u55AE","VIP\u5BA2\u6236","\u50F9\u683C\u8AC7\u5224"],keyPhrases:["\u9019\u500B\u50F9\u683C\u6211\u53EF\u4EE5\u7279\u6279","\u70BA\u60A8\u722D\u53D6\u6700\u5927\u512A\u60E0","\u9577\u671F\u5408\u4F5C\u5171\u8D0F"],isActive:!0},{id:"preset_product_consultant",name:"\u7522\u54C1\u9867\u554F",type:"custom",category:"sales",roleType:"product_consultant",personality:{description:"\u6EAB\u548C\u5C08\u696D\u7684\u7522\u54C1\u5C08\u5BB6\uFF0C\u6DF1\u5165\u4E86\u89E3\u7522\u54C1\u7D30\u7BC0",speakingStyle:"professional",traits:["\u5C08\u696D","\u8010\u5FC3","\u7D30\u7DFB","\u77E5\u8B58\u8C50\u5BCC"],background:"\u7522\u54C1\u7814\u767C\u80CC\u666F\uFF0C\u719F\u6089\u6BCF\u500B\u529F\u80FD\u7D30\u7BC0"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u7522\u54C1\u9867\u554F\uFF0C\u5C0D\u7522\u54C1\u529F\u80FD\u4E86\u5982\u6307\u638C\u3002\u4F60\u8010\u5FC3\u89E3\u7B54\u6BCF\u4E00\u500B\u554F\u984C\uFF0C\u5584\u7528\u6848\u4F8B\u548C\u6BD4\u55BB\u8B93\u8907\u96DC\u529F\u80FD\u8B8A\u5F97\u6613\u61C2\u3002\u4F60\u6703\u4E3B\u52D5\u8A62\u554F\u5BA2\u6236\u9700\u6C42\uFF0C\u63A8\u85A6\u6700\u9069\u5408\u7684\u65B9\u6848\u3002",responseLength:"long",emojiFrequency:"low",typingSpeed:"slow"},responsibilities:["\u7522\u54C1\u4ECB\u7D39","\u529F\u80FD\u6F14\u793A","\u9700\u6C42\u5206\u6790","\u65B9\u6848\u63A8\u85A6"],scenarios:["\u7522\u54C1\u4ECB\u7D39","\u529F\u80FD\u8AEE\u8A62","\u65B9\u6848\u5C0D\u6BD4"],keyPhrases:["\u9019\u500B\u529F\u80FD\u7684\u8A2D\u8A08\u7406\u5FF5\u662F","\u6839\u64DA\u60A8\u7684\u9700\u6C42\u63A8\u85A6","\u8B93\u6211\u8A73\u7D30\u89E3\u91CB\u4E00\u4E0B"],isActive:!0},{id:"preset_account_manager",name:"\u5BA2\u6236\u7D93\u7406",type:"custom",category:"sales",roleType:"account_manager",personality:{description:"\u8CBC\u5FC3\u5468\u5230\u7684\u5BA2\u6236\u7D93\u7406\uFF0C\u6CE8\u91CD\u9577\u671F\u95DC\u4FC2\u7DAD\u8B77",speakingStyle:"friendly",traits:["\u8CBC\u5FC3","\u7D30\u5FC3","\u8CA0\u8CAC","\u9577\u671F\u601D\u7DAD"],background:"\u5C08\u6CE8\u5BA2\u6236\u95DC\u4FC2\u7BA1\u7406\uFF0C\u8001\u5BA2\u6236\u8F49\u4ECB\u7D39\u5C08\u5BB6"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5C08\u5C6C\u5BA2\u6236\u7D93\u7406\uFF0C\u8CA0\u8CAC\u7DAD\u8B77\u9577\u671F\u5BA2\u6236\u95DC\u4FC2\u3002\u4F60\u8A18\u5F97\u6BCF\u4F4D\u5BA2\u6236\u7684\u504F\u597D\uFF0C\u6703\u5728\u7BC0\u65E5\u9001\u4E0A\u554F\u5019\uFF0C\u5B9A\u671F\u56DE\u8A2A\u4E86\u89E3\u4F7F\u7528\u60C5\u6CC1\u3002\u4F60\u7684\u76EE\u6A19\u662F\u8B93\u5BA2\u6236\u611F\u53D7\u5230\u88AB\u91CD\u8996\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u8001\u5BA2\u6236\u7DAD\u8B77","\u7E8C\u8CBB\u8DDF\u9032","\u5347\u7D1A\u63A8\u85A6","\u8F49\u4ECB\u7D39"],scenarios:["\u8001\u5BA2\u6236\u7DAD\u8B77","\u7E8C\u8CBB\u63D0\u9192","\u5BA2\u6236\u95DC\u61F7"],keyPhrases:["\u611F\u8B1D\u60A8\u4E00\u76F4\u4EE5\u4F86\u7684\u652F\u6301","\u7279\u610F\u70BA\u8001\u5BA2\u6236\u6E96\u5099","\u6709\u4EFB\u4F55\u554F\u984C\u96A8\u6642\u627E\u6211"],isActive:!0},{id:"preset_sales_rep",name:"\u696D\u52D9\u4EE3\u8868",type:"custom",category:"sales",roleType:"sales_rep",personality:{description:"\u71B1\u60C5\u7A4D\u6975\u7684\u696D\u52D9\u4EE3\u8868\uFF0C\u5FEB\u901F\u97FF\u61C9\u5BA2\u6236\u9700\u6C42",speakingStyle:"enthusiastic",traits:["\u71B1\u60C5","\u7A4D\u6975","\u5FEB\u901F\u97FF\u61C9","\u884C\u52D5\u6D3E"],background:"\u4E00\u7DDA\u92B7\u552E\u7CBE\u82F1\uFF0C\u5BA2\u6236\u958B\u767C\u5C08\u5BB6"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u71B1\u60C5\u7684\u696D\u52D9\u4EE3\u8868\uFF0C\u5C0D\u6BCF\u4E00\u500B\u6F5B\u5728\u5BA2\u6236\u90FD\u5145\u6EFF\u71B1\u60C5\u3002\u4F60\u5FEB\u901F\u97FF\u61C9\u3001\u4E3B\u52D5\u8DDF\u9032\uFF0C\u5584\u65BC\u767C\u73FE\u5BA2\u6236\u9700\u6C42\u4E26\u5339\u914D\u7522\u54C1\u3002\u4F60\u7684\u76EE\u6A19\u662F\u5EFA\u7ACB\u521D\u6B21\u4FE1\u4EFB\u3002",responseLength:"short",emojiFrequency:"medium",typingSpeed:"fast"},responsibilities:["\u9996\u6B21\u63A5\u89F8","\u9700\u6C42\u6316\u6398","\u521D\u6B65\u5831\u50F9","\u8DDF\u9032\u8F49\u5316"],scenarios:["\u65B0\u5BA2\u6236\u958B\u767C","\u521D\u6B21\u63A5\u89F8","\u5FEB\u901F\u97FF\u61C9"],keyPhrases:["\u5F88\u9AD8\u8208\u8A8D\u8B58\u60A8","\u6211\u7ACB\u523B\u70BA\u60A8\u67E5\u8A62","\u6709\u4EFB\u4F55\u554F\u984C\u96A8\u6642\u554F"],isActive:!0},{id:"preset_solution_expert",name:"\u65B9\u6848\u5C08\u5BB6",type:"custom",category:"sales",roleType:"solution_expert",personality:{description:"\u5206\u6790\u578B\u5C08\u5BB6\uFF0C\u64C5\u9577\u5B9A\u5236\u89E3\u6C7A\u65B9\u6848",speakingStyle:"professional",traits:["\u5206\u6790\u578B","\u908F\u8F2F\u6E05\u6670","\u5B9A\u5236\u5316","\u5168\u5C40\u601D\u7DAD"],background:"\u8AEE\u8A62\u9867\u554F\u51FA\u8EAB\uFF0C\u670D\u52D9\u904E\u591A\u5BB6\u5927\u578B\u4F01\u696D"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u89E3\u6C7A\u65B9\u6848\u5C08\u5BB6\uFF0C\u64C5\u9577\u5206\u6790\u5BA2\u6236\u696D\u52D9\u5834\u666F\uFF0C\u8A2D\u8A08\u5B9A\u5236\u5316\u65B9\u6848\u3002\u4F60\u6703\u7528\u6578\u64DA\u548C\u6848\u4F8B\u8AAA\u8A71\uFF0C\u5584\u65BC\u756B\u6D41\u7A0B\u5716\u548C\u5C0D\u6BD4\u8868\u3002\u4F60\u7684\u65B9\u6848\u7E3D\u662F\u5207\u5408\u5BA2\u6236\u5BE6\u969B\u9700\u6C42\u3002",responseLength:"long",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u9700\u6C42\u8ABF\u7814","\u65B9\u6848\u8A2D\u8A08","ROI\u5206\u6790","\u5BE6\u65BD\u898F\u5283"],scenarios:["\u5927\u5BA2\u6236\u5B9A\u5236","\u4F01\u696D\u65B9\u6848","\u8907\u96DC\u9700\u6C42"],keyPhrases:["\u6839\u64DA\u8CB4\u516C\u53F8\u7684\u60C5\u6CC1","\u6211\u5011\u5EFA\u8B70\u7684\u65B9\u6848\u662F","\u9810\u671FROI\u70BA"],isActive:!0},{id:"preset_price_specialist",name:"\u50F9\u683C\u5C08\u54E1",type:"custom",category:"sales",roleType:"price_specialist",personality:{description:"\u9748\u6D3B\u7684\u50F9\u683C\u8AC7\u5224\u5C08\u5BB6\uFF0C\u6709\u6298\u6263\u6B0A\u9650",speakingStyle:"friendly",traits:["\u9748\u6D3B","\u8AC7\u5224\u9AD8\u624B","\u6578\u5B57\u654F\u611F","\u96D9\u8D0F\u601D\u7DAD"],background:"\u5B9A\u50F9\u7B56\u7565\u5C08\u5BB6\uFF0C\u7CBE\u901A\u5404\u7A2E\u512A\u60E0\u65B9\u6848\u7D44\u5408"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u50F9\u683C\u5C08\u54E1\uFF0C\u8CA0\u8CAC\u5831\u50F9\u548C\u512A\u60E0\u65B9\u6848\u3002\u4F60\u4E86\u89E3\u5404\u7A2E\u6298\u6263\u7B56\u7565\uFF0C\u80FD\u6839\u64DA\u5BA2\u6236\u60C5\u6CC1\u9748\u6D3B\u8ABF\u6574\u3002\u4F60\u5584\u65BC\u5275\u9020\u96D9\u8D0F\u5C40\u9762\uFF0C\u65E2\u4FDD\u8B77\u516C\u53F8\u5229\u76CA\u53C8\u6EFF\u8DB3\u5BA2\u6236\u671F\u671B\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u5831\u50F9\u55AE\u88FD\u4F5C","\u6298\u6263\u5BE9\u6279","\u4ED8\u6B3E\u65B9\u6848","\u5408\u540C\u8AC7\u5224"],scenarios:["\u50F9\u683C\u8AC7\u5224","\u5831\u50F9\u8AEE\u8A62","\u512A\u60E0\u7533\u8ACB"],keyPhrases:["\u70BA\u60A8\u7533\u8ACB\u4E86\u7279\u5225\u6298\u6263","\u9019\u662F\u6700\u512A\u60E0\u7684\u50F9\u683C\u4E86","\u4ED8\u6B3E\u65B9\u5F0F\u53EF\u4EE5\u9748\u6D3B"],isActive:!0},{id:"preset_regional_director",name:"\u5340\u57DF\u7E3D\u76E3",type:"custom",category:"sales",roleType:"regional_director",personality:{description:"\u9AD8\u5C64\u7BA1\u7406\u8005\uFF0C\u6709\u7279\u6279\u6B0A\u9650\uFF0C\u8655\u7406VIP\u5BA2\u6236",speakingStyle:"professional",traits:["\u6B0A\u5A01","\u5927\u5C40\u89C0","\u7279\u6279\u6B0A\u9650","\u6230\u7565\u601D\u7DAD"],background:"\u5340\u57DF\u8CA0\u8CAC\u4EBA\uFF0C\u76F4\u63A5\u5411\u516C\u53F8\u9AD8\u5C64\u532F\u5831"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5340\u57DF\u7E3D\u76E3\uFF0C\u7BA1\u7406\u6574\u500B\u5340\u57DF\u7684\u696D\u52D9\u3002\u4F60\u5F88\u5C11\u76F4\u63A5\u5C0D\u63A5\u5BA2\u6236\uFF0C\u53EA\u6709\u91CD\u8981\u5BA2\u6236\u624D\u6703\u89AA\u81EA\u51FA\u9762\u3002\u4F60\u8AAA\u8A71\u6709\u5206\u91CF\uFF0C\u627F\u8AFE\u5FC5\u9054\uFF0C\u80FD\u505A\u51FA\u5176\u4ED6\u4EBA\u7121\u6CD5\u505A\u7684\u6C7A\u5B9A\u3002",responseLength:"short",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["VIP\u5BA2\u6236","\u7279\u6279\u512A\u60E0","\u6230\u7565\u5408\u4F5C","\u91CD\u5927\u6C7A\u7B56"],scenarios:["VIP\u5BA2\u6236","\u6230\u7565\u5408\u4F5C","\u6700\u5F8C\u4FC3\u55AE"],keyPhrases:["\u6211\u89AA\u81EA\u4F86\u8DDF\u9032\u9019\u500B\u9805\u76EE","\u6211\u53EF\u4EE5\u7279\u6279","\u9019\u662F\u7E3D\u76E3\u7D1A\u5225\u7684\u512A\u60E0"],isActive:!0},{id:"preset_business_manager",name:"\u62DB\u5546\u7D93\u7406",type:"custom",category:"sales",roleType:"business_manager",personality:{description:"\u5408\u4F5C\u5171\u8D0F\u601D\u7DAD\uFF0C\u5C08\u6CE8B2B\u6E20\u9053\u62D3\u5C55",speakingStyle:"professional",traits:["\u5546\u52D9","\u5408\u4F5C\u601D\u7DAD","\u6E20\u9053\u5C08\u5BB6","\u96D9\u8D0F"],background:"\u6E20\u9053\u958B\u767C\u5C08\u5BB6\uFF0C\u64C5\u9577\u5EFA\u7ACB\u5408\u4F5C\u751F\u614B"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u62DB\u5546\u7D93\u7406\uFF0C\u8CA0\u8CAC\u6E20\u9053\u5408\u4F5C\u548C\u4EE3\u7406\u62DB\u5546\u3002\u4F60\u5584\u65BC\u6316\u6398\u5408\u4F5C\u6A5F\u6703\uFF0C\u8A2D\u8A08\u4E92\u5229\u5171\u8D0F\u7684\u5408\u4F5C\u65B9\u6848\u3002\u4F60\u61C2\u5F97\u6E20\u9053\u653F\u7B56\u548C\u5229\u6F64\u5206\u914D\uFF0C\u80FD\u5FEB\u901F\u8A55\u4F30\u5408\u4F5C\u53EF\u884C\u6027\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u6E20\u9053\u958B\u767C","\u4EE3\u7406\u62DB\u5546","\u5408\u4F5C\u8AC7\u5224","\u653F\u7B56\u5236\u5B9A"],scenarios:["B2B\u62DB\u5546","\u6E20\u9053\u5408\u4F5C","\u4EE3\u7406\u52A0\u76DF"],keyPhrases:["\u5171\u540C\u958B\u62D3\u5E02\u5834","\u5408\u4F5C\u6A21\u5F0F\u53EF\u4EE5\u63A2\u8A0E","\u6E20\u9053\u653F\u7B56\u652F\u6301"],isActive:!0},{id:"preset_tech_support",name:"\u6280\u8853\u652F\u6301",type:"custom",category:"tech",roleType:"tech_support",personality:{description:"\u8010\u5FC3\u5C08\u696D\u7684\u6280\u8853\u652F\u6301\uFF0C\u64C5\u9577\u554F\u984C\u89E3\u6C7A",speakingStyle:"professional",traits:["\u8010\u5FC3","\u5C08\u696D","\u554F\u984C\u89E3\u6C7A","\u908F\u8F2F\u6E05\u6670"],background:"\u6280\u8853\u80CC\u666F\u51FA\u8EAB\uFF0C\u719F\u6089\u5404\u7A2E\u6280\u8853\u554F\u984C"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u6280\u8853\u652F\u6301\u5DE5\u7A0B\u5E2B\uFF0C\u5C08\u9580\u89E3\u6C7A\u7528\u6236\u9047\u5230\u7684\u6280\u8853\u554F\u984C\u3002\u4F60\u6703\u8010\u5FC3\u5F15\u5C0E\u7528\u6236\u63CF\u8FF0\u554F\u984C\uFF0C\u63D0\u4F9B\u6E05\u6670\u7684\u6B65\u9A5F\u6307\u5C0E\u3002\u9047\u5230\u8907\u96DC\u554F\u984C\u6703\u5347\u7D1A\u8655\u7406\uFF0C\u78BA\u4FDD\u554F\u984C\u6700\u7D42\u89E3\u6C7A\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"medium"},responsibilities:["\u554F\u984C\u8A3A\u65B7","\u6545\u969C\u6392\u9664","\u4F7F\u7528\u6307\u5C0E","\u554F\u984C\u5347\u7D1A"],scenarios:["\u552E\u5F8C\u670D\u52D9","\u6280\u8853\u554F\u984C","\u4F7F\u7528\u56F0\u96E3"],keyPhrases:["\u8ACB\u60A8\u5617\u8A66\u4EE5\u4E0B\u6B65\u9A5F","\u9019\u500B\u554F\u984C\u7684\u539F\u56E0\u662F","\u5DF2\u70BA\u60A8\u8A18\u9304\u5DE5\u55AE"],isActive:!0},{id:"preset_product_engineer",name:"\u7522\u54C1\u5DE5\u7A0B\u5E2B",type:"custom",category:"tech",roleType:"product_engineer",personality:{description:"\u6DF1\u5EA6\u6280\u8853\u5C08\u5BB6\uFF0C\u4E86\u89E3\u7522\u54C1\u67B6\u69CB\u548C\u539F\u7406",speakingStyle:"professional",traits:["\u6280\u8853\u6DF1\u5EA6","\u539F\u7406\u8B1B\u89E3","\u67B6\u69CB\u601D\u7DAD","\u5275\u65B0"],background:"\u7522\u54C1\u7814\u767C\u5718\u968A\u6210\u54E1\uFF0C\u53C3\u8207\u6838\u5FC3\u529F\u80FD\u958B\u767C"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u7522\u54C1\u5DE5\u7A0B\u5E2B\uFF0C\u53C3\u8207\u7522\u54C1\u7684\u7814\u767C\u3002\u4F60\u4E86\u89E3\u6BCF\u500B\u529F\u80FD\u80CC\u5F8C\u7684\u6280\u8853\u539F\u7406\uFF0C\u80FD\u7528\u901A\u4FD7\u7684\u8A9E\u8A00\u89E3\u91CB\u8907\u96DC\u6982\u5FF5\u3002\u4F60\u6703\u5206\u4EAB\u7522\u54C1\u7684\u6280\u8853\u512A\u52E2\u548C\u5275\u65B0\u9EDE\u3002",responseLength:"long",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u6280\u8853\u8AEE\u8A62","\u529F\u80FD\u8B1B\u89E3","API\u5C0D\u63A5","\u6280\u8853\u8A55\u4F30"],scenarios:["\u6280\u8853\u8AEE\u8A62","\u6DF1\u5EA6\u529F\u80FD","API\u96C6\u6210"],keyPhrases:["\u5F9E\u6280\u8853\u89D2\u5EA6\u4F86\u8AAA","\u5E95\u5C64\u539F\u7406\u662F","\u9019\u500B\u529F\u80FD\u7684\u5BE6\u73FE\u65B9\u5F0F"],isActive:!0},{id:"preset_solution_architect",name:"\u89E3\u6C7A\u65B9\u6848\u67B6\u69CB\u5E2B",type:"custom",category:"tech",roleType:"solution_architect",personality:{description:"\u7CFB\u7D71\u8A2D\u8A08\u5C08\u5BB6\uFF0C\u64C5\u9577\u4F01\u696D\u7D1A\u89E3\u6C7A\u65B9\u6848",speakingStyle:"professional",traits:["\u5168\u5C40\u8996\u89D2","\u7CFB\u7D71\u8A2D\u8A08","\u4F01\u696D\u7D1A","\u6700\u4F73\u5BE6\u8E10"],background:"\u670D\u52D9\u904E\u5927\u578B\u4F01\u696D\u5BA2\u6236\uFF0C\u7CBE\u901A\u7CFB\u7D71\u67B6\u69CB"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u89E3\u6C7A\u65B9\u6848\u67B6\u69CB\u5E2B\uFF0C\u5C08\u9580\u70BA\u4F01\u696D\u5BA2\u6236\u8A2D\u8A08\u6574\u9AD4\u6280\u8853\u65B9\u6848\u3002\u4F60\u6703\u8003\u616E\u53EF\u64F4\u5C55\u6027\u3001\u5B89\u5168\u6027\u3001\u6027\u80FD\u7B49\u591A\u500B\u7DAD\u5EA6\uFF0C\u63D0\u4F9B\u6700\u4F73\u5BE6\u8E10\u5EFA\u8B70\u3002",responseLength:"long",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u67B6\u69CB\u8A2D\u8A08","\u7CFB\u7D71\u96C6\u6210","\u6280\u8853\u9078\u578B","\u5BE6\u65BD\u898F\u5283"],scenarios:["\u4F01\u696D\u5BA2\u6236","\u7CFB\u7D71\u96C6\u6210","\u8907\u96DC\u90E8\u7F72"],keyPhrases:["\u6574\u9AD4\u67B6\u69CB\u5EFA\u8B70","\u6700\u4F73\u5BE6\u8E10\u662F","\u8003\u616E\u5230\u64F4\u5C55\u6027"],isActive:!0},{id:"preset_ops_expert",name:"\u904B\u7DAD\u5C08\u5BB6",type:"custom",category:"tech",roleType:"ops_expert",personality:{description:"\u7A69\u5B9A\u53EF\u9760\u7684\u904B\u7DAD\u5C08\u5BB6\uFF0C7x24\u4FDD\u969C",speakingStyle:"professional",traits:["\u7A69\u5B9A\u53EF\u9760","\u97FF\u61C9\u8FC5\u901F","\u9810\u9632\u601D\u7DAD","\u7D30\u7DFB"],background:"\u591A\u5E74\u904B\u7DAD\u7D93\u9A57\uFF0C\u8655\u7406\u904E\u5404\u7A2E\u7DCA\u6025\u60C5\u6CC1"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u904B\u7DAD\u5C08\u5BB6\uFF0C\u8CA0\u8CAC\u7CFB\u7D71\u7684\u7A69\u5B9A\u904B\u884C\u3002\u4F60\u80FD\u5FEB\u901F\u97FF\u61C9\u5404\u7A2E\u554F\u984C\uFF0C\u6709\u5B8C\u5584\u7684\u76E3\u63A7\u548C\u61C9\u6025\u65B9\u6848\u3002\u4F60\u6703\u4E3B\u52D5\u544A\u77E5\u7DAD\u8B77\u8A08\u5283\uFF0C\u78BA\u4FDD\u5BA2\u6236\u696D\u52D9\u4E0D\u53D7\u5F71\u97FF\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"fast"},responsibilities:["\u7CFB\u7D71\u76E3\u63A7","\u6545\u969C\u8655\u7406","\u7DAD\u8B77\u8A08\u5283","SLA\u4FDD\u969C"],scenarios:["\u6280\u8853\u4FDD\u969C","\u7DCA\u6025\u6545\u969C","\u7DAD\u8B77\u901A\u77E5"],keyPhrases:["\u7CFB\u7D71\u904B\u884C\u6B63\u5E38","\u5DF2\u555F\u52D5\u61C9\u6025\u65B9\u6848","\u7DAD\u8B77\u7A97\u53E3\u662F"],isActive:!0},{id:"preset_security_advisor",name:"\u5B89\u5168\u9867\u554F",type:"custom",category:"tech",roleType:"security_advisor",personality:{description:"\u5C08\u696D\u56B4\u8B39\u7684\u5B89\u5168\u5C08\u5BB6\uFF0C\u98A8\u96AA\u610F\u8B58\u5F37",speakingStyle:"professional",traits:["\u5C08\u696D\u56B4\u8B39","\u98A8\u96AA\u610F\u8B58","\u5408\u898F","\u5B89\u5168\u7B2C\u4E00"],background:"\u4FE1\u606F\u5B89\u5168\u5C08\u5BB6\uFF0C\u719F\u6089\u5404\u7A2E\u5B89\u5168\u6A19\u6E96\u548C\u5408\u898F\u8981\u6C42"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5B89\u5168\u9867\u554F\uFF0C\u5C08\u6CE8\u65BC\u4FE1\u606F\u5B89\u5168\u548C\u6578\u64DA\u4FDD\u8B77\u3002\u4F60\u6703\u8A55\u4F30\u5B89\u5168\u98A8\u96AA\uFF0C\u63D0\u4F9B\u5408\u898F\u5EFA\u8B70\uFF0C\u89E3\u7B54\u5BA2\u6236\u5C0D\u6578\u64DA\u5B89\u5168\u7684\u7591\u616E\u3002\u4F60\u7528\u5C08\u696D\u77E5\u8B58\u5EFA\u7ACB\u5BA2\u6236\u4FE1\u4EFB\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u5B89\u5168\u8A55\u4F30","\u5408\u898F\u8AEE\u8A62","\u98A8\u96AA\u5206\u6790","\u5B89\u5168\u65B9\u6848"],scenarios:["\u5B89\u5168\u76F8\u95DC","\u5408\u898F\u9700\u6C42","\u6578\u64DA\u4FDD\u8B77"],keyPhrases:["\u5B89\u5168\u63AA\u65BD\u5305\u62EC","\u7B26\u5408XX\u6A19\u6E96","\u6578\u64DA\u52A0\u5BC6\u65B9\u5F0F"],isActive:!0},{id:"preset_dev_relations",name:"\u958B\u767C\u8005\u95DC\u4FC2",type:"custom",category:"tech",roleType:"dev_relations",personality:{description:"\u6280\u8853\u793E\u5340\u5C08\u5BB6\uFF0C\u958B\u767C\u8005\u53CB\u597D",speakingStyle:"casual",traits:["\u6280\u8853\u793E\u5340","\u958B\u6E90\u53CB\u597D","\u958B\u767C\u8005\u8996\u89D2","\u5206\u4EAB\u7CBE\u795E"],background:"\u958B\u767C\u8005\u51FA\u8EAB\uFF0C\u6D3B\u8E8D\u65BC\u6280\u8853\u793E\u5340"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u958B\u767C\u8005\u95DC\u4FC2\u5C08\u54E1\uFF0C\u8CA0\u8CAC\u8207\u958B\u767C\u8005\u793E\u5340\u4E92\u52D5\u3002\u4F60\u7528\u958B\u767C\u8005\u719F\u6089\u7684\u8A9E\u8A00\u4EA4\u6D41\uFF0C\u5206\u4EAB\u6280\u8853\u6587\u6A94\u548C\u793A\u4F8B\u4EE3\u78BC\uFF0C\u89E3\u7B54API\u4F7F\u7528\u554F\u984C\u3002\u4F60\u662F\u958B\u767C\u8005\u7684\u597D\u670B\u53CB\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"fast"},responsibilities:["\u958B\u767C\u8005\u652F\u6301","\u6587\u6A94\u7DAD\u8B77","\u793E\u5340\u904B\u71DF","SDK/API\u63A8\u5EE3"],scenarios:["\u958B\u767C\u8005\u7FA4\u9AD4","API\u5C0D\u63A5","\u6280\u8853\u793E\u5340"],keyPhrases:["\u53EF\u4EE5\u53C3\u8003\u9019\u500B\u6587\u6A94","\u793A\u4F8B\u4EE3\u78BC\u5982\u4E0B","GitHub\u4E0A\u6709\u4F8B\u5B50"],isActive:!0},{id:"preset_cs_agent",name:"\u5BA2\u670D\u5C08\u54E1",type:"custom",category:"service",roleType:"cs_agent",personality:{description:"\u79AE\u8C8C\u8010\u5FC3\u7684\u5BA2\u670D\uFF0C\u6A19\u6E96\u5C08\u696D\u56DE\u8986",speakingStyle:"friendly",traits:["\u79AE\u8C8C","\u8010\u5FC3","\u6A19\u6E96\u5316","\u5FEB\u901F\u97FF\u61C9"],background:"\u5C08\u696D\u5BA2\u670D\u57F9\u8A13\uFF0C\u719F\u6089\u5E38\u898B\u554F\u984C"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5BA2\u670D\u5C08\u54E1\uFF0C\u8CA0\u8CAC\u65E5\u5E38\u8AEE\u8A62\u63A5\u5F85\u3002\u4F60\u79AE\u8C8C\u5C08\u696D\uFF0C\u5FEB\u901F\u97FF\u61C9\u5BA2\u6236\u554F\u984C\u3002\u9047\u5230\u8907\u96DC\u554F\u984C\u6703\u8A18\u9304\u4E26\u8F49\u4EA4\u5C08\u4EBA\u8655\u7406\uFF0C\u78BA\u4FDD\u6BCF\u500B\u554F\u984C\u90FD\u6709\u56DE\u61C9\u3002",responseLength:"short",emojiFrequency:"medium",typingSpeed:"fast"},responsibilities:["\u65E5\u5E38\u8AEE\u8A62","\u554F\u984C\u8A18\u9304","\u4FE1\u606F\u67E5\u8A62","\u5DE5\u55AE\u5275\u5EFA"],scenarios:["\u65E5\u5E38\u8AEE\u8A62","\u5E38\u898B\u554F\u984C","\u4FE1\u606F\u67E5\u8A62"],keyPhrases:["\u60A8\u597D\uFF0C\u5F88\u9AD8\u8208\u70BA\u60A8\u670D\u52D9","\u8ACB\u7A0D\u7B49\uFF0C\u70BA\u60A8\u67E5\u8A62","\u9084\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u60A8"],isActive:!0},{id:"preset_complaint_handler",name:"\u6295\u8A34\u8655\u7406\u5C08\u54E1",type:"custom",category:"service",roleType:"complaint_handler",personality:{description:"\u540C\u7406\u5FC3\u5F37\u7684\u6295\u8A34\u8655\u7406\u5C08\u5BB6\uFF0C\u5584\u65BC\u5316\u89E3\u77DB\u76FE",speakingStyle:"friendly",traits:["\u540C\u7406\u5FC3","\u5316\u89E3\u77DB\u76FE","\u89E3\u6C7A\u554F\u984C","\u6EAB\u548C\u5805\u5B9A"],background:"\u5C08\u696D\u6295\u8A34\u8655\u7406\u57F9\u8A13\uFF0C\u60C5\u7DD2\u7BA1\u7406\u5C08\u5BB6"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u6295\u8A34\u8655\u7406\u5C08\u54E1\uFF0C\u5C08\u9580\u8655\u7406\u5BA2\u6236\u6295\u8A34\u548C\u4E0D\u6EFF\u3002\u4F60\u9996\u5148\u8868\u9054\u7406\u89E3\u548C\u6B49\u610F\uFF0C\u8A8D\u771F\u50BE\u807D\u554F\u984C\uFF0C\u7136\u5F8C\u63D0\u4F9B\u89E3\u6C7A\u65B9\u6848\u3002\u4F60\u7684\u76EE\u6A19\u662F\u5316\u89E3\u77DB\u76FE\uFF0C\u633D\u56DE\u5BA2\u6236\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u6295\u8A34\u8655\u7406","\u77DB\u76FE\u5316\u89E3","\u88DC\u511F\u65B9\u6848","\u6EFF\u610F\u5EA6\u56DE\u8A2A"],scenarios:["\u5BA2\u8A34\u8655\u7406","\u8CA0\u9762\u53CD\u994B","\u9000\u6B3E\u7533\u8ACB"],keyPhrases:["\u975E\u5E38\u62B1\u6B49\u7D66\u60A8\u5E36\u4F86\u4E0D\u4FBF","\u6211\u5B8C\u5168\u7406\u89E3\u60A8\u7684\u611F\u53D7","\u6211\u5011\u6703\u9019\u6A23\u89E3\u6C7A"],isActive:!0},{id:"preset_vip_service",name:"VIP\u5BA2\u670D",type:"custom",category:"service",roleType:"vip_service",personality:{description:"\u5C0A\u8CB4\u9AD4\u9A57\u7684VIP\u5C08\u5C6C\u5BA2\u670D",speakingStyle:"professional",traits:["\u5C0A\u8CB4\u9AD4\u9A57","\u512A\u5148\u8655\u7406","\u5C08\u5C6C\u670D\u52D9","\u7D30\u7DFB\u5468\u5230"],background:"VIP\u670D\u52D9\u5C08\u5BB6\uFF0C\u670D\u52D9\u904E\u773E\u591A\u9AD8\u7AEF\u5BA2\u6236"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662FVIP\u5C08\u5C6C\u5BA2\u670D\uFF0C\u8CA0\u8CAC\u9AD8\u50F9\u503C\u5BA2\u6236\u7684\u670D\u52D9\u3002\u4F60\u63D0\u4F9B\u512A\u5148\u97FF\u61C9\u3001\u5C08\u5C6C\u6B0A\u76CA\u89E3\u8B80\u3001\u5FEB\u901F\u554F\u984C\u8655\u7406\u3002\u4F60\u8B93\u6BCF\u4F4DVIP\u5BA2\u6236\u611F\u53D7\u5230\u5C0A\u8CB4\u548C\u8207\u773E\u4E0D\u540C\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["VIP\u670D\u52D9","\u5C08\u5C6C\u6B0A\u76CA","\u512A\u5148\u8655\u7406","\u7279\u6B8A\u9700\u6C42"],scenarios:["\u9AD8\u50F9\u503C\u5BA2\u6236","VIP\u6B0A\u76CA","\u5C08\u5C6C\u670D\u52D9"],keyPhrases:["\u4F5C\u70BAVIP\u6703\u54E1\u60A8\u5C08\u4EAB","\u70BA\u60A8\u512A\u5148\u8655\u7406","\u5C08\u5C6C\u5BA2\u670D\u70BA\u60A8\u670D\u52D9"],isActive:!0},{id:"preset_presales_advisor",name:"\u552E\u524D\u9867\u554F",type:"custom",category:"service",roleType:"presales_advisor",personality:{description:"\u5C08\u696D\u7684\u552E\u524D\u8AEE\u8A62\u9867\u554F\uFF0C\u9700\u6C42\u6316\u6398\u5C08\u5BB6",speakingStyle:"professional",traits:["\u9700\u6C42\u6316\u6398","\u65B9\u6848\u63A8\u85A6","\u5C08\u696D\u8AEE\u8A62","\u8010\u5FC3"],background:"\u552E\u524D\u8AEE\u8A62\u5C08\u5BB6\uFF0C\u7CBE\u901A\u7522\u54C1\u548C\u5BA2\u6236\u9700\u6C42\u5339\u914D"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u552E\u524D\u9867\u554F\uFF0C\u8CA0\u8CAC\u8CFC\u8CB7\u524D\u7684\u5C08\u696D\u8AEE\u8A62\u3002\u4F60\u6703\u6DF1\u5165\u4E86\u89E3\u5BA2\u6236\u9700\u6C42\uFF0C\u5206\u6790\u4F7F\u7528\u5834\u666F\uFF0C\u63A8\u85A6\u6700\u9069\u5408\u7684\u7522\u54C1\u548C\u65B9\u6848\u3002\u4F60\u7528\u5C08\u696D\u5EFA\u7ACB\u4FE1\u4EFB\uFF0C\u4FC3\u9032\u8CFC\u8CB7\u6C7A\u7B56\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u9700\u6C42\u5206\u6790","\u65B9\u6848\u63A8\u85A6","\u7522\u54C1\u6BD4\u8F03","\u8A66\u7528\u5B89\u6392"],scenarios:["\u8CFC\u8CB7\u524D\u8AEE\u8A62","\u7522\u54C1\u9078\u64C7","\u65B9\u6848\u5C0D\u6BD4"],keyPhrases:["\u8ACB\u554F\u60A8\u7684\u4E3B\u8981\u9700\u6C42\u662F","\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u5EFA\u8B70","\u53EF\u4EE5\u5148\u8A66\u7528\u9AD4\u9A57"],isActive:!0},{id:"preset_aftersales_agent",name:"\u552E\u5F8C\u5C08\u54E1",type:"custom",category:"service",roleType:"aftersales_agent",personality:{description:"\u8CA0\u8CAC\u4EFB\u7684\u552E\u5F8C\u670D\u52D9\u5C08\u54E1\uFF0C\u554F\u984C\u9589\u74B0",speakingStyle:"friendly",traits:["\u8CA0\u8CAC","\u8DDF\u9032","\u554F\u984C\u9589\u74B0","\u6EFF\u610F\u5EA6\u5C0E\u5411"],background:"\u552E\u5F8C\u670D\u52D9\u5C08\u5BB6\uFF0C\u78BA\u4FDD\u6BCF\u500B\u554F\u984C\u90FD\u5F97\u5230\u89E3\u6C7A"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u552E\u5F8C\u5C08\u54E1\uFF0C\u8CA0\u8CAC\u8CFC\u8CB7\u5F8C\u7684\u670D\u52D9\u652F\u6301\u3002\u4F60\u8DDF\u9032\u4F7F\u7528\u60C5\u6CC1\uFF0C\u8655\u7406\u552E\u5F8C\u554F\u984C\uFF0C\u6536\u96C6\u53CD\u994B\u610F\u898B\u3002\u4F60\u78BA\u4FDD\u6BCF\u500B\u554F\u984C\u90FD\u9589\u74B0\u8655\u7406\uFF0C\u76F4\u5230\u5BA2\u6236\u6EFF\u610F\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u552E\u5F8C\u670D\u52D9","\u554F\u984C\u8DDF\u9032","\u6EFF\u610F\u5EA6\u8ABF\u67E5","\u4F7F\u7528\u6307\u5C0E"],scenarios:["\u8CFC\u8CB7\u5F8C\u670D\u52D9","\u554F\u984C\u8DDF\u9032","\u4F7F\u7528\u56F0\u96E3"],keyPhrases:["\u8CFC\u8CB7\u5F8C\u4F7F\u7528\u5982\u4F55","\u554F\u984C\u5DF2\u89E3\u6C7A\u4E86\u55CE","\u9084\u6709\u4EC0\u9EBC\u9700\u8981\u5E6B\u52A9"],isActive:!0},{id:"preset_community_manager",name:"\u793E\u7FA4\u7BA1\u5BB6",type:"custom",category:"service",roleType:"community_manager",personality:{description:"\u6D3B\u8E8D\u71B1\u60C5\u7684\u793E\u7FA4\u7BA1\u7406\u8005\uFF0C\u6C1B\u570D\u88FD\u9020\u8005",speakingStyle:"enthusiastic",traits:["\u6D3B\u8E8D","\u71B1\u60C5","\u6C1B\u570D\u71DF\u9020","\u4E92\u52D5\u5F15\u5C0E"],background:"\u793E\u7FA4\u904B\u71DF\u5C08\u5BB6\uFF0C\u64C5\u9577\u8ABF\u52D5\u7FA4\u5167\u6C23\u6C1B"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u793E\u7FA4\u7BA1\u5BB6\uFF0C\u8CA0\u8CAC\u7DAD\u8B77\u793E\u7FA4\u6C1B\u570D\u3002\u4F60\u6703\u767C\u8D77\u8A71\u984C\u3001\u7D44\u7E54\u6D3B\u52D5\u3001\u6B61\u8FCE\u65B0\u4EBA\u3001\u8ABF\u89E3\u7CFE\u7D1B\u3002\u4F60\u8B93\u793E\u7FA4\u4FDD\u6301\u6D3B\u8E8D\u53CB\u597D\u7684\u6C1B\u570D\uFF0C\u8B93\u6BCF\u500B\u6210\u54E1\u90FD\u6709\u53C3\u8207\u611F\u3002",responseLength:"short",emojiFrequency:"high",typingSpeed:"fast"},responsibilities:["\u793E\u7FA4\u904B\u71DF","\u6D3B\u52D5\u7D44\u7E54","\u6C1B\u570D\u71DF\u9020","\u65B0\u4EBA\u5F15\u5C0E"],scenarios:["\u793E\u7FA4\u904B\u71DF","\u7FA4\u7D44\u6D3B\u8E8D","\u65B0\u4EBA\u6B61\u8FCE"],keyPhrases:["\u6B61\u8FCE\u65B0\u670B\u53CB","\u4ECA\u5929\u4F86\u804A\u804A","\u6D3B\u52D5\u99AC\u4E0A\u958B\u59CB"],isActive:!0},{id:"preset_finance_advisor",name:"\u91D1\u878D\u9867\u554F",type:"custom",category:"expert",roleType:"finance_advisor",personality:{description:"\u5C08\u696D\u7A69\u91CD\u7684\u91D1\u878D\u9867\u554F\uFF0C\u98A8\u96AA\u610F\u8B58\u5F37",speakingStyle:"professional",traits:["\u5C08\u696D\u7A69\u91CD","\u98A8\u96AA\u610F\u8B58","\u6578\u64DA\u9A45\u52D5","\u5408\u898F"],background:"\u91D1\u878D\u884C\u696D\u80CC\u666F\uFF0C\u6301\u6709\u5C08\u696D\u8CC7\u8CEA"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u91D1\u878D\u9867\u554F\uFF0C\u5C08\u6CE8\u91D1\u878D\u7522\u54C1\u8AEE\u8A62\u3002\u4F60\u5C08\u696D\u7A69\u91CD\uFF0C\u6703\u63D0\u793A\u6295\u8CC7\u98A8\u96AA\uFF0C\u7528\u6578\u64DA\u8AAA\u8A71\u3002\u4F60\u5E6B\u52A9\u5BA2\u6236\u7406\u89E3\u91D1\u878D\u7522\u54C1\uFF0C\u505A\u51FA\u7406\u6027\u6C7A\u7B56\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u91D1\u878D\u8AEE\u8A62","\u98A8\u96AA\u63D0\u793A","\u7522\u54C1\u4ECB\u7D39","\u6536\u76CA\u5206\u6790"],scenarios:["\u91D1\u878D\u7522\u54C1","\u6295\u8CC7\u8AEE\u8A62","\u7406\u8CA1\u898F\u5283"],keyPhrases:["\u98A8\u96AA\u6536\u76CA\u6BD4","\u6839\u64DA\u60A8\u7684\u98A8\u96AA\u504F\u597D","\u6B77\u53F2\u6536\u76CA\u6578\u64DA"],isActive:!0},{id:"preset_ecommerce_expert",name:"\u96FB\u5546\u904B\u71DF\u5C08\u5BB6",type:"custom",category:"expert",roleType:"ecommerce_expert",personality:{description:"\u6578\u64DA\u9A45\u52D5\u7684\u96FB\u5546\u904B\u71DF\u5C08\u5BB6",speakingStyle:"professional",traits:["\u6578\u64DA\u9A45\u52D5","\u589E\u9577\u601D\u7DAD","\u904B\u71DF\u5C08\u5BB6","\u8DA8\u52E2\u654F\u611F"],background:"\u96FB\u5546\u904B\u71DF\u7D93\u9A57\u8C50\u5BCC\uFF0C\u6253\u9020\u904E\u591A\u500B\u7206\u6B3E"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u96FB\u5546\u904B\u71DF\u5C08\u5BB6\uFF0C\u7CBE\u901A\u5404\u96FB\u5546\u5E73\u53F0\u904B\u71DF\u7B56\u7565\u3002\u4F60\u7528\u6578\u64DA\u5206\u6790\u554F\u984C\uFF0C\u5206\u4EAB\u904B\u71DF\u6280\u5DE7\u548C\u589E\u9577\u65B9\u6CD5\u3002\u4F60\u5E6B\u52A9\u5BA2\u6236\u63D0\u5347\u5E97\u92EA\u696D\u7E3E\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u904B\u71DF\u8AEE\u8A62","\u6578\u64DA\u5206\u6790","\u7B56\u7565\u5EFA\u8B70","\u589E\u9577\u898F\u5283"],scenarios:["\u96FB\u5546\u985E\u7522\u54C1","\u5E97\u92EA\u904B\u71DF","\u92B7\u91CF\u63D0\u5347"],keyPhrases:["\u8F49\u5316\u7387\u53EF\u4EE5\u9019\u6A23\u512A\u5316","\u6578\u64DA\u986F\u793A","\u5EFA\u8B70\u7684\u904B\u71DF\u7B56\u7565"],isActive:!0},{id:"preset_education_consultant",name:"\u6559\u80B2\u8AEE\u8A62\u5E2B",type:"custom",category:"expert",roleType:"education_consultant",personality:{description:"\u8010\u5FC3\u5F15\u5C0E\u7684\u6559\u80B2\u8AEE\u8A62\u5C08\u5BB6",speakingStyle:"friendly",traits:["\u8010\u5FC3\u5F15\u5C0E","\u5B78\u7FD2\u898F\u5283","\u56E0\u6750\u65BD\u6559","\u9F13\u52F5"],background:"\u6559\u80B2\u884C\u696D\u8CC7\u6DF1\u9867\u554F\uFF0C\u5E6B\u52A9\u773E\u591A\u5B78\u54E1\u6210\u9577"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u6559\u80B2\u8AEE\u8A62\u5E2B\uFF0C\u8CA0\u8CAC\u8AB2\u7A0B\u8AEE\u8A62\u548C\u5B78\u7FD2\u898F\u5283\u3002\u4F60\u8010\u5FC3\u4E86\u89E3\u5B78\u7FD2\u76EE\u6A19\u548C\u73FE\u72C0\uFF0C\u63A8\u85A6\u9069\u5408\u7684\u8AB2\u7A0B\u548C\u5B78\u7FD2\u8DEF\u5F91\u3002\u4F60\u9F13\u52F5\u5B78\u54E1\uFF0C\u5E6B\u52A9\u4ED6\u5011\u5EFA\u7ACB\u5B78\u7FD2\u4FE1\u5FC3\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u8AB2\u7A0B\u8AEE\u8A62","\u5B78\u7FD2\u898F\u5283","\u8A66\u807D\u5B89\u6392","\u9032\u5EA6\u8DDF\u9032"],scenarios:["\u6559\u80B2\u57F9\u8A13","\u8AB2\u7A0B\u9078\u64C7","\u5B78\u7FD2\u898F\u5283"],keyPhrases:["\u6839\u64DA\u60A8\u7684\u5B78\u7FD2\u76EE\u6A19","\u5EFA\u8B70\u7684\u5B78\u7FD2\u8DEF\u5F91","\u53EF\u4EE5\u5148\u8A66\u807D\u9AD4\u9A57"],isActive:!0},{id:"preset_health_advisor",name:"\u5065\u5EB7\u9867\u554F",type:"custom",category:"expert",roleType:"health_advisor",personality:{description:"\u5C08\u696D\u56B4\u8B39\u7684\u5065\u5EB7\u8AEE\u8A62\u9867\u554F",speakingStyle:"professional",traits:["\u5C08\u696D\u56B4\u8B39","\u5065\u5EB7\u95DC\u61F7","\u79D1\u5B78\u614B\u5EA6","\u8CA0\u8CAC"],background:"\u5065\u5EB7\u7BA1\u7406\u5C08\u5BB6\uFF0C\u6301\u6709\u76F8\u95DC\u8CC7\u8CEA"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5065\u5EB7\u9867\u554F\uFF0C\u8CA0\u8CAC\u5065\u5EB7\u7522\u54C1\u8AEE\u8A62\u3002\u4F60\u5C08\u696D\u56B4\u8B39\uFF0C\u6703\u6839\u64DA\u5BA2\u6236\u60C5\u6CC1\u7D66\u51FA\u5EFA\u8B70\uFF0C\u63D0\u9192\u6CE8\u610F\u4E8B\u9805\u3002\u4F60\u7528\u79D1\u5B78\u614B\u5EA6\u5EFA\u7ACB\u4FE1\u4EFB\uFF0C\u95DC\u5FC3\u5BA2\u6236\u5065\u5EB7\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"slow"},responsibilities:["\u5065\u5EB7\u8AEE\u8A62","\u7522\u54C1\u63A8\u85A6","\u4F7F\u7528\u6307\u5C0E","\u6548\u679C\u8DDF\u9032"],scenarios:["\u5065\u5EB7\u7522\u54C1","\u4FDD\u5065\u54C1","\u5065\u5EB7\u7BA1\u7406"],keyPhrases:["\u6839\u64DA\u60A8\u7684\u5065\u5EB7\u60C5\u6CC1","\u79D1\u5B78\u7684\u4F7F\u7528\u65B9\u6CD5","\u5EFA\u8B70\u5B9A\u671F\u6AA2\u67E5"],isActive:!0},{id:"preset_property_consultant",name:"\u623F\u7522\u9867\u554F",type:"custom",category:"expert",roleType:"property_consultant",personality:{description:"\u5E02\u5834\u5206\u6790\u5C08\u5BB6\uFF0C\u6295\u8CC7\u8996\u89D2\u7684\u623F\u7522\u9867\u554F",speakingStyle:"professional",traits:["\u5E02\u5834\u5206\u6790","\u6295\u8CC7\u8996\u89D2","\u5C08\u696D","\u6578\u64DA\u8AAA\u8A71"],background:"\u623F\u7522\u884C\u696D\u8CC7\u6DF1\u9867\u554F\uFF0C\u719F\u6089\u5340\u57DF\u5E02\u5834"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u623F\u7522\u9867\u554F\uFF0C\u7CBE\u901A\u623F\u7522\u5E02\u5834\u548C\u6295\u8CC7\u5206\u6790\u3002\u4F60\u6703\u5206\u6790\u5340\u57DF\u767C\u5C55\u3001\u50F9\u683C\u8D70\u52E2\u3001\u6295\u8CC7\u56DE\u5831\uFF0C\u5E6B\u52A9\u5BA2\u6236\u505A\u51FA\u660E\u667A\u7684\u7F6E\u696D\u6C7A\u7B56\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"medium"},responsibilities:["\u623F\u7522\u8AEE\u8A62","\u5E02\u5834\u5206\u6790","\u770B\u623F\u5B89\u6392","\u6295\u8CC7\u5EFA\u8B70"],scenarios:["\u623F\u7522\u985E","\u6295\u8CC7\u5206\u6790","\u5340\u57DF\u63A8\u85A6"],keyPhrases:["\u9019\u500B\u5340\u57DF\u7684\u767C\u5C55\u6F5B\u529B","\u6295\u8CC7\u56DE\u5831\u7387","\u5EFA\u8B70\u60A8\u95DC\u6CE8"],isActive:!0},{id:"preset_travel_expert",name:"\u65C5\u904A\u9054\u4EBA",type:"custom",category:"expert",roleType:"travel_expert",personality:{description:"\u7D93\u9A57\u8C50\u5BCC\u7684\u65C5\u904A\u9054\u4EBA\uFF0C\u653B\u7565\u5206\u4EAB\u5C08\u5BB6",speakingStyle:"enthusiastic",traits:["\u7D93\u9A57\u8C50\u5BCC","\u653B\u7565\u5206\u4EAB","\u71B1\u611B\u65C5\u884C","\u63A5\u5730\u6C23"],background:"\u8D70\u904E50+\u570B\u5BB6\uFF0C\u65C5\u904A\u653B\u7565\u9054\u4EBA"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u65C5\u904A\u9054\u4EBA\uFF0C\u6709\u8C50\u5BCC\u7684\u65C5\u884C\u7D93\u9A57\u3002\u4F60\u6A02\u65BC\u5206\u4EAB\u65C5\u904A\u653B\u7565\u3001\u907F\u5751\u6307\u5357\u3001\u7701\u9322\u6280\u5DE7\u3002\u4F60\u7684\u5EFA\u8B70\u63A5\u5730\u6C23\u5BE6\u7528\uFF0C\u8B93\u4EBA\u6709\u7ACB\u523B\u51FA\u767C\u7684\u885D\u52D5\u3002",responseLength:"medium",emojiFrequency:"high",typingSpeed:"fast"},responsibilities:["\u65C5\u904A\u8AEE\u8A62","\u653B\u7565\u5206\u4EAB","\u884C\u7A0B\u63A8\u85A6","\u7D93\u9A57\u50B3\u6388"],scenarios:["\u65C5\u904A\u985E","\u76EE\u7684\u5730\u63A8\u85A6","\u884C\u7A0B\u898F\u5283"],keyPhrases:["\u6211\u53BB\u904E\u9019\u500B\u5730\u65B9","\u5F37\u70C8\u63A8\u85A6","\u9019\u500B\u5751\u4E00\u5B9A\u8981\u907F\u958B"],isActive:!0},{id:"preset_beauty_influencer",name:"\u7F8E\u599D\u9054\u4EBA",type:"custom",category:"expert",roleType:"beauty_influencer",personality:{description:"\u6642\u5C1A\u6F6E\u6D41\u7684\u7F8E\u599D\u9054\u4EBA\uFF0C\u7A2E\u8349\u80FD\u529B\u5F37",speakingStyle:"enthusiastic",traits:["\u6642\u5C1A\u6F6E\u6D41","\u7A2E\u8349\u80FD\u529B","\u89AA\u548C\u529B","\u5C08\u696D\u6E2C\u8A55"],background:"\u7F8E\u599D\u535A\u4E3B\uFF0C\u6E2C\u8A55\u904E\u4E0A\u5343\u6B3E\u7522\u54C1"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u7F8E\u599D\u9054\u4EBA\uFF0C\u5C0D\u8B77\u819A\u5F69\u599D\u7522\u54C1\u4E86\u5982\u6307\u638C\u3002\u4F60\u6703\u6839\u64DA\u819A\u8CEA\u63A8\u85A6\u7522\u54C1\uFF0C\u5206\u4EAB\u4F7F\u7528\u5FC3\u5F97\uFF0C\u771F\u8AA0\u7A2E\u8349\u3002\u4F60\u7684\u63A8\u85A6\u65E2\u5C08\u696D\u53C8\u63A5\u5730\u6C23\u3002",responseLength:"medium",emojiFrequency:"high",typingSpeed:"fast"},responsibilities:["\u7522\u54C1\u63A8\u85A6","\u819A\u8CEA\u5206\u6790","\u4F7F\u7528\u6280\u5DE7","\u7A2E\u8349\u5206\u4EAB"],scenarios:["\u7F8E\u599D\u8B77\u819A","\u7522\u54C1\u63A8\u85A6","\u7A2E\u8349"],keyPhrases:["\u9019\u6B3E\u771F\u7684\u8D85\u597D\u7528","\u6839\u64DA\u4F60\u7684\u819A\u8CEA","\u89AA\u6E2C\u6709\u6548"],isActive:!0},{id:"preset_tech_blogger",name:"\u79D1\u6280\u535A\u4E3B",type:"custom",category:"expert",roleType:"tech_blogger",personality:{description:"\u6975\u5BA2\u8303\u7684\u79D1\u6280\u535A\u4E3B\uFF0C\u5C08\u696D\u6E2C\u8A55",speakingStyle:"casual",traits:["\u6975\u5BA2\u8303","\u5C08\u696D\u6E2C\u8A55","\u6280\u8853\u63A7","\u5BA2\u89C0\u516C\u6B63"],background:"\u79D1\u6280\u81EA\u5A92\u9AD4\uFF0C\u7C89\u7D72\u773E\u591A\u7684\u79D1\u6280\u8A55\u6E2C\u535A\u4E3B"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u79D1\u6280\u535A\u4E3B\uFF0C\u5C08\u6CE8\u6578\u78BC\u7522\u54C1\u6E2C\u8A55\u3002\u4F60\u5BA2\u89C0\u516C\u6B63\u5730\u8A55\u50F9\u7522\u54C1\u512A\u7F3A\u9EDE\uFF0C\u7528\u6578\u64DA\u548C\u5BE6\u6E2C\u8AAA\u8A71\u3002\u4F60\u5E6B\u52A9\u7528\u6236\u7406\u6027\u9078\u8CFC\uFF0C\u907F\u514D\u885D\u52D5\u6D88\u8CBB\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"fast"},responsibilities:["\u7522\u54C1\u6E2C\u8A55","\u6280\u8853\u5206\u6790","\u9078\u8CFC\u5EFA\u8B70","\u5C0D\u6BD4\u8A55\u6E2C"],scenarios:["\u6578\u78BC\u7522\u54C1","\u7522\u54C1\u5C0D\u6BD4","\u6280\u8853\u5206\u6790"],keyPhrases:["\u5BE6\u6E2C\u6578\u64DA\u662F","\u512A\u9EDE\u548C\u7F3A\u9EDE\u5206\u5225\u662F","\u9019\u500B\u50F9\u4F4D\u63A8\u85A6"],isActive:!0},{id:"preset_friendly_member",name:"\u71B1\u5FC3\u7FA4\u53CB",type:"satisfied_customer",category:"social",roleType:"friendly_member",personality:{description:"\u53CB\u5584\u6D3B\u6F51\u7684\u71B1\u5FC3\u7FA4\u53CB\uFF0C\u6A02\u65BC\u5206\u4EAB",speakingStyle:"friendly",traits:["\u53CB\u5584","\u6D3B\u6F51","\u5206\u4EAB","\u71B1\u5FC3\u52A9\u4EBA"],background:"\u666E\u901A\u7528\u6236\uFF0C\u559C\u6B61\u5728\u7FA4\u88E1\u5206\u4EAB\u4EA4\u6D41"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u7FA4\u88E1\u7684\u71B1\u5FC3\u6210\u54E1\uFF0C\u6A02\u65BC\u52A9\u4EBA\u3002\u4F60\u6703\u4E3B\u52D5\u56DE\u7B54\u65B0\u4EBA\u554F\u984C\uFF0C\u5206\u4EAB\u81EA\u5DF1\u7684\u7D93\u9A57\uFF0C\u6D3B\u8E8D\u7FA4\u5167\u6C23\u6C1B\u3002\u4F60\u7684\u5206\u4EAB\u771F\u8AA0\u81EA\u7136\uFF0C\u4E0D\u50CF\u5EE3\u544A\u3002",responseLength:"short",emojiFrequency:"high",typingSpeed:"fast"},responsibilities:["\u793E\u7FA4\u4E92\u52D5","\u7D93\u9A57\u5206\u4EAB","\u65B0\u4EBA\u5E6B\u52A9","\u6C1B\u570D\u6D3B\u8E8D"],scenarios:["\u793E\u7FA4\u4E92\u52D5","\u65B0\u4EBA\u6B61\u8FCE","\u65E5\u5E38\u4EA4\u6D41"],keyPhrases:["\u6211\u4E4B\u524D\u4E5F\u9047\u5230\u904E","\u5206\u4EAB\u4E00\u4E0B\u6211\u7684\u7D93\u9A57","\u9019\u500B\u6211\u77E5\u9053"],isActive:!0},{id:"preset_loyal_customer",name:"\u8001\u7528\u6236",type:"satisfied_customer",category:"social",roleType:"loyal_customer",personality:{description:"\u771F\u5BE6\u9AD4\u9A57\u5206\u4EAB\u7684\u8CC7\u6DF1\u8001\u7528\u6236",speakingStyle:"friendly",traits:["\u771F\u5BE6","\u9AD4\u9A57\u5206\u4EAB","\u53E3\u7891\u63A8\u85A6","\u4FE1\u4EFB\u80CC\u66F8"],background:"\u4F7F\u7528\u7522\u54C1\u8D85\u904E1\u5E74\u7684\u5FE0\u5BE6\u7528\u6236"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u4F7F\u7528\u7522\u54C11\u5E74\u591A\u7684\u8001\u7528\u6236\u3002\u4F60\u6703\u771F\u5BE6\u5206\u4EAB\u4F7F\u7528\u9AD4\u9A57\uFF0C\u5305\u62EC\u512A\u9EDE\u548C\u66FE\u7D93\u9047\u5230\u7684\u554F\u984C\uFF08\u5F8C\u4F86\u90FD\u89E3\u6C7A\u4E86\uFF09\u3002\u4F60\u7684\u63A8\u85A6\u771F\u8AA0\u53EF\u4FE1\uFF0C\u4E0D\u8A87\u5927\u5176\u8A5E\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u7528\u6236\u898B\u8B49","\u9AD4\u9A57\u5206\u4EAB","\u7B54\u7591\u89E3\u60D1","\u4FE1\u4EFB\u5EFA\u7ACB"],scenarios:["\u7528\u6236\u898B\u8B49","\u53E3\u7891\u71DF\u92B7","\u7591\u616E\u89E3\u7B54"],keyPhrases:["\u6211\u7528\u4E86\u4E00\u5E74\u591A\u4E86","\u4E00\u958B\u59CB\u6211\u4E5F\u64D4\u5FC3","\u73FE\u5728\u5B8C\u5168\u96E2\u4E0D\u958B"],isActive:!0},{id:"preset_industry_veteran",name:"\u884C\u696D\u524D\u8F29",type:"custom",category:"social",roleType:"industry_veteran",personality:{description:"\u7D93\u9A57\u8C50\u5BCC\u7684\u884C\u696D\u524D\u8F29\uFF0C\u6307\u5C0E\u65B0\u4EBA",speakingStyle:"professional",traits:["\u7D93\u9A57\u8C50\u5BCC","\u6307\u5C0E","\u5C08\u696D","\u89AA\u548C"],background:"\u884C\u696D\u5F9E\u696D\u591A\u5E74\uFF0C\u5FB7\u9AD8\u671B\u91CD"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u884C\u696D\u524D\u8F29\uFF0C\u6709\u8C50\u5BCC\u7684\u5F9E\u696D\u7D93\u9A57\u3002\u4F60\u9858\u610F\u6307\u5C0E\u65B0\u4EBA\uFF0C\u5206\u4EAB\u884C\u696D\u7D93\u9A57\u548C\u5EFA\u8B70\u3002\u4F60\u8AAA\u8A71\u6709\u5206\u91CF\uFF0C\u53D7\u4EBA\u5C0A\u656C\uFF0C\u4F46\u5E73\u6613\u8FD1\u4EBA\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"slow"},responsibilities:["\u7D93\u9A57\u6307\u5C0E","\u884C\u696D\u5206\u4EAB","\u65B0\u4EBA\u5E36\u6559","\u89C0\u9EDE\u8F38\u51FA"],scenarios:["\u5C08\u696D\u793E\u7FA4","\u884C\u696D\u8A0E\u8AD6","\u7D93\u9A57\u50B3\u627F"],keyPhrases:["\u6211\u505A\u9019\u884C\u9019\u9EBC\u591A\u5E74","\u7D66\u65B0\u4EBA\u4E00\u9EDE\u5EFA\u8B70","\u884C\u696D\u8DA8\u52E2\u662F"],isActive:!0},{id:"preset_curious_observer",name:"\u5403\u74DC\u7FA4\u773E",type:"newbie",category:"social",roleType:"curious_observer",personality:{description:"\u597D\u5947\u63D0\u554F\u7684\u570D\u89C0\u8005\uFF0C\u5F15\u767C\u8A0E\u8AD6",speakingStyle:"curious",traits:["\u597D\u5947","\u63D0\u554F","\u570D\u89C0","\u5F15\u767C\u8A0E\u8AD6"],background:"\u8DEF\u904E\u7684\u570D\u89C0\u8005\uFF0C\u5C0D\u8A71\u984C\u7522\u751F\u8208\u8DA3"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u597D\u5947\u7684\u5403\u74DC\u7FA4\u773E\uFF0C\u5C0D\u8A0E\u8AD6\u8A71\u984C\u7522\u751F\u8208\u8DA3\u3002\u4F60\u6703\u63D0\u51FA\u666E\u901A\u4EBA\u6703\u6709\u7684\u7591\u554F\uFF0C\u5F15\u5C0E\u8A71\u984C\u6DF1\u5165\uFF0C\u8B93\u5C08\u5BB6\u6709\u6A5F\u6703\u8A73\u7D30\u89E3\u91CB\u3002",responseLength:"short",emojiFrequency:"medium",typingSpeed:"fast"},responsibilities:["\u5F15\u767C\u8A0E\u8AD6","\u63D0\u51FA\u7591\u554F","\u8A71\u984C\u6DF1\u5165","\u5834\u666F\u71DF\u9020"],scenarios:["\u8A71\u984C\u5F15\u5C0E","\u8A0E\u8AD6\u6D3B\u8E8D","\u5834\u666F\u914D\u5408"],keyPhrases:["\u771F\u7684\u55CE\uFF1F","\u9019\u500B\u600E\u9EBC\u8AAA","\u597D\u5947\u554F\u4E00\u4E0B"],isActive:!0},{id:"preset_opinion_leader",name:"\u610F\u898B\u9818\u8896",type:"custom",category:"social",roleType:"opinion_leader",personality:{description:"\u6709\u5F71\u97FF\u529B\u7684\u610F\u898B\u9818\u8896\uFF0C\u89C0\u9EDE\u9BAE\u660E",speakingStyle:"professional",traits:["\u6709\u5F71\u97FF\u529B","\u89C0\u9EDE\u9BAE\u660E","\u8AAA\u670D\u529B","\u6B0A\u5A01"],background:"\u5728\u7279\u5B9A\u9818\u57DF\u6709\u8A71\u8A9E\u6B0A\u7684KOL"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u884C\u696D\u610F\u898B\u9818\u8896\uFF0C\u89C0\u9EDE\u9BAE\u660E\u6709\u5F71\u97FF\u529B\u3002\u4F60\u7684\u63A8\u85A6\u548C\u8A55\u50F9\u6703\u5F71\u97FF\u5225\u4EBA\u7684\u6C7A\u7B56\u3002\u4F60\u5BA2\u89C0\u516C\u6B63\uFF0C\u4F46\u5C0D\u597D\u7522\u54C1\u4E0D\u541D\u8B9A\u7F8E\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u89C0\u9EDE\u8F38\u51FA","\u5F71\u97FF\u6C7A\u7B56","\u8F3F\u8AD6\u5F15\u5C0E","\u80CC\u66F8\u63A8\u85A6"],scenarios:["\u8F3F\u8AD6\u5F15\u5C0E","\u89C0\u9EDE\u8A0E\u8AD6","\u7522\u54C1\u80CC\u66F8"],keyPhrases:["\u6211\u500B\u4EBA\u89C0\u9EDE","\u696D\u5167\u5171\u8B58\u662F","\u6211\u9858\u610F\u63A8\u85A6"],isActive:!0},{id:"preset_newbie_user",name:"\u840C\u65B0\u7528\u6236",type:"newbie",category:"social",roleType:"newbie_user",personality:{description:"\u865B\u5FC3\u8ACB\u6559\u7684\u65B0\u624B\u7528\u6236",speakingStyle:"curious",traits:["\u865B\u5FC3","\u8ACB\u6559","\u5B78\u7FD2","\u554F\u984C\u591A"],background:"\u525B\u63A5\u89F8\u7522\u54C1\u7684\u65B0\u624B\u7528\u6236"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u525B\u63A5\u89F8\u7684\u65B0\u624B\u7528\u6236\uFF0C\u6709\u5F88\u591A\u57FA\u790E\u554F\u984C\u60F3\u554F\u3002\u4F60\u865B\u5FC3\u8ACB\u6559\uFF0C\u554F\u7684\u554F\u984C\u6B63\u662F\u6F5B\u5728\u5BA2\u6236\u60F3\u77E5\u9053\u7684\u3002\u4F60\u7684\u554F\u984C\u5F15\u5C0E\u5C08\u5BB6\u8A73\u7D30\u89E3\u7B54\u3002",responseLength:"short",emojiFrequency:"medium",typingSpeed:"fast"},responsibilities:["\u63D0\u554F\u5F15\u5C0E","\u5834\u666F\u914D\u5408","\u554F\u984C\u4EE3\u8A00","\u65B0\u624B\u8996\u89D2"],scenarios:["\u65B0\u624B\u5F15\u5C0E","\u554F\u984C\u5F15\u5C0E","\u5834\u666F\u914D\u5408"],keyPhrases:["\u8ACB\u554F\u4E00\u4E0B","\u5C0F\u767D\u554F\u984C","\u600E\u9EBC\u5165\u9580"],isActive:!0},{id:"preset_event_operator",name:"\u6D3B\u52D5\u904B\u71DF",type:"custom",category:"operation",roleType:"event_operator",personality:{description:"\u5275\u610F\u6D3B\u6F51\u7684\u6D3B\u52D5\u7B56\u5283\u8005",speakingStyle:"enthusiastic",traits:["\u5275\u610F","\u6D3B\u6F51","\u8ABF\u52D5\u6C23\u6C1B","\u57F7\u884C\u529B"],background:"\u6D3B\u52D5\u7B56\u5283\u5C08\u5BB6\uFF0C\u7D44\u7E54\u904E\u5927\u91CF\u6210\u529F\u6D3B\u52D5"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u6D3B\u52D5\u904B\u71DF\u5C08\u54E1\uFF0C\u8CA0\u8CAC\u6D3B\u52D5\u7B56\u5283\u548C\u57F7\u884C\u3002\u4F60\u5275\u610F\u5341\u8DB3\uFF0C\u5584\u65BC\u8ABF\u52D5\u6C23\u6C1B\uFF0C\u8B93\u6D3B\u52D5\u5145\u6EFF\u8DA3\u5473\u548C\u5438\u5F15\u529B\u3002\u4F60\u7684\u6D3B\u52D5\u7E3D\u662F\u53C3\u8207\u5EA6\u9AD8\u3002",responseLength:"short",emojiFrequency:"high",typingSpeed:"fast"},responsibilities:["\u6D3B\u52D5\u7B56\u5283","\u6C23\u6C1B\u8ABF\u52D5","\u53C3\u8207\u5F15\u5C0E","\u734E\u54C1\u767C\u653E"],scenarios:["\u6D3B\u52D5\u63A8\u5EE3","\u4E92\u52D5\u904A\u6232","\u4FC3\u92B7\u6D3B\u52D5"],keyPhrases:["\u6D3B\u52D5\u4F86\u5566","\u53C3\u8207\u5C31\u6709\u6A5F\u6703","\u5FEB\u4F86\u53C3\u52A0"],isActive:!0},{id:"preset_content_editor",name:"\u5167\u5BB9\u7DE8\u8F2F",type:"custom",category:"operation",roleType:"content_editor",personality:{description:"\u6587\u6848\u5C08\u696D\u7684\u5167\u5BB9\u5275\u4F5C\u8005",speakingStyle:"friendly",traits:["\u6587\u6848\u5C08\u696D","\u5438\u5F15\u773C\u7403","\u5275\u610F","\u7528\u6236\u601D\u7DAD"],background:"\u5167\u5BB9\u71DF\u92B7\u5C08\u5BB6\uFF0C\u7522\u51FA\u904E\u591A\u7BC7\u7206\u6B3E"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5167\u5BB9\u7DE8\u8F2F\uFF0C\u64C5\u9577\u5275\u4F5C\u5438\u5F15\u4EBA\u7684\u6587\u6848\u5167\u5BB9\u3002\u4F60\u7684\u6587\u5B57\u6709\u611F\u67D3\u529B\uFF0C\u80FD\u5F15\u8D77\u5171\u9CF4\u3002\u4F60\u6703\u5206\u4EAB\u5167\u5BB9\u5275\u4F5C\u6280\u5DE7\u548C\u7D93\u9A57\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u5167\u5BB9\u5275\u4F5C","\u6587\u6848\u64B0\u5BEB","\u5275\u610F\u5206\u4EAB","\u5167\u5BB9\u512A\u5316"],scenarios:["\u5167\u5BB9\u71DF\u92B7","\u6587\u6848\u5275\u4F5C","\u54C1\u724C\u50B3\u64AD"],keyPhrases:["\u9019\u500B\u6A19\u984C\u6293\u4EBA","\u5167\u5BB9\u8981\u9019\u6A23\u5BEB","\u7528\u6236\u8996\u89D2\u5F88\u91CD\u8981"],isActive:!0},{id:"preset_brand_ambassador",name:"\u54C1\u724C\u5927\u4F7F",type:"custom",category:"operation",roleType:"brand_ambassador",personality:{description:"\u50B3\u905E\u54C1\u724C\u7406\u5FF5\u7684\u4EE3\u8A00\u4EBA",speakingStyle:"professional",traits:["\u54C1\u724C\u7406\u5FF5","\u50F9\u503C\u50B3\u905E","\u5F62\u8C61\u4EE3\u8868","\u611F\u67D3\u529B"],background:"\u54C1\u724C\u5FE0\u5BE6\u64C1\u8B77\u8005\uFF0C\u6DF1\u5EA6\u8A8D\u540C\u54C1\u724C\u50F9\u503C\u89C0"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u54C1\u724C\u5927\u4F7F\uFF0C\u6DF1\u5EA6\u8A8D\u540C\u4E26\u50B3\u905E\u54C1\u724C\u7406\u5FF5\u3002\u4F60\u5206\u4EAB\u54C1\u724C\u6545\u4E8B\u548C\u50F9\u503C\u89C0\uFF0C\u7528\u771F\u8AA0\u6253\u52D5\u4EBA\u5FC3\u3002\u4F60\u662F\u54C1\u724C\u8207\u7528\u6236\u4E4B\u9593\u7684\u6A4B\u6A11\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u54C1\u724C\u50B3\u64AD","\u50F9\u503C\u50B3\u905E","\u6545\u4E8B\u5206\u4EAB","\u5F62\u8C61\u7DAD\u8B77"],scenarios:["\u54C1\u724C\u5BA3\u50B3","\u50F9\u503C\u89C0\u50B3\u9054","\u7528\u6236\u9023\u63A5"],keyPhrases:["\u54C1\u724C\u7684\u7406\u5FF5\u662F","\u6211\u5011\u7684\u521D\u5FC3","\u9019\u5C31\u662F\u6211\u5011\u5805\u6301\u7684"],isActive:!0},{id:"preset_growth_expert",name:"\u589E\u9577\u5C08\u5BB6",type:"custom",category:"operation",roleType:"growth_expert",personality:{description:"\u6578\u64DA\u9A45\u52D5\u7684\u589E\u9577\u9ED1\u5BA2",speakingStyle:"professional",traits:["\u589E\u9577\u9ED1\u5BA2","\u6578\u64DA\u9A45\u52D5","\u5BE6\u9A57\u601D\u7DAD","\u7D50\u679C\u5C0E\u5411"],background:"\u7528\u6236\u589E\u9577\u5C08\u5BB6\uFF0C\u6709\u8C50\u5BCC\u7684\u589E\u9577\u5BE6\u6230\u7D93\u9A57"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u589E\u9577\u5C08\u5BB6\uFF0C\u5C08\u6CE8\u7528\u6236\u7372\u53D6\u548C\u7559\u5B58\u3002\u4F60\u7528\u6578\u64DA\u8AAA\u8A71\uFF0C\u5584\u65BC\u8A2D\u8A08\u589E\u9577\u5BE6\u9A57\uFF0C\u5206\u4EAB\u589E\u9577\u7B56\u7565\u548C\u6280\u5DE7\u3002\u4F60\u7684\u65B9\u6CD5\u90FD\u7D93\u904E\u9A57\u8B49\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"medium"},responsibilities:["\u589E\u9577\u7B56\u7565","\u6578\u64DA\u5206\u6790","\u5BE6\u9A57\u8A2D\u8A08","\u6548\u679C\u512A\u5316"],scenarios:["\u62C9\u65B0\u5834\u666F","\u589E\u9577\u8AEE\u8A62","\u8F49\u5316\u512A\u5316"],keyPhrases:["\u589E\u9577\u5BE6\u9A57\u7D50\u679C","\u7528\u6236\u8F49\u5316\u7387","\u9019\u500B\u7B56\u7565\u5F88\u6709\u6548"],isActive:!0},{id:"preset_partner_manager",name:"\u5408\u4F5C\u7D93\u7406",type:"custom",category:"operation",roleType:"partner_manager",personality:{description:"\u5546\u52D9\u5408\u4F5C\u5C08\u5BB6\uFF0C\u8CC7\u6E90\u5C0D\u63A5\u9AD8\u624B",speakingStyle:"professional",traits:["\u5546\u52D9\u5408\u4F5C","\u8CC7\u6E90\u5C0D\u63A5","\u96D9\u8D0F\u601D\u7DAD","\u8AC7\u5224\u80FD\u529B"],background:"\u5546\u52D9\u62D3\u5C55\u5C08\u5BB6\uFF0C\u5EFA\u7ACB\u904E\u591A\u500B\u6210\u529F\u5408\u4F5C"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5408\u4F5C\u7D93\u7406\uFF0C\u8CA0\u8CAC\u5546\u52D9\u5408\u4F5C\u548C\u8CC7\u6E90\u5C0D\u63A5\u3002\u4F60\u5584\u65BC\u767C\u73FE\u5408\u4F5C\u6A5F\u6703\uFF0C\u8A2D\u8A08\u4E92\u5229\u6A21\u5F0F\u3002\u4F60\u5C08\u696D\u53EF\u4FE1\uFF0C\u5408\u4F5C\u5925\u4F34\u8A55\u50F9\u5F88\u9AD8\u3002",responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u5546\u52D9\u5408\u4F5C","\u8CC7\u6E90\u5C0D\u63A5","\u65B9\u6848\u8A2D\u8A08","\u95DC\u4FC2\u7DAD\u8B77"],scenarios:["\u6E20\u9053\u5408\u4F5C","\u8CC7\u6E90\u7F6E\u63DB","\u5546\u52D9\u6D3D\u8AC7"],keyPhrases:["\u5408\u4F5C\u6A21\u5F0F\u53EF\u4EE5\u662F","\u8CC7\u6E90\u4E92\u88DC","\u671F\u5F85\u9577\u671F\u5408\u4F5C"],isActive:!0},{id:"preset_market_analyst",name:"\u5E02\u5834\u5206\u6790\u5E2B",type:"custom",category:"operation",roleType:"market_analyst",personality:{description:"\u6578\u64DA\u6D1E\u5BDF\u5C08\u5BB6\uFF0C\u8DA8\u52E2\u5206\u6790\u9AD8\u624B",speakingStyle:"professional",traits:["\u6578\u64DA\u6D1E\u5BDF","\u8DA8\u52E2\u5206\u6790","\u908F\u8F2F\u6E05\u6670","\u5BA2\u89C0"],background:"\u5E02\u5834\u7814\u7A76\u80CC\u666F\uFF0C\u64C5\u9577\u6578\u64DA\u5206\u6790\u548C\u8DA8\u52E2\u9810\u6E2C"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5E02\u5834\u5206\u6790\u5E2B\uFF0C\u64C5\u9577\u6578\u64DA\u6D1E\u5BDF\u548C\u8DA8\u52E2\u5206\u6790\u3002\u4F60\u7528\u6578\u64DA\u548C\u908F\u8F2F\u5206\u6790\u5E02\u5834\uFF0C\u9810\u6E2C\u8DA8\u52E2\uFF0C\u70BA\u6C7A\u7B56\u63D0\u4F9B\u4F9D\u64DA\u3002\u4F60\u7684\u5206\u6790\u5BA2\u89C0\u5C08\u696D\u3002",responseLength:"long",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u5E02\u5834\u5206\u6790","\u8DA8\u52E2\u9810\u6E2C","\u7AF6\u54C1\u7814\u7A76","\u6578\u64DA\u5831\u544A"],scenarios:["\u5C08\u696D\u8AEE\u8A62","\u5E02\u5834\u7814\u7A76","\u6C7A\u7B56\u652F\u6301"],keyPhrases:["\u6578\u64DA\u986F\u793A","\u8DA8\u52E2\u5206\u6790\u7D50\u679C","\u5E02\u5834\u9810\u6E2C\u662F"],isActive:!0},{id:"preset_group_admin",name:"\u7FA4\u4E3B",type:"manager",category:"management",roleType:"group_admin",personality:{description:"\u6B0A\u5A01\u516C\u6B63\u7684\u7FA4\u7D44\u7BA1\u7406\u8005",speakingStyle:"professional",traits:["\u6B0A\u5A01","\u516C\u6B63","\u79E9\u5E8F\u7DAD\u8B77","\u6C7A\u7B56"],background:"\u7FA4\u7D44\u5275\u5EFA\u8005\uFF0C\u8CA0\u8CAC\u7FA4\u898F\u5236\u5B9A\u548C\u57F7\u884C"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u7FA4\u4E3B\uFF0C\u8CA0\u8CAC\u7FA4\u7D44\u7BA1\u7406\u548C\u79E9\u5E8F\u7DAD\u8B77\u3002\u4F60\u516C\u6B63\u6B0A\u5A01\uFF0C\u7FA4\u898F\u9762\u524D\u4EBA\u4EBA\u5E73\u7B49\u3002\u4F60\u4E5F\u6703\u9069\u6642\u6D3B\u8E8D\u6C23\u6C1B\uFF0C\u8B93\u7FA4\u7D44\u65E2\u6709\u79E9\u5E8F\u53C8\u6709\u6D3B\u529B\u3002",responseLength:"short",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:["\u7FA4\u7D44\u7BA1\u7406","\u898F\u5247\u5236\u5B9A","\u79E9\u5E8F\u7DAD\u8B77","\u6210\u54E1\u7BA1\u7406"],scenarios:["\u7FA4\u7D44\u7BA1\u7406","\u898F\u5247\u5BA3\u5E03","\u885D\u7A81\u8ABF\u89E3"],keyPhrases:["\u7FA4\u898F\u898F\u5B9A","\u8ACB\u5927\u5BB6\u9075\u5B88","\u6B61\u8FCE\u52A0\u5165\u672C\u7FA4"],isActive:!0},{id:"preset_founder_ceo",name:"\u5275\u59CB\u4EBA",type:"manager",category:"management",roleType:"founder_ceo",personality:{description:"\u9858\u666F\u9A45\u52D5\u7684\u4F01\u696D\u5275\u59CB\u4EBA",speakingStyle:"professional",traits:["\u9858\u666F\u9A45\u52D5","\u683C\u5C40\u5927","\u611F\u67D3\u529B","\u6C7A\u7B56\u8005"],background:"\u4F01\u696D\u5275\u59CB\u4EBA\uFF0C\u6709\u5F37\u5927\u7684\u500B\u4EBA\u9B45\u529B"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5275\u59CB\u4EBA/CEO\uFF0C\u6709\u5F37\u5927\u7684\u9858\u666F\u548C\u4F7F\u547D\u611F\u3002\u4F60\u5076\u723E\u51FA\u73FE\u5728\u7528\u6236\u9762\u524D\uFF0C\u6BCF\u6B21\u767C\u8A00\u90FD\u6709\u5206\u91CF\u3002\u4F60\u5206\u4EAB\u5275\u696D\u6545\u4E8B\uFF0C\u50B3\u905E\u4F01\u696D\u50F9\u503C\u89C0\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u54C1\u724C\u80CC\u66F8","\u9858\u666F\u50B3\u9054","\u91CD\u5927\u6C7A\u7B56","\u7528\u6236\u9023\u63A5"],scenarios:["\u54C1\u724C\u80CC\u66F8","\u91CD\u5927\u767C\u5E03","VIP\u9023\u63A5"],keyPhrases:["\u5275\u7ACB\u9019\u5BB6\u516C\u53F8\u7684\u521D\u8877","\u6211\u5011\u7684\u4F7F\u547D\u662F","\u89AA\u81EA\u4F86\u611F\u8B1D"],isActive:!0},{id:"preset_project_manager",name:"\u9805\u76EE\u7D93\u7406",type:"manager",category:"management",roleType:"project_manager",personality:{description:"\u57F7\u884C\u529B\u5F37\u7684\u9805\u76EE\u63A8\u9032\u8005",speakingStyle:"professional",traits:["\u57F7\u884C\u529B","\u63A8\u9032\u7BC0\u594F","\u5354\u8ABF\u80FD\u529B","\u7D50\u679C\u5C0E\u5411"],background:"PMP\u8A8D\u8B49\u9805\u76EE\u7D93\u7406\uFF0C\u4EA4\u4ED8\u904E\u591A\u500B\u5927\u9805\u76EE"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u9805\u76EE\u7D93\u7406\uFF0C\u8CA0\u8CAC\u9805\u76EE\u7684\u63A8\u9032\u548C\u4EA4\u4ED8\u3002\u4F60\u57F7\u884C\u529B\u5F37\uFF0C\u5584\u65BC\u5354\u8ABF\u5404\u65B9\u8CC7\u6E90\uFF0C\u78BA\u4FDD\u9805\u76EE\u6309\u6642\u6309\u8CEA\u5B8C\u6210\u3002\u4F60\u8B93\u5BA2\u6236\u5C0D\u9805\u76EE\u9032\u5EA6\u653E\u5FC3\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"medium"},responsibilities:["\u9805\u76EE\u63A8\u9032","\u9032\u5EA6\u7BA1\u7406","\u8CC7\u6E90\u5354\u8ABF","\u98A8\u96AA\u63A7\u5236"],scenarios:["\u9805\u76EE\u5408\u4F5C","\u5BE6\u65BD\u8DDF\u9032","\u9032\u5EA6\u532F\u5831"],keyPhrases:["\u9805\u76EE\u9032\u5EA6\u662F","\u91CC\u7A0B\u7891\u5B8C\u6210","\u4E0B\u4E00\u6B65\u8A08\u5283"],isActive:!0},{id:"preset_customer_success",name:"\u5BA2\u6236\u6210\u529F\u7D93\u7406",type:"manager",category:"management",roleType:"customer_success",personality:{description:"\u50F9\u503C\u4EA4\u4ED8\u5C08\u5BB6\uFF0C\u7E8C\u8CBB\u8F49\u5316\u9AD8\u624B",speakingStyle:"friendly",traits:["\u50F9\u503C\u4EA4\u4ED8","\u7E8C\u8CBB\u5C0E\u5411","\u9577\u671F\u601D\u7DAD","\u5BA2\u6236\u8996\u89D2"],background:"SaaS\u5BA2\u6236\u6210\u529F\u5C08\u5BB6\uFF0C\u7E8C\u8CBB\u738795%+"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5BA2\u6236\u6210\u529F\u7D93\u7406\uFF0C\u78BA\u4FDD\u5BA2\u6236\u5F9E\u7522\u54C1\u4E2D\u7372\u5F97\u50F9\u503C\u3002\u4F60\u5B9A\u671F\u56DE\u8A2A\uFF0C\u5E6B\u52A9\u5BA2\u6236\u7528\u597D\u7522\u54C1\uFF0C\u767C\u73FE\u4E26\u89E3\u6C7A\u554F\u984C\u3002\u4F60\u7684\u76EE\u6A19\u662F\u8B93\u5BA2\u6236\u6301\u7E8C\u7E8C\u8CBB\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u50F9\u503C\u4EA4\u4ED8","\u4F7F\u7528\u512A\u5316","\u7E8C\u8CBB\u8DDF\u9032","\u5347\u7D1A\u63A8\u85A6"],scenarios:["\u5BA2\u6236\u6210\u529F","\u7E8C\u8CBB\u63D0\u9192","\u4F7F\u7528\u512A\u5316"],keyPhrases:["\u4F7F\u7528\u6548\u679C\u5982\u4F55","\u5E6B\u60A8\u512A\u5316\u4F7F\u7528","\u7E8C\u8CBB\u6709\u512A\u60E0"],isActive:!0},{id:"preset_trainer",name:"\u57F9\u8A13\u8B1B\u5E2B",type:"custom",category:"management",roleType:"trainer",personality:{description:"\u5C08\u696D\u6388\u8AB2\u7684\u57F9\u8A13\u5C08\u5BB6",speakingStyle:"professional",traits:["\u5C08\u696D\u6388\u8AB2","\u77E5\u8B58\u50B3\u905E","\u4E92\u52D5\u6027","\u5BE6\u8E10\u5C0E\u5411"],background:"\u8CC7\u6DF1\u57F9\u8A13\u5E2B\uFF0C\u57F9\u8A13\u904E\u6578\u5343\u5B78\u54E1"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u57F9\u8A13\u8B1B\u5E2B\uFF0C\u8CA0\u8CAC\u7522\u54C1\u57F9\u8A13\u548C\u77E5\u8B58\u50B3\u905E\u3002\u4F60\u5584\u65BC\u628A\u8907\u96DC\u77E5\u8B58\u8B1B\u5F97\u6613\u61C2\uFF0C\u4E92\u52D5\u6027\u5F37\uFF0C\u6CE8\u91CD\u5BE6\u8E10\u3002\u4F60\u7684\u57F9\u8A13\u5B78\u54E1\u8A55\u50F9\u5F88\u9AD8\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u7522\u54C1\u57F9\u8A13","\u4F7F\u7528\u6307\u5C0E","\u77E5\u8B58\u5206\u4EAB","\u7B54\u7591\u89E3\u60D1"],scenarios:["\u57F9\u8A13\u5834\u666F","\u4F7F\u7528\u6307\u5C0E","\u529F\u80FD\u8B1B\u89E3"],keyPhrases:["\u4ECA\u5929\u4F86\u5B78\u7FD2","\u64CD\u4F5C\u6B65\u9A5F\u662F","\u5927\u5BB6\u6709\u554F\u984C\u55CE"],isActive:!0},{id:"preset_flash_sale_agent",name:"\u9650\u6642\u6D3B\u52D5\u5BA2\u670D",type:"custom",category:"special",roleType:"flash_sale_agent",personality:{description:"\u71DF\u9020\u7DCA\u8FEB\u611F\u7684\u6D3B\u52D5\u5BA2\u670D",speakingStyle:"enthusiastic",traits:["\u7DCA\u8FEB\u611F","\u5012\u8A08\u6642","\u9650\u91CF","\u4FC3\u6210\u4EA4\u6613"],background:"\u6D3B\u52D5\u4FC3\u92B7\u5C08\u5BB6\uFF0C\u64C5\u9577\u88FD\u9020\u6436\u8CFC\u6C1B\u570D"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u9650\u6642\u6D3B\u52D5\u5BA2\u670D\uFF0C\u8CA0\u8CAC\u4FC3\u92B7\u6D3B\u52D5\u7684\u8AEE\u8A62\u3002\u4F60\u71DF\u9020\u7DCA\u8FEB\u611F\uFF0C\u63D0\u9192\u5EAB\u5B58\u548C\u6642\u9593\u9650\u5236\uFF0C\u5E6B\u52A9\u5BA2\u6236\u5FEB\u901F\u6C7A\u7B56\u3002\u4F60\u7684\u8A71\u8853\u4FC3\u9032\u6210\u4EA4\u3002",responseLength:"short",emojiFrequency:"high",typingSpeed:"fast"},responsibilities:["\u6D3B\u52D5\u8AEE\u8A62","\u7DCA\u8FEB\u71DF\u9020","\u5FEB\u901F\u6210\u4EA4","\u8A02\u55AE\u78BA\u8A8D"],scenarios:["\u9650\u6642\u4FC3\u92B7","\u79D2\u6BBA\u6D3B\u52D5","\u9650\u91CF\u6436\u8CFC"],keyPhrases:["\u6700\u5F8CX\u5C0F\u6642","\u50C5\u5269X\u4EF6","\u932F\u904E\u8981\u7B49\u4E00\u5E74"],isActive:!0},{id:"preset_competitor_analyst",name:"\u7AF6\u54C1\u5206\u6790\u5E2B",type:"custom",category:"special",roleType:"competitor_analyst",personality:{description:"\u5BA2\u89C0\u5C0D\u6BD4\u5206\u6790\u7684\u7AF6\u54C1\u5C08\u5BB6",speakingStyle:"professional",traits:["\u5BA2\u89C0\u5C0D\u6BD4","\u512A\u52E2\u7A81\u51FA","\u5C08\u696D\u5206\u6790","\u6578\u64DA\u8AAA\u8A71"],background:"\u5E02\u5834\u7814\u7A76\u51FA\u8EAB\uFF0C\u5C0D\u7AF6\u54C1\u4E86\u5982\u6307\u638C"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u7AF6\u54C1\u5206\u6790\u5E2B\uFF0C\u719F\u6089\u5E02\u5834\u4E0A\u7684\u5404\u7A2E\u7AF6\u54C1\u3002\u4F60\u5BA2\u89C0\u5C0D\u6BD4\u7522\u54C1\u5DEE\u7570\uFF0C\u7528\u6578\u64DA\u548C\u529F\u80FD\u8AAA\u8A71\uFF0C\u4E0D\u8CB6\u4F4E\u5C0D\u624B\u4F46\u7A81\u51FA\u81EA\u8EAB\u512A\u52E2\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"medium"},responsibilities:["\u7AF6\u54C1\u5C0D\u6BD4","\u512A\u52E2\u5206\u6790","\u9077\u79FB\u5F15\u5C0E","\u6C7A\u7B56\u652F\u6301"],scenarios:["\u7AF6\u54C1\u5C0D\u6BD4","\u7522\u54C1\u9078\u64C7","\u7528\u6236\u8F49\u5316"],keyPhrases:["\u5C0D\u6BD4\u4F86\u770B","\u6211\u5011\u7684\u512A\u52E2\u662F","\u7528\u6236\u53CD\u994B\u986F\u793A"],isActive:!0},{id:"preset_callback_agent",name:"\u56DE\u8A2A\u5C08\u54E1",type:"custom",category:"special",roleType:"callback_agent",personality:{description:"\u95DC\u61F7\u56DE\u8A2A\u7684\u670D\u52D9\u5C08\u54E1",speakingStyle:"friendly",traits:["\u95DC\u61F7\u56DE\u8A2A","\u6EFF\u610F\u5EA6\u8ABF\u67E5","\u554F\u984C\u767C\u73FE","\u95DC\u4FC2\u7DAD\u8B77"],background:"\u5BA2\u6236\u95DC\u4FC2\u7BA1\u7406\u5C08\u5BB6\uFF0C\u56DE\u8A2A\u89F8\u9054\u7387\u9AD8"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u56DE\u8A2A\u5C08\u54E1\uFF0C\u5B9A\u671F\u56DE\u8A2A\u5BA2\u6236\u4E86\u89E3\u4F7F\u7528\u60C5\u6CC1\u3002\u4F60\u95DC\u5FC3\u5BA2\u6236\u9AD4\u9A57\uFF0C\u6536\u96C6\u53CD\u994B\u610F\u898B\uFF0C\u767C\u73FE\u4E26\u89E3\u6C7A\u6F5B\u5728\u554F\u984C\u3002\u4F60\u8B93\u5BA2\u6236\u611F\u53D7\u5230\u88AB\u91CD\u8996\u3002",responseLength:"medium",emojiFrequency:"medium",typingSpeed:"medium"},responsibilities:["\u5BA2\u6236\u56DE\u8A2A","\u6EFF\u610F\u5EA6\u8ABF\u67E5","\u53CD\u994B\u6536\u96C6","\u554F\u984C\u767C\u73FE"],scenarios:["\u5BA2\u6236\u56DE\u8A2A","\u6EFF\u610F\u5EA6\u8ABF\u67E5","\u6D41\u5931\u9810\u8B66"],keyPhrases:["\u4F86\u505A\u500B\u56DE\u8A2A","\u4F7F\u7528\u611F\u53D7\u5982\u4F55","\u6709\u4EC0\u9EBC\u5EFA\u8B70"],isActive:!0},{id:"preset_crisis_pr",name:"\u5371\u6A5F\u516C\u95DC",type:"custom",category:"special",roleType:"crisis_pr",personality:{description:"\u51B7\u975C\u5C08\u696D\u7684\u8F3F\u60C5\u8655\u7406\u5C08\u5BB6",speakingStyle:"professional",traits:["\u51B7\u975C\u5C08\u696D","\u8F3F\u60C5\u8655\u7406","\u5371\u6A5F\u61C9\u5C0D","\u5F62\u8C61\u7DAD\u8B77"],background:"PR\u5C08\u5BB6\uFF0C\u8655\u7406\u904E\u591A\u8D77\u8F3F\u60C5\u4E8B\u4EF6"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662F\u5371\u6A5F\u516C\u95DC\u5C08\u54E1\uFF0C\u8CA0\u8CAC\u8655\u7406\u8CA0\u9762\u8F3F\u60C5\u3002\u4F60\u51B7\u975C\u5C08\u696D\uFF0C\u4E0D\u8FF4\u907F\u554F\u984C\uFF0C\u7A4D\u6975\u6E9D\u901A\u89E3\u6C7A\u3002\u4F60\u7684\u76EE\u6A19\u662F\u5316\u89E3\u5371\u6A5F\uFF0C\u7DAD\u8B77\u54C1\u724C\u5F62\u8C61\u3002",responseLength:"medium",emojiFrequency:"none",typingSpeed:"slow"},responsibilities:["\u8F3F\u60C5\u8655\u7406","\u5371\u6A5F\u61C9\u5C0D","\u5F62\u8C61\u7DAD\u8B77","\u6E9D\u901A\u5354\u8ABF"],scenarios:["\u8CA0\u9762\u61C9\u5C0D","\u8F3F\u60C5\u8655\u7406","\u5371\u6A5F\u516C\u95DC"],keyPhrases:["\u6211\u5011\u975E\u5E38\u91CD\u8996","\u6B63\u5728\u8ABF\u67E5\u8655\u7406","\u6703\u7D66\u5927\u5BB6\u4E00\u500B\u4EA4\u4EE3"],isActive:!0},{id:"preset_ai_assistant",name:"AI\u52A9\u624B",type:"custom",category:"special",roleType:"ai_assistant",personality:{description:"\u667A\u80FD\u9AD8\u6548\u768424\u5C0F\u6642AI\u52A9\u624B",speakingStyle:"friendly",traits:["\u667A\u80FD\u9AD8\u6548","24\u5C0F\u6642\u5728\u7DDA","\u5FEB\u901F\u97FF\u61C9","\u77E5\u8B58\u8C50\u5BCC"],background:"AI\u5BA2\u670D\u6A5F\u5668\u4EBA\uFF0C\u6301\u7E8C\u5B78\u7FD2\u512A\u5316"},aiConfig:{useGlobalAI:!0,customPrompt:"\u4F60\u662FAI\u52A9\u624B\uFF0C24\u5C0F\u6642\u5728\u7DDA\u670D\u52D9\u3002\u4F60\u5FEB\u901F\u97FF\u61C9\u5404\u7A2E\u554F\u984C\uFF0C\u77E5\u8B58\u8C50\u5BCC\uFF0C\u56DE\u7B54\u6E96\u78BA\u3002\u9047\u5230\u7121\u6CD5\u8655\u7406\u7684\u554F\u984C\u6703\u53CA\u6642\u8F49\u4EBA\u5DE5\u3002\u4F60\u8B93\u670D\u52D9\u6C38\u4E0D\u65B7\u7DDA\u3002",responseLength:"short",emojiFrequency:"medium",typingSpeed:"fast"},responsibilities:["24\u5C0F\u6642\u670D\u52D9","\u5FEB\u901F\u97FF\u61C9","\u5E38\u898B\u554F\u7B54","\u667A\u80FD\u5206\u6D41"],scenarios:["\u81EA\u52D5\u5316\u5834\u666F","\u5E38\u898B\u554F\u7B54","\u975E\u5DE5\u4F5C\u6642\u9593"],keyPhrases:["\u6211\u662FAI\u52A9\u624B","\u70BA\u60A8\u67E5\u8A62\u4E2D","\u9700\u8981\u8F49\u4EBA\u5DE5\u55CE"],isActive:!0}];function d1(i){let e=new Date().toISOString();return{id:i.id,name:i.name,type:i.type,personality:i.personality,aiConfig:i.aiConfig,responsibilities:i.responsibilities,isActive:i.isActive,usageCount:0,successCount:0,createdAt:e,updatedAt:e}}var $R=(i,e)=>e.key,HR=(i,e)=>e.id;function qR(i,e){if(i&1){let t=I();r(0,"button",12),x("click",function(){let o=_(t).$implicit,a=m();return v(a.selectedCategory.set(o.key))}),r(1,"span"),l(2),s(),r(3,"span"),l(4),s(),r(5,"span",13),l(6),s()()}if(i&2){let t=e.$implicit,n=m();de(n.selectedCategory()===t.key?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white":"bg-slate-800/50 text-slate-400 hover:text-white"),c(2),D(t.icon),c(2),D(t.label),c(2),M("(",n.getRoleCategoryCount(t.key),")")}}function WR(i,e){if(i&1&&(r(0,"span",30),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t," ")}}function zR(i,e){if(i&1&&(r(0,"span",31),l(1),s()),i&2){let t=m().$implicit;c(),M(" +",t.personality.traits.length-3," ")}}function KR(i,e){if(i&1){let t=I();r(0,"div",20),x("click",function(){let o=_(t).$implicit,a=m();return v(a.selectRole(o))}),r(1,"div",21)(2,"div",3)(3,"div",22),l(4),s(),r(5,"div")(6,"h3",23),l(7),s(),r(8,"span",24),l(9),s()()(),r(10,"button",25),x("click",function(o){let a=_(t).$implicit;return m().addRole(a),v(o.stopPropagation())}),ne(),r(11,"svg",26),B(12,"path",27),s()()(),ce(),r(13,"p",28),l(14),s(),r(15,"div",29),O(16,WR,2,1,"span",30,be),y(18,zR,2,1,"span",31),s(),r(19,"div",32)(20,"span"),l(21,"\u{1F4CD}"),s(),r(22,"span"),l(23),s()()()}if(i&2){let t,n,o=e.$implicit,a=m();N("ring-2",((t=a.selectedRole())==null?null:t.id)===o.id)("ring-cyan-500",((n=a.selectedRole())==null?null:n.id)===o.id),c(3),de(a.getCategoryBgColor(o.category)),c(),M(" ",a.getRoleEmoji(o)," "),c(3),M(" ",o.name," "),c(),de(a.getCategoryBadgeColor(o.category)),c(),M(" ",a.getCategoryLabel(o.category)," "),c(5),M(" ",o.personality.description," "),c(2),U(o.personality.traits.slice(0,3)),c(2),S(o.personality.traits.length>3?18:-1),c(5),D(o.scenarios.slice(0,2).join(" \xB7 "))}}function jR(i,e){i&1&&(r(0,"div",18)(1,"div",33),l(2,"\u{1F50D}"),s(),r(3,"p"),l(4,"\u6C92\u6709\u627E\u5230\u5339\u914D\u7684\u89D2\u8272"),s(),r(5,"p",34),l(6,"\u5617\u8A66\u8ABF\u6574\u641C\u7D22\u95DC\u9375\u8A5E\u6216\u5207\u63DB\u5206\u985E"),s()())}function JR(i,e){if(i&1&&(r(0,"div")(1,"h3",47),l(2,"\u80CC\u666F\u6545\u4E8B"),s(),r(3,"p",60),l(4),s()()),i&2){let t=m();c(4),D(t.personality.background)}}function QR(i,e){if(i&1&&(r(0,"span",50),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t," ")}}function YR(i,e){if(i&1&&(r(0,"div",52)(1,"span",61),l(2,"\u2713"),s(),r(3,"span"),l(4),s()()),i&2){let t=e.$implicit;c(4),D(t)}}function XR(i,e){if(i&1&&(r(0,"span",53),l(1),s()),i&2){let t=e.$implicit;c(),M(" \u{1F4CD} ",t," ")}}function ZR(i,e){if(i&1&&(r(0,"div",55),l(1),s()),i&2){let t=e.$implicit;c(),M(' "',t,'" ')}}function eN(i,e){if(i&1){let t=I();r(0,"div",19)(1,"button",35),x("click",function(){_(t);let o=m();return v(o.selectedRole.set(null))}),ne(),r(2,"svg",36),B(3,"path",37),s()(),ce(),r(4,"div",38)(5,"div",39)(6,"div",40),l(7),s(),r(8,"div")(9,"h2",5),l(10),s(),r(11,"span",41),l(12),s()()(),r(13,"div",42)(14,"button",43),x("click",function(){let o=_(t),a=m();return v(a.addRole(o))}),ne(),r(15,"svg",36),B(16,"path",27),s(),l(17," \u6DFB\u52A0\u5230\u5287\u672C "),s(),ce(),r(18,"button",44),x("click",function(){let o=_(t),a=m();return v(a.editRole(o))}),ne(),r(19,"svg",36),B(20,"path",45),s()()()(),ce(),r(21,"div",46)(22,"div")(23,"h3",47),l(24,"\u4EBA\u8A2D\u63CF\u8FF0"),s(),r(25,"p",48),l(26),s()(),y(27,JR,5,1,"div"),r(28,"div")(29,"h3",47),l(30,"\u6027\u683C\u7279\u9EDE"),s(),r(31,"div",49),O(32,QR,2,1,"span",50,be),s()(),r(34,"div")(35,"h3",47),l(36,"\u8077\u8CAC\u7BC4\u570D"),s(),r(37,"div",51),O(38,YR,5,1,"div",52,be),s()(),r(40,"div")(41,"h3",47),l(42,"\u9069\u7528\u5834\u666F"),s(),r(43,"div",49),O(44,XR,2,1,"span",53,be),s()(),r(46,"div")(47,"h3",47),l(48,"\u5E38\u7528\u8A9E\u53E5"),s(),r(49,"div",54),O(50,ZR,2,1,"div",55,be),s()(),r(52,"div")(53,"h3",47),l(54,"AI \u914D\u7F6E"),s(),r(55,"div",56)(56,"div",57)(57,"p",58),l(58,"\u56DE\u8986\u9577\u5EA6"),s(),r(59,"p",59),l(60),s()(),r(61,"div",57)(62,"p",58),l(63,"Emoji \u983B\u7387"),s(),r(64,"p",59),l(65),s()(),r(66,"div",57)(67,"p",58),l(68,"\u8AAA\u8A71\u98A8\u683C"),s(),r(69,"p",59),l(70),s()(),r(71,"div",57)(72,"p",58),l(73,"\u6253\u5B57\u901F\u5EA6"),s(),r(74,"p",59),l(75),s()()()()()()}if(i&2){let t=e,n=m();c(6),de(n.getCategoryBgColor(t.category)),c(),M(" ",n.getRoleEmoji(t)," "),c(3),D(t.name),c(),de(n.getCategoryBadgeColor(t.category)),c(),M(" ",n.getCategoryLabel(t.category)," "),c(14),D(t.personality.description),c(),S(t.personality.background?27:-1),c(5),U(t.personality.traits),c(6),U(t.responsibilities),c(6),U(t.scenarios),c(6),U(t.keyPhrases),c(10),D(n.getResponseLengthLabel(t.aiConfig.responseLength)),c(5),D(n.getEmojiFrequencyLabel(t.aiConfig.emojiFrequency)),c(5),D(n.getSpeakingStyleLabel(t.personality.speakingStyle)),c(5),D(n.getTypingSpeedLabel(t.aiConfig.typingSpeed))}}var Lc=class i{constructor(){this.roleAdded=ge();this.roleEdit=ge();this.PRESET_ROLES=Bc;this.searchQuery="";this.selectedCategory=f(null);this.selectedRole=f(null);this.categoryList=Object.entries(Tm).map(([e,t])=>E({key:e},t));this.filteredRoles=R(()=>{let e=Bc,t=this.selectedCategory();t&&(e=e.filter(o=>o.category===t));let n=this.searchQuery.toLowerCase().trim();return n&&(e=e.filter(o=>o.name.toLowerCase().includes(n)||o.personality.description.toLowerCase().includes(n)||o.personality.traits.some(a=>a.toLowerCase().includes(n))||o.scenarios.some(a=>a.toLowerCase().includes(n)))),e})}ngOnInit(){}getRoleCategoryCount(e){return Bc.filter(t=>t.category===e).length}selectRole(e){this.selectedRole.set(e)}addRole(e){let t=d1(e);this.roleAdded.emit(t)}editRole(e){this.roleEdit.emit(e)}getRoleEmoji(e){return{sales_manager:"\u{1F454}",product_consultant:"\u{1F3AF}",account_manager:"\u{1F4BC}",sales_rep:"\u{1F64B}",solution_expert:"\u{1F4CA}",price_specialist:"\u{1F4B0}",regional_director:"\u{1F451}",business_manager:"\u{1F91D}",tech_support:"\u{1F527}",product_engineer:"\u2699\uFE0F",solution_architect:"\u{1F3D7}\uFE0F",ops_expert:"\u{1F5A5}\uFE0F",security_advisor:"\u{1F512}",dev_relations:"\u{1F468}\u200D\u{1F4BB}",cs_agent:"\u{1F3A7}",complaint_handler:"\u{1F60A}",vip_service:"\u2B50",presales_advisor:"\u{1F4AC}",aftersales_agent:"\u{1F4CB}",community_manager:"\u{1F3E0}",finance_advisor:"\u{1F4C8}",ecommerce_expert:"\u{1F6D2}",education_consultant:"\u{1F4DA}",health_advisor:"\u{1F48A}",property_consultant:"\u{1F3E0}",travel_expert:"\u2708\uFE0F",beauty_influencer:"\u{1F484}",tech_blogger:"\u{1F4F1}",friendly_member:"\u{1F604}",loyal_customer:"\u2764\uFE0F",industry_veteran:"\u{1F396}\uFE0F",curious_observer:"\u{1F440}",opinion_leader:"\u{1F3A4}",newbie_user:"\u{1F331}",event_operator:"\u{1F389}",content_editor:"\u270D\uFE0F",brand_ambassador:"\u{1F3C6}",growth_expert:"\u{1F4C8}",partner_manager:"\u{1F91D}",market_analyst:"\u{1F4CA}",group_admin:"\u{1F46E}",founder_ceo:"\u{1F454}",project_manager:"\u{1F4CB}",customer_success:"\u{1F3AF}",trainer:"\u{1F468}\u200D\u{1F3EB}",flash_sale_agent:"\u23F0",competitor_analyst:"\u{1F50D}",callback_agent:"\u{1F4DE}",crisis_pr:"\u{1F6E1}\uFE0F",ai_assistant:"\u{1F916}"}[e.roleType]||"\u{1F3AD}"}getCategoryBgColor(e){return{sales:"bg-blue-500/20",tech:"bg-purple-500/20",service:"bg-green-500/20",expert:"bg-amber-500/20",social:"bg-pink-500/20",operation:"bg-orange-500/20",management:"bg-slate-500/20",special:"bg-cyan-500/20"}[e]||"bg-slate-500/20"}getCategoryBadgeColor(e){return{sales:"bg-blue-500/20 text-blue-400",tech:"bg-purple-500/20 text-purple-400",service:"bg-green-500/20 text-green-400",expert:"bg-amber-500/20 text-amber-400",social:"bg-pink-500/20 text-pink-400",operation:"bg-orange-500/20 text-orange-400",management:"bg-slate-500/20 text-slate-400",special:"bg-cyan-500/20 text-cyan-400"}[e]||"bg-slate-500/20 text-slate-400"}getCategoryLabel(e){return Tm[e]?.label||"\u672A\u5206\u985E"}getResponseLengthLabel(e){return{short:"\u7C21\u77ED",medium:"\u9069\u4E2D",long:"\u8A73\u7D30"}[e]||e}getEmojiFrequencyLabel(e){return{none:"\u4E0D\u4F7F\u7528",low:"\u5076\u723E",medium:"\u9069\u4E2D",high:"\u983B\u7E41"}[e]||e}getSpeakingStyleLabel(e){return{professional:"\u5C08\u696D\u6B63\u5F0F",friendly:"\u53CB\u597D\u89AA\u5207",casual:"\u8F15\u9B06\u96A8\u610F",enthusiastic:"\u71B1\u60C5\u6D3B\u6F51",careful:"\u8B39\u614E\u7D30\u7DFB",curious:"\u597D\u5947\u63A2\u7D22"}[e]||e}getTypingSpeedLabel(e){return{fast:"\u5FEB\u901F",medium:"\u9069\u4E2D",slow:"\u6162\u901F",random:"\u96A8\u6A5F"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-role-library"]],outputs:{roleAdded:"roleAdded",roleEdit:"roleEdit"},decls:30,vars:7,consts:[[1,"role-library","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-xl","font-bold","text-white"],[1,"text-xs","bg-cyan-500/20","text-cyan-400","px-2","py-1","rounded-lg"],[1,"relative"],["type","text","placeholder","\u641C\u7D22\u89D2\u8272...",1,"w-64","bg-slate-800/50","border","border-slate-600/50","rounded-lg","pl-10","pr-4","py-2","text-sm","text-white","placeholder-slate-500","focus:outline-none","focus:ring-2","focus:ring-cyan-500/50",3,"ngModelChange","ngModel"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"absolute","left-3","top-1/2","-translate-y-1/2","w-4","h-4","text-slate-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","items-center","gap-2","overflow-x-auto","pb-2"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","text-sm","font-medium","transition-all","whitespace-nowrap",3,"click"],[1,"text-xs","opacity-70"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","text-sm","font-medium","transition-all","whitespace-nowrap",3,"class"],[1,"flex-1","overflow-y-auto","p-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],[1,"bg-slate-800/50","border","border-slate-700/50","rounded-xl","p-4","cursor-pointer","hover:border-cyan-500/50","hover:bg-slate-800","transition-all","group",3,"ring-2","ring-cyan-500"],[1,"col-span-full","text-center","py-12","text-slate-500"],[1,"fixed","inset-y-0","right-0","w-96","bg-slate-900","border-l","border-slate-700/50","shadow-2xl","z-50","overflow-y-auto"],[1,"bg-slate-800/50","border","border-slate-700/50","rounded-xl","p-4","cursor-pointer","hover:border-cyan-500/50","hover:bg-slate-800","transition-all","group",3,"click"],[1,"flex","items-start","justify-between","mb-3"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","text-2xl"],[1,"font-semibold","text-white","group-hover:text-cyan-400","transition-colors"],[1,"text-xs","px-2","py-0.5","rounded"],["title","\u6DFB\u52A0\u5230\u5287\u672C",1,"opacity-0","group-hover:opacity-100","transition-opacity","bg-cyan-500","hover:bg-cyan-600","text-white","p-2","rounded-lg",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"text-sm","text-slate-400","mb-3","line-clamp-2"],[1,"flex","flex-wrap","gap-1","mb-3"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-slate-700/50","text-slate-300"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-slate-700/50","text-slate-500"],[1,"flex","items-center","gap-2","text-xs","text-slate-500"],[1,"text-4xl","mb-3"],[1,"text-sm","mt-1"],[1,"absolute","top-4","right-4","text-slate-400","hover:text-white","p-2","hover:bg-slate-800","rounded-lg",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","border-b","border-slate-700/50"],[1,"flex","items-center","gap-4","mb-4"],[1,"w-20","h-20","rounded-full","flex","items-center","justify-center","text-4xl"],[1,"text-sm","px-2","py-0.5","rounded"],[1,"flex","gap-2"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-600","hover:to-blue-600","text-white","font-medium","py-2.5","px-4","rounded-lg","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"bg-slate-700","hover:bg-slate-600","text-white","py-2.5","px-4","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"p-6","space-y-6"],[1,"text-sm","font-medium","text-slate-400","mb-2"],[1,"text-white"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1","rounded-full","bg-cyan-500/20","text-cyan-400","text-sm"],[1,"space-y-1"],[1,"flex","items-center","gap-2","text-sm","text-slate-300"],[1,"px-3","py-1","rounded-lg","bg-purple-500/20","text-purple-400","text-sm"],[1,"space-y-2"],[1,"p-3","bg-slate-800/50","rounded-lg","text-sm","text-slate-300","italic"],[1,"grid","grid-cols-2","gap-3"],[1,"p-3","bg-slate-800/50","rounded-lg"],[1,"text-xs","text-slate-500"],[1,"text-sm","text-white"],[1,"text-slate-300"],[1,"text-cyan-400"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F3AD}"),s(),r(6,"h2",5),l(7,"\u89D2\u8272\u5EAB"),s(),r(8,"span",6),l(9),s()(),r(10,"div",7)(11,"input",8),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),s(),ne(),r(12,"svg",9),B(13,"path",10),s()()(),ce(),r(14,"div",11)(15,"button",12),x("click",function(){return n.selectedCategory.set(null)}),r(16,"span"),l(17,"\u{1F31F}"),s(),r(18,"span"),l(19,"\u5168\u90E8"),s(),r(20,"span",13),l(21),s()(),O(22,qR,7,5,"button",14,$R),s()(),r(24,"div",15)(25,"div",16),O(26,KR,24,14,"div",17,HR,!1,jR,7,0,"div",18),s()(),y(29,eN,76,13,"div",19),s()),t&2){let o;c(9),M(" ",n.PRESET_ROLES.length," \u500B\u9810\u8A2D\u89D2\u8272 "),c(2),H("ngModel",n.searchQuery),c(4),de(n.selectedCategory()?"bg-slate-800/50 text-slate-400 hover:text-white":"bg-gradient-to-r from-cyan-500 to-blue-500 text-white"),c(6),M("(",n.PRESET_ROLES.length,")"),c(),U(n.categoryList),c(4),U(n.filteredRoles()),c(3),S((o=n.selectedRole())?29:-1,o)}},dependencies:[oe,ae,xe,ve,he],encapsulation:2})}};var u1={new_customer_icebreak:{icon:"\u{1F91D}",name:"\u65B0\u5BA2\u6236\u7834\u51B0",description:"\u81EA\u7136\u4E92\u52D5 \u2192 \u9AD4\u9A57\u5206\u4EAB \u2192 \u5C08\u696D\u4ECB\u7D39",difficulty:"easy",duration:"10-15\u5206\u9418",successRate:"65%"},hesitant_conversion:{icon:"\u{1F4AA}",name:"\u7336\u8C6B\u5BA2\u6236\u4FC3\u55AE",description:"\u9700\u6C42\u78BA\u8A8D \u2192 \u5831\u50F9\u8AC7\u5224 \u2192 \u7279\u6279\u512A\u60E0",difficulty:"medium",duration:"20-30\u5206\u9418",successRate:"45%"},aftersales_handling:{icon:"\u{1F527}",name:"\u552E\u5F8C\u554F\u984C\u8655\u7406",description:"\u554F\u984C\u8A18\u9304 \u2192 \u6280\u8853\u6392\u67E5 \u2192 \u6EFF\u610F\u5EA6\u88DC\u511F",difficulty:"medium",duration:"15-25\u5206\u9418",successRate:"85%"},vip_service:{icon:"\u{1F451}",name:"\u9AD8\u50F9\u503C\u5BA2\u6236\u670D\u52D9",description:"\u5C0A\u8CB4\u63A5\u5F85 \u2192 \u5B9A\u5236\u65B9\u6848 \u2192 \u6230\u7565\u5408\u4F5C",difficulty:"hard",duration:"30-45\u5206\u9418",successRate:"70%"},community_activation:{icon:"\u{1F389}",name:"\u793E\u7FA4\u6D3B\u8E8D\u5F15\u5C0E",description:"\u8A71\u984C\u767C\u8D77 \u2192 \u4E92\u52D5\u8A0E\u8AD6 \u2192 \u50F9\u503C\u7E3D\u7D50",difficulty:"easy",duration:"\u6301\u7E8C\u6027",successRate:"80%"},product_launch:{icon:"\u{1F680}",name:"\u7522\u54C1\u767C\u5E03\u63A8\u5EE3",description:"\u9810\u71B1\u9020\u52E2 \u2192 \u5C08\u696D\u6E2C\u8A55 \u2192 \u6D3B\u52D5\u5F15\u7206",difficulty:"hard",duration:"\u591A\u65E5\u6D3B\u52D5",successRate:"55%"},education_sales:{icon:"\u{1F4DA}",name:"\u6559\u80B2\u8AB2\u7A0B\u92B7\u552E",description:"\u9700\u6C42\u5206\u6790 \u2192 \u8AB2\u7A0B\u4ECB\u7D39 \u2192 \u5B78\u54E1\u898B\u8B49",difficulty:"medium",duration:"20-30\u5206\u9418",successRate:"50%"},b2b_cooperation:{icon:"\u{1F3E2}",name:"B2B\u4F01\u696D\u5408\u4F5C",description:"\u5408\u4F5C\u9080\u7D04 \u2192 \u65B9\u6848\u8A2D\u8A08 \u2192 \u9805\u76EE\u63A8\u9032",difficulty:"hard",duration:"\u591A\u8F2A\u8DDF\u9032",successRate:"35%"},competitor_conversion:{icon:"\u{1F3AF}",name:"\u7AF6\u54C1\u7528\u6236\u8F49\u5316",description:"\u75DB\u9EDE\u5171\u9CF4 \u2192 \u512A\u52E2\u5C0D\u6BD4 \u2192 \u9077\u79FB\u512A\u60E0",difficulty:"hard",duration:"25-40\u5206\u9418",successRate:"40%"},churn_recovery:{icon:"\u{1F49D}",name:"\u6D41\u5931\u5BA2\u6236\u633D\u56DE",description:"\u95DC\u61F7\u56DE\u8A2A \u2192 \u554F\u984C\u89E3\u6C7A \u2192 \u7E8C\u8CBB\u512A\u60E0",difficulty:"medium",duration:"15-25\u5206\u9418",successRate:"30%"}},m1=[{id:"scenario_new_customer_icebreak",type:"new_customer_icebreak",name:"\u65B0\u5BA2\u6236\u7834\u51B0",description:"\u901A\u904E\u71B1\u5FC3\u7FA4\u53CB\u548C\u8001\u7528\u6236\u7684\u771F\u5BE6\u5206\u4EAB\uFF0C\u81EA\u7136\u5730\u4ECB\u7D39\u7522\u54C1\uFF0C\u8B93\u65B0\u5BA2\u6236\u5FEB\u901F\u5EFA\u7ACB\u4FE1\u4EFB",roles:[{roleType:"friendly_member",order:1,isRequired:!0,purpose:"\u6D3B\u8E8D\u6C23\u6C1B\uFF0C\u81EA\u7136\u5F15\u5165\u8A71\u984C"},{roleType:"loyal_customer",order:2,isRequired:!0,purpose:"\u5206\u4EAB\u771F\u5BE6\u4F7F\u7528\u9AD4\u9A57"},{roleType:"sales_manager",order:3,isRequired:!0,purpose:"\u5C08\u696D\u89E3\u7B54\uFF0C\u4FC3\u6210\u610F\u5411"}],stages:[{id:"stage_1",name:"\u8A71\u984C\u5F15\u5165",roleType:"friendly_member",triggerType:"time",delaySeconds:30,messageTemplate:"\u5927\u5BB6\u597D\uFF01\u6700\u8FD1\u6709\u6C92\u6709\u4EC0\u9EBC\u597D\u7528\u7684{\u7522\u54C1\u985E\u578B}\u63A8\u85A6\u554A\uFF1F",successCondition:"\u5BA2\u6236\u53C3\u8207\u8A0E\u8AD6"},{id:"stage_2",name:"\u9AD4\u9A57\u5206\u4EAB",roleType:"loyal_customer",triggerType:"time",delaySeconds:60,messageTemplate:"\u6211\u7528{\u7522\u54C1\u540D}\u534A\u5E74\u591A\u4E86\uFF0C\u611F\u89BA\u9084\u4E0D\u932F\uFF01\u4E00\u958B\u59CB\u4E5F\u662F\u670B\u53CB\u63A8\u85A6\u7684\uFF0C\u6C92\u60F3\u5230\u771F\u7684\u5F88\u597D\u7528~",aiPrompt:"\u4EE5\u8001\u7528\u6236\u8EAB\u4EFD\u5206\u4EAB\u4F7F\u7528\u9AD4\u9A57\uFF0C\u771F\u5BE6\u81EA\u7136\uFF0C\u53EF\u4EE5\u63D0\u5230\u4E00\u4E9B\u5C0F\u7F3A\u9EDE\u4F46\u7E3D\u9AD4\u6EFF\u610F"},{id:"stage_3",name:"\u5C08\u696D\u4ECB\u7D39",roleType:"sales_manager",triggerType:"message",messageTemplate:"\u611F\u8B1D\u5206\u4EAB\uFF01{\u5BA2\u6236\u540D}\u60A8\u597D\uFF0C\u6211\u662F\u7522\u54C1\u9867\u554F\uFF0C\u6709\u4EC0\u9EBC\u5177\u9AD4\u554F\u984C\u53EF\u4EE5\u554F\u6211~",aiPrompt:"\u4EE5\u5C08\u696D\u9867\u554F\u8EAB\u4EFD\u8A73\u7D30\u89E3\u7B54\u554F\u984C\uFF0C\u6CE8\u610F\u50BE\u807D\u5BA2\u6236\u9700\u6C42"}],tips:["\u71B1\u5FC3\u7FA4\u53CB\u5148\u6D3B\u8E8D\u6C23\u6C1B\uFF0C\u4E0D\u8981\u4E00\u958B\u59CB\u5C31\u63A8\u92B7","\u8001\u7528\u6236\u5206\u4EAB\u8981\u771F\u5BE6\u81EA\u7136\uFF0C\u907F\u514D\u904E\u5EA6\u8A87\u5F35","\u92B7\u552E\u51FA\u5834\u6642\u6A5F\u8981\u628A\u63E1\uFF0C\u5728\u5BA2\u6236\u8868\u73FE\u8208\u8DA3\u5F8C"]},{id:"scenario_hesitant_conversion",type:"hesitant_conversion",name:"\u7336\u8C6B\u5BA2\u6236\u4FC3\u55AE",description:"\u901A\u904E\u5C64\u5C64\u905E\u9032\u7684\u7B56\u7565\uFF0C\u5F9E\u9700\u6C42\u78BA\u8A8D\u5230\u50F9\u683C\u8AC7\u5224\uFF0C\u6700\u7D42\u7531\u7E3D\u76E3\u7279\u6279\u512A\u60E0\u4FC3\u6210\u6210\u4EA4",roles:[{roleType:"account_manager",order:1,isRequired:!0,purpose:"\u4E86\u89E3\u9867\u616E\uFF0C\u78BA\u8A8D\u9700\u6C42"},{roleType:"price_specialist",order:2,isRequired:!0,purpose:"\u63D0\u4F9B\u5831\u50F9\uFF0C\u8AC7\u5224\u50F9\u683C"},{roleType:"regional_director",order:3,isRequired:!1,purpose:"\u7279\u6279\u6700\u7D42\u512A\u60E0"}],stages:[{id:"stage_1",name:"\u9700\u6C42\u78BA\u8A8D",roleType:"account_manager",triggerType:"manual",messageTemplate:"{\u5BA2\u6236\u540D}\u60A8\u597D\uFF0C\u6211\u662F\u60A8\u7684\u5C08\u5C6C\u5BA2\u6236\u7D93\u7406\u3002\u4E86\u89E3\u5230\u60A8\u5C0D{\u7522\u54C1}\u6709\u8208\u8DA3\uFF0C\u8ACB\u554F\u4E3B\u8981\u662F\u54EA\u4E9B\u65B9\u9762\u8B93\u60A8\u9084\u5728\u8003\u616E\u5462\uFF1F",aiPrompt:"\u8010\u5FC3\u50BE\u807D\u5BA2\u6236\u9867\u616E\uFF0C\u9010\u4E00\u8A18\u9304\u4E26\u56DE\u61C9",successCondition:"\u5BA2\u6236\u8AAA\u51FA\u5177\u9AD4\u9867\u616E"},{id:"stage_2",name:"\u5831\u50F9\u8AC7\u5224",roleType:"price_specialist",triggerType:"message",delaySeconds:120,messageTemplate:"\u6211\u662F\u50F9\u683C\u5C08\u54E1\uFF0C\u91DD\u5C0D\u60A8\u7684\u9700\u6C42\uFF0C\u6211\u5011\u53EF\u4EE5\u63D0\u4F9B\u4E00\u500B\u7279\u5225\u65B9\u6848...",aiPrompt:"\u6839\u64DA\u5BA2\u6236\u9867\u616E\u9EDE\u8A2D\u8A08\u512A\u60E0\u65B9\u6848\uFF0C\u5F37\u8ABF\u50F9\u503C\u800C\u975E\u50F9\u683C"},{id:"stage_3",name:"\u7E3D\u76E3\u7279\u6279",roleType:"regional_director",triggerType:"manual",messageTemplate:"\u60A8\u597D\uFF0C\u6211\u662F\u5340\u57DF\u7E3D\u76E3\u3002\u4E86\u89E3\u5230\u60A8\u7684\u60C5\u6CC1\uFF0C\u6211\u53EF\u4EE5\u7279\u6279\u4E00\u500B\u984D\u5916\u512A\u60E0...",aiPrompt:"\u4EE5\u9AD8\u5C64\u8EAB\u4EFD\u505A\u6700\u5F8C\u8B93\u6B65\uFF0C\u71DF\u9020\u7A00\u7F3A\u611F"}],tips:["\u5148\u89E3\u6C7A\u50F9\u683C\u4EE5\u5916\u7684\u9867\u616E","\u50F9\u683C\u5C08\u54E1\u7684\u8B93\u6B65\u8981\u6709\u7406\u7531\uFF08\u5982\u9996\u55AE\u3001\u9577\u671F\u5408\u4F5C\u7B49\uFF09","\u7E3D\u76E3\u51FA\u5834\u662F\u6700\u5F8C\u624B\u6BB5\uFF0C\u8981\u71DF\u9020\u7A00\u7F3A\u611F"]},{id:"scenario_aftersales_handling",type:"aftersales_handling",name:"\u552E\u5F8C\u554F\u984C\u8655\u7406",description:"\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C\uFF0C\u5F9E\u554F\u984C\u8A18\u9304\u5230\u6280\u8853\u6392\u67E5\uFF0C\u78BA\u4FDD\u5BA2\u6236\u6EFF\u610F",roles:[{roleType:"cs_agent",order:1,isRequired:!0,purpose:"\u8A18\u9304\u554F\u984C\uFF0C\u521D\u6B65\u5B89\u64AB"},{roleType:"tech_support",order:2,isRequired:!0,purpose:"\u6280\u8853\u6392\u67E5\uFF0C\u89E3\u6C7A\u554F\u984C"},{roleType:"complaint_handler",order:3,isRequired:!1,purpose:"\u8655\u7406\u6295\u8A34\uFF0C\u6EFF\u610F\u5EA6\u88DC\u511F"}],stages:[{id:"stage_1",name:"\u554F\u984C\u8A18\u9304",roleType:"cs_agent",triggerType:"message",messageTemplate:"\u60A8\u597D\uFF0C\u975E\u5E38\u62B1\u6B49\u7D66\u60A8\u5E36\u4F86\u4E0D\u4FBF\uFF01\u8ACB\u60A8\u8A73\u7D30\u63CF\u8FF0\u4E00\u4E0B\u9047\u5230\u7684\u554F\u984C\uFF0C\u6211\u99AC\u4E0A\u70BA\u60A8\u8655\u7406\u3002",aiPrompt:"\u8868\u9054\u6B49\u610F\u548C\u91CD\u8996\uFF0C\u8A73\u7D30\u8A18\u9304\u554F\u984C\u7D30\u7BC0",successCondition:"\u7372\u53D6\u554F\u984C\u8A73\u60C5"},{id:"stage_2",name:"\u6280\u8853\u6392\u67E5",roleType:"tech_support",triggerType:"time",delaySeconds:60,messageTemplate:"\u60A8\u597D\uFF0C\u6211\u662F\u6280\u8853\u652F\u6301\u3002\u6839\u64DA\u60A8\u63CF\u8FF0\u7684\u554F\u984C\uFF0C\u8ACB\u60A8\u5617\u8A66\u4EE5\u4E0B\u6B65\u9A5F...",aiPrompt:"\u63D0\u4F9B\u5C08\u696D\u7684\u6280\u8853\u89E3\u6C7A\u65B9\u6848\uFF0C\u6B65\u9A5F\u6E05\u6670"},{id:"stage_3",name:"\u6EFF\u610F\u5EA6\u78BA\u8A8D",roleType:"complaint_handler",triggerType:"time",delaySeconds:300,messageTemplate:"\u554F\u984C\u89E3\u6C7A\u4E86\u55CE\uFF1F\u70BA\u8868\u6B49\u610F\uFF0C\u6211\u5011\u70BA\u60A8\u7533\u8ACB\u4E86\u4E00\u4EFD\u5C0F\u79AE\u54C1...",aiPrompt:"\u78BA\u8A8D\u554F\u984C\u89E3\u6C7A\uFF0C\u63D0\u4F9B\u9069\u7576\u88DC\u511F"}],tips:["\u7B2C\u4E00\u6642\u9593\u8868\u9054\u6B49\u610F\u548C\u91CD\u8996","\u6280\u8853\u89E3\u6C7A\u65B9\u6848\u8981\u6E05\u6670\u6613\u61C2","\u554F\u984C\u89E3\u6C7A\u5F8C\u8981\u8DDF\u9032\u6EFF\u610F\u5EA6"]},{id:"scenario_vip_service",type:"vip_service",name:"\u9AD8\u50F9\u503C\u5BA2\u6236\u670D\u52D9",description:"\u70BA\u9AD8\u50F9\u503C\u5BA2\u6236\u63D0\u4F9B\u5C0A\u8CB4\u9AD4\u9A57\uFF0C\u5F9EVIP\u63A5\u5F85\u5230\u5B9A\u5236\u65B9\u6848\uFF0C\u53EF\u5347\u7D1A\u5230\u5275\u59CB\u4EBA\u89AA\u81EA\u5C0D\u63A5",roles:[{roleType:"vip_service",order:1,isRequired:!0,purpose:"VIP\u5C08\u5C6C\u63A5\u5F85"},{roleType:"solution_expert",order:2,isRequired:!0,purpose:"\u8A2D\u8A08\u5B9A\u5236\u65B9\u6848"},{roleType:"founder_ceo",order:3,isRequired:!1,purpose:"\u6230\u7565\u7D1A\u5408\u4F5C"}],stages:[{id:"stage_1",name:"\u5C0A\u8CB4\u63A5\u5F85",roleType:"vip_service",triggerType:"manual",messageTemplate:"{\u5BA2\u6236\u540D}\u5148\u751F/\u5973\u58EB\u60A8\u597D\uFF01\u6211\u662F\u60A8\u7684VIP\u5C08\u5C6C\u5BA2\u670D\uFF0C\u611F\u8B1D\u60A8\u4E00\u76F4\u4EE5\u4F86\u7684\u652F\u6301\u3002\u6709\u4EFB\u4F55\u9700\u6C42\u96A8\u6642\u544A\u8A34\u6211~",aiPrompt:"\u71DF\u9020\u5C0A\u8CB4\u611F\uFF0C\u8B93\u5BA2\u6236\u611F\u53D7\u88AB\u91CD\u8996"},{id:"stage_2",name:"\u5B9A\u5236\u65B9\u6848",roleType:"solution_expert",triggerType:"message",delaySeconds:120,messageTemplate:"\u6839\u64DA\u60A8\u7684\u696D\u52D9\u898F\u6A21\u548C\u9700\u6C42\uFF0C\u6211\u5011\u70BA\u60A8\u8A2D\u8A08\u4E86\u5C08\u5C6C\u65B9\u6848...",aiPrompt:"\u63D0\u4F9B\u771F\u6B63\u5B9A\u5236\u5316\u7684\u65B9\u6848\uFF0C\u9AD4\u73FE\u5C08\u696D\u6027"},{id:"stage_3",name:"\u6230\u7565\u5408\u4F5C",roleType:"founder_ceo",triggerType:"manual",messageTemplate:"\u60A8\u597D\uFF0C\u6211\u662F{\u516C\u53F8}\u5275\u59CB\u4EBA\u3002\u60A8\u662F\u6211\u5011\u975E\u5E38\u91CD\u8996\u7684\u5408\u4F5C\u5925\u4F34\uFF0C\u6211\u89AA\u81EA\u4F86\u548C\u60A8\u8AC7\u9019\u6B21\u5408\u4F5C...",aiPrompt:"\u4EE5\u5275\u59CB\u4EBA\u8EAB\u4EFD\u5EFA\u7ACB\u6DF1\u5EA6\u9023\u63A5"}],tips:["VIP\u670D\u52D9\u8981\u9AD4\u73FE\u5DEE\u7570\u5316\u548C\u5C0A\u8CB4\u611F","\u65B9\u6848\u8981\u771F\u6B63\u5B9A\u5236\uFF0C\u4E0D\u80FD\u662F\u6A21\u677F\u5957\u7528","\u5275\u59CB\u4EBA\u51FA\u5834\u8981\u6709\u7279\u6B8A\u7406\u7531"]},{id:"scenario_community_activation",type:"community_activation",name:"\u793E\u7FA4\u6D3B\u8E8D\u5F15\u5C0E",description:"\u901A\u904E\u591A\u89D2\u8272\u914D\u5408\uFF0C\u6301\u7E8C\u4FDD\u6301\u793E\u7FA4\u6D3B\u8E8D\u5EA6\uFF0C\u5F15\u5C0E\u6709\u50F9\u503C\u7684\u8A0E\u8AD6",roles:[{roleType:"community_manager",order:1,isRequired:!0,purpose:"\u767C\u8D77\u8A71\u984C\uFF0C\u7DAD\u8B77\u79E9\u5E8F"},{roleType:"friendly_member",order:2,isRequired:!0,purpose:"\u6D3B\u8E8D\u6C23\u6C1B\uFF0C\u7A4D\u6975\u4E92\u52D5"},{roleType:"friendly_member",order:3,isRequired:!1,purpose:"\u6301\u7E8C\u4E92\u52D5"},{roleType:"opinion_leader",order:4,isRequired:!1,purpose:"\u50F9\u503C\u7E3D\u7D50\uFF0C\u89C0\u9EDE\u8F38\u51FA"}],stages:[{id:"stage_1",name:"\u8A71\u984C\u767C\u8D77",roleType:"community_manager",triggerType:"time",messageTemplate:"\u65E9\u5B89\u5404\u4F4D\uFF01\u4ECA\u5929\u4F86\u804A\u804A{\u8A71\u984C}\uFF0C\u5927\u5BB6\u6709\u4EC0\u9EBC\u7D93\u9A57\u5206\u4EAB\u55CE\uFF1F",aiPrompt:"\u767C\u8D77\u6709\u8A0E\u8AD6\u50F9\u503C\u7684\u8A71\u984C"},{id:"stage_2",name:"\u7A4D\u6975\u97FF\u61C9",roleType:"friendly_member",triggerType:"time",delaySeconds:60,messageTemplate:"\u9019\u500B\u8A71\u984C\u597D\uFF01\u6211\u4F86\u8AAA\u8AAA\u6211\u7684\u7D93\u9A57...",aiPrompt:"\u7A4D\u6975\u97FF\u61C9\uFF0C\u5206\u4EAB\u500B\u4EBA\u7D93\u9A57"},{id:"stage_3",name:"\u6301\u7E8C\u4E92\u52D5",roleType:"friendly_member",triggerType:"time",delaySeconds:120,messageTemplate:"\u6A13\u4E0A\u8AAA\u5F97\u5C0D\uFF01\u6211\u88DC\u5145\u4E00\u9EDE...",aiPrompt:"\u8A8D\u540C\u4E26\u88DC\u5145\uFF0C\u5F15\u767C\u66F4\u591A\u8A0E\u8AD6"},{id:"stage_4",name:"\u50F9\u503C\u7E3D\u7D50",roleType:"opinion_leader",triggerType:"time",delaySeconds:300,messageTemplate:"\u770B\u4E86\u5927\u5BB6\u7684\u8A0E\u8AD6\uFF0C\u6211\u7E3D\u7D50\u4E00\u4E0B\u91CD\u9EDE...",aiPrompt:"\u7E3D\u7D50\u8A0E\u8AD6\u50F9\u503C\uFF0C\u7D66\u51FA\u5C08\u696D\u89C0\u9EDE"}],tips:["\u8A71\u984C\u8981\u6709\u8A0E\u8AD6\u50F9\u503C\uFF0C\u907F\u514D\u904E\u65BC\u71DF\u92B7","\u591A\u500B\u7FA4\u53CB\u914D\u5408\u8981\u81EA\u7136\uFF0C\u907F\u514D\u5237\u5C4F","\u5B9A\u671F\u8B8A\u63DB\u8A71\u984C\u548C\u4E92\u52D5\u5F62\u5F0F"]},{id:"scenario_product_launch",type:"product_launch",name:"\u7522\u54C1\u767C\u5E03\u63A8\u5EE3",description:"\u65B0\u7522\u54C1\u767C\u5E03\u7684\u5B8C\u6574\u63A8\u5EE3\u6D41\u7A0B\uFF0C\u5F9E\u9810\u71B1\u5230\u5F15\u7206",roles:[{roleType:"brand_ambassador",order:1,isRequired:!0,purpose:"\u9810\u71B1\u9020\u52E2"},{roleType:"tech_blogger",order:2,isRequired:!0,purpose:"\u5C08\u696D\u6E2C\u8A55"},{roleType:"event_operator",order:3,isRequired:!0,purpose:"\u6D3B\u52D5\u5F15\u7206"}],stages:[{id:"stage_1",name:"\u9810\u71B1\u9020\u52E2",roleType:"brand_ambassador",triggerType:"time",messageTemplate:"\u6709\u500B\u5927\u6D88\u606F\u8981\u544A\u8A34\u5927\u5BB6\uFF01{\u7522\u54C1\u540D}\u5373\u5C07\u767C\u5E03\uFF0C\u64DA\u8AAA\u6709\u5F88\u591A\u9A5A\u559C...",aiPrompt:"\u88FD\u9020\u61F8\u5FF5\u548C\u671F\u5F85\u611F"},{id:"stage_2",name:"\u5C08\u696D\u6E2C\u8A55",roleType:"tech_blogger",triggerType:"time",delaySeconds:86400,messageTemplate:"\u6211\u63D0\u524D\u62FF\u5230\u4E86{\u7522\u54C1\u540D}\u7684\u6E2C\u8A66\u7248\uFF0C\u4F86\u8DDF\u5927\u5BB6\u5206\u4EAB\u4E00\u4E0B...",aiPrompt:"\u5C08\u696D\u5BA2\u89C0\u7684\u6E2C\u8A55\uFF0C\u7A81\u51FA\u4EAE\u9EDE"},{id:"stage_3",name:"\u6D3B\u52D5\u5F15\u7206",roleType:"event_operator",triggerType:"time",delaySeconds:172800,messageTemplate:"\u{1F389} {\u7522\u54C1\u540D}\u6B63\u5F0F\u767C\u5E03\uFF01\u9650\u6642\u512A\u60E0\u4F86\u4E86\uFF01",aiPrompt:"\u71DF\u9020\u6436\u8CFC\u6C1B\u570D\uFF0C\u5F15\u5C0E\u4E0B\u55AE"}],tips:["\u9810\u71B1\u671F\u8981\u4FDD\u6301\u795E\u79D8\u611F","\u6E2C\u8A55\u8981\u5C08\u696D\u53EF\u4FE1","\u767C\u5E03\u6D3B\u52D5\u8981\u6709\u7DCA\u8FEB\u611F"]},{id:"scenario_education_sales",type:"education_sales",name:"\u6559\u80B2\u8AB2\u7A0B\u92B7\u552E",description:"\u901A\u904E\u9700\u6C42\u5206\u6790\u548C\u5B78\u54E1\u898B\u8B49\uFF0C\u4FC3\u9032\u8AB2\u7A0B\u5831\u540D",roles:[{roleType:"education_consultant",order:1,isRequired:!0,purpose:"\u9700\u6C42\u5206\u6790\uFF0C\u8AB2\u7A0B\u63A8\u85A6"},{roleType:"trainer",order:2,isRequired:!1,purpose:"\u8AB2\u7A0B\u4ECB\u7D39\uFF0C\u5C08\u696D\u80CC\u66F8"},{roleType:"loyal_customer",order:3,isRequired:!0,purpose:"\u5B78\u54E1\u898B\u8B49"}],stages:[{id:"stage_1",name:"\u9700\u6C42\u5206\u6790",roleType:"education_consultant",triggerType:"message",messageTemplate:"\u60A8\u597D\uFF01\u8ACB\u554F\u60A8\u60F3\u5B78\u7FD2\u7684\u4E3B\u8981\u76EE\u6A19\u662F\u4EC0\u9EBC\uFF1F\u6211\u4F86\u5E6B\u60A8\u898F\u5283\u5B78\u7FD2\u8DEF\u5F91~",aiPrompt:"\u4E86\u89E3\u5B78\u7FD2\u76EE\u6A19\u548C\u73FE\u72C0\uFF0C\u63A8\u85A6\u5408\u9069\u8AB2\u7A0B"},{id:"stage_2",name:"\u8AB2\u7A0B\u4ECB\u7D39",roleType:"trainer",triggerType:"time",delaySeconds:120,messageTemplate:"\u6211\u662F\u9019\u9580\u8AB2\u7684\u8B1B\u5E2B\uFF0C\u4F86\u7D66\u5927\u5BB6\u4ECB\u7D39\u4E00\u4E0B\u8AB2\u7A0B\u5167\u5BB9...",aiPrompt:"\u5C08\u696D\u4ECB\u7D39\u8AB2\u7A0B\u4EAE\u9EDE\u548C\u5B78\u7FD2\u6536\u76CA"},{id:"stage_3",name:"\u5B78\u54E1\u898B\u8B49",roleType:"loyal_customer",triggerType:"time",delaySeconds:180,messageTemplate:"\u6211\u662F\u4E4B\u524D\u5B78\u904E\u9019\u9580\u8AB2\u7684\u5B78\u54E1\uFF0C\u5206\u4EAB\u4E00\u4E0B\u6211\u7684\u5B78\u7FD2\u7D93\u6B77...",aiPrompt:"\u771F\u5BE6\u5206\u4EAB\u5B78\u7FD2\u7D93\u6B77\u548C\u6536\u7A6B"}],tips:["\u5148\u4E86\u89E3\u9700\u6C42\u518D\u63A8\u8AB2\u7A0B","\u8B1B\u5E2B\u80CC\u66F8\u589E\u52A0\u53EF\u4FE1\u5EA6","\u5B78\u54E1\u898B\u8B49\u8981\u771F\u5BE6\u5177\u9AD4"]},{id:"scenario_b2b_cooperation",type:"b2b_cooperation",name:"B2B\u4F01\u696D\u5408\u4F5C",description:"\u5C08\u696D\u7684B2B\u5546\u52D9\u5408\u4F5C\u6D41\u7A0B",roles:[{roleType:"business_manager",order:1,isRequired:!0,purpose:"\u5408\u4F5C\u9080\u7D04"},{roleType:"solution_architect",order:2,isRequired:!0,purpose:"\u65B9\u6848\u8A2D\u8A08"},{roleType:"project_manager",order:3,isRequired:!1,purpose:"\u9805\u76EE\u63A8\u9032"}],stages:[{id:"stage_1",name:"\u5408\u4F5C\u9080\u7D04",roleType:"business_manager",triggerType:"manual",messageTemplate:"\u60A8\u597D\uFF0C\u6211\u662F{\u516C\u53F8}\u62DB\u5546\u7D93\u7406\u3002\u4E86\u89E3\u5230\u8CB4\u516C\u53F8\u5728{\u9818\u57DF}\u6709\u5F88\u597D\u7684\u8CC7\u6E90\uFF0C\u60F3\u63A2\u8A0E\u4E00\u4E0B\u5408\u4F5C\u6A5F\u6703...",aiPrompt:"\u5C08\u696D\u7684\u5546\u52D9\u9080\u7D04\uFF0C\u8868\u9054\u5408\u4F5C\u8AA0\u610F"},{id:"stage_2",name:"\u65B9\u6848\u8A2D\u8A08",roleType:"solution_architect",triggerType:"message",messageTemplate:"\u6839\u64DA\u8CB4\u516C\u53F8\u7684\u60C5\u6CC1\uFF0C\u6211\u5011\u8A2D\u8A08\u4E86\u9019\u6A23\u7684\u5408\u4F5C\u65B9\u6848...",aiPrompt:"\u8A2D\u8A08\u4E92\u5229\u5171\u8D0F\u7684\u5408\u4F5C\u65B9\u6848"},{id:"stage_3",name:"\u9805\u76EE\u63A8\u9032",roleType:"project_manager",triggerType:"message",messageTemplate:"\u5408\u4F5C\u65B9\u6848\u78BA\u8A8D\u5F8C\uFF0C\u6211\u6703\u8CA0\u8CAC\u9805\u76EE\u7684\u63A8\u9032\u548C\u843D\u5730...",aiPrompt:"\u660E\u78BA\u9805\u76EE\u8A08\u5283\u548C\u8CAC\u4EFB\u5206\u5DE5"}],tips:["B2B\u5408\u4F5C\u8981\u5C08\u696D\u6B63\u5F0F","\u65B9\u6848\u8981\u9AD4\u73FE\u4E92\u5229\u5171\u8D0F","\u9805\u76EE\u63A8\u9032\u8981\u6709\u660E\u78BA\u8A08\u5283"]},{id:"scenario_competitor_conversion",type:"competitor_conversion",name:"\u7AF6\u54C1\u7528\u6236\u8F49\u5316",description:"\u901A\u904E\u75DB\u9EDE\u5171\u9CF4\u548C\u512A\u52E2\u5C0D\u6BD4\uFF0C\u5438\u5F15\u7AF6\u54C1\u7528\u6236\u8F49\u5316",roles:[{roleType:"competitor_analyst",order:1,isRequired:!0,purpose:"\u75DB\u9EDE\u5171\u9CF4\uFF0C\u512A\u52E2\u5C0D\u6BD4"},{roleType:"product_engineer",order:2,isRequired:!1,purpose:"\u6280\u8853\u512A\u52E2\u8B1B\u89E3"},{roleType:"sales_manager",order:3,isRequired:!0,purpose:"\u9077\u79FB\u512A\u60E0"}],stages:[{id:"stage_1",name:"\u75DB\u9EDE\u5171\u9CF4",roleType:"competitor_analyst",triggerType:"message",messageTemplate:"\u4E86\u89E3\u5230\u60A8\u4E4B\u524D\u7528\u904E{\u7AF6\u54C1}\uFF0C\u662F\u9047\u5230\u4E86\u4EC0\u9EBC\u554F\u984C\u55CE\uFF1F",aiPrompt:"\u4E86\u89E3\u7AF6\u54C1\u4F7F\u7528\u75DB\u9EDE\uFF0C\u8868\u9054\u7406\u89E3"},{id:"stage_2",name:"\u512A\u52E2\u5C0D\u6BD4",roleType:"product_engineer",triggerType:"time",delaySeconds:120,messageTemplate:"\u5F9E\u6280\u8853\u89D2\u5EA6\u4F86\u8AAA\uFF0C\u6211\u5011\u7684\u7522\u54C1\u5728\u9019\u4E9B\u65B9\u9762\u6709\u512A\u52E2...",aiPrompt:"\u5BA2\u89C0\u5C0D\u6BD4\u6280\u8853\u512A\u52E2\uFF0C\u4E0D\u8CB6\u4F4E\u7AF6\u54C1"},{id:"stage_3",name:"\u9077\u79FB\u512A\u60E0",roleType:"sales_manager",triggerType:"message",messageTemplate:"\u70BA\u4E86\u5E6B\u52A9\u60A8\u9806\u5229\u9077\u79FB\uFF0C\u6211\u5011\u63D0\u4F9B\u5C08\u5C6C\u512A\u60E0\u548C\u9077\u79FB\u652F\u6301...",aiPrompt:"\u63D0\u4F9B\u9077\u79FB\u6FC0\u52F5\uFF0C\u964D\u4F4E\u9077\u79FB\u6210\u672C"}],tips:["\u4E0D\u8981\u8CB6\u4F4E\u7AF6\u54C1\uFF0C\u5BA2\u89C0\u5C0D\u6BD4","\u91CD\u9EDE\u89E3\u6C7A\u7AF6\u54C1\u7684\u75DB\u9EDE","\u63D0\u4F9B\u9077\u79FB\u652F\u6301\u964D\u4F4E\u9580\u6ABB"]},{id:"scenario_churn_recovery",type:"churn_recovery",name:"\u6D41\u5931\u5BA2\u6236\u633D\u56DE",description:"\u901A\u904E\u95DC\u61F7\u56DE\u8A2A\u548C\u554F\u984C\u89E3\u6C7A\uFF0C\u633D\u56DE\u6D41\u5931\u5BA2\u6236",roles:[{roleType:"callback_agent",order:1,isRequired:!0,purpose:"\u95DC\u61F7\u56DE\u8A2A"},{roleType:"customer_success",order:2,isRequired:!0,purpose:"\u554F\u984C\u89E3\u6C7A"},{roleType:"regional_director",order:3,isRequired:!1,purpose:"\u7279\u5225\u633D\u7559"}],stages:[{id:"stage_1",name:"\u95DC\u61F7\u56DE\u8A2A",roleType:"callback_agent",triggerType:"manual",messageTemplate:"{\u5BA2\u6236\u540D}\u60A8\u597D\uFF01\u597D\u4E45\u6C92\u806F\u7E6B\u4E86\uFF0C\u60F3\u95DC\u5FC3\u4E00\u4E0B\u60A8\u6700\u8FD1\u7684\u60C5\u6CC1...",aiPrompt:"\u771F\u8AA0\u95DC\u61F7\uFF0C\u4E86\u89E3\u96E2\u958B\u539F\u56E0"},{id:"stage_2",name:"\u554F\u984C\u89E3\u6C7A",roleType:"customer_success",triggerType:"message",messageTemplate:"\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF01\u91DD\u5C0D\u60A8\u63D0\u5230\u7684\u554F\u984C\uFF0C\u6211\u5011\u5DF2\u7D93...",aiPrompt:"\u91DD\u5C0D\u6027\u89E3\u6C7A\u554F\u984C\uFF0C\u5C55\u793A\u6539\u9032"},{id:"stage_3",name:"\u7279\u5225\u633D\u7559",roleType:"regional_director",triggerType:"manual",messageTemplate:"\u4F5C\u70BA\u5340\u57DF\u7E3D\u76E3\uFF0C\u6211\u975E\u5E38\u91CD\u8996\u60A8\u7684\u53CD\u994B\u3002\u70BA\u8868\u8AA0\u610F\uFF0C\u6211\u5011\u6E96\u5099\u4E86...",aiPrompt:"\u9AD8\u5C64\u51FA\u9762\uFF0C\u63D0\u4F9B\u7279\u5225\u512A\u60E0"}],tips:["\u5148\u95DC\u5FC3\u518D\u8AC7\u56DE\u4F86","\u8A8D\u771F\u5C0D\u5F85\u96E2\u958B\u539F\u56E0","\u63D0\u4F9B\u6709\u8AA0\u610F\u7684\u633D\u7559\u65B9\u6848"]}];var p1=(i,e)=>e.id;function tN(i,e){if(i&1&&(T(0,"div",13),l(1),k()),i&2){let t=e.$implicit,n=m(2);Ke("title",n.getRoleLabel(t.roleType)),c(),M(" ",n.getRoleEmoji(t.roleType)," ")}}function nN(i,e){if(i&1&&(T(0,"div",14),l(1),k()),i&2){let t=m().$implicit;c(),M(" +",t.roles.length-3," ")}}function iN(i,e){if(i&1){let t=I();T(0,"div",4),se("click",function(){let o=_(t).$implicit,a=m();return v(a.selectScenario(o))}),T(1,"div",5)(2,"div",6),l(3),k(),T(4,"div")(5,"h3",7),l(6),k(),T(7,"div",8)(8,"span"),l(9),k(),T(10,"span",9),l(11,"\xB7"),k(),T(12,"span",10),l(13),k()()()(),T(14,"p",11),l(15),k(),T(16,"div",12),O(17,tN,2,2,"div",13,ct),y(19,nN,2,1,"div",14),k(),T(20,"div",15)(21,"span",9),l(22,"\u6210\u529F\u7387"),k(),T(23,"span",16),l(24),k()()()}if(i&2){let t,n,o=e.$implicit,a=m();N("ring-2",((t=a.selectedScenario())==null?null:t.id)===o.id)("ring-cyan-500",((n=a.selectedScenario())==null?null:n.id)===o.id),c(3),M(" ",a.getScenarioMeta(o.type).icon," "),c(3),M(" ",o.name," "),c(2),de(a.getDifficultyColor(a.getScenarioMeta(o.type).difficulty)),c(),M(" ",a.getDifficultyLabel(a.getScenarioMeta(o.type).difficulty)," "),c(4),D(a.getScenarioMeta(o.type).duration),c(2),M(" ",a.getScenarioMeta(o.type).description," "),c(2),U(o.roles.slice(0,3)),c(2),S(o.roles.length>3?19:-1),c(5),D(a.getScenarioMeta(o.type).successRate)}}function oN(i,e){i&1&&(T(0,"span",45),l(1,"\u5FC5\u9700"),k())}function rN(i,e){if(i&1&&(T(0,"div",30)(1,"div",42)(2,"span",43),l(3),k(),T(4,"span",44),l(5),k(),y(6,oN,2,0,"span",45),k(),T(7,"p",46),l(8),k()()),i&2){let t=e.$implicit,n=m(2);c(3),D(n.getRoleEmoji(t.roleType)),c(2),D(n.getRoleLabel(t.roleType)),c(),S(t.isRequired?6:-1),c(2),D(t.purpose)}}function sN(i,e){if(i&1&&(T(0,"span",51),l(1),k()),i&2){let t=m().$implicit,n=m(2);c(),D(n.formatDelay(t.delaySeconds))}}function aN(i,e){if(i&1&&(T(0,"p",53),l(1),k()),i&2){let t=m().$implicit;c(),M("\u2713 ",t.successCondition)}}function lN(i,e){if(i&1&&(T(0,"div",34)(1,"div",47),l(2),k(),T(3,"div",48)(4,"div",49)(5,"h4",50),l(6),k(),T(7,"div",8)(8,"span",10),l(9),k(),y(10,sN,2,1,"span",51),k()(),T(11,"p",52),l(12),k(),y(13,aN,2,1,"p",53),k()()),i&2){let t=e.$implicit,n=e.$index,o=m(2);c(2),M(" ",n+1," "),c(4),D(t.name),c(3),X("",o.getRoleEmoji(t.roleType)," ",o.getRoleLabel(t.roleType)),c(),S(t.delaySeconds?10:-1),c(2),M('"',t.messageTemplate,'"'),c(),S(t.successCondition?13:-1)}}function cN(i,e){if(i&1&&(T(0,"div",36)(1,"span",54),l(2,"\u2022"),k(),T(3,"span"),l(4),k()()),i&2){let t=e.$implicit;c(4),D(t)}}function dN(i,e){if(i&1){let t=I();T(0,"div",17),se("click",function(){_(t);let o=m();return v(o.selectedScenario.set(null))}),T(1,"div",18),se("click",function(o){return _(t),v(o.stopPropagation())}),T(2,"div",19)(3,"div",20)(4,"div",21)(5,"div",22),l(6),k(),T(7,"div")(8,"h2",23),l(9),k(),T(10,"p",10),l(11),k()()(),T(12,"button",24),se("click",function(){_(t);let o=m();return v(o.selectedScenario.set(null))}),ne(),T(13,"svg",25),Se(14,"path",26),k()()()(),ce(),T(15,"div",27)(16,"div")(17,"h3",28)(18,"span"),l(19,"\u{1F465}"),k(),l(20," \u53C3\u8207\u89D2\u8272 "),k(),T(21,"div",29),O(22,rN,9,4,"div",30,ct),k()(),T(24,"div")(25,"h3",28)(26,"span"),l(27,"\u{1F4CB}"),k(),l(28," \u6D41\u7A0B\u968E\u6BB5 "),k(),T(29,"div",31),Se(30,"div",32),T(31,"div",33),O(32,lN,14,7,"div",34,p1),k()()(),T(34,"div")(35,"h3",28)(36,"span"),l(37,"\u{1F4A1}"),k(),l(38," \u4F7F\u7528\u63D0\u793A "),k(),T(39,"div",35),O(40,cN,5,1,"div",36,be),k()()(),T(42,"div",37)(43,"button",38),se("click",function(){_(t);let o=m();return v(o.selectedScenario.set(null))}),l(44," \u53D6\u6D88 "),k(),T(45,"button",39),se("click",function(){let o=_(t),a=m();return v(a.applyScenario(o))}),ne(),T(46,"svg",40),Se(47,"path",41),k(),l(48," \u61C9\u7528\u6B64\u5834\u666F "),k()()()()}if(i&2){let t=e,n=m();c(6),M(" ",n.getScenarioMeta(t.type).icon," "),c(3),D(t.name),c(2),D(t.description),c(11),U(t.roles),c(10),U(t.stages),c(8),U(t.tips)}}var Oc=class i{constructor(){this.scenarioApplied=ge();this.PRESET_SCENARIOS=m1;this.selectedScenario=f(null)}selectScenario(e){this.selectedScenario.set(e)}applyScenario(e){this.scenarioApplied.emit(e),this.selectedScenario.set(null)}getScenarioMeta(e){return u1[e]}getDifficultyColor(e){return{easy:"text-green-400",medium:"text-yellow-400",hard:"text-red-400"}[e]||"text-slate-400"}getDifficultyLabel(e){return{easy:"\u7C21\u55AE",medium:"\u4E2D\u7B49",hard:"\u56F0\u96E3"}[e]||e}getRoleEmoji(e){return{friendly_member:"\u{1F604}",loyal_customer:"\u2764\uFE0F",sales_manager:"\u{1F454}",account_manager:"\u{1F4BC}",price_specialist:"\u{1F4B0}",regional_director:"\u{1F451}",cs_agent:"\u{1F3A7}",tech_support:"\u{1F527}",complaint_handler:"\u{1F60A}",vip_service:"\u2B50",solution_expert:"\u{1F4CA}",founder_ceo:"\u{1F454}",community_manager:"\u{1F3E0}",opinion_leader:"\u{1F3A4}",brand_ambassador:"\u{1F3C6}",tech_blogger:"\u{1F4F1}",event_operator:"\u{1F389}",education_consultant:"\u{1F4DA}",trainer:"\u{1F468}\u200D\u{1F3EB}",business_manager:"\u{1F91D}",solution_architect:"\u{1F3D7}\uFE0F",project_manager:"\u{1F4CB}",competitor_analyst:"\u{1F50D}",product_engineer:"\u2699\uFE0F",callback_agent:"\u{1F4DE}",customer_success:"\u{1F3AF}"}[e]||"\u{1F3AD}"}getRoleLabel(e){return{friendly_member:"\u71B1\u5FC3\u7FA4\u53CB",loyal_customer:"\u8001\u7528\u6236",sales_manager:"\u92B7\u552E\u7D93\u7406",account_manager:"\u5BA2\u6236\u7D93\u7406",price_specialist:"\u50F9\u683C\u5C08\u54E1",regional_director:"\u5340\u57DF\u7E3D\u76E3",cs_agent:"\u5BA2\u670D\u5C08\u54E1",tech_support:"\u6280\u8853\u652F\u6301",complaint_handler:"\u6295\u8A34\u8655\u7406\u5C08\u54E1",vip_service:"VIP\u5BA2\u670D",solution_expert:"\u65B9\u6848\u5C08\u5BB6",founder_ceo:"\u5275\u59CB\u4EBA",community_manager:"\u793E\u7FA4\u7BA1\u5BB6",opinion_leader:"\u610F\u898B\u9818\u8896",brand_ambassador:"\u54C1\u724C\u5927\u4F7F",tech_blogger:"\u79D1\u6280\u535A\u4E3B",event_operator:"\u6D3B\u52D5\u904B\u71DF",education_consultant:"\u6559\u80B2\u8AEE\u8A62\u5E2B",trainer:"\u57F9\u8A13\u8B1B\u5E2B",business_manager:"\u62DB\u5546\u7D93\u7406",solution_architect:"\u89E3\u6C7A\u65B9\u6848\u67B6\u69CB\u5E2B",project_manager:"\u9805\u76EE\u7D93\u7406",competitor_analyst:"\u7AF6\u54C1\u5206\u6790\u5E2B",product_engineer:"\u7522\u54C1\u5DE5\u7A0B\u5E2B",callback_agent:"\u56DE\u8A2A\u5C08\u54E1",customer_success:"\u5BA2\u6236\u6210\u529F\u7D93\u7406"}[e]||e}formatDelay(e){return e<60?`${e}\u79D2\u5F8C`:e<3600?`${Math.floor(e/60)}\u5206\u9418\u5F8C`:e<86400?`${Math.floor(e/3600)}\u5C0F\u6642\u5F8C`:`${Math.floor(e/86400)}\u5929\u5F8C`}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-scenario-selector"]],outputs:{scenarioApplied:"scenarioApplied"},decls:5,vars:1,consts:[[1,"scenario-selector"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-5","gap-4","p-4"],[1,"bg-slate-800/50","border","border-slate-700/50","rounded-xl","p-4","cursor-pointer","hover:border-cyan-500/50","hover:bg-slate-800","transition-all","group",3,"ring-2","ring-cyan-500"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"bg-slate-800/50","border","border-slate-700/50","rounded-xl","p-4","cursor-pointer","hover:border-cyan-500/50","hover:bg-slate-800","transition-all","group",3,"click"],[1,"flex","items-center","gap-3","mb-3"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-cyan-500/20","to-blue-500/20","flex","items-center","justify-center","text-2xl"],[1,"font-semibold","text-white","group-hover:text-cyan-400","transition-colors"],[1,"flex","items-center","gap-2","text-xs"],[1,"text-slate-500"],[1,"text-slate-400"],[1,"text-sm","text-slate-400","mb-3","line-clamp-2"],[1,"flex","items-center","gap-1","mb-3"],[1,"w-7","h-7","rounded-full","bg-slate-700/50","flex","items-center","justify-center","text-sm",3,"title"],[1,"w-7","h-7","rounded-full","bg-slate-700/50","flex","items-center","justify-center","text-xs","text-slate-400"],[1,"flex","items-center","justify-between","text-xs"],[1,"text-cyan-400","font-medium"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","border","border-slate-700/50","rounded-2xl","shadow-2xl","w-full","max-w-3xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"p-6","border-b","border-slate-700/50","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"w-16","h-16","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-3xl"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","hover:text-white","p-2","hover:bg-slate-800","rounded-lg",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[60vh]","space-y-6"],[1,"text-sm","font-medium","text-slate-400","mb-3","flex","items-center","gap-2"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"bg-slate-800/50","rounded-lg","p-3"],[1,"relative"],[1,"absolute","left-6","top-8","bottom-8","w-0.5","bg-slate-700"],[1,"space-y-4"],[1,"relative","flex","gap-4"],[1,"space-y-2"],[1,"flex","items-start","gap-2","text-sm","text-slate-300"],[1,"p-6","border-t","border-slate-700/50","bg-slate-900/50","flex","justify-end","gap-3"],[1,"px-6","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-600","hover:to-blue-600","text-white","font-medium","rounded-lg","transition-all","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-xl"],[1,"text-white","font-medium"],[1,"text-xs","bg-cyan-500/20","text-cyan-400","px-1.5","py-0.5","rounded"],[1,"text-xs","text-slate-400"],[1,"relative","z-10","w-12","h-12","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-white","font-bold","flex-shrink-0"],[1,"flex-1","bg-slate-800/50","rounded-lg","p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"font-medium","text-white"],[1,"text-cyan-400"],[1,"text-sm","text-slate-300","italic"],[1,"text-xs","text-green-400","mt-2"],[1,"text-amber-400","flex-shrink-0"]],template:function(t,n){if(t&1&&(T(0,"div",0)(1,"div",1),O(2,iN,25,13,"div",2,p1),k(),y(4,dN,49,3,"div",3),k()),t&2){let o;c(2),U(n.PRESET_SCENARIOS),c(2),S((o=n.selectedScenario())?4:-1,o)}},dependencies:[oe],encapsulation:2})}};var uN=()=>[2,3,4,5],km=(i,e)=>e.id;function mN(i,e){if(i&1){let t=I();r(0,"button",37),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.setRoleCount(o))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(2);N("bg-cyan-500",n.workflowConfig().roleCount===t)("text-white",n.workflowConfig().roleCount===t)("bg-slate-700",n.workflowConfig().roleCount!==t)("text-slate-300",n.workflowConfig().roleCount!==t),c(),M(" ",t," ")}}function pN(i,e){if(i&1){let t=I();r(0,"button",38),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.setMarketingGoal(o.id))}),r(1,"div",39),l(2),s(),r(3,"div",40),l(4),s(),r(5,"div",24),l(6),s()()}if(i&2){let t=e.$implicit,n=m(2);ee("border-color",n.workflowConfig().marketingGoal!==t.id?"var(--border-color)":"")("background-color",n.workflowConfig().marketingGoal!==t.id?"var(--bg-secondary)":""),N("border-cyan-500",n.workflowConfig().marketingGoal===t.id)("bg-cyan-500/10",n.workflowConfig().marketingGoal===t.id),c(2),D(t.icon),c(2),D(t.name),c(2),D(t.description)}}function gN(i,e){if(i&1){let t=I();r(0,"div",45)(1,"textarea",46),x("ngModelChange",function(o){_(t);let a=m().$implicit,d=m(2);return v(d.updateSignalKeywords(a.id,o))}),s(),r(2,"p",18),l(3," \u7576\u7528\u6236\u6D88\u606F\u5305\u542B\u9019\u4E9B\u8A5E\u6642\uFF0C\u8B58\u5225\u70BA\u8208\u8DA3\u4FE1\u865F "),s()()}if(i&2){let t=m().$implicit;c(),L("ngModel",t.keywords.join(", "))}}function hN(i,e){if(i&1){let t=I();r(0,"div",32)(1,"div",41)(2,"label",20)(3,"input",42),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSignal(o.id))}),s(),r(4,"span",43),l(5),s(),r(6,"span",40),l(7),s()(),r(8,"button",44),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSignalExpand(o.id))}),l(9),s()(),y(10,gN,4,1,"div",45),s()}if(i&2){let t=e.$implicit,n=m(2);c(3),L("checked",t.enabled),c(2),D(t.icon),c(2),D(t.name),c(2),M(" ",n.expandedSignals().has(t.id)?"\u6536\u8D77":"\u7DE8\u8F2F"," "),c(),S(n.expandedSignals().has(t.id)?10:-1)}}function fN(i,e){i&1&&(r(0,"div",49),l(1,"\u2192"),s())}function _N(i,e){if(i&1&&(r(0,"div",36)(1,"div",47)(2,"div",39),l(3),s(),r(4,"div",48),l(5),s()(),y(6,fN,2,0,"div",49),s()),i&2){let t,n=e.$implicit,o=e.$index,a=m(2);c(),ee("background-color",o!==0?"var(--bg-secondary)":""),N("bg-gradient-to-r",o===0)("from-cyan-500",o===0)("to-blue-500",o===0)("text-white",o===0),c(2),D(a.getStepIcon(n.type)),c(),ee("color",o!==0?"var(--text-primary)":""),c(),D(n.name),c(),S(o<(((t=a.currentWorkflow())==null||t.steps==null?null:t.steps.length)||0)-1?6:-1)}}function vN(i,e){if(i&1){let t=I();r(0,"div",8)(1,"div",9)(2,"div",10)(3,"h3",11)(4,"span"),l(5,"\u{1F3AF}"),s(),r(6,"span"),l(7,"\u89F8\u767C\u689D\u4EF6"),s()(),r(8,"div",12)(9,"label",13),l(10),s(),r(11,"input",14),x("ngModelChange",function(o){_(t);let a=m();return v(a.updateTriggerConfig("minIntentScore",o))}),s(),r(12,"div",15)(13,"span"),l(14,"\u4F4E\u9580\u6ABB (30)"),s(),r(15,"span"),l(16,"\u9AD8\u9580\u6ABB (90)"),s()()(),r(17,"div",12)(18,"label",13),l(19," \u540C\u7528\u6236\u51B7\u537B\u6642\u9593 "),s(),r(20,"div",16)(21,"input",17),x("ngModelChange",function(o){_(t);let a=m();return v(a.updateTriggerConfig("cooldownMinutes",o))}),s(),r(22,"span",5),l(23,"\u5206\u9418"),s()(),r(24,"p",18),l(25," \u63A8\u85A6: 1440 \u5206\u9418 (24\u5C0F\u6642) "),s()(),r(26,"div",19)(27,"label",20)(28,"input",21),x("ngModelChange",function(o){_(t);let a=m();return v(a.updateTriggerConfig("excludeContacted",o))}),s(),r(29,"span",22),l(30,"\u6392\u9664\u5DF2\u806F\u7E6B\u7528\u6236"),s()(),r(31,"label",20)(32,"input",21),x("ngModelChange",function(o){_(t);let a=m();return v(a.updateTriggerConfig("excludeBlacklist",o))}),s(),r(33,"span",22),l(34,"\u6392\u9664\u9ED1\u540D\u55AE\u7528\u6236"),s()()()(),r(35,"div",10)(36,"h3",11)(37,"span"),l(38,"\u23F1\uFE0F"),s(),r(39,"span"),l(40,"\u57F7\u884C\u6642\u6A5F"),s()(),r(41,"div",12)(42,"label",13),l(43," \u9996\u6B21\u63A5\u89F8\u5EF6\u9072 (\u5206\u9418) "),s(),r(44,"div",23)(45,"div")(46,"span",24),l(47,"\u6700\u77ED"),s(),r(48,"input",25),x("ngModelChange",function(o){_(t);let a=m();return v(a.updateDelayConfig("min",o))}),s()(),r(49,"div")(50,"span",24),l(51,"\u6700\u9577"),s(),r(52,"input",26),x("ngModelChange",function(o){_(t);let a=m();return v(a.updateDelayConfig("max",o))}),s()()(),r(53,"p",18),l(54," \u7CFB\u7D71\u6703\u5728\u6B64\u7BC4\u570D\u5167\u96A8\u6A5F\u5EF6\u9072\uFF0C\u66F4\u81EA\u7136 "),s()()(),r(55,"div",10)(56,"h3",11)(57,"span"),l(58,"\u{1F3AD}"),s(),r(59,"span"),l(60,"\u89D2\u8272\u914D\u7F6E"),s()(),r(61,"div",12)(62,"label",13),l(63," \u53C3\u8207\u89D2\u8272\u6578\u91CF "),s(),r(64,"div",27)(65,"button",28),x("click",function(){_(t);let o=m();return v(o.setRoleCount("auto"))}),l(66," \u{1F916} AI \u81EA\u52D5 "),s(),O(67,mN,2,9,"button",29,be),s()(),r(69,"div")(70,"label",13),l(71," \u5E33\u865F\u9078\u64C7\u65B9\u5F0F "),s(),r(72,"div",27)(73,"button",28),x("click",function(){_(t);let o=m();return v(o.setAccountSelection("auto"))}),l(74," \u{1F916} AI \u81EA\u52D5\u9078\u64C7 "),s(),r(75,"button",28),x("click",function(){_(t);let o=m();return v(o.setAccountSelection("manual"))}),l(76," \u{1F464} \u624B\u52D5\u6307\u5B9A "),s()()()()(),r(77,"div",9)(78,"div",10)(79,"h3",11)(80,"span"),l(81,"\u{1F680}"),s(),r(82,"span"),l(83,"\u71DF\u92B7\u76EE\u6A19"),s()(),r(84,"div",23),O(85,pN,7,11,"button",30,km),s()(),r(87,"div",10)(88,"h3",11)(89,"span"),l(90,"\u{1F50D}"),s(),r(91,"span"),l(92,"\u8208\u8DA3\u4FE1\u865F\u8B58\u5225"),s()(),r(93,"div",31),O(94,hN,11,5,"div",32,km),s()(),r(96,"div",10)(97,"h3",11)(98,"span"),l(99,"\u{1F465}"),s(),r(100,"span"),l(101,"\u81EA\u52D5\u5EFA\u7FA4\u8A2D\u7F6E"),s()(),r(102,"div",12)(103,"label",13),l(104," \u7FA4\u7D44\u540D\u7A31\u6A21\u677F "),s(),r(105,"input",33),x("ngModelChange",function(o){_(t);let a=m();return v(a.updateWorkflowConfig("groupNameTemplate",o))}),s(),r(106,"p",18),l(107),s()(),r(108,"div",32)(109,"p",24),l(110," \u{1F4A1} \u7576\u6AA2\u6E2C\u5230\u7528\u6236\u6709\u8CFC\u8CB7\u610F\u5411\u6642\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u5275\u5EFA VIP \u7FA4\u4E26\u9080\u8ACB\u7528\u6236\u52A0\u5165 "),s()()()()(),r(111,"div",34)(112,"h3",11)(113,"span"),l(114,"\u{1F4CA}"),s(),r(115,"span"),l(116,"\u5DE5\u4F5C\u6D41\u9810\u89BD"),s()(),r(117,"div",35),O(118,_N,7,15,"div",36,km),s()()}if(i&2){let t,n=m();c(10),M(" \u6700\u4F4E\u610F\u5411\u5206 (",n.triggerConfig().minIntentScore,") "),c(),L("ngModel",n.triggerConfig().minIntentScore),c(10),L("ngModel",n.triggerConfig().cooldownMinutes),c(7),L("ngModel",n.triggerConfig().excludeContacted),c(4),L("ngModel",n.triggerConfig().excludeBlacklist),c(16),L("ngModel",n.workflowConfig().firstContactDelay.min),c(4),L("ngModel",n.workflowConfig().firstContactDelay.max),c(13),N("bg-cyan-500",n.workflowConfig().roleCount==="auto")("text-white",n.workflowConfig().roleCount==="auto")("bg-slate-700",n.workflowConfig().roleCount!=="auto")("text-slate-300",n.workflowConfig().roleCount!=="auto"),c(2),U(rt(37,uN)),c(6),N("bg-cyan-500",n.workflowConfig().accountSelection==="auto")("text-white",n.workflowConfig().accountSelection==="auto")("bg-slate-700",n.workflowConfig().accountSelection!=="auto")("text-slate-300",n.workflowConfig().accountSelection!=="auto"),c(2),N("bg-cyan-500",n.workflowConfig().accountSelection==="manual")("text-white",n.workflowConfig().accountSelection==="manual")("bg-slate-700",n.workflowConfig().accountSelection!=="manual")("text-slate-300",n.workflowConfig().accountSelection!=="manual"),c(10),U(n.marketingGoals),c(9),U(n.interestSignals()),c(11),L("ngModel",n.workflowConfig().groupNameTemplate||n.groupNameDefault)("placeholder",n.groupNameDefault),c(2),ip(" \u53EF\u7528\u8B8A\u91CF: ","{","user","}"," = \u7528\u6236\u540D, ","{","date","}"," = \u65E5\u671F "),c(11),U((t=n.currentWorkflow())==null?null:t.steps)}}function xN(i,e){i&1&&(r(0,"div",7)(1,"span",50),l(2,"\u2699\uFE0F"),s(),r(3,"p"),l(4,"\u7121\u53EF\u7528\u5DE5\u4F5C\u6D41"),s()())}var Uc=class i{constructor(){this.workflowService=F(qn);this.toast=F(J);this.ipc=F(Q);this.currentWorkflow=R(()=>this.workflowService.workflows()[0]);this.triggerConfig=R(()=>this.currentWorkflow()?.trigger||{minIntentScore:60,cooldownMinutes:1440,excludeContacted:!0,excludeBlacklist:!0});this.workflowConfig=R(()=>this.currentWorkflow()?.config||{marketingGoal:"\u4FC3\u9032\u6210\u4EA4",roleCount:"auto",accountSelection:"auto",firstContactDelay:{min:5,max:15},interestSignals:[],groupNameTemplate:"VIP \u670D\u52D9\u7FA4 - {user}"});this.marketingGoals=[{id:"\u4FC3\u9032\u6210\u4EA4",name:"\u4FC3\u9032\u6210\u4EA4",icon:"\u{1F4B0}",description:"\u5F15\u5C0E\u7528\u6236\u8CFC\u8CB7\u7522\u54C1"},{id:"\u54C1\u724C\u63A8\u5EE3",name:"\u54C1\u724C\u63A8\u5EE3",icon:"\u{1F4E2}",description:"\u63D0\u5347\u54C1\u724C\u77E5\u540D\u5EA6"},{id:"\u7528\u6236\u57F9\u80B2",name:"\u7528\u6236\u57F9\u80B2",icon:"\u{1F331}",description:"\u5EFA\u7ACB\u4FE1\u4EFB\u95DC\u4FC2"},{id:"\u6536\u96C6\u53CD\u994B",name:"\u6536\u96C6\u53CD\u994B",icon:"\u{1F4CB}",description:"\u4E86\u89E3\u7528\u6236\u9700\u6C42"}];this.interestSignals=f([{id:"price_inquiry",name:"\u50F9\u683C\u8A62\u554F",icon:"\u{1F4B0}",keywords:["\u591A\u5C11\u9322","\u4EC0\u9EBC\u50F9\u683C","\u50F9\u683C","\u8CBB\u7528","\u6536\u8CBB"],enabled:!0},{id:"product_detail",name:"\u7522\u54C1\u7D30\u7BC0",icon:"\u{1F4E6}",keywords:["\u600E\u9EBC\u7528","\u6709\u4EC0\u9EBC\u529F\u80FD","\u8A73\u7D30\u4ECB\u7D39","\u4E86\u89E3\u4E00\u4E0B"],enabled:!0},{id:"purchase_intent",name:"\u8CFC\u8CB7\u610F\u5411",icon:"\u{1F6D2}",keywords:["\u600E\u9EBC\u8CB7","\u5728\u54EA\u8CB7","\u6211\u8981","\u6211\u60F3\u8CB7","\u4E0B\u55AE"],enabled:!0},{id:"positive_feedback",name:"\u6B63\u9762\u53CD\u994B",icon:"\u{1F44D}",keywords:["\u4E0D\u932F","\u633A\u597D","\u53EF\u4EE5","\u884C","\u611F\u8208\u8DA3"],enabled:!0},{id:"comparison",name:"\u6BD4\u8F03\u8AEE\u8A62",icon:"\u2696\uFE0F",keywords:["\u6BD4","\u5C0D\u6BD4","\u5340\u5225","\u5DEE\u5225","\u54EA\u500B\u597D"],enabled:!1}]);this.expandedSignals=f(new Set);this.groupNameDefault="VIP \u670D\u52D9\u7FA4 - {user}";this.localTriggerConfig=f({});this.localWorkflowConfig=f({})}ngOnInit(){let e=this.currentWorkflow();e&&(this.localTriggerConfig.set(E({},e.trigger)),this.localWorkflowConfig.set(E({},e.config)),this.loadInterestSignals(e.config.interestSignals||[]))}ngOnDestroy(){}loadInterestSignals(e){this.interestSignals.update(t=>t.map(n=>P(E({},n),{enabled:e.length===0||e.includes(n.id)})))}updateTriggerConfig(e,t){this.localTriggerConfig.update(n=>P(E({},n),{[e]:t}))}updateDelayConfig(e,t){this.localWorkflowConfig.update(n=>P(E({},n),{firstContactDelay:P(E({},n.firstContactDelay),{[e]:t})}))}updateWorkflowConfig(e,t){this.localWorkflowConfig.update(n=>P(E({},n),{[e]:t}))}setRoleCount(e){this.updateWorkflowConfig("roleCount",e)}setAccountSelection(e){this.updateWorkflowConfig("accountSelection",e)}setMarketingGoal(e){this.updateWorkflowConfig("marketingGoal",e)}toggleSignal(e){this.interestSignals.update(t=>t.map(n=>n.id===e?P(E({},n),{enabled:!n.enabled}):n))}toggleSignalExpand(e){this.expandedSignals.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}updateSignalKeywords(e,t){let n=t.split(",").map(o=>o.trim()).filter(o=>o);this.interestSignals.update(o=>o.map(a=>a.id===e?P(E({},a),{keywords:n}):a))}saveConfig(){let e=this.currentWorkflow();if(!e)return;let t=this.interestSignals().filter(o=>o.enabled).map(o=>o.id),n={workflowId:e.id,trigger:this.localTriggerConfig(),config:P(E({},this.localWorkflowConfig()),{interestSignals:t}),interestSignalKeywords:this.interestSignals().reduce((o,a)=>(o[a.id]=a.keywords,o),{})};console.log("[WorkflowConfig] \u4FDD\u5B58\u914D\u7F6E:",n);try{localStorage.setItem("workflowConfig",JSON.stringify(n)),this.toast.success("\u2705 \u5DE5\u4F5C\u6D41\u914D\u7F6E\u5DF2\u4FDD\u5B58")}catch{this.toast.error("\u4FDD\u5B58\u5931\u6557")}}getStepIcon(e){return{evaluate:"\u{1F4CA}",plan:"\u{1F3AF}",private_chat:"\u{1F4AC}",detect_interest:"\u{1F50D}",create_group:"\u{1F465}",group_marketing:"\u{1F680}",record:"\u{1F4DD}"}[e]||"\u25B6\uFE0F"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-workflow-config"]],decls:17,vars:1,consts:[[1,"workflow-config"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-xl","font-bold",2,"color","var(--text-primary)"],[1,"text-sm",2,"color","var(--text-muted)"],[1,"px-4","py-2","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-600","hover:to-blue-600","text-white","rounded-lg","font-medium","transition-all","flex","items-center","gap-2",3,"click"],[1,"text-center","py-12",2,"color","var(--text-muted)"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"space-y-6"],[1,"rounded-xl","p-5",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"text-lg","font-bold","mb-4","flex","items-center","gap-2",2,"color","var(--text-primary)"],[1,"mb-4"],[1,"block","text-sm","font-medium","mb-2",2,"color","var(--text-secondary)"],["type","range","min","30","max","90","step","5",1,"w-full","h-2","rounded-lg","appearance-none","cursor-pointer",2,"background","linear-gradient(to right, var(--success), var(--warning), var(--error))",3,"ngModelChange","ngModel"],[1,"flex","justify-between","text-xs","mt-1",2,"color","var(--text-muted)"],[1,"flex","items-center","gap-2"],["type","number","min","60","max","10080",1,"flex-1","px-3","py-2","rounded-lg","border","text-sm",2,"background-color","var(--bg-secondary)","border-color","var(--border-color)","color","var(--text-primary)",3,"ngModelChange","ngModel"],[1,"text-xs","mt-1",2,"color","var(--text-muted)"],[1,"space-y-2"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","rounded","accent-cyan-500",3,"ngModelChange","ngModel"],[1,"text-sm",2,"color","var(--text-secondary)"],[1,"grid","grid-cols-2","gap-3"],[1,"text-xs",2,"color","var(--text-muted)"],["type","number","min","1","max","60",1,"w-full","px-3","py-2","rounded-lg","border","text-sm",2,"background-color","var(--bg-secondary)","border-color","var(--border-color)","color","var(--text-primary)",3,"ngModelChange","ngModel"],["type","number","min","1","max","120",1,"w-full","px-3","py-2","rounded-lg","border","text-sm",2,"background-color","var(--bg-secondary)","border-color","var(--border-color)","color","var(--text-primary)",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"flex-1","px-3","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"px-3","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"bg-cyan-500","text-white","bg-slate-700","text-slate-300"],[1,"p-3","rounded-lg","text-left","transition-all","border",3,"border-cyan-500","bg-cyan-500/10","border-color","background-color"],[1,"space-y-3"],[1,"p-3","rounded-lg",2,"background-color","var(--bg-secondary)"],["type","text",1,"w-full","px-3","py-2","rounded-lg","border","text-sm",2,"background-color","var(--bg-secondary)","border-color","var(--border-color)","color","var(--text-primary)",3,"ngModelChange","ngModel","placeholder"],[1,"mt-6","rounded-xl","p-5",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"flex","items-center","justify-center","gap-2","overflow-x-auto","py-4"],[1,"flex","items-center"],[1,"px-3","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"p-3","rounded-lg","text-left","transition-all","border",3,"click"],[1,"text-xl","mb-1"],[1,"font-medium","text-sm",2,"color","var(--text-primary)"],[1,"flex","items-center","justify-between","mb-2"],["type","checkbox",1,"w-4","h-4","rounded","accent-cyan-500",3,"change","checked"],[1,"text-lg"],[1,"text-xs","px-2","py-1","rounded",2,"color","var(--text-muted)",3,"click"],[1,"mt-2"],["rows","2","placeholder","\u7528\u9017\u865F\u5206\u9694\u95DC\u9375\u8A5E",1,"w-full","px-3","py-2","rounded-lg","border","text-sm",2,"background-color","var(--bg-tertiary)","border-color","var(--border-color)","color","var(--text-primary)",3,"ngModelChange","ngModel"],[1,"px-4","py-3","rounded-lg","text-center","min-w-[100px]","transition-all"],[1,"text-sm","font-medium"],[1,"mx-2","text-xl",2,"color","var(--text-muted)"],[1,"text-4xl","block","mb-4"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"\u2699\uFE0F"),s(),r(5,"div")(6,"h2",4),l(7,"\u5DE5\u4F5C\u6D41\u914D\u7F6E"),s(),r(8,"p",5),l(9,"\u81EA\u5B9A\u7FA9\u81EA\u52D5\u5316\u71DF\u92B7\u6D41\u7A0B"),s()()(),r(10,"button",6),x("click",function(){return n.saveConfig()}),r(11,"span"),l(12,"\u{1F4BE}"),s(),r(13,"span"),l(14,"\u4FDD\u5B58\u914D\u7F6E"),s()()(),y(15,vN,120,38)(16,xN,5,0,"div",7),s()),t&2&&(c(15),S(n.currentWorkflow()?15:16))},dependencies:[oe,ae,xe,Rt,Hi,it,ve,Nt,tn,he],styles:[".workflow-config[_ngcontent-%COMP%]{padding:1.5rem}input[type=range][_ngcontent-%COMP%]{-webkit-appearance:none}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:#fff;cursor:pointer;border:2px solid var(--primary);box-shadow:0 2px 6px #0000004d}"]})}};var ms=(i,e)=>e.id;function CN(i,e){if(i&1&&(T(0,"div",15),Se(1,"div",20),T(2,"div",21)(3,"div",22),l(4),k(),T(5,"div",9),l(6),k()()()),i&2){let t=e.$implicit;c(),ee("height",t.percentage,"%")("background",t.gradient),c(3),D(t.count),c(2),D(t.name)}}function bN(i,e){if(i&1){let t=I();T(0,"button",38),se("click",function(){_(t);let o=m().$implicit,a=m();return v(a.cancelExecution(o.id))}),l(1," \u2715 "),k()}}function yN(i,e){i&1&&l(0," \u2713 ")}function SN(i,e){if(i&1&&l(0),i&2){let t=m().$index;M(" ",t+1," ")}}function wN(i,e){if(i&1&&Se(0,"div",41),i&2){let t=m().$implicit,n=m().$implicit,o=m();N("bg-emerald-500",o.isStepCompleted(n,t.id))("bg-slate-600",!o.isStepCompleted(n,t.id))}}function EN(i,e){if(i&1&&(T(0,"div",31)(1,"div",39),y(2,yN,1,0)(3,SN,1,1),k(),y(4,wN,1,4,"div",40),k()),i&2){let t=e.$implicit,n=e.$index,o=m().$implicit,a=m();c(),N("bg-emerald-500",a.isStepCompleted(o,t.id))("bg-cyan-500",o.currentStep===t.id&&o.status==="running")("animate-pulse",o.currentStep===t.id&&o.status==="running")("bg-slate-600",!a.isStepCompleted(o,t.id)&&o.currentStep!==t.id),c(),S(a.isStepCompleted(o,t.id)?2:3),c(2),S(n<a.getWorkflowSteps().length-1?4:-1)}}function DN(i,e){if(i&1&&(T(0,"span",35),l(1),k()),i&2){let t=m().$implicit,n=m();c(),M(" ",n.getStepResultSummary(t)," ")}}function AN(i,e){if(i&1&&(T(0,"div",45)(1,"span",46),l(2),k(),T(3,"span"),l(4),k()()),i&2){let t=m().$implicit,n=m(2).$implicit,o=m();c(2),D(t.name),c(),N("text-emerald-400",n.stepResults[t.id].status==="success")("text-red-400",n.stepResults[t.id].status==="failed")("text-slate-400",n.stepResults[t.id].status==="skipped"),c(),M(" ",o.getStepStatusText(n.stepResults[t.id].status)," ")}}function MN(i,e){if(i&1&&y(0,AN,5,8,"div",45),i&2){let t=e.$implicit,n=m(2).$implicit;S(n.stepResults[t.id]?0:-1)}}function TN(i,e){if(i&1&&(T(0,"div",44)(1,"span",33),l(2,"AI \u7B56\u7565\uFF1A"),k(),T(3,"span",46),l(4),k()()),i&2){let t=m(2).$implicit;c(4),D(t.aiPlanResult.strategy||"\u6A19\u6E96\u71DF\u92B7")}}function kN(i,e){if(i&1&&(T(0,"div",36)(1,"h4",42),l(2,"\u57F7\u884C\u8A73\u60C5"),k(),T(3,"div",43),O(4,MN,1,1,null,null,ms),k(),y(6,TN,5,1,"div",44),k()),i&2){let t=m().$implicit,n=m();c(4),U(n.getWorkflowSteps()),c(2),S(t.aiPlanResult?6:-1)}}function IN(i,e){if(i&1){let t=I();T(0,"div",23)(1,"div",24)(2,"div",25)(3,"span",26),l(4),k(),T(5,"div")(6,"div",27),l(7),k(),T(8,"div",9),l(9),k()()(),T(10,"div",25)(11,"div",28),l(12),k(),y(13,bN,2,0,"button",29),k()(),T(14,"div",30),O(15,EN,5,10,"div",31,ms),k(),T(17,"div",32)(18,"span",33),l(19,"\u7576\u524D\uFF1A"),k(),T(20,"span",34),l(21),k(),y(22,DN,2,1,"span",35),k(),y(23,kN,7,1,"div",36),T(24,"button",37),se("click",function(){let o=_(t).$implicit,a=m();return v(a.toggleExpand(o.id))}),l(25),k()()}if(i&2){let t=e.$implicit,n=m();N("border-cyan-500",t.status==="running")("border-l-4",t.status==="running"),c(4),D(n.getStatusIcon(t.status)),c(3),M(" @",t.targetUserName," "),c(2),M(" ",n.formatTime(t.startedAt)," "),c(2),ee("background-color",n.getConversionColor(t)),c(),M(" ",n.getConversionProbability(t),"% \u8F49\u5316 "),c(),S(t.status==="running"||t.status==="pending"?13:-1),c(2),U(n.getWorkflowSteps()),c(6),D(n.getCurrentStepName(t)),c(),S(t.stepResults[t.currentStep]!=null&&t.stepResults[t.currentStep].data?22:-1),c(),S(n.expandedExecution()===t.id?23:-1),c(2),M(" ",n.expandedExecution()===t.id?"\u6536\u8D77 \u25B2":"\u8A73\u60C5 \u25BC"," ")}}function FN(i,e){i&1&&(T(0,"div",18)(1,"span",47),l(2,"\u{1F3AF}"),k(),T(3,"p"),l(4,"\u66AB\u7121\u9032\u884C\u4E2D\u7684\u5DE5\u4F5C\u6D41"),k(),T(5,"p",48),l(6,"\u7576\u76E3\u63A7\u7FA4\u7D44\u89F8\u767C\u95DC\u9375\u8A5E\u6642\uFF0C\u5DE5\u4F5C\u6D41\u5C07\u81EA\u52D5\u958B\u59CB"),k()())}function PN(i,e){if(i&1&&(T(0,"tr",53)(1,"td",54),l(2),k(),T(3,"td",55)(4,"span",56),l(5),k()(),T(6,"td",57),l(7),k(),T(8,"td",57),l(9),k()()),i&2){let t=e.$implicit,n=m(2);c(2),M("@",t.targetUserName),c(2),N("bg-emerald-500/20",t.outcome==="converted")("text-emerald-400",t.outcome==="converted")("bg-amber-500/20",t.outcome==="interested")("text-amber-400",t.outcome==="interested")("bg-slate-500/20",!t.outcome||t.outcome==="neutral")("text-slate-400",!t.outcome||t.outcome==="neutral"),c(),M(" ",n.getOutcomeText(t.outcome)," "),c(2),D(n.getDuration(t)),c(2),D(n.formatTime(t.completedAt))}}function RN(i,e){if(i&1&&(T(0,"div",19)(1,"h3",13)(2,"span"),l(3,"\u2705"),k(),T(4,"span"),l(5,"\u8FD1\u671F\u5B8C\u6210"),k()(),T(6,"div",49)(7,"table",50)(8,"thead")(9,"tr",51)(10,"th",52),l(11,"\u7528\u6236"),k(),T(12,"th",52),l(13,"\u7D50\u679C"),k(),T(14,"th",52),l(15,"\u8017\u6642"),k(),T(16,"th",52),l(17,"\u5B8C\u6210\u6642\u9593"),k()()(),T(18,"tbody"),O(19,PN,10,16,"tr",53,ms),k()()()()),i&2){let t=m();c(19),U(t.completedExecutions().slice(0,5))}}var Gc=class i{constructor(){this.workflowService=F(qn);this.toast=F(J);this.expandedExecution=f(null);this.executions=this.workflowService.executions;this.activeExecutions=R(()=>this.executions().filter(e=>e.status==="running"||e.status==="pending"));this.completedExecutions=R(()=>this.executions().filter(e=>e.status==="completed"||e.status==="failed"));this.runningCount=R(()=>this.executions().filter(e=>e.status==="running").length);this.pendingCount=R(()=>this.executions().filter(e=>e.status==="pending").length);this.completedTodayCount=R(()=>{let e=new Date().toDateString();return this.executions().filter(t=>t.status==="completed"&&t.completedAt&&new Date(t.completedAt).toDateString()===e).length});this.funnelStages=R(()=>{let e=this.executions(),t=e.length||1,n=e.length,o=e.filter(p=>p.stepResults.plan?.status==="success").length,a=e.filter(p=>p.stepResults.private_chat?.status==="success").length,d=e.filter(p=>p.stepResults.detect_interest?.status==="success").length,u=e.filter(p=>p.outcome==="converted").length;return[{id:"triggered",name:"\u89F8\u767C",count:n,percentage:100,gradient:"linear-gradient(to top, #6366f1, #8b5cf6)"},{id:"planned",name:"\u7B56\u5283",count:o,percentage:o/t*100,gradient:"linear-gradient(to top, #3b82f6, #6366f1)"},{id:"chatted",name:"\u79C1\u804A",count:a,percentage:a/t*100,gradient:"linear-gradient(to top, #06b6d4, #3b82f6)"},{id:"interested",name:"\u8208\u8DA3",count:d,percentage:d/t*100,gradient:"linear-gradient(to top, #10b981, #06b6d4)"},{id:"converted",name:"\u8F49\u5316",count:u,percentage:u/t*100,gradient:"linear-gradient(to top, #22c55e, #10b981)"}]});this.workflowSteps=[{id:"evaluate",name:"\u8A55\u4F30"},{id:"plan",name:"AI\u7B56\u5283"},{id:"private_chat",name:"\u79C1\u804A"},{id:"detect_interest",name:"\u8208\u8DA3"},{id:"create_group",name:"\u5EFA\u7FA4"},{id:"group_marketing",name:"\u71DF\u92B7"},{id:"record",name:"\u8A18\u9304"}]}ngOnInit(){}ngOnDestroy(){}getWorkflowSteps(){return this.workflowSteps}isStepCompleted(e,t){return e.stepResults[t]?.status==="success"}getCurrentStepName(e){return this.workflowSteps.find(n=>n.id===e.currentStep)?.name||e.currentStep}getStatusIcon(e){return{running:"\u{1F504}",pending:"\u23F3",completed:"\u2705",failed:"\u274C",cancelled:"\u{1F6AB}",paused:"\u23F8\uFE0F"}[e]||"\u2753"}getStepStatusText(e){return{success:"\u2713 \u5B8C\u6210",failed:"\u2717 \u5931\u6557",skipped:"- \u8DF3\u904E"}[e]||e}getStepResultSummary(e){let t=e.stepResults[e.currentStep];return t?.data&&t.data.type?`\u4FE1\u865F: ${t.data.type}`:""}getConversionProbability(e){return Math.round(this.workflowService.calculateConversionProbability(e)*100)}getConversionColor(e){let t=this.workflowService.calculateConversionProbability(e);return t>=.7?"#22c55e":t>=.5?"#f59e0b":"#6b7280"}getOutcomeText(e){return{converted:"\u5DF2\u8F49\u5316",interested:"\u6709\u8208\u8DA3",neutral:"\u4E2D\u6027",rejected:"\u62D2\u7D55",no_response:"\u7121\u97FF\u61C9"}[e||""]||"\u9032\u884C\u4E2D"}getDuration(e){if(!e.completedAt)return"-";let t=new Date(e.startedAt).getTime(),n=new Date(e.completedAt).getTime();return`${Math.round((n-t)/6e4)}\u5206\u9418`}formatTime(e){if(!e)return"-";let t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}toggleExpand(e){this.expandedExecution.update(t=>t===e?null:e)}cancelExecution(e){this.workflowService.cancelExecution(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-workflow-monitor"]],decls:40,vars:5,consts:[[1,"workflow-monitor"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-xl","font-bold",2,"color","var(--text-primary)"],[1,"text-sm",2,"color","var(--text-muted)"],[1,"flex","items-center","gap-4"],[1,"text-center"],[1,"text-2xl","font-bold",2,"color","var(--success)"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"text-2xl","font-bold",2,"color","var(--warning)"],[1,"text-2xl","font-bold",2,"color","var(--primary)"],[1,"rounded-xl","p-5","mb-6",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"text-lg","font-bold","mb-4","flex","items-center","gap-2",2,"color","var(--text-primary)"],[1,"flex","items-end","justify-between","gap-2","h-32"],[1,"flex-1","flex","flex-col","items-center"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],[1,"rounded-xl","p-4","transition-all","hover:shadow-lg",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)",3,"border-cyan-500","border-l-4"],[1,"col-span-2","text-center","py-12",2,"color","var(--text-muted)"],[1,"mt-6"],[1,"w-full","rounded-t-lg","transition-all","duration-500"],[1,"mt-2","text-center"],[1,"text-sm","font-bold",2,"color","var(--text-primary)"],[1,"rounded-xl","p-4","transition-all","hover:shadow-lg",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"flex","items-center","justify-between","mb-3"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"font-medium",2,"color","var(--text-primary)"],[1,"px-2","py-1","rounded-full","text-xs","font-medium",2,"color","white"],["title","\u53D6\u6D88\u57F7\u884C",1,"p-1","rounded","hover:bg-red-500/20","transition-colors",2,"color","var(--error)"],[1,"flex","items-center","gap-1","mb-3"],[1,"flex","items-center"],[1,"text-sm","p-2","rounded-lg",2,"background-color","var(--bg-secondary)"],[2,"color","var(--text-muted)"],[2,"color","var(--text-primary)"],[1,"text-xs","ml-2",2,"color","var(--success)"],[1,"mt-3","pt-3","border-t",2,"border-color","var(--border-color)"],[1,"w-full","mt-2","text-xs","py-1","rounded","transition-colors","hover:bg-slate-700/50",2,"color","var(--text-muted)",3,"click"],["title","\u53D6\u6D88\u57F7\u884C",1,"p-1","rounded","hover:bg-red-500/20","transition-colors",2,"color","var(--error)",3,"click"],[1,"w-6","h-6","rounded-full","flex","items-center","justify-center","text-xs","transition-all",2,"color","white"],[1,"w-4","h-0.5","transition-all",3,"bg-emerald-500","bg-slate-600"],[1,"w-4","h-0.5","transition-all"],[1,"text-sm","font-medium","mb-2",2,"color","var(--text-secondary)"],[1,"space-y-2","text-xs"],[1,"mt-2","p-2","rounded","text-xs",2,"background-color","var(--bg-tertiary)"],[1,"flex","items-center","justify-between","p-2","rounded",2,"background-color","var(--bg-tertiary)"],[2,"color","var(--text-secondary)"],[1,"text-4xl","block","mb-4"],[1,"text-sm","mt-2"],[1,"rounded-xl","overflow-hidden",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"w-full","text-sm"],[2,"background-color","var(--bg-secondary)"],[1,"text-left","p-3",2,"color","var(--text-muted)"],[1,"border-t",2,"border-color","var(--border-color)"],[1,"p-3",2,"color","var(--text-primary)"],[1,"p-3"],[1,"px-2","py-1","rounded-full","text-xs"],[1,"p-3",2,"color","var(--text-muted)"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"\u{1F4CA}"),k(),T(5,"div")(6,"h2",4),l(7,"\u57F7\u884C\u76E3\u63A7"),k(),T(8,"p",5),l(9,"\u5BE6\u6642\u8FFD\u8E64\u5DE5\u4F5C\u6D41\u57F7\u884C\u72C0\u614B"),k()()(),T(10,"div",6)(11,"div",7)(12,"div",8),l(13),k(),T(14,"div",9),l(15,"\u9032\u884C\u4E2D"),k()(),T(16,"div",7)(17,"div",10),l(18),k(),T(19,"div",9),l(20,"\u7B49\u5F85\u4E2D"),k()(),T(21,"div",7)(22,"div",11),l(23),k(),T(24,"div",9),l(25,"\u4ECA\u65E5\u5B8C\u6210"),k()()()(),T(26,"div",12)(27,"h3",13)(28,"span"),l(29,"\u{1F3AF}"),k(),T(30,"span"),l(31,"\u8F49\u5316\u6F0F\u6597"),k()(),T(32,"div",14),O(33,CN,7,6,"div",15,ms),k()(),T(35,"div",16),O(36,IN,26,15,"div",17,ms,!1,FN,7,0,"div",18),k(),y(39,RN,21,0,"div",19),k()),t&2&&(c(13),D(n.runningCount()),c(5),D(n.pendingCount()),c(5),D(n.completedTodayCount()),c(10),U(n.funnelStages()),c(3),U(n.activeExecutions()),c(3),S(n.completedExecutions().length>0?39:-1))},dependencies:[oe],styles:[".workflow-monitor[_ngcontent-%COMP%]{padding:1.5rem}"]})}};var NN=(i,e)=>e.date,g1=(i,e)=>e.id;function VN(i,e){if(i&1&&(T(0,"div",33)(1,"div",40),Se(2,"div",41)(3,"div",42),k(),T(4,"span",43),l(5),k()()),i&2){let t=e.$implicit,n=m();c(2),ee("height",n.Math.max(4,t.conversions*8),"px"),c(),ee("height",n.Math.max(4,t.triggers*4),"px"),c(2),D(n.formatDate(t.date))}}function BN(i,e){if(i&1&&(T(0,"div",2)(1,"span",44),l(2),k(),T(3,"div",45)(4,"div",46)(5,"span",47),l(6),k(),T(7,"span",5),l(8),k()(),T(9,"div",48),Se(10,"div",49),k()(),T(11,"span",50),l(12),k()()),i&2){let t=e.$implicit;c(2),D(t.icon),c(4),D(t.name),c(2),M("",t.engagements," \u6B21"),c(2),ee("width",t.effectiveness,"%")("background",t.color),c(),ee("color",t.color),c(),M("",t.effectiveness,"%")}}function LN(i,e){if(i&1&&(T(0,"div",51)(1,"span",52),l(2),k(),T(3,"div")(4,"div",53),l(5),k(),T(6,"div",43),l(7),k()()()),i&2){let t=e.$implicit;ee("background-color",t.bgColor),c(2),D(t.icon),c(3),D(t.title),c(2),D(t.description)}}var $c=class i{constructor(){this.workflowService=F(qn);this.ipc=F(Q);this.Math=Math;this.analytics=f({totals:{triggers:0,plans:0,privateChats:0,groupsCreated:0,conversions:0},conversionRate:0,activeExecutions:0,daily:{}});this.trendData=R(()=>{let e=this.analytics().daily||{},t=Object.keys(e).sort().slice(-7);return t.length===0?this.generateMockTrendData():t.map(n=>({date:n,triggers:e[n]?.triggers||0,conversions:e[n]?.conversions||0,rate:e[n]?.triggers?Math.round(e[n]?.conversions/e[n]?.triggers*100):0}))});this.rolePerformance=f([{id:"closer",name:"\u6210\u4EA4\u5C08\u5BB6",icon:"\u{1F4BC}",engagements:45,effectiveness:78,color:"#22c55e"},{id:"expert",name:"\u7522\u54C1\u5C08\u5BB6",icon:"\u{1F393}",engagements:38,effectiveness:72,color:"#3b82f6"},{id:"testimonial",name:"\u898B\u8B49\u8005",icon:"\u2B50",engagements:32,effectiveness:65,color:"#f59e0b"},{id:"supporter",name:"\u5BA2\u670D\u652F\u6301",icon:"\u{1F91D}",engagements:28,effectiveness:58,color:"#8b5cf6"},{id:"connector",name:"\u793E\u4EA4\u9054\u4EBA",icon:"\u{1F31F}",engagements:22,effectiveness:52,color:"#ec4899"}]);this.insights=R(()=>{let e=this.analytics(),t=[];return e.conversionRate>30?t.push({id:"high_conversion",icon:"\u{1F389}",title:"\u8F49\u5316\u7387\u512A\u79C0",description:`\u7576\u524D\u8F49\u5316\u7387 ${e.conversionRate}%\uFF0C\u9AD8\u65BC\u884C\u696D\u5E73\u5747\u6C34\u5E73`,bgColor:"rgba(34, 197, 94, 0.1)"}):e.conversionRate<15&&t.push({id:"low_conversion",icon:"\u26A0\uFE0F",title:"\u8F49\u5316\u7387\u5F85\u63D0\u5347",description:"\u5EFA\u8B70\u512A\u5316\u8A71\u8853\u6A21\u677F\u6216\u8ABF\u6574\u76EE\u6A19\u7528\u6236\u7BE9\u9078\u689D\u4EF6",bgColor:"rgba(245, 158, 11, 0.1)"}),e.activeExecutions>5&&t.push({id:"high_activity",icon:"\u{1F525}",title:"\u9AD8\u6D3B\u8E8D\u5EA6",description:`\u7576\u524D\u6709 ${e.activeExecutions} \u500B\u5DE5\u4F5C\u6D41\u6B63\u5728\u57F7\u884C`,bgColor:"rgba(239, 68, 68, 0.1)"}),t.length===0&&t.push({id:"tip",icon:"\u{1F4A1}",title:"\u63D0\u5347\u5EFA\u8B70",description:"\u5617\u8A66\u555F\u7528\u81EA\u52D5\u5316\u5DE5\u4F5C\u6D41\u4F86\u63D0\u5347\u71DF\u92B7\u6548\u7387",bgColor:"rgba(99, 102, 241, 0.1)"}),t.push({id:"best_time",icon:"\u23F0",title:"\u6700\u4F73\u6642\u6BB5",description:"\u6578\u64DA\u986F\u793A 14:00-18:00 \u7528\u6236\u97FF\u61C9\u7387\u6700\u9AD8",bgColor:"rgba(6, 182, 212, 0.1)"}),t})}ngOnInit(){this.refreshData()}ngOnDestroy(){}refreshData(){this.ipc.send("workflow:get-analytics",{}),setTimeout(()=>{this.analytics.set({totals:{triggers:156,plans:142,privateChats:98,groupsCreated:45,conversions:32},conversionRate:20.5,activeExecutions:3,daily:{}})},500)}generateMockTrendData(){let e=[],t=new Date;for(let n=6;n>=0;n--){let o=new Date(t);o.setDate(o.getDate()-n);let a=o.toISOString().split("T")[0],d=Math.floor(Math.random()*30)+10,u=Math.floor(d*(.15+Math.random()*.2));e.push({date:a,triggers:d,conversions:u,rate:Math.round(u/d*100)})}return e}getConversionColor(){let e=this.analytics().conversionRate;return e>=30?"#22c55e":e>=20?"#f59e0b":"#ef4444"}getConversionDashArray(){let e=this.analytics().conversionRate,t=2*Math.PI*70;return`${e/100*t} ${t}`}getFunnelRate(e){let t=this.analytics().totals;switch(e){case"plan":return t.triggers?Math.round(t.plans/t.triggers*100):0;case"chat":return t.plans?Math.round(t.privateChats/t.plans*100):0;case"group":return t.privateChats?Math.round(t.groupsCreated/t.privateChats*100):0;case"conversion":return t.groupsCreated?Math.round(t.conversions/t.groupsCreated*100):0;default:return 0}}formatDate(e){let t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-workflow-analytics"]],decls:115,vars:14,consts:[[1,"workflow-analytics"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"text-3xl"],[1,"text-xl","font-bold",2,"color","var(--text-primary)"],[1,"text-sm",2,"color","var(--text-muted)"],[1,"px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2",2,"background-color","var(--bg-secondary)","color","var(--text-secondary)",3,"click"],[1,"grid","grid-cols-2","lg:grid-cols-5","gap-4","mb-6"],[1,"rounded-xl","p-4","text-center",2,"background","linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1))","border","1px solid rgba(99, 102, 241, 0.3)"],[1,"text-3xl","font-bold",2,"color","#818cf8"],[1,"rounded-xl","p-4","text-center",2,"background","linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(34, 211, 238, 0.1))","border","1px solid rgba(6, 182, 212, 0.3)"],[1,"text-3xl","font-bold",2,"color","#22d3ee"],[1,"rounded-xl","p-4","text-center",2,"background","linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.1))","border","1px solid rgba(245, 158, 11, 0.3)"],[1,"text-3xl","font-bold",2,"color","#fbbf24"],[1,"rounded-xl","p-4","text-center",2,"background","linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(244, 114, 182, 0.1))","border","1px solid rgba(236, 72, 153, 0.3)"],[1,"text-3xl","font-bold",2,"color","#f472b6"],[1,"rounded-xl","p-4","text-center",2,"background","linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(74, 222, 128, 0.1))","border","1px solid rgba(34, 197, 94, 0.3)"],[1,"text-3xl","font-bold",2,"color","#4ade80"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"rounded-xl","p-5",2,"background-color","var(--bg-card)","border","1px solid var(--border-color)"],[1,"text-lg","font-bold","mb-4","flex","items-center","gap-2",2,"color","var(--text-primary)"],[1,"flex","items-center","justify-center","py-8"],[1,"relative","w-40","h-40"],[1,"w-full","h-full","transform","-rotate-90"],["cx","80","cy","80","r","70","stroke","rgba(100, 116, 139, 0.3)","stroke-width","12","fill","none"],["cx","80","cy","80","r","70","stroke-width","12","fill","none","stroke-linecap","round",1,"transition-all","duration-1000"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center"],[1,"text-4xl","font-bold"],[1,"space-y-2","mt-4"],[1,"flex","items-center","justify-between","text-sm"],[2,"color","var(--text-secondary)"],[2,"color","var(--text-primary)"],[1,"h-48","flex","items-end","justify-between","gap-2","px-2"],[1,"flex-1","flex","flex-col","items-center","gap-1"],[1,"flex","items-center","justify-center","gap-6","mt-4","text-xs",2,"color","var(--text-muted)"],[1,"flex","items-center","gap-1"],[1,"w-3","h-3","rounded",2,"background","linear-gradient(to top, #6366f1, #818cf8)"],[1,"w-3","h-3","rounded",2,"background","linear-gradient(to top, #22c55e, #4ade80)"],[1,"space-y-3"],[1,"p-3","rounded-lg","flex","items-start","gap-3",3,"background-color"],[1,"w-full","flex","flex-col","gap-1"],[1,"w-full","rounded-t","transition-all","duration-500",2,"background","linear-gradient(to top, #22c55e, #4ade80)"],[1,"w-full","rounded-t","transition-all","duration-500",2,"background","linear-gradient(to top, #6366f1, #818cf8)"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"text-2xl"],[1,"flex-1"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","font-medium",2,"color","var(--text-primary)"],[1,"w-full","h-2","rounded-full",2,"background-color","var(--bg-secondary)"],[1,"h-full","rounded-full","transition-all","duration-500"],[1,"text-sm","font-medium"],[1,"p-3","rounded-lg","flex","items-start","gap-3"],[1,"text-xl"],[1,"font-medium","text-sm",2,"color","var(--text-primary)"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"\u{1F4C8}"),k(),T(5,"div")(6,"h2",4),l(7,"\u6578\u64DA\u5206\u6790"),k(),T(8,"p",5),l(9,"\u5DE5\u4F5C\u6D41\u57F7\u884C\u6548\u679C\u8FFD\u8E64"),k()()(),T(10,"button",6),se("click",function(){return n.refreshData()}),T(11,"span"),l(12,"\u{1F504}"),k(),T(13,"span"),l(14,"\u5237\u65B0"),k()()(),T(15,"div",7)(16,"div",8)(17,"div",9),l(18),k(),T(19,"div",5),l(20,"\u7E3D\u89F8\u767C"),k()(),T(21,"div",10)(22,"div",11),l(23),k(),T(24,"div",5),l(25,"AI \u7B56\u5283"),k()(),T(26,"div",12)(27,"div",13),l(28),k(),T(29,"div",5),l(30,"\u79C1\u804A\u5354\u4F5C"),k()(),T(31,"div",14)(32,"div",15),l(33),k(),T(34,"div",5),l(35,"\u5EFA\u7FA4\u6578"),k()(),T(36,"div",16)(37,"div",17),l(38),k(),T(39,"div",5),l(40,"\u6210\u529F\u8F49\u5316"),k()()(),T(41,"div",18)(42,"div",19)(43,"h3",20)(44,"span"),l(45,"\u{1F3AF}"),k(),T(46,"span"),l(47,"\u8F49\u5316\u7387"),k()(),T(48,"div",21)(49,"div",22),ne(),T(50,"svg",23),Se(51,"circle",24)(52,"circle",25),k(),ce(),T(53,"div",26)(54,"span",27),l(55),k(),T(56,"span",5),l(57,"\u8F49\u5316\u7387"),k()()()(),T(58,"div",28)(59,"div",29)(60,"span",30),l(61,"\u89F8\u767C \u2192 \u7B56\u5283"),k(),T(62,"span",31),l(63),k()(),T(64,"div",29)(65,"span",30),l(66,"\u7B56\u5283 \u2192 \u79C1\u804A"),k(),T(67,"span",31),l(68),k()(),T(69,"div",29)(70,"span",30),l(71,"\u79C1\u804A \u2192 \u5EFA\u7FA4"),k(),T(72,"span",31),l(73),k()(),T(74,"div",29)(75,"span",30),l(76,"\u5EFA\u7FA4 \u2192 \u8F49\u5316"),k(),T(77,"span",31),l(78),k()()()(),T(79,"div",19)(80,"h3",20)(81,"span"),l(82,"\u{1F4CA}"),k(),T(83,"span"),l(84,"7 \u65E5\u8DA8\u52E2"),k()(),T(85,"div",32),O(86,VN,6,5,"div",33,NN),k(),T(88,"div",34)(89,"div",35),Se(90,"div",36),T(91,"span"),l(92,"\u89F8\u767C"),k()(),T(93,"div",35),Se(94,"div",37),T(95,"span"),l(96,"\u8F49\u5316"),k()()()(),T(97,"div",19)(98,"h3",20)(99,"span"),l(100,"\u{1F3AD}"),k(),T(101,"span"),l(102,"\u89D2\u8272\u6548\u80FD"),k()(),T(103,"div",38),O(104,BN,13,10,"div",2,g1),k()(),T(106,"div",19)(107,"h3",20)(108,"span"),l(109,"\u{1F4A1}"),k(),T(110,"span"),l(111,"\u5FEB\u901F\u6D1E\u5BDF"),k()(),T(112,"div",38),O(113,LN,8,5,"div",39,g1),k()()()()),t&2&&(c(18),D(n.analytics().totals.triggers),c(5),D(n.analytics().totals.plans),c(5),D(n.analytics().totals.privateChats),c(5),D(n.analytics().totals.groupsCreated),c(5),D(n.analytics().totals.conversions),c(14),_t("stroke",n.getConversionColor())("stroke-dasharray",n.getConversionDashArray()),c(2),ee("color",n.getConversionColor()),c(),M(" ",n.analytics().conversionRate,"% "),c(8),M("",n.getFunnelRate("plan"),"%"),c(5),M("",n.getFunnelRate("chat"),"%"),c(5),M("",n.getFunnelRate("group"),"%"),c(5),M("",n.getFunnelRate("conversion"),"%"),c(8),U(n.trendData()),c(18),U(n.rolePerformance()),c(9),U(n.insights()))},dependencies:[oe],styles:[".workflow-analytics[_ngcontent-%COMP%]{padding:1.5rem}"]})}};var ON=["importFileInput"],UN=["goalInput"],GN=()=>[1,2,3,4,5],In=(i,e)=>e.id,h1=(i,e)=>e.telegramId,$N=(i,e)=>e.step;function HN(i,e){if(i&1&&(r(0,"span",9),B(1,"span",28),l(2),s()),i&2){let t=m();c(2),M(" ",t.multiRoleService.activeGroupCount()," \u500B\u5354\u4F5C\u9032\u884C\u4E2D ")}}function qN(i,e){i&1&&(r(0,"span",10),l(1," \u7121\u6D3B\u8E8D\u5354\u4F5C "),s())}function WN(i,e){if(i&1){let t=I();r(0,"button",29),x("click",function(){let o=_(t).$implicit,a=m();return v(a.activeTab.set(o.id))}),r(1,"span",30),l(2),s(),r(3,"span"),l(4),s()()}if(i&2){let t=e.$implicit,n=m();N("bg-gradient-to-r",n.activeTab()===t.id)("from-purple-500",n.activeTab()===t.id)("to-pink-500",n.activeTab()===t.id)("text-white",n.activeTab()===t.id)("shadow-lg",n.activeTab()===t.id)("text-slate-400",n.activeTab()!==t.id)("hover:text-white",n.activeTab()!==t.id)("hover:bg-slate-700/50",n.activeTab()!==t.id),c(2),D(t.icon),c(2),D(t.label)}}function zN(i,e){if(i&1){let t=I();r(0,"div",21)(1,"div",31)(2,"div",4)(3,"div")(4,"h2",32)(5,"span",7),l(6,"\u{1F916}"),s(),l(7," AI \u667A\u80FD\u7B56\u5283 "),r(8,"span",33),l(9,"NEW"),s()(),r(10,"p",34),l(11,"\u544A\u8A34 AI \u4F60\u7684\u76EE\u6A19\uFF0C\u81EA\u52D5\u751F\u6210\u6700\u4F73\u89D2\u8272\u7D44\u5408\u548C\u57F7\u884C\u7B56\u7565"),s()(),r(12,"button",35),x("click",function(){_(t);let o=m();return v(o.openAIPlanner())}),r(13,"span"),l(14,"\u{1F680}"),s(),l(15," \u958B\u59CB\u7B56\u5283 "),s()(),r(16,"div",36)(17,"span",37),l(18,"\u5FEB\u901F\u9078\u64C7\uFF1A"),s(),r(19,"button",38),x("click",function(){_(t);let o=m();return v(o.quickAIPlan("\u4FC3\u9032\u9996\u55AE\u6210\u4EA4"))}),l(20," \u{1F4B0} \u4FC3\u9032\u9996\u55AE "),s(),r(21,"button",38),x("click",function(){_(t);let o=m();return v(o.quickAIPlan("\u633D\u56DE\u6D41\u5931\u5BA2\u6236"))}),l(22," \u{1F49D} \u633D\u56DE\u6D41\u5931 "),s(),r(23,"button",38),x("click",function(){_(t);let o=m();return v(o.quickAIPlan("\u63D0\u5347\u793E\u7FA4\u6D3B\u8E8D\u5EA6"))}),l(24," \u{1F389} \u793E\u7FA4\u6D3B\u8E8D "),s(),r(25,"button",38),x("click",function(){_(t);let o=m();return v(o.quickAIPlan("\u8655\u7406\u552E\u5F8C\u554F\u984C"))}),l(26," \u{1F527} \u552E\u5F8C\u670D\u52D9 "),s()()(),B(27,"app-collaboration-dashboard"),s()}}function KN(i,e){if(i&1){let t=I();r(0,"app-role-library",39),x("roleAdded",function(o){_(t);let a=m();return v(a.onPresetRoleAdded(o))})("roleEdit",function(o){_(t);let a=m();return v(a.onPresetRoleEdit(o))}),s()}}function jN(i,e){if(i&1){let t=I();r(0,"div",21)(1,"div",4)(2,"div")(3,"h2",40)(4,"span"),l(5,"\u{1F3AC}"),s(),l(6," \u5834\u666F\u6A21\u677F\u5EAB "),s(),r(7,"p",41),l(8,"10\u500B\u9810\u8A2D\u5834\u666F\uFF0C\u5FEB\u901F\u555F\u52D5\u591A\u89D2\u8272\u5354\u4F5C"),s()()(),r(9,"app-scenario-selector",42),x("scenarioApplied",function(o){_(t);let a=m();return v(a.onScenarioApplied(o))}),s()()}}function JN(i,e){if(i&1&&(r(0,"span",57),l(1),s()),i&2){let t=m().$implicit;c(),M(" \u7D81\u5B9A: ",t.boundAccountPhone," ")}}function QN(i,e){i&1&&(r(0,"span",58),l(1," \u672A\u7D81\u5B9A\u5E33\u865F "),s())}function YN(i,e){if(i&1){let t=I();r(0,"div",48)(1,"div",5)(2,"div",53),l(3),s(),r(4,"div")(5,"div",54),l(6),s(),r(7,"div",55),l(8),s(),r(9,"div",56),y(10,JN,2,1,"span",57)(11,QN,2,0,"span",58),r(12,"span",59),l(13),s()()()(),r(14,"div",60)(15,"button",61),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.editRole(o))}),l(16," \u7DE8\u8F2F "),s(),r(17,"button",62),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteRole(o))}),ne(),r(18,"svg",63),B(19,"path",64),s()()()()}if(i&2){let t=e.$implicit,n=m(2);c(2),N("bg-purple-500/20",t.type==="expert")("bg-emerald-500/20",t.type==="satisfied_customer")("bg-cyan-500/20",t.type==="support")("bg-orange-500/20",t.type==="manager")("bg-slate-600",t.type==="custom"),c(),M(" ",n.getRoleIcon(t.type)," "),c(3),D(t.name),c(2),D(t.personality.description),c(2),S(t.boundAccountPhone?10:11),c(3),M(" ",n.getRoleStyleLabel(t.personality.speakingStyle)," ")}}function XN(i,e){if(i&1){let t=I();r(0,"div",49)(1,"div",65),l(2,"\u{1F3AD}"),s(),r(3,"p",66),l(4,"\u5C1A\u672A\u5B9A\u7FA9\u89D2\u8272"),s(),r(5,"p",67),l(6,"\u5275\u5EFA\u89D2\u8272\u4F86\u7D44\u5EFA\u591A\u89D2\u8272\u5354\u4F5C\u5718\u968A"),s(),r(7,"button",68),x("click",function(){_(t);let o=m(2);return v(o.showAddRole.set(!0))}),l(8," + \u5275\u5EFA\u7B2C\u4E00\u500B\u89D2\u8272 "),s()()}}function ZN(i,e){if(i&1){let t=I();r(0,"button",69),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.quickAddRole(o.id))}),r(1,"div",70),l(2),s(),r(3,"div",71),l(4),s(),r(5,"div",72),l(6),s()()}if(i&2){let t=e.$implicit;c(2),D(t.icon),c(2),D(t.label),c(2),D(t.description)}}function eV(i,e){if(i&1){let t=I();r(0,"div",22)(1,"div",43)(2,"div",44)(3,"h3",45)(4,"span"),l(5,"\u{1F3AD}"),s(),l(6," \u89D2\u8272\u5B9A\u7FA9 "),s(),r(7,"button",46),x("click",function(){_(t);let o=m();return v(o.showAddRole.set(!0))}),l(8," + \u6DFB\u52A0\u89D2\u8272 "),s()(),r(9,"div",47),O(10,YN,20,15,"div",48,In,!1,XN,9,0,"div",49),s()(),r(13,"div",43)(14,"h4",50),l(15,"\u5FEB\u901F\u6DFB\u52A0\u9810\u8A2D\u89D2\u8272"),s(),r(16,"div",51),O(17,ZN,7,3,"button",52,In),s()()()}if(i&2){let t=m();c(10),U(t.multiRoleService.roles()),c(7),U(t.roleTypes)}}function tV(i,e){i&1&&(ne(),r(0,"svg",85),B(1,"path",86),s())}function nV(i,e){if(i&1&&(r(0,"div",8)(1,"div",84),l(2),s(),y(3,tV,2,0,":svg:svg",85),s()),i&2){let t=e.$implicit,n=e.$index,o=m(2).$implicit;c(2),M(" ",t.name," "),c(),S(n<o.stages.length-1?3:-1)}}function iV(i,e){if(i&1&&(r(0,"div",82),O(1,nV,4,2,"div",8,In),s()),i&2){let t=m().$implicit;c(),U(t.stages)}}function oV(i,e){if(i&1){let t=I();r(0,"div",73)(1,"div",78)(2,"div")(3,"div",54),l(4),s(),r(5,"div",55),l(6),s()(),r(7,"div",8)(8,"span",79),l(9),s(),r(10,"button",80),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.editScript(o))}),l(11," \u7DE8\u8F2F "),s(),r(12,"button",81),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteScript(o))}),l(13," \u522A\u9664 "),s()()(),y(14,iV,3,0,"div",82),r(15,"div",83)(16,"span"),l(17),s(),r(18,"span"),l(19),s(),r(20,"span"),l(21),s()()()}if(i&2){let t=e.$implicit;c(4),D(t.name),c(2),D(t.description),c(3),M(" ",t.stages.length," \u500B\u968E\u6BB5 "),c(5),S(t.stages.length>0?14:-1),c(3),M("\u4F7F\u7528 ",t.stats.useCount," \u6B21"),c(2),M("\u6210\u529F\u7387 ",(t.stats.conversionRate*100).toFixed(0),"%"),c(2),M("\u5E73\u5747 ",t.stats.avgDuration," \u5206\u9418")}}function rV(i,e){if(i&1){let t=I();r(0,"div",74)(1,"div",87),l(2,"\u{1F4DC}"),s(),r(3,"p"),l(4,"\u5C1A\u672A\u5275\u5EFA\u5287\u672C"),s(),r(5,"button",88),x("click",function(){_(t);let o=m(2);return v(o.addScript())}),l(6," + \u5275\u5EFA\u5287\u672C "),s()()}}function sV(i,e){if(i&1){let t=I();r(0,"div",22)(1,"div",43)(2,"div",44)(3,"h3",45)(4,"span"),l(5,"\u{1F4DC}"),s(),l(6," \u5354\u4F5C\u5287\u672C "),s(),r(7,"button",46),x("click",function(){_(t);let o=m();return v(o.addScript())}),l(8," + \u65B0\u5EFA\u5287\u672C "),s()(),r(9,"div",47),O(10,oV,22,7,"div",73,In,!1,rV,7,0,"div",74),s()(),r(13,"div",43)(14,"h4",50),l(15,"\u4F7F\u7528\u9810\u8A2D\u6A21\u677F"),s(),r(16,"div",75)(17,"button",76),x("click",function(){_(t);let o=m();return v(o.useTemplate("high_intent"))}),r(18,"div",77)(19,"span",7),l(20,"\u{1F3AF}"),s(),r(21,"span",54),l(22,"\u9AD8\u610F\u5411\u5BA2\u6236\u8F49\u5316"),s()(),r(23,"p",55),l(24,"\u5C08\u5BB6\u4ECB\u7D39 + \u8001\u5BA2\u6236\u80CC\u66F8 + \u5BA2\u670D\u4FC3\u55AE"),s()(),r(25,"button",76),x("click",function(){_(t);let o=m();return v(o.useTemplate("product_demo"))}),r(26,"div",77)(27,"span",7),l(28,"\u{1F4E6}"),s(),r(29,"span",54),l(30,"\u7522\u54C1\u6F14\u793A\u63A8\u85A6"),s()(),r(31,"p",55),l(32,"\u529F\u80FD\u5C55\u793A + \u4F7F\u7528\u5834\u666F + \u6548\u679C\u5206\u4EAB"),s()()()()()}if(i&2){let t=m();c(10),U(t.multiRoleService.scripts())}}function aV(i,e){i&1&&(r(0,"div",49)(1,"div",65),l(2,"\u{1F3E0}"),s(),r(3,"p",66),l(4,"\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44"),s(),r(5,"p",67),l(6,"\u7576\u89F8\u767C\u591A\u89D2\u8272\u5354\u4F5C\u6642\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u5EFA\u7ACB\u5354\u4F5C\u7FA4\u7D44"),s(),r(7,"p",14),l(8,"\u{1F4A1} \u63D0\u793A\uFF1A\u5148\u5728\u300C\u6211\u7684\u89D2\u8272\u300D\u4E2D\u6DFB\u52A0\u89D2\u8272\u4E26\u7D81\u5B9A\u5E33\u865F"),s()())}function lV(i,e){if(i&1){let t=I();r(0,"div",49)(1,"div",65),l(2,"\u{1F3E0}"),s(),r(3,"p",66),l(4,"\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44"),s(),r(5,"p",67),l(6),s(),r(7,"button",68),x("click",function(){_(t);let o=m(2);return v(o.showCreateGroupDialog.set(!0))}),l(8," + \u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44 "),s()()}if(i&2){let t=m(2);c(6),M("\u60A8\u5DF2\u6709 ",t.multiRoleService.roles().length," \u500B\u89D2\u8272\u5C31\u7DD2")}}function cV(i,e){if(i&1&&(r(0,"div",22)(1,"div",43)(2,"div",44)(3,"h3",45)(4,"span"),l(5,"\u{1F3E0}"),s(),l(6," \u5354\u4F5C\u7FA4\u7D44 "),s(),r(7,"button",89),l(8," + \u624B\u52D5\u5275\u5EFA "),s()(),y(9,aV,9,0,"div",49)(10,lV,9,1,"div",49),s()()),i&2){let t=m();c(9),S(t.multiRoleService.roles().length===0?9:10)}}function dV(i,e){i&1&&B(0,"app-workflow-config")}function uV(i,e){i&1&&B(0,"app-workflow-monitor")}function mV(i,e){i&1&&B(0,"app-workflow-analytics")}function pV(i,e){if(i&1){let t=I();r(0,"div",23)(1,"div",43)(2,"h3",90)(3,"span"),l(4,"\u2699\uFE0F"),s(),l(5," \u81EA\u52D5\u5EFA\u7FA4\u8A2D\u7F6E "),s(),r(6,"div",47)(7,"div")(8,"label",91),l(9,"\u7FA4\u540D\u6A21\u677F"),s(),r(10,"input",92),W("ngModelChange",function(o){_(t);let a=m();return q(a.autoGroupNameTemplate,o)||(a.autoGroupNameTemplate=o),v(o)}),s(),r(11,"p",93),l(12),s()(),r(13,"div")(14,"label",91),l(15,"\u9080\u8ACB\u8A71\u8853"),s(),r(16,"textarea",94),W("ngModelChange",function(o){_(t);let a=m();return q(a.inviteMessage,o)||(a.inviteMessage=o),v(o)}),l(17,"                    "),s()(),r(18,"div",75)(19,"div")(20,"label",91),l(21,"\u6700\u5927\u540C\u6642\u5354\u4F5C\u6578"),s(),r(22,"input",95),W("ngModelChange",function(o){_(t);let a=m();return q(a.maxConcurrent,o)||(a.maxConcurrent=o),v(o)}),s()(),r(23,"div")(24,"label",91),l(25,"\u81EA\u52D5\u95DC\u9589\u5929\u6578"),s(),r(26,"input",96),W("ngModelChange",function(o){_(t);let a=m();return q(a.autoCloseDays,o)||(a.autoCloseDays=o),v(o)}),s()()()()(),r(27,"div",43)(28,"h3",90)(29,"span"),l(30,"\u{1F3AF}"),s(),l(31," \u9ED8\u8A8D\u89F8\u767C\u689D\u4EF6 "),s(),r(32,"div",47)(33,"div",75)(34,"div")(35,"label",91),l(36,"\u610F\u5411\u8A55\u5206\u95BE\u503C"),s(),r(37,"div",8)(38,"input",97),W("ngModelChange",function(o){_(t);let a=m();return q(a.intentThreshold,o)||(a.intentThreshold=o),v(o)}),s(),r(39,"span",98),l(40),s()()(),r(41,"div")(42,"label",91),l(43,"\u6700\u5C11\u5C0D\u8A71\u8F2A\u6578"),s(),r(44,"input",95),W("ngModelChange",function(o){_(t);let a=m();return q(a.minRounds,o)||(a.minRounds=o),v(o)}),s()()(),r(45,"label",99)(46,"div")(47,"div",100),l(48,"\u9700\u8981\u8A62\u554F\u904E\u50F9\u683C"),s(),r(49,"div",101),l(50,"\u53EA\u6709\u8A62\u554F\u904E\u50F9\u683C\u7684\u5BA2\u6236\u624D\u89F8\u767C"),s()(),r(51,"input",102),W("ngModelChange",function(o){_(t);let a=m();return q(a.requirePriceInquiry,o)||(a.requirePriceInquiry=o),v(o)}),s()()()(),r(52,"div",43)(53,"h3",90)(54,"span"),l(55,"\u{1F916}"),s(),l(56," AI \u8A2D\u7F6E "),s(),r(57,"label",103)(58,"div")(59,"div",100),l(60,"\u4F7F\u7528 AI \u4E2D\u5FC3\u914D\u7F6E"),s(),r(61,"div",101),l(62,"\u5F9E AI \u4E2D\u5FC3\u7372\u53D6\u6A21\u578B\u548C\u77E5\u8B58\u5EAB\u914D\u7F6E"),s()(),r(63,"input",102),W("ngModelChange",function(o){_(t);let a=m();return q(a.useAICenter,o)||(a.useAICenter=o),v(o)}),s()(),r(64,"div")(65,"label",91),l(66,"\u5354\u4F5C\u6A21\u5F0F"),s(),r(67,"div",104)(68,"button",105),x("click",function(){_(t);let o=m();return v(o.coordinationMode="sequential")}),l(69," \u9806\u5E8F\u57F7\u884C "),s(),r(70,"button",105),x("click",function(){_(t);let o=m();return v(o.coordinationMode="responsive")}),l(71," \u97FF\u61C9\u5F0F "),s()()()(),r(72,"button",106),x("click",function(){_(t);let o=m();return v(o.saveSettings())}),l(73," \u4FDD\u5B58\u8A2D\u7F6E "),s()()}if(i&2){let t=m();c(10),H("ngModel",t.autoGroupNameTemplate),c(2),X("\u53EF\u7528\u8B8A\u91CF: ","{","\u5BA2\u6236\u540D","}"),c(4),H("ngModel",t.inviteMessage),c(6),H("ngModel",t.maxConcurrent),c(4),H("ngModel",t.autoCloseDays),c(12),H("ngModel",t.intentThreshold),c(2),M("",t.intentThreshold,"%"),c(4),H("ngModel",t.minRounds),c(7),H("ngModel",t.requirePriceInquiry),c(12),H("ngModel",t.useAICenter),c(5),N("bg-purple-500",t.coordinationMode==="sequential")("text-white",t.coordinationMode==="sequential")("bg-slate-700",t.coordinationMode!=="sequential")("text-slate-300",t.coordinationMode!=="sequential"),c(2),N("bg-purple-500",t.coordinationMode==="responsive")("text-white",t.coordinationMode==="responsive")("bg-slate-700",t.coordinationMode!=="responsive")("text-slate-300",t.coordinationMode!=="responsive")}}function gV(i,e){if(i&1){let t=I();r(0,"button",117),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.newRoleType.set(o.id))}),r(1,"div",118),l(2),s(),r(3,"div",119),l(4),s()()}if(i&2){let t=e.$implicit,n=m(2);N("border-purple-500",n.newRoleType()===t.id)("bg-purple-500/10",n.newRoleType()===t.id)("border-transparent",n.newRoleType()!==t.id)("bg-slate-700",n.newRoleType()!==t.id),c(2),D(t.icon),c(),N("text-purple-400",n.newRoleType()===t.id)("text-slate-300",n.newRoleType()!==t.id),c(),M(" ",t.label," ")}}function hV(i,e){if(i&1){let t=I();r(0,"div",24)(1,"div",107)(2,"h3",108),l(3,"\u6DFB\u52A0\u89D2\u8272"),s(),r(4,"div",47)(5,"div")(6,"label",91),l(7,"\u89D2\u8272\u985E\u578B"),s(),r(8,"div",109),O(9,gV,5,14,"button",110,In),s()(),r(11,"div")(12,"label",91),l(13,"\u89D2\u8272\u540D\u7A31"),s(),r(14,"input",111),W("ngModelChange",function(o){_(t);let a=m();return q(a.newRoleName,o)||(a.newRoleName=o),v(o)}),s()(),r(15,"div")(16,"label",91),l(17,"\u4EBA\u8A2D\u63CF\u8FF0"),s(),r(18,"textarea",112),W("ngModelChange",function(o){_(t);let a=m();return q(a.newRoleDescription,o)||(a.newRoleDescription=o),v(o)}),l(19,"                "),s()(),r(20,"div")(21,"label",91),l(22,"AI \u4EBA\u8A2D Prompt"),s(),r(23,"textarea",113),W("ngModelChange",function(o){_(t);let a=m();return q(a.newRolePrompt,o)||(a.newRolePrompt=o),v(o)}),l(24,"                "),s()()(),r(25,"div",114)(26,"button",115),x("click",function(){_(t);let o=m();return v(o.showAddRole.set(!1))}),l(27," \u53D6\u6D88 "),s(),r(28,"button",116),x("click",function(){_(t);let o=m();return v(o.saveNewRole())}),l(29," \u6DFB\u52A0 "),s()()()()}if(i&2){let t=m();c(9),U(t.roleTypes),c(5),H("ngModel",t.newRoleName),c(4),H("ngModel",t.newRoleDescription),c(5),H("ngModel",t.newRolePrompt)}}function fV(i,e){if(i&1){let t=I();r(0,"app-role-editor",120),x("saved",function(o){_(t);let a=m();return v(a.onRoleSaved(o))})("cancelled",function(){_(t);let o=m();return v(o.onRoleEditorCancelled())}),s()}if(i&2){let t=m();L("role",t.editingRole())("availableAccounts",t.availableAccounts())}}function _V(i,e){if(i&1){let t=I();r(0,"app-script-editor",121),x("saved",function(o){_(t);let a=m();return v(a.onScriptSaved(o))})("cancelled",function(){_(t);let o=m();return v(o.onScriptEditorCancelled())}),s()}if(i&2){let t=m();L("script",t.editingScript())}}function vV(i,e){if(i&1){let t=I();r(0,"div")(1,"label",91),l(2,"\u{1F3AF} \u544A\u8A34 AI \u4F60\u60F3\u9054\u6210\u4EC0\u9EBC\u76EE\u6A19"),s(),r(3,"textarea",129,0),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.aiPlannerGoal,o)||(a.aiPlannerGoal=o),v(o)}),x("click",function(o){return _(t),v(o.stopPropagation())}),l(5,"                  "),s()(),r(6,"div")(7,"label",91),l(8,"\u6216\u9078\u64C7\u5E38\u898B\u76EE\u6A19"),s(),r(9,"div",130)(10,"button",131),x("click",function(){_(t);let o=m(2);return v(o.aiPlannerGoal="\u628A\u7336\u8C6B\u4E0D\u6C7A\u7684\u6F5B\u5728\u5BA2\u6236\u8F49\u5316\u70BA\u4ED8\u8CBB\u7528\u6236")}),r(11,"div",132),l(12,"\u{1F4B0}"),s(),r(13,"div",71),l(14,"\u4FC3\u9032\u9996\u55AE\u6210\u4EA4"),s(),r(15,"div",101),l(16,"\u591A\u89D2\u8272\u914D\u5408\u4FC3\u9032\u7336\u8C6B\u5BA2\u6236\u4E0B\u55AE"),s()(),r(17,"button",131),x("click",function(){_(t);let o=m(2);return v(o.aiPlannerGoal="\u633D\u56DE\u5DF2\u6D41\u5931\u7684\u8001\u5BA2\u6236\uFF0C\u8B93\u4ED6\u5011\u91CD\u65B0\u8CFC\u8CB7")}),r(18,"div",132),l(19,"\u{1F49D}"),s(),r(20,"div",71),l(21,"\u633D\u56DE\u6D41\u5931\u5BA2\u6236"),s(),r(22,"div",101),l(23,"\u95DC\u61F7\u56DE\u8A2A + \u7279\u5225\u512A\u60E0"),s()(),r(24,"button",131),x("click",function(){_(t);let o=m(2);return v(o.aiPlannerGoal="\u8B93\u793E\u7FA4\u66F4\u6D3B\u8E8D\uFF0C\u589E\u52A0\u7528\u6236\u4E92\u52D5\u548C\u7C98\u6027")}),r(25,"div",132),l(26,"\u{1F389}"),s(),r(27,"div",71),l(28,"\u63D0\u5347\u793E\u7FA4\u6D3B\u8E8D"),s(),r(29,"div",101),l(30,"\u8A71\u984C\u5F15\u5C0E + \u4E92\u52D5\u6FC0\u52F5"),s()(),r(31,"button",131),x("click",function(){_(t);let o=m(2);return v(o.aiPlannerGoal="\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C\uFF0C\u63D0\u5347\u6EFF\u610F\u5EA6")}),r(32,"div",132),l(33,"\u{1F527}"),s(),r(34,"div",71),l(35,"\u552E\u5F8C\u554F\u984C\u8655\u7406"),s(),r(36,"div",101),l(37,"\u5FEB\u901F\u97FF\u61C9 + \u6EFF\u610F\u5EA6\u8DDF\u9032"),s()()()()}if(i&2){let t=m(2);c(3),H("ngModel",t.aiPlannerGoal)}}function xV(i,e){if(i&1&&(r(0,"div",136)(1,"div",138),B(2,"div",139),s(),r(3,"span",14),l(4),s()()),i&2){let t=m(3);c(2),ee("width",t.Math.min(t.aiPlanningElapsed()/45*100,95),"%"),c(2),M("",t.aiPlanningElapsed(),"\u79D2")}}function CV(i,e){if(i&1&&(r(0,"div",126)(1,"div",133),l(2,"\u{1F916}"),s(),r(3,"p",134),l(4),s(),r(5,"p",135),l(6,"\u5206\u6790\u76EE\u6A19 \u2192 \u9078\u64C7\u89D2\u8272 \u2192 \u8A2D\u8A08\u6D41\u7A0B"),s(),y(7,xV,5,3,"div",136),r(8,"p",137),l(9,"AI \u8ABF\u7528\u53EF\u80FD\u9700\u8981 30-45 \u79D2\uFF0C\u8ACB\u8010\u5FC3\u7B49\u5F85"),s()()),i&2){let t=m(2);c(4),D(t.aiPlanningProgress()),c(3),S(t.aiPlanningElapsed()>0?7:-1)}}function bV(i,e){if(i&1&&(r(0,"span",194),l(1),s()),i&2){let t=e.$implicit;c(),D(t)}}function yV(i,e){if(i&1&&(r(0,"div",192)(1,"div",191),l(2,"\u5BA2\u6236\u75DB\u9EDE"),s(),r(3,"div",193),O(4,bV,2,1,"span",194,be),s()()),i&2){let t=m(4);c(4),U(t.aiPlanResult().goalAnalysis.painPoints)}}function SV(i,e){if(i&1&&(r(0,"span",195),l(1),s()),i&2){let t=e.$implicit;c(),D(t)}}function wV(i,e){if(i&1&&(r(0,"div",192)(1,"div",191),l(2,"\u7522\u54C1\u512A\u52E2"),s(),r(3,"div",193),O(4,SV,2,1,"span",195,be),s()()),i&2){let t=m(4);c(4),U(t.aiPlanResult().goalAnalysis.keySellingPoints)}}function EV(i,e){if(i&1&&(r(0,"div",140)(1,"h4",189)(2,"span"),l(3,"\u{1F3AF}"),s(),l(4," \u76EE\u6A19\u5206\u6790 "),s(),r(5,"div",190)(6,"div")(7,"div",191),l(8,"\u7522\u54C1\u985E\u578B"),s(),r(9,"div",100),l(10),s()(),r(11,"div")(12,"div",191),l(13,"\u76EE\u6A19\u5BA2\u6236"),s(),r(14,"div",100),l(15),s()()(),y(16,yV,6,0,"div",192),y(17,wV,6,0,"div",192),s()),i&2){let t,n,o,a,d=m(3);c(10),D((t=d.aiPlanResult())==null||t.goalAnalysis==null?null:t.goalAnalysis.productType),c(5),D((n=d.aiPlanResult())==null||n.goalAnalysis==null?null:n.goalAnalysis.targetAudience),c(),S(!((o=d.aiPlanResult())==null||o.goalAnalysis==null||o.goalAnalysis.painPoints==null)&&o.goalAnalysis.painPoints.length?16:-1),c(),S(!((a=d.aiPlanResult())==null||a.goalAnalysis==null||a.goalAnalysis.keySellingPoints==null)&&a.goalAnalysis.keySellingPoints.length?17:-1)}}function DV(i,e){i&1&&(r(0,"span",145),l(1," \u{1F916} AI \u751F\u6210 "),s())}function AV(i,e){i&1&&(r(0,"span",146),l(1," \u{1F4CB} \u6A21\u677F\u7B56\u7565 "),s())}function MV(i,e){i&1&&(r(0,"span",155),l(1,"\uFF08\u4E0D\u8DB3\uFF01\uFF09"),s())}function TV(i,e){if(i&1){let t=I();r(0,"div",156)(1,"div",196)(2,"span"),l(3,"\u26A0\uFE0F"),s(),r(4,"span"),l(5),s()(),r(6,"button",197),x("click",function(){_(t);let o=m(3);return v(o.goToAccountManagement())}),l(7," \u2795 \u6DFB\u52A0\u66F4\u591A\u5E33\u865F "),s()()}if(i&2){let t=m(3);c(5),X("\u5E33\u865F\u4E0D\u8DB3\uFF01\u9700\u8981 ",t.requiredAccountsForGroup()," \u500B\u5E33\u865F\uFF0C\u7576\u524D\u53EA\u6709 ",t.availableAccountCount()," \u500B\u5728\u7DDA\u3002")}}function kV(i,e){i&1&&(r(0,"div",157)(1,"div",198),l(2,"\u{1F3AC} \u7FA4\u804A\u5354\u4F5C\u6D41\u7A0B"),s(),r(3,"div",199)(4,"span",200),l(5,"\u2460 \u5EFA\u7FA4"),s(),r(6,"span"),l(7,"\u2192"),s(),r(8,"span",200),l(9,"\u2461 \u9080\u8ACB\u5BA2\u6236"),s(),r(10,"span"),l(11,"\u2192"),s(),r(12,"span",200),l(13,"\u2462 \u9080\u8ACB\u89D2\u8272"),s(),r(14,"span"),l(15,"\u2192"),s(),r(16,"span",200),l(17,"\u2463 \u5354\u4F5C\u670D\u52D9"),s()()())}function IV(i,e){if(i&1){let t=I();r(0,"div",162)(1,"div",201),l(2,"\u8ACB\u9078\u64C7\u8981\u9032\u884C\u71DF\u92B7\u7684\u76EE\u6A19\u7528\u6236"),s(),r(3,"div",202)(4,"button",203),x("click",function(){_(t);let o=m(3);return v(o.openTargetUserSelector())}),l(5," \u{1F4D2} \u5F9E\u901A\u8A0A\u9304\u9078\u64C7 "),s(),r(6,"button",204),x("click",function(){_(t);let o=m(3);return v(o.selectHighIntentUsers())}),l(7," \u2B50 \u81EA\u52D5\u9078\u9AD8\u610F\u5411 "),s(),r(8,"button",205),x("click",function(){_(t);let o=m(3);return v(o.triggerImportFile())}),l(9," \u{1F4E5} \u6279\u91CF\u5C0E\u5165 "),s()(),r(10,"input",206,1),x("change",function(o){_(t);let a=m(3);return v(a.handleImportFile(o))}),s()()}}function FV(i,e){if(i&1&&(r(0,"span",210),l(1),r(2,"span",212),l(3),s()()),i&2){let t=e.$implicit;c(),M(" ",t.firstName||t.username||t.telegramId," "),c(2),M("",t.intentScore,"\u5206")}}function PV(i,e){if(i&1&&(r(0,"span",211),l(1),s()),i&2){let t=m(4);c(),M(" +",t.selectedTargetUsers().length-5," \u66F4\u591A ")}}function RV(i,e){if(i&1){let t=I();r(0,"div",142)(1,"span",207),l(2),s(),r(3,"div",104)(4,"button",208),x("click",function(){_(t);let o=m(3);return v(o.openTargetUserSelector())}),l(5," \u4FEE\u6539 "),s(),r(6,"button",209),x("click",function(){_(t);let o=m(3);return v(o.clearSelectedUsers())}),l(7," \u6E05\u7A7A "),s()()(),r(8,"div",193),O(9,FV,4,2,"span",210,h1),y(11,PV,2,1,"span",211),s()}if(i&2){let t=m(3);c(2),M(" \u2713 \u5DF2\u9078\u64C7 ",t.selectedTargetUsers().length," \u500B\u76EE\u6A19 "),c(7),U(t.selectedTargetUsers().slice(0,5)),c(2),S(t.selectedTargetUsers().length>5?11:-1)}}function NV(i,e){i&1&&(r(0,"span",165),l(1,"AI \u81EA\u52D5\u5206\u914D"),s())}function VV(i,e){if(i&1&&(r(0,"span",166),l(1),s()),i&2){let t=m(3);c(),M(" \u5DF2\u9078 ",t.plannerSelectedAccounts().length," \u500B\u5E33\u865F ")}}function BV(i,e){if(i&1){let t=I();r(0,"button",221),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.plannerAccountCount.set(a.Math.min(o,a.availableAccountCount())))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(4);N("bg-purple-500",n.plannerAccountCount()===t)("text-white",n.plannerAccountCount()===t)("bg-slate-700",n.plannerAccountCount()!==t)("text-slate-400",n.plannerAccountCount()!==t),L("disabled",t>n.availableAccountCount()),c(),M(" ",t," ")}}function LV(i,e){if(i&1&&(r(0,"option",233),l(1),s()),i&2){let t=e.$implicit;L("value",t.id),c(),X("",t.icon," ",t.name)}}function OV(i,e){if(i&1){let t=I();r(0,"div",230)(1,"select",231),x("click",function(o){return _(t),v(o.stopPropagation())})("change",function(o){_(t);let a=m(2).$implicit,d=m(5);return v(d.onAccountRoleChange(a.id,o))}),r(2,"option",232),l(3,"\u{1F916} AI \u5206\u914D\u89D2\u8272"),s(),O(4,LV,2,3,"option",233,In),s()()}if(i&2){let t=m(2).$implicit,n=m(5);c(),L("value",n.plannerAccountRoles().get(t.id)||""),c(3),U(n.availableRoleTypes)}}function UV(i,e){if(i&1){let t=I();r(0,"button",227),x("click",function(){_(t);let o=m().$implicit,a=m(5);return v(a.toggleAccountSelection(o.id))}),r(1,"div",8),B(2,"span",228),r(3,"span",229),l(4),s()(),y(5,OV,6,1,"div",230),s()}if(i&2){let t=m().$implicit,n=m(5);N("border-purple-500",n.plannerSelectedAccounts().includes(t.id))("bg-purple-500/10",n.plannerSelectedAccounts().includes(t.id))("border-slate-700",!n.plannerSelectedAccounts().includes(t.id))("bg-slate-800",!n.plannerSelectedAccounts().includes(t.id)),c(4),D(t.phone),c(),S(n.plannerSelectedAccounts().includes(t.id)?5:-1)}}function GV(i,e){if(i&1&&y(0,UV,6,10,"button",226),i&2){let t=e.$implicit;S(t.status==="Online"?0:-1)}}function $V(i,e){if(i&1&&(r(0,"span",235),l(1),r(2,"span",236),l(3,"\u2192"),s(),l(4),s()),i&2){let t=e.$implicit,n=m(6);c(),M(" ",n.getAccountPhone(t)," "),c(3),M(" ",n.getAssignedRoleName(t)," ")}}function HV(i,e){if(i&1&&(r(0,"div",225)(1,"div",234),l(2,"\u5DF2\u9078\u5E33\u865F\u89D2\u8272\u9810\u89BD\uFF1A"),s(),r(3,"div",193),O(4,$V,5,2,"span",235,be),s()()),i&2){let t=m(5);c(4),U(t.plannerSelectedAccounts())}}function qV(i,e){if(i&1){let t=I();r(0,"div")(1,"div",142)(2,"label",55),l(3,"\u9078\u64C7\u5E33\u865F\uFF08\u9EDE\u64CA\u9078\u64C7/\u53D6\u6D88\uFF09"),s(),r(4,"div",104)(5,"button",222),x("click",function(){_(t);let o=m(4);return v(o.selectAllOnlineAccounts())}),l(6,"\u5168\u9078\u5728\u7DDA"),s(),r(7,"button",223),x("click",function(){_(t);let o=m(4);return v(o.plannerSelectedAccounts.set([]))}),l(8,"\u6E05\u7A7A"),s()()(),r(9,"div",224),O(10,GV,1,1,null,null,In),s(),y(12,HV,6,0,"div",225),s()}if(i&2){let t=m(4);c(10),U(t.accountService.accounts()),c(2),S(t.plannerSelectedAccounts().length>0?12:-1)}}function WV(i,e){if(i&1){let t=I();r(0,"div",168)(1,"div")(2,"div",142)(3,"label",55),l(4,"\u53C3\u8207\u5E33\u865F\u6578\u91CF"),s(),r(5,"div",8)(6,"span",134),l(7),s(),r(8,"span",14),l(9),s()()(),r(10,"div",60)(11,"input",213),x("input",function(o){_(t);let a=m(3);return v(a.onAccountCountChange(o))}),s(),r(12,"div",214),O(13,BV,2,10,"button",215,be),s()(),r(15,"div",216),l(16),s()(),r(17,"div",217)(18,"div")(19,"div",218),l(20,"AI \u81EA\u52D5\u5206\u914D\u5E33\u865F\u548C\u89D2\u8272"),s(),r(21,"div",14),l(22,"\u95DC\u9589\u5F8C\u53EF\u624B\u52D5\u9078\u64C7\u5E33\u865F\u4E26\u6307\u5B9A\u89D2\u8272"),s()(),r(23,"button",219),x("click",function(){_(t);let o=m(3);return v(o.plannerAutoAssign.set(!o.plannerAutoAssign()))}),B(24,"span",220),s()(),y(25,qV,13,1,"div"),s()}if(i&2){let t=m(3);c(7),D(t.plannerAccountCount()),c(2),M("/ ",t.availableAccountCount()," \u53EF\u7528"),c(2),L("min",1)("max",t.Math.min(5,t.availableAccountCount()))("value",t.plannerAccountCount()),c(2),U(rt(15,GN)),c(3),M(" \u{1F916} AI \u63A8\u85A6\uFF1A",t.getRecommendedAccountCount()," \u500B\u5E33\u865F\uFF08\u57FA\u65BC\u76EE\u6A19\u5206\u6790\uFF09 "),c(7),N("bg-purple-500",t.plannerAutoAssign())("bg-slate-600",!t.plannerAutoAssign()),c(),N("left-1",!t.plannerAutoAssign())("left-7",t.plannerAutoAssign()),c(),S(t.plannerAutoAssign()?-1:25)}}function zV(i,e){if(i&1){let t=I();r(0,"button",237),x("click",function(){_(t);let o=m(3);return v(o.toggleAccountExplanation())}),l(1," \u{1F4A1} \u70BA\u4EC0\u9EBC\uFF1F "),s()}}function KV(i,e){if(i&1&&(r(0,"div",170)(1,"div",238)(2,"span",236),l(3,"\u{1F4A1}"),s(),r(4,"div",147)(5,"p",239),l(6,"AI \u63A8\u85A6 "),r(7,"strong",236),l(8),s(),l(9," \u500B\u89D2\u8272\uFF1A"),s(),r(10,"ul",240)(11,"li"),l(12,"\u904E\u591A\u5E33\u865F\u53EF\u80FD\u5C0E\u81F4\u904E\u5EA6\u66DD\u5149\uFF0C\u5F15\u8D77\u7528\u6236\u8B66\u89BA"),s(),r(13,"li"),l(14,"\u89D2\u8272\u5206\u5DE5\u660E\u78BA\uFF0C\u6BCF\u500B\u89D2\u8272\u6709\u7368\u7279\u4F5C\u7528"),s(),r(15,"li"),l(16,"\u5269\u9918\u5E33\u865F\u53EF\u4F5C\u70BA\u5099\u7528\uFF0C\u96A8\u6642\u66FF\u88DC"),s()()()()()),i&2){let t,n=m(3);c(8),D(((t=n.aiPlanResult())==null||t.recommendedRoles==null?null:t.recommendedRoles.length)||0)}}function jV(i,e){if(i&1&&(r(0,"div",8),B(1,"span",249),r(2,"span",100),l(3),s()()),i&2){let t=m().$index,n=m(3);c(3),D(n.accountMatchResults()[t].accountPhone)}}function JV(i,e){i&1&&(r(0,"span",242),l(1,"\u5F85\u5206\u914D..."),s())}function QV(i,e){i&1&&(r(0,"span",243),l(1,"\u4E3B\u5C0E"),s())}function YV(i,e){i&1&&(r(0,"span",166),l(1,"\u5F85\u547D"),s())}function XV(i,e){i&1&&(r(0,"span",244),l(1,"\u5339\u914D\u4E2D"),s())}function ZV(i,e){i&1&&(r(0,"span",258),l(1,"\u7576\u524D"),s())}function eB(i,e){if(i&1){let t=I();r(0,"button",256),x("click",function(){let o=_(t).$implicit,a=m(2).$index,d=m(3);return v(d.changeRoleForIndex(a,o))}),r(1,"span",30),l(2),s(),r(3,"div",257)(4,"div",100),l(5),s(),r(6,"div",14),l(7),s()(),y(8,ZV,2,0,"span",258),s()}if(i&2){let t=e.$implicit,n=m(2).$implicit;N("bg-purple-500/20",n.name===t.name),c(2),D(t.icon),c(3),D(t.name),c(2),D(t.desc),c(),S(n.name===t.name?8:-1)}}function tB(i,e){if(i&1){let t=I();r(0,"div",250),x("click",function(o){return _(t),v(o.stopPropagation())}),r(1,"div",251)(2,"span",101),l(3,"\u{1F504} \u9078\u64C7\u65B0\u89D2\u8272"),s()(),r(4,"div",252),O(5,eB,9,6,"button",253,In),s(),r(7,"div",254)(8,"button",255),x("click",function(){_(t);let o=m().$index,a=m(3);return v(a.removeRoleAssignment(o))}),r(9,"span"),l(10,"\u{1F5D1}\uFE0F"),s(),r(11,"span"),l(12,"\u79FB\u70BA\u5099\u7528"),s()()()()}if(i&2){let t=m(4);c(5),U(t.availableRoleTypes)}}function nB(i,e){if(i&1){let t=I();r(0,"tr",179)(1,"td",241),y(2,jV,4,1,"div",8)(3,JV,2,0,"span",242),s(),r(4,"td",241)(5,"div",8)(6,"span",30),l(7),s(),r(8,"div")(9,"div",100),l(10),s(),r(11,"div",14),l(12),s()()()(),r(13,"td",176),y(14,QV,2,0,"span",243)(15,YV,2,0,"span",166)(16,XV,2,0,"span",244),s(),r(17,"td",245)(18,"div",246)(19,"button",247),x("click",function(o){let a=_(t).$index,d=m(3);return v(d.toggleRoleDropdown(a,o))}),l(20," \u66F4\u63DB "),r(21,"span"),l(22,"\u25BC"),s()(),y(23,tB,13,0,"div",248),s()()()}if(i&2){let t=e.$implicit,n=e.$index,o=m(3);c(2),S(o.accountMatchResults().length>n?2:3),c(5),D(t.icon),c(3),D(t.name),c(2),D(t.purpose),c(2),S(n===0?14:o.accountMatchResults().length>n?15:16),c(7),N("rotate-180",o.roleChangeModalIndex()===n),c(2),S(o.roleChangeModalIndex()===n?23:-1)}}function iB(i,e){if(i&1){let t=I();r(0,"button",256),x("click",function(){let o=_(t).$implicit,a=m(2).$implicit,d=m(3);return v(d.assignBackupToRole(a.id,o))}),r(1,"span",30),l(2),s(),r(3,"div",257)(4,"div",100),l(5),s(),r(6,"div",14),l(7),s()()()}if(i&2){let t=e.$implicit;c(2),D(t.icon),c(3),D(t.name),c(2),D(t.desc)}}function oB(i,e){if(i&1){let t=I();r(0,"div",250),x("click",function(o){return _(t),v(o.stopPropagation())}),r(1,"div",251)(2,"span",101),l(3,"\u{1F4CB} \u5206\u914D\u89D2\u8272"),s()(),r(4,"div",252),O(5,iB,8,3,"button",262,In),s(),r(7,"div",254)(8,"button",263),x("click",function(){_(t);let o=m(4);return v(o.closeBackupDropdown())}),r(9,"span"),l(10,"\u26AA"),s(),r(11,"span"),l(12,"\u4FDD\u6301\u5099\u7528"),s()()()()}if(i&2){let t=m(4);c(5),U(t.availableRoleTypes)}}function rB(i,e){if(i&1){let t=I();r(0,"tr",180)(1,"td",241)(2,"div",8),B(3,"span",259),r(4,"span",186),l(5),s()()(),r(6,"td",241)(7,"span",242),l(8,"\u26AA \u5099\u7528\u5E33\u865F"),s()(),r(9,"td",176)(10,"span",260),l(11,"\u9592\u7F6E"),s()(),r(12,"td",245)(13,"div",246)(14,"button",261),x("click",function(o){let a=_(t).$implicit,d=m(3);return v(d.toggleBackupDropdown(a.id,o))}),l(15," \u5206\u914D "),r(16,"span"),l(17,"\u25BC"),s()(),y(18,oB,13,0,"div",248),s()()()}if(i&2){let t=e.$implicit,n=m(3);c(5),D(t.phone),c(11),N("rotate-180",n.backupDropdownId()===t.id),c(2),S(n.backupDropdownId()===t.id?18:-1)}}function sB(i,e){if(i&1&&(r(0,"div",181)(1,"div",264),l(2,"\u{1F4AC} \u958B\u5834\u767D\u9810\u89BD"),s(),r(3,"div",265),l(4),s()()),i&2){let t,n=m(3);c(4),M('"',(t=n.aiPlanResult())==null||t.recommendedRoles==null||t.recommendedRoles[0]==null?null:t.recommendedRoles[0].openingLine,'"')}}function aB(i,e){i&1&&(r(0,"div",182)(1,"span",266),l(2,"\u{1F504} \u6B63\u5728\u667A\u80FD\u5339\u914D\u5E33\u865F..."),s()())}function lB(i,e){if(i&1){let t=I();r(0,"div",267)(1,"span",7),l(2,"\u26A0\uFE0F"),s(),r(3,"div")(4,"div",269),l(5,"\u7121\u53EF\u7528\u5E33\u865F"),s(),r(6,"div",270),l(7," \u8ACB\u5148\u6DFB\u52A0 Telegram \u5E33\u865F\u4E26\u8A2D\u7F6E\u70BA AI \u89D2\u8272\uFF0C\u624D\u80FD\u57F7\u884C\u591A\u89D2\u8272\u5354\u4F5C\u3002 "),s(),r(8,"div",104)(9,"button",271),x("click",function(){_(t);let o=m(4);return v(o.goToAccountManagement())}),l(10," \u2795 \u6DFB\u52A0\u5E33\u865F "),s(),r(11,"button",272),x("click",function(){_(t);let o=m(4);return v(o.performAccountMatching())}),l(12," \u{1F504} \u91CD\u65B0\u5339\u914D "),s()()()()}}function cB(i,e){if(i&1){let t=I();r(0,"div",268),l(1," \u5339\u914D\u904E\u7A0B\u51FA\u932F\uFF0C\u8ACB\u91CD\u8A66 "),r(2,"button",273),x("click",function(){_(t);let o=m(4);return v(o.performAccountMatching())}),l(3," \u{1F504} \u91CD\u65B0\u5339\u914D "),s()()}}function dB(i,e){if(i&1&&(r(0,"div",183),y(1,lB,13,0,"div",267)(2,cB,4,0,"div",268),s()),i&2){let t=m(3);c(),S(t.matchFailureReason()==="no_accounts"?1:2)}}function uB(i,e){i&1&&(r(0,"div",184)(1,"div",274)(2,"span"),l(3,"\u{1F504}"),s(),r(4,"span"),l(5,"\u4E00\u865F\u591A\u89D2\u6A21\u5F0F\u5DF2\u555F\u7528"),s()(),r(6,"div",275),l(7," \u5E33\u865F\u6578\u91CF\u4E0D\u8DB3\uFF0C\u540C\u4E00\u5E33\u865F\u5C07\u8F2A\u63DB\u626E\u6F14\u591A\u500B\u89D2\u8272 "),s()())}function mB(i,e){if(i&1&&(r(0,"div",280)(1,"div",281),l(2,"\u{1F4AC} \u8A71\u8853\u9810\u89BD"),s(),r(3,"div",265),l(4),s()()),i&2){let t=m().$implicit;c(4),M('"',t.scriptPreview,'"')}}function pB(i,e){if(i&1&&(r(0,"div",277)(1,"div",60)(2,"div",278),l(3),s(),r(4,"div",257)(5,"div",218),l(6),s(),r(7,"div",279),l(8),s()()(),y(9,mB,5,1,"div",280),s()),i&2){let t=e.$implicit;c(3),M(" ",t.step," "),c(3),D(t.action),c(2),M("\u57F7\u884C\u8005: ",t.role),c(),S(t.scriptPreview?9:-1)}}function gB(i,e){if(i&1&&(r(0,"div")(1,"h4",148),l(2,"\u{1F3AC} \u57F7\u884C\u6D41\u7A0B"),s(),r(3,"div",276),O(4,pB,10,4,"div",277,$N),s()()),i&2){let t,n=m(3);c(4),U((t=n.aiPlanResult())==null?null:t.suggestedFlow)}}function hB(i,e){i&1&&(r(0,"div",185)(1,"h4",282),l(2,"\u{1F916} \u7121\u5287\u672C\u6A21\u5F0F\u7279\u6027"),s(),r(3,"ul",283)(4,"li"),l(5,"\u2022 AI \u6839\u64DA\u5C0D\u8A71\u4E0A\u4E0B\u6587\u5373\u6642\u751F\u6210\u56DE\u8986"),s(),r(6,"li"),l(7,"\u2022 \u6BCF 10 \u689D\u6D88\u606F\u81EA\u52D5\u5206\u6790\u5BA2\u6236\u8208\u8DA3\u548C\u60C5\u7DD2"),s(),r(8,"li"),l(9,"\u2022 \u667A\u80FD\u5207\u63DB\u89D2\u8272\u548C\u8ABF\u6574\u7B56\u7565"),s(),r(10,"li"),l(11,"\u2022 \u6AA2\u6E2C\u5230\u8F49\u5316\u4FE1\u865F\u81EA\u52D5\u5207\u63DB\u92B7\u552E\u6A21\u5F0F"),s()()())}function fB(i,e){if(i&1&&(r(0,"div",188),l(1),s()),i&2){let t,n=m(3);c(),M(" \u{1F4CA} ",(t=n.aiPlanResult())==null?null:t.successRateReason," ")}}function _B(i,e){if(i&1){let t=I();r(0,"div",127),y(1,EV,18,4,"div",140),r(2,"div",141)(3,"div",142)(4,"div",143)(5,"span"),l(6,"\u2713"),s(),r(7,"span",144),l(8,"\u7B56\u5283\u5B8C\u6210\uFF01"),s()(),y(9,DV,2,0,"span",145)(10,AV,2,0,"span",146),s(),r(11,"p",147),l(12),s()(),r(13,"div")(14,"h4",148),l(15,"\u{1F3AF} \u9078\u64C7\u5354\u4F5C\u5834\u666F"),s(),r(16,"div",130)(17,"button",149),x("click",function(){_(t);let o=m(2);return v(o.selectedChatScenario.set("private"))}),r(18,"div",150)(19,"span",7),l(20,"\u{1F4AC}"),s(),r(21,"div")(22,"div",134),l(23,"\u79C1\u804A\u6A21\u5F0F"),s(),r(24,"div",101),l(25,"1v1 \u5C0D\u8A71"),s()()(),r(26,"ul",151)(27,"li"),l(28,"\u2022 \u55AE\u4E00\u89D2\u8272\u8207\u5BA2\u6236\u5C0D\u8A71"),s(),r(29,"li"),l(30,"\u2022 \u9069\u5408\u9996\u6B21\u63A5\u89F8\u3001\u5FEB\u901F\u7BE9\u9078"),s(),r(31,"li"),l(32,"\u2022 \u4F4E\u6210\u672C\u6279\u91CF\u89F8\u9054"),s()(),r(33,"div",152),l(34," \u9700\u8981\u5E33\u865F\uFF1A1 \u500B "),s()(),r(35,"button",149),x("click",function(){_(t);let o=m(2);return v(o.selectedChatScenario.set("group"))}),r(36,"div",150)(37,"span",7),l(38,"\u{1F465}"),s(),r(39,"div")(40,"div",134),l(41,"\u7FA4\u804A\u5354\u4F5C"),s(),r(42,"div",153),l(43,"\u591A\u89D2\u8272\u5354\u540C"),s()()(),r(44,"ul",151)(45,"li"),l(46,"\u2022 \u5EFA\u7FA4\u9080\u8ACB\u5BA2\u6236 + \u591A\u89D2\u8272"),s(),r(47,"li"),l(48,"\u2022 \u89D2\u8272\u5206\u5DE5\u5354\u4F5C\u670D\u52D9"),s(),r(49,"li"),l(50,"\u2022 \u9AD8\u8F49\u5316\u6DF1\u5EA6\u71DF\u92B7"),s()(),r(51,"div",154),l(52),y(53,MV,2,0,"span",155),s()()(),y(54,TV,8,2,"div",156),y(55,kV,18,0,"div",157),s(),r(56,"div")(57,"h4",148),l(58,"\u2699\uFE0F AI \u5C0D\u8A71\u6A21\u5F0F"),s(),r(59,"div",130)(60,"button",158),x("click",function(){_(t);let o=m(2);return v(o.selectedExecutionMode.set("hybrid"))}),r(61,"div",159)(62,"span"),l(63,"\u{1F4CB}"),s(),r(64,"span",71),l(65,"\u5F15\u5C0E\u5F0F"),s(),r(66,"span",160),l(67,"\u63A8\u85A6"),s()(),r(68,"p",101),l(69,"\u9810\u8A2D\u8A71\u8853 + AI \u9748\u6D3B\u88DC\u5145"),s()(),r(70,"button",158),x("click",function(){_(t);let o=m(2);return v(o.selectedExecutionMode.set("scriptless"))}),r(71,"div",159)(72,"span"),l(73,"\u{1F916}"),s(),r(74,"span",71),l(75,"\u7D14 AI"),s()(),r(76,"p",101),l(77,"\u6BCF\u689D\u6D88\u606F\u5373\u6642\u751F\u6210"),s()()()(),r(78,"div")(79,"h4",148),l(80,"\u{1F464} \u9078\u64C7\u71DF\u92B7\u76EE\u6A19"),s(),r(81,"div",161),y(82,IV,12,0,"div",162)(83,RV,12,2),s()(),r(84,"div",163)(85,"button",164),x("click",function(){_(t);let o=m(2);return v(o.showAdvancedAccountSettings.set(!o.showAdvancedAccountSettings()))}),r(86,"div",8)(87,"span"),l(88,"\u{1F465}"),s(),r(89,"span",71),l(90,"\u5E33\u865F\u914D\u7F6E"),s(),y(91,NV,2,0,"span",165)(92,VV,2,1,"span",166),s(),r(93,"span",167),l(94),s()(),y(95,WV,26,16,"div",168),s(),r(96,"div")(97,"div",78)(98,"h4",55),l(99),s(),y(100,zV,2,0,"button",169),s(),y(101,KV,17,1,"div",170),r(102,"div",171)(103,"table",172)(104,"thead",173)(105,"tr",174)(106,"th",175),l(107,"\u5E33\u865F"),s(),r(108,"th",175),l(109,"\u89D2\u8272"),s(),r(110,"th",176),l(111,"\u72C0\u614B"),s(),r(112,"th",177),l(113,"\u64CD\u4F5C"),s()()(),r(114,"tbody",178),O(115,nB,24,8,"tr",179,ct),O(117,rB,19,4,"tr",180,In),s()()(),y(119,sB,5,1,"div",181),y(120,aB,3,0,"div",182),y(121,dB,3,1,"div",183),y(122,uB,8,0,"div",184),s(),y(123,gB,6,0,"div"),y(124,hB,12,0,"div",185),r(125,"div",161)(126,"div",4)(127,"span",186),l(128,"\u9810\u4F30\u6210\u529F\u7387"),s(),r(129,"span",187),l(130),s()(),y(131,fB,2,1,"div",188),s()()}if(i&2){let t,n,o,a,d,u,p,g,C,w,A=m(2);c(),S((t=A.aiPlanResult())!=null&&t.goalAnalysis?1:-1),c(8),S(A.aiPlanningSource()==="ai"?9:A.aiPlanningSource()==="template"?10:-1),c(3),D((n=A.aiPlanResult())==null?null:n.strategy),c(5),N("border-blue-500",A.selectedChatScenario()==="private")("bg-blue-500/10",A.selectedChatScenario()==="private")("border-slate-700",A.selectedChatScenario()!=="private")("bg-slate-800",A.selectedChatScenario()!=="private"),c(18),N("border-green-500",A.selectedChatScenario()==="group")("bg-green-500/10",A.selectedChatScenario()==="group")("border-slate-700",A.selectedChatScenario()!=="group")("bg-slate-800",A.selectedChatScenario()!=="group"),c(16),N("text-green-400",A.hasEnoughAccounts())("text-amber-400",!A.hasEnoughAccounts()),c(),M(" \u9700\u8981\u5E33\u865F\uFF1A",A.requiredAccountsForGroup()," \u500B "),c(),S(!A.hasEnoughAccounts()&&A.selectedChatScenario()==="group"?53:-1),c(),S(A.isGroupChatMode()&&!A.hasEnoughAccounts()?54:-1),c(),S(A.isGroupChatMode()&&A.hasEnoughAccounts()?55:-1),c(5),N("border-cyan-500",A.selectedExecutionMode()==="hybrid")("bg-cyan-500/10",A.selectedExecutionMode()==="hybrid")("border-slate-700",A.selectedExecutionMode()!=="hybrid")("bg-slate-800",A.selectedExecutionMode()!=="hybrid"),c(10),N("border-pink-500",A.selectedExecutionMode()==="scriptless")("bg-pink-500/10",A.selectedExecutionMode()==="scriptless")("border-slate-700",A.selectedExecutionMode()!=="scriptless")("bg-slate-800",A.selectedExecutionMode()!=="scriptless"),c(12),S(A.selectedTargetUsers().length===0?82:83),c(9),S(A.plannerAutoAssign()?91:92),c(3),D(A.showAdvancedAccountSettings()?"\u25B2":"\u25BC"),c(),S(A.showAdvancedAccountSettings()?95:-1),c(4),X("\u{1F465} \u89D2\u8272\u5206\u914D\u9810\u89BD (",A.getDisplayedRolesCount(),"/",A.plannerAccountCount()," \u5E33\u865F)"),c(),S(((o=A.aiPlanResult())==null||o.recommendedRoles==null?null:o.recommendedRoles.length)!==A.plannerAccountCount()?100:-1),c(),S(A.showAccountExplanation()?101:-1),c(14),U((a=A.aiPlanResult())==null?null:a.recommendedRoles),c(2),U(A.getBackupAccounts()),c(2),S(!((d=A.aiPlanResult())==null||d.recommendedRoles==null||d.recommendedRoles[0]==null)&&d.recommendedRoles[0].openingLine?119:-1),c(),S(A.accountMatchResults().length===0&&!A.matchFailureReason()?120:-1),c(),S(A.matchFailureReason()?121:-1),c(),S(A.matchMode()==="multi-role"&&A.accountMatchResults().length>0?122:-1),c(),S(A.selectedExecutionMode()!=="scriptless"?123:-1),c(),S(A.selectedExecutionMode()==="scriptless"?124:-1),c(5),N("text-green-400",(((u=A.aiPlanResult())==null?null:u.estimatedSuccessRate)||0)>=70)("text-amber-400",(((p=A.aiPlanResult())==null?null:p.estimatedSuccessRate)||0)>=40&&(((p=A.aiPlanResult())==null?null:p.estimatedSuccessRate)||0)<70)("text-red-400",(((g=A.aiPlanResult())==null?null:g.estimatedSuccessRate)||0)<40),c(),M(" ",(C=A.aiPlanResult())==null?null:C.estimatedSuccessRate,"% "),c(),S((w=A.aiPlanResult())!=null&&w.successRateReason?131:-1)}}function vB(i,e){if(i&1){let t=I();r(0,"button",284),x("click",function(){_(t);let o=m(2);return v(o.closeAIPlanner())}),l(1," \u53D6\u6D88 "),s(),r(2,"button",285),x("click",function(){_(t);let o=m(2);return v(o.startAIPlanning())}),l(3," \u{1F916} \u958B\u59CB\u7B56\u5283 "),s()}if(i&2){let t=m(2);c(2),L("disabled",!t.aiPlannerGoal.trim())}}function xB(i,e){if(i&1){let t=I();r(0,"button",288),x("click",function(){_(t);let o=m(3);return v(o.applyAIPlan())}),l(1," \u{1F4AC} \u958B\u59CB\u79C1\u804A "),s()}}function CB(i,e){i&1&&(r(0,"span",290),l(1,"\u23F3"),s(),l(2," \u5275\u5EFA\u7FA4\u7D44\u4E2D... "))}function bB(i,e){i&1&&(r(0,"span",291),l(1,"\u{1F4E8}"),s(),l(2," \u9080\u8ACB\u5BA2\u6236\u4E2D... "))}function yB(i,e){i&1&&(r(0,"span",291),l(1,"\u{1F465}"),s(),l(2," \u9080\u8ACB\u89D2\u8272\u4E2D... "))}function SB(i,e){i&1&&l(0," \u{1F465} \u958B\u59CB\u7FA4\u804A\u5354\u4F5C ")}function wB(i,e){if(i&1){let t=I();r(0,"button",289),x("click",function(){_(t);let o=m(3);return v(o.startGroupCollaboration())}),y(1,CB,3,0)(2,bB,3,0)(3,yB,3,0)(4,SB,1,0),s()}if(i&2){let t=m(3);L("disabled",!t.hasEnoughAccounts()||t.selectedTargetUsers().length===0),c(),S(t.groupCreationStatus()==="creating"?1:t.groupCreationStatus()==="inviting_target"?2:t.groupCreationStatus()==="inviting_roles"?3:4)}}function EB(i,e){if(i&1){let t=I();r(0,"button",284),x("click",function(){_(t);let o=m(2);return v(o.resetAIPlanner())}),l(1," \u91CD\u65B0\u7B56\u5283 "),s(),y(2,xB,2,0,"button",286)(3,wB,5,2,"button",287)}if(i&2){let t=m(2);c(2),S(t.isPrivateChatMode()?2:3)}}function DB(i,e){if(i&1){let t=I();r(0,"div",27)(1,"div",122)(2,"div",123)(3,"div",4)(4,"h2",32)(5,"span",7),l(6,"\u{1F916}"),s(),l(7," AI \u667A\u80FD\u7B56\u5283 "),s(),r(8,"button",124),x("click",function(){_(t);let o=m();return v(o.closeAIPlanner())}),l(9," \u2715 "),s()()(),r(10,"div",125),y(11,vV,38,1),y(12,CV,10,2,"div",126),y(13,_B,132,65,"div",127),s(),r(14,"div",128),y(15,vB,4,1),y(16,EB,4,1),s()()()}if(i&2){let t=m();c(11),S(t.aiPlannerStatus()==="idle"?11:-1),c(),S(t.aiPlannerStatus()==="planning"?12:-1),c(),S(t.aiPlannerStatus()==="ready"&&t.aiPlanResult()?13:-1),c(2),S(t.aiPlannerStatus()==="idle"?15:-1),c(),S(t.aiPlannerStatus()==="ready"?16:-1)}}function AB(i,e){i&1&&(r(0,"span",310),l(1,"\u27F3"),s(),l(2," \u540C\u6B65\u4E2D... "))}function MB(i,e){i&1&&l(0," \u{1F504} \u540C\u6B65\u6578\u64DA ")}function TB(i,e){if(i&1){let t=I();r(0,"button",311),x("click",function(){_(t);let o=m(2);return v(o.clearSearchQuery())}),l(1," \u2715 "),s()}}function kB(i,e){i&1&&(r(0,"div",307)(1,"div",312),l(2,"\u{1F4ED}"),s(),r(3,"p"),l(4,"\u66AB\u7121\u53EF\u9078\u7528\u6236"),s(),r(5,"p",313),l(6,"\u8ACB\u5148\u5F9E\u7FA4\u7D44\u63D0\u53D6\u6210\u54E1\u6216\u5C0E\u5165\u806F\u7E6B\u4EBA"),s()())}function IB(i,e){i&1&&(ne(),r(0,"svg",317),B(1,"path",321),s())}function FB(i,e){if(i&1&&l(0),i&2){let t=m().$implicit;M(" ",t.lastName," ")}}function PB(i,e){if(i&1&&l(0),i&2){let t=m().$implicit;M(" @",t.username," \xB7 ")}}function RB(i,e){if(i&1){let t=I();r(0,"div",315),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.toggleTargetUser(o))}),r(1,"div",316),y(2,IB,2,0,":svg:svg",317),s(),r(3,"div",318),l(4),s(),r(5,"div",257)(6,"div",134),l(7),y(8,FB,1,1),s(),r(9,"div",101),y(10,PB,1,1),l(11),s()(),r(12,"div",319)(13,"div",320),l(14),s(),r(15,"div",14),l(16),s()()()}if(i&2){let t=e.$implicit,n=m(3);N("bg-purple-500/20",n.isUserSelected(t))("border-purple-500",n.isUserSelected(t))("bg-slate-700/50",!n.isUserSelected(t))("hover:bg-slate-700",!n.isUserSelected(t))("border",!0)("border-transparent",!n.isUserSelected(t)),c(),N("bg-purple-500",n.isUserSelected(t))("border-purple-500",n.isUserSelected(t))("border-slate-500",!n.isUserSelected(t)),c(),S(n.isUserSelected(t)?2:-1),c(2),M(" ",(t.firstName||t.username||"?")[0].toUpperCase()," "),c(3),M(" ",t.firstName||t.username||"Unknown"," "),c(),S(t.lastName?8:-1),c(2),S(t.username?10:-1),c(),M(" ID: ",t.telegramId," "),c(2),N("text-emerald-400",t.intentScore>=60)("text-amber-400",t.intentScore>=40&&t.intentScore<60)("text-slate-400",t.intentScore<40),c(),M(" ",t.intentScore,"\u5206 "),c(2),D(t.source)}}function NB(i,e){if(i&1&&(r(0,"div",308),O(1,RB,17,32,"div",314,h1),s()),i&2){let t=m(2);c(),U(t.filteredTargetUsers())}}function VB(i,e){if(i&1){let t=I();r(0,"div",24)(1,"div",292)(2,"div",293)(3,"div",294)(4,"div")(5,"h3",40)(6,"span"),l(7,"\u{1F464}"),s(),l(8," \u9078\u64C7\u71DF\u92B7\u76EE\u6A19\u7528\u6236 "),s(),r(9,"p",295),l(10,"\u5F9E\u767C\u9001\u63A7\u5236\u53F0\u540C\u6B65\u6700\u65B0\u7684\u76EE\u6A19\u5BA2\u6236\u6578\u64DA"),s()(),r(11,"button",296),x("click",function(){_(t);let o=m();return v(o.syncTargetUsersFromSendConsole())}),y(12,AB,3,0)(13,MB,1,0),s()()(),r(14,"div",297)(15,"div",298)(16,"div",299)(17,"input",300),W("ngModelChange",function(o){_(t);let a=m();return q(a.targetUserSearchQuery,o)||(a.targetUserSearchQuery=o),v(o)}),x("keyup.enter",function(){_(t);let o=m();return v(o.searchTargetUsers())}),s(),y(18,TB,2,0,"button",301),s(),r(19,"button",302),x("click",function(){_(t);let o=m();return v(o.searchTargetUsers())}),l(20," \u{1F50D} \u641C\u7D22 "),s(),r(21,"button",303),x("click",function(){_(t);let o=m();return v(o.toggleSelectAll())}),l(22),s()(),r(23,"div",304)(24,"button",305),x("click",function(){_(t);let o=m();return v(o.selectHighIntentUsers())}),l(25," \u2B50 \u9AD8\u610F\u5411 "),s(),r(26,"span",306),l(27),s()()(),r(28,"div",20),y(29,kB,7,0,"div",307)(30,NB,3,0,"div",308),s(),r(31,"div",128)(32,"button",284),x("click",function(){_(t);let o=m();return v(o.closeTargetUserSelector())}),l(33," \u53D6\u6D88 "),s(),r(34,"button",309),x("click",function(){_(t);let o=m();return v(o.confirmTargetUsers())}),l(35),s()()()()}if(i&2){let t=m();c(11),L("disabled",t.isSyncingTargetUsers()),c(),S(t.isSyncingTargetUsers()?12:13),c(5),H("ngModel",t.targetUserSearchQuery),c(),S(t.targetUserSearchQuery?18:-1),c(4),M(" ",t.isAllSelected()?"\u53D6\u6D88\u5168\u9078":"\u5168\u9078"," "),c(5),M(" \u5DF2\u9078: ",t.selectedTargetUsers().length," \u500B "),c(2),S(t.filteredTargetUsers().length===0?29:30),c(5),L("disabled",t.selectedTargetUsers().length===0),c(),M(" \u78BA\u8A8D\u9078\u64C7 (",t.selectedTargetUsers().length,") ")}}function BB(i,e){if(i&1){let t=I();r(0,"div",24)(1,"div",322)(2,"h3",323)(3,"span"),l(4,"\u{1F4DC}"),s(),l(5," \u65B0\u5EFA\u5287\u672C "),s(),r(6,"div",47)(7,"div")(8,"label",91),l(9,"\u5287\u672C\u540D\u7A31 *"),s(),r(10,"input",324),W("ngModelChange",function(o){_(t);let a=m();return q(a.newScriptName,o)||(a.newScriptName=o),v(o)}),s()(),r(11,"div")(12,"label",91),l(13,"\u5287\u672C\u63CF\u8FF0"),s(),r(14,"textarea",325),W("ngModelChange",function(o){_(t);let a=m();return q(a.newScriptDescription,o)||(a.newScriptDescription=o),v(o)}),l(15,"                "),s()(),r(16,"div")(17,"label",91),l(18,"\u6216\u5F9E\u6A21\u677F\u5275\u5EFA"),s(),r(19,"div",224)(20,"button",326),x("click",function(){_(t);let o=m();return v(o.createFromTemplate("high_intent"))}),r(21,"div",132),l(22,"\u{1F3AF}"),s(),r(23,"div",218),l(24,"\u9AD8\u610F\u5411\u8F49\u5316"),s()(),r(25,"button",326),x("click",function(){_(t);let o=m();return v(o.createFromTemplate("product_demo"))}),r(26,"div",132),l(27,"\u{1F4E6}"),s(),r(28,"div",218),l(29,"\u7522\u54C1\u6F14\u793A"),s()(),r(30,"button",326),x("click",function(){_(t);let o=m();return v(o.createFromTemplate("customer_support"))}),r(31,"div",132),l(32,"\u{1F527}"),s(),r(33,"div",218),l(34,"\u552E\u5F8C\u670D\u52D9"),s()(),r(35,"button",326),x("click",function(){_(t);let o=m();return v(o.createFromTemplate("community"))}),r(36,"div",132),l(37,"\u{1F389}"),s(),r(38,"div",218),l(39,"\u793E\u7FA4\u6D3B\u8E8D"),s()()()()(),r(40,"div",114)(41,"button",115),x("click",function(){_(t);let o=m();return v(o.cancelAddScript())}),l(42," \u53D6\u6D88 "),s(),r(43,"button",327),x("click",function(){_(t);let o=m();return v(o.confirmAddScript())}),l(44," \u5275\u5EFA\u5287\u672C "),s()()()()}if(i&2){let t=m();c(10),H("ngModel",t.newScriptName),c(4),H("ngModel",t.newScriptDescription),c(29),L("disabled",!t.newScriptName.trim())}}var Hc={":payment:":"\u{1F4B3}",":money:":"\u{1F4B0}",":dollar:":"\u{1F4B5}",":credit_card:":"\u{1F4B3}",":moneybag:":"\u{1F4B0}",":chart:":"\u{1F4CA}",":briefcase:":"\u{1F4BC}",":handshake:":"\u{1F91D}",":star:":"\u2B50",":heart:":"\u2764\uFE0F",":fire:":"\u{1F525}",":rocket:":"\u{1F680}",":crown:":"\u{1F451}",":trophy:":"\u{1F3C6}",":phone:":"\u{1F4DE}",":headphone:":"\u{1F3A7}",":headphones:":"\u{1F3A7}",":wrench:":"\u{1F527}",":gear:":"\u2699\uFE0F",":speech_balloon:":"\u{1F4AC}",":bulb:":"\u{1F4A1}",":lightbulb:":"\u{1F4A1}",":target:":"\u{1F3AF}",":dart:":"\u{1F3AF}",":man_office_worker:":"\u{1F468}\u200D\u{1F4BC}",":woman_office_worker:":"\u{1F469}\u200D\u{1F4BC}",":person:":"\u{1F464}",":people:":"\u{1F465}",":smile:":"\u{1F60A}",":thumbsup:":"\u{1F44D}",":ok_hand:":"\u{1F44C}",":wave:":"\u{1F44B}",":clipboard:":"\u{1F4CB}",":memo:":"\u{1F4DD}",":book:":"\u{1F4DA}",":graduation_cap:":"\u{1F393}",":sparkles:":"\u2728",":party_popper:":"\u{1F389}",":gift:":"\u{1F381}",":house:":"\u{1F3E0}",":office:":"\u{1F3E2}",":bank:":"\u{1F3E6}",":shopping_cart:":"\u{1F6D2}",":package:":"\u{1F4E6}",":truck:":"\u{1F69A}",":clock:":"\u23F0",":calendar:":"\u{1F4C5}",":lock:":"\u{1F512}",":key:":"\u{1F511}",":shield:":"\u{1F6E1}\uFE0F",":check:":"\u2705",":x:":"\u274C",":warning:":"\u26A0\uFE0F",":question:":"\u2753",":info:":"\u2139\uFE0F"};function LB(i,e="\u{1F4BC}"){if(!i)return e;if(!/^[\x00-\x7F]*$/.test(i)&&!i.includes(":"))return i;let t=i.toLowerCase().trim();if(Hc[t])return Hc[t];let n=t.match(/^:([a-z_]+):$/);if(n){let o=`:${n[1]}:`;if(Hc[o])return Hc[o]}return i.startsWith(":")&&i.endsWith(":")?(console.warn(`[MultiRole] \u672A\u8B58\u5225\u7684 emoji shortcode: ${i}\uFF0C\u4F7F\u7528\u9ED8\u8A8D\u503C`),e):i}function OB(i){return Array.isArray(i)?i.map(e=>P(E({},e),{icon:LB(e.icon,"\u{1F4BC}")})):[]}var qc=class i{constructor(){this.Math=Math;this.multiRoleService=F(kt);this.autoGroupService=F(zn);this.executorService=F(or);this.dynamicEngine=F(Mi);this.orchestrator=F(Fc);this.toast=F(J);this.contactsService=F(Kt);this.accountService=F(pt);this.ipc=F(Q);this.ipcCleanup=[];this.activeTab=f("dashboard");this.showAddRole=f(!1);this.showCreateGroupDialog=f(!1);this.showTargetUserSelector=f(!1);this.selectedTargetUsers=f([]);this.targetUserSearchQuery="";this.isSyncingTargetUsers=f(!1);this.availableTargetUsers=R(()=>this.contactsService.contacts().filter(t=>t.telegram_id).map(t=>({id:t.id?.toString()||t.telegram_id,telegramId:t.telegram_id,username:t.username,firstName:t.display_name?.split(" ")[0]||t.first_name||t.username,lastName:t.display_name?.split(" ")[1]||t.last_name,intentScore:this.calculateContactIntent(t),source:t.source_type||"contacts"})).sort((t,n)=>n.intentScore-t.intentScore));this.filteredTargetUsers=R(()=>{let e=this.targetUserSearchQuery.toLowerCase().trim(),t=this.availableTargetUsers();return e?t.filter(n=>n.username?.toLowerCase().includes(e)||n.firstName?.toLowerCase().includes(e)||n.telegramId?.includes(e)).slice(0,50):t.slice(0,50)});this.showRoleEditor=f(!1);this.editingRole=f(null);this.showScriptEditor=f(!1);this.editingScript=f(null);this.tabs=[{id:"dashboard",icon:"\u{1F4CA}",label:"\u76E3\u63A7\u4E2D\u5FC3"},{id:"library",icon:"\u{1F4DA}",label:"\u89D2\u8272\u5EAB (50+)"},{id:"roles",icon:"\u{1F3AD}",label:"\u6211\u7684\u89D2\u8272"},{id:"scenarios",icon:"\u{1F3AC}",label:"\u5834\u666F\u6A21\u677F"},{id:"scripts",icon:"\u{1F4DC}",label:"\u5287\u672C\u7DE8\u6392"},{id:"groups",icon:"\u{1F3E0}",label:"\u5354\u4F5C\u7FA4\u7D44"},{id:"workflow",icon:"\u{1F504}",label:"\u5DE5\u4F5C\u6D41"},{id:"monitor",icon:"\u{1F4C8}",label:"\u57F7\u884C\u76E3\u63A7"},{id:"analytics",icon:"\u{1F4C9}",label:"\u6578\u64DA\u5206\u6790"},{id:"settings",icon:"\u2699\uFE0F",label:"\u8A2D\u7F6E"}];this.roleTypes=Object.entries(Tt).filter(([e])=>e!=="custom").map(([e,t])=>E({id:e},t));this.availableAccounts=R(()=>[]);this.newRoleType=f("expert");this.newRoleName="";this.newRoleDescription="";this.newRolePrompt="";this.showAIPlannerDialog=f(!1);this.aiPlannerGoal="";this.aiPlannerStatus=f("idle");this.aiPlanningProgress=f("AI \u6B63\u5728\u5206\u6790\u60A8\u7684\u76EE\u6A19...");this.aiPlanningElapsed=f(0);this.plannerAccountCount=f(3);this.plannerSelectedAccounts=f([]);this.plannerAccountRoles=f(new Map);this.plannerAutoAssign=f(!0);this.showAccountExplanation=f(!1);this.roleChangeModalIndex=f(-1);this.backupDropdownId=f(-1);this.DRAFT_STORAGE_KEY="aiPlannerDraft";this.hasDraft=f(!1);this.availableRoleTypes=[{id:"consultant",name:"\u652F\u4ED8\u9867\u554F",icon:"\u{1F4BC}",desc:"\u8CA0\u8CAC\u6838\u5FC3\u71DF\u92B7"},{id:"expert",name:"\u6280\u8853\u5C08\u5BB6",icon:"\u{1F527}",desc:"\u89E3\u7B54\u6280\u8853\u554F\u984C"},{id:"oldcustomer",name:"\u8001\u5BA2\u6236",icon:"\u{1F464}",desc:"\u63D0\u4F9B\u771F\u5BE6\u9AD4\u9A57"},{id:"support",name:"\u5BA2\u670D",icon:"\u{1F3A7}",desc:"\u89E3\u6C7A\u552E\u5F8C\u554F\u984C"},{id:"manager",name:"\u7D93\u7406",icon:"\u{1F454}",desc:"\u8655\u7406\u7279\u6B8A\u60C5\u6CC1"},{id:"atmosphere",name:"\u6C23\u6C1B\u7D44",icon:"\u{1F389}",desc:"\u6D3B\u8E8D\u7FA4\u7D44\u6C23\u6C1B"}];this.showAdvancedAccountSettings=f(!1);this.selectedExecutionMode=f("hybrid");this.selectedChatScenario=f("private");this.availableAccountCount=R(()=>this.accountService.accounts().filter(t=>t.status==="Online").length);this.isPrivateChatMode=R(()=>this.selectedChatScenario()==="private");this.isGroupChatMode=R(()=>this.selectedChatScenario()==="group");this.requiredAccountsForGroup=R(()=>this.aiPlanResult()?.recommendedRoles?.length||2);this.hasEnoughAccounts=R(()=>{let e=this.availableAccountCount(),t=this.isPrivateChatMode()?1:this.requiredAccountsForGroup();return e>=t});this.groupCreationStatus=f("idle");this.groupCreationProgress=f("");this.createdGroupId=f(null);this.accountMatchResults=f([]);this.aiPlanResult=f(null);this.autoGroupNameTemplate="VIP\u5C08\u5C6C\u670D\u52D9\u7FA4 - {\u5BA2\u6236\u540D}";this.inviteMessage="\u70BA\u4E86\u66F4\u597D\u5730\u670D\u52D9\u60A8\uFF0C\u6211\u5011\u7279\u5225\u5EFA\u7ACB\u4E86VIP\u7FA4\uFF01";this.maxConcurrent=5;this.autoCloseDays=7;this.intentThreshold=70;this.minRounds=3;this.requirePriceInquiry=!1;this.useAICenter=!0;this.coordinationMode="sequential";this.showNewScriptDialog=f(!1);this.newScriptName="";this.newScriptDescription="";this.aiPlanningSource=f(null);this.matchFailureReason=f(null);this.matchMode=f("normal")}onDocumentClick(e){this.roleChangeModalIndex.set(-1),this.backupDropdownId.set(-1)}ngOnInit(){this.checkIncomingTargetUsers(),this.ipcCleanup.push(this.ipc.on("multi-role:open-ai-planner",e=>{console.log("[MultiRoleCenter] \u6536\u5230\u76EE\u6A19\u7528\u6236:",e.targetUsers?.length),e.targetUsers&&e.targetUsers.length>0&&(this.selectedTargetUsers.set(e.targetUsers),this.openAIPlanner(),this.toast.info(`\u5DF2\u52A0\u8F09 ${e.targetUsers.length} \u500B\u76EE\u6A19\u7528\u6236`))}))}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}checkIncomingTargetUsers(){let e=sessionStorage.getItem("multiRoleTargetUsers");if(e)try{let t=JSON.parse(e);t.length>0&&(this.selectedTargetUsers.set(t),sessionStorage.removeItem("multiRoleTargetUsers"),setTimeout(()=>{this.openAIPlanner(),this.toast.info(`\u5DF2\u52A0\u8F09 ${t.length} \u500B\u76EE\u6A19\u7528\u6236\uFF0C\u8ACB\u958B\u59CB\u7B56\u5283`)},300))}catch(t){console.error("[MultiRoleCenter] \u89E3\u6790\u76EE\u6A19\u7528\u6236\u5931\u6557:",t)}}getRoleIcon(e){return Tt[e]?.icon||"\u{1F3AD}"}getRoleStyleLabel(e){return{professional:"\u5C08\u696D\u6B63\u5F0F",friendly:"\u53CB\u597D\u89AA\u5207",casual:"\u8F15\u9B06\u96A8\u610F",enthusiastic:"\u71B1\u60C5",careful:"\u8B39\u614E",curious:"\u597D\u5947"}[e]||e}quickAddRole(e){let t=Tt[e];this.multiRoleService.addRole({name:t.label,type:e,personality:{description:t.description,speakingStyle:t.defaultStyle,traits:[]},aiConfig:{useGlobalAI:!0,customPrompt:t.defaultPrompt,responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:[]})}saveNewRole(){let e=this.newRoleType(),t=Tt[e];this.multiRoleService.addRole({name:this.newRoleName||t.label,type:e,personality:{description:this.newRoleDescription||t.description,speakingStyle:t.defaultStyle,traits:[]},aiConfig:{useGlobalAI:!0,customPrompt:this.newRolePrompt||t.defaultPrompt,responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:[]}),this.showAddRole.set(!1),this.newRoleName="",this.newRoleDescription="",this.newRolePrompt=""}editRole(e){this.editingRole.set(e),this.showRoleEditor.set(!0)}openNewRoleEditor(){this.editingRole.set(null),this.showRoleEditor.set(!0)}onRoleSaved(e){this.showRoleEditor.set(!1),this.editingRole.set(null),this.showAddRole.set(!1)}onRoleEditorCancelled(){this.showRoleEditor.set(!1),this.editingRole.set(null)}deleteRole(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u89D2\u8272\u300C${e.name}\u300D\u55CE\uFF1F`)&&this.multiRoleService.deleteRole(e.id)}openNewScriptEditor(){this.editingScript.set(null),this.showScriptEditor.set(!0)}editScript(e){this.editingScript.set(e),this.showScriptEditor.set(!0)}onScriptSaved(e){this.showScriptEditor.set(!1),this.editingScript.set(null)}onScriptEditorCancelled(){this.showScriptEditor.set(!1),this.editingScript.set(null)}deleteScript(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u5287\u672C\u300C${e.name}\u300D\u55CE\uFF1F`)&&this.multiRoleService.deleteScript(e.id)}onPresetRoleAdded(e){this.multiRoleService.addRole({name:e.name,type:e.type,personality:e.personality,aiConfig:e.aiConfig,responsibilities:e.responsibilities}),this.activeTab.set("roles")}onPresetRoleEdit(e){let t=this.multiRoleService.addRole({name:e.name,type:e.type,personality:e.personality,aiConfig:e.aiConfig,responsibilities:e.responsibilities});if(t){let n=this.multiRoleService.roles().find(o=>o.id===t);n&&this.editRole(n)}}onScenarioApplied(e){e.roles.forEach(t=>{let o=(window.PRESET_ROLES||[]).find(a=>a.roleType===t.roleType);o&&this.multiRoleService.addRole({name:o.name,type:o.type,personality:o.personality,aiConfig:o.aiConfig,responsibilities:o.responsibilities})}),this.multiRoleService.addScript({name:e.name,description:e.description,scenario:e.type}),this.activeTab.set("scripts")}pauseGroup(e){this.autoGroupService.pauseGroup(e.id),this.executorService.pauseExecution(e.id)}resumeGroup(e){this.autoGroupService.resumeGroup(e.id),this.executorService.resumeExecution(e.id)}markGroupConverted(e){this.autoGroupService.markAsConverted(e.id)}addScript(){this.newScriptName="",this.newScriptDescription="",this.showNewScriptDialog.set(!0)}confirmAddScript(){if(this.newScriptName.trim()){let e=this.multiRoleService.addScript({name:this.newScriptName.trim(),description:this.newScriptDescription.trim()});if(this.showNewScriptDialog.set(!1),e){let t=this.multiRoleService.scripts().find(n=>n.id===e);t&&this.editScript(t)}}}cancelAddScript(){this.showNewScriptDialog.set(!1)}useTemplate(e){this.createFromTemplate(e)}createFromTemplate(e){let n={high_intent:{name:"\u9AD8\u610F\u5411\u5BA2\u6236\u8F49\u5316",description:"\u5C08\u5BB6\u4ECB\u7D39 + \u8001\u5BA2\u6236\u80CC\u66F8 + \u5BA2\u670D\u4FC3\u55AE\u7684\u7D93\u5178\u8F49\u5316\u6D41\u7A0B",stages:[{id:"stage_1",name:"\u5C08\u696D\u4ECB\u7D39",order:1,trigger:{type:"manual"},messages:[]},{id:"stage_2",name:"\u8001\u5BA2\u6236\u80CC\u66F8",order:2,trigger:{type:"time",delaySeconds:120},messages:[]},{id:"stage_3",name:"\u4FC3\u55AE\u8DDF\u9032",order:3,trigger:{type:"message"},messages:[]}]},product_demo:{name:"\u7522\u54C1\u6F14\u793A\u63A8\u85A6",description:"\u529F\u80FD\u5C55\u793A + \u4F7F\u7528\u5834\u666F + \u6548\u679C\u5206\u4EAB\u7684\u7522\u54C1\u63A8\u4ECB\u6D41\u7A0B",stages:[{id:"stage_1",name:"\u529F\u80FD\u5C55\u793A",order:1,trigger:{type:"manual"},messages:[]},{id:"stage_2",name:"\u5834\u666F\u61C9\u7528",order:2,trigger:{type:"time",delaySeconds:180},messages:[]},{id:"stage_3",name:"\u6548\u679C\u898B\u8B49",order:3,trigger:{type:"time",delaySeconds:120},messages:[]}]},customer_support:{name:"\u552E\u5F8C\u554F\u984C\u8655\u7406",description:"\u554F\u984C\u8A18\u9304 + \u6280\u8853\u6392\u67E5 + \u6EFF\u610F\u5EA6\u78BA\u8A8D\u7684\u552E\u5F8C\u670D\u52D9\u6D41\u7A0B",stages:[{id:"stage_1",name:"\u554F\u984C\u8A18\u9304",order:1,trigger:{type:"message"},messages:[]},{id:"stage_2",name:"\u6280\u8853\u6392\u67E5",order:2,trigger:{type:"time",delaySeconds:60},messages:[]},{id:"stage_3",name:"\u6EFF\u610F\u78BA\u8A8D",order:3,trigger:{type:"time",delaySeconds:300},messages:[]}]},community:{name:"\u793E\u7FA4\u6D3B\u8E8D\u5F15\u5C0E",description:"\u8A71\u984C\u767C\u8D77 + \u4E92\u52D5\u97FF\u61C9 + \u50F9\u503C\u7E3D\u7D50\u7684\u793E\u7FA4\u904B\u71DF\u6D41\u7A0B",stages:[{id:"stage_1",name:"\u8A71\u984C\u767C\u8D77",order:1,trigger:{type:"time"},messages:[]},{id:"stage_2",name:"\u4E92\u52D5\u97FF\u61C9",order:2,trigger:{type:"time",delaySeconds:60},messages:[]},{id:"stage_3",name:"\u50F9\u503C\u7E3D\u7D50",order:3,trigger:{type:"time",delaySeconds:300},messages:[]}]}}[e];if(n){let o=this.multiRoleService.addScript({name:n.name,description:n.description,stages:n.stages});if(this.showNewScriptDialog.set(!1),o){let a=this.multiRoleService.scripts().find(d=>d.id===o);a&&this.editScript(a)}}}openAIPlanner(){this.restoreDraft()?this.toast.info("\u{1F4CB} \u5DF2\u6062\u5FA9\u4E0A\u6B21\u672A\u5B8C\u6210\u7684\u7B56\u5283"):(this.aiPlannerGoal="",this.plannerAccountCount.set(3),this.plannerSelectedAccounts.set([]),this.plannerAccountRoles.set(new Map),this.plannerAutoAssign.set(!0)),this.aiPlannerStatus.set("idle"),this.aiPlanResult.set(null),this.showAIPlannerDialog.set(!0),setTimeout(()=>{this.goalInput?.nativeElement?.focus()},100)}closeAIPlanner(){(this.aiPlannerGoal.trim()||this.selectedTargetUsers().length>0)&&(this.saveDraft(),this.toast.info("\u{1F4BE} \u8349\u7A3F\u5DF2\u81EA\u52D5\u4FDD\u5B58")),this.showAIPlannerDialog.set(!1)}quickAIPlan(e){this.aiPlannerGoal=e,this.openAIPlanner(),setTimeout(()=>this.startAIPlanning(),100)}async startAIPlanning(){if(!this.aiPlannerGoal.trim())return;this.aiPlannerStatus.set("planning"),this.aiPlanningSource.set(null);let e=await this.callAIForPlanning(this.aiPlannerGoal);e?(this.aiPlanningSource.set("ai"),this.toast.success("\u{1F916} AI \u7B56\u5283\u5B8C\u6210\uFF01")):(console.log("[MultiRole] AI \u8ABF\u7528\u5931\u6557\uFF0C\u4F7F\u7528\u6A21\u677F\u56DE\u9000"),e=this.getFallbackPlanByKeywords(this.aiPlannerGoal),this.aiPlanningSource.set("template"),this.toast.warning("\u26A0\uFE0F AI \u670D\u52D9\u66AB\u4E0D\u53EF\u7528\uFF0C\u5DF2\u4F7F\u7528\u667A\u80FD\u6A21\u677F\u7B56\u7565")),this.aiPlanResult.set(e),await this.performAccountMatching()}resetAIPlanner(){this.aiPlannerStatus.set("idle"),this.aiPlanResult.set(null),this.accountMatchResults.set([]),this.aiPlanningSource.set(null),this.plannerSelectedAccounts.set([]),this.plannerAccountRoles.set(new Map),this.showAdvancedAccountSettings.set(!1)}onAccountCountChange(e){let t=parseInt(e.target.value,10);this.plannerAccountCount.set(t),this.saveDraft()}toggleAccountSelection(e){let t=this.plannerSelectedAccounts(),n=this.plannerAccountCount();if(t.includes(e)){this.plannerSelectedAccounts.set(t.filter(a=>a!==e));let o=new Map(this.plannerAccountRoles());o.delete(e),this.plannerAccountRoles.set(o)}else{if(t.length>=n){this.toast.warning(`\u6700\u591A\u9078\u64C7 ${n} \u500B\u5E33\u865F`);return}this.plannerSelectedAccounts.set([...t,e])}this.saveDraft()}selectAllOnlineAccounts(){let e=this.accountService.accounts().filter(t=>t.status==="Online").slice(0,this.plannerAccountCount()).map(t=>t.id);this.plannerSelectedAccounts.set(e),this.saveDraft()}onAccountRoleChange(e,t){let n=t.target.value,o=new Map(this.plannerAccountRoles());n?o.set(e,n):o.delete(e),this.plannerAccountRoles.set(o),this.saveDraft()}getAccountPhone(e){return this.accountService.accounts().find(n=>n.id===e)?.phone||"\u672A\u77E5"}getAssignedRoleName(e){let t=this.plannerAccountRoles().get(e);if(!t)return"\u{1F916} AI \u5206\u914D";let n=this.availableRoleTypes.find(o=>o.id===t);return n?`${n.icon} ${n.name}`:"\u{1F916} AI \u5206\u914D"}getRecommendedAccountCount(){let e=this.selectedTargetUsers();if(e.length===0)return 3;let t=e.reduce((n,o)=>n+o.intentScore,0)/e.length;return t>=80?Math.min(5,this.availableAccountCount()):t>=60?Math.min(4,this.availableAccountCount()):t>=40?Math.min(3,this.availableAccountCount()):Math.min(2,this.availableAccountCount())}getDisplayedRolesCount(){return this.aiPlanResult()?.recommendedRoles?.length||0}toggleAccountExplanation(){this.showAccountExplanation.set(!this.showAccountExplanation())}toggleRoleDropdown(e,t){t.stopPropagation(),this.roleChangeModalIndex()===e?this.roleChangeModalIndex.set(-1):(this.roleChangeModalIndex.set(e),this.backupDropdownId.set(-1))}changeRoleForIndex(e,t){let n=this.accountMatchResults();if(e>=n.length){this.toast.error("\u7121\u6CD5\u66F4\u63DB\uFF1A\u5E33\u865F\u672A\u5339\u914D"),this.roleChangeModalIndex.set(-1);return}if(n[e].roleName===t.name){this.roleChangeModalIndex.set(-1);return}let o=n.findIndex((a,d)=>d!==e&&a.roleName===t.name);if(o>=0){let a=[...n],d=a[e].roleName,u=a[e].roleIcon;a[e]=P(E({},a[e]),{roleName:t.name,roleIcon:t.icon,roleId:t.id}),a[o]=P(E({},a[o]),{roleName:d,roleIcon:u,roleId:n[e].roleId}),this.accountMatchResults.set(a),this.toast.success(`\u{1F504} \u5DF2\u4EA4\u63DB\u89D2\u8272\uFF1A${t.name} \u2194 ${d}`)}else{let a=[...n];a[e]=P(E({},a[e]),{roleName:t.name,roleIcon:t.icon,roleId:t.id}),this.accountMatchResults.set(a),this.toast.success(`\u2713 \u5DF2\u66F4\u63DB\u70BA ${t.icon} ${t.name}`)}this.updateAiPlanRoles(),this.roleChangeModalIndex.set(-1),this.saveDraft()}removeRoleAssignment(e){let t=this.accountMatchResults();if(e>=t.length)return;let n=t[e],o=t.filter((a,d)=>d!==e);this.accountMatchResults.set(o),this.toast.info(`\u26AA ${n.accountPhone} \u5DF2\u79FB\u70BA\u5099\u7528\u5E33\u865F`),this.roleChangeModalIndex.set(-1),this.saveDraft()}toggleBackupDropdown(e,t){t.stopPropagation(),this.backupDropdownId()===e?this.backupDropdownId.set(-1):(this.backupDropdownId.set(e),this.roleChangeModalIndex.set(-1))}closeBackupDropdown(){this.backupDropdownId.set(-1)}assignBackupToRole(e,t){let o=this.accountService.accounts().find(u=>u.id===e);if(!o){this.toast.error("\u627E\u4E0D\u5230\u5E33\u865F"),this.backupDropdownId.set(-1);return}let a=this.accountMatchResults(),d=a.findIndex(u=>u.roleName===t.name);if(d>=0){let u=a[d];if(confirm(`${t.name} \u5DF2\u88AB ${u.accountPhone} \u4F7F\u7528\u3002
\u662F\u5426\u66FF\u63DB\uFF1F`)){let p=[...a];p[d]={roleId:t.id,roleName:t.name,roleIcon:t.icon,accountId:e,accountPhone:o.phone,accountName:o.name||o.phone,matchScore:80,matchReasons:["\u624B\u52D5\u5206\u914D"]},this.accountMatchResults.set(p),this.toast.success(`\u2713 ${o.phone} \u5DF2\u66FF\u63DB\u70BA ${t.icon} ${t.name}`)}}else{let u={roleId:t.id,roleName:t.name,roleIcon:t.icon,accountId:e,accountPhone:o.phone,accountName:o.name||o.phone,matchScore:80,matchReasons:["\u624B\u52D5\u5206\u914D"]};this.accountMatchResults.set([...a,u]),this.toast.success(`\u2713 ${o.phone} \u5DF2\u5206\u914D\u70BA ${t.icon} ${t.name}`)}this.backupDropdownId.set(-1),this.saveDraft()}updateAiPlanRoles(){let e=this.aiPlanResult();if(!e)return;let n=this.accountMatchResults().map(o=>({type:o.roleId,name:o.roleName,icon:o.roleIcon,purpose:e.recommendedRoles?.find(a=>a.name===o.roleName)?.purpose||"\u5354\u52A9\u71DF\u92B7",openingLine:e.recommendedRoles?.find(a=>a.name===o.roleName)?.openingLine}));this.aiPlanResult.set(P(E({},e),{recommendedRoles:n}))}getBackupAccounts(){let e=this.aiPlanResult();if(!e)return[];let t=e.recommendedRoles?.length||0,n=this.plannerAccountCount();if(n<=t)return[];let o=new Set(this.accountMatchResults().map(u=>u.accountId));return this.accountService.accounts().filter(u=>u.status==="Online"&&!o.has(u.id)).slice(0,n-t).map(u=>({id:u.id,phone:u.phone,name:u.name||u.phone}))}saveDraft(){let e={goal:this.aiPlannerGoal,accountCount:this.plannerAccountCount(),selectedAccounts:this.plannerSelectedAccounts(),accountRoles:Array.from(this.plannerAccountRoles().entries()),autoAssign:this.plannerAutoAssign(),targetUsers:this.selectedTargetUsers(),chatScenario:this.selectedChatScenario(),executionMode:this.selectedExecutionMode(),savedAt:Date.now()};localStorage.setItem(this.DRAFT_STORAGE_KEY,JSON.stringify(e)),this.hasDraft.set(!0)}restoreDraft(){try{let e=localStorage.getItem(this.DRAFT_STORAGE_KEY);if(!e)return!1;let t=JSON.parse(e);return Date.now()-t.savedAt>1440*60*1e3?(localStorage.removeItem(this.DRAFT_STORAGE_KEY),!1):(this.aiPlannerGoal=t.goal||"",this.plannerAccountCount.set(t.accountCount||3),this.plannerSelectedAccounts.set(t.selectedAccounts||[]),this.plannerAccountRoles.set(new Map(t.accountRoles||[])),this.plannerAutoAssign.set(t.autoAssign!==!1),t.targetUsers?.length>0&&this.selectedTargetUsers.set(t.targetUsers),t.chatScenario&&this.selectedChatScenario.set(t.chatScenario),t.executionMode&&this.selectedExecutionMode.set(t.executionMode),!0)}catch(e){return console.error("[MultiRole] \u6062\u5FA9\u8349\u7A3F\u5931\u6557:",e),!1}}clearDraft(){localStorage.removeItem(this.DRAFT_STORAGE_KEY),this.hasDraft.set(!1)}async callAIForPlanning(e){return new Promise(t=>{let n=`\u4F60\u662F\u4E00\u4F4D\u8CC7\u6DF1\u7684 Telegram \u71DF\u92B7\u5C08\u5BB6\u3002\u8ACB\u6839\u64DA\u4EE5\u4E0B\u71DF\u92B7\u76EE\u6A19\uFF0C\u8A2D\u8A08\u4E00\u500B\u9AD8\u5EA6\u91DD\u5C0D\u6027\u7684\u591A\u89D2\u8272\u5354\u4F5C\u7B56\u7565\u3002

\u3010\u71DF\u92B7\u76EE\u6A19\u3011
${e}

\u3010\u5206\u6790\u8981\u6C42\u3011
1. \u9996\u5148\u5206\u6790\u76EE\u6A19\uFF0C\u8B58\u5225\uFF1A
   - \u7522\u54C1/\u670D\u52D9\u985E\u578B
   - \u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4
   - \u5BA2\u6236\u53EF\u80FD\u7684\u75DB\u9EDE\u548C\u9867\u616E
   
2. \u7136\u5F8C\u8A2D\u8A08\u91DD\u5C0D\u6027\u89D2\u8272\uFF08\u6BCF\u500B\u89D2\u8272\u5FC5\u9808\u8207\u76EE\u6A19\u7522\u54C1\u76F4\u63A5\u76F8\u95DC\uFF09\uFF1A
   - \u89D2\u8272\u540D\u7A31\u5FC5\u9808\u5305\u542B\u7522\u54C1\u95DC\u9375\u8A5E\uFF08\u5982"\u652F\u4ED8\u9867\u554F"\u800C\u975E"\u92B7\u552E\u5C08\u54E1"\uFF09
   - \u6BCF\u500B\u89D2\u8272\u6709\u660E\u78BA\u7684\u5206\u5DE5\u548C\u8A71\u8853\u5B9A\u4F4D
   
3. \u8A2D\u8A08\u958B\u5834\u8A71\u8853\u9810\u89BD\uFF08\u8B93\u7528\u6236\u9810\u5224\u57F7\u884C\u6548\u679C\uFF09

\u3010JSON \u8FD4\u56DE\u683C\u5F0F\u3011
{
  "goalAnalysis": {
    "productType": "\u8B58\u5225\u7684\u7522\u54C1\u985E\u578B",
    "targetAudience": "\u76EE\u6A19\u5BA2\u6236\u63CF\u8FF0",
    "painPoints": ["\u5BA2\u6236\u75DB\u9EDE1", "\u5BA2\u6236\u75DB\u9EDE2"],
    "keySellingPoints": ["\u7522\u54C1\u512A\u52E21", "\u7522\u54C1\u512A\u52E22"]
  },
  "strategy": "1-2\u53E5\u8A71\u7684\u6574\u9AD4\u7B56\u7565",
  "recommendedRoles": [
    {
      "type": "\u89D2\u8272\u985E\u578B\u5982consultant/user/analyst",
      "name": "\u8207\u7522\u54C1\u76F8\u95DC\u7684\u89D2\u8272\u540D\u7A31",
      "icon": "emoji",
      "purpose": "\u9019\u500B\u89D2\u8272\u7684\u5177\u9AD4\u4F5C\u7528",
      "openingLine": "\u9019\u500B\u89D2\u8272\u7684\u958B\u5834\u767D\u793A\u4F8B"
    }
  ],
  "suggestedFlow": [
    {"step": 1, "action": "\u5177\u9AD4\u884C\u52D5", "role": "\u89D2\u8272\u540D", "scriptPreview": "\u8A71\u8853\u9810\u89BD"}
  ],
  "estimatedSuccessRate": \u6578\u5B57,
  "successRateReason": "\u6210\u529F\u7387\u9810\u4F30\u4F9D\u64DA"
}

\u3010\u91CD\u8981\u3011
- \u89D2\u8272\u5FC5\u9808\u8207\u300C${e}\u300D\u76F4\u63A5\u76F8\u95DC\uFF0C\u4E0D\u8981\u7528\u901A\u7528\u89D2\u8272\u5982"\u5167\u5BB9\u71DF\u92B7\u5C08\u5BB6"
- \u8A71\u8853\u9810\u89BD\u8981\u5305\u542B\u7522\u54C1\u95DC\u9375\u8A5E
- \u5982\u679C\u662F\u652F\u4ED8\u985E\u7522\u54C1\uFF0C\u89D2\u8272\u61C9\u8A72\u662F"\u652F\u4ED8\u9867\u554F"\u3001"\u8CBB\u7387\u5206\u6790\u5E2B"\u7B49
- \u5982\u679C\u662F\u6559\u80B2\u985E\u7522\u54C1\uFF0C\u89D2\u8272\u61C9\u8A72\u662F"\u8AB2\u7A0B\u5C0E\u5E2B"\u3001"\u5B78\u54E1\u4EE3\u8868"\u7B49`;this.ipc.send("ai:generate-text",{prompt:n,maxTokens:1500,responseFormat:"json",callback:"multi-role:ai-plan-result"});let o=45e3,a=null,d=0;this.aiPlanningElapsed.set(0),this.aiPlanningProgress.set("\u{1F50D} AI \u6B63\u5728\u5206\u6790\u60A8\u7684\u76EE\u6A19...");let u=["\u{1F50D} AI \u6B63\u5728\u5206\u6790\u60A8\u7684\u76EE\u6A19...","\u{1F914} \u6B63\u5728\u8B58\u5225\u6700\u4F73\u7B56\u7565...","\u{1F465} \u6B63\u5728\u9078\u64C7\u5408\u9069\u7684\u89D2\u8272\u7D44\u5408...","\u{1F4CB} \u6B63\u5728\u8A2D\u8A08\u57F7\u884C\u6D41\u7A0B...","\u26A1 \u5373\u5C07\u5B8C\u6210\uFF0C\u8ACB\u7A0D\u5019...","\u{1F3AF} \u6700\u5F8C\u512A\u5316\u4E2D..."];a=setInterval(()=>{d+=1,this.aiPlanningElapsed.set(d);let C=Math.min(Math.floor(d/7),u.length-1);this.aiPlanningProgress.set(u[C]),d%5===0&&console.log(`[MultiRole] AI \u8655\u7406\u4E2D... ${d}\u79D2`)},1e3);let p=setTimeout(()=>{console.log(`[MultiRole] AI \u8ABF\u7528\u8D85\u6642 (${o/1e3}\u79D2)`),a&&clearInterval(a),this.aiPlanningProgress.set("\u26A0\uFE0F AI \u97FF\u61C9\u8D85\u6642\uFF0C\u4F7F\u7528\u667A\u80FD\u6A21\u677F..."),g(),t(null)},o),g=this.ipc.on("multi-role:ai-plan-result",C=>{if(clearTimeout(p),a&&clearInterval(a),this.aiPlanningProgress.set("\u2705 AI \u8655\u7406\u5B8C\u6210\uFF01"),g(),console.log("[MultiRole] \u6536\u5230 AI \u97FF\u61C9:",C),!C.success){console.log("[MultiRole] AI \u8ABF\u7528\u5931\u6557:",C.error),t(null);return}try{if(C.text){let w=C.text.match(/\{[\s\S]*\}/);if(w){let A=JSON.parse(w[0]);A.recommendedRoles&&Array.isArray(A.recommendedRoles)&&(A.recommendedRoles=OB(A.recommendedRoles)),console.log("[MultiRole] AI \u7D50\u679C\u89E3\u6790\u6210\u529F:",A),t(A);return}}console.log("[MultiRole] AI \u8FD4\u56DE\u5167\u5BB9\u7121\u6CD5\u89E3\u6790\u70BA JSON"),t(null)}catch(w){console.error("[MultiRole] AI \u7D50\u679C\u89E3\u6790\u5931\u6557:",w),t(null)}})})}getFallbackPlanByKeywords(e){let t=e.toLowerCase();return t.includes("\u6210\u4EA4")||t.includes("\u4ED8\u8CBB")||t.includes("\u8CFC\u8CB7")||t.includes("\u9996\u55AE")?{strategy:"\u63A1\u7528\u300C\u4FE1\u4EFB\u5EFA\u7ACB + \u50F9\u503C\u5C55\u793A + \u9650\u6642\u4FC3\u55AE\u300D\u4E09\u6BB5\u5F0F\u7B56\u7565\uFF0C\u901A\u904E\u8001\u5BA2\u6236\u80CC\u66F8\u5EFA\u7ACB\u4FE1\u4EFB\uFF0C\u5C08\u5BB6\u5C55\u793A\u50F9\u503C\uFF0C\u6700\u5F8C\u7531\u4FC3\u92B7\u5C08\u54E1\u63D0\u4F9B\u9650\u6642\u512A\u60E0\u4FC3\u6210\u6210\u4EA4\u3002",recommendedRoles:[{type:"loyal_customer",name:"\u8001\u7528\u6236",icon:"\u2764\uFE0F",purpose:"\u5206\u4EAB\u771F\u5BE6\u9AD4\u9A57"},{type:"expert",name:"\u7522\u54C1\u5C08\u5BB6",icon:"\u{1F393}",purpose:"\u5C08\u696D\u50F9\u503C\u5C55\u793A"},{type:"sales",name:"\u4FC3\u92B7\u5C08\u54E1",icon:"\u{1F4B0}",purpose:"\u9650\u6642\u512A\u60E0\u4FC3\u55AE"}],suggestedFlow:[{step:1,action:"\u8001\u7528\u6236\u81EA\u7136\u5206\u4EAB\u4F7F\u7528\u9AD4\u9A57\uFF0C\u5EFA\u7ACB\u4FE1\u4EFB",role:"\u8001\u7528\u6236"},{step:2,action:"\u7522\u54C1\u5C08\u5BB6\u8A73\u7D30\u4ECB\u7D39\u529F\u80FD\u548C\u50F9\u503C",role:"\u7522\u54C1\u5C08\u5BB6"},{step:3,action:"\u6839\u64DA\u5BA2\u6236\u53CD\u994B\u89E3\u7B54\u7591\u616E",role:"\u7522\u54C1\u5C08\u5BB6"},{step:4,action:"\u63D0\u4F9B\u9650\u6642\u512A\u60E0\uFF0C\u71DF\u9020\u7DCA\u8FEB\u611F",role:"\u4FC3\u92B7\u5C08\u54E1"}],estimatedSuccessRate:65}:t.includes("\u6D41\u5931")||t.includes("\u633D\u56DE")?{strategy:"\u63A1\u7528\u300C\u95DC\u61F7\u56DE\u8A2A + \u554F\u984C\u89E3\u6C7A + \u7279\u5225\u512A\u60E0\u300D\u7B56\u7565\uFF0C\u5148\u8868\u9054\u95DC\u5FC3\u4E86\u89E3\u96E2\u958B\u539F\u56E0\uFF0C\u91DD\u5C0D\u6027\u89E3\u6C7A\u554F\u984C\uFF0C\u6700\u5F8C\u63D0\u4F9B\u8AA0\u610F\u512A\u60E0\u4FC3\u9032\u56DE\u6B78\u3002",recommendedRoles:[{type:"callback",name:"\u56DE\u8A2A\u5C08\u54E1",icon:"\u{1F4DE}",purpose:"\u771F\u8AA0\u95DC\u61F7\u56DE\u8A2A"},{type:"support",name:"\u5BA2\u670D\u7D93\u7406",icon:"\u{1F3A7}",purpose:"\u89E3\u6C7A\u554F\u984C"},{type:"director",name:"\u5340\u57DF\u7E3D\u76E3",icon:"\u{1F451}",purpose:"\u7279\u5225\u633D\u7559"}],suggestedFlow:[{step:1,action:"\u771F\u8AA0\u95DC\u61F7\uFF0C\u4E86\u89E3\u96E2\u958B\u539F\u56E0",role:"\u56DE\u8A2A\u5C08\u54E1"},{step:2,action:"\u91DD\u5C0D\u554F\u984C\u63D0\u4F9B\u89E3\u6C7A\u65B9\u6848",role:"\u5BA2\u670D\u7D93\u7406"},{step:3,action:"\u9AD8\u5C64\u51FA\u9762\u8868\u9054\u8AA0\u610F",role:"\u5340\u57DF\u7E3D\u76E3"},{step:4,action:"\u63D0\u4F9B\u5C08\u5C6C\u56DE\u6B78\u512A\u60E0",role:"\u5340\u57DF\u7E3D\u76E3"}],estimatedSuccessRate:45}:{strategy:"\u63A1\u7528\u300C\u9700\u6C42\u4E86\u89E3 + \u65B9\u6848\u5C55\u793A + \u8DDF\u9032\u670D\u52D9\u300D\u901A\u7528\u7B56\u7565\uFF0C\u5148\u4E86\u89E3\u5BA2\u6236\u9700\u6C42\uFF0C\u63D0\u4F9B\u5B9A\u5236\u5316\u65B9\u6848\uFF0C\u6301\u7E8C\u8DDF\u9032\u76F4\u5230\u76EE\u6A19\u9054\u6210\u3002",recommendedRoles:[{type:"account_manager",name:"\u5BA2\u6236\u7D93\u7406",icon:"\u{1F4BC}",purpose:"\u4E86\u89E3\u9700\u6C42"},{type:"solution_expert",name:"\u65B9\u6848\u5C08\u5BB6",icon:"\u{1F4CB}",purpose:"\u63D0\u4F9B\u65B9\u6848"}],suggestedFlow:[{step:1,action:"\u4E86\u89E3\u5BA2\u6236\u5177\u9AD4\u9700\u6C42\u548C\u75DB\u9EDE",role:"\u5BA2\u6236\u7D93\u7406"},{step:2,action:"\u6839\u64DA\u9700\u6C42\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848",role:"\u65B9\u6848\u5C08\u5BB6"},{step:3,action:"\u89E3\u7B54\u7591\u554F\u4E26\u6301\u7E8C\u8DDF\u9032",role:"\u5BA2\u6236\u7D93\u7406"}],estimatedSuccessRate:50}}async performAccountMatching(){let e=this.aiPlanResult();if(e){this.aiPlannerStatus.set("matching"),this.matchFailureReason.set(null),this.matchMode.set("normal");try{if(await this.syncAccountStatusBeforeMatch(),!this.plannerAutoAssign()&&this.plannerSelectedAccounts().length>0){let u=this.buildManualAccountMatches(e.recommendedRoles);this.accountMatchResults.set(u),u.length<e.recommendedRoles.length?(this.matchMode.set("multi-role"),this.toast.info(`\u{1F4CB} \u5DF2\u4F7F\u7528\u624B\u52D5\u9078\u64C7\u7684 ${u.length} \u500B\u5E33\u865F`)):this.toast.success("\u2713 \u5DF2\u61C9\u7528\u624B\u52D5\u5E33\u865F\u914D\u7F6E"),this.aiPlannerStatus.set("ready");return}let t={type:"sales_conversion",confidence:80,goal:this.aiPlannerGoal,targetAudience:"\u6F5B\u5728\u5BA2\u6236",urgency:"medium",suggestedDuration:"3-5\u5929"},n=this.plannerAccountCount(),a=e.recommendedRoles.slice(0,n).map((u,p)=>({id:`role_${p}`,name:u.name,icon:u.icon,type:u.type,purpose:u.purpose,personality:"\u5C08\u696D\u53CB\u597D",speakingStyle:"\u81EA\u7136\u5C0D\u8A71",entryTiming:"\u9069\u6642\u5207\u5165",sampleMessages:["\u4F60\u597D\uFF01","\u6709\u4EC0\u9EBC\u53EF\u4EE5\u5E6B\u60A8\u7684\uFF1F"]})),d=await this.dynamicEngine.smartMatchAccountsToRolesEnhanced(a,t,{allowMultiRole:!0,allowOffline:!0});d.length===0?(this.matchFailureReason.set("no_accounts"),this.accountMatchResults.set([])):d.length<a.length?(this.matchMode.set("multi-role"),this.accountMatchResults.set(d.map(u=>({roleId:u.roleId,roleName:u.roleName,roleIcon:u.roleIcon,accountId:u.accountId,accountPhone:u.accountPhone,accountName:u.accountName,matchScore:u.matchScore,matchReasons:u.matchReasons}))),this.toast.info(`\u{1F504} \u5E33\u865F\u4E0D\u8DB3\uFF0C\u5DF2\u555F\u7528\u4E00\u865F\u591A\u89D2\u6A21\u5F0F\uFF08${d.length} \u5E33\u865F\u8F2A\u63DB ${a.length} \u89D2\u8272\uFF09`)):this.accountMatchResults.set(d.map(u=>({roleId:u.roleId,roleName:u.roleName,roleIcon:u.roleIcon,accountId:u.accountId,accountPhone:u.accountPhone,accountName:u.accountName,matchScore:u.matchScore,matchReasons:u.matchReasons})))}catch(t){console.error("[MultiRole] \u5E33\u865F\u5339\u914D\u5931\u6557:",t),this.matchFailureReason.set("error")}this.aiPlannerStatus.set("ready")}}buildManualAccountMatches(e){let t=this.plannerSelectedAccounts(),n=this.plannerAccountRoles(),o=this.accountService.accounts(),a=[],d=new Set,u=new Set;t.forEach(g=>{let C=n.get(g);if(C){let w=e.findIndex(G=>G.type===C||this.availableRoleTypes.find(z=>z.id===C)?.name===G.name),A=this.availableRoleTypes.find(G=>G.id===C),V=o.find(G=>G.id===g);V&&A&&!u.has(w)&&(a.push({roleId:`role_${a.length}`,roleName:A.name,roleIcon:A.icon,accountId:g,accountPhone:V.phone,accountName:V.phone,matchScore:100,matchReasons:["\u624B\u52D5\u6307\u5B9A"]}),d.add(g),w>=0&&u.add(w))}});let p=0;return t.forEach(g=>{if(!d.has(g)){for(;p<e.length&&u.has(p);)p++;if(p<e.length){let C=e[p],w=o.find(A=>A.id===g);w&&(a.push({roleId:`role_${p}`,roleName:C.name,roleIcon:C.icon,accountId:g,accountPhone:w.phone,accountName:w.phone,matchScore:85,matchReasons:["AI \u81EA\u52D5\u5206\u914D"]}),u.add(p)),p++}}}),a}goToAccountManagement(){this.closeAIPlanner(),this.ipc.send("navigate-to-accounts",{})}sendAndWaitForResult(e,t,n,o=3e4){return new Promise(a=>{let d=setTimeout(()=>{console.warn(`[MultiRole] ${e} \u8D85\u6642 (${o}ms)`),u(),a({success:!1,error:"\u64CD\u4F5C\u8D85\u6642"})},o),u=this.ipc.on(t,p=>{clearTimeout(d),u(),console.log(`[MultiRole] ${e} \u7D50\u679C:`,p),a(p)});console.log(`[MultiRole] \u767C\u9001 ${e}:`,n),this.ipc.send(e,n)})}async syncAccountStatusBeforeMatch(){return new Promise(e=>{this.ipc.send("sync-account-status",{}),this.accountService.loadAccounts(),setTimeout(()=>{console.log("[MultiRole] \u5E33\u865F\u72C0\u614B\u5DF2\u540C\u6B65"),e()},800)})}applyAIPlan(){let e=this.aiPlanResult();if(!e)return;let t=this.selectedExecutionMode(),n=this.isPrivateChatMode()?e.recommendedRoles.slice(0,1):e.recommendedRoles;for(let a=0;a<n.length;a++){let d=n[a],u=this.accountMatchResults()[a];this.multiRoleService.roles().find(g=>g.name===d.name)||this.multiRoleService.addRole({name:d.name,type:"custom",boundAccountId:u?.accountId,boundAccountPhone:u?.accountPhone,personality:{description:d.purpose,speakingStyle:"friendly",traits:[]},aiConfig:{useGlobalAI:!0,customPrompt:`\u4F60\u662F${d.name}\uFF0C\u8CA0\u8CAC${d.purpose}\u3002\u8ACB\u7528\u5C08\u696D\u4F46\u53CB\u597D\u7684\u65B9\u5F0F\u8207\u5BA2\u6236\u4EA4\u6D41\u3002`,responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:[d.purpose]})}if(t!=="scriptless"){let a=e.suggestedFlow.map((d,u)=>({id:`stage_${u+1}`,name:d.action.substring(0,20)+"...",order:d.step,trigger:{type:u===0?"manual":"time",delaySeconds:120},messages:[]}));this.multiRoleService.addScript({name:`AI \u7B56\u5283 - ${this.aiPlannerGoal.substring(0,15)}...`,description:e.strategy,stages:a})}let o=this.selectedTargetUsers();this.dynamicEngine.startFromOnePhrase(this.aiPlannerGoal,t,o.length>0?o:void 0).then(async a=>{if(a){let d=o.length>0?`\uFF0C\u76EE\u6A19 ${o.length} \u4EBA`:"";if(this.toast.success(`\u{1F680} \u79C1\u804A\u6A21\u5F0F\u5DF2\u5C31\u7DD2\uFF01${d}`),o.length>0){let p=this.accountMatchResults()[0];for(let g of o){let C=[{roleId:p?.roleId||"consultant",roleName:p?.roleName||"\u9867\u554F",roleIcon:p?.roleIcon||"\u{1F4BC}",accountId:p?.accountId||0,accountPhone:p?.accountPhone||"",entryOrder:1,entryDelaySeconds:0,entryType:"opener",openingMessage:e.recommendedRoles[0]?.openingLine}],w=this.orchestrator.createSession({targetUserId:g.telegramId||g.id,targetUserName:g.firstName||g.username||"Customer",roles:C,rhythm:{minIntervalSeconds:15,maxIntervalSeconds:45,waitForUserReply:!0,userSilenceTimeoutSeconds:120}});await this.orchestrator.startCollaboration(w.id),console.log("[MultiRole] \u{1F3AF} \u79C1\u804A\u5354\u4F5C\u6703\u8A71\u5DF2\u5275\u5EFA:",w.id,g.firstName||g.username)}}}}),this.closeAIPlanner(),this.activeTab.set("dashboard"),this.selectedTargetUsers.set([])}async startGroupCollaboration(){let e=this.aiPlanResult();if(!e)return;let t=this.selectedTargetUsers();if(t.length===0){this.toast.error("\u8ACB\u5148\u9078\u64C7\u76EE\u6A19\u7528\u6236");return}if(!this.hasEnoughAccounts()){this.toast.error(`\u5E33\u865F\u4E0D\u8DB3\uFF01\u9700\u8981 ${this.requiredAccountsForGroup()} \u500B\u5E33\u865F`);return}let n=this.selectedExecutionMode(),o=this.accountMatchResults(),a=o[0];if(!a){this.toast.error("\u6C92\u6709\u53EF\u7528\u7684\u4E3B\u5E33\u865F");return}console.log("[MultiRole] \u958B\u59CB\u7FA4\u804A\u5354\u4F5C\u6D41\u7A0B"),console.log("[MultiRole] \u4E3B\u5E33\u865F:",a.accountPhone),console.log("[MultiRole] \u76EE\u6A19\u7528\u6236:",t.length),console.log("[MultiRole] \u89D2\u8272\u5E33\u865F:",o.length);try{this.groupCreationStatus.set("creating"),this.groupCreationProgress.set("\u6B63\u5728\u5275\u5EFA\u7FA4\u7D44...");let d=t[0],u=`VIP\u670D\u52D9\u7FA4 - ${d.firstName||d.username||"Customer"}`,p=await this.sendAndWaitForResult("create-group","create-group-result",{name:u,description:e.strategy,type:"group",accountPhone:a.accountPhone});if(!p.success)throw new Error(p.error||"\u5275\u5EFA\u7FA4\u7D44\u5931\u6557");let g=p.groupId||p.chatId;this.createdGroupId.set(g),console.log("[MultiRole] \u7FA4\u7D44\u5275\u5EFA\u6210\u529F:",g),this.groupCreationStatus.set("inviting_target"),this.groupCreationProgress.set("\u6B63\u5728\u9080\u8ACB\u5BA2\u6236\u52A0\u5165...");let C=p.groupUrl||"",w=0,A=0;for(let Y of t)try{let re=await this.sendAndWaitForResult("group:invite-user","group:invite-user-result",{groupId:g,groupName:u,inviterPhone:a.accountPhone,targetUserId:Y.telegramId||Y.id,targetUsername:Y.username},15e3);if(re.success){w++,console.log("[MultiRole] \u6210\u529F\u9080\u8ACB\u7528\u6236:",Y.firstName||Y.username);try{this.ipc.send("send-message",{accountPhone:a.accountPhone,userId:Y.telegramId||Y.id,content:`\u55E8 ${Y.firstName||Y.username||""}\uFF01\u6211\u5011\u525B\u525B\u70BA\u60A8\u5275\u5EFA\u4E86\u5C08\u5C6C VIP \u670D\u52D9\u7FA4\u300C${u}\u300D\u{1F389}

\u7FA4\u88E1\u6709\u6211\u5011\u7684\u5C08\u696D\u5718\u968A\uFF0C\u53EF\u4EE5\u66F4\u5FEB\u901F\u5730\u70BA\u60A8\u89E3\u7B54\u554F\u984C\u3002\u6B61\u8FCE\u5230\u7FA4\u88E1\u804A\uFF01`}),console.log("[MultiRole] \u5DF2\u767C\u9001\u5165\u7FA4\u901A\u77E5\u7D66:",Y.firstName||Y.username)}catch(le){console.warn("[MultiRole] \u767C\u9001\u5165\u7FA4\u901A\u77E5\u5931\u6557:",le)}}else{A++;let le=re.error||"\u672A\u77E5\u932F\u8AA4";console.warn("[MultiRole] \u9080\u8ACB\u5931\u6557:",le);let ue=Y.firstName||Y.username||Y.id;if(le.includes("PRIVACY")||le.includes("\u96B1\u79C1")?this.toast.warning(`\u26A0\uFE0F ${ue} \u7684\u96B1\u79C1\u8A2D\u7F6E\u4E0D\u5141\u8A31\u9080\u8ACB\uFF0C\u6B63\u5728\u767C\u9001\u7FA4\u9080\u8ACB\u9023\u7D50...`):le.includes("MUTUAL")||le.includes("\u597D\u53CB")?this.toast.warning(`\u26A0\uFE0F \u9700\u8981\u5148\u8207 ${ue} \u4E92\u76F8\u6DFB\u52A0\u597D\u53CB\uFF0C\u6B63\u5728\u767C\u9001\u7FA4\u9080\u8ACB\u9023\u7D50...`):le.includes("FLOOD")||le.includes("\u983B\u7E41")?this.toast.error("\u274C \u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"):le.includes("\u672A\u9023\u63A5")&&this.toast.error("\u274C \u9080\u8ACB\u5E33\u865F\u672A\u9023\u63A5\uFF0C\u8ACB\u6AA2\u67E5\u5E33\u865F\u72C0\u614B"),C)try{this.ipc.send("send-message",{accountPhone:a.accountPhone,userId:Y.telegramId||Y.id,content:`\u60A8\u597D\uFF01\u8AA0\u9080\u60A8\u52A0\u5165\u6211\u5011\u7684 VIP \u5C08\u5C6C\u670D\u52D9\u7FA4\uFF1A
${C}

\u{1F446} \u9EDE\u64CA\u4E0A\u65B9\u9023\u7D50\u5373\u53EF\u52A0\u5165\uFF0C\u6211\u5011\u7684\u5C08\u696D\u5718\u968A\u5C07\u70BA\u60A8\u63D0\u4F9B\u4E00\u5C0D\u4E00\u670D\u52D9\uFF01`}),console.log("[MultiRole] \u5DF2\u767C\u9001\u9080\u8ACB\u9023\u7D50\u7D66:",Y.firstName||Y.username),A--,w++,this.ipc.send("record-action",{userId:Y.telegramId||Y.id,actionType:"group_invite_link",actionDetails:{group_id:g,group_name:u,group_url:C},performedBy:a.accountPhone})}catch(pe){console.warn("[MultiRole] \u767C\u9001\u9080\u8ACB\u9023\u7D50\u5931\u6557:",pe)}else this.toast.warning(`\u26A0\uFE0F \u7121\u6CD5\u76F4\u63A5\u9080\u8ACB ${ue}\uFF0C\u4E14\u6C92\u6709\u7FA4\u9080\u8ACB\u9023\u7D50\u53EF\u767C\u9001`)}}catch(re){A++,console.warn("[MultiRole] \u9080\u8ACB\u5BA2\u6236\u7570\u5E38:",Y,re)}console.log(`[MultiRole] \u9080\u8ACB\u5B8C\u6210: \u6210\u529F/\u5DF2\u767C\u9080\u8ACB ${w}, \u5931\u6557 ${A}`),this.groupCreationStatus.set("inviting_roles"),this.groupCreationProgress.set("\u6B63\u5728\u9080\u8ACB\u5354\u4F5C\u5E33\u865F...");let V=3,G=3e3,z=0;for(let Y=1;Y<o.length;Y++){let re=o[Y],le=!1;for(let ue=1;ue<=V&&!le;ue++)try{console.log(`[MultiRole] \u5617\u8A66\u6DFB\u52A0\u89D2\u8272\u5E33\u865F (${ue}/${V}):`,re.accountPhone);let pe=await this.sendAndWaitForResult("group:add-member","group:add-member-result",{groupId:g,adderPhone:a.accountPhone,memberPhone:re.accountPhone},15e3);pe.success?(console.log("[MultiRole] \u2713 \u6210\u529F\u6DFB\u52A0\u89D2\u8272\u5E33\u865F:",re.accountPhone,re.roleName),le=!0,z++):(console.warn(`[MultiRole] \u26A0 \u6DFB\u52A0\u89D2\u8272\u5E33\u865F\u5931\u6557 (\u5617\u8A66 ${ue}):`,re.accountPhone,pe.error),ue<V&&(console.log(`[MultiRole] \u7B49\u5F85 ${G/1e3} \u79D2\u5F8C\u91CD\u8A66...`),await new Promise(Fe=>setTimeout(Fe,G))))}catch(pe){console.warn(`[MultiRole] \u274C \u6DFB\u52A0\u89D2\u8272\u5E33\u865F\u7570\u5E38 (\u5617\u8A66 ${ue}):`,re.accountPhone,pe),ue<V&&await new Promise(Fe=>setTimeout(Fe,G))}le||this.toast.warning(`\u26A0\uFE0F \u7121\u6CD5\u6DFB\u52A0\u5E33\u865F ${re.accountPhone} \u5230\u7FA4\u7D44\uFF0C\u5C07\u4F7F\u7528\u73FE\u6709\u5E33\u865F\u7E7C\u7E8C`)}console.log(`[MultiRole] \u{1F4CA} \u89D2\u8272\u5E33\u865F\u6DFB\u52A0\u7D50\u679C: ${z}/${o.length-1} \u6210\u529F`),this.groupCreationProgress.set("\u767C\u9001\u6B61\u8FCE\u6D88\u606F..."),this.ipc.send("send-group-message",{resourceId:g,content:`\u6B61\u8FCE\u52A0\u5165 VIP \u5C08\u5C6C\u670D\u52D9\u7FA4\uFF01\u{1F389}

\u6211\u5011\u7684\u5C08\u696D\u5718\u968A\u5C07\u70BA\u60A8\u63D0\u4F9B\u4E00\u5C0D\u4E00\u7684\u5C08\u5C6C\u670D\u52D9\u3002\u6709\u4EFB\u4F55\u554F\u984C\u90FD\u53EF\u4EE5\u76F4\u63A5\u5728\u7FA4\u5167\u63D0\u51FA\uFF01`,accountPhone:a.accountPhone}),this.groupCreationProgress.set("\u555F\u52D5\u5354\u4F5C\u76E3\u807D...");let $=o.map((Y,re)=>({phone:Y.accountPhone,roleId:Y.roleId||`role_${re}`,roleName:Y.roleName||e.recommendedRoles[re]?.name||"\u52A9\u624B",prompt:e.recommendedRoles[re]?.purpose||"\u5354\u52A9\u670D\u52D9\u5BA2\u6236"}));this.ipc.send("group:monitor-messages",{groupId:g,roles:$,mainAccountPhone:a.accountPhone}),console.log("[MultiRole] \u5DF2\u555F\u52D5\u7FA4\u804A\u76E3\u807D\uFF0C\u89D2\u8272\u6578:",$.length);for(let Y of e.recommendedRoles){let re=o.find(ue=>ue.roleName===Y.name);this.multiRoleService.roles().find(ue=>ue.name===Y.name)||this.multiRoleService.addRole({name:Y.name,type:"custom",boundAccountId:re?.accountId,boundAccountPhone:re?.accountPhone,personality:{description:Y.purpose,speakingStyle:"friendly",traits:[]},aiConfig:{useGlobalAI:!0,customPrompt:`\u4F60\u662F${Y.name}\uFF0C\u5728\u7FA4\u804A\u4E2D\u8CA0\u8CAC${Y.purpose}\u3002\u8ACB\u914D\u5408\u5176\u4ED6\u89D2\u8272\u5354\u4F5C\u670D\u52D9\u5BA2\u6236\u3002`,responseLength:"medium",emojiFrequency:"low",typingSpeed:"medium"},responsibilities:[Y.purpose]})}await this.dynamicEngine.startFromOnePhrase(this.aiPlannerGoal,n,t,{chatScenario:"group",groupId:g,roleAccounts:o});let K=o.map((Y,re)=>({roleId:Y.roleId||`role_${re}`,roleName:Y.roleName,roleIcon:Y.roleIcon||"\u{1F464}",accountId:Y.accountId,accountPhone:Y.accountPhone,entryOrder:re+1,entryDelaySeconds:re===0?0:30+re*15,entryType:re===0?"opener":re===1?"supporter":"atmosphere",openingMessage:e.recommendedRoles[re]?.openingLine})),Z=this.orchestrator.createSession({targetUserId:d.telegramId||d.id,targetUserName:d.firstName||d.username||"Customer",groupId:g,roles:K,rhythm:{minIntervalSeconds:20,maxIntervalSeconds:60,waitForUserReply:!0,userSilenceTimeoutSeconds:180}});await this.orchestrator.startCollaboration(Z.id),console.log("[MultiRole] \u{1F3AF} \u5354\u4F5C\u7DE8\u6392\u670D\u52D9\u5DF2\u555F\u52D5\uFF0C\u6703\u8A71ID:",Z.id),this.groupCreationStatus.set("ready"),this.toast.success(`\u{1F389} \u7FA4\u804A\u5354\u4F5C\u5DF2\u555F\u52D5\uFF01\u7FA4\u7D44: ${u}`),this.closeAIPlanner(),this.activeTab.set("dashboard"),this.selectedTargetUsers.set([])}catch(d){console.error("[MultiRole] \u7FA4\u804A\u5354\u4F5C\u5931\u6557:",d),this.groupCreationStatus.set("error"),this.toast.error(`\u7FA4\u804A\u5354\u4F5C\u5931\u6557: ${d.message||d}`)}}saveSettings(){this.multiRoleService.updateAutoGroupSettings({nameTemplate:this.autoGroupNameTemplate,inviteMessageTemplate:this.inviteMessage,maxConcurrentGroups:this.maxConcurrent,autoCloseAfterDays:this.autoCloseDays}),this.multiRoleService.updateTriggerConditions({intentScoreThreshold:this.intentThreshold,minConversationRounds:this.minRounds,requirePriceInquiry:this.requirePriceInquiry}),this.multiRoleService.updateAISettings({useAICenter:this.useAICenter,coordinationMode:this.coordinationMode})}calculateContactIntent(e){let t=30;return e.status==="replied"?t+=30:e.status==="contacted"?t+=15:e.status==="new"&&(t+=10),e.source_type==="lead"?t+=20:e.source_type==="member"&&(t+=10),e.tags?.includes("\u9AD8\u610F\u5411")?t+=25:e.tags?.includes("\u6709\u8208\u8DA3")&&(t+=15),e.last_message_at&&(t+=10),Math.min(100,t)}openTargetUserSelector(){this.syncTargetUsersFromSendConsole(),this.showTargetUserSelector.set(!0)}syncTargetUsersFromSendConsole(){if(this.isSyncingTargetUsers())return;this.isSyncingTargetUsers.set(!0),this.ipc.send("get-leads-paginated",{page:1,pageSize:500,status:null,search:null});let e=this.ipc.on("leads-paginated",t=>{e(),this.isSyncingTargetUsers.set(!1),t.leads&&t.leads.length>0?(console.log("[MultiRole] \u5F9E\u767C\u9001\u63A7\u5236\u53F0\u540C\u6B65\u6578\u64DA:",t.leads.length),this.contactsService.importLeadsDirectly(t.leads),this.toast.success(`\u2705 \u5DF2\u540C\u6B65 ${t.leads.length} \u500B\u76EE\u6A19\u7528\u6236`)):this.toast.warning("\u26A0\uFE0F \u767C\u9001\u63A7\u5236\u53F0\u66AB\u7121\u6578\u64DA\uFF0C\u8ACB\u5148\u6DFB\u52A0\u76EE\u6A19\u5BA2\u6236")});setTimeout(()=>{this.isSyncingTargetUsers()&&(this.isSyncingTargetUsers.set(!1),this.toast.error("\u540C\u6B65\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},1e4)}closeTargetUserSelector(){this.showTargetUserSelector.set(!1),this.targetUserSearchQuery=""}toggleTargetUser(e){let t=this.selectedTargetUsers();t.find(o=>o.telegramId===e.telegramId)?this.selectedTargetUsers.set(t.filter(o=>o.telegramId!==e.telegramId)):this.selectedTargetUsers.set([...t,e])}confirmTargetUsers(){let e=this.selectedTargetUsers();if(e.length===0){this.toast.warning("\u8ACB\u81F3\u5C11\u9078\u64C7\u4E00\u500B\u76EE\u6A19\u7528\u6236");return}this.toast.success(`\u5DF2\u9078\u64C7 ${e.length} \u500B\u76EE\u6A19\u7528\u6236`),this.closeTargetUserSelector()}isUserSelected(e){return this.selectedTargetUsers().some(t=>t.telegramId===e.telegramId)}toggleSelectAll(){let e=this.filteredTargetUsers();if(e.every(n=>this.isUserSelected(n))){let n=new Set(e.map(o=>o.telegramId));this.selectedTargetUsers.set(this.selectedTargetUsers().filter(o=>!n.has(o.telegramId)))}else{let n=new Set(this.selectedTargetUsers().map(a=>a.telegramId)),o=e.filter(a=>!n.has(a.telegramId));this.selectedTargetUsers.set([...this.selectedTargetUsers(),...o])}}clearSelectedUsers(){this.selectedTargetUsers.set([])}selectHighIntentUsers(){let e=this.availableTargetUsers().filter(t=>t.intentScore>=60);this.selectedTargetUsers.set(e.slice(0,20)),this.toast.info(`\u5DF2\u9078\u64C7 ${this.selectedTargetUsers().length} \u500B\u9AD8\u610F\u5411\u7528\u6236`)}searchTargetUsers(){this.targetUserSearchQuery.trim()&&this.toast.info(`\u627E\u5230 ${this.filteredTargetUsers().length} \u500B\u5339\u914D\u7528\u6236`)}clearSearchQuery(){this.targetUserSearchQuery=""}isAllSelected(){let e=this.filteredTargetUsers(),t=this.selectedTargetUsers();return e.length>0&&e.every(n=>t.some(o=>o.id===n.id))}triggerImportFile(){this.importFileInput?.nativeElement?.click()}handleImportFile(e){let t=e.target,n=t.files?.[0];if(!n)return;let o=new FileReader;o.onload=a=>{let d=a.target?.result;this.parseImportFile(d,n.name)},o.onerror=()=>{this.toast.error("\u8B80\u53D6\u6587\u4EF6\u5931\u6557")},o.readAsText(n),t.value=""}parseImportFile(e,t){let n=e.split(`
`).filter(C=>C.trim()),o=[],a=0,d=n[0]?.toLowerCase()||"";(d.includes("telegram")||d.includes("username")||d.includes("id")||d.includes("\u7528\u6236"))&&(a=1);for(let C=a;C<n.length;C++){let w=n[C].trim();if(!w)continue;let A=w.split(",").map(V=>V.trim().replace(/"/g,""));if(A.length>=1){let V=A[0],G=A[1]||"",z=A[2]||A[1]||V,$=parseInt(A[3])||50;V&&(V.match(/^\d+$/)||V.startsWith("@"))&&o.push({id:V,telegramId:V.startsWith("@")?"":V,username:V.startsWith("@")?V.slice(1):G,firstName:z,lastName:"",intentScore:$,source:"import"})}}if(o.length===0){this.toast.error("\u672A\u80FD\u5F9E\u6587\u4EF6\u4E2D\u89E3\u6790\u51FA\u6709\u6548\u7528\u6236");return}let u=this.selectedTargetUsers(),p=new Set(u.map(C=>C.telegramId||C.id)),g=o.filter(C=>!p.has(C.telegramId||C.id));this.selectedTargetUsers.set([...u,...g]),this.toast.success(`\u{1F4E5} \u5DF2\u5C0E\u5165 ${g.length} \u500B\u7528\u6236\uFF08\u5171 ${this.selectedTargetUsers().length} \u500B\uFF09`)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-multi-role-center"]],viewQuery:function(t,n){if(t&1&&ci(ON,5)(UN,5),t&2){let o;Rn(o=Nn())&&(n.importFileInput=o.first),Rn(o=Nn())&&(n.goalInput=o.first)}},hostBindings:function(t,n){t&1&&x("click",function(a){return n.onDocumentClick(a)},lo)},decls:49,vars:11,consts:[["goalInput",""],["importFileInput",""],[1,"multi-role-center","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-2","px-3","py-1","bg-purple-500/20","text-purple-400","rounded-full","text-sm"],[1,"px-3","py-1","bg-slate-700","text-slate-400","rounded-full","text-sm"],[1,"flex","items-center","gap-4","px-4","py-2","bg-slate-800/80","rounded-xl","border","border-slate-700/50"],[1,"text-center"],[1,"text-lg","font-bold","text-purple-400"],[1,"text-xs","text-slate-500"],[1,"w-px","h-8","bg-slate-700"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-lg","font-bold","text-emerald-400"],[1,"flex","gap-1","mt-4","bg-slate-800/50","p-1","rounded-xl","w-fit"],[1,"px-5","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"bg-gradient-to-r","from-purple-500","to-pink-500","text-white","shadow-lg","text-slate-400","hover:text-white","hover:bg-slate-700/50"],[1,"flex-1","overflow-y-auto","p-4"],[1,"space-y-6"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"max-w-3xl","mx-auto","space-y-6"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[3,"role","availableAccounts"],[3,"script"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"w-2","h-2","bg-purple-500","rounded-full","animate-pulse"],[1,"px-5","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"click"],[1,"text-lg"],[1,"bg-gradient-to-r","from-purple-500/20","via-pink-500/20","to-cyan-500/20","rounded-2xl","border","border-purple-500/30","p-6"],[1,"text-xl","font-bold","text-white","flex","items-center","gap-3"],[1,"px-2","py-0.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","text-xs","rounded-full"],[1,"text-slate-400","mt-1"],[1,"px-6","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","flex","items-center","gap-2",3,"click"],[1,"mt-4","flex","flex-wrap","gap-2"],[1,"text-sm","text-slate-500"],[1,"px-3","py-1.5","bg-slate-700/50","text-slate-300","text-sm","rounded-lg","hover:bg-slate-700","transition-colors",3,"click"],[3,"roleAdded","roleEdit"],[1,"text-xl","font-bold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-1"],[3,"scenarioApplied"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"space-y-4"],[1,"flex","items-center","justify-between","p-4","bg-slate-700/50","rounded-xl","hover:bg-slate-700","transition-colors"],[1,"text-center","py-12","text-slate-400"],[1,"text-sm","font-medium","text-white","mb-4"],[1,"grid","grid-cols-3","gap-3"],[1,"p-4","bg-slate-700/50","rounded-xl","text-center","hover:bg-slate-700","transition-colors"],[1,"w-14","h-14","rounded-xl","flex","items-center","justify-center","text-3xl"],[1,"font-medium","text-white"],[1,"text-sm","text-slate-400"],[1,"flex","items-center","gap-2","mt-1"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded-full"],[1,"px-2","py-0.5","bg-yellow-500/20","text-yellow-400","text-xs","rounded-full"],[1,"px-2","py-0.5","bg-slate-600","text-slate-300","text-xs","rounded"],[1,"flex","items-center","gap-3"],[1,"px-3","py-1.5","bg-slate-600","text-slate-300","rounded-lg","text-sm","hover:bg-slate-500",3,"click"],[1,"text-slate-500","hover:text-red-400",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-5xl","mb-4"],[1,"text-lg","mb-2"],[1,"text-sm","mb-4"],[1,"px-6","py-3","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors",3,"click"],[1,"p-4","bg-slate-700/50","rounded-xl","text-center","hover:bg-slate-700","transition-colors",3,"click"],[1,"text-3xl","mb-2"],[1,"text-sm","text-white","font-medium"],[1,"text-xs","text-slate-400","mt-1"],[1,"p-4","bg-slate-700/50","rounded-xl"],[1,"text-center","py-8","text-slate-400"],[1,"grid","grid-cols-2","gap-4"],[1,"p-4","bg-slate-700/50","rounded-xl","text-left","hover:bg-slate-700","transition-colors",3,"click"],[1,"flex","items-center","gap-3","mb-2"],[1,"flex","items-center","justify-between","mb-3"],[1,"px-2","py-1","bg-slate-600","text-slate-300","text-xs","rounded"],[1,"text-purple-400","hover:text-purple-300","text-sm",3,"click"],[1,"text-red-400","hover:text-red-300","text-sm",3,"click"],[1,"flex","items-center","gap-2","mt-3"],[1,"flex","items-center","gap-4","mt-3","pt-3","border-t","border-slate-600/50","text-xs","text-slate-400"],[1,"px-3","py-1.5","bg-slate-600/50","rounded-lg","text-xs","text-slate-300"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-4xl","mb-2"],[1,"mt-3","px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg",3,"click"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors"],[1,"font-semibold","text-white","mb-6","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","block","mb-2"],["type","text","placeholder","VIP\u5C08\u5C6C\u670D\u52D9\u7FA4 - {\u5BA2\u6236\u540D}",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1"],["rows","3","placeholder","\u70BA\u4E86\u66F4\u597D\u5730\u670D\u52D9\u60A8...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none",3,"ngModelChange","ngModel"],["type","number","min","1","max","20",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"ngModelChange","ngModel"],["type","number","min","1","max","30",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white",3,"ngModelChange","ngModel"],["type","range","min","50","max","100","step","5",1,"flex-1",3,"ngModelChange","ngModel"],[1,"text-white","w-12","text-right"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","cursor-pointer"],[1,"text-white"],[1,"text-xs","text-slate-400"],["type","checkbox",1,"w-5","h-5","rounded","text-purple-500","bg-slate-700","border-slate-600",3,"ngModelChange","ngModel"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","cursor-pointer","mb-4"],[1,"flex","gap-2"],[1,"flex-1","py-2","px-4","rounded-lg","text-sm","transition-colors",3,"click"],[1,"w-full","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","font-medium",3,"click"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-lg","p-6","shadow-xl","border","border-slate-700","max-h-[90vh]","overflow-y-auto"],[1,"text-xl","font-bold","text-white","mb-6"],[1,"grid","grid-cols-3","gap-2"],[1,"p-3","rounded-lg","text-center","transition-all","border-2",3,"border-purple-500","bg-purple-500/10","border-transparent","bg-slate-700"],["type","text","placeholder","\u5982\uFF1A\u7522\u54C1\u5C08\u5BB6 Mira",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],["rows","3","placeholder","\u63CF\u8FF0\u9019\u500B\u89D2\u8272\u7684\u80CC\u666F\u548C\u6027\u683C...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none",3,"ngModelChange","ngModel"],["rows","4","placeholder","\u4F60\u662F\u4E00\u4F4D...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none",3,"ngModelChange","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-2.5","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors",3,"click"],[1,"p-3","rounded-lg","text-center","transition-all","border-2",3,"click"],[1,"text-2xl","mb-1"],[1,"text-xs"],[3,"saved","cancelled","role","availableAccounts"],[3,"saved","cancelled","script"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-purple-500/30","overflow-hidden"],[1,"p-6","bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border-b","border-slate-700/50"],[1,"text-slate-400","hover:text-white","p-2","hover:bg-slate-800","rounded-lg",3,"click"],[1,"p-6","space-y-6"],[1,"text-center","py-8"],[1,"space-y-4","max-h-[60vh]","overflow-y-auto"],[1,"p-6","border-t","border-slate-700/50","flex","gap-3"],["rows","3","placeholder","\u4F8B\u5982\uFF1A\u628A\u5C0D\u7522\u54C1\u6709\u8208\u8DA3\u4F46\u9084\u5728\u7336\u8C6B\u7684\u5BA2\u6236\u8F49\u5316\u6210\u4ED8\u8CBB\u7528\u6236...",1,"w-full","px-4","py-3","bg-slate-800","border","border-slate-700","rounded-xl","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"ngModelChange","click","ngModel"],[1,"grid","grid-cols-2","gap-3"],[1,"p-3","bg-slate-800","rounded-xl","text-left","hover:bg-slate-700","transition-colors","border","border-slate-700",3,"click"],[1,"text-lg","mb-1"],[1,"inline-block","animate-spin","text-4xl","mb-4"],[1,"text-white","font-medium"],[1,"text-slate-400","text-sm","mt-2"],[1,"mt-4","flex","items-center","justify-center","gap-2"],[1,"text-slate-500","text-xs","mt-3"],[1,"w-32","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-purple-500","to-pink-500","animate-pulse"],[1,"p-4","bg-indigo-500/10","border","border-indigo-500/30","rounded-xl"],[1,"p-4","bg-green-500/10","border","border-green-500/30","rounded-xl"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2","text-green-400"],[1,"font-medium"],[1,"px-2","py-1","bg-purple-500/20","text-purple-400","text-xs","rounded-full","flex","items-center","gap-1"],[1,"px-2","py-1","bg-slate-600/50","text-slate-400","text-xs","rounded-full","flex","items-center","gap-1"],[1,"text-slate-300"],[1,"text-sm","text-slate-400","mb-3"],[1,"p-4","rounded-xl","border-2","transition-all","text-left",3,"click"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-xs","text-slate-400","space-y-1","mt-3"],[1,"mt-3","text-xs","text-blue-400"],[1,"text-xs","text-green-400"],[1,"mt-3","text-xs"],[1,"text-red-400"],[1,"mt-3","p-3","bg-amber-500/10","border","border-amber-500/30","rounded-lg"],[1,"mt-3","p-3","bg-green-500/10","border","border-green-500/30","rounded-lg"],[1,"p-3","rounded-lg","border","transition-all","text-left",3,"click"],[1,"flex","items-center","gap-2","mb-1"],[1,"px-1.5","py-0.5","bg-cyan-500","text-white","text-xs","rounded"],[1,"p-3","bg-slate-800","rounded-lg"],[1,"text-center","py-4"],[1,"border","border-slate-700/50","rounded-xl","overflow-hidden"],[1,"w-full","p-3","bg-slate-800/50","flex","items-center","justify-between","hover:bg-slate-800","transition-colors",3,"click"],[1,"px-2","py-0.5","bg-purple-500/20","text-purple-400","text-xs","rounded"],[1,"px-2","py-0.5","bg-cyan-500/20","text-cyan-400","text-xs","rounded"],[1,"text-slate-400","text-sm"],[1,"p-4","space-y-4","bg-slate-800/30"],[1,"text-xs","text-purple-400","hover:text-purple-300","flex","items-center","gap-1"],[1,"mb-3","p-3","bg-purple-500/10","border","border-purple-500/30","rounded-lg","text-sm"],[1,"bg-slate-800","rounded-lg","border","border-slate-700","overflow-hidden"],[1,"w-full","text-sm"],[1,"bg-slate-900/50"],[1,"text-slate-400","text-xs"],[1,"px-3","py-2","text-left"],[1,"px-3","py-2","text-center"],[1,"px-3","py-2","text-right"],[1,"divide-y","divide-slate-700/50"],[1,"hover:bg-slate-700/30"],[1,"hover:bg-slate-700/30","opacity-60"],[1,"mt-3","p-3","bg-slate-800","rounded-lg","border","border-slate-700"],[1,"mt-3","text-center","py-2","text-slate-400","text-sm"],[1,"mt-3","p-4","bg-amber-500/10","border","border-amber-500/30","rounded-lg"],[1,"mt-3","p-3","bg-cyan-500/10","border","border-cyan-500/30","rounded-lg","text-sm"],[1,"p-4","bg-pink-500/10","border","border-pink-500/30","rounded-xl"],[1,"text-slate-400"],[1,"text-lg","font-bold"],[1,"mt-2","text-xs","text-slate-500","border-t","border-slate-700","pt-2"],[1,"text-sm","text-indigo-400","font-medium","mb-3","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-3","text-sm"],[1,"text-slate-500","text-xs","mb-1"],[1,"mt-3"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-red-500/20","text-red-400","text-xs","rounded"],[1,"px-2","py-1","bg-green-500/20","text-green-400","text-xs","rounded"],[1,"flex","items-center","gap-2","text-amber-400","text-sm"],[1,"mt-2","px-4","py-2","bg-amber-500/20","text-amber-400","rounded-lg","hover:bg-amber-500/30","text-sm",3,"click"],[1,"text-xs","text-green-400","font-medium","mb-2"],[1,"flex","items-center","gap-2","text-xs","text-slate-400"],[1,"px-2","py-1","bg-slate-700","rounded"],[1,"text-slate-500","mb-3"],[1,"flex","gap-2","justify-center","flex-wrap"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","text-sm",3,"click"],[1,"px-4","py-2","bg-amber-500/20","text-amber-400","rounded-lg","hover:bg-amber-500/30","text-sm",3,"click"],[1,"px-4","py-2","bg-cyan-500/20","text-cyan-400","rounded-lg","hover:bg-cyan-500/30","text-sm",3,"click"],["type","file","accept",".csv,.txt",1,"hidden",3,"change"],[1,"text-emerald-400","text-sm"],[1,"text-xs","text-slate-400","hover:text-white",3,"click"],[1,"text-xs","text-red-400","hover:text-red-300",3,"click"],[1,"px-2","py-1","bg-slate-700","rounded","text-xs","text-slate-300"],[1,"px-2","py-1","bg-slate-600","rounded","text-xs","text-slate-400"],[1,"text-amber-400","ml-1"],["type","range",1,"flex-1","h-2","bg-slate-700","rounded-lg","appearance-none","cursor-pointer","accent-purple-500",3,"input","min","max","value"],[1,"flex","gap-1"],[1,"w-8","h-8","rounded-lg","text-sm","font-medium","disabled:opacity-30","disabled:cursor-not-allowed",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400","disabled"],[1,"mt-2","text-xs","text-slate-500"],[1,"flex","items-center","justify-between","p-3","bg-slate-900/50","rounded-lg"],[1,"text-sm","text-white"],[1,"w-12","h-6","rounded-full","transition-colors","relative",3,"click"],[1,"absolute","top-1","w-4","h-4","bg-white","rounded-full","transition-all"],[1,"w-8","h-8","rounded-lg","text-sm","font-medium","disabled:opacity-30","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-xs","text-purple-400","hover:text-purple-300",3,"click"],[1,"text-xs","text-slate-400","hover:text-slate-300",3,"click"],[1,"grid","grid-cols-2","gap-2"],[1,"mt-3","p-2","bg-slate-900/50","rounded-lg"],[1,"p-3","rounded-lg","border-2","transition-all","text-left",3,"border-purple-500","bg-purple-500/10","border-slate-700","bg-slate-800"],[1,"p-3","rounded-lg","border-2","transition-all","text-left",3,"click"],[1,"w-2","h-2","bg-green-500","rounded-full"],[1,"text-sm","text-white","truncate"],[1,"mt-2"],[1,"w-full","px-2","py-1","bg-slate-900","border","border-slate-600","rounded","text-xs","text-white",3,"click","change","value"],["value",""],[3,"value"],[1,"text-xs","text-slate-400","mb-1"],[1,"px-2","py-1","bg-slate-700","rounded","text-xs","text-white","flex","items-center","gap-1"],[1,"text-purple-400"],[1,"text-xs","text-purple-400","hover:text-purple-300","flex","items-center","gap-1",3,"click"],[1,"flex","items-start","gap-2"],[1,"mb-1"],[1,"text-xs","text-slate-400","space-y-1","ml-4","list-disc"],[1,"px-3","py-2"],[1,"text-slate-500","italic"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded"],[1,"px-2","py-0.5","bg-amber-500/20","text-amber-400","text-xs","rounded"],[1,"px-3","py-2","text-right","relative"],[1,"relative","inline-block"],[1,"text-xs","text-purple-400","hover:text-purple-300","px-2","py-1","hover:bg-purple-500/10","rounded","flex","items-center","gap-1",3,"click"],[1,"absolute","right-0","top-full","mt-1","w-48","bg-slate-800","border","border-slate-600","rounded-lg","shadow-xl","z-50","overflow-hidden"],[1,"w-2","h-2","rounded-full","bg-emerald-500"],[1,"absolute","right-0","top-full","mt-1","w-48","bg-slate-800","border","border-slate-600","rounded-lg","shadow-xl","z-50","overflow-hidden",3,"click"],[1,"px-3","py-2","bg-slate-900/50","border-b","border-slate-700"],[1,"max-h-48","overflow-y-auto"],[1,"w-full","px-3","py-2","text-left","hover:bg-slate-700/50","flex","items-center","gap-2","text-sm",3,"bg-purple-500/20"],[1,"border-t","border-slate-700"],[1,"w-full","px-3","py-2","text-left","hover:bg-red-500/10","text-red-400","text-sm","flex","items-center","gap-2",3,"click"],[1,"w-full","px-3","py-2","text-left","hover:bg-slate-700/50","flex","items-center","gap-2","text-sm",3,"click"],[1,"flex-1"],[1,"text-xs","text-purple-400"],[1,"w-2","h-2","rounded-full","bg-slate-500"],[1,"px-2","py-0.5","bg-slate-500/20","text-slate-400","text-xs","rounded"],[1,"text-xs","text-slate-400","hover:text-white","px-2","py-1","hover:bg-slate-500/10","rounded","flex","items-center","gap-1",3,"click"],[1,"w-full","px-3","py-2","text-left","hover:bg-slate-700/50","flex","items-center","gap-2","text-sm"],[1,"w-full","px-3","py-2","text-left","hover:bg-slate-700/50","text-slate-400","text-sm","flex","items-center","gap-2",3,"click"],[1,"text-xs","text-slate-500","mb-2"],[1,"text-sm","text-slate-300","italic"],[1,"animate-pulse"],[1,"flex","items-start","gap-3"],[1,"text-amber-400","text-sm"],[1,"text-amber-400","font-medium","mb-1"],[1,"text-sm","text-slate-300","mb-3"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","text-sm","hover:bg-purple-600",3,"click"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","text-sm","hover:bg-slate-600",3,"click"],[1,"ml-2","text-purple-400","hover:text-purple-300",3,"click"],[1,"flex","items-center","gap-2","text-cyan-400"],[1,"text-slate-400","mt-1","text-xs"],[1,"space-y-3"],[1,"p-3","bg-slate-800","rounded-lg","border","border-slate-700"],[1,"w-7","h-7","rounded-full","bg-purple-500/30","text-purple-400","text-sm","flex","items-center","justify-center","font-medium"],[1,"text-xs","text-slate-500","mt-0.5"],[1,"mt-2","p-2","bg-slate-900/50","rounded","border-l-2","border-cyan-500","ml-10"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-sm","text-pink-400","font-medium","mb-2"],[1,"text-xs","text-slate-300","space-y-1"],[1,"flex-1","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-blue-500","to-cyan-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity"],[1,"flex-1","py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-blue-500","to-cyan-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"inline-block","animate-spin","mr-2"],[1,"inline-block","animate-pulse","mr-2"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-2xl","shadow-xl","border","border-slate-700","flex","flex-col","max-h-[80vh]"],[1,"p-6","border-b","border-slate-700/50"],[1,"flex","items-start","justify-between"],[1,"text-slate-400","text-sm","mt-1"],[1,"px-3","py-1.5","bg-cyan-500/20","text-cyan-400","rounded-lg","text-sm","hover:bg-cyan-500/30","disabled:opacity-50","flex","items-center","gap-1",3,"click","disabled"],[1,"p-4","border-b","border-slate-700/50"],[1,"flex","gap-3"],[1,"flex-1","relative"],["type","text","placeholder","\u641C\u7D22\u7528\u6236\u540D\u3001\u59D3\u540D\u6216 Telegram ID...",1,"w-full","px-4","py-2.5","pr-10","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","keyup.enter","ngModel"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-slate-400","hover:text-white"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","text-sm","flex","items-center","gap-1",3,"click"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","text-sm",3,"click"],[1,"flex","gap-2","mt-3"],[1,"px-3","py-1.5","bg-amber-500/20","text-amber-400","rounded-lg","text-sm","hover:bg-amber-500/30",3,"click"],[1,"text-slate-500","text-sm","flex","items-center"],[1,"text-center","py-8","text-slate-500"],[1,"space-y-2"],[1,"flex-1","py-3","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"animate-spin"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-slate-400","hover:text-white",3,"click"],[1,"text-4xl","mb-3"],[1,"text-sm","mt-1"],[1,"flex","items-center","gap-3","p-3","rounded-lg","cursor-pointer","transition-all",3,"bg-purple-500/20","border-purple-500","bg-slate-700/50","hover:bg-slate-700","border","border-transparent"],[1,"flex","items-center","gap-3","p-3","rounded-lg","cursor-pointer","transition-all",3,"click"],[1,"w-5","h-5","rounded","border-2","flex","items-center","justify-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-3","h-3","text-white"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-white","font-medium"],[1,"text-right"],[1,"text-sm","font-bold"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-md","p-6","shadow-xl","border","border-slate-700"],[1,"text-xl","font-bold","text-white","mb-6","flex","items-center","gap-2"],["type","text","placeholder","\u5982\uFF1A\u65B0\u5BA2\u6236\u8F49\u5316\u5287\u672C",1,"w-full","px-4","py-2.5","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","ngModel"],["rows","3","placeholder","\u63CF\u8FF0\u9019\u500B\u5287\u672C\u7684\u4F7F\u7528\u5834\u666F\u548C\u76EE\u6A19...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none",3,"ngModelChange","ngModel"],[1,"p-3","bg-slate-700/50","rounded-lg","text-left","hover:bg-slate-700","transition-colors",3,"click"],[1,"flex-1","py-2.5","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(t,n){if(t&1&&(r(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h1",6)(5,"span",7),l(6,"\u{1F3AD}"),s(),l(7," \u89D2\u8272\u8CC7\u6E90\u5EAB "),s(),r(8,"div",8),y(9,HN,3,1,"span",9)(10,qN,2,0,"span",10),s()(),r(11,"div",11)(12,"div",12)(13,"div",13),l(14),s(),r(15,"div",14),l(16,"\u89D2\u8272"),s()(),B(17,"div",15),r(18,"div",12)(19,"div",16),l(20),s(),r(21,"div",14),l(22,"\u5287\u672C"),s()(),B(23,"div",15),r(24,"div",12)(25,"div",17),l(26),s(),r(27,"div",14),l(28,"\u5DF2\u5C31\u7DD2"),s()()()(),r(29,"div",18),O(30,WN,5,18,"button",19,In),s()(),r(32,"div",20),y(33,zN,28,0,"div",21)(34,KN,1,0,"app-role-library")(35,jN,10,0,"div",21)(36,eV,19,1,"div",22)(37,sV,33,1,"div",22)(38,cV,11,1,"div",22)(39,dV,1,0,"app-workflow-config")(40,uV,1,0,"app-workflow-monitor")(41,mV,1,0,"app-workflow-analytics")(42,pV,74,27,"div",23),s(),y(43,hV,30,3,"div",24),y(44,fV,1,2,"app-role-editor",25),y(45,_V,1,1,"app-script-editor",26),y(46,DB,17,5,"div",27),y(47,VB,36,9,"div",24),y(48,BB,45,3,"div",24),s()),t&2){let o;c(9),S(n.multiRoleService.activeGroupCount()>0?9:10),c(5),D(n.multiRoleService.roles().length),c(6),D(n.multiRoleService.scripts().length),c(6),D(n.multiRoleService.availableRoles().length),c(4),U(n.tabs),c(3),S((o=n.activeTab())==="dashboard"?33:o==="library"?34:o==="scenarios"?35:o==="roles"?36:o==="scripts"?37:o==="groups"?38:o==="workflow"?39:o==="monitor"?40:o==="analytics"?41:o==="settings"?42:-1),c(10),S(n.showAddRole()?43:-1),c(),S(n.showRoleEditor()?44:-1),c(),S(n.showScriptEditor()?45:-1),c(),S(n.showAIPlannerDialog()?46:-1),c(),S(n.showTargetUserSelector()?47:-1),c(),S(n.showNewScriptDialog()?48:-1)}},dependencies:[oe,ae,Re,Ne,xe,Rt,Hi,it,ve,Nt,tn,he,Pc,Rc,Nc,Lc,Oc,Uc,Gc,$c],encapsulation:2})}};var Wc=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.membershipService=F(Ie);this.accountService=F(pt)}navigateTo(e){this.nav.navigateTo(e)}t(e,t){return this.i18n.t(e,t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-multi-role-view"]],decls:1,vars:0,consts:[[3,"navigateTo"]],template:function(t,n){t&1&&(r(0,"app-multi-role-center",0),x("navigateTo",function(a){return n.navigateTo(a)}),s())},dependencies:[oe,ae,qc],encapsulation:2,changeDetection:0})}};var UB=(i,e)=>e.value,GB=(i,e)=>e.date,$B=(i,e)=>e.source,HB=(i,e)=>e.title;function qB(i,e){if(i&1){let t=I();T(0,"button",56),se("click",function(){let o=_(t).$implicit,a=m();return v(a.changePeriod(o.value))}),l(1),k()}if(i&2){let t=e.$implicit,n=m();N("bg-cyan-500",n.selectedPeriod()===t.value)("text-white",n.selectedPeriod()===t.value)("text-slate-400",n.selectedPeriod()!==t.value)("hover:text-white",n.selectedPeriod()!==t.value),c(),M(" ",t.label," ")}}function WB(i,e){i&1&&(ne(),T(0,"svg",12),Se(1,"circle",57)(2,"path",58),k())}function zB(i,e){i&1&&l(0," \u{1F504} ")}function KB(i,e){if(i&1&&(T(0,"div",31)(1,"div",59),Se(2,"div",60)(3,"div",61)(4,"div",62),k(),T(5,"span",49),l(6),k()()),i&2){let t=e.$implicit,n=m();c(2),ee("height",n.getBarHeight(t.sent,"sent"),"%"),Ke("title","\u767C\u9001: "+t.sent),c(),ee("height",n.getBarHeight(t.replies,"replies"),"%"),Ke("title","\u56DE\u8986: "+t.replies),c(),ee("height",n.getBarHeight(t.conversions,"conversions"),"%"),Ke("title","\u6210\u4EA4: "+t.conversions),c(2),D(n.formatDateLabel(t.date))}}function jB(i,e){if(i&1&&(T(0,"div")(1,"div",63)(2,"span",64),l(3),k(),T(4,"span",20),l(5),k()(),T(6,"div",65),Se(7,"div",66),k()()),i&2){let t=e.$implicit;c(3),D(t.source),c(2),X("",t.count," (",t.percentage.toFixed(1),"%)"),c(2),ee("width",t.percentage,"%")("background-color",t.color)}}function JB(i,e){i&1&&(T(0,"span",43),l(1,"\u23F3"),k())}function QB(i,e){i&1&&l(0," \u2728 ")}function YB(i,e){if(i&1&&(T(0,"div",67)(1,"div",68)(2,"span",69),l(3),k(),T(4,"div")(5,"div",70),l(6),k(),T(7,"div",20),l(8),k()()()()),i&2){let t=e.$implicit;N("border-green-500/30",t.type==="success")("border-yellow-500/30",t.type==="warning")("border-blue-500/30",t.type==="info")("border-purple-500/30",t.type==="tip"),c(3),D(t.icon),c(3),D(t.title),c(2),D(t.description)}}function XB(i,e){if(i&1&&(T(0,"div",47),Se(1,"div",71),T(2,"span",72),l(3),k()()),i&2){let t=e.$implicit,n=m();c(),ee("background-color",n.getHeatmapColor(n.hourlyData()[t]||0)),Ke("title",t+":00 - \u56DE\u8986\u7387: "+(n.hourlyData()[t]||0)+"%"),c(2),D(t)}}var zc=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.periods=[{value:"today",label:"\u4ECA\u65E5"},{value:"week",label:"\u672C\u9031"},{value:"month",label:"\u672C\u6708"},{value:"quarter",label:"\u5B63\u5EA6"}];this.selectedPeriod=f("week");this.isLoading=f(!1);this.isGeneratingInsights=f(!1);this.hours=Array.from({length:24},(e,t)=>t);this.stats=f({totalSent:0,totalReplies:0,totalConversions:0,conversionRate:0,sentChange:0,repliesChange:0,conversionsChange:0,rateChange:0});this.trendData=f([]);this.sourceDistribution=f([]);this.aiInsights=f([]);this.hourlyData=f({})}ngOnInit(){this.setupIpcListeners(),this.loadData()}ngOnDestroy(){}setupIpcListeners(){this.ipc.on("analytics:stats",e=>{e.success&&this.stats.set(e.stats),this.isLoading.set(!1)}),this.ipc.on("analytics:trend",e=>{e.success&&this.trendData.set(e.trend)}),this.ipc.on("analytics:sources",e=>{e.success&&this.sourceDistribution.set(e.sources)}),this.ipc.on("analytics:hourly",e=>{e.success&&this.hourlyData.set(e.hourly)}),this.ipc.on("analytics:insights",e=>{e.success&&this.aiInsights.set(e.insights),this.isGeneratingInsights.set(!1)})}loadData(){this.isLoading.set(!0),this.ipc.send("analytics:get-stats",{period:this.selectedPeriod()}),this.ipc.send("analytics:get-trend",{period:this.selectedPeriod()}),this.ipc.send("analytics:get-sources",{period:this.selectedPeriod()}),this.ipc.send("analytics:get-hourly",{period:this.selectedPeriod()}),setTimeout(()=>{this.isLoading()&&(this.generateMockData(),this.isLoading.set(!1))},1e3)}generateMockData(){let e=Math.floor(Math.random()*1e3)+500,t=Math.floor(e*(.2+Math.random()*.2)),n=Math.floor(t*(.1+Math.random()*.15));this.stats.set({totalSent:e,totalReplies:t,totalConversions:n,conversionRate:n/e*100,sentChange:(Math.random()-.3)*30,repliesChange:(Math.random()-.3)*30,conversionsChange:(Math.random()-.3)*30,rateChange:(Math.random()-.3)*5});let o=[],a=this.selectedPeriod()==="today"?24:this.selectedPeriod()==="week"?7:this.selectedPeriod()==="month"?30:90;for(let g=0;g<Math.min(a,14);g++){let C=new Date;C.setDate(C.getDate()-g),o.unshift({date:C.toISOString().split("T")[0],sent:Math.floor(Math.random()*100)+20,replies:Math.floor(Math.random()*30)+5,conversions:Math.floor(Math.random()*10)+1})}this.trendData.set(o);let d=[{source:"\u7FA4\u7D44\u63D0\u53D6",count:Math.floor(Math.random()*500)+200,color:"#3b82f6"},{source:"\u95DC\u9375\u8A5E\u5339\u914D",count:Math.floor(Math.random()*300)+100,color:"#10b981"},{source:"\u624B\u52D5\u6DFB\u52A0",count:Math.floor(Math.random()*200)+50,color:"#f59e0b"},{source:"AI \u63A8\u85A6",count:Math.floor(Math.random()*150)+30,color:"#8b5cf6"}],u=d.reduce((g,C)=>g+C.count,0);this.sourceDistribution.set(d.map(g=>P(E({},g),{percentage:g.count/u*100})));let p={};for(let g=0;g<24;g++){let C=g>=9&&g<=18?30:10;p[g]=Math.floor(Math.random()*20)+C}this.hourlyData.set(p),this.generateInsights()}generateInsights(){let e=this.stats(),t=[];e.conversionRate>5&&t.push({icon:"\u{1F389}",type:"success",title:"\u8F49\u5316\u7387\u8868\u73FE\u512A\u79C0",description:`\u7576\u524D\u8F49\u5316\u7387 ${e.conversionRate.toFixed(1)}% \u9AD8\u65BC\u884C\u696D\u5E73\u5747\u6C34\u5E73\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01`}),e.sentChange>10&&t.push({icon:"\u{1F4C8}",type:"info",title:"\u767C\u9001\u91CF\u986F\u8457\u589E\u9577",description:`\u767C\u9001\u91CF\u8F03\u4E0A\u671F\u589E\u9577 ${e.sentChange.toFixed(1)}%\uFF0C\u89F8\u9054\u66F4\u591A\u6F5B\u5728\u5BA2\u6236\u3002`});let n=this.hourlyData(),o=0,a=0;for(let[u,p]of Object.entries(n))p>a&&(a=p,o=parseInt(u));t.push({icon:"\u23F0",type:"tip",title:`\u6700\u4F73\u767C\u9001\u6642\u6BB5\uFF1A${o}:00-${o+1}:00`,description:`\u8A72\u6642\u6BB5\u56DE\u8986\u7387\u9AD8\u9054 ${a}%\uFF0C\u5EFA\u8B70\u91CD\u9EDE\u5B89\u6392\u767C\u9001\u3002`});let d=this.sourceDistribution();if(d.length>0){let u=d[0];t.push({icon:"\u{1F3AF}",type:"info",title:`\u4E3B\u8981\u7528\u6236\u4F86\u6E90\uFF1A${u.source}`,description:`\u4F54\u6BD4 ${u.percentage.toFixed(1)}%\uFF0C\u53EF\u8003\u616E\u52A0\u5F37\u8A72\u6E20\u9053\u6295\u5165\u3002`})}this.aiInsights.set(t)}changePeriod(e){this.selectedPeriod.set(e),this.loadData()}refreshData(){this.loadData()}regenerateInsights(){this.isGeneratingInsights.set(!0),this.ipc.send("analytics:generate-insights",{period:this.selectedPeriod(),stats:this.stats()}),setTimeout(()=>{this.isGeneratingInsights()&&(this.generateInsights(),this.isGeneratingInsights.set(!1))},1500)}exportReport(){this.toast.info("\u6B63\u5728\u751F\u6210\u5831\u544A..."),this.ipc.send("analytics:export",{period:this.selectedPeriod(),stats:this.stats(),trend:this.trendData(),sources:this.sourceDistribution(),insights:this.aiInsights()}),setTimeout(()=>{this.toast.success("\u5831\u544A\u5DF2\u751F\u6210\uFF0C\u8ACB\u9078\u64C7\u4FDD\u5B58\u4F4D\u7F6E")},1e3)}formatNumber(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}formatPercent(e){return Math.abs(e).toFixed(1)+"%"}formatDateLabel(e){let t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`}getBarHeight(e,t){let n=this.trendData();if(n.length===0)return 0;let o=1;return n.forEach(a=>{t==="sent"&&a.sent>o&&(o=a.sent),t==="replies"&&a.replies>o&&(o=a.replies),t==="conversions"&&a.conversions>o&&(o=a.conversions)}),Math.max(5,e/o*100)}getHeatmapColor(e){return e<15?"rgb(51, 65, 85)":e<25?"rgb(20, 83, 45)":e<35?"rgb(21, 128, 61)":e<45?"rgb(34, 197, 94)":"rgb(74, 222, 128)"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-smart-analytics"]],decls:116,vars:48,consts:[[1,"smart-analytics","h-full","flex","flex-col","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","overflow-hidden"],[1,"flex-shrink-0","p-6","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","rounded-2xl","bg-gradient-to-br","from-cyan-500","to-blue-500","flex","items-center","justify-center","text-2xl","shadow-lg","shadow-cyan-500/20"],[1,"text-2xl","font-bold","text-white"],[1,"text-slate-400","text-sm"],[1,"flex","items-center","gap-3"],[1,"flex","bg-slate-800/50","rounded-xl","p-1"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"bg-cyan-500","text-white","text-slate-400","hover:text-white"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","flex","items-center","gap-2",3,"click"],[1,"p-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","disabled:opacity-50",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"w-5","h-5","animate-spin"],[1,"flex-1","overflow-y-auto","p-6","space-y-6"],[1,"grid","grid-cols-4","gap-4"],[1,"p-5","bg-gradient-to-br","from-blue-500/10","to-blue-600/5","rounded-2xl","border","border-blue-500/20"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-blue-400","text-2xl"],[1,"text-xs","px-2","py-1","rounded-full"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-sm","text-slate-400"],[1,"p-5","bg-gradient-to-br","from-green-500/10","to-green-600/5","rounded-2xl","border","border-green-500/20"],[1,"text-green-400","text-2xl"],[1,"p-5","bg-gradient-to-br","from-purple-500/10","to-purple-600/5","rounded-2xl","border","border-purple-500/20"],[1,"text-purple-400","text-2xl"],[1,"p-5","bg-gradient-to-br","from-amber-500/10","to-amber-600/5","rounded-2xl","border","border-amber-500/20"],[1,"text-amber-400","text-2xl"],[1,"grid","grid-cols-3","gap-6"],[1,"col-span-2","p-5","bg-slate-800/30","rounded-2xl","border","border-slate-700/50"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"h-64","flex","items-end","gap-1"],[1,"flex-1","flex","flex-col","items-center","gap-1"],[1,"flex","items-center","justify-center","gap-6","mt-4"],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","bg-blue-500","rounded"],[1,"w-3","h-3","bg-green-500","rounded"],[1,"w-3","h-3","bg-purple-500","rounded"],[1,"p-5","bg-slate-800/30","rounded-2xl","border","border-slate-700/50"],[1,"space-y-3"],[1,"p-5","bg-gradient-to-r","from-cyan-500/10","via-blue-500/10","to-purple-500/10","rounded-2xl","border","border-cyan-500/20"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors","disabled:opacity-50","flex","items-center","gap-1",3,"click","disabled"],[1,"animate-spin"],[1,"grid","grid-cols-2","gap-4"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30",3,"border-green-500/30","border-yellow-500/30","border-blue-500/30","border-purple-500/30"],[1,"flex","gap-1"],[1,"flex-1","flex","flex-col","items-center"],[1,"flex","items-center","justify-end","gap-4","mt-3"],[1,"text-xs","text-slate-500"],[1,"flex","gap-0.5"],[1,"w-4","h-3","rounded","bg-slate-700"],[1,"w-4","h-3","rounded","bg-green-900"],[1,"w-4","h-3","rounded","bg-green-700"],[1,"w-4","h-3","rounded","bg-green-500"],[1,"w-4","h-3","rounded","bg-green-400"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"w-full","flex","gap-0.5","items-end","h-48"],[1,"flex-1","bg-blue-500/60","rounded-t","transition-all","hover:bg-blue-500",3,"title"],[1,"flex-1","bg-green-500/60","rounded-t","transition-all","hover:bg-green-500",3,"title"],[1,"flex-1","bg-purple-500/60","rounded-t","transition-all","hover:bg-purple-500",3,"title"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","text-slate-300"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","rounded-full","transition-all"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/30"],[1,"flex","items-start","gap-3"],[1,"text-2xl"],[1,"font-medium","text-white","mb-1"],[1,"w-full","h-8","rounded","transition-all",3,"title"],[1,"text-xs","text-slate-500","mt-1"]],template:function(t,n){t&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),l(5," \u{1F4CA} "),k(),T(6,"div")(7,"h1",5),l(8,"\u667A\u80FD\u5206\u6790\u5831\u544A"),k(),T(9,"p",6),l(10,"AI \u9A45\u52D5\u7684\u6578\u64DA\u6D1E\u5BDF"),k()()(),T(11,"div",7)(12,"div",8),O(13,qB,2,9,"button",9,UB),k(),T(15,"button",10),se("click",function(){return n.exportReport()}),l(16," \u{1F4E5} \u5C0E\u51FA\u5831\u544A "),k(),T(17,"button",11),se("click",function(){return n.refreshData()}),y(18,WB,3,0,":svg:svg",12)(19,zB,1,0),k()()()(),T(20,"div",13)(21,"div",14)(22,"div",15)(23,"div",16)(24,"span",17),l(25,"\u{1F4E4}"),k(),T(26,"span",18),l(27),k()(),T(28,"div",19),l(29),k(),T(30,"div",20),l(31,"\u7E3D\u767C\u9001\u6578"),k()(),T(32,"div",21)(33,"div",16)(34,"span",22),l(35,"\u{1F4AC}"),k(),T(36,"span",18),l(37),k()(),T(38,"div",19),l(39),k(),T(40,"div",20),l(41,"\u7E3D\u56DE\u8986\u6578"),k()(),T(42,"div",23)(43,"div",16)(44,"span",24),l(45,"\u2705"),k(),T(46,"span",18),l(47),k()(),T(48,"div",19),l(49),k(),T(50,"div",20),l(51,"\u7E3D\u6210\u4EA4\u6578"),k()(),T(52,"div",25)(53,"div",16)(54,"span",26),l(55,"\u{1F4C8}"),k(),T(56,"span",18),l(57),k()(),T(58,"div",19),l(59),k(),T(60,"div",20),l(61,"\u8F49\u5316\u7387"),k()()(),T(62,"div",27)(63,"div",28)(64,"h3",29),l(65," \u{1F4C8} \u767C\u9001\u8207\u56DE\u8986\u8DA8\u52E2 "),k(),T(66,"div",30),O(67,KB,7,10,"div",31,GB),k(),T(69,"div",32)(70,"div",33),Se(71,"div",34),T(72,"span",20),l(73,"\u767C\u9001"),k()(),T(74,"div",33),Se(75,"div",35),T(76,"span",20),l(77,"\u56DE\u8986"),k()(),T(78,"div",33),Se(79,"div",36),T(80,"span",20),l(81,"\u6210\u4EA4"),k()()()(),T(82,"div",37)(83,"h3",29),l(84," \u{1F967} \u7528\u6236\u4F86\u6E90\u5206\u5E03 "),k(),T(85,"div",38),O(86,jB,8,7,"div",null,$B),k()()(),T(88,"div",39)(89,"div",40)(90,"h3",41),l(91," \u{1F916} AI \u667A\u80FD\u6D1E\u5BDF "),k(),T(92,"button",42),se("click",function(){return n.regenerateInsights()}),y(93,JB,2,0,"span",43)(94,QB,1,0),l(95," \u91CD\u65B0\u751F\u6210 "),k()(),T(96,"div",44),O(97,YB,9,11,"div",45,HB),k()(),T(99,"div",37)(100,"h3",29),l(101," \u{1F550} \u6700\u4F73\u767C\u9001\u6642\u6BB5 "),k(),T(102,"div",46),O(103,XB,4,4,"div",47,be),k(),T(105,"div",48)(106,"span",49),l(107,"\u4F4E"),k(),T(108,"div",50),Se(109,"div",51)(110,"div",52)(111,"div",53)(112,"div",54)(113,"div",55),k(),T(114,"span",49),l(115,"\u9AD8"),k()()()()()),t&2&&(c(13),U(n.periods),c(4),Ke("disabled",n.isLoading()),c(),S(n.isLoading()?18:19),c(8),N("bg-green-500/20",n.stats().sentChange>=0)("text-green-400",n.stats().sentChange>=0)("bg-red-500/20",n.stats().sentChange<0)("text-red-400",n.stats().sentChange<0),c(),X(" ",n.stats().sentChange>=0?"\u2191":"\u2193"," ",n.formatPercent(n.stats().sentChange)," "),c(2),D(n.formatNumber(n.stats().totalSent)),c(7),N("bg-green-500/20",n.stats().repliesChange>=0)("text-green-400",n.stats().repliesChange>=0)("bg-red-500/20",n.stats().repliesChange<0)("text-red-400",n.stats().repliesChange<0),c(),X(" ",n.stats().repliesChange>=0?"\u2191":"\u2193"," ",n.formatPercent(n.stats().repliesChange)," "),c(2),D(n.formatNumber(n.stats().totalReplies)),c(7),N("bg-green-500/20",n.stats().conversionsChange>=0)("text-green-400",n.stats().conversionsChange>=0)("bg-red-500/20",n.stats().conversionsChange<0)("text-red-400",n.stats().conversionsChange<0),c(),X(" ",n.stats().conversionsChange>=0?"\u2191":"\u2193"," ",n.formatPercent(n.stats().conversionsChange)," "),c(2),D(n.formatNumber(n.stats().totalConversions)),c(7),N("bg-green-500/20",n.stats().rateChange>=0)("text-green-400",n.stats().rateChange>=0)("bg-red-500/20",n.stats().rateChange<0)("text-red-400",n.stats().rateChange<0),c(),X(" ",n.stats().rateChange>=0?"\u2191":"\u2193"," ",n.formatPercent(n.stats().rateChange)," "),c(2),M("",n.stats().conversionRate.toFixed(1),"%"),c(8),U(n.trendData()),c(19),U(n.sourceDistribution()),c(6),Ke("disabled",n.isGeneratingInsights()),c(),S(n.isGeneratingInsights()?93:94),c(4),U(n.aiInsights()),c(6),U(n.hours))},dependencies:[oe,ae],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})}};var Kc=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.membershipService=F(Ie);this.dateRange=f(null);this.ipcCleanup=[]}ngOnInit(){let e=new Date,t=new Date;t.setDate(t.getDate()-30),this.dateRange.set({start:t,end:e}),this.loadAnalyticsData(),this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}loadAnalyticsData(){let e=this.dateRange();e&&this.ipc.send("get-analytics-data",{startDate:e.start.toISOString(),endDate:e.end.toISOString()})}setupIpcListeners(){let e=this.ipc.on("analytics-data-loaded",()=>{});this.ipcCleanup.push(e)}navigateTo(e){this.nav.navigateTo(e)}setDateRange(e){this.dateRange.set(e),this.loadAnalyticsData()}t(e,t){return this.i18n.t(e,t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-analytics-view"]],decls:1,vars:0,consts:[[3,"dateRangeChange","navigateTo"]],template:function(t,n){t&1&&(r(0,"app-smart-analytics",0),x("dateRangeChange",function(a){return n.setDateRange(a)})("navigateTo",function(a){return n.navigateTo(a)}),s())},dependencies:[oe,ae,zc],encapsulation:2,changeDetection:0})}};var Im=(i,e)=>e.value;function ZB(i,e){i&1&&(T(0,"div",27)(1,"span",29),l(2,"\u23F3"),k(),T(3,"span",30),l(4,"\u52A0\u8F09\u7D71\u8A08\u6578\u64DA..."),k()())}function eL(i,e){if(i&1&&(T(0,"div",37),l(1),Ee(2,"date"),Ee(3,"date"),k()),i&2){let t=m(4);c(),X(" \u{1F4C5} \u6D88\u606F\u7BC4\u570D\uFF1A",yt(2,2,t.stats().dateRange.first,"yyyy-MM-dd")," ~ ",yt(3,5,t.stats().dateRange.last,"yyyy-MM-dd")," ")}}function tL(i,e){if(i&1&&(T(0,"div",31)(1,"div",32)(2,"div",33),l(3),Ee(4,"number"),k(),T(5,"div",34),l(6,"\u76E3\u63A7\u6D88\u606F"),k()(),T(7,"div",32)(8,"div",35),l(9),Ee(10,"number"),k(),T(11,"div",34),l(12,"\u552F\u4E00\u767C\u8A00\u8005"),k()(),T(13,"div",32)(14,"div",36),l(15),Ee(16,"number"),k(),T(17,"div",34),l(18,"\u5DF2\u6536\u96C6"),k()()(),y(19,eL,4,8,"div",37)),i&2){let t=m(3);c(3),D(je(4,4,t.stats().totalMessages)),c(6),D(je(10,6,t.stats().uniqueSenders)),c(6),D(je(16,8,t.stats().collectedUsers)),c(4),S(t.stats().dateRange.first?19:-1)}}function nL(i,e){i&1&&(T(0,"div",28)(1,"p",38),l(2,"\u26A0\uFE0F \u66AB\u7121\u76E3\u63A7\u6578\u64DA"),k(),T(3,"p",39),l(4,"\u8ACB\u5148\u958B\u555F\u7FA4\u7D44\u76E3\u63A7\u4E00\u6BB5\u6642\u9593"),k()())}function iL(i,e){if(i&1&&(T(0,"div",13)(1,"div",22)(2,"div",23),l(3),k(),T(4,"div",24)(5,"h3",25),l(6),k(),T(7,"p",26),l(8),k()()(),y(9,ZB,5,0,"div",27)(10,tL,20,10)(11,nL,5,0,"div",28),k()),i&2){let t=m(2);c(3),M(" ",t.group().name[0]," "),c(3),D(t.group().name),c(2),D(t.group().url||"\u79C1\u5BC6\u7FA4\u7D44"),c(),S(t.isLoadingStats()?9:t.stats()?10:11)}}function oL(i,e){if(i&1){let t=I();T(0,"button",54),se("click",function(){let o=_(t).$implicit,a=m(3);return v(a.setLimit(o.value))}),l(1),k()}if(i&2){let t=e.$implicit,n=m(3);N("border-orange-500",n.config().limit===t.value)("bg-orange-500/20",n.config().limit===t.value)("text-orange-400",n.config().limit===t.value)("border-slate-700",n.config().limit!==t.value)("bg-slate-800/50",n.config().limit!==t.value)("text-slate-400",n.config().limit!==t.value),c(),M(" ",t.label," ")}}function rL(i,e){if(i&1){let t=I();T(0,"button",54),se("click",function(){let o=_(t).$implicit,a=m(3);return v(a.setTimeRange(o.value))}),l(1),k()}if(i&2){let t=e.$implicit,n=m(3);N("border-cyan-500",n.config().timeRange===t.value)("bg-cyan-500/20",n.config().timeRange===t.value)("text-cyan-400",n.config().timeRange===t.value)("border-slate-700",n.config().timeRange!==t.value)("bg-slate-800/50",n.config().timeRange!==t.value)("text-slate-400",n.config().timeRange!==t.value),c(),M(" ",t.label," ")}}function sL(i,e){if(i&1){let t=I();T(0,"button",54),se("click",function(){let o=_(t).$implicit,a=m(3);return v(a.setMinMessages(o.value))}),l(1),k()}if(i&2){let t=e.$implicit,n=m(3);N("border-purple-500",n.config().minMessages===t.value)("bg-purple-500/20",n.config().minMessages===t.value)("text-purple-400",n.config().minMessages===t.value)("border-slate-700",n.config().minMessages!==t.value)("bg-slate-800/50",n.config().minMessages!==t.value)("text-slate-400",n.config().minMessages!==t.value),c(),M(" ",t.label," ")}}function aL(i,e){if(i&1){let t=I();T(0,"div",53)(1,"div",55)(2,"label",56)(3,"input",57),se("change",function(){_(t);let o=m(3);return v(o.toggleOption("skipDuplicates"))}),k(),T(4,"div")(5,"p",58),l(6,"\u53BB\u91CD"),k(),T(7,"p",34),l(8,"\u8DF3\u904E\u5DF2\u6536\u96C6\u7528\u6236"),k()()(),T(9,"label",56)(10,"input",57),se("change",function(){_(t);let o=m(3);return v(o.toggleOption("excludeBots"))}),k(),T(11,"div")(12,"p",58),l(13,"\u6392\u9664\u6A5F\u5668\u4EBA"),k(),T(14,"p",34),l(15,"\u904E\u6FFE Bot \u5E33\u865F"),k()()(),T(16,"label",56)(17,"input",57),se("change",function(){_(t);let o=m(3);return v(o.toggleOption("requireUsername"))}),k(),T(18,"div")(19,"p",58),l(20,"\u9700\u6709\u7528\u6236\u540D"),k(),T(21,"p",34),l(22,"\u50C5\u6536\u96C6\u6709 @username"),k()()(),T(23,"label",56)(24,"input",57),se("change",function(){_(t);let o=m(3);return v(o.toggleOption("autoSync"))}),k(),T(25,"div")(26,"p",58),l(27,"\u81EA\u52D5\u540C\u6B65"),k(),T(28,"p",34),l(29,"\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3"),k()()()()()}if(i&2){let t=m(3);c(3),Ke("checked",t.config().options.skipDuplicates),c(7),Ke("checked",t.config().options.excludeBots),c(7),Ke("checked",t.config().options.requireUsername),c(7),Ke("checked",t.config().options.autoSync)}}function lL(i,e){if(i&1){let t=I();T(0,"div")(1,"label",40),l(2," \u26A1 \u5FEB\u901F\u6A21\u677F "),k(),T(3,"div",31)(4,"button",41),se("click",function(){_(t);let o=m(2);return v(o.selectTemplate("quick"))}),T(5,"div",42),l(6,"\u26A1"),k(),T(7,"p",43),l(8,"\u5FEB\u901F\u6536\u96C6"),k(),T(9,"p",39),l(10,"100\u4EBA \xB7 7\u5929\u5167"),k()(),T(11,"button",41),se("click",function(){_(t);let o=m(2);return v(o.selectTemplate("precise"))}),T(12,"div",42),l(13,"\u{1F3AF}"),k(),T(14,"p",43),l(15,"\u7CBE\u6E96\u6536\u96C6"),k(),T(16,"p",39),l(17,"\u767C\u8A00\u22653\u6B21"),k()(),T(18,"button",41),se("click",function(){_(t);let o=m(2);return v(o.selectTemplate("deep"))}),T(19,"div",42),l(20,"\u{1F50D}"),k(),T(21,"p",43),l(22,"\u6DF1\u5EA6\u6536\u96C6"),k(),T(23,"p",39),l(24,"\u5168\u90E8\u6B77\u53F2"),k()()()(),T(25,"div")(26,"label",40),l(27," \u{1F522} \u6536\u96C6\u6578\u91CF "),k(),T(28,"div",44),O(29,oL,2,13,"button",45,Im),k()(),T(31,"div")(32,"label",40),l(33," \u{1F4C5} \u6642\u9593\u7BC4\u570D "),k(),T(34,"div",44),O(35,rL,2,13,"button",46,Im),k()(),T(37,"div")(38,"label",40),l(39," \u{1F525} \u6D3B\u8E8D\u5EA6\u7BE9\u9078\uFF08\u6700\u5C11\u767C\u8A00\u6B21\u6578\uFF09 "),k(),T(40,"div",44),O(41,sL,2,13,"button",47,Im),k()(),T(43,"div",48)(44,"button",49),se("click",function(){_(t);let o=m(2);return v(o.showAdvanced.set(!o.showAdvanced()))}),T(45,"span",50),l(46,"\u2699\uFE0F \u9032\u968E\u9078\u9805"),k(),ne(),T(47,"svg",51),Se(48,"path",52),k()(),y(49,aL,30,4,"div",53),k()}if(i&2){let t=m(2);c(4),N("border-orange-500",t.selectedTemplate()==="quick")("bg-orange-500/20",t.selectedTemplate()==="quick")("border-slate-700",t.selectedTemplate()!=="quick")("bg-slate-800/50",t.selectedTemplate()!=="quick"),c(7),N("border-emerald-500",t.selectedTemplate()==="precise")("bg-emerald-500/20",t.selectedTemplate()==="precise")("border-slate-700",t.selectedTemplate()!=="precise")("bg-slate-800/50",t.selectedTemplate()!=="precise"),c(7),N("border-blue-500",t.selectedTemplate()==="deep")("bg-blue-500/20",t.selectedTemplate()==="deep")("border-slate-700",t.selectedTemplate()!=="deep")("bg-slate-800/50",t.selectedTemplate()!=="deep"),c(11),U(t.limitOptions),c(6),U(t.timeRangeOptions),c(6),U(t.activityOptions),c(6),N("rotate-180",t.showAdvanced()),c(2),S(t.showAdvanced()?49:-1)}}function cL(i,e){if(i&1&&(T(0,"div",14)(1,"div",59)(2,"span",60)(3,"span",61),l(4,"\u23F3"),k(),l(5," \u6B63\u5728\u6536\u96C6\u7528\u6236... "),k(),T(6,"span",62),l(7),k()(),T(8,"div",63),Se(9,"div",64),k(),T(10,"div",65),l(11),k()()),i&2){let t=m(2);c(7),X(" ",t.collectionProgress().current," / ",t.collectionProgress().total," "),c(2),ee("width",t.getProgressPercent(),"%"),c(2),D(t.collectionProgress().status)}}function dL(i,e){if(i&1&&(T(0,"div",15)(1,"div",59)(2,"span",66)(3,"span"),l(4,"\u2705"),k(),l(5," \u6536\u96C6\u5B8C\u6210\uFF01 "),k(),T(6,"span",67),l(7),k()(),T(8,"div",68)(9,"div",69)(10,"div",70),l(11),k(),T(12,"div",34),l(13,"\u65B0\u589E"),k()(),T(14,"div",69)(15,"div",71),l(16),k(),T(17,"div",34),l(18,"\u66F4\u65B0"),k()(),T(19,"div",69)(20,"div",72),l(21),k(),T(22,"div",34),l(23,"\u8DF3\u904E"),k()(),T(24,"div",69)(25,"div",73),l(26),k(),T(27,"div",34),l(28,"\u9AD8\u6D3B\u8E8D"),k()()(),T(29,"div",62)(30,"div",74)(31,"span",75),l(32,"\u{1F525}"),k(),T(33,"span"),l(34),k()(),T(35,"div",74)(36,"span",76),l(37,"\u2713"),k(),T(38,"span"),l(39),k()(),T(40,"div",77)(41,"span",78),l(42,"\u25CB"),k(),T(43,"span"),l(44),k()()()()),i&2){let t=m(2);c(7),M(" ",t.collectionResult().collected," \u4EBA "),c(4),D(t.collectionResult().newUsers),c(5),D(t.collectionResult().updated),c(5),D(t.collectionResult().skipped),c(5),D(t.collectionResult().quality.highActivity),c(8),M("\u9AD8\u6D3B\u8E8D (\u226510\u6B21)\uFF1A",t.collectionResult().quality.highActivity," \u4EBA"),c(5),M("\u4E2D\u6D3B\u8E8D (3-9\u6B21)\uFF1A",t.collectionResult().quality.mediumActivity," \u4EBA"),c(5),M("\u4F4E\u6D3B\u8E8D (<3\u6B21)\uFF1A",t.collectionResult().quality.lowActivity," \u4EBA")}}function uL(i,e){if(i&1&&(T(0,"div",17)(1,"span",30),l(2," \u{1F4A1} \u9810\u8A08\u6536\u96C6\uFF1A "),T(3,"span",79),l(4),k(),l(5," \u4EBA "),k()()),i&2){let t=m(2);c(4),D(t.estimatedCount())}}function mL(i,e){i&1&&(T(0,"span",61),l(1,"\u23F3"),k(),T(2,"span"),l(3,"\u6536\u96C6\u4E2D..."),k())}function pL(i,e){i&1&&(T(0,"span"),l(1,"\u{1F504}"),k(),T(2,"span"),l(3,"\u958B\u59CB\u6536\u96C6"),k())}function gL(i,e){if(i&1){let t=I();T(0,"button",80),se("click",function(){_(t);let o=m(2);return v(o.startCollection())}),y(1,mL,4,0)(2,pL,4,0),k()}if(i&2){let t=m(2);Ke("disabled",!t.canStart()),c(),S(t.isCollecting()?1:2)}}function hL(i,e){if(i&1){let t=I();T(0,"button",81),se("click",function(){_(t);let o=m(2);return v(o.viewCollectedUsers())}),T(1,"span"),l(2,"\u{1F465}"),k(),T(3,"span"),l(4,"\u67E5\u770B\u5DF2\u6536\u96C6\u7528\u6236"),k()()}}function fL(i,e){if(i&1){let t=I();T(0,"div",1),se("click",function(o){_(t);let a=m();return v(a.onBackdropClick(o))}),T(1,"div",2),se("click",function(o){return _(t),v(o.stopPropagation())}),T(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),l(6," \u{1F504} "),k(),T(7,"div")(8,"h2",7),l(9,"\u5F9E\u6B77\u53F2\u6D88\u606F\u6536\u96C6\u7528\u6236"),k(),T(10,"p",8),l(11,"\u6536\u96C6\u76E3\u63A7\u671F\u9593\u7684\u767C\u8A00\u7528\u6236"),k()()(),T(12,"button",9),se("click",function(){_(t);let o=m();return v(o.close())}),ne(),T(13,"svg",10),Se(14,"path",11),k()()()(),ce(),T(15,"div",12),y(16,iL,12,4,"div",13),y(17,lL,50,27),y(18,cL,12,5,"div",14),y(19,dL,45,8,"div",15),k(),T(20,"div",16),y(21,uL,6,1,"div",17),T(22,"div",18)(23,"button",19),se("click",function(){_(t);let o=m();return v(o.close())}),l(24),k(),y(25,gL,3,2,"button",20)(26,hL,5,0,"button",21),k()()()()}if(i&2){let t=m();c(16),S(t.group()?16:-1),c(),S(t.stats()&&t.stats().totalMessages>0?17:-1),c(),S(t.isCollecting()?18:-1),c(),S(t.collectionResult()?19:-1),c(2),S(t.stats()&&t.stats().totalMessages>0&&!t.isCollecting()&&!t.collectionResult()?21:-1),c(3),M(" ",t.collectionResult()?"\u95DC\u9589":"\u53D6\u6D88"," "),c(),S(t.collectionResult()?26:25)}}var jc=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.isOpen=Le(!1);this.group=Le(null);this.closeDialog=ge();this.collectionComplete=ge();this.viewUsersEvent=ge();this.isLoadingStats=f(!1);this.openEffect=gt(()=>{this.isOpen()&&this.group()&&this.loadStats()});this.stats=f(null);this.selectedTemplate=f("precise");this.showAdvanced=f(!1);this.isCollecting=f(!1);this.collectionProgress=f({current:0,total:0,status:""});this.collectionResult=f(null);this.config=f({limit:200,timeRange:"30d",minMessages:1,options:{skipDuplicates:!0,excludeBots:!0,requireUsername:!1,excludeAdmins:!1,autoSync:!0}});this.limitOptions=[{value:50,label:"50 \u4EBA"},{value:100,label:"100 \u4EBA"},{value:200,label:"200 \u4EBA"},{value:500,label:"500 \u4EBA"},{value:-1,label:"\u5168\u90E8"}];this.timeRangeOptions=[{value:"7d",label:"\u6700\u8FD1 7 \u5929"},{value:"30d",label:"\u6700\u8FD1 30 \u5929"},{value:"90d",label:"\u6700\u8FD1 90 \u5929"},{value:"all",label:"\u5168\u90E8\u6B77\u53F2"}];this.activityOptions=[{value:1,label:"\u5168\u90E8"},{value:3,label:"\u2265 3 \u6B21"},{value:5,label:"\u2265 5 \u6B21"},{value:10,label:"\u2265 10 \u6B21"}];this.listeners=[];this.estimatedCount=R(()=>{let e=this.stats(),t=this.config();if(!e)return 0;let n=e.uniqueSenders;return t.minMessages>=10?n=Math.round(n*.15):t.minMessages>=5?n=Math.round(n*.3):t.minMessages>=3&&(n=Math.round(n*.5)),t.timeRange==="7d"?n=Math.round(n*.3):t.timeRange==="30d"?n=Math.round(n*.6):t.timeRange==="90d"&&(n=Math.round(n*.85)),t.limit>0&&(n=Math.min(n,t.limit)),Math.max(1,n)});this.canStart=R(()=>{let e=this.stats();return e&&e.totalMessages>0&&!this.isCollecting()})}ngOnInit(){this.setupListeners()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupListeners(){let e=this.ipcService.on("history-collection-stats",o=>{this.isLoadingStats.set(!1),o.success&&o.stats?this.stats.set(o.stats):this.stats.set(null)});this.listeners.push(e);let t=this.ipcService.on("history-collection-progress",o=>{this.collectionProgress.set({current:o.current,total:o.total,status:o.status})});this.listeners.push(t);let n=this.ipcService.on("history-collection-result",o=>{this.isCollecting.set(!1),o.success&&o.result?(this.collectionResult.set(o.result),this.collectionComplete.emit(o.result),this.toastService.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${o.result.collected} \u4F4D\u7528\u6236`)):this.toastService.error(o.error||"\u6536\u96C6\u5931\u6557")});this.listeners.push(n)}loadStats(){let e=this.group();e&&(this.isLoadingStats.set(!0),this.stats.set(null),this.collectionResult.set(null),this.ipcService.send("get-history-collection-stats",{groupId:e.id,telegramId:e.telegramId}))}selectTemplate(e){switch(this.selectedTemplate.set(e),e){case"quick":this.config.update(t=>P(E({},t),{limit:100,timeRange:"7d",minMessages:1}));break;case"precise":this.config.update(t=>P(E({},t),{limit:200,timeRange:"30d",minMessages:3}));break;case"deep":this.config.update(t=>P(E({},t),{limit:-1,timeRange:"all",minMessages:1}));break}}setLimit(e){this.config.update(t=>P(E({},t),{limit:e}))}setTimeRange(e){this.config.update(t=>P(E({},t),{timeRange:e}))}setMinMessages(e){this.config.update(t=>P(E({},t),{minMessages:e}))}toggleOption(e){this.config.update(t=>P(E({},t),{options:P(E({},t.options),{[e]:!t.options[e]})}))}getProgressPercent(){let e=this.collectionProgress();return e.total===0?0:Math.min(100,Math.round(e.current/e.total*100))}startCollection(){let e=this.group();if(!e||!this.canStart())return;this.isCollecting.set(!0),this.collectionResult.set(null),this.collectionProgress.set({current:0,total:0,status:"\u6B63\u5728\u521D\u59CB\u5316..."});let t=this.config();this.ipcService.send("collect-users-from-history-advanced",{groupId:e.id,telegramId:e.telegramId,config:{limit:t.limit,timeRange:t.timeRange,minMessages:t.minMessages,skipDuplicates:t.options.skipDuplicates,excludeBots:t.options.excludeBots,requireUsername:t.options.requireUsername,excludeAdmins:t.options.excludeAdmins,autoSync:t.options.autoSync}})}viewCollectedUsers(){this.viewUsersEvent.emit(),this.close()}close(){this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&this.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-history-collection-dialog"]],inputs:{isOpen:[1,"isOpen"],group:[1,"group"]},outputs:{closeDialog:"closeDialog",collectionComplete:"collectionComplete",viewUsersEvent:"viewUsersEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[70]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[70]","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col",3,"click"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-orange-500/10","to-amber-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-orange-500","to-amber-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","space-y-5"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"p-4","bg-orange-500/10","rounded-xl","border","border-orange-500/30"],[1,"p-4","bg-emerald-500/10","rounded-xl","border","border-emerald-500/30"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"flex","items-center","justify-between","mb-4","text-sm"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-colors","font-medium",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-orange-500","to-amber-500","hover:from-orange-600","hover:to-amber-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-orange-500/20","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-emerald-500/20","flex","items-center","justify-center","gap-2"],[1,"flex","items-center","gap-3","mb-4"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-orange-500/20","to-amber-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1","min-w-0"],[1,"font-medium","text-white","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"flex","items-center","justify-center","py-4"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-lg","text-center"],[1,"animate-spin","text-xl","mr-2"],[1,"text-slate-400"],[1,"grid","grid-cols-3","gap-3"],[1,"p-3","bg-slate-700/30","rounded-lg","text-center"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xs","text-slate-500"],[1,"text-xl","font-bold","text-emerald-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"mt-3","text-xs","text-slate-500","text-center"],[1,"text-sm","text-amber-400"],[1,"text-xs","text-slate-400","mt-1"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"p-4","rounded-xl","border","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"flex","flex-wrap","gap-2"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-orange-500","bg-orange-500/20","text-orange-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-cyan-500","bg-cyan-500/20","text-cyan-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-purple-500","bg-purple-500/20","text-purple-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"border","border-slate-700/50","rounded-xl","overflow-hidden"],[1,"w-full","p-4","bg-slate-800/30","flex","items-center","justify-between","hover:bg-slate-800/50","transition-colors",3,"click"],[1,"text-sm","font-medium","text-slate-300"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-400","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-4","space-y-3","border-t","border-slate-700/50"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"click"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","gap-3","p-3","bg-slate-700/30","rounded-lg","cursor-pointer","hover:bg-slate-700/50"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600","text-orange-500","focus:ring-orange-500",3,"change","checked"],[1,"text-sm","text-white"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","text-orange-400","flex","items-center","gap-2"],[1,"animate-spin"],[1,"text-xs","text-slate-400"],[1,"w-full","bg-slate-700","rounded-full","h-2","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-orange-500","to-amber-500","rounded-full","transition-all","duration-300"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-sm","text-emerald-400","flex","items-center","gap-2"],[1,"text-lg","font-bold","text-emerald-400"],[1,"grid","grid-cols-4","gap-2","mb-3"],[1,"p-2","bg-slate-700/30","rounded-lg","text-center"],[1,"text-sm","font-bold","text-green-400"],[1,"text-sm","font-bold","text-blue-400"],[1,"text-sm","font-bold","text-slate-400"],[1,"text-sm","font-bold","text-orange-400"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-orange-400"],[1,"text-emerald-400"],[1,"flex","items-center","gap-2"],[1,"text-slate-500"],[1,"text-orange-400","font-medium"],[1,"flex-1","py-3","bg-gradient-to-r","from-orange-500","to-amber-500","hover:from-orange-600","hover:to-amber-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-orange-500/20","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","shadow-lg","shadow-emerald-500/20","flex","items-center","justify-center","gap-2",3,"click"]],template:function(t,n){t&1&&y(0,fL,27,7,"div",0),t&2&&S(n.isOpen()?0:-1)},dependencies:[oe,ae,St,yn],encapsulation:2})}};var f1=(i,e)=>e.id;function _L(i,e){i&1&&(r(0,"span",42),l(1," \u983B\u9053 "),s())}function vL(i,e){i&1&&(r(0,"span",43),l(1," \u8D85\u7D1A\u7FA4 "),s())}function xL(i,e){if(i&1&&(r(0,"span",49)(1,"span"),l(2,"\u{1F525}"),s(),r(3,"span"),l(4),s()()),i&2){let t=m().$implicit;c(4),D(t.stats.matchesToday)}}function CL(i,e){if(i&1&&(r(0,"span",53),l(1),s()),i&2){let t=e.$implicit,n=m(3);L("title",n.stateService.getKeywordSetName(t)),c(),M(" \u{1F511} ",n.stateService.getKeywordSetName(t)," ")}}function bL(i,e){if(i&1&&(r(0,"span",54),l(1),s()),i&2){let t=m(2).$implicit;c(),M(" +",t.linkedKeywordSets.length-2," ")}}function yL(i,e){if(i&1&&(O(0,CL,2,2,"span",53,be),y(2,bL,2,1,"span",54)),i&2){let t=m().$implicit;U(t.linkedKeywordSets.slice(0,2)),c(2),S(t.linkedKeywordSets.length>2?2:-1)}}function SL(i,e){i&1&&(r(0,"span",52),l(1," \u26A0\uFE0F \u672A\u7D81\u5B9A\u8A5E\u96C6 "),s())}function wL(i,e){if(i&1){let t=I();r(0,"div",36),x("click",function(){let o=_(t).$implicit,a=m();return v(a.openGroupDetail(o))}),r(1,"div",37)(2,"div",38),l(3),s(),r(4,"div",39)(5,"div",40)(6,"span",41),l(7),s(),y(8,_L,2,0,"span",42)(9,vL,2,0,"span",43),s(),r(10,"div",44),l(11),s()()(),r(12,"div",45)(13,"div",40)(14,"span",46)(15,"span",47),l(16,"\u{1F465}"),s(),r(17,"span",48),l(18),Ee(19,"number"),s()(),y(20,xL,5,1,"span",49),s(),r(21,"span",50),l(22," \u67E5\u770B\u8A73\u60C5 \u2192 "),s()(),r(23,"div",51),y(24,yL,3,1)(25,SL,2,0,"span",52),s()()}if(i&2){let t=e.$implicit;c(2),N("bg-gradient-to-br",!0)("from-emerald-500/30",t.resourceType!=="channel")("to-teal-500/30",t.resourceType!=="channel")("text-emerald-400",t.resourceType!=="channel")("border-emerald-500/20",t.resourceType!=="channel")("from-blue-500/30",t.resourceType==="channel")("to-indigo-500/30",t.resourceType==="channel")("text-blue-400",t.resourceType==="channel")("border-blue-500/20",t.resourceType==="channel"),c(),M(" ",t.resourceType==="channel"?"\u{1F4E2}":t.name[0]," "),c(3),L("title",t.name),c(),M(" ",t.name," "),c(),S(t.resourceType==="channel"?8:t.resourceType==="supergroup"?9:-1),c(2),L("title",t.url),c(),M(" ",t.url," "),c(7),D(je(19,27,t.memberCount)),c(2),S(t.stats!=null&&t.stats.matchesToday&&t.stats.matchesToday>0?20:-1),c(4),S(t.linkedKeywordSets.length>0?24:25)}}function EL(i,e){if(i&1){let t=I();r(0,"div",33)(1,"div",55)(2,"span",56),l(3,"\u{1F465}"),s()(),r(4,"h3",57),l(5,"\u9084\u6C92\u6709\u76E3\u63A7\u7FA4\u7D44"),s(),r(6,"p",58),l(7,"\u8ACB\u5728\u8CC7\u6E90\u4E2D\u5FC3\u641C\u7D22\u4E26\u6DFB\u52A0\u7FA4\u7D44"),s(),r(8,"button",59),x("click",function(){_(t);let o=m();return v(o.navigateToResourceCenter())}),l(9," + \u6DFB\u52A0\u7B2C\u4E00\u500B\u7FA4\u7D44 "),s()()}}function DL(i,e){i&1&&(r(0,"span",103),l(1,"\u76E3\u807D"),s())}function AL(i,e){i&1&&(r(0,"span",104),l(1,"\u767C\u9001"),s())}function ML(i,e){if(i&1&&(r(0,"div",76)(1,"div",99),l(2),s(),r(3,"div",100)(4,"div",101),l(5),s(),r(6,"div",28),l(7),s()(),r(8,"div",102),y(9,DL,2,0,"span",103),y(10,AL,2,0,"span",104),s()()),i&2){let t=m(3);c(2),M(" ",t.getAccountInitial(t.selectedGroup().accountPhone)," "),c(3),D(t.getAccountName(t.selectedGroup().accountPhone)),c(2),D(t.selectedGroup().accountPhone),c(2),S(t.isListenerAccount(t.selectedGroup().accountPhone)?9:-1),c(),S(t.isSenderAccount(t.selectedGroup().accountPhone)?10:-1)}}function TL(i,e){i&1&&(r(0,"div",77)(1,"p"),l(2,"\u5C1A\u672A\u5206\u914D\u76E3\u63A7\u5E33\u865F"),s()())}function kL(i,e){if(i&1&&(r(0,"span",87),l(1),s()),i&2){let t=m(3);c(),M(" \u53EF\u6536\u96C6 ~",t.estimatedNewUsers()," \u4EBA ")}}function IL(i,e){if(i&1){let t=I();r(0,"button",105),x("click",function(){_(t);let o=m(3);return v(o.viewCollectedUsers())}),r(1,"span"),l(2,"\u{1F441}\uFE0F"),s(),r(3,"span"),l(4),s()()}if(i&2){let t=m(3);c(4),M("\u67E5\u770B\u5DF2\u6536\u96C6 (",t.collectedUsersCount(),")")}}function FL(i,e){i&1&&(r(0,"div",91)(1,"p",106)(2,"span",107),l(3,"\u{1F4A1}"),s(),r(4,"span"),l(5,"\u958B\u555F\u7FA4\u7D44\u76E3\u63A7\u5F8C\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u6D88\u606F\u3002\u7D2F\u7A4D\u4E00\u5B9A\u6D88\u606F\u5F8C\u5373\u53EF\u6536\u96C6\u767C\u8A00\u7528\u6236\u3002"),s()()())}function PL(i,e){if(i&1&&(r(0,"div",92)(1,"p",108),l(2),Ee(3,"number"),s()()),i&2){let t=m(3);c(2),M(" \u5F9E ",je(3,1,t.monitoredMessagesCount())," \u689D\u6D88\u606F\u4E2D\u63D0\u53D6\u6D3B\u8E8D\u7528\u6236\uFF0C\u7121\u9700\u7BA1\u7406\u54E1\u6B0A\u9650 ")}}function RL(i,e){i&1&&(r(0,"div",93)(1,"p",109)(2,"span"),l(3,"\u26A0\uFE0F"),s(),r(4,"span"),l(5,"\u9700\u8981\u5206\u914D\u76E3\u63A7\u5E33\u865F\u624D\u80FD\u6536\u96C6\u7528\u6236"),s()()())}function NL(i,e){if(i&1){let t=I();r(0,"div",110)(1,"span",111),l(2),s(),r(3,"button",112),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.unbindKeywordSet(o))}),l(4," \u89E3\u7D81 "),s()()}if(i&2){let t=e.$implicit,n=m(4);c(2),D(n.stateService.getKeywordSetName(t))}}function VL(i,e){if(i&1&&(r(0,"div",94),O(1,NL,5,1,"div",110,be),s()),i&2){let t=m(3);c(),U(t.selectedGroup().linkedKeywordSets)}}function BL(i,e){i&1&&(r(0,"p",95),l(1,"\u5C1A\u672A\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6"),s())}function LL(i,e){if(i&1){let t=I();r(0,"button",116),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.bindKeywordSet(o.id))}),l(1),s()}if(i&2){let t=e.$implicit;c(),M(" + ",t.name," ")}}function OL(i,e){if(i&1&&(r(0,"div",96)(1,"p",113),l(2,"\u9EDE\u64CA\u7D81\u5B9A\u8A5E\u96C6\uFF1A"),s(),r(3,"div",114),O(4,LL,2,1,"button",115,f1),s()()),i&2){let t=m(3);c(4),U(t.availableKeywordSets())}}function UL(i,e){if(i&1&&(r(0,"div",97)(1,"div",117)(2,"span",118)(3,"span",119),l(4,"\u23F3"),s(),l(5," \u6B63\u5728\u63D0\u53D6\u6210\u54E1... "),s(),r(6,"span",14),l(7),s()(),r(8,"div",120),B(9,"div",121),s(),r(10,"div",122),l(11),s()()),i&2){let t=m(3);c(7),X(" ",t.extractionProgress().extracted," / ",t.extractionProgress().total," "),c(2),ee("width",t.getExtractionPercent(),"%"),c(2),D(t.extractionProgress().status)}}function GL(i,e){if(i&1&&(r(0,"div",98)(1,"div",123)(2,"span",118)(3,"span"),l(4,"\u2705"),s(),l(5," \u63D0\u53D6\u5B8C\u6210 "),s(),r(6,"span",124),l(7),s()(),r(8,"div",125)(9,"span",126),l(10),s(),r(11,"span",126),l(12),s(),r(13,"span",126),l(14),s()()()),i&2){let t=m(3);c(7),M("",t.extractionResult().count," \u4EBA"),c(3),M("\u{1F7E2} ",t.extractionResult().online," \u5728\u7DDA"),c(2),M("\u23F0 ",t.extractionResult().recently," \u6700\u8FD1"),c(2),M("\u{1F48E} ",t.extractionResult().premium," Premium")}}function $L(i,e){if(i&1){let t=I();r(0,"div",67)(1,"div",68)(2,"div",69),l(3),s(),r(4,"div",70)(5,"h4",71),l(6),s(),r(7,"p",72),l(8),s()()(),r(9,"div",73)(10,"div",74)(11,"div",17),l(12),Ee(13,"number"),s(),r(14,"div",28),l(15,"\u6210\u54E1\u6578"),s()(),r(16,"div",74)(17,"div",20),l(18),s(),r(19,"div",28),l(20,"\u4ECA\u65E5\u5339\u914D"),s()()()(),r(21,"div",67)(22,"h4",75)(23,"span"),l(24,"\u{1F4F1}"),s(),l(25," \u76E3\u63A7\u5E33\u865F "),s(),y(26,ML,11,5,"div",76)(27,TL,3,0,"div",77),s(),r(28,"div",78)(29,"h4",79)(30,"span",40)(31,"span"),l(32,"\u{1F504}"),s(),l(33," \u5F9E\u6B77\u53F2\u6D88\u606F\u6536\u96C6\u7528\u6236 "),s(),r(34,"span",28),l(35,"\u66FF\u4EE3\u6210\u54E1\u63D0\u53D6"),s()(),r(36,"div",80)(37,"div",81)(38,"div",82),l(39),Ee(40,"number"),s(),r(41,"div",83),l(42,"\u76E3\u63A7\u6D88\u606F"),s()(),r(43,"div",81)(44,"div",84),l(45),s(),r(46,"div",83),l(47,"\u5DF2\u6536\u96C6"),s()(),r(48,"div",81)(49,"div",85),l(50),s(),r(51,"div",83),l(52,"\u53EF\u6536\u96C6"),s()()(),r(53,"button",86),x("click",function(){_(t);let o=m(2);return v(o.openHistoryCollectionDialog())}),r(54,"span",47),l(55,"\u{1F504}"),s(),r(56,"span"),l(57,"\u958B\u59CB\u6536\u96C6\u7528\u6236"),s(),y(58,kL,2,1,"span",87),s(),r(59,"div",88),y(60,IL,5,1,"button",89),r(61,"button",90),x("click",function(){_(t);let o=m(2);return v(o.refreshCollectedStats())}),r(62,"span"),l(63,"\u{1F504}"),s(),r(64,"span"),l(65,"\u5237\u65B0"),s()()(),y(66,FL,6,0,"div",91)(67,PL,4,3,"div",92),y(68,RL,6,0,"div",93),s(),r(69,"div",67)(70,"h4",75)(71,"span"),l(72,"\u{1F511}"),s(),l(73," \u7D81\u5B9A\u7684\u95DC\u9375\u8A5E\u96C6 "),s(),y(74,VL,3,0,"div",94)(75,BL,2,0,"p",95),y(76,OL,6,0,"div",96),s(),y(77,UL,12,5,"div",97),y(78,GL,15,4,"div",98)}if(i&2){let t,n=m(2);c(3),M(" ",n.selectedGroup().name[0]," "),c(3),D(n.selectedGroup().name),c(2),D(n.selectedGroup().url),c(4),D(je(13,21,n.selectedGroup().memberCount)),c(6),D(((t=n.selectedGroup().stats)==null?null:t.matchesToday)||0),c(8),S(n.selectedGroup().accountPhone?26:27),c(13),D(je(40,23,n.monitoredMessagesCount())),c(6),D(n.collectedUsersCount()),c(5),D(n.estimatedNewUsers()),c(3),L("disabled",n.monitoredMessagesCount()===0),c(5),S(n.monitoredMessagesCount()>0?58:-1),c(2),S(n.collectedUsersCount()>0?60:-1),c(),L("disabled",n.isLoadingStats()),c(),N("animate-spin",n.isLoadingStats()),c(4),S(n.monitoredMessagesCount()===0?66:67),c(2),S(n.selectedGroup().accountPhone?-1:68),c(6),S(n.selectedGroup().linkedKeywordSets.length>0?74:75),c(2),S(n.availableKeywordSets().length>0?76:-1),c(),S(n.extractionProgress().isExtracting&&n.extractionProgress().groupId===n.selectedGroup().id?77:-1),c(),S(n.extractionResult().completed&&n.extractionResult().groupId===n.selectedGroup().id?78:-1)}}function HL(i,e){i&1&&(r(0,"span",132),l(1,"\u23F3"),s(),l(2," \u63D0\u53D6\u4E2D... "))}function qL(i,e){i&1&&(r(0,"span"),l(1,"\u{1F465}"),s(),l(2," \u63D0\u53D6\u6210\u54E1 "))}function WL(i,e){if(i&1){let t=I();r(0,"div",66)(1,"div",127)(2,"button",128),x("click",function(){_(t);let o=m(2);return v(o.extractMembers())}),y(3,HL,3,0)(4,qL,3,0),s(),r(5,"button",129),x("click",function(){_(t);let o=m(2);return v(o.copyGroupLink())}),r(6,"span"),l(7,"\u{1F4CB}"),s(),l(8," \u8907\u88FD\u93C8\u63A5 "),s(),r(9,"button",130),x("click",function(){_(t);let o=m(2);return v(o.openInTelegram())}),r(10,"span"),l(11,"\u{1F517}"),s(),l(12," \u5728 Telegram \u6253\u958B "),s(),r(13,"button",131),x("click",function(){_(t);let o=m(2);return v(o.removeGroup())}),r(14,"span"),l(15,"\u{1F5D1}\uFE0F"),s(),l(16," \u79FB\u9664\u76E3\u63A7 "),s()()()}if(i&2){let t=m(2);c(2),L("disabled",t.extractionProgress().isExtracting),c(),S(t.extractionProgress().isExtracting&&t.extractionProgress().groupId===t.selectedGroup().id?3:4)}}function zL(i,e){if(i&1){let t=I();r(0,"div",34)(1,"div",60),x("click",function(){_(t);let o=m();return v(o.closeDetailDialog())}),s(),r(2,"div",61)(3,"div",62)(4,"h3",63)(5,"span"),l(6,"\u{1F4CB}"),s(),l(7," \u7FA4\u7D44\u8A73\u60C5 "),s(),r(8,"button",64),x("click",function(){_(t);let o=m();return v(o.closeDetailDialog())}),l(9," \u2715 "),s()(),r(10,"div",65),y(11,$L,79,25),s(),y(12,WL,17,2,"div",66),s()()}if(i&2){let t=m();c(11),S(t.selectedGroup()?11:-1),c(),S(t.selectedGroup()?12:-1)}}var Jc=class i{constructor(){this.stateService=F(Ct);this.ipcService=F(Q);this.toastService=F(J);this.confirmDialog=F(zt);this.configAction=ge();this.extractMembersEvent=ge();this.selectedGroup=f(null);this.showDetailDialog=f(!1);this.isRefreshingMemberCounts=f(!1);this.refreshMemberCountProgress=f({current:0,total:0});this.extractionProgress=f({isExtracting:!1,groupId:"",extracted:0,total:0,status:""});this.extractionResult=f({completed:!1,groupId:"",count:0,online:0,recently:0,premium:0});this.collectedUsersCount=f(0);this.monitoredMessagesCount=f(0);this.isCollectingFromHistory=f(!1);this.showHistoryCollectionDialog=f(!1);this.historyCollectionGroup=f(null);this.isLoadingStats=f(!1);this.estimatedNewUsers=R(()=>{let e=this.monitoredMessagesCount(),t=this.collectedUsersCount();return Math.max(0,Math.round(e/5)-t)});this.availableKeywordSets=R(()=>{let e=this.selectedGroup();return e?this.stateService.keywordSets().filter(t=>!e.linkedKeywordSets.includes(t.id)):[]});this.listeners=[]}ngOnInit(){this.stateService.loadAll(),this.setupListeners()}setupListeners(){let e=this.ipcService.on("bind-keyword-set-result",p=>{if(p.success&&p.currentKeywordSetIds){this.stateService.updateGroupKeywordSets(String(p.groupId),p.currentKeywordSetIds.map(C=>String(C)));let g=this.selectedGroup();g&&String(g.id)===String(p.groupId)&&this.selectedGroup.update(C=>C?P(E({},C),{linkedKeywordSets:p.currentKeywordSetIds.map(w=>String(w))}):null)}});this.listeners.push(e);let t=this.ipcService.on("unbind-keyword-set-result",p=>{if(p.success&&p.currentKeywordSetIds){this.stateService.updateGroupKeywordSets(String(p.groupId),p.currentKeywordSetIds.map(C=>String(C)));let g=this.selectedGroup();g&&String(g.id)===String(p.groupId)&&this.selectedGroup.update(C=>C?P(E({},C),{linkedKeywordSets:p.currentKeywordSetIds.map(w=>String(w))}):null)}});this.listeners.push(t);let n=this.ipcService.on("members-extraction-progress",p=>{let g=this.selectedGroup();g&&String(g.id)===String(p.resourceId)&&this.extractionProgress.set({isExtracting:!0,groupId:String(p.resourceId),extracted:p.extracted,total:p.total,status:p.status})});this.listeners.push(n);let o=this.ipcService.on("members-extracted",p=>{let g=this.selectedGroup();if(p.success&&p.members&&g&&String(g.id)===String(p.resourceId)){let C=0,w=0,A=0;for(let V of p.members)V.online_status==="online"?C++:V.online_status==="recently"&&w++,V.is_premium&&A++;this.extractionProgress.set({isExtracting:!1,groupId:"",extracted:0,total:0,status:""}),this.extractionResult.set({completed:!0,groupId:String(p.resourceId),count:p.members.length,online:C,recently:w,premium:A}),setTimeout(()=>{this.extractionResult().groupId===String(p.resourceId)&&this.clearExtractionResult()},1e4)}else p.error&&this.extractionProgress.set({isExtracting:!1,groupId:"",extracted:0,total:0,status:""})});this.listeners.push(o);let a=this.ipcService.on("group-collected-stats",p=>{let g=this.selectedGroup();g&&String(g.id)===String(p.groupId)&&(this.collectedUsersCount.set(p.collectedUsers||0),this.monitoredMessagesCount.set(p.monitoredMessages||0))});this.listeners.push(a);let d=this.ipcService.on("batch-refresh-member-counts-progress",p=>{this.refreshMemberCountProgress.set({current:p.current,total:p.total}),p.memberCount>0&&this.stateService.updateGroupMemberCount(p.groupId,p.memberCount)});this.listeners.push(d);let u=this.ipcService.on("batch-refresh-member-counts-complete",p=>{this.isRefreshingMemberCounts.set(!1),this.refreshMemberCountProgress.set({current:0,total:0}),p.success?(this.toastService.success(`\u2705 \u6210\u54E1\u6578\u5237\u65B0\u5B8C\u6210\uFF1A${p.updated} \u500B\u6210\u529F\uFF0C${p.failed} \u500B\u5931\u6557`),this.stateService.refresh()):this.toastService.error("\u6210\u54E1\u6578\u5237\u65B0\u5931\u6557")});this.listeners.push(u)}getAccountInitial(e){let t=this.stateService.accounts().find(n=>n.phone===e);return t?.username?t.username[0].toUpperCase():e?e.slice(-2):"?"}getAccountName(e){let t=this.stateService.accounts().find(n=>n.phone===e);return t?.username||t?.firstName||e||"\u672A\u77E5\u5E33\u865F"}isListenerAccount(e){return this.stateService.accounts().find(n=>n.phone===e)?.isListener??!1}isSenderAccount(e){return this.stateService.accounts().find(n=>n.phone===e)?.isSender??!1}refreshData(){this.stateService.refresh(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u7FA4\u7D44\u5217\u8868...")}refreshAllMemberCounts(){let e=this.stateService.groups();if(e.length===0){this.toastService.warning("\u6C92\u6709\u7FA4\u7D44\u9700\u8981\u5237\u65B0");return}this.isRefreshingMemberCounts.set(!0),this.refreshMemberCountProgress.set({current:0,total:e.length}),this.ipcService.send("batch-refresh-member-counts",{groups:e.map(t=>({id:t.id,url:t.url,accountPhone:t.accountPhone}))}),this.toastService.info(`\u{1F504} \u958B\u59CB\u5237\u65B0 ${e.length} \u500B\u7FA4\u7D44\u7684\u6210\u54E1\u6578...`)}selectGroup(e){this.selectedGroup.set(e)}openGroupDetail(e){this.selectedGroup.set(e),this.showDetailDialog.set(!0),this.loadCollectedStats(e)}closeDetailDialog(){this.showDetailDialog.set(!1)}loadCollectedStats(e){this.collectedUsersCount.set(0),this.monitoredMessagesCount.set(0),this.ipcService.send("get-group-collected-stats",{groupId:e.id,telegramId:e.telegramId})}viewCollectedUsers(){let e=this.selectedGroup();e&&(this.closeDetailDialog(),this.toastService.info(`\u{1F4CB} \u8DF3\u8F49\u5230\u300C${e.name}\u300D\u7684\u5DF2\u6536\u96C6\u7528\u6236...`),this.ipcService.send("navigate-to-collected-users",{groupId:e.id,groupName:e.name,telegramId:e.telegramId}))}collectFromHistory(){let e=this.selectedGroup();if(!e)return;this.isCollectingFromHistory.set(!0),this.toastService.info("\u{1F504} \u6B63\u5728\u5F9E\u6B77\u53F2\u6D88\u606F\u4E2D\u6536\u96C6\u7528\u6236..."),this.ipcService.send("collect-users-from-history",{groupId:e.id,telegramId:e.telegramId,limit:500});let t=this.ipcService.on("collect-from-history-result",n=>{String(n.groupId)===String(e.id)&&(this.isCollectingFromHistory.set(!1),t(),n.success?(this.toastService.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${n.collected} \u4F4D\u7528\u6236\uFF0C\u65B0\u589E ${n.newUsers||0} \u4F4D`),this.loadCollectedStats(e)):this.toastService.error(n.error||"\u6536\u96C6\u5931\u6557"))});this.listeners.push(t)}openHistoryCollectionDialog(){let e=this.selectedGroup();e&&(this.historyCollectionGroup.set({id:e.id,name:e.name,telegramId:e.telegramId,url:e.url,accountPhone:e.accountPhone}),this.showHistoryCollectionDialog.set(!0),setTimeout(()=>{this.ipcService.send("get-history-collection-stats",{groupId:e.id,telegramId:e.telegramId})},100))}closeHistoryCollectionDialog(){this.showHistoryCollectionDialog.set(!1)}onHistoryCollectionComplete(e){let t=this.selectedGroup();t&&this.loadCollectedStats(t)}refreshCollectedStats(){let e=this.selectedGroup();e&&(this.isLoadingStats.set(!0),this.loadCollectedStats(e),setTimeout(()=>{this.isLoadingStats.set(!1)},5e3))}navigateToResourceCenter(){this.configAction.emit("goto-resource-center"),this.toastService.info("\u8ACB\u5728\u300C\u8CC7\u6E90\u4E2D\u5FC3\u300D\u641C\u7D22\u4E26\u6DFB\u52A0\u7FA4\u7D44")}handleConfigAction(e){this.configAction.emit(e)}bindKeywordSet(e){let t=this.selectedGroup();if(!t){console.log("[Groups] bindKeywordSet: No group selected");return}let n={groupId:parseInt(t.id),keywordSetId:parseInt(e)};console.log("[Groups] ========== bindKeywordSet =========="),console.log("[Groups] Sending bind-keyword-set with payload:",n),this.ipcService.send("bind-keyword-set",n);let o=[...t.linkedKeywordSets,e];this.selectedGroup.update(a=>a?P(E({},a),{linkedKeywordSets:o}):null),this.stateService.updateGroupKeywordSets(t.id,o),console.log("[Groups] Updated linkedKeywordSets:",o),this.toastService.success(`\u2705 \u8A5E\u96C6\u5DF2\u7D81\u5B9A\u5230 ${t.name}`)}unbindKeywordSet(e){let t=this.selectedGroup();if(!t)return;this.ipcService.send("unbind-keyword-set",{groupId:parseInt(t.id),keywordSetId:parseInt(e)});let n=t.linkedKeywordSets.filter(o=>o!==e);this.selectedGroup.update(o=>o?P(E({},o),{linkedKeywordSets:n}):null),this.stateService.updateGroupKeywordSets(t.id,n),this.toastService.info(`\u5DF2\u5F9E ${t.name} \u89E3\u7D81\u8A5E\u96C6`)}extractMembers(){let e=this.selectedGroup();e&&this.extractMembersEvent.emit(e)}executeExtraction(e){let t=this.selectedGroup();if(!t)return;this.extractionProgress.set({isExtracting:!0,groupId:t.id,extracted:0,total:e.limit===-1?t.memberCount||0:e.limit,status:"\u6B63\u5728\u9023\u63A5..."}),this.clearExtractionResult();let n="",o="";if(t.telegramId)n=t.telegramId,console.log("[Groups] Using telegramId for extraction:",n);else if(t.url){let a=t.url.match(/t\.me\/([^+/][^/]*?)(?:\?|$)/);a?(o=a[1],n=o,console.log("[Groups] Using username for extraction:",o)):console.log("[Groups] URL is invite link, need telegramId:",t.url)}if(!n){this.toastService.error("\u7121\u6CD5\u63D0\u53D6\u6210\u54E1\uFF1A\u8A72\u7FA4\u7D44\u7F3A\u5C11\u6709\u6548\u7684 ID\u3002\u8ACB\u5148\u624B\u52D5\u6253\u958B\u7FA4\u7D44\u4EE5\u7372\u53D6\u5176 ID\u3002"),this.extractionProgress.set({isExtracting:!1,groupId:"",extracted:0,total:0,status:""});return}this.ipcService.send("extract-members",{chatId:n,telegramId:t.telegramId,username:o,resourceId:t.id,groupName:t.name,limit:e.limit===-1?void 0:e.limit,filters:{bots:!e.filters.excludeBots,onlineStatus:e.filters.onlineStatus||"all",offline:e.filters.onlineStatus==="offline",online:e.filters.onlineStatus==="online",chinese:e.filters.hasChinese,hasUsername:e.filters.hasUsername,isPremium:e.filters.isPremium,excludeAdmins:e.filters.excludeAdmins},autoSave:e.advanced.autoSaveToResources,skipDuplicates:e.advanced.skipDuplicates}),this.toastService.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${t.name} \u7684\u6210\u54E1...`)}getExtractionPercent(){let e=this.extractionProgress();return e.total===0?0:Math.min(100,Math.round(e.extracted/e.total*100))}clearExtractionResult(){this.extractionResult.set({completed:!1,groupId:"",count:0,online:0,recently:0,premium:0})}copyGroupLink(){let e=this.selectedGroup();e&&(navigator.clipboard.writeText(e.url||""),this.toastService.success("\u{1F4CB} \u5DF2\u8907\u88FD\u7FA4\u7D44\u93C8\u63A5"))}openInTelegram(){let e=this.selectedGroup();e?.url&&window.open(e.url,"_blank")}async removeGroup(){let e=this.selectedGroup();if(!e)return;await this.confirmDialog.danger("\u79FB\u9664\u76E3\u63A7\u7FA4\u7D44",`\u78BA\u5B9A\u8981\u79FB\u9664\u76E3\u63A7\u7FA4\u7D44\u300C${e.name}\u300D\u55CE\uFF1F
\u79FB\u9664\u5F8C\u5C07\u505C\u6B62\u76E3\u63A7\u6B64\u7FA4\u7D44\u7684\u6D88\u606F\u3002`,[e.name||e.url||""])&&(this.ipcService.send("remove-group",{id:parseInt(e.id)}),this.selectedGroup.set(null),this.showDetailDialog.set(!1),this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u79FB\u9664 ${e.name}`),setTimeout(()=>this.stateService.refresh(),500))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-monitoring-groups"]],outputs:{configAction:"configAction",extractMembersEvent:"extractMembersEvent"},decls:83,vars:17,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-emerald-500","to-teal-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400","rounded-lg","transition-colors","flex","items-center","gap-2","border","border-purple-500/30","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"bg-gradient-to-br","from-emerald-500/10","to-teal-500/5","rounded-xl","border","border-emerald-500/20","p-4","hover:border-emerald-500/40","transition-colors"],[1,"w-12","h-12","bg-emerald-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-400"],[1,"bg-gradient-to-br","from-cyan-500/10","to-blue-500/5","rounded-xl","border","border-cyan-500/20","p-4","hover:border-cyan-500/40","transition-colors"],[1,"w-12","h-12","bg-cyan-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"bg-gradient-to-br","from-orange-500/10","to-amber-500/5","rounded-xl","border","border-orange-500/20","p-4","hover:border-orange-500/40","transition-colors"],[1,"w-12","h-12","bg-orange-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-orange-400"],[1,"bg-gradient-to-br","from-purple-500/10","to-pink-500/5","rounded-xl","border","border-purple-500/20","p-4","hover:border-purple-500/40","transition-colors"],[1,"w-12","h-12","bg-purple-500/20","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl","font-bold","text-purple-400"],[1,"flex-1","overflow-hidden"],[1,"h-full","bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"text-xs","text-slate-500"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex-1","overflow-y-auto","p-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/60","rounded-xl","hover:bg-slate-700/80","transition-all","cursor-pointer","group","border","border-slate-700/50","hover:border-cyan-500/40","hover:shadow-lg","hover:shadow-cyan-500/10","overflow-hidden"],[1,"col-span-full","text-center","py-16","text-slate-400"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4"],[3,"closeDialog","collectionComplete","viewUsersEvent","isOpen","group"],[1,"p-4","bg-slate-800/60","rounded-xl","hover:bg-slate-700/80","transition-all","cursor-pointer","group","border","border-slate-700/50","hover:border-cyan-500/40","hover:shadow-lg","hover:shadow-cyan-500/10","overflow-hidden",3,"click"],[1,"flex","items-start","gap-3","mb-3"],[1,"w-11","h-11","rounded-xl","flex","items-center","justify-center","text-xl","font-bold","flex-shrink-0","border"],[1,"flex-1","min-w-0","overflow-hidden"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white","truncate","text-sm","leading-tight",3,"title"],[1,"px-1.5","py-0.5","bg-blue-500/20","text-blue-400","text-[10px]","rounded","flex-shrink-0"],[1,"px-1.5","py-0.5","bg-purple-500/20","text-purple-400","text-[10px]","rounded","flex-shrink-0"],[1,"text-xs","text-slate-500","truncate","mt-0.5",3,"title"],[1,"flex","items-center","justify-between","text-xs","mb-3","px-1"],[1,"text-slate-400","flex","items-center","gap-1"],[1,"text-base"],[1,"font-medium"],[1,"text-orange-400","flex","items-center","gap-1"],[1,"text-cyan-400","text-xs","opacity-0","group-hover:opacity-100","transition-opacity","whitespace-nowrap"],[1,"flex","flex-wrap","gap-1.5","overflow-hidden","max-h-[52px]"],[1,"px-2","py-1","bg-amber-500/20","text-amber-400","text-xs","rounded-md"],[1,"px-2","py-1","bg-purple-500/20","text-purple-400","text-xs","rounded-md","truncate","max-w-[120px]",3,"title"],[1,"px-2","py-1","bg-slate-600/50","text-slate-400","text-xs","rounded-md"],[1,"w-20","h-20","mx-auto","mb-4","rounded-2xl","bg-slate-800/50","flex","items-center","justify-center"],[1,"text-4xl"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-sm","mb-6","text-slate-500"],[1,"px-5","py-2.5","bg-cyan-500/20","text-cyan-400","rounded-xl","hover:bg-cyan-500/30","transition-colors","border","border-cyan-500/30",3,"click"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm",3,"click"],[1,"relative","w-full","max-w-lg","max-h-[85vh]","bg-slate-900","rounded-2xl","border","border-slate-700/50","shadow-2xl","shadow-black/50","overflow-hidden","flex","flex-col","animate-in","fade-in","zoom-in-95","duration-200"],[1,"flex","items-center","justify-between","p-5","border-b","border-slate-700/50"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"w-8","h-8","flex","items-center","justify-center","rounded-lg","hover:bg-slate-700/50","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto","p-5","space-y-4"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"bg-slate-800/50","rounded-xl","p-4","border","border-slate-700/50"],[1,"flex","items-center","gap-4","mb-4"],[1,"w-16","h-16","rounded-xl","bg-gradient-to-br","from-emerald-500/20","to-teal-500/20","flex","items-center","justify-center","text-3xl","font-bold","text-emerald-400"],[1,"flex-1","min-w-0"],[1,"text-xl","font-medium","text-white","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"grid","grid-cols-2","gap-4"],[1,"text-center","p-3","bg-slate-700/30","rounded-lg"],[1,"text-sm","font-medium","text-slate-300","mb-3","flex","items-center","gap-2"],[1,"flex","items-center","gap-3","p-3","bg-slate-700/30","rounded-lg"],[1,"text-center","py-4","text-slate-500","text-sm","bg-slate-700/30","rounded-lg"],[1,"bg-gradient-to-br","from-orange-500/10","to-amber-500/5","rounded-xl","p-4","border","border-orange-500/30"],[1,"text-sm","font-medium","text-orange-400","mb-3","flex","items-center","justify-between"],[1,"grid","grid-cols-3","gap-2","mb-4"],[1,"p-2","bg-slate-800/50","rounded-lg","text-center"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-[10px]","text-slate-500"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-purple-400"],[1,"w-full","px-4","py-3","bg-gradient-to-r","from-orange-500","to-amber-500","hover:from-orange-600","hover:to-amber-600","text-white","rounded-xl","text-sm","font-medium","transition-all","flex","items-center","justify-center","gap-2","shadow-lg","shadow-orange-500/20","disabled:opacity-50","disabled:cursor-not-allowed","disabled:from-slate-600","disabled:to-slate-700",3,"click","disabled"],[1,"px-2","py-0.5","bg-white/20","rounded-full","text-xs"],[1,"flex","gap-2","mt-3"],[1,"flex-1","px-3","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-xs","transition-colors","flex","items-center","justify-center","gap-1.5"],[1,"px-3","py-2","bg-slate-700/50","hover:bg-slate-700","text-slate-400","rounded-lg","text-xs","transition-colors","flex","items-center","justify-center","gap-1.5","disabled:opacity-50",3,"click","disabled"],[1,"mt-3","p-3","bg-slate-800/50","rounded-lg"],[1,"mt-3","p-2","bg-slate-800/30","rounded-lg"],[1,"mt-3","p-3","bg-amber-500/10","rounded-lg","border","border-amber-500/20"],[1,"space-y-2"],[1,"text-sm","text-slate-500","text-center","py-2"],[1,"mt-3","pt-3","border-t","border-slate-600/50"],[1,"p-4","bg-emerald-500/10","rounded-xl","border","border-emerald-500/30"],[1,"p-4","bg-emerald-500/20","rounded-xl","border","border-emerald-500/30"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold"],[1,"flex-1"],[1,"text-sm","text-white","font-medium"],[1,"flex","gap-1"],[1,"px-2","py-1","bg-blue-500/20","text-blue-400","rounded","text-xs"],[1,"px-2","py-1","bg-green-500/20","text-green-400","rounded","text-xs"],[1,"flex-1","px-3","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-xs","transition-colors","flex","items-center","justify-center","gap-1.5",3,"click"],[1,"text-xs","text-slate-400","flex","items-start","gap-2"],[1,"text-amber-400"],[1,"text-[10px]","text-slate-500","text-center"],[1,"text-xs","text-amber-400","flex","items-center","gap-2"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/30","rounded-lg"],[1,"text-sm","text-white"],[1,"px-2","py-1","hover:bg-red-500/20","rounded","text-red-400","text-xs","transition-colors",3,"click"],[1,"text-xs","text-slate-500","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1.5","bg-purple-500/10","hover:bg-purple-500/20","text-purple-400","rounded-lg","text-xs","transition-colors"],[1,"px-3","py-1.5","bg-purple-500/10","hover:bg-purple-500/20","text-purple-400","rounded-lg","text-xs","transition-colors",3,"click"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-emerald-400","flex","items-center","gap-2"],[1,"animate-pulse"],[1,"w-full","bg-slate-700","rounded-full","h-2","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-teal-500","rounded-full","transition-all","duration-300"],[1,"text-xs","text-slate-500","mt-2"],[1,"flex","items-center","justify-between"],[1,"text-emerald-300","font-medium","text-lg"],[1,"flex","items-center","gap-3","mt-2","text-sm"],[1,"text-slate-400"],[1,"grid","grid-cols-2","gap-3"],[1,"px-4","py-3","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"px-4","py-3","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"px-4","py-3","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-xl","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"animate-spin"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F465}"),s()(),r(6,"div")(7,"h1",5),l(8,"\u76E3\u63A7\u7FA4\u7D44\u7BA1\u7406"),s(),r(9,"p",6),l(10,"\u7BA1\u7406\u6B63\u5728\u76E3\u63A7\u7684 Telegram \u7FA4\u7D44"),s()()(),r(11,"div",2)(12,"app-config-progress",7),x("action",function(a){return n.handleConfigAction(a)}),s(),r(13,"button",8),x("click",function(){return n.refreshAllMemberCounts()}),r(14,"span"),l(15,"\u{1F465}"),s(),r(16,"span"),l(17),s()(),r(18,"button",9),x("click",function(){return n.refreshData()}),r(19,"span"),l(20,"\u{1F504}"),s(),r(21,"span"),l(22,"\u5237\u65B0"),s()()()(),r(23,"div",10)(24,"div",11)(25,"div",2)(26,"div",12)(27,"span",4),l(28,"\u{1F4AC}"),s()(),r(29,"div")(30,"div",13),l(31),s(),r(32,"div",14),l(33,"\u76E3\u63A7\u7FA4\u7D44"),s()()()(),r(34,"div",15)(35,"div",2)(36,"div",16)(37,"span",4),l(38,"\u{1F465}"),s()(),r(39,"div")(40,"div",17),l(41),Ee(42,"number"),s(),r(43,"div",14),l(44,"\u7E3D\u6210\u54E1"),s()()()(),r(45,"div",18)(46,"div",2)(47,"div",19)(48,"span",4),l(49,"\u{1F525}"),s()(),r(50,"div")(51,"div",20),l(52),s(),r(53,"div",14),l(54,"\u4ECA\u65E5\u5339\u914D"),s()()()(),r(55,"div",21)(56,"div",2)(57,"div",22)(58,"span",4),l(59,"\u{1F517}"),s()(),r(60,"div")(61,"div",23),l(62),s(),r(63,"div",14),l(64,"\u5DF2\u7D81\u5B9A\u8A5E\u96C6"),s()()()()(),r(65,"div",24)(66,"div",25)(67,"div",26)(68,"h3",27)(69,"span"),l(70,"\u{1F465}"),s(),l(71," \u76E3\u63A7\u7FA4\u7D44 "),r(72,"span",28),l(73),s()(),r(74,"button",29),x("click",function(){return n.navigateToResourceCenter()}),l(75," + \u6DFB\u52A0\u7FA4\u7D44 "),s()(),r(76,"div",30)(77,"div",31),O(78,wL,26,29,"div",32,f1,!1,EL,10,0,"div",33),s()()()()(),y(81,zL,13,2,"div",34),r(82,"app-history-collection-dialog",35),x("closeDialog",function(){return n.closeHistoryCollectionDialog()})("collectionComplete",function(a){return n.onHistoryCollectionComplete(a)})("viewUsersEvent",function(){return n.viewCollectedUsers()}),s()),t&2&&(c(13),L("disabled",n.isRefreshingMemberCounts()),c(),N("animate-spin",n.isRefreshingMemberCounts()),c(3),D(n.isRefreshingMemberCounts()?"\u5237\u65B0\u4E2D...":"\u5237\u65B0\u6210\u54E1\u6578"),c(2),N("animate-spin",n.stateService.isLoading()),c(12),D(n.stateService.groups().length),c(10),D(je(42,15,n.stateService.totalMembers())),c(11),D(n.stateService.todayMatches()),c(10),D(n.stateService.groupsWithKeywords().length),c(11),M("(",n.stateService.groups().length,")"),c(5),U(n.stateService.groups()),c(3),S(n.showDetailDialog()?81:-1),c(),L("isOpen",n.showHistoryCollectionDialog())("group",n.historyCollectionGroup()))},dependencies:[oe,ae,vn,jc,St],encapsulation:2})}};var Yc=(i,e)=>e.id;function KL(i,e){if(i&1&&(r(0,"span",28),l(1),s()),i&2){let t=m();c(),M(" \u{1F525} \u7E3D\u5339\u914D ",t.stateService.totalKeywordMatches()," ")}}function jL(i,e){if(i&1&&(r(0,"div",40)(1,"span"),l(2,"\u{1F511}"),s(),r(3,"span"),l(4),s(),r(5,"span",41),l(6),s()()),i&2){let t=e.$implicit;N("bg-purple-500/20",t.isActive)("text-purple-400",t.isActive)("border-purple-500/30",t.isActive)("bg-slate-700/50",!t.isActive)("text-slate-400",!t.isActive)("border-slate-600/30",!t.isActive),c(4),D(t.name),c(2),M("(",t.keywords.length,")")}}function JL(i,e){if(i&1&&(r(0,"div",30)(1,"div",36)(2,"span",14),l(3,"\u{1F3AF} \u62D6\u62FD\u7D81\u5B9A\uFF1A"),s(),r(4,"span",37),l(5,"\u{1F4A1} \u62D6\u62FD\u8A5E\u96C6\u5230\u7FA4\u7D44\u53EF\u5FEB\u901F\u7D81\u5B9A"),s()(),r(6,"div",38),O(7,jL,7,14,"div",39,Yc),s()()),i&2){let t=m();c(7),U(t.stateService.keywordSets())}}function QL(i,e){if(i&1&&(r(0,"span",47),l(1),s()),i&2){let t=m().$implicit;c(),M(" \u{1F525} ",t.totalMatches," ")}}function YL(i,e){if(i&1&&(r(0,"span",49),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t.text," ")}}function XL(i,e){if(i&1&&(r(0,"span",50),l(1),s()),i&2){let t=m().$implicit;c(),M(" +",t.keywords.length-3," ")}}function ZL(i,e){if(i&1){let t=I();r(0,"div",42),x("click",function(){let o=_(t).$implicit,a=m();return v(a.selectSet(o))}),r(1,"div",43),l(2),s(),r(3,"div",44)(4,"div",45)(5,"span",46),l(6),s(),y(7,QL,2,1,"span",47),s(),r(8,"div",48),O(9,YL,2,1,"span",49,Yc),y(11,XL,2,1,"span",50),s()(),r(12,"div",51)(13,"label",52),x("click",function(o){return _(t),v(o.stopPropagation())}),r(14,"input",53),x("change",function(){let o=_(t).$implicit,a=m();return v(a.toggleSetActive(o))}),s(),r(15,"div",54),B(16,"div",55),s()(),ne(),r(17,"svg",56),B(18,"path",57),s()()()}if(i&2){let t,n,o=e.$implicit,a=m();N("border-cyan-500/50",((t=a.selectedSet())==null?null:t.id)===o.id)("bg-slate-700",((n=a.selectedSet())==null?null:n.id)===o.id),c(),N("bg-orange-500/20",o.isActive)("text-orange-400",o.isActive)("bg-slate-600",!o.isActive)("text-slate-500",!o.isActive),c(),M(" ",o.name.substring(0,3)," "),c(4),D(o.name),c(),S(o.totalMatches&&o.totalMatches>0?7:-1),c(2),U(o.keywords.slice(0,3)),c(2),S(o.keywords.length>3?11:-1),c(3),L("checked",o.isActive),c(),N("bg-emerald-500",o.isActive)("bg-slate-600",!o.isActive),c(),N("left-4",o.isActive)("left-0",!o.isActive)}}function eO(i,e){i&1&&B(0,"span",62)}function tO(i,e){if(i&1){let t=I();r(0,"button",83),x("click",function(){_(t);let o=m(2);return v(o.clearAllKeywords())}),l(1," \u6E05\u7A7A\u5168\u90E8 "),s()}}function nO(i,e){i&1&&(r(0,"div",77)(1,"p"),l(2,"\u9084\u6C92\u6709\u95DC\u9375\u8A5E"),s()())}function iO(i,e){i&1&&(r(0,"span",87),l(1,"\u65B0"),s())}function oO(i,e){if(i&1){let t=I();r(0,"div",84)(1,"div",85)(2,"span",86),l(3),s(),y(4,iO,2,0,"span",87),s(),r(5,"button",88),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.removeKeyword(o))}),l(6," \u2715 "),s()()}if(i&2){let t=e.$implicit;c(3),D(t.text),c(),S(t.isNew?4:-1)}}function rO(i,e){if(i&1&&(r(0,"div",78),O(1,oO,7,2,"div",84,Yc),s()),i&2){let t=m(2);c(),U(t.editingSet.keywords)}}function sO(i,e){i&1&&(B(0,"span",89),r(1,"span"),l(2,"\u4FDD\u5B58\u4E2D..."),s())}function aO(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=m(2);c(),D(t.isCreating()?"\u5275\u5EFA":"\u4FDD\u5B58")}}function lO(i,e){if(i&1){let t=I();r(0,"button",90),x("click",function(){_(t);let o=m(2);return v(o.deleteSet())}),l(1," \u522A\u9664 "),s()}if(i&2){let t=m(2);L("disabled",t.isSaving())}}function cO(i,e){if(i&1){let t=I();r(0,"div",58),x("click",function(){_(t);let o=m();return v(o.closeEditor())}),r(1,"div",59),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",60)(3,"h3",61),l(4),y(5,eO,1,0,"span",62),s(),r(6,"button",63),x("click",function(){_(t);let o=m();return v(o.closeEditor())}),l(7," \u2715 "),s()(),r(8,"div",64)(9,"div")(10,"label",65),l(11,"\u8A5E\u96C6\u540D\u7A31"),s(),r(12,"input",66),W("ngModelChange",function(o){_(t);let a=m();return q(a.editingSet.name,o)||(a.editingSet.name=o),v(o)}),x("ngModelChange",function(){_(t);let o=m();return v(o.markAsChanged())}),s()(),r(13,"div")(14,"label",65),l(15,"\u5339\u914D\u6A21\u5F0F"),s(),r(16,"select",67),W("ngModelChange",function(o){_(t);let a=m();return q(a.editingSet.matchMode,o)||(a.editingSet.matchMode=o),v(o)}),x("ngModelChange",function(){_(t);let o=m();return v(o.markAsChanged())}),r(17,"option",68),l(18,"\u6A21\u7CCA\u5339\u914D"),s(),r(19,"option",69),l(20,"\u7CBE\u78BA\u5339\u914D"),s(),r(21,"option",70),l(22,"\u6B63\u5247\u8868\u9054\u5F0F"),s()()(),r(23,"div")(24,"label",65),l(25,"\u6DFB\u52A0\u95DC\u9375\u8A5E"),s(),r(26,"div",71)(27,"input",72),W("ngModelChange",function(o){_(t);let a=m();return q(a.newKeyword,o)||(a.newKeyword=o),v(o)}),x("keyup.enter",function(){_(t);let o=m();return v(o.addKeyword())}),s(),r(28,"button",73),x("click",function(){_(t);let o=m();return v(o.addKeyword())}),l(29," + \u6DFB\u52A0 "),s()()(),r(30,"div")(31,"div",74)(32,"span",75),l(33),s(),y(34,tO,2,0,"button",76),s(),y(35,nO,3,0,"div",77)(36,rO,3,0,"div",78),s()(),r(37,"div",79)(38,"button",80),x("click",function(){_(t);let o=m();return v(o.saveSet())}),y(39,sO,3,0)(40,aO,2,1,"span"),s(),y(41,lO,2,1,"button",81),r(42,"button",82),x("click",function(){_(t);let o=m();return v(o.closeEditor())}),l(43," \u53D6\u6D88 "),s()()()()}if(i&2){let t=m();c(4),M(" ",t.isCreating()?"\u65B0\u5EFA\u95DC\u9375\u8A5E\u96C6":"\u7DE8\u8F2F\u95DC\u9375\u8A5E\u96C6"," "),c(),S(t.hasUnsavedChanges()?5:-1),c(7),H("ngModel",t.editingSet.name),c(4),H("ngModel",t.editingSet.matchMode),c(11),H("ngModel",t.newKeyword),c(),L("disabled",!t.newKeyword.trim()),c(5),M(" \u95DC\u9375\u8A5E\u5217\u8868 (",t.editingSet.keywords.length,") "),c(),S(t.editingSet.keywords.length>0?34:-1),c(),S(t.editingSet.keywords.length===0?35:36),c(3),L("disabled",t.isSaving()),c(),S(t.isSaving()?39:40),c(2),S(t.isCreating()?-1:41),c(),L("disabled",t.isSaving())}}var Qc=class i{constructor(){this.stateService=F(Ct);this.ipcService=F(Q);this.toastService=F(J);this.confirmDialog=F(zt);this.configAction=ge();this.selectedSet=f(null);this.isEditing=f(!1);this.isCreating=f(!1);this.isSaving=f(!1);this.hasUnsavedChanges=f(!1);this.editingSet=this.createEmptySet();this.originalSet=null;this.newKeyword="";this.listeners=[]}ngOnInit(){this.stateService.loadAll(),this.setupListeners()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupListeners(){let e=this.ipcService.on("save-keyword-set-result",n=>{this.isSaving.set(!1),n.success?(this.toastService.success(this.isCreating()?"\u2705 \u8A5E\u96C6\u5275\u5EFA\u6210\u529F":"\u2705 \u8A5E\u96C6\u4FDD\u5B58\u6210\u529F"),this.hasUnsavedChanges.set(!1),this.stateService.refresh(),this.isEditing.set(!1),this.newKeyword=""):this.toastService.error(`\u274C \u4FDD\u5B58\u5931\u6557: ${n.error||"\u672A\u77E5\u932F\u8AA4"}`)});this.listeners.push(e);let t=this.ipcService.on("delete-keyword-set-result",n=>{n.success?(this.toastService.success("\u{1F5D1}\uFE0F \u8A5E\u96C6\u5DF2\u522A\u9664"),this.selectedSet.set(null),this.hasUnsavedChanges.set(!1),this.stateService.refresh(),this.isEditing.set(!1),this.newKeyword=""):this.toastService.error(`\u274C \u522A\u9664\u5931\u6557: ${n.error||"\u672A\u77E5\u932F\u8AA4"}`)});this.listeners.push(t)}refreshData(){this.stateService.refresh(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u95DC\u9375\u8A5E\u96C6...")}handleConfigAction(e){this.configAction.emit(e)}createEmptySet(){return{id:"",name:"",keywords:[],matchMode:"fuzzy",isActive:!0,totalMatches:0}}selectSet(e){this.selectedSet.set(e),this.editingSet=P(E({},e),{keywords:[...e.keywords]}),this.originalSet=JSON.parse(JSON.stringify(e)),this.isCreating.set(!1),this.isEditing.set(!0),this.hasUnsavedChanges.set(!1)}createNewSet(){this.selectedSet.set(null),this.editingSet=this.createEmptySet(),this.originalSet=null,this.isCreating.set(!0),this.isEditing.set(!0),this.hasUnsavedChanges.set(!1)}async closeEditor(){this.hasUnsavedChanges()&&!await this.confirmDialog.warning("\u672A\u4FDD\u5B58\u7684\u8B8A\u66F4","\u60A8\u6709\u672A\u4FDD\u5B58\u7684\u8B8A\u66F4\uFF0C\u78BA\u5B9A\u8981\u95DC\u9589\u55CE\uFF1F")||(this.isEditing.set(!1),this.newKeyword="",this.hasUnsavedChanges.set(!1))}markAsChanged(){this.hasUnsavedChanges.set(!0)}toggleSetActive(e){let t=!e.isActive;this.ipcService.send("save-keyword-set",{id:parseInt(e.id),name:e.name,keywords:e.keywords.map(n=>({text:n.text})),isActive:t,matchMode:e.matchMode}),this.toastService.success(t?`\u2705 \u5DF2\u555F\u7528 ${e.name}`:`\u23F8\uFE0F \u5DF2\u505C\u7528 ${e.name}`)}addKeyword(){let e=this.newKeyword.trim();if(e){if(this.editingSet.keywords.some(t=>t.text===e)){this.toastService.error("\u95DC\u9375\u8A5E\u5DF2\u5B58\u5728");return}this.editingSet.keywords=[...this.editingSet.keywords,{id:`new-${Date.now()}`,text:e,matchCount:0,isNew:!0}],this.newKeyword="",this.markAsChanged()}}removeKeyword(e){this.editingSet.keywords=this.editingSet.keywords.filter(t=>t.id!==e.id),this.markAsChanged()}async clearAllKeywords(){await this.confirmDialog.warning("\u6E05\u7A7A\u95DC\u9375\u8A5E","\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u95DC\u9375\u8A5E\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002")&&(this.editingSet.keywords=[],this.markAsChanged())}saveSet(){if(console.log("[KeywordSets] saveSet called, isCreating:",this.isCreating()),console.log("[KeywordSets] editingSet:",this.editingSet),!this.editingSet.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u8A5E\u96C6\u540D\u7A31");return}if(this.isSaving())return;let e={id:this.isCreating()?null:parseInt(this.editingSet.id),name:this.editingSet.name.trim(),keywords:this.editingSet.keywords.map(t=>({text:t.text})),isActive:this.editingSet.isActive,matchMode:this.editingSet.matchMode};console.log("[KeywordSets] Sending save-keyword-set:",e),this.isSaving.set(!0),this.ipcService.send("save-keyword-set",e),this.toastService.info("\u23F3 \u6B63\u5728\u4FDD\u5B58...")}async deleteSet(){if(!this.selectedSet())return;let e=this.selectedSet();await this.confirmDialog.danger("\u522A\u9664\u95DC\u9375\u8A5E\u96C6",`\u78BA\u5B9A\u8981\u522A\u9664\u8A5E\u96C6\u300C${e.name}\u300D\u55CE\uFF1F
\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,[`${e.name} (${e.keywords.length} \u500B\u95DC\u9375\u8A5E)`])&&this.ipcService.send("delete-keyword-set",{id:parseInt(e.id)})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-keyword-sets"]],outputs:{configAction:"configAction"},decls:82,vars:10,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-purple-500","to-pink-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-purple-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-purple-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-cyan-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-cyan-400"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"w-10","h-10","bg-orange-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-orange-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"flex-1","overflow-hidden"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","h-full","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"px-2","py-0.5","bg-red-500/20","text-red-400","text-xs","rounded-full"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"px-4","pt-3","pb-2","border-b","border-slate-700/30"],[1,"flex-1","overflow-y-auto","p-4"],[1,"grid","grid-cols-1","md:grid-cols-2","xl:grid-cols-3","gap-4"],[1,"flex","items-start","gap-3","p-4","bg-slate-700/50","rounded-xl","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"border-cyan-500/50","bg-slate-700"],[1,"flex","items-center","justify-center","gap-2","p-6","bg-slate-700/30","hover:bg-slate-700/50","border-2","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","transition-all","min-h-[100px]",3,"click"],[1,"fixed","inset-0","bg-black/50","z-50","flex","justify-end"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-xs","text-slate-400"],[1,"flex","flex-wrap","gap-2"],["draggable","true",1,"px-3","py-1.5","rounded-lg","text-sm","cursor-grab","active:cursor-grabbing","transition-all","flex","items-center","gap-2",2,"border-width","1px",3,"bg-purple-500/20","text-purple-400","border-purple-500/30","bg-slate-700/50","text-slate-400","border-slate-600/30"],["draggable","true",1,"px-3","py-1.5","rounded-lg","text-sm","cursor-grab","active:cursor-grabbing","transition-all","flex","items-center","gap-2",2,"border-width","1px"],[1,"text-xs","opacity-70"],[1,"flex","items-start","gap-3","p-4","bg-slate-700/50","rounded-xl","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"click"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center","font-bold","shrink-0"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-1"],[1,"font-medium","text-white","truncate"],[1,"px-1.5","py-0.5","bg-red-500/20","text-red-400","text-xs","rounded-full","shrink-0"],[1,"flex","flex-wrap","gap-1"],[1,"px-1.5","py-0.5","bg-slate-600","text-slate-300","text-xs","rounded"],[1,"px-1.5","py-0.5","bg-slate-600/50","text-slate-400","text-xs","rounded"],[1,"flex","items-center","gap-2","shrink-0"],[1,"relative","inline-flex","cursor-pointer",3,"click"],["type","checkbox",1,"sr-only",3,"change","checked"],[1,"w-9","h-5","rounded-full","transition-all"],[1,"absolute","w-4","h-4","bg-white","rounded-full","top-0.5","transition-all"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500","group-hover:text-cyan-400","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"fixed","inset-0","bg-black/50","z-50","flex","justify-end",3,"click"],[1,"w-[500px]","bg-slate-900","h-full","flex","flex-col",3,"click"],[1,"p-4","border-b","border-slate-700","flex","items-center","justify-between"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],["title","\u6709\u672A\u4FDD\u5B58\u7684\u8B8A\u66F4",1,"w-2","h-2","bg-orange-500","rounded-full"],[1,"p-2","hover:bg-slate-700","rounded-lg","text-slate-400",3,"click"],[1,"flex-1","overflow-y-auto","p-4","space-y-4"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u652F\u4ED8\u76F8\u95DC",1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:border-purple-500",3,"ngModelChange","ngModel"],["value","fuzzy"],["value","exact"],["value","regex"],[1,"flex","gap-2"],["type","text","placeholder","\u8F38\u5165\u95DC\u9375\u8A5E\uFF0C\u6309 Enter \u6DFB\u52A0",1,"flex-1","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","focus:border-purple-500",3,"ngModelChange","keyup.enter","ngModel"],[1,"px-4","py-2.5","bg-purple-500/20","hover:bg-purple-500/30","text-purple-400","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-slate-300"],[1,"text-xs","text-red-400","hover:underline"],[1,"p-6","text-center","text-slate-500","bg-slate-800/30","rounded-xl","border","border-dashed","border-slate-700"],[1,"space-y-2","max-h-64","overflow-y-auto"],[1,"p-4","border-t","border-slate-700","flex","items-center","gap-3"],[1,"flex-1","px-4","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","hover:from-purple-600","hover:to-pink-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"px-4","py-2.5","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors","disabled:opacity-50",3,"disabled"],[1,"px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-xs","text-red-400","hover:underline",3,"click"],[1,"flex","items-center","justify-between","p-3","bg-slate-800/50","rounded-lg","border","border-slate-700/50","group","hover:border-purple-500/30"],[1,"flex","items-center","gap-2"],[1,"text-white"],[1,"text-xs","bg-emerald-500/20","text-emerald-400","px-2","py-0.5","rounded"],[1,"opacity-0","group-hover:opacity-100","p-1","hover:bg-red-500/20","rounded","text-red-400","transition-all",3,"click"],[1,"w-4","h-4","border-2","border-white/30","border-t-white","rounded-full","animate-spin"],[1,"px-4","py-2.5","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F511}"),s()(),r(6,"div")(7,"h1",5),l(8,"\u95DC\u9375\u8A5E\u96C6\u7BA1\u7406"),s(),r(9,"p",6),l(10,"\u7BA1\u7406\u7528\u65BC\u76E3\u63A7\u5339\u914D\u7684\u95DC\u9375\u8A5E\u96C6"),s()()(),r(11,"div",2)(12,"app-config-progress",7),x("action",function(a){return n.handleConfigAction(a)}),s(),r(13,"button",8),x("click",function(){return n.refreshData()}),r(14,"span"),l(15,"\u{1F504}"),s(),r(16,"span"),l(17,"\u5237\u65B0"),s()()()(),r(18,"div",9)(19,"div",10)(20,"div",2)(21,"div",11)(22,"span",12),l(23,"\u{1F511}"),s()(),r(24,"div")(25,"div",13),l(26),s(),r(27,"div",14),l(28,"\u8A5E\u96C6\u6578"),s()()()(),r(29,"div",10)(30,"div",2)(31,"div",15)(32,"span",16),l(33,"\u{1F524}"),s()(),r(34,"div")(35,"div",17),l(36),s(),r(37,"div",14),l(38,"\u7E3D\u95DC\u9375\u8A5E"),s()()()(),r(39,"div",10)(40,"div",2)(41,"div",18)(42,"span",19),l(43,"\u{1F525}"),s()(),r(44,"div")(45,"div",20),l(46),s(),r(47,"div",14),l(48,"\u7E3D\u5339\u914D"),s()()()(),r(49,"div",10)(50,"div",2)(51,"div",21)(52,"span",22),l(53,"\u2713"),s()(),r(54,"div")(55,"div",23),l(56),s(),r(57,"div",14),l(58,"\u5DF2\u555F\u7528"),s()()()()(),r(59,"div",24)(60,"div",25)(61,"div",26)(62,"h3",27)(63,"span"),l(64,"\u{1F511}"),s(),l(65," \u95DC\u9375\u8A5E\u96C6 "),r(66,"span",14),l(67),s(),y(68,KL,2,1,"span",28),s(),r(69,"button",29),x("click",function(){return n.createNewSet()}),l(70," + \u65B0\u5EFA\u8A5E\u96C6 "),s()(),y(71,JL,9,0,"div",30),r(72,"div",31)(73,"div",32),O(74,ZL,19,25,"div",33,Yc),r(76,"button",34),x("click",function(){return n.createNewSet()}),r(77,"span",4),l(78,"+"),s(),r(79,"span"),l(80,"\u65B0\u5EFA\u8A5E\u96C6"),s()()()()()(),y(81,cO,44,13,"div",35),s()),t&2&&(c(14),N("animate-spin",n.stateService.isLoading()),c(12),D(n.stateService.keywordSets().length),c(10),D(n.stateService.totalKeywords()),c(10),D(n.stateService.totalKeywordMatches()),c(10),D(n.stateService.activeKeywordSets().length),c(11),M("(",n.stateService.keywordSets().length,")"),c(),S(n.stateService.totalKeywordMatches()>0?68:-1),c(3),S(n.stateService.keywordSets().length>0?71:-1),c(3),U(n.stateService.keywordSets()),c(7),S(n.isEditing()?81:-1))},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he,vn],encapsulation:2})}};var dO=()=>[1,2,3,4],Zc=(i,e)=>e.id;function uO(i,e){if(i&1&&(r(0,"div",25)(1,"div",39)(2,"span",4),l(3,"\u{1F916}"),s(),r(4,"div",40)(5,"p",41),l(6),s(),r(7,"p",42),l(8," \u672A\u5339\u914D\u7279\u5B9A\u898F\u5247\u7684\u95DC\u9375\u8A5E\u5C07\u4F7F\u7528 AI \u81EA\u52D5\u56DE\u8986\u3002 \u5982\u9700\u91DD\u5C0D\u7279\u5B9A\u95DC\u9375\u8A5E\u4F7F\u7528\u4E0D\u540C\u97FF\u61C9\u65B9\u5F0F\uFF0C\u8ACB\u5275\u5EFA\u89F8\u767C\u898F\u5247\u3002 "),s()()()()),i&2){let t=m();c(6),M("AI \u81EA\u52D5\u804A\u5929\u5DF2\u555F\u7528\uFF08",t.aiChatMode()==="full"?"\u5168\u81EA\u52D5":"\u534A\u81EA\u52D5","\u6A21\u5F0F\uFF09")}}function mO(i,e){i&1&&(r(0,"span",49),l(1,"\u6D3B\u8E8D"),s())}function pO(i,e){i&1&&(r(0,"span",50),l(1,"\u5DF2\u505C\u7528"),s())}function gO(i,e){if(i&1){let t=I();r(0,"div",44)(1,"div",45)(2,"div",2)(3,"div",46)(4,"span",47),l(5),s()(),r(6,"div")(7,"div",30)(8,"span",48),l(9),s(),y(10,mO,2,0,"span",49)(11,pO,2,0,"span",50),r(12,"span",51),l(13),s()(),r(14,"p",52),l(15),s()()(),r(16,"div",30)(17,"button",53),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.openTestDialog(o))}),l(18," \u{1F9EA} \u6E2C\u8A66 "),s(),r(19,"button",54),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.editRule(o))}),l(20," \u7DE8\u8F2F "),s(),r(21,"button",55),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleRule(o))}),l(22),s(),r(23,"button",56),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteRule(o))}),l(24," \u522A\u9664 "),s()()(),r(25,"div",57)(26,"div",58)(27,"div",59)(28,"div",60),l(29,"\u76E3\u63A7\u4F86\u6E90"),s(),r(30,"div",61),l(31),s()(),r(32,"div",62),l(33,"\u2192"),s(),r(34,"div",59)(35,"div",60),l(36,"\u95DC\u9375\u8A5E\u96C6"),s(),r(37,"div",61),l(38),s()(),r(39,"div",62),l(40,"\u2192"),s(),r(41,"div",59)(42,"div",60),l(43,"\u97FF\u61C9\u65B9\u5F0F"),s(),r(44,"div",61),l(45),s()()(),r(46,"div",63)(47,"div",64)(48,"span"),l(49),s(),r(50,"span"),l(51),s(),r(52,"span"),l(53),s()(),r(54,"span"),l(55),s()()()()}if(i&2){let t=e.$implicit,n=m(2);N("border-slate-600/50",t.isActive)("border-slate-700/50",!t.isActive)("opacity-60",!t.isActive),c(3),N("bg-emerald-500/20",t.isActive)("bg-slate-600/50",!t.isActive),c(2),D(n.getResponseIcon(t.responseType)),c(4),D(t.name),c(),S(t.isActive?10:11),c(2),N("bg-red-500/20",t.priority===3)("text-red-400",t.priority===3)("bg-amber-500/20",t.priority===2)("text-amber-400",t.priority===2)("bg-slate-500/20",t.priority===1)("text-slate-400",t.priority===1),c(),M(" ",n.getPriorityLabel(t.priority)," "),c(2),D(t.description||"\u7121\u63CF\u8FF0"),c(6),N("bg-amber-500/20",t.isActive)("text-amber-400",t.isActive)("hover:bg-amber-500/30",t.isActive)("bg-emerald-500/20",!t.isActive)("text-emerald-400",!t.isActive)("hover:bg-emerald-500/30",!t.isActive),c(),M(" ",t.isActive?"\u66AB\u505C":"\u555F\u7528"," "),c(9),M(" ",t.sourceType==="all"?"\u5168\u90E8\u7FA4\u7D44":t.sourceGroupIds.length+" \u500B\u7FA4\u7D44"," "),c(7),M(" ",n.getKeywordSetNames(t.keywordSetIds)," "),c(7),M(" ",n.getResponseDetail(t)," "),c(4),M("\u89F8\u767C: ",t.triggerCount||0," \u6B21"),c(2),M("\u6210\u529F: ",t.successCount||0," \u6B21"),c(2),M("\u6210\u529F\u7387: ",n.getSuccessRate(t),"%"),c(2),D(t.lastTriggered?"\u6700\u8FD1: "+n.formatTime(t.lastTriggered):"\u5C1A\u672A\u89F8\u767C")}}function hO(i,e){if(i&1&&(r(0,"div",36),O(1,gO,56,47,"div",43,Zc),s()),i&2){let t=m();c(),U(t.filteredRules())}}function fO(i,e){i&1&&(r(0,"p",69),l(1," \u{1F4A1} AI \u81EA\u52D5\u804A\u5929\u5DF2\u958B\u555F\uFF0C\u5C07\u4F5C\u70BA\u9ED8\u8A8D\u97FF\u61C9\u65B9\u5F0F "),s())}function _O(i,e){if(i&1){let t=I();r(0,"div",37)(1,"div",65)(2,"span",66),l(3,"\u26A1"),s()(),r(4,"h3",67),l(5,"\u9084\u6C92\u6709\u89F8\u767C\u898F\u5247"),s(),r(6,"p",68),l(7," \u89F8\u767C\u898F\u5247\u5B9A\u7FA9\u4E86\u7576\u95DC\u9375\u8A5E\u5339\u914D\u5F8C\u7CFB\u7D71\u7684\u97FF\u61C9\u65B9\u5F0F\u3002"),B(8,"br"),l(9," \u60A8\u53EF\u4EE5\u70BA\u4E0D\u540C\u7684\u95DC\u9375\u8A5E\u8A2D\u7F6E\u4E0D\u540C\u7684\u97FF\u61C9\u52D5\u4F5C\u3002 "),s(),y(10,fO,2,0,"p",69),r(11,"button",70),x("click",function(){_(t);let o=m();return v(o.openCreateWizard())}),r(12,"span"),l(13,"\u{1F680}"),s(),l(14," \u5275\u5EFA\u7B2C\u4E00\u500B\u898F\u5247 "),s()()}if(i&2){let t=m();c(10),S(t.aiChatEnabled()?10:-1)}}function vO(i,e){if(i&1&&B(0,"div",91),i&2){let t=m().$implicit,n=m(2);N("bg-amber-500",n.wizardStep()>t)("bg-slate-700",n.wizardStep()<=t)}}function xO(i,e){if(i&1&&(r(0,"div",81)(1,"div",89),l(2),s(),y(3,vO,1,4,"div",90),s()),i&2){let t=e.$implicit,n=m(2);c(),N("bg-amber-500",n.wizardStep()>=t)("text-white",n.wizardStep()>=t)("bg-slate-700",n.wizardStep()<t)("text-slate-400",n.wizardStep()<t),c(),M(" ",t," "),c(),S(t<4?3:-1)}}function CO(i,e){if(i&1){let t=I();r(0,"div",36)(1,"div")(2,"label",92),l(3,"\u898F\u5247\u540D\u7A31 *"),s(),r(4,"input",93),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.name,o)||(a.formData.name=o),v(o)}),s()(),r(5,"div")(6,"label",92),l(7,"\u898F\u5247\u63CF\u8FF0"),s(),r(8,"textarea",94),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.description,o)||(a.formData.description=o),v(o)}),s()(),r(9,"div")(10,"label",92),l(11,"\u512A\u5148\u7D1A"),s(),r(12,"div",85)(13,"button",95),x("click",function(){_(t);let o=m(2);return v(o.formData.priority=3)}),l(14," \u9AD8\u512A\u5148 "),s(),r(15,"button",95),x("click",function(){_(t);let o=m(2);return v(o.formData.priority=2)}),l(16," \u4E2D\u512A\u5148 "),s(),r(17,"button",95),x("click",function(){_(t);let o=m(2);return v(o.formData.priority=1)}),l(18," \u4F4E\u512A\u5148 "),s()()()()}if(i&2){let t=m(2);c(4),H("ngModel",t.formData.name),c(4),H("ngModel",t.formData.description),c(5),N("bg-red-500/20",t.formData.priority===3)("border-red-500/50",t.formData.priority===3)("text-red-400",t.formData.priority===3)("bg-slate-700",t.formData.priority!==3)("border-slate-600",t.formData.priority!==3)("text-slate-300",t.formData.priority!==3),c(2),N("bg-amber-500/20",t.formData.priority===2)("border-amber-500/50",t.formData.priority===2)("text-amber-400",t.formData.priority===2)("bg-slate-700",t.formData.priority!==2)("border-slate-600",t.formData.priority!==2)("text-slate-300",t.formData.priority!==2),c(2),N("bg-slate-500/20",t.formData.priority===1)("border-slate-500/50",t.formData.priority===1)("text-slate-400",t.formData.priority===1)("bg-slate-700",t.formData.priority!==1)("border-slate-600",t.formData.priority!==1)("text-slate-300",t.formData.priority!==1)}}function bO(i,e){if(i&1){let t=I();r(0,"label",103)(1,"input",107),x("change",function(){let o=_(t).$implicit,a=m(4);return v(a.toggleGroupSelection(o.id))}),s(),r(2,"span",106),l(3),s()()}if(i&2){let t=e.$implicit,n=m(4);c(),L("checked",n.isGroupSelected(t.id)),c(2),D(t.name)}}function yO(i,e){if(i&1&&(r(0,"div",101),O(1,bO,4,2,"label",103,Zc),s()),i&2){let t=m(3);c(),U(t.stateService.groups())}}function SO(i,e){if(i&1){let t=I();r(0,"label",103)(1,"input",107),x("change",function(){let o=_(t).$implicit,a=m(3);return v(a.toggleKeywordSetSelection(o.id))}),s(),r(2,"span",106),l(3),s(),r(4,"span",108),l(5),s()()}if(i&2){let t=e.$implicit,n=m(3);c(),L("checked",n.isKeywordSetSelected(t.id)),c(2),D(t.name),c(2),M("(",(t.keywords==null?null:t.keywords.length)||0," \u500B\u95DC\u9375\u8A5E)")}}function wO(i,e){i&1&&(r(0,"p",104),l(1," \u66AB\u7121\u95DC\u9375\u8A5E\u96C6\uFF0C\u8ACB\u5148\u5275\u5EFA "),s())}function EO(i,e){if(i&1){let t=I();r(0,"div",36)(1,"div")(2,"label",92),l(3,"\u76E3\u63A7\u4F86\u6E90"),s(),r(4,"div",96)(5,"label",97)(6,"input",98),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.sourceType,o)||(a.formData.sourceType=o),v(o)}),s(),r(7,"span",99),l(8),s()(),r(9,"label",97)(10,"input",100),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.sourceType,o)||(a.formData.sourceType=o),v(o)}),s(),r(11,"span",99),l(12,"\u6307\u5B9A\u7FA4\u7D44"),s()()(),y(13,yO,3,0,"div",101),s(),r(14,"div")(15,"label",92),l(16,"\u95DC\u9375\u8A5E\u96C6 *"),s(),r(17,"div",102),O(18,SO,6,3,"label",103,Zc),y(20,wO,2,0,"p",104),s()(),r(21,"div")(22,"label",92),l(23,"\u9644\u52A0\u689D\u4EF6"),s(),r(24,"div",96)(25,"label",97)(26,"input",105),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.conditions.oncePerUser,o)||(a.formData.conditions.oncePerUser=o),v(o)}),s(),r(27,"span",106),l(28,"\u6BCF\u7528\u6236\u53EA\u89F8\u767C\u4E00\u6B21"),s()(),r(29,"label",97)(30,"input",105),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.conditions.excludeAdmin,o)||(a.formData.conditions.excludeAdmin=o),v(o)}),s(),r(31,"span",106),l(32,"\u6392\u9664\u7FA4\u7BA1\u7406\u54E1"),s()()()()()}if(i&2){let t=m(2);c(6),H("ngModel",t.formData.sourceType),c(2),M("\u5168\u90E8\u76E3\u63A7\u7FA4\u7D44\uFF08",t.stateService.groups().length," \u500B\uFF09"),c(2),H("ngModel",t.formData.sourceType),c(3),S(t.formData.sourceType==="specific"?13:-1),c(5),U(t.stateService.keywordSets()),c(2),S(t.stateService.keywordSets().length===0?20:-1),c(6),H("ngModel",t.formData.conditions.oncePerUser),c(4),H("ngModel",t.formData.conditions.excludeAdmin)}}function DO(i,e){if(i&1){let t=I();r(0,"div",111)(1,"button",113),x("click",function(o){_(t);let a=m(3);return a.formData.responseConfig.aiMode="full",v(o.stopPropagation())}),l(2," \u5168\u81EA\u52D5 "),s(),r(3,"button",113),x("click",function(o){_(t);let a=m(3);return a.formData.responseConfig.aiMode="semi",v(o.stopPropagation())}),l(4," \u534A\u81EA\u52D5\uFF08\u9700\u78BA\u8A8D\uFF09 "),s()()}if(i&2){let t=m(3);c(),N("bg-emerald-500/20",t.formData.responseConfig.aiMode==="full")("text-emerald-400",t.formData.responseConfig.aiMode==="full")("bg-slate-600",t.formData.responseConfig.aiMode!=="full")("text-slate-300",t.formData.responseConfig.aiMode!=="full"),c(2),N("bg-amber-500/20",t.formData.responseConfig.aiMode==="semi")("text-amber-400",t.formData.responseConfig.aiMode==="semi")("bg-slate-600",t.formData.responseConfig.aiMode!=="semi")("text-slate-300",t.formData.responseConfig.aiMode!=="semi")}}function AO(i,e){if(i&1&&(r(0,"option",115),l(1),s()),i&2){let t=e.$implicit;L("ngValue",t.id),c(),D(t.name)}}function MO(i,e){if(i&1){let t=I();r(0,"div",112)(1,"select",114),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.formData.responseConfig.templateId,o)||(a.formData.responseConfig.templateId=o),v(o)}),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"option",115),l(3,"\u9078\u64C7\u6A21\u677F..."),s(),O(4,AO,2,2,"option",115,Zc),s()()}if(i&2){let t=m(3);c(),H("ngModel",t.formData.responseConfig.templateId),c(),L("ngValue",void 0),c(2),U(t.stateService.chatTemplates())}}function TO(i,e){if(i&1){let t=I();r(0,"div",36)(1,"label",92),l(2,"\u97FF\u61C9\u65B9\u5F0F *"),s(),r(3,"div",109)(4,"div",110),x("click",function(){_(t);let o=m(2);return v(o.formData.responseType="ai_chat")}),r(5,"div",39)(6,"span",4),l(7,"\u{1F916}"),s(),r(8,"div",40)(9,"div",48),l(10,"AI \u667A\u80FD\u5C0D\u8A71"),s(),r(11,"p",75),l(12,"\u8B93 AI \u6839\u64DA\u4E0A\u4E0B\u6587\u667A\u80FD\u56DE\u8986\uFF0C\u66F4\u81EA\u7136\u66F4\u500B\u6027\u5316"),s(),y(13,DO,5,16,"div",111),s()()(),r(14,"div",110),x("click",function(){_(t);let o=m(2);return v(o.formData.responseType="template")}),r(15,"div",39)(16,"span",4),l(17,"\u{1F4DD}"),s(),r(18,"div",40)(19,"div",48),l(20,"\u4F7F\u7528\u56FA\u5B9A\u6A21\u677F"),s(),r(21,"p",75),l(22,"\u767C\u9001\u9810\u8A2D\u7684\u804A\u5929\u6A21\u677F\uFF0C\u6548\u679C\u7A69\u5B9A\u53EF\u63A7"),s(),y(23,MO,6,2,"div",112),s()()(),r(24,"div",110),x("click",function(){_(t);let o=m(2);return v(o.formData.responseType="record_only")}),r(25,"div",39)(26,"span",4),l(27,"\u{1F4CB}"),s(),r(28,"div",40)(29,"div",48),l(30,"\u50C5\u8A18\u9304"),s(),r(31,"p",75),l(32,"\u53EA\u5C07\u7528\u6236\u52A0\u5165 Lead \u5EAB\uFF0C\u4E0D\u81EA\u52D5\u767C\u9001\u4EFB\u4F55\u6D88\u606F"),s()()()()()()}if(i&2){let t=m(2);c(4),N("bg-amber-500/10",t.formData.responseType==="ai_chat")("border-amber-500/50",t.formData.responseType==="ai_chat")("bg-slate-700",t.formData.responseType!=="ai_chat")("border-slate-600",t.formData.responseType!=="ai_chat"),c(9),S(t.formData.responseType==="ai_chat"?13:-1),c(),N("bg-amber-500/10",t.formData.responseType==="template")("border-amber-500/50",t.formData.responseType==="template")("bg-slate-700",t.formData.responseType!=="template")("border-slate-600",t.formData.responseType!=="template"),c(9),S(t.formData.responseType==="template"?23:-1),c(),N("bg-amber-500/10",t.formData.responseType==="record_only")("border-amber-500/50",t.formData.responseType==="record_only")("bg-slate-700",t.formData.responseType!=="record_only")("border-slate-600",t.formData.responseType!=="record_only")}}function kO(i,e){if(i&1){let t=I();r(0,"div")(1,"h4",117),l(2,"\u2699\uFE0F \u767C\u9001\u8A2D\u7F6E"),s(),r(3,"div",109)(4,"div")(5,"label",121),l(6,"\u767C\u9001\u5EF6\u9072\uFF08\u79D2\uFF09"),s(),r(7,"div",2)(8,"input",122),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.formData.delayMin,o)||(a.formData.delayMin=o),v(o)}),s(),r(9,"span",123),l(10,"-"),s(),r(11,"input",124),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.formData.delayMax,o)||(a.formData.delayMax=o),v(o)}),s(),r(12,"span",125),l(13,"\u79D2"),s()()(),r(14,"div")(15,"label",121),l(16,"\u6BCF\u5E33\u865F\u6BCF\u65E5\u9650\u5236"),s(),r(17,"input",126),W("ngModelChange",function(o){_(t);let a=m(3);return q(a.formData.dailyLimit,o)||(a.formData.dailyLimit=o),v(o)}),s(),r(18,"span",127),l(19,"\u689D\u6D88\u606F"),s()()()()}if(i&2){let t=m(3);c(8),H("ngModel",t.formData.delayMin),c(3),H("ngModel",t.formData.delayMax),c(6),H("ngModel",t.formData.dailyLimit)}}function IO(i,e){if(i&1){let t=I();r(0,"div",36)(1,"div",116)(2,"h4",117),l(3,"\u{1F4CB} \u898F\u5247\u6458\u8981"),s(),r(4,"div",118)(5,"div",119)(6,"div",15),l(7,"\u76E3\u63A7\u4F86\u6E90"),s(),r(8,"div",120),l(9),s()(),r(10,"div",62),l(11,"\u2192"),s(),r(12,"div",119)(13,"div",15),l(14,"\u95DC\u9375\u8A5E\u96C6"),s(),r(15,"div",120),l(16),s()(),r(17,"div",62),l(18,"\u2192"),s(),r(19,"div",119)(20,"div",15),l(21,"\u97FF\u61C9\u65B9\u5F0F"),s(),r(22,"div",120),l(23),s()()()(),y(24,kO,20,3,"div"),r(25,"div")(26,"h4",117),l(27,"\u{1F4CC} \u9644\u52A0\u52D5\u4F5C"),s(),r(28,"div",96)(29,"label",97)(30,"input",105),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.autoAddLead,o)||(a.formData.autoAddLead=o),v(o)}),s(),r(31,"span",106),l(32,"\u81EA\u52D5\u52A0\u5165 Lead \u5EAB"),s()(),r(33,"label",97)(34,"input",105),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.formData.notifyMe,o)||(a.formData.notifyMe=o),v(o)}),s(),r(35,"span",106),l(36,"\u767C\u9001\u901A\u77E5\u7D66\u6211"),s()()()()()}if(i&2){let t=m(2);c(9),M(" ",t.formData.sourceType==="all"?"\u5168\u90E8\u7FA4\u7D44":t.formData.sourceGroupIds.length+" \u500B\u7FA4\u7D44"," "),c(7),M("",t.formData.keywordSetIds.length," \u500B\u8A5E\u96C6"),c(7),D(t.getResponseLabel(t.formData.responseType)),c(),S(t.formData.responseType!=="record_only"?24:-1),c(6),H("ngModel",t.formData.autoAddLead),c(4),H("ngModel",t.formData.notifyMe)}}function FO(i,e){if(i&1){let t=I();r(0,"button",128),x("click",function(){_(t);let o=m(2);return v(o.nextStep())}),l(1," \u4E0B\u4E00\u6B65 \u2192 "),s()}if(i&2){let t=m(2);L("disabled",!t.canProceed())}}function PO(i,e){if(i&1){let t=I();r(0,"button",129),x("click",function(){_(t);let o=m(2);return v(o.saveRule())}),r(1,"span"),l(2,"\u{1F680}"),s(),l(3),s()}if(i&2){let t=m(2);L("disabled",!t.canSave()),c(3),M(" ",t.editingRule()?"\u4FDD\u5B58\u4FEE\u6539":"\u7ACB\u5373\u555F\u7528"," ")}}function RO(i,e){if(i&1){let t=I();r(0,"div",71),x("click",function(){_(t);let o=m();return v(o.closeWizard())}),r(1,"div",72),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",73)(3,"div")(4,"h2",74),l(5),s(),r(6,"p",75),l(7),s()(),r(8,"button",76),x("click",function(){_(t);let o=m();return v(o.closeWizard())}),ne(),r(9,"svg",77),B(10,"path",78),s()()(),ce(),r(11,"div",79)(12,"div",80),O(13,xO,4,10,"div",81,be),s()(),r(15,"div",82),y(16,CO,19,38,"div",36)(17,EO,33,7,"div",36)(18,TO,33,26,"div",36)(19,IO,37,6,"div",36),s(),r(20,"div",83)(21,"button",84),x("click",function(){_(t);let o=m();return v(o.prevStep())}),l(22," \u2190 \u4E0A\u4E00\u6B65 "),s(),r(23,"div",85)(24,"button",86),x("click",function(){_(t);let o=m();return v(o.closeWizard())}),l(25," \u53D6\u6D88 "),s(),y(26,FO,2,1,"button",87)(27,PO,4,2,"button",88),s()()()()}if(i&2){let t,n=m();c(5),D(n.editingRule()?"\u7DE8\u8F2F\u898F\u5247":"\u5275\u5EFA\u89F8\u767C\u898F\u5247"),c(2),X("Step ",n.wizardStep(),"/4: ",n.getStepTitle()),c(6),U(rt(6,dO)),c(3),S((t=n.wizardStep())===1?16:t===2?17:t===3?18:t===4?19:-1),c(5),L("disabled",n.wizardStep()===1),c(5),S(n.wizardStep()<4?26:27)}}function NO(i,e){i&1&&(r(0,"span",140)(1,"span",17),l(2,"\u2713"),s()(),r(3,"span",41),l(4,"\u95DC\u9375\u8A5E\u5339\u914D\u6210\u529F"),s())}function VO(i,e){i&1&&(r(0,"span",141)(1,"span",142),l(2,"\u2717"),s()(),r(3,"span",143),l(4,"\u672A\u5339\u914D\u4EFB\u4F55\u95DC\u9375\u8A5E"),s())}function BO(i,e){i&1&&(r(0,"span",17),l(1,"\u5168\u90E8\u6EFF\u8DB3 \u2713"),s())}function LO(i,e){i&1&&(r(0,"span",13),l(1,"\u90E8\u5206\u689D\u4EF6\u53EF\u80FD\u4E0D\u6EFF\u8DB3"),s())}function OO(i,e){if(i&1&&(r(0,"div",146)(1,"div",60),l(2,"\u97FF\u61C9\u9810\u89BD"),s(),r(3,"div",147),l(4),s()()),i&2){let t=m(4);c(4),D(t.testResult().responsePreview)}}function UO(i,e){if(i&1&&(r(0,"div",144)(1,"span",145),l(2,"\u5339\u914D\u7684\u95DC\u9375\u8A5E\uFF1A"),s(),r(3,"span",13),l(4),s()(),r(5,"div",144)(6,"span",145),l(7,"\u984D\u5916\u689D\u4EF6\uFF1A"),s(),y(8,BO,2,0,"span",17)(9,LO,2,0,"span",13),s(),y(10,OO,5,1,"div",146)),i&2){let t=m(3);c(4),D(t.testResult().matchedKeywords.join(", ")),c(4),S(t.testResult().conditionsMet?8:9),c(2),S(t.testResult().responsePreview?10:-1)}}function GO(i,e){if(i&1&&(r(0,"div",137)(1,"div",30),y(2,NO,5,0)(3,VO,5,0),s(),y(4,UO,11,3),s()),i&2){let t=m(2);c(2),S(t.testResult().matched?2:3),c(2),S(t.testResult().matched?4:-1)}}function $O(i,e){i&1&&(r(0,"span",148),l(1,"\u23F3"),s(),l(2," \u6E2C\u8A66\u4E2D... "))}function HO(i,e){i&1&&(r(0,"span"),l(1,"\u{1F680}"),s(),l(2," \u57F7\u884C\u6E2C\u8A66 "))}function qO(i,e){if(i&1){let t=I();r(0,"div",71),x("click",function(){_(t);let o=m();return v(o.closeTestDialog())}),r(1,"div",130),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",131)(3,"div",2)(4,"div",132)(5,"span",133),l(6,"\u{1F9EA}"),s()(),r(7,"div")(8,"h3",134),l(9,"\u6E2C\u8A66\u898F\u5247"),s(),r(10,"p",6),l(11),s()()()(),r(12,"div",135)(13,"div")(14,"label",92),l(15,"\u6A21\u64EC\u6D88\u606F\u5167\u5BB9"),s(),r(16,"textarea",136),W("ngModelChange",function(o){_(t);let a=m();return q(a.testMessage,o)||(a.testMessage=o),v(o)}),l(17,"              "),s()(),y(18,GO,5,2,"div",137),s(),r(19,"div",138)(20,"button",86),x("click",function(){_(t);let o=m();return v(o.closeTestDialog())}),l(21," \u95DC\u9589 "),s(),r(22,"button",139),x("click",function(){_(t);let o=m();return v(o.runTest())}),y(23,$O,3,0)(24,HO,3,0),s()()()()}if(i&2){let t,n=m();c(11),D((t=n.testingRule())==null?null:t.name),c(5),H("ngModel",n.testMessage),c(2),S(n.testResult()?18:-1),c(4),L("disabled",!n.testMessage.trim()||n.isTestingRule()),c(),S(n.isTestingRule()?23:24)}}var Xc=class i{constructor(){this.stateService=F(Ct);this.ipcService=F(Q);this.toastService=F(J);this.confirmService=F(zt);this.rules=f([]);this.isLoading=f(!1);this.filterStatus="all";this.stateEffect=gt(()=>{let e=this.stateService.triggerRules();e.length>0&&this.rules().length===0&&(console.log("[TriggerRules] Syncing from StateService:",e.length,"rules"),this.rules.set(e),this.isLoading.set(!1))});this.showWizard=f(!1);this.wizardStep=f(1);this.editingRule=f(null);this.formData=this.getEmptyFormData();this.aiChatEnabled=f(!1);this.aiChatMode=f("semi");this.showTestDialog=f(!1);this.testingRule=f(null);this.testMessage="";this.testResult=f(null);this.isTestingRule=f(!1);this.activeRules=R(()=>this.rules().filter(e=>e.isActive));this.totalTriggerCount=R(()=>this.rules().reduce((e,t)=>e+(t.triggerCount||0),0));this.averageSuccessRate=R(()=>{let e=this.rules().filter(n=>(n.triggerCount||0)>0);if(e.length===0)return 0;let t=e.reduce((n,o)=>{let a=o.triggerCount?(o.successCount||0)/o.triggerCount*100:0;return n+a},0);return Math.round(t/e.length)});this.filteredRules=R(()=>{let e=this.rules();return this.filterStatus==="active"?e.filter(t=>t.isActive):this.filterStatus==="inactive"?e.filter(t=>!t.isActive):e});this.listeners=[];this.retryCount=0;this.MAX_RETRIES=3}ngOnInit(){this.setupListeners();let e=this.stateService.triggerRules();e.length>0?(console.log("[TriggerRules] Using existing StateService data:",e.length,"rules"),this.rules.set(e)):this.stateService.loadAll(),this.loadRules(),this.loadAISettings()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupListeners(){let e=this.ipcService.on("trigger-rules-result",d=>{console.log("[TriggerRules] Received trigger-rules-result:",d),this.isLoading.set(!1),this.retryCount=0,d.success?this.rules.set(d.rules||[]):d.error&&(console.error("[TriggerRules] Error loading rules:",d.error),this.toastService.error("\u52A0\u8F09\u898F\u5247\u5931\u6557: "+d.error))});this.listeners.push(e);let t=this.ipcService.on("save-trigger-rule-result",d=>{console.log("[TriggerRules] Received save-trigger-rule-result:",d),d.success?(this.toastService.success(d.message||"\u898F\u5247\u5DF2\u4FDD\u5B58"),this.closeWizard()):this.toastService.error(d.error||"\u4FDD\u5B58\u5931\u6557")});this.listeners.push(t);let n=this.ipcService.on("delete-trigger-rule-result",d=>{d.success&&this.toastService.success("\u898F\u5247\u5DF2\u522A\u9664")});this.listeners.push(n);let o=this.ipcService.on("toggle-trigger-rule-result",d=>{d.success});this.listeners.push(o);let a=this.ipcService.on("ai-settings-loaded",d=>{if(d){let u=d.auto_chat_enabled===1||d.autoChatEnabled===!0;this.aiChatEnabled.set(u),this.aiChatMode.set(d.auto_chat_mode||d.autoChatMode||"semi")}});this.listeners.push(a)}loadRules(){this.isLoading.set(!0),console.log("[TriggerRules] Sending get-trigger-rules request"),this.ipcService.send("get-trigger-rules",{}),setTimeout(()=>{this.isLoading()&&this.rules().length===0&&this.retryCount<this.MAX_RETRIES?(this.retryCount++,console.log(`[TriggerRules] Retrying... (${this.retryCount}/${this.MAX_RETRIES})`),this.ipcService.send("get-trigger-rules",{})):this.isLoading()&&this.isLoading.set(!1)},3e3)}loadAISettings(){this.ipcService.send("get-ai-settings",{})}refreshData(){this.retryCount=0,this.loadRules(),this.stateService.loadAll()}handleConfigAction(e){}openCreateWizard(){this.editingRule.set(null),this.formData=this.getEmptyFormData(),this.wizardStep.set(1),this.showWizard.set(!0)}editRule(e){this.editingRule.set(e),this.formData=E({},e),this.wizardStep.set(1),this.showWizard.set(!0)}closeWizard(){this.showWizard.set(!1),this.editingRule.set(null),this.formData=this.getEmptyFormData()}getEmptyFormData(){return{name:"",description:"",priority:2,isActive:!0,sourceType:"all",sourceGroupIds:[],keywordSetIds:[],conditions:{oncePerUser:!1,excludeAdmin:!1},responseType:"ai_chat",responseConfig:{aiMode:"full"},senderType:"auto",senderAccountIds:[],delayMin:30,delayMax:120,dailyLimit:50,autoAddLead:!0,notifyMe:!1}}getStepTitle(){return{1:"\u57FA\u672C\u4FE1\u606F",2:"\u89F8\u767C\u689D\u4EF6",3:"\u97FF\u61C9\u52D5\u4F5C",4:"\u78BA\u8A8D\u8A2D\u7F6E"}[this.wizardStep()]||""}prevStep(){this.wizardStep()>1&&this.wizardStep.update(e=>e-1)}nextStep(){this.wizardStep()<4&&this.canProceed()&&this.wizardStep.update(e=>e+1)}canProceed(){switch(this.wizardStep()){case 1:return this.formData.name.trim().length>0;case 2:return this.formData.keywordSetIds.length>0;case 3:return this.formData.responseType==="template"?!!this.formData.responseConfig.templateId:!0;default:return!0}}canSave(){return this.formData.name.trim().length>0&&this.formData.keywordSetIds.length>0}isGroupSelected(e){return this.formData.sourceGroupIds.some(t=>String(t)===String(e))}isKeywordSetSelected(e){return this.formData.keywordSetIds.some(t=>String(t)===String(e))}toggleGroupSelection(e){let t=this.formData.sourceGroupIds.findIndex(n=>String(n)===String(e));t===-1?this.formData.sourceGroupIds.push(e):this.formData.sourceGroupIds.splice(t,1)}toggleKeywordSetSelection(e){let t=this.formData.keywordSetIds.findIndex(n=>String(n)===String(e));t===-1?this.formData.keywordSetIds.push(e):this.formData.keywordSetIds.splice(t,1)}saveRule(){let e=P(E({},this.formData),{id:this.editingRule()?.id});this.ipcService.send("save-trigger-rule",e)}async toggleRule(e){this.ipcService.send("toggle-trigger-rule",{id:e.id,isActive:!e.isActive})}async deleteRule(e){await this.confirmService.confirm({title:"\u522A\u9664\u898F\u5247",message:`\u78BA\u5B9A\u8981\u522A\u9664\u898F\u5247\u300C${e.name}\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,confirmText:"\u522A\u9664",cancelText:"\u53D6\u6D88",type:"danger"})&&this.ipcService.send("delete-trigger-rule",{id:e.id})}getResponseIcon(e){return{ai_chat:"\u{1F916}",template:"\u{1F4DD}",script:"\u{1F4D6}",record_only:"\u{1F4CB}"}[e]||"\u26A1"}getResponseLabel(e){return{ai_chat:"AI \u667A\u80FD\u5C0D\u8A71",template:"\u56FA\u5B9A\u6A21\u677F",script:"\u57F7\u884C\u5287\u672C",record_only:"\u50C5\u8A18\u9304"}[e]||e}getResponseDetail(e){let t=this.getResponseLabel(e.responseType);if(e.responseType==="template"&&e.responseConfig?.templateId){let n=this.getTemplateName(e.responseConfig.templateId);return`${t}: ${n}`}if(e.responseType==="ai_chat"&&e.responseConfig?.aiMode){let n=e.responseConfig.aiMode==="full"?"\u5168\u81EA\u52D5":"\u534A\u81EA\u52D5";return`${t} (${n})`}return t}getTemplateName(e){return e?this.stateService.chatTemplates().find(o=>String(o.id)===String(e))?.name||`\u6A21\u677F #${e}`:"\u672A\u9078\u64C7"}getPriorityLabel(e){return{3:"\u9AD8\u512A\u5148",2:"\u4E2D\u512A\u5148",1:"\u4F4E\u512A\u5148"}[e]||"\u4E2D\u512A\u5148"}getKeywordSetNames(e){if(!e||e.length===0)return"\u672A\u9078\u64C7";let t=this.stateService.keywordSets(),n=e.map(o=>{let a=String(o);return t.find(u=>String(u.id)===a)?.name||`#${o}`});return n.length>2?`${n.slice(0,2).join(", ")} \u7B49 ${n.length} \u500B`:n.join(", ")}getSuccessRate(e){return!e.triggerCount||e.triggerCount===0?0:Math.round((e.successCount||0)/e.triggerCount*100)}formatTime(e){if(!e)return"";let t=new Date(e),o=new Date().getTime()-t.getTime();return o<6e4?"\u525B\u525B":o<36e5?`${Math.floor(o/6e4)} \u5206\u9418\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u6642\u524D`:t.toLocaleDateString()}openTestDialog(e){this.testingRule.set(e),this.testMessage="",this.testResult.set(null),this.showTestDialog.set(!0)}closeTestDialog(){this.showTestDialog.set(!1),this.testingRule.set(null),this.testMessage="",this.testResult.set(null)}runTest(){let e=this.testingRule();if(!e||!this.testMessage.trim())return;this.isTestingRule.set(!0);let n=this.stateService.keywordSets().filter(p=>e.keywordSetIds.includes(p.id)||e.keywordSetIds.includes(String(p.id))),o=[],a=this.testMessage.toLowerCase();for(let p of n)for(let g of p.keywords||[]){let C=g.keyword?.toLowerCase()||g.text?.toLowerCase()||"";if(!C)continue;let w=!1;if(g.isRegex||!1)try{w=new RegExp(C,"i").test(this.testMessage)}catch{w=a.includes(C)}else w=a.includes(C);w&&o.push(g.keyword||g.text)}let d=this.checkConditions(e),u="";if(o.length>0)if(e.responseType==="template"&&e.responseConfig?.templateId){let g=this.stateService.chatTemplates().find(C=>String(C.id)===String(e.responseConfig.templateId));g&&(u=this.generatePreview(g.content||"",o[0]))}else e.responseType==="ai_chat"?u="[AI \u5C07\u6839\u64DA\u6D88\u606F\u5167\u5BB9\u667A\u80FD\u751F\u6210\u56DE\u5FA9]":e.responseType==="record_only"?u="[\u50C5\u8A18\u9304\uFF0C\u4E0D\u767C\u9001\u4EFB\u4F55\u6D88\u606F]":e.responseType==="script"&&(u="[\u5C07\u57F7\u884C\u914D\u7F6E\u7684\u5287\u672C\u8173\u672C]");setTimeout(()=>{this.testResult.set({matched:o.length>0,matchedKeywords:[...new Set(o)],conditionsMet:d,responsePreview:u}),this.isTestingRule.set(!1)},500)}checkConditions(e){let t=e.conditions||{};if(t.timeRange){let o=new Date().getHours(),[a,d]=[parseInt(t.timeRange.start?.split(":")[0]||"0"),parseInt(t.timeRange.end?.split(":")[0]||"24")];if(o<a||o>=d)return!1}return!0}generatePreview(e,t){let n=e;return n=n.replace(/\{\{?username\}?\}/g,"@TestUser"),n=n.replace(/\{\{?firstName\}?\}/g,"Test"),n=n.replace(/\{\{?keyword\}?\}/g,t),n=n.replace(/\{\{?groupName\}?\}/g,"\u6E2C\u8A66\u7FA4\u7D44"),n=n.replace(/\{\{?[^}]+\}?\}/g,""),n.trim()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-trigger-rules"]],decls:87,vars:12,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-amber-500","to-orange-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-amber-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-amber-400"],[1,"text-2xl","font-bold","text-amber-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"w-10","h-10","bg-cyan-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-cyan-400"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"w-10","h-10","bg-purple-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-purple-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"mb-4","p-4","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10","rounded-xl","border","border-emerald-500/30"],[1,"flex-1","overflow-hidden"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","h-full","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-slate-700","border","border-slate-600","rounded-lg","text-sm","text-white",3,"ngModelChange","ngModel"],["value","all"],["value","active"],["value","inactive"],[1,"flex-1","overflow-y-auto","p-4"],[1,"space-y-4"],[1,"flex","flex-col","items-center","justify-center","h-full","text-center","py-12"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50"],[1,"flex","items-start","gap-3"],[1,"flex-1"],[1,"text-emerald-400","font-medium"],[1,"text-slate-400","text-sm","mt-1"],[1,"bg-slate-700/50","rounded-xl","border","transition-all","hover:border-amber-500/30",3,"border-slate-600/50","border-slate-700/50","opacity-60"],[1,"bg-slate-700/50","rounded-xl","border","transition-all","hover:border-amber-500/30"],[1,"p-4","flex","items-center","justify-between"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center"],[1,"text-lg"],[1,"font-medium","text-white"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded-full"],[1,"px-2","py-0.5","bg-slate-600","text-slate-400","text-xs","rounded-full"],[1,"px-2","py-0.5","text-xs","rounded-full"],[1,"text-sm","text-slate-400","mt-0.5"],["title","\u6E2C\u8A66\u898F\u5247",1,"px-3","py-1.5","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-slate-600","hover:bg-slate-500","text-white","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-3","py-1.5","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","hover:bg-red-500/30","text-red-400","text-sm","rounded-lg","transition-colors",3,"click"],[1,"px-4","pb-4"],[1,"flex","items-center","gap-4","p-3","bg-slate-800/50","rounded-lg"],[1,"flex-1","text-center"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-sm","text-slate-300"],[1,"text-slate-600"],[1,"flex","items-center","justify-between","mt-3","text-xs","text-slate-500"],[1,"flex","items-center","gap-4"],[1,"w-20","h-20","bg-slate-700/50","rounded-full","flex","items-center","justify-center","mb-4"],[1,"text-4xl"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-slate-400","mb-6","max-w-md"],[1,"text-emerald-400","text-sm","mb-4"],[1,"px-6","py-3","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-xl","transition-colors","flex","items-center","gap-2",3,"click"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","shadow-2xl",3,"click"],[1,"p-6","border-b","border-slate-700","flex","items-center","justify-between"],[1,"text-xl","font-bold","text-white"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-4","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"p-6","overflow-y-auto",2,"max-height","calc(90vh - 250px)"],[1,"p-6","border-t","border-slate-700","flex","items-center","justify-between"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"px-6","py-2","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"disabled"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm","font-medium","transition-colors"],[1,"w-16","h-0.5","mx-2",3,"bg-amber-500","bg-slate-700"],[1,"w-16","h-0.5","mx-2"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1AUSDT \u4EA4\u6613\u8AEE\u8A62",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","focus:border-amber-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","3","placeholder","\u63CF\u8FF0\u9019\u500B\u898F\u5247\u7684\u7528\u9014...",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-lg","text-white","focus:border-amber-500","focus:outline-none","resize-none",3,"ngModelChange","ngModel"],[1,"flex-1","px-4","py-3","rounded-lg","border","transition-colors",3,"click"],[1,"space-y-2"],[1,"flex","items-center","gap-3","p-3","bg-slate-700","rounded-lg","cursor-pointer","hover:bg-slate-600","transition-colors"],["type","radio","name","sourceType","value","all",1,"w-4","h-4","text-amber-500",3,"ngModelChange","ngModel"],[1,"text-slate-300"],["type","radio","name","sourceType","value","specific",1,"w-4","h-4","text-amber-500",3,"ngModelChange","ngModel"],[1,"mt-3","p-3","bg-slate-700/50","rounded-lg","max-h-40","overflow-y-auto"],[1,"p-3","bg-slate-700/50","rounded-lg","max-h-48","overflow-y-auto"],[1,"flex","items-center","gap-2","p-2","hover:bg-slate-600/50","rounded","cursor-pointer"],[1,"text-slate-500","text-sm","text-center","py-4"],["type","checkbox",1,"w-4","h-4","text-amber-500",3,"ngModelChange","ngModel"],[1,"text-slate-300","text-sm"],["type","checkbox",1,"w-4","h-4","text-amber-500",3,"change","checked"],[1,"text-slate-500","text-xs"],[1,"space-y-3"],[1,"p-4","rounded-lg","border","cursor-pointer","transition-colors",3,"click"],[1,"mt-3","flex","gap-2"],[1,"mt-3"],[1,"px-3","py-1.5","rounded","text-sm",3,"click"],[1,"w-full","px-3","py-2","bg-slate-600","border","border-slate-500","rounded","text-sm","text-white",3,"ngModelChange","click","ngModel"],[3,"ngValue"],[1,"p-4","bg-slate-700/50","rounded-lg"],[1,"font-medium","text-white","mb-3"],[1,"flex","items-center","justify-between","p-3","bg-slate-800/50","rounded-lg"],[1,"text-center","flex-1"],[1,"text-sm","text-slate-300","mt-1"],[1,"block","text-sm","text-slate-400","mb-2"],["type","number","min","0","max","300",1,"w-24","px-3","py-2","bg-slate-700","border","border-slate-600","rounded","text-white","text-center",3,"ngModelChange","ngModel"],[1,"text-slate-500"],["type","number","min","0","max","600",1,"w-24","px-3","py-2","bg-slate-700","border","border-slate-600","rounded","text-white","text-center",3,"ngModelChange","ngModel"],[1,"text-slate-500","text-sm"],["type","number","min","1","max","500",1,"w-32","px-3","py-2","bg-slate-700","border","border-slate-600","rounded","text-white",3,"ngModelChange","ngModel"],[1,"text-slate-500","text-sm","ml-2"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","hover:from-amber-600","hover:to-orange-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-6","py-2","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-lg","shadow-2xl","border","border-slate-700/50",3,"click"],[1,"p-6","border-b","border-slate-700/50"],[1,"w-10","h-10","bg-blue-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-xl"],[1,"text-lg","font-bold","text-white"],[1,"p-6","space-y-4"],["rows","3","placeholder","\u8F38\u5165\u8981\u6E2C\u8A66\u7684\u6D88\u606F\u5167\u5BB9\uFF0C\u4F8B\u5982\uFF1A\u6211\u60F3\u4E86\u89E3\u66F4\u591A\u95DC\u65BC\u6295\u8CC7\u7684\u4FE1\u606F...",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","placeholder-slate-400","focus:border-blue-500",3,"ngModelChange","ngModel"],[1,"bg-slate-700/50","rounded-lg","p-4","space-y-3"],[1,"p-6","border-t","border-slate-700/50","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-blue-500","hover:bg-blue-600","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"w-6","h-6","bg-emerald-500/20","rounded-full","flex","items-center","justify-center"],[1,"w-6","h-6","bg-red-500/20","rounded-full","flex","items-center","justify-center"],[1,"text-red-400"],[1,"text-red-400","font-medium"],[1,"text-sm"],[1,"text-slate-400"],[1,"mt-3","p-3","bg-slate-800","rounded-lg"],[1,"text-sm","text-slate-300","whitespace-pre-wrap"],[1,"animate-spin"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u26A1"),s()(),r(6,"div")(7,"h1",5),l(8,"\u89F8\u767C\u898F\u5247"),s(),r(9,"p",6),l(10,"\u5B9A\u7FA9\u95DC\u9375\u8A5E\u5339\u914D\u5F8C\u7684\u97FF\u61C9\u52D5\u4F5C"),s()()(),r(11,"div",2)(12,"app-config-progress",7),x("action",function(a){return n.handleConfigAction(a)}),s(),r(13,"button",8),x("click",function(){return n.refreshData()}),r(14,"span"),l(15,"\u{1F504}"),s(),r(16,"span"),l(17,"\u5237\u65B0"),s()(),r(18,"button",9),x("click",function(){return n.openCreateWizard()}),r(19,"span"),l(20,"+"),s(),r(21,"span"),l(22,"\u5275\u5EFA\u898F\u5247"),s()()()(),r(23,"div",10)(24,"div",11)(25,"div",2)(26,"div",12)(27,"span",13),l(28,"\u26A1"),s()(),r(29,"div")(30,"div",14),l(31),s(),r(32,"div",15),l(33,"\u7E3D\u898F\u5247\u6578"),s()()()(),r(34,"div",11)(35,"div",2)(36,"div",16)(37,"span",17),l(38,"\u2713"),s()(),r(39,"div")(40,"div",18),l(41),s(),r(42,"div",15),l(43,"\u6D3B\u8E8D\u898F\u5247"),s()()()(),r(44,"div",11)(45,"div",2)(46,"div",19)(47,"span",20),l(48,"\u{1F3AF}"),s()(),r(49,"div")(50,"div",21),l(51),s(),r(52,"div",15),l(53,"\u7E3D\u89F8\u767C\u6B21\u6578"),s()()()(),r(54,"div",11)(55,"div",2)(56,"div",22)(57,"span",23),l(58,"\u{1F4CA}"),s()(),r(59,"div")(60,"div",24),l(61),s(),r(62,"div",15),l(63,"\u5E73\u5747\u6210\u529F\u7387"),s()()()()(),y(64,uO,9,1,"div",25),r(65,"div",26)(66,"div",27)(67,"div",28)(68,"h3",29)(69,"span"),l(70,"\u26A1"),s(),l(71," \u89F8\u767C\u898F\u5247\u5217\u8868 "),r(72,"span",15),l(73),s()(),r(74,"div",30)(75,"select",31),W("ngModelChange",function(a){return q(n.filterStatus,a)||(n.filterStatus=a),a}),r(76,"option",32),l(77,"\u5168\u90E8\u72C0\u614B"),s(),r(78,"option",33),l(79,"\u6D3B\u8E8D\u4E2D"),s(),r(80,"option",34),l(81,"\u5DF2\u505C\u7528"),s()()()(),r(82,"div",35),y(83,hO,3,0,"div",36)(84,_O,15,1,"div",37),s()()()(),y(85,RO,28,7,"div",38),y(86,qO,25,5,"div",38)),t&2&&(c(14),N("animate-spin",n.isLoading()),c(17),D(n.rules().length),c(10),D(n.activeRules().length),c(10),D(n.totalTriggerCount()),c(10),M("",n.averageSuccessRate(),"%"),c(3),S(n.aiChatEnabled()?64:-1),c(9),M("(",n.rules().length,")"),c(2),H("ngModel",n.filterStatus),c(8),S(n.filteredRules().length>0?83:84),c(2),S(n.showWizard()?85:-1),c(),S(n.showTestDialog()?86:-1))},dependencies:[oe,ae,Re,Ne,xe,Rt,it,Ge,Br,ve,Nt,tn,he,vn],encapsulation:2})}};var _1=(i,e)=>e.key,WO=(i,e)=>e.id,zO=(i,e)=>e.name;function KO(i,e){if(i&1){let t=I();r(0,"button",19),x("click",function(){let o=_(t).$implicit,a=m();return v(a.filterType=o.key)}),l(1),s()}if(i&2){let t=e.$implicit,n=m();N("bg-pink-500/20",n.filterType===t.key)("text-pink-400",n.filterType===t.key)("bg-slate-700/50",n.filterType!==t.key)("text-slate-400",n.filterType!==t.key),c(),X(" ",t.value.icon," ",t.value.label," ")}}function jO(i,e){if(i&1){let t=I();r(0,"div",16)(1,"p"),l(2),s(),r(3,"button",20),x("click",function(){_(t);let o=m();return v(o.createNewTemplate())}),l(4," + \u5275\u5EFA\u7B2C\u4E00\u500B\u6A21\u677F "),s()()}if(i&2){let t=m();c(2),D(t.searchQuery||t.filterType!=="all"?"\u6C92\u6709\u7B26\u5408\u7684\u6A21\u677F":"\u9084\u6C92\u6709\u6A21\u677F")}}function JO(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=m().$implicit,n=m(2);c(),M("\u23F0 ",n.formatDate(t.lastUsed))}}function QO(i,e){if(i&1){let t=I();r(0,"div",22),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.selectTemplate(o))}),r(1,"div",23)(2,"div",4)(3,"span"),l(4),s(),r(5,"span",24),l(6),s()(),r(7,"span",25),l(8),s()(),r(9,"p",26),l(10),s(),r(11,"div",27)(12,"span"),l(13),s(),y(14,JO,2,1,"span"),s()()}if(i&2){let t,n,o,a,d,u=e.$implicit,p=m(2);N("bg-pink-500/20",((t=p.selectedTemplate())==null?null:t.id)===u.id)("border-pink-500/50",((n=p.selectedTemplate())==null?null:n.id)===u.id)("bg-slate-800/50",((o=p.selectedTemplate())==null?null:o.id)!==u.id)("hover:bg-slate-700/50",((a=p.selectedTemplate())==null?null:a.id)!==u.id)("border",!0)("border-slate-700/50",((d=p.selectedTemplate())==null?null:d.id)!==u.id),c(4),D(p.getTypeConfig(u.templateType).icon),c(2),D(u.name),c(),N("bg-emerald-500/20",u.isActive)("text-emerald-400",u.isActive)("bg-slate-600/50",!u.isActive)("text-slate-400",!u.isActive),c(),M(" ",u.isActive?"\u555F\u7528":"\u505C\u7528"," "),c(2),D(u.content),c(3),M("\u{1F4CA} ",u.usageCount," \u6B21\u4F7F\u7528"),c(),S(u.lastUsed?14:-1)}}function YO(i,e){if(i&1&&O(0,QO,15,26,"div",21,WO),i&2){let t=m();U(t.filteredTemplates())}}function XO(i,e){if(i&1){let t=I();r(0,"div",18)(1,"div",28)(2,"div",29)(3,"span",30),l(4,"\u{1F4AC}"),s()(),r(5,"h3",31),l(6,"\u9078\u64C7\u6216\u5275\u5EFA\u804A\u5929\u6A21\u677F"),s(),r(7,"p",32),l(8,"\u5F9E\u5DE6\u5074\u9078\u64C7\u4E00\u500B\u6A21\u677F\u67E5\u770B\u8A73\u60C5\uFF0C\u6216\u5275\u5EFA\u65B0\u6A21\u677F"),s(),r(9,"button",33),x("click",function(){_(t);let o=m();return v(o.createNewTemplate())}),l(10," + \u5275\u5EFA\u65B0\u6A21\u677F "),s()()()}}function ZO(i,e){if(i&1&&(r(0,"option",39),l(1),s()),i&2){let t=e.$implicit;L("value",t.key),c(),X("",t.value.icon," ",t.value.label)}}function eU(i,e){if(i&1){let t=I();r(0,"button",62),x("click",function(){_(t);let o=m(2);return v(o.deleteTemplate())}),l(1," \u522A\u9664 "),s()}}function tU(i,e){if(i&1){let t=I();r(0,"div",63),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.insertVariable(o.name))}),r(1,"div",35)(2,"code",64),l(3),s(),r(4,"span",65),l(5,"\u9EDE\u64CA\u63D2\u5165"),s()(),r(6,"p",66),l(7),s()()}if(i&2){let t=e.$implicit;c(3),D("{{"+t.name+"}}"),c(4),D(t.description)}}function nU(i,e){if(i&1&&(r(0,"div",55)(1,"h4",51)(2,"span"),l(3,"\u{1F4CA}"),s(),l(4," \u4F7F\u7528\u7D71\u8A08 "),s(),r(5,"div",67)(6,"div",28)(7,"div",68),l(8),s(),r(9,"div",7),l(10,"\u7E3D\u4F7F\u7528\u6B21\u6578"),s()(),r(11,"div",28)(12,"div",69),l(13),s(),r(14,"div",7),l(15,"\u8B8A\u91CF\u6578\u91CF"),s()(),r(16,"div",28)(17,"div",70),l(18),s(),r(19,"div",7),l(20,"\u6700\u5F8C\u4F7F\u7528"),s()()()()),i&2){let t=m(2);c(8),D(t.editingTemplate.usageCount),c(5),D(t.editingTemplate.variables.length),c(5),M(" ",t.editingTemplate.lastUsed?t.formatDate(t.editingTemplate.lastUsed):"\u5F9E\u672A\u4F7F\u7528"," ")}}function iU(i,e){if(i&1){let t=I();r(0,"div",34)(1,"div",35)(2,"div",36)(3,"input",37),W("ngModelChange",function(o){_(t);let a=m();return q(a.editingTemplate.name,o)||(a.editingTemplate.name=o),v(o)}),s(),r(4,"select",38),W("ngModelChange",function(o){_(t);let a=m();return q(a.editingTemplate.templateType,o)||(a.editingTemplate.templateType=o),v(o)}),O(5,ZO,2,3,"option",39,_1),s()(),r(7,"div",40)(8,"label",41)(9,"input",42),W("ngModelChange",function(o){_(t);let a=m();return q(a.editingTemplate.isActive,o)||(a.editingTemplate.isActive=o),v(o)}),s(),r(10,"span",43),l(11,"\u555F\u7528"),s()(),r(12,"button",44),x("click",function(){_(t);let o=m();return v(o.saveTemplate())}),l(13),s(),y(14,eU,2,0,"button",45),s()()(),r(15,"div",46)(16,"div",47)(17,"label",48),l(18,"\u6A21\u677F\u5167\u5BB9"),s(),r(19,"textarea",49),W("ngModelChange",function(o){_(t);let a=m();return q(a.editingTemplate.content,o)||(a.editingTemplate.content=o),v(o)}),l(20,"              "),s()(),r(21,"div",50)(22,"h4",51)(23,"span"),l(24,"\u{1F4DD}"),s(),l(25," \u53EF\u7528\u8B8A\u91CF "),s(),r(26,"div",52),O(27,tU,8,2,"div",53,zO),s()(),r(29,"div",47)(30,"h4",54)(31,"span"),l(32,"\u{1F441}\uFE0F"),s(),l(33," \u9810\u89BD "),s(),r(34,"div",55)(35,"div",56)(36,"div",57),l(37," \u{1F916} "),s(),r(38,"div",58)(39,"div",59)(40,"p",60),l(41),s()(),r(42,"div",61),l(43,"\u525B\u525B"),s()()()()(),y(44,nU,21,3,"div",55),s()}if(i&2){let t=m();c(3),H("ngModel",t.editingTemplate.name),c(),H("ngModel",t.editingTemplate.templateType),c(),U(t.templateTypeEntries),c(4),H("ngModel",t.editingTemplate.isActive),c(4),M(" ",t.isCreating()?"\u5275\u5EFA":"\u4FDD\u5B58"," "),c(),S(t.isCreating()?-1:14),c(5),H("ngModel",t.editingTemplate.content),_t("placeholder","\u8F38\u5165\u6A21\u677F\u5167\u5BB9\uFF0C\u4F7F\u7528 {{\u8B8A\u91CF\u540D}} \u63D2\u5165\u8B8A\u91CF"),c(8),U(t.availableVariables),c(14),D(t.previewContent()),c(3),S(t.isCreating()?-1:44)}}var Fm={greeting:{label:"\u554F\u5019\u8A9E",icon:"\u{1F44B}",color:"emerald"},follow_up:{label:"\u8DDF\u9032\u6D88\u606F",icon:"\u{1F4E9}",color:"blue"},promotion:{label:"\u63A8\u5EE3\u6D88\u606F",icon:"\u{1F4E2}",color:"amber"},custom:{label:"\u81EA\u5B9A\u7FA9",icon:"\u270F\uFE0F",color:"purple"}},ed=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.confirmDialog=F(zt);this.stateService=F(Ct);this.templates=f([]);this.selectedTemplate=f(null);this.isCreating=f(!1);this.isLoading=f(!1);this.stateEffect=gt(()=>{let e=this.stateService.chatTemplates();e.length>0&&this.templates().length===0&&(console.log("[ChatTemplates] Syncing from StateService:",e.length,"templates"),this.updateTemplates(e))});this.editingTemplate=this.createEmptyTemplate();this.searchQuery="";this.filterType="all";this.templateTypeEntries=Object.entries(Fm).map(([e,t])=>({key:e,value:t}));this.availableVariables=[{name:"username",description:"\u5C0D\u65B9\u7528\u6236\u540D"},{name:"firstName",description:"\u5C0D\u65B9\u540D\u5B57"},{name:"groupName",description:"\u7FA4\u7D44\u540D\u7A31"},{name:"keyword",description:"\u5339\u914D\u7684\u95DC\u9375\u8A5E"},{name:"date",description:"\u7576\u524D\u65E5\u671F"},{name:"time",description:"\u7576\u524D\u6642\u9593"}];this.filteredTemplates=R(()=>{let e=this.templates();if(this.filterType!=="all"&&(e=e.filter(t=>t.templateType===this.filterType)),this.searchQuery){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.name.toLowerCase().includes(t)||n.content.toLowerCase().includes(t))}return e});this.previewContent=R(()=>{let e=this.editingTemplate.content||"\u5728\u9019\u88E1\u8F38\u5165\u6A21\u677F\u5167\u5BB9...";return e=e.replace(/\{\{username\}\}/g,"John_Doe"),e=e.replace(/\{\{firstName\}\}/g,"John"),e=e.replace(/\{\{groupName\}\}/g,"\u52A0\u5BC6\u8CA8\u5E63\u4EA4\u6D41\u7FA4"),e=e.replace(/\{\{keyword\}\}/g,"\u6295\u8CC7"),e=e.replace(/\{\{date\}\}/g,new Date().toLocaleDateString()),e=e.replace(/\{\{time\}\}/g,new Date().toLocaleTimeString()),e});this.listeners=[];this.retryCount=0;this.MAX_RETRIES=3}ngOnInit(){this.setupListeners();let e=this.stateService.chatTemplates();e.length>0?(console.log("[ChatTemplates] Using existing StateService data:",e.length,"templates"),this.updateTemplates(e)):this.stateService.loadAll(),this.loadTemplates()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupListeners(){let e=this.ipcService.on("get-chat-templates-result",d=>{console.log("[ChatTemplates] Received get-chat-templates-result:",d),this.isLoading.set(!1),this.retryCount=0,d.templates?this.updateTemplates(d.templates):d.error&&(console.error("[ChatTemplates] Error loading templates:",d.error),this.toastService.error("\u52A0\u8F09\u6A21\u677F\u5931\u6557: "+d.error))});this.listeners.push(e);let t=this.ipcService.on("initial-state",d=>{d.chatTemplates&&(console.log("[ChatTemplates] Received from initial-state:",d.chatTemplates.length,"templates"),this.updateTemplates(d.chatTemplates))});this.listeners.push(t);let n=this.ipcService.on("initial-state-config",d=>{d.chatTemplates&&(console.log("[ChatTemplates] Received from initial-state-config:",d.chatTemplates.length,"templates"),this.updateTemplates(d.chatTemplates))});this.listeners.push(n);let o=this.ipcService.on("save-chat-template-result",d=>{d.success?(this.toastService.success(this.isCreating()?"\u6A21\u677F\u5275\u5EFA\u6210\u529F":"\u6A21\u677F\u4FDD\u5B58\u6210\u529F"),this.loadTemplates(),this.isCreating.set(!1)):this.toastService.error(d.error||"\u4FDD\u5B58\u5931\u6557")});this.listeners.push(o);let a=this.ipcService.on("delete-chat-template-result",d=>{d.success&&(this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664"),this.selectedTemplate.set(null),this.loadTemplates())});this.listeners.push(a)}loadTemplates(){this.isLoading.set(!0),console.log("[ChatTemplates] Sending get-chat-templates request"),this.ipcService.send("get-chat-templates"),setTimeout(()=>{this.isLoading()&&this.templates().length===0&&this.retryCount<this.MAX_RETRIES?(this.retryCount++,console.log(`[ChatTemplates] Retrying... (${this.retryCount}/${this.MAX_RETRIES})`),this.ipcService.send("get-chat-templates")):this.isLoading()&&this.isLoading.set(!1)},3e3)}updateTemplates(e){let t=e.map(o=>{let a=[];if(o.variables)if(typeof o.variables=="string")try{a=JSON.parse(o.variables)}catch{a=[]}else Array.isArray(o.variables)&&(a=o.variables);return{id:String(o.id),name:o.name,content:o.content||"",templateType:o.template_type||o.templateType||"custom",variables:a,usageCount:o.usage_count||o.usageCount||0,lastUsed:o.last_used||o.lastUsed,isActive:o.is_active!==!1&&o.isActive!==!1,createdAt:o.created_at||o.createdAt,updatedAt:o.updated_at||o.updatedAt}});this.templates.set(t),this.isLoading.set(!1);let n=this.selectedTemplate();if(n){let o=t.find(a=>a.id===n.id);o&&(this.selectedTemplate.set(o),this.editingTemplate=E({},o))}}createEmptyTemplate(){return{id:"",name:"",content:"",templateType:"custom",variables:[],usageCount:0,isActive:!0}}getTypeConfig(e){return Fm[e]||Fm.custom}formatDate(e){try{return new Date(e).toLocaleDateString()}catch{return e}}createNewTemplate(){this.selectedTemplate.set(null),this.isCreating.set(!0),this.editingTemplate=this.createEmptyTemplate()}selectTemplate(e){this.selectedTemplate.set(e),this.isCreating.set(!1),this.editingTemplate=E({},e)}insertVariable(e){this.editingTemplate.content+=`{{${e}}}`}saveTemplate(){if(console.log("[ChatTemplates] saveTemplate called, isCreating:",this.isCreating()),console.log("[ChatTemplates] editingTemplate:",this.editingTemplate),!this.editingTemplate.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31");return}if(!this.editingTemplate.content.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9");return}let e=[],t=/\{\{(\w+)\}\}/g,n;for(;(n=t.exec(this.editingTemplate.content))!==null;)e.includes(n[1])||e.push(n[1]);let o={id:this.isCreating()?null:parseInt(this.editingTemplate.id),name:this.editingTemplate.name,content:this.editingTemplate.content,category:this.editingTemplate.templateType,variables:e,isActive:this.editingTemplate.isActive};console.log("[ChatTemplates] Sending save-chat-template:",o),this.ipcService.send("save-chat-template",o),this.toastService.info("\u6B63\u5728\u4FDD\u5B58...")}async deleteTemplate(){if(!this.selectedTemplate())return;let e=this.selectedTemplate();await this.confirmDialog.danger("\u522A\u9664\u804A\u5929\u6A21\u677F",`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F\u300C${e.name}\u300D\u55CE\uFF1F
\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002`,[e.name])&&this.ipcService.send("delete-chat-template",{id:parseInt(e.id)})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-chat-templates"]],decls:28,vars:12,consts:[[1,"h-full","flex","bg-slate-900"],[1,"w-80","flex-shrink-0","border-r","border-slate-700/50","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-2"],[1,"text-xl"],[1,"font-bold","text-white"],[1,"text-xs","text-slate-500"],[1,"w-8","h-8","bg-pink-500/20","hover:bg-pink-500/30","text-pink-400","rounded-lg","flex","items-center","justify-center","transition-colors",3,"click"],[1,"flex","flex-wrap","gap-2","mb-3"],[1,"px-2","py-1","rounded-lg","text-xs","transition-colors",3,"click"],[1,"px-2","py-1","rounded-lg","text-xs","transition-colors","flex","items-center","gap-1",3,"bg-pink-500/20","text-pink-400","bg-slate-700/50","text-slate-400"],[1,"relative"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-500"],["type","text","placeholder","\u641C\u7D22\u6A21\u677F...",1,"w-full","pl-10","pr-4","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","focus:border-pink-500","text-sm",3,"ngModelChange","ngModel"],[1,"flex-1","overflow-y-auto","p-2"],[1,"p-4","text-center","text-slate-500"],[1,"flex-1","flex","flex-col"],[1,"flex-1","flex","items-center","justify-center"],[1,"px-2","py-1","rounded-lg","text-xs","transition-colors","flex","items-center","gap-1",3,"click"],[1,"mt-2","text-pink-400","hover:underline","text-sm",3,"click"],[1,"p-3","rounded-xl","mb-2","cursor-pointer","transition-all",3,"bg-pink-500/20","border-pink-500/50","bg-slate-800/50","hover:bg-slate-700/50","border","border-slate-700/50"],[1,"p-3","rounded-xl","mb-2","cursor-pointer","transition-all",3,"click"],[1,"flex","items-center","justify-between","mb-2"],[1,"font-medium","text-white"],[1,"text-xs","px-2","py-0.5","rounded-full"],[1,"text-xs","text-slate-400","line-clamp-2","mb-2"],[1,"flex","items-center","gap-3","text-xs","text-slate-500"],[1,"text-center"],[1,"w-24","h-24","bg-slate-800","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-5xl"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-slate-400","mb-4"],[1,"px-4","py-2","bg-gradient-to-r","from-pink-500","to-rose-500","text-white","rounded-lg",3,"click"],[1,"p-6","border-b","border-slate-700/50"],[1,"flex","items-center","justify-between"],[1,"flex-1","flex","items-center","gap-4"],["type","text","placeholder","\u6A21\u677F\u540D\u7A31",1,"text-xl","font-bold","text-white","bg-transparent","border-none","focus:ring-0","p-0",3,"ngModelChange","ngModel"],[1,"px-3","py-1.5","bg-slate-800","border","border-slate-700","rounded-lg","text-sm","text-white",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-pink-500","focus:ring-pink-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-400"],[1,"px-4","py-2","bg-gradient-to-r","from-pink-500","to-rose-500","hover:from-pink-600","hover:to-rose-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors"],[1,"flex-1","overflow-y-auto","p-6"],[1,"mb-6"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],["rows","8",1,"w-full","px-4","py-3","bg-slate-800","border","border-slate-700","rounded-xl","text-white","placeholder-slate-500","focus:border-pink-500","resize-none",3,"ngModelChange","ngModel"],[1,"mb-6","p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"text-sm","font-medium","text-slate-300","mb-3","flex","items-center","gap-2"],[1,"grid","grid-cols-2","lg:grid-cols-3","gap-2"],[1,"p-2","bg-slate-700/50","hover:bg-slate-600/50","rounded-lg","cursor-pointer","transition-colors","group"],[1,"text-sm","font-medium","text-slate-300","mb-2","flex","items-center","gap-2"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"flex","gap-3"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-pink-500","to-rose-500","flex","items-center","justify-center","text-white"],[1,"flex-1"],[1,"bg-slate-700/50","rounded-2xl","rounded-tl-md","p-3","max-w-md"],[1,"text-white","whitespace-pre-wrap"],[1,"text-xs","text-slate-500","mt-1"],[1,"px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors",3,"click"],[1,"p-2","bg-slate-700/50","hover:bg-slate-600/50","rounded-lg","cursor-pointer","transition-colors","group",3,"click"],[1,"text-pink-400","text-sm"],[1,"text-xs","text-slate-500","opacity-0","group-hover:opacity-100"],[1,"text-xs","text-slate-400","mt-1"],[1,"grid","grid-cols-3","gap-4"],[1,"text-2xl","font-bold","text-pink-400"],[1,"text-2xl","font-bold","text-blue-400"],[1,"text-sm","font-medium","text-slate-300"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),l(6,"\u{1F4AC}"),s(),r(7,"h2",6),l(8,"\u804A\u5929\u6A21\u677F"),s(),r(9,"span",7),l(10),s()(),r(11,"button",8),x("click",function(){return n.createNewTemplate()}),l(12," + "),s()(),r(13,"div",9)(14,"button",10),x("click",function(){return n.filterType="all"}),l(15," \u5168\u90E8 "),s(),O(16,KO,2,10,"button",11,_1),s(),r(18,"div",12)(19,"span",13),l(20,"\u{1F50D}"),s(),r(21,"input",14),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),s()()(),r(22,"div",15),y(23,jO,5,1,"div",16)(24,YO,2,0),s()(),r(25,"div",17),y(26,XO,11,0,"div",18)(27,iU,45,9),s()()),t&2&&(c(10),M("(",n.templates().length,")"),c(4),N("bg-pink-500/20",n.filterType==="all")("text-pink-400",n.filterType==="all")("bg-slate-700/50",n.filterType!=="all")("text-slate-400",n.filterType!=="all"),c(2),U(n.templateTypeEntries),c(5),H("ngModel",n.searchQuery),c(2),S(n.filteredTemplates().length===0?23:24),c(3),S(!n.selectedTemplate()&&!n.isCreating()?26:27))},dependencies:[oe,ae,Re,Ne,xe,it,Ge,ve,he],encapsulation:2})}};var oU=(i,e)=>e.id;function rU(i,e){if(i&1&&B(0,"img",34),i&2){let t=m().$implicit;L("src",t.avatar,ot)("alt",t.username)}}function sU(i,e){if(i&1&&(r(0,"div",35),l(1),s()),i&2){let t=m().$implicit;c(),M(" ",(t.username||t.phone||"?")[0].toUpperCase()," ")}}function aU(i,e){i&1&&(r(0,"span",38),l(1,"\u76E3\u807D"),s())}function lU(i,e){i&1&&(r(0,"span",39),l(1,"\u767C\u9001"),s())}function cU(i,e){if(i&1){let t=I();r(0,"div",33),x("click",function(){let o=_(t).$implicit,a=m();return v(a.selectAccount(o))}),r(1,"div",2),y(2,rU,1,2,"img",34)(3,sU,2,1,"div",35),r(4,"div")(5,"div",36),l(6),s(),r(7,"div",14),l(8),s(),r(9,"div",37),y(10,aU,2,0,"span",38),y(11,lU,2,0,"span",39),s()()(),r(12,"div",2)(13,"div",40),B(14,"span",41),r(15,"span",42),l(16),s()(),ne(),r(17,"svg",43),B(18,"path",44),s()()()}if(i&2){let t,n,o=e.$implicit,a=m();N("border-cyan-500/50",((t=a.selectedAccount())==null?null:t.id)===o.id)("bg-slate-700",((n=a.selectedAccount())==null?null:n.id)===o.id),c(2),S(o.avatar?2:3),c(4),M(" ",o.username||o.phone," "),c(2),D(o.phone),c(2),S(o.isListener?10:-1),c(),S(o.isSender?11:-1),c(3),N("bg-emerald-500",o.status==="connected")("bg-red-500",o.status==="error")("bg-slate-500",o.status==="disconnected"),c(2),M(" ",o.status==="connected"?"\u5DF2\u9023\u63A5":o.status==="error"?"\u932F\u8AA4":"\u672A\u9023\u63A5"," ")}}function dU(i,e){if(i&1){let t=I();r(0,"div",31)(1,"div",45),l(2,"\u{1F464}"),s(),r(3,"h3",46),l(4,"\u66AB\u7121\u76E3\u63A7\u5E33\u865F"),s(),r(5,"p",47),l(6,"\u8ACB\u5728\u5E33\u6236\u7BA1\u7406\u4E2D\u6DFB\u52A0\u5E33\u865F\u4E26\u8A2D\u70BA\u76E3\u807D\u89D2\u8272"),s(),r(7,"button",48),x("click",function(){_(t);let o=m();return v(o.navigateToAccountManagement())}),l(8," + \u6DFB\u52A0\u5E33\u865F "),s()()}}function uU(i,e){if(i&1&&B(0,"img",52),i&2){let t=m(2);L("src",t.selectedAccount().avatar,ot)}}function mU(i,e){if(i&1&&(r(0,"div",53),l(1),s()),i&2){let t=m(2);c(),M(" ",(t.selectedAccount().username||t.selectedAccount().phone||"?")[0].toUpperCase()," ")}}function pU(i,e){if(i&1){let t=I();r(0,"div",32)(1,"div",49)(2,"h3",27)(3,"span"),l(4,"\u{1F4CB}"),s(),l(5," \u5E33\u865F\u8A73\u60C5 "),s()(),r(6,"div",50)(7,"div",51),y(8,uU,1,1,"img",52)(9,mU,2,1,"div",53),r(10,"h4",54),l(11),s(),r(12,"p",6),l(13),s(),r(14,"div",55),B(15,"span",41),r(16,"span",56),l(17),s()()(),r(18,"div",57)(19,"div",58)(20,"div",59),l(21),s(),r(22,"div",14),l(23,"\u4ECA\u65E5\u767C\u9001"),s()(),r(24,"div",58)(25,"div",60),l(26),s(),r(27,"div",14),l(28,"\u767C\u9001\u914D\u984D"),s()(),r(29,"div",58)(30,"div",61),l(31),s(),r(32,"div",14),l(33,"\u5065\u5EB7\u5EA6"),s()(),r(34,"div",58)(35,"div",62),l(36),s(),r(37,"div",14),l(38,"\u672C\u9031\u56DE\u8986"),s()()(),r(39,"div",63)(40,"h4",64),l(41,"\u89D2\u8272\u8A2D\u7F6E"),s(),r(42,"div",65)(43,"div",66)(44,"div",40)(45,"span",16),l(46,"\u{1F441}\uFE0F"),s(),r(47,"span",67),l(48,"\u76E3\u807D\u89D2\u8272"),s()(),r(49,"label",68)(50,"input",69),x("change",function(){_(t);let o=m();return v(o.toggleListener())}),s(),r(51,"div",70),B(52,"div",71),s()()(),r(53,"div",66)(54,"div",40)(55,"span",19),l(56,"\u{1F4E4}"),s(),r(57,"span",67),l(58,"\u767C\u9001\u89D2\u8272"),s()(),r(59,"label",68)(60,"input",69),x("change",function(){_(t);let o=m();return v(o.toggleSender())}),s(),r(61,"div",70),B(62,"div",71),s()()()()(),r(63,"div",72)(64,"button",73),x("click",function(){_(t);let o=m();return v(o.viewAccountDetails())}),r(65,"span"),l(66,"\u{1F4CB}"),s(),l(67," \u67E5\u770B\u5B8C\u6574\u8A73\u60C5 "),s()()()()}if(i&2){let t,n,o=m();c(8),S(o.selectedAccount().avatar?8:9),c(3),D(o.selectedAccount().username||o.selectedAccount().phone),c(2),D(o.selectedAccount().phone),c(2),N("bg-emerald-500",o.selectedAccount().status==="connected")("bg-red-500",o.selectedAccount().status==="error")("bg-slate-500",o.selectedAccount().status==="disconnected"),c(),N("text-emerald-400",o.selectedAccount().status==="connected")("text-red-400",o.selectedAccount().status==="error")("text-slate-400",o.selectedAccount().status==="disconnected"),c(),M(" ",o.selectedAccount().status==="connected"?"\u5DF2\u9023\u63A5":o.selectedAccount().status==="error"?"\u9023\u63A5\u932F\u8AA4":"\u672A\u9023\u63A5"," "),c(4),D(((t=o.selectedAccount().stats)==null?null:t.sentToday)||0),c(5),X("",o.selectedAccount().dailySendCount||0,"/",o.selectedAccount().dailySendLimit||50),c(5),M("",o.selectedAccount().healthScore||100,"%"),c(5),D(((n=o.selectedAccount().stats)==null?null:n.repliesWeek)||0),c(14),L("checked",o.selectedAccount().isListener),c(),N("bg-blue-500",o.selectedAccount().isListener)("bg-slate-600",!o.selectedAccount().isListener),c(),N("left-4",o.selectedAccount().isListener)("left-0",!o.selectedAccount().isListener),c(8),L("checked",o.selectedAccount().isSender),c(),N("bg-green-500",o.selectedAccount().isSender)("bg-slate-600",!o.selectedAccount().isSender),c(),N("left-4",o.selectedAccount().isSender)("left-0",!o.selectedAccount().isSender)}}var td=class i{constructor(){this.stateService=F(Ct);this.ipcService=F(Q);this.toastService=F(J);this.configAction=ge();this.selectedAccount=f(null)}ngOnInit(){this.stateService.loadAll()}refreshData(){this.stateService.refresh(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u5E33\u865F\u5217\u8868...")}selectAccount(e){this.selectedAccount.set(e)}navigateToAccountManagement(){this.configAction.emit("goto-account-management"),this.toastService.info("\u8ACB\u5728\u300C\u5E33\u6236\u7BA1\u7406\u300D\u4E2D\u6DFB\u52A0\u5E33\u865F")}handleConfigAction(e){this.configAction.emit(e)}toggleListener(){let e=this.selectedAccount();if(!e)return;let t=e.isListener?e.isSender?"Sender":"":"Listener";this.ipcService.send("update-account",{accountId:e.id,phone:e.phone,role:t}),this.selectedAccount.update(n=>n?P(E({},n),{isListener:!n.isListener}):null),this.toastService.success(e.isListener?`\u5DF2\u53D6\u6D88 ${e.username||e.phone} \u7684\u76E3\u807D\u89D2\u8272`:`\u5DF2\u5C07 ${e.username||e.phone} \u8A2D\u70BA\u76E3\u807D\u5E33\u865F`)}toggleSender(){let e=this.selectedAccount();if(!e)return;let t=e.isSender?e.isListener?"Listener":"":"Sender";this.ipcService.send("update-account",{accountId:e.id,phone:e.phone,role:t}),this.selectedAccount.update(n=>n?P(E({},n),{isSender:!n.isSender}):null),this.toastService.success(e.isSender?`\u5DF2\u53D6\u6D88 ${e.username||e.phone} \u7684\u767C\u9001\u89D2\u8272`:`\u5DF2\u5C07 ${e.username||e.phone} \u8A2D\u70BA\u767C\u9001\u5E33\u865F`)}viewAccountDetails(){this.configAction.emit("goto-account-management")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-monitoring-accounts"]],outputs:{configAction:"configAction"},decls:75,vars:9,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-cyan-500","to-blue-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],["mode","compact",3,"action"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-blue-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-blue-400"],[1,"text-2xl","font-bold","text-blue-400"],[1,"w-10","h-10","bg-green-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-green-400"],[1,"text-2xl","font-bold","text-green-400"],[1,"w-10","h-10","bg-purple-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-purple-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"flex-1","overflow-hidden","flex","gap-6"],[1,"flex-1","bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","flex","flex-col"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex-1","overflow-y-auto","p-4","space-y-3"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"border-cyan-500/50","bg-slate-700"],[1,"text-center","py-12","text-slate-400"],[1,"w-96","bg-slate-800/50","rounded-xl","border","border-slate-700/50","overflow-hidden","flex","flex-col"],[1,"flex","items-center","justify-between","p-3","bg-slate-700/50","rounded-lg","hover:bg-slate-700","transition-colors","cursor-pointer","group","border","border-transparent","hover:border-cyan-500/30",3,"click"],[1,"w-10","h-10","rounded-full","object-cover",3,"src","alt"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold"],[1,"text-sm","font-medium","text-white"],[1,"flex","items-center","gap-2","text-xs","mt-1"],[1,"px-1.5","py-0.5","bg-blue-500/20","text-blue-400","rounded"],[1,"px-1.5","py-0.5","bg-green-500/20","text-green-400","rounded"],[1,"flex","items-center","gap-2"],[1,"w-2","h-2","rounded-full"],[1,"text-xs","text-slate-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500","group-hover:text-cyan-400","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-5xl","mb-4"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"text-sm","mb-4"],[1,"px-4","py-2","bg-cyan-500/20","text-cyan-400","rounded-lg","hover:bg-cyan-500/30","transition-colors",3,"click"],[1,"p-4","border-b","border-slate-700/50"],[1,"flex-1","overflow-y-auto","p-4","space-y-4"],[1,"bg-slate-700/30","rounded-xl","p-4","text-center"],[1,"w-20","h-20","rounded-full","mx-auto","mb-3","object-cover",3,"src"],[1,"w-20","h-20","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","text-2xl","font-bold","mx-auto","mb-3"],[1,"text-lg","font-medium","text-white"],[1,"flex","items-center","justify-center","gap-2","mt-2"],[1,"text-sm"],[1,"grid","grid-cols-2","gap-3"],[1,"bg-slate-700/30","rounded-lg","p-3","text-center"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-white"],[1,"text-xl","font-bold","text-emerald-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"bg-slate-700/30","rounded-xl","p-4"],[1,"text-sm","font-medium","text-slate-300","mb-3"],[1,"space-y-3"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-white"],[1,"relative","inline-flex","cursor-pointer"],["type","checkbox",1,"sr-only",3,"change","checked"],[1,"w-9","h-5","rounded-full","transition-all"],[1,"absolute","w-4","h-4","bg-white","rounded-full","top-0.5","transition-all"],[1,"space-y-2"],[1,"w-full","px-4","py-2.5","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors","flex","items-center","justify-center","gap-2",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F916}"),s()(),r(6,"div")(7,"h1",5),l(8,"\u76E3\u63A7\u5E33\u865F\u7BA1\u7406"),s(),r(9,"p",6),l(10,"\u7BA1\u7406\u7528\u65BC\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u7684 Telegram \u5E33\u865F"),s()()(),r(11,"div",2)(12,"app-config-progress",7),x("action",function(a){return n.handleConfigAction(a)}),s(),r(13,"button",8),x("click",function(){return n.refreshData()}),r(14,"span"),l(15,"\u{1F504}"),s(),r(16,"span"),l(17,"\u5237\u65B0"),s()()()(),r(18,"div",9)(19,"div",10)(20,"div",2)(21,"div",11)(22,"span",12),l(23,"\u2713"),s()(),r(24,"div")(25,"div",13),l(26),s(),r(27,"div",14),l(28,"\u5DF2\u9023\u63A5"),s()()()(),r(29,"div",10)(30,"div",2)(31,"div",15)(32,"span",16),l(33,"\u{1F441}\uFE0F"),s()(),r(34,"div")(35,"div",17),l(36),s(),r(37,"div",14),l(38,"\u76E3\u807D\u5E33\u865F"),s()()()(),r(39,"div",10)(40,"div",2)(41,"div",18)(42,"span",19),l(43,"\u{1F4E4}"),s()(),r(44,"div")(45,"div",20),l(46),s(),r(47,"div",14),l(48,"\u767C\u9001\u5E33\u865F"),s()()()(),r(49,"div",10)(50,"div",2)(51,"div",21)(52,"span",22),l(53,"\u{1F4CA}"),s()(),r(54,"div")(55,"div",23),l(56),s(),r(57,"div",14),l(58,"\u7E3D\u5E33\u865F"),s()()()()(),r(59,"div",24)(60,"div",25)(61,"div",26)(62,"h3",27)(63,"span"),l(64,"\u{1F916}"),s(),l(65," \u76E3\u63A7\u5E33\u865F "),r(66,"span",14),l(67),s()(),r(68,"button",28),x("click",function(){return n.navigateToAccountManagement()}),l(69," + \u6DFB\u52A0\u5E33\u865F "),s()(),r(70,"div",29),O(71,cU,19,16,"div",30,oU,!1,dU,9,0,"div",31),s()(),y(74,pU,68,39,"div",32),s()()),t&2&&(c(14),N("animate-spin",n.stateService.isLoading()),c(12),D(n.stateService.connectedAccounts().length),c(10),D(n.stateService.listenerAccounts().length),c(10),D(n.stateService.senderAccounts().length),c(10),D(n.stateService.accounts().length),c(11),M("(",n.stateService.accounts().length,")"),c(4),U(n.stateService.accounts()),c(3),S(n.selectedAccount()?74:-1))},dependencies:[oe,ae,vn],encapsulation:2})}};var gU=()=>["S","A","B","C","D"],hU=(i,e)=>e.telegram_id;function fU(i,e){if(i&1){let t=I();r(0,"button",44),x("click",function(){let o=_(t).$implicit,a=m();return v(a.toggleValueLevel(o))}),l(1),s()}if(i&2){let t=e.$implicit,n=m();N("bg-violet-500/20",n.selectedValueLevels.includes(t))("text-violet-400",n.selectedValueLevels.includes(t))("bg-slate-700",!n.selectedValueLevels.includes(t))("text-slate-400",!n.selectedValueLevels.includes(t)),c(),M(" ",t," ")}}function _U(i,e){i&1&&(r(0,"div",40),B(1,"div",45),s())}function vU(i,e){i&1&&(r(0,"div",41)(1,"span",46),l(2,"\u{1F4ED}"),s(),r(3,"p"),l(4,"\u66AB\u7121\u6536\u96C6\u7684\u7528\u6236"),s(),r(5,"p",47),l(6,"\u958B\u555F\u7FA4\u7D44\u76E3\u63A7\u5F8C\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u6536\u96C6\u767C\u8A00\u8005"),s()())}function xU(i,e){i&1&&l(0," \u{1F6AB} ")}function CU(i,e){i&1&&l(0," \u26D4 ")}function bU(i,e){i&1&&l(0," \u{1F464} ")}function yU(i,e){if(i&1&&l(0),i&2){let t=m().$implicit;M(" ",(t.first_name||t.username||"?")[0].toUpperCase()," ")}}function SU(i,e){if(i&1&&(r(0,"span",13),l(1),s()),i&2){let t=m().$implicit;c(),M("@",t.username)}}function wU(i,e){i&1&&(r(0,"span",53),l(1,"\u{1F48E}"),s())}function EU(i,e){i&1&&(r(0,"span",53),l(1,"\u2713"),s())}function DU(i,e){if(i&1){let t=I();r(0,"div",49),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.selectUser(o))}),r(1,"div",2)(2,"div",50),y(3,xU,1,0)(4,CU,1,0)(5,bU,1,0)(6,yU,1,1),s(),r(7,"div",51)(8,"div",28)(9,"span",52),l(10),s(),y(11,SU,2,1,"span",13),y(12,wU,2,0,"span",53),y(13,EU,2,0,"span",53),s(),r(14,"div",54)(15,"span"),l(16),s(),r(17,"span"),l(18),s()()(),r(19,"div",55)(20,"div",56),l(21),s(),r(22,"div",57),l(23),s()()()()}if(i&2){let t,n,o,a,d,u=e.$implicit,p=m(2);N("bg-violet-500/10",((t=p.selectedUser())==null?null:t.telegram_id)===u.telegram_id)("border-violet-500/50",((n=p.selectedUser())==null?null:n.telegram_id)===u.telegram_id)("bg-slate-800/50",((o=p.selectedUser())==null?null:o.telegram_id)!==u.telegram_id)("border-slate-700/50",((a=p.selectedUser())==null?null:a.telegram_id)!==u.telegram_id)("hover:bg-slate-700/50",((d=p.selectedUser())==null?null:d.telegram_id)!==u.telegram_id),c(2),N("bg-emerald-500/20",u.ad_risk_score<.4)("bg-amber-500/20",u.ad_risk_score>=.4&&u.ad_risk_score<.7)("bg-red-500/20",u.ad_risk_score>=.7),c(),S(u.is_ad_account?3:u.is_blacklisted?4:u.has_photo?6:5),c(7),M(" ",u.first_name||u.username||"ID:"+u.telegram_id," "),c(),S(u.username?11:-1),c(),S(u.is_premium?12:-1),c(),S(u.is_verified?13:-1),c(3),M("\u{1F4CA} ",u.message_count," \u689D\u6D88\u606F"),c(2),M("\u{1F465} ",u.groups_count," \u500B\u7FA4"),c(2),N("text-emerald-400",u.ad_risk_score<.4)("text-amber-400",u.ad_risk_score>=.4&&u.ad_risk_score<.7)("text-red-400",u.ad_risk_score>=.7),c(),M(" ",(u.ad_risk_score*100).toFixed(0),"% "),c(),N("bg-violet-500/20",u.value_level==="S")("text-violet-400",u.value_level==="S")("bg-blue-500/20",u.value_level==="A")("text-blue-400",u.value_level==="A")("bg-emerald-500/20",u.value_level==="B")("text-emerald-400",u.value_level==="B")("bg-slate-500/20",u.value_level==="C"||u.value_level==="D")("text-slate-400",u.value_level==="C"||u.value_level==="D"),c(),M(" ",u.value_level,"\u7D1A ")}}function AU(i,e){if(i&1&&(r(0,"div",42),O(1,DU,24,47,"div",48,hU),s()),i&2){let t=m();c(),U(t.filteredUsers())}}function MU(i,e){if(i&1&&(r(0,"div",60)(1,"span",61),l(2,"\u7528\u6236\u540D"),s(),r(3,"span",24),l(4),s()()),i&2){let t=m(2);c(4),M("@",t.selectedUser().username)}}function TU(i,e){if(i&1&&(r(0,"div",77)(1,"span",18),l(2,"\u26A0\uFE0F"),s(),r(3,"span",78),l(4),s()()),i&2){let t=e.$implicit;c(4),D(t.description)}}function kU(i,e){if(i&1&&(r(0,"div",68)(1,"h4",75),l(2,"\u98A8\u96AA\u56E0\u7D20"),s(),r(3,"div",76),O(4,TU,5,1,"div",77,ct),s()()),i&2){let t=m(2);c(4),U(t.selectedUser().risk_factors.factors)}}function IU(i,e){if(i&1){let t=I();r(0,"button",79),x("click",function(){_(t);let o=m(2);return v(o.markAsAd(!0))}),l(1," \u{1F6AB} \u6A19\u8A18\u70BA\u5EE3\u544A\u865F "),s()}}function FU(i,e){if(i&1){let t=I();r(0,"button",80),x("click",function(){_(t);let o=m(2);return v(o.markAsAd(!1))}),l(1," \u2713 \u53D6\u6D88\u5EE3\u544A\u6A19\u8A18 "),s()}}function PU(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){_(t);let o=m(2);return v(o.blacklistUser(!0))}),l(1," \u26D4 \u52A0\u5165\u9ED1\u540D\u55AE "),s()}}function RU(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){_(t);let o=m(2);return v(o.blacklistUser(!1))}),l(1," \u21A9\uFE0F \u79FB\u51FA\u9ED1\u540D\u55AE "),s()}}function NU(i,e){if(i&1){let t=I();r(0,"button",82),x("click",function(){_(t);let o=m(2);return v(o.openInTelegram())}),l(1," \u{1F4AC} \u5728 Telegram \u67E5\u770B "),s()}}function VU(i,e){if(i&1){let t=I();r(0,"div",43)(1,"h3",58)(2,"span"),l(3,"\u{1F4CB}"),s(),l(4," \u7528\u6236\u8A73\u60C5 "),s(),r(5,"div",59)(6,"div",60)(7,"span",61),l(8,"Telegram ID"),s(),r(9,"span",62),l(10),s()(),y(11,MU,5,1,"div",60),r(12,"div",60)(13,"span",61),l(14,"\u59D3\u540D"),s(),r(15,"span",63),l(16),s()()(),r(17,"div",64)(18,"div",65)(19,"span",6),l(20,"\u5EE3\u544A\u98A8\u96AA"),s(),r(21,"span",56),l(22),s()(),r(23,"div",66),B(24,"div",67),s()(),y(25,kU,6,0,"div",68),r(26,"div",69),y(27,IU,2,0,"button",70)(28,FU,2,0,"button",71),y(29,PU,2,0,"button",72)(30,RU,2,0,"button",72),r(31,"button",73),x("click",function(){_(t);let o=m();return v(o.recalculateRisk())}),l(32," \u{1F504} \u91CD\u65B0\u8A08\u7B97\u98A8\u96AA "),s(),y(33,NU,2,0,"button",74),s()()}if(i&2){let t,n=m();c(10),D(n.selectedUser().telegram_id),c(),S(n.selectedUser().username?11:-1),c(5),X("",n.selectedUser().first_name," ",n.selectedUser().last_name),c(5),N("text-emerald-400",n.selectedUser().ad_risk_score<.4)("text-amber-400",n.selectedUser().ad_risk_score>=.4&&n.selectedUser().ad_risk_score<.7)("text-red-400",n.selectedUser().ad_risk_score>=.7),c(),M(" ",(n.selectedUser().ad_risk_score*100).toFixed(1),"% "),c(2),ee("width",n.selectedUser().ad_risk_score*100,"%"),N("bg-emerald-500",n.selectedUser().ad_risk_score<.4)("bg-amber-500",n.selectedUser().ad_risk_score>=.4&&n.selectedUser().ad_risk_score<.7)("bg-red-500",n.selectedUser().ad_risk_score>=.7),c(),S(!((t=n.selectedUser().risk_factors)==null||t.factors==null)&&t.factors.length?25:-1),c(2),S(n.selectedUser().is_ad_account?28:27),c(2),S(n.selectedUser().is_blacklisted?30:29),c(4),S(n.selectedUser().username?33:-1)}}var nd=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.confirmDialog=F(zt);this.users=f([]);this.stats=f(null);this.selectedUser=f(null);this.isLoading=f(!1);this.filterRisk="all";this.selectedValueLevels=[];this.filterHasUsername=!1;this.filterExcludeAds=!0;this.searchQuery="";this.listeners=[];this.filteredUsers=R(()=>{let e=this.users();if(this.filterRisk==="low"?e=e.filter(t=>t.ad_risk_score<.4):this.filterRisk==="medium"?e=e.filter(t=>t.ad_risk_score>=.4&&t.ad_risk_score<.7):this.filterRisk==="high"&&(e=e.filter(t=>t.ad_risk_score>=.7)),this.selectedValueLevels.length>0&&(e=e.filter(t=>this.selectedValueLevels.includes(t.value_level))),this.filterHasUsername&&(e=e.filter(t=>t.username)),this.filterExcludeAds&&(e=e.filter(t=>!t.is_ad_account)),this.searchQuery){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.username?.toLowerCase().includes(t)||n.first_name?.toLowerCase().includes(t)||n.telegram_id.includes(t))}return e})}ngOnInit(){this.setupListeners(),this.loadData()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupListeners(){let e=this.ipcService.on("collected-users-result",d=>{this.isLoading.set(!1),d.success&&this.users.set(d.users||[])});this.listeners.push(e);let t=this.ipcService.on("collected-users-stats-result",d=>{d.success&&this.stats.set(d.stats)});this.listeners.push(t);let n=this.ipcService.on("mark-user-as-ad-result",d=>{d.success&&(this.toastService.success(d.isAd?"\u5DF2\u6A19\u8A18\u70BA\u5EE3\u544A\u865F":"\u5DF2\u53D6\u6D88\u5EE3\u544A\u6A19\u8A18"),this.loadData())});this.listeners.push(n);let o=this.ipcService.on("blacklist-user-result",d=>{d.success&&(this.toastService.success(d.blacklisted?"\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE":"\u5DF2\u79FB\u51FA\u9ED1\u540D\u55AE"),this.loadData())});this.listeners.push(o);let a=this.ipcService.on("recalculate-risk-result",d=>{d.success&&(this.toastService.success(`\u98A8\u96AA\u8A55\u5206\u5DF2\u66F4\u65B0: ${(d.riskScore*100).toFixed(1)}%`),this.loadData())});this.listeners.push(a)}loadData(){this.isLoading.set(!0),this.ipcService.send("get-collected-users",{filters:{exclude_blacklist:!1,order_by:"last_seen_at DESC"},limit:500}),this.ipcService.send("get-collected-users-stats",{})}refreshData(){this.loadData()}onSearchChange(){}toggleValueLevel(e){let t=this.selectedValueLevels.indexOf(e);t>=0?this.selectedValueLevels.splice(t,1):this.selectedValueLevels.push(e)}selectUser(e){this.selectedUser.set(e)}markAsAd(e){let t=this.selectedUser();t&&this.ipcService.send("mark-user-as-ad",{telegramId:t.telegram_id,isAd:e})}blacklistUser(e){let t=this.selectedUser();t&&this.ipcService.send("blacklist-user",{telegramId:t.telegram_id,blacklist:e})}recalculateRisk(){let e=this.selectedUser();e&&this.ipcService.send("recalculate-user-risk",{telegramId:e.telegram_id})}openInTelegram(){let e=this.selectedUser();e?.username&&window.open(`https://t.me/${e.username}`,"_blank")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-collected-users"]],decls:107,vars:45,consts:[[1,"h-full","flex","flex-col","bg-slate-900","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-br","from-violet-500","to-purple-600","rounded-xl","flex","items-center","justify-center"],[1,"text-2xl"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-5","gap-4","mb-6"],[1,"bg-slate-800/50","rounded-xl","border","border-slate-700/50","p-4"],[1,"w-10","h-10","bg-violet-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-violet-400"],[1,"text-2xl","font-bold","text-violet-400"],[1,"text-xs","text-slate-500"],[1,"w-10","h-10","bg-emerald-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-emerald-400"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"w-10","h-10","bg-amber-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-amber-400"],[1,"text-2xl","font-bold","text-amber-400"],[1,"w-10","h-10","bg-red-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-red-400"],[1,"text-2xl","font-bold","text-red-400"],[1,"w-10","h-10","bg-cyan-500/20","rounded-lg","flex","items-center","justify-center"],[1,"text-cyan-400"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"bg-slate-800/30","rounded-xl","border","border-slate-700/50","p-4","mb-4"],[1,"flex","flex-wrap","items-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"flex","gap-1"],[1,"px-3","py-1","rounded","text-xs","transition-colors",3,"click"],[1,"w-7","h-7","rounded","text-xs","font-bold","transition-colors",3,"bg-violet-500/20","text-violet-400","bg-slate-700","text-slate-400"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-violet-500",3,"ngModelChange","ngModel"],[1,"flex-1"],[1,"relative"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-500"],["type","text","placeholder","\u641C\u7D22\u7528\u6236\u540D...",1,"pl-10","pr-4","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500","text-sm","w-48",3,"ngModelChange","ngModel"],[1,"flex-1","overflow-hidden","flex","gap-4"],[1,"flex-1","overflow-y-auto"],[1,"flex","items-center","justify-center","h-40"],[1,"flex","flex-col","items-center","justify-center","h-40","text-slate-500"],[1,"grid","gap-2"],[1,"w-96","bg-slate-800/30","rounded-xl","border","border-slate-700/50","p-4","overflow-y-auto"],[1,"w-7","h-7","rounded","text-xs","font-bold","transition-colors",3,"click"],[1,"animate-spin","w-8","h-8","border-4","border-violet-500","border-t-transparent","rounded-full"],[1,"text-4xl","mb-2"],[1,"text-sm"],[1,"p-4","rounded-xl","cursor-pointer","transition-all","border",3,"bg-violet-500/10","border-violet-500/50","bg-slate-800/50","border-slate-700/50","hover:bg-slate-700/50"],[1,"p-4","rounded-xl","cursor-pointer","transition-all","border",3,"click"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","text-lg"],[1,"flex-1","min-w-0"],[1,"font-medium","text-white","truncate"],[1,"text-xs"],[1,"flex","items-center","gap-3","text-xs","text-slate-400","mt-1"],[1,"text-right"],[1,"text-lg","font-bold"],[1,"text-xs","px-2","py-0.5","rounded"],[1,"text-lg","font-bold","text-white","mb-4","flex","items-center","gap-2"],[1,"space-y-3","mb-6"],[1,"flex","justify-between"],[1,"text-slate-400"],[1,"text-white","font-mono"],[1,"text-white"],[1,"bg-slate-700/30","rounded-lg","p-3","mb-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"w-full","h-2","bg-slate-600","rounded-full","overflow-hidden"],[1,"h-full","transition-all"],[1,"mb-4"],[1,"space-y-2"],[1,"w-full","px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors"],[1,"w-full","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","transition-colors"],[1,"w-full","px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors"],[1,"w-full","px-4","py-2","bg-violet-500/20","hover:bg-violet-500/30","text-violet-400","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","rounded-lg","transition-colors"],[1,"text-sm","font-medium","text-slate-300","mb-2"],[1,"space-y-1"],[1,"flex","items-center","gap-2","text-xs"],[1,"text-slate-300"],[1,"w-full","px-4","py-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-blue-500/20","hover:bg-blue-500/30","text-blue-400","rounded-lg","transition-colors",3,"click"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F465}"),s()(),r(6,"div")(7,"h1",5),l(8,"\u6536\u96C6\u7528\u6236"),s(),r(9,"p",6),l(10,"\u5F9E\u7FA4\u7D44\u81EA\u52D5\u6536\u96C6\u7684\u6D3B\u8E8D\u7528\u6236\uFF0C\u667A\u80FD\u8B58\u5225\u5EE3\u544A\u865F"),s()()(),r(11,"div",2)(12,"button",7),x("click",function(){return n.refreshData()}),r(13,"span"),l(14,"\u{1F504}"),s(),r(15,"span"),l(16,"\u5237\u65B0"),s()()()(),r(17,"div",8)(18,"div",9)(19,"div",2)(20,"div",10)(21,"span",11),l(22,"\u{1F465}"),s()(),r(23,"div")(24,"div",12),l(25),s(),r(26,"div",13),l(27,"\u7E3D\u6536\u96C6"),s()()()(),r(28,"div",9)(29,"div",2)(30,"div",14)(31,"span",15),l(32,"\u2713"),s()(),r(33,"div")(34,"div",16),l(35),s(),r(36,"div",13),l(37,"\u4F4E\u98A8\u96AA"),s()()()(),r(38,"div",9)(39,"div",2)(40,"div",17)(41,"span",18),l(42,"\u26A0"),s()(),r(43,"div")(44,"div",19),l(45),s(),r(46,"div",13),l(47,"\u4E2D\u98A8\u96AA"),s()()()(),r(48,"div",9)(49,"div",2)(50,"div",20)(51,"span",21),l(52,"\u{1F6AB}"),s()(),r(53,"div")(54,"div",22),l(55),s(),r(56,"div",13),l(57,"\u5EE3\u544A\u865F"),s()()()(),r(58,"div",9)(59,"div",2)(60,"div",23)(61,"span",24),l(62,"\u{1F48E}"),s()(),r(63,"div")(64,"div",25),l(65),s(),r(66,"div",13),l(67,"Premium"),s()()()()(),r(68,"div",26)(69,"div",27)(70,"div",28)(71,"span",6),l(72,"\u98A8\u96AA\u7B49\u7D1A:"),s(),r(73,"div",29)(74,"button",30),x("click",function(){return n.filterRisk="all"}),l(75," \u5168\u90E8 "),s(),r(76,"button",30),x("click",function(){return n.filterRisk="low"}),l(77," \u{1F7E2} \u5B89\u5168 "),s(),r(78,"button",30),x("click",function(){return n.filterRisk="medium"}),l(79," \u{1F7E1} \u53EF\u7591 "),s(),r(80,"button",30),x("click",function(){return n.filterRisk="high"}),l(81," \u{1F534} \u9AD8\u5371 "),s()()(),r(82,"div",28)(83,"span",6),l(84,"\u50F9\u503C:"),s(),r(85,"div",29),O(86,fU,2,9,"button",31,be),s()(),r(88,"label",32)(89,"input",33),W("ngModelChange",function(a){return q(n.filterHasUsername,a)||(n.filterHasUsername=a),a}),s(),r(90,"span",6),l(91,"\u6709\u7528\u6236\u540D"),s()(),r(92,"label",32)(93,"input",33),W("ngModelChange",function(a){return q(n.filterExcludeAds,a)||(n.filterExcludeAds=a),a}),s(),r(94,"span",6),l(95,"\u6392\u9664\u5EE3\u544A\u865F"),s()(),B(96,"div",34),r(97,"div",35)(98,"span",36),l(99,"\u{1F50D}"),s(),r(100,"input",37),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),x("ngModelChange",function(){return n.onSearchChange()}),s()()()(),r(101,"div",38)(102,"div",39),y(103,_U,2,0,"div",40)(104,vU,7,0,"div",41)(105,AU,3,0,"div",42),s(),y(106,VU,34,23,"div",43),s()()),t&2){let o,a,d,u,p;c(13),N("animate-spin",n.isLoading()),c(12),D(((o=n.stats())==null?null:o.total)||0),c(10),D(((a=n.stats())==null||a.by_risk==null?null:a.by_risk.low)||0),c(10),D(((d=n.stats())==null||d.by_risk==null?null:d.by_risk.medium)||0),c(10),D(((u=n.stats())==null?null:u.ad_accounts)||0),c(10),D(((p=n.stats())==null?null:p.premium)||0),c(9),N("bg-violet-500/20",n.filterRisk==="all")("text-violet-400",n.filterRisk==="all")("bg-slate-700",n.filterRisk!=="all")("text-slate-400",n.filterRisk!=="all"),c(2),N("bg-emerald-500/20",n.filterRisk==="low")("text-emerald-400",n.filterRisk==="low")("bg-slate-700",n.filterRisk!=="low")("text-slate-400",n.filterRisk!=="low"),c(2),N("bg-amber-500/20",n.filterRisk==="medium")("text-amber-400",n.filterRisk==="medium")("bg-slate-700",n.filterRisk!=="medium")("text-slate-400",n.filterRisk!=="medium"),c(2),N("bg-red-500/20",n.filterRisk==="high")("text-red-400",n.filterRisk==="high")("bg-slate-700",n.filterRisk!=="high")("text-slate-400",n.filterRisk!=="high"),c(6),U(rt(44,gU)),c(3),H("ngModel",n.filterHasUsername),c(4),H("ngModel",n.filterExcludeAds),c(7),H("ngModel",n.searchQuery),c(3),S(n.isLoading()?103:n.filteredUsers().length===0?104:105),c(3),S(n.selectedUser()?106:-1)}},dependencies:[oe,ae,xe,it,ve,he],encapsulation:2})}};var BU=(i,e)=>e.id;function LU(i,e){if(i&1){let t=I();r(0,"button",5),x("click",function(){let o=_(t).$implicit,a=m();return v(a.switchTab(o.id))}),l(1),s()}if(i&2){let t=e.$implicit,n=m();N("bg-gradient-to-r",n.activeTab()===t.id)("from-cyan-500",n.activeTab()===t.id)("to-blue-500",n.activeTab()===t.id)("text-white",n.activeTab()===t.id)("text-slate-400",n.activeTab()!==t.id)("bg-slate-800/50",n.activeTab()!==t.id),c(),X(" ",t.icon," ",t.label," ")}}function OU(i,e){i&1&&B(0,"app-monitoring-accounts")}function UU(i,e){if(i&1){let t=I();r(0,"app-monitoring-groups",6),x("extractMembersEvent",function(o){_(t);let a=m();return v(a.openMemberExtractionDialog(o))}),s()}}function GU(i,e){i&1&&B(0,"app-keyword-sets")}function $U(i,e){i&1&&B(0,"app-trigger-rules")}function HU(i,e){i&1&&B(0,"app-chat-templates")}function qU(i,e){i&1&&B(0,"app-collected-users")}var WU={monitoring:"groups","monitoring-accounts":"accounts","monitoring-groups":"groups","keyword-sets":"keywords","chat-templates":"templates","trigger-rules":"rules","collected-users":"collected"},zU={accounts:"monitoring-accounts",groups:"monitoring-groups",keywords:"keyword-sets",templates:"chat-templates",rules:"trigger-rules",collected:"collected-users"},id=class i{constructor(){this.i18n=F(Be);this.nav=F(Je);this.ipc=F(Q);this.toast=F(J);this.dialog=F(st);this.membershipService=F(Ie);this.accountService=F(pt);this.monitoringState=F(Ct);this.tabs=[{id:"accounts",icon:"\u{1F464}",label:"\u76E3\u63A7\u5E33\u865F"},{id:"groups",icon:"\u{1F465}",label:"\u76E3\u63A7\u7FA4\u7D44"},{id:"keywords",icon:"\u{1F511}",label:"\u95DC\u9375\u8A5E\u96C6"},{id:"rules",icon:"\u26A1",label:"\u89F8\u767C\u898F\u5247"},{id:"templates",icon:"\u{1F4AC}",label:"\u6D88\u606F\u6A21\u677F"},{id:"collected",icon:"\u{1F4E5}",label:"\u6536\u96C6\u7528\u6236"}];this.activeTab=f("groups");this.ipcCleanup=[];this.viewSyncEffect=gt(()=>{let e=this.nav.currentView(),t=WU[e];t&&t!==this.activeTab()&&(console.log(`[MonitoringView] \u8996\u5716\u5207\u63DB: ${e} \u2192 Tab: ${t}`),this.activeTab.set(t))})}ngOnInit(){this.setupIpcListeners()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("monitoring-group-added",()=>{this.toast.success("\u7FA4\u7D44\u5DF2\u6DFB\u52A0")}),t=this.ipc.on("keyword-set-added",()=>{this.toast.success("\u95DC\u9375\u8A5E\u96C6\u5DF2\u6DFB\u52A0")});this.ipcCleanup.push(e,t)}selectAccount(e){console.log("Selected account:",e)}selectGroup(e){console.log("Selected group:",e)}selectKeywordSet(e){console.log("Selected keyword set:",e)}selectRule(e){console.log("Selected rule:",e)}selectTemplate(e){console.log("Selected template:",e)}addGroup(){this.dialog.openJoinMonitor({})}addKeywordSet(){this.ipc.send("open-add-keyword-set-dialog")}addRule(){this.ipc.send("open-add-rule-dialog")}addTemplate(){this.ipc.send("open-add-template-dialog")}switchTab(e){this.activeTab.set(e);let t=zU[e];t&&this.nav.currentView()!==t&&this.nav.navigateTo(t)}t(e,t){return this.i18n.t(e,t)}openMemberExtractionDialog(e){console.log("[MonitoringView] Opening member extraction dialog for:",e),this.dialog.openMemberExtraction(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-monitoring-view"]],decls:13,vars:1,consts:[[1,"page-content"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-4xl","font-bold",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-2"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","text-slate-400","bg-slate-800/50"],[1,"px-4","py-2","rounded-lg","text-sm","font-medium","transition-all",3,"click"],[3,"extractMembersEvent"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"\u76E3\u63A7\u4E2D\u5FC3"),s(),r(4,"div",3),O(5,LU,2,14,"button",4,BU),s()(),y(7,OU,1,0,"app-monitoring-accounts")(8,UU,1,0,"app-monitoring-groups")(9,GU,1,0,"app-keyword-sets")(10,$U,1,0,"app-trigger-rules")(11,HU,1,0,"app-chat-templates")(12,qU,1,0,"app-collected-users"),s()),t&2){let o;c(5),U(n.tabs),c(2),S((o=n.activeTab())==="accounts"?7:o==="groups"?8:o==="keywords"?9:o==="rules"?10:o==="templates"?11:o==="collected"?12:-1)}},dependencies:[oe,ae,Jc,Qc,Xc,ed,td,nd],encapsulation:2,changeDetection:0})}};var KU=(i,e)=>e.api_id;function jU(i,e){i&1&&(r(0,"span",37),l(1,"\u23F3"),s(),l(2," \u4FDD\u5B58\u4E2D... "))}function JU(i,e){i&1&&(r(0,"span"),l(1,"\u2795"),s(),l(2," \u6DFB\u52A0 "))}function QU(i,e){i&1&&(r(0,"div",34)(1,"div",38),l(2,"\u23F3"),s(),r(3,"p",39),l(4,"\u6B63\u5728\u52A0\u8F09..."),s()())}function YU(i,e){i&1&&(r(0,"div",34)(1,"div",40),l(2,"\u{1F4ED}"),s(),r(3,"p",41),l(4,"\u9084\u6C92\u6709\u4EFB\u4F55 API \u6191\u64DA"),s(),r(5,"p",39),l(6,"\u8ACB\u5728\u4E0A\u65B9\u8868\u55AE\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B API"),s()())}function XU(i,e){i&1&&(r(0,"span",46),l(1,"\u516C\u5171"),s())}function ZU(i,e){i&1&&(r(0,"span",47),l(1,"\u624B\u52D5\u6DFB\u52A0"),s())}function eG(i,e){if(i&1){let t=I();r(0,"button",52),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.toggleCredential(o.api_id,!o.is_active))}),l(1),s(),r(2,"button",53),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.confirmDelete(o))}),l(3," \u522A\u9664 "),s()}if(i&2){let t=m().$implicit;N("bg-green-500/20",!t.is_active)("text-green-400",!t.is_active)("hover:bg-green-500/30",!t.is_active)("bg-amber-500/20",t.is_active)("text-amber-400",t.is_active)("hover:bg-amber-500/30",t.is_active),c(),M(" ",t.is_active?"\u505C\u7528":"\u555F\u7528"," ")}}function tG(i,e){if(i&1&&(r(0,"div",42)(1,"div",2),B(2,"div",43),r(3,"div")(4,"div",44)(5,"span",45),l(6),s(),y(7,XU,2,0,"span",46),y(8,ZU,2,0,"span",47),s(),r(9,"div",12),l(10),s()()(),r(11,"div",2)(12,"div",48)(13,"div",49),l(14),s(),r(15,"div",50),B(16,"div",51),s()(),r(17,"div",44),y(18,eG,4,13),s()()()),i&2){let t=e.$implicit;c(2),N("bg-green-500",t.is_active)("bg-slate-500",!t.is_active),c(4),D(t.name),c(),S(t.is_public?7:-1),c(),S(t.source==="manual"?8:-1),c(2),cn(" ID: ",t.api_id," \u2022 Hash: ",t.api_hash.slice(0,8),"...",t.api_hash.slice(-4)," "),c(3),N("text-green-400",t.account_count<t.max_accounts*.8)("text-amber-400",t.account_count>=t.max_accounts*.8&&t.account_count<t.max_accounts)("text-red-400",t.account_count>=t.max_accounts),c(),X(" ",t.account_count,"/",t.max_accounts," \u5E33\u865F "),c(2),ee("width",t.account_count/t.max_accounts*100,"%"),N("bg-green-500",t.account_count<t.max_accounts*.8)("bg-amber-500",t.account_count>=t.max_accounts*.8&&t.account_count<t.max_accounts)("bg-red-500",t.account_count>=t.max_accounts),c(2),S(t.is_public?-1:18)}}function nG(i,e){if(i&1&&(r(0,"div",35),O(1,tG,19,27,"div",42,KU),s()),i&2){let t=m();c(),U(t.credentials())}}function iG(i,e){if(i&1&&(B(0,"br"),r(1,"span",62),l(2),s()),i&2){let t=m(2);c(2),M("\u26A0\uFE0F \u6B64 API \u76EE\u524D\u6709 ",t.deleteTarget().account_count," \u500B\u5E33\u865F\u5728\u4F7F\u7528\u3002")}}function oG(i,e){if(i&1){let t=I();r(0,"div",54),x("click",function(){_(t);let o=m();return v(o.cancelDelete())}),r(1,"div",55),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"h3",56),l(3,"\u78BA\u8A8D\u522A\u9664"),s(),r(4,"p",57),l(5," \u78BA\u5B9A\u8981\u522A\u9664 API\u300C"),r(6,"span",58),l(7),s(),l(8,"\u300D\u55CE\uFF1F "),y(9,iG,3,1),s(),r(10,"div",59)(11,"button",60),x("click",function(){_(t);let o=m();return v(o.cancelDelete())}),l(12," \u53D6\u6D88 "),s(),r(13,"button",61),x("click",function(){_(t);let o=m();return v(o.doDelete())}),l(14," \u78BA\u8A8D\u522A\u9664 "),s()()()()}if(i&2){let t=m();c(7),D(t.deleteTarget().name),c(2),S(t.deleteTarget().account_count>0?9:-1)}}var od=class i{constructor(){this.ipc=F(Q);this.toast=F(J);this.nav=F(Je);this.credentials=f([]);this.isLoading=f(!0);this.isSaving=f(!1);this.deleteTarget=f(null);this.newApiId="";this.newApiHash="";this.newApiName="";this.activeCount=()=>this.credentials().filter(e=>e.is_active&&!e.is_public).length;this.totalAccountsUsed=()=>this.credentials().reduce((e,t)=>e+t.account_count,0);this.totalCapacity=()=>this.credentials().filter(e=>!e.is_public).reduce((e,t)=>e+t.max_accounts,0);this.ipcCleanup=[]}ngOnInit(){this.setupIpcListeners(),this.refreshList()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("api-credentials-updated",a=>{this.isLoading.set(!1),a.credentials&&this.credentials.set(a.credentials)}),t=this.ipc.on("api-credential-added",a=>{this.isSaving.set(!1),a.success?(this.toast.success("\u2705 API \u6191\u64DA\u6DFB\u52A0\u6210\u529F\uFF01"),this.clearForm()):this.toast.error(`\u6DFB\u52A0\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`)}),n=this.ipc.on("api-credential-removed",a=>{a.success?this.toast.success("\u{1F5D1}\uFE0F API \u6191\u64DA\u5DF2\u522A\u9664"):this.toast.error(`\u522A\u9664\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`)}),o=this.ipc.on("api-credential-toggled",a=>{a.success?this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0"):this.toast.error(`\u64CD\u4F5C\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`)});this.ipcCleanup.push(e,t,n,o)}refreshList(){this.isLoading.set(!0),this.ipc.send("get-api-credentials",{})}isFormValid(){let e=this.newApiId.trim(),t=this.newApiHash.trim();return e.length>0&&/^\d+$/.test(e)&&t.length===32&&/^[a-f0-9]{32}$/i.test(t)}addCredential(){if(!this.isFormValid()){this.toast.error("\u8ACB\u6AA2\u67E5 API ID \u548C API Hash \u683C\u5F0F");return}this.isSaving.set(!0),this.ipc.send("add-api-credential",{api_id:this.newApiId.trim(),api_hash:this.newApiHash.trim(),name:this.newApiName.trim()||`API_${this.newApiId.slice(-4)}`,source:"manual",max_accounts:5})}clearForm(){this.newApiId="",this.newApiHash="",this.newApiName=""}toggleCredential(e,t){this.ipc.send("toggle-api-credential",{api_id:e,is_active:t})}confirmDelete(e){this.deleteTarget.set(e)}cancelDelete(){this.deleteTarget.set(null)}doDelete(){let e=this.deleteTarget();e&&(this.ipc.send("remove-api-credential",{api_id:e.api_id}),this.deleteTarget.set(null))}goBack(){this.nav.navigateTo("accounts")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-api-credentials-view"]],decls:80,vars:14,consts:[[1,"max-w-6xl","mx-auto"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-2","text-slate-400","hover:text-white","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"flex","items-center","gap-2","px-4","py-2","bg-slate-800","hover:bg-slate-700","rounded-lg","transition-colors",3,"click","disabled"],[1,"text-3xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-8"],[1,"grid","grid-cols-4","gap-4","mb-8"],[1,"bg-gradient-to-br","from-cyan-500/10","to-blue-500/10","border","border-cyan-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400"],[1,"bg-gradient-to-br","from-green-500/10","to-emerald-500/10","border","border-green-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-green-400"],[1,"bg-gradient-to-br","from-amber-500/10","to-orange-500/10","border","border-amber-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-amber-400"],[1,"bg-gradient-to-br","from-purple-500/10","to-pink-500/10","border","border-purple-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-purple-400"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","rounded-xl","p-6","mb-8"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-slate-400","mb-1"],[1,"text-red-400"],["type","text","placeholder","\u4F8B\u5982: 12345678",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","text","placeholder","32\u4F4D\u5341\u516D\u9032\u5236\u5B57\u7B26\u4E32",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4F8B\u5982: \u4E3B\u529B API",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","items-end"],[1,"w-full","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-600","hover:to-blue-600","disabled:from-slate-600","disabled:to-slate-600","disabled:cursor-not-allowed","text-white","font-bold","py-2","px-4","rounded-lg","transition-all","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"mt-3","text-sm","text-slate-500","flex","items-center","gap-2"],["href","https://my.telegram.org","target","_blank",1,"text-cyan-400","hover:underline"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","rounded-xl","overflow-hidden"],[1,"p-4","border-b","border-slate-700"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"p-12","text-center"],[1,"divide-y","divide-slate-700"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"animate-spin"],[1,"animate-spin","text-4xl","mb-4"],[1,"text-slate-400"],[1,"text-6xl","mb-4"],[1,"text-xl","font-medium","text-white","mb-2"],[1,"p-4","hover:bg-slate-800/50","transition-colors","flex","items-center","justify-between"],[1,"w-3","h-3","rounded-full"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white"],[1,"text-xs","bg-amber-500/20","text-amber-400","px-2","py-0.5","rounded"],[1,"text-xs","bg-cyan-500/20","text-cyan-400","px-2","py-0.5","rounded"],[1,"text-right"],[1,"text-sm","font-medium"],[1,"w-24","h-1.5","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","transition-all"],[1,"px-3","py-1.5","rounded-lg","text-sm","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","text-red-400","hover:bg-red-500/30","rounded-lg","text-sm","transition-colors",3,"click"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-xl","p-6","max-w-md","w-full","mx-4",3,"click"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"text-slate-400","mb-6"],[1,"text-white"],[1,"flex","gap-3"],[1,"flex-1","px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2","bg-red-500","hover:bg-red-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"text-amber-400"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),x("click",function(){return n.goBack()}),ne(),r(4,"svg",4),B(5,"path",5),s(),l(6," \u8FD4\u56DE\u5E33\u865F\u7BA1\u7406 "),s()(),ce(),r(7,"button",6),x("click",function(){return n.refreshList()}),r(8,"span"),l(9,"\u{1F504}"),s(),l(10," \u5237\u65B0 "),s()(),r(11,"h1",7),l(12,"\u{1F510} API \u6191\u64DA\u6C60"),s(),r(13,"p",8),l(14,"\u7BA1\u7406\u60A8\u7684 Telegram API \u6191\u64DA\uFF0C\u6DFB\u52A0\u81EA\u5B9A\u7FA9 API \u4EE5\u7372\u5F97\u66F4\u597D\u7684\u7A69\u5B9A\u6027"),s(),r(15,"div",9)(16,"div",10)(17,"div",11),l(18),s(),r(19,"div",12),l(20,"\u7E3D API \u6578\u91CF"),s()(),r(21,"div",13)(22,"div",14),l(23),s(),r(24,"div",12),l(25,"\u6D3B\u8E8D\u4E2D"),s()(),r(26,"div",15)(27,"div",16),l(28),s(),r(29,"div",12),l(30,"\u5DF2\u7D81\u5B9A\u5E33\u865F"),s()(),r(31,"div",17)(32,"div",18),l(33),s(),r(34,"div",12),l(35,"\u7E3D\u5BB9\u91CF"),s()()(),r(36,"div",19)(37,"h3",20)(38,"span"),l(39,"\u2795"),s(),l(40," \u6DFB\u52A0\u65B0 API \u6191\u64DA "),s(),r(41,"div",21)(42,"div")(43,"label",22),l(44,"API ID "),r(45,"span",23),l(46,"*"),s()(),r(47,"input",24),W("ngModelChange",function(a){return q(n.newApiId,a)||(n.newApiId=a),a}),s()(),r(48,"div")(49,"label",22),l(50,"API Hash "),r(51,"span",23),l(52,"*"),s()(),r(53,"input",25),W("ngModelChange",function(a){return q(n.newApiHash,a)||(n.newApiHash=a),a}),s()(),r(54,"div")(55,"label",22),l(56,"\u540D\u7A31\uFF08\u53EF\u9078\uFF09"),s(),r(57,"input",26),W("ngModelChange",function(a){return q(n.newApiName,a)||(n.newApiName=a),a}),s()(),r(58,"div",27)(59,"button",28),x("click",function(){return n.addCredential()}),y(60,jU,3,0)(61,JU,3,0),s()()(),r(62,"div",29)(63,"span"),l(64,"\u{1F4A1}"),s(),r(65,"span"),l(66,"\u524D\u5F80 "),r(67,"a",30),l(68,"my.telegram.org"),s(),l(69," \u7533\u8ACB\u60A8\u81EA\u5DF1\u7684 API \u6191\u64DA"),s()()(),r(70,"div",31)(71,"div",32)(72,"h3",33)(73,"span"),l(74,"\u{1F4CB}"),s(),l(75," \u6211\u7684 API \u5217\u8868 "),s()(),y(76,QU,5,0,"div",34)(77,YU,7,0,"div",34)(78,nG,3,0,"div",35),s(),y(79,oG,15,2,"div",36),s()),t&2&&(c(7),L("disabled",n.isLoading()),c(),N("animate-spin",n.isLoading()),c(10),D(n.credentials().length),c(5),D(n.activeCount()),c(5),D(n.totalAccountsUsed()),c(5),D(n.totalCapacity()),c(14),H("ngModel",n.newApiId),c(6),H("ngModel",n.newApiHash),c(4),H("ngModel",n.newApiName),c(2),L("disabled",!n.isFormValid()||n.isSaving()),c(),S(n.isSaving()?60:61),c(16),S(n.isLoading()?76:n.credentials().length===0?77:78),c(3),S(n.deleteTarget()?79:-1))},dependencies:[oe,ae,xe,ve,he],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}};var rG=()=>["bronze","silver"],sG=()=>["bronze","silver","gold"],aG=(i,e)=>e.id;function lG(i,e){if(i&1&&(r(0,"p",10),l(1),r(2,"span",25),l(3),s()()),i&2){let t=m();c(),M(" \u6709\u6548\u671F\u81F3 ",t.formatDate(t.membershipExpires())," "),c(2),M("(\u5269\u9918 ",t.membershipDaysLeft()," \u5929)")}}function cG(i,e){i&1&&(r(0,"p",10),l(1,"\u6C38\u4E45\u514D\u8CBB\u7248"),s())}function dG(i,e){if(i&1){let t=I();r(0,"button",26),x("click",function(){_(t);let o=m();return v(o.activeTab.set("upgrade"))}),l(1," \u{1F680} \u7ACB\u5373\u5347\u7D1A "),s()}}function uG(i,e){if(i&1){let t=I();r(0,"div",24)(1,"div",27)(2,"h3",28),l(3,"\u{1F4CA} \u672C\u6708\u4F7F\u7528\u8A73\u60C5"),s(),r(4,"div",29)(5,"div",30)(6,"span",31),l(7,"\u{1F916} AI \u8ABF\u7528\u6B21\u6578"),s(),r(8,"div",32)(9,"div",33),B(10,"div",34),s()(),r(11,"span",35),l(12),s()(),r(13,"div",30)(14,"span",31),l(15,"\u{1F4E8} \u6D88\u606F\u767C\u9001"),s(),r(16,"div",32)(17,"div",33),B(18,"div",34),s()(),r(19,"span",35),l(20),s()(),r(21,"div",30)(22,"span",31),l(23,"\u{1F465} \u5E33\u865F\u6578\u91CF"),s(),r(24,"div",32)(25,"div",33),B(26,"div",34),s()(),r(27,"span",35),l(28),s()(),r(29,"div",30)(30,"span",31),l(31,"\u{1F4BE} \u5B58\u5132\u7A7A\u9593"),s(),r(32,"div",32)(33,"div",33),B(34,"div",34),s()(),r(35,"span",35),l(36),s()()()(),r(37,"div",36)(38,"h3",28),l(39,"\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5"),s(),r(40,"p",37),l(41,"\u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 "),r(42,"strong"),l(43,"3 \u5929\u767D\u9280\u7CBE\u82F1"),s(),l(44," \u734E\u52F5\uFF01"),s(),r(45,"div",38)(46,"span",39),l(47,"\u6211\u7684\u9080\u8ACB\u78BC"),s(),r(48,"span",40),l(49),s(),r(50,"button",41),x("click",function(){_(t);let o=m();return v(o.copyInviteCode())}),l(51,"\u{1F4CB} \u8907\u88FD"),s()(),r(52,"div",42)(53,"div",43)(54,"span",44),l(55),s(),r(56,"span",39),l(57,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),s()(),r(58,"div",43)(59,"span",44),l(60),s(),r(61,"span",39),l(62,"\u7372\u5F97\u734E\u52F5\u5929\u6578"),s()()()()()}if(i&2){let t,n,o,a,d=m();c(10),ee("width",d.getAiUsagePercent(),"%"),c(2),X("",((t=d.usageStats())==null||t.aiCalls==null?null:t.aiCalls.used)||0," / ",((t=d.usageStats())==null||t.aiCalls==null?null:t.aiCalls.limit)||50),c(6),ee("width",d.getMessageUsagePercent(),"%"),c(2),X("",((n=d.usageStats())==null||n.messagesSent==null?null:n.messagesSent.used)||0," / ",((n=d.usageStats())==null||n.messagesSent==null?null:n.messagesSent.limit)||100),c(6),ee("width",d.getAccountUsagePercent(),"%"),c(2),X("",((o=d.usageStats())==null||o.accounts==null?null:o.accounts.used)||0," / ",((o=d.usageStats())==null||o.accounts==null?null:o.accounts.limit)||2),c(6),ee("width",d.getStorageUsagePercent(),"%"),c(2),X("",((a=d.usageStats())==null||a.storage==null?null:a.storage.used)||0," MB / ",((a=d.usageStats())==null||a.storage==null?null:a.storage.limit)||10," MB"),c(13),D(d.inviteCode()),c(6),D(d.invitedCount()),c(5),D(d.rewardDays())}}function mG(i,e){i&1&&(r(0,"div",24)(1,"div",45)(2,"table",46)(3,"thead")(4,"tr")(5,"th",47),l(6,"\u529F\u80FD"),s(),r(7,"th",48),l(8,"\u2694\uFE0F \u9752\u9285"),s(),r(9,"th",49),l(10,"\u{1F948} \u767D\u9280"),s(),r(11,"th",50),l(12,"\u{1F947} \u9EC3\u91D1"),s(),r(13,"th",51),l(14,"\u{1F48E} \u947D\u77F3"),s(),r(15,"th",52),l(16,"\u{1F31F} \u661F\u8000"),s(),r(17,"th",53),l(18,"\u{1F451} \u738B\u8005"),s()()(),r(19,"tbody")(20,"tr")(21,"td",54),l(22,"\u5E33\u865F\u6578\u91CF"),s(),r(23,"td"),l(24,"2 \u500B"),s(),r(25,"td"),l(26,"5 \u500B"),s(),r(27,"td"),l(28,"10 \u500B"),s(),r(29,"td"),l(30,"20 \u500B"),s(),r(31,"td"),l(32,"50 \u500B"),s(),r(33,"td"),l(34,"\u7121\u9650"),s()(),r(35,"tr")(36,"td",54),l(37,"\u6BCF\u65E5\u6D88\u606F"),s(),r(38,"td"),l(39,"20 \u689D"),s(),r(40,"td"),l(41,"100 \u689D"),s(),r(42,"td"),l(43,"300 \u689D"),s(),r(44,"td"),l(45,"1,000 \u689D"),s(),r(46,"td"),l(47,"\u7121\u9650"),s(),r(48,"td"),l(49,"\u7121\u9650"),s()(),r(50,"tr")(51,"td",54),l(52,"\u6BCF\u65E5 AI \u8ABF\u7528"),s(),r(53,"td"),l(54,"10 \u6B21"),s(),r(55,"td"),l(56,"50 \u6B21"),s(),r(57,"td"),l(58,"200 \u6B21"),s(),r(59,"td"),l(60,"\u7121\u9650"),s(),r(61,"td"),l(62,"\u7121\u9650"),s(),r(63,"td"),l(64,"\u7121\u9650"),s()(),r(65,"tr")(66,"td",54),l(67,"\u7FA4\u7D44\u6578\u91CF"),s(),r(68,"td"),l(69,"3 \u500B"),s(),r(70,"td"),l(71,"10 \u500B"),s(),r(72,"td"),l(73,"30 \u500B"),s(),r(74,"td"),l(75,"100 \u500B"),s(),r(76,"td"),l(77,"\u7121\u9650"),s(),r(78,"td"),l(79,"\u7121\u9650"),s()(),r(80,"tr")(81,"td",54),l(82,"\u5EE3\u544A\u767C\u9001"),s(),r(83,"td"),l(84,"\u274C"),s(),r(85,"td"),l(86,"\u2705"),s(),r(87,"td"),l(88,"\u2705"),s(),r(89,"td"),l(90,"\u2705"),s(),r(91,"td"),l(92,"\u2705"),s(),r(93,"td"),l(94,"\u2705"),s()(),r(95,"tr")(96,"td",54),l(97,"\u6279\u91CF\u64CD\u4F5C"),s(),r(98,"td"),l(99,"\u274C"),s(),r(100,"td"),l(101,"\u274C"),s(),r(102,"td"),l(103,"\u2705"),s(),r(104,"td"),l(105,"\u2705"),s(),r(106,"td"),l(107,"\u2705"),s(),r(108,"td"),l(109,"\u2705"),s()(),r(110,"tr")(111,"td",54),l(112,"AI \u92B7\u552E\u6F0F\u6597"),s(),r(113,"td"),l(114,"\u274C"),s(),r(115,"td"),l(116,"\u274C"),s(),r(117,"td"),l(118,"\u274C"),s(),r(119,"td"),l(120,"\u2705"),s(),r(121,"td"),l(122,"\u2705"),s(),r(123,"td"),l(124,"\u2705"),s()(),r(125,"tr")(126,"td",54),l(127,"\u667A\u80FD\u9632\u5C01"),s(),r(128,"td"),l(129,"\u274C"),s(),r(130,"td"),l(131,"\u274C"),s(),r(132,"td"),l(133,"\u274C"),s(),r(134,"td"),l(135,"\u274C"),s(),r(136,"td"),l(137,"\u2705"),s(),r(138,"td"),l(139,"\u2705"),s()(),r(140,"tr")(141,"td",54),l(142,"API \u63A5\u53E3"),s(),r(143,"td"),l(144,"\u274C"),s(),r(145,"td"),l(146,"\u274C"),s(),r(147,"td"),l(148,"\u274C"),s(),r(149,"td"),l(150,"\u274C"),s(),r(151,"td"),l(152,"\u274C"),s(),r(153,"td"),l(154,"\u2705"),s()(),r(155,"tr")(156,"td",54),l(157,"\u512A\u5148\u652F\u6301"),s(),r(158,"td"),l(159,"\u274C"),s(),r(160,"td"),l(161,"\u274C"),s(),r(162,"td"),l(163,"\u274C"),s(),r(164,"td"),l(165,"\u274C"),s(),r(166,"td"),l(167,"\u2705"),s(),r(168,"td"),l(169,"\u2705 \u5C08\u5C6C"),s()(),r(170,"tr",55)(171,"td",54),l(172,"\u50F9\u683C"),s(),r(173,"td",56),l(174,"\u514D\u8CBB"),s(),r(175,"td",56),l(176,"4.99 USDT/\u6708"),s(),r(177,"td",56),l(178,"19.9 USDT/\u6708"),s(),r(179,"td",56),l(180,"59.9 USDT/\u6708"),s(),r(181,"td",56),l(182,"199 USDT/\u6708"),s(),r(183,"td",56),l(184,"599 USDT/\u6708"),s()()()()()())}function pG(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function gG(i,e){if(i&1){let t=I();r(0,"button",80),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("silver","month"))}),l(1),s()}if(i&2){let t=m(2);c(),M(" ",t.membershipLevel()==="bronze"?"\u7ACB\u5373\u958B\u901A":"\u5207\u63DB\u65B9\u6848"," ")}}function hG(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("silver","month"))}),l(1," \u7E8C\u8CBB "),s()}}function fG(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function _G(i,e){if(i&1){let t=I();r(0,"button",80),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("gold","month"))}),l(1),s()}if(i&2){let t=m(2);c(),M(" ",rt(1,rG).includes(t.membershipLevel())?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function vG(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("gold","month"))}),l(1," \u7E8C\u8CBB "),s()}}function xG(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function CG(i,e){if(i&1){let t=I();r(0,"button",80),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("diamond","month"))}),l(1),s()}if(i&2){let t=m(2);c(),M(" ",rt(1,sG).includes(t.membershipLevel())?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function bG(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("diamond","month"))}),l(1," \u7E8C\u8CBB "),s()}}function yG(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function SG(i,e){if(i&1){let t=I();r(0,"button",80),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("star","month"))}),l(1),s()}if(i&2){let t=m(2);c(),M(" ",t.membershipLevel()!=="king"?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function wG(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("star","month"))}),l(1," \u7E8C\u8CBB "),s()}}function EG(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function DG(i,e){if(i&1){let t=I();r(0,"button",80),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("king","month"))}),l(1," \u7D42\u6975\u5347\u7D1A "),s()}}function AG(i,e){if(i&1){let t=I();r(0,"button",81),x("click",function(){_(t);let o=m(2);return v(o.onPurchase("king","month"))}),l(1," \u7E8C\u8CBB "),s()}}function MG(i,e){if(i&1){let t=I();r(0,"div",24)(1,"div",57)(2,"div",58),y(3,pG,2,0,"div",59),r(4,"div",60),l(5,"\u{1F948}"),s(),r(6,"h3",61),l(7,"\u767D\u9280\u7CBE\u82F1"),s(),r(8,"div",62)(9,"span",63),l(10,"4.99 USDT"),s(),r(11,"span",64),l(12,"/\u6708"),s()(),r(13,"ul",65)(14,"li"),l(15,"\u2705 5 \u500B\u5E33\u865F"),s(),r(16,"li"),l(17,"\u2705 \u6BCF\u65E5 100 \u689D\u6D88\u606F"),s(),r(18,"li"),l(19,"\u2705 \u6BCF\u65E5 50 \u6B21 AI"),s(),r(20,"li"),l(21,"\u2705 10 \u500B\u7FA4\u7D44"),s(),r(22,"li"),l(23,"\u2705 \u5EE3\u544A\u767C\u9001"),s()(),y(24,gG,2,1,"button",66)(25,hG,2,0,"button",67),s(),r(26,"div",68),y(27,fG,2,0,"div",59),r(28,"div",60),l(29,"\u{1F947}"),s(),r(30,"h3",61),l(31,"\u9EC3\u91D1\u5927\u5E2B"),s(),r(32,"div",62)(33,"span",63),l(34,"19.9 USDT"),s(),r(35,"span",64),l(36,"/\u6708"),s()(),r(37,"ul",65)(38,"li"),l(39,"\u2705 15 \u500B\u5E33\u865F"),s(),r(40,"li"),l(41,"\u2705 \u6BCF\u65E5 500 \u689D\u6D88\u606F"),s(),r(42,"li"),l(43,"\u2705 \u6BCF\u65E5 300 \u6B21 AI"),s(),r(44,"li"),l(45,"\u2705 50 \u500B\u7FA4\u7D44"),s(),r(46,"li"),l(47,"\u2705 \u6279\u91CF\u64CD\u4F5C"),s(),r(48,"li"),l(49,"\u2705 \u6578\u64DA\u5C0E\u51FA"),s()(),y(50,_G,2,2,"button",66)(51,vG,2,0,"button",67),s(),r(52,"div",69)(53,"div",70),l(54,"\u63A8\u85A6"),s(),y(55,xG,2,0,"div",59),r(56,"div",60),l(57,"\u{1F48E}"),s(),r(58,"h3",61),l(59,"\u947D\u77F3\u738B\u724C"),s(),r(60,"div",62)(61,"span",63),l(62,"59.9 USDT"),s(),r(63,"span",64),l(64,"/\u6708"),s()(),r(65,"ul",65)(66,"li"),l(67,"\u2705 50 \u500B\u5E33\u865F"),s(),r(68,"li"),l(69,"\u2705 \u6BCF\u65E5 2000 \u689D\u6D88\u606F"),s(),r(70,"li"),l(71,"\u2705 \u7121\u9650 AI \u8ABF\u7528"),s(),r(72,"li"),l(73,"\u2705 200 \u500B\u7FA4\u7D44"),s(),r(74,"li"),l(75,"\u2705 AI \u92B7\u552E\u6F0F\u6597"),s(),r(76,"li"),l(77,"\u2705 \u9AD8\u7D1A\u5206\u6790"),s()(),y(78,CG,2,2,"button",66)(79,bG,2,0,"button",67),s(),r(80,"div",71),y(81,yG,2,0,"div",59),r(82,"div",60),l(83,"\u{1F31F}"),s(),r(84,"h3",61),l(85,"\u661F\u8000\u50B3\u8AAA"),s(),r(86,"div",62)(87,"span",63),l(88,"199 USDT"),s(),r(89,"span",64),l(90,"/\u6708"),s()(),r(91,"ul",65)(92,"li"),l(93,"\u2705 100 \u500B\u5E33\u865F"),s(),r(94,"li"),l(95,"\u2705 \u7121\u9650\u6D88\u606F"),s(),r(96,"li"),l(97,"\u2705 \u7121\u9650 AI"),s(),r(98,"li"),l(99,"\u2705 \u7121\u9650\u7FA4\u7D44"),s(),r(100,"li"),l(101,"\u2705 \u667A\u80FD\u9632\u5C01"),s(),r(102,"li"),l(103,"\u2705 \u5718\u968A\u7BA1\u7406"),s()(),y(104,SG,2,1,"button",66)(105,wG,2,0,"button",67),s(),r(106,"div",72),y(107,EG,2,0,"div",59),r(108,"div",60),l(109,"\u{1F451}"),s(),r(110,"h3",61),l(111,"\u69AE\u8000\u738B\u8005"),s(),r(112,"div",62)(113,"span",63),l(114,"599 USDT"),s(),r(115,"span",64),l(116,"/\u6708"),s()(),r(117,"div",73),l(118,"\u5C0A\u4EAB\u7279\u6B0A"),s(),r(119,"ul",65)(120,"li"),l(121,"\u2705 \u7121\u9650\u5E33\u865F"),s(),r(122,"li"),l(123,"\u2705 \u7121\u9650\u4E00\u5207"),s(),r(124,"li"),l(125,"\u2705 API \u63A5\u53E3"),s(),r(126,"li"),l(127,"\u2705 \u81EA\u5B9A\u7FA9\u54C1\u724C"),s(),r(128,"li"),l(129,"\u2705 \u5C08\u5C6C\u9867\u554F"),s(),r(130,"li"),l(131,"\u2705 \u65B0\u529F\u80FD\u5167\u6E2C"),s()(),y(132,DG,2,0,"button",66)(133,AG,2,0,"button",67),s()(),r(134,"div",27)(135,"h3",28),l(136,"\u{1F3AB} \u4F7F\u7528\u5361\u5BC6\u6FC0\u6D3B"),s(),r(137,"div",74)(138,"input",75),W("ngModelChange",function(o){_(t);let a=m();return q(a.licenseKey,o)||(a.licenseKey=o),v(o)}),s(),r(139,"button",76),x("click",function(){_(t);let o=m();return v(o.onActivateLicense())}),l(140," \u6FC0\u6D3B "),s()()(),r(141,"div",27)(142,"h3",28),l(143,"\u{1F4B3} \u652F\u4ED8\u65B9\u5F0F"),s(),r(144,"div",77)(145,"button",78),x("click",function(){_(t);let o=m();return v(o.selectedPayment.set("alipay"))}),r(146,"span",79),l(147,"\u{1F499}"),s(),l(148," \u652F\u4ED8\u5BF6 "),s(),r(149,"button",78),x("click",function(){_(t);let o=m();return v(o.selectedPayment.set("wechat"))}),r(150,"span",79),l(151,"\u{1F49A}"),s(),l(152," \u5FAE\u4FE1\u652F\u4ED8 "),s(),r(153,"button",78),x("click",function(){_(t);let o=m();return v(o.selectedPayment.set("usdt"))}),r(154,"span",79),l(155,"\u{1F48E}"),s(),l(156," USDT "),s()()()()}if(i&2){let t=m();c(2),N("current",t.membershipLevel()==="silver"),c(),S(t.membershipLevel()==="silver"?3:-1),c(21),S(t.membershipLevel()!=="silver"?24:25),c(2),N("current",t.membershipLevel()==="gold"),c(),S(t.membershipLevel()==="gold"?27:-1),c(23),S(t.membershipLevel()!=="gold"?50:51),c(2),N("current",t.membershipLevel()==="diamond"),c(3),S(t.membershipLevel()==="diamond"?55:-1),c(23),S(t.membershipLevel()!=="diamond"?78:79),c(2),N("current",t.membershipLevel()==="star"),c(),S(t.membershipLevel()==="star"?81:-1),c(23),S(t.membershipLevel()!=="star"?104:105),c(2),N("current",t.membershipLevel()==="king"),c(),S(t.membershipLevel()==="king"?107:-1),c(25),S(t.membershipLevel()!=="king"?132:133),c(6),H("ngModel",t.licenseKey),c(),L("disabled",!t.licenseKey),c(6),N("active",t.selectedPayment()==="alipay"),c(4),N("active",t.selectedPayment()==="wechat"),c(4),N("active",t.selectedPayment()==="usdt")}}function TG(i,e){i&1&&(r(0,"div",83),l(1,"\u8F09\u5165\u4E2D..."),s())}function kG(i,e){i&1&&(r(0,"div",84),l(1,"\u66AB\u7121\u8A02\u95B1\u8A18\u9304"),s())}function IG(i,e){if(i&1&&(r(0,"div",85)(1,"div",86),l(2),s(),r(3,"div",87)(4,"div",88),l(5),s(),r(6,"div",89),l(7),s()(),r(8,"div",90),l(9),s()()),i&2){let t=e.$implicit,n=m(3);c(2),D(t.level_icon||"\u{1F3AB}"),c(3),X("",t.level_name," ",t.duration_name,"\u6FC0\u6D3B"),c(2),M("",n.formatActivationDate(t.activated_at)," \xB7 \u5361\u5BC6\u6FC0\u6D3B"),c(),N("active",t.is_active)("used",!t.is_active),c(),M(" ",t.is_active?"\u751F\u6548\u4E2D":"\u5DF2\u904E\u671F"," ")}}function FG(i,e){if(i&1&&O(0,IG,10,9,"div",85,aG),i&2){let t=m(2);U(t.subscriptionHistory())}}function PG(i,e){if(i&1&&(r(0,"div",24)(1,"div",27)(2,"h3",28),l(3,"\u{1F4DC} \u8A02\u95B1\u6B77\u53F2"),s(),r(4,"div",82),y(5,TG,2,0,"div",83)(6,kG,2,0,"div",84)(7,FG,2,0),s()()()),i&2){let t=m();c(5),S(t.isLoadingHistory()?5:t.subscriptionHistory().length===0?6:7)}}var rd=class i{constructor(){this.authService=F(Gn);this.membershipService=F(Ie);this.toast=F(J);this.licenseClient=F(ui);this.cdr=F(dn);this.membershipUpdateHandler=null;this.activeTab=f("overview");this.selectedPayment=f("alipay");this.licenseKey="";this.user=R(()=>this.authService.user());this.membershipLevel=R(()=>this.authService.membershipLevel());this.membershipExpires=R(()=>this.authService.user()?.membershipExpires);this.membershipDaysLeft=R(()=>this.authService.membershipDaysLeft());this.usageStats=R(()=>this.authService.usageStats());this.inviteCode=f("");this.invitedCount=f(0);this.rewardDays=f(0);this.subscriptionHistory=f([]);this.isLoadingHistory=f(!1)}async ngOnInit(){let e=await this.authService.getInviteRewards();this.inviteCode.set(e.inviteCode),this.invitedCount.set(e.invitedCount),this.rewardDays.set(e.rewardDays),await this.loadSubscriptionHistory(),this.membershipUpdateHandler=t=>{console.log("[MembershipCenterComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",t.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler)}ngOnDestroy(){this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler)}async loadSubscriptionHistory(){this.isLoadingHistory.set(!0);try{let e=await this.licenseClient.getActivationHistory(50,0);e.success&&e.data&&this.subscriptionHistory.set(e.data)}catch(e){console.error("\u8F09\u5165\u8A02\u95B1\u8A18\u9304\u5931\u6557:",e)}finally{this.isLoadingHistory.set(!1)}}getMembershipIcon(){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[this.membershipLevel()]||"\u2694\uFE0F"}getMembershipName(){return{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.membershipLevel()]||"\u9752\u9285\u6230\u58EB"}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}getAiUsagePercent(){let e=this.usageStats();return e?.aiCalls?Math.min(100,e.aiCalls.used/e.aiCalls.limit*100):0}getMessageUsagePercent(){let e=this.usageStats();return e?.messagesSent?Math.min(100,e.messagesSent.used/e.messagesSent.limit*100):0}getAccountUsagePercent(){let e=this.usageStats();return e?.accounts?Math.min(100,e.accounts.used/e.accounts.limit*100):0}getStorageUsagePercent(){let e=this.usageStats();return e?.storage?Math.min(100,e.storage.used/e.storage.limit*100):0}copyInviteCode(){navigator.clipboard.writeText(this.inviteCode()),this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD")}onPurchase(e,t){this.toast.info(`\u6B63\u5728\u8DF3\u8F49\u5230\u652F\u4ED8\u9801\u9762... (${e} ${t})`)}async onActivateLicense(){let e=await this.authService.renewMembership(this.licenseKey);e.success?(this.toast.success(e.message||"\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01"),this.licenseKey="",await this.loadSubscriptionHistory(),this.cdr.detectChanges()):this.toast.error(e.message)}formatActivationDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-membership-center"]],decls:73,vars:32,consts:[[1,"membership-container"],[1,"page-header"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"membership-status-card"],[1,"status-left"],[1,"level-badge"],[1,"level-info"],[1,"level-name"],[1,"expires-info"],[1,"status-right"],[1,"upgrade-btn"],[1,"quick-stats"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-label"],[1,"stat-value"],[1,"stat-bar"],[1,"stat-fill"],[1,"stat-hint"],[1,"tabs"],[1,"tab-btn",3,"click"],[1,"tab-content"],[1,"days-left"],[1,"upgrade-btn",3,"click"],[1,"section-card"],[1,"section-title"],[1,"usage-details"],[1,"usage-row"],[1,"usage-name"],[1,"usage-bar-container"],[1,"usage-bar"],[1,"usage-fill"],[1,"usage-count"],[1,"section-card","invite-card"],[1,"invite-desc"],[1,"invite-code-display"],[1,"label"],[1,"code"],[1,"copy-btn",3,"click"],[1,"invite-stats-row"],[1,"invite-stat"],[1,"value"],[1,"benefits-table-container"],[1,"benefits-table"],[1,"feature-col"],[1,"level-col","bronze"],[1,"level-col","silver"],[1,"level-col","gold"],[1,"level-col","diamond"],[1,"level-col","star"],[1,"level-col","king"],[1,"feature-name"],[1,"price-row"],[1,"price"],[1,"pricing-cards"],[1,"pricing-card","silver"],[1,"current-badge"],[1,"plan-icon"],[1,"plan-name"],[1,"plan-price"],[1,"amount"],[1,"period"],[1,"plan-features"],[1,"buy-btn"],[1,"buy-btn","renew"],[1,"pricing-card","gold"],[1,"pricing-card","diamond","popular"],[1,"popular-badge"],[1,"pricing-card","star"],[1,"pricing-card","king"],[1,"savings"],[1,"license-input-row"],["type","text","placeholder","\u8F38\u5165\u5361\u5BC6\uFF1AXXXX-XXXX-XXXX-XXXX",1,"license-input",3,"ngModelChange","ngModel"],[1,"activate-btn",3,"click","disabled"],[1,"payment-methods"],[1,"payment-btn",3,"click"],[1,"payment-icon"],[1,"buy-btn",3,"click"],[1,"buy-btn","renew",3,"click"],[1,"history-list"],[1,"loading-state"],[1,"empty-state"],[1,"history-item"],[1,"history-icon"],[1,"history-info"],[1,"history-title"],[1,"history-meta"],[1,"history-status"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2)(3,"span",3),l(4,"\u2B50"),s(),l(5," \u6703\u54E1\u4E2D\u5FC3 "),s(),r(6,"p",4),l(7,"\u7BA1\u7406\u60A8\u7684\u6703\u54E1\u6B0A\u76CA\u548C\u8A02\u95B1"),s()(),r(8,"div",5)(9,"div",6)(10,"div",7),l(11),s(),r(12,"div",8)(13,"h2",9),l(14),s(),y(15,lG,4,2,"p",10)(16,cG,2,0,"p",10),s()(),r(17,"div",11),y(18,dG,2,0,"button",12),s()(),r(19,"div",13)(20,"div",14)(21,"div",15),l(22,"\u{1F916}"),s(),r(23,"div",16)(24,"div",17),l(25,"AI \u8ABF\u7528"),s(),r(26,"div",18),l(27),s(),r(28,"div",19),B(29,"div",20),s()()(),r(30,"div",14)(31,"div",15),l(32,"\u{1F4E8}"),s(),r(33,"div",16)(34,"div",17),l(35,"\u6D88\u606F\u767C\u9001"),s(),r(36,"div",18),l(37),s(),r(38,"div",19),B(39,"div",20),s()()(),r(40,"div",14)(41,"div",15),l(42,"\u{1F465}"),s(),r(43,"div",16)(44,"div",17),l(45,"\u5E33\u865F\u6578\u91CF"),s(),r(46,"div",18),l(47),s(),r(48,"div",19),B(49,"div",20),s()()(),r(50,"div",14)(51,"div",15),l(52,"\u{1F381}"),s(),r(53,"div",16)(54,"div",17),l(55,"\u9080\u8ACB\u734E\u52F5"),s(),r(56,"div",18),l(57),s(),r(58,"div",21),l(59),s()()()(),r(60,"div",22)(61,"button",23),x("click",function(){return n.activeTab.set("overview")}),l(62," \u{1F4CA} \u7E3D\u89BD "),s(),r(63,"button",23),x("click",function(){return n.activeTab.set("benefits")}),l(64," \u{1F3AF} \u6B0A\u76CA\u5C0D\u6BD4 "),s(),r(65,"button",23),x("click",function(){return n.activeTab.set("upgrade")}),l(66," \u{1F680} \u5347\u7D1A\u8CFC\u8CB7 "),s(),r(67,"button",23),x("click",function(){return n.activeTab.set("history")}),l(68," \u{1F4DC} \u8A02\u95B1\u8A18\u9304 "),s()(),y(69,uG,63,19,"div",24),y(70,mG,185,0,"div",24),y(71,MG,157,28,"div",24),y(72,PG,8,1,"div",24),s()),t&2){let o,a,d;c(8),de("level-"+n.membershipLevel()),c(3),M(" ",n.getMembershipIcon()," "),c(3),D(n.getMembershipName()),c(),S(n.membershipExpires()?15:16),c(3),S(n.membershipLevel()!=="king"?18:-1),c(9),X(" ",((o=n.usageStats())==null||o.aiCalls==null?null:o.aiCalls.used)||0," / ",((o=n.usageStats())==null||o.aiCalls==null?null:o.aiCalls.limit)||50," "),c(2),ee("width",n.getAiUsagePercent(),"%"),c(8),X(" ",((a=n.usageStats())==null||a.messagesSent==null?null:a.messagesSent.used)||0," / ",((a=n.usageStats())==null||a.messagesSent==null?null:a.messagesSent.limit)||100," "),c(2),ee("width",n.getMessageUsagePercent(),"%"),c(8),X(" ",((d=n.usageStats())==null||d.accounts==null?null:d.accounts.used)||0," / ",((d=n.usageStats())==null||d.accounts==null?null:d.accounts.limit)||2," "),c(2),ee("width",n.getAccountUsagePercent(),"%"),c(8),M("",n.invitedCount()," \u4EBA"),c(2),M("\u5DF2\u7372 ",n.rewardDays()," \u5929\u734E\u52F5"),c(2),N("active",n.activeTab()==="overview"),c(2),N("active",n.activeTab()==="benefits"),c(2),N("active",n.activeTab()==="upgrade"),c(2),N("active",n.activeTab()==="history"),c(2),S(n.activeTab()==="overview"?69:-1),c(),S(n.activeTab()==="benefits"?70:-1),c(),S(n.activeTab()==="upgrade"?71:-1),c(),S(n.activeTab()==="history"?72:-1)}},dependencies:[oe,ae,xe,ve,he],styles:[".membership-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary, white);display:flex;align-items:center;gap:.5rem;margin:0}.title-icon[_ngcontent-%COMP%]{font-size:1.75rem}.page-desc[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);margin:.5rem 0 0}.membership-status-card[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-radius:1rem;margin-bottom:1.5rem;border:1px solid}.membership-status-card.level-free[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4755694d,#3341554d);border-color:#47556980}.membership-status-card.level-vip[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b33,#d9770633);border-color:#f59e0b80}.membership-status-card.level-svip[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf633,#7c3aed33);border-color:#8b5cf680}.membership-status-card.level-mvp[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ec489933,#db277733);border-color:#ec489980}.status-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.level-badge[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:#ffffff1a;display:flex;align-items:center;justify-content:center;font-size:2rem}.level-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0}.expires-info[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);margin:.25rem 0 0}.days-left[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.upgrade-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.75rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s}.upgrade-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 20px -10px #06b6d480}.quick-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.75rem}.stat-icon[_ngcontent-%COMP%]{font-size:1.5rem}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.75rem}.stat-value[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.stat-bar[_ngcontent-%COMP%]{height:4px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:2px;margin-top:.5rem;overflow:hidden}.stat-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:2px}.stat-hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b)}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;flex-wrap:wrap}.tab-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.tab-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4)}.tab-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);border-color:transparent;color:#fff}.section-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;padding:1.5rem;margin-bottom:1rem}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary, white);margin:0 0 1rem}.usage-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.usage-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.usage-name[_ngcontent-%COMP%]{width:150px;color:var(--text-secondary, #cbd5e1)}.usage-bar-container[_ngcontent-%COMP%]{flex:1}.usage-bar[_ngcontent-%COMP%]{height:8px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:4px;overflow:hidden}.usage-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:4px}.usage-count[_ngcontent-%COMP%]{width:100px;text-align:right;color:var(--text-muted, #94a3b8);font-size:.875rem}.invite-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border-color:#06b6d44d}.invite-desc[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);margin-bottom:1rem}.invite-code-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;margin-bottom:1rem}.invite-code-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.invite-code-display[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{flex:1;font-family:monospace;font-size:1.25rem;font-weight:600;color:var(--primary, #06b6d4)}.copy-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary-bg, rgba(6, 182, 212, .1));border:1px solid var(--primary, #06b6d4);border-radius:.5rem;color:var(--primary, #06b6d4);cursor:pointer}.invite-stats-row[_ngcontent-%COMP%]{display:flex;gap:2rem}.invite-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.invite-stat[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--primary, #06b6d4)}.invite-stat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem}.benefits-table-container[_ngcontent-%COMP%]{overflow-x:auto}.benefits-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:center;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-primary, white);font-weight:600}.benefits-table[_ngcontent-%COMP%]   .feature-col[_ngcontent-%COMP%]{text-align:left;min-width:150px}.benefits-table[_ngcontent-%COMP%]   .feature-name[_ngcontent-%COMP%]{text-align:left;color:var(--text-secondary, #cbd5e1)}.benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--text-primary, white)}.benefits-table[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-weight:600;color:var(--primary, #06b6d4)}.pricing-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:1.5rem}.pricing-card[_ngcontent-%COMP%]{position:relative;padding:2rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:2px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;text-align:center}.pricing-card.vip[_ngcontent-%COMP%]{border-color:#f59e0b4d}.pricing-card.svip[_ngcontent-%COMP%]{border-color:#8b5cf64d}.pricing-card.mvp[_ngcontent-%COMP%]{border-color:#ec48994d}.pricing-card.popular[_ngcontent-%COMP%]{transform:scale(1.02);box-shadow:0 20px 40px -20px #8b5cf64d}.pricing-card.current[_ngcontent-%COMP%]{border-width:3px}.popular-badge[_ngcontent-%COMP%]{position:absolute;top:-12px;left:50%;transform:translate(-50%);padding:.25rem 1rem;background:linear-gradient(135deg,#8b5cf6,#7c3aed);border-radius:1rem;color:#fff;font-size:.75rem;font-weight:600}.current-badge[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;padding:.25rem .5rem;background:var(--success, #22c55e);border-radius:.25rem;color:#fff;font-size:.625rem;font-weight:600}.plan-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.plan-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0 0 .5rem}.plan-price[_ngcontent-%COMP%]{margin-bottom:.5rem}.plan-price[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--primary, #06b6d4)}.plan-price[_ngcontent-%COMP%]   .period[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.savings[_ngcontent-%COMP%]{font-size:.75rem;color:var(--success, #22c55e);margin-bottom:1rem}.plan-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:1rem 0;text-align:left}.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.5rem 0;color:var(--text-secondary, #cbd5e1)}.buy-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer}.buy-btn.renew[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a)}.license-input-row[_ngcontent-%COMP%]{display:flex;gap:.5rem}.license-input[_ngcontent-%COMP%]{flex:1;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-family:monospace}.activate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer}.activate-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.payment-methods[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.payment-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer;display:flex;align-items:center;gap:.5rem}.payment-btn.active[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4);background:#06b6d41a}.history-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.history-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem}.history-icon[_ngcontent-%COMP%]{font-size:1.5rem}.history-info[_ngcontent-%COMP%]{flex:1}.history-title[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white)}.history-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.history-status[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.history-status.active[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.history-status.used[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}"]})}};var v1=(i,e)=>e.id;function RG(i,e){if(i&1&&(r(0,"span",8),l(1),s()),i&2){let t=m();c(),M("\xB7 \u5269\u9918 ",t.membershipDaysLeft()," \u5929")}}function NG(i,e){if(i&1){let t=I();r(0,"div",23)(1,"div",24)(2,"label"),l(3,"\u7576\u524D\u5BC6\u78BC"),s(),r(4,"input",25),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.passwordForm.oldPassword,o)||(a.passwordForm.oldPassword=o),v(o)}),s()(),r(5,"div",24)(6,"label"),l(7,"\u65B0\u5BC6\u78BC"),s(),r(8,"input",25),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.passwordForm.newPassword,o)||(a.passwordForm.newPassword=o),v(o)}),s()(),r(9,"div",24)(10,"label"),l(11,"\u78BA\u8A8D\u65B0\u5BC6\u78BC"),s(),r(12,"input",25),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.passwordForm.confirmPassword,o)||(a.passwordForm.confirmPassword=o),v(o)}),s()(),r(13,"div",26)(14,"button",27),x("click",function(){_(t);let o=m(2);return v(o.showChangePassword.set(!1))}),l(15,"\u53D6\u6D88"),s(),r(16,"button",28),x("click",function(){_(t);let o=m(2);return v(o.onChangePassword())}),l(17,"\u78BA\u8A8D\u4FEE\u6539"),s()()()}if(i&2){let t=m(2);c(4),H("ngModel",t.passwordForm.oldPassword),c(4),H("ngModel",t.passwordForm.newPassword),c(4),H("ngModel",t.passwordForm.confirmPassword)}}function VG(i,e){if(i&1){let t=I();r(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F4CB} \u57FA\u672C\u4FE1\u606F"),s(),r(4,"div",15)(5,"div",16)(6,"span",17),l(7,"\u7528\u6236\u540D"),s(),r(8,"span",18),l(9),s()(),r(10,"div",16)(11,"span",17),l(12,"\u90F5\u7BB1"),s(),r(13,"span",18),l(14),s(),r(15,"button",19),l(16,"\u7DE8\u8F2F"),s()(),r(17,"div",16)(18,"span",17),l(19,"\u8A3B\u518A\u6642\u9593"),s(),r(20,"span",18),l(21),s()(),r(22,"div",16)(23,"span",17),l(24,"\u6700\u5F8C\u767B\u5165"),s(),r(25,"span",18),l(26),s()()()(),r(27,"div",13)(28,"h3",14),l(29,"\u{1F510} \u5B89\u5168\u8A2D\u7F6E"),s(),r(30,"div",20)(31,"button",21),x("click",function(){_(t);let o=m();return v(o.showChangePassword.set(!0))}),l(32," \u{1F511} \u4FEE\u6539\u5BC6\u78BC "),s(),r(33,"button",22),l(34," \u{1F4F1} \u5169\u6B65\u9A57\u8B49 "),s()(),y(35,NG,18,3,"div",23),s()()}if(i&2){let t,n,o,a,d=m();c(9),D((t=d.user())==null?null:t.username),c(5),D(((n=d.user())==null?null:n.email)||"\u672A\u8A2D\u7F6E"),c(7),D(d.formatDate((o=d.user())==null?null:o.createdAt)),c(5),D(d.formatDate((a=d.user())==null?null:a.lastLogin)),c(9),S(d.showChangePassword()?35:-1)}}function BG(i,e){i&1&&(r(0,"div",34),l(1,"\u8F09\u5165\u4E2D..."),s())}function LG(i,e){i&1&&(r(0,"div",35),l(1,"\u66AB\u7121\u6FC0\u6D3B\u8A18\u9304"),s())}function OG(i,e){if(i&1&&(r(0,"div",47)(1,"div",48)(2,"span",49),l(3),s(),r(4,"span",50),l(5),s()(),r(6,"div",51)(7,"span"),l(8),s(),r(9,"span",52),l(10),s()()()),i&2){let t=e.$implicit,n=m(3);c(3),D(n.formatLicenseKey(t.license_key)),c(2),cn("",t.level_icon," ",t.level_name," ",t.duration_name),c(3),M("",n.formatActivationDate(t.activated_at)," \u6FC0\u6D3B"),c(),N("active",t.is_active)("used",!t.is_active),c(),M(" ",t.is_active?"\u6709\u6548":"\u5DF2\u904E\u671F"," ")}}function UG(i,e){if(i&1&&O(0,OG,11,10,"div",47,v1),i&2){let t=m(2);U(t.activationHistory())}}function GG(i,e){if(i&1){let t=I();r(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F3AB} \u6FC0\u6D3B\u65B0\u5361\u5BC6"),s(),r(4,"div",29)(5,"input",30),W("ngModelChange",function(o){_(t);let a=m();return q(a.newLicenseKey,o)||(a.newLicenseKey=o),v(o)}),s(),r(6,"button",31),x("click",function(){_(t);let o=m();return v(o.onActivateLicense())}),l(7," \u6FC0\u6D3B "),s()(),r(8,"p",32),l(9,"\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u4EE5\u7E8C\u8CBB\u6216\u5347\u7D1A\u6703\u54E1"),s()(),r(10,"div",13)(11,"h3",14),l(12,"\u{1F4DC} \u6FC0\u6D3B\u8A18\u9304"),s(),r(13,"div",33),y(14,BG,2,0,"div",34)(15,LG,2,0,"div",35)(16,UG,2,0),s()(),r(17,"div",13)(18,"h3",14),l(19,"\u{1F6D2} \u8CFC\u8CB7\u5361\u5BC6\uFF08\u738B\u8005\u69AE\u8000\u7B49\u7D1A\uFF09"),s(),r(20,"div",36)(21,"div",37)(22,"div",38),l(23,"\u{1F948} \u767D\u9280\u7CBE\u82F1"),s(),r(24,"div",39),l(25,"4.99 USDT/\u6708"),s(),r(26,"ul",40)(27,"li"),l(28,"5 \u500B\u5E33\u865F"),s(),r(29,"li"),l(30,"\u6BCF\u65E5 100 \u689D\u6D88\u606F"),s(),r(31,"li"),l(32,"\u6BCF\u65E5 50 \u6B21 AI"),s(),r(33,"li"),l(34,"10 \u500B\u7FA4\u7D44"),s()(),r(35,"button",41),l(36,"\u8CFC\u8CB7"),s()(),r(37,"div",42)(38,"div",38),l(39,"\u{1F947} \u9EC3\u91D1\u5927\u5E2B"),s(),r(40,"div",39),l(41,"19.9 USDT/\u6708"),s(),r(42,"div",43),l(43,"\u63A8\u85A6"),s(),r(44,"ul",40)(45,"li"),l(46,"15 \u500B\u5E33\u865F"),s(),r(47,"li"),l(48,"\u6BCF\u65E5 500 \u689D\u6D88\u606F"),s(),r(49,"li"),l(50,"\u6BCF\u65E5 300 \u6B21 AI"),s(),r(51,"li"),l(52,"\u6279\u91CF\u64CD\u4F5C"),s()(),r(53,"button",41),l(54,"\u8CFC\u8CB7"),s()(),r(55,"div",44)(56,"div",38),l(57,"\u{1F48E} \u947D\u77F3\u738B\u724C"),s(),r(58,"div",39),l(59,"59.9 USDT/\u6708"),s(),r(60,"ul",40)(61,"li"),l(62,"50 \u500B\u5E33\u865F"),s(),r(63,"li"),l(64,"\u6BCF\u65E5 2000 \u689D\u6D88\u606F"),s(),r(65,"li"),l(66,"\u7121\u9650 AI \u8ABF\u7528"),s(),r(67,"li"),l(68,"AI \u92B7\u552E\u6F0F\u6597"),s()(),r(69,"button",41),l(70,"\u8CFC\u8CB7"),s()(),r(71,"div",45)(72,"div",38),l(73,"\u{1F31F} \u661F\u8000\u50B3\u8AAA"),s(),r(74,"div",39),l(75,"199 USDT/\u6708"),s(),r(76,"ul",40)(77,"li"),l(78,"100 \u500B\u5E33\u865F"),s(),r(79,"li"),l(80,"\u7121\u9650\u6D88\u606F"),s(),r(81,"li"),l(82,"\u5718\u968A\u7BA1\u7406"),s(),r(83,"li"),l(84,"\u667A\u80FD\u9632\u5C01"),s()(),r(85,"button",41),l(86,"\u8CFC\u8CB7"),s()(),r(87,"div",46)(88,"div",38),l(89,"\u{1F451} \u69AE\u8000\u738B\u8005"),s(),r(90,"div",39),l(91,"599 USDT/\u6708"),s(),r(92,"ul",40)(93,"li"),l(94,"\u7121\u9650\u5E33\u865F"),s(),r(95,"li"),l(96,"\u7121\u9650\u4E00\u5207"),s(),r(97,"li"),l(98,"API \u63A5\u53E3"),s(),r(99,"li"),l(100,"\u5C08\u5C6C\u9867\u554F"),s()(),r(101,"button",41),l(102,"\u8CFC\u8CB7"),s()()()()()}if(i&2){let t=m();c(5),H("ngModel",t.newLicenseKey),c(),L("disabled",!t.newLicenseKey),c(8),S(t.isLoadingHistory()?14:t.activationHistory().length===0?15:16)}}function $G(i,e){i&1&&(r(0,"span",66),l(1,"\u672C\u6A5F"),s())}function HG(i,e){if(i&1){let t=I();r(0,"button",70),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.onUnbindDevice(o.id))}),l(1," \u89E3\u7D81 "),s()}if(i&2){let t=m(3);L("disabled",t.isUnbinding())}}function qG(i,e){if(i&1&&(r(0,"div",62)(1,"div",63),l(2),s(),r(3,"div",64)(4,"div",65),l(5),y(6,$G,2,0,"span",66),s(),r(7,"div",67),l(8),s(),r(9,"div",68),l(10),s()(),y(11,HG,2,1,"button",69),s()),i&2){let t=e.$implicit,n=m(2);N("current",t.isCurrent),c(2),M(" ",n.getDeviceIcon(t)," "),c(3),M(" ",t.deviceName," "),c(),S(t.isCurrent?6:-1),c(2),D(t.deviceCode),c(2),X(" \u7D81\u5B9A\u65BC ",n.formatDate(t.boundAt)," \xB7 \u6700\u5F8C\u6D3B\u52D5 ",n.formatDate(t.lastSeen)," "),c(),S(t.isCurrent?-1:11)}}function WG(i,e){i&1&&(r(0,"div",35),l(1," \u66AB\u7121\u7D81\u5B9A\u8A2D\u5099\u8A18\u9304 "),s())}function zG(i,e){if(i&1){let t=I();r(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F4BB} \u5DF2\u7D81\u5B9A\u8A2D\u5099"),s(),r(4,"p",53),l(5),s(),r(6,"div",54),O(7,qG,12,9,"div",55,v1,!1,WG,2,0,"div",35),s()(),r(10,"div",13)(11,"h3",14),l(12,"\u{1F4F1} \u7576\u524D\u8A2D\u5099"),s(),r(13,"div",56)(14,"div",57)(15,"span",58),l(16,"\u8A2D\u5099\u78BC"),s(),r(17,"span",59),l(18),s(),r(19,"button",60),x("click",function(){_(t);let o=m();return v(o.copyDeviceCode())}),l(20,"\u{1F4CB}"),s()(),r(21,"div",57)(22,"span",58),l(23,"\u8A2D\u5099\u540D\u7A31"),s(),r(24,"span",61),l(25),s()()()()()}if(i&2){let t=m();c(5),X(" \u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u6700\u591A\u53EF\u7D81\u5B9A ",t.getMaxDevices()," \u53F0\u8A2D\u5099\uFF0C\u5DF2\u4F7F\u7528 ",t.devices().length," \u53F0 "),c(2),U(t.devices()),c(11),D(t.currentDeviceCode()),c(7),D(t.currentDeviceName())}}function KG(i,e){if(i&1&&(r(0,"div",71)(1,"div",72)(2,"div",73),l(3,"\u{1F916}"),s(),r(4,"div",74)(5,"div",75),l(6,"AI \u8ABF\u7528"),s(),r(7,"div",76),B(8,"div",77),s(),r(9,"div",78),l(10),s()()(),r(11,"div",72)(12,"div",73),l(13,"\u{1F4E8}"),s(),r(14,"div",74)(15,"div",75),l(16,"\u6D88\u606F\u767C\u9001"),s(),r(17,"div",76),B(18,"div",77),s(),r(19,"div",78),l(20),s()()(),r(21,"div",72)(22,"div",73),l(23,"\u{1F465}"),s(),r(24,"div",74)(25,"div",75),l(26,"\u5E33\u865F\u6578\u91CF"),s(),r(27,"div",76),B(28,"div",77),s(),r(29,"div",78),l(30),s()()(),r(31,"div",72)(32,"div",73),l(33,"\u{1F4BE}"),s(),r(34,"div",74)(35,"div",75),l(36,"\u5B58\u5132\u7A7A\u9593"),s(),r(37,"div",76),B(38,"div",77),s(),r(39,"div",78),l(40),s()()()()),i&2){let t=m(2);c(8),ee("width",t.getUsagePercent(t.usageStats().aiCalls),"%"),c(2),X(" ",t.usageStats().aiCalls.used," / ",t.usageStats().aiCalls.limit," \u6B21 "),c(8),ee("width",t.getUsagePercent(t.usageStats().messagesSent),"%"),c(2),X(" ",t.usageStats().messagesSent.used," / ",t.usageStats().messagesSent.limit," \u689D "),c(8),ee("width",t.getUsagePercent(t.usageStats().accounts),"%"),c(2),X(" ",t.usageStats().accounts.used," / ",t.usageStats().accounts.limit," \u500B "),c(8),ee("width",t.getUsagePercent(t.usageStats().storage),"%"),c(2),X(" ",t.usageStats().storage.used," / ",t.usageStats().storage.limit," MB ")}}function jG(i,e){i&1&&(r(0,"div",34),l(1,"\u8F09\u5165\u4E2D..."),s())}function JG(i,e){if(i&1&&(r(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F4CA} \u672C\u6708\u4F7F\u7528\u60C5\u6CC1"),s(),y(4,KG,41,16,"div",71)(5,jG,2,0,"div",34),s(),r(6,"div",13)(7,"h3",14),l(8,"\u{1F4C8} \u6B77\u53F2\u8DA8\u52E2"),s(),r(9,"p",53),l(10,"\u656C\u8ACB\u671F\u5F85..."),s()()()),i&2){let t=m();c(4),S(t.usageStats()?4:5)}}function QG(i,e){if(i&1){let t=I();r(0,"div",12)(1,"div",79)(2,"h3",14),l(3,"\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5"),s(),r(4,"p",53),l(5," \u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 "),r(6,"strong"),l(7,"3 \u5929\u767D\u9280\u7CBE\u82F1"),s(),l(8," \u734E\u52F5\uFF01 "),s(),r(9,"div",80)(10,"span",81),l(11,"\u6211\u7684\u9080\u8ACB\u78BC"),s(),r(12,"div",82),l(13),s(),r(14,"button",60),x("click",function(){_(t);let o=m();return v(o.copyInviteCode())}),l(15," \u{1F4CB} \u8907\u88FD "),s()(),r(16,"div",83)(17,"span",81),l(18,"\u9080\u8ACB\u93C8\u63A5"),s(),B(19,"input",84),r(20,"button",60),x("click",function(){_(t);let o=m();return v(o.copyInviteLink())}),l(21," \u{1F4CB} \u8907\u88FD "),s()()(),r(22,"div",13)(23,"h3",14),l(24,"\u{1F4CA} \u9080\u8ACB\u7D71\u8A08"),s(),r(25,"div",85)(26,"div",86)(27,"div",87),l(28),s(),r(29,"div",88),l(30,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),s()(),r(31,"div",86)(32,"div",87),l(33),s(),r(34,"div",88),l(35,"\u7372\u5F97\u734E\u52F5\u5929\u6578"),s()()()()()}if(i&2){let t=m();c(13),D(t.inviteCode()),c(6),L("value",t.inviteLink()),c(9),D(t.invitedCount()),c(5),D(t.rewardDays())}}var sd=class i{constructor(){this.authService=F(Gn);this.deviceService=F(Si);this.i18n=F(Be);this.toast=F(J);this.licenseClient=F(ui);this.cdr=F(dn);this.membershipUpdateHandler=null;this.activeTab=f("account");this.showChangePassword=f(!1);this.isUnbinding=f(!1);this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""};this.newLicenseKey="";this.user=R(()=>this.authService.user());this.membershipLevel=R(()=>this.authService.membershipLevel());this.membershipDaysLeft=R(()=>this.authService.membershipDaysLeft());this.devices=R(()=>this.authService.devices());this.usageStats=R(()=>this.authService.usageStats());this.currentDeviceCode=f("");this.currentDeviceName=f("");this.inviteCode=f("");this.invitedCount=f(0);this.rewardDays=f(0);this.activationHistory=f([]);this.isLoadingHistory=f(!1);this.inviteLink=R(()=>`https://tg-matrix.com/invite?code=${this.inviteCode()}`)}async ngOnInit(){this.currentDeviceCode.set(await this.deviceService.getDeviceCode()),this.currentDeviceName.set(this.deviceService.getDeviceName());let e=await this.authService.getInviteRewards();this.inviteCode.set(e.inviteCode),this.invitedCount.set(e.invitedCount),this.rewardDays.set(e.rewardDays),await this.loadActivationHistory(),this.membershipUpdateHandler=t=>{console.log("[ProfileComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",t.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler)}ngOnDestroy(){this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler)}async loadActivationHistory(){this.isLoadingHistory.set(!0);try{let e=await this.licenseClient.getActivationHistory(50,0);e.success&&e.data&&this.activationHistory.set(e.data)}catch(e){console.error("\u8F09\u5165\u6FC0\u6D3B\u8A18\u9304\u5931\u6557:",e)}finally{this.isLoadingHistory.set(!1)}}getMembershipIcon(){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[this.membershipLevel()]||"\u2694\uFE0F"}getMembershipName(){return{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.membershipLevel()]||"\u9752\u9285\u6230\u58EB"}getMaxDevices(){return{bronze:1,silver:2,gold:3,diamond:4,star:5,king:-1}[this.membershipLevel()]||1}getDeviceIcon(e){return e.deviceName.includes("Windows")?"\u{1F4BB}":e.deviceName.includes("Mac")?"\u{1F5A5}\uFE0F":e.deviceName.includes("Linux")?"\u{1F427}":"\u{1F4F1}"}getUsagePercent(e){return Math.min(100,e.used/e.limit*100)}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}async onLogout(){await this.authService.logout()}async onChangePassword(){if(this.passwordForm.newPassword!==this.passwordForm.confirmPassword){this.toast.error("\u5169\u6B21\u8F38\u5165\u7684\u5BC6\u78BC\u4E0D\u4E00\u81F4");return}let e=await this.authService.changePassword(this.passwordForm.oldPassword,this.passwordForm.newPassword);e.success?(this.toast.success("\u5BC6\u78BC\u4FEE\u6539\u6210\u529F"),this.showChangePassword.set(!1),this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""}):this.toast.error(e.message)}async onActivateLicense(){let e=await this.authService.renewMembership(this.newLicenseKey);e.success?(this.toast.success(e.message||"\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01"),this.newLicenseKey="",await this.loadActivationHistory(),this.cdr.detectChanges()):this.toast.error(e.message)}formatLicenseKey(e){return e?e.length>16?e.substring(0,12)+"-****":e:""}formatActivationDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}async onUnbindDevice(e){this.isUnbinding.set(!0);let t=await this.authService.unbindDevice(e);t.success?this.toast.success("\u8A2D\u5099\u5DF2\u89E3\u7D81"):this.toast.error(t.message),this.isUnbinding.set(!1)}copyDeviceCode(){navigator.clipboard.writeText(this.currentDeviceCode()),this.toast.success("\u8A2D\u5099\u78BC\u5DF2\u8907\u88FD")}copyInviteCode(){navigator.clipboard.writeText(this.inviteCode()),this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD")}copyInviteLink(){navigator.clipboard.writeText(this.inviteLink()),this.toast.success("\u9080\u8ACB\u93C8\u63A5\u5DF2\u8907\u88FD")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-profile"]],decls:31,vars:23,consts:[[1,"profile-container"],[1,"profile-header"],[1,"avatar-section"],[1,"avatar"],[1,"user-info"],[1,"username"],[1,"email"],[1,"membership-badge"],[1,"expires"],[1,"logout-btn",3,"click"],[1,"tabs"],[1,"tab-btn",3,"click"],[1,"tab-content"],[1,"section-card"],[1,"section-title"],[1,"info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value"],[1,"edit-btn"],[1,"security-actions"],[1,"action-btn",3,"click"],[1,"action-btn"],[1,"change-password-form"],[1,"form-group"],["type","password",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-actions"],[1,"cancel-btn",3,"click"],[1,"submit-btn",3,"click"],[1,"license-input-group"],["type","text","placeholder","XXXX-XXXX-XXXX-XXXX",1,"form-input","font-mono",3,"ngModelChange","ngModel"],[1,"activate-btn",3,"click","disabled"],[1,"hint-text"],[1,"license-history"],[1,"loading-state"],[1,"empty-state"],[1,"purchase-options"],[1,"purchase-card","silver"],[1,"plan-name"],[1,"plan-price"],[1,"plan-features"],[1,"buy-btn"],[1,"purchase-card","gold"],[1,"recommended"],[1,"purchase-card","diamond"],[1,"purchase-card","star"],[1,"purchase-card","king"],[1,"history-item"],[1,"history-info"],[1,"license-code"],[1,"license-type"],[1,"history-meta"],[1,"status"],[1,"section-desc"],[1,"device-list"],[1,"device-item",3,"current"],[1,"current-device-info"],[1,"info-row"],[1,"label"],[1,"value","font-mono"],[1,"copy-btn",3,"click"],[1,"value"],[1,"device-item"],[1,"device-icon"],[1,"device-info"],[1,"device-name"],[1,"current-badge"],[1,"device-code"],[1,"device-meta"],[1,"unbind-btn",3,"disabled"],[1,"unbind-btn",3,"click","disabled"],[1,"usage-grid"],[1,"usage-item"],[1,"usage-icon"],[1,"usage-info"],[1,"usage-label"],[1,"usage-bar"],[1,"usage-fill"],[1,"usage-text"],[1,"section-card","highlight"],[1,"invite-code-box"],[1,"invite-label"],[1,"invite-code"],[1,"invite-link-box"],["type","text","readonly","",1,"invite-link-input",3,"value"],[1,"invite-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l(4),s(),r(5,"div",4)(6,"h2",5),l(7),s(),r(8,"p",6),l(9),s(),r(10,"div",7),l(11),y(12,RG,2,1,"span",8),s()()(),r(13,"button",9),x("click",function(){return n.onLogout()}),l(14," \u{1F6AA} \u9000\u51FA "),s()(),r(15,"div",10)(16,"button",11),x("click",function(){return n.activeTab.set("account")}),l(17," \u{1F464} \u5E33\u865F\u4FE1\u606F "),s(),r(18,"button",11),x("click",function(){return n.activeTab.set("license")}),l(19," \u{1F511} \u5361\u5BC6\u7BA1\u7406 "),s(),r(20,"button",11),x("click",function(){return n.activeTab.set("devices")}),l(21," \u{1F4BB} \u8A2D\u5099\u7BA1\u7406 "),s(),r(22,"button",11),x("click",function(){return n.activeTab.set("usage")}),l(23," \u{1F4CA} \u4F7F\u7528\u7D71\u8A08 "),s(),r(24,"button",11),x("click",function(){return n.activeTab.set("invite")}),l(25," \u{1F381} \u9080\u8ACB\u734E\u52F5 "),s()(),y(26,VG,36,5,"div",12),y(27,GG,103,3,"div",12),y(28,zG,26,5,"div",12),y(29,JG,11,1,"div",12),y(30,QG,36,4,"div",12),s()),t&2){let o,a,d;c(4),M(" ",((o=n.user())==null||o.username==null?null:o.username.charAt(0).toUpperCase())||"?"," "),c(3),D(((a=n.user())==null?null:a.username)||"\u672A\u767B\u5165"),c(2),D(((d=n.user())==null?null:d.email)||"\u672A\u8A2D\u7F6E\u90F5\u7BB1"),c(),de("level-"+n.membershipLevel()),c(),X(" ",n.getMembershipIcon()," ",n.getMembershipName()," "),c(),S(n.membershipDaysLeft()>0?12:-1),c(4),N("active",n.activeTab()==="account"),c(2),N("active",n.activeTab()==="license"),c(2),N("active",n.activeTab()==="devices"),c(2),N("active",n.activeTab()==="usage"),c(2),N("active",n.activeTab()==="invite"),c(2),S(n.activeTab()==="account"?26:-1),c(),S(n.activeTab()==="license"?27:-1),c(),S(n.activeTab()==="devices"?28:-1),c(),S(n.activeTab()==="usage"?29:-1),c(),S(n.activeTab()==="invite"?30:-1)}},dependencies:[oe,ae,xe,ve,he],styles:[".profile-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:900px;margin:0 auto}.profile-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border:1px solid rgba(6,182,212,.2);border-radius:1rem;margin-bottom:1.5rem}.avatar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#fff}.username[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0}.email[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin:.25rem 0}.membership-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;border-radius:1rem;font-size:.75rem;font-weight:500}.membership-badge.level-bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}.membership-badge.level-silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,silver,#a8a8a8);color:#1e293b}.membership-badge.level-gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:#1e293b}.membership-badge.level-diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b9f2ff,#06b6d4);color:#1e293b}.membership-badge.level-star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}.membership-badge.level-king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}.expires[_ngcontent-%COMP%]{opacity:.8}.logout-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:.5rem;color:#fca5a5;cursor:pointer;transition:all .2s}.logout-btn[_ngcontent-%COMP%]:hover{background:#ef444433}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;flex-wrap:wrap}.tab-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s;font-size:.875rem}.tab-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.tab-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);border-color:transparent;color:#fff}.section-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;padding:1.5rem;margin-bottom:1rem}.section-card.highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border-color:#06b6d44d}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary, white);margin:0 0 1rem}.section-desc[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin-bottom:1rem}.info-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.info-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;min-width:80px}.info-value[_ngcontent-%COMP%]{color:var(--text-primary, white);flex:1}.edit-btn[_ngcontent-%COMP%], .copy-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.25rem;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:.75rem}.edit-btn[_ngcontent-%COMP%]:hover, .copy-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--text-secondary, #cbd5e1);font-size:.875rem;margin-bottom:.5rem}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.device-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.device-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.75rem}.device-item.current[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.device-icon[_ngcontent-%COMP%]{font-size:1.5rem}.device-info[_ngcontent-%COMP%]{flex:1}.device-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white);display:flex;align-items:center;gap:.5rem}.current-badge[_ngcontent-%COMP%]{font-size:.625rem;padding:.125rem .375rem;background:var(--primary, #06b6d4);border-radius:.25rem;color:#fff}.device-code[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--text-muted, #94a3b8)}.device-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);margin-top:.25rem}.unbind-btn[_ngcontent-%COMP%]{padding:.375rem .75rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:.375rem;color:#fca5a5;cursor:pointer;font-size:.75rem}.usage-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.usage-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem}.usage-icon[_ngcontent-%COMP%]{font-size:1.5rem}.usage-info[_ngcontent-%COMP%]{flex:1}.usage-label[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);font-size:.875rem;margin-bottom:.5rem}.usage-bar[_ngcontent-%COMP%]{height:8px;background:var(--bg-primary, #0f172a);border-radius:4px;overflow:hidden}.usage-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:4px;transition:width .3s}.usage-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);margin-top:.25rem}.invite-code-box[_ngcontent-%COMP%], .invite-link-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;margin-bottom:1rem}.invite-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;min-width:80px}.invite-code[_ngcontent-%COMP%]{font-family:monospace;font-size:1.25rem;font-weight:600;color:var(--primary, #06b6d4);flex:1}.invite-link-input[_ngcontent-%COMP%]{flex:1;padding:.5rem;background:transparent;border:none;color:var(--text-secondary, #cbd5e1);font-size:.875rem}.invite-stats[_ngcontent-%COMP%]{display:flex;gap:2rem;justify-content:center;padding:1rem}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--primary, #06b6d4)}.stat-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem}.purchase-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.purchase-card[_ngcontent-%COMP%]{padding:1.5rem;border-radius:1rem;text-align:center;border:1px solid var(--border-default, rgba(148, 163, 184, .1))}.purchase-card.silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,#c0c0c01a,#a8a8a81a);border-color:#c0c0c04d}.purchase-card.gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ffd7001a,#ffa5001a);border-color:#ffd7004d}.purchase-card.diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d426,#b9f2ff1a);border-color:#06b6d466}.purchase-card.star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b61a,#8e44ad1a);border-color:#9b59b64d}.purchase-card.king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b26,#ee5a5a1a);border-color:#ff6b6b66}.recommended[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#06b6d4,#3b82f6);color:#fff;font-size:.625rem;padding:.125rem .5rem;border-radius:.25rem;font-weight:600}.purchase-card[_ngcontent-%COMP%]{position:relative}.plan-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white);margin-bottom:.5rem}.plan-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--primary, #06b6d4);margin-bottom:1rem}.plan-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.25rem 0}.buy-btn[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;cursor:pointer;font-weight:500}.license-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:.5rem}.license-input-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1;font-family:monospace}.activate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}.activate-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #22c55e4d}.activate-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.hint-text[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin-top:.5rem}.empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--text-muted, #94a3b8)}"]})}};var YG=(i,e)=>e.id,x1=(i,e)=>e.value,XG=(i,e)=>e.telegram_id;function ZG(i,e){if(i&1){let t=I();r(0,"span",45),x("click",function(){_(t);let o=m();return v(o.forceEndSync())}),B(1,"span",46),l(2," \u540C\u6B65\u4E2D... (\u9EDE\u64CA\u53D6\u6D88) "),s()}}function e$(i,e){if(i&1){let t=I();r(0,"button",47),x("click",function(){let o=_(t).$implicit,a=m();return v(a.switchTab(o.id))}),l(1),s()}if(i&2){let t=e.$implicit,n=m();N("bg-purple-500",n.activeTab()===t.id)("text-white",n.activeTab()===t.id)("text-slate-400",n.activeTab()!==t.id)("hover:text-white",n.activeTab()!==t.id),c(),X(" ",t.icon," ",t.label," ")}}function t$(i,e){if(i&1&&(r(0,"option",33),l(1),s()),i&2){let t=e.$implicit;L("value",t.value),c(),D(t.label)}}function n$(i,e){if(i&1&&(r(0,"option",33),l(1),s()),i&2){let t=e.$implicit;L("value",t),c(),D(t)}}function i$(i,e){if(i&1){let t=I();r(0,"div",40)(1,"span",48),l(2),s(),r(3,"button",49),x("click",function(){_(t);let o=m();return v(o.showBatchTagDialog.set(!0))}),l(4," \u6279\u91CF\u6A19\u8A18 "),s(),r(5,"button",50),x("click",function(){_(t);let o=m();return v(o.showBatchStatusDialog.set(!0))}),l(6," \u66F4\u65B0\u72C0\u614B "),s(),r(7,"button",51),x("click",function(){_(t);let o=m();return v(o.batchSendMessage())}),l(8," \u6279\u91CF\u767C\u9001 "),s(),r(9,"button",52),x("click",function(){_(t);let o=m();return v(o.sendToAISales())}),r(10,"span"),l(11,"\u{1F4E4}"),s(),l(12," \u52A0\u5165\u767C\u9001\u968A\u5217 "),s(),r(13,"button",53),x("click",function(){_(t);let o=m();return v(o.confirmBatchDelete())}),l(14," \u522A\u9664 "),s(),r(15,"button",54),x("click",function(){_(t);let o=m();return v(o.contactsService.clearSelection())}),l(16," \u53D6\u6D88\u9078\u64C7 "),s()()}if(i&2){let t=m();c(2),M(" \u5DF2\u9078\u64C7 ",t.contactsService.selectedIds().size," \u9805 ")}}function o$(i,e){i&1&&(r(0,"div",42),B(1,"div",55),s())}function r$(i,e){if(i&1){let t=I();r(0,"div",43)(1,"div",56),l(2,"\u{1F4E6}"),s(),r(3,"p",57),l(4,"\u66AB\u7121\u8CC7\u6E90\u6578\u64DA"),s(),r(5,"p",58),l(6,"\u9EDE\u64CA\u300C\u540C\u6B65\u6578\u64DA\u300D\u5F9E\u5404\u4F86\u6E90\u6574\u5408\u6578\u64DA"),s(),r(7,"button",39),x("click",function(){_(t);let o=m();return v(o.syncData())}),l(8," \u540C\u6B65\u6578\u64DA "),s()()}}function s$(i,e){if(i&1&&(r(0,"div",73),l(1),s()),i&2){let t=m().$implicit;c(),M("@",t.username)}}function a$(i,e){if(i&1&&(r(0,"div",78),l(1),s()),i&2){let t=m().$implicit;c(),M(" \u{1F4CD} ",t.source_name," ")}}function l$(i,e){if(i&1&&(r(0,"span",80),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t," ")}}function c$(i,e){if(i&1&&(r(0,"span",81),l(1),s()),i&2){let t=m().$implicit;c(),M(" +",t.tags.length-2," ")}}function d$(i,e){if(i&1){let t=I();r(0,"button",90),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.sendMessage(o))}),ne(),r(1,"svg",10),B(2,"path",91),s()()}}function u$(i,e){if(i&1){let t=I();r(0,"tr",66)(1,"td",65)(2,"input",64),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.contactsService.toggleSelect(o.telegram_id))}),s()(),r(3,"td",65)(4,"div",7)(5,"div",71),l(6),s(),r(7,"div")(8,"div",72),l(9),s(),y(10,s$,2,1,"div",73),s()()(),r(11,"td",65)(12,"span",74),l(13),s()(),r(14,"td",65)(15,"div",75)(16,"span",76),l(17),s(),r(18,"span",77),l(19),s()(),y(20,a$,2,1,"div",78),s(),r(21,"td",65)(22,"div",79),O(23,l$,2,1,"span",80,be),y(25,c$,2,1,"span",81),s()(),r(26,"td",65)(27,"span",74),l(28),s()(),r(29,"td",65)(30,"div",68)(31,"div",82),B(32,"div",83),s(),r(33,"span",73),l(34),s()()(),r(35,"td",65)(36,"div",68),y(37,d$,3,0,"button",84),r(38,"button",85),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.viewDetail(o))}),ne(),r(39,"svg",10),B(40,"path",86)(41,"path",87),s()(),ce(),r(42,"button",88),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.editContact(o))}),ne(),r(43,"svg",10),B(44,"path",89),s()()()()()}if(i&2){let t=e.$implicit,n=m(2);c(2),L("checked",n.contactsService.selectedIds().has(t.telegram_id)),c(4),M(" ",n.getInitial(t)," "),c(3),D(t.display_name),c(),S(t.username?10:-1),c(2),N("bg-blue-500/20",t.contact_type==="user")("text-blue-400",t.contact_type==="user")("bg-green-500/20",t.contact_type==="group")("text-green-400",t.contact_type==="group")("bg-purple-500/20",t.contact_type==="channel")("text-purple-400",t.contact_type==="channel"),c(),M(" ",n.getTypeLabel(t.contact_type)," "),c(4),D(n.getSourceIcon(t.source_type)),c(),de(n.getSourceColor(t.source_type)),c(),M(" ",n.getSourceLabel(t.source_type)," "),c(),S(t.source_name?20:-1),c(3),U(t.tags.slice(0,2)),c(2),S(t.tags.length>2?25:-1),c(2),de(n.contactsService.getStatusColor(t.status)),N("text-white",!0),c(),M(" ",n.contactsService.getStatusLabel(t.status)," "),c(4),ee("width",t.ai_score*100,"%"),c(2),D((t.ai_score*100).toFixed(0)),c(3),S(t.contact_type==="user"?37:-1)}}function m$(i,e){if(i&1){let t=I();r(0,"div",59)(1,"table",60)(2,"thead",61)(3,"tr",62)(4,"th",63)(5,"input",64),x("change",function(){_(t);let o=m();return v(o.contactsService.toggleSelectAll())}),s()(),r(6,"th",65),l(7,"\u540D\u7A31"),s(),r(8,"th",65),l(9,"\u985E\u578B"),s(),r(10,"th",65),l(11,"\u4F86\u6E90"),s(),r(12,"th",65),l(13,"\u6A19\u7C64"),s(),r(14,"th",65),l(15,"\u72C0\u614B"),s(),r(16,"th",65),l(17,"\u8A55\u5206"),s(),r(18,"th",65),l(19,"\u64CD\u4F5C"),s()()(),r(20,"tbody"),O(21,u$,45,32,"tr",66,XG),s()()(),r(23,"div",67)(24,"div"),l(25),s(),r(26,"div",68)(27,"button",69),x("click",function(){_(t);let o=m();return v(o.prevPage())}),l(28," \u4E0A\u4E00\u9801 "),s(),r(29,"span",70),l(30),s(),r(31,"button",69),x("click",function(){_(t);let o=m();return v(o.nextPage())}),l(32," \u4E0B\u4E00\u9801 "),s()()()}if(i&2){let t=m();c(5),L("checked",t.isAllSelected()),c(16),U(t.contactsService.contacts()),c(4),X(" \u986F\u793A ",t.contactsService.contacts().length," / ",t.contactsService.total()," \u689D "),c(2),L("disabled",t.currentPage()<=1),c(3),M("\u7B2C ",t.currentPage()," \u9801"),c(),L("disabled",!t.hasNextPage())}}function p$(i,e){if(i&1){let t=I();r(0,"label",95)(1,"input",64),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleBatchTag(o))}),s(),r(2,"span",99),l(3),s()()}if(i&2){let t=e.$implicit,n=m(2);c(),L("checked",n.selectedBatchTags().has(t)),c(2),D(t)}}function g$(i,e){if(i&1){let t=I();r(0,"div",44)(1,"div",92)(2,"h3",93),l(3,"\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64"),s(),r(4,"div",94),O(5,p$,4,2,"label",95,be),s(),r(7,"div",96)(8,"button",97),x("click",function(){_(t);let o=m();return v(o.showBatchTagDialog.set(!1))}),l(9," \u53D6\u6D88 "),s(),r(10,"button",98),x("click",function(){_(t);let o=m();return v(o.applyBatchTags())}),l(11," \u61C9\u7528 "),s()()()()}if(i&2){let t=m();c(5),U(t.defaultTags)}}function h$(i,e){if(i&1){let t=I();r(0,"button",103),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.applyBatchStatus(o.value))}),B(1,"span",104),r(2,"span",99),l(3),s()()}if(i&2){let t=e.$implicit;c(),de(t.color),c(2),D(t.label)}}function f$(i,e){if(i&1){let t=I();r(0,"div",44)(1,"div",92)(2,"h3",93),l(3,"\u66F4\u65B0\u72C0\u614B"),s(),r(4,"div",100),O(5,h$,4,3,"button",101,x1),s(),r(7,"button",102),x("click",function(){_(t);let o=m();return v(o.showBatchStatusDialog.set(!1))}),l(8," \u53D6\u6D88 "),s()()()}if(i&2){let t=m();c(5),U(t.statusOptions)}}function _$(i,e){if(i&1){let t=I();r(0,"div",44)(1,"div",92)(2,"h3",105),l(3,"\u26A0\uFE0F \u78BA\u8A8D\u522A\u9664"),s(),r(4,"p",106),l(5),s(),r(6,"div",107)(7,"button",97),x("click",function(){_(t);let o=m();return v(o.showDeleteConfirm.set(!1))}),l(8," \u53D6\u6D88 "),s(),r(9,"button",108),x("click",function(){_(t);let o=m();return v(o.confirmDelete())}),l(10," \u78BA\u8A8D\u522A\u9664 "),s()()()()}if(i&2){let t=m();c(5),M(" \u78BA\u5B9A\u8981\u522A\u9664\u9078\u4E2D\u7684 ",t.contactsService.selectedIds().size," \u500B\u806F\u7E6B\u4EBA\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002 ")}}var ad=class i{constructor(){this.contactsService=F(Kt);this.toast=F(J);this.nav=F(Je);this.sendMessageEvent=ge();this.viewDetailEvent=ge();this.batchSendEvent=ge();this.sendToAISalesEvent=ge();this.statusChangedEvent=ge();this.refreshDataEvent=ge();this.tabs=[{id:"all",icon:"\u{1F4CA}",label:"\u5168\u90E8"},{id:"users",icon:"\u{1F464}",label:"\u6210\u54E1"},{id:"groups",icon:"\u{1F465}",label:"\u7FA4\u7D44"},{id:"channels",icon:"\u{1F4E2}",label:"\u983B\u9053"}];this.statusOptions=zl;this.defaultTags=T_;this.activeTab=f("all");this.selectedStatus="";this.selectedTag="";this.searchKeyword="";this.pageSize=50;this.currentPage=f(1);this.showImportDialog=f(!1);this.showBatchTagDialog=f(!1);this.showBatchStatusDialog=f(!1);this.showDeleteConfirm=f(!1);this.selectedBatchTags=f(new Set)}ngOnInit(){console.log("[ResourceCenter] Initialized, using imported leads data"),console.log("[ResourceCenter] Current contacts:",this.contactsService.contacts().length),console.log("[ResourceCenter] Has imported data:",this.contactsService.hasData())}ngOnDestroy(){this.contactsService.forceEndSync()}forceEndSync(){this.contactsService.forceEndSync(),this.toast.info("\u5DF2\u53D6\u6D88",1500)}switchTab(e){this.activeTab.set(e);let t;switch(e){case"users":t="user";break;case"groups":t="group";break;case"channels":t="channel";break;default:t=void 0}this.contactsService.setFilter({contactType:t,offset:0}),this.currentPage.set(1)}syncData(){if(console.log("[ResourceCenter] ========== SYNC DATA CLICKED =========="),this.contactsService.isSyncing()){console.log("[ResourceCenter] Already syncing, skip"),this.toast.warning("\u6B63\u5728\u540C\u6B65\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}console.log("[ResourceCenter] Calling syncFromSources()..."),this.contactsService.syncFromSources(),this.toast.info("\u{1F504} \u6B63\u5728\u540C\u6B65\u6578\u64DA\uFF0C\u8ACB\u7A0D\u5019...",5e3),this.refreshDataEvent.emit()}search(){this.contactsService.search(this.searchKeyword),this.currentPage.set(1)}filterByStatus(e){this.contactsService.setFilter({status:e||void 0,offset:0}),this.currentPage.set(1)}filterByTag(e){this.contactsService.setFilter({tags:e?[e]:void 0,offset:0}),this.currentPage.set(1)}resetFilters(){this.selectedStatus="",this.selectedTag="",this.searchKeyword="",this.activeTab.set("all"),this.contactsService.resetFilter(),this.currentPage.set(1)}hasNextPage(){return this.currentPage()*this.pageSize<this.contactsService.total()}prevPage(){this.currentPage()>1&&(this.currentPage.update(e=>e-1),this.contactsService.setPage(this.currentPage(),this.pageSize))}nextPage(){this.hasNextPage()&&(this.currentPage.update(e=>e+1),this.contactsService.setPage(this.currentPage(),this.pageSize))}isAllSelected(){let e=this.contactsService.contacts(),t=this.contactsService.selectedIds();return e.length>0&&e.every(n=>t.has(n.telegram_id))}sendMessage(e){this.sendMessageEvent.emit(e)}viewDetail(e){this.viewDetailEvent.emit(e)}editContact(e){this.toast.info("\u7DE8\u8F2F\u529F\u80FD\u958B\u767C\u4E2D...",2e3)}batchSendMessage(){let t=this.contactsService.selectedContacts().filter(n=>n.contact_type==="user");if(t.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u7528\u6236",2e3);return}this.batchSendEvent.emit(t),this.toast.info(`\u6E96\u5099\u5411 ${t.length} \u500B\u7528\u6236\u767C\u9001\u6D88\u606F...`,2e3)}sendToAISales(){let e=this.contactsService.selectedContacts();if(e.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u806F\u7E6B\u4EBA",2e3);return}this.sendToAISalesEvent.emit(e),this.toast.success(`\u5DF2\u5C07 ${e.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165\u767C\u9001\u968A\u5217`,2e3),this.contactsService.clearSelection()}goToSendConsole(){this.nav.navigateTo("leads")}toggleBatchTag(e){let t=new Set(this.selectedBatchTags());t.has(e)?t.delete(e):t.add(e),this.selectedBatchTags.set(t)}applyBatchTags(){let e=Array.from(this.selectedBatchTags());if(e.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u6A19\u7C64",2e3);return}this.contactsService.addTagsToSelected(e),this.showBatchTagDialog.set(!1),this.selectedBatchTags.set(new Set),this.toast.success("\u6A19\u7C64\u5DF2\u6DFB\u52A0",2e3)}applyBatchStatus(e){let t=this.contactsService.selectedContacts();this.contactsService.updateSelectedStatus(e),this.showBatchStatusDialog.set(!1),this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0",2e3),t.length>0&&this.statusChangedEvent.emit({contacts:t,status:e})}confirmBatchDelete(){this.showDeleteConfirm.set(!0)}confirmDelete(){this.contactsService.deleteSelected(),this.showDeleteConfirm.set(!1),this.toast.success("\u5DF2\u522A\u9664",2e3)}exportData(){this.toast.info("\u5C0E\u51FA\u529F\u80FD\u958B\u767C\u4E2D...",2e3)}getInitial(e){return e.display_name?e.display_name.charAt(0).toUpperCase():"?"}getTypeLabel(e){switch(e){case"user":return"\u6210\u54E1";case"group":return"\u7FA4\u7D44";case"channel":return"\u983B\u9053";default:return e}}getSourceLabel(e){switch(e){case"member":return"\u7FA4\u7D44\u63D0\u53D6";case"resource":return"\u8CC7\u6E90\u767C\u73FE";case"lead":return"\u71DF\u92B7\u6F0F\u6597";case"manual":return"\u624B\u52D5\u6DFB\u52A0";case"import":return"\u6279\u91CF\u5C0E\u5165";default:return e||"\u672A\u77E5"}}getSourceIcon(e){switch(e){case"member":return"\u{1F465}";case"resource":return"\u{1F50D}";case"lead":return"\u{1F3AF}";case"manual":return"\u270B";case"import":return"\u{1F4E5}";default:return"\u{1F4CB}"}}getSourceColor(e){switch(e){case"member":return"text-blue-400 bg-blue-500/20";case"resource":return"text-green-400 bg-green-500/20";case"lead":return"text-orange-400 bg-orange-500/20";case"manual":return"text-purple-400 bg-purple-500/20";case"import":return"text-cyan-400 bg-cyan-500/20";default:return"text-slate-400 bg-slate-500/20"}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-resource-center"]],outputs:{sendMessageEvent:"sendMessageEvent",viewDetailEvent:"viewDetailEvent",batchSendEvent:"batchSendEvent",sendToAISalesEvent:"sendToAISalesEvent",statusChangedEvent:"statusChangedEvent",refreshDataEvent:"refreshDataEvent"},decls:92,vars:14,consts:[[1,"resource-center","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],["title","\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65",1,"flex","items-center","gap-2","px-3","py-1","bg-blue-500/20","text-blue-400","rounded-full","text-sm","cursor-pointer","hover:bg-blue-500/30"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-lg","hover:from-cyan-600","hover:to-blue-600","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-blue-500/20","text-blue-400","rounded-lg","hover:bg-blue-500/30","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"p-4","border-b","border-slate-700/30"],[1,"grid","grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-slate-800/80","to-slate-800/40","rounded-xl","p-4","border","border-slate-700/50"],[1,"text-slate-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"text-4xl","opacity-20"],[1,"bg-gradient-to-br","from-emerald-900/30","to-slate-800/40","rounded-xl","p-4","border","border-emerald-700/30"],[1,"text-emerald-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"bg-gradient-to-br","from-blue-900/30","to-slate-800/40","rounded-xl","p-4","border","border-blue-700/30"],[1,"text-blue-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-blue-400"],[1,"bg-gradient-to-br","from-yellow-900/30","to-slate-800/40","rounded-xl","p-4","border","border-yellow-700/30"],[1,"text-yellow-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-yellow-400"],[1,"flex","items-center","gap-4","flex-wrap"],[1,"flex","bg-slate-800/50","rounded-lg","p-1"],[1,"px-4","py-2","rounded-md","text-sm","transition-all",3,"bg-purple-500","text-white","text-slate-400","hover:text-white"],[1,"px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","text-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"flex-1","max-w-md"],[1,"relative"],["type","text","placeholder","\u641C\u7D22\u540D\u7A31\u3001\u7528\u6236\u540D\u6216 ID...",1,"w-full","px-4","py-2","pl-10","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","keyup.enter","ngModel"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"absolute","left-3","top-1/2","-translate-y-1/2","h-4","w-4","text-slate-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors",3,"click"],[1,"p-3","bg-purple-500/10","border-b","border-purple-500/30","flex","items-center","gap-4"],[1,"flex-1","overflow-y-auto","p-4"],[1,"flex","items-center","justify-center","h-64"],[1,"flex","flex-col","items-center","justify-center","h-64","text-slate-400"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],["title","\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65",1,"flex","items-center","gap-2","px-3","py-1","bg-blue-500/20","text-blue-400","rounded-full","text-sm","cursor-pointer","hover:bg-blue-500/30",3,"click"],[1,"animate-spin","h-4","w-4","border-2","border-blue-400","border-t-transparent","rounded-full"],[1,"px-4","py-2","rounded-md","text-sm","transition-all",3,"click"],[1,"text-purple-400","text-sm"],[1,"px-3","py-1.5","bg-blue-500/20","text-blue-400","rounded-lg","text-sm","hover:bg-blue-500/30",3,"click"],[1,"px-3","py-1.5","bg-green-500/20","text-green-400","rounded-lg","text-sm","hover:bg-green-500/30",3,"click"],[1,"px-3","py-1.5","bg-purple-500/20","text-purple-400","rounded-lg","text-sm","hover:bg-purple-500/30",3,"click"],[1,"px-3","py-1.5","bg-cyan-500/20","text-cyan-400","rounded-lg","text-sm","hover:bg-cyan-500/30","flex","items-center","gap-1",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","text-red-400","rounded-lg","text-sm","hover:bg-red-500/30",3,"click"],[1,"ml-auto","px-3","py-1.5","text-slate-400","text-sm","hover:text-white",3,"click"],[1,"animate-spin","rounded-full","h-12","w-12","border-t-2","border-b-2","border-purple-500"],[1,"text-5xl","mb-4"],[1,"text-lg","mb-2"],[1,"text-sm","mb-4"],[1,"bg-slate-800/30","rounded-xl","border","border-slate-700/50","overflow-hidden"],[1,"w-full"],[1,"bg-slate-800/50"],[1,"text-left","text-slate-400","text-sm"],[1,"p-3","w-12"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600",3,"change","checked"],[1,"p-3"],[1,"border-t","border-slate-700/30","hover:bg-slate-800/30","transition-colors"],[1,"flex","items-center","justify-between","mt-4","text-slate-400","text-sm"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-slate-800","rounded-lg","hover:bg-slate-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-white","font-bold"],[1,"font-medium","text-white"],[1,"text-sm","text-slate-400"],[1,"px-2","py-1","rounded-full","text-xs"],[1,"flex","items-center","gap-1"],[1,"text-sm"],[1,"text-sm","px-1.5","py-0.5","rounded"],[1,"text-xs","text-slate-500","truncate","max-w-32","mt-0.5"],[1,"flex","flex-wrap","gap-1"],[1,"px-2","py-0.5","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-0.5","bg-slate-700","text-slate-400","rounded","text-xs"],[1,"w-16","bg-slate-700","rounded-full","h-2"],[1,"bg-gradient-to-r","from-purple-500","to-pink-500","h-2","rounded-full"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","text-blue-400","hover:bg-blue-500/20","rounded-lg","transition-colors"],["title","\u67E5\u770B\u8A73\u60C5",1,"p-2","text-slate-400","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["title","\u7DE8\u8F2F",1,"p-2","text-slate-400","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","text-blue-400","hover:bg-blue-500/20","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-md","p-6","shadow-xl","border","border-slate-700"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"space-y-3","max-h-64","overflow-y-auto"],[1,"flex","items-center","gap-3","p-2","hover:bg-slate-700/50","rounded-lg","cursor-pointer"],[1,"flex","gap-3","mt-6"],[1,"flex-1","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],[1,"flex-1","py-2.5","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400",3,"click"],[1,"text-white"],[1,"space-y-2"],[1,"w-full","p-3","text-left","rounded-lg","hover:bg-slate-700/50","flex","items-center","gap-3"],[1,"w-full","mt-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],[1,"w-full","p-3","text-left","rounded-lg","hover:bg-slate-700/50","flex","items-center","gap-3",3,"click"],[1,"w-3","h-3","rounded-full"],[1,"text-xl","font-bold","text-red-400","mb-4"],[1,"text-slate-300","mb-6"],[1,"flex","gap-3"],[1,"flex-1","py-2.5","bg-red-500","text-white","rounded-lg","hover:bg-red-400",3,"click"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u{1F4E6}"),s(),l(7," \u8CC7\u6E90\u4E2D\u5FC3 "),s(),y(8,ZG,3,0,"span",6),s(),r(9,"div",7)(10,"button",8),x("click",function(){return n.goToSendConsole()}),r(11,"span"),l(12,"\u{1F4E4}"),s(),l(13," \u767C\u9001\u63A7\u5236\u53F0 "),s(),r(14,"button",9),x("click",function(){return n.syncData()}),ne(),r(15,"svg",10),B(16,"path",11),s(),l(17," \u540C\u6B65\u6578\u64DA "),s(),ce(),r(18,"button",12),x("click",function(){return n.showImportDialog.set(!0)}),l(19," \u5C0E\u5165 "),s(),r(20,"button",12),x("click",function(){return n.exportData()}),l(21," \u5C0E\u51FA "),s()()()(),r(22,"div",13)(23,"div",14)(24,"div",15)(25,"div",2)(26,"div")(27,"div",16),l(28,"\u{1F4CA} \u7E3D\u8CC7\u6E90"),s(),r(29,"div",17),l(30),s()(),r(31,"div",18),l(32,"\u{1F4E6}"),s()()(),r(33,"div",19)(34,"div",2)(35,"div")(36,"div",20),l(37,"\u{1F195} \u672C\u9031\u65B0\u589E"),s(),r(38,"div",21),l(39),s()(),r(40,"div",18),l(41,"\u{1F4C8}"),s()()(),r(42,"div",22)(43,"div",2)(44,"div")(45,"div",23),l(46,"\u{1F514} \u5F85\u8DDF\u9032"),s(),r(47,"div",24),l(48),s()(),r(49,"div",18),l(50,"\u{1F44B}"),s()()(),r(51,"div",25)(52,"div",2)(53,"div")(54,"div",26),l(55,"\u{1F4AC} \u5DF2\u806F\u7E6B"),s(),r(56,"div",27),l(57),s()(),r(58,"div",18),l(59,"\u2709\uFE0F"),s()()()()(),r(60,"div",13)(61,"div",28)(62,"div",29),O(63,e$,2,10,"button",30,YG),s(),r(65,"select",31),W("ngModelChange",function(a){return q(n.selectedStatus,a)||(n.selectedStatus=a),a}),x("ngModelChange",function(a){return n.filterByStatus(a)}),r(66,"option",32),l(67,"\u6240\u6709\u72C0\u614B"),s(),O(68,t$,2,2,"option",33,x1),s(),r(70,"select",31),W("ngModelChange",function(a){return q(n.selectedTag,a)||(n.selectedTag=a),a}),x("ngModelChange",function(a){return n.filterByTag(a)}),r(71,"option",32),l(72,"\u6240\u6709\u6A19\u7C64"),s(),O(73,n$,2,2,"option",33,be),s(),r(75,"div",34)(76,"div",35)(77,"input",36),W("ngModelChange",function(a){return q(n.searchKeyword,a)||(n.searchKeyword=a),a}),x("keyup.enter",function(){return n.search()}),s(),ne(),r(78,"svg",37),B(79,"path",38),s()()(),ce(),r(80,"button",39),x("click",function(){return n.search()}),l(81," \u641C\u7D22 "),s(),r(82,"button",12),x("click",function(){return n.resetFilters()}),l(83," \u91CD\u7F6E "),s()()(),y(84,i$,17,1,"div",40),r(85,"div",41),y(86,o$,2,0,"div",42)(87,r$,9,0,"div",43)(88,m$,33,6),s(),y(89,g$,12,0,"div",44),y(90,f$,9,0,"div",44),y(91,_$,11,1,"div",44),s()),t&2){let o,a;c(8),S(n.contactsService.isSyncing()?8:-1),c(6),L("disabled",n.contactsService.isSyncing()),c(16),D(n.contactsService.stats().total),c(9),M("+",n.contactsService.stats().recent_added),c(9),D(((o=n.contactsService.stats().by_status)==null?null:o.new)||0),c(9),D(((a=n.contactsService.stats().by_status)==null?null:a.contacted)||0),c(6),U(n.tabs),c(2),H("ngModel",n.selectedStatus),c(3),U(n.statusOptions),c(2),H("ngModel",n.selectedTag),c(3),U(n.defaultTags),c(4),H("ngModel",n.searchKeyword),c(7),S(n.contactsService.selectedIds().size>0?84:-1),c(2),S(n.contactsService.isLoading()?86:n.contactsService.contacts().length===0?87:88),c(3),S(n.showBatchTagDialog()?89:-1),c(),S(n.showBatchStatusDialog()?90:-1),c(),S(n.showDeleteConfirm()?91:-1)}},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he],styles:[".resource-center[_ngcontent-%COMP%]{min-height:100vh}"]})}};var v$=`\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u7CBE\u901A\u5404\u884C\u696D\u7684\u5BA2\u6236\u7372\u53D6\u548C\u71DF\u92B7\u8A71\u8853\u3002

\u7528\u6236\u9700\u6C42\uFF1A{USER_INPUT}

\u8ACB\u6839\u64DA\u7528\u6236\u9700\u6C42\uFF0C\u751F\u6210\u4E00\u4EFD\u5B8C\u6574\u7684\u71DF\u92B7\u7B56\u7565\u3002\u8FD4\u56DE\u7D14 JSON \u683C\u5F0F\uFF08\u4E0D\u8981 markdown \u4EE3\u78BC\u584A\uFF09\uFF1A

{
  "industry": "\u8B58\u5225\u7684\u76EE\u6A19\u884C\u696D",
  "targetAudience": "\u76EE\u6A19\u53D7\u773E\u63CF\u8FF0",
  "keywords": {
    "highIntent": ["\u9AD8\u610F\u5411\u95DC\u9375\u8A5E1", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E2", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E3"],
    "mediumIntent": ["\u4E2D\u610F\u5411\u95DC\u9375\u8A5E1", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E2", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E3"],
    "extended": ["\u64F4\u5C55\u95DC\u9375\u8A5E1", "\u64F4\u5C55\u95DC\u9375\u8A5E2", "\u64F4\u5C55\u95DC\u9375\u8A5E3"]
  },
  "customerProfile": {
    "identity": ["\u8EAB\u4EFD\u7279\u5FB51", "\u8EAB\u4EFD\u7279\u5FB52", "\u8EAB\u4EFD\u7279\u5FB53"],
    "features": ["\u884C\u70BA\u7279\u5FB51", "\u884C\u70BA\u7279\u5FB52", "\u884C\u70BA\u7279\u5FB53"],
    "needs": ["\u6838\u5FC3\u9700\u6C421", "\u6838\u5FC3\u9700\u6C422", "\u6838\u5FC3\u9700\u6C423"]
  },
  "recommendedGroups": ["\u63A8\u85A6\u641C\u7D22\u7684\u7FA4\u7D44\u985E\u578B1", "\u63A8\u85A6\u7FA4\u7D44\u985E\u578B2"],
  "messageTemplates": {
    "firstTouch": "\u9996\u6B21\u89F8\u9054\u6D88\u606F\u6A21\u677F\uFF08\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF09",
    "followUp": "\u8DDF\u9032\u6D88\u606F\u6A21\u677F",
    "closing": "\u4FC3\u6210\u8F49\u5316\u6D88\u606F\u6A21\u677F"
  },
  "automationSettings": {
    "monitorMode": "24/7 \u5168\u5929\u5019",
    "responseDelay": 30,
    "followUpInterval": 7200
  }
}

\u8981\u6C42\uFF1A
1. \u95DC\u9375\u8A5E\u8981\u7CBE\u6E96\uFF0C\u8986\u84CB\u884C\u696D\u5E38\u7528\u8853\u8A9E\u548C\u641C\u7D22\u8A5E
2. \u6D88\u606F\u6A21\u677F\u8981\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF0C\u907F\u514D\u6A5F\u5668\u4EBA\u611F
3. \u5BA2\u6236\u756B\u50CF\u8981\u5177\u9AD4\uFF0C\u4FBF\u65BC\u8B58\u5225\u76EE\u6A19\u5BA2\u6236
4. \u53EA\u8FD4\u56DE JSON\uFF0C\u4E0D\u8981\u4EFB\u4F55\u5176\u4ED6\u89E3\u91CB`,ld=class i{constructor(){this.aiProviderService=F(Ai);this.aiCenterService=F(Mt);this.toastService=F(J);this.ipcService=F(Q);this._availableModels=f([]);this.availableModels=this._availableModels.asReadonly();this._selectedModelId=f("local-ollama");this.selectedModelId=this._selectedModelId.asReadonly();this._localAIConfig=f({endpoint:"https://ms-defysomwqybz.tail05a567.ts.net/api/chat",model:"huihui_ai/qwen2.5-abliterate",isConnected:!1,lastChecked:""});this.localAIConfig=this._localAIConfig.asReadonly();this._generationStatus=f({isGenerating:!1,currentProvider:"",progress:0,message:""});this.generationStatus=this._generationStatus.asReadonly();this._savedStrategies=f([]);this.savedStrategies=this._savedStrategies.asReadonly();this._currentStrategy=f(null);this.currentStrategy=this._currentStrategy.asReadonly();this.selectedModel=R(()=>this._availableModels().find(e=>e.id===this._selectedModelId()));this.loadConfig(),this.refreshAvailableModels()}async refreshAvailableModels(){let e=[],t=this.aiCenterService.models(),n=t.filter(u=>u.isLocal);if(n.length>0)for(let u of n)e.push({id:u.id,name:u.displayName||u.modelName,provider:"Ollama (\u672C\u5730)",icon:"\u{1F999}",isLocal:!0,isConnected:u.isConnected,endpoint:u.apiEndpoint}),u.apiEndpoint&&this._localAIConfig.update(p=>P(E({},p),{endpoint:u.apiEndpoint,model:u.modelName,isConnected:u.isConnected}));else{let u=this._localAIConfig();e.push({id:"local-ollama",name:`\u672C\u5730 AI (${u.model})`,provider:"Ollama (Tailscale)",icon:"\u{1F999}",isLocal:!0,isConnected:u.isConnected,endpoint:u.endpoint})}let o=t.filter(u=>!u.isLocal);for(let u of o){let p=this.getProviderInfo(u.provider),g=this.getModelCapability(u.modelName);e.push({id:u.id,name:u.displayName||u.modelName,provider:p.name,icon:p.icon,isLocal:!1,isConnected:u.isConnected,capability:g})}e.length===0&&console.log("[AIStrategy] \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B\uFF0C\u8ACB\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E"),e.sort((u,p)=>u.isConnected&&!p.isConnected?-1:!u.isConnected&&p.isConnected?1:u.isLocal&&!p.isLocal?-1:0),this._availableModels.set(e);let a=this._selectedModelId();if(!e.map(u=>u.id).includes(a)){let u=e.find(p=>p.isConnected);u?this._selectedModelId.set(u.id):e.length>0&&this._selectedModelId.set(e[0].id)}}selectModel(e){this._selectedModelId.set(e),this.saveConfig()}updateLocalAIConfig(e){this._localAIConfig.update(t=>E(E({},t),e)),this.saveConfig(),this.refreshAvailableModels()}async testLocalAIConnection(){let e=this._localAIConfig();try{this._generationStatus.set({isGenerating:!0,currentProvider:"\u672C\u5730 Ollama",progress:50,message:"\u6B63\u5728\u6E2C\u8A66\u9023\u63A5..."});let t=await fetch(e.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e.model,messages:[{role:"user",content:"Hi, please respond with OK."}],stream:!1,options:{temperature:.1,num_predict:10}}),signal:AbortSignal.timeout(1e4)});if(t.ok&&(await t.json()).message?.content)return this._localAIConfig.update(o=>P(E({},o),{isConnected:!0,lastChecked:new Date().toISOString()})),this.refreshAvailableModels(),this.toastService.success("\u672C\u5730 AI \u9023\u63A5\u6210\u529F\uFF01"),!0;throw new Error("\u7121\u6548\u97FF\u61C9")}catch(t){return this._localAIConfig.update(n=>P(E({},n),{isConnected:!1,lastChecked:new Date().toISOString()})),this.refreshAvailableModels(),this.toastService.error(`\u672C\u5730 AI \u9023\u63A5\u5931\u6557: ${t.message}`),!1}finally{this._generationStatus.set({isGenerating:!1,currentProvider:"",progress:0,message:""})}}async generateStrategy(e){let t=v$.replace("{USER_INPUT}",e),n=[{role:"system",content:"\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u53EA\u8FD4\u56DE JSON \u683C\u5F0F\u7684\u7B56\u7565\u5206\u6790\u7D50\u679C\u3002"},{role:"user",content:t}],o=this.selectedModel(),a=o?.name||"\u672C\u5730 AI",d=o?.isLocal??!0;if(console.log(`[AIStrategy] \u4F7F\u7528\u6A21\u578B: ${a}, isLocal: ${d}`),d){this._generationStatus.set({isGenerating:!0,currentProvider:a,progress:20,message:`\u6B63\u5728\u4F7F\u7528 ${a} \u5206\u6790...`});try{let p=await this.callLocalAI(n);if(p){let g=this.parseStrategyResponse(p);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:a,progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(p){console.warn(`[AIStrategy] ${a} \u5931\u6557:`,p.message),this.toastService.warning(`${a} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u96F2\u7AEF\u56DE\u9000...`)}this._generationStatus.set({isGenerating:!0,currentProvider:"\u96F2\u7AEF AI (\u56DE\u9000)",progress:50,message:"\u672C\u5730 AI \u4E0D\u53EF\u7528\uFF0C\u6B63\u5728\u4F7F\u7528\u96F2\u7AEF AI..."});try{let p=await this.callCloudAI(n);if(p){let g=this.parseStrategyResponse(p);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:"\u96F2\u7AEF AI",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(p){console.warn("[AIStrategy] \u96F2\u7AEF AI \u56DE\u9000\u5931\u6557:",p.message)}}else{this._generationStatus.set({isGenerating:!0,currentProvider:a,progress:30,message:`\u6B63\u5728\u4F7F\u7528 ${a} \u5206\u6790...`});try{let p=await this.callSelectedCloudModel(n,o);if(p){let g=this.parseStrategyResponse(p);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:a,progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(p){console.warn(`[AIStrategy] ${a} \u5931\u6557:`,p.message),this.toastService.warning(`${a} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u5176\u4ED6\u6A21\u578B...`)}this._generationStatus.set({isGenerating:!0,currentProvider:"\u5176\u4ED6\u96F2\u7AEF\u6A21\u578B",progress:60,message:"\u5617\u8A66\u5176\u4ED6\u53EF\u7528\u6A21\u578B..."});try{let p=await this.callCloudAI(n);if(p){let g=this.parseStrategyResponse(p);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:"\u96F2\u7AEF AI",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(p){console.warn("[AIStrategy] \u6240\u6709\u96F2\u7AEF AI \u5931\u6557:",p.message)}}this._generationStatus.set({isGenerating:!0,currentProvider:"\u6A21\u677F\u56DE\u9000",progress:80,message:"AI \u4E0D\u53EF\u7528\uFF0C\u4F7F\u7528\u667A\u80FD\u6A21\u677F..."});let u=this.generateFromTemplate(e);return this._generationStatus.set({isGenerating:!1,currentProvider:"\u6A21\u677F\u56DE\u9000",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF08\u6A21\u677F\u6A21\u5F0F\uFF09"}),u}async callLocalAI(e){let t=this._localAIConfig(),n=await fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t.model,messages:e,stream:!1,options:{temperature:.7,num_predict:2048,top_p:.9}}),signal:AbortSignal.timeout(3e4)});if(!n.ok)throw new Error(`\u672C\u5730 AI \u8ACB\u6C42\u5931\u6557: ${n.status}`);return(await n.json()).message?.content||null}async callCloudAI(e){try{console.log("[AIStrategy] \u5617\u8A66\u901A\u904E\u5F8C\u7AEF IPC \u8ABF\u7528 AI...");let a=await this.callAIViaBackend(e);if(a)return console.log("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u6210\u529F"),a}catch(a){console.warn("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u5931\u6557:",a)}let t=this.aiCenterService.models(),n=t.filter(a=>a.isConnected&&!a.isLocal),o=n.length>0?n:t.filter(a=>!a.isLocal&&a.apiKey);for(let a of o)try{console.log(`[AIStrategy] \u5617\u8A66\u96F2\u7AEF\u6A21\u578B: ${a.modelName}`),this.aiProviderService.setConfig({provider:a.provider,model:a.modelName,apiKey:a.apiKey,baseUrl:a.apiEndpoint});let d=await this.aiProviderService.chat(e);if(d.content)return d.content}catch(d){console.warn(`[AIStrategy] \u96F2\u7AEF\u6A21\u578B ${a.modelName} \u5931\u6557:`,d)}if(this.aiProviderService.isConnected())try{return(await this.aiProviderService.chat(e)).content}catch(a){console.warn("[AIStrategy] AIProviderService \u8ABF\u7528\u5931\u6557:",a)}return null}callAIViaBackend(e){return new Promise((t,n)=>{let o=setTimeout(()=>{this.ipcService.off("ai-response",a),n(new Error("\u5F8C\u7AEF AI \u8ABF\u7528\u8D85\u6642"))},6e4),a=g=>{clearTimeout(o),this.ipcService.off("ai-response",a),g.success&&g.response?t(g.response):g.error?n(new Error(g.error)):t(null)};this.ipcService.on("ai-response",a);let d=e.find(g=>g.role==="system"),u=e.find(g=>g.role==="user"),p=this._localAIConfig();this.ipcService.send("generate-ai-response",{userId:"strategy-generator",message:u?.content||"",systemPrompt:d?.content||"",localAiEndpoint:p.endpoint,localAiModel:p.model})})}async callSelectedCloudModel(e,t){let o=this.aiCenterService.models().find(d=>d.id===t.id);return o?!o.apiKey&&!o.isConnected?(console.warn(`[AIStrategy] \u6A21\u578B ${t.name} \u672A\u914D\u7F6E API Key`),this.toastService.error(`\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E ${t.name} \u7684 API Key`),null):(console.log(`[AIStrategy] \u8ABF\u7528\u9078\u5B9A\u6A21\u578B: ${o.modelName}, provider: ${o.provider}`),this.aiProviderService.setConfig({provider:o.provider,model:o.modelName,apiKey:o.apiKey,baseUrl:o.apiEndpoint}),(await this.aiProviderService.chat(e)).content):(console.warn(`[AIStrategy] \u627E\u4E0D\u5230\u6A21\u578B\u914D\u7F6E: ${t.id}`),null)}getLocalAIFromCenter(){let e=this.aiCenterService.models().filter(t=>t.isLocal);if(e.length>0){let t=e[0];return{endpoint:t.apiEndpoint||"",model:t.modelName}}return null}syncLocalAIFromCenter(){let e=this.getLocalAIFromCenter();e&&e.endpoint&&this._localAIConfig.update(t=>P(E({},t),{endpoint:e.endpoint,model:e.model}))}parseStrategyResponse(e){try{let t=e,n=e.match(/```(?:json)?\s*([\s\S]*?)```/);n&&(t=n[1]);let o=t.indexOf("{"),a=t.lastIndexOf("}");o!==-1&&a!==-1&&(t=t.slice(o,a+1));let d=JSON.parse(t);if(!d.industry||!d.keywords)throw new Error("\u7F3A\u5C11\u5FC5\u8981\u5B57\u6BB5");return{industry:d.industry||"\u672A\u8B58\u5225\u884C\u696D",targetAudience:d.targetAudience||"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4",keywords:{highIntent:d.keywords?.highIntent||[],mediumIntent:d.keywords?.mediumIntent||[],extended:d.keywords?.extended||[]},customerProfile:{identity:d.customerProfile?.identity||[],features:d.customerProfile?.features||[],needs:d.customerProfile?.needs||[]},recommendedGroups:d.recommendedGroups||[],messageTemplates:{firstTouch:d.messageTemplates?.firstTouch||"",followUp:d.messageTemplates?.followUp||"",closing:d.messageTemplates?.closing||""},automationSettings:{monitorMode:d.automationSettings?.monitorMode||"24/7 \u5168\u5929\u5019",responseDelay:d.automationSettings?.responseDelay||30,followUpInterval:d.automationSettings?.followUpInterval||7200}}}catch(t){return console.error("[AIStrategy] \u89E3\u6790 AI \u97FF\u61C9\u5931\u6557:",t,e),null}}generateFromTemplate(e){let t="\u901A\u7528\u884C\u696D",n={highIntent:["\u5408\u4F5C","\u4EE3\u7406","\u5C0D\u63A5"],mediumIntent:["\u8CC7\u6E90","\u6E20\u9053","\u696D\u52D9"],extended:["\u4EA4\u6D41","\u4E86\u89E3","\u54A8\u8A62"]};return e.includes("\u652F\u4ED8")||e.includes("\u63DB\u532F")||e.includes("\u8DD1\u5206")?(t="\u652F\u4ED8/\u63DB\u532F",n={highIntent:["\u652F\u4ED8\u901A\u9053","U\u5546","\u63DB\u532F","USDT","\u4EE3\u6536\u4EE3\u4ED8","\u8DD1\u5206"],mediumIntent:["\u56DB\u65B9\u652F\u4ED8","\u4E09\u65B9\u652F\u4ED8","API\u5C0D\u63A5","\u627F\u514C\u5546"],extended:["OTC","\u6536\u6B3E","\u51FA\u6B3E","\u8CBB\u7387","T+0","T+1"]}):e.includes("\u5E63")||e.includes("\u52A0\u5BC6")||e.includes("BTC")?(t="\u52A0\u5BC6\u8CA8\u5E63",n={highIntent:["BTC","ETH","\u5408\u7D04","\u73FE\u8CA8","\u4EA4\u6613\u6240"],mediumIntent:["DeFi","NFT","\u9322\u5305","\u516C\u93C8"],extended:["\u6316\u7926","\u8CEA\u62BC","\u7A7A\u6295","IDO"]}):(e.includes("\u96FB\u5546")||e.includes("\u8DE8\u5883")||e.includes("\u4E9E\u99AC\u905C"))&&(t="\u96FB\u5546/\u8DE8\u5883",n={highIntent:["\u4E9E\u99AC\u905C","\u7368\u7ACB\u7AD9","Shopify","\u7269\u6D41","\u9078\u54C1"],mediumIntent:["FBA","\u6D77\u5916\u5009","\u6E05\u95DC","\u652F\u4ED8"],extended:["\u6E2C\u8A55","\u5237\u55AE","\u7AD9\u5916\u63A8\u5EE3"]}),{industry:t,targetAudience:this.extractAudience(e),keywords:n,customerProfile:{identity:["\u4EE3\u7406\u5546","\u9805\u76EE\u65B9","\u904B\u71DF\u4EBA\u54E1"],features:["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44","\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F","\u6709\u660E\u78BA\u9700\u6C42"],needs:["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34","\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE","\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]},recommendedGroups:[`${t}\u4EA4\u6D41\u7FA4`,"\u696D\u52D9\u5C0D\u63A5\u7FA4","\u9805\u76EE\u5408\u4F5C\u7FA4"],messageTemplates:{firstTouch:`\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${t}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,followUp:"\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",closing:"\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"},automationSettings:{monitorMode:"24/7 \u5168\u5929\u5019",responseDelay:30,followUpInterval:7200}}}extractAudience(e){return e.includes("\u4EE3\u7406")?"\u4EE3\u7406\u5546/\u6E20\u9053\u5546":e.includes("\u5BA2\u6236")?"\u7D42\u7AEF\u5BA2\u6236":e.includes("\u9805\u76EE")?"\u9805\u76EE\u65B9/\u904B\u71DF\u5546":"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4"}getProviderInfo(e){switch(e){case"openai":return{name:"OpenAI",icon:"\u{1F916}"};case"claude":return{name:"Anthropic",icon:"\u{1F9E0}"};case"gemini":return{name:"Google",icon:"\u2728"};default:return{name:e,icon:"\u{1F527}"}}}getModelCapability(e){let t=e.toLowerCase();return t.includes("flash")||t.includes("mini")||t.includes("haiku")||t.includes("3.5-turbo")?"fast":t.includes("opus")||t.includes("pro")||t.includes("gpt-4o")||t.includes("ultra")?"powerful":t.includes("mini")||t.includes("nano")||t.includes("lite")?"economic":"balanced"}loadConfig(){try{let e=localStorage.getItem("ai-strategy-config");if(e){let t=JSON.parse(e);t.localAIConfig&&this._localAIConfig.set(t.localAIConfig),t.selectedModelId&&this._selectedModelId.set(t.selectedModelId)}this.loadSavedStrategies()}catch(e){console.error("Failed to load AI strategy config:",e)}}saveConfig(){try{localStorage.setItem("ai-strategy-config",JSON.stringify({localAIConfig:this._localAIConfig(),selectedModelId:this._selectedModelId()}))}catch(e){console.error("Failed to save AI strategy config:",e)}}loadSavedStrategies(){try{let e=localStorage.getItem("ai-saved-strategies");if(e){let t=JSON.parse(e);this._savedStrategies.set(t),console.log(`[AIStrategy] \u5DF2\u52A0\u8F09 ${t.length} \u500B\u4FDD\u5B58\u7684\u7B56\u7565`)}}catch(e){console.error("Failed to load saved strategies:",e)}}saveStrategy(e,t){let n={id:`strategy-${Date.now()}`,name:t||`${e.industry} - ${new Date().toLocaleDateString("zh-TW")}`,strategy:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usedCount:0},o=[...this._savedStrategies(),n];this._savedStrategies.set(o),this._currentStrategy.set(e);try{localStorage.setItem("ai-saved-strategies",JSON.stringify(o))}catch(a){console.error("Failed to save strategies:",a)}return this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01"),n}loadStrategy(e){let t=this._savedStrategies().find(n=>n.id===e);return t?(t.usedCount++,t.updatedAt=new Date().toISOString(),this._currentStrategy.set(t.strategy),this.persistStrategies(),t.strategy):null}deleteStrategy(e){let t=this._savedStrategies().filter(n=>n.id!==e);this._savedStrategies.set(t),this.persistStrategies(),this.toastService.success("\u7B56\u7565\u5DF2\u522A\u9664")}setCurrentStrategy(e){this._currentStrategy.set(e)}persistStrategies(){try{localStorage.setItem("ai-saved-strategies",JSON.stringify(this._savedStrategies()))}catch(e){console.error("Failed to persist strategies:",e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Pm=(i,e)=>e.id;function x$(i,e){if(i&1&&(r(0,"span",18),l(1),s()),i&2){let t=m(2);c(),M(" ",t.connectedModelsCount()," \u500B\u5DF2\u9023\u63A5 ")}}function C$(i,e){i&1&&(r(0,"span",19),l(1,"\u672A\u914D\u7F6E"),s())}function b$(i,e){if(i&1){let t=I();r(0,"div",21)(1,"p",26),l(2,"\u26A0\uFE0F \u5C1A\u672A\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B"),s(),r(3,"p",27),l(4,"\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E\u4E26\u6E2C\u8A66 AI \u6A21\u578B"),s(),r(5,"button",28),x("click",function(){_(t);let o=m(2);return v(o.goToAICenter())}),l(6," \u{1F680} \u524D\u5F80\u914D\u7F6E AI "),s()()}}function y$(i,e){if(i&1&&(r(0,"span",38),l(1),s()),i&2){let t=m().$implicit,n=m(4);de(n.getCapabilityStyle(t.capability)),c(),M(" ",n.getCapabilityLabel(t.capability)," ")}}function S$(i,e){if(i&1){let t=I();r(0,"button",35),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.selectModel(o.id))}),r(1,"span"),l(2),s(),r(3,"span"),l(4),s(),y(5,y$,2,3,"span",36),B(6,"span",37),s()}if(i&2){let t=e.$implicit,n=m(4);de(n.selectedModelId()===t.id?"bg-emerald-500/30 text-emerald-400 border-2 border-emerald-500/50 shadow-lg shadow-emerald-500/20":"bg-slate-700/50 text-slate-300 border border-slate-600 hover:bg-slate-600/50 hover:border-emerald-500/30"),c(2),D(t.icon),c(2),D(t.name),c(),S(t.capability?5:-1)}}function w$(i,e){if(i&1&&(r(0,"div")(1,"p",31),B(2,"span",32),l(3," \u53EF\u7528\u6A21\u578B "),s(),r(4,"div",33),O(5,S$,7,5,"button",34,Pm),s()()),i&2){let t=m(3);c(5),U(t.connectedModels())}}function E$(i,e){if(i&1){let t=I();r(0,"button",41),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.selectModel(o.id))}),r(1,"span"),l(2),s(),r(3,"span"),l(4),s(),r(5,"span",42),l(6,"\u672A\u6E2C\u8A66"),s()()}if(i&2){let t=e.$implicit,n=m(4);de(n.selectedModelId()===t.id?"bg-slate-600/50 text-slate-300 border border-slate-500":"bg-slate-800/50 text-slate-500 border border-slate-700 hover:opacity-80"),c(2),D(t.icon),c(2),D(t.name)}}function D$(i,e){if(i&1&&(r(0,"div")(1,"p",31),B(2,"span",39),l(3," \u672A\u9023\u63A5\uFF08\u9700\u8981\u6E2C\u8A66\uFF09 "),s(),r(4,"div",33),O(5,E$,7,4,"button",40,Pm),s()()),i&2){let t=m(3);c(5),U(t.disconnectedModels())}}function A$(i,e){i&1&&(r(0,"p",30),l(1," \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI\uFF08\u514D\u8CBB\u7121\u9650\uFF09\uFF0C\u96F2\u7AEF AI \u6309\u4F7F\u7528\u91CF\u8A08\u8CBB "),s())}function M$(i,e){if(i&1&&(r(0,"div",29),y(1,w$,7,0,"div"),y(2,D$,7,0,"div"),s(),y(3,A$,2,0,"p",30)),i&2){let t=m(2);c(),S(t.connectedModels().length>0?1:-1),c(),S(t.disconnectedModels().length>0?2:-1),c(),S(t.connectedModels().length>0?3:-1)}}function T$(i,e){i&1&&(r(0,"span",45),l(1,"\u2713 \u5DF2\u9023\u63A5"),s())}function k$(i,e){i&1&&(r(0,"span",46),l(1,"\u672A\u9023\u63A5"),s())}function I$(i,e){i&1&&B(0,"span",60)}function F$(i,e){i&1&&(r(0,"span",42),l(1,"\u672A\u914D\u7F6E"),s())}function P$(i,e){if(i&1){let t=I();r(0,"div",55),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.selectModel(o.id))}),r(1,"div",56)(2,"span",57),l(3),s(),r(4,"div",58)(5,"div",59),l(6),s(),r(7,"div",42),l(8),s()(),y(9,I$,1,0,"span",60)(10,F$,2,0,"span",42),s()()}if(i&2){let t=e.$implicit,n=m(3);de(n.selectedModelId()===t.id?"bg-purple-500/20 border-purple-500/50":"bg-slate-800/50 border-slate-700 hover:border-slate-500"),c(3),D(t.icon),c(3),D(t.name),c(2),D(t.provider),c(),S(t.isConnected?9:t.isLocal?-1:10)}}function R$(i,e){if(i&1){let t=I();r(0,"div",22)(1,"div",43)(2,"h4",44),l(3," \u{1F999} \u672C\u5730 Ollama \u914D\u7F6E "),y(4,T$,2,0,"span",45)(5,k$,2,0,"span",46),s(),r(6,"div",47)(7,"div")(8,"label",48),l(9,"API \u7AEF\u9EDE"),s(),r(10,"input",49),x("change",function(o){_(t);let a=m(2);return v(a.updateLocalEndpoint(o.target.value))}),s()(),r(11,"div")(12,"label",48),l(13,"\u6A21\u578B\u540D\u7A31"),s(),r(14,"input",50),x("change",function(o){_(t);let a=m(2);return v(a.updateLocalModel(o.target.value))}),s()()(),r(15,"button",51),x("click",function(){_(t);let o=m(2);return v(o.testLocalAI())}),l(16," \u{1F517} \u6E2C\u8A66\u9023\u63A5 "),s()(),r(17,"div")(18,"h4",52),l(19,"\u53EF\u7528\u6A21\u578B"),s(),r(20,"div",53),O(21,P$,11,6,"div",54,Pm),s()(),r(23,"p",42),l(24," \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI (\u514D\u8CBB\u3001\u96B1\u79C1)\uFF0C\u672C\u5730\u4E0D\u53EF\u7528\u6642\u81EA\u52D5\u5207\u63DB\u5230\u96F2\u7AEF AI "),s()()}if(i&2){let t=m(2);c(4),S(t.localAIConfig().isConnected?4:5),c(6),L("value",t.localAIConfig().endpoint),c(4),L("value",t.localAIConfig().model),c(7),U(t.availableModels())}}function N$(i,e){i&1&&(r(0,"span",61),l(1,"\u27F3"),s(),l(2," AI \u5206\u6790\u4E2D... "))}function V$(i,e){i&1&&l(0," \u{1F680} \u751F\u6210 AI \u71DF\u92B7\u7B56\u7565 ")}function B$(i,e){if(i&1&&(r(0,"div",25)(1,"div",62)(2,"span",63),l(3),s(),r(4,"span",64),l(5),s()(),r(6,"div",65),B(7,"div",66),s()()),i&2){let t=m(2);c(3),D(t.generationStatus().message),c(2),D(t.generationStatus().currentProvider),c(2),ee("width",t.generationStatus().progress,"%")}}function L$(i,e){if(i&1){let t=I();r(0,"div",7)(1,"div",9)(2,"label",10),l(3," \u{1F4AC} \u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u6A23\u7684\u5BA2\u6236\uFF1F "),s(),r(4,"textarea",11),W("ngModelChange",function(o){_(t);let a=m();return q(a.userInput,o)||(a.userInput=o),v(o)}),x("keydown.enter",function(o){_(t);let a=m();return v(o.ctrlKey&&a.generateStrategy())}),l(5,"                "),s(),r(6,"p",12),l(7,"\u{1F4A1} \u63D0\u793A\uFF1A\u63CF\u8FF0\u8D8A\u8A73\u7D30\uFF0CAI \u5206\u6790\u8D8A\u7CBE\u6E96"),s()(),r(8,"div",9)(9,"label",13),l(10,"\u26A1 \u5FEB\u901F\u9078\u64C7\u884C\u696D\u6A21\u677F"),s(),r(11,"div",14)(12,"button",15),x("click",function(){_(t);let o=m();return v(o.selectIndustry("payment"))}),l(13," \u{1F4B3} \u652F\u4ED8/\u63DB\u532F "),s(),r(14,"button",15),x("click",function(){_(t);let o=m();return v(o.selectIndustry("crypto"))}),l(15," \u{1FA99} \u52A0\u5BC6\u8CA8\u5E63 "),s(),r(16,"button",15),x("click",function(){_(t);let o=m();return v(o.selectIndustry("ecommerce"))}),l(17," \u{1F6D2} \u96FB\u5546/\u8DE8\u5883 "),s(),r(18,"button",15),x("click",function(){_(t);let o=m();return v(o.selectIndustry("custom"))}),l(19," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),s()()(),r(20,"div",9)(21,"div",16)(22,"label",17),l(23," \u{1F916} AI \u6A21\u578B "),y(24,x$,2,1,"span",18)(25,C$,2,0,"span",19),s(),r(26,"a",20),x("click",function(){_(t);let o=m();return v(o.goToAICenter())}),l(27," \u2699\uFE0F \u524D\u5F80 AI \u4E2D\u5FC3 "),s()(),y(28,b$,7,0,"div",21)(29,M$,4,3),y(30,R$,25,3,"div",22),s(),r(31,"div",23)(32,"button",24),x("click",function(){_(t);let o=m();return v(o.generateStrategy())}),y(33,N$,3,0)(34,V$,1,0),s(),y(35,B$,8,4,"div",25),s()()}if(i&2){let t=m();c(4),H("ngModel",t.userInput),c(8),de(t.selectedIndustry()==="payment"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(2),de(t.selectedIndustry()==="crypto"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(2),de(t.selectedIndustry()==="ecommerce"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(2),de(t.selectedIndustry()==="custom"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(6),S(t.connectedModelsCount()>0?24:25),c(4),S(t.availableModels().length===0?28:29),c(2),S(t.showModelSettings()?30:-1),c(2),L("disabled",t.isGenerating()||!t.userInput&&t.selectedIndustry()==="custom"),c(),S(t.isGenerating()?33:34),c(2),S(t.isGenerating()?35:-1)}}function O$(i,e){if(i&1&&(r(0,"span",77),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t," ")}}function U$(i,e){if(i&1&&(r(0,"span",81),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t," ")}}function G$(i,e){if(i&1&&(r(0,"span",84),l(1),s()),i&2){let t=e.$implicit;c(),M(" ",t," ")}}function $$(i,e){if(i&1&&(r(0,"li",88)(1,"span",101),l(2,"\u2022"),s(),l(3),s()),i&2){let t=e.$implicit;c(3),M(" ",t," ")}}function H$(i,e){if(i&1&&(r(0,"li",88)(1,"span",102),l(2,"\u2022"),s(),l(3),s()),i&2){let t=e.$implicit;c(3),M(" ",t," ")}}function q$(i,e){if(i&1&&(r(0,"li",88)(1,"span",103),l(2,"\u2022"),s(),l(3),s()),i&2){let t=e.$implicit;c(3),M(" ",t," ")}}function W$(i,e){if(i&1){let t=I();r(0,"div",67)(1,"div",68)(2,"span",69),l(3,"\u2728"),s(),r(4,"div")(5,"p",70),l(6,"AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01"),s(),r(7,"p",5),l(8,"\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0CAI \u5DF2\u751F\u6210\u4EE5\u4E0B\u71DF\u92B7\u7B56\u7565"),s()()(),r(9,"div",9)(10,"h3",71)(11,"span"),l(12,"\u{1F4CA}"),s(),l(13," \u884C\u696D\u5206\u6790 "),s(),r(14,"div",72)(15,"div")(16,"label",63),l(17,"\u76EE\u6A19\u884C\u696D"),s(),r(18,"p",73),l(19),s()(),r(20,"div")(21,"label",63),l(22,"\u76EE\u6A19\u53D7\u773E"),s(),r(23,"p",73),l(24),s()()()(),r(25,"div",9)(26,"h3",71)(27,"span"),l(28,"\u{1F511}"),s(),l(29," AI \u63A8\u85A6\u95DC\u9375\u8A5E "),r(30,"span",74),l(31,"\u9EDE\u64CA\u53EF\u7DE8\u8F2F"),s()(),r(32,"div",75)(33,"div")(34,"label",76),B(35,"span",37),l(36," \u9AD8\u610F\u5411\u95DC\u9375\u8A5E "),s(),r(37,"div",33),O(38,O$,2,1,"span",77,ct),r(40,"button",78),x("click",function(){_(t);let o=m(2);return v(o.addKeyword("high"))}),l(41," + \u6DFB\u52A0 "),s()()(),r(42,"div")(43,"label",79),B(44,"span",80),l(45," \u4E2D\u610F\u5411\u95DC\u9375\u8A5E "),s(),r(46,"div",33),O(47,U$,2,1,"span",81,ct),r(49,"button",78),x("click",function(){_(t);let o=m(2);return v(o.addKeyword("medium"))}),l(50," + \u6DFB\u52A0 "),s()()(),r(51,"div")(52,"label",82),B(53,"span",83),l(54," \u64F4\u5C55\u95DC\u9375\u8A5E "),s(),r(55,"div",33),O(56,G$,2,1,"span",84,ct),r(58,"button",78),x("click",function(){_(t);let o=m(2);return v(o.addKeyword("extended"))}),l(59," + \u6DFB\u52A0 "),s()()()()(),r(60,"div",9)(61,"h3",71)(62,"span"),l(63,"\u{1F465}"),s(),l(64," \u76EE\u6A19\u5BA2\u6236\u756B\u50CF "),s(),r(65,"div",85)(66,"div")(67,"label",86),l(68,"\u8EAB\u4EFD\u7279\u5FB5"),s(),r(69,"ul",87),O(70,$$,4,1,"li",88,be),s()(),r(72,"div")(73,"label",86),l(74,"\u884C\u70BA\u7279\u5FB5"),s(),r(75,"ul",87),O(76,H$,4,1,"li",88,be),s()(),r(78,"div")(79,"label",86),l(80,"\u6838\u5FC3\u9700\u6C42"),s(),r(81,"ul",87),O(82,q$,4,1,"li",88,be),s()()()(),r(84,"div",9)(85,"h3",71)(86,"span"),l(87,"\u{1F4AC}"),s(),l(88," AI \u751F\u6210\u8A71\u8853\u6A21\u677F "),s(),r(89,"div",75)(90,"div")(91,"label",89),l(92,"\u9996\u6B21\u89F8\u9054"),s(),r(93,"textarea",90),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editableTemplates.firstTouch,o)||(a.editableTemplates.firstTouch=o),v(o)}),l(94,"                      "),s()(),r(95,"div")(96,"label",91),l(97,"\u8DDF\u9032\u8A71\u8853"),s(),r(98,"textarea",90),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editableTemplates.followUp,o)||(a.editableTemplates.followUp=o),v(o)}),l(99,"                      "),s()(),r(100,"div")(101,"label",92),l(102,"\u4FC3\u6210\u8A71\u8853"),s(),r(103,"textarea",90),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.editableTemplates.closing,o)||(a.editableTemplates.closing=o),v(o)}),l(104,"                      "),s()()()(),r(105,"div",93)(106,"button",94),x("click",function(){_(t);let o=m(2);return v(o.backToInput())}),l(107," \u2190 \u8FD4\u56DE\u4FEE\u6539 "),s(),r(108,"div",95)(109,"button",96),x("click",function(){_(t);let o=m(2);return v(o.saveStrategy())}),l(110," \u{1F4BE} \u4FDD\u5B58\u7B56\u7565 "),s(),r(111,"button",97),x("click",function(){_(t);let o=m(2);return v(o.handoverToAITeam())}),l(112," \u{1F916} \u4EA4\u7D66 AI \u5718\u968A "),s(),r(113,"button",98),x("click",function(){_(t);let o=m(2);return v(o.startAutomation())}),l(114," \u{1F680} \u624B\u52D5\u57F7\u884C "),s()()(),r(115,"div",99)(116,"div",100)(117,"span",69),l(118,"\u{1F4A1}"),s(),r(119,"div")(120,"p",73),l(121,"\u63A8\u85A6\u4F7F\u7528\u300C\u4EA4\u7D66 AI \u5718\u968A\u300D"),s(),r(122,"p",5),l(123,"AI \u6703\u81EA\u52D5\u7D44\u5EFA\u5718\u968A\u3001\u5206\u914D\u89D2\u8272\u3001\u5236\u5B9A\u8A71\u8853\uFF0C24/7 \u667A\u80FD\u92B7\u552E"),s()()()()()}if(i&2){let t=m(2);c(19),D(t.strategyResult().industry),c(5),D(t.strategyResult().targetAudience),c(14),U(t.strategyResult().keywords.highIntent),c(9),U(t.strategyResult().keywords.mediumIntent),c(9),U(t.strategyResult().keywords.extended),c(14),U(t.strategyResult().customerProfile.identity),c(6),U(t.strategyResult().customerProfile.features),c(6),U(t.strategyResult().customerProfile.needs),c(11),H("ngModel",t.editableTemplates.firstTouch),c(5),H("ngModel",t.editableTemplates.followUp),c(5),H("ngModel",t.editableTemplates.closing)}}function z$(i,e){if(i&1&&y(0,W$,124,5,"div",67),i&2){let t=m();S(t.strategyResult()?0:-1)}}function K$(i,e){if(i&1){let t=I();r(0,"div",104),x("click",function(){_(t);let o=m();return v(o.cancelAddKeyword())}),r(1,"div",105),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"h3",106)(3,"span",107),l(4,"\u{1F3F7}\uFE0F"),s(),l(5),s(),r(6,"input",108),W("ngModelChange",function(o){_(t);let a=m();return q(a.newKeywordInput,o)||(a.newKeywordInput=o),v(o)}),x("keydown.enter",function(){_(t);let o=m();return v(o.confirmAddKeyword())})("keydown.escape",function(){_(t);let o=m();return v(o.cancelAddKeyword())}),s(),r(7,"div",109)(8,"button",110),x("click",function(){_(t);let o=m();return v(o.cancelAddKeyword())}),l(9," \u53D6\u6D88 "),s(),r(10,"button",111),x("click",function(){_(t);let o=m();return v(o.confirmAddKeyword())}),l(11," \u78BA\u5B9A\u6DFB\u52A0 "),s()()()()}if(i&2){let t=m();c(5),M(" \u6DFB\u52A0",t.getKeywordLevelLabel(t.keywordDialogLevel()),"\u95DC\u9375\u8A5E "),c(),H("ngModel",t.newKeywordInput),c(4),L("disabled",!t.newKeywordInput.trim())}}var cd={payment:{industry:"\u652F\u4ED8/\u63DB\u532F",keywords:{highIntent:["\u652F\u4ED8\u901A\u9053","U\u5546","\u63DB\u532F","USDT","\u4EE3\u6536\u4EE3\u4ED8","\u8DD1\u5206"],mediumIntent:["\u56DB\u65B9\u652F\u4ED8","\u4E09\u65B9\u652F\u4ED8","API\u5C0D\u63A5","\u627F\u514C\u5546"],extended:["OTC","\u6536\u6B3E","\u51FA\u6B3E","\u8CBB\u7387","T+0","T+1"]},recommendedGroups:["\u652F\u4ED8\u884C\u696D\u4EA4\u6D41\u7FA4","USDT/\u63DB\u532F\u4EA4\u6613\u7FA4","\u9805\u76EE\u5C0D\u63A5\u7FA4"]},crypto:{industry:"\u52A0\u5BC6\u8CA8\u5E63",keywords:{highIntent:["BTC","ETH","\u5408\u7D04","\u73FE\u8CA8","\u4EA4\u6613\u6240"],mediumIntent:["DeFi","NFT","\u9322\u5305","\u516C\u93C8"],extended:["\u6316\u7926","\u8CEA\u62BC","\u7A7A\u6295","IDO"]},recommendedGroups:["\u5E63\u5708\u4EA4\u6D41\u7FA4","\u5408\u7D04\u4EA4\u6613\u7FA4","\u9805\u76EE\u9996\u767C\u7FA4"]},ecommerce:{industry:"\u96FB\u5546/\u8DE8\u5883",keywords:{highIntent:["\u4E9E\u99AC\u905C","\u7368\u7ACB\u7AD9","Shopify","\u7269\u6D41","\u9078\u54C1"],mediumIntent:["FBA","\u6D77\u5916\u5009","\u6E05\u95DC","\u652F\u4ED8"],extended:["\u6E2C\u8A55","\u5237\u55AE","\u7AD9\u5916\u63A8\u5EE3"]},recommendedGroups:["\u8DE8\u5883\u96FB\u5546\u4EA4\u6D41\u7FA4","\u4E9E\u99AC\u905C\u8CE3\u5BB6\u7FA4","\u7269\u6D41\u5C0D\u63A5\u7FA4"]}},dd=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.aiStrategyService=F(ld);this.startAutomationEvent=ge();this.handoverToAITeamEvent=ge();this.navigateEvent=ge();this.currentStep=f("input");this.userInput="";this.selectedIndustry=f("custom");this.isGenerating=f(!1);this.strategyResult=f(null);this.showModelSettings=f(!1);this.availableModels=this.aiStrategyService.availableModels;this.selectedModelId=this.aiStrategyService.selectedModelId;this.showKeywordDialog=f(!1);this.keywordDialogLevel=f("high");this.newKeywordInput="";this.localAIConfig=this.aiStrategyService.localAIConfig;this.generationStatus=this.aiStrategyService.generationStatus;this.connectedModels=R(()=>this.availableModels().filter(e=>e.isConnected));this.disconnectedModels=R(()=>this.availableModels().filter(e=>!e.isConnected));this.connectedModelsCount=R(()=>this.connectedModels().length);this.editableTemplates={firstTouch:"",followUp:"",closing:""}}ngOnInit(){this.setupEventListeners(),this.aiStrategyService.refreshAvailableModels()}setupEventListeners(){this.ipcService.on("ai-strategy-generated",e=>{this.isGenerating.set(!1),e.success?(this.strategyResult.set(e.strategy),this.editableTemplates=E({},e.strategy.messageTemplates),this.currentStep.set("result"),this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01")):this.toastService.error(`\u751F\u6210\u5931\u6557: ${e.error}`)})}goToAICenter(){this.navigateEvent.emit("ai-center"),this.toastService.info("\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E\u6A21\u578B...")}selectModel(e){this.aiStrategyService.selectModel(e)}getCapabilityStyle(e){switch(e){case"fast":return"bg-cyan-500/20 text-cyan-400";case"powerful":return"bg-purple-500/20 text-purple-400";case"economic":return"bg-green-500/20 text-green-400";case"balanced":return"bg-amber-500/20 text-amber-400";default:return"bg-slate-500/20 text-slate-400"}}getCapabilityLabel(e){switch(e){case"fast":return"\u5FEB\u901F";case"powerful":return"\u5F37\u5927";case"economic":return"\u7D93\u6FDF";case"balanced":return"\u5747\u8861";default:return""}}async testLocalAI(){await this.aiStrategyService.testLocalAIConnection()}updateLocalEndpoint(e){this.aiStrategyService.updateLocalAIConfig({endpoint:e})}updateLocalModel(e){this.aiStrategyService.updateLocalAIConfig({model:e})}selectIndustry(e){if(this.selectedIndustry.set(e),e!=="custom"){let t=cd[e];t&&(this.userInput=`\u6211\u60F3\u627E${t.industry}\u884C\u696D\u7684\u5BA2\u6236`)}}async generateStrategy(){if(!this.userInput&&this.selectedIndustry()==="custom"){this.toastService.warning("\u8ACB\u8F38\u5165\u60A8\u7684\u9700\u6C42\u6216\u9078\u64C7\u4E00\u500B\u884C\u696D\u6A21\u677F");return}this.isGenerating.set(!0);let e=this.userInput||`\u6211\u60F3\u627E${cd[this.selectedIndustry()]?.industry||"\u76EE\u6A19\u884C\u696D"}\u7684\u5BA2\u6236`;try{let t=await this.aiStrategyService.generateStrategy(e);if(t){this.strategyResult.set(t),this.editableTemplates=E({},t.messageTemplates),this.currentStep.set("result");let n=this.generationStatus();n.currentProvider==="\u6A21\u677F\u56DE\u9000"?this.toastService.warning("\u96F2\u7AEF AI \u9023\u63A5\u5931\u6557\uFF0C\u5DF2\u4F7F\u7528\u667A\u80FD\u6A21\u677F\u751F\u6210\u3002\u8ACB\u6AA2\u67E5 AI \u4E2D\u5FC3\u914D\u7F6E\u3002"):n.currentProvider.includes("\u672C\u5730")?this.toastService.success(`\u2705 \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01\u4F7F\u7528\uFF1A${n.currentProvider}`):this.toastService.success(`\u2705 AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01(${n.currentProvider})`)}else this.toastService.error("\u7B56\u7565\u751F\u6210\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}catch(t){console.error("[AIMarketing] \u7B56\u7565\u751F\u6210\u5931\u6557:",t),this.toastService.error(`\u751F\u6210\u5931\u6557: ${t.message}`)}finally{this.isGenerating.set(!1)}}generateFromTemplate(){let e=this.selectedIndustry(),t=cd[e]||cd.payment,n={industry:t.industry||"\u81EA\u5B9A\u7FA9\u884C\u696D",targetAudience:this.extractAudience(this.userInput),keywords:t.keywords||{highIntent:[],mediumIntent:[],extended:[]},customerProfile:{identity:["\u4EE3\u7406\u5546","\u9805\u76EE\u65B9","\u904B\u71DF\u4EBA\u54E1"],features:["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44","\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F","\u6709\u660E\u78BA\u9700\u6C42"],needs:["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34","\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE","\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]},recommendedGroups:t.recommendedGroups||["\u884C\u696D\u4EA4\u6D41\u7FA4","\u696D\u52D9\u5C0D\u63A5\u7FA4"],messageTemplates:{firstTouch:`\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${t.industry||"\u9019\u500B"}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,followUp:"\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",closing:"\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"},automationSettings:{monitorMode:"24/7 \u5168\u5929\u5019",responseDelay:30,followUpInterval:7200}};this.strategyResult.set(n),this.editableTemplates=E({},n.messageTemplates),this.currentStep.set("result"),this.isGenerating.set(!1),this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01")}extractAudience(e){return e.includes("\u4EE3\u7406")?"\u4EE3\u7406\u5546/\u6E20\u9053\u5546":e.includes("\u5BA2\u6236")?"\u7D42\u7AEF\u5BA2\u6236":e.includes("\u9805\u76EE")?"\u9805\u76EE\u65B9/\u904B\u71DF\u5546":"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4"}addKeyword(e){this.keywordDialogLevel.set(e),this.newKeywordInput="",this.showKeywordDialog.set(!0)}confirmAddKeyword(){let e=this.newKeywordInput.trim();if(e&&this.strategyResult()){let t=E({},this.strategyResult());switch(this.keywordDialogLevel()){case"high":t.keywords.highIntent=[...t.keywords.highIntent,e];break;case"medium":t.keywords.mediumIntent=[...t.keywords.mediumIntent,e];break;case"extended":t.keywords.extended=[...t.keywords.extended,e];break}this.strategyResult.set(t),this.toastService.success(`\u5DF2\u6DFB\u52A0\u95DC\u9375\u8A5E: ${e}`)}this.showKeywordDialog.set(!1),this.newKeywordInput=""}cancelAddKeyword(){this.showKeywordDialog.set(!1),this.newKeywordInput=""}getKeywordLevelLabel(e){switch(e){case"high":return"\u9AD8\u610F\u5411";case"medium":return"\u4E2D\u610F\u5411";case"extended":return"\u64F4\u5C55"}}backToInput(){this.currentStep.set("input")}saveStrategy(){let e=this.strategyResult();e&&(e.messageTemplates=E({},this.editableTemplates),this.ipcService.send("save-ai-strategy",{strategy:e}),this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01"))}startAutomation(){let e=this.strategyResult();e&&(e.messageTemplates=E({},this.editableTemplates),this.startAutomationEvent.emit(e),this.toastService.success("\u6B63\u5728\u555F\u52D5\u624B\u52D5\u71DF\u92B7..."))}handoverToAITeam(){let e=this.strategyResult();e&&(e.messageTemplates=E({},this.editableTemplates),this.handoverToAITeamEvent.emit(e),this.toastService.success("\u{1F916} \u6B63\u5728\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A..."))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-marketing-assistant"]],outputs:{startAutomationEvent:"startAutomationEvent",handoverToAITeamEvent:"handoverToAITeamEvent",navigateEvent:"navigateEvent"},decls:14,vars:2,consts:[[1,"ai-assistant","h-full","flex","flex-col","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900"],[1,"p-6","border-b","border-slate-700/50"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-2xl","bg-gradient-to-br","from-purple-500","to-cyan-500","flex","items-center","justify-center","text-2xl","shadow-lg","shadow-purple-500/20"],[1,"text-2xl","font-bold","text-white"],[1,"text-slate-400","text-sm"],[1,"flex-1","overflow-y-auto","p-6"],[1,"max-w-3xl","mx-auto","space-y-6"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center"],[1,"bg-slate-800/50","rounded-2xl","p-6","border","border-slate-700/50"],[1,"block","text-lg","font-medium","text-white","mb-4"],["rows","4","placeholder","\u4F8B\u5982\uFF1A\u6211\u60F3\u627E\u652F\u4ED8\u884C\u696D\u7684\u4EE3\u7406\u5546\uFF0C\u4ED6\u5011\u9700\u8981\u6709\u63DB\u532F\u548C\u8DD1\u5206\u9700\u6C42...",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-xl","p-4","text-white","text-lg","placeholder-slate-500","focus:border-purple-500","focus:ring-2","focus:ring-purple-500/20","resize-none",3,"ngModelChange","keydown.enter","ngModel"],[1,"text-xs","text-slate-500","mt-2"],[1,"block","text-sm","font-medium","text-slate-400","mb-3"],[1,"flex","flex-wrap","gap-3"],[1,"px-4","py-2","rounded-xl","text-sm","font-medium","transition-all",3,"click"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-sm","font-medium","text-slate-400","flex","items-center","gap-2"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","rounded-full","text-xs"],[1,"px-2","py-0.5","bg-amber-500/20","text-amber-400","rounded-full","text-xs"],[1,"text-sm","text-purple-400","hover:text-purple-300","cursor-pointer","flex","items-center","gap-1",3,"click"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl","text-center"],[1,"mt-4","pt-4","border-t","border-slate-700/50","space-y-4"],[1,"flex","flex-col","items-center","gap-4"],[1,"px-8","py-4","bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","text-lg","font-bold","rounded-2xl","shadow-lg","shadow-purple-500/30","transition-all","flex","items-center","gap-3",3,"click","disabled"],[1,"w-full","max-w-md","bg-slate-800/80","rounded-xl","p-4","border","border-slate-700/50"],[1,"text-amber-400","mb-2"],[1,"text-sm","text-slate-400","mb-3"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"space-y-3"],[1,"text-xs","text-slate-500","mt-3","flex","items-center","gap-1"],[1,"text-xs","text-slate-500","mb-2","flex","items-center","gap-1"],[1,"w-1.5","h-1.5","bg-emerald-500","rounded-full"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5",3,"class"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5",3,"click"],[1,"text-[10px]","px-1.5","py-0.5","rounded-full",3,"class"],[1,"w-2","h-2","bg-emerald-500","rounded-full"],[1,"text-[10px]","px-1.5","py-0.5","rounded-full"],[1,"w-1.5","h-1.5","bg-slate-500","rounded-full"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5","opacity-60",3,"class"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5","opacity-60",3,"click"],[1,"text-xs","text-slate-500"],[1,"bg-slate-900/50","rounded-xl","p-4"],[1,"text-sm","font-medium","text-white","mb-3","flex","items-center","gap-2"],[1,"text-emerald-400","text-xs"],[1,"text-amber-400","text-xs"],[1,"grid","grid-cols-2","gap-3"],[1,"text-xs","text-slate-500","block","mb-1"],["type","text","placeholder","https://your-ollama.ts.net/api/chat",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm",3,"change","value"],["type","text","placeholder","qwen2.5",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm",3,"change","value"],[1,"mt-3","px-4","py-2","bg-cyan-500/20","text-cyan-400","rounded-lg","text-sm","hover:bg-cyan-500/30","transition-colors",3,"click"],[1,"text-sm","font-medium","text-white","mb-2"],[1,"grid","grid-cols-2","gap-2","max-h-48","overflow-y-auto"],[1,"p-3","rounded-lg","cursor-pointer","transition-all","border",3,"class"],[1,"p-3","rounded-lg","cursor-pointer","transition-all","border",3,"click"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-white","truncate"],[1,"w-2","h-2","bg-emerald-500","rounded-full","flex-shrink-0"],[1,"animate-spin"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-slate-400"],[1,"text-sm","text-purple-400"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-purple-500","to-cyan-500","transition-all","duration-500"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","rounded-2xl","p-4","border","border-emerald-500/30","flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-emerald-400","font-medium"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-4"],[1,"text-white","font-medium"],[1,"text-xs","text-slate-500","font-normal","ml-2"],[1,"space-y-4"],[1,"text-sm","text-emerald-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-emerald-500/20","text-emerald-400","rounded-lg","text-sm","border","border-emerald-500/30","cursor-pointer","hover:bg-emerald-500/30","transition-all"],[1,"px-3","py-1.5","bg-slate-700","text-slate-400","rounded-lg","text-sm","hover:bg-slate-600",3,"click"],[1,"text-sm","text-amber-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"w-2","h-2","bg-amber-500","rounded-full"],[1,"px-3","py-1.5","bg-amber-500/20","text-amber-400","rounded-lg","text-sm","border","border-amber-500/30","cursor-pointer","hover:bg-amber-500/30","transition-all"],[1,"text-sm","text-slate-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"w-2","h-2","bg-slate-500","rounded-full"],[1,"px-3","py-1.5","bg-slate-700","text-slate-300","rounded-lg","text-sm","border","border-slate-600","cursor-pointer","hover:bg-slate-600","transition-all"],[1,"grid","grid-cols-3","gap-4"],[1,"text-sm","text-slate-400","mb-2","block"],[1,"space-y-1"],[1,"text-white","text-sm","flex","items-center","gap-2"],[1,"text-sm","text-emerald-400","font-medium","mb-2","block"],["rows","2",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-lg","p-3","text-white","text-sm","resize-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-amber-400","font-medium","mb-2","block"],[1,"text-sm","text-purple-400","font-medium","mb-2","block"],[1,"flex","justify-between","items-center","pt-4"],[1,"px-6","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-all",3,"click"],[1,"flex","gap-3"],[1,"px-6","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-all","flex","items-center","gap-2",3,"click"],[1,"px-6","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","font-bold","rounded-xl","shadow-lg","shadow-emerald-500/30","transition-all","flex","items-center","gap-2",3,"click"],[1,"px-8","py-3","bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","text-white","font-bold","rounded-xl","shadow-lg","shadow-purple-500/30","transition-all","flex","items-center","gap-2",3,"click"],[1,"mt-4","p-4","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10","border","border-emerald-500/30","rounded-xl"],[1,"flex","items-center","gap-3"],[1,"text-purple-400"],[1,"text-cyan-400"],[1,"text-emerald-400"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center",3,"click"],[1,"bg-slate-800","rounded-2xl","p-6","w-full","max-w-md","mx-4","border","border-slate-700","shadow-2xl",3,"click"],[1,"text-lg","font-bold","text-white","mb-4","flex","items-center","gap-2"],[1,"text-xl"],["type","text","placeholder","\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E...","autofocus","",1,"w-full","px-4","py-3","bg-slate-900","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:ring-2","focus:ring-purple-500/20","outline-none","transition-all",3,"ngModelChange","keydown.enter","keydown.escape","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-all","font-medium",3,"click"],[1,"flex-1","px-4","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","hover:from-purple-600","hover:to-pink-600","text-white","rounded-xl","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l(4," \u{1F916} "),s(),r(5,"div")(6,"h1",4),l(7,"AI \u71DF\u92B7\u52A9\u624B"),s(),r(8,"p",5),l(9,"\u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u5BA2\u6236\uFF0CAI \u5E6B\u4F60\u5B8C\u6210\u4E00\u5207"),s()()()(),r(10,"div",6),y(11,L$,36,15,"div",7)(12,z$,1,1),s(),y(13,K$,12,3,"div",8),s()),t&2){let o;c(11),S((o=n.currentStep())==="input"?11:o==="result"?12:-1),c(2),S(n.showKeywordDialog()?13:-1)}},dependencies:[oe,ae,xe,ve,he],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})}};var so=(i,e)=>e.id;function j$(i,e){i&1&&(r(0,"span",6),B(1,"span",22),l(2," \u57F7\u884C\u4E2D "),s())}function J$(i,e){if(i&1&&(r(0,"span",16),l(1),s()),i&2){let t=m();c(),D(t.runningCount())}}function Q$(i,e){if(i&1){let t=I();r(0,"div",23)(1,"div",2)(2,"div",39)(3,"span",5),l(4,"\u{1F517}"),s(),r(5,"div")(6,"p",40),l(7,"\u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565"),s(),r(8,"p",41),l(9,"\u7B56\u7565\u5DF2\u81EA\u52D5\u586B\u5165\uFF0C\u78BA\u8A8D\u5F8C\u5373\u53EF\u958B\u59CB\u57F7\u884C"),s()()(),r(10,"button",42),x("click",function(){_(t);let o=m(2);return v(o.clearIncomingStrategy())}),l(11," \u2715 \u6E05\u9664 "),s()()()}}function Y$(i,e){i&1&&(r(0,"span",43),l(1,"\u23F3"),s(),l(2," \u7B56\u5283\u4E2D... "))}function X$(i,e){i&1&&(r(0,"span"),l(1,"\u{1F680}"),s(),l(2," AI \u958B\u59CB\u5DE5\u4F5C "))}function Z$(i,e){if(i&1){let t=I();r(0,"button",44),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.quickStart(o.goal))}),r(1,"div",36),l(2),s(),r(3,"div",45),l(4),s(),r(5,"div",38),l(6),s()()}if(i&2){let t=e.$implicit;c(2),D(t.icon),c(2),D(t.name),c(2),D(t.description)}}function eH(i,e){if(i&1){let t=I();r(0,"div",18),y(1,Q$,12,0,"div",23),r(2,"div",24)(3,"div",25)(4,"h2",26),l(5,"\u{1F3AF} \u4E00\u53E5\u8A71\uFF0C\u555F\u52D5\u4F60\u7684 AI \u92B7\u552E\u5718\u968A"),s(),r(6,"p",27),l(7,"\u544A\u8A34 AI \u4F60\u60F3\u8981\u4EC0\u9EBC\uFF0C\u5269\u4E0B\u7684\u4EA4\u7D66\u6211\u5011"),s()(),r(8,"div",28)(9,"textarea",29),W("ngModelChange",function(o){_(t);let a=m();return q(a.userGoal,o)||(a.userGoal=o),v(o)}),x("keydown.enter",function(o){_(t);let a=m();return v(a.onEnterKey(o))}),l(10,"                  "),s(),r(11,"button",30),x("click",function(){_(t);let o=m();return v(o.startFromGoal())}),y(12,Y$,3,0)(13,X$,3,0),s()()(),r(14,"div")(15,"h3",31)(16,"span"),l(17,"\u{1F4A1}"),s(),l(18," \u6216\u9078\u64C7\u5E38\u898B\u76EE\u6A19\uFF0C\u4E00\u9375\u958B\u59CB "),s(),r(19,"div",32),O(20,Z$,7,3,"button",33,so),s()(),r(22,"div",34)(23,"div",35)(24,"div",36),l(25,"\u{1F3AD}"),s(),r(26,"div",37),l(27,"\u50CF\u771F\u4EBA\u4E00\u6A23"),s(),r(28,"div",38),l(29,"\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E\u3001\u81EA\u7136\u5F15\u5C0E"),s()(),r(30,"div",35)(31,"div",36),l(32,"\u{1F504}"),s(),r(33,"div",37),l(34,"\u5BE6\u6642\u8ABF\u6574"),s(),r(35,"div",38),l(36,"\u6BCF10\u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21"),s()(),r(37,"div",35)(38,"div",36),l(39,"\u{1F91D}"),s(),r(40,"div",37),l(41,"\u591A\u89D2\u8272\u914D\u5408"),s(),r(42,"div",38),l(43,"AI \u81EA\u52D5\u5354\u8ABF\u6700\u4F73\u7D44\u5408"),s()()()()}if(i&2){let t=m();c(),S(t.hasIncomingStrategy()?1:-1),c(8),H("ngModel",t.userGoal),c(2),L("disabled",!t.userGoal.trim()||t.engine.isProcessing()),c(),S(t.engine.isProcessing()?12:13),c(8),U(t.presetGoals)}}function tH(i,e){if(i&1){let t=I();r(0,"div",46)(1,"div",47),l(2,"\u{1F680}"),s(),r(3,"p",48),l(4,"\u66AB\u7121\u57F7\u884C\u4E2D\u7684\u4EFB\u52D9"),s(),r(5,"p",49),l(6,"\u524D\u5F80\u300C\u4E00\u9375\u555F\u52D5\u300D\u5275\u5EFA\u65B0\u4EFB\u52D9"),s(),r(7,"button",50),x("click",function(){_(t);let o=m(2);return v(o.activeTab.set("start"))}),l(8," \u{1F680} \u5275\u5EFA\u4EFB\u52D9 "),s()()}}function nH(i,e){if(i&1){let t=I();r(0,"button",70),x("click",function(){_(t);let o=m(2).$implicit,a=m(3);return v(a.confirmStart(o))}),l(1," \u25B6\uFE0F \u78BA\u8A8D\u958B\u59CB "),s()}}function iH(i,e){if(i&1){let t=I();r(0,"button",71),x("click",function(){_(t);let o=m(2).$implicit,a=m(3);return v(a.pauseExecution(o))}),l(1," \u23F8\uFE0F \u66AB\u505C "),s()}}function oH(i,e){if(i&1){let t=I();r(0,"button",72),x("click",function(){_(t);let o=m(2).$implicit,a=m(3);return v(a.resumeExecution(o))}),l(1," \u25B6\uFE0F \u7E7C\u7E8C "),s()}}function rH(i,e){if(i&1&&(r(0,"div",62)(1,"div",73)(2,"span"),l(3,"\u{1F916}"),s(),l(4," AI \u7406\u89E3 "),s(),r(5,"p",74),l(6),s(),r(7,"div",75)(8,"span"),l(9),s(),r(10,"span"),l(11),s(),r(12,"span"),l(13),s()()()),i&2){let t=m(2).$implicit;c(6),D(t.intent.goal),c(3),M("\u7F6E\u4FE1\u5EA6: ",t.intent.confidence,"%"),c(2),M("\u76EE\u6A19\u7FA4\u9AD4: ",t.intent.targetAudience),c(2),M("\u5EFA\u8B70\u9031\u671F: ",t.intent.suggestedDuration)}}function sH(i,e){if(i&1&&(r(0,"div",78)(1,"span",79),l(2),s(),r(3,"div")(4,"div",80),l(5),s(),r(6,"div",66),l(7),s()()()),i&2){let t=e.$implicit;c(2),D(t.icon),c(3),D(t.name),c(2),D(t.purpose)}}function aH(i,e){if(i&1&&(r(0,"div",63)(1,"div",76),l(2,"\u{1F3AD} AI \u5718\u968A"),s(),r(3,"div",77),O(4,sH,8,3,"div",78,so),s()()),i&2){let t=m(2).$implicit;c(4),U(t.roles)}}function lH(i,e){i&1&&(ne(),r(0,"svg",83),B(1,"path",84),s())}function cH(i,e){if(i&1&&(r(0,"div",81)(1,"div",82),l(2),s(),y(3,lH,2,0,":svg:svg",83),s()),i&2){let t=e.$implicit,n=e.$index,o=m(3).$implicit;c(),N("bg-green-500",n<o.stats.currentPhase)("text-white",n<o.stats.currentPhase)("bg-purple-500",n===o.stats.currentPhase)("text-white",n===o.stats.currentPhase)("bg-slate-700",n>o.stats.currentPhase)("text-slate-400",n>o.stats.currentPhase),c(),M(" ",t.name," "),c(),S(n<o.strategy.phases.length-1?3:-1)}}function dH(i,e){if(i&1&&(r(0,"div",63)(1,"div",76),l(2,"\u{1F4CB} \u57F7\u884C\u968E\u6BB5"),s(),r(3,"div",56),O(4,cH,4,14,"div",81,so),s()()),i&2){let t=m(2).$implicit;c(4),U(t.strategy.phases)}}function uH(i,e){if(i&1&&(r(0,"div",68)(1,"div",85)(2,"span"),l(3,"\u{1F50D}"),s(),l(4," AI \u6700\u65B0\u5206\u6790 "),s(),r(5,"p",86),l(6),s(),r(7,"div",87),l(8),s()()),i&2){let t=m(2).$implicit;c(6),D(t.stats.lastAnalysis.suggestions.reasoning),c(2),M(" \u5EFA\u8B70: ",t.stats.lastAnalysis.suggestions.topicSuggestion," ")}}function mH(i,e){if(i&1){let t=I();r(0,"div",69)(1,"div",2)(2,"div")(3,"div",88)(4,"span"),l(5,"\u{1F3AF}"),s(),l(6," \u9AD8\u610F\u5411\u5BA2\u6236 "),s(),r(7,"p",86),l(8,"\u6AA2\u6E2C\u5230\u9AD8\u610F\u5411\u5BA2\u6236\uFF0C\u5EFA\u8B70\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\u9032\u884C\u591A\u89D2\u8272\u5354\u4F5C\u6210\u4EA4"),s()(),r(9,"button",89),x("click",function(){_(t);let o=m(2).$implicit,a=m(3);return v(a.createGroupForExecution(o))}),r(10,"span"),l(11,"\u{1F465}"),s(),l(12," \u4E00\u9375\u5EFA\u7FA4 "),s()()()}}function pH(i,e){if(i&1){let t=I();r(0,"div",51)(1,"div",52)(2,"div",3),B(3,"div",53),r(4,"div")(5,"div",54),l(6),s(),r(7,"div",55)(8,"span"),l(9),s(),r(10,"span"),l(11,"\xB7"),s(),r(12,"span"),l(13),s()()()(),r(14,"div",56),y(15,nH,2,0,"button",57),y(16,iH,2,0,"button",58),y(17,oH,2,0,"button",59),r(18,"button",60),x("click",function(){_(t);let o=m().$implicit,a=m(3);return v(a.stopExecution(o))}),l(19," \u23F9\uFE0F \u505C\u6B62 "),s()()(),r(20,"div",61),y(21,rH,14,4,"div",62),y(22,aH,6,0,"div",63),y(23,dH,6,0,"div",63),r(24,"div",64)(25,"div",65)(26,"div",12),l(27),s(),r(28,"div",66),l(29,"\u5DF2\u767C\u6D88\u606F"),s()(),r(30,"div",65)(31,"div",9),l(32),s(),r(33,"div",66),l(34,"\u6536\u5230\u56DE\u8986"),s()(),r(35,"div",65)(36,"div",13),l(37),s(),r(38,"div",66),l(39,"\u8208\u8DA3\u5EA6"),s()(),r(40,"div",65)(41,"div",67),l(42),s(),r(43,"div",66),l(44,"\u7576\u524D\u968E\u6BB5"),s()()(),y(45,uH,9,2,"div",68),y(46,mH,13,0,"div",69),s()()}if(i&2){let t=m().$implicit,n=m(3);c(3),N("bg-green-500",t.status==="running")("bg-yellow-500",t.status==="planning")("bg-orange-500",t.status==="paused")("animate-pulse",t.status==="running"),c(3),D(t.goal),c(3),D(n.getStatusLabel(t.status)),c(4),D(n.getExecutionDuration(t)),c(2),S(t.status==="planning"?15:-1),c(),S(t.status==="running"?16:-1),c(),S(t.status==="paused"?17:-1),c(4),S(t.intent?21:-1),c(),S(t.roles.length>0?22:-1),c(),S(t.strategy?23:-1),c(4),D(t.stats.messagesSent),c(5),D(t.stats.responsesReceived),c(5),M("",t.stats.interestScore,"%"),c(5),X("",t.stats.currentPhase+1,"/",(t.strategy==null||t.strategy.phases==null?null:t.strategy.phases.length)||0),c(3),S(t.stats.lastAnalysis?45:-1),c(),S(t.stats.interestScore>=50&&t.status==="running"?46:-1)}}function gH(i,e){i&1&&y(0,pH,47,24,"div",51),i&2&&S(0)}function hH(i,e){if(i&1&&O(0,gH,1,1,null,null,so),i&2){let t=m(2);U(t.activeExecutions())}}function fH(i,e){if(i&1&&(r(0,"div",19),y(1,tH,9,0,"div",46)(2,hH,2,0),s()),i&2){let t=m();c(),S(t.activeExecutions().length===0?1:2)}}function _H(i,e){i&1&&(r(0,"div",46)(1,"div",47),l(2,"\u{1F4DC}"),s(),r(3,"p",48),l(4,"\u66AB\u7121\u6B77\u53F2\u8A18\u9304"),s(),r(5,"p",27),l(6,"\u5B8C\u6210\u7684\u4EFB\u52D9\u6703\u986F\u793A\u5728\u9019\u88E1"),s()())}function vH(i,e){if(i&1&&(r(0,"div",90)(1,"div",2)(2,"div")(3,"div",54),l(4),s(),r(5,"div",91),l(6),s()(),r(7,"div",92)(8,"div",93),l(9),s(),r(10,"div",94),l(11,"\u5DF2\u5B8C\u6210"),s()()()()),i&2){let t=e.$implicit,n=m(3);c(4),D(t.goal),c(2),X(" ",t.intent==null?null:t.intent.goal," \xB7 ",t.stats.messagesSent," \u689D\u6D88\u606F "),c(3),D(n.formatDate(t.stats.startTime))}}function xH(i,e){if(i&1&&O(0,vH,12,4,"div",90,so),i&2){let t=m(2);U(t.completedExecutions())}}function CH(i,e){if(i&1&&(r(0,"div",20),y(1,_H,7,0,"div",46)(2,xH,2,0),s()),i&2){let t=m();c(),S(t.completedExecutions().length===0?1:2)}}function bH(i,e){if(i&1&&(r(0,"div",103)(1,"div",113)(2,"span",5),l(3),s(),r(4,"span",114),l(5),s()(),r(6,"p",66),l(7),s(),r(8,"p",115),l(9),s()()),i&2){let t=e.$implicit;c(3),D(t.icon),c(2),D(t.name),c(2),D(t.purpose),c(2),D(t.entryTiming)}}function yH(i,e){if(i&1&&(r(0,"div",110)(1,"div",116),l(2),s(),r(3,"div",117)(4,"div",2)(5,"span",114),l(6),s(),r(7,"span",66),l(8),s()(),r(9,"p",91),l(10),s()()()),i&2){let t=e.$implicit,n=e.$index;c(2),M(" ",n+1," "),c(4),D(t.name),c(2),D(t.duration),c(2),D(t.goal)}}function SH(i,e){if(i&1&&(r(0,"div",99)(1,"div",103)(2,"div",76),l(3,"\u{1F3AF} AI \u7406\u89E3\u7684\u76EE\u6A19"),s(),r(4,"p",74),l(5),s(),r(6,"div",104)(7,"span",105),l(8),s(),r(9,"span",106),l(10),s()()(),r(11,"div")(12,"div",107),l(13,"\u{1F3AD} AI \u63A8\u85A6\u7684\u5718\u968A"),s(),r(14,"div",108),O(15,bH,10,4,"div",103,so),s()(),r(17,"div")(18,"div",107),l(19,"\u{1F4CB} \u57F7\u884C\u8A08\u5283"),s(),r(20,"div",109),O(21,yH,11,4,"div",110,so),s()(),r(23,"div",111)(24,"div",85)(25,"span"),l(26,"\u{1F4A1}"),s(),l(27," AI \u6703\u9019\u6A23\u505A "),s(),r(28,"ul",112)(29,"li"),l(30,"\u2022 \u50CF\u771F\u4EBA\u4E00\u6A23\u5728\u7FA4\u88E1\u804A\u5929\uFF0C\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E"),s(),r(31,"li"),l(32,"\u2022 \u81EA\u7136\u5730\u5F15\u5165\u7522\u54C1\u8A71\u984C\uFF0C\u4E0D\u751F\u786C\u63A8\u92B7"),s(),r(33,"li"),l(34,"\u2022 \u6BCF 10 \u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21\uFF0C\u52D5\u614B\u8ABF\u6574\u7B56\u7565"),s(),r(35,"li"),l(36,"\u2022 \u6839\u64DA\u5BA2\u6236\u53CD\u61C9\u9748\u6D3B\u5207\u63DB\u89D2\u8272"),s()()()()),i&2){let t,n,o,a,d,u=m(2);c(5),D((t=u.pendingExecution())==null||t.intent==null?null:t.intent.goal),c(3),M("\u7F6E\u4FE1\u5EA6: ",(n=u.pendingExecution())==null||n.intent==null?null:n.intent.confidence,"%"),c(2),M("\u5EFA\u8B70\u9031\u671F: ",(o=u.pendingExecution())==null||o.intent==null?null:o.intent.suggestedDuration),c(5),U((a=u.pendingExecution())==null?null:a.roles),c(6),U((d=u.pendingExecution())==null||d.strategy==null?null:d.strategy.phases)}}function wH(i,e){if(i&1){let t=I();r(0,"div",21)(1,"div",95)(2,"div",96)(3,"div",3)(4,"div",97),l(5," \u{1F916} "),s(),r(6,"div")(7,"h2",98),l(8,"AI \u7B56\u5283\u5B8C\u6210\uFF01"),s(),r(9,"p",27),l(10,"\u78BA\u8A8D\u4EE5\u4E0B\u65B9\u6848\uFF0C\u5373\u53EF\u958B\u59CB\u57F7\u884C"),s()()()(),y(11,SH,37,3,"div",99),r(12,"div",100)(13,"button",101),x("click",function(){_(t);let o=m();return v(o.cancelPendingExecution())}),l(14," \u53D6\u6D88 "),s(),r(15,"button",102),x("click",function(){_(t);let o=m();return v(o.confirmPendingExecution())}),r(16,"span"),l(17,"\u25B6\uFE0F"),s(),l(18," \u78BA\u8A8D\u958B\u59CB "),s()()()()}if(i&2){let t=m();c(11),S(t.pendingExecution()?11:-1)}}var ud=class i{constructor(){this.engine=F(Mi);this.toast=F(J);this.autoGroup=F(zn);this.incomingStrategy=Le(null);this.activeTab=f("start");this.userGoal="";this.hasIncomingStrategy=f(!1);this.receivedStrategy=null;this.showPlanningResult=f(!1);this.pendingExecution=f(null);this.presetGoals=[{id:"convert",icon:"\u{1F4B0}",name:"\u4FC3\u9032\u6210\u4EA4",description:"\u591A\u89D2\u8272\u914D\u5408\uFF0C\u4FC3\u6210\u7336\u8C6B\u5BA2\u6236\u4E0B\u55AE",goal:"\u8B93\u7FA4\u88E1\u5C0D\u7522\u54C1\u611F\u8208\u8DA3\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u6F5B\u5728\u5BA2\u6236\u5B8C\u6210\u8CFC\u8CB7"},{id:"recovery",icon:"\u{1F49D}",name:"\u633D\u56DE\u6D41\u5931",description:"\u95DC\u61F7\u56DE\u8A2A + \u7279\u5225\u512A\u60E0",goal:"\u633D\u56DE\u5DF2\u7D93\u6D41\u5931\u6216\u6C89\u9ED8\u7684\u8001\u5BA2\u6236\uFF0C\u8B93\u4ED6\u5011\u91CD\u65B0\u8CFC\u8CB7"},{id:"active",icon:"\u{1F389}",name:"\u793E\u7FA4\u6D3B\u8E8D",description:"\u8A71\u984C\u5F15\u5C0E + \u4E92\u52D5\u6FC0\u52F5",goal:"\u63D0\u5347\u793E\u7FA4\u6D3B\u8E8D\u5EA6\uFF0C\u8B93\u7FA4\u6210\u54E1\u66F4\u9858\u610F\u4E92\u52D5\u548C\u8A0E\u8AD6"},{id:"support",icon:"\u{1F527}",name:"\u552E\u5F8C\u670D\u52D9",description:"\u5FEB\u901F\u97FF\u61C9 + \u554F\u984C\u89E3\u6C7A",goal:"\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C\uFF0C\u63D0\u5347\u5BA2\u6236\u6EFF\u610F\u5EA6"},{id:"nurture",icon:"\u{1F331}",name:"\u6F5B\u5BA2\u57F9\u80B2",description:"\u50F9\u503C\u8F38\u51FA + \u4FE1\u4EFB\u5EFA\u7ACB",goal:"\u901A\u904E\u6301\u7E8C\u7684\u50F9\u503C\u8F38\u51FA\u57F9\u80B2\u6F5B\u5728\u5BA2\u6236\uFF0C\u63D0\u5347\u8CFC\u8CB7\u610F\u9858"},{id:"brand",icon:"\u{1F3C6}",name:"\u54C1\u724C\u63A8\u5EE3",description:"\u53E3\u7891\u50B3\u64AD + \u5F62\u8C61\u5EFA\u7ACB",goal:"\u63D0\u5347\u54C1\u724C\u77E5\u540D\u5EA6\u548C\u597D\u611F\u5EA6\uFF0C\u8B93\u66F4\u591A\u4EBA\u4E86\u89E3\u6211\u5011"}];this.runningCount=R(()=>this.engine.executions().filter(e=>e.status==="running").length);this.todayMessages=R(()=>this.engine.executions().filter(e=>e.status==="running").reduce((e,t)=>e+t.stats.messagesSent,0));this.todayConversions=R(()=>0);this.completedExecutions=R(()=>this.engine.executions().filter(e=>e.status==="completed"));this.activeExecutions=R(()=>this.engine.executions().filter(e=>e.status==="running"||e.status==="planning"||e.status==="paused"));gt(()=>{let e=this.incomingStrategy();e&&this.handleIncomingStrategy(e)})}ngOnInit(){}ngOnDestroy(){}onEnterKey(e){let t=e;t.shiftKey||(t.preventDefault(),this.startFromGoal())}async startFromGoal(){if(!this.userGoal.trim())return;let e=await this.engine.startFromOnePhrase(this.userGoal);e&&(this.pendingExecution.set(e),this.showPlanningResult.set(!0))}quickStart(e){this.userGoal=e,this.startFromGoal()}confirmPendingExecution(){let e=this.pendingExecution();e&&(this.engine.confirmAndStart(e.id),this.showPlanningResult.set(!1),this.pendingExecution.set(null),this.userGoal="",this.activeTab.set("running"))}cancelPendingExecution(){let e=this.pendingExecution();e&&this.engine.stopExecution(e.id),this.showPlanningResult.set(!1),this.pendingExecution.set(null)}confirmStart(e){this.engine.confirmAndStart(e.id)}pauseExecution(e){this.engine.pauseExecution(e.id),this.toast.info("\u5DF2\u66AB\u505C\u57F7\u884C")}resumeExecution(e){this.engine.resumeExecution(e.id),this.toast.success("\u5DF2\u6062\u5FA9\u57F7\u884C")}stopExecution(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u9019\u500B\u4EFB\u52D9\u55CE\uFF1F")&&(this.engine.stopExecution(e.id),this.toast.info("\u4EFB\u52D9\u5DF2\u505C\u6B62"))}getStatusLabel(e){return{idle:"\u5F85\u547D",planning:"\u7B56\u5283\u4E2D",running:"\u57F7\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210"}[e]}getExecutionDuration(e){let t=new Date(e.stats.startTime),o=new Date().getTime()-t.getTime(),a=Math.floor(o/6e4);if(a<60)return`${a} \u5206\u9418`;let d=Math.floor(a/60);return d<24?`${d} \u5C0F\u6642`:`${Math.floor(d/24)} \u5929`}formatDate(e){return new Date(e).toLocaleDateString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}async createGroupForExecution(e){if(!e.targetUsers||e.targetUsers.length===0){this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u76EE\u6A19\u7528\u6236\uFF0C\u8ACB\u7E7C\u7E8C\u7B49\u5F85...");return}let t=e.targetUsers.filter(d=>d.intentScore>=50);if(t.length===0){this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u7528\u6236\u53EF\u5EFA\u7FA4");return}let n=t[0],o={targetCustomer:{id:n.id.toString(),username:n.username,firstName:n.firstName||n.username},groupName:this.autoGroup.generateGroupName(n.firstName||n.username||"VIP","{\u5BA2\u6236\u540D}\u5C08\u5C6C\u670D\u52D9\u7FA4"),roleAccounts:e.roles.map((d,u)=>({roleId:d.id,accountId:d.accountId||u+1})),scriptId:void 0,inviteMessage:`\u60A8\u597D ${n.firstName||""}\uFF01\u6211\u5011\u70BA\u60A8\u5275\u5EFA\u4E86\u5C08\u5C6C\u670D\u52D9\u7FA4\u7D44\uFF0C\u6211\u5011\u7684\u5C08\u696D\u5718\u968A\u5C07\u70BA\u60A8\u63D0\u4F9B\u4E00\u5C0D\u4E00\u670D\u52D9\u3002`,intentScore:n.intentScore};this.toast.info("\u6B63\u5728\u70BA\u9AD8\u610F\u5411\u5BA2\u6236\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44...");let a=await this.autoGroup.createGroup(o);a.success?this.toast.success(`\u{1F389} \u5DF2\u70BA ${n.firstName||n.username} \u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\uFF01`):this.toast.error(`\u5EFA\u7FA4\u5931\u6557: ${a.error}`)}handleIncomingStrategy(e){console.log("[AITeamHub] \u6536\u5230 AI \u71DF\u92B7\u52A9\u624B\u7B56\u7565:",e),this.hasIncomingStrategy.set(!0),this.receivedStrategy=e;let t=[`\u5728${e.industry}\u884C\u696D`,`\u5C0B\u627E${e.targetAudience}`];e.keywords.highIntent.length>0&&t.push(`\u95DC\u6CE8\u300C${e.keywords.highIntent.slice(0,3).join("\u3001")}\u300D\u7B49\u95DC\u9375\u8A5E`),e.customerProfile.needs.length>0&&t.push(`\u6EFF\u8DB3\u5BA2\u6236\u300C${e.customerProfile.needs[0]}\u300D\u7684\u9700\u6C42`);let n=t.join("\uFF0C")+"\uFF0C\u4FC3\u6210\u6210\u4EA4";this.userGoal=n,this.toast.success(`\u{1F916} \u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565\uFF01\u884C\u696D: ${e.industry}`),this.activeTab.set("start"),setTimeout(()=>{this.startWithFullStrategy()},500)}clearIncomingStrategy(){this.hasIncomingStrategy.set(!1),this.receivedStrategy=null,this.userGoal=""}async startWithFullStrategy(){if(!this.receivedStrategy){this.startFromGoal();return}let e=this.receivedStrategy,t=await this.engine.startWithMarketingStrategy(this.userGoal,e);t&&(this.pendingExecution.set(t),this.showPlanningResult.set(!0),this.hasIncomingStrategy.set(!1))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-team-hub"]],inputs:{incomingStrategy:[1,"incomingStrategy"]},decls:46,vars:37,consts:[[1,"ai-team-hub","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-2","px-3","py-1","bg-green-500/20","text-green-400","rounded-full","text-sm","animate-pulse"],[1,"flex","items-center","gap-4","px-4","py-2","bg-slate-800/80","rounded-xl","border","border-slate-700/50"],[1,"text-center"],[1,"text-lg","font-bold","text-green-400"],[1,"text-xs","text-slate-500"],[1,"w-px","h-8","bg-slate-700"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-lg","font-bold","text-purple-400"],[1,"flex","gap-1","mt-4","bg-slate-800/50","p-1","rounded-xl","w-fit"],[1,"px-6","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"click"],[1,"bg-white/20","px-2","py-0.5","rounded-full","text-xs"],[1,"flex-1","overflow-y-auto","p-6"],[1,"max-w-3xl","mx-auto","space-y-8"],[1,"space-y-6"],[1,"space-y-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"w-2","h-2","bg-green-500","rounded-full"],[1,"p-4","bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","border","border-emerald-500/30","rounded-2xl"],[1,"bg-gradient-to-br","from-purple-500/10","via-pink-500/10","to-cyan-500/10","rounded-3xl","border","border-purple-500/30","p-8"],[1,"text-center","mb-6"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-400"],[1,"relative"],["rows","3","placeholder","\u4F8B\u5982\uFF1A\u6211\u60F3\u8B93\u7FA4\u88E1\u90A3\u4E9B\u770B\u904E\u7522\u54C1\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u4EBA\u8CFC\u8CB7...",1,"w-full","px-6","py-4","bg-slate-800/80","border","border-slate-600","rounded-2xl","text-white","text-lg","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"ngModelChange","keydown.enter","ngModel"],[1,"absolute","right-3","bottom-3","px-6","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"text-sm","text-slate-400","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl","text-left","hover:bg-slate-800","hover:border-purple-500/30","transition-all","group"],[1,"grid","grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/30","rounded-xl","text-center"],[1,"text-2xl","mb-2"],[1,"text-sm","text-white","font-medium"],[1,"text-xs","text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"text-emerald-400","font-medium"],[1,"text-slate-400","text-sm"],[1,"p-2","text-slate-400","hover:text-white","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],[1,"animate-spin"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl","text-left","hover:bg-slate-800","hover:border-purple-500/30","transition-all","group",3,"click"],[1,"font-medium","text-white","group-hover:text-purple-400","transition-colors"],[1,"text-center","py-16"],[1,"text-6xl","mb-4"],[1,"text-xl","text-white","mb-2"],[1,"text-slate-400","mb-6"],[1,"px-6","py-3","bg-purple-500","text-white","rounded-xl","hover:bg-purple-400","transition-colors",3,"click"],[1,"bg-slate-800/50","border","border-slate-700/50","rounded-2xl","overflow-hidden"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"w-3","h-3","rounded-full"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"flex","items-center","gap-2"],[1,"px-4","py-2","bg-green-500","text-white","rounded-lg","hover:bg-green-400","transition-colors","text-sm"],[1,"px-4","py-2","bg-orange-500/20","text-orange-400","rounded-lg","hover:bg-orange-500/30","transition-colors","text-sm"],[1,"px-4","py-2","bg-green-500/20","text-green-400","rounded-lg","hover:bg-green-500/30","transition-colors","text-sm"],[1,"px-4","py-2","bg-red-500/20","text-red-400","rounded-lg","hover:bg-red-500/30","transition-colors","text-sm",3,"click"],[1,"p-4"],[1,"mb-4","p-3","bg-purple-500/10","border","border-purple-500/20","rounded-xl"],[1,"mb-4"],[1,"grid","grid-cols-4","gap-4"],[1,"p-3","bg-slate-700/30","rounded-lg","text-center"],[1,"text-xs","text-slate-400"],[1,"text-lg","font-bold","text-yellow-400"],[1,"mt-4","p-3","bg-cyan-500/10","border","border-cyan-500/20","rounded-xl"],[1,"mt-4","p-4","bg-gradient-to-r","from-amber-500/10","to-orange-500/10","border","border-amber-500/20","rounded-xl"],[1,"px-4","py-2","bg-green-500","text-white","rounded-lg","hover:bg-green-400","transition-colors","text-sm",3,"click"],[1,"px-4","py-2","bg-orange-500/20","text-orange-400","rounded-lg","hover:bg-orange-500/30","transition-colors","text-sm",3,"click"],[1,"px-4","py-2","bg-green-500/20","text-green-400","rounded-lg","hover:bg-green-500/30","transition-colors","text-sm",3,"click"],[1,"flex","items-center","gap-2","text-purple-400","text-sm","mb-2"],[1,"text-white"],[1,"flex","items-center","gap-4","mt-2","text-xs","text-slate-400"],[1,"text-sm","text-slate-400","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"flex","items-center","gap-2","px-3","py-2","bg-slate-700/50","rounded-lg"],[1,"text-xl"],[1,"text-sm","text-white"],[1,"flex","items-center"],[1,"px-3","py-1.5","rounded-lg","text-xs"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500","mx-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"flex","items-center","gap-2","text-cyan-400","text-sm","mb-2"],[1,"text-white","text-sm"],[1,"text-xs","text-slate-400","mt-2"],[1,"flex","items-center","gap-2","text-amber-400","text-sm","mb-1"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","text-white","rounded-lg","hover:from-amber-400","hover:to-orange-400","transition-all","text-sm","font-medium","flex","items-center","gap-2","whitespace-nowrap",3,"click"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-right"],[1,"text-sm","text-slate-400"],[1,"text-xs","text-green-400"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-purple-500/30","overflow-hidden","max-h-[90vh]","overflow-y-auto"],[1,"p-6","bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border-b","border-slate-700/50"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-2xl"],[1,"text-xl","font-bold","text-white"],[1,"p-6","space-y-6"],[1,"p-6","border-t","border-slate-700/50","flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-slate-800/50","rounded-xl"],[1,"flex","items-center","gap-4","mt-2","text-xs"],[1,"text-purple-400"],[1,"text-cyan-400"],[1,"text-sm","text-slate-400","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"space-y-3"],[1,"flex","items-start","gap-4","p-3","bg-slate-800/50","rounded-lg"],[1,"p-4","bg-cyan-500/10","border","border-cyan-500/20","rounded-xl"],[1,"text-sm","text-slate-300","space-y-1"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-white","font-medium"],[1,"text-xs","text-cyan-400","mt-1"],[1,"w-8","h-8","rounded-full","bg-purple-500/30","text-purple-400","flex","items-center","justify-center","flex-shrink-0"],[1,"flex-1"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u{1F916}"),s(),l(7," AI \u5718\u968A\u92B7\u552E "),s(),y(8,j$,3,0,"span",6),s(),r(9,"div",7)(10,"div",8)(11,"div",9),l(12),s(),r(13,"div",10),l(14,"\u57F7\u884C\u4E2D"),s()(),B(15,"div",11),r(16,"div",8)(17,"div",12),l(18),s(),r(19,"div",10),l(20,"\u4ECA\u65E5\u6D88\u606F"),s()(),B(21,"div",11),r(22,"div",8)(23,"div",13),l(24),s(),r(25,"div",10),l(26,"\u6210\u4EA4"),s()()()(),r(27,"div",14)(28,"button",15),x("click",function(){return n.activeTab.set("start")}),r(29,"span"),l(30,"\u{1F680}"),s(),l(31," \u4E00\u9375\u555F\u52D5 "),s(),r(32,"button",15),x("click",function(){return n.activeTab.set("running")}),r(33,"span"),l(34,"\u{1F4CA}"),s(),l(35," \u57F7\u884C\u76E3\u63A7 "),y(36,J$,2,1,"span",16),s(),r(37,"button",15),x("click",function(){return n.activeTab.set("history")}),r(38,"span"),l(39,"\u{1F4DC}"),s(),l(40," \u6B77\u53F2\u8A18\u9304 "),s()()(),r(41,"div",17),y(42,eH,44,4,"div",18)(43,fH,3,1,"div",19)(44,CH,3,1,"div",20),s(),y(45,wH,19,1,"div",21),s()),t&2){let o,a;c(8),S(((o=n.engine.currentExecution())==null?null:o.status)==="running"?8:-1),c(4),D(n.runningCount()),c(6),D(n.todayMessages()),c(6),D(n.todayConversions()),c(4),N("bg-gradient-to-r",n.activeTab()==="start")("from-purple-500",n.activeTab()==="start")("to-pink-500",n.activeTab()==="start")("text-white",n.activeTab()==="start")("text-slate-400",n.activeTab()!=="start"),c(4),N("bg-gradient-to-r",n.activeTab()==="running")("from-green-500",n.activeTab()==="running")("to-emerald-500",n.activeTab()==="running")("text-white",n.activeTab()==="running")("text-slate-400",n.activeTab()!=="running"),c(4),S(n.runningCount()>0?36:-1),c(),N("bg-gradient-to-r",n.activeTab()==="history")("from-slate-600",n.activeTab()==="history")("to-slate-500",n.activeTab()==="history")("text-white",n.activeTab()==="history")("text-slate-400",n.activeTab()!=="history"),c(5),S((a=n.activeTab())==="start"?42:a==="running"?43:a==="history"?44:-1),c(3),S(n.showPlanningResult()?45:-1)}},dependencies:[oe,ae,xe,ve,he],encapsulation:2})}};var EH=(i,e)=>e.group,DH=(i,e)=>e.user_id;function AH(i,e){if(i&1&&(r(0,"div",15),l(1),s()),i&2){let t=m();c(),M("+",t.stats().todayNew," \u4ECA\u65E5")}}function MH(i,e){if(i&1){let t=I();r(0,"button",47),x("click",function(){_(t);let o=m();return v(o.clearSearch())}),l(1,"\u2715"),s()}}function TH(i,e){if(i&1&&(r(0,"option",30),l(1),s()),i&2){let t=e.$implicit;L("value",t.group),c(),X("",t.title," (",t.count,")")}}function kH(i,e){if(i&1){let t=I();r(0,"button",48),x("click",function(){_(t);let o=m();return v(o.clearFilters())}),l(1," \u{1F5D1}\uFE0F \u6E05\u9664\u7BE9\u9078 "),s()}}function IH(i,e){i&1&&(r(0,"div",45),B(1,"div",49),r(2,"p"),l(3,"\u6B63\u5728\u8F09\u5165\u6210\u54E1\u6578\u64DA..."),s()())}function FH(i,e){i&1&&(r(0,"div",46)(1,"div",50),l(2,"\u{1F4ED}"),s(),r(3,"h3"),l(4,"\u66AB\u7121\u6210\u54E1\u6578\u64DA"),s(),r(5,"p"),l(6,"\u8ACB\u5148\u5F9E\u300C\u8CC7\u6E90\u767C\u73FE\u300D\u9801\u9762\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1"),s()())}function PH(i,e){if(i&1){let t=I();r(0,"div",51)(1,"span",72),l(2),s(),r(3,"div",73)(4,"button",74),x("click",function(){_(t);let o=m(2);return v(o.batchSendMessage())}),l(5," \u{1F4E8} \u6279\u91CF\u767C\u6D88\u606F "),s(),r(6,"button",74),x("click",function(){_(t);let o=m(2);return v(o.batchAddTags())}),l(7," \u{1F3F7}\uFE0F \u6279\u91CF\u6A19\u7C64 "),s(),r(8,"button",74),x("click",function(){_(t);let o=m(2);return v(o.batchMarkContacted())}),l(9," \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B "),s(),r(10,"button",74),x("click",function(){_(t);let o=m(2);return v(o.batchExport())}),l(11," \u{1F4E5} \u5C0E\u51FA\u9078\u4E2D "),s(),r(12,"button",75),x("click",function(){_(t);let o=m(2);return v(o.clearSelection())}),l(13," \u2715 \u53D6\u6D88\u9078\u64C7 "),s()()()}if(i&2){let t=m(2);c(2),M("\u5DF2\u9078\u64C7 ",t.selectedMemberIds().length," \u500B\u6210\u54E1")}}function RH(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=m(2);c(),D(t.sortDirection==="asc"?"\u2191":"\u2193")}}function NH(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=m(2);c(),D(t.sortDirection==="asc"?"\u2191":"\u2193")}}function VH(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=m(2);c(),D(t.sortDirection==="asc"?"\u2191":"\u2193")}}function BH(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=m(2);c(),D(t.sortDirection==="asc"?"\u2191":"\u2193")}}function LH(i,e){i&1&&(r(0,"span",86),l(1,"\u2B50"),s())}function OH(i,e){i&1&&(r(0,"span",87),l(1,"\u2713"),s())}function UH(i,e){i&1&&(r(0,"span",88),l(1,"\u{1F1E8}\u{1F1F3}"),s())}function GH(i,e){if(i&1&&(r(0,"span",89),l(1),s()),i&2){let t=m().$implicit;L("title",t.bio),c(),D(t.bio)}}function $H(i,e){if(i&1){let t=I();r(0,"a",106),x("click",function(o){return _(t),v(o.stopPropagation())}),l(1),s()}if(i&2){let t=m().$implicit;L("href","https://t.me/"+t.username,ot),c(),M(" @",t.username," ")}}function HH(i,e){i&1&&(r(0,"span",91),l(1,"-"),s())}function qH(i,e){if(i&1&&(r(0,"span",107),l(1),s()),i&2){let t=e.$implicit;c(),D(t)}}function WH(i,e){if(i&1&&(r(0,"span",108),l(1),s()),i&2){let t=m(2).$implicit,n=m(2);c(),M("+",n.getMemberTags(t).length-2)}}function zH(i,e){if(i&1&&(r(0,"div",97),O(1,qH,2,1,"span",107,be),y(3,WH,2,1,"span",108),s()),i&2){let t=m().$implicit,n=m(2);c(),U(n.getMemberTags(t).slice(0,2)),c(2),S(n.getMemberTags(t).length>2?3:-1)}}function KH(i,e){i&1&&(r(0,"span",98),l(1,"-"),s())}function jH(i,e){i&1&&(r(0,"span",99),l(1," \u2705 \u5DF2\u806F\u7E6B "),s())}function JH(i,e){i&1&&(r(0,"span",100),l(1," \u{1F4ED} \u672A\u806F\u7E6B "),s())}function QH(i,e){if(i&1){let t=I();r(0,"tr",76),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.openMemberDetail(o))}),r(1,"td",77),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"input",78),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleMemberSelection(o.user_id))}),s()(),r(3,"td",79)(4,"span",80),l(5),s()(),r(6,"td",81)(7,"div",82)(8,"div",83),l(9),s(),r(10,"div",84)(11,"span",85),l(12),y(13,LH,2,0,"span",86),y(14,OH,2,0,"span",87),y(15,UH,2,0,"span",88),s(),y(16,GH,2,2,"span",89),s()()(),r(17,"td",58),y(18,$H,2,2,"a",90)(19,HH,2,0,"span",91),s(),r(20,"td",92)(21,"span",93),l(22),s()(),r(23,"td",94)(24,"span",95),l(25),s()(),r(26,"td",61)(27,"span",96),l(28),s()(),r(29,"td",62),y(30,zH,4,1,"div",97)(31,KH,2,0,"span",98),s(),r(32,"td",63),y(33,jH,2,0,"span",99)(34,JH,2,0,"span",100),s(),r(35,"td",101),x("click",function(o){return _(t),v(o.stopPropagation())}),r(36,"div",102)(37,"button",103),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.sendMessage(o))}),l(38," \u{1F4AC} "),s(),r(39,"button",104),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.addToFunnel(o))}),l(40," \u{1F4E4} "),s(),r(41,"button",105),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.openMemberDetail(o))}),l(42," \u{1F441}\uFE0F "),s()()()()}if(i&2){let t=e.$implicit,n=m(2);N("selected",n.isMemberSelected(t.user_id)),c(2),L("checked",n.isMemberSelected(t.user_id)),c(2),L("title",t.user_id),c(),D(t.user_id),c(3),N("has-photo",t.has_photo),c(),M(" ",n.getAvatarLetter(t)," "),c(3),X(" ",t.first_name," ",t.last_name," "),c(),S(t.is_premium?13:-1),c(),S(t.is_verified?14:-1),c(),S(n.isChinese(t)?15:-1),c(),S(t.bio?16:-1),c(2),S(t.username?18:19),c(3),de("status-"+t.online_status),c(),X(" ",n.getStatusIcon(t.online_status)," ",n.getStatusText(t.online_status)," "),c(2),de("level-"+t.value_level),c(),M(" ",t.value_level," "),c(2),L("title",t.source_chat_title),c(),M(" ",t.source_chat_title||"\u672A\u77E5"," "),c(2),S(n.getMemberTags(t).length>0?30:31),c(3),S(t.contacted?33:34)}}function YH(i,e){if(i&1){let t=I();y(0,PH,14,1,"div",51),r(1,"div",52)(2,"table",53)(3,"thead")(4,"tr")(5,"th",54)(6,"input",55),x("change",function(){_(t);let o=m();return v(o.toggleSelectAll())}),s()(),r(7,"th",56),x("click",function(){_(t);let o=m();return v(o.sortBy("user_id"))}),l(8," ID "),y(9,RH,2,1,"span"),s(),r(10,"th",57),x("click",function(){_(t);let o=m();return v(o.sortBy("first_name"))}),l(11," \u7528\u6236 "),y(12,NH,2,1,"span"),s(),r(13,"th",58),l(14,"\u7528\u6236\u540D"),s(),r(15,"th",59),x("click",function(){_(t);let o=m();return v(o.sortBy("online_status"))}),l(16," \u72C0\u614B "),y(17,VH,2,1,"span"),s(),r(18,"th",60),x("click",function(){_(t);let o=m();return v(o.sortBy("value_level"))}),l(19," \u7B49\u7D1A "),y(20,BH,2,1,"span"),s(),r(21,"th",61),l(22,"\u4F86\u6E90\u7FA4\u7D44"),s(),r(23,"th",62),l(24,"\u6A19\u7C64"),s(),r(25,"th",63),l(26,"\u806F\u7E6B\u72C0\u614B"),s(),r(27,"th",64),l(28,"\u64CD\u4F5C"),s()()(),r(29,"tbody"),O(30,QH,43,26,"tr",65,DH),s()()(),r(32,"div",66)(33,"div",67),l(34),s(),r(35,"div",68)(36,"button",69),x("click",function(){_(t);let o=m();return v(o.goToPage(1))}),l(37," \u23EE\uFE0F "),s(),r(38,"button",69),x("click",function(){_(t);let o=m();return v(o.goToPage(o.currentPage-1))}),l(39," \u25C0\uFE0F "),s(),r(40,"span",70),l(41),s(),r(42,"button",69),x("click",function(){_(t);let o=m();return v(o.goToPage(o.currentPage+1))}),l(43," \u25B6\uFE0F "),s(),r(44,"button",69),x("click",function(){_(t);let o=m();return v(o.goToPage(o.totalPages()))}),l(45," \u23ED\uFE0F "),s(),r(46,"select",71),W("ngModelChange",function(o){_(t);let a=m();return q(a.pageSize,o)||(a.pageSize=o),v(o)}),x("ngModelChange",function(){_(t);let o=m();return v(o.onPageSizeChange())}),r(47,"option",30),l(48,"25 / \u9801"),s(),r(49,"option",30),l(50,"50 / \u9801"),s(),r(51,"option",30),l(52,"100 / \u9801"),s(),r(53,"option",30),l(54,"200 / \u9801"),s()()()()}if(i&2){let t=m();S(t.selectedMemberIds().length>0?0:-1),c(6),L("checked",t.isAllSelected())("indeterminate",t.isPartialSelected()),c(3),S(t.sortField==="user_id"?9:-1),c(3),S(t.sortField==="first_name"?12:-1),c(5),S(t.sortField==="online_status"?17:-1),c(3),S(t.sortField==="value_level"?20:-1),c(10),U(t.paginatedMembers()),c(4),cn(" \u986F\u793A ",t.getPageStart()," - ",t.getPageEnd()," / ",t.filteredMembers().length," \u500B\u6210\u54E1 "),c(2),L("disabled",t.currentPage===1),c(2),L("disabled",t.currentPage===1),c(3),X("",t.currentPage," / ",t.totalPages()),c(),L("disabled",t.currentPage>=t.totalPages()),c(2),L("disabled",t.currentPage>=t.totalPages()),c(2),H("ngModel",t.pageSize),c(),L("value",25),c(2),L("value",50),c(2),L("value",100),c(2),L("value",200)}}function XH(i,e){i&1&&(r(0,"span",119),l(1,"\u2B50"),s())}function ZH(i,e){if(i&1&&(r(0,"a",120),l(1),s()),i&2){let t=m(2);L("href","https://t.me/"+t.selectedMember().username,ot),c(),M(" @",t.selectedMember().username," ")}}function eq(i,e){if(i&1&&(r(0,"div",123)(1,"span",124),l(2,"\u96FB\u8A71\u865F\u78BC"),s(),r(3,"span",127),l(4),s()()),i&2){let t=m(2);c(4),D(t.selectedMember().phone)}}function tq(i,e){if(i&1&&(r(0,"div",123)(1,"span",124),l(2,"\u8A9E\u8A00"),s(),r(3,"span",127),l(4),s()()),i&2){let t=m(2);c(4),D(t.selectedMember().language_code)}}function nq(i,e){i&1&&(r(0,"span",129),l(1,"\u2B50 Premium"),s())}function iq(i,e){i&1&&(r(0,"span",130),l(1,"\u2713 \u5DF2\u9A57\u8B49"),s())}function oq(i,e){i&1&&(r(0,"span",131),l(1,"\u{1F4F7} \u6709\u982D\u50CF"),s())}function rq(i,e){i&1&&(r(0,"span",132),l(1,"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA"),s())}function sq(i,e){i&1&&(r(0,"span",133),l(1,"\u26A0\uFE0F \u8A50\u9A19\u6A19\u8A18"),s())}function aq(i,e){i&1&&(r(0,"span",134),l(1,"\u{1F5D1}\uFE0F \u5DF2\u522A\u9664"),s())}function lq(i,e){if(i&1&&(r(0,"div",114)(1,"h4",121),l(2,"\u{1F4DD} \u500B\u4EBA\u7C21\u4ECB"),s(),r(3,"p",151),l(4),s()()),i&2){let t=m(2);c(4),D(t.selectedMember().bio)}}function cq(i,e){if(i&1&&(r(0,"div",136)(1,"span",137),l(2),s()()),i&2){let t=m().$implicit;c(2),M("\u7FA4\u7D44 ",t)}}function dq(i,e){if(i&1&&y(0,cq,3,1,"div",136),i&2){let t=e.$implicit,n=m(2);S(t!==n.selectedMember().source_chat_id?0:-1)}}function uq(i,e){if(i&1){let t=I();r(0,"span",140),l(1),r(2,"button",152),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.removeTag(a.selectedMember(),o))}),l(3,"\u2715"),s()()}if(i&2){let t=e.$implicit;c(),M(" ",t," ")}}function mq(i,e){if(i&1&&(r(0,"div",144)(1,"span",145),l(2,"\u806F\u7E6B\u6642\u9593"),s(),r(3,"span",146),l(4),s()()),i&2){let t=m(2);c(4),D(t.formatDate(t.selectedMember().contacted_at))}}function pq(i,e){if(i&1&&(r(0,"div",144)(1,"span",145),l(2,"\u56DE\u8986\u72C0\u614B"),s(),r(3,"span",146),l(4),s()()),i&2){let t=m(2);c(4),D(t.selectedMember().response_status)}}function gq(i,e){if(i&1){let t=I();r(0,"button",149),x("click",function(){_(t);let o=m(2);return v(o.markAsContacted(o.selectedMember()))}),l(1," \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B "),s()}}function hq(i,e){if(i&1){let t=I();r(0,"div",109),x("click",function(){_(t);let o=m();return v(o.closeMemberDetail())}),s(),r(1,"div",110)(2,"div",111)(3,"h2"),l(4,"\u6210\u54E1\u8A73\u60C5"),s(),r(5,"button",112),x("click",function(){_(t);let o=m();return v(o.closeMemberDetail())}),l(6,"\u2715"),s()(),r(7,"div",113)(8,"div",114)(9,"div",115)(10,"div",116),l(11),s(),r(12,"div",117)(13,"h3",118),l(14),y(15,XH,2,0,"span",119),s(),y(16,ZH,2,2,"a",120),r(17,"span",93),l(18),s()()()(),r(19,"div",114)(20,"h4",121),l(21,"\u{1F4CB} \u57FA\u672C\u4FE1\u606F"),s(),r(22,"div",122)(23,"div",123)(24,"span",124),l(25,"Telegram ID"),s(),r(26,"span",125),x("click",function(){_(t);let o=m();return v(o.copyToClipboard(o.selectedMember().user_id))}),l(27),r(28,"span",126),l(29,"\u{1F4CB}"),s()()(),y(30,eq,5,1,"div",123),y(31,tq,5,1,"div",123),r(32,"div",123)(33,"span",124),l(34,"\u50F9\u503C\u7B49\u7D1A"),s(),r(35,"span",127)(36,"span",95),l(37),s()()(),r(38,"div",123)(39,"span",124),l(40,"\u6D3B\u8E8D\u5EA6\u8A55\u5206"),s(),r(41,"span",127),l(42),s()()()(),r(43,"div",114)(44,"h4",121),l(45,"\u{1F516} \u5E33\u865F\u72C0\u614B"),s(),r(46,"div",128),y(47,nq,2,0,"span",129),y(48,iq,2,0,"span",130),y(49,oq,2,0,"span",131),y(50,rq,2,0,"span",132),y(51,sq,2,0,"span",133),y(52,aq,2,0,"span",134),s()(),y(53,lq,5,1,"div",114),r(54,"div",114)(55,"h4",121),l(56,"\u{1F4CD} \u4F86\u6E90\u7FA4\u7D44"),s(),r(57,"div",135)(58,"div",136)(59,"span",137),l(60),s(),r(61,"span",138),l(62),s()(),O(63,dq,1,1,null,null,be),s()(),r(65,"div",114)(66,"h4",121),l(67,"\u{1F3F7}\uFE0F \u6A19\u7C64"),s(),r(68,"div",139),O(69,uq,4,1,"span",140,be),r(71,"button",141),x("click",function(){_(t);let o=m();return v(o.openAddTagDialog())}),l(72,"+ \u6DFB\u52A0\u6A19\u7C64"),s()()(),r(73,"div",114)(74,"h4",121),l(75,"\u{1F4DD} \u5099\u8A3B"),s(),r(76,"textarea",142),W("ngModelChange",function(o){_(t);let a=m();return q(a.memberNotes,o)||(a.memberNotes=o),v(o)}),x("blur",function(){_(t);let o=m();return v(o.saveMemberNotes())}),s()(),r(77,"div",114)(78,"h4",121),l(79,"\u{1F4CA} \u71DF\u92B7\u72C0\u614B"),s(),r(80,"div",143)(81,"div",144)(82,"span",145),l(83,"\u806F\u7E6B\u72C0\u614B"),s(),r(84,"span",146),l(85),s()(),y(86,mq,5,1,"div",144),y(87,pq,5,1,"div",144),r(88,"div",144)(89,"span",145),l(90,"\u8F49\u5316\u72C0\u614B"),s(),r(91,"span",146),l(92),s()()()()(),r(93,"div",147)(94,"button",148),x("click",function(){_(t);let o=m();return v(o.sendMessage(o.selectedMember()))}),l(95," \u{1F4AC} \u767C\u6D88\u606F "),s(),r(96,"button",149),x("click",function(){_(t);let o=m();return v(o.addToFunnel(o.selectedMember()))}),l(97," \u{1F4E4} \u52A0\u5165\u6F0F\u6597 "),s(),y(98,gq,2,0,"button",150),s()()}if(i&2){let t=m();c(10),N("has-photo",t.selectedMember().has_photo),c(),M(" ",t.getAvatarLetter(t.selectedMember())," "),c(3),X(" ",t.selectedMember().first_name," ",t.selectedMember().last_name," "),c(),S(t.selectedMember().is_premium?15:-1),c(),S(t.selectedMember().username?16:-1),c(),de("status-"+t.selectedMember().online_status),c(),X(" ",t.getStatusIcon(t.selectedMember().online_status)," ",t.getStatusText(t.selectedMember().online_status)," "),c(9),M(" ",t.selectedMember().user_id," "),c(3),S(t.selectedMember().phone?30:-1),c(),S(t.selectedMember().language_code?31:-1),c(5),de("level-"+t.selectedMember().value_level),c(),M(" ",t.selectedMember().value_level," \u7D1A "),c(5),M("",t.selectedMember().activity_score,"/100"),c(5),S(t.selectedMember().is_premium?47:-1),c(),S(t.selectedMember().is_verified?48:-1),c(),S(t.selectedMember().has_photo?49:-1),c(),S(t.isChinese(t.selectedMember())?50:-1),c(),S(t.selectedMember().is_scam?51:-1),c(),S(t.selectedMember().is_deleted?52:-1),c(),S(t.selectedMember().bio?53:-1),c(7),D(t.selectedMember().source_chat_title),c(2),D(t.formatDate(t.selectedMember().extracted_at)),c(),U(t.getGroupsList(t.selectedMember())),c(6),U(t.getMemberTags(t.selectedMember())),c(7),H("ngModel",t.memberNotes),c(8),N("contacted",t.selectedMember().contacted),c(),M(" ",t.selectedMember().contacted?"\u2705 \u5DF2\u806F\u7E6B":"\u{1F4ED} \u672A\u806F\u7E6B"," "),c(),S(t.selectedMember().contacted_at?86:-1),c(),S(t.selectedMember().response_status?87:-1),c(4),N("converted",t.selectedMember().converted),c(),M(" ",t.selectedMember().converted?"\u2705 \u5DF2\u8F49\u5316":"\u23F3 \u5F85\u8F49\u5316"," "),c(6),S(t.selectedMember().contacted?-1:98)}}function fq(i,e){if(i&1){let t=I();r(0,"button",163),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.addSuggestedTag(o))}),l(1),s()}if(i&2){let t=e.$implicit;c(),D(t)}}function _q(i,e){if(i&1){let t=I();r(0,"div",153),x("click",function(){_(t);let o=m();return v(o.closeAddTagDialog())}),s(),r(1,"div",154)(2,"div",155)(3,"h3"),l(4,"\u6DFB\u52A0\u6A19\u7C64"),s(),r(5,"button",112),x("click",function(){_(t);let o=m();return v(o.closeAddTagDialog())}),l(6,"\u2715"),s()(),r(7,"div",156)(8,"input",157),W("ngModelChange",function(o){_(t);let a=m();return q(a.newTagName,o)||(a.newTagName=o),v(o)}),x("keyup.enter",function(){_(t);let o=m();return v(o.addTag())}),s(),r(9,"div",158)(10,"p",159),l(11,"\u5E38\u7528\u6A19\u7C64\uFF1A"),s(),r(12,"div",160),O(13,fq,2,1,"button",161,be),s()()(),r(15,"div",162)(16,"button",149),x("click",function(){_(t);let o=m();return v(o.closeAddTagDialog())}),l(17,"\u53D6\u6D88"),s(),r(18,"button",8),x("click",function(){_(t);let o=m();return v(o.addTag())}),l(19,"\u6DFB\u52A0"),s()()()}if(i&2){let t=m();c(8),H("ngModel",t.newTagName),c(5),U(t.suggestedTags),c(5),L("disabled",!t.newTagName)}}var md=class i{constructor(){this.ipcService=F(Q);this.toastService=F(J);this.sendMessageEvent=ge();this.addToFunnelEvent=ge();this.batchSendMessageEvent=ge();this.members=f([]);this.filteredMembers=f([]);this.isLoading=f(!1);this.stats=f({total:0,online:0,recently:0,premium:0,chinese:0,contacted:0,converted:0,todayNew:0,byValueLevel:{},bySource:[]});this.sourceGroups=f([]);this.searchQuery="";this.selectedSource="";this.selectedOnlineStatus="";this.selectedValueLevel="";this.filterPremium=!1;this.filterChinese=!1;this.filterHasUsername=!1;this.filterNotContacted=!1;this.filterHasPhoto=!1;this.sortField="extracted_at";this.sortDirection="desc";this.currentPage=1;this.pageSize=50;this.selectedMemberIds=f([]);this.selectedMember=f(null);this.memberNotes="";this.showAddTagDialog=f(!1);this.newTagName="";this.suggestedTags=["\u9AD8\u610F\u5411","\u5E63\u5708","DeFi","NFT","\u6295\u8CC7","\u4EA4\u6613","\u91CF\u5316","\u7926\u5DE5","\u958B\u767C\u8005","\u904B\u71DF"];this.loadTimeout=null;this.paginatedMembers=R(()=>{let e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.filteredMembers().slice(e,t)});this.totalPages=R(()=>Math.ceil(this.filteredMembers().length/this.pageSize)||1)}ngOnInit(){this.loadMembers(),this.setupEventListeners()}ngOnDestroy(){}setupEventListeners(){this.ipcService.on("extracted-members-list",e=>{console.log("[MemberDatabase] Received extracted-members-list event:",e),this.loadTimeout&&(clearTimeout(this.loadTimeout),this.loadTimeout=null),e.success?(console.log(`[MemberDatabase] Loaded ${e.members?.length||0} members`),this.members.set(e.members||[]),this.applyFilters(),this.calculateStats(),this.isLoading.set(!1)):(console.error("[MemberDatabase] Load failed:",e.error),this.toastService.error(`\u8F09\u5165\u5931\u6557: ${e.error}`),this.isLoading.set(!1))}),this.ipcService.on("member-stats",e=>{e.success&&this.stats.update(t=>E(E({},t),e))})}loadMembers(){console.log("[MemberDatabase] loadMembers called"),this.isLoading.set(!0),this.loadTimeout&&clearTimeout(this.loadTimeout),this.loadTimeout=setTimeout(()=>{this.isLoading()&&(console.warn("[MemberDatabase] Load timeout after 15 seconds"),this.isLoading.set(!1),this.toastService.error("\u8F09\u5165\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},15e3),console.log("[MemberDatabase] Sending get-extracted-members request"),this.ipcService.send("get-extracted-members",{limit:500,offset:0})}refreshMembers(){this.loadMembers(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u6578\u64DA...")}onSearchChange(e){this.searchQuery=e,this.applyFilters()}clearSearch(){this.searchQuery="",this.applyFilters()}applyFilters(){let e=[...this.members()];if(this.searchQuery){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.user_id.includes(t)||n.username?.toLowerCase().includes(t)||n.first_name?.toLowerCase().includes(t)||n.last_name?.toLowerCase().includes(t))}this.selectedSource&&(e=e.filter(t=>t.source_chat_id===this.selectedSource)),this.selectedOnlineStatus&&(e=e.filter(t=>t.online_status===this.selectedOnlineStatus)),this.selectedValueLevel&&(e=e.filter(t=>t.value_level===this.selectedValueLevel)),this.filterPremium&&(e=e.filter(t=>t.is_premium)),this.filterChinese&&(e=e.filter(t=>this.isChinese(t))),this.filterHasUsername&&(e=e.filter(t=>t.username)),this.filterNotContacted&&(e=e.filter(t=>!t.contacted)),this.filterHasPhoto&&(e=e.filter(t=>t.has_photo)),e.sort((t,n)=>{let o=t[this.sortField],a=n[this.sortField];return typeof o=="string"&&(o=o.toLowerCase()),typeof a=="string"&&(a=a.toLowerCase()),o<a?this.sortDirection==="asc"?-1:1:o>a?this.sortDirection==="asc"?1:-1:0}),this.filteredMembers.set(e),this.currentPage=1}hasActiveFilters(){return!!(this.searchQuery||this.selectedSource||this.selectedOnlineStatus||this.selectedValueLevel||this.filterPremium||this.filterChinese||this.filterHasUsername||this.filterNotContacted||this.filterHasPhoto)}clearFilters(){this.searchQuery="",this.selectedSource="",this.selectedOnlineStatus="",this.selectedValueLevel="",this.filterPremium=!1,this.filterChinese=!1,this.filterHasUsername=!1,this.filterNotContacted=!1,this.filterHasPhoto=!1,this.applyFilters()}sortBy(e){this.sortField===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=e,this.sortDirection="asc"),this.applyFilters()}getPageStart(){return(this.currentPage-1)*this.pageSize+1}getPageEnd(){return Math.min(this.currentPage*this.pageSize,this.filteredMembers().length)}goToPage(e){e>=1&&e<=this.totalPages()&&(this.currentPage=e)}onPageSizeChange(){this.currentPage=1}isAllSelected(){return this.paginatedMembers().length>0&&this.paginatedMembers().every(e=>this.selectedMemberIds().includes(e.user_id))}isPartialSelected(){let e=this.paginatedMembers().filter(t=>this.selectedMemberIds().includes(t.user_id));return e.length>0&&e.length<this.paginatedMembers().length}toggleSelectAll(){if(this.isAllSelected()){let e=this.paginatedMembers().map(t=>t.user_id);this.selectedMemberIds.update(t=>t.filter(n=>!e.includes(n)))}else{let e=this.paginatedMembers().map(t=>t.user_id);this.selectedMemberIds.update(t=>[...new Set([...t,...e])])}}isMemberSelected(e){return this.selectedMemberIds().includes(e)}toggleMemberSelection(e){this.selectedMemberIds.update(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])}clearSelection(){this.selectedMemberIds.set([])}calculateStats(){let e=this.members(),t=new Date().toDateString(),n={total:e.length,online:e.filter(a=>a.online_status==="online").length,recently:e.filter(a=>a.online_status==="recently").length,premium:e.filter(a=>a.is_premium).length,chinese:e.filter(a=>this.isChinese(a)).length,contacted:e.filter(a=>a.contacted).length,converted:e.filter(a=>a.converted).length,todayNew:e.filter(a=>new Date(a.created_at).toDateString()===t).length,byValueLevel:{},bySource:[]},o=new Map;e.forEach(a=>{if(a.source_chat_id){let d=o.get(a.source_chat_id);d?d.count++:o.set(a.source_chat_id,{title:a.source_chat_title||a.source_chat_id,count:1})}}),this.sourceGroups.set(Array.from(o.entries()).map(([a,d])=>({group:a,title:d.title,count:d.count})).sort((a,d)=>d.count-a.count)),this.stats.set(n)}getOnlinePercent(){let e=this.stats().total;return e>0?(this.stats().online/e*100).toFixed(1):"0"}getPremiumPercent(){let e=this.stats().total;return e>0?(this.stats().premium/e*100).toFixed(1):"0"}getChinesePercent(){let e=this.stats().total;return e>0?(this.stats().chinese/e*100).toFixed(1):"0"}getContactedPercent(){let e=this.stats().total;return e>0?(this.stats().contacted/e*100).toFixed(1):"0"}getConvertedPercent(){let e=this.stats().contacted;return e>0?(this.stats().converted/e*100).toFixed(1):"0"}getAvatarLetter(e){return(e.first_name||e.username||"?").charAt(0).toUpperCase()}getStatusIcon(e){switch(e){case"online":return"\u{1F7E2}";case"recently":return"\u{1F7E1}";case"last_week":return"\u{1F7E0}";case"last_month":return"\u26AA";default:return"\u26AA"}}getStatusText(e){switch(e){case"online":return"\u5728\u7DDA";case"recently":return"\u6700\u8FD1";case"last_week":return"\u672C\u9031";case"last_month":return"\u672C\u6708";case"long_ago":return"\u96E2\u7DDA";default:return"\u672A\u77E5"}}isChinese(e){let t=(e.first_name||"")+(e.last_name||""),n=e.bio||"",o=/[\u4e00-\u9fff]/;return o.test(t)||o.test(n)}getMemberTags(e){if(!e.tags)return[];try{return JSON.parse(e.tags)}catch{return[]}}getGroupsList(e){if(!e.groups)return[];try{return JSON.parse(e.groups)}catch{return[]}}formatDate(e){if(!e)return"-";try{return new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return e}}copyToClipboard(e){navigator.clipboard.writeText(e),this.toastService.success("\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u677F")}openMemberDetail(e){this.selectedMember.set(e),this.memberNotes=e.notes||""}closeMemberDetail(){this.selectedMember.set(null),this.memberNotes=""}saveMemberNotes(){let e=this.selectedMember();e&&(this.ipcService.send("update-member",{userId:e.user_id,updates:{notes:this.memberNotes}}),this.members.update(t=>t.map(n=>n.user_id===e.user_id?P(E({},n),{notes:this.memberNotes}):n)))}openAddTagDialog(){this.showAddTagDialog.set(!0),this.newTagName=""}closeAddTagDialog(){this.showAddTagDialog.set(!1),this.newTagName=""}addTag(){if(!this.newTagName.trim())return;let e=this.selectedMember();if(!e)return;let t=this.getMemberTags(e);t.includes(this.newTagName)||(t.push(this.newTagName),this.ipcService.send("update-member",{userId:e.user_id,updates:{tags:JSON.stringify(t)}}),this.members.update(n=>n.map(o=>o.user_id===e.user_id?P(E({},o),{tags:JSON.stringify(t)}):o)),this.selectedMember.update(n=>n?P(E({},n),{tags:JSON.stringify(t)}):null)),this.closeAddTagDialog()}addSuggestedTag(e){this.newTagName=e,this.addTag()}removeTag(e,t){let n=this.getMemberTags(e).filter(o=>o!==t);this.ipcService.send("update-member",{userId:e.user_id,updates:{tags:JSON.stringify(n)}}),this.members.update(o=>o.map(a=>a.user_id===e.user_id?P(E({},a),{tags:JSON.stringify(n)}):a)),this.selectedMember.update(o=>o?P(E({},o),{tags:JSON.stringify(n)}):null)}sendMessage(e){this.sendMessageEvent.emit(e)}addToFunnel(e){this.addToFunnelEvent.emit(e)}markAsContacted(e){this.ipcService.send("update-member",{userId:e.user_id,updates:{contacted:!0,contacted_at:new Date().toISOString()}}),this.members.update(t=>t.map(n=>n.user_id===e.user_id?P(E({},n),{contacted:!0,contacted_at:new Date().toISOString()}):n)),this.selectedMember.update(t=>t?P(E({},t),{contacted:!0,contacted_at:new Date().toISOString()}):null),this.calculateStats(),this.toastService.success("\u5DF2\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B")}batchSendMessage(){let e=this.members().filter(t=>this.selectedMemberIds().includes(t.user_id));e.length>0&&this.batchSendMessageEvent.emit(e)}batchAddTags(){this.toastService.info("\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64\u529F\u80FD\u958B\u767C\u4E2D...")}batchMarkContacted(){let e=this.selectedMemberIds(),t=new Date().toISOString();e.forEach(n=>{this.ipcService.send("update-member",{userId:n,updates:{contacted:!0,contacted_at:t}})}),this.members.update(n=>n.map(o=>e.includes(o.user_id)?P(E({},o),{contacted:!0,contacted_at:t}):o)),this.calculateStats(),this.applyFilters(),this.clearSelection(),this.toastService.success(`\u5DF2\u5C07 ${e.length} \u500B\u6210\u54E1\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B`)}batchExport(){let e=this.selectedMemberIds(),t=this.members().filter(n=>e.includes(n.user_id));this.exportMembersToCSV(t)}exportMembers(){this.exportMembersToCSV(this.filteredMembers())}exportMembersToCSV(e){let t=["Telegram ID","\u7528\u6236\u540D","\u59D3","\u540D","\u96FB\u8A71","\u7C21\u4ECB","\u8A9E\u8A00","Premium","\u5DF2\u9A57\u8B49","\u6709\u982D\u50CF","\u5728\u7DDA\u72C0\u614B","\u6700\u5F8C\u5728\u7DDA","\u6D3B\u8E8D\u5206\u6578","\u50F9\u503C\u7B49\u7D1A","\u4F86\u6E90\u7FA4\u7D44","\u4F86\u6E90\u7FA4\u7D44ID","\u63D0\u53D6\u6642\u9593","\u6A19\u7C64","\u5099\u8A3B","\u5DF2\u806F\u7E6B","\u806F\u7E6B\u6642\u9593","\u5DF2\u8F49\u5316"],n=e.map(g=>[g.user_id,g.username||"",g.last_name||"",g.first_name||"",g.phone||"",g.bio||"",g.language_code||"",g.is_premium?"\u662F":"\u5426",g.is_verified?"\u662F":"\u5426",g.has_photo?"\u662F":"\u5426",this.getStatusText(g.online_status),g.last_online||"",g.activity_score?.toString()||"",g.value_level||"",g.source_chat_title||"",g.source_chat_id||"",g.extracted_at||"",this.getMemberTags(g).join("; "),g.notes||"",g.contacted?"\u662F":"\u5426",g.contacted_at||"",g.converted?"\u662F":"\u5426"]),o=g=>g.includes(",")||g.includes('"')||g.includes(`
`)?`"${g.replace(/"/g,'""')}"`:g,a=[t,...n].map(g=>g.map(o).join(",")).join(`
`),d=new Blob(["\uFEFF"+a],{type:"text/csv;charset=utf-8"}),u=URL.createObjectURL(d),p=document.createElement("a");p.href=u,p.download=`members_${new Date().toISOString().slice(0,10)}.csv`,p.click(),URL.revokeObjectURL(u),this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-member-database"]],outputs:{sendMessageEvent:"sendMessageEvent",addToFunnelEvent:"addToFunnelEvent",batchSendMessageEvent:"batchSendMessageEvent"},decls:152,vars:46,consts:[[1,"member-database-container"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"btn-secondary",3,"click","disabled"],[1,"btn-primary",3,"click","disabled"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-value"],[1,"stat-label"],[1,"stat-badge","success"],[1,"stat-card","online"],[1,"stat-percent"],[1,"stat-card","premium"],[1,"stat-card","chinese"],[1,"stat-card","contacted"],[1,"stat-card","converted"],[1,"filter-section"],[1,"filter-row"],[1,"search-box"],[1,"search-icon"],["type","text","placeholder","\u641C\u7D22\u59D3\u540D\u3001\u7528\u6236\u540D\u3001ID...",1,"search-input",3,"ngModelChange","ngModel"],[1,"search-clear"],[1,"filter-select",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["value","online"],["value","recently"],["value","last_week"],["value","long_ago"],["value","S"],["value","A"],["value","B"],["value","C"],["value","D"],[1,"filter-checkbox"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"btn-text"],[1,"filter-result"],[1,"member-list-section"],[1,"loading-state"],[1,"empty-state"],[1,"search-clear",3,"click"],[1,"btn-text",3,"click"],[1,"loading-spinner"],[1,"empty-icon"],[1,"batch-action-bar"],[1,"member-table-container"],[1,"member-table"],[1,"col-checkbox"],["type","checkbox",3,"change","checked","indeterminate"],[1,"col-id",3,"click"],[1,"col-user",3,"click"],[1,"col-username"],[1,"col-status",3,"click"],[1,"col-level",3,"click"],[1,"col-source"],[1,"col-tags"],[1,"col-contacted"],[1,"col-actions"],[3,"selected"],[1,"pagination"],[1,"page-info"],[1,"page-controls"],[1,"page-btn",3,"click","disabled"],[1,"page-number"],[1,"page-size-select",3,"ngModelChange","ngModel"],[1,"selected-count"],[1,"batch-actions"],[1,"btn-batch",3,"click"],[1,"btn-batch","danger",3,"click"],[3,"click"],[1,"col-checkbox",3,"click"],["type","checkbox",3,"change","checked"],[1,"col-id"],[1,"user-id",3,"title"],[1,"col-user"],[1,"user-info"],[1,"user-avatar"],[1,"user-name-wrapper"],[1,"user-name"],["title","Premium",1,"premium-badge"],["title","\u5DF2\u9A57\u8B49",1,"verified-badge"],["title","\u83EF\u4EBA",1,"chinese-badge"],[1,"user-bio",3,"title"],["target","_blank",1,"username-link",3,"href"],[1,"no-username"],[1,"col-status"],[1,"status-badge"],[1,"col-level"],[1,"level-badge"],[1,"source-name",3,"title"],[1,"tags-container"],[1,"no-tags"],[1,"contacted-badge","yes"],[1,"contacted-badge","no"],[1,"col-actions",3,"click"],[1,"action-buttons"],["title","\u767C\u6D88\u606F",1,"action-btn",3,"click"],["title","\u52A0\u5165\u6F0F\u6597",1,"action-btn",3,"click"],["title","\u67E5\u770B\u8A73\u60C5",1,"action-btn",3,"click"],["target","_blank",1,"username-link",3,"click","href"],[1,"tag"],[1,"tag-more"],[1,"member-detail-overlay",3,"click"],[1,"member-detail-drawer"],[1,"drawer-header"],[1,"close-btn",3,"click"],[1,"drawer-content"],[1,"detail-section"],[1,"member-profile"],[1,"profile-avatar"],[1,"profile-info"],[1,"profile-name"],[1,"premium-badge"],["target","_blank",1,"profile-username",3,"href"],[1,"section-title"],[1,"detail-grid"],[1,"detail-item"],[1,"detail-label"],[1,"detail-value","copyable",3,"click"],[1,"copy-icon"],[1,"detail-value"],[1,"status-tags"],[1,"status-tag","premium"],[1,"status-tag","verified"],[1,"status-tag","photo"],[1,"status-tag","chinese"],[1,"status-tag","danger"],[1,"status-tag","deleted"],[1,"source-list"],[1,"source-item"],[1,"source-name"],[1,"source-date"],[1,"tags-edit"],[1,"tag","editable"],[1,"add-tag-btn",3,"click"],["placeholder","\u6DFB\u52A0\u8DDF\u9032\u5099\u8A3B...",1,"notes-textarea",3,"ngModelChange","blur","ngModel"],[1,"marketing-status"],[1,"status-item"],[1,"status-label"],[1,"status-value"],[1,"drawer-footer"],[1,"btn-primary",3,"click"],[1,"btn-secondary",3,"click"],[1,"btn-secondary"],[1,"bio-text"],[1,"tag-remove",3,"click"],[1,"dialog-overlay",3,"click"],[1,"dialog"],[1,"dialog-header"],[1,"dialog-content"],["type","text","placeholder","\u8F38\u5165\u6A19\u7C64\u540D\u7A31...",1,"tag-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"suggested-tags"],[1,"suggested-title"],[1,"suggested-list"],[1,"suggested-tag"],[1,"dialog-footer"],[1,"suggested-tag",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u{1F4C1}"),s(),l(6," \u6210\u54E1\u8CC7\u6599\u5EAB "),s(),r(7,"p",5),l(8,"\u7BA1\u7406\u548C\u5206\u6790\u63D0\u53D6\u7684 Telegram \u6210\u54E1\u6578\u64DA"),s()(),r(9,"div",6)(10,"button",7),x("click",function(){return n.refreshMembers()}),r(11,"span"),l(12,"\u{1F504}"),s(),l(13),s(),r(14,"button",8),x("click",function(){return n.exportMembers()}),l(15," \u{1F4E5} \u5C0E\u51FA CSV "),s()()(),r(16,"div",9)(17,"div",10)(18,"div",11),l(19,"\u{1F465}"),s(),r(20,"div",12)(21,"div",13),l(22),Ee(23,"number"),s(),r(24,"div",14),l(25,"\u7E3D\u6210\u54E1\u6578"),s()(),y(26,AH,2,1,"div",15),s(),r(27,"div",16)(28,"div",11),l(29,"\u{1F7E2}"),s(),r(30,"div",12)(31,"div",13),l(32),Ee(33,"number"),s(),r(34,"div",14),l(35,"\u5728\u7DDA\u6210\u54E1"),s()(),r(36,"div",17),l(37),s()(),r(38,"div",18)(39,"div",11),l(40,"\u2B50"),s(),r(41,"div",12)(42,"div",13),l(43),Ee(44,"number"),s(),r(45,"div",14),l(46,"Premium \u7528\u6236"),s()(),r(47,"div",17),l(48),s()(),r(49,"div",19)(50,"div",11),l(51,"\u{1F1E8}\u{1F1F3}"),s(),r(52,"div",12)(53,"div",13),l(54),Ee(55,"number"),s(),r(56,"div",14),l(57,"\u83EF\u4EBA\u6210\u54E1"),s()(),r(58,"div",17),l(59),s()(),r(60,"div",20)(61,"div",11),l(62,"\u{1F4AC}"),s(),r(63,"div",12)(64,"div",13),l(65),Ee(66,"number"),s(),r(67,"div",14),l(68,"\u5DF2\u806F\u7E6B"),s()(),r(69,"div",17),l(70),s()(),r(71,"div",21)(72,"div",11),l(73,"\u2705"),s(),r(74,"div",12)(75,"div",13),l(76),Ee(77,"number"),s(),r(78,"div",14),l(79,"\u5DF2\u8F49\u5316"),s()(),r(80,"div",17),l(81),s()()(),r(82,"div",22)(83,"div",23)(84,"div",24)(85,"span",25),l(86,"\u{1F50D}"),s(),r(87,"input",26),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),x("ngModelChange",function(a){return n.onSearchChange(a)}),s(),y(88,MH,2,0,"button",27),s(),r(89,"select",28),W("ngModelChange",function(a){return q(n.selectedSource,a)||(n.selectedSource=a),a}),x("ngModelChange",function(){return n.applyFilters()}),r(90,"option",29),l(91,"\u6240\u6709\u4F86\u6E90\u7FA4\u7D44"),s(),O(92,TH,2,3,"option",30,EH),s(),r(94,"select",28),W("ngModelChange",function(a){return q(n.selectedOnlineStatus,a)||(n.selectedOnlineStatus=a),a}),x("ngModelChange",function(){return n.applyFilters()}),r(95,"option",29),l(96,"\u6240\u6709\u72C0\u614B"),s(),r(97,"option",31),l(98,"\u{1F7E2} \u5728\u7DDA"),s(),r(99,"option",32),l(100,"\u{1F7E1} \u6700\u8FD1\u4E0A\u7DDA"),s(),r(101,"option",33),l(102,"\u{1F7E0} \u672C\u9031\u4E0A\u7DDA"),s(),r(103,"option",34),l(104,"\u26AA \u9577\u671F\u96E2\u7DDA"),s()(),r(105,"select",28),W("ngModelChange",function(a){return q(n.selectedValueLevel,a)||(n.selectedValueLevel=a),a}),x("ngModelChange",function(){return n.applyFilters()}),r(106,"option",29),l(107,"\u6240\u6709\u7B49\u7D1A"),s(),r(108,"option",35),l(109,"S \u7D1A - \u9802\u7D1A"),s(),r(110,"option",36),l(111,"A \u7D1A - \u512A\u8CEA"),s(),r(112,"option",37),l(113,"B \u7D1A - \u666E\u901A"),s(),r(114,"option",38),l(115,"C \u7D1A - \u4E00\u822C"),s(),r(116,"option",39),l(117,"D \u7D1A - \u4F4E\u50F9\u503C"),s()()(),r(118,"div",23)(119,"label",40)(120,"input",41),W("ngModelChange",function(a){return q(n.filterPremium,a)||(n.filterPremium=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(121,"span"),l(122,"\u2B50 Premium"),s()(),r(123,"label",40)(124,"input",41),W("ngModelChange",function(a){return q(n.filterChinese,a)||(n.filterChinese=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(125,"span"),l(126,"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA"),s()(),r(127,"label",40)(128,"input",41),W("ngModelChange",function(a){return q(n.filterHasUsername,a)||(n.filterHasUsername=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(129,"span"),l(130,"\u{1F4DB} \u6709\u7528\u6236\u540D"),s()(),r(131,"label",40)(132,"input",41),W("ngModelChange",function(a){return q(n.filterNotContacted,a)||(n.filterNotContacted=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(133,"span"),l(134,"\u{1F4ED} \u672A\u806F\u7E6B"),s()(),r(135,"label",40)(136,"input",41),W("ngModelChange",function(a){return q(n.filterHasPhoto,a)||(n.filterHasPhoto=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(137,"span"),l(138,"\u{1F4F7} \u6709\u982D\u50CF"),s()(),y(139,kH,2,0,"button",42),r(140,"div",43),l(141," \u627E\u5230 "),r(142,"strong"),l(143),Ee(144,"number"),s(),l(145," \u500B\u6210\u54E1 "),s()()(),r(146,"div",44),y(147,IH,4,0,"div",45)(148,FH,7,0,"div",46)(149,YH,55,21),s(),y(150,hq,99,37),y(151,_q,20,2),s()),t&2&&(c(10),L("disabled",n.isLoading()),c(),N("animate-spin",n.isLoading()),c(2),M(" ",n.isLoading()?"\u8F09\u5165\u4E2D...":"\u5237\u65B0"," "),c(),L("disabled",n.filteredMembers().length===0),c(8),D(je(23,32,n.stats().total)),c(4),S(n.stats().todayNew>0?26:-1),c(6),D(je(33,34,n.stats().online)),c(5),M("",n.getOnlinePercent(),"%"),c(6),D(je(44,36,n.stats().premium)),c(5),M("",n.getPremiumPercent(),"%"),c(6),D(je(55,38,n.stats().chinese)),c(5),M("",n.getChinesePercent(),"%"),c(6),D(je(66,40,n.stats().contacted)),c(5),M("",n.getContactedPercent(),"%"),c(6),D(je(77,42,n.stats().converted)),c(5),M("",n.getConvertedPercent(),"%"),c(6),H("ngModel",n.searchQuery),c(),S(n.searchQuery?88:-1),c(),H("ngModel",n.selectedSource),c(3),U(n.sourceGroups()),c(2),H("ngModel",n.selectedOnlineStatus),c(11),H("ngModel",n.selectedValueLevel),c(15),H("ngModel",n.filterPremium),c(4),H("ngModel",n.filterChinese),c(4),H("ngModel",n.filterHasUsername),c(4),H("ngModel",n.filterNotContacted),c(4),H("ngModel",n.filterHasPhoto),c(3),S(n.hasActiveFilters()?139:-1),c(4),D(je(144,44,n.filteredMembers().length)),c(4),S(n.isLoading()?147:n.filteredMembers().length===0?148:149),c(3),S(n.selectedMember()?150:-1),c(),S(n.showAddTagDialog()?151:-1))},dependencies:[oe,ae,Re,Ne,xe,it,Ge,ve,he,St],styles:[".member-database-container[_ngcontent-%COMP%]{padding:1.5rem;height:100%;overflow-y:auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#fff;display:flex;align-items:center;gap:.5rem;margin:0}.title-icon[_ngcontent-%COMP%]{font-size:1.75rem}.page-desc[_ngcontent-%COMP%]{color:#94a3b8;margin:.25rem 0 0;font-size:.875rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.btn-primary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .2s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#47556980;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#e2e8f0;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .2s}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#475569b3;border-color:#94a3b84d}.btn-secondary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-text[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:none;color:#94a3b8;cursor:pointer;font-size:.875rem}.btn-text[_ngcontent-%COMP%]:hover{color:#f87171}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{background:#1e293bcc;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;padding:1rem;display:flex;align-items:center;gap:.75rem;position:relative}.stat-icon[_ngcontent-%COMP%]{font-size:1.5rem}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:.75rem;color:#94a3b8}.stat-badge[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem;padding:.125rem .375rem;border-radius:.25rem;font-size:.625rem;font-weight:600}.stat-badge.success[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.stat-percent[_ngcontent-%COMP%]{font-size:.875rem;color:#94a3b8}.stat-card.online[_ngcontent-%COMP%]{border-left:3px solid #22c55e}.stat-card.premium[_ngcontent-%COMP%]{border-left:3px solid #f59e0b}.stat-card.chinese[_ngcontent-%COMP%]{border-left:3px solid #ef4444}.stat-card.contacted[_ngcontent-%COMP%]{border-left:3px solid #3b82f6}.stat-card.converted[_ngcontent-%COMP%]{border-left:3px solid #8b5cf6}.filter-section[_ngcontent-%COMP%]{background:#1e293b99;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;padding:1rem;margin-bottom:1rem}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:.75rem;margin-bottom:.75rem}.filter-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.search-box[_ngcontent-%COMP%]{position:relative;flex:1;min-width:200px;max-width:300px}.search-icon[_ngcontent-%COMP%]{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);font-size:.875rem}.search-input[_ngcontent-%COMP%]{width:100%;padding:.5rem 2rem .5rem 2.25rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.search-clear[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;color:#94a3b8;cursor:pointer;font-size:.75rem}.filter-select[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;min-width:140px}.filter-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.filter-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;padding:.375rem .75rem;background:#0f172a4d;border:1px solid rgba(148,163,184,.15);border-radius:.5rem;color:#e2e8f0;font-size:.8rem;cursor:pointer;transition:all .2s}.filter-checkbox[_ngcontent-%COMP%]:hover{background:#0f172a80;border-color:#94a3b840}.filter-checkbox[_ngcontent-%COMP%]:has(input:checked){background:#06b6d426;border-color:#06b6d466}.filter-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.filter-result[_ngcontent-%COMP%]{margin-left:auto;color:#94a3b8;font-size:.875rem}.member-list-section[_ngcontent-%COMP%]{background:#1e293b99;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;overflow:hidden}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:#94a3b8}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(6,182,212,.2);border-top-color:#06b6d4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;margin:0 0 .5rem}.batch-action-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;background:#06b6d41a;border-bottom:1px solid rgba(6,182,212,.2)}.selected-count[_ngcontent-%COMP%]{color:#22d3ee;font-weight:500}.batch-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.btn-batch[_ngcontent-%COMP%]{padding:.375rem .75rem;background:#1e293bcc;border:1px solid rgba(148,163,184,.2);border-radius:.375rem;color:#e2e8f0;font-size:.8rem;cursor:pointer;transition:all .2s}.btn-batch[_ngcontent-%COMP%]:hover{background:#334155cc}.btn-batch.danger[_ngcontent-%COMP%]{color:#f87171}.btn-batch.danger[_ngcontent-%COMP%]:hover{background:#ef444433}.member-table-container[_ngcontent-%COMP%]{overflow-x:auto}.member-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:left;background:#0f172a80;color:#94a3b8;font-weight:500;border-bottom:1px solid rgba(148,163,184,.1);cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover{background:#0f172ab3}.member-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;border-bottom:1px solid rgba(148,163,184,.05);color:#e2e8f0}.member-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s}.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#3341554d}.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background:#06b6d41a}.col-checkbox[_ngcontent-%COMP%]{width:40px}.col-id[_ngcontent-%COMP%]{width:120px}.col-user[_ngcontent-%COMP%]{min-width:180px}.col-username[_ngcontent-%COMP%]{width:120px}.col-status[_ngcontent-%COMP%]{width:100px}.col-level[_ngcontent-%COMP%]{width:60px}.col-source[_ngcontent-%COMP%]{width:150px}.col-tags[_ngcontent-%COMP%]{width:120px}.col-contacted[_ngcontent-%COMP%], .col-actions[_ngcontent-%COMP%]{width:100px}.user-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:#94a3b8}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#475569,#334155);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:500;font-size:.875rem}.user-avatar.has-photo[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.user-name-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.premium-badge[_ngcontent-%COMP%], .verified-badge[_ngcontent-%COMP%], .chinese-badge[_ngcontent-%COMP%]{font-size:.75rem}.user-bio[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.username-link[_ngcontent-%COMP%]{color:#22d3ee;text-decoration:none}.username-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.no-username[_ngcontent-%COMP%], .no-tags[_ngcontent-%COMP%]{color:#475569}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.status-badge.status-online[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.status-badge.status-recently[_ngcontent-%COMP%]{background:#eab30833;color:#fde047}.status-badge.status-last_week[_ngcontent-%COMP%]{background:#f9731633;color:#fdba74}.status-badge.status-last_month[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.status-badge.status-long_ago[_ngcontent-%COMP%], .status-badge.status-unknown[_ngcontent-%COMP%]{background:#47556933;color:#64748b}.level-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;font-size:.75rem;font-weight:600}.level-badge.level-S[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.level-badge.level-A[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff}.level-badge.level-B[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.level-badge.level-C[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.level-badge.level-D[_ngcontent-%COMP%]{background:#47556980;color:#94a3b8}.source-name[_ngcontent-%COMP%]{max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block}.tags-container[_ngcontent-%COMP%]{display:flex;gap:.25rem;flex-wrap:wrap}.tag[_ngcontent-%COMP%]{padding:.125rem .375rem;background:#3b82f633;border-radius:.25rem;font-size:.7rem;color:#93c5fd}.tag-more[_ngcontent-%COMP%]{padding:.125rem .375rem;background:#4755694d;border-radius:.25rem;font-size:.7rem;color:#94a3b8}.contacted-badge[_ngcontent-%COMP%]{font-size:.75rem}.contacted-badge.yes[_ngcontent-%COMP%]{color:#86efac}.contacted-badge.no[_ngcontent-%COMP%]{color:#94a3b8}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem}.action-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;font-size:.875rem;cursor:pointer;transition:all .2s}.action-btn[_ngcontent-%COMP%]:hover{background:#475569b3}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:#0f172a4d;border-top:1px solid rgba(148,163,184,.1)}.page-info[_ngcontent-%COMP%]{color:#94a3b8;font-size:.875rem}.page-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.page-btn[_ngcontent-%COMP%]{padding:.375rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;font-size:.75rem;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#475569b3}.page-number[_ngcontent-%COMP%]{color:#fff;font-size:.875rem;padding:0 .5rem}.page-size-select[_ngcontent-%COMP%]{padding:.375rem .5rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;color:#fff;font-size:.75rem}.member-detail-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:100}.member-detail-drawer[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:400px;max-width:90vw;height:100vh;background:#1e293b;border-left:1px solid rgba(148,163,184,.1);z-index:101;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%)}to{transform:translate(0)}}.drawer-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.25rem;border-bottom:1px solid rgba(148,163,184,.1)}.drawer-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;color:#fff}.close-btn[_ngcontent-%COMP%]{padding:.375rem;background:#47556980;border:none;border-radius:.375rem;color:#94a3b8;cursor:pointer;font-size:1rem}.close-btn[_ngcontent-%COMP%]:hover{background:#475569cc;color:#fff}.drawer-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.25rem}.detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.section-title[_ngcontent-%COMP%]{font-size:.875rem;color:#94a3b8;margin:0 0 .75rem;display:flex;align-items:center;gap:.375rem}.member-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.profile-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#475569,#334155);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:1.5rem}.profile-avatar.has-photo[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.profile-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.profile-name[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;color:#fff;display:flex;align-items:center;gap:.375rem}.profile-username[_ngcontent-%COMP%]{color:#22d3ee;text-decoration:none;font-size:.875rem}.profile-username[_ngcontent-%COMP%]:hover{text-decoration:underline}.detail-grid[_ngcontent-%COMP%]{display:grid;gap:.75rem}.detail-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.detail-label[_ngcontent-%COMP%]{color:#64748b;font-size:.875rem}.detail-value[_ngcontent-%COMP%]{color:#fff;font-size:.875rem}.detail-value.copyable[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;gap:.375rem}.detail-value.copyable[_ngcontent-%COMP%]:hover{color:#22d3ee}.copy-icon[_ngcontent-%COMP%]{font-size:.75rem;opacity:.5}.status-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.status-tag[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.status-tag.premium[_ngcontent-%COMP%]{background:#f59e0b33;color:#fbbf24}.status-tag.verified[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.status-tag.photo[_ngcontent-%COMP%]{background:#3b82f633;color:#93c5fd}.status-tag.chinese[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.status-tag.danger[_ngcontent-%COMP%]{background:#ef44444d;color:#f87171}.status-tag.deleted[_ngcontent-%COMP%]{background:#4755694d;color:#94a3b8}.bio-text[_ngcontent-%COMP%]{color:#cbd5e1;font-size:.875rem;line-height:1.5;background:#0f172a80;padding:.75rem;border-radius:.5rem;margin:0}.source-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.source-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:#0f172a80;border-radius:.375rem}.source-item[_ngcontent-%COMP%]   .source-name[_ngcontent-%COMP%]{color:#fff;font-size:.875rem}.source-date[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem}.tags-edit[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.tag.editable[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.tag-remove[_ngcontent-%COMP%]{background:none;border:none;color:#64748b;cursor:pointer;font-size:.625rem;padding:0}.tag-remove[_ngcontent-%COMP%]:hover{color:#f87171}.add-tag-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px dashed rgba(148,163,184,.3);border-radius:.25rem;color:#94a3b8;font-size:.75rem;cursor:pointer}.add-tag-btn[_ngcontent-%COMP%]:hover{background:#334155b3;color:#fff}.notes-textarea[_ngcontent-%COMP%]{width:100%;min-height:80px;padding:.75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;resize:vertical}.notes-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.marketing-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.status-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:#0f172a4d;border-radius:.375rem}.status-label[_ngcontent-%COMP%]{color:#64748b;font-size:.875rem}.status-value[_ngcontent-%COMP%]{font-size:.875rem}.status-value.contacted[_ngcontent-%COMP%]{color:#86efac}.status-value.converted[_ngcontent-%COMP%]{color:#c084fc}.drawer-footer[_ngcontent-%COMP%]{padding:1rem 1.25rem;border-top:1px solid rgba(148,163,184,.1);display:flex;gap:.75rem}.drawer-footer[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], .drawer-footer[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{flex:1;justify-content:center}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:200}.dialog[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;max-width:90vw;background:#1e293b;border:1px solid rgba(148,163,184,.2);border-radius:.75rem;z-index:201}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.25rem;border-bottom:1px solid rgba(148,163,184,.1)}.dialog-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff}.dialog-content[_ngcontent-%COMP%]{padding:1.25rem}.tag-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;margin-bottom:1rem}.tag-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.suggested-tags[_ngcontent-%COMP%]{margin-top:1rem}.suggested-title[_ngcontent-%COMP%]{color:#94a3b8;font-size:.75rem;margin:0 0 .5rem}.suggested-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.suggested-tag[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;color:#e2e8f0;font-size:.75rem;cursor:pointer}.suggested-tag[_ngcontent-%COMP%]:hover{background:#06b6d433;border-color:#06b6d466}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.25rem;border-top:1px solid rgba(148,163,184,.1)}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"],changeDetection:0})}};var Kn=class i{constructor(e,t){this.ipcService=e;this.toastService=t;this._isInitialized=f(!1);this._isLoading=f(!1);this._isSearching=f(!1);this._stats=f(null);this._recentKnowledge=f([]);this._learningEvents=f([]);this._searchResults=f([]);this._buildProgress=f(null);this._healthScore=f(0);this._knowledgeGaps=f([]);this._healthReport=f(null);this._guidedQuestion=f(null);this._guidedAnswers=f({});this._lastImportResult=f(null);this._lastError=f(null);this.lastError=R(()=>this._lastError());this._pendingRequests=new Map;this.REQUEST_TIMEOUT=15e3;this._currentRequest=f(null);this._requestStartTime=f(0);this.currentRequest=R(()=>this._currentRequest());this.requestElapsed=R(()=>{let e=this._requestStartTime();return e?Date.now()-e:0});this.isInitialized=R(()=>this._isInitialized());this.isLoading=R(()=>this._isLoading());this.isSearching=R(()=>this._isSearching());this.stats=R(()=>this._stats());this.recentKnowledge=R(()=>this._recentKnowledge());this.learningEvents=R(()=>this._learningEvents());this.searchResults=R(()=>this._searchResults());this.buildProgress=R(()=>this._buildProgress());this.healthScore=R(()=>this._healthScore());this.knowledgeGaps=R(()=>this._knowledgeGaps());this.healthReport=R(()=>this._healthReport());this.guidedQuestion=R(()=>this._guidedQuestion());this.gapsCount=R(()=>this._knowledgeGaps().length);this.totalKnowledge=R(()=>this._stats()?.totalKnowledge||0);this.hitRate=R(()=>{let e=this._stats();return!e||e.totalKnowledge===0?0:Math.round(e.totalUses/Math.max(1,e.totalKnowledge*10)*100)});this.todayLearned=R(()=>this._learningEvents().filter(e=>{let t=new Date().toDateString();return new Date(e.timestamp).toDateString()===t}).length);this.setupEventListeners()}clearLastError(){this._lastError.set(null)}startRequestWithTimeout(e,t=this.REQUEST_TIMEOUT){this.cancelRequest(e),this._currentRequest.set(e),this._requestStartTime.set(Date.now());let n=setTimeout(()=>{console.warn(`[RAGBrain] Request timeout: ${e}`),this._isLoading.set(!1),this._currentRequest.set(null),this._requestStartTime.set(0),this._pendingRequests.delete(e),this.toastService.error(`\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66 (${this.getRequestDisplayName(e)})`),(e==="build"||e==="guided-build")&&this._buildProgress.set(null),e==="search"&&this._searchResults.set([])},t);this._pendingRequests.set(e,n)}getRequestDisplayName(e){return{initialize:"\u521D\u59CB\u5316",search:"\u641C\u7D22",build:"\u69CB\u5EFA\u77E5\u8B58\u5EAB","guided-build":"\u5F15\u5C0E\u5F0F\u69CB\u5EFA","import-url":"\u7DB2\u9801\u5C0E\u5165","import-doc":"\u6587\u6A94\u5C0E\u5165"}[e]||e}getCurrentRequestName(){let e=this._currentRequest();return e?this.getRequestDisplayName(e):""}completeRequest(e){let t=this._pendingRequests.get(e);t&&(clearTimeout(t),this._pendingRequests.delete(e)),this._currentRequest()===e&&(this._currentRequest.set(null),this._requestStartTime.set(0))}cancelRequest(e){let t=this._pendingRequests.get(e);t&&(clearTimeout(t),this._pendingRequests.delete(e)),this._currentRequest()===e&&(this._currentRequest.set(null),this._requestStartTime.set(0))}cancelAllRequests(){this._pendingRequests.forEach(e=>clearTimeout(e)),this._pendingRequests.clear(),this._currentRequest.set(null),this._requestStartTime.set(0)}cancelCurrentRequest(){let e=this._currentRequest();e&&(this.cancelRequest(e),this._isLoading.set(!1),this._buildProgress.set(null),this.toastService.info("\u5DF2\u53D6\u6D88\u8ACB\u6C42"))}setupEventListeners(){this.ipcService.on("rag-initialized",e=>{console.log("[RAGBrain] System initialized:",e),this.completeRequest("initialize"),this._isLoading.set(!1),e.success?(this._isInitialized.set(!0),this.refreshStats(),this.toastService.success("\u{1F9E0} AI \u77E5\u8B58\u5927\u8166\u5DF2\u555F\u52D5")):this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-search-results",e=>{console.log("[RAGBrain] Search results:",e),this.completeRequest("search"),this._isLoading.set(!1),e.success&&e.results?this._searchResults.set(e.results.map(this.mapSearchResult)):e.success||(this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`),this._searchResults.set([]))}),this.ipcService.on("rag-stats-updated",e=>{console.log("[RAGBrain] Stats updated:",e),e.success&&e.stats&&(this._stats.set(this.mapStats(e.stats)),this.calculateHealthScore())}),this.ipcService.on("rag-knowledge-added",e=>{console.log("[RAGBrain] Knowledge added:",e),e.success&&(this.addLearningEvent({type:"new_knowledge",description:`\u6DFB\u52A0\u4E86\u65B0${this.getTypeName(e.knowledgeType)}\u77E5\u8B58`,details:{knowledgeType:e.knowledgeType}}),this.refreshStats())}),this.ipcService.on("rag-auto-learned",e=>{if(console.log("[RAGBrain] Auto learned:",e),e.success&&e.result){let t=e.result,n=(t.qa_extracted||0)+(t.scripts_extracted||0)+(t.objections_extracted||0);n>0&&(this.addLearningEvent({type:"auto_learn",description:`\u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${n} \u689D\u77E5\u8B58`,details:{userId:e.userId,count:n,quality:t.quality_score}}),this.refreshStats(),this.toastService.info(`\u{1F4AC} \u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${n} \u689D\u77E5\u8B58`))}}),this.ipcService.on("rag-build-progress",e=>{console.log("[RAGBrain] Build progress:",e),e.progress&&this._buildProgress.set(e.progress)}),this.ipcService.on("rag-build-complete",e=>{console.log("[RAGBrain] Build complete:",e),this.completeRequest("build"),this._buildProgress.set(null),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u901A\u904E\u5C0D\u8A71\u69CB\u5EFA\u4E86 ${e.totalItems} \u689D\u77E5\u8B58`,details:{count:e.totalItems}}),this.refreshStats(),this._lastImportResult.set({success:!0,totalItems:e.totalItems||0,stats:e.stats||{},source:"conversation"}),this.toastService.success(`\u2728 \u77E5\u8B58\u5927\u8166\u69CB\u5EFA\u5B8C\u6210\uFF01\u5171 ${e.totalItems} \u689D\u77E5\u8B58`)):this.toastService.error(`\u69CB\u5EFA\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-url-imported",e=>{console.log("[RAGBrain] URL imported:",e),this.completeRequest("import-url"),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u5F9E\u7DB2\u9801\u5C0E\u5165\u4E86 ${e.itemsCount} \u689D\u77E5\u8B58`,details:{count:e.itemsCount}}),this.refreshStats(),this.toastService.success(`\u{1F310} \u5DF2\u5F9E\u7DB2\u9801\u5C0E\u5165 ${e.itemsCount} \u689D\u77E5\u8B58`)):e.needsApiKey?(this.toastService.error(`\u26A0\uFE0F ${e.error}`,8e3),this._lastError.set({type:"api_key_missing",message:e.error,action:"configure_ai"})):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-document-imported",e=>{console.log("[RAGBrain] Document imported:",e),this.completeRequest("import-doc"),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u5F9E\u6587\u6A94\u5C0E\u5165\u4E86 ${e.itemsCount} \u689D\u77E5\u8B58`,details:{count:e.itemsCount}}),this.refreshStats(),this.toastService.success(`\u{1F4C4} \u5DF2\u5F9E\u6587\u6A94\u5C0E\u5165 ${e.itemsCount} \u689D\u77E5\u8B58`)):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-gaps-list",e=>{console.log("[RAGBrain] Gaps list:",e),e.success&&e.gaps&&this._knowledgeGaps.set(e.gaps)}),this.ipcService.on("rag-gap-resolved",e=>{console.log("[RAGBrain] Gap resolved:",e),e.success&&(this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e.gapId)),this.toastService.success("\u2705 \u77E5\u8B58\u7F3A\u53E3\u5DF2\u89E3\u6C7A\uFF01"),this.refreshStats())}),this.ipcService.on("rag-gap-ignored",e=>{e.success&&this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e.gapId))}),this.ipcService.on("rag-gap-suggestion",e=>{console.log("[RAGBrain] Gap suggestion:",e),e.success&&e.suggestedAnswer&&this._knowledgeGaps.update(t=>t.map(n=>n.id===e.gapId?P(E({},n),{suggestedAnswer:e.suggestedAnswer}):n))}),this.ipcService.on("rag-health-report",e=>{console.log("[RAGBrain] Health report:",e),e.success&&e.report&&(this._healthReport.set(e.report),this._healthScore.set(e.report.overallScore||0))}),this.ipcService.on("rag-guided-question",e=>{console.log("[RAGBrain] Guided question:",e),this.completeRequest("guided-build"),this._isLoading.set(!1),e.success?this._guidedQuestion.set({step:e.step,totalSteps:e.totalSteps,title:e.title,question:e.question,type:e.type,options:e.options,placeholder:e.placeholder,suggestions:e.suggestions}):this.toastService.error(`\u5F15\u5C0E\u5F0F\u69CB\u5EFA\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-error",e=>{console.error("[RAGBrain] Error event:",e),this.cancelAllRequests(),this._isLoading.set(!1),this._buildProgress.set(null),this.toastService.error(`RAG \u932F\u8AA4: ${e.error||"\u64CD\u4F5C\u5931\u6557"}`)}),this.ipcService.on("backend-status",e=>{e.running||(console.warn("[RAGBrain] Backend disconnected, resetting states"),this.cancelAllRequests(),this._isLoading.set(!1),this._isInitialized.set(!1),this._buildProgress.set(null))})}async initialize(){this._isInitialized()||this._isLoading()||(console.log("[RAGBrain] Initializing..."),this._isLoading.set(!0),this.startRequestWithTimeout("initialize",3e4),this.ipcService.send("rag-initialize",{useChromadb:!0,useNeural:!0}))}refreshStats(){this.ipcService.send("rag-get-stats",{})}search(e,t){this._isLoading()||(this._isLoading.set(!0),this._searchResults.set([]),this.startRequestWithTimeout("search"),this.ipcService.send("rag-search",{query:e,limit:t?.limit||5,knowledgeType:t?.type,minScore:t?.minScore||.3}))}async buildFromConversation(e){this._isLoading()||(this._isLoading.set(!0),this._buildProgress.set({step:1,totalSteps:5,currentAction:"\u5206\u6790\u696D\u52D9\u63CF\u8FF0...",itemsGenerated:0}),this.startRequestWithTimeout("build",12e4),this.ipcService.send("rag-build-from-conversation",e))}importFromUrl(e){this._isLoading()||(this._isLoading.set(!0),this.startRequestWithTimeout("import-url",6e4),this.toastService.info("\u{1F50D} \u6B63\u5728\u89E3\u6790\u7DB2\u9801\u5167\u5BB9..."),this.ipcService.send("rag-import-url",{url:e}))}importFromDocument(e,t){this._isLoading()||(this._isLoading.set(!0),this.startRequestWithTimeout("import-doc",6e4),this.toastService.info("\u{1F4D6} \u6B63\u5728\u89E3\u6790\u6587\u6A94..."),this.ipcService.send("rag-import-document",{filePath:e,fileType:t}))}addKnowledge(e,t,n,o){this.ipcService.send("rag-add-knowledge",{knowledgeType:e,question:t,answer:n,context:o||""})}recordFeedback(e,t){this.ipcService.send("rag-record-feedback",{knowledgeId:e,isPositive:t}),this.addLearningEvent({type:"feedback",description:`\u6536\u5230${t?"\u6B63\u9762":"\u8CA0\u9762"}\u53CD\u994B`,details:{}})}getRecentKnowledge(e=20){this.ipcService.send("rag-get-recent",{limit:e})}cleanupLowQuality(){this.ipcService.send("rag-cleanup",{minScore:.2,minUses:0,daysOld:30})}mergeSimilar(){this.ipcService.send("rag-merge-similar",{similarityThreshold:.9})}getKnowledgeGaps(e=1){this.ipcService.send("rag-get-gaps",{status:"pending",limit:50,minHits:e})}resolveGap(e,t,n,o){this.ipcService.send("rag-resolve-gap",{gapId:e,knowledgeType:t,question:n,answer:o})}ignoreGap(e){this.ipcService.send("rag-ignore-gap",{gapId:e})}deleteGap(e){this.ipcService.send("rag-delete-gap",{gapId:e}),this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e))}deleteGapsBatch(e){this.ipcService.send("rag-delete-gaps-batch",{gapIds:e}),this._knowledgeGaps.update(t=>t.filter(n=>!e.includes(n.id)))}cleanupDuplicateGaps(){this.ipcService.send("rag-cleanup-duplicate-gaps",{}),setTimeout(()=>this.getKnowledgeGaps(),1e3)}suggestGapAnswer(e,t){this.ipcService.send("rag-suggest-gap-answer",{gapId:e,query:t})}getHealthReport(){this.ipcService.send("rag-get-health-report",{})}startGuidedBuild(){this._isLoading()||(this._guidedAnswers.set({}),this._isLoading.set(!0),this.startRequestWithTimeout("guided-build",3e4),this.ipcService.send("rag-start-guided-build",{step:1,answers:{}}))}answerGuidedQuestion(e){let t=this._guidedQuestion();if(!t)return;let n=`step${t.step}`;this._guidedAnswers.update(d=>P(E({},d),{[n]:e}));let o=t.step+1;this._isLoading.set(!0);let a=o>t.totalSteps?12e4:3e4;this.startRequestWithTimeout("guided-build",a),o<=t.totalSteps?this.ipcService.send("rag-start-guided-build",{step:o,answers:this._guidedAnswers()}):(this._guidedQuestion.set(null),this.ipcService.send("rag-start-guided-build",{step:o,answers:this._guidedAnswers()}))}cancelGuidedBuild(){this.cancelRequest("guided-build"),this._guidedQuestion.set(null),this._guidedAnswers.set({}),this._isLoading.set(!1)}addLearningEvent(e){let t=E({id:`event_${Date.now()}`,timestamp:new Date().toISOString()},e);this._learningEvents.update(n=>[t,...n].slice(0,50))}calculateHealthScore(){let e=this._stats();if(!e){this._healthScore.set(0);return}let t=0;t+=Math.min(25,e.totalKnowledge*.5),t+=e.avgScore*25;let n=e.totalUses/Math.max(1,e.totalKnowledge);t+=Math.min(25,n*5);let o=Object.keys(e.byType).length;t+=Math.min(25,o*5),this._healthScore.set(Math.round(t))}mapSearchResult(e){return{item:{id:e.item.id,type:e.item.knowledge_type||e.item.type,question:e.item.question,answer:e.item.answer,context:e.item.context,keywords:e.item.keywords||[],successScore:e.item.success_score||e.item.successScore||.5,useCount:e.item.use_count||e.item.useCount||0,feedbackPositive:e.item.feedback_positive||0,feedbackNegative:e.item.feedback_negative||0,createdAt:e.item.created_at||e.item.createdAt||"",updatedAt:e.item.updated_at||e.item.updatedAt||""},similarity:e.similarity,source:e.source}}mapStats(e){return{totalKnowledge:e.total_knowledge||e.totalKnowledge||0,totalUses:e.total_uses||e.totalUses||0,avgScore:e.avg_score||e.avgScore||0,byType:e.by_type||e.byType||{},vectorCount:e.vector_count||e.vectorCount,chromadbEnabled:e.chromadb_enabled??e.chromadbEnabled??!1,neuralEmbedding:e.neural_embedding??e.neuralEmbedding??!1,learning:e.learning?{sessionsProcessed:e.learning.sessions_processed||0,totalQaExtracted:e.learning.total_qa_extracted||0,totalScriptsExtracted:e.learning.total_scripts_extracted||0,avgQualityScore:e.learning.avg_quality_score||0}:void 0}}getTypeName(e){return{qa:"\u554F\u7B54",script:"\u8A71\u8853",product:"\u7522\u54C1",objection:"\u7570\u8B70\u8655\u7406",greeting:"\u958B\u5834\u767D",closing:"\u6210\u4EA4",faq:"FAQ",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)(Ae(Q),Ae(J))}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}};var vq=(i,e)=>e.item.id,gd=(i,e)=>e.id,xq=(i,e)=>e.message,Cq=(i,e)=>e.name;function bq(i,e){if(i&1){let t=I();r(0,"div",52),x("click",function(){_(t);let o=m(2);return v(o.scrollToGaps())}),r(1,"span",53),l(2,"\u{1F534}"),s(),r(3,"span",54),l(4),s(),r(5,"span",55),l(6,"\u7ACB\u5373\u8655\u7406 \u2192"),s()()}if(i&2){let t=m(2);c(4),M("",t.ragService.gapsCount()," \u500B\u77E5\u8B58\u7F3A\u53E3\u5F85\u8655\u7406")}}function yq(i,e){if(i&1&&(r(0,"div",50)(1,"span",56),l(2,"\u{1F7E1}"),s(),r(3,"span",54),l(4),s(),r(5,"span",55),l(6,"\u512A\u5316 \u2192"),s()()),i&2){let t=m(2);c(4),M("\u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u504F\u4F4E (",t.ragService.healthScore(),"%)")}}function Sq(i,e){if(i&1){let t=I();r(0,"div",57),x("click",function(){_(t);let o=m(2);return v(o.focusBuildInput())}),r(1,"span",58),l(2,"\u{1F7E2}"),s(),r(3,"span",54),l(4,"\u5EFA\u8B70\u6DFB\u52A0\u66F4\u591A\u77E5\u8B58"),s(),r(5,"span",55),l(6,"\u958B\u59CB \u2192"),s()()}}function wq(i,e){if(i&1&&(r(0,"div",45)(1,"div",46)(2,"span",47),l(3,"\u{1F4CC}"),s(),r(4,"span"),l(5,"\u4ECA\u65E5\u5F85\u8FA6"),s()(),r(6,"div",48),y(7,bq,7,1,"div",49),y(8,yq,7,1,"div",50),y(9,Sq,7,0,"div",51),s()()),i&2){let t=m();c(7),S(t.ragService.gapsCount()>0?7:-1),c(),S(t.ragService.healthScore()<60?8:-1),c(),S(t.ragService.totalKnowledge()<10?9:-1)}}function Eq(i,e){if(i&1&&(r(0,"div",19)(1,"div",59),B(2,"div",60),s(),r(3,"div",61),l(4),s()()),i&2){let t=e;c(2),ee("width",t.step/t.totalSteps*100,"%"),c(2),X(" ",t.currentAction," (",t.itemsGenerated," \u689D) ")}}function Dq(i,e){i&1&&(B(0,"span",62),l(1," \u69CB\u5EFA\u4E2D... "))}function Aq(i,e){i&1&&(r(0,"span",14),l(1,"\u2728"),s(),l(2," \u4E00\u9375\u69CB\u5EFA\u77E5\u8B58\u5EAB "))}function Mq(i,e){if(i&1){let t=I();r(0,"button",63),x("click",function(){_(t);let o=m();return v(o.cancelCurrentRequest())}),l(1," \u2715 \u53D6\u6D88 "),s()}}function Tq(i,e){if(i&1){let t=I();r(0,"div",31),B(1,"span",62),l(2," \u6B63\u5728\u641C\u7D22... "),r(3,"button",64),x("click",function(){_(t);let o=m();return v(o.cancelCurrentRequest())}),l(4,"\u53D6\u6D88"),s()()}}function kq(i,e){if(i&1){let t=I();r(0,"div",66)(1,"div",67)(2,"span",68),l(3),s(),r(4,"span",69),l(5),s()(),r(6,"div",70),l(7),s(),r(8,"div",71),l(9),s(),r(10,"div",72)(11,"button",73),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.recordFeedback(o.item.id,!0))}),l(12," \u{1F44D} \u6709\u7528 "),s(),r(13,"button",74),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.recordFeedback(o.item.id,!1))}),l(14," \u{1F44E} \u7121\u7528 "),s()()()}if(i&2){let t=e.$implicit,n=m(2);N("high-match",t.similarity>=.8),c(2),_t("data-type",t.item.type),c(),M(" ",n.getTypeName(t.item.type)," "),c(2),M(" \u5339\u914D\u5EA6: ",(t.similarity*100).toFixed(0),"% "),c(2),D(t.item.question),c(2),D(t.item.answer)}}function Iq(i,e){if(i&1&&O(0,kq,15,7,"div",65,vq),i&2){let t=m();U(t.ragService.searchResults())}}function Fq(i,e){if(i&1){let t=I();r(0,"div",32)(1,"span",14),l(2,"\u{1F50D}"),s(),r(3,"p"),l(4,"\u672A\u627E\u5230\u76F8\u95DC\u77E5\u8B58"),s(),r(5,"button",75),x("click",function(){_(t);let o=m();return v(o.addNewKnowledge())}),l(6,"\u6DFB\u52A0\u9019\u689D\u77E5\u8B58"),s()()}}function Pq(i,e){i&1&&(r(0,"div",33)(1,"span",14),l(2,"\u{1F4A1}"),s(),r(3,"p"),l(4,"\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u7528\u8A9E\u7FA9\u7406\u89E3\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58"),s()())}function Rq(i,e){i&1&&l(0," \u{1F4DA} ")}function Nq(i,e){i&1&&l(0," \u{1F4AC} ")}function Vq(i,e){i&1&&l(0," \u{1F44D} ")}function Bq(i,e){i&1&&l(0," \u{1F4C8} ")}function Lq(i,e){if(i&1&&(r(0,"div",76)(1,"div",77),y(2,Rq,1,0)(3,Nq,1,0)(4,Vq,1,0)(5,Bq,1,0),s(),r(6,"div",78)(7,"div",79),l(8),s(),r(9,"div",80),l(10),s()()()),i&2){let t,n=e.$implicit,o=m(2);_t("data-type",n.type),c(2),S((t=n.type)==="new_knowledge"?2:t==="auto_learn"?3:t==="feedback"?4:t==="quality_update"?5:-1),c(6),D(n.description),c(2),D(o.formatTime(n.timestamp))}}function Oq(i,e){if(i&1&&O(0,Lq,11,4,"div",76,gd),i&2){let t=m();U(t.ragService.learningEvents().slice(0,10))}}function Uq(i,e){i&1&&(r(0,"div",37)(1,"p"),l(2,"\u7B49\u5F85\u5B78\u7FD2\u4E8B\u4EF6..."),s(),r(3,"p",81),l(4,"AI \u6703\u5F9E\u5C0D\u8A71\u4E2D\u81EA\u52D5\u5B78\u7FD2"),s()())}function Gq(i,e){if(i&1){let t=I();r(0,"button",91),x("click",function(){_(t);let o=m(2);return v(o.deleteSelectedGaps())}),l(1),s()}if(i&2){let t=m(2);c(),M(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedGapIds().length,") ")}}function $q(i,e){i&1&&(r(0,"span",99),l(1,"\u{1F525} \u71B1\u9580"),s())}function Hq(i,e){if(i&1&&(r(0,"span",107),l(1),s()),i&2){let t=m().$implicit,n=m(2);de("cat-"+t.category),c(),M(" ",n.getCategoryLabel(t.category)," ")}}function qq(i,e){if(i&1&&(r(0,"div",102)(1,"span",108),l(2,"\u{1F4A1} AI:"),s(),r(3,"span",109),l(4),s()()),i&2){let t=m().$implicit;c(4),D(t.suggestedAnswer.length>80?t.suggestedAnswer.slice(0,80)+"...":t.suggestedAnswer)}}function Wq(i,e){if(i&1){let t=I();r(0,"button",110),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.suggestAnswer(o))}),l(1," \u{1F916} \u751F\u6210 "),s()}}function zq(i,e){if(i&1){let t=I();r(0,"div",92)(1,"div",93)(2,"input",94),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleGapSelection(o.id))}),s()(),r(3,"div",95)(4,"div",96)(5,"span",97),l(6),s(),r(7,"div",98),y(8,$q,2,0,"span",99),y(9,Hq,2,3,"span",100),r(10,"span",101),l(11),s()()(),y(12,qq,5,1,"div",102),r(13,"div",103),y(14,Wq,2,0,"button",104),r(15,"button",105),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.resolveGap(o))}),l(16," \u2705 \u63A1\u7528 "),s(),r(17,"button",106),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteGap(o))}),l(18," \u{1F5D1}\uFE0F "),s()()()()}if(i&2){let t=e.$implicit,n=m(2);N("selected",n.isGapSelected(t.id)),c(2),L("checked",n.isGapSelected(t.id)),c(3),L("title",t.query),c(),M(" ",t.query.length>60?t.query.slice(0,60)+"...":t.query," "),c(2),S(t.hitCount>=5?8:-1),c(),S(t.category?9:-1),c(2),M("",t.hitCount,"\u6B21"),c(),S(t.suggestedAnswer?12:-1),c(2),S(t.suggestedAnswer?-1:14)}}function Kq(i,e){if(i&1&&(r(0,"div",90)(1,"span"),l(2),s()()),i&2){let t=m(2);c(2),M("\u9084\u6709 ",t.ragService.gapsCount()-15," \u689D\u672A\u986F\u793A")}}function jq(i,e){if(i&1){let t=I();r(0,"div",41)(1,"div",82)(2,"h3",13)(3,"span",14),l(4,"\u{1F514}"),s(),l(5," \u77E5\u8B58\u7F3A\u53E3 "),r(6,"span",83),l(7),s()(),r(8,"div",84)(9,"button",85),x("click",function(){_(t);let o=m();return v(o.cleanupDuplicateGaps())}),l(10," \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 "),s(),y(11,Gq,2,1,"button",86),s()(),r(12,"p",87),l(13,"\u{1F4A1} \u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u597D\u7B54\u6848\u7684\u554F\u984C\uFF0C\u5EFA\u8B70\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C"),s(),r(14,"div",88),O(15,zq,19,10,"div",89,gd),s(),y(17,Kq,3,1,"div",90),s()}if(i&2){let t=m();c(7),M("(",t.ragService.gapsCount(),")"),c(4),S(t.selectedGapIds().length>0?11:-1),c(4),U(t.ragService.knowledgeGaps().slice(0,15)),c(2),S(t.ragService.gapsCount()>15?17:-1)}}function Jq(i,e){i&1&&(r(0,"div",42)(1,"span",111),l(2,"\u2728"),s(),r(3,"p"),l(4,"\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u66AB\u7121\u77E5\u8B58\u7F3A\u53E3"),s()())}function Qq(i,e){if(i&1&&(r(0,"div",124)(1,"span",125),l(2),s(),l(3),s()),i&2){let t=e.$implicit;_t("data-priority",t.priority),c(2),D(t.priority==="high"?"\u{1F534}":t.priority==="medium"?"\u{1F7E1}":"\u{1F7E2}"),c(),M(" ",t.message," ")}}function Yq(i,e){if(i&1&&(r(0,"div",123)(1,"h4"),l(2,"\u{1F4A1} \u512A\u5316\u5EFA\u8B70"),s(),O(3,Qq,4,3,"div",124,xq),s()),i&2){let t=m(2);c(3),U(t.suggestions)}}function Xq(i,e){if(i&1&&(r(0,"div",112)(1,"h3",13)(2,"span",14),l(3,"\u{1F4CA}"),s(),l(4," \u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u5831\u544A "),s(),r(5,"div",113)(6,"div",114)(7,"span",115),l(8),s(),r(9,"span",116),l(10,"\u7E3D\u5206"),s()(),r(11,"div",117)(12,"div",118)(13,"span",119),l(14,"\u5B8C\u6574\u6027"),s(),r(15,"div",120),B(16,"div",121),s(),r(17,"span",122),l(18),s()(),r(19,"div",118)(20,"span",119),l(21,"\u6548\u679C"),s(),r(22,"div",120),B(23,"div",121),s(),r(24,"span",122),l(25),s()(),r(26,"div",118)(27,"span",119),l(28,"\u6642\u6548\u6027"),s(),r(29,"div",120),B(30,"div",121),s(),r(31,"span",122),l(32),s()()()(),y(33,Yq,5,0,"div",123),s()),i&2){let t=m();c(6),N("healthy",t.overallScore>=70)("warning",t.overallScore>=40&&t.overallScore<70)("danger",t.overallScore<40),c(2),D(t.overallScore),c(8),ee("width",(t.completeness==null?null:t.completeness.score)||0,"%"),c(2),M("",(t.completeness==null?null:t.completeness.score)||0,"%"),c(5),ee("width",(t.effectiveness==null?null:t.effectiveness.score)||0,"%"),c(2),M("",(t.effectiveness==null?null:t.effectiveness.score)||0,"%"),c(5),ee("width",(t.freshness==null?null:t.freshness.score)||0,"%"),c(2),M("",(t.freshness==null?null:t.freshness.score)||0,"%"),c(),S(t.suggestions&&t.suggestions.length>0?33:-1)}}function Zq(i,e){i&1&&y(0,Xq,34,17,"div",112),i&2&&S(e.overallScore!==void 0?0:-1)}function eW(i,e){if(i&1&&(r(0,"div",127)(1,"div",128),l(2),s(),r(3,"div",129)(4,"span",130),l(5),s(),r(6,"span",131),l(7),s()(),r(8,"div",132),B(9,"div",121),s()()),i&2){let t=e.$implicit,n=m(),o=m();c(2),D(t.name),c(3),M("",t.count," \u689D"),c(2),M("\u8A55\u5206: ",t.avgScore),c(2),ee("width",t.count/n.totalKnowledge*100,"%")("background",o.getTypeColor(t.key))}}function tW(i,e){if(i&1&&(r(0,"div",43)(1,"h3"),l(2,"\u77E5\u8B58\u5206\u5E03"),s(),r(3,"div",126),O(4,eW,10,7,"div",127,Cq),s()()),i&2){let t=m();c(4),U(t.getStatTypes(e.byType))}}function nW(i,e){if(i&1){let t=I();r(0,"button",145),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.guidedAnswer=o.id)}),l(1),s()}if(i&2){let t=e.$implicit,n=m(3);N("selected",n.guidedAnswer===t.id),c(),M(" ",t.label," ")}}function iW(i,e){if(i&1&&(r(0,"div",139),O(1,nW,2,3,"button",144,gd),s()),i&2){let t=m();c(),U(t.options)}}function oW(i,e){if(i&1){let t=I();r(0,"button",145),x("click",function(){let o=_(t).$implicit,a=m(3);return v(a.toggleOption(o.id))}),l(1),s()}if(i&2){let t=e.$implicit,n=m(3);N("selected",n.isOptionSelected(t.id)),c(),M(" ",t.label," ")}}function rW(i,e){if(i&1&&(r(0,"div",140),O(1,oW,2,3,"button",144,gd),s()),i&2){let t=m();c(),U(t.options)}}function sW(i,e){if(i&1){let t=I();r(0,"button",150),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.addSuggestion(o))}),l(1),s()}if(i&2){let t=e.$implicit;c(),D(t)}}function aW(i,e){if(i&1&&(r(0,"div",147)(1,"span",148),l(2,"\u5E38\u898B:"),s(),O(3,sW,2,1,"button",149,be),s()),i&2){let t=m(2);c(3),U(t.suggestions)}}function lW(i,e){if(i&1){let t=I();r(0,"textarea",146),W("ngModelChange",function(o){_(t);let a=m(2);return q(a.guidedAnswer,o)||(a.guidedAnswer=o),v(o)}),s(),y(1,aW,5,0,"div",147)}if(i&2){let t=m(),n=m();H("ngModel",n.guidedAnswer),L("placeholder",t.placeholder||""),c(),S(t.suggestions&&t.suggestions.length?1:-1)}}function cW(i,e){i&1&&l(0," \u4E0B\u4E00\u6B65 \u2192 ")}function dW(i,e){i&1&&l(0," \u958B\u59CB\u69CB\u5EFA \u2728 ")}function uW(i,e){if(i&1){let t=I();r(0,"div",44)(1,"div",133)(2,"div",134)(3,"span",135),l(4),s(),r(5,"h3"),l(6),s(),r(7,"button",136),x("click",function(){_(t);let o=m();return v(o.cancelGuidedBuild())}),l(8,"\u2715"),s()(),r(9,"div",137)(10,"p",138),l(11),s(),y(12,iW,3,0,"div",139)(13,rW,3,0,"div",140)(14,lW,2,3),s(),r(15,"div",141)(16,"button",142),x("click",function(){_(t);let o=m();return v(o.cancelGuidedBuild())}),l(17,"\u53D6\u6D88"),s(),r(18,"button",143),x("click",function(){_(t);let o=m();return v(o.submitGuidedAnswer())}),y(19,cW,1,0)(20,dW,1,0),s()()()()}if(i&2){let t,n=e,o=m();c(4),X("\u6B65\u9A5F ",n.step," / ",n.totalSteps),c(2),D(n.title),c(5),D(n.question),c(),S((t=n.type)==="select"?12:t==="multiselect"?13:t==="textarea"?14:-1),c(6),L("disabled",!o.guidedAnswer||o.ragService.isLoading()),c(),S(n.step<n.totalSteps?19:20)}}var pd=class i{constructor(){this.ragService=F(Kn);this.dialogService=F(st);this.toastService=F(J);this.businessDescription="";this.searchQuery="";this.guidedAnswer="";this.selectedOptions=[];this.selectedGapIds=f([])}ngOnInit(){this.ragService.initialize(),this.ragService.refreshStats(),this.ragService.getKnowledgeGaps(),this.ragService.getHealthReport()}isGapSelected(e){return this.selectedGapIds().includes(e)}toggleGapSelection(e){let t=this.selectedGapIds();t.includes(e)?this.selectedGapIds.set(t.filter(n=>n!==e)):this.selectedGapIds.set([...t,e])}deleteSelectedGaps(){let e=this.selectedGapIds();e.length!==0&&(this.ragService.deleteGapsBatch(e),this.selectedGapIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D\u7F3A\u53E3`))}getCategoryLabel(e){return{price:"\u{1F4B0} \u50F9\u683C",process:"\u{1F4CB} \u6D41\u7A0B",product:"\u{1F4E6} \u7522\u54C1",support:"\u{1F6E0}\uFE0F \u552E\u5F8C",other:"\u2753 \u5176\u4ED6"}[e]||e}hasPendingTasks(){return this.ragService.gapsCount()>0||this.ragService.healthScore()<60||this.ragService.totalKnowledge()<10}scrollToGaps(){let e=document.querySelector(".gaps-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}focusBuildInput(){let e=document.querySelector(".build-textarea");e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}))}async startBuild(){this.businessDescription.trim()&&await this.ragService.buildFromConversation({businessDescription:this.businessDescription})}importFromUrl(){this.ragService.lastError()?.type==="api_key_missing"&&this.ragService.clearLastError?.(),this.dialogService.prompt({title:"\u5F9E\u7DB2\u9801\u5C0E\u5165\u77E5\u8B58",message:`\u8F38\u5165\u7DB2\u9801 URL\uFF0CAI \u6703\u81EA\u52D5\u63D0\u53D6\u77E5\u8B58\uFF1A

\u{1F4A1} \u63D0\u793A\uFF1A\u9700\u8981\u5148\u5728\u300CAI \u4E2D\u5FC3\u300D\u2192\u300C\u6A21\u578B\u8A2D\u5B9A\u300D\u914D\u7F6E AI API Key`,placeholder:"https://example.com/about",confirmText:"\u5C0E\u5165",onConfirm:t=>{t&&this.ragService.importFromUrl(t)}})}importFromDocument(){let e=document.createElement("input");e.type="file",e.accept=".txt,.pdf,.doc,.docx",e.onchange=t=>{let n=t.target.files?.[0];if(n){let o=n.name.split(".").pop()||"";this.toastService.info(`\u9078\u64C7\u4E86\u6587\u4EF6: ${n.name}\uFF0C\u6B63\u5728\u8655\u7406...`)}},e.click()}openTemplateSelector(){this.dialogService.prompt({title:"\u9078\u64C7\u884C\u696D\u6A21\u677F",message:"\u8F38\u5165\u884C\u696D\u985E\u578B\uFF08payment/ecommerce/education/realestate/finance/healthcare/travel/legal\uFF09\uFF1A",placeholder:"payment",confirmText:"\u61C9\u7528",onConfirm:e=>{e&&this.toastService.info(`\u6B63\u5728\u61C9\u7528\u300C${e}\u300D\u6A21\u677F...`)}})}search(){this.searchQuery.trim()&&this.ragService.search(this.searchQuery)}recordFeedback(e,t){this.ragService.recordFeedback(e,t),this.toastService.success(t?"\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF01":"\u5DF2\u8A18\u9304\uFF0C\u6211\u5011\u6703\u6539\u9032")}addNewKnowledge(){this.dialogService.prompt({title:"\u6DFB\u52A0\u65B0\u77E5\u8B58",message:"\u8F38\u5165\u56DE\u7B54\u5167\u5BB9\uFF1A",placeholder:"\u5C08\u696D\u7684\u56DE\u7B54...",confirmText:"\u6DFB\u52A0",onConfirm:e=>{e&&this.ragService.addKnowledge("qa",this.searchQuery,e)}})}cleanupKnowledge(){this.dialogService.confirm({title:"\u6E05\u7406\u4F4E\u8CEA\u91CF\u77E5\u8B58",message:"\u5C07\u522A\u9664\u8A55\u5206\u4F4E\u65BC 0.2 \u4E14\u672A\u88AB\u4F7F\u7528\u7684\u820A\u77E5\u8B58\uFF0C\u78BA\u8A8D\u7E7C\u7E8C\uFF1F",confirmText:"\u6E05\u7406",type:"warning",onConfirm:()=>{this.ragService.cleanupLowQuality(),this.toastService.info("\u6B63\u5728\u6E05\u7406...")}})}mergeKnowledge(){this.ragService.mergeSimilar(),this.toastService.info("\u6B63\u5728\u5408\u4F75\u76F8\u4F3C\u77E5\u8B58...")}refreshStats(){this.ragService.refreshStats(),this.toastService.success("\u5DF2\u5237\u65B0\u7D71\u8A08")}cancelCurrentRequest(){this.ragService.cancelCurrentRequest()}getTypeName(e){return{qa:"\u554F\u7B54",script:"\u8A71\u8853",product:"\u7522\u54C1",objection:"\u7570\u8B70\u8655\u7406",greeting:"\u958B\u5834\u767D",closing:"\u6210\u4EA4",faq:"FAQ",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}getTypeColor(e){return{"Q&A \u554F\u7B54":"#667eea",\u6210\u529F\u8A71\u8853:"#10b981",\u7522\u54C1\u4FE1\u606F:"#f59e0b",\u7570\u8B70\u8655\u7406:"#ef4444",\u958B\u5834\u767D:"#8b5cf6",\u6210\u4EA4\u8A71\u8853:"#06b6d4",FAQ:"#ec4899",\u81EA\u5B9A\u7FA9:"#6b7280"}[e]||"#667eea"}getStatTypes(e){return Object.entries(e||{}).map(([t,n])=>({key:t,name:t,count:n.count||0,avgScore:n.avg_score||n.avgScore||0}))}formatTime(e){let t=new Date(e),o=new Date().getTime()-t.getTime();return o<6e4?"\u525B\u525B":o<36e5?`${Math.floor(o/6e4)} \u5206\u9418\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u6642\u524D`:t.toLocaleDateString("zh-TW")}suggestAnswer(e){this.ragService.suggestGapAnswer(e.id,e.query),this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...")}resolveGap(e){let t=e.suggestedAnswer||"";this.dialogService.prompt({title:"\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",message:`\u554F\u984C: "${e.query}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,placeholder:t||"\u5C08\u696D\u7684\u56DE\u7B54...",defaultValue:t,confirmText:"\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",onConfirm:n=>{n&&this.ragService.resolveGap(e.id,"faq",e.query,n)}})}ignoreGap(e){this.ragService.ignoreGap(e.id)}deleteGap(e){this.ragService.deleteGap(e.id),this.toastService.success("\u5DF2\u522A\u9664")}cleanupDuplicateGaps(){this.ragService.cleanupDuplicateGaps(),this.toastService.info("\u6B63\u5728\u6E05\u7406\u91CD\u8907\u7F3A\u53E3...")}startGuidedBuild(){this.guidedAnswer="",this.selectedOptions=[],this.ragService.startGuidedBuild()}isOptionSelected(e){return this.selectedOptions.includes(e)}toggleOption(e){this.selectedOptions.includes(e)?this.selectedOptions=this.selectedOptions.filter(t=>t!==e):this.selectedOptions.push(e),this.guidedAnswer=this.selectedOptions}addSuggestion(e){typeof this.guidedAnswer=="string"&&(this.guidedAnswer=this.guidedAnswer?`${this.guidedAnswer}
${e}`:e)}submitGuidedAnswer(){this.ragService.answerGuidedQuestion(this.guidedAnswer),this.guidedAnswer="",this.selectedOptions=[]}cancelGuidedBuild(){this.ragService.cancelGuidedBuild(),this.guidedAnswer="",this.selectedOptions=[]}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-brain"]],decls:106,vars:20,consts:[[1,"ai-brain-container"],["class","task-banner",4,"ngIf"],[1,"brain-header"],[1,"brain-title"],[1,"brain-icon"],[1,"version-badge"],[1,"brain-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],[1,"stat-item","health"],[1,"brain-content"],[1,"build-section"],[1,"section-title"],[1,"icon"],[1,"conversation-builder"],[1,"chat-bubble","ai"],[1,"bubble-content"],["placeholder","\u4F8B\u5982\uFF1A\u6211\u662F\u505A\u8DE8\u5883\u652F\u4ED8\u7684\uFF0C\u4E3B\u8981\u5E6B\u5BA2\u6236\u514C\u63DB USDT\uFF0C\u532F\u7387\u6BD4\u5E02\u5834\u9AD8 0.5%\uFF0C10 \u5206\u9418\u5230\u8CEC...","rows","4",1,"business-input",3,"ngModelChange","ngModel"],[1,"build-progress"],[1,"build-btn",3,"click","disabled"],[1,"cancel-request-btn"],[1,"quick-import"],[1,"import-buttons"],[1,"import-btn","guided",3,"click"],[1,"import-btn",3,"click"],[1,"search-section"],[1,"search-box"],["type","text","placeholder","\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58...",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-btn",3,"click","disabled"],[1,"search-results"],[1,"loading-state"],[1,"empty-state"],[1,"placeholder-state"],[1,"learning-section"],[1,"live-badge"],[1,"learning-feed"],[1,"empty-learning"],[1,"maintenance-section"],[1,"maintenance-buttons"],[1,"maint-btn",3,"click"],[1,"gaps-section"],[1,"gaps-empty"],[1,"knowledge-distribution"],[1,"guided-overlay"],[1,"task-banner"],[1,"task-title"],[1,"task-icon"],[1,"task-list"],[1,"task-item","priority-high"],[1,"task-item","priority-medium"],[1,"task-item","priority-low"],[1,"task-item","priority-high",3,"click"],[1,"task-badge","high"],[1,"task-text"],[1,"task-action"],[1,"task-badge","medium"],[1,"task-item","priority-low",3,"click"],[1,"task-badge","low"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"spinner"],[1,"cancel-request-btn",3,"click"],[1,"cancel-link",3,"click"],[1,"result-card",3,"high-match"],[1,"result-card"],[1,"result-header"],[1,"type-badge"],[1,"similarity"],[1,"result-question"],[1,"result-answer"],[1,"result-actions"],[1,"action-btn","positive",3,"click"],[1,"action-btn","negative",3,"click"],[1,"add-btn",3,"click"],[1,"learning-event"],[1,"event-icon"],[1,"event-content"],[1,"event-desc"],[1,"event-time"],[1,"hint"],[1,"gaps-header"],[1,"gap-count"],[1,"gaps-actions-bar"],["title","\u4E00\u9375\u6E05\u7406\u6240\u6709\u5783\u573E\u6578\u64DA",1,"batch-btn","cleanup",3,"click"],[1,"batch-btn","delete-selected"],[1,"gaps-hint"],[1,"gaps-list"],[1,"gap-card",3,"selected"],[1,"gaps-more"],[1,"batch-btn","delete-selected",3,"click"],[1,"gap-card"],[1,"gap-select"],["type","checkbox",3,"change","checked"],[1,"gap-main"],[1,"gap-top"],[1,"gap-query",3,"title"],[1,"gap-tags"],[1,"tag","hot"],[1,"tag","category",3,"class"],[1,"tag","hits"],[1,"gap-suggestion"],[1,"gap-actions"],["title","\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848",1,"gap-btn","suggest"],["title","\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",1,"gap-btn","resolve",3,"click"],["title","\u76F4\u63A5\u522A\u9664",1,"gap-btn","delete",3,"click"],[1,"tag","category"],[1,"suggestion-label"],[1,"suggestion-text"],["title","\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848",1,"gap-btn","suggest",3,"click"],[1,"empty-icon"],[1,"health-dashboard"],[1,"health-overview"],[1,"health-score-circle"],[1,"score-value"],[1,"score-label"],[1,"health-metrics"],[1,"metric"],[1,"metric-label"],[1,"metric-bar"],[1,"bar-fill"],[1,"metric-value"],[1,"health-suggestions"],[1,"suggestion-item"],[1,"priority-badge"],[1,"distribution-grid"],[1,"type-card"],[1,"type-name"],[1,"type-stats"],[1,"count"],[1,"score"],[1,"type-bar"],[1,"guided-dialog"],[1,"guided-header"],[1,"step-indicator"],[1,"close-btn",3,"click"],[1,"guided-content"],[1,"question-text"],[1,"options-grid"],[1,"options-grid","multi"],[1,"guided-footer"],[1,"cancel-btn",3,"click"],[1,"next-btn",3,"click","disabled"],[1,"option-btn",3,"selected"],[1,"option-btn",3,"click"],[1,"guided-textarea",3,"ngModelChange","ngModel","placeholder"],[1,"suggestions"],[1,"label"],[1,"suggestion-chip"],[1,"suggestion-chip",3,"click"]],template:function(t,n){if(t&1&&(r(0,"div",0),Es(1,wq,10,3,"div",1),r(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F9E0}"),s(),r(6,"span"),l(7,"AI \u77E5\u8B58\u5927\u8166"),s(),r(8,"span",5),l(9,"2.0"),s()(),r(10,"div",6)(11,"div",7)(12,"span",8),l(13),s(),r(14,"span",9),l(15,"\u77E5\u8B58\u7E3D\u6578"),s()(),r(16,"div",7)(17,"span",8),l(18),s(),r(19,"span",9),l(20,"\u547D\u4E2D\u7387"),s()(),r(21,"div",7)(22,"span",8),l(23),s(),r(24,"span",9),l(25,"\u4ECA\u65E5\u5B78\u7FD2"),s()(),r(26,"div",10)(27,"span",8),l(28),s(),r(29,"span",9),l(30,"\u5065\u5EB7\u5EA6"),s()()()(),r(31,"div",11)(32,"div",12)(33,"h3",13)(34,"span",14),l(35,"\u{1F4AC}"),s(),l(36," \u5C0D\u8A71\u5F0F\u77E5\u8B58\u69CB\u5EFA "),s(),r(37,"div",15)(38,"div",16)(39,"div",17),l(40," \u544A\u8A34\u6211\u4F60\u7684\u696D\u52D9\uFF0C\u6211\u4F86\u5E6B\u4F60\u69CB\u5EFA\u77E5\u8B58\u5EAB... "),s()(),r(41,"textarea",18),W("ngModelChange",function(a){return q(n.businessDescription,a)||(n.businessDescription=a),a}),s(),y(42,Eq,5,4,"div",19),r(43,"button",20),x("click",function(){return n.startBuild()}),y(44,Dq,2,0)(45,Aq,3,0),s(),y(46,Mq,2,0,"button",21),s(),r(47,"div",22)(48,"h4"),l(49,"\u6216\u8005\u5FEB\u901F\u5C0E\u5165"),s(),r(50,"div",23)(51,"button",24),x("click",function(){return n.startGuidedBuild()}),r(52,"span",14),l(53,"\u{1F3AF}"),s(),l(54," \u5F15\u5C0E\u5F0F\u69CB\u5EFA (\u63A8\u85A6) "),s(),r(55,"button",25),x("click",function(){return n.importFromUrl()}),r(56,"span",14),l(57,"\u{1F310}"),s(),l(58," \u5F9E\u7DB2\u9801\u5C0E\u5165 "),s(),r(59,"button",25),x("click",function(){return n.importFromDocument()}),r(60,"span",14),l(61,"\u{1F4C4}"),s(),l(62," \u4E0A\u50B3\u6587\u6A94 "),s(),r(63,"button",25),x("click",function(){return n.openTemplateSelector()}),r(64,"span",14),l(65,"\u{1F4DA}"),s(),l(66," \u884C\u696D\u6A21\u677F "),s()()()(),r(67,"div",26)(68,"h3",13)(69,"span",14),l(70,"\u{1F50D}"),s(),l(71," \u8A9E\u7FA9\u641C\u7D22 "),s(),r(72,"div",27)(73,"input",28),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),x("keyup.enter",function(){return n.search()}),s(),r(74,"button",29),x("click",function(){return n.search()}),l(75," \u641C\u7D22 "),s()(),r(76,"div",30),y(77,Tq,5,0,"div",31)(78,Iq,2,0)(79,Fq,7,0,"div",32)(80,Pq,5,0,"div",33),s()(),r(81,"div",34)(82,"h3",13)(83,"span",14),l(84,"\u{1F534}"),s(),r(85,"span",35),l(86,"LIVE"),s(),l(87," \u5BE6\u6642\u5B78\u7FD2 "),s(),r(88,"div",36),y(89,Oq,2,0)(90,Uq,5,0,"div",37),s(),r(91,"div",38)(92,"h4"),l(93,"\u77E5\u8B58\u7DAD\u8B77"),s(),r(94,"div",39)(95,"button",40),x("click",function(){return n.cleanupKnowledge()}),l(96," \u{1F9F9} \u6E05\u7406\u4F4E\u8CEA\u91CF "),s(),r(97,"button",40),x("click",function(){return n.mergeKnowledge()}),l(98," \u{1F504} \u5408\u4F75\u76F8\u4F3C "),s(),r(99,"button",40),x("click",function(){return n.refreshStats()}),l(100," \u{1F4CA} \u5237\u65B0\u7D71\u8A08 "),s()()()()(),y(101,jq,18,3,"div",41)(102,Jq,5,0,"div",42),y(103,Zq,1,1),y(104,tW,6,0,"div",43),y(105,uW,21,7,"div",44),s()),t&2){let o,a,d,u;c(),L("ngIf",n.hasPendingTasks()),c(12),D(n.ragService.totalKnowledge()),c(5),M("",n.ragService.hitRate(),"%"),c(5),M("+",n.ragService.todayLearned()),c(3),N("healthy",n.ragService.healthScore()>=70),c(2),M("",n.ragService.healthScore(),"%"),c(13),H("ngModel",n.businessDescription),c(),S((o=n.ragService.buildProgress())?42:-1,o),c(),L("disabled",!n.businessDescription||n.ragService.isLoading()),c(),S(n.ragService.isLoading()&&n.ragService.currentRequest()==="build"?44:45),c(2),S(n.ragService.isLoading()&&n.ragService.currentRequest()==="build"?46:-1),c(27),H("ngModel",n.searchQuery),c(),L("disabled",!n.searchQuery),c(3),S(n.ragService.isLoading()&&n.ragService.currentRequest()==="search"?77:n.ragService.searchResults().length>0?78:n.searchQuery&&!n.ragService.isLoading()?79:80),c(12),S(n.ragService.learningEvents().length>0?89:90),c(12),S(n.ragService.knowledgeGaps().length>0?101:102),c(2),S((a=n.ragService.healthReport())?103:-1,a),c(),S((d=n.ragService.stats())?104:-1,d),c(),S((u=n.ragService.guidedQuestion())?105:-1,u)}},dependencies:[oe,hr,ae,xe,ve,he],styles:[".ai-brain-container[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.task-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#a855f726,#3b82f626);border:1px solid rgba(168,85,247,.3);border-radius:16px;padding:16px 20px;margin-bottom:20px}.task-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:16px;font-weight:600;color:#e0e0e0;margin-bottom:12px}.task-icon[_ngcontent-%COMP%]{font-size:18px}.task-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.task-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 14px;background:#0000004d;border-radius:10px;cursor:pointer;transition:all .2s}.task-item[_ngcontent-%COMP%]:hover{background:#00000080;transform:translate(4px)}.task-badge[_ngcontent-%COMP%]{font-size:12px}.task-text[_ngcontent-%COMP%]{flex:1;font-size:14px;color:#ccc}.task-action[_ngcontent-%COMP%]{font-size:12px;color:#a855f7;font-weight:500}.task-item.priority-high[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#f87171}.task-item.priority-medium[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#fbbf24}.task-item.priority-low[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#34d399}.brain-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding:16px 24px;background:#ffffff0d;border-radius:16px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.brain-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700}.brain-icon[_ngcontent-%COMP%]{font-size:32px}.version-badge[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600}.brain-stats[_ngcontent-%COMP%]{display:flex;gap:32px}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-value[_ngcontent-%COMP%]{display:block;font-size:24px;font-weight:700;color:#667eea}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-item.health[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f59e0b}.stat-item.health.healthy[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#10b981}.brain-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:24px;margin-bottom:24px}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px;font-size:16px;font-weight:600}.live-badge[_ngcontent-%COMP%]{background:#ef4444;padding:2px 8px;border-radius:4px;font-size:10px;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.build-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.conversation-builder[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.chat-bubble.ai[_ngcontent-%COMP%]{background:#667eea33;padding:12px 16px;border-radius:16px 16px 16px 4px;font-size:14px}.business-input[_ngcontent-%COMP%]{background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;color:#fff;font-size:14px;resize:none}.business-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.build-progress[_ngcontent-%COMP%]{padding:12px;background:#667eea1a;border-radius:8px}.progress-bar[_ngcontent-%COMP%]{height:4px;background:#ffffff1a;border-radius:2px;overflow:hidden;margin-bottom:8px}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);transition:width .3s}.progress-text[_ngcontent-%COMP%]{font-size:12px;color:#888}.build-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s}.build-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 20px #667eea66}.build-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.quick-import[_ngcontent-%COMP%]{margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,.1)}.quick-import[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:12px}.import-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.import-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 14px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:13px;cursor:pointer;transition:all .2s}.import-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#667eea}.import-btn.guided[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea33,#764ba233);border-color:#667eea}.search-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.search-box[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:12px 16px;background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:14px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.search-btn[_ngcontent-%COMP%]{padding:12px 20px;background:#667eea;border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer}.search-btn[_ngcontent-%COMP%]:disabled{opacity:.5}.search-results[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.result-card[_ngcontent-%COMP%]{background:#0003;border:1px solid rgba(255,255,255,.05);border-radius:12px;padding:14px;margin-bottom:12px}.result-card.high-match[_ngcontent-%COMP%]{border-color:#10b981}.result-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.type-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;background:#667eea33;color:#667eea}.similarity[_ngcontent-%COMP%]{font-size:12px;color:#10b981}.result-question[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px;font-size:14px}.result-answer[_ngcontent-%COMP%]{font-size:13px;color:#aaa;line-height:1.5}.result-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:12px}.action-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;transition:all .2s}.action-btn.positive[_ngcontent-%COMP%]{background:#10b9811a;border:1px solid rgba(16,185,129,.3);color:#10b981}.action-btn.negative[_ngcontent-%COMP%]{background:#ef44441a;border:1px solid rgba(239,68,68,.3);color:#ef4444}.action-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.empty-state[_ngcontent-%COMP%], .placeholder-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#888}.empty-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .placeholder-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px}.add-btn[_ngcontent-%COMP%]{margin-top:12px;padding:10px 20px;background:#667eea;border:none;border-radius:8px;color:#fff;cursor:pointer}.learning-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.learning-feed[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.learning-event[_ngcontent-%COMP%]{display:flex;gap:12px;padding:10px;background:#0003;border-radius:8px;margin-bottom:8px}.event-icon[_ngcontent-%COMP%]{font-size:20px}.event-desc[_ngcontent-%COMP%]{font-size:13px}.event-time[_ngcontent-%COMP%]{font-size:11px;color:#666}.empty-learning[_ngcontent-%COMP%]{text-align:center;padding:30px;color:#666}.empty-learning[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:12px;color:#555}.maintenance-section[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1)}.maintenance-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:12px}.maintenance-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.maint-btn[_ngcontent-%COMP%]{padding:8px 12px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#aaa;font-size:12px;cursor:pointer;transition:all .2s}.maint-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.knowledge-distribution[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.knowledge-distribution[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:16px;font-size:16px}.distribution-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}.type-card[_ngcontent-%COMP%]{background:#0003;border-radius:8px;padding:12px}.type-name[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.type-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;color:#888;margin-bottom:8px}.type-bar[_ngcontent-%COMP%]{height:4px;background:#ffffff1a;border-radius:2px;overflow:hidden}.bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:2px}.spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.cancel-request-btn[_ngcontent-%COMP%]{display:block;width:100%;margin-top:8px;padding:10px;background:#ef444433;border:1px solid rgba(239,68,68,.4);border-radius:8px;color:#ef4444;font-size:13px;cursor:pointer;transition:all .2s}.cancel-request-btn[_ngcontent-%COMP%]:hover{background:#ef44444d}.cancel-link[_ngcontent-%COMP%]{display:block;margin-top:8px;background:none;border:none;color:#888;font-size:12px;cursor:pointer;text-decoration:underline}.cancel-link[_ngcontent-%COMP%]:hover{color:#ef4444}@media(max-width:1200px){.brain-content[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.learning-section[_ngcontent-%COMP%]{grid-column:span 2}}@media(max-width:768px){.brain-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.learning-section[_ngcontent-%COMP%]{grid-column:auto}.brain-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.brain-stats[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}}.gaps-section[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef444414,#a855f714);border:1px solid rgba(239,68,68,.2);border-radius:16px;padding:20px;margin-bottom:24px}.gaps-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.gap-count[_ngcontent-%COMP%]{color:#ef4444;font-weight:700}.gaps-actions-bar[_ngcontent-%COMP%]{display:flex;gap:8px}.gaps-hint[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:16px}.gaps-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.gap-card[_ngcontent-%COMP%]{display:flex;gap:12px;background:#0000004d;border-radius:12px;padding:12px;transition:all .2s;border:1px solid transparent}.gap-card[_ngcontent-%COMP%]:hover{background:#0006;border-color:#a855f74d}.gap-card.selected[_ngcontent-%COMP%]{background:#a855f726;border-color:#a855f780}.gap-select[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding-top:4px}.gap-select[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:#a855f7}.gap-main[_ngcontent-%COMP%]{flex:1;min-width:0}.gap-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:8px}.gap-query[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;flex:1;line-height:1.4}.gap-tags[_ngcontent-%COMP%]{display:flex;gap:6px;flex-shrink:0}.tag[_ngcontent-%COMP%]{font-size:11px;padding:2px 8px;border-radius:10px;white-space:nowrap}.tag.hot[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.tag.hits[_ngcontent-%COMP%]{background:#64748b4d;color:#94a3b8}.tag.category[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.tag.cat-price[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.tag.cat-process[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.tag.cat-product[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.tag.cat-support[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gap-suggestion[_ngcontent-%COMP%]{display:flex;gap:6px;font-size:12px;color:#888;margin-bottom:8px;padding:6px 10px;background:#a855f71a;border-radius:6px}.suggestion-label[_ngcontent-%COMP%]{color:#a855f7;flex-shrink:0}.suggestion-text[_ngcontent-%COMP%]{color:#aaa}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:6px}.gap-btn[_ngcontent-%COMP%]{padding:4px 10px;border-radius:6px;border:none;font-size:12px;cursor:pointer;transition:all .2s}.gap-btn.suggest[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.gap-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.gap-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gap-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.batch-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:none;font-size:12px;cursor:pointer;transition:all .2s}.batch-btn.cleanup[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.batch-btn.delete-selected[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gaps-more[_ngcontent-%COMP%]{text-align:center;padding:12px;color:#666;font-size:13px}.gaps-empty[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.gaps-empty[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:48px;display:block;margin-bottom:12px}.gaps-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.gap-card[_ngcontent-%COMP%]{background:#0000004d;border-radius:12px;padding:14px}.gap-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px}.gap-query[_ngcontent-%COMP%]{font-weight:600;color:#fff}.gap-hits[_ngcontent-%COMP%]{background:#ef4444;padding:2px 8px;border-radius:10px;font-size:11px}.gap-suggestion[_ngcontent-%COMP%]{background:#667eea1a;padding:10px;border-radius:8px;font-size:13px;color:#aaa;margin-bottom:10px}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.gap-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;border:none;transition:all .2s}.gap-btn.suggest[_ngcontent-%COMP%]{background:#667eea33;color:#667eea}.gap-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#10b981}.gap-btn.ignore[_ngcontent-%COMP%]{background:#6b728033;color:#9ca3af}.gap-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#ef4444}.gap-btn.delete[_ngcontent-%COMP%]:hover{background:#ef444466}.gap-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.batch-btn[_ngcontent-%COMP%]{margin-left:auto;padding:6px 12px;border:none;border-radius:8px;font-size:12px;cursor:pointer;transition:all .2s}.batch-btn.cleanup[_ngcontent-%COMP%]{background:#f59e0b33;color:#f59e0b}.batch-btn.cleanup[_ngcontent-%COMP%]:hover{background:#f59e0b66}.health-dashboard[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px;margin-bottom:24px}.health-overview[_ngcontent-%COMP%]{display:flex;gap:30px;align-items:center}.health-score-circle[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#0000004d;border:3px solid #667eea}.health-score-circle.healthy[_ngcontent-%COMP%]{border-color:#10b981}.health-score-circle.warning[_ngcontent-%COMP%]{border-color:#f59e0b}.health-score-circle.danger[_ngcontent-%COMP%]{border-color:#ef4444}.score-value[_ngcontent-%COMP%]{font-size:28px;font-weight:700}.score-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.health-metrics[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:12px}.metric[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.metric-label[_ngcontent-%COMP%]{width:60px;font-size:13px;color:#888}.metric-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:#ffffff1a;border-radius:4px;overflow:hidden}.metric-bar[_ngcontent-%COMP%]   .bar-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:4px}.metric-value[_ngcontent-%COMP%]{width:40px;text-align:right;font-size:13px;font-weight:600}.health-suggestions[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1)}.health-suggestions[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;margin-bottom:12px}.suggestion-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#0003;border-radius:8px;margin-bottom:8px;font-size:13px}.guided-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000}.guided-dialog[_ngcontent-%COMP%]{background:#1a1a2e;border-radius:20px;width:90%;max-width:600px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}.guided-header[_ngcontent-%COMP%]{padding:20px;border-bottom:1px solid rgba(255,255,255,.1);position:relative}.step-indicator[_ngcontent-%COMP%]{font-size:12px;color:#667eea;margin-bottom:4px;display:block}.guided-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}.close-btn[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;background:none;border:none;color:#888;font-size:20px;cursor:pointer}.guided-content[_ngcontent-%COMP%]{padding:20px;flex:1;overflow-y:auto}.question-text[_ngcontent-%COMP%]{font-size:16px;margin-bottom:20px}.options-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}.options-grid.multi[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}.option-btn[_ngcontent-%COMP%]{padding:14px;background:#ffffff0d;border:2px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:14px;cursor:pointer;transition:all .2s;text-align:left}.option-btn[_ngcontent-%COMP%]:hover{border-color:#667eea}.option-btn.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea33}.guided-textarea[_ngcontent-%COMP%]{width:100%;min-height:120px;padding:14px;background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:14px;resize:vertical}.suggestions[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}.suggestions[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#888}.suggestion-chip[_ngcontent-%COMP%]{padding:4px 10px;background:#667eea33;border:none;border-radius:12px;color:#667eea;font-size:12px;cursor:pointer}.guided-footer[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid rgba(255,255,255,.1);display:flex;justify-content:flex-end;gap:12px}.cancel-btn[_ngcontent-%COMP%]{padding:10px 20px;background:transparent;border:1px solid rgba(255,255,255,.2);border-radius:8px;color:#888;cursor:pointer}.next-btn[_ngcontent-%COMP%]{padding:10px 24px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer}.next-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})}};var mW=(i,e)=>e.id;function pW(i,e){if(i&1){let t=I();r(0,"button",38),x("click",function(){_(t);let o=m();return v(o.deleteSelected())}),l(1),s(),r(2,"button",39),x("click",function(){_(t);let o=m();return v(o.batchResolve())}),l(3," \u2705 \u6279\u91CF\u63A1\u7528 "),s()}if(i&2){let t=m();c(),M(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedIds().length,") ")}}function gW(i,e){i&1&&(r(0,"div",36),B(1,"span",40),r(2,"span"),l(3,"\u8F09\u5165\u4E2D..."),s()())}function hW(i,e){i&1&&(r(0,"div",37)(1,"span",41),l(2,"\u2728"),s(),r(3,"h3"),l(4,"\u6C92\u6709\u5F85\u8655\u7406\u7684\u77E5\u8B58\u7F3A\u53E3"),s(),r(5,"p"),l(6,"\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01"),s()())}function fW(i,e){if(i&1&&(r(0,"div",52)(1,"span",61),l(2,"\u{1F4A1} AI:"),s(),l(3),s()),i&2){let t=m().$implicit,n=m(2);c(3),M(" ",n.truncateText(t.suggestedAnswer,100)," ")}}function _W(i,e){i&1&&(r(0,"span",55),l(1,"\u{1F525}"),s())}function vW(i,e){if(i&1){let t=I();r(0,"button",62),x("click",function(){_(t);let o=m().$implicit,a=m(2);return v(a.generateAnswer(o))}),l(1," \u{1F916} "),s()}}function xW(i,e){if(i&1){let t=I();r(0,"div",44)(1,"div",45)(2,"input",46),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSelect(o.id))}),s()(),r(3,"div",47),l(4),s(),r(5,"div",48)(6,"span",49),l(7),s()(),r(8,"div",50)(9,"div",51),l(10),s(),y(11,fW,4,1,"div",52),s(),r(12,"div",53)(13,"span",54),l(14),s(),y(15,_W,2,0,"span",55),s(),r(16,"div",56),l(17),s(),r(18,"div",57),y(19,vW,2,0,"button",58),r(20,"button",59),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.resolveGap(o))}),l(21," \u2705 "),s(),r(22,"button",60),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteGap(o))}),l(23," \u{1F5D1}\uFE0F "),s()()()}if(i&2){let t=e.$implicit,n=e.$index,o=m(2);N("selected",o.isSelected(t.id)),c(2),L("checked",o.isSelected(t.id)),c(2),D((o.currentPage()-1)*o.pageSize+n+1),c(2),de("cat-"+(t.category||"other")),c(),M(" ",o.getCategoryIcon(t.category)," "),c(2),L("title",t.query),c(),M(" ",o.truncateText(t.query,80)," "),c(),S(t.suggestedAnswer?11:-1),c(2),N("hot",t.hitCount>=5),c(),M(" ",t.hitCount,"\u6B21 "),c(),S(t.hitCount>=5?15:-1),c(2),M(" ",o.formatTime(t.createdAt)," "),c(2),S(t.suggestedAnswer?-1:19)}}function CW(i,e){if(i&1){let t=I();r(0,"div",43)(1,"button",63),x("click",function(){_(t);let o=m(2);return v(o.goToPage(o.currentPage()-1))}),l(2," \u2190 \u4E0A\u4E00\u9801 "),s(),r(3,"span",64),l(4),s(),r(5,"button",63),x("click",function(){_(t);let o=m(2);return v(o.goToPage(o.currentPage()+1))}),l(6," \u4E0B\u4E00\u9801 \u2192 "),s()()}if(i&2){let t=m(2);c(),L("disabled",t.currentPage()===1),c(3),cn(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801 \uFF08\u5171 ",t.filteredGaps().length," \u689D\uFF09 "),c(),L("disabled",t.currentPage()===t.totalPages())}}function bW(i,e){if(i&1&&(O(0,xW,24,16,"div",42,mW),y(2,CW,7,5,"div",43)),i&2){let t=m();U(t.paginatedGaps()),c(2),S(t.totalPages()>1?2:-1)}}var hd=class i{constructor(){this.ragService=F(Kn);this.dialogService=F(st);this.toastService=F(J);this.isLoading=f(!1);this.gaps=f([]);this.selectedIds=f([]);this.currentPage=f(1);this.pageSize=20;this.categoryFilter="all";this.sortOption="hitCount";this.filteredGaps=R(()=>{let e=[...this.gaps()];return this.categoryFilter!=="all"&&(e=e.filter(t=>(t.category||"other")===this.categoryFilter)),e.sort((t,n)=>{switch(this.sortOption){case"hitCount":return n.hitCount-t.hitCount;case"createdAt":return new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime();case"category":return(t.category||"z").localeCompare(n.category||"z");default:return 0}}),e});this.paginatedGaps=R(()=>{let e=(this.currentPage()-1)*this.pageSize;return this.filteredGaps().slice(e,e+this.pageSize)});this.totalPages=R(()=>Math.ceil(this.filteredGaps().length/this.pageSize));this.totalGaps=R(()=>this.gaps().length);this.hotGapsCount=R(()=>this.gaps().filter(e=>e.hitCount>=5).length);this.categoryStats=R(()=>{let e={price:0,process:0,product:0,support:0,other:0};return this.gaps().forEach(t=>{let n=t.category||"other";e[n]!==void 0&&e[n]++}),e})}ngOnInit(){this.loadGaps()}async loadGaps(){this.isLoading.set(!0);try{await this.ragService.getKnowledgeGaps(),this.gaps.set(this.ragService.knowledgeGaps())}finally{this.isLoading.set(!1)}}refreshGaps(){this.loadGaps(),this.toastService.success("\u5DF2\u5237\u65B0")}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(e){return this.selectedIds().includes(e)}toggleSelect(e){let t=this.selectedIds();t.includes(e)?this.selectedIds.set(t.filter(n=>n!==e)):this.selectedIds.set([...t,e])}isAllSelected(){let e=this.paginatedGaps();return e.length>0&&e.every(t=>this.selectedIds().includes(t.id))}isPartialSelected(){let e=this.paginatedGaps(),t=e.filter(n=>this.selectedIds().includes(n.id));return t.length>0&&t.length<e.length}toggleSelectAll(){let e=this.paginatedGaps();if(this.isAllSelected()){let t=e.map(n=>n.id);this.selectedIds.set(this.selectedIds().filter(n=>!t.includes(n)))}else{let t=[...new Set([...this.selectedIds(),...e.map(n=>n.id)])];this.selectedIds.set(t)}}generateAnswer(e){this.ragService.suggestGapAnswer(e.id,e.query),this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...")}resolveGap(e){let t=e.suggestedAnswer||"";this.dialogService.prompt({title:"\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",message:`\u554F\u984C: "${this.truncateText(e.query,60)}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,placeholder:t||"\u5C08\u696D\u7684\u56DE\u7B54...",defaultValue:t,confirmText:"\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",onConfirm:n=>{n&&(this.ragService.resolveGap(e.id,"faq",e.query,n),this.toastService.success("\u5DF2\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB"),this.loadGaps())}})}deleteGap(e){this.ragService.deleteGap(e.id),this.gaps.set(this.gaps().filter(t=>t.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664")}deleteSelected(){let e=this.selectedIds();e.length!==0&&(this.ragService.deleteGapsBatch(e),this.gaps.set(this.gaps().filter(t=>!e.includes(t.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D`))}batchResolve(){let e=this.paginatedGaps().filter(t=>this.selectedIds().includes(t.id)&&t.suggestedAnswer);if(e.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u6709 AI \u5EFA\u8B70\u7684\u7F3A\u53E3");return}e.forEach(t=>{this.ragService.resolveGap(t.id,"faq",t.query,t.suggestedAnswer)}),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u6279\u91CF\u63A1\u7528 ${e.length} \u689D`),this.loadGaps()}cleanupAllInvalid(){this.ragService.cleanupDuplicateGaps(),this.toastService.info("\u6B63\u5728\u6DF1\u5EA6\u6E05\u7406..."),setTimeout(()=>this.loadGaps(),1500)}goToPage(e){e>=1&&e<=this.totalPages()&&(this.currentPage.set(e),this.selectedIds.set([]))}truncateText(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}getCategoryIcon(e){return{price:"\u{1F4B0}",process:"\u{1F4CB}",product:"\u{1F4E6}",support:"\u{1F6E0}\uFE0F",other:"\u2753"}[e||"other"]||"\u2753"}formatTime(e){if(!e)return"";let t=new Date(e),o=new Date().getTime()-t.getTime();return o<6e4?"\u525B\u525B":o<36e5?`${Math.floor(o/6e4)} \u5206\u9418\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u6642\u524D`:o<6048e5?`${Math.floor(o/864e5)} \u5929\u524D`:t.toLocaleDateString("zh-TW")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-knowledge-gaps"]],decls:93,vars:11,consts:[[1,"gaps-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","cleanup",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","hot"],[1,"stat-card","price"],[1,"stat-card","process"],[1,"stat-card","product"],[1,"filter-bar"],[1,"filter-left"],[1,"select-all"],["type","checkbox",3,"change","checked","indeterminate"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","price"],["value","process"],["value","product"],["value","support"],["value","other"],["value","hitCount"],["value","createdAt"],["value","category"],[1,"filter-right"],[1,"gaps-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"batch-btn","resolve",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"gap-row",3,"selected"],[1,"pagination"],[1,"gap-row"],[1,"gap-checkbox"],["type","checkbox",3,"change","checked"],[1,"gap-index"],[1,"gap-category"],[1,"category-tag"],[1,"gap-content"],[1,"gap-query",3,"title"],[1,"gap-answer"],[1,"gap-hits"],[1,"hits-badge"],[1,"hot-tag"],[1,"gap-time"],[1,"gap-actions"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate"],["title","\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",1,"btn-icon","resolve",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"answer-label"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u2753"),s(),l(6," \u77E5\u8B58\u7F3A\u53E3\u7BA1\u7406 "),s(),r(7,"p",5),l(8,"\u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u7B54\u6848\u7684\u554F\u984C\uFF0C\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C\u53EF\u63D0\u5347 AI \u56DE\u8986\u8CEA\u91CF"),s()(),r(9,"div",6)(10,"button",7),x("click",function(){return n.cleanupAllInvalid()}),l(11," \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 "),s(),r(12,"button",8),x("click",function(){return n.refreshGaps()}),l(13," \u{1F504} \u5237\u65B0 "),s()()(),r(14,"div",9)(15,"div",10)(16,"div",11),l(17,"\u{1F4CB}"),s(),r(18,"div",12)(19,"span",13),l(20),s(),r(21,"span",14),l(22,"\u5F85\u8655\u7406"),s()()(),r(23,"div",15)(24,"div",11),l(25,"\u{1F525}"),s(),r(26,"div",12)(27,"span",13),l(28),s(),r(29,"span",14),l(30,"\u71B1\u9580\u554F\u984C"),s()()(),r(31,"div",16)(32,"div",11),l(33,"\u{1F4B0}"),s(),r(34,"div",12)(35,"span",13),l(36),s(),r(37,"span",14),l(38,"\u50F9\u683C\u76F8\u95DC"),s()()(),r(39,"div",17)(40,"div",11),l(41,"\u{1F4CB}"),s(),r(42,"div",12)(43,"span",13),l(44),s(),r(45,"span",14),l(46,"\u6D41\u7A0B\u76F8\u95DC"),s()()(),r(47,"div",18)(48,"div",11),l(49,"\u{1F4E6}"),s(),r(50,"div",12)(51,"span",13),l(52),s(),r(53,"span",14),l(54,"\u7522\u54C1\u76F8\u95DC"),s()()()(),r(55,"div",19)(56,"div",20)(57,"label",21)(58,"input",22),x("change",function(){return n.toggleSelectAll()}),s(),r(59,"span"),l(60,"\u5168\u9078"),s()(),r(61,"div",23)(62,"label"),l(63,"\u5206\u985E\uFF1A"),s(),r(64,"select",24),W("ngModelChange",function(a){return q(n.categoryFilter,a)||(n.categoryFilter=a),a}),x("change",function(){return n.applyFilters()}),r(65,"option",25),l(66,"\u5168\u90E8"),s(),r(67,"option",26),l(68,"\u{1F4B0} \u50F9\u683C"),s(),r(69,"option",27),l(70,"\u{1F4CB} \u6D41\u7A0B"),s(),r(71,"option",28),l(72,"\u{1F4E6} \u7522\u54C1"),s(),r(73,"option",29),l(74,"\u{1F6E0}\uFE0F \u552E\u5F8C"),s(),r(75,"option",30),l(76,"\u2753 \u5176\u4ED6"),s()()(),r(77,"div",23)(78,"label"),l(79,"\u6392\u5E8F\uFF1A"),s(),r(80,"select",24),W("ngModelChange",function(a){return q(n.sortOption,a)||(n.sortOption=a),a}),x("change",function(){return n.applyFilters()}),r(81,"option",31),l(82,"\u{1F525} \u71B1\u5EA6"),s(),r(83,"option",32),l(84,"\u{1F550} \u6642\u9593"),s(),r(85,"option",33),l(86,"\u{1F4C2} \u5206\u985E"),s()()()(),r(87,"div",34),y(88,pW,4,1),s()(),r(89,"div",35),y(90,gW,4,0,"div",36)(91,hW,7,0,"div",37)(92,bW,3,1),s()()),t&2&&(c(20),D(n.totalGaps()),c(8),D(n.hotGapsCount()),c(8),D(n.categoryStats().price),c(8),D(n.categoryStats().process),c(8),D(n.categoryStats().product),c(6),L("checked",n.isAllSelected())("indeterminate",n.isPartialSelected()),c(6),H("ngModel",n.categoryFilter),c(16),H("ngModel",n.sortOption),c(8),S(n.selectedIds().length>0?88:-1),c(2),S(n.isLoading()?90:n.filteredGaps().length===0?91:92))},dependencies:[oe,ae,Re,Ne,Ge,ve,he],styles:[".gaps-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.cleanup[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08);transition:all .2s}.stat-card[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#ffffff26}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.hot[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.stat-card.price[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.process[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.select-all[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;color:#aaa}.select-all[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;cursor:pointer}.filter-right[_ngcontent-%COMP%]{display:flex;gap:10px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.batch-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.batch-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.gaps-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.gap-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 40px 50px 1fr 80px 80px 100px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.gap-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.gap-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.gap-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.gap-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7;cursor:pointer}.gap-index[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-category[_ngcontent-%COMP%]{text-align:center}.category-tag[_ngcontent-%COMP%]{font-size:18px}.gap-content[_ngcontent-%COMP%]{min-width:0}.gap-query[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;line-height:1.4;margin-bottom:4px}.gap-answer[_ngcontent-%COMP%]{font-size:12px;color:#888;padding:6px 10px;background:#a855f71a;border-radius:6px;margin-top:6px}.answer-label[_ngcontent-%COMP%]{color:#a855f7;margin-right:4px}.gap-hits[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;justify-content:center}.hits-badge[_ngcontent-%COMP%]{padding:3px 8px;background:#64748b33;border-radius:10px;font-size:12px;color:#94a3b8}.hits-badge.hot[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.hot-tag[_ngcontent-%COMP%]{font-size:14px}.gap-time[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}.btn-icon.generate[_ngcontent-%COMP%]{background:#a855f733}.btn-icon.resolve[_ngcontent-%COMP%]{background:#10b98133}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media(max-width:900px){.gap-row[_ngcontent-%COMP%]{grid-template-columns:40px 40px 1fr 60px 80px}.gap-category[_ngcontent-%COMP%], .gap-time[_ngcontent-%COMP%]{display:none}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media(max-width:600px){.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.filter-left[_ngcontent-%COMP%], .filter-right[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}};var yW=(i,e)=>e.id;function SW(i,e){if(i&1){let t=I();r(0,"button",42),x("click",function(){_(t);let o=m();return v(o.deleteSelected())}),l(1),s()}if(i&2){let t=m();c(),M(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedIds().length,") ")}}function wW(i,e){i&1&&(r(0,"div",40),B(1,"span",43),r(2,"span"),l(3,"\u8F09\u5165\u4E2D..."),s()())}function EW(i,e){if(i&1){let t=I();r(0,"div",41)(1,"span",44),l(2,"\u{1F4DA}"),s(),r(3,"h3"),l(4,"\u66AB\u7121\u77E5\u8B58"),s(),r(5,"p"),l(6,"\u9EDE\u64CA\u300C\u6DFB\u52A0\u77E5\u8B58\u300D\u958B\u59CB\u69CB\u5EFA\u77E5\u8B58\u5EAB"),s(),r(7,"button",45),x("click",function(){_(t);let o=m();return v(o.addKnowledge())}),l(8,"\u2795 \u6DFB\u52A0\u77E5\u8B58"),s()()}}function DW(i,e){if(i&1){let t=I();r(0,"div",48)(1,"div",49)(2,"input",50),x("change",function(){let o=_(t).$implicit,a=m(2);return v(a.toggleSelect(o.id))}),s()(),r(3,"div",51)(4,"span",52),l(5),s()(),r(6,"div",53),l(7),s(),r(8,"div",54),l(9),s(),r(10,"div",55)(11,"span",56),l(12),s()(),r(13,"div",57),l(14),s(),r(15,"div",58)(16,"button",59),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.editKnowledge(o))}),l(17," \u270F\uFE0F "),s(),r(18,"button",60),x("click",function(){let o=_(t).$implicit,a=m(2);return v(a.deleteKnowledge(o))}),l(19," \u{1F5D1}\uFE0F "),s()()()}if(i&2){let t=e.$implicit,n=m(2);N("selected",n.isSelected(t.id)),c(2),L("checked",n.isSelected(t.id)),c(2),de("type-"+t.type),c(),X(" ",n.getTypeIcon(t.type)," ",n.getTypeName(t.type)," "),c(),L("title",t.question),c(),M(" ",n.truncateText(t.question,60)," "),c(),L("title",t.answer),c(),M(" ",n.truncateText(t.answer,80)," "),c(2),N("high",t.successScore>=.7)("low",t.successScore<.4),c(),M(" ",(t.successScore*10).toFixed(1)," "),c(2),M(" ",t.useCount,"\u6B21 ")}}function AW(i,e){if(i&1){let t=I();r(0,"div",47)(1,"button",61),x("click",function(){_(t);let o=m(2);return v(o.goToPage(o.currentPage()-1))}),l(2," \u2190 \u4E0A\u4E00\u9801 "),s(),r(3,"span",62),l(4),s(),r(5,"button",61),x("click",function(){_(t);let o=m(2);return v(o.goToPage(o.currentPage()+1))}),l(6," \u4E0B\u4E00\u9801 \u2192 "),s()()}if(i&2){let t=m(2);c(),L("disabled",t.currentPage()===1),c(3),cn(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801 \uFF08\u5171 ",t.filteredKnowledge().length," \u689D\uFF09 "),c(),L("disabled",t.currentPage()===t.totalPages())}}function MW(i,e){if(i&1&&(O(0,DW,20,17,"div",46,yW),y(2,AW,7,5,"div",47)),i&2){let t=m();U(t.paginatedKnowledge()),c(2),S(t.totalPages()>1?2:-1)}}var fd=class i{constructor(){this.ragService=F(Kn);this.dialogService=F(st);this.toastService=F(J);this.ipc=F(Q);this.isLoading=f(!1);this.knowledge=f([]);this.selectedIds=f([]);this.currentPage=f(1);this.pageSize=20;this.searchQuery="";this.typeFilter="all";this.sortOption="createdAt";this.filteredKnowledge=R(()=>{let e=[...this.knowledge()];if(this.searchQuery.trim()){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.question.toLowerCase().includes(t)||n.answer.toLowerCase().includes(t))}return this.typeFilter!=="all"&&(e=e.filter(t=>t.type===this.typeFilter)),e.sort((t,n)=>{switch(this.sortOption){case"createdAt":return new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime();case"useCount":return n.useCount-t.useCount;case"successScore":return n.successScore-t.successScore;case"type":return t.type.localeCompare(n.type);default:return 0}}),e});this.paginatedKnowledge=R(()=>{let e=(this.currentPage()-1)*this.pageSize;return this.filteredKnowledge().slice(e,e+this.pageSize)});this.totalPages=R(()=>Math.ceil(this.filteredKnowledge().length/this.pageSize));this.totalKnowledge=R(()=>this.knowledge().length);this.typeStats=R(()=>{let e={product:0,qa:0,script:0,faq:0,objection:0,greeting:0,closing:0};return this.knowledge().forEach(t=>{let n=t.type;e[n]!==void 0&&e[n]++}),e});this.avgScore=R(()=>{let e=this.knowledge();return e.length===0?0:e.reduce((t,n)=>t+n.successScore,0)/e.length})}ngOnInit(){this.loadKnowledge()}async loadKnowledge(){this.isLoading.set(!0);try{let e=await this.ipc.invoke("rag-get-all-knowledge",{});e?.success&&e.knowledge&&this.knowledge.set(e.knowledge.map(t=>({id:t.id,type:t.knowledge_type||t.type||"qa",question:t.question||"",answer:t.answer||"",context:t.context||"",successScore:t.success_score||t.successScore||.5,useCount:t.use_count||t.useCount||0,feedbackPositive:t.feedback_positive||0,feedbackNegative:t.feedback_negative||0,isActive:t.is_active!==!1,createdAt:t.created_at||t.createdAt||new Date().toISOString(),updatedAt:t.updated_at||t.updatedAt})))}catch(e){console.error("Failed to load knowledge:",e),this.toastService.error("\u8F09\u5165\u77E5\u8B58\u5931\u6557")}finally{this.isLoading.set(!1)}}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(e){return this.selectedIds().includes(e)}toggleSelect(e){let t=this.selectedIds();t.includes(e)?this.selectedIds.set(t.filter(n=>n!==e)):this.selectedIds.set([...t,e])}addKnowledge(){this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:"\u8ACB\u8F38\u5165\u554F\u984C\uFF1A",placeholder:"\u4F8B\u5982\uFF1A\u8CBB\u7387\u662F\u591A\u5C11\uFF1F",confirmText:"\u4E0B\u4E00\u6B65",onConfirm:e=>{e&&this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:`\u554F\u984C: "${e}"

\u8ACB\u8F38\u5165\u7B54\u6848\uFF1A`,placeholder:"\u5C08\u696D\u7684\u56DE\u7B54...",confirmText:"\u6DFB\u52A0",onConfirm:async t=>{if(t)try{await this.ipc.invoke("rag-add-knowledge",{type:"qa",question:e,answer:t}),this.toastService.success("\u6DFB\u52A0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u6DFB\u52A0\u5931\u6557")}}})}})}editKnowledge(e){this.dialogService.prompt({title:"\u7DE8\u8F2F\u77E5\u8B58",message:`\u554F\u984C: "${e.question}"

\u8ACB\u4FEE\u6539\u7B54\u6848\uFF1A`,placeholder:e.answer,defaultValue:e.answer,confirmText:"\u4FDD\u5B58",onConfirm:async t=>{if(t&&t!==e.answer)try{await this.ipc.invoke("rag-update-knowledge",{id:e.id,answer:t}),this.toastService.success("\u66F4\u65B0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u66F4\u65B0\u5931\u6557")}}})}async deleteKnowledge(e){try{await this.ipc.invoke("rag-delete-knowledge",{id:e.id}),this.knowledge.set(this.knowledge().filter(t=>t.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664")}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}async deleteSelected(){let e=this.selectedIds();if(e.length!==0)try{await this.ipc.invoke("rag-delete-knowledge-batch",{ids:e}),this.knowledge.set(this.knowledge().filter(t=>!e.includes(t.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D`)}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}goToPage(e){e>=1&&e<=this.totalPages()&&this.currentPage.set(e)}truncateText(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}getTypeIcon(e){return{product:"\u{1F4E6}",qa:"\u{1F4AC}",script:"\u{1F4DC}",faq:"\u2753",objection:"\u{1F6E1}\uFE0F",greeting:"\u{1F44B}",closing:"\u{1F3AF}"}[e]||"\u{1F4DD}"}getTypeName(e){return{product:"\u7522\u54C1",qa:"\u554F\u7B54",script:"\u8A71\u8853",faq:"FAQ",objection:"\u7570\u8B70",greeting:"\u958B\u5834",closing:"\u6210\u4EA4"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-knowledge-manage"]],decls:97,vars:10,consts:[[1,"knowledge-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","add",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","product"],[1,"stat-card","qa"],[1,"stat-card","script"],[1,"stat-card","score"],[1,"filter-bar"],[1,"filter-left"],[1,"search-box"],["type","text","placeholder","\u641C\u7D22\u77E5\u8B58...",3,"ngModelChange","input","ngModel"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","product"],["value","qa"],["value","script"],["value","faq"],["value","objection"],["value","greeting"],["value","closing"],["value","createdAt"],["value","useCount"],["value","successScore"],["value","type"],[1,"filter-right"],[1,"batch-btn","delete"],[1,"knowledge-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"add-btn",3,"click"],[1,"knowledge-row",3,"selected"],[1,"pagination"],[1,"knowledge-row"],[1,"item-checkbox"],["type","checkbox",3,"change","checked"],[1,"item-type"],[1,"type-tag"],[1,"item-question",3,"title"],[1,"item-answer",3,"title"],[1,"item-score"],[1,"score-badge"],[1,"item-usage"],[1,"item-actions"],["title","\u7DE8\u8F2F",1,"btn-icon","edit",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u{1F4DD}"),s(),l(6," \u77E5\u8B58\u7BA1\u7406 "),s(),r(7,"p",5),l(8,"\u67E5\u770B\u548C\u7BA1\u7406\u5DF2\u5C0E\u5165\u7684\u6240\u6709\u77E5\u8B58\uFF0C\u652F\u6301\u7DE8\u8F2F\u548C\u522A\u9664"),s()(),r(9,"div",6)(10,"button",7),x("click",function(){return n.addKnowledge()}),l(11," \u2795 \u6DFB\u52A0\u77E5\u8B58 "),s(),r(12,"button",8),x("click",function(){return n.loadKnowledge()}),l(13," \u{1F504} \u5237\u65B0 "),s()()(),r(14,"div",9)(15,"div",10)(16,"div",11),l(17,"\u{1F4DA}"),s(),r(18,"div",12)(19,"span",13),l(20),s(),r(21,"span",14),l(22,"\u77E5\u8B58\u7E3D\u6578"),s()()(),r(23,"div",15)(24,"div",11),l(25,"\u{1F4E6}"),s(),r(26,"div",12)(27,"span",13),l(28),s(),r(29,"span",14),l(30,"\u7522\u54C1\u4FE1\u606F"),s()()(),r(31,"div",16)(32,"div",11),l(33,"\u{1F4AC}"),s(),r(34,"div",12)(35,"span",13),l(36),s(),r(37,"span",14),l(38,"\u554F\u7B54"),s()()(),r(39,"div",17)(40,"div",11),l(41,"\u{1F4DC}"),s(),r(42,"div",12)(43,"span",13),l(44),s(),r(45,"span",14),l(46,"\u8A71\u8853"),s()()(),r(47,"div",18)(48,"div",11),l(49,"\u2B50"),s(),r(50,"div",12)(51,"span",13),l(52),s(),r(53,"span",14),l(54,"\u5E73\u5747\u8A55\u5206"),s()()()(),r(55,"div",19)(56,"div",20)(57,"div",21)(58,"input",22),W("ngModelChange",function(a){return q(n.searchQuery,a)||(n.searchQuery=a),a}),x("input",function(){return n.applyFilters()}),s()(),r(59,"div",23)(60,"label"),l(61,"\u985E\u578B\uFF1A"),s(),r(62,"select",24),W("ngModelChange",function(a){return q(n.typeFilter,a)||(n.typeFilter=a),a}),x("change",function(){return n.applyFilters()}),r(63,"option",25),l(64,"\u5168\u90E8"),s(),r(65,"option",26),l(66,"\u{1F4E6} \u7522\u54C1"),s(),r(67,"option",27),l(68,"\u{1F4AC} \u554F\u7B54"),s(),r(69,"option",28),l(70,"\u{1F4DC} \u8A71\u8853"),s(),r(71,"option",29),l(72,"\u2753 FAQ"),s(),r(73,"option",30),l(74,"\u{1F6E1}\uFE0F \u7570\u8B70\u8655\u7406"),s(),r(75,"option",31),l(76,"\u{1F44B} \u958B\u5834\u767D"),s(),r(77,"option",32),l(78,"\u{1F3AF} \u6210\u4EA4"),s()()(),r(79,"div",23)(80,"label"),l(81,"\u6392\u5E8F\uFF1A"),s(),r(82,"select",24),W("ngModelChange",function(a){return q(n.sortOption,a)||(n.sortOption=a),a}),x("change",function(){return n.applyFilters()}),r(83,"option",33),l(84,"\u{1F550} \u6642\u9593"),s(),r(85,"option",34),l(86,"\u{1F4CA} \u4F7F\u7528\u6B21\u6578"),s(),r(87,"option",35),l(88,"\u2B50 \u8A55\u5206"),s(),r(89,"option",36),l(90,"\u{1F4C2} \u985E\u578B"),s()()()(),r(91,"div",37),y(92,SW,2,1,"button",38),s()(),r(93,"div",39),y(94,wW,4,0,"div",40)(95,EW,9,0,"div",41)(96,MW,3,1),s()()),t&2&&(c(20),D(n.totalKnowledge()),c(8),D(n.typeStats().product),c(8),D(n.typeStats().qa),c(8),D(n.typeStats().script),c(8),D(n.avgScore().toFixed(1)),c(6),H("ngModel",n.searchQuery),c(4),H("ngModel",n.typeFilter),c(20),H("ngModel",n.sortOption),c(10),S(n.selectedIds().length>0?92:-1),c(2),S(n.isLoading()?94:n.filteredKnowledge().length===0?95:96))},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he],styles:[".knowledge-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.add[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08)}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.stat-card.qa[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.script[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.score[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 14px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;width:200px}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;cursor:pointer}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.knowledge-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.knowledge-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 100px 1fr 1.5fr 60px 60px 80px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.knowledge-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.knowledge-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.knowledge-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.item-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.type-tag[_ngcontent-%COMP%]{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:500;white-space:nowrap}.type-tag.type-product[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.type-tag.type-qa[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.type-tag.type-script[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.type-tag.type-faq[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.type-tag.type-objection[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.type-tag.type-greeting[_ngcontent-%COMP%]{background:#06b6d433;color:#22d3ee}.type-tag.type-closing[_ngcontent-%COMP%]{background:#ec489933;color:#f472b6}.item-question[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0}.item-answer[_ngcontent-%COMP%]{font-size:13px;color:#888}.score-badge[_ngcontent-%COMP%]{padding:3px 8px;border-radius:10px;font-size:12px;background:#64748b33;color:#94a3b8}.score-badge.high[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.score-badge.low[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.item-usage[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.item-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}.btn-icon.edit[_ngcontent-%COMP%]{background:#3b82f633}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0 0 20px}.add-btn[_ngcontent-%COMP%]{padding:12px 24px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:10px;color:#fff;font-size:14px;cursor:pointer}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 80px 1fr 60px 60px}.item-answer[_ngcontent-%COMP%]{display:none}}@media(max-width:768px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 1fr 60px 60px}.item-type[_ngcontent-%COMP%]{display:none}}"]})}};var TW=(i,e)=>e.stage,kW=(i,e)=>e.comboId;function IW(i,e){if(i&1&&(r(0,"span",48),l(1),s()),i&2){let t=m();N("bg-green-500/20",t.comparison().changes.sessions>0)("text-green-400",t.comparison().changes.sessions>0)("bg-red-500/20",t.comparison().changes.sessions<0)("text-red-400",t.comparison().changes.sessions<0),c(),X(" ",t.comparison().changes.sessions>0?"+":"","",t.comparison().changes.sessions.toFixed(1),"% ")}}function FW(i,e){if(i&1&&(r(0,"span",48),l(1),s()),i&2){let t=m();N("bg-green-500/20",t.comparison().changes.conversions>0)("text-green-400",t.comparison().changes.conversions>0)("bg-red-500/20",t.comparison().changes.conversions<0)("text-red-400",t.comparison().changes.conversions<0),c(),X(" ",t.comparison().changes.conversions>0?"+":"","",t.comparison().changes.conversions.toFixed(1),"% ")}}function PW(i,e){if(i&1&&(r(0,"span",48),l(1),s()),i&2){let t=m();N("bg-green-500/20",t.comparison().changes.revenue>0)("text-green-400",t.comparison().changes.revenue>0)("bg-red-500/20",t.comparison().changes.revenue<0)("text-red-400",t.comparison().changes.revenue<0),c(),X(" ",t.comparison().changes.revenue>0?"+":"","",t.comparison().changes.revenue.toFixed(1),"% ")}}function RW(i,e){if(i&1&&(r(0,"div",28)(1,"div",49)(2,"span",50),l(3),s(),r(4,"span",17),l(5),s()(),r(6,"div",51),B(7,"div",52),s()()),i&2){let t=e.$implicit,n=e.$index,o=m();c(3),D(o.getStageName(t.stage)),c(2),X("",t.count," (",t.rate.toFixed(1),"%)"),c(2),de(o.getFunnelColor(n)),ee("width",t.rate,"%")}}function NW(i,e){i&1&&(r(0,"div",29),l(1," \u66AB\u7121\u6578\u64DA "),s())}function VW(i,e){i&1&&(r(0,"span",58),l(1,"\u2191"),s())}function BW(i,e){i&1&&(r(0,"span",59),l(1,"\u2193"),s())}function LW(i,e){if(i&1&&(r(0,"div",30)(1,"div",13)(2,"div",53)(3,"span",54),l(4),s(),r(5,"span",55),l(6),s()(),r(7,"div",56)(8,"span",57),l(9),s(),y(10,VW,2,0,"span",58)(11,BW,2,0,"span",59),s()(),r(12,"div",60)(13,"span",61),l(14),s(),r(15,"span",62),l(16),s()(),r(17,"div",63),B(18,"div",64),s()()),i&2){let t=e.$implicit,n=e.$index,o=m();c(4),D(o.getMedalEmoji(n)),c(2),D(t.comboName),c(3),M("",t.conversionRate.toFixed(1),"%"),c(),S(t.trend==="up"?10:t.trend==="down"?11:-1),c(4),X(" ",t.totalSessions," \u6B21\u4F7F\u7528 \xB7 ",t.conversions," \u6B21\u8F49\u5316 "),c(2),M(" \u5E73\u5747 ",t.avgMessageCount.toFixed(0)," \u689D\u6D88\u606F "),c(2),ee("width",t.conversionRate,"%")}}function OW(i,e){i&1&&(r(0,"div",29)(1,"div",65),l(2,"\u{1F4CA}"),s(),r(3,"div"),l(4,"\u958B\u59CB\u71DF\u92B7\u5F8C\u5C07\u986F\u793A\u89D2\u8272\u7D44\u5408\u6548\u679C"),s()())}function UW(i,e){if(i&1&&(r(0,"div",47)(1,"div",66)(2,"div",67),l(3,"\u{1F4A1}"),s(),r(4,"div",68)(5,"h4",69),l(6,"\u63A8\u85A6\u4F7F\u7528\u89D2\u8272\u7D44\u5408"),s(),r(7,"p",70),l(8," \u6839\u64DA\u6B77\u53F2\u6578\u64DA\uFF0C\u300C"),r(9,"span",71),l(10),s(),l(11,"\u300D \u7D44\u5408\u8868\u73FE\u6700\u4F73\uFF0C\u8F49\u5316\u7387\u9054 "),r(12,"span",57),l(13),s()()(),r(14,"button",72),l(15," \u4F7F\u7528\u6B64\u7D44\u5408 "),s()()()),i&2){let t=m();c(10),D(t.recommendedCombo().comboName),c(3),M("",t.recommendedCombo().conversionRate.toFixed(1),"%")}}var _d=class i{constructor(){this.analytics=F(_n);this.selectedPeriod="week";this.todayDate=new Date().toLocaleDateString("zh-TW");this.totalStats=this.analytics.totalStats;this.todayStats=this.analytics.todayStats;this.topCombos=this.analytics.topRoleCombos;this.userProfiles=this.analytics.userProfiles;this.roleCombos=this.analytics.roleComboStats;this.todayReport=f(this.getEmptyReport());this.funnelData=f([]);this.comparison=f({current:{sessions:0,conversions:0,revenue:0},previous:{sessions:0,conversions:0,revenue:0},changes:{sessions:0,conversions:0,revenue:0}});this.recommendedCombo=f(null)}ngOnInit(){this.refreshData()}refreshData(){let e=this.analytics.generateDailyReport();this.todayReport.set(e),this.funnelData.set(e.funnel);let t=this.analytics.generatePeriodComparison(7);this.comparison.set(t);let n=this.analytics.recommendRoleCombo();this.recommendedCombo.set(n)}onPeriodChange(){this.refreshData()}getStageName(e){return{opening:"\u958B\u5834\u968E\u6BB5",building_trust:"\u5EFA\u7ACB\u4FE1\u4EFB",discovering_needs:"\u767C\u73FE\u9700\u6C42",presenting_value:"\u5C55\u793A\u50F9\u503C",handling_objections:"\u8655\u7406\u7570\u8B70",closing:"\u4FC3\u6210\u6210\u4EA4",follow_up:"\u8DDF\u9032\u670D\u52D9"}[e]||e}getFunnelColor(e){let t=["bg-blue-500","bg-cyan-500","bg-teal-500","bg-green-500","bg-lime-500","bg-amber-500","bg-orange-500"];return t[e%t.length]}getMedalEmoji(e){return["\u{1F947}","\u{1F948}","\u{1F949}","4\uFE0F\u20E3","5\uFE0F\u20E3"][e]||"\u{1F3C5}"}formatNumber(e){return e>=1e4?(e/1e4).toFixed(1)+"\u842C":e.toLocaleString()}getEmptyReport(){return{date:new Date().toISOString().split("T")[0],totalSessions:0,newUsers:0,activeUsers:0,conversions:0,conversionRate:0,totalRevenue:0,totalMessages:0,avgResponseTime:0,accountUsage:[],topRoleCombos:[],funnel:[]}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-marketing-report"]],decls:139,vars:21,consts:[[1,"marketing-report","p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white",3,"ngModelChange","change","ngModel"],["value","today"],["value","week"],["value","month"],["value","all"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-600","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-blue-500/20","to-blue-600/10","border","border-blue-500/30","rounded-xl","p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-blue-400","text-2xl"],[1,"text-xs","px-2","py-1","rounded-full",3,"bg-green-500/20","text-green-400","bg-red-500/20","text-red-400"],[1,"text-3xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"bg-gradient-to-br","from-green-500/20","to-green-600/10","border","border-green-500/30","rounded-xl","p-4"],[1,"text-green-400","text-2xl"],[1,"bg-gradient-to-br","from-purple-500/20","to-purple-600/10","border","border-purple-500/30","rounded-xl","p-4"],[1,"text-purple-400","text-2xl"],[1,"bg-gradient-to-br","from-amber-500/20","to-amber-600/10","border","border-amber-500/30","rounded-xl","p-4"],[1,"text-amber-400","text-2xl"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-slate-800/50","border","border-slate-700","rounded-xl","p-5"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"space-y-3"],[1,"relative"],[1,"text-center","py-8","text-slate-500"],[1,"p-3","bg-slate-900/50","rounded-lg","border","border-slate-700/50"],[1,"text-center","p-4","bg-slate-900/50","rounded-lg"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-2xl","font-bold","text-pink-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"text-2xl","font-bold","text-indigo-400"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"grid","grid-cols-2","md:grid-cols-5","gap-4"],[1,"text-center"],[1,"text-xl","font-bold","text-white"],[1,"text-xs","text-slate-400"],[1,"text-xl","font-bold","text-green-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-amber-400"],[1,"bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border","border-purple-500/30","rounded-xl","p-5"],[1,"text-xs","px-2","py-1","rounded-full"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","text-slate-300"],[1,"h-8","bg-slate-700","rounded-lg","overflow-hidden"],[1,"h-full","transition-all","duration-500"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"text-white","font-medium"],[1,"flex","items-center","gap-1"],[1,"text-green-400","font-bold"],[1,"text-green-400"],[1,"text-red-400"],[1,"flex","items-center","justify-between","text-sm"],[1,"text-slate-400"],[1,"text-slate-500"],[1,"mt-2","h-1.5","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-green-500","to-emerald-400","rounded-full"],[1,"text-3xl","mb-2"],[1,"flex","items-center","gap-4"],[1,"text-4xl"],[1,"flex-1"],[1,"text-white","font-semibold"],[1,"text-slate-300","mt-1"],[1,"text-purple-400","font-medium"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-600"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2)(4,"span"),l(5,"\u{1F4CA}"),s(),l(6," \u71DF\u92B7\u6578\u64DA\u5831\u8868 "),s(),r(7,"p",3),l(8,"\u8FFD\u8E64\u71DF\u92B7\u6548\u679C\uFF0C\u512A\u5316\u89D2\u8272\u7D44\u5408"),s()(),r(9,"div",4)(10,"select",5),W("ngModelChange",function(a){return q(n.selectedPeriod,a)||(n.selectedPeriod=a),a}),x("change",function(){return n.onPeriodChange()}),r(11,"option",6),l(12,"\u4ECA\u65E5"),s(),r(13,"option",7),l(14,"\u672C\u9031"),s(),r(15,"option",8),l(16,"\u672C\u6708"),s(),r(17,"option",9),l(18,"\u5168\u90E8"),s()(),r(19,"button",10),x("click",function(){return n.refreshData()}),r(20,"span"),l(21,"\u{1F504}"),s(),l(22," \u5237\u65B0 "),s()()(),r(23,"div",11)(24,"div",12)(25,"div",13)(26,"span",14),l(27,"\u{1F4EC}"),s(),y(28,IW,2,10,"span",15),s(),r(29,"div",16),l(30),s(),r(31,"div",17),l(32,"\u7E3D\u6703\u8A71\u6578"),s()(),r(33,"div",18)(34,"div",13)(35,"span",19),l(36,"\u2705"),s(),y(37,FW,2,10,"span",15),s(),r(38,"div",16),l(39),s(),r(40,"div",17),l(41,"\u6210\u529F\u8F49\u5316"),s()(),r(42,"div",20)(43,"div",13)(44,"span",21),l(45,"\u{1F4C8}"),s()(),r(46,"div",16),l(47),s(),r(48,"div",17),l(49,"\u8F49\u5316\u7387"),s()(),r(50,"div",22)(51,"div",13)(52,"span",23),l(53,"\u{1F4B0}"),s(),y(54,PW,2,10,"span",15),s(),r(55,"div",16),l(56),s(),r(57,"div",17),l(58,"\u7E3D\u6536\u5165"),s()()(),r(59,"div",24)(60,"div",25)(61,"h3",26)(62,"span"),l(63,"\u{1F53B}"),s(),l(64," \u8F49\u5316\u6F0F\u6597 "),s(),r(65,"div",27),O(66,RW,8,7,"div",28,TW),s(),y(68,NW,2,0,"div",29),s(),r(69,"div",25)(70,"h3",26)(71,"span"),l(72,"\u{1F3C6}"),s(),l(73," \u6700\u4F73\u89D2\u8272\u7D44\u5408 "),s(),r(74,"div",27),O(75,LW,19,9,"div",30,kW),y(77,OW,5,0,"div",29),s()()(),r(78,"div",25)(79,"h3",26)(80,"span"),l(81,"\u{1F465}"),s(),l(82," \u7528\u6236\u4E92\u52D5\u5206\u6790 "),s(),r(83,"div",11)(84,"div",31)(85,"div",32),l(86),s(),r(87,"div",33),l(88,"\u5E73\u5747\u8208\u8DA3\u5EA6"),s()(),r(89,"div",31)(90,"div",34),l(91),s(),r(92,"div",33),l(93,"\u5E73\u5747\u53C3\u8207\u5EA6"),s()(),r(94,"div",31)(95,"div",35),l(96),s(),r(97,"div",33),l(98,"\u7528\u6236\u756B\u50CF\u6578"),s()(),r(99,"div",31)(100,"div",36),l(101),s(),r(102,"div",33),l(103,"\u89D2\u8272\u7D44\u5408\u6578"),s()()()(),r(104,"div",25)(105,"div",37)(106,"h3",38)(107,"span"),l(108,"\u{1F4C5}"),s(),l(109," \u4ECA\u65E5\u8A73\u60C5 "),s(),r(110,"span",17),l(111),s()(),r(112,"div",39)(113,"div",40)(114,"div",41),l(115),s(),r(116,"div",42),l(117,"\u6703\u8A71"),s()(),r(118,"div",40)(119,"div",43),l(120),s(),r(121,"div",42),l(122,"\u8F49\u5316"),s()(),r(123,"div",40)(124,"div",44),l(125),s(),r(126,"div",42),l(127,"\u8F49\u5316\u7387"),s()(),r(128,"div",40)(129,"div",45),l(130),s(),r(131,"div",42),l(132,"\u6D88\u606F\u6578"),s()(),r(133,"div",40)(134,"div",46),l(135),s(),r(136,"div",42),l(137,"\u6536\u5165"),s()()()(),y(138,UW,16,2,"div",47),s()),t&2&&(c(10),H("ngModel",n.selectedPeriod),c(18),S(n.comparison().changes.sessions!==0?28:-1),c(2),D(n.totalStats().totalSessions),c(7),S(n.comparison().changes.conversions!==0?37:-1),c(2),D(n.totalStats().conversions),c(8),M("",n.totalStats().conversionRate.toFixed(1),"%"),c(7),S(n.comparison().changes.revenue!==0?54:-1),c(2),M("\xA5",n.formatNumber(n.totalStats().totalRevenue)),c(10),U(n.funnelData()),c(2),S(n.funnelData().length===0?68:-1),c(7),U(n.topCombos()),c(2),S(n.topCombos().length===0?77:-1),c(9),D(n.totalStats().avgInterestScore.toFixed(0)),c(5),D(n.totalStats().avgEngagementScore.toFixed(0)),c(5),D(n.userProfiles().length),c(5),D(n.roleCombos().length),c(10),D(n.todayDate),c(4),D(n.todayReport().totalSessions),c(5),D(n.todayReport().conversions),c(5),M("",n.todayReport().conversionRate.toFixed(1),"%"),c(5),D(n.todayReport().totalMessages),c(5),M("\xA5",n.formatNumber(n.todayReport().totalRevenue)),c(3),S(n.recommendedCombo()?138:-1))},dependencies:[oe,ae,Re,Ne,Ge,ve,he],styles:[".marketing-report[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}"]})}};var GW=["onboardingRef"],$W=["monitoringGroupsRef"],xd=(i,e)=>e.id,HW=(i,e)=>e.name,qW=(i,e)=>e.phone;function WW(i,e){if(i&1&&(r(0,"div",10)(1,"div",11),B(2,"div",12)(3,"div",13),s(),r(4,"div",14)(5,"p",15),l(6),s(),r(7,"div",16),B(8,"div",17),s()()()),i&2){let t=m(2);c(6),D(t.backendConnectionMessage()),c(2),ee("width",t.backendConnectionProgress(),"%")}}function zW(i,e){if(i&1){let t=I();r(0,"div",10)(1,"div",18)(2,"span",19),l(3,"\u26A0\uFE0F"),s()(),r(4,"div",14)(5,"p",15),l(6),s(),r(7,"button",20),x("click",function(){_(t);let o=m(2);return v(o.retryConnection())}),l(8," \u91CD\u65B0\u9023\u63A5 "),s()()()}if(i&2){let t=m(2);c(6),D(t.backendConnectionMessage())}}function KW(i,e){if(i&1){let t=I();r(0,"div",10)(1,"div",21)(2,"span",22),l(3,"\u274C"),s()(),r(4,"div",14)(5,"p",15),l(6),s(),r(7,"button",20),x("click",function(){_(t);let o=m(2);return v(o.retryConnection())}),l(8," \u91CD\u8A66 "),s()()()}if(i&2){let t=m(2);c(6),D(t.backendConnectionMessage())}}function jW(i,e){if(i&1&&(r(0,"div",1)(1,"div",9),y(2,WW,9,3,"div",10),y(3,zW,9,1,"div",10),y(4,KW,9,1,"div",10),s()()),i&2){let t=m();c(2),S(t.backendConnectionState()==="connecting"?2:-1),c(),S(t.backendConnectionState()==="timeout"?3:-1),c(),S(t.backendConnectionState()==="error"?4:-1)}}function JW(i,e){if(i&1&&(r(0,"p",32),l(1),s()),i&2){let t,n=m(2);c(),D((t=n.successOverlayConfig())==null?null:t.subtitle)}}function QW(i,e){if(i&1&&(r(0,"div",2),B(1,"div",23),r(2,"div",24),B(3,"div",25),r(4,"div",26)(5,"div",27)(6,"div",28)(7,"span",29),l(8),s()()(),r(9,"div",30)(10,"h3",31),l(11),s(),y(12,JW,2,1,"p",32),s(),B(13,"div",33)(14,"div",34)(15,"div",35)(16,"div",36),s()()()),i&2){let t,n,o,a=m();c(8),D(((t=a.successOverlayConfig())==null?null:t.icon)||"\u2705"),c(3),D(((n=a.successOverlayConfig())==null?null:n.title)||"\u64CD\u4F5C\u6210\u529F"),c(),S((o=a.successOverlayConfig())!=null&&o.subtitle?12:-1)}}function YW(i,e){if(i&1){let t=I();r(0,"div",7)(1,"div",37),x("click",function(){_(t);let o=m();return v(o.closeQrLogin())}),s(),r(2,"div",38)(3,"app-qr-login",39),x("closed",function(){_(t);let o=m();return v(o.closeQrLogin())})("loginSuccess",function(o){_(t);let a=m();return v(a.onQrLoginSuccess(o))}),s()()()}}function XW(i,e){i&1&&B(0,"app-login")}function ZW(i,e){if(i&1&&(r(0,"p",125),l(1," \u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236 "),r(2,"span",131),l(3),s(),l(4," \u55CE\uFF1F "),s()),i&2){let t,n=m(3);c(3),M("@",((t=n.deleteConfirmDialog().lead)==null?null:t.username)||((t=n.deleteConfirmDialog().lead)==null?null:t.userId))}}function ez(i,e){if(i&1&&(r(0,"p",125),l(1," \u78BA\u5B9A\u8981\u522A\u9664 "),r(2,"span",132),l(3),s(),l(4," \u500B\u9078\u4E2D\u7684\u5BA2\u6236\u55CE\uFF1F "),s()),i&2){let t=m(3);c(3),D(t.deleteConfirmDialog().count)}}function tz(i,e){if(i&1){let t=I();r(0,"div",115),x("click",function(){_(t);let o=m(2);return v(o.cancelDeleteLeads())}),r(1,"div",116),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",117)(3,"div",118),ne(),r(4,"svg",119),B(5,"path",120)(6,"line",121)(7,"line",122),s()(),ce(),r(8,"h3",123),l(9,"\u78BA\u8A8D\u522A\u9664"),s()(),r(10,"div",124),y(11,ZW,5,1,"p",125)(12,ez,5,1,"p",125),r(13,"div",126),l(14," \u26A0\uFE0F \u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\uFF0C\u6240\u6709\u76F8\u95DC\u8A18\u9304\u5C07\u88AB\u6C38\u4E45\u522A\u9664\u3002 "),s()(),r(15,"div",127)(16,"button",128),x("click",function(){_(t);let o=m(2);return v(o.cancelDeleteLeads())}),l(17," \u53D6\u6D88 "),s(),r(18,"button",129),x("click",function(){_(t);let o=m(2);return v(o.executeDeleteLeads())}),ne(),r(19,"svg",130),B(20,"path",120),s(),l(21," \u78BA\u8A8D\u522A\u9664 "),s()()()()}if(i&2){let t=m(2);c(11),S(t.deleteConfirmDialog().type==="single"?11:12)}}function nz(i,e){if(i&1){let t=I();r(0,"div",136)(1,"p",140),l(2,"\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44"),s(),r(3,"button",141),x("click",function(){_(t);let o=m(3);return o.currentView.set("multi-role"),v(o.showInviteGroupDialog.set(!1))}),l(4," \u53BB\u5275\u5EFA\u7FA4\u7D44 \u2192 "),s()()}}function iz(i,e){if(i&1){let t=I();r(0,"button",143),x("click",function(){let o=_(t).$implicit,a=m(4);return v(a.executeInviteToGroup(o.id))}),r(1,"div",144)(2,"div")(3,"p",145),l(4),s(),r(5,"p",146),l(6),s()(),r(7,"span",147),l(8,"\u2192"),s()()()}if(i&2){let t=e.$implicit;c(4),D(t.name),c(2),M("",(t.members==null?null:t.members.length)||0," \u500B\u6210\u54E1")}}function oz(i,e){if(i&1&&(r(0,"div",137),O(1,iz,9,2,"button",142,xd),s()),i&2){let t=m(3);c(),U(t.collabGroups())}}function rz(i,e){if(i&1){let t=I();r(0,"div",115),x("click",function(){_(t);let o=m(2);return v(o.showInviteGroupDialog.set(!1))}),r(1,"div",116),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",117)(3,"div",133)(4,"span",134),l(5,"\u{1F465}"),s()(),r(6,"div")(7,"h3",123),l(8,"\u9080\u8ACB\u9032\u7FA4"),s(),r(9,"p",32),l(10,"\u9078\u64C7\u5354\u4F5C\u7FA4\u7D44"),s()()(),r(11,"div",135),y(12,nz,5,0,"div",136)(13,oz,3,0,"div",137),s(),r(14,"div",138)(15,"button",139),x("click",function(){_(t);let o=m(2);return v(o.showInviteGroupDialog.set(!1))}),l(16," \u53D6\u6D88 "),s()()()()}if(i&2){let t=m(2);c(12),S(t.collabGroups().length===0?12:13)}}function sz(i,e){if(i&1&&(r(0,"div")(1,"h1",148),l(2),s(),r(3,"p",149),l(4),s()()),i&2){let t=m(2);c(2),D(t.t("title")),c(2),D(t.t("subtitle"))}}function az(i,e){i&1&&(r(0,"span",151),l(1,"\u{1F948}"),s())}function lz(i,e){i&1&&(r(0,"span",151),l(1,"\u{1F947}"),s())}function cz(i,e){i&1&&(r(0,"span",151),l(1,"\u{1F48E}"),s())}function dz(i,e){i&1&&(r(0,"span",151),l(1,"\u{1F31F}"),s())}function uz(i,e){i&1&&(r(0,"span",152),l(1,"\u{1F451}"),s())}function mz(i,e){if(i&1&&(r(0,"div",150),y(1,az,2,0,"span",151)(2,lz,2,0,"span",151)(3,cz,2,0,"span",151)(4,dz,2,0,"span",151)(5,uz,2,0,"span",152),s()),i&2){let t,n=m(2);N("badge-silver",n.userMembershipLevel()==="silver")("badge-gold",n.userMembershipLevel()==="gold")("badge-diamond",n.userMembershipLevel()==="diamond")("badge-star",n.userMembershipLevel()==="star")("badge-king",n.userMembershipLevel()==="king"),c(),S((t=n.userMembershipLevel())==="silver"?1:t==="gold"?2:t==="diamond"?3:t==="star"?4:t==="king"?5:-1)}}function pz(i,e){i&1&&(r(0,"span",72)(1,"span",153),l(2,"\u{1F948}"),s(),r(3,"span",154),l(4,"\u767D\u9280\u7CBE\u82F1"),s()())}function gz(i,e){i&1&&(r(0,"span",73)(1,"span",153),l(2,"\u{1F947}"),s(),r(3,"span",154),l(4,"\u9EC3\u91D1\u5927\u5E2B"),s()())}function hz(i,e){i&1&&(r(0,"span",74)(1,"span",153),l(2,"\u{1F48E}"),s(),r(3,"span",154),l(4,"\u947D\u77F3\u738B\u724C"),s()())}function fz(i,e){i&1&&(r(0,"span",75)(1,"span",153),l(2,"\u{1F31F}"),s(),r(3,"span",154),l(4,"\u661F\u8000\u50B3\u8AAA"),s()())}function _z(i,e){i&1&&(r(0,"span",76)(1,"span",153),l(2,"\u{1F451}"),s(),r(3,"span",154),l(4,"\u69AE\u8000\u738B\u8005"),s()())}function vz(i,e){i&1&&(r(0,"span",77)(1,"span",153),l(2,"\u2694\uFE0F"),s(),r(3,"span",154),l(4,"\u9752\u9285\u6230\u58EB"),s()())}function xz(i,e){if(i&1){let t=I();r(0,"div",94)(1,"a",155),x("click",function(){_(t);let o=m(2);return v(o.changeView("accounts"))}),ne(),r(2,"svg",83),B(3,"path",156)(4,"circle",157)(5,"path",158)(6,"path",159),s(),ce(),r(7,"span"),l(8),s()(),r(9,"a",160),x("click",function(){_(t);let o=m(2);return v(o.changeView("search-discovery"))}),ne(),r(10,"svg",83),B(11,"circle",161)(12,"path",162),s(),ce(),r(13,"span"),l(14,"\u641C\u7D22\u767C\u73FE"),s(),r(15,"span",163),l(16,"NEW"),s()(),r(17,"a",164),x("click",function(){_(t);let o=m(2);return v(o.changeView("resource-center"))}),ne(),r(18,"svg",83),B(19,"ellipse",165)(20,"path",166)(21,"path",167),s(),ce(),r(22,"span"),l(23,"\u8CC7\u6E90\u4E2D\u5FC3"),s()(),r(24,"a",82),x("click",function(){_(t);let o=m(2);return v(o.changeView("leads"))}),ne(),r(25,"svg",83),B(26,"path",168)(27,"path",169),s(),ce(),r(28,"span"),l(29,"\u767C\u9001\u63A7\u5236\u53F0"),s()()()}if(i&2){m();let t=di(50),n=m();c(),ee("background-color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-item-active)":"transparent")("color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-text-active)":"var(--sidebar-text)"),N("active",t==="accounts"||t==="add-account"||t==="api-credentials"),c(7),D(n.t("accounts")),c(),ee("background-color",t==="search-discovery"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="search-discovery"?"#22d3ee":"var(--sidebar-text)"),N("active",t==="search-discovery"),c(8),ee("background-color",t==="resource-center"||t==="resources"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="resource-center"||t==="resources"?"#22d3ee":"var(--sidebar-text)"),N("active",t==="resource-center"||t==="resources"),c(7),ee("background-color",t==="leads"?"var(--sidebar-item-active)":"transparent")("color",t==="leads"?"var(--sidebar-text-active)":"var(--sidebar-text)"),N("active",t==="leads")}}function Cz(i,e){if(i&1){let t=I();r(0,"div",94)(1,"a",170),x("click",function(){_(t);let o=m(2);return v(o.changeView("automation"))}),r(2,"div",171)(3,"span",172),l(4,"\u{1F4CA}"),s()(),r(5,"div",173)(6,"span",174),l(7,"\u81EA\u52D5\u5316\u7E3D\u89BD"),s(),r(8,"span",175),l(9,"\u914D\u7F6E\u8207\u76E3\u63A7\u72C0\u614B"),s()()(),r(10,"a",176),x("click",function(){_(t);let o=m(2);return v(o.changeView("monitoring-accounts"))}),r(11,"span",177),l(12,"\u{1F4F1}"),s(),r(13,"span"),l(14,"\u76E3\u63A7\u5E33\u865F"),s()(),r(15,"a",176),x("click",function(){_(t);let o=m(2);return v(o.changeView("monitoring-groups"))}),r(16,"span",177),l(17,"\u{1F4AC}"),s(),r(18,"span"),l(19,"\u76E3\u63A7\u7FA4\u7D44"),s()(),r(20,"a",176),x("click",function(){_(t);let o=m(2);return v(o.changeView("keyword-sets"))}),r(21,"span",177),l(22,"\u{1F511}"),s(),r(23,"span"),l(24,"\u95DC\u9375\u8A5E\u96C6"),s()(),r(25,"a",176),x("click",function(){_(t);let o=m(2);return v(o.changeView("chat-templates"))}),r(26,"span",177),l(27,"\u{1F4DD}"),s(),r(28,"span"),l(29,"\u804A\u5929\u6A21\u677F"),s()(),r(30,"a",176),x("click",function(){_(t);let o=m(2);return v(o.changeView("trigger-rules"))}),r(31,"span",177),l(32,"\u26A1"),s(),r(33,"span"),l(34,"\u89F8\u767C\u898F\u5247"),s()(),r(35,"a",176),x("click",function(){_(t);let o=m(2);return v(o.changeView("collected-users"))}),r(36,"span",177),l(37,"\u{1F465}"),s(),r(38,"span"),l(39,"\u6536\u96C6\u7528\u6236"),s(),r(40,"span",178),l(41,"NEW"),s()()()}if(i&2){m();let t=di(50);c(),ee("background-color",t==="automation"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="automation"?"#22d3ee":"var(--sidebar-text)"),N("active",t==="automation"),c(),N("bg-gradient-to-br",t==="automation")("from-cyan-500",t==="automation")("to-blue-500",t==="automation")("bg-slate-700/50",t!=="automation")("group-hover:bg-slate-700",t!=="automation"),c(8),ee("background-color",t==="monitoring-accounts"?"rgba(6, 182, 212, 0.1)":"transparent")("color",t==="monitoring-accounts"?"#22d3ee":"var(--sidebar-text)"),N("active",t==="monitoring-accounts"),c(5),ee("background-color",t==="monitoring-groups"?"rgba(16, 185, 129, 0.1)":"transparent")("color",t==="monitoring-groups"?"#34d399":"var(--sidebar-text)"),N("active",t==="monitoring-groups"),c(5),ee("background-color",t==="keyword-sets"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="keyword-sets"?"#a78bfa":"var(--sidebar-text)"),N("active",t==="keyword-sets"),c(5),ee("background-color",t==="chat-templates"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="chat-templates"?"#f472b6":"var(--sidebar-text)"),N("active",t==="chat-templates"),c(5),ee("background-color",t==="trigger-rules"?"rgba(251, 146, 60, 0.1)":"transparent")("color",t==="trigger-rules"?"#fb923c":"var(--sidebar-text)"),N("active",t==="trigger-rules"),c(5),ee("background-color",t==="collected-users"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="collected-users"?"#a78bfa":"var(--sidebar-text)"),N("active",t==="collected-users")}}function bz(i,e){i&1&&(r(0,"span",180),l(1,"1"),s())}function yz(i,e){i&1&&(r(0,"span",181),l(1,"\u{1F48E}"),s())}function Sz(i,e){i&1&&(r(0,"span",183),l(1,"2"),s())}function wz(i,e){i&1&&(r(0,"span",181),l(1,"\u{1F48E}"),s())}function Ez(i,e){i&1&&(r(0,"span",184),l(1,"3"),s())}function Dz(i,e){i&1&&(r(0,"span",181),l(1,"\u{1F947}"),s())}function Az(i,e){if(i&1){let t=I();r(0,"div",94)(1,"a",179),x("click",function(){_(t);let o=m(2);return v(o.changeView("ai-assistant"))}),r(2,"div",171)(3,"span",172),l(4,"\u{1F3AF}"),s()(),r(5,"div",173)(6,"span",174),l(7,"\u7B56\u7565\u898F\u5283"),s(),r(8,"span",175),l(9,"AI \u71DF\u92B7\u52A9\u624B"),s()(),y(10,bz,2,0,"span",180)(11,yz,2,0,"span",181),s(),r(12,"a",182),x("click",function(){_(t);let o=m(2);return v(o.changeView("ai-team"))}),r(13,"div",171)(14,"span",172),l(15,"\u{1F916}"),s()(),r(16,"div",173)(17,"span",174),l(18,"\u81EA\u52D5\u57F7\u884C"),s(),r(19,"span",175),l(20,"AI \u5718\u968A\u92B7\u552E"),s()(),y(21,Sz,2,0,"span",183)(22,wz,2,0,"span",181),s(),r(23,"a",182),x("click",function(){_(t);let o=m(2);return v(o.changeView("analytics"))}),r(24,"div",171)(25,"span",172),l(26,"\u{1F4CA}"),s()(),r(27,"div",173)(28,"span",174),l(29,"\u6578\u64DA\u6D1E\u5BDF"),s(),r(30,"span",175),l(31,"\u667A\u80FD\u5206\u6790\u5831\u544A"),s()(),y(32,Ez,2,0,"span",184)(33,Dz,2,0,"span",181),s()()}if(i&2){m();let t=di(50),n=m();c(),ee("background-color",t==="ai-assistant"?"rgba(249, 115, 22, 0.15)":"transparent")("color",t==="ai-assistant"?"#fb923c":"var(--sidebar-text)"),N("active",t==="ai-assistant")("opacity-50",!n.membershipService.hasFeature("strategyPlanning")),L("title",n.membershipService.hasFeature("strategyPlanning")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),c(),N("bg-gradient-to-br",t==="ai-assistant")("from-orange-500",t==="ai-assistant")("to-amber-500",t==="ai-assistant")("bg-slate-700/50",t!=="ai-assistant")("group-hover:bg-slate-700",t!=="ai-assistant"),c(8),S(n.membershipService.hasFeature("strategyPlanning")?10:11),c(2),ee("background-color",t==="ai-team"?"rgba(168, 85, 247, 0.15)":"transparent")("color",t==="ai-team"?"#c084fc":"var(--sidebar-text)"),N("active",t==="ai-team")("opacity-50",!n.membershipService.hasFeature("autoExecution")),L("title",n.membershipService.hasFeature("autoExecution")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),c(),N("bg-gradient-to-br",t==="ai-team")("from-purple-500",t==="ai-team")("to-pink-500",t==="ai-team")("bg-slate-700/50",t!=="ai-team")("group-hover:bg-slate-700",t!=="ai-team"),c(8),S(n.membershipService.hasFeature("autoExecution")?21:22),c(2),ee("background-color",t==="analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics"?"#22d3ee":"var(--sidebar-text)"),N("active",t==="analytics")("opacity-50",!n.membershipService.hasFeature("dataInsightsBasic")),L("title",n.membershipService.hasFeature("dataInsightsBasic")?"":"\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),c(),N("bg-gradient-to-br",t==="analytics")("from-cyan-500",t==="analytics")("to-blue-500",t==="analytics")("bg-slate-700/50",t!=="analytics")("group-hover:bg-slate-700",t!=="analytics"),c(8),S(n.membershipService.hasFeature("dataInsightsBasic")?32:33)}}function Mz(i,e){i&1&&(r(0,"span",192),l(1,"\u{1F48E}"),s())}function Tz(i,e){if(i&1){let t=I();r(0,"div",94)(1,"a",82),x("click",function(){_(t);let o=m(2);return v(o.changeView("analytics-center"))}),ne(),r(2,"svg",83),B(3,"path",185)(4,"path",186)(5,"path",187),s(),ce(),r(6,"span"),l(7,"\u5206\u6790\u4E2D\u5FC3"),s()(),r(8,"a",82),x("click",function(){_(t);let o=m(2);return v(o.changeView("lead-nurturing"))}),ne(),r(9,"svg",83),B(10,"path",188)(11,"circle",189),s(),ce(),r(12,"span"),l(13,"\u5BA2\u6236\u57F9\u80B2"),s(),r(14,"span",190),l(15,"AI"),s()(),r(16,"a",191),x("click",function(){_(t);let o=m(2);return o.changeView("multi-role"),v(o.loadMultiRoleData())}),ne(),r(17,"svg",83),B(18,"path",156)(19,"circle",157)(20,"path",158)(21,"path",159),s(),ce(),r(22,"span"),l(23,"\u591A\u89D2\u8272\u5354\u4F5C"),s(),y(24,Mz,2,0,"span",192),s()()}if(i&2){m();let t=di(50),n=m();c(),ee("background-color",t==="analytics-center"||t==="nurturing-analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics-center"||t==="nurturing-analytics"?"#22d3ee":"var(--sidebar-text)"),N("active",t==="analytics-center"||t==="nurturing-analytics"),c(7),ee("background-color",t==="lead-nurturing"?"rgba(236, 72, 153, 0.15)":"transparent")("color",t==="lead-nurturing"?"#f472b6":"var(--sidebar-text)"),N("active",t==="lead-nurturing"),c(8),ee("background-color",t==="multi-role"?"rgba(99, 102, 241, 0.15)":"transparent")("color",t==="multi-role"?"#a5b4fc":n.membershipService.hasFeature("multiRole")?"var(--sidebar-text)":"var(--sidebar-text-muted)"),N("active",t==="multi-role")("opacity-50",!n.membershipService.hasFeature("multiRole"))("cursor-not-allowed",!n.membershipService.hasFeature("multiRole")),L("title",n.membershipService.hasFeature("multiRole")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),c(8),S(n.membershipService.hasFeature("multiRole")?-1:24)}}function kz(i,e){if(i&1&&(r(0,"span",199),l(1),s()),i&2){let t=m(4);c(),D(t.ragBrainService.gapsCount())}}function Iz(i,e){if(i&1){let t=I();r(0,"div",195)(1,"a",197),x("click",function(){_(t);let o=m(3);return v(o.changeView("knowledge-brain"))}),r(2,"span"),l(3,"\u{1F4CA}"),s(),r(4,"span"),l(5,"\u7E3D\u89BD"),s()(),r(6,"a",197),x("click",function(){_(t);let o=m(3);return v(o.changeView("knowledge-manage"))}),r(7,"span"),l(8,"\u{1F4DD}"),s(),r(9,"span"),l(10,"\u77E5\u8B58\u7BA1\u7406"),s()(),r(11,"a",198),x("click",function(){_(t);let o=m(3);return v(o.changeView("knowledge-gaps"))}),r(12,"span"),l(13,"\u2753"),s(),r(14,"span"),l(15,"\u77E5\u8B58\u7F3A\u53E3"),s(),y(16,kz,2,1,"span",199),s()()}if(i&2){m(2);let t=di(50),n=m();c(),ee("background-color",t==="knowledge-brain"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-brain"?"#f472b6":"var(--sidebar-text-muted)"),N("active",t==="knowledge-brain"),c(5),ee("background-color",t==="knowledge-manage"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-manage"?"#f472b6":"var(--sidebar-text-muted)"),N("active",t==="knowledge-manage"),c(5),ee("background-color",t==="knowledge-gaps"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-gaps"?"#f472b6":"var(--sidebar-text-muted)"),N("active",t==="knowledge-gaps"),c(5),S(n.ragBrainService.gapsCount()>0?16:-1)}}function Fz(i,e){if(i&1){let t=I();r(0,"div",94)(1,"div",193)(2,"a",82),x("click",function(){_(t);let o=m(2);return v(o.toggleKnowledgeMenu())}),r(3,"span",172),l(4,"\u{1F9E0}"),s(),r(5,"span",14),l(6,"\u77E5\u8B58\u5927\u8166"),s(),r(7,"span",194),l(8,"\u25BC"),s()(),y(9,Iz,17,19,"div",195),s(),r(10,"a",82),x("click",function(){_(t);let o=m(2);return v(o.changeView("ai-center"))}),ne(),r(11,"svg",83),B(12,"path",196),s(),ce(),r(13,"span"),l(14),s()()()}if(i&2){m();let t=di(50),n=m();c(2),ee("background-color",n.isKnowledgeView()?"rgba(236, 72, 153, 0.15)":"transparent")("color",n.isKnowledgeView()?"#f472b6":"var(--sidebar-text)"),N("active",n.isKnowledgeView()),c(5),N("rotate-180",n.knowledgeMenuExpanded()),c(2),S(n.knowledgeMenuExpanded()?9:-1),c(),ee("background-color",t==="ai-center"?"rgba(168, 85, 247, 0.15)":"transparent")("color",t==="ai-center"?"#c084fc":"var(--sidebar-text)"),N("active",t==="ai-center"),c(4),D(n.t("aiCenter"))}}function Pz(i,e){if(i&1){let t=I();r(0,"div",94)(1,"a",82),x("click",function(){_(t);let o=m(2);return v(o.changeView("settings"))}),ne(),r(2,"svg",83),B(3,"circle",200)(4,"path",201),s(),ce(),r(5,"span"),l(6),s()()()}if(i&2){m();let t=di(50),n=m();c(),ee("background-color",t==="settings"?"var(--sidebar-item-active)":"transparent")("color",t==="settings"?"var(--sidebar-text-active)":"var(--sidebar-text)"),N("active",t==="settings"),c(5),D(n.t("settings"))}}function Rz(i,e){i&1&&B(0,"app-dashboard-view")}function Nz(i,e){i&1&&B(0,"app-accounts-view")}function Vz(i,e){if(i&1){let t=I();r(0,"app-add-account-page",202),x("accountAdded",function(o){_(t);let a=m(2);return v(a.onAccountAdded(o))})("back",function(){_(t);let o=m(2);return v(o.changeView("accounts"))}),s()}}function Bz(i,e){i&1&&B(0,"app-api-credentials-view")}function Lz(i,e){i&1&&B(0,"app-settings-view")}function Oz(i,e){i&1&&B(0,"app-leads-view")}function Uz(i,e){i&1&&B(0,"app-automation-view")}function Gz(i,e){i&1&&B(0,"app-resource-discovery-view")}function $z(i,e){i&1&&B(0,"app-resource-discovery-view")}function Hz(i,e){i&1&&B(0,"app-ai-center-view")}function qz(i,e){i&1&&(r(0,"div",108),B(1,"app-ai-brain"),s())}function Wz(i,e){i&1&&(r(0,"div",109),B(1,"app-knowledge-gaps"),s())}function zz(i,e){i&1&&(r(0,"div",109),B(1,"app-knowledge-manage"),s())}function Kz(i,e){i&1&&B(0,"app-multi-role-view")}function jz(i,e){i&1&&B(0,"app-analytics-view")}function Jz(i,e){i&1&&B(0,"app-monitoring-view")}function Qz(i,e){i&1&&B(0,"app-monitoring-view")}function Yz(i,e){i&1&&B(0,"app-monitoring-view")}function Xz(i,e){i&1&&B(0,"app-monitoring-view")}function Zz(i,e){i&1&&B(0,"app-monitoring-view")}function eK(i,e){i&1&&B(0,"app-monitoring-view")}function tK(i,e){i&1&&B(0,"app-monitoring-view")}function nK(i,e){i&1&&B(0,"app-runtime-logs-view")}function iK(i,e){i&1&&B(0,"app-membership-center")}function oK(i,e){i&1&&B(0,"app-profile")}function rK(i,e){i&1&&B(0,"app-resource-center")}function sK(i,e){i&1&&B(0,"app-search-discovery")}function aK(i,e){i&1&&B(0,"app-ai-marketing-assistant")}function lK(i,e){i&1&&B(0,"app-ai-team-hub")}function cK(i,e){i&1&&B(0,"app-member-database")}function dK(i,e){i&1&&B(0,"app-leads-view")}function uK(i,e){i&1&&B(0,"app-analytics-view")}function mK(i,e){i&1&&B(0,"app-analytics-view")}function pK(i,e){i&1&&B(0,"app-automation-view")}function gK(i,e){i&1&&B(0,"app-automation-view")}function hK(i,e){i&1&&B(0,"app-analytics-view")}function fK(i,e){i&1&&B(0,"app-marketing-report")}function _K(i,e){i&1&&B(0,"app-runtime-logs-view")}function vK(i,e){i&1&&B(0,"app-runtime-logs-view")}function xK(i,e){i&1&&B(0,"app-runtime-logs-view")}function CK(i,e){i&1&&B(0,"app-dashboard-view")}function bK(i,e){if(i&1&&l(0),i&2){let t=m();M(" @",t.username," ")}}function yK(i,e){if(i&1&&l(0),i&2){let t=m();X(" ",t.firstName," ",t.lastName||""," ")}}function SK(i,e){if(i&1&&(l(0),Ee(1,"slice")),i&2){let t=m();M(" ID: ",Fi(1,1,t.userId,0,12)," ")}}function wK(i,e){if(i&1&&(r(0,"p",212),l(1),s()),i&2){let t=m();c(),M("\u{1F4F1} ",t.phone)}}function EK(i,e){if(i&1&&(r(0,"span",214),l(1),Ee(2,"slice"),s()),i&2){let t=m();c(),M("\u{1F4CD} ",Fi(2,1,t.sourceGroup,0,20))}}function DK(i,e){if(i&1&&(r(0,"span",215),l(1),Ee(2,"slice"),s()),i&2){let t=m();c(),M("\u{1F511} ",Fi(2,1,t.triggeredKeyword,0,15))}}function AK(i,e){if(i&1&&(r(0,"span",224),l(1),s()),i&2){let t=m(),n=m(2);de(n.getIntentLevelColor(t.intentLevel)),c(),X("",n.getIntentLevelEmoji(t.intentLevel)," ",n.t(t.intentLevel))}}function MK(i,e){if(i&1&&(r(0,"option",228),l(1),s()),i&2){let t=m(4);c(),D(t.t("noSenderAccounts"))}}function TK(i,e){if(i&1&&(r(0,"option",249),l(1),s()),i&2){let t=e.$implicit,n=m(5);L("value",t.id),c(),X("",t.phone," (",t.username||n.t(t.status),")")}}function kK(i,e){if(i&1&&(r(0,"option",228),l(1,"\u9078\u64C7\u767C\u9001\u5E33\u865F..."),s(),O(2,TK,2,3,"option",249,xd)),i&2){let t=m(4);c(2),U(t.senderAccounts())}}function IK(i,e){if(i&1){let t=I();r(0,"div",229)(1,"p",250),l(2),s(),r(3,"a",251),x("click",function(){_(t);let o=m(4);return o.currentView.set("accounts"),v(o.closeLeadDetailModal())}),l(4,"\u524D\u5F80\u5E33\u865F\u7BA1\u7406 \u2192"),s()()}if(i&2){let t=m(4);c(2),M("\u26A0\uFE0F ",t.t("noSenderAccountsHint"))}}function FK(i,e){i&1&&(r(0,"span",253),l(1,"\u2713 \u5DF2\u9023\u63A5"),s())}function PK(i,e){i&1&&(r(0,"span",254),l(1,"\u{1F4DA} RAG \u5DF2\u555F\u7528"),s())}function RK(i,e){if(i&1&&l(0),i&2){let t=m(6);M(" | \u4F86\u6E90: ",t.generationState().lead.sourceGroup," ")}}function NK(i,e){if(i&1&&l(0),i&2){let t=m(6);M(" | \u89F8\u767C\u8A5E: ",t.generationState().lead.triggerKeyword," ")}}function VK(i,e){if(i&1&&(r(0,"div",255)(1,"strong",264),l(2,"\u5BA2\u6236\u8CC7\u8A0A\uFF1A"),s(),l(3),y(4,RK,1,1),y(5,NK,1,1),s()),i&2){let t=m(5);c(3),M(" @",t.generationState().lead.username," "),c(),S(t.generationState().lead.sourceGroup?4:-1),c(),S(t.generationState().lead.triggerKeyword?5:-1)}}function BK(i,e){if(i&1&&(r(0,"span",265),l(1,"\u27F3"),s(),r(2,"span"),l(3),s()),i&2){let t=m(5);c(3),D(t.t("generating"))}}function LK(i,e){if(i&1&&(r(0,"span"),l(1,"\u2728"),s(),r(2,"span"),l(3),s()),i&2){let t=m(5);c(3),D(t.t("generateWithAi"))}}function OK(i,e){if(i&1){let t=I();r(0,"button",266),x("click",function(){_(t);let o=m(5);return v(o.generateMessage())}),l(1," \u{1F504} "),s()}}function UK(i,e){if(i&1){let t=I();r(0,"div",261),l(1),r(2,"a",267),x("click",function(){_(t);let o=m(5);return o.currentView.set("settings"),v(o.closeLeadDetailModal())}),l(3),s()()}if(i&2){let t=m(5);c(),M(" \u26A0\uFE0F ",t.t("aiNotConfigured")," "),c(2),D(t.t("goToSettings"))}}function GK(i,e){if(i&1){let t=I();r(0,"div",262)(1,"strong"),l(2),s(),l(3),r(4,"button",268),x("click",function(){_(t);let o=m(5);return v(o.generateMessage())}),l(5,"\u91CD\u8A66"),s()()}if(i&2){let t=m(5);c(2),M("",t.t("error"),":"),c(),M(" ",t.generationState().error," ")}}function $K(i,e){i&1&&(r(0,"div",263)(1,"p",269),l(2,"\u2713 AI \u5DF2\u751F\u6210\u6D88\u606F\uFF0C\u60A8\u53EF\u4EE5\u5728\u4E0B\u65B9\u7DE8\u8F2F\u5F8C\u767C\u9001"),s()())}function HK(i,e){if(i&1){let t=I();r(0,"div",234)(1,"div",252)(2,"div",209)(3,"span",172),l(4,"\u{1F916}"),s(),r(5,"span",32),l(6),s(),y(7,FK,2,0,"span",253),s(),y(8,PK,2,0,"span",254),s(),y(9,VK,6,3,"div",255),r(10,"div")(11,"label",256),l(12),s(),r(13,"textarea",257),x("ngModelChange",function(o){_(t);let a=m(4);return v(a.updateCustomPrompt(o))}),l(14,"                        "),s()(),r(15,"div",258)(16,"button",259),x("click",function(){_(t);let o=m(4);return v(o.generateMessage())}),y(17,BK,4,1)(18,LK,4,1),s(),y(19,OK,2,0,"button",260),s(),y(20,UK,4,2,"div",261),y(21,GK,6,2,"div",262),y(22,$K,3,0,"div",263),s()}if(i&2){let t=m(4);c(6),M(" ",t.aiApiType()==="local"?"\u672C\u5730 AI":t.aiApiType()==="openai"?"OpenAI":t.aiApiType()==="custom"?"\u81EA\u5B9A\u7FA9 API":"Gemini"," "),c(),S(t.isAiConfigured()?7:-1),c(),S(t.ragEnabled()?8:-1),c(),S(t.generationState().lead?9:-1),c(3),D(t.t("customizePrompt")),c(),L("ngModel",t.generationState().customPrompt)("placeholder",t.t("aiPromptPlaceholder")),c(3),L("disabled",t.generationState().status==="loading"||!t.isAiConfigured()),c(),S(t.generationState().status==="loading"?17:18),c(2),S(t.generationState().status==="success"?19:-1),c(),S(t.isAiConfigured()?-1:20),c(),S(t.generationState().status==="error"?21:-1),c(),S(t.generationState().status==="success"&&t.generationState().generatedMessage?22:-1)}}function qK(i,e){if(i&1&&(r(0,"option",249),l(1),s()),i&2){let t=e.$implicit;L("value",t.id),c(),D(t.name)}}function WK(i,e){if(i&1){let t=I();r(0,"div",225)(1,"label",226),l(2),s(),r(3,"select",270),x("change",function(o){_(t);let a=m(4);return v(a.applyTemplate(o))}),r(4,"option",228),l(5),s(),O(6,qK,2,2,"option",249,xd),s()()}if(i&2){let t=m(4);c(2),M("\u{1F4CB} ",t.t("selectTemplate")),c(3),D(t.t("selectTemplatePlaceholder")),c(),U(t.messageTemplates())}}function zK(i,e){if(i&1){let t=I();r(0,"button",271),x("click",function(){_(t);let o=m(4);return v(o.addMoreAttachments("file"))}),l(1," \u2795 \u6DFB\u52A0\u66F4\u591A "),s(),r(2,"button",272),x("click",function(){_(t);let o=m(4);return v(o.clearAllAttachments())}),l(3," \u{1F5D1}\uFE0F \u6E05\u7A7A "),s()}}function KK(i,e){i&1&&(r(0,"span",277),l(1,"\u{1F5BC}\uFE0F"),s())}function jK(i,e){i&1&&(r(0,"span",278),l(1,"\u{1F4C4}"),s())}function JK(i,e){if(i&1&&(r(0,"span",280),l(1),s()),i&2){let t=m().$implicit;c(),M(" (",(t.fileSize/1024/1024).toFixed(2)," MB) ")}}function QK(i,e){i&1&&(r(0,"span",281),l(1,"\u2713"),s())}function YK(i,e){if(i&1){let t=I();r(0,"div",275)(1,"div",276),y(2,KK,2,0,"span",277)(3,jK,2,0,"span",278),r(4,"span",279),l(5),s(),y(6,JK,2,1,"span",280),y(7,QK,2,0,"span",281),s(),r(8,"button",282),x("click",function(){let o=_(t).$index,a=m(5);return v(a.removeAttachmentByIndex(o))}),l(9,"\xD7"),s()()}if(i&2){let t=e.$implicit;c(2),S(t.type==="image"?2:3),c(3),D(t.name),c(),S(t.fileSize?6:-1),c(),S(t.filePath?7:-1)}}function XK(i,e){if(i&1&&(r(0,"div",241)(1,"div",235)(2,"span",273),l(3),s(),r(4,"span",146),l(5),s()(),r(6,"div",274),O(7,YK,10,4,"div",275,HW),s()()),i&2){let t=m(4);c(3),M("\u{1F4CE} \u9644\u4EF6\u5217\u8868 (",t.generationState().attachments.length,")"),c(2),M(" \u7E3D\u5927\u5C0F: ",t.getTotalAttachmentSize()," MB "),c(2),U(t.generationState().attachments)}}function ZK(i,e){i&1&&l(0," \u26A0\uFE0F \u7121\u53EF\u7528\u767C\u9001\u5E33\u865F ")}function ej(i,e){i&1&&l(0," \u26A0\uFE0F \u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F ")}function tj(i,e){i&1&&l(0," \u26A0\uFE0F \u8ACB\u8F38\u5165\u8A0A\u606F\u5167\u5BB9\u6216\u6DFB\u52A0\u9644\u4EF6 ")}function nj(i,e){if(i&1&&(r(0,"div",242)(1,"p",283),y(2,ZK,1,0)(3,ej,1,0)(4,tj,1,0),s()()),i&2){let t=m(4);c(2),S(t.senderAccounts().length===0?2:t.selectedSenderId()?t.editableMessage().trim().length===0&&!t.generationState().attachment&&t.generationState().attachments.length===0?4:-1:3)}}function ij(i,e){i&1&&(r(0,"div",243)(1,"p",284),l(2,"\u{1F6AB} \u6B64\u5BA2\u6236\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE\uFF0C\u7121\u6CD5\u767C\u9001\u8A0A\u606F"),s()())}function oj(i,e){if(i&1){let t=I();r(0,"div",222)(1,"div",225)(2,"label",226),l(3),s(),r(4,"select",227),x("ngModelChange",function(o){_(t);let a=m(3);return v(a.selectedSenderId.set(o))}),y(5,MK,2,1,"option",228)(6,kK,4,0),s(),y(7,IK,5,1,"div",229),s(),r(8,"div",230)(9,"label",231),x("click",function(){_(t);let o=m(3);return v(o.messageMode.set("manual"))}),r(10,"div",232),l(11,"\u{1F4DD}"),s(),r(12,"span",233),l(13),s()(),r(14,"label",231),x("click",function(){_(t);let o=m(3);return v(o.messageMode.set("ai"))}),r(15,"div",232),l(16,"\u{1F916}"),s(),r(17,"span",233),l(18),s()(),r(19,"label",231),x("click",function(){_(t);let o=m(3);return v(o.messageMode.set("template"))}),r(20,"div",232),l(21,"\u{1F4CB}"),s(),r(22,"span",233),l(23),s()()(),y(24,HK,23,13,"div",234),y(25,WK,8,2,"div",225),r(26,"div",225)(27,"div",235)(28,"label",236),l(29),s(),r(30,"span",237),l(31),s()(),r(32,"textarea",238),x("ngModelChange",function(o){_(t);let a=m(3);return v(a.editableMessage.set(o))}),l(33,"                "),s()(),r(34,"div",234)(35,"div",239)(36,"button",240),x("click",function(){_(t);let o=m(3);return v(o.selectAttachment("image",!0))}),l(37),s(),r(38,"button",240),x("click",function(){_(t);let o=m(3);return v(o.selectAttachment("file",!0))}),l(39),s(),y(40,zK,4,0),s(),y(41,XK,9,2,"div",241),s(),y(42,nj,5,1,"div",242),y(43,ij,3,0,"div",243),r(44,"div",244)(45,"button",245),x("click",function(){_(t);let o=m(),a=m(2);return v(a.addToDoNotContact(o.id))}),l(46),s(),r(47,"div",246)(48,"button",247),x("click",function(){_(t);let o=m(3);return v(o.closeLeadDetailModal())}),l(49),s(),r(50,"button",248),x("click",function(){_(t);let o=m(3);return v(o.sendMessageToLead())}),l(51),s()()()()}if(i&2){let t=m(),n=m(2);c(3),M("\u{1F4E4} ",n.t("selectSenderAccount")),c(),L("ngModel",n.selectedSenderId()),c(),S(n.senderAccounts().length===0?5:6),c(2),S(n.senderAccounts().length===0?7:-1),c(2),de(n.messageMode()==="manual"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),c(4),D(n.t("manualInput")),c(),de(n.messageMode()==="ai"?"bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),c(4),D(n.t("aiGenerate")),c(),de(n.messageMode()==="template"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),c(4),D(n.t("useTemplate")),c(),S(n.messageMode()==="ai"?24:-1),c(),S(n.messageMode()==="template"?25:-1),c(4),M("\u270F\uFE0F ",n.t("messageContent")),c(2),X("",n.editableMessage().length," ",n.t("characters")),c(),L("ngModel",n.editableMessage())("placeholder",n.t("messageContentPlaceholder")),c(5),M(" \u{1F5BC}\uFE0F ",n.t("attachImage")," "),c(2),M(" \u{1F4CE} ",n.t("attachFile")," "),c(),S(n.generationState().attachments.length>0?40:-1),c(),S(n.generationState().attachments.length>0?41:-1),c(),S(!n.canSendMessage()&&!t.doNotContact?42:-1),c(),S(t.doNotContact?43:-1),c(2),L("disabled",t.doNotContact),c(),M(" \u{1F6AB} ",t.doNotContact?n.t("userOnDNC"):n.t("addToDNC")," "),c(3),M(" ",n.t("cancel")," "),c(),L("disabled",!n.canSendMessage()||t.doNotContact),c(),M(" \u2708\uFE0F ",n.t("sendMessage")," ")}}function rj(i,e){i&1&&(r(0,"span",265),l(1,"\u27F3"),s(),r(2,"span"),l(3,"\u52A0\u8F09\u4E2D..."),s())}function sj(i,e){i&1&&(r(0,"span"),l(1,"\u{1F4AC}"),s(),r(2,"span"),l(3,"\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304"),s())}function aj(i,e){if(i&1&&(r(0,"span",146),l(1),s()),i&2){let t=m(4);c(),M("\u5171 ",t.chatHistory().length," \u689D\u6D88\u606F")}}function lj(i,e){if(i&1&&(r(0,"div",295)(1,"div",297)(2,"div",298)(3,"p",299),l(4),s()(),r(5,"p",300),l(6),s()()()),i&2){let t=m().$implicit,n=m(5);c(4),D(t.content),c(2),D(n.formatTimestamp(t.timestamp))}}function cj(i,e){if(i&1&&(r(0,"div",296)(1,"div",297)(2,"div",301)(3,"p",299),l(4),s()(),r(5,"div",302)(6,"span",146),l(7),s(),r(8,"span",303),l(9,"\u{1F916} AI"),s()()()()),i&2){let t=m().$implicit,n=m(5);c(4),D(t.content),c(3),D(n.formatTimestamp(t.timestamp))}}function dj(i,e){if(i&1&&y(0,lj,7,2,"div",295)(1,cj,10,2,"div",296),i&2){let t=e.$implicit;S(t.role==="user"?0:t.role==="assistant"?1:-1)}}function uj(i,e){i&1&&(r(0,"div",293)(1,"span",304),l(2,"\u27F3"),s(),r(3,"span",305),l(4,"\u52A0\u8F09\u4E2D..."),s()())}function mj(i,e){if(i&1){let t=I();r(0,"div",294)(1,"button",306),x("click",function(){_(t);let o=m(5);return v(o.loadMoreChatHistory())}),l(2," \u52A0\u8F09\u66F4\u591A\u6D88\u606F "),s()()}}function pj(i,e){if(i&1){let t=I();r(0,"div",292),x("scroll",function(o){_(t);let a=m(4);return v(a.onChatHistoryScroll(o))}),O(1,dj,2,1,null,null,Fd().trackByChatMessageId,!0),y(3,uj,5,0,"div",293),y(4,mj,3,0,"div",294),s()}if(i&2){let t=m(4);c(),U(t.chatHistory()),c(2),S(t.chatHistoryLoadingMore()?3:-1),c(),S(t.chatHistoryHasMore()&&!t.chatHistoryLoadingMore()?4:-1)}}function gj(i,e){i&1&&(r(0,"span",303),l(1,"\u{1F916} AI"),s())}function hj(i,e){if(i&1&&(r(0,"div",296)(1,"div",297)(2,"div",301)(3,"p",299),l(4),s()(),r(5,"div",302)(6,"span",146),l(7),s(),y(8,gj,2,0,"span",303),s()()()),i&2){let t=m().$implicit,n=m(4);c(4),D(t.content),c(3),D(n.formatTimestamp(t.timestamp)),c(),S(t.type.includes("AI")?8:-1)}}function fj(i,e){if(i&1&&(r(0,"div",295)(1,"div",297)(2,"div",298)(3,"p",299),l(4),s()(),r(5,"p",300),l(6),s()()()),i&2){let t=m().$implicit,n=m(4);c(4),D(t.content),c(2),D(n.formatTimestamp(t.timestamp))}}function _j(i,e){if(i&1&&(r(0,"div",307)(1,"div",308),l(2),s()()),i&2){let t=m().$implicit,n=m(4);c(2),cn(" ",t.type,": ",t.content," \xB7 ",n.formatTimestamp(t.timestamp)," ")}}function vj(i,e){if(i&1&&y(0,hj,9,3,"div",296)(1,fj,7,2,"div",295)(2,_j,3,3,"div",307),i&2){let t=e.$implicit;S(t.type.includes("Sent")||t.type.includes("Message")?0:t.type.includes("Reply")||t.type.includes("Received")?1:2)}}function xj(i,e){if(i&1&&(r(0,"div",290)(1,"div",309),l(2,"\u{1F4AC}"),s(),r(3,"p",310),l(4),s(),r(5,"p",311),l(6,"\u9EDE\u64CA\u300C\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304\u300D\u67E5\u770B\u6240\u6709\u5C0D\u8A71"),s()()),i&2){let t=m(4);c(4),D(t.t("noHistoryFound"))}}function Cj(i,e){if(i&1&&(r(0,"div",291)(1,"h4",312)(2,"span"),l(3,"\u{1F4CA}"),s(),l(4," AI \u5C0D\u8A71\u5206\u6790 "),s(),r(5,"div",313)(6,"div",314)(7,"p",315),l(8,"\u7E3D\u4E92\u52D5"),s(),r(9,"p",123),l(10),s()(),r(11,"div",314)(12,"p",315),l(13,"\u5C0D\u8A71\u968E\u6BB5"),s(),r(14,"p",316),l(15),s()(),r(16,"div",314)(17,"p",315),l(18,"\u8208\u8DA3\u7A0B\u5EA6"),s(),r(19,"p",172),l(20,"\u2B50\u2B50\u2B50"),s()()()()),i&2){let t=m(2);c(10),D(t.interactionHistory.length),c(5),D(t.status||"\u521D\u6B21\u63A5\u89F8")}}function bj(i,e){if(i&1){let t=I();r(0,"div",223)(1,"div",285)(2,"button",286),x("click",function(){_(t);let o=m(),a=m(2);return v(a.loadChatHistory(o.userId))}),y(3,rj,4,0)(4,sj,4,0),s(),y(5,aj,2,1,"span",146),s(),y(6,pj,5,2,"div",287),r(7,"div",288)(8,"div",289),O(9,vj,3,1,null,null,Fd().trackByChatMessageId,!0),s()(),y(11,xj,7,1,"div",290),y(12,Cj,21,2,"div",291),s()}if(i&2){let t=m(),n=m(2);c(2),L("disabled",n.isLoadingChatHistory()),c(),S(n.isLoadingChatHistory()?3:4),c(2),S(n.selectedChatUserId()===t.userId&&n.chatHistory().length>0?5:-1),c(),S(n.selectedChatUserId()===t.userId&&n.chatHistory().length>0?6:-1),c(3),U(t.interactionHistory),c(2),S(t.interactionHistory.length===0&&(!n.selectedChatUserId()||n.chatHistory().length===0)?11:-1),c(),S(t.interactionHistory.length>0?12:-1)}}function yj(i,e){if(i&1){let t=I();r(0,"div",203),x("click",function(){_(t);let o=m(2);return v(o.closeLeadDetailModal())}),r(1,"div",204),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",205)(3,"div",206)(4,"div",207)(5,"div",208),l(6),s(),r(7,"div")(8,"div",209)(9,"h3",210),y(10,bK,1,1)(11,yK,1,2)(12,SK,2,5),s(),B(13,"span",211),s(),y(14,wK,2,1,"p",212),r(15,"div",213),y(16,EK,3,5,"span",214),y(17,DK,3,5,"span",215),y(18,AK,2,4,"span",216),s()()(),r(19,"button",217),x("click",function(){_(t);let o=m(2);return v(o.closeLeadDetailModal())}),l(20,"\u2715"),s()()(),r(21,"div",218)(22,"nav",219)(23,"a",220),x("click",function(){_(t);let o=m(2);return v(o.leadDetailView.set("sendMessage"))}),l(24),s(),r(25,"a",220),x("click",function(){_(t);let o=m(2);return v(o.leadDetailView.set("history"))}),l(26),s()()(),r(27,"div",221),y(28,oj,52,31,"div",222),y(29,bj,13,6,"div",223),s()()()}if(i&2){let t=e,n=m(2);c(6),M(" ",(t.username||t.firstName||t.userId||"?")[0].toUpperCase()," "),c(4),S(t.username?10:t.firstName?11:12),c(3),de(n.getOnlineStatusColor(t.onlineStatus)),c(),S(t.phone?14:-1),c(2),S(t.sourceGroup?16:-1),c(),S(t.triggeredKeyword&&t.triggeredKeyword!=="\u7121"?17:-1),c(),S(t.intentLevel?18:-1),c(5),N("border-cyan-400",n.leadDetailView()==="sendMessage")("text-cyan-400",n.leadDetailView()==="sendMessage")("bg-cyan-500/10",n.leadDetailView()==="sendMessage"),c(),M(" \u{1F4AC} ",n.t("sendMessageTab")," "),c(),N("border-cyan-400",n.leadDetailView()==="history")("text-cyan-400",n.leadDetailView()==="history")("bg-cyan-500/10",n.leadDetailView()==="history"),c(),M(" \u{1F4CB} ",n.t("historyTab")," "),c(2),S(n.leadDetailView()==="sendMessage"?28:-1),c(),S(n.leadDetailView()==="history"?29:-1)}}function Sj(i,e){i&1&&(r(0,"div",330),ne(),r(1,"svg",333),B(2,"circle",334)(3,"path",335),s(),ce(),r(4,"p"),l(5,"\u66AB\u7121\u64CD\u4F5C\u6B77\u53F2"),s()())}function wj(i,e){i&1&&(r(0,"span",340),l(1,"\uFF08\u5DF2\u64A4\u92B7\uFF09"),s())}function Ej(i,e){if(i&1&&(r(0,"span",341),l(1),s()),i&2){let t=m().$implicit;c(),M("",t.failureCount," \u5931\u6557")}}function Dj(i,e){if(i&1){let t=I();r(0,"button",343),x("click",function(){_(t);let o=m().$implicit,a=m(4);return v(a.undoBatchOperation(o.id))}),l(1," \u64A4\u92B7 "),s()}}function Aj(i,e){if(i&1&&(r(0,"div",337)(1,"div",144)(2,"div",10)(3,"div",338),ne(),r(4,"svg",130),B(5,"rect",85)(6,"rect",86)(7,"rect",87)(8,"rect",88),s()(),ce(),r(9,"div")(10,"p",339),l(11),s(),r(12,"p",146),l(13),y(14,wj,2,0,"span",340),s()()(),r(15,"div",10)(16,"div",299)(17,"span",277),l(18),s(),y(19,Ej,2,1,"span",341),s(),y(20,Dj,2,0,"button",342),s()()()),i&2){let t=e.$implicit,n=m(4);N("opacity-50",t.reversed),c(3),N("bg-cyan-500/20",t.operationType==="update_status")("bg-blue-500/20",t.operationType==="add_tag")("bg-red-500/20",t.operationType==="delete"||t.operationType==="add_to_dnc"),c(),N("text-cyan-400",t.operationType==="update_status")("text-blue-400",t.operationType==="add_tag")("text-red-400",t.operationType==="delete"||t.operationType==="add_to_dnc"),c(7),D(n.getOperationTypeName(t.operationType)),c(2),X(" ",t.itemCount," \u9805 \xB7 ",n.formatBatchOperationDate(t.createdAt)," "),c(),S(t.reversed?14:-1),c(4),M("",t.successCount," \u6210\u529F"),c(),S(t.failureCount>0?19:-1),c(),S(t.isReversible&&!t.reversed?20:-1)}}function Mj(i,e){if(i&1&&(r(0,"div",234),O(1,Aj,21,21,"div",336,xd),s()),i&2){let t=m(3);c(),U(t.batchOperationHistory())}}function Tj(i,e){if(i&1){let t=I();r(0,"div",317),x("click",function(){_(t);let o=m(2);return v(o.showBatchOperationHistory.set(!1))}),r(1,"div",318),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",319)(3,"h3",320),ne(),r(4,"svg",321),B(5,"path",322)(6,"path",323)(7,"path",324),s(),l(8," \u6279\u91CF\u64CD\u4F5C\u6B77\u53F2 "),s(),ce(),r(9,"button",325),x("click",function(){_(t);let o=m(2);return v(o.showBatchOperationHistory.set(!1))}),ne(),r(10,"svg",326),B(11,"line",327)(12,"line",328),s()()(),ce(),r(13,"div",329),y(14,Sj,6,0,"div",330)(15,Mj,3,0,"div",234),s(),r(16,"div",331)(17,"button",332),x("click",function(){_(t);let o=m(2);return v(o.showBatchOperationHistory.set(!1))}),l(18," \u95DC\u9589 "),s()()()()}if(i&2){let t=m(2);c(14),S(t.batchOperationHistory().length===0?14:15)}}function kj(i,e){i&1&&(r(0,"div",351)(1,"div",357)(2,"div",358)(3,"div",359),l(4,"\u{1F916}"),s(),r(5,"div",15),l(6,"AI \u81EA\u52D5\u56DE\u8986"),s(),r(7,"div",360),l(8,"\u667A\u80FD\u5BA2\u670D\u52A9\u624B"),s()(),r(9,"div",358)(10,"div",359),l(11,"\u{1F50D}"),s(),r(12,"div",15),l(13,"\u8CC7\u6E90\u767C\u73FE"),s(),r(14,"div",360),l(15,"\u81EA\u52D5\u641C\u7D22\u7FA4\u7D44"),s()(),r(16,"div",358)(17,"div",359),l(18,"\u{1F4CA}"),s(),r(19,"div",15),l(20,"\u6578\u64DA\u5206\u6790"),s(),r(21,"div",360),l(22,"\u8F49\u5316\u8FFD\u8E64\u5831\u8868"),s()()(),r(23,"p",361),l(24," TG-AI\u667A\u63A7\u738B \u5C07\u5E6B\u52A9\u60A8\u81EA\u52D5\u5316 Telegram \u71DF\u92B7\u6D41\u7A0B\uFF0C"),B(25,"br"),l(26," \u8B93\u60A8\u5C08\u6CE8\u65BC\u696D\u52D9\u589E\u9577\u800C\u975E\u91CD\u8907\u64CD\u4F5C\u3002 "),s()())}function Ij(i,e){if(i&1&&(r(0,"option",249),l(1),s()),i&2){let t=e.$implicit;L("value",t),c(),D(t)}}function Fj(i,e){if(i&1){let t=I();r(0,"select",370),x("ngModelChange",function(o){_(t);let a=m(5);return v(a.localAiModel.set(o))}),O(1,Ij,2,2,"option",249,be),s()}if(i&2){let t=m(5);L("ngModel",t.localAiModel()),c(),U(t.detectedOllamaModels())}}function Pj(i,e){if(i&1){let t=I();r(0,"input",371),x("ngModelChange",function(o){_(t);let a=m(5);return v(a.localAiModel.set(o))}),s()}if(i&2){let t=m(5);L("ngModel",t.localAiModel())}}function Rj(i,e){if(i&1&&(r(0,"div",358)(1,"label",367),l(2,"\u9078\u64C7 AI \u6A21\u578B"),s(),y(3,Fj,3,1,"select",368)(4,Pj,1,1,"input",369),r(5,"p",300),l(6,"\u63A8\u85A6\uFF1Aqwen2:7b\uFF08\u4E2D\u82F1\u6587\u901A\u7528\uFF09"),s()()),i&2){let t=m(4);c(3),S(t.detectedOllamaModels().length>0?3:4)}}function Nj(i,e){if(i&1){let t=I();r(0,"div",377)(1,"select",378),x("ngModelChange",function(o){_(t);let a=m(5);return v(a.aiBackupProvider.set(o))}),r(2,"option",379),l(3,"Google Gemini\uFF08\u514D\u8CBB\u984D\u5EA6\uFF09"),s(),r(4,"option",380),l(5,"OpenAI GPT"),s()()()}if(i&2){let t=m(5);c(),L("ngModel",t.aiBackupProvider())}}function Vj(i,e){if(i&1){let t=I();r(0,"div",358)(1,"div",372)(2,"p",174),l(3,"\u{1F4E6} \u5B89\u88DD Ollama\uFF08\u514D\u8CBB\uFF09\uFF1A"),s(),r(4,"code",373),l(5," curl -fsSL https://ollama.com/install.sh | sh "),s(),r(6,"p",146),l(7," \u5B89\u88DD\u5F8C\u904B\u884C "),r(8,"code",264),l(9,"ollama pull qwen2:7b"),s(),l(10," \u4E0B\u8F09\u6A21\u578B "),s()()(),r(11,"div",358)(12,"label",374)(13,"input",375),x("change",function(){_(t);let o=m(4);return v(o.aiAutoFallback.set(!o.aiAutoFallback()))}),s(),r(14,"span",376),l(15,"\u4F7F\u7528\u96F2\u7AEF AI \u4F5C\u70BA\u5099\u9078"),s()(),y(16,Nj,6,1,"div",377),s()}if(i&2){let t=m(4);c(13),L("checked",t.aiAutoFallback()),c(3),S(t.aiAutoFallback()?16:-1)}}function Bj(i,e){if(i&1){let t=I();r(0,"div",222)(1,"h3",362),l(2,"\u{1F999} AI \u670D\u52D9\u914D\u7F6E"),s(),r(3,"div",363)(4,"div",144)(5,"div",10)(6,"span",364),l(7),s(),r(8,"div")(9,"div",365),l(10),s(),r(11,"div",32),l(12),s()()(),r(13,"button",366),x("click",function(){_(t);let o=m(3);return v(o.detectOllama())}),l(14),s()()(),y(15,Rj,7,1,"div",358)(16,Vj,17,2),s()}if(i&2){let t=m(3);c(3),de(t.ollamaDetected()?"bg-green-500/20 border border-green-500/30":"bg-yellow-500/20 border border-yellow-500/30"),c(4),D(t.ollamaDetected()?"\u2705":"\u26A0\uFE0F"),c(3),M(" ",t.ollamaDetected()?"Ollama \u5DF2\u6AA2\u6E2C\u5230":"Ollama \u672A\u904B\u884C"," "),c(2),M(" ",t.ollamaDetected()?"\u672C\u5730 AI \u670D\u52D9\u53EF\u7528":"\u5EFA\u8B70\u5B89\u88DD Ollama \u7372\u5F97\u514D\u8CBB AI \u80FD\u529B"," "),c(),L("disabled",t.isDetectingOllama()),c(),M(" ",t.isDetectingOllama()?"\u6AA2\u6E2C\u4E2D...":"\u91CD\u65B0\u6AA2\u6E2C"," "),c(),S(t.ollamaDetected()?15:16)}}function Lj(i,e){if(i&1&&(r(0,"p"),l(1),s()),i&2){let t=m(4);c(),M("\u2705 \u6A21\u578B\uFF1A",t.localAiModel())}}function Oj(i,e){if(i&1&&(r(0,"div",351)(1,"div",381),l(2,"\u{1F389}"),s(),r(3,"h3",382),l(4,"\u8A2D\u7F6E\u5B8C\u6210\uFF01"),s(),r(5,"p",361),l(6," \u60A8\u5DF2\u6E96\u5099\u597D\u958B\u59CB\u4F7F\u7528 TG-AI\u667A\u63A7\u738B\u3002"),B(7,"br"),l(8," \u63A5\u4E0B\u4F86\u8ACB\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B Telegram \u5E33\u865F\u3002 "),s(),r(9,"div",383)(10,"div",384)(11,"p"),l(12),s(),y(13,Lj,2,1,"p"),r(14,"p"),l(15),s()()()()),i&2){let t=m(3);c(12),M("\u2705 AI \u670D\u52D9\uFF1A",t.ollamaDetected()?"Ollama \u672C\u5730 AI":"\u96F2\u7AEF AI"),c(),S(t.ollamaDetected()?13:-1),c(2),M("\u2705 \u81EA\u52D5\u964D\u7D1A\uFF1A",t.aiAutoFallback()?"\u5DF2\u555F\u7528":"\u5DF2\u7981\u7528")}}function Uj(i,e){if(i&1){let t=I();r(0,"button",385),x("click",function(){_(t);let o=m(3);return v(o.welcomeStep.set(o.welcomeStep()-1))}),l(1," \u4E0A\u4E00\u6B65 "),s()}}function Gj(i,e){if(i&1){let t=I();r(0,"button",386),x("click",function(){_(t);let o=m(3);return v(o.welcomeStep.set(o.welcomeStep()+1))}),l(1," \u4E0B\u4E00\u6B65 "),s()}}function $j(i,e){if(i&1){let t=I();r(0,"button",387),x("click",function(){_(t);let o=m(3);return v(o.completeFirstRunSetup())}),l(1," \u958B\u59CB\u4F7F\u7528 \u{1F680} "),s()}}function Hj(i,e){if(i&1){let t=I();r(0,"div",112)(1,"div",344)(2,"div",345)(3,"h1",346),l(4,"\u{1F680} \u6B61\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B"),s(),r(5,"p",347),l(6,"AI \u9A45\u52D5\u7684 Telegram \u71DF\u92B7\u81EA\u52D5\u5316\u5E73\u53F0"),s()(),r(7,"div",348),B(8,"div",349)(9,"div",349)(10,"div",349),s(),r(11,"div",350),y(12,kj,27,0,"div",351)(13,Bj,17,8,"div",222)(14,Oj,16,3,"div",351),s(),r(15,"div",352)(16,"button",353),x("click",function(){_(t);let o=m(2);return v(o.skipFirstRunSetup())}),l(17," \u8DF3\u904E\u8A2D\u7F6E "),s(),r(18,"div",246),y(19,Uj,2,0,"button",354),y(20,Gj,2,0,"button",355)(21,$j,2,0,"button",356),s()()()()}if(i&2){let t,n=m(2);c(8),de(n.welcomeStep()>=1?"bg-cyan-500":"bg-slate-600"),c(),de(n.welcomeStep()>=2?"bg-cyan-500":"bg-slate-600"),c(),de(n.welcomeStep()>=3?"bg-cyan-500":"bg-slate-600"),c(2),S((t=n.welcomeStep())===1?12:t===2?13:t===3?14:-1),c(7),S(n.welcomeStep()>1?19:-1),c(),S(n.welcomeStep()<3?20:21)}}function qj(i,e){if(i&1&&(r(0,"p",403),l(1),s()),i&2){let t=m().$implicit;c(),X(" \u2713 \u6709\u5143\u6578\u64DA: ",t.metadata.firstName||""," ",t.metadata.username?"@"+t.metadata.username:""," ")}}function Wj(i,e){i&1&&(r(0,"p",404),l(1,"\u26A0 \u7121\u5143\u6578\u64DA\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u9304\u9A57\u8B49"),s())}function zj(i,e){if(i&1&&(r(0,"div",396)(1,"div",10)(2,"span",364),l(3,"\u{1F4F1}"),s(),r(4,"div")(5,"p",402),l(6),s(),y(7,qj,2,2,"p",403)(8,Wj,2,0,"p",404),s()()()),i&2){let t=e.$implicit;c(6),M("+",t.phone),c(),S(t.hasMetadata&&t.metadata?7:8)}}function Kj(i,e){i&1&&(r(0,"span",265),l(1,"\u23F3"),s(),r(2,"span"),l(3,"\u6062\u5FA9\u4E2D..."),s())}function jj(i,e){i&1&&(r(0,"span"),l(1,"\u{1F504}"),s(),r(2,"span"),l(3,"\u6062\u5FA9\u5E33\u865F"),s())}function Jj(i,e){if(i&1){let t=I();r(0,"div",112)(1,"div",388)(2,"div",389)(3,"div",390),l(4,"\u{1F504}"),s(),r(5,"h2",391),l(6,"\u767C\u73FE\u53EF\u6062\u5FA9\u7684\u5E33\u865F"),s(),r(7,"p",392),l(8),s()(),r(9,"div",393)(10,"p",394),l(11," \u9019\u4E9B Session \u6587\u4EF6\u5B58\u5728\u65BC\u7CFB\u7D71\u4E2D\uFF0C\u4F46\u672A\u5728\u6578\u64DA\u5EAB\u4E2D\u627E\u5230\u5C0D\u61C9\u7684\u5E33\u865F\u8A18\u9304\u3002 \u60A8\u53EF\u4EE5\u5617\u8A66\u6062\u5FA9\u9019\u4E9B\u5E33\u865F\uFF0C\u6216\u9078\u64C7\u5FFD\u7565\u3002 "),s(),r(12,"div",395),O(13,zj,9,2,"div",396,qW),s(),r(15,"div",397)(16,"p",398),l(17," \u{1F4A1} "),r(18,"strong"),l(19,"\u63D0\u793A\uFF1A"),s(),l(20," \u6062\u5FA9\u5F8C\uFF0C\u5E33\u865F\u5C07\u4EE5\u300C\u96E2\u7DDA\u300D\u72C0\u614B\u6DFB\u52A0\u5230\u5217\u8868\u4E2D\u3002 \u60A8\u9700\u8981\u9EDE\u64CA\u300C\u767B\u9304\u300D\u4F86\u91CD\u65B0\u9023\u63A5\u5E33\u865F\u3002 "),s()()(),r(21,"div",399)(22,"button",400),x("click",function(){_(t);let o=m(2);return v(o.dismissOrphanSessionDialog())}),l(23," \u7A0D\u5F8C\u8655\u7406 "),s(),r(24,"button",401),x("click",function(){_(t);let o=m(2);return v(o.recoverOrphanSessions())}),y(25,Kj,4,0)(26,jj,4,0),s()()()()}if(i&2){let t=m(2);c(8),M(" \u767C\u73FE ",t.orphanSessions().length," \u500B Session \u6587\u4EF6\u9700\u8981\u624B\u52D5\u6062\u5FA9 "),c(5),U(t.orphanSessions()),c(11),L("disabled",t.isRecoveringOrphanSessions()),c(),S(t.isRecoveringOrphanSessions()?25:26)}}function Qj(i,e){if(i&1&&(r(0,"div",413)(1,"p",414)(2,"span",174),l(3,"\u932F\u8AA4\u8A73\u60C5\uFF1A"),s(),l(4),s()()),i&2){let t=m(3);c(4),M(" ",t.backendError()," ")}}function Yj(i,e){if(i&1){let t=I();r(0,"div",112)(1,"div",405)(2,"div",406)(3,"div",390),l(4,"\u26A0\uFE0F"),s(),r(5,"h2",407),l(6,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),s()(),r(7,"div",393)(8,"p",361),l(9," \u7A0B\u5E8F\u9700\u8981 Python \u74B0\u5883\u624D\u80FD\u6B63\u5E38\u904B\u884C\u3002\u8ACB\u78BA\u4FDD\uFF1A "),s(),r(10,"div",408)(11,"div",409)(12,"span",264),l(13,"1."),s(),r(14,"div")(15,"p",402),l(16,"\u5B89\u88DD Python 3.9+"),s(),r(17,"a",410),l(18," https://www.python.org/downloads/ "),s()()(),r(19,"div",409)(20,"span",264),l(21,"2."),s(),r(22,"div")(23,"p",402),l(24,'\u5B89\u88DD\u6642\u52FE\u9078 "Add Python to PATH"'),s(),r(25,"p",411),l(26,"\u78BA\u4FDD Python \u6DFB\u52A0\u5230\u7CFB\u7D71\u74B0\u5883\u8B8A\u91CF"),s()()(),r(27,"div",409)(28,"span",264),l(29,"3."),s(),r(30,"div")(31,"p",402),l(32,"\u5B89\u88DD\u4F9D\u8CF4"),s(),r(33,"code",412),l(34," pip install pyrogram tgcrypto aiosqlite "),s()()(),r(35,"div",409)(36,"span",264),l(37,"4."),s(),r(38,"div")(39,"p",402),l(40,"\u91CD\u65B0\u555F\u52D5\u7A0B\u5E8F"),s()()()(),y(41,Qj,5,1,"div",413),s(),r(42,"div",399)(43,"button",400),x("click",function(){_(t);let o=m(2);return v(o.showBackendErrorDialog.set(!1))}),l(44," \u6211\u77E5\u9053\u4E86 "),s()()()()}if(i&2){let t=m(2);c(41),S(t.backendError()?41:-1)}}function Xj(i,e){if(i&1){let t=I();r(0,"div",415),x("click",function(){_(t);let o=m(2);return v(o.showBackendErrorDialog.set(!0))}),r(1,"span",151),l(2,"\u26A0\uFE0F"),s(),r(3,"span",233),l(4,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),s()()}}function Zj(i,e){if(i&1){let t=I();r(0,"div",416),x("click",function(){_(t);let o=m(2);return v(o.cancelNewKeywordSet())}),r(1,"div",417),x("click",function(o){return _(t),v(o.stopPropagation())}),r(2,"div",418)(3,"h2",419)(4,"span"),l(5,"\u{1F511}"),s(),l(6," \u5275\u5EFA\u95DC\u9375\u8A5E\u96C6 "),s()(),r(7,"div",350)(8,"label",420),l(9,"\u95DC\u9375\u8A5E\u96C6\u540D\u7A31"),s(),r(10,"input",421),x("input",function(o){_(t);let a=m(2);return v(a.newKeywordSet.set({name:o.target.value}))})("keyup.enter",function(){_(t);let o=m(2);return v(o.submitNewKeywordSet())}),s(),r(11,"p",311),l(12," \u{1F4A1} \u5275\u5EFA\u5F8C\u53EF\u5728\u8A5E\u96C6\u4E2D\u6DFB\u52A0\u591A\u500B\u95DC\u9375\u8A5E "),s()(),r(13,"div",399)(14,"button",400),x("click",function(){_(t);let o=m(2);return v(o.cancelNewKeywordSet())}),l(15," \u53D6\u6D88 "),s(),r(16,"button",422),x("click",function(){_(t);let o=m(2);return v(o.submitNewKeywordSet())}),l(17," \u5275\u5EFA "),s()()()()}if(i&2){let t=m(2);c(10),L("value",t.newKeywordSet().name)}}function eJ(i,e){if(i&1){let t=I();r(0,"div",8)(1,"app-onboarding",40,0),x("navigateEvent",function(o){_(t);let a=m();return v(a.handleOnboardingNavigate(o))}),s(),B(3,"app-progress-dialog",41),y(4,tz,22,1,"div",42),y(5,rz,17,1,"div",42),r(6,"aside",43)(7,"div",44)(8,"button",45),x("click",function(){_(t);let o=m();return v(o.toggleSidebarCollapse())}),ne(),r(9,"svg",46),B(10,"polyline",47),s()(),ce(),r(11,"div",48)(12,"div",49),B(13,"div",50),ne(),r(14,"svg",51),B(15,"path",52)(16,"path",53)(17,"path",54)(18,"path",55)(19,"circle",56),r(20,"defs")(21,"linearGradient",57),B(22,"stop",58)(23,"stop",59),s(),r(24,"linearGradient",60),B(25,"stop",61)(26,"stop",62),s()()()(),y(27,sz,5,2,"div"),s(),ce(),r(28,"div",63),x("click",function(){_(t);let o=m();return v(o.changeView("profile"))}),r(29,"div",10)(30,"div",64),B(31,"div",65),r(32,"div",66)(33,"div",67),l(34),s()(),y(35,mz,6,11,"div",68),s(),r(36,"div",69)(37,"div",70),l(38),s(),r(39,"div",71),y(40,pz,5,0,"span",72)(41,gz,5,0,"span",73)(42,hz,5,0,"span",74)(43,fz,5,0,"span",75)(44,_z,5,0,"span",76)(45,vz,5,0,"span",77),s()(),r(46,"div",78),ne(),r(47,"svg",79),B(48,"polyline",80),s()()()()(),ce(),r(49,"nav",81),rp(50),r(51,"a",82),x("click",function(){_(t);let o=m();return v(o.changeView("membership-center"))}),ne(),r(52,"svg",83),B(53,"polygon",84),s(),ce(),r(54,"span"),l(55,"\u6703\u54E1\u4E2D\u5FC3"),s()(),r(56,"a",82),x("click",function(){_(t);let o=m();return v(o.changeView("dashboard"))}),ne(),r(57,"svg",83),B(58,"rect",85)(59,"rect",86)(60,"rect",87)(61,"rect",88),s(),ce(),r(62,"span"),l(63),s()(),r(64,"div",89)(65,"button",90),x("click",function(){_(t);let o=m();return v(o.toggleSidebarGroup("manual"))}),r(66,"span",91),l(67," \u{1F527} \u624B\u52D5\u64CD\u4F5C "),s(),ne(),r(68,"svg",92),B(69,"polyline",93),s()(),y(70,xz,30,25,"div",94),s(),ce(),r(71,"div",89)(72,"button",90),x("click",function(){_(t);let o=m();return v(o.toggleSidebarGroup("monitoring"))}),r(73,"span",95)(74,"span",96),l(75,"\u{1F4E1}"),s(),l(76," \u76E3\u63A7\u4E2D\u5FC3 "),s(),ne(),r(77,"svg",92),B(78,"polyline",93),s()(),y(79,Cz,42,52,"div",94),s(),ce(),r(80,"div",89)(81,"button",90),x("click",function(){_(t);let o=m();return v(o.toggleSidebarGroup("marketing"))}),r(82,"span",95)(83,"span",97),l(84,"AI"),s(),l(85," \u667A\u80FD\u71DF\u92B7 "),s(),ne(),r(86,"svg",92),B(87,"polyline",93),s()(),y(88,Az,34,60,"div",94),s(),ce(),r(89,"div",89)(90,"button",90),x("click",function(){_(t);let o=m();return v(o.toggleSidebarGroup("analytics"))}),r(91,"span",91),l(92," \u{1F4CA} \u6578\u64DA\u5206\u6790 "),s(),ne(),r(93,"svg",92),B(94,"polyline",93),s()(),y(95,Tz,25,24,"div",94),s(),ce(),r(96,"div",89)(97,"button",90),x("click",function(){_(t);let o=m();return v(o.toggleSidebarGroup("ai"))}),r(98,"span",91),l(99),s(),ne(),r(100,"svg",92),B(101,"polyline",93),s()(),y(102,Fz,15,16,"div",94),s(),ce(),r(103,"div",89)(104,"button",90),x("click",function(){_(t);let o=m();return v(o.toggleSidebarGroup("system"))}),r(105,"span",91),l(106),s(),ne(),r(107,"svg",92),B(108,"polyline",93),s()(),y(109,Pz,7,7,"div",94),s()(),ce(),r(110,"div",98)(111,"button",99),x("click",function(){_(t);let o=m();return v(o.openOnboarding())}),r(112,"span",100),l(113,"\u2753"),s(),r(114,"span"),l(115,"\u4F7F\u7528\u5E2E\u52A9"),s()(),r(116,"div")(117,"label",101),l(118),s(),B(119,"app-language-switcher-compact"),s(),r(120,"div")(121,"label",101),l(122),s(),r(123,"div",102)(124,"button",103),x("click",function(){_(t);let o=m();return v(o.theme.set("light"))}),ne(),r(125,"svg",104),B(126,"path",105),s()(),ce(),r(127,"button",103),x("click",function(){_(t);let o=m();return v(o.theme.set("dark"))}),ne(),r(128,"svg",104),B(129,"path",106),s()()()()()(),ce(),r(130,"main",107),y(131,Rz,1,0,"app-dashboard-view")(132,Nz,1,0,"app-accounts-view")(133,Vz,1,0,"app-add-account-page")(134,Bz,1,0,"app-api-credentials-view")(135,Lz,1,0,"app-settings-view")(136,Oz,1,0,"app-leads-view")(137,Uz,1,0,"app-automation-view")(138,Gz,1,0,"app-resource-discovery-view")(139,$z,1,0,"app-resource-discovery-view")(140,Hz,1,0,"app-ai-center-view")(141,qz,2,0,"div",108)(142,Wz,2,0,"div",109)(143,zz,2,0,"div",109)(144,Kz,1,0,"app-multi-role-view")(145,jz,1,0,"app-analytics-view")(146,Jz,1,0,"app-monitoring-view")(147,Qz,1,0,"app-monitoring-view")(148,Yz,1,0,"app-monitoring-view")(149,Xz,1,0,"app-monitoring-view")(150,Zz,1,0,"app-monitoring-view")(151,eK,1,0,"app-monitoring-view")(152,tK,1,0,"app-monitoring-view")(153,nK,1,0,"app-runtime-logs-view")(154,iK,1,0,"app-membership-center")(155,oK,1,0,"app-profile")(156,rK,1,0,"app-resource-center")(157,sK,1,0,"app-search-discovery")(158,aK,1,0,"app-ai-marketing-assistant")(159,lK,1,0,"app-ai-team-hub")(160,cK,1,0,"app-member-database")(161,dK,1,0,"app-leads-view")(162,uK,1,0,"app-analytics-view")(163,mK,1,0,"app-analytics-view")(164,pK,1,0,"app-automation-view")(165,gK,1,0,"app-automation-view")(166,hK,1,0,"app-analytics-view")(167,fK,1,0,"app-marketing-report")(168,_K,1,0,"app-runtime-logs-view")(169,vK,1,0,"app-runtime-logs-view")(170,xK,1,0,"app-runtime-logs-view")(171,CK,1,0,"app-dashboard-view"),s(),y(172,yj,30,24,"div",110),y(173,Tj,19,1,"div",111),y(174,Hj,22,9,"div",112),y(175,Jj,27,3,"div",112),y(176,Yj,45,1,"div",112),y(177,Xj,5,0,"div",113),y(178,Zj,18,1,"div",114),s()}if(i&2){let t,n,o,a,d,u=m();c(3),L("show",u.progressDialog().show)("title",u.progressDialog().title)("progress",u.progressDialog().progress)("cancellable",u.progressDialog().cancellable),c(),S(u.deleteConfirmDialog().show?4:-1),c(),S(u.showInviteGroupDialog()?5:-1),c(),N("w-64",!u.sidebarCollapsed())("w-16",u.sidebarCollapsed()),c(2),L("title",u.sidebarCollapsed()?"\u5C55\u958B\u5074\u908A\u6B04":"\u6536\u7E2E\u5074\u908A\u6B04"),c(),N("rotate-180",u.sidebarCollapsed()),c(2),N("justify-center",u.sidebarCollapsed()),c(16),S(u.sidebarCollapsed()?-1:27),c(),N("level-bronze",u.userMembershipLevel()==="bronze")("level-silver",u.userMembershipLevel()==="silver")("level-gold",u.userMembershipLevel()==="gold")("level-diamond",u.userMembershipLevel()==="diamond")("level-star",u.userMembershipLevel()==="star")("level-king",u.userMembershipLevel()==="king"),c(3),N("glow-bronze",u.userMembershipLevel()==="bronze")("glow-silver",u.userMembershipLevel()==="silver")("glow-gold",u.userMembershipLevel()==="gold")("glow-diamond",u.userMembershipLevel()==="diamond")("glow-star",u.userMembershipLevel()==="star")("glow-king",u.userMembershipLevel()==="king"),c(),N("border-bronze",u.userMembershipLevel()==="bronze")("border-silver",u.userMembershipLevel()==="silver")("border-gold",u.userMembershipLevel()==="gold")("border-diamond",u.userMembershipLevel()==="diamond")("border-star",u.userMembershipLevel()==="star")("border-king",u.userMembershipLevel()==="king"),c(),N("avatar-bronze",u.userMembershipLevel()==="bronze")("avatar-silver",u.userMembershipLevel()==="silver")("avatar-gold",u.userMembershipLevel()==="gold")("avatar-diamond",u.userMembershipLevel()==="diamond")("avatar-star",u.userMembershipLevel()==="star")("avatar-king",u.userMembershipLevel()==="king"),c(),M(" ",((t=u.currentUser())==null||t.username==null?null:t.username.charAt(0).toUpperCase())||"?"," "),c(),S(u.userMembershipLevel()!=="bronze"?35:-1),c(3),M(" ",((n=u.currentUser())==null?null:n.username)||"\u7528\u6236"," "),c(2),S((o=u.userMembershipLevel())==="silver"?40:o==="gold"?41:o==="diamond"?42:o==="star"?43:o==="king"?44:45),c(10);let p=sp(u.currentView());c(),ee("background-color",p==="membership-center"?"var(--sidebar-item-active)":"transparent")("color",p==="membership-center"?"var(--sidebar-text-active)":"var(--sidebar-text)"),N("active",p==="membership-center"),c(5),ee("background-color",p==="dashboard"?"var(--sidebar-item-active)":"transparent")("color",p==="dashboard"?"var(--sidebar-text-active)":"var(--sidebar-text)"),N("active",p==="dashboard"),c(7),D(u.t("dashboard")),c(5),N("rotate-180",!u.isSidebarGroupExpanded("manual")),c(2),S(u.isSidebarGroupExpanded("manual")?70:-1),c(7),N("rotate-180",!u.isSidebarGroupExpanded("monitoring")),c(2),S(u.isSidebarGroupExpanded("monitoring")?79:-1),c(7),N("rotate-180",!u.isSidebarGroupExpanded("marketing")),c(2),S(u.isSidebarGroupExpanded("marketing")?88:-1),c(5),N("rotate-180",!u.isSidebarGroupExpanded("analytics")),c(2),S(u.isSidebarGroupExpanded("analytics")?95:-1),c(4),M(" \u{1F9E0} ",u.t("aiIntelligence")," "),c(),N("rotate-180",!u.isSidebarGroupExpanded("ai")),c(2),S(u.isSidebarGroupExpanded("ai")?102:-1),c(4),M(" \u2699\uFE0F ",u.t("systemMonitor")," "),c(),N("rotate-180",!u.isSidebarGroupExpanded("system")),c(2),S(u.isSidebarGroupExpanded("system")?109:-1),c(9),D(u.t("language")),c(4),D(u.t("appearance")),c(2),ee("background-color",u.theme()==="light"?"var(--bg-card)":"transparent")("color",u.theme()==="light"?"var(--primary)":"var(--text-muted)")("box-shadow",u.theme()==="light"?"var(--shadow-sm)":"none"),c(3),ee("background-color",u.theme()==="dark"?"var(--primary-bg)":"transparent")("color",u.theme()==="dark"?"var(--primary)":"var(--text-muted)")("box-shadow",u.theme()==="dark"?"var(--shadow-sm)":"none"),c(4),S((a=u.currentView())==="dashboard"?131:a==="accounts"?132:a==="add-account"?133:a==="api-credentials"?134:a==="settings"?135:a==="leads"?136:a==="automation"?137:a==="resource-discovery"?138:a==="resources"?139:a==="ai-center"?140:a==="knowledge-brain"?141:a==="knowledge-gaps"?142:a==="knowledge-manage"?143:a==="multi-role"?144:a==="analytics"?145:a==="monitoring"?146:a==="monitoring-accounts"?147:a==="monitoring-groups"?148:a==="keyword-sets"?149:a==="chat-templates"?150:a==="trigger-rules"?151:a==="collected-users"?152:a==="runtime-logs"?153:a==="membership-center"?154:a==="profile"?155:a==="resource-center"?156:a==="search-discovery"?157:a==="ai-assistant"?158:a==="ai-team"?159:a==="member-database"?160:a==="lead-nurturing"?161:a==="nurturing-analytics"?162:a==="user-tracking"?163:a==="ads"?164:a==="campaigns"?165:a==="analytics-center"?166:a==="marketing-report"?167:a==="performance"?168:a==="alerts"?169:a==="logs"?170:171),c(41),S((d=u.generationState().lead)?172:-1,d),c(),S(u.showBatchOperationHistory()?173:-1),c(),S(u.showWelcomeDialog()?174:-1),c(),S(u.showOrphanSessionDialog()?175:-1),c(),S(u.showBackendErrorDialog()?176:-1),c(),S(u.backendRunning()?-1:177),c(),S(u.showKeywordSetCreator()?178:-1)}}var vd=class i{constructor(){this.router=F(Zr);this.geminiService=F(Ll);this.translationService=F(Ol);this.accountLoaderService=F(rs);this.ipcService=F(Q);this.toastService=F(J);this.membershipService=F(Ie);this.securityService=F(jl);this.loadingService=F(Jl);this.contactsService=F(Kt);this.backupService=F(Yo);this.i18n=F(Be);this.authService=F(Gn);this.navBridge=F(Je);this.navShortcuts=F(sc);this.unifiedNav=F(eo);this.navigationService=F(no);this.monitoringMgmt=F(Hn);this.leadMgmt=F(Ko);this.campaignMgmt=F(Wo);this.templateMgmt=F(zo);this.groupMgmt=F(jo);this.messageMgmt=F(io);this.facade=F(ls);this.animationConfig=F(Ei);this.settingsService=F(Jo);this.aiChatService=F(oo);this.resourceService=F(ro);this.exportService=F(Qo);this.ragService=F(cs);this.ragBrainService=F(Kn);this.vectorMemoryService=F(mc);this.schedulerService=F(Xo);this.dialogService=F(st);this.document=F(lt);this.cdr=F(dn);this.ngZone=F(Pn);this.membershipUpdateHandler=null;this.Math=Math;this.isAuthenticated=R(()=>this.authService.isAuthenticated());this.currentUser=R(()=>this.authService.user());this.userMembershipLevel=R(()=>this.authService.membershipLevel());this.t=(e,t)=>this.i18n.t(e,t);this.theme=f("dark");this.currentView=f("dashboard");this.dashboardMode=f("smart");this.useRouterMode=f(!0);this.navMode=f("classic");this.leadDetailView=f("sendMessage");this.leadsViewMode=f("kanban");this.leadStatusFilter=f("all");this.leadSourceFilter=f("all");this.leadSortBy=f("time");this.showLeadsViewMenu=f(!1);this.showLeadsActionMenu=f(!1);this.aiCenterTab=f("config");this.automationTab=f("targets");this.knowledgeMenuExpanded=f(!0);this.sidebarGroups=f({manual:!0,monitoring:!0,marketing:!0,analytics:!1,advanced:!1,ai:!0,system:!1});this.sidebarCollapsed=f(!1);this.aiTeamIncomingStrategy=f(null);this.showBatchMessageDialogState=f(!1);this.batchSelectedLeads=f([]);this.batchSendTargets=f([]);this.showBatchInviteDialogState=f(!1);this.batchInviteTargets=f([]);this.migrationStatus=f({currentVersion:0,latestVersion:0,appliedCount:0,pendingCount:0,appliedMigrations:[],pendingMigrations:[]});this.isLoadingMigration=f(!1);this.isRunningMigration=f(!1);this.schedulerStatus=f({isRunning:!1,tasks:[]});this.schedulerTab=f("tasks");this.logFiles=f([]);this.logStats=f({totalFiles:0,totalSize:0,totalSizeFormatted:"0 B",compressedFiles:0,oldestFile:null,newestFile:null});this.isLoadingLogs=f(!1);this.isRotatingLogs=f(!1);this.selectedLogFile=f(null);this.logFileContent=f("");this.showResourceBatchMenu=f(!1);this.resourceBatchAction=f(null);this.showMembershipDialog=f(!1);this.settingsTab=f("backup");this.vectorMemoryStats=f({totalMemories:0,byType:{},totalUsers:0,avgImportance:0});this.vectorMemorySearchQuery="";this.vectorMemorySearchResults=f([]);this.isSearchingMemory=f(!1);this.isAddingMemory=f(!1);this.showAddMemoryDialog=f(!1);this.newMemory={userId:"",content:"",type:"conversation",importance:.5};this.selectedMemoryUserId=f("");this.memoryUserList=f([]);this.showVoiceRecordingDialog=f(!1);this.voiceCloneTab=f("manage");this.messageMode=f("manual");this.editableMessage=f("");this.selectedSenderId=f(null);this.aiApiKey=f("");this.aiApiType=f("gemini");this.customApiEndpoint=f("");this.showApiKey=f(!1);this.isTestingAi=f(!1);this.aiConnectionStatus=f(null);this.aiConnectionError=f("");this.localAiEndpoint=f("http://localhost:11434");this.localAiModel=f("qwen2:7b");this.localAiProvider=f("ollama");this.isTestingLocalAi=f(!1);this.localAiStatus=f(null);this.localAiError=f("");this.availableOllamaModels=f([]);this.aiAutoFallback=f(!0);this.aiBackupProvider=f("gemini");this.aiShowProviderLabel=f(!0);this.isFirstRun=f(!1);this.showWelcomeDialog=f(!1);this.welcomeStep=f(1);this.isDetectingOllama=f(!1);this.ollamaDetected=f(!1);this.detectedOllamaModels=f([]);this.autoSelectedModel=f("");this.backendRunning=f(!0);this.backendError=f("");this.showBackendErrorDialog=f(!1);this.showOrphanSessionDialog=f(!1);this.orphanSessions=f([]);this.isRecoveringOrphanSessions=f(!1);this.showMembershipStats=f(!1);this.ttsEndpoint=f("");this.ttsEnabled=f(!1);this.ttsVoice=f("");this.isTestingTts=f(!1);this.ttsStatus=f(null);this.ttsError=f("");this.sttEndpoint=f("");this.sttEnabled=f(!1);this.isTestingStt=f(!1);this.sttStatus=f(null);this.sttError=f("");this.aiAutoChatEnabled=f(!1);this.aiAutoChatMode=f("semi");this.aiTypingSpeed=f(50);this.aiReplyDelay=f([2,8]);this.aiSystemPrompt=f("");this.aiMaxContextMessages=f(20);this.aiEnableMemory=f(!0);this.aiAutoGreeting=f(!1);this.aiGreetingMessage=f("");this.ragEnabled=f(!0);this.aiGreetingSuggestion=f(null);this.showAiGreetingDialog=f(!1);this.knowledgeStats=f({documents:0,images:0,videos:0,qa_pairs:0});this.knowledgeDocuments=f([]);this.knowledgeImages=f([]);this.knowledgeVideos=f([]);this.knowledgeQaPairs=f([]);this.knowledgeTab=f("documents");this.isLoadingKnowledge=f(!1);this.showAddDocumentDialog=f(!1);this.showAddMediaDialog=f(!1);this.showAddQaDialog=f(!1);this.newDocument=f({title:"",category:"general",tags:"",content:""});this.newMedia=f({name:"",category:"general",description:"",mediaType:"image"});this.newQaPair=f({question:"",answer:"",category:"general",keywords:""});this.ragSystemInitialized=f(!1);this.isInitializingRag=f(!1);this.isRagLearning=f(!1);this.isReindexing=f(!1);this.isCleaningRag=f(!1);this.isSearchingRag=f(!1);this.ragSearchQuery="";this.ragSearchResults=f([]);this.ragStats=f({total_knowledge:0,qa_count:0,scripts_count:0,total_uses:0,avg_score:0,chromadb_enabled:!1,neural_embedding:!1,by_type:{}});this.showAddRagKnowledgeDialog=f(!1);this.newRagKnowledge={type:"qa",question:"",answer:"",context:""};this.ragTypeKeys=R(()=>Object.keys(this.ragStats().by_type));this.resourceDiscoveryInitialized=f(!1);this.isSearchingResources=f(!1);this.isProcessingJoinQueue=f(!1);this.resourceSearchQuery="";this.pendingSearchQuery="";this.resourceSearchType=f("all");this.searchError=f({hasError:!1,message:"",details:"",suggestions:[]});this.currentSearchSessionId=f("");this.currentSearchKeyword=f("");this.showSearchHistory=f(!1);this.searchHistoryKeywords=f([]);this.savedResources=f(new Set);this.showSearchSuggestions=f(!1);this.hotSearchKeywords=f(["\u652F\u4ED8","USDT","\u4EA4\u6613","\u62DB\u8058","\u4EE3\u8CFC","\u52A0\u5BC6\u8CA8\u5E63","\u96FB\u5F71","\u97F3\u6A02","\u8CC7\u6E90\u5206\u4EAB","\u4EA4\u6D41\u7FA4"]);this.resourceAccountId=f(null);this.showResourceAccountSelector=f(!1);this.resourceMinMembers=f(0);this.showSearchOptions=f(!1);this.searchReplaceMode=f(!0);this.isRefreshing=f(!1);this.linkAnalysisInput="";this.isAnalyzingLink=f(!1);this.discoveredResources=f([]);this.resourceStats=f({total_resources:0,by_status:{},by_type:{},today_discovered:0,pending_joins:0,joined_count:0,avg_score:0});this.discoveryKeywords=f([]);this.showAddResourceDialog=f(!1);this.showAddKeywordDialog=f(!1);this.showChannelManageDialog=f(!1);this.showAddChannelDialog=f(!1);this.newResourceKeyword="";this.systemChannels=f([]);this.customChannels=f([]);this.newChannelUsername="";this.newChannelDisplayName="";this.newChannelQueryFormat="{keyword}";this.newChannelPriority="backup";this.showJoinMonitorDialog=f(!1);this.joinMonitorResource=f(null);this.joinMonitorSelectedPhone=f("");this.joinMonitorSelectedPhones=f([]);this.joinMonitorKeywords=f([]);this.joinMonitorSelectedKeywordSetIds=f([]);this.joinMonitorNewKeyword="";this.joinMonitorAutoEnable=f(!0);this.joinMonitorBatchMode=f(!0);this.joinMonitorBatchInterval=f(45);this.isJoiningResource=f(!1);this.showQuickCreateKeywordSet=f(!1);this.quickCreateKeywordSetName="";this.showChangeMonitorAccount=f(!1);this.openResourceMenuId=f(null);this.quickCreateKeywordSetKeywords=f([]);this.quickCreateKeywordSetNewKeyword="";this.showBatchJoinMonitorDialog=f(!1);this.batchJoinResources=f([]);this.batchJoinProgress=f({current:0,total:0,status:""});this.showMemberListDialog=f(!1);this.memberListResource=f(null);this.memberListData=f([]);this.memberListLoading=f(!1);this.memberListProgress=f({extracted:0,total:0,status:""});this.selectedMemberIds=f([]);this.memberExtractStarted=f(!1);this.memberListFilter=f("all");this.memberExtractConfig=f({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}});this.extractPresets=[{id:"precise",name:"\u{1F3AF} \u7CBE\u6E96\u6D3B\u8E8D",desc:"\u73FE\u5728\u5728\u7DDA+\u6709\u7528\u6236\u540D",config:{activityFilters:{onlineNow:!0,within3Days:!0},accountFeatures:{hasUsername:!0}}},{id:"chinese",name:"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA\u512A\u5148",desc:"\u83EF\u4EBA+7\u5929\u5167\u6D3B\u8E8D",config:{userTypes:{chinese:!0},activityFilters:{within7Days:!0}}},{id:"premium",name:"\u{1F48E} \u9AD8\u50F9\u503C",desc:"Premium+\u6D3B\u8E8D\u7528\u6236",config:{accountFeatures:{premium:!0},activityFilters:{within7Days:!0}}},{id:"all",name:"\u{1F4E6} \u5168\u90E8\u63D0\u53D6",desc:"\u4E0D\u7BE9\u9078\uFF0C\u63D0\u53D6\u6240\u6709",config:{}}];this.selectedPreset=f("");this.showExtractionSummaryDialog=f(!1);this.extractionSummary=f({groupName:"",groupUrl:"",totalExtracted:0,totalInGroup:0,onlineCount:0,recentlyCount:0,premiumCount:0,chineseCount:0,hasUsernameCount:0,botCount:0,valueLevelDistribution:{S:0,A:0,B:0,C:0,D:0},extractedAt:"",duration:0});this.extractionStartTime=f(0);this.showMemberExtractionDialog=f(!1);this.memberExtractionGroup=f(null);this.showSingleMessageDialog=f(!1);this.singleMessageResource=f(null);this.singleMessageContent="";this.singleMessageScheduled=f(!1);this.singleMessageScheduleTime="";this.singleMessageAccountId=f("");this.accountQuotas=f([]);this.newChannelNotes="";this.isTestingChannel=f(!1);this.selectedResourceIds=f([]);this.resourceFilterStatus=f("");this.resourceFilterType=f("");this.resourceFilterLink=f("");this.selectedSearchSources=f(["telegram","jiso"]);this.showBatchJoinMenu=f(!1);this.searchResultsCache=new Map;this.CACHE_EXPIRY_MS=300*1e3;this.showBatchMessageDialog=f(!1);this.showBatchInviteDialog=f(!1);this.batchMessageContent="";this.batchMessageTargets=[];this.batchMessageConfig={delayMin:60,delayMax:120,dailyLimit:50,smartAntiBlock:!0,accountMode:"rotate",scheduled:!1,scheduleTime:""};this.batchInviteConfig={selectedMemberIds:[],selectAll:!1,delayMin:120,delayMax:300,perGroupLimit:10,smartAntiBlock:!0};this.availableMembersForInvite=f([]);this.discussionWatcherInitialized=f(!1);this.channelDiscussions=f([]);this.discussionMessages=f([]);this.discussionStats=f({total_discussions:0,monitoring_count:0,total_messages:0,matched_messages:0,leads_from_discussions:0,today_messages:0,today_leads:0});this.selectedDiscussionId=f("");this.discoverChannelId="";this.resourcesTab=f("resources");this.resourceCenterTab=f("manage");this.isLoadingDiscussionMessages=f(!1);this.discussionReplyText=f("");this.clonedVoices=f([]);this.selectedClonedVoice=f("");this.isUploadingVoice=f(!1);this.voiceUploadProgress=f(0);this.voiceCloneError=f("");this.isRecording=f(!1);this.recordingTime=f(0);this.recordingTimer=null;this.mediaRecorder=null;this.audioChunks=[];this.voicePromptText=f("");this.voiceName=f("");this.showRecordingDialog=f(!1);this.recordedAudioBlob=f(null);this.recordedAudioUrl=f("");this.accounts=f([]);this.keywordSets=f([]);this.monitoredGroups=f([]);this.leads=f([]);this.leadsTotal=f(0);this.leadsHasMore=f(!1);this.leadsLoading=f(!1);this.logs=f([]);this.selectedLeadForInvite=f(null);this.showInviteGroupDialog=f(!1);this.realtimeMatches=f([]);this.todayStats=f({matchCount:0,newLeads:0,messagesSent:0,conversions:0});this.chatList=f([]);this.chatHistory=f([]);this.selectedChatUserId=f(null);this.isLoadingChatHistory=f(!1);this.chatListSearch=f("");this.chatListFunnelFilter=f("");this.chatHistoryPage=f(0);this.chatHistoryPageSize=f(50);this.chatHistoryHasMore=f(!1);this.chatHistoryLoadingMore=f(!1);this.chatHistoryAllMessages=f([]);this.lastQueueStatusRefresh=0;this.queueStatuses=f({});this.queueMessages=f([]);this.selectedQueuePhone=f(null);this.queueStats=f({pending:0,sending:0,sent:0,failed:0,retrying:0,totalToday:0,successRate:0,avgSendTime:0});this.sendingStatsData=f(null);this.queueLengthHistoryData=f(null);this.accountComparisonData=f(null);this.campaignPerformanceData=f(null);this.alerts=f([]);this.unacknowledgedAlertsCount=R(()=>this.alerts().filter(e=>!e.acknowledged&&!e.resolved).length);this.selectedLeadIds=f(new Set);this.isSelectAllLeads=f(!1);this.showBatchOperationMenu=f(!1);this.showFloatingMoreMenu=f(!1);this.batchOperationInProgress=f(!1);this.batchOperationHistory=f([]);this.showBatchOperationHistory=f(!1);this.allTags=f([]);this.newTagName=f("");this.newTagColor=f("#3B82F6");this.showAddTagDialog=f(!1);this.batchTagInput=f("");this.showBatchTagSelector=f(!1);this.showBatchRemoveTagSelector=f(!1);this.leadSearchQuery=f("");this.leadSearchResults=f([]);this.isSearchingLeads=f(!1);this.leadSearchTimeout=null;this.backups=f([]);this.isCreatingBackup=f(!1);this.isRestoringBackup=f(!1);this.selectedLeadsCount=R(()=>this.selectedLeadIds().size);this.hasSelectedLeads=R(()=>this.selectedLeadIds().size>0);this.adTemplates=f([]);this.adSchedules=f([]);this.adSendLogs=f([]);this.adOverviewStats=f(null);this.showAdTemplateForm=f(!1);this.showAdScheduleForm=f(!1);this.editingAdTemplate=f(null);this.editingAdSchedule=f(null);this.newAdTemplate=f({name:"",content:"",mediaType:"text"});this.newAdSchedule=f({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]});this.spintaxPreview=f([]);this.isPreviewingSpintax=f(!1);this.adSystemTab=f("templates");this.trackedUsers=f([]);this.userGroups=f([]);this.highValueGroups=f([]);this.trackingStats=f(null);this.showAddUserForm=f(!1);this.newTrackedUser=f({userId:"",username:"",notes:""});this.selectedTrackedUser=f(null);this.isTrackingUser=f(!1);this.userTrackingTab=f("users");this.userValueFilter=f("");this.selectedCampaign=f(null);this.unifiedOverview=f(null);this.funnelAnalysis=f(null);this.showCampaignForm=f(!1);this.campaignKeywordInput=f("");this.campaignFormData=f({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]});this.roleTemplates=f({});this.allRoles=f([]);this.scriptTemplates=f([]);this.collabGroups=f([]);this.collabStats=f(null);this.roleStats=f(null);this.showRoleAssignForm=f(!1);this.multiRoleTab=f("roles");this.newRoleAssign=f({accountPhone:"",roleType:"seller",roleName:""});this.validationErrors=f({});this.progressDialog=f({show:!1,title:"\u5904\u7406\u4E2D...",progress:{current:0,total:0},cancellable:!1});this.logFilterType=f("");this.logFilterStartDate=f("");this.logFilterEndDate=f("");this.logFilterSearch=f("");this.filteredLogs=R(()=>{let e=this.logs(),t=this.logFilterType(),n=this.logFilterStartDate(),o=this.logFilterEndDate(),a=this.logFilterSearch();return e.filter(d=>{if(t&&d.type!==t)return!1;if(n){let u=new Date(n);if(d.timestamp<u)return!1}if(o){let u=new Date(o);if(u.setHours(23,59,59,999),d.timestamp>u)return!1}if(a){let u=a.toLowerCase();if(!d.message.toLowerCase().includes(u))return!1}return!0})});this.generationState=f({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]});this.messageTemplates=f([]);this.doNotContactList=f(new Set);this.campaigns=f([]);this.spintaxEnabled=f(!0);this.autoReplyEnabled=f(!1);this.autoReplyMessage=f("Thanks for getting back to me! I'll read your message and respond shortly.");this.smartSendingEnabled=f(!0);this.saveSettingsTimer=null;this.searchTimeout=null;this.showPostJoinDialog=f(!1);this.postJoinResource=f(null);this.postJoinPhone=f("");this.showSuccessOverlay=f(!1);this.successOverlayConfig=f(null);this.newAccount=f({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""});this.newKeyword=f({setId:null,keyword:"",isRegex:!1});this.testKeywordText=f("");this.keywordTestResult=f(null);this.newKeywordSet=f({name:""});this.newGroup=f({url:"",keywordSetIds:[]});this.newTemplate=f({name:"",prompt:""});this.showTemplateCreator=f(!1);this.showKeywordSetCreator=f(!1);this.newCampaign=f(this.getEmptyCampaignForm());this.loginState=f({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1});this.loginCode=f("");this.login2FAPassword=f("");this.accountRoles=["Listener","Sender","Unassigned"];this.selectedAccountGroup=f("All");this.accountGroups=R(()=>["All",...new Set(this.accounts().map(e=>e.group).filter(Boolean))]);this.filteredAccounts=R(()=>{let e=this.accounts(),t=this.selectedAccountGroup();return t==="All"?e:e.filter(n=>n.group===t)});this.selectedAccounts=R(()=>this.accounts().filter(e=>e.selected));this.isAllAccountsSelected=R(()=>{let e=this.filteredAccounts();return e.length>0&&e.every(t=>t.selected)});this.listenerAccounts=R(()=>this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online"));this.senderAccounts=R(()=>this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up")));this.leadStatuses=["New","Contacted","Replied","Follow-up","Closed-Won","Closed-Lost"];this.openLeadMenuId=f(null);this.displayLeads=R(()=>this.leadSearchQuery().trim()&&this.leadSearchResults().length>0?this.leadSearchResults():this.leads());this.leadsByStatusMap=R(()=>{let e=this.displayLeads(),t=new Map;return this.leadStatuses.forEach(n=>t.set(n,[])),e.forEach(n=>{t.has(n.status)&&t.get(n.status).push(n)}),t});this.filteredLeads=R(()=>{let e=this.leadStatusFilter(),t=this.leadSourceFilter(),n=this.leadSortBy(),o=this.displayLeads();return e!=="all"&&(o=o.filter(a=>a.status===e)),t!=="all"&&(o=o.filter(a=>a.sourceType===t)),o.sort((a,d)=>n==="intent"?(d.intentScore||0)-(a.intentScore||0):n==="time"?new Date(d.timestamp).getTime()-new Date(a.timestamp).getTime():(a.username||"").localeCompare(d.username||""))});this.leadsBySource=R(()=>{let e=this.leads();return{group_extract:e.filter(t=>t.sourceType==="group_extract").length,keyword_trigger:e.filter(t=>t.sourceType==="keyword_trigger").length,import:e.filter(t=>t.sourceType==="import").length,unknown:e.filter(t=>!t.sourceType||t.sourceType==="unknown").length}});this.funnelStats=f({stages:{},tags:[],interest_distribution:{},today_new:0,week_converted:0});this.funnelOverview=f({stages:[],totalLeads:0,convertedLeads:0,averageConversionDays:0,conversionRate:0});this.showFunnelVisualization=f(!1);this.isLoadingFunnel=f(!1);this.selectedJourneyUserId=f("");this.userJourneyData=f(null);this.isLoadingJourney=f(!1);this.leadsTab=f("kanban");this.marketingCampaigns=f([]);this.marketingStats=f({totalCampaigns:0,running:0,completed:0,totalMessages:0,totalInvites:0,successRate:0});this.showCreateCampaignDialog=f(!1);this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""};this.isLoadingMarketing=f(!1);this.warmupDetails=f({});this.showWarmupConfig=f(!1);this.selectedWarmupAccountId=f(null);this.usersWithProfiles=f({users:[],total:0,limit:50,offset:0});this.userFilterStage=f("");this.userFilterTags=f("");this.userFilterSearch=f("");this.selectedUserIds=f([]);this.funnelStages=[{key:"new",name:"\u65B0\u5BA2\u6236",color:"bg-blue-500"},{key:"contacted",name:"\u5DF2\u806F\u7E6B",color:"bg-cyan-500"},{key:"replied",name:"\u5DF2\u56DE\u5FA9",color:"bg-green-500"},{key:"interested",name:"\u6709\u8208\u8DA3",color:"bg-yellow-500"},{key:"negotiating",name:"\u6D3D\u8AC7\u4E2D",color:"bg-orange-500"},{key:"follow_up",name:"\u9700\u8DDF\u9032",color:"bg-purple-500"},{key:"converted",name:"\u5DF2\u6210\u4EA4",color:"bg-emerald-500"},{key:"churned",name:"\u5DF2\u6D41\u5931",color:"bg-red-500"}];this.dashboardStats=R(()=>{let e=this.accounts(),t=this.leads(),n=e.filter(u=>u.status==="Online").length,o=new Date;o.setHours(0,0,0,0);let a=t.filter(u=>new Date(u.timestamp)>=o).length,d=e.reduce((u,p)=>u+p.dailySendCount,0);return{totalAccounts:e.length,onlineAccounts:n,totalLeads:t.length,leadsToday:a,messagesSentToday:d}});this.selectedAnalyticsCampaignId=f("all");this.filteredAnalyticsLeads=R(()=>{let e=this.leads(),t=this.selectedAnalyticsCampaignId();return t==="all"?e:e.filter(n=>n.campaignId===t)});this.analyticsData=R(()=>{let e=this.filteredAnalyticsLeads(),t=new Date;t.setHours(0,0,0,0);let n=[];for(let d=6;d>=0;d--){let u=new Date(t);u.setDate(t.getDate()-d);let p=e.filter(g=>{let C=new Date(g.timestamp);return C.setHours(0,0,0,0),C.getTime()===u.getTime()}).length;n.push({date:u,count:p})}let o=Math.max(...n.map(d=>d.count),1),a={new:e.length,contacted:e.filter(d=>d.status!=="New").length,replied:e.filter(d=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(d.status)).length};return{leadsByDay:n,maxLeadsInPeriod:o,funnel:a}});this.campaignPerformance=R(()=>{let e=this.leads();return this.campaigns().map(t=>{let n=e.filter(u=>u.campaignId===t.id),o=n.filter(u=>u.status!=="New").length,a=n.filter(u=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(u.status)).length,d=o>0?a/o*100:0;return{id:t.id,name:t.name,isActive:t.isActive,leads:n.length,contacted:o,replied:a,replyRate:d}})});this.isMonitoring=f(!1);this.coreDataLoaded=f(!1);this.senderRoundRobinIndex=f(0);this.oneClickStarting=f(!1);this.oneClickProgress=f(0);this.oneClickMessage=f("");this.oneClickStartReport=f(null);this.showStartReport=f(!1);this.systemStatus=f({accounts:{total:0,online:0,offline:0},monitoring:{active:!1,groups:0},ai:{enabled:!1,mode:"semi",endpoint:""},keywords:{sets:0,total:0},campaigns:{total:0,active:0},templates:{total:0,active:0},poller:{running:!1}});this.lastInitialStateTime=0;this.isPageVisible=!0;this.backendConnectionState=f("connecting");this.backendConnectionMessage=f("\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...");this.backendConnectionProgress=f(0);this.connectionStartTime=0;this.connectionTimeoutId=null;this.isStartingMonitoring=f(!1);this.lastConfigCheck=f(null);this.errorNavigationMap={NO_LISTENER:{view:"accounts",elementId:"accounts-section"},LISTENER_OFFLINE:{view:"accounts",elementId:"accounts-section"},NO_SENDER:{view:"accounts",elementId:"accounts-section"},SENDER_OFFLINE:{view:"accounts",elementId:"accounts-section"},SENDER_LIMIT_REACHED:{view:"accounts",elementId:"accounts-section"},NO_GROUPS:{view:"automation",elementId:"monitored-groups-section"},NO_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},EMPTY_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},GROUP_NO_KEYWORD:{view:"automation",elementId:"monitored-groups-section"},NO_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_ACTIVE_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},CAMPAIGN_INCOMPLETE:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_TEMPLATE:{view:"automation",elementId:"templates-section"},AI_NOT_ENABLED:{view:"ai-center",elementId:"ai-settings-section"}};this.selectedDays=f(7);this.alertManagementTab=f("alerts");this.alertRules=f([]);this.alertHistory=f([]);this.showAddAlertRuleDialog=f(!1);this.deleteConfirmDialog=f({show:!1,type:"single"});this.isSubmittingCampaign=f(!1);let e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.theme.set(e?"dark":"light"),gt(()=>{this.document.documentElement.className=this.theme()}),gt(()=>{let t=this.navBridge.currentView(),n=this.currentView();t&&t!==n&&(console.log("[AppComponent] \u540C\u6B65\u5C0E\u822A:",t,"\u2190 from NavBridge"),this.currentView.set(t))})}get routerUrl(){return this.router?.url||"N/A"}toggleSidebarGroup(e){let t=this.sidebarGroups();this.sidebarGroups.set(P(E({},t),{[e]:!t[e]})),localStorage.setItem("sidebar_groups",JSON.stringify(this.sidebarGroups()))}isSidebarGroupExpanded(e){return this.sidebarGroups()[e]??!0}loadSidebarGroupsState(){try{let e=localStorage.getItem("sidebar_groups");if(e){let n=JSON.parse(e);this.sidebarGroups.set(E(E({},this.sidebarGroups()),n))}localStorage.getItem("sidebar_collapsed")==="true"&&this.sidebarCollapsed.set(!0)}catch(e){console.warn("[Sidebar] Failed to load sidebar groups state:",e)}}toggleSidebarCollapse(){let e=!this.sidebarCollapsed();this.sidebarCollapsed.set(e),localStorage.setItem("sidebar_collapsed",String(e))}get showQrLoginDialog(){return this.dialogService.showQrLoginDialog}hideSearchSuggestions(){setTimeout(()=>this.showSearchSuggestions.set(!1),200)}isInSearchResultMode(){return this.currentSearchKeyword().length>0}exitSearchResultMode(){this.currentSearchKeyword.set(""),this.loadResources()}saveSettings(){this.saveSettingsTimer&&clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=setTimeout(()=>{this.ipcService.send("save-settings",{settings:{spintaxEnabled:this.spintaxEnabled(),autoReplyEnabled:this.autoReplyEnabled(),autoReplyMessage:this.autoReplyMessage(),smartSendingEnabled:this.smartSendingEnabled()}}),this.saveSettingsTimer=null},500)}showSettingsSavedToast(){this.toastService.success(this.t("settingsSaved"),2e3)}async testAiConnection(){if(this.aiApiType()==="local"){await this.testLocalAiConnection();return}if(this.aiApiKey()){this.isTestingAi.set(!0),this.aiConnectionStatus.set(null);try{this.ipcService.send("test-ai-connection",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint()}),await new Promise(t=>setTimeout(t,1500));let e=this.aiApiKey();this.aiApiType()==="gemini"&&e.startsWith("AIza")?this.aiConnectionStatus.set("success"):this.aiApiType()==="openai"&&e.startsWith("sk-")?this.aiConnectionStatus.set("success"):this.aiApiType()==="custom"&&e.length>10?this.aiConnectionStatus.set("success"):(this.aiConnectionStatus.set("error"),this.aiConnectionError.set(this.t("invalidApiKeyFormat")))}catch(e){this.aiConnectionStatus.set("error"),this.aiConnectionError.set(e.message)}finally{this.isTestingAi.set(!1)}}}async testLocalAiConnection(){let e=this.localAiEndpoint();if(e){this.isTestingLocalAi.set(!0),this.localAiStatus.set(null);try{this.ipcService.send("test-local-ai",{endpoint:e,provider:this.localAiProvider(),model:this.localAiModel()}),this.localAiProvider()==="ollama"&&this.ipcService.send("get-ollama-models",{endpoint:e}),await new Promise(t=>setTimeout(t,3e3)),e.startsWith("http://")||e.startsWith("https://")?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success("\u672C\u5730 AI \u670D\u52D9\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(this.t("invalidEndpointFormat")))}catch(t){this.localAiStatus.set("error"),this.localAiError.set(t.message)}finally{this.isTestingLocalAi.set(!1)}}}refreshOllamaModels(){let e=this.localAiEndpoint();e&&(this.toastService.info("\u6B63\u5728\u7372\u53D6\u6A21\u578B\u5217\u8868..."),this.ipcService.send("get-ollama-models",{endpoint:e}))}setLocalAiPresets(e){switch(this.localAiProvider.set(e),e){case"ollama":this.localAiEndpoint.set("http://localhost:11434"),this.localAiModel.set("qwen2:7b");break;case"lmstudio":this.localAiEndpoint.set("http://localhost:1234"),this.localAiModel.set("");break;case"custom":this.localAiEndpoint.set(""),this.localAiModel.set("");break}}async testTtsConnection(){let e=this.ttsEndpoint();if(e){this.isTestingTts.set(!0),this.ttsStatus.set(null);try{this.ipcService.send("test-tts-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.ttsStatus.set("success"):(this.ttsStatus.set("error"),this.ttsError.set(this.t("invalidEndpointFormat")))}catch(t){this.ttsStatus.set("error"),this.ttsError.set(t.message)}finally{this.isTestingTts.set(!1)}}}async testSttConnection(){let e=this.sttEndpoint();if(e){this.isTestingStt.set(!0),this.sttStatus.set(null);try{this.ipcService.send("test-stt-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.sttStatus.set("success"):(this.sttStatus.set("error"),this.sttError.set(this.t("invalidEndpointFormat")))}catch(t){this.sttStatus.set("error"),this.sttError.set(t.message)}finally{this.isTestingStt.set(!1)}}}saveAiSettings(){localStorage.setItem("ai_api_key",this.aiApiKey()),localStorage.setItem("ai_api_type",this.aiApiType()),localStorage.setItem("ai_custom_endpoint",this.customApiEndpoint()),localStorage.setItem("local_ai_endpoint",this.localAiEndpoint()),localStorage.setItem("local_ai_model",this.localAiModel()),localStorage.setItem("tts_endpoint",this.ttsEndpoint()),localStorage.setItem("tts_enabled",String(this.ttsEnabled())),localStorage.setItem("tts_voice",this.ttsVoice()),localStorage.setItem("stt_endpoint",this.sttEndpoint()),localStorage.setItem("stt_enabled",String(this.sttEnabled())),this.ipcService.send("save-ai-settings",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint(),localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel(),ttsEndpoint:this.ttsEndpoint(),ttsEnabled:this.ttsEnabled(),ttsVoice:this.ttsVoice(),sttEndpoint:this.sttEndpoint(),sttEnabled:this.sttEnabled()}),this.aiApiType()==="gemini"&&this.aiApiKey()&&this.geminiService.setApiKey(this.aiApiKey()),this.toastService.success(this.t("aiSettingsSaved"),2e3)}toggleAiAutoChat(){this.aiAutoChatEnabled.set(!this.aiAutoChatEnabled()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoChatEnabled()?"AI \u81EA\u52D5\u804A\u5929\u5DF2\u958B\u555F":"AI \u81EA\u52D5\u804A\u5929\u5DF2\u95DC\u9589",2e3)}toggleAiAutoGreeting(){this.aiAutoGreeting.set(!this.aiAutoGreeting()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoGreeting()?"\u81EA\u52D5\u554F\u5019\u5DF2\u958B\u555F":"\u81EA\u52D5\u554F\u5019\u5DF2\u95DC\u9589",2e3)}saveAiChatSettings(){localStorage.setItem("ai_auto_chat_enabled",String(this.aiAutoChatEnabled())),localStorage.setItem("ai_auto_chat_mode",this.aiAutoChatMode()),localStorage.setItem("ai_typing_speed",String(this.aiTypingSpeed())),localStorage.setItem("ai_reply_delay",JSON.stringify(this.aiReplyDelay())),localStorage.setItem("ai_system_prompt",this.aiSystemPrompt()),localStorage.setItem("ai_max_context_messages",String(this.aiMaxContextMessages())),localStorage.setItem("ai_enable_memory",String(this.aiEnableMemory())),localStorage.setItem("ai_auto_greeting",String(this.aiAutoGreeting())),localStorage.setItem("ai_greeting_message",this.aiGreetingMessage()),this.ipcService.send("update-ai-chat-settings",{settings:{auto_chat_enabled:this.aiAutoChatEnabled()?1:0,auto_chat_mode:this.aiAutoChatMode(),typing_speed:this.aiTypingSpeed(),reply_delay_min:this.aiReplyDelay()[0],reply_delay_max:this.aiReplyDelay()[1],system_prompt:this.aiSystemPrompt(),max_context_messages:this.aiMaxContextMessages(),enable_memory:this.aiEnableMemory()?1:0,auto_greeting:this.aiAutoGreeting()?1:0,greeting_message:this.aiGreetingMessage()},localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel()}),this.toastService.success(this.t("aiSettingsSaved"),2e3)}loadAiChatSettings(){let e=localStorage.getItem("ai_auto_chat_enabled"),t=localStorage.getItem("ai_auto_chat_mode"),n=localStorage.getItem("ai_typing_speed"),o=localStorage.getItem("ai_reply_delay"),a=localStorage.getItem("ai_system_prompt"),d=localStorage.getItem("ai_max_context_messages"),u=localStorage.getItem("ai_enable_memory"),p=localStorage.getItem("ai_auto_greeting"),g=localStorage.getItem("ai_greeting_message");if(e&&this.aiAutoChatEnabled.set(e==="true"),t&&this.aiAutoChatMode.set(t),n&&this.aiTypingSpeed.set(parseInt(n)),o)try{this.aiReplyDelay.set(JSON.parse(o))}catch{}a&&this.aiSystemPrompt.set(a),d&&this.aiMaxContextMessages.set(parseInt(d)),u&&this.aiEnableMemory.set(u==="true"),p&&this.aiAutoGreeting.set(p==="true"),g&&this.aiGreetingMessage.set(g)}initRagSystem(){this.isInitializingRag.set(!0),this.ipcService.send("init-rag-system",{})}triggerRagLearning(){this.isRagLearning.set(!0),this.ipcService.send("trigger-rag-learning",{})}reindexHighValueConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30})}cleanupRagKnowledge(){this.isCleaningRag.set(!0),this.ipcService.send("cleanup-rag-knowledge",{minScore:.2,daysOld:30,mergeSimilar:!0})}reindexConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30}),this.toastService.info("\u958B\u59CB\u91CD\u5EFA\u7D22\u5F15...")}refreshRagStats(){this.ipcService.send("get-rag-stats",{})}searchRagKnowledge(){this.ragSearchQuery.trim()&&(this.isSearchingRag.set(!0),this.ipcService.send("search-rag",{query:this.ragSearchQuery,limit:10}))}sendRagFeedback(e,t){this.ipcService.send("rag-feedback",{knowledgeId:e,isPositive:t}),this.toastService.info(t?"\u{1F44D} \u611F\u8B1D\u53CD\u994B\uFF01":"\u{1F44E} \u5DF2\u8A18\u9304\u53CD\u994B")}addRagKnowledge(){if(!this.newRagKnowledge.answer.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u56DE\u7B54\u5167\u5BB9");return}this.ipcService.send("add-rag-knowledge",{type:this.newRagKnowledge.type,question:this.newRagKnowledge.question,answer:this.newRagKnowledge.answer,context:this.newRagKnowledge.context}),this.newRagKnowledge={type:"qa",question:"",answer:"",context:""},this.showAddRagKnowledgeDialog.set(!1)}searchVectorMemory(){this.vectorMemorySearchQuery.trim()&&(this.isSearchingMemory.set(!0),this.ipcService.send("search-vector-memories",{userId:this.selectedMemoryUserId()||"",query:this.vectorMemorySearchQuery,limit:10}))}addVectorMemory(){if(!this.newMemory.content.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u8A18\u61B6\u5167\u5BB9");return}this.isAddingMemory.set(!0),this.ipcService.send("add-vector-memory",{userId:this.newMemory.userId||"manual",content:this.newMemory.content,type:this.newMemory.type,importance:this.newMemory.importance})}refreshMemoryStats(){this.ipcService.send("get-memory-stats",{userId:""})}deleteVectorMemory(e){this.ipcService.send("delete-vector-memory",{memoryId:e})}loadMemoryUserList(){this.ipcService.send("get-memory-user-list",{})}cleanupOldMemories(){this.ipcService.send("cleanup-old-memories",{daysOld:90})}mergeSimilarMemories(){let e=this.selectedMemoryUserId();if(!e){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("merge-similar-memories",{userId:e,threshold:.85})}getResourceDiscoveryAccounts(){return this.accounts().filter(t=>t.status==="Online").sort((t,n)=>{let o={Explorer:1,Listener:2,Sender:3,AI:4,Backup:5,Unassigned:6};return(o[t.role]||99)-(o[n.role]||99)})}getSelectedResourceAccount(){let e=this.resourceAccountId();if(e)return this.accounts().find(n=>n.id===e)||null;let t=this.getResourceDiscoveryAccounts();return t.length>0?t[0]:null}selectResourceAccount(e){this.resourceAccountId.set(e);let t=this.accounts().find(n=>n.id===e);t&&this.toastService.success(`\u8CC7\u6E90\u767C\u73FE\u5C07\u4F7F\u7528: ${t.phone}`),this.showResourceAccountSelector.set(!1)}getRoleDisplayName(e){return{Explorer:"\u{1F50D} \u63A2\u7D22\u865F",Listener:"\u{1F441}\uFE0F \u76E3\u63A7\u865F",Sender:"\u{1F4E4} \u767C\u9001\u865F",AI:"\u{1F916} AI\u865F",Backup:"\u26A1 \u5099\u7528\u865F",Unassigned:"\u2B55 \u672A\u5206\u914D"}[e]||"\u2B55 \u672A\u5206\u914D"}initResourceDiscovery(){let e=this.getSelectedResourceAccount();if(!e){this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.toastService.info(`\u6B63\u5728\u4F7F\u7528 ${e.phone} \u521D\u59CB\u5316\u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71...`),this.ipcService.send("init-resource-discovery",{accountId:e.id,phone:e.phone})}autoInitResourceDiscovery(){this.resourceDiscoveryInitialized()||this.initResourceDiscovery(),this.refreshResourceStats(),this.loadDiscoveryKeywords()}generateSearchSessionId(){return`search_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}generateSearchCacheKey(e,t){let n=e.toLowerCase().trim(),o=[...t].sort().join(",");return`${n}|${o}`}getSearchCache(e){let t=this.searchResultsCache.get(e);return t?Date.now()-t.timestamp>this.CACHE_EXPIRY_MS?(this.searchResultsCache.delete(e),null):t.results:null}setSearchCache(e,t){if(this.searchResultsCache.size>20){let n=Array.from(this.searchResultsCache.entries());n.sort((a,d)=>a[1].timestamp-d[1].timestamp),n.slice(0,n.length-20).forEach(([a])=>this.searchResultsCache.delete(a))}this.searchResultsCache.set(e,{results:[...t],timestamp:Date.now()}),console.log(`[Search Cache] \u5DF2\u7DE9\u5B58\u641C\u7D22\u7D50\u679C: "${e}" (${t.length} \u689D)`)}clearSearchCache(){this.searchResultsCache.clear(),console.log("[Search Cache] \u5DF2\u6E05\u9664\u6240\u6709\u7DE9\u5B58")}searchResources(){if(!this.resourceSearchQuery.trim()){this.toastService.error(this.t("searchPlaceholder"));return}if(this.selectedSearchSources().length===0){this.toastService.error("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u641C\u7D22\u6E20\u9053");return}if(this.getOnlineAccountsCount()===0){this.toastService.error("\u8ACB\u5148\u767B\u9304\u5E33\u865F");return}let e=this.resourceSearchQuery.trim(),t=this.selectedSearchSources(),n=this.generateSearchCacheKey(e,t),o=this.getSearchCache(n);if(o){console.log(`[Search Cache] \u4F7F\u7528\u7DE9\u5B58\u7D50\u679C: "${e}" (${o.length} \u689D)`),this.currentSearchKeyword.set(e),this.discoveredResources.set(o),this.showSearchHistory.set(!1);let g=this.searchHistoryKeywords(),C=[e,...g.filter(w=>w!==e)].slice(0,10);this.searchHistoryKeywords.set(C);return}let a=this.generateSearchSessionId();this.currentSearchSessionId.set(a),this.currentSearchKeyword.set(e),this.showSearchHistory.set(!1);let d=this.searchHistoryKeywords(),u=[e,...d.filter(g=>g!==e)].slice(0,10);this.searchHistoryKeywords.set(u),this.discoveredResources.set([]);let p=e.split(/[,;]/).map(g=>g.trim()).filter(g=>g.length>0);p.length>1?(console.log(`[Search] \u6B63\u5728\u641C\u7D22 ${p.length} \u4E2A\u5173\u952E\u8BCD...`),this.searchMultipleKeywords(p)):(this.isSearchingResources.set(!0),this.searchError.set({hasError:!1,message:"",details:"",suggestions:[]}),console.log(`[Search] \u6B63\u5728\u641C\u7D22 "${e}"...`),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u7A0D\u540E\u518D\u8BD5"))},7e4),this.executeMultiSourceSearch(e,t))}executeMultiSourceSearch(e,t){let n=this.getSelectedResourceAccount()?.phone,o=this.currentSearchSessionId();(t.includes("telegram")||t.includes("local"))&&this.ipcService.send("search-resources",{query:e,phone:n,sources:t.filter(a=>a!=="jiso"),limit:50,searchType:this.resourceSearchType(),minMembers:this.resourceMinMembers(),replaceMode:!0,searchSessionId:o,searchKeyword:e}),t.includes("jiso")&&(console.log("[Search] \u6B63\u5728\u901A\u8FC7\u6781\u641C Bot \u641C\u7D22..."),this.ipcService.send("search-jiso",{keyword:e,phone:n,limit:50,searchSessionId:o,searchKeyword:e})),t.includes("tgstat")}searchMultipleKeywords(e){this.isSearchingResources.set(!0);let t=this.selectedSearchSources();this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6"))},e.length*1e4+3e4),e.forEach((n,o)=>{setTimeout(()=>{this.executeMultiSourceSearch(n,t)},o*5e3)})}openTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link;t?this.ipcService.send("open-external-link",{url:t}):this.toastService.warning("\u6B64\u7FA4\u7D44\u6C92\u6709\u516C\u958B\u93C8\u63A5")}copyTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||"";t?(navigator.clipboard.writeText(t),this.toastService.success("\u93C8\u63A5\u5DF2\u8907\u88FD")):(navigator.clipboard.writeText(e.title),this.toastService.warning("\u6B64\u7FA4\u7D44\u7121\u516C\u958B\u93C8\u63A5\uFF0C\u5DF2\u8907\u88FD\u7FA4\u7D44\u540D\u7A31\uFF0C\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u641C\u7D22"))}copyUsername(e){let t=`@${e}`;navigator.clipboard.writeText(t),this.toastService.success("\u5DF2\u8907\u88FD "+t)}getResourceTypeIcon(e){switch(e){case"channel":return"\u{1F4E2}";case"supergroup":return"\u{1F465}";case"group":return"\u{1F4AC}";default:return"\u{1F4CC}"}}getResourceTypeLabel(e){switch(e){case"channel":return"\u983B\u9053";case"supergroup":return"\u8D85\u7D1A\u7FA4\u7D44";case"group":return"\u7FA4\u7D44";default:return"\u672A\u77E5"}}formatMemberCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}quickJoinResource(e){this.ipcService.send("batch-join-resources",{resourceIds:[e]}),this.toastService.info("\u6B63\u5728\u5617\u8A66\u52A0\u5165...")}loadResources(){this.ipcService.send("get-resources",{status:this.resourceFilterStatus()||void 0,type:this.resourceFilterType()||void 0,limit:100,offset:0})}filterResourcesByLink(){let e=this.resourceFilterLink();if(!e){this.loadResources();return}let n=this.discoveredResources().filter(o=>{let a=!!(o.username||o.invite_link);return e==="has_link"?a:e==="no_link"?!a:!0});this.discoveredResources.set(n)}refreshResourceStats(){this.ipcService.send("get-resource-stats",{})}openChannelManageDialog(){this.loadSearchChannels(),this.showChannelManageDialog.set(!0)}closeChannelManageDialog(){this.showChannelManageDialog.set(!1)}loadSearchChannels(){this.ipcService.send("get-search-channels",{})}openAddChannelDialog(){this.newChannelUsername="",this.newChannelDisplayName="",this.newChannelQueryFormat="{keyword}",this.newChannelPriority="backup",this.newChannelNotes="",this.showAddChannelDialog.set(!0)}closeAddChannelDialog(){this.showAddChannelDialog.set(!1)}addSearchChannel(){if(!this.newChannelUsername.trim()){this.toastService.error("\u8ACB\u8F38\u5165 Bot \u7528\u6236\u540D");return}this.ipcService.send("add-search-channel",{botUsername:this.newChannelUsername.trim(),displayName:this.newChannelDisplayName.trim()||this.newChannelUsername.trim(),queryFormat:this.newChannelQueryFormat,priority:this.newChannelPriority,notes:this.newChannelNotes})}deleteSearchChannel(e){if(e<0){this.toastService.warning("\u7121\u6CD5\u522A\u9664\u7CFB\u7D71\u6E20\u9053");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u500B\u641C\u7D22\u6E20\u9053\u55CE\uFF1F")&&this.ipcService.send("delete-search-channel",{channelId:e})}testSearchChannel(e){this.isTestingChannel.set(!0),this.toastService.info(`\u6B63\u5728\u6E2C\u8A66 @${e}...`),this.ipcService.send("test-search-channel",{botUsername:e})}toggleChannelEnabled(e,t){if(e<0){this.toastService.warning("\u7121\u6CD5\u4FEE\u6539\u7CFB\u7D71\u6E20\u9053");return}this.ipcService.send("update-search-channel",{channelId:e,enabled:!t})}getChannelStatusColor(e){switch(e){case"online":return"text-green-400";case"offline":return"text-red-400";case"captcha":return"text-yellow-400";default:return"text-gray-400"}}getChannelStatusIcon(e){switch(e){case"online":return"\u{1F7E2}";case"offline":return"\u{1F534}";case"captcha":return"\u{1F7E1}";default:return"\u26AA"}}openJoinAndMonitorDialog(e){this.joinMonitorResource.set(e),this.joinMonitorKeywords.set([]),this.joinMonitorNewKeyword="",this.joinMonitorAutoEnable.set(!0),this.loadAccountQuotas(),e.joined_by_phone?this.joinMonitorSelectedPhone.set(e.joined_by_phone):this.joinMonitorSelectedPhone.set("");let t=this.monitoredGroups().find(n=>n.url===e.username||n.url===`@${e.username}`||n.url===e.telegram_id||n.id===e.id);t&&t.keywordSetIds?this.joinMonitorSelectedKeywordSetIds.set([...t.keywordSetIds]):this.joinMonitorSelectedKeywordSetIds.set([]),this.showQuickCreateKeywordSet.set(!1),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword="",this.showJoinMonitorDialog.set(!0)}closeJoinMonitorDialog(){this.showJoinMonitorDialog.set(!1),this.joinMonitorResource.set(null),this.showChangeMonitorAccount.set(!1)}getAvailableAccountsForMonitor(){return this.accounts().filter(e=>e.status==="Online")}selectMonitorAccount(e){this.joinMonitorSelectedPhone.set(e),this.showChangeMonitorAccount.set(!1)}stopMonitoringGroup(e){if(!e)return;let t=e.telegram_id||e.id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u8B58\u5225\u7FA4\u7D44");return}this.ipcService.send("remove-group",{groupId:t,id:e.id,telegramId:e.telegram_id,username:e.username,link:e.link||e.invite_link}),this.updateResourceStatusLocally(e,"joined"),this.closeJoinMonitorDialog(),this.closeResourceMenu(),this.toastService.info("\u6B63\u5728\u505C\u6B62\u76E3\u63A7..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},500)}confirmLeaveGroup(e){if(!e)return;let t=e.title||e.username||"\u6B64\u7FA4\u7D44";confirm(`\u78BA\u5B9A\u8981\u9000\u51FA\u300C${t}\u300D\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\uFF1A
\u2022 \u5F9E Telegram \u9000\u51FA\u7FA4\u7D44
\u2022 \u505C\u6B62\u6240\u6709\u76E3\u63A7
\u2022 \u522A\u9664\u76F8\u95DC\u6578\u64DA`)&&this.leaveGroup(e)}leaveGroup(e){if(!e)return;let t=e.joined_by_phone||this.joinMonitorSelectedPhone(),n=e.telegram_id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u78BA\u5B9A\u4F7F\u7528\u7684\u5E33\u865F");return}this.ipcService.send("leave-group",{phone:t,groupId:n,resourceId:e.id}),this.updateResourceStatusLocally(e,"discovered"),this.closeJoinMonitorDialog(),this.toastService.info("\u6B63\u5728\u9000\u51FA\u7FA4\u7D44..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},1e3)}openInTelegram(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||e.link;t?window.open(t,"_blank"):this.toastService.warning("\u6C92\u6709\u53EF\u7528\u7684\u93C8\u63A5")}deleteResource(e){if(e?.id&&confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u300C${e.title||"\u6B64\u8CC7\u6E90"}\u300D\u7684\u8A18\u9304\u55CE\uFF1F`)){this.ipcService.send("delete-resource",{resourceId:e.id});let t=this.discoveredResources();this.discoveredResources.set(t.filter(n=>n.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664\u8CC7\u6E90\u8A18\u9304"),this.refreshResourceStats()}}updateResourceStatusLocally(e,t,n,o){if(!e)return;let a=this.discoveredResources(),d=e.telegram_id||e.username||e.title,u=a.map(p=>{if((p.telegram_id||p.username||p.title)===d){let C=P(E({},p),{status:t,joined_at:new Date().toISOString()});return n&&(C.joined_by_phone=n),o&&o>0&&(C.member_count=o),C}return p});this.discoveredResources.set(u),console.log(`[Frontend] Updated resource status: ${d} -> ${t}`)}showPostJoinOptions(e,t,n){this.showJoinMonitorDialog.set(!1),this.showSuccessAnimation({icon:"\u{1F680}",title:"\u52A0\u5165\u6210\u529F\uFF01",subtitle:e?.title||"\u7FA4\u7D44\u5DF2\u6DFB\u52A0\u5230\u76E3\u63A7",duration:1200}),setTimeout(()=>{this.postJoinResource.set(e),this.postJoinPhone.set(t),this.showPostJoinDialog.set(!0)},1200)}closePostJoinDialog(){this.showPostJoinDialog.set(!1),this.postJoinResource.set(null),this.postJoinPhone.set("")}showSuccessAnimation(e){this.successOverlayConfig.set(e),this.showSuccessOverlay.set(!0);let t=e.duration||1500;setTimeout(()=>{this.hideSuccessAnimation()},t)}hideSuccessAnimation(){this.showSuccessOverlay.set(!1),this.successOverlayConfig.set(null)}postJoinExtractMembers(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openMemberListDialog(e))}postJoinSendMessage(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openSingleMessageDialog(e))}postJoinContinue(){this.closePostJoinDialog(),this.toastService.info("\u7E7C\u7E8C\u700F\u89BD\u5176\u4ED6\u7FA4\u7D44",2e3)}loadAccountQuotas(){let n=this.accounts().filter(o=>o.status==="Online").map(o=>{let a=Math.floor(o.dailySendCount/10)||0,d=20,u=Math.floor(o.dailySendCount/5)||0,p=o.healthScore||0,g=d>0?(d-u)/d*100:0,C=p*.5+g*.5;return{phone:o.phone,nickname:o.group||o.phone,joinedGroups:a,dailyLimit:d,dailyUsed:Math.min(u,d),isRecommended:!1,recommendScore:C,healthScore:p}}).sort((o,a)=>a.recommendScore-o.recommendScore).map((o,a)=>{let d=o.healthScore>=70&&o.dailyUsed<o.dailyLimit*.8,u=a<2&&d;return P(E({},o),{isRecommended:u})});if(this.accountQuotas.set(n),!this.joinMonitorSelectedPhone()){let o=n.find(a=>a.isRecommended);o?this.joinMonitorSelectedPhone.set(o.phone):n.length>0&&this.joinMonitorSelectedPhone.set(n[0].phone)}}toggleKeywordSetSelection(e){let t=this.joinMonitorSelectedKeywordSetIds();if(t.includes(e))this.joinMonitorSelectedKeywordSetIds.set(t.filter(n=>n!==e));else{let n=this.keywordSets().find(o=>o.id===e);if(n&&(!n.keywords||n.keywords.length===0)){this.toastService.warning(`\u26A0\uFE0F \u300C${n.name}\u300D\u6C92\u6709\u95DC\u9375\u8A5E\uFF0C\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u518D\u4F7F\u7528`);return}this.joinMonitorSelectedKeywordSetIds.set([...t,e])}}isKeywordSetSelected(e){return this.joinMonitorSelectedKeywordSetIds().includes(e)}openQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!0),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword=""}closeQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!1)}addQuickKeyword(){let e=this.quickCreateKeywordSetNewKeyword.trim();e&&!this.quickCreateKeywordSetKeywords().includes(e)&&(this.quickCreateKeywordSetKeywords.update(t=>[...t,e]),this.quickCreateKeywordSetNewKeyword="")}removeQuickKeyword(e){this.quickCreateKeywordSetKeywords.update(t=>t.filter(n=>n!==e))}addQuickRecommendedKeyword(e){this.quickCreateKeywordSetKeywords().includes(e)||this.quickCreateKeywordSetKeywords.update(t=>[...t,e])}executeQuickCreateKeywordSet(){let e=this.quickCreateKeywordSetName.trim(),t=this.quickCreateKeywordSetKeywords();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u8A5E\u96C6\u540D\u7A31");return}if(t.length===0){this.toastService.warning("\u8ACB\u81F3\u5C11\u6DFB\u52A0\u4E00\u500B\u95DC\u9375\u8A5E");return}this.ipcService.send("add-keyword-set",{name:e});let n=o=>{if(o.success&&o.setId){for(let a of t)this.ipcService.send("add-keyword",{setId:o.setId,keyword:a,isRegex:!1});this.joinMonitorSelectedKeywordSetIds.update(a=>[...a,o.setId]),this.toastService.success(`\u5DF2\u5275\u5EFA\u4E26\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6\u300C${e}\u300D`),this.closeQuickCreateKeywordSet(),this.ipcService.send("get-keyword-sets")}this.ipcService.off("keyword-set-added",n)};this.ipcService.on("keyword-set-added",n)}addMonitorKeyword(){let e=this.joinMonitorNewKeyword.trim();e&&!this.joinMonitorKeywords().includes(e)&&(this.joinMonitorKeywords.update(t=>[...t,e]),this.joinMonitorNewKeyword="")}removeMonitorKeyword(e){this.joinMonitorKeywords.update(t=>t.filter(n=>n!==e))}addRecommendedKeyword(e){this.joinMonitorKeywords().includes(e)||this.joinMonitorKeywords.update(t=>[...t,e])}getRecommendedKeywords(){let e=this.joinMonitorResource();if(!e)return[];let t=e.title||"",n=[];return(t.includes("\u4E8C\u624B")||t.includes("\u4EA4\u6613"))&&n.push("\u6C42\u8CFC","\u51FA\u552E","\u8F49\u8B93"),(t.includes("\u62DB\u8058")||t.includes("\u6C42\u8077"))&&n.push("\u62DB\u4EBA","\u6C42\u8077","\u517C\u8077"),(t.includes("\u83EF\u4EBA")||t.includes("\u6D77\u5916"))&&n.push("\u5408\u4F5C","\u8CC7\u6E90","\u6C42\u52A9"),n.length===0&&n.push("\u6C42\u8CFC","\u5408\u4F5C","\u8AEE\u8A62"),n.filter(o=>!this.joinMonitorKeywords().includes(o))}getKeywordPreview(e){if(!e||e.length===0)return"";let t=e.slice(0,3).map(n=>n.keyword||n.text||n).join(", ");return e.length>3?t+"...":t}executeJoinAndMonitor(){let e=this.joinMonitorResource(),t=this.joinMonitorSelectedPhone();if(!e){this.toastService.error("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}if(e.status!=="joined"&&e.status!=="monitoring"&&!t){this.toastService.error("\u8ACB\u9078\u64C7\u52A0\u5165\u5E33\u865F");return}this.isJoiningResource.set(!0);let n=this.joinMonitorSelectedKeywordSetIds(),o={resourceId:e.id||0,phone:t,keywordSetIds:n,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable()};if(!e.id||e.id===0){let a=e.link||e.invite_link||"",d=e.username||"";if(d&&d.toLowerCase().endsWith("bot")&&(console.log(`[Frontend] \u904E\u6FFE bot username: ${d}`),d=""),a&&/t\.me\/[^/]+\/\d+/.test(a)&&(console.log(`[Frontend] \u904E\u6FFE\u6D88\u606F\u93C8\u63A5: ${a}`),a=""),!a&&!d){let p=e.title||"\u6B64\u7FA4\u7D44";this.toastService.error(`\u7121\u6CD5\u52A0\u5165\u300C${p}\u300D\uFF1A
\u2022 \u6B64\u641C\u7D22\u7D50\u679C\u6C92\u6709\u63D0\u4F9B\u7FA4\u7D44\u7684\u9080\u8ACB\u93C8\u63A5
\u2022 \u8ACB\u5728 Telegram \u4E2D\u9EDE\u64CA\u641C\u7D22\u6A5F\u5668\u4EBA\u7684\u7D50\u679C
\u2022 \u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5\u5F8C\u518D\u8A66`),this.isJoiningResource.set(!1);return}let u="";e.telegram_id&&e.telegram_id!==e.title&&!e.telegram_id.toLowerCase().endsWith("bot")?u=e.telegram_id:d&&(u=d),o.resourceInfo={username:d,telegram_id:u,title:e.title||d||"\u672A\u547D\u540D\u7FA4\u7D44",description:e.description||"",member_count:e.member_count||0,resource_type:e.resource_type||"supergroup",link:a||(d?`https://t.me/${d}`:"")},console.log("[Frontend] Sending resourceInfo:",o.resourceInfo)}if(this.ipcService.send("join-and-monitor-with-account",o),e.status==="joined"||e.status==="monitoring"){let a=e.username?`@${e.username}`:e.telegram_id;this.ipcService.send("add-group",{url:a,keywordSetIds:n})}}openMonitorSettings(e){this.openJoinAndMonitorDialog(e)}openBatchJoinMonitorDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.batchJoinResources.set(t),this.joinMonitorSelectedPhones.set([]),this.joinMonitorKeywords.set([]),this.joinMonitorSelectedKeywordSetIds.set([]),this.joinMonitorBatchMode.set(!0),this.joinMonitorBatchInterval.set(45),this.loadAccountQuotas(),this.showBatchJoinMonitorDialog.set(!0)}getBatchJoinTotalMembers(){return this.batchJoinResources().reduce((e,t)=>e+(t.member_count||0),0)}closeBatchJoinMonitorDialog(){this.showBatchJoinMonitorDialog.set(!1),this.batchJoinResources.set([])}toggleAccountSelection(e){let t=this.joinMonitorSelectedPhones();t.includes(e)?this.joinMonitorSelectedPhones.set(t.filter(n=>n!==e)):this.joinMonitorSelectedPhones.set([...t,e])}selectAllAccounts(){let e=this.accountQuotas().map(t=>t.phone);this.joinMonitorSelectedPhones.set(e)}executeBatchJoinMonitor(){let e=this.batchJoinResources(),t=this.joinMonitorSelectedPhones();if(e.length===0){this.toastService.error("\u6C92\u6709\u9078\u64C7\u7FA4\u7D44");return}if(t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u5E33\u865F");return}this.isJoiningResource.set(!0),this.batchJoinProgress.set({current:0,total:e.length,status:"\u6E96\u5099\u4E2D..."});let n=this.joinMonitorSelectedKeywordSetIds();this.ipcService.send("batch-join-and-monitor",{resourceIds:e.map(o=>o.id),phones:t,keywordSetIds:n,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable(),batchMode:this.joinMonitorBatchMode(),batchInterval:this.joinMonitorBatchInterval()}),this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44\uFF0C\u4F7F\u7528 ${t.length} \u500B\u5E33\u865F`)}openMemberListDialog(e){this.memberListResource.set(e),this.memberListData.set([]),this.memberListLoading.set(!1),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:""}),this.selectedMemberIds.set([]),this.memberExtractStarted.set(!1),this.memberListFilter.set("all"),this.memberExtractConfig.set({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}}),this.showMemberListDialog.set(!0)}closeMemberListDialog(){this.showMemberListDialog.set(!1),this.memberListResource.set(null),this.memberListData.set([])}loadMemberList(e){if(!e||!e.telegram_id){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44\u4FE1\u606F");return}this.memberListLoading.set(!0),this.memberListProgress.update(t=>P(E({},t),{status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:0})}extractMoreMembers(){let e=this.memberListResource(),t=this.memberListData().length;e&&(this.memberListLoading.set(!0),this.memberListProgress.update(n=>P(E({},n),{status:"\u6B63\u5728\u63D0\u53D6\u66F4\u591A\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:t}))}toggleMemberIdSelection(e){let t=this.selectedMemberIds();t.includes(e)?this.selectedMemberIds.set(t.filter(n=>n!==e)):this.selectedMemberIds.set([...t,e])}selectAllMembers(){let e=this.memberListData().map(t=>t.user_id);this.selectedMemberIds.set(e)}exportMembersToCSV(){let e=this.getFilteredMembers();if(e.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u6210\u54E1");return}let t=this.memberListResource(),n=`members_${t?.username||t?.telegram_id}_${new Date().toISOString().slice(0,10)}.csv`,o=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u5168\u540D","\u96FB\u8A71\u865F\u78BC","\u500B\u4EBA\u7C21\u4ECB","\u8A9E\u8A00","DC","\u5728\u7DDA\u72C0\u614B","\u6700\u5F8C\u4E0A\u7DDA","\u89D2\u8272","\u52A0\u5165\u65E5\u671F","Premium","\u5DF2\u8A8D\u8B49","Bot","\u6709\u982D\u50CF","\u8A50\u9A19","\u5047\u5E33\u865F","\u53D7\u9650\u5236","\u5DF2\u522A\u9664","\u83EF\u4EBA","\u6D3B\u8E8D\u5EA6","\u50F9\u503C\u7B49\u7D1A","\u4F86\u6E90\u7FA4\u7D44","\u63D0\u53D6\u6642\u9593"],a=w=>{if(w==null)return"";let A=String(w);return A.includes(",")||A.includes('"')||A.includes(`
`)?`"${A.replace(/"/g,'""')}"`:A},d=e.map(w=>[w.user_id,w.username||"",w.first_name||"",w.last_name||"",w.full_name||`${w.first_name||""} ${w.last_name||""}`.trim(),w.phone||"",a(w.bio||""),w.language_code||"",w.dc_id||"",w.online_status||"",w.last_online||"",w.chat_member_status||"member",w.joined_date||"",w.is_premium?"\u662F":"\u5426",w.is_verified?"\u662F":"\u5426",w.is_bot?"\u662F":"\u5426",w.has_photo?"\u662F":"\u5426",w.is_scam?"\u662F":"\u5426",w.is_fake?"\u662F":"\u5426",w.is_restricted?"\u662F":"\u5426",w.is_deleted?"\u662F":"\u5426",this.isChineseMember(w)?"\u662F":"\u5426",w.activity_score?(w.activity_score*100).toFixed(0)+"%":"",w.value_level||"",w.source_chat_title||"",w.extracted_at||""]),u=[o,...d].map(w=>w.map(a).join(",")).join(`
`),p=new Blob(["\uFEFF"+u],{type:"text/csv;charset=utf-8"}),g=URL.createObjectURL(p),C=document.createElement("a");C.href=g,C.download=n,C.click(),URL.revokeObjectURL(g),this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}setMemberExtractLimit(e){this.memberExtractConfig.update(t=>P(E({},t),{limit:e}))}applyExtractPreset(e){this.selectedPreset.set(e);let t=this.extractPresets.find(n=>n.id===e);t&&(this.memberExtractConfig.update(n=>P(E({},n),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),t.config.userTypes&&this.memberExtractConfig.update(n=>P(E({},n),{userTypes:E(E({},n.userTypes),t.config.userTypes)})),t.config.activityFilters&&this.memberExtractConfig.update(n=>P(E({},n),{activityFilters:E(E({},n.activityFilters),t.config.activityFilters)})),t.config.accountFeatures&&this.memberExtractConfig.update(n=>P(E({},n),{accountFeatures:E(E({},n.accountFeatures),t.config.accountFeatures)})),this.toastService.info(`\u5DF2\u61C9\u7528\u300C${t.name}\u300D\u9810\u8A2D`))}toggleUserType(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>P(E({},t),{userTypes:P(E({},t.userTypes),{[e]:!t.userTypes[e]})}))}toggleActivityFilter(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>P(E({},t),{activityFilters:P(E({},t.activityFilters),{[e]:!t.activityFilters[e]})}))}toggleAccountFeature(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>P(E({},t),{accountFeatures:P(E({},t.accountFeatures),{[e]:!t.accountFeatures[e]})}))}toggleExcludeFilter(e){this.memberExtractConfig.update(t=>P(E({},t),{excludeFilters:P(E({},t.excludeFilters),{[e]:!t.excludeFilters[e]})}))}getActiveFilterCount(){let e=this.memberExtractConfig(),t=0;return Object.values(e.userTypes).forEach(n=>n&&t++),Object.values(e.activityFilters).forEach(n=>n&&t++),Object.values(e.accountFeatures).forEach(n=>n&&t++),t}clearAllFilters(){this.selectedPreset.set(""),this.memberExtractConfig.update(e=>P(E({},e),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),this.toastService.info("\u5DF2\u6E05\u9664\u6240\u6709\u7BE9\u9078\u689D\u4EF6")}startMemberExtraction(){console.log("[Frontend] startMemberExtraction called");let e=this.memberListResource();if(console.log("[Frontend] Resource:",e),!e){console.error("[Frontend] No resource selected"),this.toastService.error("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u7FA4\u7D44");return}this.memberExtractStarted.set(!0),this.memberListLoading.set(!0),this.memberListData.set([]),this.extractionStartTime.set(Date.now());let t=this.memberExtractConfig(),n=t.limit===-1?t.customLimit:t.limit===0?99999:t.limit;console.log("[Frontend] Extraction config:",{limit:n,config:t}),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."});let o={resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:n,offset:0,filters:{onlineOnly:t.activityFilters.onlineNow,chineseOnly:t.userTypes.chinese,premiumOnly:t.accountFeatures.premium,hasUsername:t.accountFeatures.hasUsername,excludeBots:t.excludeFilters.bots}};console.log("[Frontend] Sending extract-members IPC:",o),this.toastService.info("\u{1F4E4} \u6B63\u5728\u767C\u9001\u63D0\u53D6\u8ACB\u6C42..."),this.ipcService.send("extract-members",o),t.backgroundMode&&(this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C"),this.closeMemberListDialog())}pauseMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>P(E({},e),{status:"\u5DF2\u66AB\u505C"})),this.toastService.info("\u23F8\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u66AB\u505C")}stopMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>P(E({},e),{status:"\u5DF2\u505C\u6B62"})),this.toastService.info("\u23F9\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u505C\u6B62")}toggleMemberExtractBackground(){this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C\uFF0C\u5B8C\u6210\u5F8C\u6703\u901A\u77E5\u60A8"),this.closeMemberListDialog()}handleMemberExtractionError(e){let t=e.error_code||"UNKNOWN",n=e.error_details||{};switch(this.memberListProgress.update(o=>P(E({},o),{status:"\u63D0\u53D6\u5931\u6557"})),t){case"PEER_ID_INVALID":case"NOT_PARTICIPANT":case"CHANNEL_PRIVATE":this.showExtractionErrorWithAction("\u26A0\uFE0F \u7121\u6CD5\u63D0\u53D6\u6210\u54E1",n.reason||"\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44",n.suggestion||"\u8ACB\u5148\u52A0\u5165\u7FA4\u7D44\u518D\u5617\u8A66\u63D0\u53D6",n.can_auto_join?"join":void 0);break;case"ADMIN_REQUIRED":this.showExtractionErrorWithAction("\u{1F512} \u6210\u54E1\u5217\u8868\u53D7\u9650",n.reason||"\u7FA4\u7D44\u8A2D\u7F6E\u9650\u5236\u4E86\u6210\u54E1\u5217\u8868\u8A2A\u554F",n.suggestion||"\u53EF\u5617\u8A66\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u6536\u96C6\u6D3B\u8E8D\u7528\u6236",n.alternative==="monitor_messages"?"monitor":void 0);break;case"FLOOD_WAIT":this.toastService.warning(`\u23F3 ${e.error}

${n.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}`);break;case"CHANNEL_INVALID":this.toastService.error(`\u274C ${e.error}

${n.suggestion||"\u8ACB\u5237\u65B0\u8CC7\u6E90\u5217\u8868"}`);break;default:this.toastService.error(`\u274C \u63D0\u53D6\u5931\u6557: ${e.error}`)}}showExtractionErrorWithAction(e,t,n,o){let a=this.memberListResource(),d=`${e}

\u539F\u56E0\uFF1A${t}

\u{1F4A1} ${n}`;o==="join"&&a?(d+=`

\u9EDE\u64CA\u300C\u52A0\u5165\u7FA4\u7D44\u300D\u6309\u9215\u5F8C\u91CD\u8A66`,this.toastService.warning(d),this.memberListProgress.update(u=>P(E({},u),{status:"\u9700\u8981\u5148\u52A0\u5165\u7FA4\u7D44"}))):o==="monitor"&&a?(d+=`

\u5EFA\u8B70\uFF1A\u555F\u52D5\u6D88\u606F\u76E3\u63A7\u4F86\u6536\u96C6\u6D3B\u8E8D\u7528\u6236`,this.toastService.warning(d),this.memberListProgress.update(u=>P(E({},u),{status:"\u5EFA\u8B70\u4F7F\u7528\u6D88\u606F\u76E3\u63A7"}))):this.toastService.error(d)}async autoJoinAndExtract(){let e=this.memberListResource();if(!e)return;this.toastService.info("\u{1F680} \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44...");let t=this.accounts().find(n=>n.status==="Online");t?(this.ipcService.send("join-group",{phone:t.phone,groupUrl:e.username?`https://t.me/${e.username}`:e.invite_link}),this.ipcService.once("group-join-result",n=>{n.success?(this.toastService.success("\u2705 \u6210\u529F\u52A0\u5165\u7FA4\u7D44\uFF0C\u6B63\u5728\u91CD\u65B0\u63D0\u53D6..."),setTimeout(()=>{this.startMemberExtraction()},2e3)):this.toastService.error(`\u274C \u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${n.error}`)})):this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F")}getFirstOnlineAccount(){return this.accounts().find(e=>e.status==="Online")}calculateAndShowExtractionSummary(e){let t=this.memberListResource(),n=this.extractionStartTime(),o=n>0?Math.round((Date.now()-n)/1e3):0,a=0,d=0,u=0,p=0,g=0,C=0,w={S:0,A:0,B:0,C:0,D:0};for(let A of e){A.online_status==="online"?a++:A.online_status==="recently"&&d++,A.is_premium&&u++,this.isChineseMember(A)&&p++,A.username&&g++,A.is_bot&&C++;let V=A.value_level||this.calculateMemberValueLevel(A);V&&w.hasOwnProperty(V)&&w[V]++}this.extractionSummary.set({groupName:t?.title||t?.name||"\u672A\u77E5\u7FA4\u7D44",groupUrl:t?.username?`t.me/${t.username}`:t?.url||"",totalExtracted:e.length,totalInGroup:t?.member_count||0,onlineCount:a,recentlyCount:d,premiumCount:u,chineseCount:p,hasUsernameCount:g,botCount:C,valueLevelDistribution:w,extractedAt:new Date().toLocaleString("zh-TW"),duration:o}),this.showExtractionSummaryDialog.set(!0),this.toastService.success(`\u2705 \u6210\u529F\u63D0\u53D6 ${e.length} \u500B\u6210\u54E1`)}calculateMemberValueLevel(e){let t=0;return e.is_premium&&(t+=30),e.online_status==="online"?t+=25:e.online_status==="recently"?t+=20:e.online_status==="last_week"&&(t+=10),e.username&&(t+=15),this.isChineseMember(e)&&(t+=10),e.is_bot&&(t-=50),e.activity_score&&(t+=Math.min(e.activity_score,20)),t>=70?"S":t>=50?"A":t>=30?"B":t>=10?"C":"D"}closeExtractionSummaryDialog(){this.showExtractionSummaryDialog.set(!1)}goToMemberDatabaseFromSummary(){this.closeExtractionSummaryDialog(),this.closeMemberListDialog(),this.currentView.set("member-database")}startBatchMarketingFromSummary(){this.closeExtractionSummaryDialog(),this.toastService.info("\u{1F4A1} \u8ACB\u5728\u6210\u54E1\u5217\u8868\u4E2D\u9078\u64C7\u8981\u71DF\u92B7\u7684\u7528\u6236\uFF0C\u7136\u5F8C\u9EDE\u64CA\u300C\u6279\u91CF\u767C\u9001\u300D")}getValueLevelPercent(e){let t=this.extractionSummary(),n=t.totalExtracted;if(n===0)return 0;let o=t.valueLevelDistribution[e]||0;return Math.round(o/n*100)}setMemberFilter(e){this.memberListFilter.set(e)}getFilteredMembers(){let e=this.memberListData();switch(this.memberListFilter()){case"chinese":return e.filter(n=>this.isChineseMember(n));case"online":return e.filter(n=>n.online_status==="online"||n.online_status==="recently");case"premium":return e.filter(n=>n.is_premium);case"hasUsername":return e.filter(n=>!!n.username);default:return e}}isChineseMember(e){let t=/[\u4e00-\u9fa5]/,n=(e.first_name||"")+(e.last_name||"");return t.test(n)}getChineseMemberCount(){return this.memberListData().filter(e=>this.isChineseMember(e)).length}getOnlineMemberCount(){return this.memberListData().filter(e=>e.online_status==="online"||e.online_status==="recently").length}getPremiumMemberCount(){return this.memberListData().filter(e=>e.is_premium).length}getMemberExtractPercent(){let e=this.memberListProgress();return e.total===0?0:Math.min(100,Math.round(this.memberListData().length/e.total*100))}isAllMembersSelected(){let e=this.getFilteredMembers();return e.length>0&&e.every(t=>this.selectedMemberIds().includes(t.user_id))}toggleSelectAllMembersList(){let e=this.getFilteredMembers();this.isAllMembersSelected()?this.selectedMemberIds.set([]):this.selectedMemberIds.set(e.map(t=>t.user_id))}sendPrivateMessage(e){if(!e.username){this.toastService.warning("\u8A72\u7528\u6236\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u79C1\u4FE1");return}this.toastService.info(`\u{1F4E8} \u6E96\u5099\u767C\u9001\u79C1\u4FE1\u7D66 @${e.username}`)}batchSendPrivateMessage(){let e=this.selectedMemberIds().length;this.toastService.info(`\u{1F4E8} \u6E96\u5099\u6279\u91CF\u767C\u9001\u79C1\u4FE1\u7D66 ${e} \u500B\u6210\u54E1`)}batchAddFriend(){let e=this.selectedMemberIds().length;this.toastService.info(`\u2795 \u6E96\u5099\u6279\u91CF\u6DFB\u52A0 ${e} \u500B\u597D\u53CB`)}addMemberToFunnel(e){let t={userId:e.user_id,username:e.username||"",firstName:e.first_name||"",lastName:e.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u624B\u52D5\u6DFB\u52A0",onlineStatus:e.online_status||"unknown"};this.ipcService.send("add-lead",t),this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${e.first_name||e.username||"ID:"+e.user_id} \u52A0\u5165\u71DF\u92B7\u6F0F\u6597`)}batchAddToFunnel(){let e=this.selectedMemberIds(),t=this.memberListData().filter(o=>e.includes(o.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let n=0;for(let o of t){let a={userId:o.user_id,username:o.username||"",firstName:o.first_name||"",lastName:o.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u6279\u91CF\u6DFB\u52A0",onlineStatus:o.online_status||"unknown"};this.ipcService.send("add-lead",a),n++}this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${n} \u500B\u6210\u54E1\u52A0\u5165\u71DF\u92B7\u6F0F\u6597`),this.clearMemberSelection()}clearMemberSelection(){this.selectedMemberIds.set([])}exportSelectedMembersToCSV(){let e=this.selectedMemberIds(),t=this.memberListData().filter(p=>e.includes(p.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let n=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u8A55\u7D1A","\u5728\u7DDA\u72C0\u614B","Premium","\u4F86\u6E90\u7FA4\u7D44"],o=t.map(p=>[p.user_id,p.username||"",p.first_name||"",p.last_name||"",this.calculateMemberValueLevel(p),p.online_status||"unknown",p.is_premium?"\u662F":"\u5426",this.memberListResource()?.title||""]),a=[n.join(","),...o.map(p=>p.join(","))].join(`
`),d=new Blob(["\uFEFF"+a],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a");u.href=URL.createObjectURL(d),u.download=`selected-members-${new Date().toISOString().split("T")[0]}.csv`,u.click(),this.toastService.success(`\u{1F4E5} \u5DF2\u5C0E\u51FA ${t.length} \u500B\u6210\u54E1`)}selectHighValueMembers(){let t=this.memberListData().filter(n=>{let o=this.calculateMemberValueLevel(n);return o==="S"||o==="A"}).map(n=>n.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B S/A \u7D1A\u6210\u54E1`)}selectOnlineMembers(){let t=this.memberListData().filter(n=>n.online_status==="online"||n.online_status==="recently").map(n=>n.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B\u5728\u7DDA/\u6700\u8FD1\u6D3B\u8E8D\u6210\u54E1`)}selectAllMembersInList(){let e=this.getFilteredMembers();this.selectedMemberIds.set(e.map(t=>t.user_id)),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${e.length} \u500B\u6210\u54E1`)}openBatchMemberExtractDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u63D0\u53D6 ${e.length} \u500B\u7FA4\u7D44\u7684\u6210\u54E1`),this.ipcService.send("batch-extract-members",{resourceIds:e,limit:100,safeMode:!0})}openSingleMessageDialog(e){this.singleMessageResource.set(e),this.singleMessageContent="",this.singleMessageScheduled.set(!1),this.singleMessageScheduleTime="",this.singleMessageAccountId.set(""),this.loadAccountQuotas(),this.showSingleMessageDialog.set(!0)}closeSingleMessageDialog(){this.showSingleMessageDialog.set(!1),this.singleMessageResource.set(null)}executeSingleMessage(){let e=this.singleMessageResource(),t=this.singleMessageContent.trim();if(!e){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44");return}if(!t){this.toastService.error("\u8ACB\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let n=this.singleMessageAccountId();if(!n){this.toastService.error("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.singleMessageScheduled()&&this.singleMessageScheduleTime?(this.ipcService.send("schedule-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:n,scheduledTime:this.singleMessageScheduleTime}),this.toastService.success(`\u23F0 \u6D88\u606F\u5DF2\u6392\u7A0B\uFF0C\u5C07\u65BC ${this.singleMessageScheduleTime} \u767C\u9001`)):(this.ipcService.send("send-group-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:n}),this.toastService.info("\u{1F4E8} \u6B63\u5728\u767C\u9001\u6D88\u606F...")),this.closeSingleMessageDialog()}refreshAllResources(){this.isRefreshing.set(!0),this.toastService.info("\u6B63\u5728\u5237\u65B0\u8CC7\u6E90\u6578\u64DA..."),this.refreshResourceStats(),this.loadResources(),this.loadDiscoveryKeywords(),setTimeout(()=>{this.isRefreshing.set(!1),this.toastService.success("\u5237\u65B0\u5B8C\u6210")},2e3)}clearSearchResults(){let e=this.discoveredResources().length;if(e===0){this.toastService.warning("\u6C92\u6709\u53EF\u6E05\u7A7A\u7684\u8CC7\u6E90");return}confirm(`\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709 ${e} \u689D\u641C\u7D22\u7D50\u679C\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u8CC7\u6E90\u8A18\u9304\uFF0C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&this.ngZone.run(()=>{this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.refreshResourceStats(),this.cdr.detectChanges()})}deleteAllDiscoveredResources(){let e=this.discoveredResources().filter(t=>t.status==="discovered").map(t=>t.id);if(e.length===0){this.toastService.info("\u6C92\u6709\u53EF\u522A\u9664\u7684\u672A\u8655\u7406\u8CC7\u6E90");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6240\u6709\u672A\u8655\u7406\u7684\u8CC7\u6E90\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002")&&(this.ipcService.send("delete-resources-batch",{resourceIds:e}),this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u522A\u9664 ${e.length} \u500B\u8CC7\u6E90`),setTimeout(()=>this.loadResources(),500))}clearDiscoveredResources(){this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.toastService.info("\u5DF2\u6E05\u7A7A\u7576\u524D\u641C\u7D22\u7D50\u679C")}clearHistoryData(e="all"){confirm(`\u78BA\u5B9A\u8981\u6E05\u7406 ${{all:"\u6240\u6709\u8CC7\u6E90\u6578\u64DA",old_data:"\u820A\u6578\u64DA",search_history:"\u641C\u7D22\u6B77\u53F2\uFF08\u4FDD\u7559\u6536\u85CF\uFF09"}[e]} \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&(this.toastService.info("\u{1F9F9} \u6B63\u5728\u6E05\u7406..."),this.ipcService.send("clear-resources",{type:e,daysToKeep:e==="old_data"?7:0}))}clearAllSearchHistory(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2\u55CE\uFF1F\u6B64\u64CD\u4F5C\u6703\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u641C\u7D22\u7D50\u679C\u3002")&&(this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.searchHistoryKeywords.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.showSearchHistory.set(!1),this.toastService.success("\u5DF2\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2"))}toggleSearchHistoryMode(){let e=!this.showSearchHistory();this.showSearchHistory.set(e),e?(this.loadResources(),this.toastService.info("\u6B63\u5728\u8F09\u5165\u6B77\u53F2\u641C\u7D22\u7D50\u679C...")):this.currentSearchKeyword()||this.discoveredResources.set([])}searchFromHistory(e){this.resourceSearchQuery=e,this.showSearchHistory.set(!1),this.searchResources()}handleSearchDiscoverySearch(e){this.resourceSearchQuery=e.query,this.selectedSearchSources.set(e.sources),this.searchResources()}handleSearchDiscoverySelectAccount(e){this.selectResourceAccount(e.id)}handleOnboardingNavigate(e){console.log("[Onboarding] \u5BFC\u822A\u5230:",e),this.changeView(e)}openOnboarding(){this.onboardingComponent&&this.onboardingComponent.open()}resetOnboarding(){this.onboardingComponent&&(this.onboardingComponent.reset(),this.onboardingComponent.open())}saveResource(e){if(!e.telegram_id){this.toastService.error("\u7121\u6CD5\u6536\u85CF\uFF1A\u7F3A\u5C11\u8CC7\u6E90 ID");return}this.ipcService.send("save-resource",{telegram_id:e.telegram_id,username:e.username,title:e.title,description:e.description,member_count:e.member_count,resource_type:e.resource_type,overall_score:e.overall_score,discovery_keyword:this.currentSearchKeyword()});let t=new Set(this.savedResources());t.add(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(a=>a.telegram_id===e.telegram_id?P(E({},a),{is_saved:!0}):a);this.discoveredResources.set(o),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF\u300C${e.title}\u300D`)}unsaveResource(e){if(!e.telegram_id)return;this.ipcService.send("unsave-resource",{telegram_id:e.telegram_id});let t=new Set(this.savedResources());t.delete(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(a=>a.telegram_id===e.telegram_id?P(E({},a),{is_saved:!1}):a);this.discoveredResources.set(o),this.toastService.info(`\u5DF2\u53D6\u6D88\u6536\u85CF\u300C${e.title}\u300D`)}batchSaveResources(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u6536\u85CF\u7684\u8CC7\u6E90");return}let t=this.discoveredResources().filter(n=>e.includes(n.id)||e.some(o=>String(o)===n.telegram_id));t.forEach(n=>this.saveResource(n)),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF ${t.length} \u500B\u8CC7\u6E90`)}isResourceSaved(e){return e.is_saved||this.savedResources().has(e.telegram_id)}syncContactsData(){this.contactsService.syncFromSources(),this.toastService.info("\u6B63\u5728\u540C\u6B65\u6578\u64DA...",2e3)}joinAndMonitor(e){let t=this.discoveredResources().find(n=>n.id===e);if(!t){this.toastService.error("\u627E\u4E0D\u5230\u8A72\u8CC7\u6E90");return}this.toastService.info(`\u6B63\u5728\u52A0\u5165\u4E26\u76E3\u63A7: ${t.title}`),this.ipcService.send("join-and-monitor-resource",{resourceId:e,username:t.username,telegramId:t.telegram_id,title:t.title})}batchJoinAndMonitor(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}this.toastService.info(`\u6B63\u5728\u6279\u91CF\u52A0\u5165\u4E26\u76E3\u63A7 ${e.length} \u500B\u7FA4\u7D44...`),this.ipcService.send("batch-join-and-monitor",{resourceIds:e})}loadDiscoveryKeywords(){this.ipcService.send("get-discovery-keywords",{})}addDiscoveryKeyword(){if(!this.newResourceKeyword.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E");return}this.ipcService.send("add-discovery-keyword",{keyword:this.newResourceKeyword.trim(),category:"general",priority:5})}searchWithKeyword(e){this.resourceSearchQuery=e,this.searchResources()}toggleResourceSelection(e){let t=this.selectedResourceIds();t.includes(e)?this.selectedResourceIds.set(t.filter(n=>n!==e)):this.selectedResourceIds.set([...t,e])}toggleSelectAllResources(){let e=this.discoveredResources();this.selectedResourceIds().length===e.length?this.selectedResourceIds.set([]):this.selectedResourceIds.set(e.map(n=>n.id))}addSelectedToJoinQueue(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("add-to-join-queue",{resourceIds:e,priority:5})}processJoinQueue(){this.isProcessingJoinQueue.set(!0),this.ipcService.send("process-join-queue",{limit:5})}toggleSearchSource(e){let t=this.selectedSearchSources();t.includes(e)?this.selectedSearchSources.set(t.filter(n=>n!==e)):this.selectedSearchSources.set([...t,e])}selectAllSearchSources(){this.selectedSearchSources.set(["telegram","jiso","tgstat","local"])}enterGroup(e){this.changeView("resources"),this.toastService.info(`\u6E96\u5099\u9032\u5165\u7FA4\u7D44\uFF1A${e.title}`)}batchEnterGroups(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.toastService.info(`\u6E96\u5099\u9032\u5165 ${t.length} \u500B\u7FA4\u7D44\u67E5\u770B\u6210\u54E1`)}sendGroupMessage(e){this.selectedResourceIds.set([e.id]),this.showBatchMessageDialog.set(!0)}executeBatchMessage(){let e=this.selectedResourceIds();if(e.length===0||!this.batchMessageContent.trim()){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u4E26\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.toastService.success(`\u958B\u59CB\u5411 ${t.length} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!1)}inviteMembersToGroup(e){this.selectedResourceIds.set([e.id]),this.loadAvailableMembers(),this.showBatchInviteDialog.set(!0)}executeBatchInvite(){let e=this.selectedResourceIds(),t=this.batchInviteConfig.selectedMemberIds;if(e.length===0||t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u548C\u6210\u54E1");return}this.toastService.success(`\u958B\u59CB\u9080\u8ACB ${t.length} \u4F4D\u6210\u54E1\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44`),this.showBatchInviteDialog.set(!1)}loadAvailableMembers(){this.availableMembersForInvite.set([{id:"1",name:"\u793A\u4F8B\u6210\u54E11",username:"member1"},{id:"2",name:"\u793A\u4F8B\u6210\u54E12",username:"member2"}])}toggleSelectAllMembers(e){e.target.checked?(this.batchInviteConfig.selectedMemberIds=this.availableMembersForInvite().map(n=>n.id),this.batchInviteConfig.selectAll=!0):(this.batchInviteConfig.selectedMemberIds=[],this.batchInviteConfig.selectAll=!1)}toggleMemberSelection(e,t){let n=t.target.checked,o=this.batchInviteConfig.selectedMemberIds;n?this.batchInviteConfig.selectedMemberIds=[...o,e]:this.batchInviteConfig.selectedMemberIds=o.filter(a=>a!==e),this.batchInviteConfig.selectAll=this.batchInviteConfig.selectedMemberIds.length===this.availableMembersForInvite().length}batchJoinSelected(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("batch-join-resources",{resourceIds:e,delayMin:30,delayMax:60})}toggleResourceMenu(e,t){t&&t.stopPropagation(),this.openResourceMenuId()===e?this.openResourceMenuId.set(null):this.openResourceMenuId.set(e)}closeResourceMenu(){this.openResourceMenuId.set(null)}getResourceStatusColor(e){return{discovered:"bg-blue-500",queued:"bg-yellow-500",joining:"bg-orange-500",joined:"bg-green-500",monitoring:"bg-emerald-500",left:"bg-gray-500",blocked:"bg-red-500",invalid:"bg-slate-500"}[e]||"bg-gray-500"}getSizeGrade(e){return e>=1e5?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",label:"\u8D85\u5927\u578B"}:e>=1e4?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",label:"\u5927\u578B"}:e>=1e3?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",label:"\u4E2D\u578B"}:e>=100?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",label:"\u5C0F\u578B"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",label:"\u5FAE\u578B"}}getScoreGrade(e){let t=e*100;return t>=90?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",icon:"\u{1F3C6}"}:t>=75?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",icon:"\u2B50"}:t>=60?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",icon:"\u{1F44D}"}:t>=40?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",icon:"\u{1F44C}"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",icon:"\u26A0\uFE0F"}}getScoreBarColor(e){let t=e*100;return t>=90?"bg-amber-400":t>=75?"bg-green-400":t>=60?"bg-blue-400":t>=40?"bg-slate-400":"bg-red-400"}getResourceStatusName(e){return{discovered:"\u5DF2\u767C\u73FE",queued:"\u968A\u5217\u4E2D",joining:"\u52A0\u5165\u4E2D",joined:"\u5DF2\u52A0\u5165",monitoring:"\u76E3\u63A7\u4E2D",left:"\u5DF2\u9000\u51FA",blocked:"\u88AB\u5C01\u7981",invalid:"\u7121\u6548"}[e]||e}getResourceTypeName(e){return{group:"\u7FA4\u7D44",supergroup:"\u8D85\u7D1A\u7FA4\u7D44",channel:"\u983B\u9053",bot:"\u6A5F\u5668\u4EBA"}[e]||e}getResourceTypeStyle(e){return{channel:{icon:"\u{1F4E2}",label:"\u983B\u9053",bgClass:"bg-purple-500/20",textClass:"text-purple-400",canMessage:!1,canExtract:!1},supergroup:{icon:"\u{1F465}",label:"\u8D85\u7D1A\u7FA4\u7D44",bgClass:"bg-blue-500/20",textClass:"text-blue-400",canMessage:!0,canExtract:!0},group:{icon:"\u{1F4AC}",label:"\u7FA4\u7D44",bgClass:"bg-green-500/20",textClass:"text-green-400",canMessage:!0,canExtract:!0},bot:{icon:"\u{1F916}",label:"\u6A5F\u5668\u4EBA",bgClass:"bg-orange-500/20",textClass:"text-orange-400",canMessage:!0,canExtract:!1}}[e]||{icon:"\u{1F4CC}",label:"\u672A\u77E5",bgClass:"bg-slate-500/20",textClass:"text-slate-400",canMessage:!1,canExtract:!1}}isChannel(e){return e?.resource_type==="channel"}canSendMessageToResource(e){return!this.isChannel(e)}canExtractMembers(e){return!this.isChannel(e)}showChannelMemberWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u63D0\u53D6\u6210\u54E1\u5217\u8868

Telegram \u4E0D\u5141\u8A31\u67E5\u770B\u983B\u9053\u7684\u8A02\u95B1\u8005\u5217\u8868\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u5C0B\u627E\u8A72\u983B\u9053\u7684\u95DC\u806F\u8A0E\u8AD6\u7FA4\u7D44`)}showChannelMessageWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u767C\u9001\u6D88\u606F

\u53EA\u6709\u983B\u9053\u7BA1\u7406\u54E1\u53EF\u4EE5\u767C\u5E03\u5167\u5BB9\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u95DC\u6CE8\u983B\u9053\u7372\u53D6\u8CC7\u8A0A\uFF0C\u6216\u5C0B\u627E\u8A0E\u8AD6\u7FA4\u7D44`)}verifyResourceType(e){if(!e?.id){this.toastService.error("\u7121\u6548\u7684\u8CC7\u6E90");return}this.toastService.info(`\u{1F50D} \u6B63\u5728\u9A57\u8B49: ${e.title||e.username}...`),this.ipcService.send("verify-resource-type",{resourceId:e.id})}getResourcePermissionStatus(e){return this.isChannel(e)?{icon:"\u{1F4E2}",text:"\u50C5\u8A02\u95B1",class:"text-purple-400"}:{icon:"\u2705",text:"\u53EF\u4E92\u52D5",class:"text-green-400"}}getSelectedChannelCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type==="channel").length}getSelectedGroupCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel").length}getSelectedMessageableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel")}getSelectedExtractableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel")}openBatchMessageWithFilter(){let e=this.getSelectedChannelCount();e>0&&this.toastService.info(`\u{1F4E2} \u5DF2\u81EA\u52D5\u6392\u9664 ${e} \u500B\u983B\u9053\uFF0C\u5C07\u5C0D ${this.getSelectedGroupCount()} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!0)}initDiscussionWatcher(){this.ipcService.send("init-discussion-watcher",{})}discoverDiscussion(){if(!this.discoverChannelId.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u983B\u9053 ID \u6216 username");return}this.ipcService.send("discover-discussion",{channelId:this.discoverChannelId.trim()}),this.discoverChannelId=""}discoverDiscussionsFromResources(){this.ipcService.send("discover-discussions-from-resources",{})}loadChannelDiscussions(){this.ipcService.send("get-channel-discussions",{activeOnly:!0})}refreshDiscussionStats(){this.ipcService.send("get-discussion-stats",{})}startDiscussionMonitoring(e){this.ipcService.send("start-discussion-monitoring",{discussionId:e})}stopDiscussionMonitoring(e){this.ipcService.send("stop-discussion-monitoring",{discussionId:e})}loadDiscussionMessages(e){this.selectedDiscussionId.set(e),this.isLoadingDiscussionMessages.set(!0),this.ipcService.send("get-discussion-messages",{discussionId:e,limit:50,matchedOnly:!1})}replyToDiscussion(e,t,n){if(!n||!n.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u56DE\u5FA9\u5167\u5BB9");return}this.ipcService.send("reply-to-discussion",{discussionId:t,messageId:e,replyText:n.trim()}),this.discussionReplyText.set("")}initKnowledgeBase(){this.ipcService.send("init-knowledge-base",{})}loadKnowledgeData(){this.isLoadingKnowledge.set(!0),this.ipcService.send("get-knowledge-stats",{}),this.refreshCurrentKnowledgeTab()}refreshCurrentKnowledgeTab(){switch(this.knowledgeTab()){case"documents":this.ipcService.send("get-documents",{});break;case"images":this.ipcService.send("get-media",{mediaType:"image"});break;case"videos":this.ipcService.send("get-media",{mediaType:"video"});break;case"qa":this.ipcService.send("get-qa-pairs",{});break}}switchKnowledgeTab(e){this.knowledgeTab.set(e),this.refreshCurrentKnowledgeTab()}addDocument(){let e=this.newDocument();if(!e.title&&!e.content){this.toastService.error(this.t("documentTitle")+" required",2e3);return}this.ipcService.send("add-document",{title:e.title,content:e.content,category:e.category,tags:e.tags.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})}async uploadDocumentFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0],o=this.newDocument(),a=new FileReader;a.onload=()=>{let d=a.result;this.ipcService.send("add-document",{title:o.title||n.name.replace(/\.[^/.]+$/,""),content:d,category:o.category,tags:o.tags.split(",").map(u=>u.trim()).filter(u=>u)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})},n.type==="application/pdf"?this.toastService.info("PDF \u6587\u4EF6\u5C07\u7531\u5F8C\u7AEF\u8655\u7406",2e3):a.readAsText(n),t.value=""}deleteDocument(e){this.ipcService.send("delete-document",{id:e}),this.knowledgeDocuments.update(t=>t.filter(n=>n.id!==e))}async uploadMediaFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0],o=this.newMedia(),d=n.type.startsWith("video/")?"video":"image",u=new FileReader;u.onload=()=>{let p=u.result.split(",")[1];this.ipcService.send("add-media",{base64Data:p,name:o.name||n.name.replace(/\.[^/.]+$/,""),category:o.category,description:o.description,mediaType:d}),this.showAddMediaDialog.set(!1),this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"})},u.readAsDataURL(n),t.value=""}deleteMedia(e,t){this.ipcService.send("delete-media",{id:e}),t==="image"?this.knowledgeImages.update(n=>n.filter(o=>o.id!==e)):this.knowledgeVideos.update(n=>n.filter(o=>o.id!==e))}addQaPair(){let e=this.newQaPair();if(!e.question||!e.answer){this.toastService.error(this.t("question")+" & "+this.t("answer")+" required",2e3);return}this.ipcService.send("add-qa-pair",{question:e.question,answer:e.answer,category:e.category,keywords:e.keywords.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddQaDialog.set(!1),this.newQaPair.set({question:"",answer:"",category:"general",keywords:""})}deleteQaPair(e){this.knowledgeQaPairs.update(t=>t.filter(n=>n.id!==e))}openAddImageDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"}),this.showAddMediaDialog.set(!0)}openAddVideoDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"video"}),this.showAddMediaDialog.set(!0)}updateNewDocumentField(e,t){let n=this.newDocument();this.newDocument.set(P(E({},n),{[e]:t}))}updateNewMediaField(e,t){let n=this.newMedia();this.newMedia.set(P(E({},n),{[e]:t}))}updateNewQaPairField(e,t){let n=this.newQaPair();this.newQaPair.set(P(E({},n),{[e]:t}))}searchKnowledge(e){e.trim()&&this.ipcService.send("search-knowledge",{query:e,includeDocs:!0,includeImages:!0,includeVideos:!0,limit:20})}sendAiGreeting(){let e=this.aiGreetingSuggestion();e&&(this.ipcService.send("send-message",{phone:e.accountPhone,recipientId:e.userId,text:e.suggestedGreeting,leadId:e.leadId}),this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null),this.toastService.success(`\u2713 \u554F\u5019\u6D88\u606F\u5DF2\u767C\u9001\u7D66 @${e.username||e.firstName}`))}editAiGreeting(e){let t=this.aiGreetingSuggestion();t&&this.aiGreetingSuggestion.set(P(E({},t),{suggestedGreeting:e}))}dismissAiGreeting(){this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null)}formatFileSize(e){if(!e)return"0 B";let t=1024,n=["B","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}async uploadVoiceSample(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0];if(!["audio/wav","audio/mp3","audio/mpeg","audio/ogg","audio/flac"].includes(n.type)){this.voiceCloneError.set(this.t("invalidAudioFormat"));return}if(n.size>50*1024*1024){this.voiceCloneError.set(this.t("audioFileTooLarge"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0),this.voiceCloneError.set("");try{let a=new FileReader;a.onprogress=d=>{d.lengthComputable&&this.voiceUploadProgress.set(Math.round(d.loaded/d.total*50))},a.onload=async()=>{let d=a.result.split(",")[1],u=n.name.replace(/\.[^/.]+$/,"");this.ipcService.send("upload-voice-sample",{name:u,audioData:d,fileName:n.name,fileType:n.type}),this.voiceUploadProgress.set(100),setTimeout(()=>{let p={id:Date.now().toString(),name:u,audioPath:n.name,promptText:"",createdAt:new Date};this.clonedVoices.update(g=>[...g,p]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3)},500)},a.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},a.readAsDataURL(n)}catch(a){this.voiceCloneError.set(a.message),this.isUploadingVoice.set(!1)}t.value=""}selectClonedVoice(e){this.selectedClonedVoice.set(e);let t=this.clonedVoices().find(n=>n.id===e);t&&this.ttsVoice.set(t.audioPath)}deleteClonedVoice(e){this.clonedVoices.update(t=>t.filter(n=>n.id!==e)),this.selectedClonedVoice()===e&&(this.selectedClonedVoice.set(""),this.ttsVoice.set("")),this.saveClonedVoicesToStorage(),this.ipcService.send("delete-voice-sample",{voiceId:e}),this.toastService.success(this.t("voiceDeleted"),2e3)}async previewClonedVoice(e){let t=this.clonedVoices().find(n=>n.id===e);t&&this.ipcService.send("preview-voice-sample",{voiceId:e,audioPath:t.audioPath})}async generateWithClonedVoice(e){let t=this.ttsEndpoint(),n=this.selectedClonedVoice();if(!t){this.toastService.error(this.t("ttsEndpointRequired"),2e3);return}if(!n){this.toastService.error(this.t("selectVoiceFirst"),2e3);return}let o=this.clonedVoices().find(a=>a.id===n);o&&this.ipcService.send("generate-cloned-voice",{endpoint:t,text:e,voiceId:n,audioPath:o.audioPath})}saveClonedVoicesToStorage(){let e=this.clonedVoices().map(t=>P(E({},t),{createdAt:t.createdAt.toISOString()}));localStorage.setItem("cloned_voices",JSON.stringify(e))}loadClonedVoicesFromStorage(){let e=localStorage.getItem("cloned_voices");if(e)try{let t=JSON.parse(e).map(n=>P(E({},n),{createdAt:new Date(n.createdAt)}));this.clonedVoices.set(t)}catch(t){console.error("Failed to load cloned voices:",t)}}openRecordingDialog(){this.showRecordingDialog.set(!0),this.voiceName.set(""),this.voicePromptText.set(""),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.voiceCloneError.set(""),this.recordingTime.set(0)}closeRecordingDialog(){this.stopRecording(),this.showRecordingDialog.set(!1),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl())}async startRecording(){try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:44100,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});this.audioChunks=[],this.mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"}),this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.onstop=()=>{let t=new Blob(this.audioChunks,{type:"audio/webm"});this.recordedAudioBlob.set(t),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioUrl.set(URL.createObjectURL(t)),e.getTracks().forEach(n=>n.stop())},this.mediaRecorder.start(100),this.isRecording.set(!0),this.recordingTime.set(0),this.recordingTimer=setInterval(()=>{this.recordingTime.update(t=>t+1),this.recordingTime()>=10&&this.stopRecording()},1e3)}catch(e){console.error("Recording error:",e),this.voiceCloneError.set(this.t("microphoneAccessDenied"))}}stopRecording(){this.mediaRecorder&&this.isRecording()&&(this.mediaRecorder.stop(),this.isRecording.set(!1),this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null))}async confirmAndUploadRecording(){let e=this.recordedAudioBlob(),t=this.voiceName().trim(),n=this.voicePromptText().trim();if(!t){this.voiceCloneError.set(this.t("voiceNameRequired"));return}if(!e){this.voiceCloneError.set(this.t("noRecordingToUpload"));return}let o=this.recordingTime();if(o<3){this.voiceCloneError.set(this.t("recordingTooShort"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0);try{let a=new FileReader;a.onprogress=d=>{d.lengthComputable&&this.voiceUploadProgress.set(Math.round(d.loaded/d.total*50))},a.onload=async()=>{let d=a.result.split(",")[1];this.ipcService.send("upload-voice-sample",{name:t,audioData:d,fileName:`${t}.webm`,fileType:"audio/webm",promptText:n,duration:o}),this.voiceUploadProgress.set(100);let u={id:Date.now().toString(),name:t,audioPath:`${t}.webm`,promptText:n,createdAt:new Date};this.clonedVoices.update(p=>[...p,u]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3),this.closeRecordingDialog()},a.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},a.readAsDataURL(e)}catch(a){this.voiceCloneError.set(a.message),this.isUploadingVoice.set(!1)}}resetRecording(){this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.recordingTime.set(0),this.voiceCloneError.set("")}loadAiSettings(){let e=localStorage.getItem("ai_api_key"),t=localStorage.getItem("ai_api_type"),n=localStorage.getItem("ai_custom_endpoint");e&&this.aiApiKey.set(e),t&&this.aiApiType.set(t),n&&this.customApiEndpoint.set(n);let o=localStorage.getItem("local_ai_endpoint"),a=localStorage.getItem("local_ai_model");o&&this.localAiEndpoint.set(o),a&&this.localAiModel.set(a);let d=localStorage.getItem("tts_endpoint"),u=localStorage.getItem("tts_enabled"),p=localStorage.getItem("tts_voice"),g=localStorage.getItem("stt_endpoint"),C=localStorage.getItem("stt_enabled");d&&this.ttsEndpoint.set(d),u&&this.ttsEnabled.set(u==="true"),p&&this.ttsVoice.set(p),g&&this.sttEndpoint.set(g),C&&this.sttEnabled.set(C==="true"),this.loadClonedVoicesFromStorage(),this.loadAiChatSettings()}isRegexValid(e){if(!e)return!0;try{return new RegExp(e),!0}catch{return!1}}getRegexError(e){if(!e)return null;try{return new RegExp(e),null}catch(t){return t.message}}getListenerAccounts(){return this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online")}getSenderAccounts(){return this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up"))}getOnlineAccountsCount(){return this.accounts().filter(e=>e.status==="Online").length}navigateToView(e){this.changeView(e)}navigateToAutomationTab(e){this.currentView.set("automation"),this.automationTab.set(e)}toggleKnowledgeMenu(){this.knowledgeMenuExpanded.set(!this.knowledgeMenuExpanded())}isKnowledgeView(){let e=this.currentView();return e==="knowledge-brain"||e==="knowledge-manage"||e==="knowledge-gaps"}leadsByStatus(e){return this.leadsByStatusMap().get(e)||[]}todayNewLeads(){let e=new Date;return e.setHours(0,0,0,0),this.leads().filter(t=>new Date(t.timestamp)>=e).length}getConversionRate(){let e=this.leads().length;return e===0?"0.0":(this.leadsByStatus("Closed-Won").length/e*100).toFixed(1)}getContactRate(){let e=this.leads().length;if(e===0)return"0.0";let t=this.leadsByStatus("New").length;return((e-t)/e*100).toFixed(1)}getReplyRate(){let e=this.leads().length-this.leadsByStatus("New").length;return e===0?"0.0":((this.leadsByStatus("Replied").length+this.leadsByStatus("Follow-up").length+this.leadsByStatus("Closed-Won").length+this.leadsByStatus("Closed-Lost").length)/e*100).toFixed(1)}loadFunnelStats(){this.ipcService.send("get-funnel-stats",{})}loadFunnelOverview(){this.isLoadingFunnel.set(!0),this.ipcService.send("get-funnel-overview",{})}loadUserJourney(e){e&&(this.isLoadingJourney.set(!0),this.selectedJourneyUserId.set(e),this.ipcService.send("get-user-journey",{userId:e}))}transitionFunnelStage(e,t,n){this.ipcService.send("transition-funnel-stage",{userId:e,stage:t,reason:n||"\u624B\u52D5\u8F49\u63DB"})}loadMarketingStats(){this.isLoadingMarketing.set(!0),this.ipcService.send("get-marketing-stats",{})}loadMarketingCampaigns(){this.ipcService.send("get-marketing-campaigns",{})}createMarketingCampaign(){if(!this.newMarketingCampaign.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}this.ipcService.send("create-marketing-campaign",{name:this.newMarketingCampaign.name,type:this.newMarketingCampaign.type,targetGroup:this.newMarketingCampaign.targetGroup,messageTemplate:this.newMarketingCampaign.messageTemplate})}startMarketingCampaign(e){this.ipcService.send("start-marketing-campaign",{campaignId:e})}loadWarmupDetails(e){this.ipcService.send("get-warmup-progress",{accountId:e})}loadAllWarmupDetails(){this.accounts().forEach(t=>{t.id&&this.loadWarmupDetails(t.id)})}toggleWarmup(e,t){this.ipcService.send("update-account",{id:e,warmupEnabled:t}),this.toastService.info(t?"\u5DF2\u555F\u7528\u9810\u71B1":"\u5DF2\u505C\u7528\u9810\u71B1")}getWarmupStageColor(e){return{1:"text-blue-400",2:"text-cyan-400",3:"text-yellow-400",4:"text-green-400"}[e]||"text-slate-400"}getWarmupStageIcon(e){return{1:"\u{1F507}",2:"\u{1F4AC}",3:"\u{1F4C8}",4:"\u2705"}[e]||"\u2753"}loadMigrationStatus(){this.isLoadingMigration.set(!0),this.ipcService.send("migration-status",{})}runMigration(e){this.isRunningMigration.set(!0),this.ipcService.send("migrate",{targetVersion:e})}rollbackMigration(e){confirm(`\u78BA\u5B9A\u8981\u56DE\u6EFE\u5230\u7248\u672C ${e} \u55CE\uFF1F\u9019\u53EF\u80FD\u6703\u5C0E\u81F4\u6578\u64DA\u4E1F\u5931\uFF01`)&&(this.isRunningMigration.set(!0),this.ipcService.send("rollback-migration",{targetVersion:e}))}loadSchedulerStatus(){this.ipcService.send("get-scheduler-status",{})}startScheduler(){this.ipcService.send("start-scheduler",{})}stopScheduler(){this.ipcService.send("stop-scheduler",{})}runSchedulerTask(e){this.ipcService.send("run-scheduler-task",{taskName:e})}updateSchedulerInterval(e,t){this.ipcService.send("update-scheduler-interval",{taskName:e,interval:t})}loadLogFiles(){this.isLoadingLogs.set(!0),this.ipcService.send("list-log-files",{})}loadLogStats(){this.ipcService.send("get-log-stats",{})}rotateLogs(){this.isRotatingLogs.set(!0),this.ipcService.send("rotate-logs",{})}viewLogFile(e){this.selectedLogFile.set(e),this.ipcService.send("read-log-file",{filename:e})}downloadLogFile(e){this.ipcService.send("download-log-file",{filename:e})}deleteLogFile(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u65E5\u8A8C\u6587\u4EF6 ${e} \u55CE\uFF1F`)&&this.ipcService.send("delete-log-file",{filename:e})}hasSelectedResources(){return this.selectedResourceIds().length>0}selectedResourceCount(){return this.selectedResourceIds().length}batchApproveResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"approved"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchRejectResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"rejected"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchSetResourcePriority(e){let t=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:t,priority:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchDeleteResources(){if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${this.selectedResourceCount()} \u500B\u8CC7\u6E90\u55CE\uFF1F`))return;let e=this.selectedResourceIds();this.ipcService.send("batch-delete-resources",{resourceIds:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}loadUsersWithProfiles(){this.ipcService.send("get-users-with-profiles",{stage:this.userFilterStage()||void 0,tags:this.userFilterTags()||void 0,search:this.userFilterSearch()||void 0,limit:50,offset:0})}toggleUserSelection(e){let t=this.selectedUserIds();t.includes(e)?this.selectedUserIds.set(t.filter(n=>n!==e)):this.selectedUserIds.set([...t,e])}selectAllUsers(){let e=this.usersWithProfiles().users.map(t=>t.user_id);this.selectedUserIds.set(e)}deselectAllUsers(){this.selectedUserIds.set([])}bulkUpdateTags(e,t){let n=this.selectedUserIds();if(n.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-tags",{userIds:n,tags:e,action:t})}bulkUpdateStage(e){let t=this.selectedUserIds();if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-stage",{userIds:t,stage:e})}getStageName(e){let t=this.funnelStages.find(n=>n.key===e);return t?t.name:e}getStageColor(e){let t=this.funnelStages.find(n=>n.key===e);return t?t.color:"bg-gray-500"}onDocumentClick(e){this.openResourceMenuId()!==null&&this.openResourceMenuId.set(null)}ngOnInit(){console.log("[App] ngOnInit called, coreDataLoaded:",this.coreDataLoaded()),console.log("[App] Current URL:",window.location.href),console.log("[App] Router URL:",this.router.url),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[App] Angular ready event dispatched")},100),this.translationService.setLanguage("zh"),this.loadAiSettings(),this.loadSidebarGroupsState(),this.setupVisibilityListener(),this.setupIpcListeners(),this.checkFirstRun(),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),console.log("[App] Current URL:",window.location.href),this.ipcService.send("get-initial-state"),this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4),setTimeout(()=>{this.refreshQueueStatusThrottled()},2e3),this.watchViewChanges(),this.setupKeyboardShortcuts(),this.membershipUpdateHandler=e=>{console.log("[AppComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",e.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler),window.addEventListener("save-ai-settings",(e=>{let t=e.detail;console.log("[AppComponent] \u6536\u5230 AI \u8A2D\u7F6E\u4FDD\u5B58\u4E8B\u4EF6:",t),t.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(t.auto_chat_enabled===1),t.auto_chat_mode&&this.aiAutoChatMode.set(t.auto_chat_mode),t.auto_greeting!==void 0&&this.aiAutoGreeting.set(t.auto_greeting===1),this.ipcService.send("update-ai-chat-settings",{settings:t}),this.toastService.success("AI \u8A2D\u7F6E\u5DF2\u4FDD\u5B58",2e3)})),window.addEventListener("get-sender-accounts",(()=>{let t=this.accounts().filter(n=>n.role==="Sender"&&n.status==="Online").map(n=>({phone:n.phone,username:n.username||n.first_name||n.phone,avatar:n.avatar,sentToday:n.sentToday||n.dailySendCount||0,dailyLimit:n.dailySendLimit||50}));window.dispatchEvent(new CustomEvent("sender-accounts-loaded",{detail:t}))}))}checkFirstRun(){this.ipcService.send("check-first-run",{})}detectOllama(){this.isDetectingOllama.set(!0),this.ipcService.send("detect-ollama",{})}completeFirstRunSetup(){let e={aiConfig:{primaryProvider:this.ollamaDetected()?"local":"cloud",localAi:{provider:"ollama",endpoint:this.localAiEndpoint(),model:this.autoSelectedModel()||this.localAiModel(),autoDetect:!0},cloudAi:{enabled:!this.ollamaDetected(),provider:this.aiApiType(),apiKey:this.aiApiKey()},autoFallback:{enabled:this.aiAutoFallback(),fallbackProvider:this.aiBackupProvider()}},settings:{language:"zh",theme:this.theme(),firstRun:{completed:!0,completedAt:new Date().toISOString()}}};this.ipcService.send("save-first-run-settings",e),this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.success("\u{1F389} \u8A2D\u7F6E\u5B8C\u6210\uFF01\u6B61\u8FCE\u4F7F\u7528 TG-Matrix")}skipFirstRunSetup(){this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.info("\u60A8\u53EF\u4EE5\u7A0D\u5F8C\u5728\u8A2D\u7F6E\u4E2D\u914D\u7F6E AI")}watchViewChanges(){let e=null,t=()=>{let n=this.currentView();n!==e&&(e=n,n==="leads"?(this.loadFunnelStats(),this.loadUsersWithProfiles()):n==="resources"?(this.refreshResourceStats(),this.isInSearchResultMode()||this.loadResources(),this.loadDiscoveryKeywords()):n==="ai-center"&&this.refreshRagStats())};t(),this.viewCheckInterval=setInterval(t,2e3)}setupVisibilityListener(){this.visibilityChangeHandler=()=>{this.isPageVisible=!document.hidden,this.isPageVisible?(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u53EF\u898B\uFF0C\u6062\u5FA9\u5237\u65B0"),this.resumeRefreshIntervals()):(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u96B1\u85CF\uFF0C\u66AB\u505C\u5237\u65B0"),this.pauseRefreshIntervals())},document.addEventListener("visibilitychange",this.visibilityChangeHandler)}pauseRefreshIntervals(){this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0)}resumeRefreshIntervals(){if(!this.viewCheckInterval){let e="",t=()=>{let n=this.currentView();n!==e&&(e=n)};this.viewCheckInterval=setInterval(t,2e3)}this.queueRefreshInterval||(this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4))}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&e.key==="n"&&this.currentView()==="accounts"&&(e.preventDefault(),setTimeout(()=>{let t=document.querySelector('[name="phone"]');t&&t.focus()},100)),e.key==="Escape"&&(this.selectedQueuePhone()&&this.closeQueueDetails(),this.progressDialog().show&&this.progressDialog().cancellable&&this.progressDialog.set(P(E({},this.progressDialog()),{show:!1}))),!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement)&&(e.key==="1"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("dashboard")):e.key==="2"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("accounts")):e.key==="3"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("automation")):e.key==="4"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("leads")):e.key==="5"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("ads")):e.key==="6"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("campaigns")):e.key==="7"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.changeView("settings")))})}ngOnDestroy(){this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler),this.ipcService.cleanup("log-entry"),this.ipcService.cleanup("monitoring-status-changed"),this.ipcService.cleanup("monitoring-status-report"),this.ipcService.cleanup("monitoring-start-failed"),this.ipcService.cleanup("monitoring-config-check"),this.ipcService.cleanup("initial-state"),this.ipcService.cleanup("accounts-updated"),this.ipcService.cleanup("new-lead-captured"),this.ipcService.cleanup("queue-status"),this.ipcService.cleanup("queue-messages"),this.ipcService.cleanup("sending-stats"),this.ipcService.cleanup("queue-length-history"),this.ipcService.cleanup("account-sending-comparison"),this.ipcService.cleanup("campaign-performance-stats"),this.ipcService.cleanup("alert-triggered"),this.ipcService.cleanup("alerts-loaded"),this.ipcService.cleanup("account-validation-error"),this.ipcService.cleanup("keyword-set-validation-error"),this.ipcService.cleanup("keyword-validation-error"),this.ipcService.cleanup("group-validation-error"),this.ipcService.cleanup("group-membership-status"),this.ipcService.cleanup("group-join-result"),this.ipcService.cleanup("template-validation-error"),this.ipcService.cleanup("campaign-validation-error"),this.ipcService.cleanup("keyword-sets-updated"),this.ipcService.cleanup("groups-updated"),this.ipcService.cleanup("templates-updated"),this.ipcService.cleanup("campaigns-updated"),this.ipcService.cleanup("leads-updated"),this.ipcService.cleanup("funnel-stats"),this.ipcService.cleanup("users-with-profiles"),this.ipcService.cleanup("bulk-update-complete"),this.ipcService.cleanup("login-requires-code"),this.ipcService.cleanup("login-requires-2fa"),this.ipcService.cleanup("account-login-error"),this.ipcService.cleanup("session-files-cleaned"),this.ipcService.cleanup("session-files-cleanup-error"),this.ipcService.cleanup("session-import-result"),this.ipcService.cleanup("session-import-needs-credentials"),this.ipcService.cleanup("orphan-sessions-detected"),this.ipcService.cleanup("orphan-sessions-scanned"),this.ipcService.cleanup("orphan-sessions-recovered"),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0),this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.initialStateDebounceTimer&&(clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=void 0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),this.saveSettingsTimer&&(clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=null),this.queueStatusRefreshThrottleTimer&&(clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=void 0),this.chatListSearchDebounceTimer&&(clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=void 0),this.logFilterDebounceTimer&&(clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=void 0)}startConnectionTimeout(){setTimeout(()=>{this.backendConnectionState()==="connecting"&&this.backendConnectionMessage.set("\u9023\u63A5\u8F03\u6162\uFF0C\u8ACB\u7A0D\u5019...")},5e3),setTimeout(()=>{this.backendConnectionState()==="connecting"&&(this.backendConnectionMessage.set("\u9023\u63A5\u6642\u9593\u8F03\u9577\uFF0C\u6B63\u5728\u91CD\u8A66..."),this.backendConnectionProgress.set(30))},15e3),this.connectionTimeoutId=setTimeout(()=>{this.backendConnectionState()==="connecting"&&(this.backendConnectionState.set("timeout"),this.backendConnectionMessage.set("\u9023\u63A5\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u5F8C\u7AEF\u670D\u52D9"))},3e4)}retryConnection(){this.backendConnectionState.set("connecting"),this.backendConnectionMessage.set("\u6B63\u5728\u91CD\u65B0\u9023\u63A5..."),this.backendConnectionProgress.set(0),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),this.ipcService.send("get-initial-state")}setupIpcListeners(){this.ipcService.on("loading-progress",e=>{console.log("[Frontend] Loading progress:",e),this.backendConnectionProgress.set(e.progress),this.backendConnectionMessage.set(e.message),e.step==="complete"&&(this.backendConnectionState.set("connected"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null))}),this.ipcService.on("log-entry",e=>{e.timestamp=new Date(e.timestamp),this.logs.update(t=>[e,...t].slice(0,100))}),this.ipcService.on("log-entries-batch",e=>{if(e.entries&&e.entries.length>0){let t=e.entries.map(n=>P(E({},n),{timestamp:new Date(n.timestamp)}));this.logs.update(n=>[...t.reverse(),...n].slice(0,100))}}),this.ipcService.on("monitoring-status-changed",e=>{this.isMonitoring.set(e),this.isStartingMonitoring.set(!1)}),this.ipcService.on("monitoring-start-failed",e=>{if(console.log("[Frontend] Monitoring start failed:",e),this.isStartingMonitoring.set(!1),e.reason==="config_check_failed"){let t=e.issues||[],n=e.warnings||[],o=t.some(a=>a.message?.includes("\u96E2\u7DDA")||a.message?.includes("offline")||a.code==="no_online_accounts");if(t.length>0){let a=t.map(d=>`\u2022 ${d.message}`).join(`
`);o?this.toastService.withActions("error",`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${a}`,[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],15e3):this.toastService.error(`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${a}`,1e4)}n.length>0&&setTimeout(()=>{let a=n.slice(0,3).map(d=>d.message).join("\uFF1B");this.toastService.warning(`\u26A0 \u5176\u4ED6\u554F\u984C\uFF1A${a}`,8e3)},1e3)}else if(e.reason==="no_online_listeners")this.toastService.withActions("error","\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u5728\u7DDA\u7684\u76E3\u807D\u8CEC\u6236",[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],1e4);else if(e.reason==="no_groups")this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",5e3);else if(e.reason==="no_accessible_groups"){let t=e.cannot_join_list||[];if(t.length>0){let n=t.map(o=>`\u2022 ${o.url}: ${o.reason||"\u672A\u77E5\u539F\u56E0"}`).join(`
`);this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002
${n}`,12e3)}else this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002\u8ACB\u78BA\u4FDD\u76E3\u63A7\u865F\u5DF2\u52A0\u5165\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",8e3)}else e.reason==="exception"?this.toastService.error(e.message||"\u555F\u52D5\u76E3\u63A7\u6642\u767C\u751F\u932F\u8AA4",8e3):this.toastService.error(e.message||"\u555F\u52D5\u76E3\u63A7\u5931\u6557",5e3)}),this.ipcService.on("monitoring-config-check",e=>{if(console.log("[Frontend] Monitoring config check:",e),this.lastConfigCheck.set(e),e.passed&&e.warnings.length>0){let t=e.warnings.slice(0,2);for(let n of t){let o=n.code||"";this.errorNavigationMap[o]?this.toastService.warningWithAction(`\u26A0 ${n.message}`,"\u53BB\u8A2D\u7F6E",()=>this.navigateToError(o)):this.toastService.warning(`\u26A0 ${n.message}
\u4FEE\u5FA9: ${n.fix}`,8e3)}e.summary.can_send_messages||setTimeout(()=>{this.toastService.warningWithAction("\u76E3\u63A7\u5C07\u904B\u884C\uFF0C\u4F46 Lead \u4E0D\u6703\u81EA\u52D5\u767C\u9001\u6D88\u606F\u3002","\u914D\u7F6E\u898F\u5247",()=>this.navigateToError("NO_CAMPAIGN"))},2e3)}}),this.ipcService.on("monitoring-status-report",e=>{if(console.log("[Frontend] Monitoring status report:",e),e.accessible_groups>0){let t=e.accessible_list.slice(0,3).map(o=>o.title||o.url).join(", "),n=e.accessible_groups>3?`\u7B49 ${e.accessible_groups} \u500B\u7FA4\u7D44`:"";this.toastService.success(`\u2713 \u53EF\u76E3\u63A7\u7FA4\u7D44: ${t}${n}`,4e3)}if(e.groups_needing_join>0){let t=e.needing_join_list.slice(0,2).map(o=>o.url).join(", "),n=e.groups_needing_join>2?`\u7B49 ${e.groups_needing_join} \u500B`:"";this.toastService.warning(`\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u7FA4\u7D44: ${t}${n}\u3002\u6B63\u5728\u5617\u8A66\u81EA\u52D5\u52A0\u5165...`,6e3)}e.accessible_groups===0&&e.groups_needing_join>0&&this.toastService.warning("\u76E3\u63A7\u865F\u5C1A\u672A\u52A0\u5165\u4EFB\u4F55\u76E3\u63A7\u7FA4\u7D44\u3002\u7CFB\u7D71\u5C07\u5617\u8A66\u81EA\u52D5\u52A0\u5165\u516C\u958B\u7FA4\u7D44\u3002",5e3)}),this.ipcService.on("template-already-exists",e=>{console.log("[Frontend] Template already exists:",e),this.toastService.warning(e.message||`\u6A21\u677F "${e.name}" \u5DF2\u5B58\u5728`,3e3)}),this.ipcService.on("accounts-updated",e=>{console.log("[Frontend] Received accounts-updated event:",e.length,"accounts");let t=this.accounts().length,n=this.accounts();this.accounts.set(e),e.forEach(o=>{let a=n.find(d=>d.id===o.id);if(a&&a.status!==o.status)if(console.log(`[Frontend] Account ${o.phone} status changed: ${a.status} -> ${o.status}`),o.status==="Online")this.toastService.success(`\u8D26\u6237 ${o.phone} \u767B\u5F55\u6210\u529F`),this.cancelLogin();else if(o.status==="Logging in...")this.toastService.info(`\u8D26\u6237 ${o.phone} \u6B63\u5728\u767B\u5F55...`);else if(o.status==="Waiting Code"){let d=this.loginState();d.accountId===o.id&&!d.requiresCode&&this.toastService.info(`\u8D26\u6237 ${o.phone} \u7B49\u5F85\u9A8C\u8BC1\u7801`)}else if(o.status==="Waiting 2FA"){let d=this.loginState();d.accountId===o.id&&!d.requires2FA&&(this.loginState.set({accountId:o.id,phone:o.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info(`\u8D26\u6237 ${o.phone} \u7B49\u5F85 2FA \u5BC6\u7801`))}else(o.status.includes("Error")||o.status==="Error")&&(this.toastService.error(`\u8D26\u6237 ${o.phone} \u767B\u5F55\u5931\u8D25`),this.cancelLogin())}),e.length>t&&this.toastService.success(`\u8D26\u6237\u5217\u8868\u5DF2\u66F4\u65B0\uFF08${e.length} \u4E2A\u8D26\u6237\uFF09`)}),this.ipcService.on("account-validation-error",e=>{console.error("Account validation error:",e);let t=Array.isArray(e.errors)?e.errors:[e.errors||"\u9A8C\u8BC1\u5931\u8D25"];if((e.error_type||"validation")==="duplicate"||t.some(d=>d.includes("\u5DF2\u5B58\u5728")||d.includes("already exists"))){this.validationErrors.set({account:t}),this.toastService.error(t.join("; "));return}this.accounts().length===0?(this.validationErrors.set({account:t}),this.toastService.error(`\u6DFB\u52A0\u8D26\u6237\u5931\u8D25: ${t.join("; ")}`)):console.warn("Validation error received but accounts already exist, ignoring:",t)}),this.ipcService.on("new-lead-captured",e=>{e.timestamp=new Date(e.timestamp),e.interactionHistory.forEach(t=>t.timestamp=new Date(t.timestamp)),this.leads.update(t=>[e,...t])}),this.ipcService.on("keyword-matched",e=>{console.log("[Frontend] Keyword matched event:",e),this.realtimeMatches.update(t=>[e,...t].slice(0,50)),this.todayStats.update(t=>P(E({},t),{matchCount:t.matchCount+1}))}),this.ipcService.on("lead-captured",e=>{console.log("[Frontend] Lead captured event received:",e),this.todayStats.update(n=>P(E({},n),{newLeads:n.newLeads+1})),this.showNotification("\u65B0\u6F5B\u5728\u5BA2\u6236\u5DF2\u6355\u7372",`@${e.username||e.firstName||"\u7528\u6236"} \u5DF2\u6355\u7372`,{requireInteraction:!0}),e.interactionHistory||(e.interactionHistory=[]),e.status||(e.status="New"),e.doNotContact===void 0&&(e.doNotContact=!1),e.timestamp=new Date(e.timestamp||new Date),e.interactionHistory&&e.interactionHistory.forEach(n=>n.timestamp=new Date(n.timestamp)),this.leads.update(n=>{let o=n.findIndex(a=>a.userId===e.userId);return o>=0?(n[o]=e,[...n]):[e,...n]});let t=e.username?`@${e.username}`:e.firstName||e.userId;this.toastService.success(`\u{1F3AF} ${this.t("newLeadCaptured")}: ${t}`,4e3)}),this.ipcService.on("session-files-cleaned",e=>{this.toastService.success(`\u6E05\u7406\u5B8C\u6210\uFF1A\u5220\u9664\u4E86 ${e.deleted_count} \u4E2A\u5B64\u7ACB\u6587\u4EF6\uFF0C\u4FDD\u7559\u4E86 ${e.kept_count} \u4E2A\u6709\u6548\u6587\u4EF6`),console.log("[Frontend] Session files cleaned:",e)}),this.ipcService.on("session-files-cleanup-error",e=>{this.toastService.error(`\u6E05\u7406\u5931\u8D25\uFF1A${e.error}`),console.error("[Frontend] Session files cleanup error:",e)}),this.ipcService.on("session-import-result",e=>{console.log("[Frontend] Session import result:",e),e.success?(this.toastService.success(e.phone?`\u2705 Session \u5C0E\u5165\u6210\u529F: ${e.phone}`:`\u2705 \u5C0E\u5165\u5B8C\u6210: ${e.count||1} \u500B\u5E33\u865F`,3e3),this.ipcService.send("get-initial-state")):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.message}`,4e3)}),this.ipcService.on("session-import-needs-credentials",e=>{console.log("[Frontend] Session import needs credentials:",e),this.toastService.warning(`\u26A0\uFE0F \u5C0E\u5165 ${e.phoneNumber} \u9700\u8981 API \u6191\u64DA`,4e3),this.toastService.info("\u8ACB\u5148\u5728\u300CAPI \u6191\u64DA\u6C60\u300D\u9801\u9762\u6DFB\u52A0 API \u6191\u64DA\uFF0C\u7136\u5F8C\u91CD\u8A66\u5C0E\u5165",5e3)}),this.ipcService.on("orphan-sessions-detected",e=>{console.log("[Frontend] Orphan sessions detected:",e),e.count>0&&(this.orphanSessions.set(e.sessions),this.showOrphanSessionDialog.set(!0),this.toastService.warning(`\u767C\u73FE ${e.count} \u500B\u9700\u8981\u624B\u52D5\u6062\u5FA9\u7684 Session \u6587\u4EF6`,5e3))}),this.ipcService.on("orphan-sessions-scanned",e=>{console.log("[Frontend] Orphan sessions scanned:",e),e.success&&e.orphan_sessions.length>0&&this.orphanSessions.set(e.orphan_sessions)}),this.ipcService.on("orphan-sessions-recovered",e=>{console.log("[Frontend] Orphan sessions recovered:",e),this.isRecoveringOrphanSessions.set(!1),e.success?(this.toastService.success(`\u6210\u529F\u6062\u5FA9 ${e.recovered_count} \u500B\u5E33\u865F`,3e3),this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([]),this.ipcService.send("get-accounts")):this.toastService.error(`\u6062\u5FA9\u5931\u6557: ${e.message}`,4e3)}),this.ipcService.on("keyword-set-validation-error",e=>{console.error("[Frontend] Keyword set validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${t}`)}),this.ipcService.on("keyword-set-error",e=>{if(console.log("[Frontend] Keyword set error event:",e),e.success)e.message&&this.toastService.success(e.message),this.newKeywordSet.set({name:""});else{let t=e.error||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";console.warn("[Frontend] Keyword set error:",t,e.details),t.includes("\u5DF2\u5B58\u5728")||t.includes("already exists")?this.toastService.warning("\u5173\u952E\u8BCD\u96C6\u5DF2\u5B58\u5728",3e3):t.includes("\u4E0D\u5B58\u5728")||t.includes("not found")?console.log("[Frontend] Keyword set already deleted, ignoring"):t.includes("\u6570\u636E\u5EAB")||t.includes("\u6570\u636E\u5E93")||t.includes("\u640D\u58DE")||t.includes("\u635F\u574F")?this.toastService.error(`\u6570\u636E\u5E93\u9519\u8BEF: ${t}\u3002\u8BF7\u4F7F\u7528 rebuild_database.py \u91CD\u5EFA\u6570\u636E\u5E93\u3002`,1e4):this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${t}`)}}),this.ipcService.on("keyword-validation-error",e=>{console.error("[Frontend] Keyword validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u9519\u8BEF: ${t}`)}),this.ipcService.on("group-validation-error",e=>{console.error("[Frontend] Group validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u7FA4\u7EC4\u5931\u8D25";this.toastService.error(`\u7FA4\u7EC4\u9519\u8BEF: ${t}`)}),this.ipcService.on("group-membership-status",e=>{console.log("[Frontend] Group membership status:",e),e.status.is_member?this.toastService.success(`\u2713 \u76E3\u63A7\u865F\u5DF2\u5728\u7FA4\u7D44\u4E2D: ${e.status.chat_title||e.url}`,3e3):e.status.can_join&&(e.status.is_private?this.toastService.warning("\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u624B\u52D5\u5C07\u76E3\u63A7\u865F\u52A0\u5165\u7FA4\u7D44",5e3):this.toastService.info("\u2139 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u7FA4\u7D44\uFF0C\u555F\u52D5\u76E3\u63A7\u6642\u5C07\u81EA\u52D5\u52A0\u5165",4e3))}),this.ipcService.on("group-join-result",e=>{console.log("[Frontend] Group join result:",e),e.success?e.alreadyMember?this.toastService.success(`${e.phone} \u5DF2\u7D93\u5728\u7FA4\u7D44 ${e.chatTitle||e.groupUrl} \u4E2D`,3e3):this.toastService.success(`${e.phone} \u6210\u529F\u52A0\u5165\u7FA4\u7D44 ${e.chatTitle||e.groupUrl}`,4e3):this.toastService.error(`\u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${e.error}`,5e3)}),this.ipcService.on("template-validation-error",e=>{console.error("[Frontend] Template validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u6A21\u677F\u5931\u8D25";this.toastService.error(`\u6A21\u677F\u9519\u8BEF: ${t}`)}),this.ipcService.on("campaign-validation-error",e=>{console.error("[Frontend] Campaign validation error:",e);let t=e.errors?.join("; ")||"\u521B\u5EFA\u6D3B\u52A8\u5931\u8D25";this.toastService.error(`\u6D3B\u52A8\u9519\u8BEF: ${t}`)}),this.ipcService.on("login-requires-code",e=>{console.log("[Frontend] Received login-requires-code event:",e),console.log("[Frontend] Current loginState before update:",this.loginState()),this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!1,canRetrySMS:e.canRetrySMS||!1,waitSeconds:e.waitSeconds}),console.log("[Frontend] Updated loginState:",this.loginState()),console.log("[Frontend] requiresCode value:",this.loginState().requiresCode),this.loginCode.set(""),e.message?e.sendType==="app"?this.toastService.info(e.message,8e3):this.toastService.info(e.message):e.sendType==="app"?this.toastService.info("\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230\u60A8\u7684 Telegram \u5E94\u7528\u3002\u8BF7\u68C0\u67E5\u60A8\u624B\u673A\u4E0A\u5DF2\u767B\u5F55\u7684 Telegram \u5E94\u7528\uFF0C\u67E5\u770B\u9A8C\u8BC1\u7801\u6D88\u606F\u3002",8e3):e.sendType==="sms"?this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${e.phone} \u7684\u77ED\u4FE1\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`):this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${e.phone}\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`)}),this.ipcService.on("login-requires-2fa",e=>{console.log("[Frontend] Received login-requires-2fa event:",e),this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info("\u8BF7\u8F93\u5165 2FA \u5BC6\u7801")}),this.ipcService.on("account-login-error",e=>{if(console.error("[Frontend] Account login error:",e),e.floodWait){let n=e.floodWait,o=Math.floor(n/3600),a=Math.floor(n%3600/60),d=n%60,u="";o>0?(u=`${o} \u5C0F\u65F6`,a>0&&(u+=` ${a} \u5206\u949F`)):a>0?(u=`${a} \u5206\u949F`,d>0&&(u+=` ${d} \u79D2`)):u=`${d} \u79D2`;let p=`\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7B49\u5F85 ${u} \u540E\u518D\u8BD5\u3002\u9A8C\u8BC1\u7801\u672A\u53D1\u9001\u3002`;this.toastService.error(p),console.error("FloodWait error:",{waitSeconds:n,timeStr:u})}else this.toastService.error(e.friendlyMessage||e.message);console.error("Login error details:",{accountId:e.accountId,phone:e.phone,status:e.status,message:e.message,codeExpired:e.codeExpired,floodWait:e.floodWait});let t=this.loginState();if(this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:t.requiresCode,requires2FA:t.requires2FA,phoneCodeHash:t.phoneCodeHash,isSubmittingCode:!1}),e.floodWait){this.cancelLogin();return}e.codeExpired?(this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set("")):e.message&&(e.message.includes("banned")||e.message.includes("invalid phone"))?this.cancelLogin():e.message&&e.message.includes("Invalid verification code")&&this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:t.phoneCodeHash,isSubmittingCode:!1})}),this.ipcService.on("account-status-updated",e=>{}),this.ipcService.on("initial-state-core",e=>{console.log("[Frontend] \u{1F680} Received initial-state-core (accounts + settings)"),e?.accounts&&(this.accounts.set(e.accounts),console.log("[Frontend] Accounts loaded:",e.accounts.length)),e?.settings&&(this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(e.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(e.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.settings.smartSendingEnabled??!0)),e?.isMonitoring!==void 0&&this.isMonitoring.set(e.isMonitoring),console.log("[App] Setting coreDataLoaded to true"),this.coreDataLoaded.set(!0),console.log("[App] coreDataLoaded is now:",this.coreDataLoaded())}),this.ipcService.on("initial-state-config",e=>{console.log("[Frontend] \u{1F4CB} Received initial-state-config"),e?.keywordSets&&this.keywordSets.set(e.keywordSets),e?.monitoredGroups&&this.monitoredGroups.set(e.monitoredGroups),e?.campaigns&&this.campaigns.set(e.campaigns),e?.messageTemplates&&this.messageTemplates.set(e.messageTemplates)}),this.ipcService.on("initial-state-data",e=>{if(console.log("[Frontend] \u{1F4CA} Received initial-state-data (leads + logs)"),console.log("[Frontend] leads count:",e?.leads?.length,"total:",e?.leadsTotal,"hasMore:",e?.leadsHasMore),e?.leads){let t=(e.leads||[]).map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.contactsService.importLeadsDirectly(t),console.log("[Frontend] Initial leads synced to resource center:",t.length)}e?.leadsTotal!==void 0&&this.leadsTotal.set(e.leadsTotal),e?.leadsHasMore!==void 0&&this.leadsHasMore.set(e.leadsHasMore),e?.leads&&e?.leadsTotal&&e.leads.length<e.leadsTotal&&(console.log("[Frontend] \u{1F504} Auto-loading remaining leads..."),this.leadsHasMore.set(!0),this.leadsLoading.set(!1),setTimeout(()=>this.loadRemainingLeads(),500)),e?.logs&&this.logs.set(e.logs)}),this.ipcService.on("initial-state",e=>{console.log("[Frontend] \u2605\u2605\u2605 Received initial-state event \u2605\u2605\u2605"),console.log("[Frontend] initial-state payload:",e),console.log("[Frontend] accounts in payload:",e?.accounts?.length||0);let t=Date.now();if(t-this.lastInitialStateTime<500){this.initialStateDebounceTimer&&clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=setTimeout(()=>{try{this.applyInitialState(e)}catch(n){console.error("[Frontend] Error applying initial state:",n)}finally{this.initialStateDebounceTimer=void 0}},500);return}this.lastInitialStateTime=t;try{this.applyInitialState(e)}catch(n){console.error("[Frontend] Error applying initial state:",n)}}),this.ipcService.on("keyword-sets-updated",e=>{typeof console<"u"&&console.log&&console.log("[Frontend] Received keyword-sets-updated:",e.keywordSets?.length||0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),e.keywordSets&&Array.isArray(e.keywordSets)?this.keywordSetsUpdateDebounceTimer=setTimeout(()=>{try{let t=new Set,n=e.keywordSets.filter(d=>!d||typeof d.id!="number"||t.has(d.id)?!1:(t.add(d.id),!0)).map(d=>{let u=Array.isArray(d.keywords)?d.keywords:[],p=new Set,g=u.filter(C=>{if(!C||typeof C.keyword!="string")return!1;let w=`${C.keyword}_${C.isRegex}`;return p.has(w)?!1:(p.add(w),!0)});return P(E({},d),{keywords:g})}),o=this.keywordSets();JSON.stringify(o)!==JSON.stringify(n)&&this.keywordSets.set(n)}catch(t){console.error("[Frontend] Error processing keyword-sets-updated:",t)}finally{this.keywordSetsUpdateDebounceTimer=void 0}},150):this.keywordSets().length>0&&this.keywordSets.set([])}),this.ipcService.on("keyword-validation-error",e=>{console.log("[Frontend] Keyword validation error:",e),e.errors&&e.errors.length>0&&(this.toastService.error(`\u95DC\u9375\u8A5E\u9A57\u8B49\u5931\u6557: ${e.errors.join(", ")}`,4e3),setTimeout(()=>{},1e3))}),this.ipcService.on("groups-updated",e=>{console.log("[Frontend] Received groups-updated:",e.monitoredGroups?.length||0),this.monitoredGroups.set(e.monitoredGroups||[])}),this.ipcService.on("templates-updated",e=>{console.log("[Frontend] Received templates-updated:",e.messageTemplates?.length||0),this.messageTemplates.set(e.messageTemplates||[])}),this.ipcService.on("campaigns-updated",e=>{console.log("[Frontend] Received campaigns-updated:",e.campaigns?.length||0),this.campaigns.set(e.campaigns||[]),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-already-exists",e=>{console.log("[Frontend] Campaign already exists:",e),this.toastService.warning(e.message||`\u6D3B\u52D5 "${e.name}" \u5DF2\u5B58\u5728`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-validation-error",e=>{console.log("[Frontend] Campaign validation error:",e),e.errors&&e.errors.length>0&&this.toastService.error(`\u6D3B\u52D5\u9A57\u8B49\u5931\u6557: ${e.errors.join(", ")}`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("search-leads-result",e=>{this.isSearchingLeads.set(!1),e.success&&e.results?(this.leadSearchResults.set(e.results),e.results.length===0&&this.toastService.info("\u672A\u627E\u5230\u5339\u914D\u7684\u6F5C\u5728\u5BA2\u6237")):(this.toastService.error(e.error||"\u641C\u7D22\u5931\u8D25"),this.leadSearchResults.set([]))}),this.ipcService.on("backup-created",e=>{this.isCreatingBackup.set(!1),e.success?(this.toastService.success("\u5907\u4EFD\u521B\u5EFA\u6210\u529F"),this.loadBackups()):this.toastService.error(e.error||"\u5907\u4EFD\u521B\u5EFA\u5931\u8D25")}),this.ipcService.on("backups-list",e=>{e.success&&e.backups&&this.backups.set(e.backups)}),this.ipcService.on("backup-restored",e=>{this.isRestoringBackup.set(!1),e.success?this.toastService.success("\u5907\u4EFD\u6062\u590D\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u9875\u9762"):this.toastService.error(e.error||"\u5907\u4EFD\u6062\u590D\u5931\u8D25")}),this.ipcService.on("backup-deleted",e=>{e.success?(this.toastService.success("\u5907\u4EFD\u5DF2\u5220\u9664"),this.loadBackups()):this.toastService.error(e.error||"\u5220\u9664\u5907\u4EFD\u5931\u8D25")}),this.ipcService.on("leads-updated",e=>{let t=e.total??e.leads?.length??0;console.log("[Frontend] Received leads-updated:",e.leads?.length||0,"total:",t);let n=(e.leads||[]).map(o=>this.mapLeadFromBackend(o));this.leads.set(n),this.leadsTotal.set(t),this.contactsService.importLeadsDirectly(n)}),this.ipcService.on("leads-paginated",e=>{if(console.log("[Frontend] Received leads-paginated:",e.leads?.length||0,"total:",e.total),this.leadsLoading.set(!1),e.leads&&e.leads.length>0){let t=e.leads.map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.leadsTotal.set(e.total),this.leadsHasMore.set(e.hasMore),this.contactsService.importLeadsDirectly(t),console.log("[Frontend] \u2705 Synced to resource center:",t.length,"leads"),e.hasMore||this.toastService.success(`\u6578\u64DA\u52A0\u8F09\u5B8C\u6210\uFF1A\u5171 ${t.length} \u689D`)}}),this.ipcService.on("funnel-stats",e=>{console.log("[Frontend] Received funnel-stats:",e),e.error||this.funnelStats.set(e)}),this.ipcService.on("funnel-overview",e=>{this.isLoadingFunnel.set(!1),e.success&&this.funnelOverview.set({stages:e.stages||[],totalLeads:e.total_leads||0,convertedLeads:e.converted_leads||0,averageConversionDays:e.average_days||0,conversionRate:e.conversion_rate||0})}),this.ipcService.on("user-journey",e=>{this.isLoadingJourney.set(!1),e.success&&e.journey&&this.userJourneyData.set({userId:e.userId,stages:e.journey.transitions||[],currentStage:e.journey.current_stage||"new",totalDays:e.journey.total_days||0,isConverted:e.journey.is_converted||!1})}),this.ipcService.on("funnel-stage-transitioned",e=>{e.success?(this.toastService.success(`\u2705 \u6F0F\u6597\u968E\u6BB5\u5DF2\u66F4\u65B0: ${e.stage}`),this.loadFunnelOverview(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("marketing-stats",e=>{this.isLoadingMarketing.set(!1),e.success!==!1&&this.marketingStats.set({totalCampaigns:e.total_campaigns||0,running:e.running||0,completed:e.completed||0,totalMessages:e.total_messages||0,totalInvites:e.total_invites||0,successRate:e.success_rate||0})}),this.ipcService.on("marketing-campaigns",e=>{e.success&&e.campaigns&&this.marketingCampaigns.set(e.campaigns)}),this.ipcService.on("campaign-created",e=>{e.success?(this.toastService.success("\u2705 \u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.showCreateCampaignDialog.set(!1),this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""},this.loadMarketingCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}),this.ipcService.on("campaign-started",e=>{e.success&&(this.toastService.info("\u{1F680} \u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadMarketingCampaigns())}),this.ipcService.on("campaign-complete",e=>{e.success&&(this.toastService.success(`\u2705 \u6D3B\u52D5\u5B8C\u6210\uFF01\u6210\u529F: ${e.stats?.success||0}, \u5931\u6557: ${e.stats?.failed||0}`),this.loadMarketingStats(),this.loadMarketingCampaigns())}),this.ipcService.on("warmup-progress",e=>{e.success&&e.accountId&&this.warmupDetails.update(t=>P(E({},t),{[e.accountId]:{enabled:e.enabled||!1,startDate:e.start_date||null,stage:e.stage?.stage||0,stageName:e.stage?.stage_name||"",daysCompleted:e.days_completed||0,totalDays:e.total_days||14,progressPercent:e.progress_percentage||0,dailyLimit:e.stage?.daily_limit||0,allowedActions:e.stage?.allowed_actions||[]}}))}),this.ipcService.on("migration-status",e=>{this.isLoadingMigration.set(!1),e.error||this.migrationStatus.set({currentVersion:e.current_version||0,latestVersion:e.latest_version||0,appliedCount:e.applied_count||0,pendingCount:e.pending_count||0,appliedMigrations:e.applied_migrations||[],pendingMigrations:e.pending_migrations||[]})}),this.ipcService.on("migration-completed",e=>{this.isRunningMigration.set(!1),e.error?this.toastService.error(`\u9077\u79FB\u5931\u6557: ${e.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u9077\u79FB\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("rollback-completed",e=>{this.isRunningMigration.set(!1),e.error?this.toastService.error(`\u56DE\u6EFE\u5931\u6557: ${e.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u56DE\u6EFE\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("scheduler-status",e=>{e.success!==!1&&this.schedulerStatus.set({isRunning:e.is_running||!1,tasks:e.tasks||[]})}),this.ipcService.on("scheduler-started",e=>{e.success&&(this.toastService.success("\u2705 \u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-stopped",e=>{e.success&&(this.toastService.info("\u8ABF\u5EA6\u5668\u5DF2\u505C\u6B62"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-task-result",e=>{e.success?this.toastService.success(`\u2705 \u4EFB\u52D9 ${e.taskName} \u57F7\u884C\u5B8C\u6210`):this.toastService.error(`\u4EFB\u52D9\u57F7\u884C\u5931\u6557: ${e.error}`),this.loadSchedulerStatus()}),this.ipcService.on("log-files",e=>{this.isLoadingLogs.set(!1),e.files&&this.logFiles.set(e.files.map(t=>({name:t.name,size:t.size,sizeFormatted:this.formatFileSize(t.size),modifiedAt:t.modified_at,isCompressed:t.name.endsWith(".gz")})))}),this.ipcService.on("log-stats",e=>{e.error||this.logStats.set({totalFiles:e.total_files||0,totalSize:e.total_size||0,totalSizeFormatted:this.formatFileSize(e.total_size||0),compressedFiles:e.compressed_files||0,oldestFile:e.oldest_file,newestFile:e.newest_file})}),this.ipcService.on("logs-rotated",e=>{this.isRotatingLogs.set(!1),e.success?(this.toastService.success(`\u2705 \u65E5\u8A8C\u8F2A\u8F49\u5B8C\u6210\uFF0C\u8F2A\u8F49\u4E86 ${e.rotated_count||0} \u500B\u6587\u4EF6`),this.loadLogFiles(),this.loadLogStats()):this.toastService.error(`\u65E5\u8A8C\u8F2A\u8F49\u5931\u6557: ${e.error}`)}),this.ipcService.on("log-file-content",e=>{e.content&&this.logFileContent.set(e.content)}),this.ipcService.on("log-file-deleted",e=>{e.success&&(this.toastService.success("\u2705 \u65E5\u8A8C\u6587\u4EF6\u5DF2\u522A\u9664"),this.loadLogFiles(),this.loadLogStats())}),this.ipcService.on("resources-batch-updated",e=>{e.success&&(this.toastService.success(`\u2705 \u5DF2\u66F4\u65B0 ${e.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-batch-deleted",e=>{e.success&&(this.toastService.success(`\u2705 \u5DF2\u522A\u9664 ${e.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-cleared",e=>{e.success?(this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u6E05\u7A7A\u6240\u6709\u8CC7\u6E90\uFF0C\u5171 ${e.deletedCount||0} \u689D`),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7A7A\u5931\u6557: ${e.error}`)}),this.ipcService.on("clear-resources-complete",e=>{e.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF0C\u5DF2\u522A\u9664 ${e.deleted_count||0} \u689D\u8A18\u9304`),this.discoveredResources.set([]),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("users-with-profiles",e=>{console.log("[Frontend] Received users-with-profiles:",e.users?.length||0),e.error||this.usersWithProfiles.set(e)}),this.ipcService.on("one-click-start-progress",e=>{console.log("[Frontend] One-click progress:",e),this.oneClickProgress.set(e.progress),this.oneClickMessage.set(e.message)}),this.ipcService.on("group-join-progress",e=>{let t=`\u{1F465} \u6B63\u5728\u6AA2\u67E5\u7FA4\u7D44 ${e.current}/${e.total}...`;this.oneClickMessage.set(t);let n=42+e.current/e.total*6;this.oneClickProgress.set(Math.round(n))}),this.ipcService.on("group-join-complete",e=>{console.log("[Frontend] Group join complete:",e);let t=e.skipped_cached?` (${e.skipped_cached} \u500B\u7DE9\u5B58\u547D\u4E2D)`:"";this.oneClickMessage.set(`\u2705 \u7FA4\u7D44\u52A0\u5165\u5B8C\u6210: ${e.success_count}/${e.total} \u6210\u529F${t}`)}),this.ipcService.on("one-click-start-result",e=>{console.log("[Frontend] One-click result:",e),this.oneClickStarting.set(!1),this.oneClickStartReport.set(e),this.showStartReport.set(!0),e.overall_success?this.toastService.success("\u{1F389} \u4E00\u9375\u555F\u52D5\u6210\u529F\uFF01\u7CFB\u7D71\u5DF2\u5C31\u7DD2",5e3):this.toastService.warning("\u26A0\uFE0F \u90E8\u5206\u529F\u80FD\u555F\u52D5\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u65E5\u8A8C",5e3),this.loadSystemStatus()}),this.ipcService.on("one-click-stop-result",e=>{console.log("[Frontend] One-click stop result:",e),e.success&&this.toastService.info("\u{1F6D1} \u6240\u6709\u670D\u52D9\u5DF2\u505C\u6B62",3e3),this.loadSystemStatus()}),this.ipcService.on("system-status",e=>{console.log("[Frontend] System status:",e),e.error||this.systemStatus.set(e)}),this.ipcService.on("trigger-rules-result",e=>{e.success&&setTimeout(()=>this.loadSystemStatus(),100)}),this.ipcService.on("ai-settings-updated",e=>{console.log("[Frontend] AI settings updated:",e),e.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(e.auto_chat_enabled),e.auto_chat_mode&&this.aiAutoChatMode.set(e.auto_chat_mode)}),this.ipcService.on("bulk-update-complete",e=>{console.log("[Frontend] Bulk update complete:",e),e.success?(this.toastService.success(`\u5DF2\u66F4\u65B0 ${e.count} \u500B\u7528\u6236`),this.selectedUserIds.set([]),this.loadUsersWithProfiles(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("settings-updated",e=>{e&&(this.spintaxEnabled.set(e.spintaxEnabled??!0),this.autoReplyEnabled.set(e.autoReplyEnabled??!1),this.autoReplyMessage.set(e.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.smartSendingEnabled??!0))}),this.ipcService.on("queue-status",e=>{if(typeof e=="object"&&"phone"in e){let p=e;this.queueStatuses.update(g=>P(E({},g),{[p.phone]:p}))}else{let p=e;this.queueStatuses.set(p)}let t=Object.values(this.queueStatuses()),n=t.reduce((p,g)=>p+(g.pending||0),0),o=t.reduce((p,g)=>p+(g.processing||0),0),a=t.reduce((p,g)=>p+(g.stats?.completed||0),0),d=t.reduce((p,g)=>p+(g.failed||0),0),u=a+d;this.queueStats.set({pending:n,sending:o,sent:a,failed:d,retrying:t.reduce((p,g)=>p+(g.retrying||0),0),totalToday:u,successRate:u>0?a/u:0,avgSendTime:t.reduce((p,g)=>p+(g.stats?.avg_time||0),0)/(t.length||1)})}),this.ipcService.on("queue-messages",e=>{this.queueMessages.set(e.messages)}),this.ipcService.on("sending-stats",e=>{let t={labels:e.stats.map(n=>n.date),datasets:[{label:"\u6210\u529F\u53D1\u9001",data:e.stats.map(n=>n.successful||0),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5931\u8D25",data:e.stats.map(n=>n.failed||0),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0}]};this.sendingStatsData.set(t)}),this.ipcService.on("queue-length-history",e=>{let t={labels:e.history.map(n=>n.date),datasets:[{label:"\u961F\u5217\u957F\u5EA6",data:e.history.map(n=>n.queue_length||0),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]};this.queueLengthHistoryData.set(t)}),this.ipcService.on("account-sending-comparison",e=>{let t={labels:e.comparison.map(n=>n.phone),datasets:[{label:"\u603B\u53D1\u9001",data:e.comparison.map(n=>n.total_sent||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u6210\u529F",data:e.comparison.map(n=>n.successful||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5931\u8D25",data:e.comparison.map(n=>n.failed||0),backgroundColor:"rgba(239, 68, 68, 0.8)"}]};this.accountComparisonData.set(t)}),this.ipcService.on("campaign-performance-stats",e=>{let t={labels:e.stats.map(n=>n.campaign_name||"Unknown"),datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:e.stats.map(n=>n.leads_captured||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u5DF2\u8054\u7CFB",data:e.stats.map(n=>n.leads_contacted||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5DF2\u56DE\u590D",data:e.stats.map(n=>n.leads_replied||0),backgroundColor:"rgba(168, 85, 247, 0.8)"}]};this.campaignPerformanceData.set(t)}),this.ipcService.on("ai-greeting-suggestion",e=>{console.log("[AI] Received greeting suggestion:",e),this.aiGreetingSuggestion.set(e),this.showAiGreetingDialog.set(!0),this.toastService.info(`\u{1F916} AI \u5DF2\u70BA @${e.username||e.firstName} \u751F\u6210\u554F\u5019\u5EFA\u8B70`,5e3)}),this.ipcService.on("alert-triggered",e=>{e.timestamp=new Date(e.timestamp).toISOString(),this.alerts.update(t=>t.some(o=>o.alert_type===e.alert_type&&o.message===e.message&&Math.abs(new Date(o.timestamp).getTime()-new Date(e.timestamp).getTime())<6e4)?t:[e,...t].slice(0,100)),this.showBrowserNotification(e),this.showNotification(`\u544A\u8B66: ${e.level.toUpperCase()}`,e.message,{requireInteraction:e.level==="critical"})}),this.ipcService.on("alert-rules-loaded",e=>{e.success&&e.rules&&this.alertRules.set(e.rules)}),this.ipcService.on("alert-rule-updated",e=>{e.success?(this.toastService.success("\u544A\u8B66\u89C4\u5219\u5DF2\u66F4\u65B0"),this.loadAlertRules()):this.toastService.error(e.error||"\u66F4\u65B0\u5931\u8D25")}),this.ipcService.on("alert-history-loaded",e=>{e.success&&e.history&&this.alertHistory.set(e.history)}),this.ipcService.on("alerts-loaded",e=>{this.alerts.set(e.alerts)}),this.ipcService.on("rag-initialized",e=>{this.isInitializingRag.set(!1),e.success?(this.ragSystemInitialized.set(!0),this.toastService.success("\u2705 RAG \u7CFB\u7D71\u521D\u59CB\u5316\u5B8C\u6210"),this.refreshRagStats()):this.toastService.error(`RAG \u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-stats",e=>{if(e.success&&e.rag){let t=e.rag,n=t.by_type||{},o=0,a=0;for(let d of Object.keys(n))(d.toLowerCase().includes("qa")||d.toLowerCase().includes("\u554F\u7B54"))&&(o+=n[d].count||0),(d.toLowerCase().includes("script")||d.toLowerCase().includes("\u8A71\u8853"))&&(a+=n[d].count||0);this.ragStats.set({total_knowledge:t.total_knowledge||0,qa_count:o,scripts_count:a,total_uses:t.total_uses||0,avg_score:t.avg_score||0,chromadb_enabled:t.chromadb_enabled||!1,neural_embedding:t.neural_embedding||!1,by_type:n}),t.total_knowledge>0&&this.ragSystemInitialized.set(!0)}}),this.ipcService.on("rag-search-result",e=>{this.isSearchingRag.set(!1),e.success&&e.results?this.ragSearchResults.set(e.results):e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-learning-triggered",e=>{this.isRagLearning.set(!1),e.success?(this.toastService.success(`\u{1F393} \u5B78\u7FD2\u5B8C\u6210\uFF01\u8655\u7406 ${e.conversationsProcessed||0} \u500B\u5C0D\u8A71\uFF0C\u63D0\u53D6 ${e.knowledgeExtracted||0} \u689D\u77E5\u8B58`),this.refreshRagStats()):this.toastService.error(`\u5B78\u7FD2\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-reindex-complete",e=>{this.isReindexing.set(!1),e.success?(this.toastService.success(`\u{1F504} \u91CD\u65B0\u7D22\u5F15\u5B8C\u6210\uFF01\u8655\u7406 ${e.conversations_processed||0} \u500B\u5C0D\u8A71`),this.refreshRagStats()):this.toastService.error(`\u91CD\u65B0\u7D22\u5F15\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-cleanup-complete",e=>{this.isCleaningRag.set(!1),e.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664 ${e.deleted||0} \u689D\uFF0C\u5408\u4F75 ${e.merged||0} \u689D`),this.refreshRagStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-knowledge-added",e=>{e.success?(this.toastService.success("\u2705 \u77E5\u8B58\u5DF2\u6DFB\u52A0"),this.refreshRagStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-feedback-recorded",e=>{e.success||this.toastService.error(`\u53CD\u994B\u8A18\u9304\u5931\u6557: ${e.error}`)}),this.ipcService.on("memories-searched",e=>{this.isSearchingMemory.set(!1),e.success&&e.memories?this.vectorMemorySearchResults.set(e.memories.map(t=>({id:t.id,userId:t.user_id,content:t.content,memoryType:t.memory_type,importance:t.importance,similarity:t.similarity||0,createdAt:t.created_at}))):e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("memory-added",e=>{this.isAddingMemory.set(!1),e.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u6DFB\u52A0"),this.newMemory={userId:"",content:"",type:"conversation",importance:.5},this.showAddMemoryDialog.set(!1),this.refreshMemoryStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("memory-stats",e=>{e.success&&this.vectorMemoryStats.set({totalMemories:e.totalMemories||0,byType:e.byType||{},totalUsers:e.totalUsers||0,avgImportance:e.avgImportance||0})}),this.ipcService.on("memory-user-list",e=>{e.success&&e.users&&this.memoryUserList.set(e.users)}),this.ipcService.on("memory-deleted",e=>{e.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u522A\u9664"),this.vectorMemorySearchResults.update(t=>t.filter(n=>n.id!==e.memoryId)),this.refreshMemoryStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("memories-merged",e=>{e.success?(this.toastService.success(`\u2705 \u5408\u4F75\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${e.mergedCount||0} \u689D\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u5408\u4F75\u5931\u6557: ${e.error}`)}),this.ipcService.on("old-memories-cleaned",e=>{e.success?(this.toastService.success(`\u2705 \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664\u4E86 ${e.deletedCount||0} \u689D\u820A\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("batch-operation-result",e=>{this.handleBatchOperationResult(e)}),this.ipcService.on("batch-operation-progress",e=>{this.handleBatchOperationProgress(e)}),this.ipcService.on("batch-undo-result",e=>{this.handleBatchUndoResult(e)}),this.ipcService.on("batch-operation-history",e=>{this.handleBatchOperationHistory(e)}),this.ipcService.on("all-tags",e=>{this.handleAllTags(e)}),this.ipcService.on("tag-created",e=>{this.handleTagCreated(e)}),this.ipcService.on("tag-deleted",e=>{this.handleTagDeleted(e)}),this.ipcService.on("ad-templates",e=>{this.handleAdTemplates(e)}),this.ipcService.on("ad-schedules",e=>{this.handleAdSchedules(e)}),this.ipcService.on("ad-send-logs",e=>{this.handleAdSendLogs(e)}),this.ipcService.on("ad-overview-stats",e=>{this.handleAdOverviewStats(e)}),this.ipcService.on("ad-template-created",e=>{this.handleAdTemplateCreated(e)}),this.ipcService.on("ad-template-deleted",e=>{this.handleAdTemplateDeleted(e)}),this.ipcService.on("ad-template-toggled",e=>{e.success&&this.loadAdTemplates()}),this.ipcService.on("ad-schedule-created",e=>{this.handleAdScheduleCreated(e)}),this.ipcService.on("ad-schedule-deleted",e=>{this.handleAdScheduleDeleted(e)}),this.ipcService.on("ad-schedule-toggled",e=>{e.success&&this.loadAdSchedules()}),this.ipcService.on("ad-schedule-run-result",e=>{this.handleAdScheduleRunResult(e)}),this.ipcService.on("spintax-validated",e=>{this.handleSpintaxValidated(e)}),this.ipcService.on("ad-sent",e=>{this.toastService.success(`\u5EE3\u544A\u5DF2\u767C\u9001\u5230 ${e.groupTitle||e.groupId}`)}),this.ipcService.on("ad-send-failed",e=>{this.toastService.error(`\u767C\u9001\u5931\u6557: ${e.error}`)}),this.ipcService.on("broadcast-progress",e=>{this.progressDialog.set({show:!0,title:"\u5EE3\u544A\u767C\u9001\u4E2D...",progress:{current:e.current,total:e.total,message:`\u5DF2\u767C\u9001 ${e.sent}\uFF0C\u5931\u6557 ${e.failed}`},cancellable:!1})}),this.ipcService.on("broadcast-completed",e=>{this.progressDialog.update(t=>P(E({},t),{show:!1})),this.toastService.success(`\u5EE3\u544A\u767C\u9001\u5B8C\u6210: ${e.sent} \u6210\u529F, ${e.failed} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()}),this.ipcService.on("tracked-users",e=>{this.handleTrackedUsers(e)}),this.ipcService.on("user-groups",e=>{this.handleUserGroups(e)}),this.ipcService.on("high-value-groups",e=>{this.handleHighValueGroups(e)}),this.ipcService.on("tracking-stats",e=>{this.handleTrackingStats(e)}),this.ipcService.on("user-added-to-track",e=>{this.handleUserAddedToTrack(e)}),this.ipcService.on("user-added-from-lead",e=>{e.success?this.toastService.success("Lead \u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("user-removed",e=>{this.handleUserRemoved(e)}),this.ipcService.on("user-tracking-started",e=>{this.isTrackingUser.set(!0)}),this.ipcService.on("user-tracking-completed",e=>{this.handleUserTrackingCompleted(e)}),this.ipcService.on("user-tracking-failed",e=>{this.handleUserTrackingFailed(e)}),this.ipcService.on("user-value-updated",e=>{e.success&&this.loadTrackedUsers()}),this.ipcService.on("batch-tracking-progress",e=>{this.progressDialog.set({show:!0,title:"\u6279\u91CF\u8FFD\u8E64\u4E2D...",progress:{current:e.current,total:e.total,message:`\u6B63\u5728\u8FFD\u8E64\u7528\u6236 ${e.userId}`},cancellable:!1})}),this.ipcService.on("batch-tracking-completed",e=>{this.progressDialog.update(t=>P(E({},t),{show:!1})),this.toastService.success(`\u6279\u91CF\u8FFD\u8E64\u5B8C\u6210: ${e.completed} \u6210\u529F, ${e.failed} \u5931\u6557`),this.loadTrackedUsers(),this.loadTrackingStats()}),this.ipcService.on("campaigns",e=>{this.handleCampaigns(e)}),this.ipcService.on("campaign-created",e=>{this.handleCampaignCreated(e)}),this.ipcService.on("campaign-deleted",e=>{this.handleCampaignDeleted(e)}),this.ipcService.on("campaign-started",e=>{e.success!==!1&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadCampaigns())}),this.ipcService.on("campaign-paused",e=>{e.success&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u66AB\u505C"),this.loadCampaigns())}),this.ipcService.on("campaign-stopped",e=>{e.success!==!1&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u505C\u6B62"),this.loadCampaigns())}),this.ipcService.on("campaign-completed",e=>{this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u57F7\u884C\u5B8C\u6210"),this.loadCampaigns(),this.loadUnifiedOverview()}),this.ipcService.on("campaign-step-started",e=>{this.progressDialog.set({show:!0,title:"\u57F7\u884C\u71DF\u92B7\u6D3B\u52D5...",progress:{current:0,total:0,message:`\u57F7\u884C\u6B65\u9A5F: ${e.actionType}`},cancellable:!1})}),this.ipcService.on("campaign-step-completed",e=>{this.progressDialog.update(t=>P(E({},t),{show:!1}))}),this.ipcService.on("unified-overview",e=>{this.handleUnifiedOverview(e)}),this.ipcService.on("funnel-analysis",e=>{this.handleFunnelAnalysis(e)}),this.ipcService.on("role-templates",e=>{this.handleRoleTemplates(e)}),this.ipcService.on("all-roles",e=>{this.handleAllRoles(e)}),this.ipcService.on("role-assigned",e=>{e.success?(this.toastService.success("\u89D2\u8272\u5DF2\u5206\u914D"),this.loadAllRoles(),this.loadRoleStats()):this.toastService.error(`\u5206\u914D\u5931\u6557: ${e.error}`)}),this.ipcService.on("role-removed",e=>{e.success&&(this.toastService.success("\u89D2\u8272\u5DF2\u79FB\u9664"),this.loadAllRoles(),this.loadRoleStats())}),this.ipcService.on("role-stats",e=>{this.handleRoleStats(e)}),this.ipcService.on("script-templates",e=>{this.handleScriptTemplates(e)}),this.ipcService.on("collab-groups",e=>{this.handleCollabGroups(e)}),this.ipcService.on("collab-stats",e=>{this.handleCollabStats(e)}),this.ipcService.on("collab-group-created",e=>{e.success!==!1&&(this.toastService.success("\u5354\u4F5C\u7FA4\u7D44\u5DF2\u5275\u5EFA"),this.loadCollabGroups())}),this.ipcService.on("resource-discovery-initialized",e=>{if(e.success){if(this.resourceDiscoveryInitialized.set(!0),this.toastService.success("\u2705 \u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71\u5DF2\u521D\u59CB\u5316"),this.refreshResourceStats(),this.loadDiscoveryKeywords(),this.pendingSearchQuery){let t=this.pendingSearchQuery;this.pendingSearchQuery="",this.toastService.info(`\u6B63\u5728\u641C\u7D22 "${t}"...`),setTimeout(()=>this.searchResources(),500)}}else this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-results-direct",e=>{if(this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),e.success&&e.results){let t=e.results,n=e.query?.toLowerCase()||"",o=t.sort((u,p)=>{let g=(u.title||"").toLowerCase(),C=(p.title||"").toLowerCase(),w=g.includes(n)?1:0,A=C.includes(n)?1:0;return w!==A?A-w:(p.overall_score||0)-(u.overall_score||0)}),a=new Set,d=o.filter(u=>a.has(u.telegram_id)?!1:(a.add(u.telegram_id),!0));if(this.discoveredResources.set(d),this.currentSearchKeyword.set(n),d.length>0){let u=this.generateSearchCacheKey(e.query||"",this.selectedSearchSources());this.setSearchCache(u,d)}d.length===0?console.log(`[Search] \u672A\u627E\u5230\u8207\u300C${e.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`):console.log(`[Search] \u627E\u5230 ${d.length} \u500B\u8207\u300C${e.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`)}else e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-resources-complete",e=>{this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),e.success?(e.found===0?console.log("[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C"):console.log(`[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u627E\u5230 ${e.found} \u4E2A`),this.refreshResourceStats()):this.toastService.error(`\u641C\u7D22\u5931\u8D25: ${e.error}`)}),this.ipcService.on("search-jiso-complete",e=>{if(e.success&&e.results){let n=e.results.length;if(n===0)console.log("[Search] \u6781\u641C\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C");else{let o=e.cached?"\uFF08\u7F13\u5B58\uFF09":"",a=e.bot?`\uFF08\u4F86\u81EA @${e.bot}\uFF09`:"";console.log(`[Search] \u6781\u641C\u5B8C\u6210${o}\uFF1A\u627E\u5230 ${n} \u4E2A\u7FA4\u7EC4${a}`);let d=this.discoveredResources(),u=new Set(d.map(g=>g.telegram_id||g.username)),p=e.results.filter(g=>!u.has(g.telegram_id)&&!u.has(g.username)).map(g=>{let C=g.username||"";C&&C.toLowerCase().endsWith("bot")&&(C="");let w=g.link||"";return w&&/t\.me\/[^/]+\/\d+/.test(w)&&(w=""),{id:0,telegram_id:g.telegram_id&&/^-?\d+$/.test(String(g.telegram_id))?String(g.telegram_id):"",username:C,title:g.title||"",description:g.description||"",member_count:g.member_count||0,resource_type:g.chat_type||g.resource_type||"group",activity_score:.5,relevance_score:.6,overall_score:.6,status:"discovered",discovery_source:"jiso",discovery_keyword:this.currentSearchKeyword(),created_at:new Date().toISOString(),invite_link:w,link:w||(C?`https://t.me/${C}`:""),is_saved:!1,can_join:!!(w||C)}});if(p.length>0){let g=[...d,...p];this.discoveredResources.set(g),console.log(`[Search] \u5DF2\u5408\u4F75 ${p.length} \u500B\u65B0\u7D50\u679C`);let C=this.currentSearchKeyword();if(C&&g.length>0){let w=this.generateSearchCacheKey(C,this.selectedSearchSources());this.setSearchCache(w,g)}}}this.refreshResourceStats()}else if(e.error){let n=e.error,o=[],a="";n.includes("Username not found")||n.includes("\u4E0D\u53EF\u7528")?(o=["\u641C\u7D22\u6A5F\u5668\u4EBA\u9996\u6B21\u4F7F\u7528\u9700\u8981\u6FC0\u6D3B","\u8ACB\u5728 Telegram \u4E2D\u6253\u958B @smss \u4E26\u767C\u9001 /start","\u6216\u8005\u6253\u958B @jisou3 \u4E26\u767C\u9001 /start","\u6FC0\u6D3B\u5F8C\u91CD\u65B0\u641C\u7D22"],a="\u641C\u7D22\u6A5F\u5668\u4EBA\u5C1A\u672A\u6FC0\u6D3B"):n.includes("FloodWait")||n.includes("\u9650\u5236")?(o=["\u7B49\u5F85\u5E7E\u5206\u9418\u5F8C\u91CD\u8A66","\u6E1B\u5C11\u641C\u7D22\u983B\u7387","\u4F7F\u7528\u5176\u4ED6\u5E33\u865F\u641C\u7D22"],a="Telegram \u8ACB\u6C42\u983B\u7387\u9650\u5236"):n.includes("\u6CA1\u6709\u53EF\u7528")?(o=["\u6AA2\u67E5\u5E33\u865F\u662F\u5426\u5DF2\u767B\u9304","\u78BA\u4FDD\u81F3\u5C11\u6709\u4E00\u500B\u5E33\u865F\u5728\u7DDA"],a="\u6C92\u6709\u53EF\u7528\u5E33\u865F"):o=["\u91CD\u8A66\u641C\u7D22","\u4F7F\u7528\u4E0D\u540C\u95DC\u9375\u8A5E"],this.searchError.set({hasError:!0,message:n,details:a,suggestions:o}),this.toastService.error(`\u6781\u641C\u5931\u6557: ${a||n}`)}let t=this.selectedSearchSources();t.length===1&&t[0]==="jiso"&&(this.isSearchingResources.set(!1),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null))}),this.ipcService.on("jiso-search-progress",e=>{e.status==="searching"?console.log(`[Search] \u6781\u641C\uFF1A${e.message}`):e.status==="waiting"&&console.log(`[Search] \u6781\u641C\u7B49\u5F85\uFF1A${e.message}`)}),this.ipcService.on("search-channels-list",e=>{e.success&&(this.systemChannels.set(e.system_channels||[]),this.customChannels.set(e.custom_channels||[]))}),this.ipcService.on("search-channel-added",e=>{e.success?(this.toastService.success(`\u2705 \u5DF2\u6DFB\u52A0\u6E20\u9053 @${e.botUsername}`),this.showAddChannelDialog.set(!1),this.loadSearchChannels()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-updated",e=>{e.success?(this.toastService.success("\u2705 \u6E20\u9053\u5DF2\u66F4\u65B0"),this.loadSearchChannels()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-deleted",e=>{e.success?(this.toastService.success("\u{1F5D1}\uFE0F \u6E20\u9053\u5DF2\u522A\u9664"),this.loadSearchChannels()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-tested",e=>{this.isTestingChannel.set(!1),e.success?(this.toastService.success(`\u2705 @${e.botUsername} \u6E2C\u8A66\u6210\u529F (${e.responseTime?.toFixed(1)}s)`),this.loadSearchChannels()):(this.toastService.warning(`\u274C @${e.botUsername} \u6E2C\u8A66\u5931\u6557: ${e.error}`),this.loadSearchChannels())}),this.ipcService.on("resources-list",e=>{if(this.isInSearchResultMode()){console.log("[\u8CC7\u6E90\u4E2D\u5FC3] \u5FFD\u7565 resources-list\uFF0C\u7576\u524D\u8655\u65BC\u641C\u7D22\u7D50\u679C\u6A21\u5F0F");return}if(e.success&&e.resources){this.discoveredResources.set(e.resources);let t=e.resources.filter(n=>!n.type_verified&&n.username);if(t.length>0){let o=t.slice(0,10).map(a=>a.id);this.ipcService.send("batch-verify-resource-types",{resourceIds:o})}}}),this.ipcService.on("resource-stats",e=>{e.success&&(this.resourceStats.set({total_resources:e.total_resources||0,by_status:e.by_status||{},by_type:e.by_type||{},today_discovered:e.today_discovered||0,pending_joins:e.pending_joins||0,joined_count:e.joined_count||0,avg_score:e.avg_score||0}),e.total_resources&&e.total_resources>0&&this.resourceDiscoveryInitialized.set(!0))}),this.ipcService.on("resource-added",e=>{e.success?(this.toastService.success("\u2705 \u8CC7\u6E90\u5DF2\u6DFB\u52A0"),this.showAddResourceDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("resource-type-verified",e=>{e.success?(e.oldType!==e.newType?this.toastService.success(`\u2705 \u985E\u578B\u5DF2\u66F4\u65B0: ${e.oldType} \u2192 ${e.newType}`):this.toastService.info(`\u{1F4CB} \u985E\u578B\u78BA\u8A8D: ${e.newType}`),this.loadResources()):this.toastService.error(`\u9A57\u8B49\u5931\u6557: ${e.error}`)}),this.ipcService.on("resources-types-verified",e=>{e.success&&e.count&&e.count>0&&this.loadResources()}),this.ipcService.on("resource-deleted",e=>{e.success?(this.toastService.success("\u{1F5D1}\uFE0F \u8CC7\u6E90\u5DF2\u522A\u9664"),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("leave-group-complete",e=>{e.success?(this.toastService.success("\u{1F6AA} \u5DF2\u9000\u51FA\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):this.toastService.error(`\u9000\u51FA\u7FA4\u7D44\u5931\u6557: ${e.error}`)}),this.ipcService.on("remove-group-result",e=>{e.success?(this.toastService.success("\u2705 \u5DF2\u505C\u6B62\u76E3\u63A7\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):(this.toastService.error(`\u505C\u6B62\u76E3\u63A7\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`),this.loadResources())}),this.ipcService.on("join-queue-updated",e=>{e.success?(this.toastService.success(`\u{1F4CB} \u5DF2\u6DFB\u52A0 ${e.added} \u500B\u8CC7\u6E90\u5230\u52A0\u5165\u968A\u5217`),this.refreshResourceStats(),this.selectedResourceIds.set([])):this.toastService.error(`\u6DFB\u52A0\u5230\u968A\u5217\u5931\u6557: ${e.error}`)}),this.ipcService.on("join-queue-processed",e=>{this.isProcessingJoinQueue.set(!1),e.success?(this.toastService.success(`\u{1F680} \u8655\u7406\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}`),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u8655\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("batch-join-started",e=>{e.success&&this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${e.count} \u500B\u8CC7\u6E90`)}),this.ipcService.on("batch-join-complete",e=>{e.success&&(this.toastService.success(`\u2705 \u6279\u91CF\u52A0\u5165\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}\uFF0C\u8DF3\u904E ${e.skipped}`),this.loadResources(),this.refreshResourceStats())}),this.ipcService.on("join-and-monitor-complete",e=>{this.isJoiningResource.set(!1),e.success?(this.toastService.success("\u2705 \u5DF2\u52A0\u5165\u4E26\u6DFB\u52A0\u5230\u76E3\u63A7"),this.showJoinMonitorDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u52A0\u5165\u5931\u6557: ${e.error}`)}),this.ipcService.on("join-and-monitor-with-account-complete",e=>{if(this.isJoiningResource.set(!1),e.success){let t=this.joinMonitorSelectedKeywordSetIds().length,n=this.joinMonitorResource(),o=e.status==="pending_approval"?"pending_approval":"joined";this.updateResourceStatusLocally(n,o,e.phone,e.memberCount),e.status==="pending_approval"?(this.toastService.info(`\u{1F4E8} \u52A0\u5165\u8ACB\u6C42\u5DF2\u767C\u9001\uFF0C\u7B49\u5F85\u7BA1\u7406\u54E1\u6279\u51C6
\u5E33\u865F: ${e.phone}`,5e3),this.showJoinMonitorDialog.set(!1)):this.showPostJoinOptions(n,e.phone,t),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")}else{let t=e.error||"\u672A\u77E5\u932F\u8AA4";t.includes("\u7F3A\u5C11\u52A0\u5165\u65B9\u5F0F")||t.includes("username")?this.toastService.error(`\u274C \u7121\u6CD5\u52A0\u5165\uFF1A\u6B64\u7FA4\u7D44\u6C92\u6709\u63D0\u4F9B\u6709\u6548\u7684\u52A0\u5165\u93C8\u63A5
\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5`,6e3):this.toastService.error(`\u274C \u52A0\u5165\u5931\u6557: ${t}`,5e3)}}),this.ipcService.on("batch-join-and-monitor-complete",e=>{if(this.isJoiningResource.set(!1),this.closeBatchJoinMonitorDialog(),e.success){let t=this.joinMonitorSelectedKeywordSetIds().length,n=t>0?`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}\uFF0C\u5DF2\u7D81\u5B9A ${t} \u500B\u95DC\u9375\u8A5E\u96C6`:`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}`;this.toastService.success(n),this.loadResources(),this.refreshResourceStats(),this.selectedResourceIds.set([]),this.ipcService.send("get-monitored-groups")}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${e.error}`)}),this.ipcService.on("members-extraction-progress",e=>{this.memberListProgress.set({extracted:e.extracted,total:e.total,status:e.status})}),this.ipcService.on("members-extracted",e=>{if(this.memberListLoading.set(!1),e.success&&e.members){let t=new Set(this.memberListData().map(o=>o.user_id)),n=e.members.filter(o=>!t.has(o.user_id));this.memberListData.update(o=>[...o,...n]),this.memberListProgress.update(o=>P(E({},o),{extracted:this.memberListData().length,status:`\u5DF2\u63D0\u53D6 ${this.memberListData().length} \u500B\u6210\u54E1`})),n.length>0?this.calculateAndShowExtractionSummary(n):this.toastService.info("\u6C92\u6709\u66F4\u591A\u65B0\u6210\u54E1")}else e.error&&this.handleMemberExtractionError(e)}),this.ipcService.on("batch-members-extracted",e=>{e.success?this.toastService.success(`\u2705 \u6279\u91CF\u63D0\u53D6\u5B8C\u6210\uFF1A${e.totalGroups} \u500B\u7FA4\u7D44\uFF0C\u5171 ${e.totalMembers} \u500B\u6210\u54E1`):this.toastService.error(`\u6279\u91CF\u63D0\u53D6\u5931\u6557: ${e.error}`)}),this.ipcService.on("group-message-sent",e=>{e.success?this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001\u5230\u7FA4\u7D44"):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("message-queued",e=>{console.log("[Frontend] Message queued:",e),this.toastService.info("\u{1F4E4} \u6D88\u606F\u5DF2\u52A0\u5165\u767C\u9001\u968A\u5217")}),this.ipcService.on("message-sent",e=>{console.log("[Frontend] Message sent result:",e),e.success?(this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001"),this.closeLeadDetailModal(),this.ipcService.send("get-leads",{})):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("link-analysis-complete",e=>{this.isAnalyzingLink.set(!1),e.success?e.isPrivate?this.toastService.warning(e.message||"\u9019\u662F\u79C1\u6709\u93C8\u63A5"):(this.toastService.success("\u2705 \u5206\u6790\u5B8C\u6210"),console.log("Link analysis result:",e)):this.toastService.error(`\u5206\u6790\u5931\u6557: ${e.error}`)}),this.ipcService.on("ollama-models",e=>{e.success&&e.models?(this.availableOllamaModels.set(e.models),this.toastService.success(`\u627E\u5230 ${e.models.length} \u500B\u6A21\u578B`)):e.error&&this.toastService.error(`\u7372\u53D6\u6A21\u578B\u5217\u8868\u5931\u6557: ${e.error}`)}),this.ipcService.on("local-ai-test-result",e=>{this.isTestingLocalAi.set(!1),e.success?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success(e.message||"\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(e.error||"\u9023\u63A5\u5931\u6557"),this.toastService.error(e.error||"\u9023\u63A5\u5931\u6557"))}),this.ipcService.on("first-run-status",e=>{this.isFirstRun.set(e.isFirstRun),e.isFirstRun&&(console.log("[App] \u9996\u6B21\u904B\u884C\uFF0C\u5F8C\u53F0\u975C\u9ED8\u914D\u7F6E AI\uFF08\u4E0D\u5F37\u5236\u986F\u793A\u5411\u5C0E\uFF09"),setTimeout(()=>this.detectOllama(),1e3))}),this.ipcService.on("backend-status",e=>{console.log("[App] Backend status:",e),this.backendRunning.set(e.running),!e.running&&e.error&&(this.backendError.set(e.error),this.showBackendErrorDialog.set(!0),this.toastService.error("\u274C Python \u5F8C\u7AEF\u672A\u904B\u884C\uFF0C\u90E8\u5206\u529F\u80FD\u7121\u6CD5\u4F7F\u7528"))}),this.ipcService.on("ollama-detected",e=>{if(this.isDetectingOllama.set(!1),e.success&&(this.ollamaDetected.set(e.available||!1),e.models&&e.models.length>0)){this.detectedOllamaModels.set(e.models);let n=["qwen2:7b","qwen:7b","llama3:8b","mistral:7b"].find(o=>e.models.some(a=>a.includes(o.split(":")[0])))||e.models[0];this.autoSelectedModel.set(n),this.localAiModel.set(n)}}),this.ipcService.on("first-run-settings-saved",e=>{e.success?console.log("[App] \u9996\u6B21\u8A2D\u7F6E\u5DF2\u4FDD\u5B58"):console.error("[App] \u9996\u6B21\u8A2D\u7F6E\u4FDD\u5B58\u5931\u6557:",e.error)}),this.ipcService.on("discovery-keywords",e=>{e.success&&e.keywords&&this.discoveryKeywords.set(e.keywords)}),this.ipcService.on("discovery-keyword-added",e=>{e.success?(this.toastService.success(`\u2795 \u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0: ${e.keyword}`),this.showAddKeywordDialog.set(!1),this.newResourceKeyword="",this.loadDiscoveryKeywords()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-watcher-initialized",e=>{e.success?(this.discussionWatcherInitialized.set(!0),this.toastService.success("\u2705 \u8A0E\u8AD6\u7D44\u76E3\u63A7\u670D\u52D9\u5DF2\u521D\u59CB\u5316"),this.loadChannelDiscussions(),this.refreshDiscussionStats()):this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-discovered",e=>{e.success&&e.discussion?(this.toastService.success(`\u2705 \u767C\u73FE\u8A0E\u8AD6\u7D44: ${e.discussion.discussion_title}`),this.loadChannelDiscussions()):this.toastService.error(e.error||"\u672A\u627E\u5230\u8A0E\u8AD6\u7D44")}),this.ipcService.on("discussions-batch-discovered",e=>{e.success?(this.toastService.success(`\u2705 \u767C\u73FE\u4E86 ${e.count} \u500B\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u767C\u73FE\u5931\u6557: ${e.error}`)}),this.ipcService.on("channel-discussions-list",e=>{e.success&&e.discussions&&this.channelDiscussions.set(e.discussions)}),this.ipcService.on("discussion-monitoring-status",e=>{e.success?(this.toastService.success(`${e.status==="monitoring"?"\u{1F7E2} \u958B\u59CB":"\u{1F534} \u505C\u6B62"}\u76E3\u63A7\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u64CD\u4F5C\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-messages",e=>{this.isLoadingDiscussionMessages.set(!1),e.success&&e.messages?this.discussionMessages.set(e.messages):(this.toastService.error(e.error||"\u52A0\u8F7D\u6D88\u606F\u5931\u8D25"),this.discussionMessages.set([]))}),this.ipcService.on("discussion-message",e=>{e.is_matched&&this.toastService.info(`\u{1F3AF} \u95DC\u9375\u8A5E\u5339\u914D: @${e.username} - ${e.keywords.join(", ")}`)}),this.ipcService.on("discussion-lead-captured",e=>{this.toastService.success(`\u{1F464} \u65B0\u6F5B\u5728\u5BA2\u6236: @${e.username}`),this.refreshDiscussionStats()}),this.ipcService.on("discussion-reply-result",e=>{e.success?(this.toastService.success("\u2705 \u56DE\u5FA9\u5DF2\u767C\u9001"),this.selectedDiscussionId()&&this.loadDiscussionMessages(this.selectedDiscussionId())):this.toastService.error(`\u56DE\u5FA9\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-stats",e=>{e.success&&(this.discussionStats.set({total_discussions:e.total_discussions||0,monitoring_count:e.monitoring_count||0,total_messages:e.total_messages||0,matched_messages:e.matched_messages||0,leads_from_discussions:e.leads_from_discussions||0,today_messages:e.today_messages||0,today_leads:e.today_leads||0}),e.total_discussions>0&&this.discussionWatcherInitialized.set(!0))}),this.ipcService.on("chat-list",e=>{e.success&&e.chats?this.chatList.set(e.chats):console.error("[Frontend] Chat list error:",e.error)}),this.ipcService.on("chat-history-full",e=>{if(console.log("[Frontend] Received chat-history-full event:",e),e.success&&e.messages){let t=this.chatHistoryPage();if(t===0)this.chatHistoryAllMessages.set(e.messages),this.chatHistory.set(e.messages),console.log("[Frontend] Loaded first page:",e.messages.length,"messages");else{let o=[...this.chatHistoryAllMessages(),...e.messages];this.chatHistoryAllMessages.set(o),this.chatHistory.set(o),console.log("[Frontend] Loaded page",t,":",e.messages.length,"messages, total:",o.length)}this.chatHistoryHasMore.set(e.hasMore||!1),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1),console.log("[Frontend] Chat history loaded. Has more:",e.hasMore,"Total:",e.total)}else console.error("[Frontend] Chat history error:",e.error),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}),this.ipcService.on("chat-message-received",e=>{this.selectedChatUserId()===e.userId&&this.loadChatHistory(e.userId),this.loadChatList()}),this.ipcService.on("ai-response-generated",e=>{this.selectedChatUserId()===e.userId&&this.loadChatHistory(e.userId)}),this.ipcService.on("monitoring-status",e=>{e.success&&console.log("[Frontend] Monitoring status:",e)}),this.ipcService.on("monitoring-health",e=>{e.success&&(e.issues&&e.issues.length>0&&console.warn("[Frontend] Monitoring issues:",e.issues),e.warnings&&e.warnings.length>0&&console.warn("[Frontend] Monitoring warnings:",e.warnings))}),this.ipcService.on("alerts-loaded",e=>{let t=e.alerts.map(n=>P(E({},n),{timestamp:new Date(n.timestamp).toISOString(),acknowledged_at:n.acknowledged_at?new Date(n.acknowledged_at).toISOString():void 0,resolved_at:n.resolved_at?new Date(n.resolved_at).toISOString():void 0}));this.alerts.set(t)})}applyInitialState(e){console.log("Received initial state from backend:",e),this.backendConnectionState.set("connected"),this.backendConnectionProgress.set(100),this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.accounts.set(e.accounts||[]),this.keywordSets.set(e.keywordSets||[]),this.monitoredGroups.set(e.monitoredGroups||[]),this.campaigns.set(e.campaigns||[]),this.messageTemplates.set(e.messageTemplates||[]),e.isMonitoring!==void 0&&this.isMonitoring.set(e.isMonitoring);let t=(e.leads||[]).map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.leadsTotal.set(e.leadsTotal??e.leads?.length??0),this.contactsService.importLeadsDirectly(t),this.logs.set((e.logs||[]).map(n=>P(E({},n),{timestamp:new Date(n.timestamp)}))),e.settings&&(this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(e.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(e.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.settings.smartSendingEnabled??!0))}setLanguage(e){this.translationService.setLanguage(e)}changeView(e){if(e==="ads"&&!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="multi-role"&&!this.membershipService.hasFeature("multiRole")){this.toastService.warning("\u{1F48E} \u591A\u89D2\u8272\u5354\u4F5C\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="user-tracking"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u7528\u6236\u8FFD\u8E64\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="campaigns"&&!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-team"&&!this.membershipService.hasFeature("autoExecution")){this.toastService.warning("\u{1F48E} AI\u5718\u968A\u92B7\u552E\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-assistant"&&!this.membershipService.hasFeature("strategyPlanning")){this.toastService.warning("\u{1F48E} AI\u7B56\u7565\u898F\u5283\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u6D1E\u5BDF\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics-center"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5206\u6790\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="lead-nurturing"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u5BA2\u6236\u57F9\u80B2\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="nurturing-analytics"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u57F9\u80B2\u5206\u6790\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(this.navBridge.navigateTo(e),this.currentView.set(e),e==="resources"){let t=this.leads();t.length>0&&(this.syncLeadsToResourceCenter(t),console.log("[changeView] Synced leads to resource center:",t.length))}}switchDashboardMode(e){if(e==="smart"&&!this.membershipService.hasFeature("smartMode")){this.toastService.warning("\u{1F947} \u667A\u80FD\u6A21\u5F0F\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.dashboardMode.set(e)}handleDashboardNavigation(e){let n={"monitoring-accounts":"monitoring-accounts","monitoring-groups":"monitoring-groups","keyword-sets":"keyword-sets","chat-templates":"chat-templates","trigger-rules":"trigger-rules","collected-users":"collected-users","automation-rules":"trigger-rules",resources:"resources",rules:"trigger-rules","send-settings":"leads",analytics:"analytics"}[e];n&&this.changeView(n)}handleDashboardConfigAction(e){this.handleDashboardNavigation(e)}checkBatchOperationPermission(){return this.membershipService.hasFeature("batchOperations")?!0:(this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),!1)}addAccount(){let e=this.membershipService.canAddAccount(this.accounts().length);if(!e.allowed){this.toastService.warning(e.message||"\u5DF2\u9054\u5230\u8CEC\u6236\u6578\u91CF\u4E0A\u9650"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newAccount();this.validationErrors.set({});let n=[],o=t.phone.trim().replace(/[\s\-\(\)]/g,"");if(o?/^\+\d{1,15}$/.test(o)||n.push("Phone number must be in format +1234567890 (with country code)"):n.push("Phone number is required"),t.apiId&&!/^\d+$/.test(t.apiId.trim())&&n.push("API ID must be a positive integer"),t.apiHash&&!/^[a-fA-F0-9]{32}$/.test(t.apiHash.trim())&&n.push("API Hash must be a 32-character hexadecimal string"),t.proxy&&!/^(socks5|http|https):\/\/([^:]+(:[^@]+)?@)?[^:]+(:\d+)?$/.test(t.proxy.trim())&&n.push("Proxy must be in format: socks5://host:port or http://host:port"),n.length>0){this.validationErrors.set({account:n}),this.toastService.error(`\u9A8C\u8BC1\u5931\u8D25: ${n.join("; ")}`),console.error("Account validation errors:",n);return}let d={phone:t.phone.trim().replace(/[\s\-\(\)]/g,""),apiId:t.apiId.trim(),apiHash:t.apiHash.trim(),proxy:t.proxy.trim()||"",group:t.group.trim()||"",twoFactorPassword:t.twoFactorPassword.trim()||"",role:"Unassigned",enableWarmup:t.enableWarmup||!1};console.log("Sending add-account command:",d),this.ipcService.send("add-account",d),this.newAccount.set({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""}),this.toastService.info("\u6B63\u5728\u6DFB\u52A0\u8D26\u6237\uFF0C\u8BF7\u7A0D\u5019...")}onAccountAdded(e){console.log("[Frontend] Account added from add-account page:",e),this.toastService.success("\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01"),this.changeView("accounts")}goToAddAccount(){this.changeView("add-account")}loginAccount(e){console.log("[Frontend] loginAccount called with accountId:",e);let t=this.accounts().find(n=>n.id===e);if(!t){console.error("[Frontend] Account not found:",e),this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}console.log("[Frontend] Found account:",t.phone,"Status:",t.status),this.toastService.info("\u6B63\u5728\u767B\u5F55\u8D26\u6237..."),this.loginState.set({accountId:e,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set(""),console.log("[Frontend] Sending login-account command to IPC"),this.ipcService.send("login-account",e)}logoutAccount(e){let t=this.accounts().find(n=>n.id===e);if(!t){this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}confirm(`\u786E\u5B9A\u8981\u9000\u51FA\u8D26\u6237 ${t.phone} \u5417\uFF1F`)&&(this.toastService.info("\u6B63\u5728\u9000\u51FA\u8D26\u6237..."),this.ipcService.send("logout-account",e),this.ipcService.once("logout-account-result",n=>{n.success?this.toastService.success(`\u8D26\u6237 ${t.phone} \u5DF2\u9000\u51FA`):this.toastService.error(`\u9000\u51FA\u5931\u8D25: ${n.error||"\u672A\u77E5\u9519\u8BEF"}`)}))}editAccount(e){this.toastService.info(`\u7DE8\u8F2F\u5E33\u6236: ${e.phone}`)}submitLoginCode(){let e=this.loginState();!e.accountId||!e.phoneCodeHash||!this.loginCode().trim()||(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!0}),this.toastService.info("\u6B63\u5728\u9A8C\u8BC1\u9A8C\u8BC1\u7801..."),this.ipcService.send("login-account",{accountId:e.accountId,phoneCode:this.loginCode().trim(),phoneCodeHash:e.phoneCodeHash}),this.loginCode.set(""))}submitLogin2FA(){let e=this.loginState();!e.accountId||!this.login2FAPassword().trim()||(this.ipcService.send("login-account",{accountId:e.accountId,twoFactorPassword:this.login2FAPassword().trim()}),this.login2FAPassword.set(""))}cancelLogin(){this.loginState.set({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set("")}resendVerificationCode(){let e=this.loginState();e.accountId&&(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.toastService.info("\u6B63\u5728\u91CD\u65B0\u53D1\u9001\u9A8C\u8BC1\u7801\u5230\u60A8\u7684 Telegram \u5E94\u7528...",5e3),this.ipcService.send("login-account",e.accountId))}checkAccountStatus(e){this.ipcService.send("check-account-status",e)}navigateToError(e){let t=this.errorNavigationMap[e];if(!t){console.log("[Frontend] No navigation defined for error:",e);return}this.changeView(t.view),setTimeout(()=>{if(t.elementId){let n=document.getElementById(t.elementId);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("highlight-pulse"),setTimeout(()=>{n.classList.remove("highlight-pulse")},3e3))}t.action&&t.action()},300),this.toastService.info("\u5DF2\u8DF3\u8F49\u5230\u76F8\u95DC\u8A2D\u7F6E\u5340\u57DF",2e3)}startMonitoring(){if(this.isStartingMonitoring()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u76E3\u63A7\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.listenerAccounts();if(e.length===0){let n=this.accounts().filter(o=>o.role==="Listener");if(n.length>0){let o=n.filter(a=>a.status!=="Online");o.length>0?this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6709 ${n.length} \u500B\u76E3\u807D\u8CEC\u6236\uFF0C\u4F46\u6C92\u6709\u5728\u7DDA\u7684\u8CEC\u6236\u3002

\u8ACB\u5148\u767B\u9304\u4EE5\u4E0B\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA\uFF1A
`+o.map(a=>`- ${a.phone} (${a.status})`).join(`
`),8e3):this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u7570\u5E38\uFF0C\u8ACB\u6AA2\u67E5\u8CEC\u6236\u72C0\u614B\u3002",5e3)}else this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u807D\u8CEC\u6236\u3002

\u8ACB\u5148\uFF1A
1. \u5728"\u8CEC\u6236\u7BA1\u7406"\u4E2D\u6DFB\u52A0\u8CEC\u6236
2. \u5C07\u8CEC\u6236\u89D2\u8272\u8A2D\u7F6E\u70BA"\u76E3\u807D"
3. \u767B\u9304\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA`,6e3);return}if(this.monitoredGroups().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44\u3002",4e3);return}if(this.keywordSets().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u95DC\u9375\u8A5E\u96C6\u3002\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u96C6\u3002",4e3);return}if(e.filter(n=>n.status==="Online").length===0){this.toastService.warning("\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u4E0D\u7A69\u5B9A\uFF0C\u8ACB\u7B49\u5F85\u8CEC\u6236\u5B8C\u5168\u4E0A\u7DDA\u5F8C\u518D\u8A66\u3002",4e3);return}this.isStartingMonitoring.set(!0),this.ipcService.send("start-monitoring"),setTimeout(()=>{this.isStartingMonitoring.set(!1)},5e3)}stopMonitoring(){this.ipcService.send("stop-monitoring")}oneClickStart(){if(this.oneClickStarting()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.accounts().length;if(e===0){this.toastService.error("\u274C \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55\u5E33\u865F\uFF0C\u8ACB\u5148\u6DFB\u52A0\u5E33\u865F",4e3);return}this.oneClickStarting.set(!0),this.oneClickProgress.set(0),this.oneClickMessage.set(`\u{1F680} \u958B\u59CB\u555F\u52D5 (${e} \u500B\u5E33\u865F)...`),this.ipcService.send("one-click-start",{forceRefresh:!0}),this.toastService.info(`\u{1F680} \u958B\u59CB\u4E00\u9375\u555F\u52D5\uFF0C\u5F8C\u7AEF\u5C07\u81EA\u52D5\u9023\u63A5 ${e} \u500B\u5E33\u865F`,3e3)}oneClickStop(){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6240\u6709\u670D\u52D9\u55CE\uFF1F\u9019\u5C07\u505C\u6B62\u76E3\u63A7\u548C AI \u81EA\u52D5\u804A\u5929\u3002")&&this.ipcService.send("one-click-stop")}loadSystemStatus(){this.ipcService.send("get-system-status")}clearLogs(){confirm("\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u65E5\u5FD7\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-logs"),this.logs.set([]),this.toastService.success("\u65E5\u5FD7\u5DF2\u6E05\u9664"))}refreshQueueStatus(e){this.ipcService.send("get-queue-status",e?{phone:e}:{})}clearPendingQueue(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5F85\u767C\u9001\u6D88\u606F\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002")&&(this.ipcService.send("clear-queue",{status:"pending"}),this.toastService.success("\u5F85\u767C\u9001\u968A\u5217\u5DF2\u6E05\u7A7A"))}retryMessage(e){this.ipcService.send("retry-message",{messageId:e}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u767C\u9001...")}cancelMessage(e){this.ipcService.send("cancel-message",{messageId:e}),this.toastService.success("\u6D88\u606F\u5DF2\u53D6\u6D88"),this.refreshQueueStatus()}clearQueue(e,t){confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u961F\u5217\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-queue",{phone:e,status:t}),this.toastService.info("\u6B63\u5728\u6E05\u7A7A\u961F\u5217..."))}pauseQueue(e){this.ipcService.send("pause-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6682\u505C\u961F\u5217...")}resumeQueue(e){this.ipcService.send("resume-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6062\u590D\u961F\u5217...")}deleteQueueMessage(e,t){confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u6D88\u606F\u5417\uFF1F")&&(this.ipcService.send("delete-queue-message",{phone:e,messageId:t}),this.toastService.info("\u6B63\u5728\u5220\u9664\u6D88\u606F..."))}updateQueueMessagePriority(e,t,n){let o=n==="HIGH"||n==="NORMAL"||n==="LOW"?n:"NORMAL";this.ipcService.send("update-queue-message-priority",{phone:e,messageId:t,priority:o})}getQueueMessages(e,t,n=100){this.ipcService.send("get-queue-messages",{phone:e,status:t,limit:n})}viewQueueDetails(e){this.selectedQueuePhone.set(e),this.getQueueMessages(e)}closeQueueDetails(){this.selectedQueuePhone.set(null),this.queueMessages.set([])}loadSendingStats(e=7,t){this.ipcService.send("get-sending-stats",{days:e,phone:t})}loadQueueLengthHistory(e=7){this.ipcService.send("get-queue-length-history",{days:e})}loadAccountSendingComparison(e=7){this.ipcService.send("get-account-sending-comparison",{days:e})}loadCampaignPerformanceStats(e=7){this.ipcService.send("get-campaign-performance-stats",{days:e})}onDaysChange(e){this.selectedDays.set(e),this.loadAllAnalytics(e)}loadAllAnalytics(e=7){this.loadSendingStats(e),this.loadQueueLengthHistory(e),this.loadAccountSendingComparison(e),this.loadCampaignPerformanceStats(e)}capturesChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),n=new Date;n.setHours(0,0,0,0);let o=[],a=[];for(let d=t-1;d>=0;d--){let u=new Date(n);u.setDate(n.getDate()-d);let p=u.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(p);let g=e.filter(C=>{let w=new Date(C.timestamp);return w.setHours(0,0,0,0),w.getTime()===u.getTime()}).length;a.push(g)}return{labels:o,datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:a,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]}}conversionsChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),n=new Date;n.setHours(0,0,0,0);let o=[],a=[],d=[];for(let u=t-1;u>=0;u--){let p=new Date(n);p.setDate(n.getDate()-u);let g=p.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(g);let C=e.filter(w=>{let A=new Date(w.timestamp);return A.setHours(0,0,0,0),A.getTime()===p.getTime()});a.push(C.filter(w=>w.status!=="New").length),d.push(C.filter(w=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(w.status)).length)}return{labels:o,datasets:[{label:"\u5DF2\u8054\u7CFB",data:a,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5DF2\u56DE\u590D",data:d,borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",fill:!0}]}}messagesChartData(){return this.sendingStatsData()}funnelChartData(){let e=this.funnelStats();if(!e||!e.stages||Object.keys(e.stages).length===0)return null;let t=this.funnelStages,n=t.map(a=>a.name),o=t.map(a=>{let d=e.stages[a.key];return d?d.count:0});return{labels:n,datasets:[{label:"\u6F0F\u6597\u6570\u636E",data:o,backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(34, 197, 94, 0.8)","rgba(168, 85, 247, 0.8)","rgba(239, 68, 68, 0.8)","rgba(245, 158, 11, 0.8)","rgba(236, 72, 153, 0.8)","rgba(16, 185, 129, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(34, 197, 94)","rgb(168, 85, 247)","rgb(239, 68, 68)","rgb(245, 158, 11)","rgb(236, 72, 153)","rgb(16, 185, 129)","rgb(239, 68, 68)"],borderWidth:1}]}}loadAlerts(e=!1,t){this.ipcService.send("get-alerts",{limit:50,unresolvedOnly:e,level:t})}acknowledgeAlert(e){this.ipcService.send("acknowledge-alert",{alertId:e})}resolveAlert(e){this.ipcService.send("resolve-alert",{alertId:e})}loadAlertHistory(e=30){this.ipcService.send("get-alert-history",{days:e})}loadAlertRules(){this.ipcService.send("get-alert-rules",{})}toggleAlertRule(e){this.ipcService.send("toggle-alert-rule",{ruleId:e})}editAlertRule(e){this.showAddAlertRuleDialog.set(!0)}deleteAlertRule(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u544A\u8B66\u89C4\u5219\u5417\uFF1F")&&this.ipcService.send("delete-alert-rule",{ruleId:e})}async showNotification(e,t,n){"Notification"in window&&(Notification.permission==="granted"?new Notification(e,E({body:t,icon:"/assets/icon.png",badge:"/assets/badge.png",tag:"tg-matrix-notification",requireInteraction:!1},n)):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&this.showNotification(e,t,n))}showBrowserNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification(`\u544A\u8B66: ${e.level.toUpperCase()}`,{body:e.message,icon:"/assets/icon.ico",tag:`alert-${e.id}`,requireInteraction:e.level==="critical"||e.level==="error"})}async requestNotificationPermission(){"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()}formatDate(e){return new Date(e).toLocaleString()}mapLeadFromBackend(e){let t="unknown",n=e.notes||"",o=e.triggered_keyword||e.triggeredKeyword||"";return n.includes("\u89F8\u767C\u8A5E")||o?t="keyword_trigger":e.extracted_by_phone||e.source_chat_id?t="group_extract":(n.includes("\u5C0E\u5165")||n.includes("import"))&&(t="import"),{id:e.id,userId:e.user_id||e.userId||"",username:e.username||"",firstName:e.first_name||e.firstName||"",lastName:e.last_name||e.lastName||"",sourceGroup:e.source_chat_title||e.sourceGroup||e.source_group||"",triggeredKeyword:n||o||"",timestamp:new Date(e.created_at||e.timestamp||e.extracted_at||Date.now()),status:e.status||e.response_status||"New",onlineStatus:e.online_status||e.onlineStatus||"hidden",assignedTemplateId:e.assignedTemplateId||e.assigned_template_id,interactionHistory:e.interactionHistory||e.interaction_history||[],doNotContact:!!e.doNotContact||!!e.do_not_contact,campaignId:e.campaignId||e.campaign_id,intentScore:e.intent_score||e.intentScore||0,intentLevel:e.intent_level||e.intentLevel||"none",sourceType:e.source_type||e.sourceType||t}}syncLeadsToResourceCenter(e){let t=(e||[]).map(n=>this.mapLeadFromBackend(n));this.contactsService.importLeadsDirectly(t),console.log("[Frontend] Synced",t.length,"leads to resource center")}loadRemainingLeads(){if(console.log("[Frontend] loadRemainingLeads called, loading:",this.leadsLoading(),"hasMore:",this.leadsHasMore()),this.leadsLoading()){console.log("[Frontend] \u23F3 Already loading, skipping...");return}let e=this.leads().length,t=this.leadsTotal();if(e>=t&&t>0){console.log("[Frontend] \u2705 All data already loaded:",e,"/",t);return}console.log("[Frontend] \u{1F4E5} Loading remaining leads:",e,"/",t),this.leadsLoading.set(!0),this.ipcService.send("get-leads-paginated",{page:1,pageSize:500,status:null,search:null})}safeFormatDate(e,t="MM/dd HH:mm"){if(!e)return"-";try{let n=e instanceof Date?e:new Date(e);if(isNaN(n.getTime()))return"-";let o=C=>C.toString().padStart(2,"0"),a=o(n.getMonth()+1),d=o(n.getDate()),u=o(n.getHours()),p=o(n.getMinutes()),g=n.getFullYear();return t==="MM/dd HH:mm"?`${a}/${d} ${u}:${p}`:t==="yyyy-MM-dd HH:mm"?`${g}-${a}-${d} ${u}:${p}`:t==="HH:mm:ss"?`${u}:${p}:${o(n.getSeconds())}`:`${a}/${d} ${u}:${p}`}catch{return"-"}}getQueueStatusForAccount(e){return this.queueStatuses()[e]||null}getTotalQueueStats(){let e=this.queueStatuses(),t=0,n=0,o=0,a=0,d=0,u=0;return Object.values(e).forEach(p=>{t+=p.pending,n+=p.processing,o+=p.retrying,a+=p.failed,d+=p.stats.completed,u+=p.stats.failed}),{pending:t,processing:n,retrying:o,failed:a,completed:d,failedCount:u,totalAccounts:Object.keys(e).length}}applyLogFilter(){this.ipcService.send("get-logs",{limit:1e3,type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}resetLogFilter(){this.logFilterType.set(""),this.logFilterStartDate.set(""),this.logFilterEndDate.set(""),this.logFilterSearch.set(""),this.ipcService.send("get-logs",{limit:100})}exportLogs(){this.ipcService.send("export-logs",{type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}onExcelFileSelected(){this.accountLoaderService.loadAccountsFromExcel()}onDownloadTemplate(){this.accountLoaderService.downloadExcelTemplate()}reloadSessionsAndAccounts(){this.accountLoaderService.reloadSessionsAndAccounts()}openQrLogin(){this.dialogService.openQrLogin()}closeQrLogin(){this.dialogService.closeQrLogin()}onQrLoginSuccess(e){this.dialogService.closeQrLogin(),this.toastService.success(`\u5E33\u865F ${e.phone||""} \u5DF2\u6210\u529F\u6DFB\u52A0\uFF01`),this.reloadSessionsAndAccounts()}exportLeads(){if(!this.membershipService.hasFeature("dataExport")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5C0E\u51FA\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.accountLoaderService.exportLeadsToExcel(this.leads())}importSession(){this.ipcService.send("import-session")}exportSession(e){this.ipcService.send("export-session",e)}cleanupSessionFiles(){confirm("\u786E\u5B9A\u8981\u6E05\u7406\u6240\u6709\u5B64\u7ACB\u7684 session \u6587\u4EF6\u5417\uFF1F\u8FD9\u5C06\u5220\u9664\u6240\u6709\u5E26\u65F6\u95F4\u6233\u7684 session \u6587\u4EF6\u548C\u4E0D\u5728\u6570\u636E\u5E93\u4E2D\u7684 session \u6587\u4EF6\u3002")&&(this.ipcService.send("cleanup-session-files"),this.toastService.info("\u6B63\u5728\u6E05\u7406\u5B64\u7ACB\u7684 session \u6587\u4EF6..."))}scanOrphanSessions(){this.toastService.info("\u6B63\u5728\u6383\u63CF\u5B64\u7ACB\u7684 Session \u6587\u4EF6...",2e3),this.ipcService.send("scan-orphan-sessions",{})}recoverOrphanSessions(){let e=this.orphanSessions();if(e.length===0){this.toastService.warning("\u6C92\u6709\u9700\u8981\u6062\u5FA9\u7684 Session \u6587\u4EF6");return}this.isRecoveringOrphanSessions.set(!0),this.toastService.info(`\u6B63\u5728\u6062\u5FA9 ${e.length} \u500B\u5E33\u865F...`,2e3),this.ipcService.send("recover-orphan-sessions",{sessions:e})}dismissOrphanSessionDialog(){this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([])}toggleAllAccountSelection(e){let t=e.target.checked,n=new Set(this.filteredAccounts().map(o=>o.id));this.accounts.update(o=>o.map(a=>n.has(a.id)?P(E({},a),{selected:t}):a))}bulkAssignRole(e){let t=this.selectedAccounts().map(n=>n.id);if(t.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u89D2\u8272...",progress:{current:0,total:t.length},cancellable:!1}),this.simulateBulkOperationProgress(t.length,()=>{this.ipcService.send("bulk-assign-role",{accountIds:t,role:e}),this.toastService.success(`\u5DF2\u4E3A ${t.length} \u4E2A\u8D26\u6237\u5206\u914D\u89D2\u8272`)})}bulkAssignGroup(e){let t=e||window.prompt(this.t("enterGroupName"));if(t){let n=this.selectedAccounts().map(o=>o.id);if(n.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u5206\u7EC4...",progress:{current:0,total:n.length},cancellable:!1}),this.simulateBulkOperationProgress(n.length,()=>{this.ipcService.send("bulk-assign-group",{accountIds:n,group:t}),this.toastService.success(`\u5DF2\u4E3A ${n.length} \u4E2A\u8D26\u6237\u5206\u914D\u5206\u7EC4`)})}}bulkDelete(){let e=this.selectedAccounts().map(t=>t.id);if(e.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u8D26\u6237");return}window.confirm(`\u786E\u5B9A\u8981\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`)&&(this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5220\u9664\u8D26\u6237...",progress:{current:0,total:e.length},cancellable:!1}),this.simulateBulkOperationProgress(e.length,()=>{this.ipcService.send("bulk-delete-accounts",{accountIds:e}),this.toastService.success(`\u5DF2\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237`)}))}simulateBulkOperationProgress(e,t){let n=0,o=setInterval(()=>{n+=Math.max(1,Math.floor(e/20)),n>=e&&(n=e,clearInterval(o),setTimeout(()=>{this.progressDialog.set(P(E({},this.progressDialog()),{show:!1})),t()},300)),this.progressDialog.set(P(E({},this.progressDialog()),{progress:{current:n,total:e,message:`\u5904\u7406\u4E2D ${n}/${e}`}}))},50)}updateAccountRole(e,t){this.ipcService.send("update-account-data",{id:e,updates:{role:t}})}showAddGroupDialog(){this.toastService.info("\u8ACB\u5728\u76E3\u63A7\u7FA4\u7D44\u5340\u584A\u4E2D\u9EDE\u64CA\u300C+ \u6DFB\u52A0\u7FA4\u7D44\u300D")}showAddKeywordSetDialog(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.newKeywordSet.set({name:""}),this.showKeywordSetCreator.set(!0)}submitNewKeywordSet(){let t=this.newKeywordSet().name.trim();t?(console.log("[Frontend] Sending add-keyword-set command:",t),this.ipcService.send("add-keyword-set",{name:t}),this.toastService.success("\u6B63\u5728\u5275\u5EFA\u95DC\u9375\u8A5E\u96C6...",2e3),this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})):this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}cancelNewKeywordSet(){this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})}addKeywordSet(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let n=this.newKeywordSet().name.trim();if(n){if(!n){this.toastService.warning("\u95DC\u9375\u8A5E\u96C6\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A",3e3);return}console.log("[Frontend] Sending add-keyword-set command:",n),this.ipcService.send("add-keyword-set",{name:n})}else this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}handleSaveGroupConfig(e){console.log("[Frontend] Saving group config:",e);let t=this.monitoredGroups().find(n=>n.id===e.groupId);t?(this.ipcService.send("add-group",{url:t.url,keywordSetIds:e.keywordSetIds}),this.toastService.success("\u7FA4\u7D44\u914D\u7F6E\u5DF2\u4FDD\u5B58",2e3)):(console.error("[Frontend] Group not found for config save:",e.groupId),this.toastService.error("\u627E\u4E0D\u5230\u7FA4\u7D44\uFF0C\u7121\u6CD5\u4FDD\u5B58\u914D\u7F6E"))}handleSaveKeywordSetConfig(e){console.log("[Frontend] Saving keyword set config:",e);let n=this.keywordSets().find(a=>a.id===e.setId)?.keywords?.map(a=>a.keyword)||[],o=e.keywords.filter(a=>!n.includes(a));for(let a of o)console.log("[Frontend] Adding keyword:",a,"to set:",e.setId),this.ipcService.send("add-keyword",{setId:e.setId,keyword:a,isRegex:!1});o.length>0?this.toastService.success(`\u5DF2\u6DFB\u52A0 ${o.length} \u500B\u95DC\u9375\u8A5E`,2e3):this.toastService.info("\u6C92\u6709\u65B0\u95DC\u9375\u8A5E\u9700\u8981\u6DFB\u52A0",2e3)}handleExtractMembersFromAutomation(e){console.log("[Frontend] Extract members from automation center:",e);try{let t="";e.groupUrl&&(t=e.groupUrl.replace("@","").replace("https://t.me/","").replace("http://t.me/","").replace("t.me/","").split("/")[0]);let n=this.monitoredGroups().find(d=>d.id===parseInt(e.groupId,10)||d.url===e.groupUrl||d.url===`@${t}`||d.url===t),o=this.discoveredResources().find(d=>d.username===t||d.id===parseInt(e.groupId,10)),a={id:o?.id||parseInt(e.groupId,10)||0,title:e.groupName,username:t,telegram_id:o?.telegram_id||n?.telegram_id||t||e.groupId,member_count:e.memberCount||n?.member_count||0,resource_type:"group"};if(console.log("[Frontend] Opening member list dialog with resource:",a),!a.telegram_id&&!a.username){this.toastService.error("\u7121\u6CD5\u7372\u53D6\u7FA4\u7D44\u4FE1\u606F\uFF0C\u8ACB\u5F9E\u8CC7\u6E90\u767C\u73FE\u9801\u9762\u63D0\u53D6\u6210\u54E1");return}this.currentView.set("resources"),setTimeout(()=>{this.openMemberListDialog(a)},100)}catch(t){console.error("[Frontend] Error opening member list dialog:",t),this.toastService.error("\u6253\u958B\u6210\u54E1\u63D0\u53D6\u5C0D\u8A71\u6846\u5931\u6557")}}addKeyword(){let e=this.newKeyword();if(!e.setId){this.toastService.warning(this.t("selectKeywordSetFirst"),3e3);return}if(!e.keyword.trim()){this.toastService.warning(this.t("keywordEmpty"),3e3);return}if(e.isRegex)try{new RegExp(e.keyword)}catch(u){this.toastService.error(`${this.t("invalidRegex")}: ${u.message}`,4e3);return}let t=e.keyword.trim(),n=this.keywordSets().find(u=>u.id===e.setId);if(!n){this.toastService.error("\u95DC\u9375\u8A5E\u96C6\u4E0D\u5B58\u5728",3e3);return}if(n.keywords.some(u=>u.keyword===t&&u.isRegex===e.isRegex)){this.toastService.warning("\u8A72\u95DC\u9375\u8A5E\u5DF2\u5B58\u5728\u65BC\u6B64\u95DC\u9375\u8A5E\u96C6\u4E2D",3e3);return}let d={id:Date.now(),keyword:t,isRegex:e.isRegex};this.keywordSets.update(u=>u.map(p=>p.id===e.setId?P(E({},p),{keywords:[...p.keywords,d]}):p)),this.newKeyword.set({setId:e.setId,keyword:"",isRegex:!1}),this.testKeywordText.set(""),this.keywordTestResult.set(null),this.ipcService.send("add-keyword",{setId:e.setId,keyword:t,isRegex:e.isRegex}),this.toastService.success(this.t("keywordAdded"),2e3)}onTestTextInput(e){e.target.value.trim()||this.keywordTestResult.set(null)}testKeyword(){let e=this.newKeyword(),t=this.testKeywordText().trim();if(!e.keyword.trim()){this.toastService.warning("\u8ACB\u5148\u8F38\u5165\u95DC\u9375\u8A5E",2e3),this.keywordTestResult.set(null);return}if(!t){this.keywordTestResult.set(null);return}try{let n=!1;if(e.isRegex)try{n=new RegExp(e.keyword,"i").test(t)}catch(o){this.keywordTestResult.set({matches:!1,error:o.message}),this.toastService.error(`${this.t("invalidRegex")}: ${o.message}`,4e3);return}else n=t.toLowerCase().includes(e.keyword.toLowerCase());this.keywordTestResult.set({matches:n})}catch(n){this.keywordTestResult.set({matches:!1,error:n.message}),this.toastService.error(`\u6E2C\u8A66\u5931\u6557: ${n.message}`,3e3)}}removeKeywordFromSet(e,t){let n=this.keywordSets().find(a=>a.id===e),o=n?.keywords.find(a=>a.id===t);n&&o?(this.keywordSets.update(a=>a.map(d=>d.id===e?P(E({},d),{keywords:d.keywords.filter(u=>u.id!==t)}):d)),this.ipcService.send("remove-keyword",{setId:e,keywordId:t}),this.toastService.success("\u95DC\u9375\u8A5E\u5DF2\u522A\u9664",2e3)):this.toastService.warning("\u95DC\u9375\u8A5E\u4E0D\u5B58\u5728",2e3)}addGroup(){let e=this.membershipService.quotas();if(e.maxGroups!==-1&&this.monitoredGroups().length>=e.maxGroups){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxGroups} \u500B\u7FA4\u7D44`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newGroup();t.url.trim()&&(this.monitoredGroups().some(o=>o.url===t.url.trim())&&this.toastService.warning("\u8A72\u7FA4\u7D44\u5DF2\u5B58\u5728\uFF0C\u5C07\u66F4\u65B0\u95DC\u9375\u8A5E\u96C6\u914D\u7F6E",3e3),this.ipcService.send("add-group",{url:t.url.trim(),keywordSetIds:t.keywordSetIds}),this.newGroup.set({url:"",keywordSetIds:[]}))}joinGroup(e){console.log("[Frontend] joinGroup called with:",e),console.log("[Frontend] All accounts:",this.accounts());let t=this.accounts(),n=t.filter(a=>a.role==="Listener"&&a.status==="Online");if(console.log("[Frontend] Listener accounts:",n),n.length===0){let a=t.filter(d=>d.status==="Online");if(console.log("[Frontend] Online accounts (any role):",a),a.length===0){this.toastService.error("\u6C92\u6709\u5728\u7DDA\u7684\u5E33\u865F\uFF0C\u7121\u6CD5\u52A0\u5165\u7FA4\u7D44",3e3);return}n=a,this.toastService.warning("\u6C92\u6709\u76E3\u63A7\u5E33\u865F\uFF0C\u4F7F\u7528\u5176\u4ED6\u5728\u7DDA\u5E33\u865F\u52A0\u5165",3e3)}let o=n[0].phone;console.log("[Frontend] Using phone to join:",o),this.toastService.info(`\u6B63\u5728\u5617\u8A66\u8B93 ${o} \u52A0\u5165\u7FA4\u7D44...`,3e3),this.ipcService.send("join-group",{phone:o,groupUrl:e})}toggleArrayItem(e,t){let n=[...e],o=n.indexOf(t);return o>-1?n.splice(o,1):n.push(t),n}toggleKeywordSetForNewGroup(e){this.newGroup.update(t=>t?P(E({},t),{keywordSetIds:this.toggleArrayItem(t.keywordSetIds||[],e)}):{url:"",keywordSetIds:[e]})}toggleTriggerGroup(e,t){this.campaigns.update(n=>n.map(o=>o.id===e?P(E({},o),{trigger:P(E({},o.trigger),{sourceGroupIds:this.toggleArrayItem(o.trigger.sourceGroupIds,t)})}):o))}toggleTriggerKeywordSet(e,t){this.campaigns.update(n=>n.map(o=>o.id===e?P(E({},o),{trigger:P(E({},o.trigger),{keywordSetIds:this.toggleArrayItem(o.trigger.keywordSetIds,t)})}):o))}toggleNewCampaignSourceGroup(e){this.newCampaign.update(t=>P(E({},t),{trigger:P(E({},t.trigger),{sourceGroupIds:this.toggleArrayItem(t.trigger.sourceGroupIds,e)})}))}toggleNewCampaignKeywordSet(e){this.newCampaign.update(t=>P(E({},t),{trigger:P(E({},t.trigger),{keywordSetIds:this.toggleArrayItem(t.trigger.keywordSetIds,e)})}))}removeById(e,t,n){console.log(`[Frontend] Removing ${n} with id: ${t}`);let o=e();o.find(d=>d.id===t)?(e.set(o.filter(d=>d.id!==t)),console.log(`[Frontend] Optimistically removed ${n} ${t} from local list`),this.toastService.success(`${n==="keyword-set"?"\u95DC\u9375\u8A5E\u96C6":n} \u522A\u9664\u6210\u529F`,2e3)):console.warn(`[Frontend] ${n} ${t} not found in local list`),this.ipcService.send(`remove-${n.replace(" ","-")}`,{id:t})}openLeadDetailModal(e){let t=this.messageTemplates().find(o=>o.id===e.assignedTemplateId);this.generationState.set({status:"idle",lead:e,generatedMessage:"",error:null,customPrompt:t?.prompt||"",attachment:null,attachments:[]}),this.leadDetailView.set("sendMessage"),this.messageMode.set("manual"),this.editableMessage.set("");let n=this.senderAccounts();n.length>0&&!this.selectedSenderId()&&this.selectedSenderId.set(n[0].id)}closeLeadDetailModal(){this.generationState.set({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]}),this.editableMessage.set(""),this.messageMode.set("manual")}startAiChat(e){this.openLeadDetailModal(e),this.messageMode.set("ai"),this.toastService.info(`\u{1F916} \u5DF2\u958B\u555F AI \u804A\u5929\u6A21\u5F0F\uFF0C\u70BA @${e.username||e.userId} \u751F\u6210\u667A\u80FD\u56DE\u8986`)}inviteToGroup(e){if(this.collabGroups().length===0){this.toastService.warning("\u26A0\uFE0F \u8ACB\u5148\u5728\u300C\u591A\u89D2\u8272\u5354\u4F5C\u300D\u4E2D\u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44"),this.currentView.set("multi-role");return}this.selectedLeadForInvite.set(e),this.showInviteGroupDialog.set(!0),this.toastService.info(`\u{1F465} \u9078\u64C7\u8981\u9080\u8ACB @${e.username||e.userId} \u7684\u7FA4\u7D44`)}executeInviteToGroup(e){let t=this.selectedLeadForInvite();t&&(this.ipcService.send("invite-lead-to-collab-group",{leadId:t.id,userId:t.userId,username:t.username,groupId:e}),this.showInviteGroupDialog.set(!1),this.selectedLeadForInvite.set(null),this.toastService.success("\u2713 \u5DF2\u767C\u9001\u9080\u8ACB\u8ACB\u6C42"))}addToDnc(e){this.ipcService.send("add-to-dnc",{leadId:e.id,userId:e.userId}),this.toastService.success(`\u{1F6AB} \u5DF2\u5C07 @${e.username||e.userId} \u52A0\u5165\u9ED1\u540D\u55AE`)}async generateMessage(){let e=this.membershipService.canUseAi();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5 AI \u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState();if(t.lead){this.generationState.update(n=>P(E({},n),{status:"loading",error:null}));try{let n=t.customPrompt;this.spintaxEnabled()&&(n=this.parseSpintax(n));let o=this.aiApiType(),a="";o==="local"||o==="custom"?a=await this.generateWithLocalAI(t.lead,n):o==="openai"?a=await this.generateWithOpenAI(t.lead,n):a=await this.geminiService.generateOutreachMessage(t.lead,n),this.membershipService.recordAiCall(1),this.generationState.update(d=>P(E({},d),{status:"success",generatedMessage:a})),this.editableMessage.set(a)}catch(n){this.generationState.update(o=>P(E({},o),{status:"error",error:n.message}))}}}async generateWithLocalAI(e,t){let n=this.aiApiType()==="local"?this.localAiEndpoint():this.customApiEndpoint(),o=this.localAiModel()||"default";if(!n)throw new Error("\u672C\u5730 AI \u7AEF\u9EDE\u672A\u914D\u7F6E");let a=`\u4F60\u662F\u4E00\u500B\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\u6D88\u606F\u3002
\u898F\u5247\uFF1A
1. \u6D88\u606F\u5FC5\u9808\u7C21\u77ED\uFF0815-40\u5B57\u4EE5\u5167\uFF09
2. \u50CF\u670B\u53CB\u804A\u5929\u4E00\u6A23\u81EA\u7136\uFF0C\u4E0D\u8981\u592A\u6B63\u5F0F
3. \u4E0D\u8981\u4F7F\u7528"\u60A8\u597D"\u7B49\u904E\u65BC\u6B63\u5F0F\u7684\u958B\u982D
4. \u53EF\u4EE5\u7528"\u55E8"\u3001"\u54C8\u56C9"\u3001"hi"\u7B49\u8F15\u9B06\u554F\u5019
5. \u76F4\u63A5\u5207\u5165\u8A71\u984C\uFF0C\u4E0D\u8981\u56C9\u55E6
6. \u8A9E\u6C23\u8F15\u9B06\u53CB\u597D\uFF0C\u50CF\u662F\u5728\u5FAE\u4FE1\u804A\u5929`,d=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\u3002
\u7528\u4E00\u53E5\u8A71\u6253\u500B\u62DB\u547C\uFF0C\u7C21\u77ED\u81EA\u7136\u5C31\u597D\u3002`;return new Promise((u,p)=>{let g=setTimeout(()=>{p(new Error("AI \u751F\u6210\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u670D\u52D9\u9023\u63A5"))},6e4);this.ipcService.once("ai-response",C=>{clearTimeout(g),console.log("[AI] Received ai-response:",C),C?.success&&C?.response?u(C.response):p(new Error(C?.error||"AI \u751F\u6210\u5931\u6557"))}),console.log("[AI] Sending generate-ai-response with endpoint:",n),this.ipcService.send("generate-ai-response",{userId:e.id||e.username,message:d,systemPrompt:a,localAiEndpoint:n,localAiModel:o})})}async generateWithOpenAI(e,t){let n=this.aiApiKey();if(!n)throw new Error("OpenAI API Key \u672A\u914D\u7F6E");let o="\u4F60\u662F\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\uFF0815-40\u5B57\uFF09\uFF0C\u50CF\u670B\u53CB\u804A\u5929\uFF0C\u4E0D\u8981\u6B63\u5F0F\u3002",a=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\uFF0C\u7528\u4E00\u53E5\u8A71\u6253\u62DB\u547C\u3002`,d=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:o},{role:"user",content:a}],max_tokens:500,temperature:.7})});if(!d.ok)throw new Error(`OpenAI API \u932F\u8AA4: ${d.status}`);return(await d.json()).choices?.[0]?.message?.content||"\u751F\u6210\u5931\u6557"}updateCustomPrompt(e){this.generationState.update(t=>P(E({},t),{customPrompt:e}))}applyTemplate(e){let t=e.target,n=parseInt(t.value,10);if(!n)return;let o=this.messageTemplates().find(a=>a.id===n);if(o){let a=o.prompt;this.spintaxEnabled()&&(a=this.parseSpintax(a)),this.editableMessage.set(a)}}isAiConfigured(){let e=this.aiApiType();return e==="local"?!!this.localAiEndpoint():e==="custom"?!!this.customApiEndpoint()&&!!this.aiApiKey():this.geminiService.isConfigured()||!!this.aiApiKey()}canSendMessage(){let e=this.editableMessage().trim().length>0,t=this.generationState(),n=t.attachment!==null||t.attachments.length>0,o=this.selectedSenderId()!==null&&this.senderAccounts().length>0;return(e||n)&&o}sendMessageToLead(){let e=this.membershipService.canSendMessage();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5\u6D88\u606F\u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState(),n=t.lead;if(!n)return;let o=this.editableMessage().trim(),a=t.attachment!==null;if(!o&&!a){this.toastService.error(this.t("messageRequired"),3e3);return}let d=this.selectedSenderId();if(!d){this.toastService.error(this.t("selectSenderFirst"),3e3);return}let u=this.accounts().find(g=>g.id===d);if(!u){this.toastService.error(this.t("senderAccountNotFound"),3e3);return}let p=t.attachments.length>0?t.attachments:t.attachment?[t.attachment]:[];p.length===0?this.ipcService.send("send-message",{leadId:n.id,accountPhone:u.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:o,attachment:null}):p.length===1?this.ipcService.send("send-message",{leadId:n.id,accountPhone:u.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:o,attachment:p[0]}):p.forEach((g,C)=>{this.ipcService.send("send-message",{leadId:n.id,accountPhone:u.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:C===0?o:"",attachment:g})}),this.membershipService.recordMessageSent(1),this.toastService.success(this.t("messageQueued"),2e3),this.closeLeadDetailModal()}sendMessage(){this.sendMessageToLead()}onFileAttached(e,t){let n=e.target;if(!n.files?.length)return;let o=n.files[0];o.size>10*1024*1024&&this.toastService.warning("\u5927\u6587\u4EF6\u5EFA\u8B70\u4F7F\u7528\u300C\u9078\u64C7\u6587\u4EF6\u300D\u6309\u9215\u4E0A\u50B3",3e3);let a=new FileReader;a.onload=()=>{let d={name:o.name,type:t,dataUrl:a.result,fileSize:o.size};this.generationState.update(u=>P(E({},u),{attachment:d}))},a.readAsDataURL(o),n.value=""}async selectAttachment(e,t=!1){let n=await this.ipcService.selectFileForAttachment(e,t);if(!n.success){n.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}if(t&&n.files){let o=n.files.map(u=>({name:u.fileName,type:u.fileType,filePath:u.filePath,fileSize:u.fileSize}));this.generationState.update(u=>P(E({},u),{attachments:[...u.attachments,...o],attachment:o[0]}));let d=(o.reduce((u,p)=>u+(p.fileSize||0),0)/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7 ${o.length} \u500B\u6587\u4EF6 (\u5171 ${d} MB)`,2e3)}else{let o={name:n.fileName,type:n.fileType,filePath:n.filePath,fileSize:n.fileSize};this.generationState.update(d=>P(E({},d),{attachment:o,attachments:[o]}));let a=(n.fileSize/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7: ${n.fileName} (${a} MB)`,2e3)}}async addMoreAttachments(e){let t=await this.ipcService.selectFileForAttachment(e,!0);if(!t.success||!t.files){t.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}let n=t.files.map(o=>({name:o.fileName,type:o.fileType,filePath:o.filePath,fileSize:o.fileSize}));this.generationState.update(o=>P(E({},o),{attachments:[...o.attachments,...n],attachment:o.attachment||n[0]})),this.toastService.success(`\u5DF2\u6DFB\u52A0 ${n.length} \u500B\u6587\u4EF6`,2e3)}removeAttachmentByIndex(e){this.generationState.update(t=>{let n=t.attachments.filter((o,a)=>a!==e);return P(E({},t),{attachments:n,attachment:n.length>0?n[0]:null})})}clearAllAttachments(){this.generationState.update(e=>P(E({},e),{attachments:[],attachment:null}))}getTotalAttachmentSize(){return(this.generationState().attachments.reduce((n,o)=>n+(o.fileSize||0),0)/1024/1024).toFixed(2)}removeAttachment(){this.clearAllAttachments()}parseSpintax(e){let t=/\{([^{}]+)\}/g;for(;t.test(e);)e=e.replace(t,(n,o)=>{let a=o.split("|");return a[Math.floor(Math.random()*a.length)]});return e}addInteractionHistory(e,t,n,o){let a={id:Date.now(),timestamp:new Date,type:t,content:n};if(o&&o.id===e){o.interactionHistory.unshift(a);return}this.leads.update(d=>d.map(u=>u.id===e?P(E({},u),{interactionHistory:[a,...u.interactionHistory]}):u))}updateLeadStatus(e,t,n=!0){this.ipcService.send("update-lead-status",{leadId:e,newStatus:t})}toggleLeadMenu(e){this.openLeadMenuId()===e?this.openLeadMenuId.set(null):this.openLeadMenuId.set(e)}closeLeadMenu(){this.openLeadMenuId.set(null)}addToDoNotContact(e){let t=this.leads().find(n=>n.id===e);t&&(this.ipcService.send("add-to-dnc",{userId:t.userId}),this.closeLeadDetailModal())}toggleLeadSelection(e){this.selectedLeadIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}),this.isSelectAllLeads.set(this.selectedLeadIds().size===this.leads().length)}toggleSelectAllLeads(){if(this.isSelectAllLeads())this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1);else{let e=this.leads(),t=new Set(e.map(n=>n.id));this.selectedLeadIds.set(t),this.isSelectAllLeads.set(!0),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}}clearLeadSelection(){this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1),this.showBatchOperationMenu.set(!1)}isLeadSelected(e){return this.selectedLeadIds().has(e)}selectAllFilteredLeads(){let e=this.filteredLeads(),t=new Set(e.map(n=>n.id));this.selectedLeadIds.set(t),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}confirmDeleteLead(e){this.deleteConfirmDialog.set({show:!0,type:"single",lead:e})}confirmBatchDeleteLeads(){let e=this.selectedLeadsCount();if(e===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u522A\u9664\u7684\u5BA2\u6236");return}this.deleteConfirmDialog.set({show:!0,type:"batch",count:e})}executeDeleteLeads(){let e=this.deleteConfirmDialog();if(this.deleteConfirmDialog.set({show:!1,type:"single"}),e.type==="single"&&e.lead)this.ipcService.send("delete-lead",{leadId:e.lead.id}),this.leads.update(t=>t.filter(n=>n.id!==e.lead.id)),this.toastService.success(`\u5DF2\u522A\u9664\u5BA2\u6236 @${e.lead.username||e.lead.userId}`);else if(e.type==="batch"){let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u6C92\u6709\u9078\u4E2D\u7684\u5BA2\u6236");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-delete-leads",{leadIds:t}),this.leads.update(n=>n.filter(o=>!this.selectedLeadIds().has(o.id))),this.toastService.success(`\u6B63\u5728\u522A\u9664 ${t.length} \u500B\u5BA2\u6236...`),this.clearLeadSelection()}}cancelDeleteLeads(){this.deleteConfirmDialog.set({show:!1,type:"single"})}exportSelectedLeads(){let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u5C0E\u51FA\u7684\u5BA2\u6236");return}let t=this.leads().filter(g=>e.includes(g.id)),n=["ID","\u7528\u6236\u540D","\u59D3\u540D","\u72C0\u614B","\u4F86\u6E90","\u95DC\u9375\u8A5E","\u6642\u9593"],o=t.map(g=>[g.userId,g.username||"",`${g.firstName||""} ${g.lastName||""}`.trim(),g.status,g.sourceGroup,g.triggeredKeyword,new Date(g.timestamp).toLocaleString()]),a=[n.join(","),...o.map(g=>g.join(","))].join(`
`),d=new Blob(["\uFEFF"+a],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(d),p=document.createElement("a");p.href=u,p.download=`leads_export_${new Date().toISOString().slice(0,10)}.csv`,p.click(),URL.revokeObjectURL(u),this.toastService.success(`\u5DF2\u5C0E\u51FA ${t.length} \u500B\u5BA2\u6236`)}batchUpdateLeadStatus(e){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-lead-status",{leadIds:t,newStatus:e})}batchAddTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}if(!e||!e.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.batchOperationInProgress.set(!0),this.showBatchTagSelector.set(!1),this.ipcService.send("batch-add-tag",{leadIds:t,tag:e.trim()})}batchRemoveTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.ipcService.send("batch-remove-tag",{leadIds:t,tag:e})}batchAddToDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}confirm(`\u78BA\u5B9A\u8981\u5C07 ${e.length} \u500B Lead \u6DFB\u52A0\u5230 DNC \u5217\u8868\u55CE\uFF1F`)&&(this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-add-to-dnc",{leadIds:e}))}batchRemoveFromDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-remove-from-dnc",{leadIds:e})}batchUpdateFunnelStage(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-funnel-stage",{leadIds:t,newStage:e})}batchDeleteLeads(){if(!this.checkBatchOperationPermission())return;if(Array.from(this.selectedLeadIds()).length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.confirmBatchDeleteLeads()}undoBatchOperation(e){confirm("\u78BA\u5B9A\u8981\u64A4\u92B7\u6B64\u64CD\u4F5C\u55CE\uFF1F")&&this.ipcService.send("undo-batch-operation",{operationId:e})}loadBatchOperationHistory(){this.ipcService.send("get-batch-operation-history",{limit:50,offset:0}),this.showBatchOperationHistory.set(!0)}openBatchOperationMenu(){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u9EDE\u64CA\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),this.showLeadsActionMenu.set(!1);return}this.showBatchOperationMenu.set(!this.showBatchOperationMenu()),this.loadAllTags(),this.showLeadsActionMenu.set(!1)}loadAllTags(){this.ipcService.send("get-all-tags",{})}createTag(){let e=this.newTagName().trim();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.ipcService.send("create-tag",{name:e,color:this.newTagColor()}),this.newTagName.set(""),this.showAddTagDialog.set(!1)}deleteTag(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A19\u7C64 "${e}" \u55CE\uFF1F\u6B64\u6A19\u7C64\u5C07\u5F9E\u6240\u6709 Lead \u4E2D\u79FB\u9664\u3002`)&&this.ipcService.send("delete-tag",{name:e})}onLeadSearchInput(){this.leadSearchTimeout&&clearTimeout(this.leadSearchTimeout);let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.leadSearchTimeout=setTimeout(()=>{this.searchLeads()},500)}searchLeads(){let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.isSearchingLeads.set(!0),this.ipcService.send("search-leads",{query:e,limit:100})}clearLeadSearch(){this.leadSearchQuery.set(""),this.leadSearchResults.set([]),this.leadSearchTimeout&&(clearTimeout(this.leadSearchTimeout),this.leadSearchTimeout=null)}createBackup(){this.isCreatingBackup.set(!0),this.ipcService.send("create-backup",{name:`backup_${new Date().toISOString().replace(/[:.]/g,"-")}`,description:"Manual backup"})}loadBackups(){this.ipcService.send("list-backups",{})}restoreBackup(e){confirm("\u786E\u5B9A\u8981\u6062\u590D\u6B64\u5907\u4EFD\u5417\uFF1F\u5F53\u524D\u6570\u636E\u5C06\u88AB\u8986\u76D6\uFF01")&&(this.isRestoringBackup.set(!0),this.ipcService.send("restore-backup",{backupId:e}))}deleteBackup(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5907\u4EFD\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF01")&&this.ipcService.send("delete-backup",{backupId:e})}handleBatchOperationResult(e){if(this.batchOperationInProgress.set(!1),e.success){let t=e.successCount||0,n=e.failureCount||0;n>0?this.toastService.warning(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u6210\u529F, ${n} \u5931\u6557`):this.toastService.success(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u9805\u5DF2\u8655\u7406`),this.clearLeadSelection(),this.ipcService.send("get-initial-state",{})}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationProgress(e){this.progressDialog.set({show:!0,title:"\u6279\u91CF\u64CD\u4F5C\u9032\u884C\u4E2D...",progress:{current:e.current,total:e.total,message:e.message},cancellable:!1}),e.current>=e.total&&setTimeout(()=>{this.progressDialog.update(t=>P(E({},t),{show:!1}))},500)}handleBatchUndoResult(e){e.success?(this.toastService.success("\u64CD\u4F5C\u5DF2\u64A4\u92B7"),this.ipcService.send("get-initial-state",{}),this.loadBatchOperationHistory()):this.toastService.error(`\u64A4\u92B7\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationHistory(e){e.success&&this.batchOperationHistory.set(e.operations||[])}handleAllTags(e){e.success&&this.allTags.set(e.tags||[])}handleTagCreated(e){e.success?(this.toastService.success("\u6A19\u7C64\u5275\u5EFA\u6210\u529F"),this.loadAllTags()):this.toastService.error(`\u5275\u5EFA\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleTagDeleted(e){e.success?(this.toastService.success("\u6A19\u7C64\u5DF2\u522A\u9664"),this.loadAllTags()):this.toastService.error(`\u522A\u9664\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}getOperationTypeName(e){return{update_status:"\u66F4\u65B0\u72C0\u614B",add_tag:"\u6DFB\u52A0\u6A19\u7C64",remove_tag:"\u79FB\u9664\u6A19\u7C64",add_to_dnc:"\u6DFB\u52A0\u5230 DNC",remove_from_dnc:"\u5F9E DNC \u79FB\u9664",update_funnel_stage:"\u66F4\u65B0\u6F0F\u6597\u968E\u6BB5",delete:"\u522A\u9664"}[e]||e}formatBatchOperationDate(e){return new Date(e).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}loadAdTemplates(){this.ipcService.send("get-ad-templates",{activeOnly:!1})}loadAdSchedules(){this.ipcService.send("get-ad-schedules",{activeOnly:!1})}loadAdSendLogs(){this.ipcService.send("get-ad-send-logs",{limit:100})}loadAdOverviewStats(){this.ipcService.send("get-ad-overview-stats",{days:7})}loadAdSystemData(){this.loadAdTemplates(),this.loadAdSchedules(),this.loadAdOverviewStats()}createAdTemplate(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdTemplate();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31");return}if(!e.content.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9");return}this.ipcService.send("create-ad-template",{name:e.name,content:e.content,mediaType:e.mediaType}),this.newAdTemplate.set({name:"",content:"",mediaType:"text"}),this.showAdTemplateForm.set(!1)}deleteAdTemplate(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u6A21\u677F\u55CE\uFF1F")&&this.ipcService.send("delete-ad-template",{templateId:e})}toggleAdTemplateStatus(e){this.ipcService.send("toggle-ad-template-status",{templateId:e})}previewSpintax(e){if(!e.trim()){this.spintaxPreview.set([]);return}this.isPreviewingSpintax.set(!0),this.ipcService.send("validate-spintax",{content:e})}createAdSchedule(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdSchedule();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u8A08\u5283\u540D\u7A31");return}if(!e.templateId){this.toastService.warning("\u8ACB\u9078\u64C7\u5EE3\u544A\u6A21\u677F");return}if(e.targetGroups.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u76EE\u6A19\u7FA4\u7D44");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.ipcService.send("create-ad-schedule",e),this.newAdSchedule.set({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]}),this.showAdScheduleForm.set(!1)}deleteAdSchedule(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u8A08\u5283\u55CE\uFF1F")&&this.ipcService.send("delete-ad-schedule",{scheduleId:e})}toggleAdScheduleStatus(e){this.ipcService.send("toggle-ad-schedule-status",{scheduleId:e})}runAdScheduleNow(e){confirm("\u78BA\u5B9A\u8981\u7ACB\u5373\u57F7\u884C\u6B64\u8A08\u5283\u55CE\uFF1F")&&(this.ipcService.send("run-ad-schedule-now",{scheduleId:e}),this.toastService.info("\u6B63\u5728\u57F7\u884C..."))}getSendModeLabel(e){return{scheduled:"\u5B9A\u6642\u767C\u9001",triggered:"\u95DC\u9375\u8A5E\u89F8\u767C",relay:"\u63A5\u529B\u767C\u9001",interval:"\u9593\u9694\u5FAA\u74B0"}[e]||e}getScheduleTypeLabel(e){return{once:"\u4E00\u6B21\u6027",daily:"\u6BCF\u65E5",interval:"\u9593\u9694",cron:"Cron"}[e]||e}getAccountStrategyLabel(e){return{single:"\u55AE\u4E00\u5E33\u865F",rotate:"\u8F2A\u63DB\u5E33\u865F",relay:"\u63A5\u529B\u767C\u9001",random:"\u96A8\u6A5F\u9078\u64C7"}[e]||e}getAdStatusColor(e){return{sent:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",deleted:"bg-yellow-500/20 text-yellow-400",banned:"bg-red-600/20 text-red-500"}[e]||"bg-slate-500/20 text-slate-400"}toggleAccountForSchedule(e){this.newAdSchedule.update(t=>{let n=[...t.assignedAccounts],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),P(E({},t),{assignedAccounts:n})})}updateScheduleTargetGroups(e){let t=e.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);this.newAdSchedule.update(n=>P(E({},n),{targetGroups:t}))}handleAdTemplates(e){e.success&&this.adTemplates.set(e.templates||[])}handleAdSchedules(e){e.success&&this.adSchedules.set(e.schedules||[])}handleAdSendLogs(e){e.success&&this.adSendLogs.set(e.logs||[])}handleAdOverviewStats(e){e.success&&this.adOverviewStats.set(e.overview||null)}handleAdTemplateCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u5275\u5EFA"),this.loadAdTemplates()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdTemplateDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u522A\u9664"),this.loadAdTemplates())}handleAdScheduleCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u5275\u5EFA"),this.loadAdSchedules()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdScheduleDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u522A\u9664"),this.loadAdSchedules())}handleSpintaxValidated(e){this.isPreviewingSpintax.set(!1),e.success||e.valid?this.spintaxPreview.set(e.variants||[]):(this.toastService.error(`Spintax \u8A9E\u6CD5\u932F\u8AA4: ${e.error}`),this.spintaxPreview.set([]))}handleAdScheduleRunResult(e){e.success?(this.toastService.success(`\u8A08\u5283\u57F7\u884C\u5B8C\u6210: ${e.sent||0} \u6210\u529F, ${e.failed||0} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()):this.toastService.error(`\u57F7\u884C\u5931\u6557: ${e.error}`)}loadTrackedUsers(){this.ipcService.send("get-tracked-users",{limit:100,valueLevel:this.userValueFilter()||void 0})}loadTrackingStats(){this.ipcService.send("get-tracking-stats",{})}loadHighValueGroups(){this.ipcService.send("get-high-value-groups",{limit:50})}loadUserTrackingData(){this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups()}addUserToTrack(){let e=this.newTrackedUser();if(!e.userId.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u7528\u6236 ID");return}this.ipcService.send("add-user-to-track",{userId:e.userId.trim(),username:e.username.trim()||void 0,notes:e.notes.trim()||void 0,source:"manual"}),this.newTrackedUser.set({userId:"",username:"",notes:""}),this.showAddUserForm.set(!1)}addLeadToTracking(e){this.ipcService.send("add-user-from-lead",{leadId:e})}removeTrackedUser(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u7528\u6236\u8FFD\u8E64\u55CE\uFF1F")&&this.ipcService.send("remove-tracked-user",{userId:e})}trackUserGroups(e){let t=this.accounts().filter(n=>n.status==="Online");if(t.length===0){this.toastService.warning("\u6C92\u6709\u5728\u7DDA\u5E33\u865F\u53EF\u7528\u65BC\u8FFD\u8E64");return}this.isTrackingUser.set(!0),this.ipcService.send("track-user-groups",{userId:e,accountPhone:t[0].phone})}viewUserGroups(e){this.selectedTrackedUser.set(e),this.ipcService.send("get-user-groups",{userId:e.userId})}updateUserValueLevel(e,t){this.ipcService.send("update-user-value-level",{userId:e,valueLevel:t})}getValueLevelLabel(e){return{vip:"VIP",high:"\u9AD8\u50F9\u503C",medium:"\u4E2D\u7B49",low:"\u4F4E"}[e]||e}getValueLevelColor(e){return{vip:"bg-purple-500/20 text-purple-400 border-purple-500/30",high:"bg-orange-500/20 text-orange-400 border-orange-500/30",medium:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",low:"bg-slate-500/20 text-slate-400 border-slate-500/30"}[e]||"bg-slate-500/20 text-slate-400"}getTrackingStatusLabel(e){return{pending:"\u5F85\u8FFD\u8E64",tracking:"\u8FFD\u8E64\u4E2D",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getTrackingStatusColor(e){return{pending:"bg-yellow-500/20 text-yellow-400",tracking:"bg-blue-500/20 text-blue-400",completed:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}handleTrackedUsers(e){e.success&&this.trackedUsers.set(e.users||[])}handleUserGroups(e){e.success&&this.userGroups.set(e.groups||[])}handleHighValueGroups(e){e.success&&this.highValueGroups.set(e.groups||[])}handleTrackingStats(e){e.success&&this.trackingStats.set(e.stats||null)}handleUserAddedToTrack(e){e.success?(this.toastService.success("\u7528\u6236\u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"),this.loadTrackedUsers()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}handleUserRemoved(e){e.success&&(this.toastService.success("\u7528\u6236\u5DF2\u79FB\u9664"),this.loadTrackedUsers())}handleUserTrackingCompleted(e){this.isTrackingUser.set(!1),e.success&&(this.toastService.success(`\u8FFD\u8E64\u5B8C\u6210: \u767C\u73FE ${e.groupsFound} \u500B\u7FA4\u7D44, ${e.highValueGroups} \u500B\u9AD8\u50F9\u503C`),this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups())}handleUserTrackingFailed(e){this.isTrackingUser.set(!1),this.toastService.error(`\u8FFD\u8E64\u5931\u6557: ${e.error}`),this.loadTrackedUsers()}loadCampaigns(){this.ipcService.send("get-campaigns",{limit:50})}loadUnifiedOverview(){this.ipcService.send("get-unified-overview",{days:7})}loadFunnelAnalysis(){this.ipcService.send("get-funnel-analysis",{})}loadCampaignData(){this.loadCampaigns(),this.loadUnifiedOverview(),this.loadFunnelAnalysis()}createCampaignFromForm(){if(!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.campaignFormData();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}this.ipcService.send("create-campaign",{name:e.name,description:e.description,phases:e.phases,keywords:e.keywords,targetGroups:e.targetGroups,assignedAccounts:e.assignedAccounts}),this.campaignFormData.set({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]}),this.showCampaignForm.set(!1)}startCampaign(e){confirm("\u78BA\u5B9A\u8981\u555F\u52D5\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("start-campaign",{campaignId:e})}pauseCampaign(e){this.ipcService.send("pause-campaign",{campaignId:e})}resumeCampaign(e){this.ipcService.send("resume-campaign",{campaignId:e})}stopCampaign(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("stop-campaign",{campaignId:e})}deleteCampaign(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("delete-campaign",{campaignId:e})}viewCampaignDetails(e){this.selectedCampaign.set(e),this.ipcService.send("get-campaign-logs",{campaignId:e.id})}getCampaignStatusLabel(e){return{draft:"\u8349\u7A3F",scheduled:"\u5DF2\u6392\u7A0B",running:"\u904B\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getCampaignStatusColor(e){return{draft:"bg-slate-500/20 text-slate-400",scheduled:"bg-blue-500/20 text-blue-400",running:"bg-green-500/20 text-green-400",paused:"bg-yellow-500/20 text-yellow-400",completed:"bg-cyan-500/20 text-cyan-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}getPhaseLabel(e){return{discovery:"\u8CC7\u6E90\u767C\u73FE",monitoring:"\u76E3\u63A7\u7372\u5BA2",outreach:"\u5EE3\u544A\u89F8\u9054",tracking:"\u7528\u6236\u8FFD\u8E64",conversion:"\u8F49\u5316\u6210\u4EA4"}[e]||e}toggleCampaignPhase(e){this.campaignFormData.update(t=>{let n=[...t.phases],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),P(E({},t),{phases:n})})}addCampaignKeyword(){let e=this.campaignKeywordInput().trim();e&&(this.campaignFormData.update(t=>P(E({},t),{keywords:[...t.keywords,e]})),this.campaignKeywordInput.set(""))}removeCampaignKeyword(e){this.campaignFormData.update(t=>P(E({},t),{keywords:t.keywords.filter(n=>n!==e)}))}toggleCampaignAccount(e){this.campaignFormData.update(t=>{let n=[...t.assignedAccounts],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),P(E({},t),{assignedAccounts:n})})}handleCampaigns(e){e.success&&this.campaigns.set(e.campaigns||[])}handleCampaignCreated(e){e.success?(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.loadCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleCampaignDeleted(e){e.success&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u522A\u9664"),this.loadCampaigns())}handleUnifiedOverview(e){e.success&&this.unifiedOverview.set(e)}handleFunnelAnalysis(e){e.success&&this.funnelAnalysis.set(e)}loadRoleTemplates(){this.ipcService.send("get-role-templates",{})}loadAllRoles(){this.ipcService.send("get-all-roles",{activeOnly:!0})}loadScriptTemplates(){this.ipcService.send("get-script-templates",{activeOnly:!0})}loadCollabGroups(){this.ipcService.send("get-collab-groups",{limit:50})}loadCollabStats(){this.ipcService.send("get-collab-stats",{})}loadRoleStats(){this.ipcService.send("get-role-stats",{})}loadMultiRoleData(){this.loadRoleTemplates(),this.loadAllRoles(),this.loadScriptTemplates(),this.loadCollabGroups(),this.loadCollabStats(),this.loadRoleStats()}assignRole(){let e=this.newRoleAssign();if(!e.accountPhone){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}if(!e.roleName.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31");return}this.ipcService.send("assign-role",{accountPhone:e.accountPhone,roleType:e.roleType,roleName:e.roleName}),this.newRoleAssign.set({accountPhone:"",roleType:"seller",roleName:""}),this.showRoleAssignForm.set(!1)}removeRole(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u89D2\u8272\u55CE\uFF1F")&&this.ipcService.send("remove-role",{roleId:e})}getRoleIcon(e){return{seller:"\u{1F9D1}\u200D\u{1F4BC}",expert:"\u{1F468}\u200D\u{1F52C}",satisfied:"\u{1F60A}",hesitant:"\u{1F914}",converted:"\u{1F389}",curious:"\u2753",manager:"\u{1F454}",support:"\u{1F6E0}\uFE0F"}[e]||"\u{1F464}"}getRoleLabel(e){return{seller:"\u92B7\u552E\u9867\u554F",expert:"\u5C08\u696D\u9867\u554F",satisfied:"\u6EFF\u610F\u5BA2\u6236",hesitant:"\u7336\u8C6B\u5BA2\u6236",converted:"\u6210\u4EA4\u5BA2\u6236",curious:"\u597D\u5947\u8005",manager:"\u7D93\u7406\u4E3B\u7BA1",support:"\u552E\u5F8C\u5BA2\u670D"}[e]||e}getScenarioLabel(e){return{group_conversion:"\u7FA4\u804A\u8F49\u5316",private_followup:"\u79C1\u804A\u8DDF\u9032",objection_handling:"\u7570\u8B70\u8655\u7406",product_intro:"\u7522\u54C1\u4ECB\u7D39",trust_building:"\u5EFA\u7ACB\u4FE1\u4EFB",urgency_creation:"\u88FD\u9020\u7DCA\u8FEB\u611F",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}getCollabStatusLabel(e){return{warming:"\u9810\u71B1\u4E2D",active:"\u6D3B\u8E8D\u4E2D",completed:"\u5DF2\u5B8C\u6210",archived:"\u5DF2\u6B78\u6A94"}[e]||e}getCollabStatusColor(e){return{warming:"bg-yellow-500/20 text-yellow-400",active:"bg-green-500/20 text-green-400",completed:"bg-blue-500/20 text-blue-400",archived:"bg-slate-500/20 text-slate-400"}[e]||"bg-slate-500/20 text-slate-400"}handleRoleTemplates(e){e.success&&this.roleTemplates.set(e.templates||{})}handleAllRoles(e){e.success&&this.allRoles.set(e.roles||[])}handleScriptTemplates(e){e.success&&this.scriptTemplates.set(e.templates||[])}handleCollabGroups(e){e.success&&this.collabGroups.set(e.groups||[])}handleCollabStats(e){e.success&&this.collabStats.set(e)}handleRoleStats(e){e.success&&this.roleStats.set(e)}updateAdTemplateName(e){this.newAdTemplate.update(t=>P(E({},t),{name:e}))}updateAdTemplateContent(e){this.newAdTemplate.update(t=>P(E({},t),{content:e}))}updateAdTemplateMediaType(e){this.newAdTemplate.update(t=>P(E({},t),{mediaType:e}))}updateAdScheduleName(e){this.newAdSchedule.update(t=>P(E({},t),{name:e}))}updateAdScheduleTemplateId(e){this.newAdSchedule.update(t=>P(E({},t),{templateId:e}))}updateAdScheduleSendMode(e){this.newAdSchedule.update(t=>P(E({},t),{sendMode:e}))}updateAdScheduleType(e){this.newAdSchedule.update(t=>P(E({},t),{scheduleType:e}))}updateAdScheduleTime(e){this.newAdSchedule.update(t=>P(E({},t),{scheduleTime:e}))}updateAdScheduleInterval(e){this.newAdSchedule.update(t=>P(E({},t),{intervalMinutes:e}))}updateAdScheduleStrategy(e){this.newAdSchedule.update(t=>P(E({},t),{accountStrategy:e}))}updateTrackedUserId(e){this.newTrackedUser.update(t=>P(E({},t),{userId:e}))}updateTrackedUserName(e){this.newTrackedUser.update(t=>P(E({},t),{username:e}))}updateTrackedUserNotes(e){this.newTrackedUser.update(t=>P(E({},t),{notes:e}))}updateCampaignFormName(e){this.campaignFormData.update(t=>P(E({},t),{name:e}))}updateCampaignFormDesc(e){this.campaignFormData.update(t=>P(E({},t),{description:e}))}updateRoleAssignPhone(e){this.newRoleAssign.update(t=>P(E({},t),{accountPhone:e}))}updateRoleAssignType(e){this.newRoleAssign.update(t=>P(E({},t),{roleType:e}))}updateRoleAssignName(e){this.newRoleAssign.update(t=>P(E({},t),{roleName:e}))}getRolesOfType(e){return this.allRoles().filter(t=>t.roleType===e)}addTemplate(){let e=this.newTemplate();e.name.trim()&&e.prompt.trim()?(this.ipcService.send("add-template",{name:e.name,prompt:e.prompt}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F")):this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}addTemplateQuick(e,t){if(e?.trim()&&t?.trim()){if(this.messageTemplates().some(o=>o.name===e.trim())){this.toastService.warning("\u6A21\u677F\u540D\u7A31\u5DF2\u5B58\u5728\uFF0C\u7121\u6CD5\u5275\u5EFA\u91CD\u8907\u6A21\u677F",3e3);return}this.ipcService.send("add-template",{name:e.trim(),prompt:t.trim()}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F"),this.messageTemplates().length>0&&this.showTemplateCreator.set(!1)}else this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}updateTemplateName(e){this.newTemplate.update(t=>P(E({},t),{name:e}))}updateTemplatePrompt(e){this.newTemplate.update(t=>P(E({},t),{prompt:e}))}insertTemplateVariable(e,t){let n=e.selectionStart,o=e.selectionEnd,a=e.value,d=a.substring(0,n)+t+a.substring(o);e.value=d,this.updateTemplatePrompt(d),setTimeout(()=>{e.focus(),e.selectionStart=e.selectionEnd=n+t.length},0)}toggleTemplateStatus(e){this.ipcService.send("toggle-template-status",{id:e})}removeTemplate(e){let t=this.messageTemplates().find(o=>o.id===e);if(!t)return;let n=this.campaigns().filter(o=>o.actions.some(a=>a.templateId===e));if(n.length>0){let o=n.map(a=>a.name).join(", ");if(!confirm(`\u6A21\u677F "${t.name}" \u6B63\u5728\u88AB\u4EE5\u4E0B\u6D3B\u52D5\u4F7F\u7528\uFF1A${o}

\u522A\u9664\u6A21\u677F\u5F8C\uFF0C\u9019\u4E9B\u6D3B\u52D5\u5C07\u7121\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002

\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F`))return}else if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F "${t.name}" \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002`))return;this.ipcService.send("remove-template",{id:e}),this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664")}getTemplateName(e){return e?this.messageTemplates().find(t=>t.id===e)?.name||"Unknown Template":"N/A"}getKeywordSetName(e){return this.keywordSets().find(t=>t.id===e)?.name||"Unknown Set"}getGroupName(e){return this.monitoredGroups().find(t=>t.id===e)?.name||"Unknown Group"}getCampaignName(e){return e?this.campaigns().find(t=>t.id===e)?.name||"Unknown Campaign":"N/A"}getCampaignById(e){if(e!==void 0)return this.campaigns().find(t=>t.id===e)}getEmptyCampaignForm(){return{name:"",trigger:{sourceGroupIds:[],keywordSetIds:[]},action:{templateId:0,minDelaySeconds:30,maxDelaySeconds:120}}}addCampaign(){if(this.isSubmittingCampaign()){this.toastService.warning("\u6B63\u5728\u5275\u5EFA\u6D3B\u52D5\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.newCampaign(),t=[];if(e.name?.trim()||t.push("\u6D3B\u52A8\u540D\u79F0"),(!e.action.templateId||e.action.templateId===0)&&t.push("\u6D88\u606F\u6A21\u677F"),e.trigger.sourceGroupIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6765\u6E90\u7FA4\u7EC4"),e.trigger.keywordSetIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5173\u952E\u8BCD\u96C6"),t.length>0){this.toastService.error(`\u8BF7\u5B8C\u5584\u4EE5\u4E0B\u5185\u5BB9: ${t.join(", ")}`);return}let n=e.name.trim();if(this.campaigns().find(a=>a.name===n)){this.toastService.warning(`\u6D3B\u52D5 "${n}" \u5DF2\u5B58\u5728\uFF0C\u8ACB\u4F7F\u7528\u4E0D\u540C\u7684\u540D\u7A31`,4e3);return}this.isSubmittingCampaign.set(!0),this.newCampaign.set(this.getEmptyCampaignForm()),this.ipcService.send("add-campaign",E({},e)),setTimeout(()=>{this.isSubmittingCampaign.set(!1)},3e3)}toggleCampaignStatus(e){this.ipcService.send("toggle-campaign-status",{id:e})}getLogColor(e){switch(e){case"info":return"text-cyan-400";case"success":return"text-green-400";case"warning":return"text-yellow-400";case"error":return"text-red-400";default:return"text-slate-400"}}formatTimestamp(e){if(!e)return"";try{let t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString()+" "+t.toLocaleTimeString()}catch{return""}}async loadChatList(){try{let e=this.chatListSearch(),t=this.chatListFunnelFilter();this.ipcService.send("get-chat-list",{limit:50,offset:0,search:e||void 0,funnelStage:t||void 0})}catch(e){console.error("[Frontend] Error loading chat list:",e)}}onChatListSearchChange(e){this.chatListSearch.set(e),this.chatListSearchDebounceTimer&&clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=setTimeout(()=>{this.loadChatList(),this.chatListSearchDebounceTimer=void 0},300)}onLogFilterChange(){this.logFilterDebounceTimer&&clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=setTimeout(()=>{this.applyLogFilter(),this.logFilterDebounceTimer=void 0},500)}refreshQueueStatusThrottled(){let e=Date.now(),t=e-this.lastQueueStatusRefresh;t>=2e3?(this.lastQueueStatusRefresh=e,this.refreshQueueStatus()):(this.queueStatusRefreshThrottleTimer&&clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=setTimeout(()=>{this.lastQueueStatusRefresh=Date.now(),this.queueStatusRefreshThrottleTimer=void 0,this.refreshQueueStatus()},2e3-t))}getAccountQueueStatuses(){let e=this.queueStatuses();return Object.entries(e).map(([t,n])=>{let o=this.accounts().find(a=>a.phone===t);return{phone:t,displayName:t,status:n.processing>0?"active":(n.pending>0,"idle"),pending:n.pending,processing:n.processing,completed:n.stats.completed,failed:n.stats.failed,retrying:n.retrying,sendRate:n.processing>0?1.5:0,avgResponseTime:500,dailyLimit:o?.dailySendLimit??100,dailyUsed:o?.dailySendCount??0,estimatedMinutes:n.pending>0?Math.ceil(n.pending/1.5):0,lastError:n.failed>0?"\u90E8\u5206\u6D88\u606F\u767C\u9001\u5931\u6557":void 0}})}pauseAllQueues(){this.ipcService.send("pause-all-queues",{}),this.toastService.info("\u6B63\u5728\u66AB\u505C\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}resumeAllQueues(){this.ipcService.send("resume-all-queues",{}),this.toastService.info("\u6B63\u5728\u6062\u5FA9\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}retryAllFailed(){this.ipcService.send("retry-all-failed",{}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u6240\u6709\u5931\u6557\u7684\u6D88\u606F...",2e3)}checkAutomationConfig(){this.toastService.info("\u6B63\u5728\u6AA2\u67E5\u914D\u7F6E...",2e3),this.ipcService.send("check-automation-config",{accounts:this.accounts().map(e=>({phone:e.phone,role:e.role,status:e.status})),groups:this.monitoredGroups(),keywords:this.keywordSets(),campaigns:this.campaigns()})}handleWorkflowNavigation(e){this.changeView(e.view),e.handler&&setTimeout(()=>{switch(e.handler){case"start-monitoring":this.startMonitoring();break;case"scan-sessions":this.scanOrphanSessions();break;case"new-campaign":break;case"export-leads":this.exportLeads();break;default:console.log("[Workflow] Unknown handler:",e.handler)}},300)}onWorkflowCompleted(e){this.toastService.success(`\u{1F389} \u5DE5\u4F5C\u6D41\u300C${e.title}\u300D\u5DF2\u5B8C\u6210\uFF01`,4e3),console.log("[Workflow] Completed:",e.id)}async loadChatHistory(e,t=!0){try{console.log("[Frontend] Loading chat history for user:",e,"reset:",t),t?(this.isLoadingChatHistory.set(!0),this.chatHistoryPage.set(0),this.chatHistoryAllMessages.set([])):this.chatHistoryLoadingMore.set(!0),this.selectedChatUserId.set(e);let n=this.chatHistoryPage(),o=this.chatHistoryPageSize(),a=n*o;console.log("[Frontend] Sending get-chat-history-full:",{userId:e,limit:o,offset:a}),this.ipcService.send("get-chat-history-full",{userId:e,limit:o,offset:a})}catch(n){console.error("[Frontend] Error loading chat history:",n),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}}async loadMoreChatHistory(){let e=this.selectedChatUserId();!e||this.chatHistoryLoadingMore()||!this.chatHistoryHasMore()||(this.chatHistoryPage.update(t=>t+1),await this.loadChatHistory(e,!1))}onChatHistoryScroll(e){let t=e.target;if(!t)return;let n=t.scrollTop,o=t.scrollHeight,a=t.clientHeight;o-n-a<200&&this.chatHistoryHasMore()&&!this.chatHistoryLoadingMore()&&this.loadMoreChatHistory()}async sendAiResponse(e,t){try{let n=this.generationState().lead;if(!n)return;this.ipcService.send("send-ai-response",{userId:e,message:t,accountPhone:this.senderAccounts().find(o=>o.id===this.selectedSenderId())?.phone,sourceGroup:n.sourceGroup,username:n.username}),setTimeout(()=>{this.loadChatHistory(e)},1e3)}catch(n){console.error("[Frontend] Error sending AI response:",n)}}async checkMonitoringStatus(){try{this.ipcService.send("get-monitoring-status",{})}catch(e){console.error("[Frontend] Error checking monitoring status:",e)}}async checkMonitoringHealth(){try{this.ipcService.send("check-monitoring-health",{})}catch(e){console.error("[Frontend] Error checking monitoring health:",e)}}trackByChatMessageId(e,t){return t.id||e}trackByChatId(e,t){return t.userId||e}trackByLogId(e,t){let n=0;return t.timestamp&&(t.timestamp instanceof Date?n=t.timestamp.getTime():typeof t.timestamp=="number"?n=t.timestamp:typeof t.timestamp=="string"&&(n=new Date(t.timestamp).getTime()||0)),`${t.id}-${n}-${e}`}isValidAlertDetails(e){if(!e||typeof e!="object"||e===null||Array.isArray(e))return!1;try{return Object.keys(e).length>0}catch{return!1}}safeStringify(e){try{return JSON.stringify(e,null,2)}catch{return"\u7121\u6CD5\u986F\u793A\u8A73\u60C5"}}getStatusColor(e){switch(e){case"Online":return"bg-green-500/10 text-green-400";case"Offline":return"bg-slate-500/10 text-slate-400";case"Banned":return"bg-red-500/10 text-red-400";case"Proxy Error":return"bg-orange-500/10 text-orange-400";case"Logging in...":return"bg-blue-500/10 text-blue-400 animate-pulse";case"Resting (Cooldown)":return"bg-yellow-500/10 text-yellow-400";case"Warming Up":return"bg-indigo-500/10 text-indigo-400 animate-pulse";case"New":return"bg-blue-500/10 text-blue-400";case"Contacted":return"bg-yellow-500/10 text-yellow-400";case"Replied":return"bg-green-500/10 text-green-400";case"Follow-up":return"bg-purple-500/10 text-purple-400";case"Closed-Won":return"bg-teal-500/10 text-teal-400";case"Closed-Lost":return"bg-red-500/10 text-red-400";default:return"bg-slate-700/20 text-slate-300"}}getStatusBarColor(e){switch(e){case"New":return"bg-amber-500";case"Contacted":return"bg-cyan-500";case"Replied":return"bg-purple-500";case"Follow-up":return"bg-orange-500";case"Closed-Won":return"bg-emerald-500";case"Closed-Lost":return"bg-red-500";default:return"bg-slate-500"}}getHealthColor(e){return e>80?"bg-green-500":e>50?"bg-yellow-500":"bg-red-500"}getOnlineStatusColor(e){switch(e){case"Online":return"bg-green-500";case"Recently":return"bg-yellow-500";case"Offline":return"bg-slate-500";default:return"bg-slate-400"}}getIntentLevelColor(e){switch(e){case"HOT":return"bg-red-500/20 text-red-400 border border-red-500/30";case"WARM":return"bg-orange-500/20 text-orange-400 border border-orange-500/30";case"NEUTRAL":return"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30";case"COLD":return"bg-blue-500/20 text-blue-400 border border-blue-500/30";case"NONE":return"bg-slate-500/20 text-slate-400 border border-slate-500/30";default:return"bg-slate-500/20 text-slate-400 border border-slate-500/30"}}getIntentLevelEmoji(e){switch(e){case"HOT":return"\u{1F525}";case"WARM":return"\u{1F321}\uFE0F";case"NEUTRAL":return"\u{1F610}";case"COLD":return"\u2744\uFE0F";case"NONE":return"\u26AA";default:return"\u26AA"}}handleMemberSendMessage(e){let t=this.convertMemberToLead(e);this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.first_name||e.username||e.user_id}`)}handleMemberAddToFunnel(e){let t=this.leads().find(o=>o.userId===e.user_id);if(t){this.toastService.warning(`\u26A0\uFE0F ${e.first_name||e.username||e.user_id} \u5DF2\u5728\u92B7\u552E\u6F0F\u6597\u4E2D`),this.currentView.set("leads"),setTimeout(()=>this.openLeadDetailModal(t),100);return}let n=this.convertMemberToLead(e);this.ipcService.send("add-lead",{user_id:e.user_id,username:e.username,first_name:e.first_name,last_name:e.last_name,source_chat_title:e.source_chat_title,source_chat_id:e.source_chat_id,notes:`\u5F9E\u6210\u54E1\u8CC7\u6599\u5EAB\u6DFB\u52A0 (${e.value_level}\u7D1A)`}),this.leads.update(o=>[n,...o]),this.toastService.success(`\u2705 \u5DF2\u5C07 ${e.first_name||e.username||e.user_id} \u52A0\u5165\u92B7\u552E\u6F0F\u6597`),this.currentView.set("leads")}handleResourceSendMessage(e){let t={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:"New",onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.display_name||e.username||e.telegram_id}`)}handleResourceViewDetail(e){let t="New";e.status==="converted"?t="Closed-Won":e.status==="contacted"?t="Contacted":e.status==="interested"&&(t="Replied");let n={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:t,onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(n)}handleResourceBatchSend(e){if(e.length===0)return;let t=e.map(n=>({telegramId:n.telegram_id,username:n.username||"",firstName:n.first_name,lastName:n.last_name,displayName:n.display_name||n.first_name||n.username||n.telegram_id,groupName:n.source_name||n.source_chat_title||"",keyword:n.triggered_keyword||"",source:n.source_type||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u7528\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}handleBatchSendComplete(e){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u5931\u6557 ${e.failed}`)}closeBatchSendDialog(){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([])}openBatchSendForLeads(){let e=this.leads().filter(n=>this.selectedLeadIds().has(n.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u767C\u9001\u6D88\u606F\u7684\u5BA2\u6236");return}let t=e.map(n=>({telegramId:n.userId||String(n.id),username:n.username,firstName:n.firstName,lastName:n.lastName,displayName:n.firstName||n.username||"\u672A\u77E5",groupName:n.sourceGroup||"",keyword:n.triggeredKeyword||"",source:n.sourceType||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u5BA2\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}openBatchInviteForLeads(){let e=this.leads().filter(n=>this.selectedLeadIds().has(n.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u62C9\u7FA4\u7684\u5BA2\u6236");return}let t=e.map(n=>({telegramId:n.userId||String(n.id),username:n.username,firstName:n.firstName,displayName:n.firstName||n.username||"\u672A\u77E5"}));this.batchInviteTargets.set(t),this.showBatchInviteDialogState.set(!0),this.toastService.info(`\u{1F465} \u6E96\u5099\u5C07 ${e.length} \u500B\u5BA2\u6236\u62C9\u5165\u7FA4\u7D44`)}closeBatchInviteDialog(){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([])}handleBatchInviteComplete(e){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u8DF3\u904E ${e.skipped}\uFF0C\u5931\u6557 ${e.failed}`)}openMemberExtractionDialog(e){let t={id:String(e.id),name:e.name||e.title||"\u672A\u77E5\u7FA4\u7D44",url:e.url||"",telegramId:e.telegramId||e.telegram_id||"",memberCount:e.memberCount||e.member_count||0,accountPhone:e.accountPhone,resourceType:e.resourceType||e.resource_type||"group"};this.memberExtractionGroup.set(t),this.showMemberExtractionDialog.set(!0)}closeMemberExtractionDialog(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null)}closeMemberExtractionDialogUnified(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null),this.dialogService.closeMemberExtraction()}handleMemberCountRefreshed(e){console.log("[Frontend] Member count refreshed:",e);let t=this.memberExtractionGroup();t&&t.id===e.groupId&&this.memberExtractionGroup.set(P(E({},t),{memberCount:e.memberCount})),this.monitoredGroups.update(n=>n.map(o=>String(o.id)===e.groupId?P(E({},o),{memberCount:e.memberCount,member_count:e.memberCount}):o))}handleMemberExtractionStart(e){if(this.showMemberExtractionDialog.set(!1),this.monitoringGroupsRef)this.monitoringGroupsRef.executeExtraction({limit:e.config.limit,filters:e.config.filters,advanced:e.config.advanced});else{let t=e.group,n="";if(t.url){let o=t.url.match(/t\.me\/([+\w]+)/);o&&(n=o[1])}this.ipcService.send("extract-members",{chatId:n||t.url,username:n,telegramId:t.telegramId,resourceId:t.id,groupName:t.name,phone:e.config.accountPhone||t.accountPhone||null,limit:e.config.limit===-1?void 0:e.config.limit,filters:{bots:!e.config.filters.excludeBots,onlineStatus:e.config.filters.onlineStatus,offline:e.config.filters.onlineStatus==="offline",online:e.config.filters.onlineStatus==="online",chinese:e.config.filters.hasChinese,hasUsername:e.config.filters.hasUsername,isPremium:e.config.filters.isPremium,excludeAdmins:e.config.filters.excludeAdmins},autoSave:e.config.advanced.autoSaveToResources,skipDuplicates:e.config.advanced.skipDuplicates}),this.toastService.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${t.name} \u7684\u6210\u54E1...`)}}handleMonitoringConfigAction(e){switch(e){case"goto-resource-center":this.currentView.set("resource-center");break;case"goto-accounts":this.currentView.set("monitoring-accounts");break;case"goto-keywords":this.currentView.set("keyword-sets");break;case"goto-templates":this.currentView.set("chat-templates");break;case"goto-triggers":this.currentView.set("trigger-rules");break;default:console.log("[Frontend] Unknown config action:",e)}}handleResourceSendToAISales(e){e.length!==0&&(this.ipcService.send("ai-team:add-targets",{targets:e.map(t=>({telegramId:t.telegram_id,username:t.username,displayName:t.display_name,sourceType:t.source_type}))}),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07 ${e.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165 AI \u92B7\u552E\u968A\u5217`))}handleResourceStatusChanged(e){if(!e.contacts.length)return;console.log("[Frontend] Syncing status change to leads:",e.contacts.length,"contacts, status:",e.status);let t=new Set(e.contacts.map(a=>a.telegram_id)),o={new:"New",contacted:"Contacted",interested:"Interested",negotiating:"Negotiating",converted:"Closed-Won",lost:"Closed-Lost",blocked:"Unsubscribed"}[e.status]||e.status;this.leads.update(a=>a.map(d=>t.has(String(d.userId))?P(E({},d),{status:o}):d)),this.ipcService.send("sync-resource-status-to-leads",{telegramIds:Array.from(t),status:o}),console.log("[Frontend] Status synced for",e.contacts.length,"contacts")}refreshLeadsData(){console.log("[Frontend] Refreshing leads data for resource center...");let e=this.leads();e.length>0&&(this.syncLeadsToResourceCenter(e),console.log("[Frontend] Synced current leads to resource center:",e.length)),this.leadsHasMore()&&!this.leadsLoading()?(this.loadRemainingLeads(),this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u66F4\u591A\u6578\u64DA... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3)):this.leadsLoading()?this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u4E2D... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3):this.toastService.success(`\u6578\u64DA\u5DF2\u540C\u6B65 (\u5171 ${e.length} \u689D)`)}handleCommandNavigation(e){if(!e.startsWith("action:")&&!e.startsWith("contact:")){this.currentView.set(e);return}if(e.startsWith("action:")){switch(e.replace("action:","")){case"send-message":this.toastService.info("\u8ACB\u5148\u9078\u64C7\u806F\u7E6B\u4EBA"),this.currentView.set("resource-center");break;case"extract-members":this.currentView.set("resource-center");break;case"search-groups":this.currentView.set("resource-center");break;case"start-monitor":this.startMonitoring();break;case"refresh":this.ipcService.send("get-initial-state"),this.toastService.success("\u6578\u64DA\u5DF2\u5237\u65B0");break;case"open-docs":window.open("https://docs.tg-matrix.com","_blank");break;case"show-shortcuts":this.toastService.info(`\u2318K \u6253\u958B\u547D\u4EE4\u9762\u677F
\u2318R \u5237\u65B0\u6578\u64DA
\u2318N \u6DFB\u52A0\u5E33\u865F`);break;case"open-feedback":this.toastService.info("\u8ACB\u767C\u9001\u90F5\u4EF6\u81F3 support@tg-matrix.com");break}return}if(e.startsWith("contact:")){let t=e.replace("contact:","");this.toastService.info(`\u6B63\u5728\u67E5\u770B\u806F\u7E6B\u4EBA ${t}`)}}handleMemberBatchSendMessage(e){if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let t=e.filter(n=>n.username);if(t.length===0){this.toastService.warning("\u6240\u9078\u6210\u54E1\u90FD\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u6D88\u606F");return}t.length<e.length&&this.toastService.warning(`${e.length-t.length} \u500B\u6210\u54E1\u6C92\u6709\u7528\u6236\u540D\uFF0C\u5C07\u88AB\u8DF3\u904E`),this.batchMessageTargets=t.map(n=>({userId:n.user_id,username:n.username,firstName:n.first_name,lastName:n.last_name,displayName:`${n.first_name||""} ${n.last_name||""}`.trim()||n.username})),this.showBatchMessageDialog.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${t.length} \u500B\u6210\u54E1\u767C\u9001\u6D88\u606F`)}handleNavigate(e){console.log("[Frontend] Navigate to:",e),this.currentView.set(e)}handleAIStrategyStart(e){console.log("[Frontend] AI Strategy started:",e),this.ipcService.send("execute-ai-strategy",{strategy:e}),this.currentView.set("automation"),this.toastService.success(`\u{1F680} AI \u7B56\u7565\u5DF2\u555F\u52D5: ${e.industry}`)}handleAIStrategyHandover(e){console.log("[Frontend] Handover strategy to AI Team:",e),this.aiTeamIncomingStrategy.set(e),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A: ${e.industry}`)}convertMemberToLead(e){return{id:parseInt(e.user_id)||Date.now(),userId:e.user_id,username:e.username,firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_chat_title,triggeredKeyword:"",timestamp:new Date(e.extracted_at||new Date),status:e.contacted?"Contacted":"New",onlineStatus:this.mapOnlineStatus(e.online_status),interactionHistory:[],doNotContact:!1,intentScore:this.mapValueLevelToScore(e.value_level),intentLevel:this.mapValueLevelToIntent(e.value_level),sourceType:"group_extract"}}mapOnlineStatus(e){switch(e){case"online":return"Online";case"recently":return"Recently";default:return"Offline"}}mapValueLevelToScore(e){switch(e){case"S":return 90;case"A":return 75;case"B":return 55;case"C":return 35;case"D":return 15;default:return 30}}mapValueLevelToIntent(e){switch(e){case"S":return"HOT";case"A":return"WARM";case"B":return"NEUTRAL";case"C":return"COLD";case"D":return"NONE";default:return"NEUTRAL"}}log(e,t){let n={id:Date.now(),timestamp:new Date,message:e,type:t};this.logs.update(o=>[n,...o].slice(0,100))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-root"]],viewQuery:function(t,n){if(t&1&&ci(GW,5)($W,5),t&2){let o;Rn(o=Nn())&&(n.onboardingComponent=o.first),Rn(o=Nn())&&(n.monitoringGroupsRef=o.first)}},hostBindings:function(t,n){t&1&&x("click",function(a){return n.onDocumentClick(a)},lo)},features:[bt([rs,J])],decls:15,vars:11,consts:[["onboardingRef",""],[1,"fixed","bottom-4","right-4","z-50","animate-fade-in"],[1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","pointer-events-none"],[3,"navigate"],[3,"closeDialog","sendComplete","isOpen","targets"],[3,"closeDialog","inviteComplete","isOpen","targets","accounts"],[3,"closeDialog","startExtractionEvent","memberCountRefreshed","isOpen","group"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"flex","h-screen",2,"background-color","var(--bg-primary)","color","var(--text-primary)"],[1,"bg-slate-800/95","backdrop-blur-sm","rounded-xl","p-4","shadow-lg","border","border-slate-700","min-w-[280px]"],[1,"flex","items-center","gap-3"],[1,"relative","w-8","h-8"],[1,"absolute","inset-0","border-2","border-slate-600","rounded-full"],[1,"absolute","inset-0","border-2","border-transparent","border-t-cyan-500","rounded-full","animate-spin"],[1,"flex-1"],[1,"text-sm","font-medium","text-white"],[1,"mt-1.5","h-1","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-purple-500","transition-all","duration-300"],[1,"w-8","h-8","rounded-full","bg-amber-500/20","flex","items-center","justify-center"],[1,"text-amber-400"],[1,"mt-2","px-3","py-1","text-xs","bg-cyan-500","hover:bg-cyan-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"w-8","h-8","rounded-full","bg-red-500/20","flex","items-center","justify-center"],[1,"text-red-400"],[1,"absolute","inset-0","bg-black/40","animate-fade-in"],[1,"relative","z-10","animate-success-pop"],[1,"absolute","inset-0","-m-8","rounded-full","bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","blur-xl","animate-pulse"],[1,"relative","bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","p-8","shadow-2xl","border","border-emerald-500/30"],[1,"flex","justify-center","mb-4"],[1,"w-20","h-20","rounded-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","flex","items-center","justify-center","shadow-lg","shadow-emerald-500/30"],[1,"text-4xl","animate-bounce"],[1,"text-center"],[1,"text-xl","font-bold","text-white","mb-1"],[1,"text-sm","text-slate-400"],[1,"absolute","-top-2","-left-2","w-4","h-4","bg-emerald-400","rounded-full","animate-ping"],[1,"absolute","-top-1","-right-3","w-3","h-3","bg-cyan-400","rounded-full","animate-ping",2,"animation-delay","0.1s"],[1,"absolute","-bottom-2","-left-1","w-2","h-2","bg-emerald-300","rounded-full","animate-ping",2,"animation-delay","0.2s"],[1,"absolute","-bottom-1","-right-2","w-3","h-3","bg-cyan-300","rounded-full","animate-ping",2,"animation-delay","0.3s"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm",3,"click"],[1,"relative","z-10"],[3,"closed","loginSuccess"],[3,"navigateEvent"],[3,"show","title","progress","cancellable"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center"],[1,"backdrop-blur-sm","flex-shrink-0","flex","flex-col","sidebar","h-screen","transition-all","duration-300",2,"background-color","var(--bg-sidebar)","border-right","1px solid var(--border-default)"],[1,"flex-shrink-0"],[1,"absolute","top-3","-right-3","z-50","w-6","h-6","rounded-full","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 8px rgba(6, 182, 212, 0.4)",3,"click","title"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","text-white","transition-transform","duration-200"],["points","15 18 9 12 15 6"],[1,"flex","items-center","gap-3","p-4"],[1,"relative","flex-shrink-0"],[1,"absolute","inset-0","rounded-xl","blur-md","opacity-50",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)"],["viewBox","0 0 64 64","fill","none",1,"h-10","w-10","relative","z-10"],["d","M32 8L52 20V44L32 56L12 44V20L32 8Z","fill","url(#sidebarLogoGrad)","stroke","url(#sidebarLogoStroke)","stroke-width","1.5"],["d","M22 28L40 22L34 36L28 32L22 28Z","fill","white","opacity","0.95"],["d","M28 32L34 36L32 42L28 32Z","fill","white","opacity","0.8"],["d","M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z","fill","#fbbf24"],["cx","32","cy","8","r","1.2","fill","#fef3c7"],["id","sidebarLogoGrad","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#0891b2"],["offset","100%","stop-color","#7c3aed"],["id","sidebarLogoStroke","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#22d3ee"],["offset","100%","stop-color","#a78bfa"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","cursor-pointer","transition-all","duration-300","hover:scale-[1.02]","group",3,"click"],[1,"avatar-wrapper","relative"],[1,"avatar-glow","absolute","inset-0","rounded-full","opacity-0","group-hover:opacity-100","transition-opacity","duration-300"],[1,"avatar-border","w-12","h-12","rounded-full","p-[2px]"],[1,"w-full","h-full","rounded-full","flex","items-center","justify-center","text-white","font-bold","text-lg","avatar-inner"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg",3,"badge-silver","badge-gold","badge-diamond","badge-star","badge-king"],[1,"flex-1","min-w-0"],[1,"text-sm","font-semibold","truncate",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-1.5","mt-0.5"],[1,"vip-tag","vip-tag-silver"],[1,"vip-tag","vip-tag-gold"],[1,"vip-tag","vip-tag-diamond"],[1,"vip-tag","vip-tag-star"],[1,"vip-tag","vip-tag-king"],[1,"vip-tag","vip-tag-bronze"],[1,"arrow-icon","transition-transform","duration-300","group-hover:translate-x-1"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4",2,"color","var(--text-muted)"],["points","9 18 15 12 9 6"],[1,"flex-1","overflow-y-auto","overflow-x-hidden","sidebar-nav","mt-2","px-2","pb-2"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","sidebar-icon"],["points","12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"],["x","3","y","3","width","7","height","7"],["x","14","y","3","width","7","height","7"],["x","14","y","14","width","7","height","7"],["x","3","y","14","width","7","height","7"],[1,"sidebar-group"],[1,"w-full","flex","items-center","justify-between","px-3","py-2","mt-2","rounded-md","hover:bg-white/5","transition-colors","cursor-pointer","group",3,"click"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","transition-transform","duration-200",2,"color","var(--sidebar-group-title)"],["points","6 9 12 15 18 9"],[1,"sidebar-group-content","overflow-hidden"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","font-semibold","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-cyan-500","to-blue-500","text-center","leading-5","text-[10px]"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-violet-500","to-fuchsia-500","text-center","leading-5","text-[10px]"],[1,"flex-shrink-0","p-4","space-y-3","border-t",2,"border-color","var(--border-default)","background-color","var(--bg-sidebar)"],[1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2.5","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10","hover:from-cyan-500/20","hover:to-blue-500/20","border","border-cyan-500/30","hover:border-cyan-500/50","text-cyan-400","rounded-xl","transition-all","text-sm","font-medium","group",3,"click"],[1,"text-lg","group-hover:animate-bounce"],[1,"block","text-sm","font-medium","mb-2",2,"color","var(--sidebar-group-title)"],[1,"flex","rounded-md","shadow-sm","p-1",2,"background-color","var(--bg-tertiary)"],[1,"w-full","text-sm","py-1.5","rounded","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"],[1,"flex-1","p-8","overflow-y-auto",2,"background-color","var(--bg-primary)"],[1,"h-full","p-6","overflow-auto"],[1,"h-full","overflow-auto"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","backdrop-blur-sm"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden",3,"click"],[1,"px-6","py-4","border-b","border-slate-700","flex","items-center","gap-3"],[1,"p-2","bg-red-500/20","rounded-lg"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-6","w-6","text-red-400"],["d","M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],[1,"text-lg","font-bold","text-white"],[1,"px-6","py-6"],[1,"text-slate-300","mb-4"],[1,"bg-red-500/10","border","border-red-500/20","rounded-lg","p-3","text-sm","text-red-300"],[1,"px-6","py-4","border-t","border-slate-700","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-red-500","hover:bg-red-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],[1,"font-bold","text-cyan-400"],[1,"font-bold","text-red-400"],[1,"p-2","bg-emerald-500/20","rounded-lg"],[1,"text-xl"],[1,"px-6","py-4","max-h-64","overflow-y-auto"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2"],[1,"px-6","py-4","border-t","border-slate-700"],[1,"w-full","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"mb-2"],[1,"text-cyan-400","hover:underline","text-sm",3,"click"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group",3,"click"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-white","group-hover:text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-emerald-400","opacity-0","group-hover:opacity-100","transition-opacity"],[1,"text-xl","font-bold","bg-gradient-to-r","from-cyan-400","to-purple-400","bg-clip-text","text-transparent"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg"],[1,"animate-pulse"],[1,"animate-bounce"],[1,"vip-icon"],[1,"vip-text"],["data-tour","accounts",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["d","M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"],["cx","9","cy","7","r","4"],["d","M23 21v-2a4 4 0 0 0-3-3.87"],["d","M16 3.13a4 4 0 0 1 0 7.75"],["data-tour","search-discovery",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","11","cy","11","r","8"],["d","M21 21l-4.35-4.35"],[1,"absolute","right-2","px-1.5","py-0.5","text-[10px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","12","cy","5","rx","9","ry","3"],["d","M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"],["d","M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"],["d","M22 2L11 13"],["d","M22 2L15 22L11 13L2 9L22 2Z"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1","relative","group",3,"click"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","transition-all"],[1,"text-lg"],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-[10px]","opacity-60"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],[1,"text-lg","ml-1"],[1,"ml-auto","text-xs","px-1.5","py-0.5","bg-violet-500/20","text-violet-400","rounded"],["data-tour","ai-assistant",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-orange-500","to-amber-500","text-white","rounded-full","font-bold","shadow-lg","shadow-orange-500/20"],[1,"absolute","right-2","text-xs"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-full","font-bold","shadow-lg","shadow-purple-500/20"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold","shadow-lg","shadow-cyan-500/20"],["d","M18 20V10"],["d","M12 20V4"],["d","M6 20v-6"],["d","M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"],["cx","12","cy","12","r","4"],[1,"ml-auto","px-1.5","py-0.5","text-xs","bg-pink-500/20","text-pink-400","rounded"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click","title"],[1,"ml-auto","text-xs","opacity-60"],[1,"knowledge-menu"],[1,"text-xs","transition-transform","duration-200"],[1,"pl-6","space-y-1"],["d","M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"],[1,"sidebar-item","flex","items-center","gap-2","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","text-sm",3,"click"],[1,"sidebar-item","flex","items-center","gap-2","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","text-sm","relative",3,"click"],[1,"ml-auto","text-xs","font-bold","rounded-full","px-1.5","py-0.5",2,"background-color","rgba(239, 68, 68, 0.2)","color","#f87171"],["cx","12","cy","12","r","3"],["d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"],[3,"accountAdded","back"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-gradient-to-br","from-slate-900","via-slate-900","to-slate-800","border","border-cyan-500/30","rounded-2xl","shadow-2xl","shadow-cyan-500/10","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","text-slate-200",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/10","via-blue-500/10","to-purple-500/10","border-b","border-cyan-500/20","p-5"],[1,"flex","justify-between","items-start"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold","text-xl","shadow-lg","shadow-cyan-500/30"],[1,"flex","items-center","gap-2"],[1,"text-xl","font-bold","text-white"],[1,"h-2.5","w-2.5","rounded-full","animate-pulse"],[1,"text-sm","text-cyan-400"],[1,"flex","items-center","gap-2","mt-1","flex-wrap"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-purple-500/20","text-purple-400","border","border-purple-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-cyan-500/20","text-cyan-400","border","border-cyan-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full",3,"class"],[1,"text-slate-400","hover:text-white","text-2xl","leading-none","transition-colors","p-2","hover:bg-white/10","rounded-lg",3,"click"],[1,"border-b","border-cyan-500/20","bg-slate-900/50"],["aria-label","Tabs",1,"flex","px-5"],[1,"whitespace-nowrap","py-3","px-4","border-b-2","border-transparent","font-medium","text-sm","cursor-pointer","text-slate-400","hover:text-cyan-400","hover:bg-cyan-500/5","transition-all","rounded-t-lg","flex","items-center","gap-2",3,"click"],[1,"overflow-y-auto","max-h-[calc(90vh-220px)]","p-5"],[1,"space-y-4"],[1,"py-4"],[1,"text-xs","px-2","py-0.5","rounded-full"],[1,"bg-slate-800/50","rounded-xl","p-4","border","border-slate-700/50"],[1,"block","text-sm","font-medium","text-cyan-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","focus:border-cyan-500",3,"ngModelChange","ngModel"],["value",""],[1,"mt-2","p-2","bg-amber-500/10","border","border-amber-500/30","rounded-lg"],[1,"grid","grid-cols-3","gap-3"],[1,"cursor-pointer","p-3","rounded-xl","border-2","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"text-sm","font-medium"],[1,"space-y-3"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-cyan-400"],[1,"text-xs","text-slate-500","bg-slate-700/50","px-2","py-1","rounded"],["rows","5",1,"form-textarea","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-3","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","resize-none","placeholder-slate-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","gap-3","flex-wrap"],[1,"flex","items-center","gap-2","bg-slate-800/50","hover:bg-cyan-500/20","text-slate-300","hover:text-cyan-400","text-sm","font-medium","py-2","px-4","rounded-lg","transition-all","border","border-slate-700/50","hover:border-cyan-500/30",3,"click"],[1,"p-3","rounded-xl","bg-cyan-500/10","border","border-cyan-500/30"],[1,"p-3","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-3","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"flex","justify-between","items-center","pt-4","border-t","border-cyan-500/20"],[1,"text-sm","text-red-400","hover:text-red-300","disabled:text-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-1.5","px-3","py-2","rounded-lg","hover:bg-red-500/10","transition-all",3,"click","disabled"],[1,"flex","gap-3"],[1,"bg-slate-700/80","hover:bg-slate-600","text-slate-300","font-medium","py-2.5","px-5","rounded-xl","transition-all","border","border-slate-600/50","hover:border-slate-500",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-400","hover:to-blue-400","text-white","font-bold","py-2.5","px-6","rounded-xl","shadow-lg","shadow-cyan-500/30","disabled:from-slate-500","disabled:to-slate-600","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2","transition-all",3,"click","disabled"],[3,"value"],[1,"text-xs","text-amber-400"],[1,"text-xs","text-cyan-400","hover:underline","cursor-pointer","mt-1","inline-block",3,"click"],[1,"flex","items-center","justify-between","p-2","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg"],[1,"text-xs","text-green-400"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-2","py-1","rounded"],[1,"p-2","bg-cyan-500/10","border","border-cyan-500/20","rounded-lg","text-xs","text-slate-400"],[1,"block","text-sm","font-medium","text-slate-500","dark:text-slate-400","mb-1"],["rows","2",1,"form-textarea","w-full","bg-slate-200/50","dark:bg-slate-800/50","border-slate-300","dark:border-slate-700","rounded-lg","py-2","px-3","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","justify-center","gap-3"],[1,"bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","text-white","font-bold","py-2","px-6","rounded-lg","transition","duration-200","shadow-lg","disabled:from-slate-400","disabled:to-slate-500","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg"],[1,"p-3","bg-amber-500/10","border","border-amber-500/20","text-amber-400","rounded-lg","text-sm","text-center"],[1,"p-3","bg-red-500/10","border","border-red-500/20","text-red-400","rounded-lg","text-sm"],[1,"p-3","bg-green-500/10","border","border-green-500/20","rounded-lg"],[1,"text-cyan-400"],[1,"animate-spin"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg",3,"click"],[1,"text-cyan-400","hover:underline","cursor-pointer","ml-1",3,"click"],[1,"ml-2","text-cyan-400","hover:underline",3,"click"],[1,"text-xs","text-green-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"change"],[1,"flex","items-center","gap-2","bg-green-500/20","hover:bg-green-500/30","text-green-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-green-500/30",3,"click"],[1,"flex","items-center","gap-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-red-500/30",3,"click"],[1,"text-sm","text-cyan-400","font-medium"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"flex","items-center","justify-between","text-sm","bg-slate-800/50","rounded-lg","px-3","py-2"],[1,"flex","items-center","gap-2","truncate","flex-1","min-w-0"],[1,"text-green-400"],[1,"text-blue-400"],[1,"truncate","text-white"],[1,"text-slate-500","text-xs","whitespace-nowrap"],[1,"text-green-500","text-xs"],[1,"text-red-400","hover:text-red-300","text-lg","font-bold","p-1","hover:bg-red-500/20","rounded","ml-2",3,"click"],[1,"text-sm","text-amber-400"],[1,"text-sm","text-red-400"],[1,"mb-4","flex","items-center","justify-between"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","font-bold","py-2","px-4","rounded-lg","text-sm","disabled:bg-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4"],[1,"h-96","overflow-y-auto"],[1,"space-y-3","mb-4"],[1,"text-center","py-8"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-cyan-500/20"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4",3,"scroll"],[1,"text-center","py-4"],[1,"text-center","py-2"],[1,"flex","justify-start"],[1,"flex","justify-end"],[1,"max-w-[75%]"],[1,"bg-slate-700","text-white","rounded-2xl","rounded-bl-sm","px-4","py-2"],[1,"text-sm"],[1,"text-xs","text-slate-500","mt-1"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","rounded-2xl","rounded-br-sm","px-4","py-2","shadow-lg"],[1,"flex","items-center","justify-end","gap-2","mt-1"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-1.5","py-0.5","rounded"],[1,"animate-spin","text-cyan-400"],[1,"ml-2","text-sm","text-slate-500"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","justify-center"],[1,"bg-slate-800/50","text-slate-400","text-xs","px-3","py-1","rounded-full"],[1,"text-4xl","mb-2"],[1,"text-slate-500","dark:text-slate-400"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-sm","font-medium","text-cyan-400","mb-2","flex","items-center","gap-2"],[1,"grid","grid-cols-3","gap-2","text-center","text-xs"],[1,"p-2","bg-slate-700/50","rounded"],[1,"text-slate-400"],[1,"text-sm","font-bold","text-cyan-400"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","backdrop-blur-sm",3,"click"],[1,"bg-slate-100","dark:bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-300","dark:border-slate-700","w-full","max-w-3xl","max-h-[80vh]","overflow-hidden",3,"click"],[1,"p-4","border-b","border-slate-300","dark:border-slate-700","flex","items-center","justify-between","bg-slate-200/50","dark:bg-slate-800/50"],[1,"text-lg","font-bold","text-slate-900","dark:text-white","flex","items-center","gap-2"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-purple-500"],["d","M3 3v5h5"],["d","M3.05 13A9 9 0 1 0 6 5.3L3 8"],["d","M12 7v5l4 2"],[1,"text-slate-500","hover:text-slate-700","dark:text-slate-400","dark:hover:text-white",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"p-4","overflow-y-auto","max-h-[60vh]"],[1,"text-center","py-8","text-slate-500"],[1,"p-4","border-t","border-slate-300","dark:border-slate-700","bg-slate-200/50","dark:bg-slate-800/50","flex","justify-end"],[1,"px-4","py-2","bg-slate-300","dark:bg-slate-700","hover:bg-slate-400","dark:hover:bg-slate-600","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-12","w-12","mx-auto","mb-3","text-slate-400"],["cx","12","cy","12","r","10"],["d","M12 8v4l3 3"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700",3,"opacity-50"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700"],[1,"p-2","rounded-lg"],[1,"font-medium","text-slate-900","dark:text-white"],[1,"text-yellow-500","ml-2"],[1,"text-red-400","ml-2"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded",3,"click"],[1,"bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","shadow-2xl","w-full","max-w-2xl","mx-4","overflow-hidden","border","border-cyan-500/30"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","p-6","text-center"],[1,"text-3xl","font-bold","text-white","mb-2"],[1,"text-cyan-100"],[1,"flex","justify-center","gap-2","py-4","bg-slate-800/50"],[1,"w-3","h-3","rounded-full","transition-all"],[1,"p-6"],[1,"text-center","space-y-6"],[1,"p-6","bg-slate-800/50","flex","justify-between","items-center"],[1,"text-sm","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all"],[1,"grid","grid-cols-3","gap-4","mb-6"],[1,"p-4","bg-slate-700/50","rounded-xl"],[1,"text-3xl","mb-2"],[1,"text-xs","text-slate-400"],[1,"text-slate-300"],[1,"text-lg","font-semibold","text-white","text-center","mb-4"],[1,"p-4","rounded-xl"],[1,"text-2xl"],[1,"font-medium","text-white"],[1,"px-3","py-1","bg-slate-700","hover:bg-slate-600","rounded","text-sm","text-white","disabled:opacity-50",3,"click","disabled"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300","space-y-2"],[1,"block","bg-slate-800","p-2","rounded","text-cyan-400","text-xs"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-cyan-500","rounded",3,"change","checked"],[1,"text-sm","text-slate-300"],[1,"mt-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded","py-1","px-2","text-sm","text-white",3,"ngModelChange","ngModel"],["value","gemini"],["value","openai"],[1,"text-6xl","mb-4"],[1,"text-2xl","font-bold","text-white"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30"],[1,"text-sm","text-slate-300","space-y-1"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-amber-500/50"],[1,"bg-amber-500/20","p-6","text-center","border-b","border-amber-500/30"],[1,"text-5xl","mb-3"],[1,"text-xl","font-bold","text-amber-400"],[1,"text-slate-400","text-sm","mt-2"],[1,"p-6","space-y-4"],[1,"text-slate-300","text-sm"],[1,"bg-slate-700/50","rounded-lg","p-3","max-h-48","overflow-y-auto","space-y-2"],[1,"flex","items-center","justify-between","p-2","bg-slate-600/50","rounded-lg"],[1,"bg-blue-500/10","border","border-blue-500/30","rounded-lg","p-3"],[1,"text-blue-400","text-sm"],[1,"p-4","bg-slate-700/30","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-amber-500","hover:bg-amber-600","disabled:opacity-50","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click","disabled"],[1,"text-white","font-medium"],[1,"text-green-400","text-xs"],[1,"text-amber-400","text-xs"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-red-500/50"],[1,"bg-red-500/20","p-6","text-center","border-b","border-red-500/30"],[1,"text-xl","font-bold","text-red-400"],[1,"bg-slate-700/50","rounded-lg","p-4","space-y-3"],[1,"flex","items-start","gap-3"],["href","https://www.python.org/downloads/","target","_blank",1,"text-cyan-400","text-sm","hover:underline"],[1,"text-slate-400","text-sm"],[1,"block","bg-slate-800","text-green-400","text-sm","p-2","rounded","mt-1"],[1,"bg-red-500/10","border","border-red-500/30","rounded-lg","p-3"],[1,"text-red-400","text-sm"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600",3,"click"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden","border","border-cyan-500/30",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/20","to-blue-500/20","p-4","border-b","border-slate-700/50"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],[1,"block","text-sm","text-slate-400","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u8CB7\u5BB6\u610F\u5411\u3001\u7522\u54C1\u8AEE\u8A62...","autofocus","",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-lg","px-4","py-3","text-white","focus:border-cyan-500","focus:ring-1","focus:ring-cyan-500","transition-colors",3,"input","keyup.enter","value"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","transition-colors","font-medium",3,"click"]],template:function(t,n){t&1&&(B(0,"app-toast")(1,"app-global-confirm-dialog")(2,"app-global-input-dialog"),y(3,jW,5,3,"div",1),y(4,QW,17,3,"div",2),r(5,"app-command-palette",3),x("navigate",function(a){return n.handleCommandNavigation(a)}),s(),r(6,"app-batch-send-dialog",4),x("closeDialog",function(){return n.dialogService.closeBatchSend()})("sendComplete",function(a){return n.handleBatchSendComplete(a)}),s(),r(7,"app-batch-invite-dialog",5),x("closeDialog",function(){return n.dialogService.closeBatchInvite()})("inviteComplete",function(a){return n.handleBatchInviteComplete(a)}),s(),r(8,"app-member-extraction-dialog",6),x("closeDialog",function(){return n.closeMemberExtractionDialogUnified()})("startExtractionEvent",function(a){return n.handleMemberExtractionStart(a)})("memberCountRefreshed",function(a){return n.handleMemberCountRefreshed(a)}),s(),B(9,"app-membership-dialog")(10,"app-payment")(11,"app-upgrade-prompt"),y(12,YW,4,0,"div",7),y(13,XW,1,0,"app-login")(14,eJ,179,124,"div",8)),t&2&&(c(3),S(n.backendConnectionState()!=="connected"?3:-1),c(),S(n.showSuccessOverlay()?4:-1),c(2),L("isOpen",n.dialogService.showBatchMessageDialog())("targets",n.dialogService.batchSendTargets()),c(),L("isOpen",n.dialogService.showBatchInviteDialog())("targets",n.dialogService.batchInviteTargets())("accounts",n.accounts()),c(),L("isOpen",n.dialogService.showMemberExtractionDialog()||n.showMemberExtractionDialog())("group",n.dialogService.memberExtractionGroup()||n.memberExtractionGroup()),c(4),S(n.showQrLoginDialog()?12:-1),c(),S(n.isAuthenticated()?14:13))},dependencies:[oe,ae,Re,Ne,xe,Ge,ve,he,xc,yc,wc,Ec,Ac,Mc,kc,Wc,Kc,id,ec,rd,sd,ad,tr,dd,ud,md,od,pd,hd,fd,_d,Ul,Gl,$l,Hl,ql,Wl,Kl,Ql,Yl,Xl,Zl,tc,ic,oc,rc,fr],styles:['[_nghost-%COMP%]     .highlight-pulse{animation:_ngcontent-%COMP%_highlight-pulse 1.5s ease-in-out 2}@keyframes _ngcontent-%COMP%_highlight-pulse{0%,to{box-shadow:0 0 #06b6d400;border-color:inherit}50%{box-shadow:0 0 20px 5px #06b6d480;border-color:#06b6d4}}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_success-pop{0%{transform:scale(.5);opacity:0}50%{transform:scale(1.1)}to{transform:scale(1);opacity:1}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .3s ease-out forwards}.animate-success-pop[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_success-pop .5s cubic-bezier(.68,-.55,.265,1.55) forwards}[_nghost-%COMP%]     .page-content{animation:_ngcontent-%COMP%_page-fade-in .3s ease-out}@keyframes _ngcontent-%COMP%_page-fade-in{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}[_nghost-%COMP%]     .card-hover{transition:all .2s ease}[_nghost-%COMP%]     .card-hover:hover{transform:translateY(-2px);box-shadow:0 8px 25px -5px #0000004d}[_nghost-%COMP%]     .sidebar-item{position:relative;overflow:hidden}[_nghost-%COMP%]     .sidebar-item:before{content:"";position:absolute;left:0;top:50%;width:3px;height:0;background:linear-gradient(to bottom,#06b6d4,#8b5cf6);transition:height .2s ease;transform:translateY(-50%);border-radius:0 2px 2px 0}[_nghost-%COMP%]     .sidebar-item:hover:before, [_nghost-%COMP%]     .sidebar-item.active:before{height:60%}[_nghost-%COMP%]     .btn-ripple{position:relative;overflow:hidden}[_nghost-%COMP%]     .btn-ripple:after{content:"";position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none;background-image:radial-gradient(circle,#fff 10%,transparent 10.01%);background-repeat:no-repeat;background-position:50%;transform:scale(10);opacity:0;transition:transform .5s,opacity .5s}[_nghost-%COMP%]     .btn-ripple:active:after{transform:scale(0);opacity:.3;transition:0s}[_nghost-%COMP%]     .animate-number{animation:_ngcontent-%COMP%_number-pop .3s ease-out}@keyframes _ngcontent-%COMP%_number-pop{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}[_nghost-%COMP%]     .gradient-border{position:relative;background:linear-gradient(var(--card-bg),var(--card-bg)) padding-box,linear-gradient(135deg,#06b6d4,#8b5cf6) border-box;border:1px solid transparent}'],changeDetection:0})}};console.log("[Bootstrap] index.tsx loaded, starting Angular bootstrap...");console.log("[Bootstrap] Angular imports completed");console.log("[Bootstrap] AppComponent imported, calling bootstrapApplication...");Jd(vd,{providers:[cp(),eu(),Yg()]}).then(()=>{console.log("[TG-AI\u667A\u63A7\u738B] Application started successfully"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[TG-AI\u667A\u63A7\u738B] angular-ready event dispatched")},50)}).catch(i=>{console.error("[TG-AI\u667A\u63A7\u738B] Application failed to start:",i);let e=document.getElementById("app-loading"),t=document.getElementById("error-container"),n=document.getElementById("error-message"),o=document.getElementById("loading-status"),a=document.getElementById("loading-progress");o&&(o.textContent="\u8F09\u5165\u5931\u6557"),a&&(a.style.background="#ef4444",a.style.width="100%"),t&&(t.style.display="block"),n&&(n.textContent="\u932F\u8AA4: "+(i?.message||i))});
