import{a as bt}from"./chunk-CXZPK65J.js";import{a as wa}from"./chunk-C6B25AXQ.js";import{a as Aa,b as Ma}from"./chunk-WSVRIQW3.js";import{b as Ea,f as Da}from"./chunk-MMFOEXUO.js";import{a as Ta}from"./chunk-LD76BI4N.js";import{a as Ks,b as Ia}from"./chunk-UD26NHBF.js";import{a as Qs}from"./chunk-VSSEQNUC.js";import{a as Mt}from"./chunk-AQUNG32O.js";import{a as _a}from"./chunk-EYBRO2ZX.js";import{b as fa}from"./chunk-5TLJ2TGS.js";import{a as Ca}from"./chunk-3J2ERJUT.js";import{a as va}from"./chunk-4YPUANWN.js";import{a as xa}from"./chunk-7SK65I43.js";import{a as ba}from"./chunk-E6Y55QOQ.js";import"./chunk-EWAJLSAV.js";import{a as Sa,b as ya}from"./chunk-MKWM354K.js";import{a as Se,b as st,c as Us,d as Oo,e as Vt,f as Gn,g as Cn,h as ht,i as Zs,j as js,k as ea,l as na,m as ia,n as oa,o as ra,q as sa,r as aa,s as la,t as ca,u as da,v as ua,w as ma,x as pa,y as ga}from"./chunk-FGECJ42T.js";import{c as ha}from"./chunk-A4DTJ5UD.js";import{a as Ls,b as Os,d as Gs,f as qs,g as Un,i as $s}from"./chunk-IOZ6RGE3.js";import{a as zs,b as Ws,c as zn}from"./chunk-X3FI6EPB.js";import"./chunk-O6TR47GC.js";import{a as ta}from"./chunk-GI7PD52U.js";import{a as Ys,b as Qt,c as Xs}from"./chunk-QCWWCRCA.js";import{a as De}from"./chunk-MKTJUSEE.js";import{a as Jt,b as xe,c as fe,f as _e,h as qn,i as Hs,k as nt,l as He,m as Ke,n as $n,o as Hn,s as Kn,t as ue}from"./chunk-3FNGYHNZ.js";import{a as Js,b as Tt}from"./chunk-ET36GW2V.js";import{k as Ns,l as Bs,m as Wt,n as Vs,o as oe}from"./chunk-HDSZBSQ2.js";import{a as me,b as Ue}from"./chunk-CCGO3GAA.js";import{$ as vt,$a as ke,Ab as Y,Ba as Ds,Bb as je,Ea as Ms,Eb as K,Fb as z,G as we,Gb as W,Hb as Is,Ib as ks,J as Te,Jb as Dt,La as ie,Lb as Ps,Mb as _n,N as rt,Nb as Le,O as B,Ob as et,Pb as Fs,Qa as Ts,Qb as On,T as v,Tb as Rs,U as x,V as te,Vb as L,W as le,Wa as Vn,X as Es,Xa as Lo,Xb as Ee,Y as Nn,Ya as w,Yb as tt,Za as E,Zb as zt,_a as gt,a as F,aa as At,ab as $,b as N,bb as H,c as Rn,cb as V,da as C,db as s,eb as a,fa as gn,fb as k,gb as O,hb as G,ib as Ve,jb as T,kb as xt,nb as b,ob as ge,pa as Vo,pb as f,qb as Ln,rb as hn,sb as fn,ta as Bt,ub as j,va as As,vb as I,wa as Bn,wb as he,xa as d,xb as l,yb as M,zb as A}from"./chunk-XBIFDY2N.js";function ka(i){return new we(3e3,!1)}function Hc(){return new we(3100,!1)}function Kc(){return new we(3101,!1)}function zc(i){return new we(3001,!1)}function Wc(i){return new we(3003,!1)}function Jc(i){return new we(3004,!1)}function Fa(i,e){return new we(3005,!1)}function Ra(){return new we(3006,!1)}function Na(){return new we(3007,!1)}function Ba(i,e){return new we(3008,!1)}function Va(i){return new we(3002,!1)}function La(i,e,t,n,o){return new we(3010,!1)}function Oa(){return new we(3011,!1)}function Ga(){return new we(3012,!1)}function Ua(){return new we(3200,!1)}function qa(){return new we(3202,!1)}function $a(){return new we(3013,!1)}function Ha(i){return new we(3014,!1)}function Ka(i){return new we(3015,!1)}function za(i){return new we(3016,!1)}function Wa(i,e){return new we(3404,!1)}function Qc(i){return new we(3502,!1)}function Ja(i){return new we(3503,!1)}function Qa(){return new we(3300,!1)}function Ya(i){return new we(3504,!1)}function Xa(i){return new we(3301,!1)}function Za(i,e){return new we(3302,!1)}function ja(i){return new we(3303,!1)}function el(i,e){return new we(3400,!1)}function tl(i){return new we(3401,!1)}function nl(i){return new we(3402,!1)}function il(i,e){return new we(3505,!1)}function St(i){switch(i.length){case 0:return new Vt;case 1:return i[0];default:return new Gn(i)}}function $o(i,e,t=new Map,n=new Map){let o=[],r=[],c=-1,m=null;if(e.forEach(h=>{let g=h.get("offset"),_=g==c,S=_&&m||new Map;h.forEach((y,D)=>{let P=D,R=y;if(D!=="offset")switch(P=i.normalizePropertyName(P,o),R){case Cn:R=t.get(D);break;case st:R=n.get(D);break;default:R=i.normalizeStyleValue(D,P,R,o);break}S.set(P,R)}),_||r.push(S),m=S,c=g}),o.length)throw Qc(o);return r}function Wn(i,e,t,n){switch(e){case"start":i.onStart(()=>n(t&&Go(t,"start",i)));break;case"done":i.onDone(()=>n(t&&Go(t,"done",i)));break;case"destroy":i.onDestroy(()=>n(t&&Go(t,"destroy",i)));break}}function Go(i,e,t){let n=t.totalTime,o=!!t.disabled,r=Jn(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,n??i.totalTime,o),c=i._data;return c!=null&&(r._data=c),r}function Jn(i,e,t,n,o="",r=0,c){return{element:i,triggerName:e,fromState:t,toState:n,phaseName:o,totalTime:r,disabled:!!c}}function ze(i,e,t){let n=i.get(e);return n||i.set(e,n=t),n}function Ho(i){let e=i.indexOf(":"),t=i.substring(1,e),n=i.slice(e+1);return[t,n]}var Yc=typeof document>"u"?null:document.documentElement;function Qn(i){let e=i.parentNode||i.host||null;return e===Yc?null:e}function Xc(i){return i.substring(1,6)=="ebkit"}var Lt=null,Pa=!1;function ol(i){Lt||(Lt=Zc()||{},Pa=Lt.style?"WebkitAppearance"in Lt.style:!1);let e=!0;return Lt.style&&!Xc(i)&&(e=i in Lt.style,!e&&Pa&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in Lt.style)),e}function Zc(){return typeof document<"u"?document.body:null}function Ko(i,e){for(;e;){if(e===i)return!0;e=Qn(e)}return!1}function zo(i,e,t){if(t)return Array.from(i.querySelectorAll(e));let n=i.querySelector(e);return n?[n]:[]}var jc=1e3,Wo="{{",ed="}}",Jo="ng-enter",Yn="ng-leave",vn="ng-trigger",xn=".ng-trigger",Qo="ng-animating",Xn=".ng-animating";function ft(i){if(typeof i=="number")return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Uo(parseFloat(e[1]),e[2])}function Uo(i,e){switch(e){case"s":return i*jc;default:return i}}function bn(i,e,t){return i.hasOwnProperty("duration")?i:nd(i,e,t)}var td=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function nd(i,e,t){let n,o=0,r="";if(typeof i=="string"){let c=i.match(td);if(c===null)return e.push(ka(i)),{duration:0,delay:0,easing:""};n=Uo(parseFloat(c[1]),c[2]);let m=c[3];m!=null&&(o=Uo(parseFloat(m),c[4]));let h=c[5];h&&(r=h)}else n=i;if(!t){let c=!1,m=e.length;n<0&&(e.push(Hc()),c=!0),o<0&&(e.push(Kc()),c=!0),c&&e.splice(m,0,ka(i))}return{duration:n,delay:o,easing:r}}function rl(i){return i.length?i[0]instanceof Map?i:i.map(e=>new Map(Object.entries(e))):[]}function at(i,e,t){e.forEach((n,o)=>{let r=Zn(o);t&&!t.has(o)&&t.set(o,i.style[r]),i.style[r]=n})}function It(i,e){e.forEach((t,n)=>{let o=Zn(n);i.style[o]=""})}function Yt(i){return Array.isArray(i)?i.length==1?i[0]:Us(i):i}function sl(i,e,t){let n=e.params||{},o=Yo(i);o.length&&o.forEach(r=>{n.hasOwnProperty(r)||t.push(zc(r))})}var qo=new RegExp(`${Wo}\\s*(.+?)\\s*${ed}`,"g");function Yo(i){let e=[];if(typeof i=="string"){let t;for(;t=qo.exec(i);)e.push(t[1]);qo.lastIndex=0}return e}function Xt(i,e,t){let n=`${i}`,o=n.replace(qo,(r,c)=>{let m=e[c];return m==null&&(t.push(Wc(c)),m=""),m.toString()});return o==n?i:o}var id=/-+([a-z0-9])/g;function Zn(i){return i.replace(id,(...e)=>e[1].toUpperCase())}function al(i,e){return i===0||e===0}function ll(i,e,t){if(t.size&&e.length){let n=e[0],o=[];if(t.forEach((r,c)=>{n.has(c)||o.push(c),n.set(c,r)}),o.length)for(let r=1;r<e.length;r++){let c=e[r];o.forEach(m=>c.set(m,jn(i,m)))}}return e}function We(i,e,t){switch(e.type){case Se.Trigger:return i.visitTrigger(e,t);case Se.State:return i.visitState(e,t);case Se.Transition:return i.visitTransition(e,t);case Se.Sequence:return i.visitSequence(e,t);case Se.Group:return i.visitGroup(e,t);case Se.Animate:return i.visitAnimate(e,t);case Se.Keyframes:return i.visitKeyframes(e,t);case Se.Style:return i.visitStyle(e,t);case Se.Reference:return i.visitReference(e,t);case Se.AnimateChild:return i.visitAnimateChild(e,t);case Se.AnimateRef:return i.visitAnimateRef(e,t);case Se.Query:return i.visitQuery(e,t);case Se.Stagger:return i.visitStagger(e,t);default:throw Jc(e.type)}}function jn(i,e){return window.getComputedStyle(i)[e]}var pr=(()=>{class i{validateStyleProperty(t){return ol(t)}containsElement(t,n){return Ko(t,n)}getParentElement(t){return Qn(t)}query(t,n,o){return zo(t,n,o)}computeStyle(t,n,o){return o||""}animate(t,n,o,r,c,m=[],h){return new Vt(o,r)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Te({token:i,factory:i.\u0275fac})}return i})(),Gt=class{static NOOP=new pr},Ut=class{};var od=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),oi=class extends Ut{normalizePropertyName(e,t){return Zn(e)}normalizeStyleValue(e,t,n,o){let r="",c=n.toString().trim();if(od.has(t)&&n!==0&&n!=="0")if(typeof n=="number")r="px";else{let m=n.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&m[1].length==0&&o.push(Fa(e,n))}return c+r}};var ri="*";function rd(i,e){let t=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>sd(n,t,e)):t.push(i),t}function sd(i,e,t){if(i[0]==":"){let h=ad(i,t);if(typeof h=="function"){e.push(h);return}i=h}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(Ka(i)),e;let o=n[1],r=n[2],c=n[3];e.push(cl(o,c));let m=o==ri&&c==ri;r[0]=="<"&&!m&&e.push(cl(c,o))}function ad(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(za(i)),"* => *"}}var ei=new Set(["true","1"]),ti=new Set(["false","0"]);function cl(i,e){let t=ei.has(i)||ti.has(i),n=ei.has(e)||ti.has(e);return(o,r)=>{let c=i==ri||i==o,m=e==ri||e==r;return!c&&t&&typeof o=="boolean"&&(c=o?ei.has(i):ti.has(i)),!m&&n&&typeof r=="boolean"&&(m=r?ei.has(e):ti.has(e)),c&&m}}var vl=":self",ld=new RegExp(`s*${vl}s*,?`,"g");function xl(i,e,t,n){return new nr(i).build(e,t,n)}var dl="",nr=class{_driver;constructor(e){this._driver=e}build(e,t,n){let o=new ir(t);return this._resetContextStyleTimingState(o),We(this,Yt(e),o)}_resetContextStyleTimingState(e){e.currentQuerySelector=dl,e.collectedStyles=new Map,e.collectedStyles.set(dl,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,o=t.depCount=0,r=[],c=[];return e.name.charAt(0)=="@"&&t.errors.push(Ra()),e.definitions.forEach(m=>{if(this._resetContextStyleTimingState(t),m.type==Se.State){let h=m,g=h.name;g.toString().split(/\s*,\s*/).forEach(_=>{h.name=_,r.push(this.visitState(h,t))}),h.name=g}else if(m.type==Se.Transition){let h=this.visitTransition(m,t);n+=h.queryCount,o+=h.depCount,c.push(h)}else t.errors.push(Na())}),{type:Se.Trigger,name:e.name,states:r,transitions:c,queryCount:n,depCount:o,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),o=e.options&&e.options.params||null;if(n.containsDynamicStyles){let r=new Set,c=o||{};n.styles.forEach(m=>{m instanceof Map&&m.forEach(h=>{Yo(h).forEach(g=>{c.hasOwnProperty(g)||r.add(g)})})}),r.size&&t.errors.push(Ba(e.name,[...r.values()]))}return{type:Se.State,name:e.name,style:n,options:o?{params:o}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=We(this,Yt(e.animation),t),o=rd(e.expr,t.errors);return{type:Se.Transition,matchers:o,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:Ot(e.options)}}visitSequence(e,t){return{type:Se.Sequence,steps:e.steps.map(n=>We(this,n,t)),options:Ot(e.options)}}visitGroup(e,t){let n=t.currentTime,o=0,r=e.steps.map(c=>{t.currentTime=n;let m=We(this,c,t);return o=Math.max(o,t.currentTime),m});return t.currentTime=o,{type:Se.Group,steps:r,options:Ot(e.options)}}visitAnimate(e,t){let n=md(e.timings,t.errors);t.currentAnimateTimings=n;let o,r=e.styles?e.styles:Oo({});if(r.type==Se.Keyframes)o=this.visitKeyframes(r,t);else{let c=e.styles,m=!1;if(!c){m=!0;let g={};n.easing&&(g.easing=n.easing),c=Oo(g)}t.currentTime+=n.duration+n.delay;let h=this.visitStyle(c,t);h.isEmptyStep=m,o=h}return t.currentAnimateTimings=null,{type:Se.Animate,timings:n,style:o,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],o=Array.isArray(e.styles)?e.styles:[e.styles];for(let m of o)typeof m=="string"?m===st?n.push(m):t.errors.push(Va(m)):n.push(new Map(Object.entries(m)));let r=!1,c=null;return n.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(c=m.get("easing"),m.delete("easing")),!r)){for(let h of m.values())if(h.toString().indexOf(Wo)>=0){r=!0;break}}}),{type:Se.Style,styles:n,easing:c,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,o=t.currentTime,r=t.currentTime;n&&r>0&&(r-=n.duration+n.delay),e.styles.forEach(c=>{typeof c!="string"&&c.forEach((m,h)=>{let g=t.collectedStyles.get(t.currentQuerySelector),_=g.get(h),S=!0;_&&(r!=o&&r>=_.startTime&&o<=_.endTime&&(t.errors.push(La(h,_.startTime,_.endTime,r,o)),S=!1),r=_.startTime),S&&g.set(h,{startTime:r,endTime:o}),t.options&&sl(m,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:Se.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(Oa()),n;let o=1,r=0,c=[],m=!1,h=!1,g=0,_=e.steps.map(U=>{let Q=this._makeStyleAst(U,t),J=Q.offset!=null?Q.offset:ud(Q.styles),ee=0;return J!=null&&(r++,ee=Q.offset=J),h=h||ee<0||ee>1,m=m||ee<g,g=ee,c.push(ee),Q});h&&t.errors.push(Ga()),m&&t.errors.push(Ua());let S=e.steps.length,y=0;r>0&&r<S?t.errors.push(qa()):r==0&&(y=o/(S-1));let D=S-1,P=t.currentTime,R=t.currentAnimateTimings,q=R.duration;return _.forEach((U,Q)=>{let J=y>0?Q==D?1:y*Q:c[Q],ee=J*q;t.currentTime=P+R.delay+ee,R.duration=ee,this._validateStyleAst(U,t),U.offset=J,n.styles.push(U)}),n}visitReference(e,t){return{type:Se.Reference,animation:We(this,Yt(e.animation),t),options:Ot(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:Se.AnimateChild,options:Ot(e.options)}}visitAnimateRef(e,t){return{type:Se.AnimateRef,animation:this.visitReference(e.animation,t),options:Ot(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,o=e.options||{};t.queryCount++,t.currentQuery=e;let[r,c]=cd(e.selector);t.currentQuerySelector=n.length?n+" "+r:r,ze(t.collectedStyles,t.currentQuerySelector,new Map);let m=We(this,Yt(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:Se.Query,selector:r,limit:o.limit||0,optional:!!o.optional,includeSelf:c,animation:m,originalSelector:e.selector,options:Ot(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push($a());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:bn(e.timings,t.errors,!0);return{type:Se.Stagger,animation:We(this,Yt(e.animation),t),timings:n,options:null}}};function cd(i){let e=!!i.split(/\s*,\s*/).find(t=>t==vl);return e&&(i=i.replace(ld,"")),i=i.replace(/@\*/g,xn).replace(/@\w+/g,t=>xn+"-"+t.slice(1)).replace(/:animating/g,Xn),[i,e]}function dd(i){return i?F({},i):null}var ir=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(e){this.errors=e}};function ud(i){if(typeof i=="string")return null;let e=null;if(Array.isArray(i))i.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let t=i;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function md(i,e){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let r=bn(i,e).duration;return Xo(r,0,"")}let t=i;if(t.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=Xo(0,0,"");return r.dynamic=!0,r.strValue=t,r}let o=bn(t,e);return Xo(o.duration,o.delay,o.easing)}function Ot(i){return i?(i=F({},i),i.params&&(i.params=dd(i.params))):i={},i}function Xo(i,e,t){return{duration:i,delay:e,easing:t}}function gr(i,e,t,n,o,r,c=null,m=!1){return{type:1,element:i,keyframes:e,preStyleProps:t,postStyleProps:n,duration:o,delay:r,totalTime:o+r,easing:c,subTimeline:m}}var yn=class{_map=new Map;get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},pd=1,gd=":enter",hd=new RegExp(gd,"g"),fd=":leave",_d=new RegExp(fd,"g");function bl(i,e,t,n,o,r=new Map,c=new Map,m,h,g=[]){return new or().buildKeyframes(i,e,t,n,o,r,c,m,h,g)}var or=class{buildKeyframes(e,t,n,o,r,c,m,h,g,_=[]){g=g||new yn;let S=new rr(e,t,g,o,r,_,[]);S.options=h;let y=h.delay?ft(h.delay):0;S.currentTimeline.delayNextStep(y),S.currentTimeline.setStyles([c],null,S.errors,h),We(this,n,S);let D=S.timelines.filter(P=>P.containsAnimation());if(D.length&&m.size){let P;for(let R=D.length-1;R>=0;R--){let q=D[R];if(q.element===t){P=q;break}}P&&!P.allowOnlyTimelineStyles()&&P.setStyles([m],null,S.errors,h)}return D.length?D.map(P=>P.buildKeyframes()):[gr(t,[],[],[],0,y,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let o=t.createSubContext(e.options),r=t.currentTimeline.currentTime,c=this._visitSubInstructions(n,o,o.options);r!=c&&t.transformIntoNewTimeline(c)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let o of e){let r=o?.delay;if(r){let c=typeof r=="number"?r:ft(Xt(r,o?.params??{},t.errors));n.delayNextStep(c)}}}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime,c=n.duration!=null?ft(n.duration):null,m=n.delay!=null?ft(n.delay):null;return c!==0&&e.forEach(h=>{let g=t.appendInstructionToTimeline(h,c,m);r=Math.max(r,g.duration+g.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),We(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,o=t,r=e.options;if(r&&(r.params||r.delay)&&(o=t.createSubContext(r),o.transformIntoNewTimeline(),r.delay!=null)){o.previousNode.type==Se.Style&&(o.currentTimeline.snapshotCurrentStyles(),o.previousNode=si);let c=ft(r.delay);o.delayNextStep(c)}e.steps.length&&(e.steps.forEach(c=>We(this,c,o)),o.currentTimeline.applyStylesToKeyframe(),o.subContextCount>n&&o.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],o=t.currentTimeline.currentTime,r=e.options&&e.options.delay?ft(e.options.delay):0;e.steps.forEach(c=>{let m=t.createSubContext(e.options);r&&m.delayNextStep(r),We(this,c,m),o=Math.max(o,m.currentTimeline.currentTime),n.push(m.currentTimeline)}),n.forEach(c=>t.currentTimeline.mergeTimelineCollectedStyles(c)),t.transformIntoNewTimeline(o),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,o=t.params?Xt(n,t.params,t.errors):n;return bn(o,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),o=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),o.snapshotCurrentStyles());let r=e.style;r.type==Se.Keyframes?this.visitKeyframes(r,t):(t.incrementTime(n.duration),this.visitStyle(r,t),o.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,o=t.currentAnimateTimings;!o&&n.hasCurrentStyleProperties()&&n.forwardFrame();let r=o&&o.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(r):n.setStyles(e.styles,r,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,o=t.currentTimeline.duration,r=n.duration,m=t.createSubContext().currentTimeline;m.easing=n.easing,e.styles.forEach(h=>{let g=h.offset||0;m.forwardTime(g*r),m.setStyles(h.styles,h.easing,t.errors,t.options),m.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(m),t.transformIntoNewTimeline(o+r),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,o=e.options||{},r=o.delay?ft(o.delay):0;r&&(t.previousNode.type===Se.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=si);let c=n,m=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!o.optional,t.errors);t.currentQueryTotal=m.length;let h=null;m.forEach((g,_)=>{t.currentQueryIndex=_;let S=t.createSubContext(e.options,g);r&&S.delayNextStep(r),g===t.element&&(h=S.currentTimeline),We(this,e.animation,S),S.currentTimeline.applyStylesToKeyframe();let y=S.currentTimeline.currentTime;c=Math.max(c,y)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(c),h&&(t.currentTimeline.mergeTimelineCollectedStyles(h),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,o=t.currentTimeline,r=e.timings,c=Math.abs(r.duration),m=c*(t.currentQueryTotal-1),h=c*t.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":h=m-h;break;case"full":h=n.currentStaggerTime;break}let _=t.currentTimeline;h&&_.delayNextStep(h);let S=_.currentTime;We(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=o.currentTime-S+(o.startTime-n.currentTimeline.startTime)}},si={},rr=class i{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=si;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(e,t,n,o,r,c,m,h){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=o,this._leaveClassName=r,this.errors=c,this.timelines=m,this.currentTimeline=h||new ai(this._driver,t,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,o=this.options;n.duration!=null&&(o.duration=ft(n.duration)),n.delay!=null&&(o.delay=ft(n.delay));let r=n.params;if(r){let c=o.params;c||(c=this.options.params={}),Object.keys(r).forEach(m=>{(!t||!c.hasOwnProperty(m))&&(c[m]=Xt(r[m],c,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(o=>{n[o]=t[o]})}}return e}createSubContext(e=null,t,n){let o=t||this.element,r=new i(this._driver,o,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(o,n||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(e),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(e){return this.previousNode=si,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let o={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},r=new sr(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,o,e.stretchStartingKeyframe);return this.timelines.push(r),o}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,o,r,c){let m=[];if(o&&m.push(this.element),e.length>0){e=e.replace(hd,"."+this._enterClassName),e=e.replace(_d,"."+this._leaveClassName);let h=n!=1,g=this._driver.query(this.element,e,h);n!==0&&(g=n<0?g.slice(g.length+n,g.length):g.slice(0,n)),m.push(...g)}return!r&&m.length==0&&c.push(Ha(t)),m}},ai=class i{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(e,t,n,o){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=o,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new i(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=pd,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||st),this._currentKeyframe.set(t,st);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,o){t&&this._previousKeyframe.set("easing",t);let r=o&&o.params||{},c=Cd(e,this._globalTimelineStyles);for(let[m,h]of c){let g=Xt(h,r,n);this._pendingStyles.set(m,g),this._localTimelineStyles.has(m)||this._backFill.set(m,this._globalTimelineStyles.get(m)??st),this._updateStyle(m,g)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let o=this._styleSummary.get(n);(!o||t.time>o.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,o=[];this._keyframes.forEach((m,h)=>{let g=new Map([...this._backFill,...m]);g.forEach((_,S)=>{_===Cn?e.add(S):_===st&&t.add(S)}),n||g.set("offset",h/this.duration),o.push(g)});let r=[...e.values()],c=[...t.values()];if(n){let m=o[0],h=new Map(m);m.set("offset",0),h.set("offset",1),o=[m,h]}return gr(this.element,o,r,c,this.duration,this.startTime,this.easing,!1)}},sr=class extends ai{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(e,t,n,o,r,c,m=!1){super(e,t,c.delay),this.keyframes=n,this.preStyleProps=o,this.postStyleProps=r,this._stretchStartingKeyframe=m,this.timings={duration:c.duration,delay:c.delay,easing:c.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:o}=this.timings;if(this._stretchStartingKeyframe&&t){let r=[],c=n+t,m=t/c,h=new Map(e[0]);h.set("offset",0),r.push(h);let g=new Map(e[0]);g.set("offset",ul(m)),r.push(g);let _=e.length-1;for(let S=1;S<=_;S++){let y=new Map(e[S]),D=y.get("offset"),P=t+D*n;y.set("offset",ul(P/c)),r.push(y)}n=c,t=0,o="",e=r}return gr(this.element,e,this.preStyleProps,this.postStyleProps,n,t,o,!0)}};function ul(i,e=3){let t=Math.pow(10,e-1);return Math.round(i*t)/t}function Cd(i,e){let t=new Map,n;return i.forEach(o=>{if(o==="*"){n??=e.keys();for(let r of n)t.set(r,st)}else for(let[r,c]of o)t.set(r,c)}),t}function ml(i,e,t,n,o,r,c,m,h,g,_,S,y){return{type:0,element:i,triggerName:e,isRemovalTransition:o,fromState:t,fromStyles:r,toState:n,toStyles:c,timelines:m,queriedElements:h,preStyleProps:g,postStyleProps:_,totalTime:S,errors:y}}var Zo={},li=class{_triggerName;ast;_stateStyles;constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,o){return vd(this.ast.matchers,e,t,n,o)}buildStyles(e,t,n){let o=this._stateStyles.get("*");return e!==void 0&&(o=this._stateStyles.get(e?.toString())||o),o?o.buildStyles(t,n):new Map}build(e,t,n,o,r,c,m,h,g,_){let S=[],y=this.ast.options&&this.ast.options.params||Zo,D=m&&m.params||Zo,P=this.buildStyles(n,D,S),R=h&&h.params||Zo,q=this.buildStyles(o,R,S),U=new Set,Q=new Map,J=new Map,ee=o==="void",re={params:Sl(R,y),delay:this.ast.options?.delay},de=_?[]:bl(e,t,this.ast.animation,r,c,P,q,re,g,S),se=0;return de.forEach(be=>{se=Math.max(be.duration+be.delay,se)}),S.length?ml(t,this._triggerName,n,o,ee,P,q,[],[],Q,J,se,S):(de.forEach(be=>{let ae=be.element,Ce=ze(Q,ae,new Set);be.preStyleProps.forEach(Oe=>Ce.add(Oe));let Fe=ze(J,ae,new Set);be.postStyleProps.forEach(Oe=>Fe.add(Oe)),ae!==t&&U.add(ae)}),ml(t,this._triggerName,n,o,ee,P,q,de,[...U.values()],Q,J,se))}};function vd(i,e,t,n,o){return i.some(r=>r(e,t,n,o))}function Sl(i,e){let t=F({},e);return Object.entries(i).forEach(([n,o])=>{o!=null&&(t[n]=o)}),t}var ar=class{styles;defaultParams;normalizer;constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,o=Sl(e,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((c,m)=>{c&&(c=Xt(c,o,t));let h=this.normalizer.normalizePropertyName(m,t);c=this.normalizer.normalizeStyleValue(m,h,c,t),n.set(m,c)})}),n}};function xd(i,e,t){return new lr(i,e,t)}var lr=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,t.states.forEach(o=>{let r=o.options&&o.options.params||{};this.states.set(o.name,new ar(o.style,r,n))}),pl(this.states,"true","1"),pl(this.states,"false","0"),t.transitions.forEach(o=>{this.transitionFactories.push(new li(e,o,this.states))}),this.fallbackTransition=bd(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,o){return this.transitionFactories.find(c=>c.match(e,t,n,o))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function bd(i,e,t){let n=[(c,m)=>!0],o={type:Se.Sequence,steps:[],options:null},r={type:Se.Transition,animation:o,matchers:n,options:null,queryCount:0,depCount:0};return new li(i,r,e)}function pl(i,e,t){i.has(e)?i.has(t)||i.set(t,i.get(e)):i.has(t)&&i.set(e,i.get(t))}var Sd=new yn,cr=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n}register(e,t){let n=[],o=[],r=xl(this._driver,t,n,o);if(n.length)throw Ja(n);this._animations.set(e,r)}_buildPlayer(e,t,n){let o=e.element,r=$o(this._normalizer,e.keyframes,t,n);return this._driver.animate(o,r,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let o=[],r=this._animations.get(e),c,m=new Map;if(r?(c=bl(this._driver,t,r,Jo,Yn,new Map,new Map,n,Sd,o),c.forEach(_=>{let S=ze(m,_.element,new Map);_.postStyleProps.forEach(y=>S.set(y,null))})):(o.push(Qa()),c=[]),o.length)throw Ya(o);m.forEach((_,S)=>{_.forEach((y,D)=>{_.set(D,this._driver.computeStyle(S,D,st))})});let h=c.map(_=>{let S=m.get(_.element);return this._buildPlayer(_,new Map,S)}),g=St(h);return this._playersById.set(e,g),g.onDestroy(()=>this.destroy(e)),this.players.push(g),g}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw Xa(e);return t}listen(e,t,n,o){let r=Jn(t,"","","");return Wn(this._getPlayer(e),n,r,o),()=>{}}command(e,t,n,o){if(n=="register"){this.register(e,o[0]);return}if(n=="create"){let c=o[0]||{};this.create(e,t,c);return}let r=this._getPlayer(e);switch(n){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(o[0]));break;case"destroy":this.destroy(e);break}}},gl="ng-animate-queued",yd=".ng-animate-queued",jo="ng-animate-disabled",wd=".ng-animate-disabled",Ed="ng-star-inserted",Ad=".ng-star-inserted",Dd=[],yl={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Md={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},lt="__ng_removed",wn=class{namespaceId;value;options;get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),o=n?e.value:e;if(this.value=Id(o),n){let r=e,{value:c}=r,m=Rn(r,["value"]);this.options=m}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(o=>{n[o]==null&&(n[o]=t[o])})}}},Sn="void",er=new wn(Sn),dr=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this._hostClassName="ng-tns-"+e,it(t,this._hostClassName)}listen(e,t,n,o){if(!this._triggers.has(t))throw Za(n,t);if(n==null||n.length==0)throw ja(t);if(!kd(n))throw el(n,t);let r=ze(this._elementListeners,e,[]),c={name:t,phase:n,callback:o};r.push(c);let m=ze(this._engine.statesByElement,e,new Map);return m.has(t)||(it(e,vn),it(e,vn+"-"+t),m.set(t,er)),()=>{this._engine.afterFlush(()=>{let h=r.indexOf(c);h>=0&&r.splice(h,1),this._triggers.has(t)||m.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw tl(e);return t}trigger(e,t,n,o=!0){let r=this._getTrigger(t),c=new En(this.id,t,e),m=this._engine.statesByElement.get(e);m||(it(e,vn),it(e,vn+"-"+t),this._engine.statesByElement.set(e,m=new Map));let h=m.get(t),g=new wn(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&h&&g.absorbOptions(h.options),m.set(t,g),h||(h=er),!(g.value===Sn)&&h.value===g.value){if(!Rd(h.params,g.params)){let R=[],q=r.matchStyles(h.value,h.params,R),U=r.matchStyles(g.value,g.params,R);R.length?this._engine.reportError(R):this._engine.afterFlush(()=>{It(e,q),at(e,U)})}return}let y=ze(this._engine.playersByElement,e,[]);y.forEach(R=>{R.namespaceId==this.id&&R.triggerName==t&&R.queued&&R.destroy()});let D=r.matchTransition(h.value,g.value,e,g.params),P=!1;if(!D){if(!o)return;D=r.fallbackTransition,P=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:D,fromState:h,toState:g,player:c,isFallbackTransition:P}),P||(it(e,gl),c.onStart(()=>{Zt(e,gl)})),c.onDone(()=>{let R=this.players.indexOf(c);R>=0&&this.players.splice(R,1);let q=this._engine.playersByElement.get(e);if(q){let U=q.indexOf(c);U>=0&&q.splice(U,1)}}),this.players.push(c),y.push(c),c}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(o=>o.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,xn,!0);n.forEach(o=>{if(o[lt])return;let r=this._engine.fetchNamespacesByElement(o);r.size?r.forEach(c=>c.triggerLeaveAnimation(o,t,!1,!0)):this.clearElementCache(o)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(o=>this.clearElementCache(o)))}triggerLeaveAnimation(e,t,n,o){let r=this._engine.statesByElement.get(e),c=new Map;if(r){let m=[];if(r.forEach((h,g)=>{if(c.set(g,h.value),this._triggers.has(g)){let _=this.trigger(e,g,Sn,o);_&&m.push(_)}}),m.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,c),n&&St(m).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let o=new Set;t.forEach(r=>{let c=r.name;if(o.has(c))return;o.add(c);let h=this._triggers.get(c).fallbackTransition,g=n.get(c)||er,_=new wn(Sn),S=new En(this.id,c,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:c,transition:h,fromState:g,toState:_,player:S,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let o=!1;if(n.totalAnimations){let r=n.players.length?n.playersByQueriedElement.get(e):[];if(r&&r.length)o=!0;else{let c=e;for(;c=c.parentNode;)if(n.statesByElement.get(c)){o=!0;break}}}if(this.prepareLeaveAnimationListeners(e),o)n.markElementAsRemoved(this.id,e,!1,t);else{let r=e[lt];(!r||r===yl)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){it(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let o=n.player;if(o.destroyed)return;let r=n.element,c=this._elementListeners.get(r);c&&c.forEach(m=>{if(m.name==n.triggerName){let h=Jn(r,n.triggerName,n.fromState.value,n.toState.value);h._data=e,Wn(n.player,m.phase,h,m.callback)}}),o.markedForDestroy?this._engine.afterFlush(()=>{o.destroy()}):t.push(n)}),this._queue=[],t.sort((n,o)=>{let r=n.transition.ast.depCount,c=o.transition.ast.depCount;return r==0||c==0?r-c:this._engine.driver.containsElement(n.element,o.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},ur=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(e,t)=>{};_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new dr(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,o=this.namespacesByHostElement;if(n.length-1>=0){let c=!1,m=this.driver.getParentElement(t);for(;m;){let h=o.get(m);if(h){let g=n.indexOf(h);n.splice(g+1,0,e),c=!0;break}m=this.driver.getParentElement(m)}c||n.unshift(e)}else n.push(e);return o.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let o=this._namespaceLookup[e];o&&o.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let o=this._namespaceList.indexOf(n);o>=0&&this._namespaceList.splice(o,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let o of n.values())if(o.namespaceId){let r=this._fetchNamespace(o.namespaceId);r&&t.add(r)}}return t}trigger(e,t,n,o){if(ni(t)){let r=this._fetchNamespace(e);if(r)return r.trigger(t,n,o),!0}return!1}insertNode(e,t,n,o){if(!ni(t))return;let r=t[lt];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let c=this.collectedLeaveElements.indexOf(t);c>=0&&this.collectedLeaveElements.splice(c,1)}if(e){let c=this._fetchNamespace(e);c&&c.insertNode(t,n)}o&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),it(e,jo)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Zt(e,jo))}removeNode(e,t,n){if(ni(t)){let o=e?this._fetchNamespace(e):null;o?o.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let r=this.namespacesByHostElement.get(t);r&&r.id!==e&&r.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,o,r){this.collectedLeaveElements.push(t),t[lt]={namespaceId:e,setForRemoval:o,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:r}}listen(e,t,n,o,r){return ni(t)?this._fetchNamespace(e).listen(t,n,o,r):()=>{}}_buildInstruction(e,t,n,o,r){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,o,e.fromState.options,e.toState.options,t,r)}destroyInnerAnimations(e){let t=this.driver.query(e,xn,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,Xn,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return St(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[lt];if(t&&t.setForRemoval){if(e[lt]=yl,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(jo)&&this.markElementAsDisabled(e,!1),this.driver.query(e,wd,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,o)=>this._balanceNamespaceList(n,o)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let o=this.collectedEnterElements[n];it(o,Ed)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let o=0;o<n.length;o++)n[o]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let o=this.collectedLeaveElements[n];this.processLeaveNode(o)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?St(t).onDone(()=>{n.forEach(o=>o())}):n.forEach(o=>o())}}reportError(e){throw nl(e)}_flushAnimations(e,t){let n=new yn,o=[],r=new Map,c=[],m=new Map,h=new Map,g=new Map,_=new Set;this.disabledNodes.forEach(Z=>{_.add(Z);let ne=this.driver.query(Z,yd,!0);for(let ce=0;ce<ne.length;ce++)_.add(ne[ce])});let S=this.bodyNode,y=Array.from(this.statesByElement.keys()),D=_l(y,this.collectedEnterElements),P=new Map,R=0;D.forEach((Z,ne)=>{let ce=Jo+R++;P.set(ne,ce),Z.forEach(ye=>it(ye,ce))});let q=[],U=new Set,Q=new Set;for(let Z=0;Z<this.collectedLeaveElements.length;Z++){let ne=this.collectedLeaveElements[Z],ce=ne[lt];ce&&ce.setForRemoval&&(q.push(ne),U.add(ne),ce.hasAnimation?this.driver.query(ne,Ad,!0).forEach(ye=>U.add(ye)):Q.add(ne))}let J=new Map,ee=_l(y,Array.from(U));ee.forEach((Z,ne)=>{let ce=Yn+R++;J.set(ne,ce),Z.forEach(ye=>it(ye,ce))}),e.push(()=>{D.forEach((Z,ne)=>{let ce=P.get(ne);Z.forEach(ye=>Zt(ye,ce))}),ee.forEach((Z,ne)=>{let ce=J.get(ne);Z.forEach(ye=>Zt(ye,ce))}),q.forEach(Z=>{this.processLeaveNode(Z)})});let re=[],de=[];for(let Z=this._namespaceList.length-1;Z>=0;Z--)this._namespaceList[Z].drainQueuedTransitions(t).forEach(ce=>{let ye=ce.player,Be=ce.element;if(re.push(ye),this.collectedEnterElements.length){let Ge=Be[lt];if(Ge&&Ge.setForMove){if(Ge.previousTriggersValues&&Ge.previousTriggersValues.has(ce.triggerName)){let Nt=Ge.previousTriggersValues.get(ce.triggerName),Ze=this.statesByElement.get(ce.element);if(Ze&&Ze.has(ce.triggerName)){let Fn=Ze.get(ce.triggerName);Fn.value=Nt,Ze.set(ce.triggerName,Fn)}}ye.destroy();return}}let pt=!S||!this.driver.containsElement(S,Be),Xe=J.get(Be),Et=P.get(Be),Pe=this._buildInstruction(ce,n,Et,Xe,pt);if(Pe.errors&&Pe.errors.length){de.push(Pe);return}if(pt){ye.onStart(()=>It(Be,Pe.fromStyles)),ye.onDestroy(()=>at(Be,Pe.toStyles)),o.push(ye);return}if(ce.isFallbackTransition){ye.onStart(()=>It(Be,Pe.fromStyles)),ye.onDestroy(()=>at(Be,Pe.toStyles)),o.push(ye);return}let ws=[];Pe.timelines.forEach(Ge=>{Ge.stretchStartingKeyframe=!0,this.disabledNodes.has(Ge.element)||ws.push(Ge)}),Pe.timelines=ws,n.append(Be,Pe.timelines);let $c={instruction:Pe,player:ye,element:Be};c.push($c),Pe.queriedElements.forEach(Ge=>ze(m,Ge,[]).push(ye)),Pe.preStyleProps.forEach((Ge,Nt)=>{if(Ge.size){let Ze=h.get(Nt);Ze||h.set(Nt,Ze=new Set),Ge.forEach((Fn,Bo)=>Ze.add(Bo))}}),Pe.postStyleProps.forEach((Ge,Nt)=>{let Ze=g.get(Nt);Ze||g.set(Nt,Ze=new Set),Ge.forEach((Fn,Bo)=>Ze.add(Bo))})});if(de.length){let Z=[];de.forEach(ne=>{Z.push(il(ne.triggerName,ne.errors))}),re.forEach(ne=>ne.destroy()),this.reportError(Z)}let se=new Map,be=new Map;c.forEach(Z=>{let ne=Z.element;n.has(ne)&&(be.set(ne,ne),this._beforeAnimationBuild(Z.player.namespaceId,Z.instruction,se))}),o.forEach(Z=>{let ne=Z.element;this._getPreviousPlayers(ne,!1,Z.namespaceId,Z.triggerName,null).forEach(ye=>{ze(se,ne,[]).push(ye),ye.destroy()})});let ae=q.filter(Z=>Cl(Z,h,g)),Ce=new Map;fl(Ce,this.driver,Q,g,st).forEach(Z=>{Cl(Z,h,g)&&ae.push(Z)});let Oe=new Map;D.forEach((Z,ne)=>{fl(Oe,this.driver,new Set(Z),h,Cn)}),ae.forEach(Z=>{let ne=Ce.get(Z),ce=Oe.get(Z);Ce.set(Z,new Map([...ne?.entries()??[],...ce?.entries()??[]]))});let Me=[],Ye=[],pn={};c.forEach(Z=>{let{element:ne,player:ce,instruction:ye}=Z;if(n.has(ne)){if(_.has(ne)){ce.onDestroy(()=>at(ne,ye.toStyles)),ce.disabled=!0,ce.overrideTotalTime(ye.totalTime),o.push(ce);return}let Be=pn;if(be.size>1){let Xe=ne,Et=[];for(;Xe=Xe.parentNode;){let Pe=be.get(Xe);if(Pe){Be=Pe;break}Et.push(Xe)}Et.forEach(Pe=>be.set(Pe,Be))}let pt=this._buildAnimation(ce.namespaceId,ye,se,r,Oe,Ce);if(ce.setRealPlayer(pt),Be===pn)Me.push(ce);else{let Xe=this.playersByElement.get(Be);Xe&&Xe.length&&(ce.parentPlayer=St(Xe)),o.push(ce)}}else It(ne,ye.fromStyles),ce.onDestroy(()=>at(ne,ye.toStyles)),Ye.push(ce),_.has(ne)&&o.push(ce)}),Ye.forEach(Z=>{let ne=r.get(Z.element);if(ne&&ne.length){let ce=St(ne);Z.setRealPlayer(ce)}}),o.forEach(Z=>{Z.parentPlayer?Z.syncPlayerEvents(Z.parentPlayer):Z.destroy()});for(let Z=0;Z<q.length;Z++){let ne=q[Z],ce=ne[lt];if(Zt(ne,Yn),ce&&ce.hasAnimation)continue;let ye=[];if(m.size){let pt=m.get(ne);pt&&pt.length&&ye.push(...pt);let Xe=this.driver.query(ne,Xn,!0);for(let Et=0;Et<Xe.length;Et++){let Pe=m.get(Xe[Et]);Pe&&Pe.length&&ye.push(...Pe)}}let Be=ye.filter(pt=>!pt.destroyed);Be.length?Pd(this,ne,Be):this.processLeaveNode(ne)}return q.length=0,Me.forEach(Z=>{this.players.push(Z),Z.onDone(()=>{Z.destroy();let ne=this.players.indexOf(Z);this.players.splice(ne,1)}),Z.play()}),Me}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,o,r){let c=[];if(t){let m=this.playersByQueriedElement.get(e);m&&(c=m)}else{let m=this.playersByElement.get(e);if(m){let h=!r||r==Sn;m.forEach(g=>{g.queued||!h&&g.triggerName!=o||c.push(g)})}}return(n||o)&&(c=c.filter(m=>!(n&&n!=m.namespaceId||o&&o!=m.triggerName))),c}_beforeAnimationBuild(e,t,n){let o=t.triggerName,r=t.element,c=t.isRemovalTransition?void 0:e,m=t.isRemovalTransition?void 0:o;for(let h of t.timelines){let g=h.element,_=g!==r,S=ze(n,g,[]);this._getPreviousPlayers(g,_,c,m,t.toState).forEach(D=>{let P=D.getRealPlayer();P.beforeDestroy&&P.beforeDestroy(),D.destroy(),S.push(D)})}It(r,t.fromStyles)}_buildAnimation(e,t,n,o,r,c){let m=t.triggerName,h=t.element,g=[],_=new Set,S=new Set,y=t.timelines.map(P=>{let R=P.element;_.add(R);let q=R[lt];if(q&&q.removedBeforeQueried)return new Vt(P.duration,P.delay);let U=R!==h,Q=Fd((n.get(R)||Dd).map(se=>se.getRealPlayer())).filter(se=>{let be=se;return be.element?be.element===R:!1}),J=r.get(R),ee=c.get(R),re=$o(this._normalizer,P.keyframes,J,ee),de=this._buildPlayer(P,re,Q);if(P.subTimeline&&o&&S.add(R),U){let se=new En(e,m,R);se.setRealPlayer(de),g.push(se)}return de});g.forEach(P=>{ze(this.playersByQueriedElement,P.element,[]).push(P),P.onDone(()=>Td(this.playersByQueriedElement,P.element,P))}),_.forEach(P=>it(P,Qo));let D=St(y);return D.onDestroy(()=>{_.forEach(P=>Zt(P,Qo)),at(h,t.toStyles)}),S.forEach(P=>{ze(o,P,[]).push(D)}),D}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new Vt(e.duration,e.delay)}},En=class{namespaceId;triggerName;element;_player=new Vt;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(o=>Wn(e,n,void 0,o))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){ze(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function Td(i,e,t){let n=i.get(e);if(n){if(n.length){let o=n.indexOf(t);n.splice(o,1)}n.length==0&&i.delete(e)}return n}function Id(i){return i??null}function ni(i){return i&&i.nodeType===1}function kd(i){return i=="start"||i=="done"}function hl(i,e){let t=i.style.display;return i.style.display=e??"none",t}function fl(i,e,t,n,o){let r=[];t.forEach(h=>r.push(hl(h)));let c=[];n.forEach((h,g)=>{let _=new Map;h.forEach(S=>{let y=e.computeStyle(g,S,o);_.set(S,y),(!y||y.length==0)&&(g[lt]=Md,c.push(g))}),i.set(g,_)});let m=0;return t.forEach(h=>hl(h,r[m++])),c}function _l(i,e){let t=new Map;if(i.forEach(m=>t.set(m,[])),e.length==0)return t;let n=1,o=new Set(e),r=new Map;function c(m){if(!m)return n;let h=r.get(m);if(h)return h;let g=m.parentNode;return t.has(g)?h=g:o.has(g)?h=n:h=c(g),r.set(m,h),h}return e.forEach(m=>{let h=c(m);h!==n&&t.get(h).push(m)}),t}function it(i,e){i.classList?.add(e)}function Zt(i,e){i.classList?.remove(e)}function Pd(i,e,t){St(t).onDone(()=>i.processLeaveNode(e))}function Fd(i){let e=[];return wl(i,e),e}function wl(i,e){for(let t=0;t<i.length;t++){let n=i[t];n instanceof Gn?wl(n.players,e):e.push(n)}}function Rd(i,e){let t=Object.keys(i),n=Object.keys(e);if(t.length!=n.length)return!1;for(let o=0;o<t.length;o++){let r=t[o];if(!e.hasOwnProperty(r)||i[r]!==e[r])return!1}return!0}function Cl(i,e,t){let n=t.get(i);if(!n)return!1;let o=e.get(i);return o?n.forEach(r=>o.add(r)):e.set(i,n),t.delete(i),!0}var jt=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(e,t)=>{};constructor(e,t,n){this._driver=t,this._normalizer=n,this._transitionEngine=new ur(e.body,t,n),this._timelineEngine=new cr(e.body,t,n),this._transitionEngine.onRemovalComplete=(o,r)=>this.onRemovalComplete(o,r)}registerTrigger(e,t,n,o,r){let c=e+"-"+o,m=this._triggerCache[c];if(!m){let h=[],g=[],_=xl(this._driver,r,h,g);if(h.length)throw Wa(o,h);m=xd(o,_,this._normalizer),this._triggerCache[c]=m}this._transitionEngine.registerTrigger(t,o,m)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,o){this._transitionEngine.insertNode(e,t,n,o)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,o){if(n.charAt(0)=="@"){let[r,c]=Ho(n),m=o;this._timelineEngine.command(r,t,c,m)}else this._transitionEngine.trigger(e,t,n,o)}listen(e,t,n,o,r){if(n.charAt(0)=="@"){let[c,m]=Ho(n);return this._timelineEngine.listen(c,t,m,r)}return this._transitionEngine.listen(e,t,n,o,r)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function Nd(i,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=tr(e[0]),e.length>1&&(n=tr(e[e.length-1]))):e instanceof Map&&(t=tr(e)),t||n?new Bd(i,t,n):null}var Bd=(()=>{class i{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(t,n,o){this._element=t,this._startStyles=n,this._endStyles=o;let r=i.initialStylesByElement.get(t);r||i.initialStylesByElement.set(t,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&at(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(at(this._element,this._initialStyles),this._endStyles&&(at(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(It(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(It(this._element,this._endStyles),this._endStyles=null),at(this._element,this._initialStyles),this._state=3)}}return i})();function tr(i){let e=null;return i.forEach((t,n)=>{Vd(n)&&(e=e||new Map,e.set(n,t))}),e}function Vd(i){return i==="display"||i==="position"}var ci=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer=null;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(e,t,n,o){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=o,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer()&&this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return this.domPlayer;this._initialized=!0;let e=this.keyframes,t=this._triggerWebAnimation(this.element,e,this.options);if(!t)return this._onFinish(),null;this.domPlayer=t,this._finalKeyframe=e.length?e[e.length-1]:new Map;let n=()=>this._onFinish();return t.addEventListener("finish",n),this.onDestroy(()=>{t.removeEventListener("finish",n)}),t}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer?.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){let o=this._convertKeyframesToObject(t);try{return e.animate(o,n)}catch{return null}}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){let e=this._buildPlayer();e&&(this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),e.play())}pause(){this.init(),this.domPlayer?.pause()}finish(){this.init(),this.domPlayer&&(this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish())}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer?.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer||this.init(),this.domPlayer&&(this.domPlayer.currentTime=e*this.time)}getPosition(){return this.domPlayer?+(this.domPlayer.currentTime??0)/this.time:this._initialized?1:0}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,o)=>{o!=="offset"&&e.set(o,this._finished?n:jn(this.element,o))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},di=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return Ko(e,t)}getParentElement(e){return Qn(e)}query(e,t,n){return zo(e,t,n)}computeStyle(e,t,n){return jn(e,t)}animate(e,t,n,o,r,c=[]){let m=o==0?"both":"forwards",h={duration:n,delay:o,fill:m};r&&(h.easing=r);let g=new Map,_=c.filter(D=>D instanceof ci);al(n,o)&&_.forEach(D=>{D.currentSnapshot.forEach((P,R)=>g.set(R,P))});let S=rl(t).map(D=>new Map(D));S=ll(e,S,g);let y=Nd(e,S);return new ci(e,S,h,y)}};var ii="@",El="@.disabled",ui=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(e,t,n,o){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=o}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,o=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,o)}removeChild(e,t,n,o){if(o){this.delegate.removeChild(e,t,n,o);return}this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,o){this.delegate.setAttribute(e,t,n,o)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,o){this.delegate.setStyle(e,t,n,o)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==ii&&t==El?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n,o){return this.delegate.listen(e,t,n,o)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},mr=class extends ui{factory;constructor(e,t,n,o,r){super(t,n,o,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==ii?t.charAt(1)=="."&&t==El?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n,o){if(t.charAt(0)==ii){let r=Ld(e),c=t.slice(1),m="";return c.charAt(0)!=ii&&([c,m]=Od(c)),this.engine.listen(this.namespaceId,r,c,m,h=>{let g=h._data||-1;this.factory.scheduleListenerCallback(g,n,h)})}return this.delegate.listen(e,t,n,o)}};function Ld(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function Od(i){let e=i.indexOf("."),t=i.substring(0,e),n=i.slice(e+1);return[t,n]}var mi=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,t.onRemovalComplete=(o,r)=>{r?.removeChild(null,o)}}createRenderer(e,t){let o=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let g=this._rendererCache,_=g.get(o);if(!_){let S=()=>g.delete(o);_=new ui("",o,this.engine,S),g.set(o,_)}return _}let r=t.id,c=t.id+"-"+this._currentId;this._currentId++,this.engine.register(c,e);let m=g=>{Array.isArray(g)?g.forEach(m):this.engine.registerTrigger(r,c,e,g.name,g)};return t.data.animation.forEach(m),new mr(this,c,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let o=this._animationCallbacksBuffer;o.length==0&&queueMicrotask(()=>{this._zone.run(()=>{o.forEach(r=>{let[c,m]=r;c(m)}),this._animationCallbacksBuffer=[]})}),o.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(e){this.engine.flush(),this.delegate.componentReplaced?.(e)}};var Ud=(()=>{class i extends jt{constructor(t,n,o){super(t,n,o)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||i)(rt(Nn),rt(Gt),rt(Ut))};static \u0275prov=Te({token:i,factory:i.\u0275fac})}return i})();function qd(){return new oi}function $d(){return new mi(B(Ls),B(jt),B(At))}var Al=[{provide:Ut,useFactory:qd},{provide:jt,useClass:Ud},{provide:Ms,useFactory:$d}],$3=[{provide:Gt,useClass:pr},{provide:Vo,useValue:"NoopAnimations"},...Al],Hd=[{provide:Gt,useFactory:()=>new di},{provide:Vo,useFactory:()=>"BrowserAnimations"},...Al];function Dl(){return Ds("NgEagerAnimations"),[...Hd]}var Kd,zd;function Wd(){return{geminiUrl:Kd,vertexUrl:zd}}function Jd(i,e,t,n){var o,r;if(!i?.baseUrl){let c=Wd();return e?(o=c.vertexUrl)!==null&&o!==void 0?o:t:(r=c.geminiUrl)!==null&&r!==void 0?r:n}return i.baseUrl}var ut=class{};function X(i,e){let t=/\{([^}]+)\}/g;return i.replace(t,(n,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){let r=e[o];return r!=null?String(r):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function p(i,e,t){for(let r=0;r<e.length-1;r++){let c=e[r];if(c.endsWith("[]")){let m=c.slice(0,-2);if(!(m in i))if(Array.isArray(t))i[m]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(i[m])){let h=i[m];if(Array.isArray(t))for(let g=0;g<h.length;g++){let _=h[g];p(_,e.slice(r+1),t[g])}else for(let g of h)p(g,e.slice(r+1),t)}return}else if(c.endsWith("[0]")){let m=c.slice(0,-3);m in i||(i[m]=[{}]);let h=i[m];p(h[0],e.slice(r+1),t);return}(!i[c]||typeof i[c]!="object")&&(i[c]={}),i=i[c]}let n=e[e.length-1],o=i[n];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function u(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;let o=e[n];if(o.endsWith("[]")){let r=o.slice(0,-2);if(r in i){let c=i[r];return Array.isArray(c)?c.map(m=>u(m,e.slice(n+1),t)):t}else return t}else i=i[o]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function Qd(i,e){for(let[t,n]of Object.entries(e)){let o=t.split("."),r=n.split("."),c=new Set,m=-1;for(let h=0;h<o.length;h++)if(o[h]==="*"){m=h;break}if(m!==-1&&r.length>m)for(let h=m;h<r.length;h++){let g=r[h];g!=="*"&&!g.endsWith("[]")&&!g.endsWith("[0]")&&c.add(g)}_r(i,o,r,0,c)}}function _r(i,e,t,n,o){if(n>=e.length||typeof i!="object"||i===null)return;let r=e[n];if(r.endsWith("[]")){let c=r.slice(0,-2),m=i;if(c in m&&Array.isArray(m[c]))for(let h of m[c])_r(h,e,t,n+1,o)}else if(r==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let c=i,m=Object.keys(c).filter(g=>!g.startsWith("_")&&!o.has(g)),h={};for(let g of m)h[g]=c[g];for(let[g,_]of Object.entries(h)){let S=[];for(let y of t.slice(n))y==="*"?S.push(g):S.push(y);p(c,S,_)}for(let g of m)delete c[g]}}else{let c=i;r in c&&_r(c[r],e,t,n+1,o)}}function hs(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function Yd(i){let e={},t=u(i,["operationName"]);t!=null&&p(e,["operationName"],t);let n=u(i,["resourceName"]);return n!=null&&p(e,["_url","resourceName"],n),e}function Xd(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["response","generateVideoResponse"]);return c!=null&&p(e,["response"],jd(c)),e}function Zd(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["response"]);return c!=null&&p(e,["response"],eu(c)),e}function jd(i){let e={},t=u(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(c=>tu(c))),p(e,["generatedVideos"],r)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function eu(i){let e={},t=u(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(c=>nu(c))),p(e,["generatedVideos"],r)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function tu(i){let e={},t=u(i,["video"]);return t!=null&&p(e,["video"],lu(t)),e}function nu(i){let e={},t=u(i,["_self"]);return t!=null&&p(e,["video"],cu(t)),e}function iu(i){let e={},t=u(i,["operationName"]);return t!=null&&p(e,["_url","operationName"],t),e}function ou(i){let e={},t=u(i,["operationName"]);return t!=null&&p(e,["_url","operationName"],t),e}function ru(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["response"]);return c!=null&&p(e,["response"],su(c)),e}function su(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["parent"]);n!=null&&p(e,["parent"],n);let o=u(i,["documentName"]);return o!=null&&p(e,["documentName"],o),e}function jl(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["response"]);return c!=null&&p(e,["response"],au(c)),e}function au(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["parent"]);n!=null&&p(e,["parent"],n);let o=u(i,["documentName"]);return o!=null&&p(e,["documentName"],o),e}function lu(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["uri"],t);let n=u(i,["encodedVideo"]);n!=null&&p(e,["videoBytes"],hs(n));let o=u(i,["encoding"]);return o!=null&&p(e,["mimeType"],o),e}function cu(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["uri"],t);let n=u(i,["bytesBase64Encoded"]);n!=null&&p(e,["videoBytes"],hs(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}var Ht=(function(i){return i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL",i})(Ht||{});var Cr=(function(i){return i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO",i})(Cr||{});var ec=(function(i){return i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",i})(ec||{});var Dn=(function(i){return i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT",i})(Dn||{});var Tn=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var $t=class{get text(){var e,t,n,o,r,c,m,h;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let g="",_=!1,S=[];for(let y of(h=(m=(c=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||c===void 0?void 0:c.content)===null||m===void 0?void 0:m.parts)!==null&&h!==void 0?h:[]){for(let[D,P]of Object.entries(y))D!=="text"&&D!=="thought"&&D!=="thoughtSignature"&&(P!==null||P!==void 0)&&S.push(D);if(typeof y.text=="string"){if(typeof y.thought=="boolean"&&y.thought)continue;_=!0,g+=y.text}}return S.length>0&&console.warn(`there are non-text parts ${S} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),_?g:void 0}get data(){var e,t,n,o,r,c,m,h;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let g="",_=[];for(let S of(h=(m=(c=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||c===void 0?void 0:c.content)===null||m===void 0?void 0:m.parts)!==null&&h!==void 0?h:[]){for(let[y,D]of Object.entries(S))y!=="inlineData"&&(D!==null||D!==void 0)&&_.push(y);S.inlineData&&typeof S.inlineData.data=="string"&&(g+=atob(S.inlineData.data))}return _.length>0&&console.warn(`there are non-data parts ${_} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),g.length>0?btoa(g):void 0}get functionCalls(){var e,t,n,o,r,c,m,h;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let g=(h=(m=(c=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||c===void 0?void 0:c.content)===null||m===void 0?void 0:m.parts)===null||h===void 0?void 0:h.filter(_=>_.functionCall).map(_=>_.functionCall).filter(_=>_!==void 0);if(g?.length!==0)return g}get executableCode(){var e,t,n,o,r,c,m,h,g;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let _=(h=(m=(c=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||c===void 0?void 0:c.content)===null||m===void 0?void 0:m.parts)===null||h===void 0?void 0:h.filter(S=>S.executableCode).map(S=>S.executableCode).filter(S=>S!==void 0);if(_?.length!==0)return(g=_?.[0])===null||g===void 0?void 0:g.code}get codeExecutionResult(){var e,t,n,o,r,c,m,h,g;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let _=(h=(m=(c=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||c===void 0?void 0:c.content)===null||m===void 0?void 0:m.parts)===null||h===void 0?void 0:h.filter(S=>S.codeExecutionResult).map(S=>S.codeExecutionResult).filter(S=>S!==void 0);if(_?.length!==0)return(g=_?.[0])===null||g===void 0?void 0:g.output}},xi=class{},bi=class{},vr=class{},xr=class{},br=class{},Sr=class{},Si=class{},yi=class{},wi=class{},yr=class{};var Ei=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,o,r=e;return t?o=Zd(r):o=Xd(r),Object.assign(n,o),n}},Ai=class{},Di=class{},Mi=class{},Ti=class{},wr=class{},Er=class{},Ar=class{};var Dr=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=ru(e);return Object.assign(n,r),n}},Mr=class{},Tr=class{},Ir=class{};var Ii=class{};var kr=class{get text(){var e,t,n;let o="",r=!1,c=[];for(let m of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[h,g]of Object.entries(m))h!=="text"&&h!=="thought"&&g!==null&&c.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;r=!0,o+=m.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?o:void 0}get data(){var e,t,n;let o="",r=[];for(let c of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[m,h]of Object.entries(c))m!=="inlineData"&&h!==null&&r.push(m);c.inlineData&&typeof c.inlineData.data=="string"&&(o+=atob(c.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}};var Pr=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Fr=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=jl(e);return Object.assign(n,r),n}};function Ae(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function tc(i,e){let t=Ae(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function nc(i){return Array.isArray(i)?i.map(e=>ki(e)):[ki(i)]}function ki(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function ic(i){let e=ki(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function oc(i){let e=ki(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ml(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function rc(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>Ml(e)):[Ml(i)]}function Rr(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function Tl(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function Il(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function qe(i){if(i==null)throw new Error("ContentUnion is required");return Rr(i)?i:{role:"user",parts:rc(i)}}function fs(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=qe(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){let t=qe(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>qe(t)):[qe(e)]}function ot(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(Tl(i)||Il(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[qe(i)]}let e=[],t=[],n=Rr(i[0]);for(let o of i){let r=Rr(o);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(o);else{if(Tl(o)||Il(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return n||e.push({role:"user",parts:rc(t)}),e}function du(i,e){i.includes("null")&&(e.nullable=!0);let t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(Ht).includes(t[0].toUpperCase())?t[0].toUpperCase():Ht.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(Ht).includes(n.toUpperCase())?n.toUpperCase():Ht.TYPE_UNSPECIFIED})}}function tn(i){let e={},t=["items"],n=["anyOf"],o=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");let r=i.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,i=r[1]):r[1].type==="null"&&(e.nullable=!0,i=r[0])),i.type instanceof Array&&du(i.type,e);for(let[c,m]of Object.entries(i))if(m!=null)if(c=="type"){if(m==="null")throw new Error("type: null can not be the only possible type for the field.");if(m instanceof Array)continue;e.type=Object.values(Ht).includes(m.toUpperCase())?m.toUpperCase():Ht.TYPE_UNSPECIFIED}else if(t.includes(c))e[c]=tn(m);else if(n.includes(c)){let h=[];for(let g of m){if(g.type=="null"){e.nullable=!0;continue}h.push(tn(g))}e[c]=h}else if(o.includes(c)){let h={};for(let[g,_]of Object.entries(m))h[g]=tn(_);e[c]=h}else{if(c==="additionalProperties")continue;e[c]=m}return e}function _s(i){return tn(i)}function Cs(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function vs(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function sn(i){if(i.functionDeclarations)for(let e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=tn(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=tn(e.response));return i}function an(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of i)e.push(t);return e}function uu(i,e,t,n=1){let o=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:o?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function wt(i,e){if(typeof e!="string")throw new Error("name must be a string");return uu(i,e,"cachedContents")}function sc(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function kt(i){return hs(i)}function mu(i){return i!=null&&typeof i=="object"&&"name"in i}function pu(i){return i!=null&&typeof i=="object"&&"video"in i}function gu(i){return i!=null&&typeof i=="object"&&"uri"in i}function ac(i){var e;let t;if(mu(i)&&(t=i.name),!(gu(i)&&(t=i.uri,t===void 0))&&!(pu(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function lc(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function cc(i){for(let e of["models","tunedModels","publisherModels"])if(hu(i,e))return i[e];return[]}function hu(i,e){return i!==null&&typeof i=="object"&&e in i}function fu(i,e={}){let t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function _u(i,e={}){let t=[],n=new Set;for(let o of i){let r=o.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);let c=fu(o,e);c.functionDeclarations&&t.push(...c.functionDeclarations)}return{functionDeclarations:t}}function dc(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(o>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function Cu(i){if(typeof i!="string")return i;let e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function uc(i){if(typeof i!="object"||i===null)return{};let e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;let o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return i;let r=!1;for(let c of o){if(typeof c!="object"||c===null)continue;let h=c.response;if(typeof h!="object"||h===null)continue;if(h.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function ln(i,e){let t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function mc(i){let e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function vu(i){let e={},t=u(i,["responsesFile"]);t!=null&&p(e,["fileName"],t);let n=u(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>ju(c))),p(e,["inlinedResponses"],r)}let o=u(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["inlinedEmbedContentResponses"],r)}return e}function xu(i){let e={},t=u(i,["predictionsFormat"]);t!=null&&p(e,["format"],t);let n=u(i,["gcsDestination","outputUriPrefix"]);n!=null&&p(e,["gcsUri"],n);let o=u(i,["bigqueryDestination","outputUri"]);return o!=null&&p(e,["bigqueryUri"],o),e}function bu(i){let e={},t=u(i,["format"]);t!=null&&p(e,["predictionsFormat"],t);let n=u(i,["gcsUri"]);n!=null&&p(e,["gcsDestination","outputUriPrefix"],n);let o=u(i,["bigqueryUri"]);if(o!=null&&p(e,["bigqueryDestination","outputUri"],o),u(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(u(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Ci(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata","displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["metadata","state"]);o!=null&&p(e,["state"],mc(o));let r=u(i,["metadata","createTime"]);r!=null&&p(e,["createTime"],r);let c=u(i,["metadata","endTime"]);c!=null&&p(e,["endTime"],c);let m=u(i,["metadata","updateTime"]);m!=null&&p(e,["updateTime"],m);let h=u(i,["metadata","model"]);h!=null&&p(e,["model"],h);let g=u(i,["metadata","output"]);return g!=null&&p(e,["dest"],vu(uc(g))),e}function Nr(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["state"]);o!=null&&p(e,["state"],mc(o));let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["createTime"]);c!=null&&p(e,["createTime"],c);let m=u(i,["startTime"]);m!=null&&p(e,["startTime"],m);let h=u(i,["endTime"]);h!=null&&p(e,["endTime"],h);let g=u(i,["updateTime"]);g!=null&&p(e,["updateTime"],g);let _=u(i,["model"]);_!=null&&p(e,["model"],_);let S=u(i,["inputConfig"]);S!=null&&p(e,["src"],Su(S));let y=u(i,["outputConfig"]);y!=null&&p(e,["dest"],xu(uc(y)));let D=u(i,["completionStats"]);return D!=null&&p(e,["completionStats"],D),e}function Su(i){let e={},t=u(i,["instancesFormat"]);t!=null&&p(e,["format"],t);let n=u(i,["gcsSource","uris"]);n!=null&&p(e,["gcsUri"],n);let o=u(i,["bigquerySource","inputUri"]);return o!=null&&p(e,["bigqueryUri"],o),e}function yu(i,e){let t={};if(u(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(u(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=u(e,["fileName"]);n!=null&&p(t,["fileName"],n);let o=u(e,["inlinedRequests"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>Zu(i,c))),p(t,["requests","requests"],r)}return t}function wu(i){let e={},t=u(i,["format"]);t!=null&&p(e,["instancesFormat"],t);let n=u(i,["gcsUri"]);n!=null&&p(e,["gcsSource","uris"],n);let o=u(i,["bigqueryUri"]);if(o!=null&&p(e,["bigquerySource","inputUri"],o),u(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Eu(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Au(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],ln(i,n)),t}function Du(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],ln(i,n)),t}function Mu(i){let e={},t=u(i,["content"]);t!=null&&p(e,["content"],t);let n=u(i,["citationMetadata"]);n!=null&&p(e,["citationMetadata"],Tu(n));let o=u(i,["tokenCount"]);o!=null&&p(e,["tokenCount"],o);let r=u(i,["finishReason"]);r!=null&&p(e,["finishReason"],r);let c=u(i,["avgLogprobs"]);c!=null&&p(e,["avgLogprobs"],c);let m=u(i,["groundingMetadata"]);m!=null&&p(e,["groundingMetadata"],m);let h=u(i,["index"]);h!=null&&p(e,["index"],h);let g=u(i,["logprobsResult"]);g!=null&&p(e,["logprobsResult"],g);let _=u(i,["safetyRatings"]);if(_!=null){let y=_;Array.isArray(y)&&(y=y.map(D=>D)),p(e,["safetyRatings"],y)}let S=u(i,["urlContextMetadata"]);return S!=null&&p(e,["urlContextMetadata"],S),e}function Tu(i){let e={},t=u(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),p(e,["citations"],n)}return e}function pc(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>s0(r))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function Iu(i,e){let t={},n=u(i,["displayName"]);if(e!==void 0&&n!=null&&p(e,["batch","displayName"],n),u(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function ku(i,e){let t={},n=u(i,["displayName"]);e!==void 0&&n!=null&&p(e,["displayName"],n);let o=u(i,["dest"]);return e!==void 0&&o!=null&&p(e,["outputConfig"],bu(Cu(o))),t}function kl(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["src"]);o!=null&&p(t,["batch","inputConfig"],yu(i,dc(i,o)));let r=u(e,["config"]);return r!=null&&Iu(r,t),t}function Pu(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["model"],Ae(i,n));let o=u(e,["src"]);o!=null&&p(t,["inputConfig"],wu(dc(i,o)));let r=u(e,["config"]);return r!=null&&ku(r,t),t}function Fu(i,e){let t={},n=u(i,["displayName"]);return e!==void 0&&n!=null&&p(e,["batch","displayName"],n),t}function Ru(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["src"]);o!=null&&p(t,["batch","inputConfig"],Uu(i,o));let r=u(e,["config"]);return r!=null&&Fu(r,t),t}function Nu(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],ln(i,n)),t}function Bu(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],ln(i,n)),t}function Vu(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);return r!=null&&p(e,["error"],r),e}function Lu(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);return r!=null&&p(e,["error"],r),e}function Ou(i,e){let t={},n=u(e,["contents"]);if(n!=null){let r=fs(i,n);Array.isArray(r)&&(r=r.map(c=>c)),p(t,["requests[]","request","content"],r)}let o=u(e,["config"]);return o!=null&&(p(t,["_self"],Gu(o,t)),Qd(t,{"requests[].*":"requests[].request.*"})),t}function Gu(i,e){let t={},n=u(i,["taskType"]);e!==void 0&&n!=null&&p(e,["requests[]","taskType"],n);let o=u(i,["title"]);e!==void 0&&o!=null&&p(e,["requests[]","title"],o);let r=u(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&p(e,["requests[]","outputDimensionality"],r),u(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Uu(i,e){let t={},n=u(e,["fileName"]);n!=null&&p(t,["file_name"],n);let o=u(e,["inlinedRequests"]);return o!=null&&p(t,["requests"],Ou(i,o)),t}function qu(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function $u(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Hu(i){let e={},t=u(i,["mode"]);t!=null&&p(e,["mode"],t);let n=u(i,["allowedFunctionNames"]);if(n!=null&&p(e,["allowedFunctionNames"],n),u(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Ku(i,e,t){let n={},o=u(e,["systemInstruction"]);t!==void 0&&o!=null&&p(t,["systemInstruction"],pc(qe(o)));let r=u(e,["temperature"]);r!=null&&p(n,["temperature"],r);let c=u(e,["topP"]);c!=null&&p(n,["topP"],c);let m=u(e,["topK"]);m!=null&&p(n,["topK"],m);let h=u(e,["candidateCount"]);h!=null&&p(n,["candidateCount"],h);let g=u(e,["maxOutputTokens"]);g!=null&&p(n,["maxOutputTokens"],g);let _=u(e,["stopSequences"]);_!=null&&p(n,["stopSequences"],_);let S=u(e,["responseLogprobs"]);S!=null&&p(n,["responseLogprobs"],S);let y=u(e,["logprobs"]);y!=null&&p(n,["logprobs"],y);let D=u(e,["presencePenalty"]);D!=null&&p(n,["presencePenalty"],D);let P=u(e,["frequencyPenalty"]);P!=null&&p(n,["frequencyPenalty"],P);let R=u(e,["seed"]);R!=null&&p(n,["seed"],R);let q=u(e,["responseMimeType"]);q!=null&&p(n,["responseMimeType"],q);let U=u(e,["responseSchema"]);U!=null&&p(n,["responseSchema"],_s(U));let Q=u(e,["responseJsonSchema"]);if(Q!=null&&p(n,["responseJsonSchema"],Q),u(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let J=u(e,["safetySettings"]);if(t!==void 0&&J!=null){let Me=J;Array.isArray(Me)&&(Me=Me.map(Ye=>a0(Ye))),p(t,["safetySettings"],Me)}let ee=u(e,["tools"]);if(t!==void 0&&ee!=null){let Me=an(ee);Array.isArray(Me)&&(Me=Me.map(Ye=>c0(sn(Ye)))),p(t,["tools"],Me)}let re=u(e,["toolConfig"]);if(t!==void 0&&re!=null&&p(t,["toolConfig"],l0(re)),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let de=u(e,["cachedContent"]);t!==void 0&&de!=null&&p(t,["cachedContent"],wt(i,de));let se=u(e,["responseModalities"]);se!=null&&p(n,["responseModalities"],se);let be=u(e,["mediaResolution"]);be!=null&&p(n,["mediaResolution"],be);let ae=u(e,["speechConfig"]);if(ae!=null&&p(n,["speechConfig"],Cs(ae)),u(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let Ce=u(e,["thinkingConfig"]);Ce!=null&&p(n,["thinkingConfig"],Ce);let Fe=u(e,["imageConfig"]);Fe!=null&&p(n,["imageConfig"],Xu(Fe));let Oe=u(e,["enableEnhancedCivicAnswers"]);return Oe!=null&&p(n,["enableEnhancedCivicAnswers"],Oe),n}function zu(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["candidates"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>Mu(g))),p(e,["candidates"],h)}let o=u(i,["modelVersion"]);o!=null&&p(e,["modelVersion"],o);let r=u(i,["promptFeedback"]);r!=null&&p(e,["promptFeedback"],r);let c=u(i,["responseId"]);c!=null&&p(e,["responseId"],c);let m=u(i,["usageMetadata"]);return m!=null&&p(e,["usageMetadata"],m),e}function Wu(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],ln(i,n)),t}function Ju(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],ln(i,n)),t}function Qu(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function Yu(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function Xu(i){let e={},t=u(i,["aspectRatio"]);t!=null&&p(e,["aspectRatio"],t);let n=u(i,["imageSize"]);if(n!=null&&p(e,["imageSize"],n),u(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Zu(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["request","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let m=ot(o);Array.isArray(m)&&(m=m.map(h=>pc(h))),p(t,["request","contents"],m)}let r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);let c=u(e,["config"]);return c!=null&&p(t,["request","generationConfig"],Ku(i,c,u(t,["request"],{}))),t}function ju(i){let e={},t=u(i,["response"]);t!=null&&p(e,["response"],zu(t));let n=u(i,["error"]);return n!=null&&p(e,["error"],n),e}function e0(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);if(e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),u(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function t0(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);e!==void 0&&o!=null&&p(e,["_query","pageToken"],o);let r=u(i,["filter"]);return e!==void 0&&r!=null&&p(e,["_query","filter"],r),t}function n0(i){let e={},t=u(i,["config"]);return t!=null&&e0(t,e),e}function i0(i){let e={},t=u(i,["config"]);return t!=null&&t0(t,e),e}function o0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["operations"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>Ci(c))),p(e,["batchJobs"],r)}return e}function r0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["batchPredictionJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>Nr(c))),p(e,["batchJobs"],r)}return e}function s0(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let r=u(i,["fileData"]);r!=null&&p(e,["fileData"],qu(r));let c=u(i,["functionCall"]);c!=null&&p(e,["functionCall"],$u(c));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let h=u(i,["inlineData"]);h!=null&&p(e,["inlineData"],Eu(h));let g=u(i,["text"]);g!=null&&p(e,["text"],g);let _=u(i,["thought"]);_!=null&&p(e,["thought"],_);let S=u(i,["thoughtSignature"]);S!=null&&p(e,["thoughtSignature"],S);let y=u(i,["videoMetadata"]);return y!=null&&p(e,["videoMetadata"],y),e}function a0(i){let e={},t=u(i,["category"]);if(t!=null&&p(e,["category"],t),u(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=u(i,["threshold"]);return n!=null&&p(e,["threshold"],n),e}function l0(i){let e={},t=u(i,["functionCallingConfig"]);t!=null&&p(e,["functionCallingConfig"],Hu(t));let n=u(i,["retrievalConfig"]);return n!=null&&p(e,["retrievalConfig"],n),e}function c0(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let _=t;Array.isArray(_)&&(_=_.map(S=>S)),p(e,["functionDeclarations"],_)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let r=u(i,["fileSearch"]);r!=null&&p(e,["fileSearch"],r);let c=u(i,["codeExecution"]);if(c!=null&&p(e,["codeExecution"],c),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],Qu(m));let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],Yu(h));let g=u(i,["urlContext"]);return g!=null&&p(e,["urlContext"],g),e}var Pt=(function(i){return i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents",i})(Pt||{}),yt=class{constructor(e,t,n,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,o)}init(e,t,n){var o,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!n||Object.keys(n).length===0?c={config:{}}:typeof n=="object"?c=Object.assign({},n):c=n,c.config&&(c.config.pageToken=t.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(r=(o=c.config)===null||o===void 0?void 0:o.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Br=class extends ut{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new yt(Pt.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=kl(this.apiClient,e),n=t._url,o=X("{model}:batchGenerateContent",n),m=t.batch.inputConfig.requests,h=m.requests,g=[];for(let _ of h){let S=Object.assign({},_);if(S.systemInstruction){let y=S.systemInstruction;delete S.systemInstruction;let D=S.request;D.systemInstruction=y,S.request=D}g.push(S)}return m.requests=g,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},o=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${o}`),n.dest===void 0){let r=this.getGcsUri(e),c=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${o}`;else if(c)n.dest=`${c}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Pu(this.apiClient,e);return m=X("batchPredictionJobs",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>Nr(_))}else{let g=kl(this.apiClient,e);return m=X("{model}:batchGenerateContent",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>Ci(_))}}async createEmbeddingsInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Ru(this.apiClient,e);return r=X("{model}:asyncBatchEmbedContent",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>Ci(h))}}async get(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Ju(this.apiClient,e);return m=X("batchPredictionJobs/{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>Nr(_))}else{let g=Wu(this.apiClient,e);return m=X("batches/{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>Ci(_))}}async cancel(e){var t,n,o,r;let c="",m={};if(this.apiClient.isVertexAI()){let h=Du(this.apiClient,e);c=X("batchPredictionJobs/{name}:cancel",h._url),m=h._query,delete h._url,delete h._query,await this.apiClient.request({path:c,queryParams:m,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let h=Au(this.apiClient,e);c=X("batches/{name}:cancel",h._url),m=h._query,delete h._url,delete h._query,await this.apiClient.request({path:c,queryParams:m,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=i0(e);return m=X("batchPredictionJobs",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=r0(_),y=new Ii;return Object.assign(y,S),y})}else{let g=n0(e);return m=X("batches",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=o0(_),y=new Ii;return Object.assign(y,S),y})}}async delete(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Bu(this.apiClient,e);return m=X("batchPredictionJobs/{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>Lu(_))}else{let g=Nu(this.apiClient,e);return m=X("batches/{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>Vu(_))}}};function d0(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Pl(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>F0(r))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function u0(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);e!==void 0&&o!=null&&p(e,["expireTime"],o);let r=u(i,["displayName"]);e!==void 0&&r!=null&&p(e,["displayName"],r);let c=u(i,["contents"]);if(e!==void 0&&c!=null){let _=ot(c);Array.isArray(_)&&(_=_.map(S=>Pl(S))),p(e,["contents"],_)}let m=u(i,["systemInstruction"]);e!==void 0&&m!=null&&p(e,["systemInstruction"],Pl(qe(m)));let h=u(i,["tools"]);if(e!==void 0&&h!=null){let _=h;Array.isArray(_)&&(_=_.map(S=>N0(S))),p(e,["tools"],_)}let g=u(i,["toolConfig"]);if(e!==void 0&&g!=null&&p(e,["toolConfig"],R0(g)),u(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function m0(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);e!==void 0&&o!=null&&p(e,["expireTime"],o);let r=u(i,["displayName"]);e!==void 0&&r!=null&&p(e,["displayName"],r);let c=u(i,["contents"]);if(e!==void 0&&c!=null){let S=ot(c);Array.isArray(S)&&(S=S.map(y=>y)),p(e,["contents"],S)}let m=u(i,["systemInstruction"]);e!==void 0&&m!=null&&p(e,["systemInstruction"],qe(m));let h=u(i,["tools"]);if(e!==void 0&&h!=null){let S=h;Array.isArray(S)&&(S=S.map(y=>B0(y))),p(e,["tools"],S)}let g=u(i,["toolConfig"]);e!==void 0&&g!=null&&p(e,["toolConfig"],g);let _=u(i,["kmsKeyName"]);return e!==void 0&&_!=null&&p(e,["encryption_spec","kmsKeyName"],_),t}function p0(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["model"],tc(i,n));let o=u(e,["config"]);return o!=null&&u0(o,t),t}function g0(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["model"],tc(i,n));let o=u(e,["config"]);return o!=null&&m0(o,t),t}function h0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],wt(i,n)),t}function f0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],wt(i,n)),t}function _0(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function C0(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function v0(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function x0(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function b0(i){let e={},t=u(i,["mode"]);t!=null&&p(e,["mode"],t);let n=u(i,["allowedFunctionNames"]);if(n!=null&&p(e,["allowedFunctionNames"],n),u(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function S0(i){let e={};if(u(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=u(i,["description"]);t!=null&&p(e,["description"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["parameters"]);o!=null&&p(e,["parameters"],o);let r=u(i,["parametersJsonSchema"]);r!=null&&p(e,["parametersJsonSchema"],r);let c=u(i,["response"]);c!=null&&p(e,["response"],c);let m=u(i,["responseJsonSchema"]);return m!=null&&p(e,["responseJsonSchema"],m),e}function y0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],wt(i,n)),t}function w0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],wt(i,n)),t}function E0(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function A0(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function D0(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function M0(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function T0(i){let e={},t=u(i,["config"]);return t!=null&&D0(t,e),e}function I0(i){let e={},t=u(i,["config"]);return t!=null&&M0(t,e),e}function k0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["cachedContents"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["cachedContents"],r)}return e}function P0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["cachedContents"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["cachedContents"],r)}return e}function F0(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let r=u(i,["fileData"]);r!=null&&p(e,["fileData"],v0(r));let c=u(i,["functionCall"]);c!=null&&p(e,["functionCall"],x0(c));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let h=u(i,["inlineData"]);h!=null&&p(e,["inlineData"],d0(h));let g=u(i,["text"]);g!=null&&p(e,["text"],g);let _=u(i,["thought"]);_!=null&&p(e,["thought"],_);let S=u(i,["thoughtSignature"]);S!=null&&p(e,["thoughtSignature"],S);let y=u(i,["videoMetadata"]);return y!=null&&p(e,["videoMetadata"],y),e}function R0(i){let e={},t=u(i,["functionCallingConfig"]);t!=null&&p(e,["functionCallingConfig"],b0(t));let n=u(i,["retrievalConfig"]);return n!=null&&p(e,["retrievalConfig"],n),e}function N0(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let _=t;Array.isArray(_)&&(_=_.map(S=>S)),p(e,["functionDeclarations"],_)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let r=u(i,["fileSearch"]);r!=null&&p(e,["fileSearch"],r);let c=u(i,["codeExecution"]);if(c!=null&&p(e,["codeExecution"],c),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],E0(m));let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],A0(h));let g=u(i,["urlContext"]);return g!=null&&p(e,["urlContext"],g),e}function B0(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let S=t;Array.isArray(S)&&(S=S.map(y=>S0(y))),p(e,["functionDeclarations"],S)}let n=u(i,["retrieval"]);n!=null&&p(e,["retrieval"],n);let o=u(i,["googleSearchRetrieval"]);o!=null&&p(e,["googleSearchRetrieval"],o);let r=u(i,["computerUse"]);if(r!=null&&p(e,["computerUse"],r),u(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let c=u(i,["codeExecution"]);c!=null&&p(e,["codeExecution"],c);let m=u(i,["enterpriseWebSearch"]);m!=null&&p(e,["enterpriseWebSearch"],m);let h=u(i,["googleMaps"]);h!=null&&p(e,["googleMaps"],h);let g=u(i,["googleSearch"]);g!=null&&p(e,["googleSearch"],g);let _=u(i,["urlContext"]);return _!=null&&p(e,["urlContext"],_),e}function V0(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);return e!==void 0&&o!=null&&p(e,["expireTime"],o),t}function L0(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);return e!==void 0&&o!=null&&p(e,["expireTime"],o),t}function O0(i,e){let t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],wt(i,n));let o=u(e,["config"]);return o!=null&&V0(o,t),t}function G0(i,e){let t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],wt(i,n));let o=u(e,["config"]);return o!=null&&L0(o,t),t}var Vr=class extends ut{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new yt(Pt.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=g0(this.apiClient,e);return m=X("cachedContents",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>_)}else{let g=p0(this.apiClient,e);return m=X("cachedContents",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>_)}}async get(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=w0(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>_)}else{let g=y0(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>_)}}async delete(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=f0(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=C0(_),y=new Mi;return Object.assign(y,S),y})}else{let g=h0(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=_0(_),y=new Mi;return Object.assign(y,S),y})}}async update(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=G0(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>_)}else{let g=O0(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>_)}}async listInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=I0(e);return m=X("cachedContents",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=P0(_),y=new Ti;return Object.assign(y,S),y})}else{let g=T0(e);return m=X("cachedContents",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=k0(_),y=new Ti;return Object.assign(y,S),y})}}};function Pi(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(i);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(i,n[o])&&(t[n[o]]=i[n[o]]);return t}function Fl(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function pe(i){return this instanceof pe?(this.v=i,this):new pe(i)}function ct(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),o,r=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),m("next"),m("throw"),m("return",c),o[Symbol.asyncIterator]=function(){return this},o;function c(D){return function(P){return Promise.resolve(P).then(D,S)}}function m(D,P){n[D]&&(o[D]=function(R){return new Promise(function(q,U){r.push([D,R,q,U])>1||h(D,R)})},P&&(o[D]=P(o[D])))}function h(D,P){try{g(n[D](P))}catch(R){y(r[0][3],R)}}function g(D){D.value instanceof pe?Promise.resolve(D.value.v).then(_,S):y(r[0][2],D)}function _(D){h("next",D)}function S(D){h("throw",D)}function y(D,P){D(P),r.shift(),r.length&&h(r[0][0],r[0][1])}}function dt(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Fl=="function"?Fl(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=i[r]&&function(c){return new Promise(function(m,h){c=i[r](c),o(m,h,c.done,c.value)})}}function o(r,c,m,h){Promise.resolve(h).then(function(g){r({value:g,done:m})},c)}}function U0(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:gc(t)}function gc(i){if(i.parts===void 0||i.parts.length===0)return!1;for(let e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function q0(i){if(i.length!==0){for(let e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Rl(i){if(i===void 0||i.length===0)return[];let e=[],t=i.length,n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{let o=[],r=!0;for(;n<t&&i[n].role==="model";)o.push(i[n]),r&&!gc(i[n])&&(r=!1),n++;r?e.push(...o):e.pop()}return e}var Lr=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Or(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Or=class{constructor(e,t,n,o={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=o,this.history=r,this.sendPromise=Promise.resolve(),q0(r)}async sendMessage(e){var t;await this.sendPromise;let n=qe(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,c,m;let h=await o,g=(c=(r=h.candidates)===null||r===void 0?void 0:r[0])===null||c===void 0?void 0:c.content,_=h.automaticFunctionCallingHistory,S=this.getHistory(!0).length,y=[];_!=null&&(y=(m=_.slice(S))!==null&&m!==void 0?m:[]);let D=g?[g]:[];this.recordHistory(n,D,y)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;let n=qe(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});let r=await o;return this.processStreamResponse(r,n)}getHistory(e=!1){let t=e?Rl(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return ct(this,arguments,function*(){var o,r,c,m,h,g;let _=[];try{for(var S=!0,y=dt(e),D;D=yield pe(y.next()),o=D.done,!o;S=!0){m=D.value,S=!1;let P=m;if(U0(P)){let R=(g=(h=P.candidates)===null||h===void 0?void 0:h[0])===null||g===void 0?void 0:g.content;R!==void 0&&_.push(R)}yield yield pe(P)}}catch(P){r={error:P}}finally{try{!S&&!o&&(c=y.return)&&(yield pe(c.call(y)))}finally{if(r)throw r.error}}this.recordHistory(t,_)})}recordHistory(e,t,n){let o=[];t.length>0&&t.every(r=>r.role!==void 0)?o=t:o.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...Rl(n)):this.history.push(e),this.history.push(...o)}};var Fi=class i extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,i.prototype)}};function $0(i){let e={},t=u(i,["file"]);return t!=null&&p(e,["file"],t),e}function H0(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function K0(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","file"],ac(t)),e}function z0(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function W0(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","file"],ac(t)),e}function J0(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function Q0(i){let e={},t=u(i,["config"]);return t!=null&&J0(t,e),e}function Y0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["files"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["files"],r)}return e}var Gr=class extends ut{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new yt(Pt.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Q0(e);return r=X("files",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(g=>{let _=g;return _.sdkHttpResponse={headers:h.headers},_})),o.then(h=>{let g=Y0(h),_=new Mr;return Object.assign(_,g),_})}}async createInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=$0(e);return r=X("upload/v1beta/files",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>{let g=H0(h),_=new Tr;return Object.assign(_,g),_})}}async get(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=W0(e);return r=X("files/{file}",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async delete(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=K0(e);return r=X("files/{file}",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(g=>{let _=g;return _.sdkHttpResponse={headers:h.headers},_})),o.then(h=>{let g=z0(h),_=new Ir;return Object.assign(_,g),_})}}};function vi(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function X0(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>pm(r))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function Z0(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function j0(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function em(i){let e={};if(u(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=u(i,["description"]);t!=null&&p(e,["description"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["parameters"]);o!=null&&p(e,["parameters"],o);let r=u(i,["parametersJsonSchema"]);r!=null&&p(e,["parametersJsonSchema"],r);let c=u(i,["response"]);c!=null&&p(e,["response"],c);let m=u(i,["responseJsonSchema"]);return m!=null&&p(e,["responseJsonSchema"],m),e}function tm(i){let e={},t=u(i,["modelSelectionConfig"]);t!=null&&p(e,["modelConfig"],t);let n=u(i,["responseJsonSchema"]);n!=null&&p(e,["responseJsonSchema"],n);let o=u(i,["audioTimestamp"]);o!=null&&p(e,["audioTimestamp"],o);let r=u(i,["candidateCount"]);r!=null&&p(e,["candidateCount"],r);let c=u(i,["enableAffectiveDialog"]);c!=null&&p(e,["enableAffectiveDialog"],c);let m=u(i,["frequencyPenalty"]);m!=null&&p(e,["frequencyPenalty"],m);let h=u(i,["logprobs"]);h!=null&&p(e,["logprobs"],h);let g=u(i,["maxOutputTokens"]);g!=null&&p(e,["maxOutputTokens"],g);let _=u(i,["mediaResolution"]);_!=null&&p(e,["mediaResolution"],_);let S=u(i,["presencePenalty"]);S!=null&&p(e,["presencePenalty"],S);let y=u(i,["responseLogprobs"]);y!=null&&p(e,["responseLogprobs"],y);let D=u(i,["responseMimeType"]);D!=null&&p(e,["responseMimeType"],D);let P=u(i,["responseModalities"]);P!=null&&p(e,["responseModalities"],P);let R=u(i,["responseSchema"]);R!=null&&p(e,["responseSchema"],R);let q=u(i,["routingConfig"]);q!=null&&p(e,["routingConfig"],q);let U=u(i,["seed"]);U!=null&&p(e,["seed"],U);let Q=u(i,["speechConfig"]);Q!=null&&p(e,["speechConfig"],Q);let J=u(i,["stopSequences"]);J!=null&&p(e,["stopSequences"],J);let ee=u(i,["temperature"]);ee!=null&&p(e,["temperature"],ee);let re=u(i,["thinkingConfig"]);re!=null&&p(e,["thinkingConfig"],re);let de=u(i,["topK"]);de!=null&&p(e,["topK"],de);let se=u(i,["topP"]);if(se!=null&&p(e,["topP"],se),u(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function nm(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function im(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function om(i,e){let t={},n=u(i,["generationConfig"]);e!==void 0&&n!=null&&p(e,["setup","generationConfig"],n);let o=u(i,["responseModalities"]);e!==void 0&&o!=null&&p(e,["setup","generationConfig","responseModalities"],o);let r=u(i,["temperature"]);e!==void 0&&r!=null&&p(e,["setup","generationConfig","temperature"],r);let c=u(i,["topP"]);e!==void 0&&c!=null&&p(e,["setup","generationConfig","topP"],c);let m=u(i,["topK"]);e!==void 0&&m!=null&&p(e,["setup","generationConfig","topK"],m);let h=u(i,["maxOutputTokens"]);e!==void 0&&h!=null&&p(e,["setup","generationConfig","maxOutputTokens"],h);let g=u(i,["mediaResolution"]);e!==void 0&&g!=null&&p(e,["setup","generationConfig","mediaResolution"],g);let _=u(i,["seed"]);e!==void 0&&_!=null&&p(e,["setup","generationConfig","seed"],_);let S=u(i,["speechConfig"]);e!==void 0&&S!=null&&p(e,["setup","generationConfig","speechConfig"],vs(S));let y=u(i,["thinkingConfig"]);e!==void 0&&y!=null&&p(e,["setup","generationConfig","thinkingConfig"],y);let D=u(i,["enableAffectiveDialog"]);e!==void 0&&D!=null&&p(e,["setup","generationConfig","enableAffectiveDialog"],D);let P=u(i,["systemInstruction"]);e!==void 0&&P!=null&&p(e,["setup","systemInstruction"],X0(qe(P)));let R=u(i,["tools"]);if(e!==void 0&&R!=null){let de=an(R);Array.isArray(de)&&(de=de.map(se=>hm(sn(se)))),p(e,["setup","tools"],de)}let q=u(i,["sessionResumption"]);e!==void 0&&q!=null&&p(e,["setup","sessionResumption"],gm(q));let U=u(i,["inputAudioTranscription"]);e!==void 0&&U!=null&&p(e,["setup","inputAudioTranscription"],U);let Q=u(i,["outputAudioTranscription"]);e!==void 0&&Q!=null&&p(e,["setup","outputAudioTranscription"],Q);let J=u(i,["realtimeInputConfig"]);e!==void 0&&J!=null&&p(e,["setup","realtimeInputConfig"],J);let ee=u(i,["contextWindowCompression"]);e!==void 0&&ee!=null&&p(e,["setup","contextWindowCompression"],ee);let re=u(i,["proactivity"]);if(e!==void 0&&re!=null&&p(e,["setup","proactivity"],re),u(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function rm(i,e){let t={},n=u(i,["generationConfig"]);e!==void 0&&n!=null&&p(e,["setup","generationConfig"],tm(n));let o=u(i,["responseModalities"]);e!==void 0&&o!=null&&p(e,["setup","generationConfig","responseModalities"],o);let r=u(i,["temperature"]);e!==void 0&&r!=null&&p(e,["setup","generationConfig","temperature"],r);let c=u(i,["topP"]);e!==void 0&&c!=null&&p(e,["setup","generationConfig","topP"],c);let m=u(i,["topK"]);e!==void 0&&m!=null&&p(e,["setup","generationConfig","topK"],m);let h=u(i,["maxOutputTokens"]);e!==void 0&&h!=null&&p(e,["setup","generationConfig","maxOutputTokens"],h);let g=u(i,["mediaResolution"]);e!==void 0&&g!=null&&p(e,["setup","generationConfig","mediaResolution"],g);let _=u(i,["seed"]);e!==void 0&&_!=null&&p(e,["setup","generationConfig","seed"],_);let S=u(i,["speechConfig"]);e!==void 0&&S!=null&&p(e,["setup","generationConfig","speechConfig"],vs(S));let y=u(i,["thinkingConfig"]);e!==void 0&&y!=null&&p(e,["setup","generationConfig","thinkingConfig"],y);let D=u(i,["enableAffectiveDialog"]);e!==void 0&&D!=null&&p(e,["setup","generationConfig","enableAffectiveDialog"],D);let P=u(i,["systemInstruction"]);e!==void 0&&P!=null&&p(e,["setup","systemInstruction"],qe(P));let R=u(i,["tools"]);if(e!==void 0&&R!=null){let se=an(R);Array.isArray(se)&&(se=se.map(be=>fm(sn(be)))),p(e,["setup","tools"],se)}let q=u(i,["sessionResumption"]);e!==void 0&&q!=null&&p(e,["setup","sessionResumption"],q);let U=u(i,["inputAudioTranscription"]);e!==void 0&&U!=null&&p(e,["setup","inputAudioTranscription"],U);let Q=u(i,["outputAudioTranscription"]);e!==void 0&&Q!=null&&p(e,["setup","outputAudioTranscription"],Q);let J=u(i,["realtimeInputConfig"]);e!==void 0&&J!=null&&p(e,["setup","realtimeInputConfig"],J);let ee=u(i,["contextWindowCompression"]);e!==void 0&&ee!=null&&p(e,["setup","contextWindowCompression"],ee);let re=u(i,["proactivity"]);e!==void 0&&re!=null&&p(e,["setup","proactivity"],re);let de=u(i,["explicitVadSignal"]);return e!==void 0&&de!=null&&p(e,["setup","explicitVadSignal"],de),t}function sm(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["setup","model"],Ae(i,n));let o=u(e,["config"]);return o!=null&&p(t,["config"],om(o,t)),t}function am(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["setup","model"],Ae(i,n));let o=u(e,["config"]);return o!=null&&p(t,["config"],rm(o,t)),t}function lm(i){let e={},t=u(i,["musicGenerationConfig"]);return t!=null&&p(e,["musicGenerationConfig"],t),e}function cm(i){let e={},t=u(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),p(e,["weightedPrompts"],n)}return e}function dm(i){let e={},t=u(i,["media"]);if(t!=null){let g=nc(t);Array.isArray(g)&&(g=g.map(_=>vi(_))),p(e,["mediaChunks"],g)}let n=u(i,["audio"]);n!=null&&p(e,["audio"],vi(oc(n)));let o=u(i,["audioStreamEnd"]);o!=null&&p(e,["audioStreamEnd"],o);let r=u(i,["video"]);r!=null&&p(e,["video"],vi(ic(r)));let c=u(i,["text"]);c!=null&&p(e,["text"],c);let m=u(i,["activityStart"]);m!=null&&p(e,["activityStart"],m);let h=u(i,["activityEnd"]);return h!=null&&p(e,["activityEnd"],h),e}function um(i){let e={},t=u(i,["media"]);if(t!=null){let g=nc(t);Array.isArray(g)&&(g=g.map(_=>_)),p(e,["mediaChunks"],g)}let n=u(i,["audio"]);n!=null&&p(e,["audio"],oc(n));let o=u(i,["audioStreamEnd"]);o!=null&&p(e,["audioStreamEnd"],o);let r=u(i,["video"]);r!=null&&p(e,["video"],ic(r));let c=u(i,["text"]);c!=null&&p(e,["text"],c);let m=u(i,["activityStart"]);m!=null&&p(e,["activityStart"],m);let h=u(i,["activityEnd"]);return h!=null&&p(e,["activityEnd"],h),e}function mm(i){let e={},t=u(i,["setupComplete"]);t!=null&&p(e,["setupComplete"],t);let n=u(i,["serverContent"]);n!=null&&p(e,["serverContent"],n);let o=u(i,["toolCall"]);o!=null&&p(e,["toolCall"],o);let r=u(i,["toolCallCancellation"]);r!=null&&p(e,["toolCallCancellation"],r);let c=u(i,["usageMetadata"]);c!=null&&p(e,["usageMetadata"],_m(c));let m=u(i,["goAway"]);m!=null&&p(e,["goAway"],m);let h=u(i,["sessionResumptionUpdate"]);h!=null&&p(e,["sessionResumptionUpdate"],h);let g=u(i,["voiceActivityDetectionSignal"]);return g!=null&&p(e,["voiceActivityDetectionSignal"],g),e}function pm(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let r=u(i,["fileData"]);r!=null&&p(e,["fileData"],Z0(r));let c=u(i,["functionCall"]);c!=null&&p(e,["functionCall"],j0(c));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let h=u(i,["inlineData"]);h!=null&&p(e,["inlineData"],vi(h));let g=u(i,["text"]);g!=null&&p(e,["text"],g);let _=u(i,["thought"]);_!=null&&p(e,["thought"],_);let S=u(i,["thoughtSignature"]);S!=null&&p(e,["thoughtSignature"],S);let y=u(i,["videoMetadata"]);return y!=null&&p(e,["videoMetadata"],y),e}function gm(i){let e={},t=u(i,["handle"]);if(t!=null&&p(e,["handle"],t),u(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function hm(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let _=t;Array.isArray(_)&&(_=_.map(S=>S)),p(e,["functionDeclarations"],_)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let r=u(i,["fileSearch"]);r!=null&&p(e,["fileSearch"],r);let c=u(i,["codeExecution"]);if(c!=null&&p(e,["codeExecution"],c),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],nm(m));let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],im(h));let g=u(i,["urlContext"]);return g!=null&&p(e,["urlContext"],g),e}function fm(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let S=t;Array.isArray(S)&&(S=S.map(y=>em(y))),p(e,["functionDeclarations"],S)}let n=u(i,["retrieval"]);n!=null&&p(e,["retrieval"],n);let o=u(i,["googleSearchRetrieval"]);o!=null&&p(e,["googleSearchRetrieval"],o);let r=u(i,["computerUse"]);if(r!=null&&p(e,["computerUse"],r),u(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let c=u(i,["codeExecution"]);c!=null&&p(e,["codeExecution"],c);let m=u(i,["enterpriseWebSearch"]);m!=null&&p(e,["enterpriseWebSearch"],m);let h=u(i,["googleMaps"]);h!=null&&p(e,["googleMaps"],h);let g=u(i,["googleSearch"]);g!=null&&p(e,["googleSearch"],g);let _=u(i,["urlContext"]);return _!=null&&p(e,["urlContext"],_),e}function _m(i){let e={},t=u(i,["promptTokenCount"]);t!=null&&p(e,["promptTokenCount"],t);let n=u(i,["cachedContentTokenCount"]);n!=null&&p(e,["cachedContentTokenCount"],n);let o=u(i,["candidatesTokenCount"]);o!=null&&p(e,["responseTokenCount"],o);let r=u(i,["toolUsePromptTokenCount"]);r!=null&&p(e,["toolUsePromptTokenCount"],r);let c=u(i,["thoughtsTokenCount"]);c!=null&&p(e,["thoughtsTokenCount"],c);let m=u(i,["totalTokenCount"]);m!=null&&p(e,["totalTokenCount"],m);let h=u(i,["promptTokensDetails"]);if(h!=null){let D=h;Array.isArray(D)&&(D=D.map(P=>P)),p(e,["promptTokensDetails"],D)}let g=u(i,["cacheTokensDetails"]);if(g!=null){let D=g;Array.isArray(D)&&(D=D.map(P=>P)),p(e,["cacheTokensDetails"],D)}let _=u(i,["candidatesTokensDetails"]);if(_!=null){let D=_;Array.isArray(D)&&(D=D.map(P=>P)),p(e,["responseTokensDetails"],D)}let S=u(i,["toolUsePromptTokensDetails"]);if(S!=null){let D=S;Array.isArray(D)&&(D=D.map(P=>P)),p(e,["toolUsePromptTokensDetails"],D)}let y=u(i,["trafficType"]);return y!=null&&p(e,["trafficType"],y),e}function Cm(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function vm(i){let e={},t=u(i,["content"]);t!=null&&p(e,["content"],t);let n=u(i,["citationMetadata"]);n!=null&&p(e,["citationMetadata"],xm(n));let o=u(i,["tokenCount"]);o!=null&&p(e,["tokenCount"],o);let r=u(i,["finishReason"]);r!=null&&p(e,["finishReason"],r);let c=u(i,["avgLogprobs"]);c!=null&&p(e,["avgLogprobs"],c);let m=u(i,["groundingMetadata"]);m!=null&&p(e,["groundingMetadata"],m);let h=u(i,["index"]);h!=null&&p(e,["index"],h);let g=u(i,["logprobsResult"]);g!=null&&p(e,["logprobsResult"],g);let _=u(i,["safetyRatings"]);if(_!=null){let y=_;Array.isArray(y)&&(y=y.map(D=>D)),p(e,["safetyRatings"],y)}let S=u(i,["urlContextMetadata"]);return S!=null&&p(e,["urlContextMetadata"],S),e}function xm(i){let e={},t=u(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),p(e,["citations"],n)}return e}function bm(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let r=ot(o);Array.isArray(r)&&(r=r.map(c=>c)),p(t,["contents"],r)}return t}function Sm(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["tokensInfo"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),p(e,["tokensInfo"],o)}return e}function ym(i){let e={},t=u(i,["values"]);t!=null&&p(e,["values"],t);let n=u(i,["statistics"]);return n!=null&&p(e,["statistics"],wm(n)),e}function wm(i){let e={},t=u(i,["truncated"]);t!=null&&p(e,["truncated"],t);let n=u(i,["token_count"]);return n!=null&&p(e,["tokenCount"],n),e}function Ji(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>Fp(r))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function Em(i){let e={},t=u(i,["controlType"]);t!=null&&p(e,["controlType"],t);let n=u(i,["enableControlImageComputation"]);return n!=null&&p(e,["computeControl"],n),e}function Am(i){let e={};if(u(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(u(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(u(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Dm(i,e){let t={},n=u(i,["systemInstruction"]);e!==void 0&&n!=null&&p(e,["systemInstruction"],qe(n));let o=u(i,["tools"]);if(e!==void 0&&o!=null){let c=o;Array.isArray(c)&&(c=c.map(m=>Cc(m))),p(e,["tools"],c)}let r=u(i,["generationConfig"]);return e!==void 0&&r!=null&&p(e,["generationConfig"],Cp(r)),t}function Mm(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let c=ot(o);Array.isArray(c)&&(c=c.map(m=>Ji(m))),p(t,["contents"],c)}let r=u(e,["config"]);return r!=null&&Am(r),t}function Tm(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let c=ot(o);Array.isArray(c)&&(c=c.map(m=>m)),p(t,["contents"],c)}let r=u(e,["config"]);return r!=null&&Dm(r,t),t}function Im(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["totalTokens"]);n!=null&&p(e,["totalTokens"],n);let o=u(i,["cachedContentTokenCount"]);return o!=null&&p(e,["cachedContentTokenCount"],o),e}function km(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["totalTokens"]);return n!=null&&p(e,["totalTokens"],n),e}function Pm(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Ae(i,n)),t}function Fm(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Ae(i,n)),t}function Rm(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function Nm(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function Bm(i,e){let t={},n=u(i,["outputGcsUri"]);e!==void 0&&n!=null&&p(e,["parameters","storageUri"],n);let o=u(i,["negativePrompt"]);e!==void 0&&o!=null&&p(e,["parameters","negativePrompt"],o);let r=u(i,["numberOfImages"]);e!==void 0&&r!=null&&p(e,["parameters","sampleCount"],r);let c=u(i,["aspectRatio"]);e!==void 0&&c!=null&&p(e,["parameters","aspectRatio"],c);let m=u(i,["guidanceScale"]);e!==void 0&&m!=null&&p(e,["parameters","guidanceScale"],m);let h=u(i,["seed"]);e!==void 0&&h!=null&&p(e,["parameters","seed"],h);let g=u(i,["safetyFilterLevel"]);e!==void 0&&g!=null&&p(e,["parameters","safetySetting"],g);let _=u(i,["personGeneration"]);e!==void 0&&_!=null&&p(e,["parameters","personGeneration"],_);let S=u(i,["includeSafetyAttributes"]);e!==void 0&&S!=null&&p(e,["parameters","includeSafetyAttributes"],S);let y=u(i,["includeRaiReason"]);e!==void 0&&y!=null&&p(e,["parameters","includeRaiReason"],y);let D=u(i,["language"]);e!==void 0&&D!=null&&p(e,["parameters","language"],D);let P=u(i,["outputMimeType"]);e!==void 0&&P!=null&&p(e,["parameters","outputOptions","mimeType"],P);let R=u(i,["outputCompressionQuality"]);e!==void 0&&R!=null&&p(e,["parameters","outputOptions","compressionQuality"],R);let q=u(i,["addWatermark"]);e!==void 0&&q!=null&&p(e,["parameters","addWatermark"],q);let U=u(i,["labels"]);e!==void 0&&U!=null&&p(e,["labels"],U);let Q=u(i,["editMode"]);e!==void 0&&Q!=null&&p(e,["parameters","editMode"],Q);let J=u(i,["baseSteps"]);return e!==void 0&&J!=null&&p(e,["parameters","editConfig","baseSteps"],J),t}function Vm(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let r=u(e,["referenceImages"]);if(r!=null){let m=r;Array.isArray(m)&&(m=m.map(h=>Op(h))),p(t,["instances[0]","referenceImages"],m)}let c=u(e,["config"]);return c!=null&&Bm(c,t),t}function Lm(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Qi(r))),p(e,["generatedImages"],o)}return e}function Om(i,e){let t={},n=u(i,["taskType"]);e!==void 0&&n!=null&&p(e,["requests[]","taskType"],n);let o=u(i,["title"]);e!==void 0&&o!=null&&p(e,["requests[]","title"],o);let r=u(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&p(e,["requests[]","outputDimensionality"],r),u(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Gm(i,e){let t={},n=u(i,["taskType"]);e!==void 0&&n!=null&&p(e,["instances[]","task_type"],n);let o=u(i,["title"]);e!==void 0&&o!=null&&p(e,["instances[]","title"],o);let r=u(i,["outputDimensionality"]);e!==void 0&&r!=null&&p(e,["parameters","outputDimensionality"],r);let c=u(i,["mimeType"]);e!==void 0&&c!=null&&p(e,["instances[]","mimeType"],c);let m=u(i,["autoTruncate"]);return e!==void 0&&m!=null&&p(e,["parameters","autoTruncate"],m),t}function Um(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let m=fs(i,o);Array.isArray(m)&&(m=m.map(h=>h)),p(t,["requests[]","content"],m)}let r=u(e,["config"]);r!=null&&Om(r,t);let c=u(e,["model"]);return c!==void 0&&p(t,["requests[]","model"],Ae(i,c)),t}function qm(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let c=fs(i,o);Array.isArray(c)&&(c=c.map(m=>m)),p(t,["instances[]","content"],c)}let r=u(e,["config"]);return r!=null&&Gm(r,t),t}function $m(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["embeddings"],r)}let o=u(i,["metadata"]);return o!=null&&p(e,["metadata"],o),e}function Hm(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>ym(c))),p(e,["embeddings"],r)}let o=u(i,["metadata"]);return o!=null&&p(e,["metadata"],o),e}function Km(i){let e={},t=u(i,["endpoint"]);t!=null&&p(e,["name"],t);let n=u(i,["deployedModelId"]);return n!=null&&p(e,["deployedModelId"],n),e}function zm(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Wm(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Jm(i){let e={},t=u(i,["mode"]);t!=null&&p(e,["mode"],t);let n=u(i,["allowedFunctionNames"]);if(n!=null&&p(e,["allowedFunctionNames"],n),u(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Qm(i){let e={};if(u(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=u(i,["description"]);t!=null&&p(e,["description"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["parameters"]);o!=null&&p(e,["parameters"],o);let r=u(i,["parametersJsonSchema"]);r!=null&&p(e,["parametersJsonSchema"],r);let c=u(i,["response"]);c!=null&&p(e,["response"],c);let m=u(i,["responseJsonSchema"]);return m!=null&&p(e,["responseJsonSchema"],m),e}function Ym(i,e,t){let n={},o=u(e,["systemInstruction"]);t!==void 0&&o!=null&&p(t,["systemInstruction"],Ji(qe(o)));let r=u(e,["temperature"]);r!=null&&p(n,["temperature"],r);let c=u(e,["topP"]);c!=null&&p(n,["topP"],c);let m=u(e,["topK"]);m!=null&&p(n,["topK"],m);let h=u(e,["candidateCount"]);h!=null&&p(n,["candidateCount"],h);let g=u(e,["maxOutputTokens"]);g!=null&&p(n,["maxOutputTokens"],g);let _=u(e,["stopSequences"]);_!=null&&p(n,["stopSequences"],_);let S=u(e,["responseLogprobs"]);S!=null&&p(n,["responseLogprobs"],S);let y=u(e,["logprobs"]);y!=null&&p(n,["logprobs"],y);let D=u(e,["presencePenalty"]);D!=null&&p(n,["presencePenalty"],D);let P=u(e,["frequencyPenalty"]);P!=null&&p(n,["frequencyPenalty"],P);let R=u(e,["seed"]);R!=null&&p(n,["seed"],R);let q=u(e,["responseMimeType"]);q!=null&&p(n,["responseMimeType"],q);let U=u(e,["responseSchema"]);U!=null&&p(n,["responseSchema"],_s(U));let Q=u(e,["responseJsonSchema"]);if(Q!=null&&p(n,["responseJsonSchema"],Q),u(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let J=u(e,["safetySettings"]);if(t!==void 0&&J!=null){let Me=J;Array.isArray(Me)&&(Me=Me.map(Ye=>Gp(Ye))),p(t,["safetySettings"],Me)}let ee=u(e,["tools"]);if(t!==void 0&&ee!=null){let Me=an(ee);Array.isArray(Me)&&(Me=Me.map(Ye=>Wp(sn(Ye)))),p(t,["tools"],Me)}let re=u(e,["toolConfig"]);if(t!==void 0&&re!=null&&p(t,["toolConfig"],zp(re)),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let de=u(e,["cachedContent"]);t!==void 0&&de!=null&&p(t,["cachedContent"],wt(i,de));let se=u(e,["responseModalities"]);se!=null&&p(n,["responseModalities"],se);let be=u(e,["mediaResolution"]);be!=null&&p(n,["mediaResolution"],be);let ae=u(e,["speechConfig"]);if(ae!=null&&p(n,["speechConfig"],Cs(ae)),u(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let Ce=u(e,["thinkingConfig"]);Ce!=null&&p(n,["thinkingConfig"],Ce);let Fe=u(e,["imageConfig"]);Fe!=null&&p(n,["imageConfig"],yp(Fe));let Oe=u(e,["enableEnhancedCivicAnswers"]);return Oe!=null&&p(n,["enableEnhancedCivicAnswers"],Oe),n}function Xm(i,e,t){let n={},o=u(e,["systemInstruction"]);t!==void 0&&o!=null&&p(t,["systemInstruction"],qe(o));let r=u(e,["temperature"]);r!=null&&p(n,["temperature"],r);let c=u(e,["topP"]);c!=null&&p(n,["topP"],c);let m=u(e,["topK"]);m!=null&&p(n,["topK"],m);let h=u(e,["candidateCount"]);h!=null&&p(n,["candidateCount"],h);let g=u(e,["maxOutputTokens"]);g!=null&&p(n,["maxOutputTokens"],g);let _=u(e,["stopSequences"]);_!=null&&p(n,["stopSequences"],_);let S=u(e,["responseLogprobs"]);S!=null&&p(n,["responseLogprobs"],S);let y=u(e,["logprobs"]);y!=null&&p(n,["logprobs"],y);let D=u(e,["presencePenalty"]);D!=null&&p(n,["presencePenalty"],D);let P=u(e,["frequencyPenalty"]);P!=null&&p(n,["frequencyPenalty"],P);let R=u(e,["seed"]);R!=null&&p(n,["seed"],R);let q=u(e,["responseMimeType"]);q!=null&&p(n,["responseMimeType"],q);let U=u(e,["responseSchema"]);U!=null&&p(n,["responseSchema"],_s(U));let Q=u(e,["responseJsonSchema"]);Q!=null&&p(n,["responseJsonSchema"],Q);let J=u(e,["routingConfig"]);J!=null&&p(n,["routingConfig"],J);let ee=u(e,["modelSelectionConfig"]);ee!=null&&p(n,["modelConfig"],ee);let re=u(e,["safetySettings"]);if(t!==void 0&&re!=null){let Z=re;Array.isArray(Z)&&(Z=Z.map(ne=>ne)),p(t,["safetySettings"],Z)}let de=u(e,["tools"]);if(t!==void 0&&de!=null){let Z=an(de);Array.isArray(Z)&&(Z=Z.map(ne=>Cc(sn(ne)))),p(t,["tools"],Z)}let se=u(e,["toolConfig"]);t!==void 0&&se!=null&&p(t,["toolConfig"],se);let be=u(e,["labels"]);t!==void 0&&be!=null&&p(t,["labels"],be);let ae=u(e,["cachedContent"]);t!==void 0&&ae!=null&&p(t,["cachedContent"],wt(i,ae));let Ce=u(e,["responseModalities"]);Ce!=null&&p(n,["responseModalities"],Ce);let Fe=u(e,["mediaResolution"]);Fe!=null&&p(n,["mediaResolution"],Fe);let Oe=u(e,["speechConfig"]);Oe!=null&&p(n,["speechConfig"],Cs(Oe));let Me=u(e,["audioTimestamp"]);Me!=null&&p(n,["audioTimestamp"],Me);let Ye=u(e,["thinkingConfig"]);Ye!=null&&p(n,["thinkingConfig"],Ye);let pn=u(e,["imageConfig"]);if(pn!=null&&p(n,["imageConfig"],wp(pn)),u(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function Nl(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let c=ot(o);Array.isArray(c)&&(c=c.map(m=>Ji(m))),p(t,["contents"],c)}let r=u(e,["config"]);return r!=null&&p(t,["generationConfig"],Ym(i,r,t)),t}function Bl(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["contents"]);if(o!=null){let c=ot(o);Array.isArray(c)&&(c=c.map(m=>m)),p(t,["contents"],c)}let r=u(e,["config"]);return r!=null&&p(t,["generationConfig"],Xm(i,r,t)),t}function Vl(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["candidates"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>vm(g))),p(e,["candidates"],h)}let o=u(i,["modelVersion"]);o!=null&&p(e,["modelVersion"],o);let r=u(i,["promptFeedback"]);r!=null&&p(e,["promptFeedback"],r);let c=u(i,["responseId"]);c!=null&&p(e,["responseId"],c);let m=u(i,["usageMetadata"]);return m!=null&&p(e,["usageMetadata"],m),e}function Ll(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["candidates"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(_=>_)),p(e,["candidates"],g)}let o=u(i,["createTime"]);o!=null&&p(e,["createTime"],o);let r=u(i,["modelVersion"]);r!=null&&p(e,["modelVersion"],r);let c=u(i,["promptFeedback"]);c!=null&&p(e,["promptFeedback"],c);let m=u(i,["responseId"]);m!=null&&p(e,["responseId"],m);let h=u(i,["usageMetadata"]);return h!=null&&p(e,["usageMetadata"],h),e}function Zm(i,e){let t={};if(u(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=u(i,["numberOfImages"]);e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n);let o=u(i,["aspectRatio"]);e!==void 0&&o!=null&&p(e,["parameters","aspectRatio"],o);let r=u(i,["guidanceScale"]);if(e!==void 0&&r!=null&&p(e,["parameters","guidanceScale"],r),u(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let c=u(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&p(e,["parameters","safetySetting"],c);let m=u(i,["personGeneration"]);e!==void 0&&m!=null&&p(e,["parameters","personGeneration"],m);let h=u(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&p(e,["parameters","includeSafetyAttributes"],h);let g=u(i,["includeRaiReason"]);e!==void 0&&g!=null&&p(e,["parameters","includeRaiReason"],g);let _=u(i,["language"]);e!==void 0&&_!=null&&p(e,["parameters","language"],_);let S=u(i,["outputMimeType"]);e!==void 0&&S!=null&&p(e,["parameters","outputOptions","mimeType"],S);let y=u(i,["outputCompressionQuality"]);if(e!==void 0&&y!=null&&p(e,["parameters","outputOptions","compressionQuality"],y),u(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(u(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let D=u(i,["imageSize"]);if(e!==void 0&&D!=null&&p(e,["parameters","sampleImageSize"],D),u(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function jm(i,e){let t={},n=u(i,["outputGcsUri"]);e!==void 0&&n!=null&&p(e,["parameters","storageUri"],n);let o=u(i,["negativePrompt"]);e!==void 0&&o!=null&&p(e,["parameters","negativePrompt"],o);let r=u(i,["numberOfImages"]);e!==void 0&&r!=null&&p(e,["parameters","sampleCount"],r);let c=u(i,["aspectRatio"]);e!==void 0&&c!=null&&p(e,["parameters","aspectRatio"],c);let m=u(i,["guidanceScale"]);e!==void 0&&m!=null&&p(e,["parameters","guidanceScale"],m);let h=u(i,["seed"]);e!==void 0&&h!=null&&p(e,["parameters","seed"],h);let g=u(i,["safetyFilterLevel"]);e!==void 0&&g!=null&&p(e,["parameters","safetySetting"],g);let _=u(i,["personGeneration"]);e!==void 0&&_!=null&&p(e,["parameters","personGeneration"],_);let S=u(i,["includeSafetyAttributes"]);e!==void 0&&S!=null&&p(e,["parameters","includeSafetyAttributes"],S);let y=u(i,["includeRaiReason"]);e!==void 0&&y!=null&&p(e,["parameters","includeRaiReason"],y);let D=u(i,["language"]);e!==void 0&&D!=null&&p(e,["parameters","language"],D);let P=u(i,["outputMimeType"]);e!==void 0&&P!=null&&p(e,["parameters","outputOptions","mimeType"],P);let R=u(i,["outputCompressionQuality"]);e!==void 0&&R!=null&&p(e,["parameters","outputOptions","compressionQuality"],R);let q=u(i,["addWatermark"]);e!==void 0&&q!=null&&p(e,["parameters","addWatermark"],q);let U=u(i,["labels"]);e!==void 0&&U!=null&&p(e,["labels"],U);let Q=u(i,["imageSize"]);e!==void 0&&Q!=null&&p(e,["parameters","sampleImageSize"],Q);let J=u(i,["enhancePrompt"]);return e!==void 0&&J!=null&&p(e,["parameters","enhancePrompt"],J),t}function ep(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let r=u(e,["config"]);return r!=null&&Zm(r,t),t}function tp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let r=u(e,["config"]);return r!=null&&jm(r,t),t}function np(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>gp(c))),p(e,["generatedImages"],r)}let o=u(i,["positivePromptSafetyAttributes"]);return o!=null&&p(e,["positivePromptSafetyAttributes"],fc(o)),e}function ip(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>Qi(c))),p(e,["generatedImages"],r)}let o=u(i,["positivePromptSafetyAttributes"]);return o!=null&&p(e,["positivePromptSafetyAttributes"],_c(o)),e}function op(i,e){let t={},n=u(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n),u(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let o=u(i,["durationSeconds"]);if(e!==void 0&&o!=null&&p(e,["parameters","durationSeconds"],o),u(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=u(i,["aspectRatio"]);e!==void 0&&r!=null&&p(e,["parameters","aspectRatio"],r);let c=u(i,["resolution"]);e!==void 0&&c!=null&&p(e,["parameters","resolution"],c);let m=u(i,["personGeneration"]);if(e!==void 0&&m!=null&&p(e,["parameters","personGeneration"],m),u(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let h=u(i,["negativePrompt"]);e!==void 0&&h!=null&&p(e,["parameters","negativePrompt"],h);let g=u(i,["enhancePrompt"]);if(e!==void 0&&g!=null&&p(e,["parameters","enhancePrompt"],g),u(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let _=u(i,["lastFrame"]);e!==void 0&&_!=null&&p(e,["instances[0]","lastFrame"],Yi(_));let S=u(i,["referenceImages"]);if(e!==void 0&&S!=null){let y=S;Array.isArray(y)&&(y=y.map(D=>sg(D))),p(e,["instances[0]","referenceImages"],y)}if(u(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(u(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function rp(i,e){let t={},n=u(i,["numberOfVideos"]);e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n);let o=u(i,["outputGcsUri"]);e!==void 0&&o!=null&&p(e,["parameters","storageUri"],o);let r=u(i,["fps"]);e!==void 0&&r!=null&&p(e,["parameters","fps"],r);let c=u(i,["durationSeconds"]);e!==void 0&&c!=null&&p(e,["parameters","durationSeconds"],c);let m=u(i,["seed"]);e!==void 0&&m!=null&&p(e,["parameters","seed"],m);let h=u(i,["aspectRatio"]);e!==void 0&&h!=null&&p(e,["parameters","aspectRatio"],h);let g=u(i,["resolution"]);e!==void 0&&g!=null&&p(e,["parameters","resolution"],g);let _=u(i,["personGeneration"]);e!==void 0&&_!=null&&p(e,["parameters","personGeneration"],_);let S=u(i,["pubsubTopic"]);e!==void 0&&S!=null&&p(e,["parameters","pubsubTopic"],S);let y=u(i,["negativePrompt"]);e!==void 0&&y!=null&&p(e,["parameters","negativePrompt"],y);let D=u(i,["enhancePrompt"]);e!==void 0&&D!=null&&p(e,["parameters","enhancePrompt"],D);let P=u(i,["generateAudio"]);e!==void 0&&P!=null&&p(e,["parameters","generateAudio"],P);let R=u(i,["lastFrame"]);e!==void 0&&R!=null&&p(e,["instances[0]","lastFrame"],mt(R));let q=u(i,["referenceImages"]);if(e!==void 0&&q!=null){let J=q;Array.isArray(J)&&(J=J.map(ee=>ag(ee))),p(e,["instances[0]","referenceImages"],J)}let U=u(i,["mask"]);e!==void 0&&U!=null&&p(e,["instances[0]","mask"],rg(U));let Q=u(i,["compressionQuality"]);return e!==void 0&&Q!=null&&p(e,["parameters","compressionQuality"],Q),t}function sp(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["response","generateVideoResponse"]);return c!=null&&p(e,["response"],dp(c)),e}function ap(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["response"]);return c!=null&&p(e,["response"],up(c)),e}function lp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let r=u(e,["image"]);r!=null&&p(t,["instances[0]","image"],Yi(r));let c=u(e,["video"]);c!=null&&p(t,["instances[0]","video"],vc(c));let m=u(e,["source"]);m!=null&&mp(m,t);let h=u(e,["config"]);return h!=null&&op(h,t),t}function cp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let r=u(e,["image"]);r!=null&&p(t,["instances[0]","image"],mt(r));let c=u(e,["video"]);c!=null&&p(t,["instances[0]","video"],xc(c));let m=u(e,["source"]);m!=null&&pp(m,t);let h=u(e,["config"]);return h!=null&&rp(h,t),t}function dp(i){let e={},t=u(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(c=>fp(c))),p(e,["generatedVideos"],r)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function up(i){let e={},t=u(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(c=>_p(c))),p(e,["generatedVideos"],r)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function mp(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["image"]);e!==void 0&&o!=null&&p(e,["instances[0]","image"],Yi(o));let r=u(i,["video"]);return e!==void 0&&r!=null&&p(e,["instances[0]","video"],vc(r)),t}function pp(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["image"]);e!==void 0&&o!=null&&p(e,["instances[0]","image"],mt(o));let r=u(i,["video"]);return e!==void 0&&r!=null&&p(e,["instances[0]","video"],xc(r)),t}function gp(i){let e={},t=u(i,["_self"]);t!=null&&p(e,["image"],Ep(t));let n=u(i,["raiFilteredReason"]);n!=null&&p(e,["raiFilteredReason"],n);let o=u(i,["_self"]);return o!=null&&p(e,["safetyAttributes"],fc(o)),e}function Qi(i){let e={},t=u(i,["_self"]);t!=null&&p(e,["image"],hc(t));let n=u(i,["raiFilteredReason"]);n!=null&&p(e,["raiFilteredReason"],n);let o=u(i,["_self"]);o!=null&&p(e,["safetyAttributes"],_c(o));let r=u(i,["prompt"]);return r!=null&&p(e,["enhancedPrompt"],r),e}function hp(i){let e={},t=u(i,["_self"]);t!=null&&p(e,["mask"],hc(t));let n=u(i,["labels"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),p(e,["labels"],o)}return e}function fp(i){let e={},t=u(i,["video"]);return t!=null&&p(e,["video"],ig(t)),e}function _p(i){let e={},t=u(i,["_self"]);return t!=null&&p(e,["video"],og(t)),e}function Cp(i){let e={},t=u(i,["modelSelectionConfig"]);t!=null&&p(e,["modelConfig"],t);let n=u(i,["responseJsonSchema"]);n!=null&&p(e,["responseJsonSchema"],n);let o=u(i,["audioTimestamp"]);o!=null&&p(e,["audioTimestamp"],o);let r=u(i,["candidateCount"]);r!=null&&p(e,["candidateCount"],r);let c=u(i,["enableAffectiveDialog"]);c!=null&&p(e,["enableAffectiveDialog"],c);let m=u(i,["frequencyPenalty"]);m!=null&&p(e,["frequencyPenalty"],m);let h=u(i,["logprobs"]);h!=null&&p(e,["logprobs"],h);let g=u(i,["maxOutputTokens"]);g!=null&&p(e,["maxOutputTokens"],g);let _=u(i,["mediaResolution"]);_!=null&&p(e,["mediaResolution"],_);let S=u(i,["presencePenalty"]);S!=null&&p(e,["presencePenalty"],S);let y=u(i,["responseLogprobs"]);y!=null&&p(e,["responseLogprobs"],y);let D=u(i,["responseMimeType"]);D!=null&&p(e,["responseMimeType"],D);let P=u(i,["responseModalities"]);P!=null&&p(e,["responseModalities"],P);let R=u(i,["responseSchema"]);R!=null&&p(e,["responseSchema"],R);let q=u(i,["routingConfig"]);q!=null&&p(e,["routingConfig"],q);let U=u(i,["seed"]);U!=null&&p(e,["seed"],U);let Q=u(i,["speechConfig"]);Q!=null&&p(e,["speechConfig"],Q);let J=u(i,["stopSequences"]);J!=null&&p(e,["stopSequences"],J);let ee=u(i,["temperature"]);ee!=null&&p(e,["temperature"],ee);let re=u(i,["thinkingConfig"]);re!=null&&p(e,["thinkingConfig"],re);let de=u(i,["topK"]);de!=null&&p(e,["topK"],de);let se=u(i,["topP"]);if(se!=null&&p(e,["topP"],se),u(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function vp(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Ae(i,n)),t}function xp(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Ae(i,n)),t}function bp(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function Sp(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function yp(i){let e={},t=u(i,["aspectRatio"]);t!=null&&p(e,["aspectRatio"],t);let n=u(i,["imageSize"]);if(n!=null&&p(e,["imageSize"],n),u(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function wp(i){let e={},t=u(i,["aspectRatio"]);t!=null&&p(e,["aspectRatio"],t);let n=u(i,["imageSize"]);n!=null&&p(e,["imageSize"],n);let o=u(i,["outputMimeType"]);o!=null&&p(e,["imageOutputOptions","mimeType"],o);let r=u(i,["outputCompressionQuality"]);return r!=null&&p(e,["imageOutputOptions","compressionQuality"],r),e}function Ep(i){let e={},t=u(i,["bytesBase64Encoded"]);t!=null&&p(e,["imageBytes"],kt(t));let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function hc(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["gcsUri"],t);let n=u(i,["bytesBase64Encoded"]);n!=null&&p(e,["imageBytes"],kt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function Yi(i){let e={};if(u(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=u(i,["imageBytes"]);t!=null&&p(e,["bytesBase64Encoded"],kt(t));let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function mt(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["gcsUri"],t);let n=u(i,["imageBytes"]);n!=null&&p(e,["bytesBase64Encoded"],kt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function Ap(i,e,t){let n={},o=u(e,["pageSize"]);t!==void 0&&o!=null&&p(t,["_query","pageSize"],o);let r=u(e,["pageToken"]);t!==void 0&&r!=null&&p(t,["_query","pageToken"],r);let c=u(e,["filter"]);t!==void 0&&c!=null&&p(t,["_query","filter"],c);let m=u(e,["queryBase"]);return t!==void 0&&m!=null&&p(t,["_url","models_url"],lc(i,m)),n}function Dp(i,e,t){let n={},o=u(e,["pageSize"]);t!==void 0&&o!=null&&p(t,["_query","pageSize"],o);let r=u(e,["pageToken"]);t!==void 0&&r!=null&&p(t,["_query","pageToken"],r);let c=u(e,["filter"]);t!==void 0&&c!=null&&p(t,["_query","filter"],c);let m=u(e,["queryBase"]);return t!==void 0&&m!=null&&p(t,["_url","models_url"],lc(i,m)),n}function Mp(i,e){let t={},n=u(e,["config"]);return n!=null&&Ap(i,n,t),t}function Tp(i,e){let t={},n=u(e,["config"]);return n!=null&&Dp(i,n,t),t}function Ip(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["_self"]);if(o!=null){let r=cc(o);Array.isArray(r)&&(r=r.map(c=>Ur(c))),p(e,["models"],r)}return e}function kp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["_self"]);if(o!=null){let r=cc(o);Array.isArray(r)&&(r=r.map(c=>qr(c))),p(e,["models"],r)}return e}function Pp(i){let e={},t=u(i,["maskMode"]);t!=null&&p(e,["maskMode"],t);let n=u(i,["segmentationClasses"]);n!=null&&p(e,["maskClasses"],n);let o=u(i,["maskDilation"]);return o!=null&&p(e,["dilation"],o),e}function Ur(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);o!=null&&p(e,["description"],o);let r=u(i,["version"]);r!=null&&p(e,["version"],r);let c=u(i,["_self"]);c!=null&&p(e,["tunedModelInfo"],Jp(c));let m=u(i,["inputTokenLimit"]);m!=null&&p(e,["inputTokenLimit"],m);let h=u(i,["outputTokenLimit"]);h!=null&&p(e,["outputTokenLimit"],h);let g=u(i,["supportedGenerationMethods"]);g!=null&&p(e,["supportedActions"],g);let _=u(i,["temperature"]);_!=null&&p(e,["temperature"],_);let S=u(i,["maxTemperature"]);S!=null&&p(e,["maxTemperature"],S);let y=u(i,["topP"]);y!=null&&p(e,["topP"],y);let D=u(i,["topK"]);D!=null&&p(e,["topK"],D);let P=u(i,["thinking"]);return P!=null&&p(e,["thinking"],P),e}function qr(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);o!=null&&p(e,["description"],o);let r=u(i,["versionId"]);r!=null&&p(e,["version"],r);let c=u(i,["deployedModels"]);if(c!=null){let S=c;Array.isArray(S)&&(S=S.map(y=>Km(y))),p(e,["endpoints"],S)}let m=u(i,["labels"]);m!=null&&p(e,["labels"],m);let h=u(i,["_self"]);h!=null&&p(e,["tunedModelInfo"],Qp(h));let g=u(i,["defaultCheckpointId"]);g!=null&&p(e,["defaultCheckpointId"],g);let _=u(i,["checkpoints"]);if(_!=null){let S=_;Array.isArray(S)&&(S=S.map(y=>y)),p(e,["checkpoints"],S)}return e}function Fp(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let r=u(i,["fileData"]);r!=null&&p(e,["fileData"],zm(r));let c=u(i,["functionCall"]);c!=null&&p(e,["functionCall"],Wm(c));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let h=u(i,["inlineData"]);h!=null&&p(e,["inlineData"],Cm(h));let g=u(i,["text"]);g!=null&&p(e,["text"],g);let _=u(i,["thought"]);_!=null&&p(e,["thought"],_);let S=u(i,["thoughtSignature"]);S!=null&&p(e,["thoughtSignature"],S);let y=u(i,["videoMetadata"]);return y!=null&&p(e,["videoMetadata"],y),e}function Rp(i){let e={},t=u(i,["productImage"]);return t!=null&&p(e,["image"],mt(t)),e}function Np(i,e){let t={},n=u(i,["numberOfImages"]);e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n);let o=u(i,["baseSteps"]);e!==void 0&&o!=null&&p(e,["parameters","baseSteps"],o);let r=u(i,["outputGcsUri"]);e!==void 0&&r!=null&&p(e,["parameters","storageUri"],r);let c=u(i,["seed"]);e!==void 0&&c!=null&&p(e,["parameters","seed"],c);let m=u(i,["safetyFilterLevel"]);e!==void 0&&m!=null&&p(e,["parameters","safetySetting"],m);let h=u(i,["personGeneration"]);e!==void 0&&h!=null&&p(e,["parameters","personGeneration"],h);let g=u(i,["addWatermark"]);e!==void 0&&g!=null&&p(e,["parameters","addWatermark"],g);let _=u(i,["outputMimeType"]);e!==void 0&&_!=null&&p(e,["parameters","outputOptions","mimeType"],_);let S=u(i,["outputCompressionQuality"]);e!==void 0&&S!=null&&p(e,["parameters","outputOptions","compressionQuality"],S);let y=u(i,["enhancePrompt"]);e!==void 0&&y!=null&&p(e,["parameters","enhancePrompt"],y);let D=u(i,["labels"]);return e!==void 0&&D!=null&&p(e,["labels"],D),t}function Bp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["source"]);o!=null&&Lp(o,t);let r=u(e,["config"]);return r!=null&&Np(r,t),t}function Vp(i){let e={},t=u(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>Qi(o))),p(e,["generatedImages"],n)}return e}function Lp(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["personImage"]);e!==void 0&&o!=null&&p(e,["instances[0]","personImage","image"],mt(o));let r=u(i,["productImages"]);if(e!==void 0&&r!=null){let c=r;Array.isArray(c)&&(c=c.map(m=>Rp(m))),p(e,["instances[0]","productImages"],c)}return t}function Op(i){let e={},t=u(i,["referenceImage"]);t!=null&&p(e,["referenceImage"],mt(t));let n=u(i,["referenceId"]);n!=null&&p(e,["referenceId"],n);let o=u(i,["referenceType"]);o!=null&&p(e,["referenceType"],o);let r=u(i,["maskImageConfig"]);r!=null&&p(e,["maskImageConfig"],Pp(r));let c=u(i,["controlImageConfig"]);c!=null&&p(e,["controlImageConfig"],Em(c));let m=u(i,["styleImageConfig"]);m!=null&&p(e,["styleImageConfig"],m);let h=u(i,["subjectImageConfig"]);return h!=null&&p(e,["subjectImageConfig"],h),e}function fc(i){let e={},t=u(i,["safetyAttributes","categories"]);t!=null&&p(e,["categories"],t);let n=u(i,["safetyAttributes","scores"]);n!=null&&p(e,["scores"],n);let o=u(i,["contentType"]);return o!=null&&p(e,["contentType"],o),e}function _c(i){let e={},t=u(i,["safetyAttributes","categories"]);t!=null&&p(e,["categories"],t);let n=u(i,["safetyAttributes","scores"]);n!=null&&p(e,["scores"],n);let o=u(i,["contentType"]);return o!=null&&p(e,["contentType"],o),e}function Gp(i){let e={},t=u(i,["category"]);if(t!=null&&p(e,["category"],t),u(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=u(i,["threshold"]);return n!=null&&p(e,["threshold"],n),e}function Up(i){let e={},t=u(i,["image"]);return t!=null&&p(e,["image"],mt(t)),e}function qp(i,e){let t={},n=u(i,["mode"]);e!==void 0&&n!=null&&p(e,["parameters","mode"],n);let o=u(i,["maxPredictions"]);e!==void 0&&o!=null&&p(e,["parameters","maxPredictions"],o);let r=u(i,["confidenceThreshold"]);e!==void 0&&r!=null&&p(e,["parameters","confidenceThreshold"],r);let c=u(i,["maskDilation"]);e!==void 0&&c!=null&&p(e,["parameters","maskDilation"],c);let m=u(i,["binaryColorThreshold"]);e!==void 0&&m!=null&&p(e,["parameters","binaryColorThreshold"],m);let h=u(i,["labels"]);return e!==void 0&&h!=null&&p(e,["labels"],h),t}function $p(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["source"]);o!=null&&Kp(o,t);let r=u(e,["config"]);return r!=null&&qp(r,t),t}function Hp(i){let e={},t=u(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>hp(o))),p(e,["generatedMasks"],n)}return e}function Kp(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["image"]);e!==void 0&&o!=null&&p(e,["instances[0]","image"],mt(o));let r=u(i,["scribbleImage"]);return e!==void 0&&r!=null&&p(e,["instances[0]","scribble"],Up(r)),t}function zp(i){let e={},t=u(i,["functionCallingConfig"]);t!=null&&p(e,["functionCallingConfig"],Jm(t));let n=u(i,["retrievalConfig"]);return n!=null&&p(e,["retrievalConfig"],n),e}function Wp(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let _=t;Array.isArray(_)&&(_=_.map(S=>S)),p(e,["functionDeclarations"],_)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let r=u(i,["fileSearch"]);r!=null&&p(e,["fileSearch"],r);let c=u(i,["codeExecution"]);if(c!=null&&p(e,["codeExecution"],c),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],bp(m));let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],Sp(h));let g=u(i,["urlContext"]);return g!=null&&p(e,["urlContext"],g),e}function Cc(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let S=t;Array.isArray(S)&&(S=S.map(y=>Qm(y))),p(e,["functionDeclarations"],S)}let n=u(i,["retrieval"]);n!=null&&p(e,["retrieval"],n);let o=u(i,["googleSearchRetrieval"]);o!=null&&p(e,["googleSearchRetrieval"],o);let r=u(i,["computerUse"]);if(r!=null&&p(e,["computerUse"],r),u(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let c=u(i,["codeExecution"]);c!=null&&p(e,["codeExecution"],c);let m=u(i,["enterpriseWebSearch"]);m!=null&&p(e,["enterpriseWebSearch"],m);let h=u(i,["googleMaps"]);h!=null&&p(e,["googleMaps"],h);let g=u(i,["googleSearch"]);g!=null&&p(e,["googleSearch"],g);let _=u(i,["urlContext"]);return _!=null&&p(e,["urlContext"],_),e}function Jp(i){let e={},t=u(i,["baseModel"]);t!=null&&p(e,["baseModel"],t);let n=u(i,["createTime"]);n!=null&&p(e,["createTime"],n);let o=u(i,["updateTime"]);return o!=null&&p(e,["updateTime"],o),e}function Qp(i){let e={},t=u(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&p(e,["baseModel"],t);let n=u(i,["createTime"]);n!=null&&p(e,["createTime"],n);let o=u(i,["updateTime"]);return o!=null&&p(e,["updateTime"],o),e}function Yp(i,e){let t={},n=u(i,["displayName"]);e!==void 0&&n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);e!==void 0&&o!=null&&p(e,["description"],o);let r=u(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&p(e,["defaultCheckpointId"],r),t}function Xp(i,e){let t={},n=u(i,["displayName"]);e!==void 0&&n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);e!==void 0&&o!=null&&p(e,["description"],o);let r=u(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&p(e,["defaultCheckpointId"],r),t}function Zp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","name"],Ae(i,n));let o=u(e,["config"]);return o!=null&&Yp(o,t),t}function jp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["config"]);return o!=null&&Xp(o,t),t}function eg(i,e){let t={},n=u(i,["outputGcsUri"]);e!==void 0&&n!=null&&p(e,["parameters","storageUri"],n);let o=u(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&p(e,["parameters","safetySetting"],o);let r=u(i,["personGeneration"]);e!==void 0&&r!=null&&p(e,["parameters","personGeneration"],r);let c=u(i,["includeRaiReason"]);e!==void 0&&c!=null&&p(e,["parameters","includeRaiReason"],c);let m=u(i,["outputMimeType"]);e!==void 0&&m!=null&&p(e,["parameters","outputOptions","mimeType"],m);let h=u(i,["outputCompressionQuality"]);e!==void 0&&h!=null&&p(e,["parameters","outputOptions","compressionQuality"],h);let g=u(i,["enhanceInputImage"]);e!==void 0&&g!=null&&p(e,["parameters","upscaleConfig","enhanceInputImage"],g);let _=u(i,["imagePreservationFactor"]);e!==void 0&&_!=null&&p(e,["parameters","upscaleConfig","imagePreservationFactor"],_);let S=u(i,["labels"]);e!==void 0&&S!=null&&p(e,["labels"],S);let y=u(i,["numberOfImages"]);e!==void 0&&y!=null&&p(e,["parameters","sampleCount"],y);let D=u(i,["mode"]);return e!==void 0&&D!=null&&p(e,["parameters","mode"],D),t}function tg(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Ae(i,n));let o=u(e,["image"]);o!=null&&p(t,["instances[0]","image"],mt(o));let r=u(e,["upscaleFactor"]);r!=null&&p(t,["parameters","upscaleConfig","upscaleFactor"],r);let c=u(e,["config"]);return c!=null&&eg(c,t),t}function ng(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Qi(r))),p(e,["generatedImages"],o)}return e}function ig(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["uri"],t);let n=u(i,["encodedVideo"]);n!=null&&p(e,["videoBytes"],kt(n));let o=u(i,["encoding"]);return o!=null&&p(e,["mimeType"],o),e}function og(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["uri"],t);let n=u(i,["bytesBase64Encoded"]);n!=null&&p(e,["videoBytes"],kt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function rg(i){let e={},t=u(i,["image"]);t!=null&&p(e,["_self"],mt(t));let n=u(i,["maskMode"]);return n!=null&&p(e,["maskMode"],n),e}function sg(i){let e={},t=u(i,["image"]);t!=null&&p(e,["image"],Yi(t));let n=u(i,["referenceType"]);return n!=null&&p(e,["referenceType"],n),e}function ag(i){let e={},t=u(i,["image"]);t!=null&&p(e,["image"],mt(t));let n=u(i,["referenceType"]);return n!=null&&p(e,["referenceType"],n),e}function vc(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["uri"],t);let n=u(i,["videoBytes"]);n!=null&&p(e,["encodedVideo"],kt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["encoding"],o),e}function xc(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["gcsUri"],t);let n=u(i,["videoBytes"]);n!=null&&p(e,["bytesBase64Encoded"],kt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function lg(i,e){let t={},n=u(i,["displayName"]);return e!==void 0&&n!=null&&p(e,["displayName"],n),t}function cg(i){let e={},t=u(i,["config"]);return t!=null&&lg(t,e),e}function dg(i,e){let t={},n=u(i,["force"]);return e!==void 0&&n!=null&&p(e,["_query","force"],n),t}function ug(i){let e={},t=u(i,["name"]);t!=null&&p(e,["_url","name"],t);let n=u(i,["config"]);return n!=null&&dg(n,e),e}function mg(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","name"],t),e}function pg(i,e){let t={},n=u(i,["customMetadata"]);if(e!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["customMetadata"],r)}let o=u(i,["chunkingConfig"]);return e!==void 0&&o!=null&&p(e,["chunkingConfig"],o),t}function gg(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let r=u(i,["error"]);r!=null&&p(e,["error"],r);let c=u(i,["response"]);return c!=null&&p(e,["response"],fg(c)),e}function hg(i){let e={},t=u(i,["fileSearchStoreName"]);t!=null&&p(e,["_url","file_search_store_name"],t);let n=u(i,["fileName"]);n!=null&&p(e,["fileName"],n);let o=u(i,["config"]);return o!=null&&pg(o,e),e}function fg(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["parent"]);n!=null&&p(e,["parent"],n);let o=u(i,["documentName"]);return o!=null&&p(e,["documentName"],o),e}function _g(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function Cg(i){let e={},t=u(i,["config"]);return t!=null&&_g(t,e),e}function vg(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["fileSearchStores"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["fileSearchStores"],r)}return e}function bc(i,e){let t={},n=u(i,["mimeType"]);e!==void 0&&n!=null&&p(e,["mimeType"],n);let o=u(i,["displayName"]);e!==void 0&&o!=null&&p(e,["displayName"],o);let r=u(i,["customMetadata"]);if(e!==void 0&&r!=null){let m=r;Array.isArray(m)&&(m=m.map(h=>h)),p(e,["customMetadata"],m)}let c=u(i,["chunkingConfig"]);return e!==void 0&&c!=null&&p(e,["chunkingConfig"],c),t}function xg(i){let e={},t=u(i,["fileSearchStoreName"]);t!=null&&p(e,["_url","file_search_store_name"],t);let n=u(i,["config"]);return n!=null&&bc(n,e),e}function bg(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}var Sg="Content-Type",yg="X-Server-Timeout",wg="User-Agent",$r="x-goog-api-client",Eg="1.34.0",Ag=`google-genai-sdk/${Eg}`,Dg="v1beta1",Mg="v1beta",Hr=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Dg,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Mg,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let o=[this.getRequestUrlInternal(t)];return n&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[c,m]of Object.entries(e.queryParams))o.searchParams.append(c,String(m));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,o.toString(),e.abortSignal),this.unaryApiCall(o,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[o,r]of Object.entries(t))typeof r=="object"?n[o]=Object.assign(Object.assign({},n[o]),r):r!==void 0&&(n[o]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,n);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,o.toString(),e.abortSignal),this.streamApiCall(o,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,o){if(t&&t.timeout||o){let r=new AbortController,c=r.signal;if(t.timeout&&t?.timeout>0){let m=setTimeout(()=>r.abort(),t.timeout);m&&typeof m.unref=="function"&&m.unref()}o&&o.addEventListener("abort",()=>{r.abort()}),e.signal=c}return t&&t.extraBody!==null&&Tg(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async o=>(await Ol(o),new Tn(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async o=>(await Ol(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return ct(this,arguments,function*(){var n;let o=(n=e?.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let c="",m="data:",h=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:g,value:_}=yield pe(o.read());if(g){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let S=r.decode(_,{stream:!0});try{let P=JSON.parse(S);if("error"in P){let R=JSON.parse(JSON.stringify(P.error)),q=R.status,U=R.code,Q=`got status: ${q}. ${JSON.stringify(P)}`;if(U>=400&&U<600)throw new Fi({message:Q,status:U})}}catch(P){if(P.name==="ApiError")throw P}c+=S;let y=-1,D=0;for(;;){y=-1,D=0;for(let q of h){let U=c.indexOf(q);U!==-1&&(y===-1||U<y)&&(y=U,D=q.length)}if(y===-1)break;let P=c.substring(0,y);c=c.substring(y+D);let R=P.trim();if(R.startsWith(m)){let q=R.substring(m.length).trim();try{let U=new Response(q,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield pe(new Tn(U))}catch(U){throw new Error(`exception parsing stream chunk ${q}. ${U}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=Ag+" "+this.clientOptions.userAgentExtra;return e[wg]=t,e[$r]=t,e[Sg]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[o,r]of Object.entries(e.headers))n.append(o,r);e.timeout&&e.timeout>0&&n.append(yg,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);let r=this.clientOptions.uploader,c=await r.stat(e);o.sizeBytes=String(c.size);let m=(n=t?.mimeType)!==null&&n!==void 0?n:c.type;if(m===void 0||m==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=m;let h={file:o},g=this.getFileName(e),_=X("upload/v1beta/files",h._url),S=await this.fetchUploadUrl(_,o.sizeBytes,o.mimeType,g,h,t?.httpOptions);return r.upload(e,S,this)}async uploadFileToFileSearchStore(e,t,n){var o;let r=this.clientOptions.uploader,c=await r.stat(t),m=String(c.size),h=(o=n?.mimeType)!==null&&o!==void 0?o:c.type;if(h===void 0||h==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let g=`upload/v1beta/${e}:uploadToFileSearchStore`,_=this.getFileName(t),S={};n!=null&&bc(n,S);let y=await this.fetchUploadUrl(g,m,h,_,S,n?.httpOptions);return r.uploadToFileSearchStore(t,y,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,o,r,c){var m;let h={};c?h=c:h={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},o?{"X-Goog-Upload-File-Name":o}:{})};let g=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:h});if(!g||!g?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let _=(m=g?.headers)===null||m===void 0?void 0:m["x-goog-upload-url"];if(_===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return _}};async function Ol(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){let t=i.status,n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};let o=JSON.stringify(n);throw t>=400&&t<600?new Fi({message:o,status:t}):new Error(o)}}function Tg(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{let r=JSON.parse(i.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,c){let m=Object.assign({},r);for(let h in c)if(Object.prototype.hasOwnProperty.call(c,h)){let g=c[h],_=m[h];g&&typeof g=="object"&&!Array.isArray(g)&&_&&typeof _=="object"&&!Array.isArray(_)?m[h]=n(_,g):(_&&g&&typeof _!=typeof g&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${h}". Original type: ${typeof _}, New type: ${typeof g}. Overwriting.`),m[h]=g)}return m}let o=n(t,e);i.body=JSON.stringify(o)}var Ig="mcp_used/unknown",kg=!1;function Sc(i){for(let e of i)if(Pg(e)||typeof e=="object"&&"inputSchema"in e)return!0;return kg}function yc(i){var e;let t=(e=i[$r])!==null&&e!==void 0?e:"";i[$r]=(t+` ${Ig}`).trimStart()}function Pg(i){return i!==null&&typeof i=="object"&&i instanceof Kr}function Fg(i){return ct(this,arguments,function*(t,n=100){let o,r=0;for(;r<n;){let c=yield pe(t.listTools({cursor:o}));for(let m of c.tools)yield yield pe(m),r++;if(!c.nextCursor)break;o=c.nextCursor}})}var Kr=class i{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new i(e,t)}async initialize(){var e,t,n,o;if(this.mcpTools.length>0)return;let r={},c=[];for(let _ of this.mcpClients)try{for(var m=!0,h=(t=void 0,dt(Fg(_))),g;g=await h.next(),e=g.done,!e;m=!0){o=g.value,m=!1;let S=o;c.push(S);let y=S.name;if(r[y])throw new Error(`Duplicate function name ${y} found in MCP tools. Please ensure function names are unique.`);r[y]=_}}catch(S){t={error:S}}finally{try{!m&&!e&&(n=h.return)&&await n.call(h)}finally{if(t)throw t.error}}this.mcpTools=c,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),_u(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let o=this.functionNameToMcpClient[n.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let c=await o.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:c.isError?{error:c}:c}})}return t}};async function Rg(i,e,t){let n=new Pr,o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data),Object.assign(n,o),e(n)}var zr=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let o=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),c=Bg(this.apiClient.getDefaultHeaders()),m=this.apiClient.getApiKey(),h=`${o}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${m}`,g=()=>{},_=new Promise(J=>{g=J}),S=e.callbacks,y=function(){g({})},D=this.apiClient,P={onopen:y,onmessage:J=>{Rg(D,S.onmessage,J)},onerror:(t=S?.onerror)!==null&&t!==void 0?t:function(J){},onclose:(n=S?.onclose)!==null&&n!==void 0?n:function(J){}},R=this.webSocketFactory.create(h,Ng(c),P);R.connect(),await _;let Q={setup:{model:Ae(this.apiClient,e.model)}};return R.send(JSON.stringify(Q)),new Wr(R,this.apiClient)}},Wr=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=cm(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=lm(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Dn.PLAY)}pause(){this.sendPlaybackControl(Dn.PAUSE)}stop(){this.sendPlaybackControl(Dn.STOP)}resetContext(){this.sendPlaybackControl(Dn.RESET_CONTEXT)}close(){this.conn.close()}};function Ng(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function Bg(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var Vg="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Lg(i,e,t){let n=new kr,o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;let r=JSON.parse(o);if(i.isVertexAI()){let c=mm(r);Object.assign(n,c)}else Object.assign(n,r);e(n)}var Jr=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new zr(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,o,r,c,m;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let h=this.apiClient.getWebsocketBaseUrl(),g=this.apiClient.getApiVersion(),_,S=this.apiClient.getHeaders();e.config&&e.config.tools&&Sc(e.config.tools)&&yc(S);let y=Ug(S);if(this.apiClient.isVertexAI())_=`${h}/ws/google.cloud.aiplatform.${g}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(y,_);else{let ae=this.apiClient.getApiKey(),Ce="BidiGenerateContent",Fe="key";ae?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),g!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),Ce="BidiGenerateContentConstrained",Fe="access_token"),_=`${h}/ws/google.ai.generativelanguage.${g}.GenerativeService.${Ce}?${Fe}=${ae}`}let D=()=>{},P=new Promise(ae=>{D=ae}),R=e.callbacks,q=function(){var ae;(ae=R?.onopen)===null||ae===void 0||ae.call(R),D({})},U=this.apiClient,Q={onopen:q,onmessage:ae=>{Lg(U,R.onmessage,ae)},onerror:(t=R?.onerror)!==null&&t!==void 0?t:function(ae){},onclose:(n=R?.onclose)!==null&&n!==void 0?n:function(ae){}},J=this.webSocketFactory.create(_,Gg(y),Q);J.connect(),await P;let ee=Ae(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&ee.startsWith("publishers/")){let ae=this.apiClient.getProject(),Ce=this.apiClient.getLocation();ee=`projects/${ae}/locations/${Ce}/`+ee}let re={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Cr.AUDIO]}:e.config.responseModalities=[Cr.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let de=(m=(c=e.config)===null||c===void 0?void 0:c.tools)!==null&&m!==void 0?m:[],se=[];for(let ae of de)if(this.isCallableTool(ae)){let Ce=ae;se.push(await Ce.tool())}else se.push(ae);se.length>0&&(e.config.tools=se);let be={model:ee,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?re=am(this.apiClient,be):re=sm(this.apiClient,be),delete re.config,J.send(JSON.stringify(re)),new Qr(J,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},Og={turnComplete:!0},Qr=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=ot(t.turns),e.isVertexAI()||(n=n.map(o=>Ji(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(Vg)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Og),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:um(e)}:t={realtimeInput:dm(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function Gg(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function Ug(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var Gl=10;function Ul(i){var e,t,n;if(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(let c of(t=i?.tools)!==null&&t!==void 0?t:[])if(nn(c)){o=!0;break}if(!o)return!0;let r=(n=i?.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function nn(i){return"callTool"in i&&typeof i.callTool=="function"}function qg(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>nn(o)))!==null&&n!==void 0?n:!1}function ql(i){var e;let t=[];return!((e=i?.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,o)=>{if(nn(n))return;let r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(o)}),t}function $l(i){var e;return!(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var Yr=class extends ut{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,o,r,c,m;let h=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!qg(t)||Ul(t.config))return await this.generateContentInternal(h);let g=ql(t);if(g.length>0){let R=g.map(q=>`tools[${q}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${R}.`)}let _,S,y=ot(h.contents),D=(r=(o=(n=h.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&r!==void 0?r:Gl,P=0;for(;P<D&&(_=await this.generateContentInternal(h),!(!_.functionCalls||_.functionCalls.length===0));){let R=_.candidates[0].content,q=[];for(let U of(m=(c=t.config)===null||c===void 0?void 0:c.tools)!==null&&m!==void 0?m:[])if(nn(U)){let J=await U.callTool(_.functionCalls);q.push(...J)}P++,S={role:"user",parts:q},h.contents=ot(h.contents),h.contents.push(R),h.contents.push(S),$l(h.config)&&(y.push(R),y.push(S))}return $l(h.config)&&(_.automaticFunctionCallingHistory=y),_},this.generateContentStream=async t=>{var n,o,r,c,m;if(this.maybeMoveToResponseJsonSchem(t),Ul(t.config)){let S=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(S)}let h=ql(t);if(h.length>0){let S=h.map(y=>`tools[${y}]`).join(", ");throw new Error(`Incompatible tools found at ${S}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let g=(r=(o=(n=t?.config)===null||n===void 0?void 0:n.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,_=(m=(c=t?.config)===null||c===void 0?void 0:c.automaticFunctionCalling)===null||m===void 0?void 0:m.disable;if(g&&!_)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var o;let r,c=[];if(n?.generatedImages)for(let h of n.generatedImages)h&&h?.safetyAttributes&&((o=h?.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?r=h?.safetyAttributes:c.push(h);let m;return r?m={generatedImages:c,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:m={generatedImages:c,sdkHttpResponse:n.sdkHttpResponse},m}),this.list=async t=>{var n;let c={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((n=c.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new yt(Pt.PAGED_ITEM_MODELS,m=>this.listInternal(m),await this.listInternal(c),c)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{var n,o,r,c,m,h;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((o=t.video)===null||o===void 0)&&o.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((c=(r=t.source)===null||r===void 0?void 0:r.video)===null||c===void 0)&&c.uri&&(!((h=(m=t.source)===null||m===void 0?void 0:m.video)===null||h===void 0)&&h.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,o;let r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;let c=await Promise.all(r.map(async h=>nn(h)?await h.tool():h)),m={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:c})};if(m.config.tools=c,e.config&&e.config.tools&&Sc(e.config.tools)){let h=(o=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&o!==void 0?o:{},g=Object.assign({},h);Object.keys(g).length===0&&(g=this.apiClient.getDefaultHeaders()),yc(g),m.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:g})}return m}async initAfcToolsMap(e){var t,n,o;let r=new Map;for(let c of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(nn(c)){let m=c,h=await m.tool();for(let g of(o=h.functionDeclarations)!==null&&o!==void 0?o:[]){if(!g.name)throw new Error("Function declaration name is required.");if(r.has(g.name))throw new Error(`Duplicate tool declaration name: ${g.name}`);r.set(g.name,m)}}return r}async processAfcStream(e){var t,n,o;let r=(o=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&o!==void 0?o:Gl,c=!1,m=0,h=await this.initAfcToolsMap(e);return(function(g,_,S){return ct(this,arguments,function*(){for(var y,D,P,R,q,U;m<r;){c&&(m++,c=!1);let re=yield pe(g.processParamsMaybeAddMcpUsage(S)),de=yield pe(g.generateContentStreamInternal(re)),se=[],be=[];try{for(var Q=!0,J=(D=void 0,dt(de)),ee;ee=yield pe(J.next()),y=ee.done,!y;Q=!0){R=ee.value,Q=!1;let ae=R;if(yield yield pe(ae),ae.candidates&&(!((q=ae.candidates[0])===null||q===void 0)&&q.content)){be.push(ae.candidates[0].content);for(let Ce of(U=ae.candidates[0].content.parts)!==null&&U!==void 0?U:[])if(m<r&&Ce.functionCall){if(!Ce.functionCall.name)throw new Error("Function call name was not returned by the model.");if(_.has(Ce.functionCall.name)){let Fe=yield pe(_.get(Ce.functionCall.name).callTool([Ce.functionCall]));se.push(...Fe)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${_.keys()}, mising tool: ${Ce.functionCall.name}`)}}}}catch(ae){D={error:ae}}finally{try{!Q&&!y&&(P=J.return)&&(yield pe(P.call(J)))}finally{if(D)throw D.error}}if(se.length>0){c=!0;let ae=new $t;ae.candidates=[{content:{role:"user",parts:se}}],yield yield pe(ae);let Ce=[];Ce.push(...be),Ce.push({role:"user",parts:se});let Fe=ot(S.contents).concat(Ce);S.contents=Fe}else break}})})(this,h,e)}async generateContentInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Bl(this.apiClient,e);return m=X("{model}:generateContent",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Ll(_),y=new $t;return Object.assign(y,S),y})}else{let g=Nl(this.apiClient,e);return m=X("{model}:generateContent",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Vl(_),y=new $t;return Object.assign(y,S),y})}}async generateContentStreamInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Bl(this.apiClient,e);return m=X("{model}:streamGenerateContent?alt=sse",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.requestStream({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),c.then(function(S){return ct(this,arguments,function*(){var y,D,P,R;try{for(var q=!0,U=dt(S),Q;Q=yield pe(U.next()),y=Q.done,!y;q=!0){R=Q.value,q=!1;let J=R,ee=Ll(yield pe(J.json()));ee.sdkHttpResponse={headers:J.headers};let re=new $t;Object.assign(re,ee),yield yield pe(re)}}catch(J){D={error:J}}finally{try{!q&&!y&&(P=U.return)&&(yield pe(P.call(U)))}finally{if(D)throw D.error}}})})}else{let g=Nl(this.apiClient,e);return m=X("{model}:streamGenerateContent?alt=sse",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.requestStream({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),c.then(function(S){return ct(this,arguments,function*(){var y,D,P,R;try{for(var q=!0,U=dt(S),Q;Q=yield pe(U.next()),y=Q.done,!y;q=!0){R=Q.value,q=!1;let J=R,ee=Vl(yield pe(J.json()));ee.sdkHttpResponse={headers:J.headers};let re=new $t;Object.assign(re,ee),yield yield pe(re)}}catch(J){D={error:J}}finally{try{!q&&!y&&(P=U.return)&&(yield pe(P.call(U)))}finally{if(D)throw D.error}}})})}}async embedContent(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=qm(this.apiClient,e);return m=X("{model}:predict",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Hm(_),y=new xi;return Object.assign(y,S),y})}else{let g=Um(this.apiClient,e);return m=X("{model}:batchEmbedContents",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=$m(_),y=new xi;return Object.assign(y,S),y})}}async generateImagesInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=tp(this.apiClient,e);return m=X("{model}:predict",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=ip(_),y=new bi;return Object.assign(y,S),y})}else{let g=ep(this.apiClient,e);return m=X("{model}:predict",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=np(_),y=new bi;return Object.assign(y,S),y})}}async editImageInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI()){let m=Vm(this.apiClient,e);return r=X("{model}:predict",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(g=>{let _=g;return _.sdkHttpResponse={headers:h.headers},_})),o.then(h=>{let g=Lm(h),_=new vr;return Object.assign(_,g),_})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI()){let m=tg(this.apiClient,e);return r=X("{model}:predict",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(g=>{let _=g;return _.sdkHttpResponse={headers:h.headers},_})),o.then(h=>{let g=ng(h),_=new xr;return Object.assign(_,g),_})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI()){let m=Bp(this.apiClient,e);return r=X("{model}:predict",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>{let g=Vp(h),_=new br;return Object.assign(_,g),_})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI()){let m=$p(this.apiClient,e);return r=X("{model}:predict",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>{let g=Hp(h),_=new Sr;return Object.assign(_,g),_})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=xp(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>qr(_))}else{let g=vp(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>Ur(_))}}async listInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Tp(this.apiClient,e);return m=X("{models_url}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=kp(_),y=new Si;return Object.assign(y,S),y})}else{let g=Mp(this.apiClient,e);return m=X("{models_url}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Ip(_),y=new Si;return Object.assign(y,S),y})}}async update(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=jp(this.apiClient,e);return m=X("{model}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>qr(_))}else{let g=Zp(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>Ur(_))}}async delete(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Fm(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Nm(_),y=new yi;return Object.assign(y,S),y})}else{let g=Pm(this.apiClient,e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Rm(_),y=new yi;return Object.assign(y,S),y})}}async countTokens(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Tm(this.apiClient,e);return m=X("{model}:countTokens",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=km(_),y=new wi;return Object.assign(y,S),y})}else{let g=Mm(this.apiClient,e);return m=X("{model}:countTokens",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Im(_),y=new wi;return Object.assign(y,S),y})}}async computeTokens(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI()){let m=bm(this.apiClient,e);return r=X("{model}:computeTokens",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(g=>{let _=g;return _.sdkHttpResponse={headers:h.headers},_})),o.then(h=>{let g=Sm(h),_=new yr;return Object.assign(_,g),_})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=cp(this.apiClient,e);return m=X("{model}:predictLongRunning",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c.then(_=>{let S=ap(_),y=new Ei;return Object.assign(y,S),y})}else{let g=lp(this.apiClient,e);return m=X("{model}:predictLongRunning",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c.then(_=>{let S=sp(_),y=new Ei;return Object.assign(y,S),y})}}};var Xr=class extends ut{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let c=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let c=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=ou(e);return m=X("{operationName}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json()),c}else{let g=iu(e);return m=X("{operationName}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json()),c}}async fetchPredictVideosOperationInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI()){let m=Yd(e);return r=X("{resourceName}:fetchPredictOperation",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}};function $g(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Hg(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>jg(r))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function Kg(i,e,t){let n={},o=u(e,["expireTime"]);t!==void 0&&o!=null&&p(t,["expireTime"],o);let r=u(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&p(t,["newSessionExpireTime"],r);let c=u(e,["uses"]);t!==void 0&&c!=null&&p(t,["uses"],c);let m=u(e,["liveConnectConstraints"]);t!==void 0&&m!=null&&p(t,["bidiGenerateContentSetup"],Zg(i,m));let h=u(e,["lockAdditionalFields"]);return t!==void 0&&h!=null&&p(t,["fieldMask"],h),n}function zg(i,e){let t={},n=u(e,["config"]);return n!=null&&p(t,["config"],Kg(i,n,t)),t}function Wg(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Jg(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Qg(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function Yg(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function Xg(i,e){let t={},n=u(i,["generationConfig"]);e!==void 0&&n!=null&&p(e,["setup","generationConfig"],n);let o=u(i,["responseModalities"]);e!==void 0&&o!=null&&p(e,["setup","generationConfig","responseModalities"],o);let r=u(i,["temperature"]);e!==void 0&&r!=null&&p(e,["setup","generationConfig","temperature"],r);let c=u(i,["topP"]);e!==void 0&&c!=null&&p(e,["setup","generationConfig","topP"],c);let m=u(i,["topK"]);e!==void 0&&m!=null&&p(e,["setup","generationConfig","topK"],m);let h=u(i,["maxOutputTokens"]);e!==void 0&&h!=null&&p(e,["setup","generationConfig","maxOutputTokens"],h);let g=u(i,["mediaResolution"]);e!==void 0&&g!=null&&p(e,["setup","generationConfig","mediaResolution"],g);let _=u(i,["seed"]);e!==void 0&&_!=null&&p(e,["setup","generationConfig","seed"],_);let S=u(i,["speechConfig"]);e!==void 0&&S!=null&&p(e,["setup","generationConfig","speechConfig"],vs(S));let y=u(i,["thinkingConfig"]);e!==void 0&&y!=null&&p(e,["setup","generationConfig","thinkingConfig"],y);let D=u(i,["enableAffectiveDialog"]);e!==void 0&&D!=null&&p(e,["setup","generationConfig","enableAffectiveDialog"],D);let P=u(i,["systemInstruction"]);e!==void 0&&P!=null&&p(e,["setup","systemInstruction"],Hg(qe(P)));let R=u(i,["tools"]);if(e!==void 0&&R!=null){let de=an(R);Array.isArray(de)&&(de=de.map(se=>th(sn(se)))),p(e,["setup","tools"],de)}let q=u(i,["sessionResumption"]);e!==void 0&&q!=null&&p(e,["setup","sessionResumption"],eh(q));let U=u(i,["inputAudioTranscription"]);e!==void 0&&U!=null&&p(e,["setup","inputAudioTranscription"],U);let Q=u(i,["outputAudioTranscription"]);e!==void 0&&Q!=null&&p(e,["setup","outputAudioTranscription"],Q);let J=u(i,["realtimeInputConfig"]);e!==void 0&&J!=null&&p(e,["setup","realtimeInputConfig"],J);let ee=u(i,["contextWindowCompression"]);e!==void 0&&ee!=null&&p(e,["setup","contextWindowCompression"],ee);let re=u(i,["proactivity"]);if(e!==void 0&&re!=null&&p(e,["setup","proactivity"],re),u(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function Zg(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["setup","model"],Ae(i,n));let o=u(e,["config"]);return o!=null&&p(t,["config"],Xg(o,t)),t}function jg(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let r=u(i,["fileData"]);r!=null&&p(e,["fileData"],Wg(r));let c=u(i,["functionCall"]);c!=null&&p(e,["functionCall"],Jg(c));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let h=u(i,["inlineData"]);h!=null&&p(e,["inlineData"],$g(h));let g=u(i,["text"]);g!=null&&p(e,["text"],g);let _=u(i,["thought"]);_!=null&&p(e,["thought"],_);let S=u(i,["thoughtSignature"]);S!=null&&p(e,["thoughtSignature"],S);let y=u(i,["videoMetadata"]);return y!=null&&p(e,["videoMetadata"],y),e}function eh(i){let e={},t=u(i,["handle"]);if(t!=null&&p(e,["handle"],t),u(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function th(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let _=t;Array.isArray(_)&&(_=_.map(S=>S)),p(e,["functionDeclarations"],_)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let r=u(i,["fileSearch"]);r!=null&&p(e,["fileSearch"],r);let c=u(i,["codeExecution"]);if(c!=null&&p(e,["codeExecution"],c),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],Qg(m));let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],Yg(h));let g=u(i,["urlContext"]);return g!=null&&p(e,["urlContext"],g),e}function nh(i){let e=[];for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let o=Object.keys(n).map(r=>`${t}.${r}`);e.push(...o)}else e.push(t)}return e.join(",")}function ih(i,e){let t=null,n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let r=n.setup;typeof r=="object"&&r!==null?(i.bidiGenerateContentSetup=r,t=r):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;let o=i.fieldMask;if(t){let r=nh(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)r?i.fieldMask=r:delete i.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){let c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],m=[];o.length>0&&(m=o.map(g=>c.includes(g)?`generationConfig.${g}`:g));let h=[];r&&h.push(r),m.length>0&&h.push(...m),h.length>0?i.fieldMask=h.join(","):delete i.fieldMask}else delete i.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?i.fieldMask=o.join(","):delete i.fieldMask;return i}var Zr=class extends ut{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let m=zg(this.apiClient,e);r=X("auth_tokens",m._url),c=m._query,delete m.config,delete m._url,delete m._query;let h=ih(m,e.config);return o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(g=>g.json()),o.then(g=>g)}}};function oh(i,e){let t={},n=u(i,["force"]);return e!==void 0&&n!=null&&p(e,["_query","force"],n),t}function rh(i){let e={},t=u(i,["name"]);t!=null&&p(e,["_url","name"],t);let n=u(i,["config"]);return n!=null&&oh(n,e),e}function sh(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","name"],t),e}function ah(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function lh(i){let e={},t=u(i,["parent"]);t!=null&&p(e,["_url","parent"],t);let n=u(i,["config"]);return n!=null&&ah(n,e),e}function ch(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["documents"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>c)),p(e,["documents"],r)}return e}var jr=class extends ut{constructor(e){super(),this.apiClient=e,this.list=async t=>new yt(Pt.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=sh(e);return r=X("{name}",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async delete(e){var t,n;let o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let c=rh(e);o=X("{name}",c._url),r=c._query,delete c._url,delete c._query,await this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=lh(e);return r=X("{parent}/documents",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>{let g=ch(h),_=new wr;return Object.assign(_,g),_})}}};var es=class extends ut{constructor(e,t=new jr(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new yt(Pt.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=cg(e);return r=X("fileSearchStores",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async get(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=mg(e);return r=X("{name}",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async delete(e){var t,n;let o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let c=ug(e);o=X("{name}",c._url),r=c._query,delete c._url,delete c._query,await this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Cg(e);return r=X("fileSearchStores",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>{let g=vg(h),_=new Er;return Object.assign(_,g),_})}}async uploadToFileSearchStoreInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=xg(e);return r=X("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>{let g=bg(h),_=new Ar;return Object.assign(_,g),_})}}async importFile(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=hg(e);return r=X("{file_search_store_name}:importFile",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>{let g=gg(h),_=new Dr;return Object.assign(_,g),_})}}};var wc=function(){let{crypto:i}=globalThis;if(i?.randomUUID)return wc=i.randomUUID.bind(i),i.randomUUID();let e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},dh=()=>wc();function ts(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}var ns=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){let e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};var Je=class extends Error{},Qe=class i extends Je{constructor(e,t,n,o){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=o,this.error=t}static makeMessage(e,t,n){let o=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,t,n,o){if(!e||!o)return new on({message:n,cause:ns(t)});let r=t;return e===400?new Ni(e,r,n,o):e===401?new Bi(e,r,n,o):e===403?new Vi(e,r,n,o):e===404?new Li(e,r,n,o):e===409?new Oi(e,r,n,o):e===422?new Gi(e,r,n,o):e===429?new Ui(e,r,n,o):e>=500?new qi(e,r,n,o):new i(e,r,n,o)}},In=class extends Qe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},on=class extends Qe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Ri=class extends on{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ni=class extends Qe{},Bi=class extends Qe{},Vi=class extends Qe{},Li=class extends Qe{},Oi=class extends Qe{},Gi=class extends Qe{},Ui=class extends Qe{},qi=class extends Qe{};var uh=/^[a-z][a-z0-9+.-]*:/i,mh=i=>uh.test(i),is=i=>(is=Array.isArray,is(i)),ph=is,gh=ph,Hl=gh;function hh(i){if(!i)return!0;for(let e in i)return!1;return!0}function fh(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var _h=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Je(`${i} must be an integer`);if(e<0)throw new Je(`${i} must be a positive integer`);return e},Ch=i=>{try{return JSON.parse(i)}catch{return}};var vh=i=>new Promise(e=>setTimeout(e,i));var en="0.0.1";function xh(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var bh=()=>{var i,e,t,n,o;let r=xh();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":en,"X-Stainless-OS":zl(Deno.build.os),"X-Stainless-Arch":Kl(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":en,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":en,"X-Stainless-OS":zl((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":Kl((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};let c=Sh();return c?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":en,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${c.browser}`,"X-Stainless-Runtime-Version":c.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":en,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Sh(){if(typeof navigator>"u"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let n=t.exec(navigator.userAgent);if(n){let o=n[1]||0,r=n[2]||0,c=n[3]||0;return{browser:e,version:`${o}.${r}.${c}`}}}return null}var Kl=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",zl=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),pi,yh=()=>pi??(pi=bh());function wh(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Ec(...i){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function Eh(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return Ec({start(){},async pull(t){let{done:n,value:o}=await e.next();n?t.close():t.enqueue(o)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function Ac(i){if(i[Symbol.asyncIterator])return i;let e=i.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Ah(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=i.getReader(),o=n.cancel();n.releaseLock(),await o}var Dh=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Dc=()=>{var i;if(typeof File>"u"){let{process:e}=globalThis,t=typeof((i=e?.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function hr(i,e,t){return Dc(),new File(i,e??"unknown_file",t)}function Mh(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}var Th=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var Mc=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",Ih=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&Mc(i),kh=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function Ph(i,e,t){if(Dc(),i=await i,Ih(i))return i instanceof File?i:hr([await i.arrayBuffer()],i.name);if(kh(i)){let o=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),hr(await os(o),e,t)}let n=await os(i);if(e||(e=Mh(i)),!t?.type){let o=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof o=="string"&&(t=Object.assign(Object.assign({},t),{type:o}))}return hr(n,e,t)}async function os(i){var e,t,n,o,r;let c=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)c.push(i);else if(Mc(i))c.push(i instanceof Blob?i:await i.arrayBuffer());else if(Th(i))try{for(var m=!0,h=dt(i),g;g=await h.next(),e=g.done,!e;m=!0){o=g.value,m=!1;let _=o;c.push(...await os(_))}}catch(_){t={error:_}}finally{try{!m&&!e&&(n=h.return)&&await n.call(h)}finally{if(t)throw t.error}}else{let _=(r=i?.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof i}${_?`; constructor: ${_}`:""}${Fh(i)}`)}return c}function Fh(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}var Rh=(()=>{class i{constructor(t){this._client=t}}i._key=[];return i})();function Tc(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Wl=Object.freeze(Object.create(null)),Nh=(i=Tc)=>function(t,...n){if(t.length===1)return t[0];let o=!1,r=[],c=t.reduce((_,S,y)=>{var D,P,R;/[?#]/.test(S)&&(o=!0);let q=n[y],U=(o?encodeURIComponent:i)(""+q);return y!==n.length&&(q==null||typeof q=="object"&&q.toString===((R=Object.getPrototypeOf((P=Object.getPrototypeOf((D=q.hasOwnProperty)!==null&&D!==void 0?D:Wl))!==null&&P!==void 0?P:Wl))===null||R===void 0?void 0:R.toString))&&(U=q+"",r.push({start:_.length+S.length,length:U.length,error:`Value of type ${Object.prototype.toString.call(q).slice(8,-1)} is not a valid path parameter`})),_+S+(y===n.length?"":U)},""),m=c.split(/[?#]/,1)[0],h=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,g;for(;(g=h.exec(m))!==null;)r.push({start:g.index,length:g[0].length,error:`Value "${g[0]}" can't be safely passed as a path parameter`});if(r.sort((_,S)=>_.start-S.start),r.length>0){let _=0,S=r.reduce((y,D)=>{let P=" ".repeat(D.start-_),R="^".repeat(D.length);return _=D.start+D.length,y+P+R},"");throw new Je(`Path parameters result in path with invalid segments:
${r.map(y=>y.error).join(`
`)}
${c}
${S}`)}return c},gi=Nh(Tc);var $i=class extends Rh{create(e,t){var n;let{api_version:o=this._client.apiVersion}=e,r=Pi(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new Je("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new Je("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(gi`/${o}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:o=this._client.apiVersion}=t??{};return this._client.delete(gi`/${o}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:o=this._client.apiVersion}=t??{};return this._client.post(gi`/${o}/interactions/${e}/cancel`,n)}get(e,t={},n){var o;let r=t??{},{api_version:c=this._client.apiVersion}=r,m=Pi(r,["api_version"]);return this._client.get(gi`/${c}/interactions/${e}`,Object.assign(Object.assign({query:m},n),{stream:(o=t?.stream)!==null&&o!==void 0?o:!1}))}};$i._key=Object.freeze(["interactions"]);var Hi=class extends $i{};function Bh(i){let e=0;for(let o of i)e+=o.length;let t=new Uint8Array(e),n=0;for(let o of i)t.set(o,n),n+=o.length;return t}var hi;function xs(i){let e;return(hi??(e=new globalThis.TextEncoder,hi=e.encode.bind(e)))(i)}var fi;function Jl(i){let e;return(fi??(e=new globalThis.TextDecoder,fi=e.decode.bind(e)))(i)}var rn=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?xs(e):e;this.buffer=Bh([this.buffer,t]);let n=[],o;for(;(o=Vh(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){n.push(Jl(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let r=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,c=Jl(this.buffer.subarray(0,r));n.push(c),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};rn.NEWLINE_CHARS=new Set([`
`,"\r"]);rn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Vh(i,e){for(let o=e??0;o<i.length;o++){if(i[o]===10)return{preceding:o,index:o+1,carriage:!1};if(i[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function Lh(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}var Ki={off:0,error:200,warn:300,info:400,debug:500},Ql=(i,e,t)=>{if(i){if(fh(Ki,i))return i;$e(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(Ki))}`)}};function Mn(){}function _i(i,e,t){return!e||Ki[i]>Ki[t]?Mn:e[i].bind(e)}var Oh={error:Mn,warn:Mn,info:Mn,debug:Mn},Yl=new WeakMap;function $e(i){var e;let t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return Oh;let o=Yl.get(t);if(o&&o[0]===n)return o[1];let r={error:_i("error",t,n),warn:_i("warn",t,n),info:_i("info",t,n),debug:_i("debug",t,n)};return Yl.set(t,[n,r]),r}var qt=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);var rs=class i{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let o=!1,r=n?$e(n):console;function c(){return ct(this,arguments,function*(){var h,g,_,S;if(o)throw new Je("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let y=!1;try{try{for(var D=!0,P=dt(Gh(e,t)),R;R=yield pe(P.next()),h=R.done,!h;D=!0){S=R.value,D=!1;let q=S;if(!y)if(q.data.startsWith("[DONE]")){y=!0;continue}else try{yield yield pe(JSON.parse(q.data))}catch(U){throw r.error("Could not parse message into JSON:",q.data),r.error("From chunk:",q.raw),U}}}catch(q){g={error:q}}finally{try{!D&&!h&&(_=P.return)&&(yield pe(_.call(P)))}finally{if(g)throw g.error}}y=!0}catch(q){if(ts(q))return yield pe(void 0);throw q}finally{y||t.abort()}})}return new i(c,t,n)}static fromReadableStream(e,t,n){let o=!1;function r(){return ct(this,arguments,function*(){var h,g,_,S;let y=new rn,D=Ac(e);try{for(var P=!0,R=dt(D),q;q=yield pe(R.next()),h=q.done,!h;P=!0){S=q.value,P=!1;let U=S;for(let Q of y.decode(U))yield yield pe(Q)}}catch(U){g={error:U}}finally{try{!P&&!h&&(_=R.return)&&(yield pe(_.call(R)))}finally{if(g)throw g.error}}for(let U of y.flush())yield yield pe(U)})}function c(){return ct(this,arguments,function*(){var h,g,_,S;if(o)throw new Je("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let y=!1;try{try{for(var D=!0,P=dt(r()),R;R=yield pe(P.next()),h=R.done,!h;D=!0){S=R.value,D=!1;let q=S;y||q&&(yield yield pe(JSON.parse(q)))}}catch(q){g={error:q}}finally{try{!D&&!h&&(_=P.return)&&(yield pe(_.call(P)))}finally{if(g)throw g.error}}y=!0}catch(q){if(ts(q))return yield pe(void 0);throw q}finally{y||t.abort()}})}return new i(c,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),o=r=>({next:()=>{if(r.length===0){let c=n.next();e.push(c),t.push(c)}return r.shift()}});return[new i(()=>o(e),this.controller,this.client),new i(()=>o(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return Ec({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:o,done:r}=await t.next();if(r)return n.close();let c=xs(JSON.stringify(o)+`
`);n.enqueue(c)}catch(o){n.error(o)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function Gh(i,e){return ct(this,arguments,function*(){var n,o,r,c;if(!i.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Je("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Je("Attempted to iterate over a response with no body");let m=new ss,h=new rn,g=Ac(i.body);try{for(var _=!0,S=dt(Uh(g)),y;y=yield pe(S.next()),n=y.done,!n;_=!0){c=y.value,_=!1;let D=c;for(let P of h.decode(D)){let R=m.decode(P);R&&(yield yield pe(R))}}}catch(D){o={error:D}}finally{try{!_&&!n&&(r=S.return)&&(yield pe(r.call(S)))}finally{if(o)throw o.error}}for(let D of h.flush()){let P=m.decode(D);P&&(yield yield pe(P))}})}function Uh(i){return ct(this,arguments,function*(){var t,n,o,r;let c=new Uint8Array;try{for(var m=!0,h=dt(i),g;g=yield pe(h.next()),t=g.done,!t;m=!0){r=g.value,m=!1;let _=r;if(_==null)continue;let S=_ instanceof ArrayBuffer?new Uint8Array(_):typeof _=="string"?xs(_):_,y=new Uint8Array(c.length+S.length);y.set(c),y.set(S,c.length),c=y;let D;for(;(D=Lh(c))!==-1;)yield yield pe(c.slice(0,D)),c=c.slice(D)}}catch(_){n={error:_}}finally{try{!m&&!t&&(o=h.return)&&(yield pe(o.call(h)))}finally{if(n)throw n.error}}c.length>0&&(yield yield pe(c))})}var ss=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,o]=qh(e,":");return o.startsWith(" ")&&(o=o.substring(1)),t==="event"?this.event=o:t==="data"&&this.data.push(o),null}};function qh(i,e){let t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}async function $h(i,e){let{response:t,requestLogID:n,retryOfRequestLogID:o,startTime:r}=e,c=await(async()=>{var m;if(e.options.stream)return $e(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):rs.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let h=t.headers.get("content-type"),g=(m=h?.split(";")[0])===null||m===void 0?void 0:m.trim();return g?.includes("application/json")||g?.endsWith("+json")?await t.json():await t.text()})();return $e(i).debug(`[${n}] response parsed`,qt({retryOfRequestLogID:o,url:t.url,status:t.status,body:c,durationMs:Date.now()-r})),c}var as=class i extends Promise{constructor(e,t,n=$h){super(o=>{o(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var Ic=Symbol("brand.privateNullableHeaders");function*Hh(i){if(!i)return;if(Ic in i){let{values:n,nulls:o}=i;yield*n.entries();for(let r of o)yield[r,null];return}let e=!1,t;i instanceof Headers?t=i.entries():Hl(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let n of t){let o=n[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let r=Hl(n[1])?n[1]:[n[1]],c=!1;for(let m of r)m!==void 0&&(e&&!c&&(c=!0,yield[o,null]),yield[o,m])}}var An=i=>{let e=new Headers,t=new Set;for(let n of i){let o=new Set;for(let[r,c]of Hh(n)){let m=r.toLowerCase();o.has(m)||(e.delete(r),o.add(m)),c===null?(e.delete(r),t.add(m)):(e.append(r,c),t.delete(m))}}return{[Ic]:!0,values:e,nulls:t}};var fr=i=>{var e,t,n,o,r,c;if(typeof globalThis.process<"u")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(c=(r=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||r===void 0?void 0:r.call(o,i))===null||c===void 0?void 0:c.trim()};var kc,Kh=(()=>{class i{constructor(t){var n,o,r,c,m,h,g,{baseURL:_=fr("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:S=(n=fr("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:y="v1beta"}=t,D=Pi(t,["baseURL","apiKey","apiVersion"]);let P=Object.assign(Object.assign({apiKey:S,apiVersion:y},D),{baseURL:_||"https://generativelanguage.googleapis.com"});this.baseURL=P.baseURL,this.timeout=(o=P.timeout)!==null&&o!==void 0?o:i.DEFAULT_TIMEOUT,this.logger=(r=P.logger)!==null&&r!==void 0?r:console;let R="warn";this.logLevel=R,this.logLevel=(m=(c=Ql(P.logLevel,"ClientOptions.logLevel",this))!==null&&c!==void 0?c:Ql(fr("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&m!==void 0?m:R,this.fetchOptions=P.fetchOptions,this.maxRetries=(h=P.maxRetries)!==null&&h!==void 0?h:2,this.fetch=(g=P.fetch)!==null&&g!==void 0?g:wh(),this.encoder=Dh,this._options=P,this.apiKey=S,this.apiVersion=y,this.clientAdapter=P.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){let n=An([t.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return An([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return An([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([n,o])=>typeof o<"u").map(([n,o])=>{if(typeof o=="string"||typeof o=="number"||typeof o=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(o)}`;if(o===null)return`${encodeURIComponent(n)}=`;throw new Je(`Cannot stringify type ${typeof o}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${en}`}defaultIdempotencyKey(){return`stainless-node-retry-${dh()}`}makeStatusError(t,n,o,r){return Qe.generate(t,n,o,r)}buildURL(t,n,o){let r=!this.baseURLOverridden()&&o||this.baseURL,c=mh(t)?new URL(t):new URL(r+(r.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),m=this.defaultQuery();return hh(m)||(n=Object.assign(Object.assign({},m),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(c.search=this.stringifyQuery(n)),c.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){let n=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(t,{url:n,options:o}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,o){return this.request(Promise.resolve(o).then(r=>Object.assign({method:t,path:n},r)))}request(t,n=null){return new as(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,o){var r,c,m;let h=await t,g=(r=h.maxRetries)!==null&&r!==void 0?r:this.maxRetries;n==null&&(n=g),await this.prepareOptions(h);let{req:_,url:S,timeout:y}=await this.buildRequest(h,{retryCount:g-n});await this.prepareRequest(_,{url:S,options:h});let D="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),P=o===void 0?"":`, retryOf: ${o}`,R=Date.now();if($e(this).debug(`[${D}] sending request`,qt({retryOfRequestLogID:o,method:h.method,url:S,options:h,headers:_.headers})),!((c=h.signal)===null||c===void 0)&&c.aborted)throw new In;let q=new AbortController,U=await this.fetchWithTimeout(S,_,y,q).catch(ns),Q=Date.now();if(U instanceof globalThis.Error){let ee=`retrying, ${n} attempts remaining`;if(!((m=h.signal)===null||m===void 0)&&m.aborted)throw new In;let re=ts(U)||/timed? ?out/i.test(String(U)+("cause"in U?String(U.cause):""));if(n)return $e(this).info(`[${D}] connection ${re?"timed out":"failed"} - ${ee}`),$e(this).debug(`[${D}] connection ${re?"timed out":"failed"} (${ee})`,qt({retryOfRequestLogID:o,url:S,durationMs:Q-R,message:U.message})),this.retryRequest(h,n,o??D);throw $e(this).info(`[${D}] connection ${re?"timed out":"failed"} - error; no more retries left`),$e(this).debug(`[${D}] connection ${re?"timed out":"failed"} (error; no more retries left)`,qt({retryOfRequestLogID:o,url:S,durationMs:Q-R,message:U.message})),re?new Ri:new on({cause:U})}let J=`[${D}${P}] ${_.method} ${S} ${U.ok?"succeeded":"failed"} with status ${U.status} in ${Q-R}ms`;if(!U.ok){let ee=await this.shouldRetry(U);if(n&&ee){let Ce=`retrying, ${n} attempts remaining`;return await Ah(U.body),$e(this).info(`${J} - ${Ce}`),$e(this).debug(`[${D}] response error (${Ce})`,qt({retryOfRequestLogID:o,url:U.url,status:U.status,headers:U.headers,durationMs:Q-R})),this.retryRequest(h,n,o??D,U.headers)}let re=ee?"error; no more retries left":"error; not retryable";$e(this).info(`${J} - ${re}`);let de=await U.text().catch(Ce=>ns(Ce).message),se=Ch(de),be=se?void 0:de;throw $e(this).debug(`[${D}] response error (${re})`,qt({retryOfRequestLogID:o,url:U.url,status:U.status,headers:U.headers,message:be,durationMs:Date.now()-R})),this.makeStatusError(U.status,se,be,U.headers)}return $e(this).info(J),$e(this).debug(`[${D}] response start`,qt({retryOfRequestLogID:o,url:U.url,status:U.status,headers:U.headers,durationMs:Q-R})),{response:U,options:h,controller:q,requestLogID:D,retryOfRequestLogID:o,startTime:R}}async fetchWithTimeout(t,n,o,r){let c=n||{},{signal:m,method:h}=c,g=Pi(c,["signal","method"]);m&&m.addEventListener("abort",()=>r.abort());let _=setTimeout(()=>r.abort(),o),S=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||typeof g.body=="object"&&g.body!==null&&Symbol.asyncIterator in g.body,y=Object.assign(Object.assign(Object.assign({signal:r.signal},S?{duplex:"half"}:{}),{method:"GET"}),g);h&&(y.method=h.toUpperCase());try{return await this.fetch.call(void 0,t,y)}finally{clearTimeout(_)}}async shouldRetry(t){let n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,o,r){var c;let m,h=r?.get("retry-after-ms");if(h){let _=parseFloat(h);Number.isNaN(_)||(m=_)}let g=r?.get("retry-after");if(g&&!m){let _=parseFloat(g);Number.isNaN(_)?m=Date.parse(g)-Date.now():m=_*1e3}if(!(m&&0<=m&&m<60*1e3)){let _=(c=t.maxRetries)!==null&&c!==void 0?c:this.maxRetries;m=this.calculateDefaultRetryTimeoutMillis(n,_)}return await vh(m),this.makeRequest(t,n-1,o)}calculateDefaultRetryTimeoutMillis(t,n){let c=n-t,m=Math.min(.5*Math.pow(2,c),8),h=1-Math.random()*.25;return m*h*1e3}async buildRequest(t,{retryCount:n=0}={}){var o,r,c;let m=Object.assign({},t),{method:h,path:g,query:_,defaultBaseURL:S}=m,y=this.buildURL(g,_,S);"timeout"in m&&_h("timeout",m.timeout),m.timeout=(o=m.timeout)!==null&&o!==void 0?o:this.timeout;let{bodyHeaders:D,body:P}=this.buildBody({options:m}),R=await this.buildHeaders({options:t,method:h,bodyHeaders:D,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:h,headers:R},m.signal&&{signal:m.signal}),globalThis.ReadableStream&&P instanceof globalThis.ReadableStream&&{duplex:"half"}),P&&{body:P}),(r=this.fetchOptions)!==null&&r!==void 0?r:{}),(c=m.fetchOptions)!==null&&c!==void 0?c:{}),url:y,timeout:m.timeout}}async buildHeaders({options:t,method:n,bodyHeaders:o,retryCount:r}){let c={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),c[this.idempotencyHeader]=t.idempotencyKey);let m=await this.authHeaders(t),h=An([c,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),yh()),this._options.defaultHeaders,o,t.headers,m]);return this.validateHeaders(h),h.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};let o=An([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&o.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:Eh(t)}:this.encoder({body:t,headers:o})}}return i.DEFAULT_TIMEOUT=6e4,i})(),Ne=class extends Kh{constructor(){super(...arguments),this.interactions=new Hi(this)}};kc=Ne;Ne.GeminiNextGenAPIClient=kc;Ne.GeminiNextGenAPIClientError=Je;Ne.APIError=Qe;Ne.APIConnectionError=on;Ne.APIConnectionTimeoutError=Ri;Ne.APIUserAbortError=In;Ne.NotFoundError=Li;Ne.ConflictError=Oi;Ne.RateLimitError=Ui;Ne.BadRequestError=Ni;Ne.AuthenticationError=Bi;Ne.InternalServerError=qi;Ne.PermissionDeniedError=Vi;Ne.UnprocessableEntityError=Gi;Ne.toFile=Ph;Ne.Interactions=Hi;function zh(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function Wh(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function Jh(i,e){let t={},n=u(i,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function Qh(i,e){let t={},n=u(i,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function Yh(i,e,t){let n={};if(u(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let o=u(i,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&p(e,["displayName"],o),u(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let r=u(i,["epochCount"]);e!==void 0&&r!=null&&p(e,["tuningTask","hyperparameters","epochCount"],r);let c=u(i,["learningRateMultiplier"]);if(c!=null&&p(n,["tuningTask","hyperparameters","learningRateMultiplier"],c),u(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(u(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(u(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let m=u(i,["batchSize"]);e!==void 0&&m!=null&&p(e,["tuningTask","hyperparameters","batchSize"],m);let h=u(i,["learningRate"]);if(e!==void 0&&h!=null&&p(e,["tuningTask","hyperparameters","learningRate"],h),u(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(u(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function Xh(i,e,t){let n={},o=u(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let D=u(i,["validationDataset"]);e!==void 0&&D!=null&&p(e,["supervisedTuningSpec"],Xl(D))}else if(o==="PREFERENCE_TUNING"){let D=u(i,["validationDataset"]);e!==void 0&&D!=null&&p(e,["preferenceOptimizationSpec"],Xl(D))}let r=u(i,["tunedModelDisplayName"]);e!==void 0&&r!=null&&p(e,["tunedModelDisplayName"],r);let c=u(i,["description"]);e!==void 0&&c!=null&&p(e,["description"],c);let m=u(t,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){let D=u(i,["epochCount"]);e!==void 0&&D!=null&&p(e,["supervisedTuningSpec","hyperParameters","epochCount"],D)}else if(m==="PREFERENCE_TUNING"){let D=u(i,["epochCount"]);e!==void 0&&D!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],D)}let h=u(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){let D=u(i,["learningRateMultiplier"]);e!==void 0&&D!=null&&p(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],D)}else if(h==="PREFERENCE_TUNING"){let D=u(i,["learningRateMultiplier"]);e!==void 0&&D!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],D)}let g=u(t,["config","method"]);if(g===void 0&&(g="SUPERVISED_FINE_TUNING"),g==="SUPERVISED_FINE_TUNING"){let D=u(i,["exportLastCheckpointOnly"]);e!==void 0&&D!=null&&p(e,["supervisedTuningSpec","exportLastCheckpointOnly"],D)}else if(g==="PREFERENCE_TUNING"){let D=u(i,["exportLastCheckpointOnly"]);e!==void 0&&D!=null&&p(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],D)}let _=u(t,["config","method"]);if(_===void 0&&(_="SUPERVISED_FINE_TUNING"),_==="SUPERVISED_FINE_TUNING"){let D=u(i,["adapterSize"]);e!==void 0&&D!=null&&p(e,["supervisedTuningSpec","hyperParameters","adapterSize"],D)}else if(_==="PREFERENCE_TUNING"){let D=u(i,["adapterSize"]);e!==void 0&&D!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],D)}if(u(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(u(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let S=u(i,["labels"]);e!==void 0&&S!=null&&p(e,["labels"],S);let y=u(i,["beta"]);return e!==void 0&&y!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","beta"],y),n}function Zh(i,e){let t={},n=u(i,["baseModel"]);n!=null&&p(t,["baseModel"],n);let o=u(i,["preTunedModel"]);o!=null&&p(t,["preTunedModel"],o);let r=u(i,["trainingDataset"]);r!=null&&df(r);let c=u(i,["config"]);return c!=null&&Yh(c,t),t}function jh(i,e){let t={},n=u(i,["baseModel"]);n!=null&&p(t,["baseModel"],n);let o=u(i,["preTunedModel"]);o!=null&&p(t,["preTunedModel"],o);let r=u(i,["trainingDataset"]);r!=null&&uf(r,t,e);let c=u(i,["config"]);return c!=null&&Xh(c,t,e),t}function ef(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function tf(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function nf(i,e,t){let n={},o=u(i,["pageSize"]);e!==void 0&&o!=null&&p(e,["_query","pageSize"],o);let r=u(i,["pageToken"]);e!==void 0&&r!=null&&p(e,["_query","pageToken"],r);let c=u(i,["filter"]);return e!==void 0&&c!=null&&p(e,["_query","filter"],c),n}function of(i,e,t){let n={},o=u(i,["pageSize"]);e!==void 0&&o!=null&&p(e,["_query","pageSize"],o);let r=u(i,["pageToken"]);e!==void 0&&r!=null&&p(e,["_query","pageToken"],r);let c=u(i,["filter"]);return e!==void 0&&c!=null&&p(e,["_query","filter"],c),n}function rf(i,e){let t={},n=u(i,["config"]);return n!=null&&nf(n,t),t}function sf(i,e){let t={},n=u(i,["config"]);return n!=null&&of(n,t),t}function af(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["nextPageToken"]);o!=null&&p(t,["nextPageToken"],o);let r=u(i,["tunedModels"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(m=>Pc(m))),p(t,["tuningJobs"],c)}return t}function lf(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["nextPageToken"]);o!=null&&p(t,["nextPageToken"],o);let r=u(i,["tuningJobs"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(m=>ls(m))),p(t,["tuningJobs"],c)}return t}function cf(i,e){let t={},n=u(i,["name"]);n!=null&&p(t,["model"],n);let o=u(i,["name"]);return o!=null&&p(t,["endpoint"],o),t}function df(i,e){let t={};if(u(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=u(i,["examples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),p(t,["examples","examples"],o)}return t}function uf(i,e,t){let n={},o=u(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let c=u(i,["gcsUri"]);e!==void 0&&c!=null&&p(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(o==="PREFERENCE_TUNING"){let c=u(i,["gcsUri"]);e!==void 0&&c!=null&&p(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}let r=u(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let c=u(i,["vertexDatasetResource"]);e!==void 0&&c!=null&&p(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(r==="PREFERENCE_TUNING"){let c=u(i,["vertexDatasetResource"]);e!==void 0&&c!=null&&p(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}if(u(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function Pc(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["name"]);o!=null&&p(t,["name"],o);let r=u(i,["state"]);r!=null&&p(t,["state"],sc(r));let c=u(i,["createTime"]);c!=null&&p(t,["createTime"],c);let m=u(i,["tuningTask","startTime"]);m!=null&&p(t,["startTime"],m);let h=u(i,["tuningTask","completeTime"]);h!=null&&p(t,["endTime"],h);let g=u(i,["updateTime"]);g!=null&&p(t,["updateTime"],g);let _=u(i,["description"]);_!=null&&p(t,["description"],_);let S=u(i,["baseModel"]);S!=null&&p(t,["baseModel"],S);let y=u(i,["_self"]);return y!=null&&p(t,["tunedModel"],cf(y)),t}function ls(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["name"]);o!=null&&p(t,["name"],o);let r=u(i,["state"]);r!=null&&p(t,["state"],sc(r));let c=u(i,["createTime"]);c!=null&&p(t,["createTime"],c);let m=u(i,["startTime"]);m!=null&&p(t,["startTime"],m);let h=u(i,["endTime"]);h!=null&&p(t,["endTime"],h);let g=u(i,["updateTime"]);g!=null&&p(t,["updateTime"],g);let _=u(i,["error"]);_!=null&&p(t,["error"],_);let S=u(i,["description"]);S!=null&&p(t,["description"],S);let y=u(i,["baseModel"]);y!=null&&p(t,["baseModel"],y);let D=u(i,["tunedModel"]);D!=null&&p(t,["tunedModel"],D);let P=u(i,["preTunedModel"]);P!=null&&p(t,["preTunedModel"],P);let R=u(i,["supervisedTuningSpec"]);R!=null&&p(t,["supervisedTuningSpec"],R);let q=u(i,["preferenceOptimizationSpec"]);q!=null&&p(t,["preferenceOptimizationSpec"],q);let U=u(i,["tuningDataStats"]);U!=null&&p(t,["tuningDataStats"],U);let Q=u(i,["encryptionSpec"]);Q!=null&&p(t,["encryptionSpec"],Q);let J=u(i,["partnerModelTuningSpec"]);J!=null&&p(t,["partnerModelTuningSpec"],J);let ee=u(i,["customBaseModel"]);ee!=null&&p(t,["customBaseModel"],ee);let re=u(i,["experiment"]);re!=null&&p(t,["experiment"],re);let de=u(i,["labels"]);de!=null&&p(t,["labels"],de);let se=u(i,["outputUri"]);se!=null&&p(t,["outputUri"],se);let be=u(i,["pipelineJob"]);be!=null&&p(t,["pipelineJob"],be);let ae=u(i,["serviceAccount"]);ae!=null&&p(t,["serviceAccount"],ae);let Ce=u(i,["tunedModelDisplayName"]);Ce!=null&&p(t,["tunedModelDisplayName"],Ce);let Fe=u(i,["veoTuningSpec"]);return Fe!=null&&p(t,["veoTuningSpec"],Fe),t}function mf(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["name"]);o!=null&&p(t,["name"],o);let r=u(i,["metadata"]);r!=null&&p(t,["metadata"],r);let c=u(i,["done"]);c!=null&&p(t,["done"],c);let m=u(i,["error"]);return m!=null&&p(t,["error"],m),t}function Xl(i,e){let t={},n=u(i,["gcsUri"]);n!=null&&p(t,["validationDatasetUri"],n);let o=u(i,["vertexDatasetResource"]);return o!=null&&p(t,["validationDatasetUri"],o),t}var cs=class extends ut{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new yt(Pt.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let o={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(o.checkpointId=t.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},t),{preTunedModel:o});return r.baseModel=void 0,await this.tuneInternal(r)}else{let o=Object.assign({},t);return await this.tuneInternal(o)}else{let o=Object.assign({},t),r=await this.tuneMldevInternal(o),c="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?c=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(c=r.name.split("/operations/")[0]),{name:c,state:ec.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=tf(e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>ls(_))}else{let g=ef(e);return m=X("{name}",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>Pc(_))}}async listInternal(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=sf(e);return m=X("tuningJobs",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=lf(_),y=new Ai;return Object.assign(y,S),y})}else{let g=rf(e);return m=X("tunedModels",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=af(_),y=new Ai;return Object.assign(y,S),y})}}async cancel(e){var t,n,o,r;let c,m="",h={};if(this.apiClient.isVertexAI()){let g=Wh(e);return m=X("{name}:cancel",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Qh(_),y=new Di;return Object.assign(y,S),y})}else{let g=zh(e);return m=X("{name}:cancel",g._url),h=g._query,delete g._url,delete g._query,c=this.apiClient.request({path:m,queryParams:h,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(_=>_.json().then(S=>{let y=S;return y.sdkHttpResponse={headers:_.headers},y})),c.then(_=>{let S=Jh(_),y=new Di;return Object.assign(y,S),y})}}async tuneInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI()){let m=jh(e,e);return r=X("tuningJobs",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(g=>{let _=g;return _.sdkHttpResponse={headers:h.headers},_})),o.then(h=>ls(h))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let o,r="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Zh(e);return r=X("tunedModels",m._url),c=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(g=>{let _=g;return _.sdkHttpResponse={headers:h.headers},_})),o.then(h=>mf(h))}}};var ds=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},pf=1024*1024*8,gf=3,hf=1e3,ff=2,zi="x-goog-upload-status";async function _f(i,e,t){var n;let o=await Fc(i,e,t),r=await o?.json();if(((n=o?.headers)===null||n===void 0?void 0:n[zi])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function Cf(i,e,t){var n;let o=await Fc(i,e,t),r=await o?.json();if(((n=o?.headers)===null||n===void 0?void 0:n[zi])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let c=jl(r),m=new Fr;return Object.assign(m,c),m}async function Fc(i,e,t){var n,o;let r=0,c=0,m=new Tn(new Response),h="upload";for(r=i.size;c<r;){let g=Math.min(pf,r-c),_=i.slice(c,c+g);c+g>=r&&(h+=", finalize");let S=0,y=hf;for(;S<gf&&(m=await t.request({path:"",body:_,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":h,"X-Goog-Upload-Offset":String(c),"Content-Length":String(g)}}}),!(!((n=m?.headers)===null||n===void 0)&&n[zi]));)S++,await xf(y),y=y*ff;if(c+=g,((o=m?.headers)===null||o===void 0?void 0:o[zi])!=="active")break;if(r<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return m}async function vf(i){return{size:i.size,type:i.type}}function xf(i){return new Promise(e=>setTimeout(e,i))}var us=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await _f(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Cf(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await vf(e)}};var ms=class{create(e,t,n){return new ps(e,t,n)}},ps=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var Zl="x-goog-api-key",gs=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(Zl)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Zl,this.apiKey)}}};var bf="gl-node/",Wi=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Ne({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=Jd(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let o=new gs(this.apiKey);this.apiClient=new Hr({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:bf+"web",uploader:new us,downloader:new ds}),this.models=new Yr(this.apiClient),this.live=new Jr(this.apiClient,o,new ms),this.batches=new Br(this.apiClient),this.chats=new Lr(this.models,this.apiClient),this.caches=new Vr(this.apiClient),this.files=new Gr(this.apiClient),this.operations=new Xr(this.apiClient),this.authTokens=new Zr(this.apiClient),this.tunings=new cs(this.apiClient),this.fileSearchStores=new es(this.apiClient)}};var Xi=class i{constructor(){this.genAI=null;this.apiKey="";this.ipc=B(De);this.isInitialized=!1;this.loadApiKeyFromBackend()}loadApiKeyFromBackend(){let e=localStorage.getItem("ai_api_key");e&&this.setApiKeyInternal(e),this.ipc.on("ai-settings-loaded",t=>{t?.geminiApiKey&&(this.setApiKeyInternal(t.geminiApiKey),localStorage.setItem("ai_api_key",t.geminiApiKey),console.log("[GeminiService] API key loaded from backend"))}),this.ipc.send("get-ai-settings",{}),setTimeout(()=>{this.isConfigured()||console.warn("Gemini API Key not found. AI features will be disabled until configured.")},2e3)}setApiKeyInternal(e){e&&(this.apiKey=e,this.genAI=new Wi({apiKey:e}),this.isInitialized=!0)}setApiKey(e){e&&(this.setApiKeyInternal(e),localStorage.setItem("ai_api_key",e),this.ipc.send("save-ai-settings",{geminiApiKey:e}),console.log("[GeminiService] API key configured and saved to backend"))}isConfigured(){return this.genAI!==null&&this.apiKey.length>0}getApiKey(){return this.apiKey}async generateOutreachMessage(e,t){if(!this.genAI)throw new Error("Gemini API is not initialized. Please ensure the API_KEY environment variable is set.");let n="gemini-2.5-flash",o="You are an expert marketing assistant for a tool called TG-AI\u667A\u63A7\u738B. You write friendly, professional, and short direct messages (DMs). Do not use markdown formatting. Just return the plain text of the message.",r=`
      A user was found in the Telegram group "${e.sourceGroup}" because they mentioned the keyword "${e.triggeredKeyword}".
      Their username is @${e.username}.

      Based on the following instruction, write a direct message to this user.

      Instruction: "${t}"
    `;try{return(await this.genAI.models.generateContent({model:n,contents:r,config:{systemInstruction:o}})).text}catch(c){throw console.error("Error generating content with Gemini:",c),new Error("Failed to generate message. Check console for details.")}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Sf={en:{title:"TG-AI\u667A\u63A7\u738B",subtitle:"AI Telegram Outreach",dashboard:"Dashboard",accounts:"Accounts",automation:"Automation",leads:"Leads",analytics:"Analytics",logs:"Logs",performance:"Performance",alerts:"Alerts",resourceManagement:"Resource Management",marketingAutomation:"Marketing Automation",aiIntelligence:"AI & Intelligence",systemMonitor:"System Monitor",resourceDiscoveryMenu:"Resource Discovery",aiCenter:"AI Center",monitoringCenter:"Monitoring Center",aiAutoChat:"AI Auto Chat",ragKnowledge:"RAG Knowledge",voiceService:"Voice Service",enableAiAutoChat:"Enable AI Auto Chat",aiAutoChatHint:"Automatically reply to private messages using AI",chatMode:"Chat Mode",systemPrompt:"System Prompt",ttsService:"Text to Speech (TTS)",sttService:"Speech to Text (STT)",enableTts:"Enable TTS",enableStt:"Enable STT",ttsEndpointLabel:"TTS Endpoint",sttEndpointLabel:"STT Endpoint",settings:"Settings",totalAccounts:"Total Accounts",onlineAccounts:"Online Accounts",leadsToday:"Leads Today",messagesSentToday:"Messages Sent Today",leadsCaptured:"Leads Captured",keywords:"Keywords",monitoredGroups:"Monitored Groups",systemControl:"System Control",monitoringStatus:"Monitoring Status:",active:"Active",inactive:"Inactive",start:"Start",stop:"Stop",recentLogs:"Recent Logs",recentLeads:"Recent Leads",noRecentActivity:"No recent activity.",manageAccounts:"Manage Accounts",addNewAccount:"Add New Account Manually",phoneNumber:"Phone Number",apiId:"API ID",apiHash:"API Hash",proxy:"SOCKS5 Proxy (Optional)",addAccount:"Add Account",phone:"Phone",status:"Status",actions:"Actions",login:"Login",remove:"Remove",enableWarmup:"Enable Warm-up Mode",dailySends:"Daily Sends",monitoringConfig:"Monitoring Configuration",keywordsTitle:"Keywords",addGroupTitle:"Groups to Monitor",groupUrl:"Group URL or @username",add:"Add",regex:"Regex",leadPipeline:"Lead Pipeline",newLeadCaptured:"New Lead Captured",username:"Username",sourceGroup:"Source Group",keyword:"Keyword",message:"Message",contacted:"Contacted",actionLogs:"Action Logs",clearLogs:"Clear Logs",settingsTitle:"Settings",messagingConfig:"Messaging Configuration",enableSpintax:"Enable Spintax Processing",spintaxHint:"Process message prompts with Spintax (e.g., {Hi|Hello}) for message variations.",abTesting:"A/B Testing Templates",addNewTemplate:"Add New Template",templateName:"Template Name",prompt:"Prompt",saveTemplate:"Save Template",deactivate:"Deactivate",activate:"Activate",abTestingHint:"Create multiple active templates. The system will automatically assign them to new leads for testing.",leadDetails:"Lead Details",sendMessageTab:"Send Message",historyTab:"History",assignedTemplate:"Assigned Template",customizePrompt:"Customize Prompt for this Lead",selectSenderAccount:"Select Sender Account",noSenderAccounts:"No sender accounts available",noSenderAccountsHint:"Please configure sender accounts in Account Management",manualInput:"Manual Input",aiGenerate:"AI Generate",useTemplate:"Use Template",aiPromptPlaceholder:"Enter instructions for AI to generate message...",aiNotConfigured:"AI is not configured.",goToSettings:"Go to Settings",selectTemplatePlaceholder:"Choose a template...",messageContent:"Message Content",characters:"chars",messageContentPlaceholder:"Enter your message here...",messageRequired:"Please enter a message",selectSenderFirst:"Please select a sender account",senderAccountNotFound:"Sender account not found",messageSent:"Message sent successfully!",messageQueued:"Message added to queue",aiConfiguration:"AI Configuration",aiConfigurationHint:"Configure AI API to enable automatic message generation",aiProvider:"AI Provider",customApi:"Custom API",customApiKey:"API Key",geminiKeyHint:"Get your API key from",openaiKeyHint:"Get your API key from",customApiHint:"Enter your custom API key",customApiEndpoint:"API Endpoint URL",testConnection:"Test Connection",testing:"Testing...",saveApiKey:"Save API Key",aiConnectionSuccess:"AI connection successful!",aiConnectionFailed:"AI connection failed",invalidApiKeyFormat:"Invalid API key format",aiSettingsSaved:"AI settings saved!",localAi:"Local AI",localAiConfiguration:"Local AI Service",localAiHint:"Configure local AI service (e.g., Ollama, LocalAI, LM Studio)",localAiEndpoint:"Local AI Endpoint",localAiEndpointPlaceholder:"http://localhost:3002",localAiModel:"Model Name (Optional)",localAiModelPlaceholder:"e.g., llama2, mistral",voiceServices:"Voice Services",voiceServicesHint:"Configure local text-to-speech and speech-to-text services",ttsServiceLabel:"Text-to-Speech (TTS)",ttsEndpoint:"TTS Endpoint",ttsEndpointPlaceholder:"http://localhost:9881",ttsVoice:"Voice ID (Optional)",ttsVoicePlaceholder:"e.g., default, speaker_01",ttsEnabled:"Enable TTS",sttServiceLabel:"Speech-to-Text (STT)",sttEndpoint:"STT Endpoint",sttEndpointPlaceholder:"http://localhost:9000",sttEnabled:"Enable STT",testLocalAi:"Test Local AI",testTts:"Test TTS",testStt:"Test STT",localAiSuccess:"Local AI connection successful!",localAiFailed:"Local AI connection failed",ttsSuccess:"TTS service connection successful!",ttsFailed:"TTS service connection failed",sttSuccess:"STT service connection successful!",sttFailed:"STT service connection failed",invalidEndpointFormat:"Invalid endpoint format (must start with http:// or https://)",saveLocalSettings:"Save Settings",aiAutoChatTitle:"AI Auto Chat",aiAutoChatDescription:"Configure AI-powered automatic responses with unlimited context memory",enableAutoChat:"Enable AI Auto Chat",autoChatMode:"Auto Chat Mode",modeFullAuto:"Full Auto",modeFullAutoDesc:"AI fully takes over, automatically replies to all messages",modeSemiAuto:"Semi-Auto",modeSemiAutoDesc:"AI generates drafts, human confirms before sending",modeAssist:"Assist",modeAssistDesc:"Human inputs, AI provides suggestions and polishing",modeKeyword:"Keyword Trigger",modeKeywordDesc:"AI only activates when keywords are matched",typingSpeed:"Typing Speed",typingSpeedHint:"Characters per minute (simulates human typing)",replyDelay:"Reply Delay",replyDelayHint:"Random delay range before replying (seconds)",systemPromptLabel:"System Prompt",systemPromptHint:"Instructions for AI behavior and personality",systemPromptPlaceholder:"You are a friendly customer service assistant...",maxContextMessages:"Max Context Messages",maxContextHint:"Number of recent messages to include in AI context",enableMemory:"Enable AI Memory",enableMemoryHint:"AI remembers important facts about users across sessions",autoGreeting:"Auto Greeting",autoGreetingHint:"Automatically greet new users",greetingMessage:"Greeting Message",greetingPlaceholder:"Hello {name}! How can I help you today?",unlimitedContext:"Unlimited Context",chatHistory:"Chat History",userProfile:"User Profile",aiMemories:"AI Memories",conversationStage:"Conversation Stage",knowledgeBase:"Knowledge Base",knowledgeBaseHint:"Manage documents, images, videos and QA pairs for AI-enhanced responses",documents:"Documents",images:"Images",videos:"Videos",qaPairs:"Q&A Pairs",addDocument:"Add Document",addImage:"Add Image",addVideo:"Add Video",addQaPair:"Add Q&A",importQa:"Import Q&A",searchKnowledge:"Search Knowledge Base",documentTitle:"Document Title",documentCategory:"Category",documentTags:"Tags",uploadFile:"Upload File",orPasteContent:"Or paste content directly",contentPlaceholder:"Paste document content here...",question:"Question",answer:"Answer",noDocuments:"No documents yet. Add documents to enhance AI responses.",noImages:"No images yet. Add images for rich media responses.",noVideos:"No videos yet. Add videos for tutorial responses.",noQaPairs:"No Q&A pairs yet. Add common questions and answers.",categoryProducts:"Products",categoryTutorials:"Tutorials",categoryGeneral:"General",categoryFaq:"FAQ",dragDropHint:"Drag & drop files here or click to browse",supportedFormats:"Supported formats",fileSize:"File size",chunks:"chunks",preview:"Preview",edit:"Edit",ragEnabled:"RAG Enabled",ragHint:"AI will search knowledge base for relevant information",telegramRagTitle:"Telegram Auto-Learning RAG",telegramRagHint:"Automatically learn from chat history to enhance AI responses",totalKnowledge:"Total Knowledge",qaLearned:"Q&A Learned",scriptsLearned:"Scripts Learned",totalUses:"Total Uses",ragSystemOnline:"RAG System Online",ragSystemOffline:"RAG System Offline",vectorDb:"Vector DB",embedding:"Embedding",initRagSystem:"Initialize RAG",learnFromChats:"Learn from Chats",reindexHighValue:"Reindex High Value",cleanupRag:"Cleanup",refreshStats:"Refresh Stats",searchRagPlaceholder:"Search knowledge base...",searchResults:"Search Results",score:"Score",knowledgeByType:"Knowledge by Type",items:"items",addManualKnowledge:"Add Manual Knowledge",addRagKnowledge:"Add RAG Knowledge",knowledgeType:"Knowledge Type",ragQuestion:"Question",ragAnswer:"Answer",context:"Context",questionPlaceholder:"Enter question or trigger...",answerPlaceholder:"Enter answer or response...",contextPlaceholder:"Optional context info...",addKnowledge:"Add",resourceDiscoveryTitle:"Resource Discovery",resourceDiscoveryHint:"Automatically discover and join Telegram groups/channels",totalResources:"Total Resources",todayDiscovered:"Discovered Today",pendingJoins:"Pending Joins",joinedCount:"Joined",initResourceDiscovery:"Initialize",searchResources:"Search Resources",searchResourcesPlaceholder:"Enter keywords to search groups/channels...",processJoinQueue:"Process Queue",batchJoin:"Batch Join",addToQueue:"Add to Queue",resourceType:"Type",resourceStatus:"Status",memberCount:"Members",overallScore:"Score",discoveredAt:"Discovered",noResourcesFound:"No resources found. Start searching!",chineseSearch:"Chinese Search",tgstatAnalysis:"TGStat Analysis",resourceGroup:"Group",resourceSupergroup:"Supergroup",resourceChannel:"Channel",statusDiscovered:"Discovered",statusQueued:"Queued",statusJoined:"Joined",statusBlocked:"Blocked",selectAll:"Select All",selectedCount:"selected",voiceClone:"Voice Clone",voiceCloneHint:"Upload audio samples to clone voices for TTS. Supports WAV, MP3, OGG, FLAC formats (max 50MB)",uploadVoiceSample:"Upload Voice Sample",clonedVoices:"Cloned Voices",noClonedVoices:"No cloned voices yet. Upload an audio sample to get started.",voiceUploadSuccess:"Voice sample uploaded successfully!",voiceUploadFailed:"Failed to upload voice sample",voiceDeleted:"Voice sample deleted",invalidAudioFormat:"Invalid audio format. Please use WAV, MP3, OGG, or FLAC.",audioFileTooLarge:"Audio file too large. Maximum size is 50MB.",selectVoiceFirst:"Please select a cloned voice first",ttsEndpointRequired:"Please configure TTS endpoint first",previewVoice:"Preview",useThisVoice:"Use",deleteVoice:"Delete",remoteEndpointHint:"Enter the remote server URL where the service is deployed",recordVoice:"Record Voice",startRecording:"Start Recording",stopRecording:"Stop Recording",recording:"Recording...",recordingHint:"Please record 3-10 seconds of clear speech",voiceNameLabel:"Voice Name",voiceNamePlaceholder:"e.g., My Voice, Customer Service",promptTextLabel:"Reference Text (what you said)",promptTextPlaceholder:"Enter the text you spoke during recording...",confirmUpload:"Confirm & Upload",reRecord:"Re-record",recordingTooShort:"Recording too short. Please record at least 3 seconds.",recordingTooLong:"Recording too long. Maximum 10 seconds.",voiceNameRequired:"Please enter a voice name",noRecordingToUpload:"No recording to upload. Please record first.",microphoneAccessDenied:"Microphone access denied. Please allow microphone access.",orUploadFile:"Or upload audio file",seconds:"seconds",generateWithAi:"\u2728 Generate with AI",generating:"Generating...",generatedMessage:"Generated Message",error:"Error:",cancel:"Cancel",sendMessage:"Send Message",language:"Language",appearance:"Appearance",light:"Light",dark:"Dark",health:"Health",group:"Group",allAccounts:"All Accounts",importSession:"Import Session",exportSession:"Export Session",twoFactorPassword:"2FA Password (optional)",accountGroup:"Account Group",accountHealthTooltip:"Health Score based on activity, profile, and proxy quality.",viewLogs:"View Logs",fileBasedManagement:"File-Based Management",downloadTemplate:"Download Template",uploadExcel:"Upload Excel",reloadSessions:"Reload Sessions",noAccountsFound:"No accounts found. Add accounts manually or upload an Excel file.",New:"New",Contacted:"Contacted",Replied:"Replied","Follow-up":"Follow-up","Closed-Won":"Closed-Won","Closed-Lost":"Closed-Lost",moveTo:"Move to",analyticsTitle:"Performance Analytics",replyRate:"Reply Rate",replyRateDesc:'Percentage of contacted leads that have been moved to the "Replied" stage.',templatePerformance:"Template Performance",leadsOverTime:"Leads Over Time",last7Days:"Last 7 Days",conversionFunnel:"Conversion Funnel",contactHistory:"Contact History",noHistoryFound:"No history found for this lead.",kanbanView:"Kanban",listView:"List",exportToExcel:"Export to Excel",onlineStatus:"Online Status",userId:"User ID",leadName:"Lead Name",capturedAt:"Captured At",Online:"Online",Offline:"Offline",Recently:"Recently",Unknown:"Unknown",role:"Role",Listener:"Listener",Sender:"Sender",Unassigned:"Unassigned","Logging in...":"Logging in...",Banned:"Banned","Warming Up":"Warming Up",listenerConfiguration:"Listener Configuration",senderConfiguration:"Sender & Automation Configuration",activeListenerAccounts:"Active Listener Accounts",activeSenderAccounts:"Active Sender Accounts",outreachAutomation:"Outreach & Follow-up Automation",enableAutoReply:"Enable Automated Reply",autoReplyHint:"When a lead is moved to 'Replied', automatically send a message to acknowledge.",autoReplyMessage:"Auto-Reply Message",autoReplyEditHint:"Edit the message and click save to update",saveAutoReply:"Save",settingsSaved:"Settings saved successfully!",saveSettings:"Save Settings",settingsAutoSaveHint:"Settings are auto-saved when changed. You can also click to save manually.",sendingDelays:"Randomized Sending Delays",delayRangeHint:"Wait for a random period before sending the first message.",min:"Min (s)",max:"Max (s)",noActiveListeners:"No active Listener accounts. Assign the Listener role to online accounts.",noActiveSenders:"No active Sender accounts. Assign the Sender role to online accounts.",sendingStrategy:"Sending Strategy",sendImmediately:"Send Immediately",sendWithinTimeWindow:"Send within Time Window",timeWindowHint:"Only send messages between these local times.",from:"From",to:"To",smartSending:"Smart Sending",enableSmartSending:"Enable Smart Sending",smartSendingHint:"Only send messages when the lead is online. Queues message if offline.",attachImage:"Attach Image",attachFile:"Attach File",checkStatus:"Check Status","Proxy Error":"Proxy Error",selected:"selected",bulkActions:"Bulk Actions",assignRole:"Assign Role",assignGroup:"Assign Group",enterGroupName:"Enter new group name:",deleteSelected:"Delete Selected",keywordSets:"Keyword Sets",newKeywordSet:"New Keyword Set Name",assignKeywordSets:"Assign Keyword Sets",addToDNC:"Add to Do Not Contact List",userOnDNC:"User is on DNC List",automationCampaigns:"Automation Campaigns",campaigns:"Campaigns",createCampaign:"Create New Campaign",campaignName:"Campaign Name",triggers:"Triggers",campaignTriggerHint:"A lead will be captured if it matches ALL selected criteria.",sourceGroups:"Source Groups",messageTemplate:"Message Template",selectTemplate:"Select a template...",noCampaignsFound:"No campaigns created yet.",campaign:"Campaign",groups:"Groups","Resting (Cooldown)":"Resting (Cooldown)",allCampaigns:"All Campaigns",selectCampaign:"Select Campaign",campaignPerformance:"Campaign Performance",replied:"Replied",campaignDetails:"Campaign Details",automationHub:"Automation Hub",monitoringTargets:"Step 1: Monitoring Targets",automationRules:"Step 2: Automation Rules",globalSendingConfig:"Global Sending Configuration",accountStatus:"Account Status",addKeywordPlaceholder:"Enter keyword or phrase (e.g., bitcoin, payment)",regexTooltip:'Regular Expression: Use pattern matching instead of exact text. Example: bitcoin|BTC matches "bitcoin" or "BTC"',regexExamples:"Regex Examples",regexExample1:"bitcoin|BTC - matches bitcoin or BTC",regexExample2:"pay.*ment - matches payment, payments, etc.",regexExample3:"\\d+.*USD - matches numbers followed by USD",addKeywordButton:"Add",keywordAdded:"Keyword added",keywordAddFailed:"Failed to add keyword",invalidRegex:"Invalid regex syntax",selectKeywordSetFirst:"Please select a keyword set first",keywordEmpty:"Keyword cannot be empty",testKeyword:"Test",testKeywordPlaceholder:"Enter test text...",keywordMatches:"Matches",keywordNoMatch:"No match"},zh:{title:"TG-AI\u667A\u63A7\u738B",subtitle:"AI Telegram \u8425\u9500",dashboard:"\u4EEA\u8868\u76D8",accounts:"\u8D26\u6237\u7BA1\u7406",automation:"\u81EA\u52A8\u5316\u4E2D\u5FC3",leads:"\u6F5C\u5728\u5BA2\u6237",analytics:"\u5206\u6790",logs:"\u65E5\u5FD7",performance:"\u6027\u80FD\u76D1\u63A7",alerts:"\u544A\u8B66",resourceManagement:"\u8D44\u6E90\u7BA1\u7406",marketingAutomation:"\u8425\u9500\u81EA\u52A8\u5316",aiIntelligence:"AI \u667A\u80FD",systemMonitor:"\u7CFB\u7EDF\u76D1\u63A7",resourceDiscoveryMenu:"\u8D44\u6E90\u53D1\u73B0",aiCenter:"AI \u4E2D\u5FC3",monitoringCenter:"\u76D1\u63A7\u4E2D\u5FC3",aiAutoChat:"AI \u81EA\u52A8\u804A\u5929",ragKnowledge:"RAG \u77E5\u8BC6\u5E93",voiceService:"\u8BED\u97F3\u670D\u52A1",enableAiAutoChat:"\u542F\u7528 AI \u81EA\u52A8\u804A\u5929",aiAutoChatHint:"\u4F7F\u7528 AI \u81EA\u52A8\u56DE\u590D\u79C1\u4FE1",chatMode:"\u804A\u5929\u6A21\u5F0F",systemPrompt:"\u7CFB\u7EDF\u63D0\u793A\u8BCD",ttsService:"\u6587\u5B57\u8F6C\u8BED\u97F3 (TTS)",sttService:"\u8BED\u97F3\u8F6C\u6587\u5B57 (STT)",enableTts:"\u542F\u7528 TTS",enableStt:"\u542F\u7528 STT",ttsEndpointLabel:"TTS \u7AEF\u70B9",sttEndpointLabel:"STT \u7AEF\u70B9",settings:"\u8BBE\u7F6E",totalAccounts:"\u603B\u8D26\u6237\u6570",onlineAccounts:"\u5728\u7EBF\u8D26\u6237",leadsToday:"\u4ECA\u65E5\u83B7\u5BA2",messagesSentToday:"\u4ECA\u65E5\u5DF2\u53D1",leadsCaptured:"\u6355\u83B7\u5BA2\u6237",keywords:"\u5173\u952E\u8BCD",monitoredGroups:"\u76D1\u63A7\u7FA4\u7EC4",systemControl:"\u7CFB\u7EDF\u63A7\u5236",monitoringStatus:"\u76D1\u63A7\u72B6\u6001:",active:"\u8FD0\u884C\u4E2D",inactive:"\u5DF2\u505C\u6B62",start:"\u542F\u52A8",stop:"\u505C\u6B62",recentLogs:"\u6700\u8FD1\u65E5\u5FD7",recentLeads:"\u6700\u8FD1\u5BA2\u6237",noRecentActivity:"\u6682\u65E0\u6700\u8FD1\u6D3B\u52A8\u3002",manageAccounts:"\u7BA1\u7406\u8D26\u6237",addNewAccount:"\u624B\u52A8\u6DFB\u52A0\u65B0\u8D26\u6237",phoneNumber:"\u7535\u8BDD\u53F7\u7801",apiId:"API ID",apiHash:"API Hash",proxy:"SOCKS5 \u4EE3\u7406 (\u53EF\u9009)",addAccount:"\u6DFB\u52A0\u8D26\u6237",phone:"\u7535\u8BDD",status:"\u72B6\u6001",actions:"\u64CD\u4F5C",login:"\u767B\u5F55",remove:"\u79FB\u9664",enableWarmup:"\u542F\u7528\u9884\u70ED\u6A21\u5F0F",dailySends:"\u4ECA\u65E5\u5DF2\u53D1",monitoringConfig:"\u76D1\u63A7\u914D\u7F6E",keywordsTitle:"\u5173\u952E\u8BCD",addGroupTitle:"\u8981\u76D1\u63A7\u7684\u7FA4\u7EC4",groupUrl:"\u7FA4\u7EC4 URL \u6216 @username",add:"\u6DFB\u52A0",regex:"\u6B63\u5219",leadPipeline:"\u6F5C\u5728\u5BA2\u6237\u6F0F\u6597",newLeadCaptured:"\u6355\u83B7\u65B0\u6F5C\u5728\u5BA2\u6237",username:"\u7528\u6237\u540D",sourceGroup:"\u6765\u6E90\u7FA4\u7EC4",keyword:"\u5173\u952E\u8BCD",message:"\u6D88\u606F",contacted:"\u5DF2\u8054\u7CFB",actionLogs:"\u64CD\u4F5C\u65E5\u5FD7",clearLogs:"\u6E05\u7A7A\u65E5\u5FD7",settingsTitle:"\u8BBE\u7F6E",messagingConfig:"\u6D88\u606F\u914D\u7F6E",enableSpintax:"\u542F\u7528 Spintax \u5904\u7406",spintaxHint:"\u5904\u7406\u6D88\u606F\u63D0\u793A\u4E2D\u7684 Spintax (\u4F8B\u5982 {Hi|Hello}) \u4EE5\u5B9E\u73B0\u6D88\u606F\u591A\u6837\u5316\u3002",abTesting:"A/B \u6D4B\u8BD5\u6A21\u677F",addNewTemplate:"\u6DFB\u52A0\u65B0\u6A21\u677F",templateName:"\u6A21\u677F\u540D\u79F0",prompt:"\u63D0\u793A\u8BED",saveTemplate:"\u4FDD\u5B58\u6A21\u677F",deactivate:"\u505C\u7528",activate:"\u6FC0\u6D3B",abTestingHint:"\u521B\u5EFA\u591A\u4E2A\u6D3B\u52A8\u6A21\u677F\u3002\u7CFB\u7EDF\u5C06\u81EA\u52A8\u628A\u5B83\u4EEC\u5206\u914D\u7ED9\u65B0\u7684\u6F5C\u5728\u5BA2\u6237\u8FDB\u884C\u6D4B\u8BD5\u3002",leadDetails:"\u6F5C\u5728\u5BA2\u6237\u8BE6\u60C5",sendMessageTab:"\u53D1\u9001\u6D88\u606F",historyTab:"\u5386\u53F2\u8BB0\u5F55",assignedTemplate:"\u5206\u914D\u7684\u6A21\u677F",customizePrompt:"\u4E3A\u6B64\u6F5C\u5728\u5BA2\u6237\u81EA\u5B9A\u4E49\u63D0\u793A",selectSenderAccount:"\u9009\u62E9\u53D1\u9001\u8D26\u53F7",noSenderAccounts:"\u6CA1\u6709\u53EF\u7528\u7684\u53D1\u9001\u8D26\u53F7",noSenderAccountsHint:"\u8BF7\u5728\u8D26\u6237\u7BA1\u7406\u4E2D\u914D\u7F6E\u53D1\u9001\u8D26\u53F7",manualInput:"\u624B\u52A8\u8F93\u5165",aiGenerate:"AI \u751F\u6210",useTemplate:"\u4F7F\u7528\u6A21\u677F",aiPromptPlaceholder:"\u8F93\u5165 AI \u751F\u6210\u6D88\u606F\u7684\u6307\u4EE4...",aiNotConfigured:"AI \u5C1A\u672A\u914D\u7F6E\u3002",goToSettings:"\u524D\u5F80\u8BBE\u7F6E",selectTemplatePlaceholder:"\u9009\u62E9\u4E00\u4E2A\u6A21\u677F...",messageContent:"\u6D88\u606F\u5185\u5BB9",characters:"\u5B57\u7B26",messageContentPlaceholder:"\u5728\u6B64\u8F93\u5165\u60A8\u7684\u6D88\u606F...",messageRequired:"\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9",selectSenderFirst:"\u8BF7\u5148\u9009\u62E9\u53D1\u9001\u8D26\u53F7",senderAccountNotFound:"\u53D1\u9001\u8D26\u53F7\u4E0D\u5B58\u5728",messageSent:"\u6D88\u606F\u53D1\u9001\u6210\u529F\uFF01",messageQueued:"\u6D88\u606F\u5DF2\u52A0\u5165\u53D1\u9001\u961F\u5217",aiConfiguration:"AI \u914D\u7F6E",aiConfigurationHint:"\u914D\u7F6E AI API \u4EE5\u542F\u7528\u81EA\u52A8\u6D88\u606F\u751F\u6210\u529F\u80FD",aiProvider:"AI \u670D\u52A1\u5546",customApi:"\u81EA\u5B9A\u4E49 API",customApiKey:"API \u5BC6\u94A5",geminiKeyHint:"\u4ECE\u4EE5\u4E0B\u5730\u5740\u83B7\u53D6\u60A8\u7684 API \u5BC6\u94A5\uFF1A",openaiKeyHint:"\u4ECE\u4EE5\u4E0B\u5730\u5740\u83B7\u53D6\u60A8\u7684 API \u5BC6\u94A5\uFF1A",customApiHint:"\u8F93\u5165\u60A8\u7684\u81EA\u5B9A\u4E49 API \u5BC6\u94A5",customApiEndpoint:"API \u63A5\u53E3\u5730\u5740",testConnection:"\u6D4B\u8BD5\u8FDE\u63A5",testing:"\u6D4B\u8BD5\u4E2D...",saveApiKey:"\u4FDD\u5B58 API \u5BC6\u94A5",aiConnectionSuccess:"AI \u8FDE\u63A5\u6210\u529F\uFF01",aiConnectionFailed:"AI \u8FDE\u63A5\u5931\u8D25",invalidApiKeyFormat:"API \u5BC6\u94A5\u683C\u5F0F\u65E0\u6548",aiSettingsSaved:"AI \u8BBE\u7F6E\u5DF2\u4FDD\u5B58\uFF01",localAi:"\u672C\u5730 AI",localAiConfiguration:"\u672C\u5730 AI \u670D\u52A1",localAiHint:"\u914D\u7F6E\u672C\u5730 AI \u670D\u52A1\uFF08\u5982 Ollama\u3001LocalAI\u3001LM Studio\uFF09",localAiEndpoint:"\u672C\u5730 AI \u7AEF\u70B9",localAiEndpointPlaceholder:"http://localhost:3002",localAiModel:"\u6A21\u578B\u540D\u79F0\uFF08\u53EF\u9009\uFF09",localAiModelPlaceholder:"\u4F8B\u5982\uFF1Allama2\u3001mistral",voiceServices:"\u8BED\u97F3\u670D\u52A1",voiceServicesHint:"\u914D\u7F6E\u672C\u5730\u8BED\u97F3\u5408\u6210\u548C\u8BED\u97F3\u8BC6\u522B\u670D\u52A1",ttsServiceLabel:"\u8BED\u97F3\u5408\u6210 (TTS)",ttsEndpoint:"TTS \u7AEF\u70B9",ttsEndpointPlaceholder:"http://localhost:9881",ttsVoice:"\u8BED\u97F3 ID\uFF08\u53EF\u9009\uFF09",ttsVoicePlaceholder:"\u4F8B\u5982\uFF1Adefault\u3001speaker_01",ttsEnabled:"\u542F\u7528 TTS",sttServiceLabel:"\u8BED\u97F3\u8BC6\u522B (STT)",sttEndpoint:"STT \u7AEF\u70B9",sttEndpointPlaceholder:"http://localhost:9000",sttEnabled:"\u542F\u7528 STT",testLocalAi:"\u6D4B\u8BD5\u672C\u5730 AI",testTts:"\u6D4B\u8BD5 TTS",testStt:"\u6D4B\u8BD5 STT",localAiSuccess:"\u672C\u5730 AI \u8FDE\u63A5\u6210\u529F\uFF01",localAiFailed:"\u672C\u5730 AI \u8FDE\u63A5\u5931\u8D25",ttsSuccess:"TTS \u670D\u52A1\u8FDE\u63A5\u6210\u529F\uFF01",ttsFailed:"TTS \u670D\u52A1\u8FDE\u63A5\u5931\u8D25",sttSuccess:"STT \u670D\u52A1\u8FDE\u63A5\u6210\u529F\uFF01",sttFailed:"STT \u670D\u52A1\u8FDE\u63A5\u5931\u8D25",invalidEndpointFormat:"\u7AEF\u70B9\u683C\u5F0F\u65E0\u6548\uFF08\u5FC5\u987B\u4EE5 http:// \u6216 https:// \u5F00\u5934\uFF09",saveLocalSettings:"\u4FDD\u5B58\u8BBE\u7F6E",aiAutoChatTitle:"AI \u81EA\u52A8\u804A\u5929",aiAutoChatDescription:"\u914D\u7F6E AI \u9A71\u52A8\u7684\u81EA\u52A8\u56DE\u590D\uFF0C\u652F\u6301\u65E0\u9650\u4E0A\u4E0B\u6587\u8BB0\u5FC6",enableAutoChat:"\u542F\u7528 AI \u81EA\u52A8\u804A\u5929",autoChatMode:"\u81EA\u52A8\u804A\u5929\u6A21\u5F0F",modeFullAuto:"\u5168\u81EA\u52A8",modeFullAutoDesc:"AI \u5B8C\u5168\u63A5\u7BA1\uFF0C\u81EA\u52A8\u56DE\u590D\u6240\u6709\u6D88\u606F",modeSemiAuto:"\u534A\u81EA\u52A8",modeSemiAutoDesc:"AI \u751F\u6210\u8349\u7A3F\uFF0C\u4EBA\u5DE5\u786E\u8BA4\u540E\u53D1\u9001",modeAssist:"\u8F85\u52A9",modeAssistDesc:"\u4EBA\u5DE5\u8F93\u5165\uFF0CAI \u63D0\u4F9B\u5EFA\u8BAE\u548C\u6DA6\u8272",modeKeyword:"\u5173\u952E\u8BCD\u89E6\u53D1",modeKeywordDesc:"\u4EC5\u5728\u5339\u914D\u5173\u952E\u8BCD\u65F6\u542F\u52A8 AI",typingSpeed:"\u6253\u5B57\u901F\u5EA6",typingSpeedHint:"\u6BCF\u5206\u949F\u5B57\u7B26\u6570\uFF08\u6A21\u62DF\u4EBA\u7C7B\u6253\u5B57\uFF09",replyDelay:"\u56DE\u590D\u5EF6\u8FDF",replyDelayHint:"\u56DE\u590D\u524D\u7684\u968F\u673A\u5EF6\u8FDF\u8303\u56F4\uFF08\u79D2\uFF09",systemPromptLabel:"\u7CFB\u7EDF\u63D0\u793A\u8BCD",systemPromptHint:"AI \u884C\u4E3A\u548C\u4E2A\u6027\u7684\u6307\u4EE4",systemPromptPlaceholder:"\u4F60\u662F\u4E00\u4E2A\u53CB\u597D\u7684\u5BA2\u670D\u52A9\u624B...",maxContextMessages:"\u6700\u5927\u4E0A\u4E0B\u6587\u6D88\u606F\u6570",maxContextHint:"\u5305\u542B\u5728 AI \u4E0A\u4E0B\u6587\u4E2D\u7684\u6700\u8FD1\u6D88\u606F\u6570\u91CF",enableMemory:"\u542F\u7528 AI \u8BB0\u5FC6",enableMemoryHint:"AI \u8DE8\u4F1A\u8BDD\u8BB0\u4F4F\u7528\u6237\u7684\u91CD\u8981\u4FE1\u606F",autoGreeting:"\u81EA\u52A8\u95EE\u5019",autoGreetingHint:"\u81EA\u52A8\u95EE\u5019\u65B0\u7528\u6237",greetingMessage:"\u95EE\u5019\u8BED",greetingPlaceholder:"\u4F60\u597D {name}\uFF01\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u5230\u4F60\u7684\u5417\uFF1F",unlimitedContext:"\u65E0\u9650\u4E0A\u4E0B\u6587",chatHistory:"\u804A\u5929\u5386\u53F2",userProfile:"\u7528\u6237\u753B\u50CF",aiMemories:"AI \u8BB0\u5FC6",conversationStage:"\u5BF9\u8BDD\u9636\u6BB5",knowledgeBase:"\u77E5\u8BC6\u5E93",knowledgeBaseHint:"\u7BA1\u7406\u6587\u6863\u3001\u56FE\u7247\u3001\u89C6\u9891\u548C\u95EE\u7B54\u5BF9\uFF0C\u589E\u5F3A AI \u56DE\u590D\u80FD\u529B",documents:"\u6587\u6863",images:"\u56FE\u7247",videos:"\u89C6\u9891",qaPairs:"\u95EE\u7B54\u5BF9",addDocument:"\u6DFB\u52A0\u6587\u6863",addImage:"\u6DFB\u52A0\u56FE\u7247",addVideo:"\u6DFB\u52A0\u89C6\u9891",addQaPair:"\u6DFB\u52A0\u95EE\u7B54",importQa:"\u5BFC\u5165\u95EE\u7B54",searchKnowledge:"\u641C\u7D22\u77E5\u8BC6\u5E93",documentTitle:"\u6587\u6863\u6807\u9898",documentCategory:"\u5206\u7C7B",documentTags:"\u6807\u7B7E",uploadFile:"\u4E0A\u4F20\u6587\u4EF6",orPasteContent:"\u6216\u76F4\u63A5\u7C98\u8D34\u5185\u5BB9",contentPlaceholder:"\u5728\u6B64\u7C98\u8D34\u6587\u6863\u5185\u5BB9...",question:"\u95EE\u9898",answer:"\u56DE\u7B54",noDocuments:"\u8FD8\u6CA1\u6709\u6587\u6863\u3002\u6DFB\u52A0\u6587\u6863\u6765\u589E\u5F3A AI \u56DE\u590D\u3002",noImages:"\u8FD8\u6CA1\u6709\u56FE\u7247\u3002\u6DFB\u52A0\u56FE\u7247\u7528\u4E8E\u5BCC\u5A92\u4F53\u56DE\u590D\u3002",noVideos:"\u8FD8\u6CA1\u6709\u89C6\u9891\u3002\u6DFB\u52A0\u89C6\u9891\u7528\u4E8E\u6559\u7A0B\u56DE\u590D\u3002",noQaPairs:"\u8FD8\u6CA1\u6709\u95EE\u7B54\u5BF9\u3002\u6DFB\u52A0\u5E38\u89C1\u95EE\u9898\u548C\u56DE\u7B54\u3002",categoryProducts:"\u4EA7\u54C1",categoryTutorials:"\u6559\u7A0B",categoryGeneral:"\u901A\u7528",categoryFaq:"\u5E38\u89C1\u95EE\u9898",dragDropHint:"\u62D6\u653E\u6587\u4EF6\u5230\u8FD9\u91CC\u6216\u70B9\u51FB\u6D4F\u89C8",supportedFormats:"\u652F\u6301\u7684\u683C\u5F0F",fileSize:"\u6587\u4EF6\u5927\u5C0F",chunks:"\u5206\u6BB5",preview:"\u9884\u89C8",edit:"\u7F16\u8F91",ragEnabled:"\u542F\u7528 RAG",ragHint:"AI \u5C06\u4ECE\u77E5\u8BC6\u5E93\u641C\u7D22\u76F8\u5173\u4FE1\u606F",telegramRagTitle:"Telegram \u81EA\u52A8\u5B66\u4E60 RAG",telegramRagHint:"\u81EA\u52A8\u4ECE\u804A\u5929\u8BB0\u5F55\u4E2D\u5B66\u4E60\uFF0C\u589E\u5F3A AI \u56DE\u590D\u80FD\u529B",totalKnowledge:"\u603B\u77E5\u8BC6\u91CF",qaLearned:"\u5B66\u4E60\u7684\u95EE\u7B54",scriptsLearned:"\u5B66\u4E60\u7684\u8BDD\u672F",totalUses:"\u603B\u4F7F\u7528\u6B21\u6570",ragSystemOnline:"RAG \u7CFB\u7EDF\u5728\u7EBF",ragSystemOffline:"RAG \u7CFB\u7EDF\u79BB\u7EBF",vectorDb:"\u5411\u91CF\u5E93",embedding:"\u5D4C\u5165\u6A21\u578B",initRagSystem:"\u521D\u59CB\u5316 RAG",learnFromChats:"\u4ECE\u804A\u5929\u5B66\u4E60",reindexHighValue:"\u91CD\u5EFA\u9AD8\u4EF7\u503C\u7D22\u5F15",cleanupRag:"\u6E05\u7406\u77E5\u8BC6\u5E93",refreshStats:"\u5237\u65B0\u7EDF\u8BA1",searchRagPlaceholder:"\u641C\u7D22\u77E5\u8BC6\u5E93...",searchResults:"\u641C\u7D22\u7ED3\u679C",score:"\u8BC4\u5206",knowledgeByType:"\u6309\u7C7B\u578B\u5206\u7C7B",items:"\u6761",addManualKnowledge:"\u624B\u52A8\u6DFB\u52A0\u77E5\u8BC6",addRagKnowledge:"\u6DFB\u52A0 RAG \u77E5\u8BC6",knowledgeType:"\u77E5\u8BC6\u7C7B\u578B",ragQuestion:"\u95EE\u9898",ragAnswer:"\u56DE\u7B54",context:"\u4E0A\u4E0B\u6587",questionPlaceholder:"\u8F93\u5165\u95EE\u9898\u6216\u89E6\u53D1\u8BCD...",answerPlaceholder:"\u8F93\u5165\u7B54\u6848\u6216\u56DE\u590D...",contextPlaceholder:"\u53EF\u9009\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F...",addKnowledge:"\u6DFB\u52A0",resourceDiscoveryTitle:"\u8D44\u6E90\u53D1\u73B0",resourceDiscoveryHint:"\u81EA\u52A8\u53D1\u73B0\u5E76\u52A0\u5165 Telegram \u7FA4\u7EC4/\u9891\u9053",totalResources:"\u603B\u8D44\u6E90\u6570",todayDiscovered:"\u4ECA\u65E5\u53D1\u73B0",pendingJoins:"\u5F85\u52A0\u5165",joinedCount:"\u5DF2\u52A0\u5165",initResourceDiscovery:"\u521D\u59CB\u5316",searchResources:"\u641C\u7D22\u8D44\u6E90",searchResourcesPlaceholder:"\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22\u7FA4\u7EC4/\u9891\u9053...",processJoinQueue:"\u5904\u7406\u961F\u5217",batchJoin:"\u6279\u91CF\u52A0\u5165",addToQueue:"\u52A0\u5165\u961F\u5217",resourceType:"\u7C7B\u578B",resourceStatus:"\u72B6\u6001",memberCount:"\u6210\u5458\u6570",overallScore:"\u8BC4\u5206",discoveredAt:"\u53D1\u73B0\u65F6\u95F4",noResourcesFound:"\u6682\u65E0\u8D44\u6E90\u3002\u5F00\u59CB\u641C\u7D22\u5427\uFF01",chineseSearch:"\u4E2D\u6587\u641C\u7D22",tgstatAnalysis:"TGStat\u6570\u636E\u5206\u6790",resourceGroup:"\u7FA4\u7EC4",resourceSupergroup:"\u8D85\u7EA7\u7FA4\u7EC4",resourceChannel:"\u9891\u9053",statusDiscovered:"\u5DF2\u53D1\u73B0",statusQueued:"\u961F\u5217\u4E2D",statusJoined:"\u5DF2\u52A0\u5165",statusBlocked:"\u88AB\u5C01\u7981",selectAll:"\u5168\u9009",selectedCount:"\u5DF2\u9009",voiceClone:"\u58F0\u97F3\u514B\u9686",voiceCloneHint:"\u4E0A\u4F20\u97F3\u9891\u6837\u672C\u6765\u514B\u9686\u58F0\u97F3\u7528\u4E8E TTS\u3002\u652F\u6301 WAV\u3001MP3\u3001OGG\u3001FLAC \u683C\u5F0F\uFF08\u6700\u5927 50MB\uFF09",uploadVoiceSample:"\u4E0A\u4F20\u58F0\u97F3\u6837\u672C",clonedVoices:"\u5DF2\u514B\u9686\u7684\u58F0\u97F3",noClonedVoices:"\u8FD8\u6CA1\u6709\u514B\u9686\u7684\u58F0\u97F3\u3002\u4E0A\u4F20\u97F3\u9891\u6837\u672C\u5F00\u59CB\u4F7F\u7528\u3002",voiceUploadSuccess:"\u58F0\u97F3\u6837\u672C\u4E0A\u4F20\u6210\u529F\uFF01",voiceUploadFailed:"\u58F0\u97F3\u6837\u672C\u4E0A\u4F20\u5931\u8D25",voiceDeleted:"\u58F0\u97F3\u6837\u672C\u5DF2\u5220\u9664",invalidAudioFormat:"\u97F3\u9891\u683C\u5F0F\u65E0\u6548\u3002\u8BF7\u4F7F\u7528 WAV\u3001MP3\u3001OGG \u6216 FLAC\u3002",audioFileTooLarge:"\u97F3\u9891\u6587\u4EF6\u8FC7\u5927\u3002\u6700\u5927\u5927\u5C0F\u4E3A 50MB\u3002",selectVoiceFirst:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u514B\u9686\u7684\u58F0\u97F3",ttsEndpointRequired:"\u8BF7\u5148\u914D\u7F6E TTS \u7AEF\u70B9",previewVoice:"\u9884\u89C8",useThisVoice:"\u4F7F\u7528",deleteVoice:"\u5220\u9664",remoteEndpointHint:"\u8F93\u5165\u670D\u52A1\u90E8\u7F72\u7684\u8FDC\u7A0B\u670D\u52A1\u5668 URL",recordVoice:"\u5F55\u5236\u58F0\u97F3",startRecording:"\u5F00\u59CB\u5F55\u97F3",stopRecording:"\u505C\u6B62\u5F55\u97F3",recording:"\u5F55\u97F3\u4E2D...",recordingHint:"\u8BF7\u5F55\u5236 3-10 \u79D2\u6E05\u6670\u7684\u8BED\u97F3",voiceNameLabel:"\u58F0\u97F3\u540D\u79F0",voiceNamePlaceholder:"\u4F8B\u5982\uFF1A\u6211\u7684\u58F0\u97F3\u3001\u5BA2\u670D\u58F0\u97F3",promptTextLabel:"\u53C2\u8003\u6587\u672C\uFF08\u60A8\u8BF4\u7684\u5185\u5BB9\uFF09",promptTextPlaceholder:"\u8F93\u5165\u60A8\u5F55\u97F3\u65F6\u8BF4\u7684\u6587\u5B57...",confirmUpload:"\u786E\u8BA4\u5E76\u4E0A\u4F20",reRecord:"\u91CD\u65B0\u5F55\u97F3",recordingTooShort:"\u5F55\u97F3\u65F6\u95F4\u592A\u77ED\uFF0C\u8BF7\u81F3\u5C11\u5F55\u5236 3 \u79D2",recordingTooLong:"\u5F55\u97F3\u65F6\u95F4\u592A\u957F\uFF0C\u6700\u957F 10 \u79D2",voiceNameRequired:"\u8BF7\u8F93\u5165\u58F0\u97F3\u540D\u79F0",noRecordingToUpload:"\u6CA1\u6709\u53EF\u4E0A\u4F20\u7684\u5F55\u97F3\uFF0C\u8BF7\u5148\u5F55\u97F3",microphoneAccessDenied:"\u9EA6\u514B\u98CE\u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF0C\u8BF7\u5141\u8BB8\u9EA6\u514B\u98CE\u6743\u9650",orUploadFile:"\u6216\u4E0A\u4F20\u97F3\u9891\u6587\u4EF6",seconds:"\u79D2",generateWithAi:"\u2728 AI \u751F\u6210",generating:"\u751F\u6210\u4E2D...",generatedMessage:"\u751F\u6210\u7684\u6D88\u606F",error:"\u9519\u8BEF:",cancel:"\u53D6\u6D88",sendMessage:"\u53D1\u9001\u6D88\u606F",language:"\u8BED\u8A00",appearance:"\u5916\u89C2",light:"\u6D45\u8272",dark:"\u6DF1\u8272",health:"\u5065\u5EB7\u5EA6",group:"\u5206\u7EC4",allAccounts:"\u6240\u6709\u8D26\u6237",importSession:"\u5BFC\u5165\u4F1A\u8BDD",exportSession:"\u5BFC\u51FA\u56DE\u8BDD",twoFactorPassword:"2FA \u5BC6\u7801 (\u53EF\u9009)",accountGroup:"\u8D26\u6237\u5206\u7EC4",accountHealthTooltip:"\u5065\u5EB7\u5206\u57FA\u4E8E\u8D26\u53F7\u6D3B\u8DC3\u5EA6\u3001\u4E2A\u4EBA\u8D44\u6599\u5B8C\u6574\u5EA6\u548C\u4EE3\u7406\u8D28\u91CF\u3002",viewLogs:"\u67E5\u770B\u65E5\u5FD7",fileBasedManagement:"\u6587\u4EF6\u7BA1\u7406",downloadTemplate:"\u4E0B\u8F7D\u6A21\u677F",uploadExcel:"\u4E0A\u4F20 Excel",reloadSessions:"\u91CD\u65B0\u52A0\u8F7D\u4F1A\u8BDD",noAccountsFound:"\u672A\u627E\u5230\u4EFB\u4F55\u8D26\u6237\u3002\u8BF7\u624B\u52A8\u6DFB\u52A0\u6216\u4E0A\u4F20 Excel \u6587\u4EF6\u3002",New:"\u65B0\u5BA2\u6237",Contacted:"\u5DF2\u8054\u7CFB",Replied:"\u5DF2\u56DE\u590D","Follow-up":"\u9700\u8DDF\u8FDB","Closed-Won":"\u6210\u4EA4","Closed-Lost":"\u6D41\u5931",moveTo:"\u79FB\u52A8\u5230",analyticsTitle:"\u6027\u80FD\u5206\u6790",replyRate:"\u56DE\u590D\u7387",replyRateDesc:"\u5DF2\u8054\u7CFB\u7684\u6F5C\u5728\u5BA2\u6237\u4E2D\u88AB\u79FB\u81F3\u201C\u5DF2\u56DE\u590D\u201D\u9636\u6BB5\u7684\u767E\u5206\u6BD4\u3002",templatePerformance:"\u6A21\u677F\u6027\u80FD",leadsOverTime:"\u6F5C\u5728\u5BA2\u6237\u8D8B\u52BF",last7Days:"\u8FC7\u53BB7\u5929",conversionFunnel:"\u8F6C\u5316\u6F0F\u6597",contactHistory:"\u8054\u7CFB\u5386\u53F2",noHistoryFound:"\u672A\u627E\u5230\u6B64\u6F5C\u5728\u5BA2\u6237\u7684\u5386\u53F2\u8BB0\u5F55\u3002",kanbanView:"\u770B\u677F",listView:"\u5217\u8868",exportToExcel:"\u5BFC\u51FA\u5230 Excel",onlineStatus:"\u5728\u7EBF\u72B6\u6001",userId:"\u7528\u6237 ID",leadName:"\u6F5C\u5728\u5BA2\u6237",capturedAt:"\u6355\u83B7\u4E8E",Online:"\u5728\u7EBF",Offline:"\u79BB\u7EBF",Recently:"\u6700\u8FD1\u5728\u7EBF",Unknown:"\u672A\u77E5",role:"\u89D2\u8272",Listener:"\u76D1\u63A7\u53F7",Sender:"\u53D1\u9001\u53F7",Unassigned:"\u672A\u5206\u914D","Logging in...":"\u767B\u5F55\u4E2D...",Banned:"\u5DF2\u5C01\u7981","Warming Up":"\u9884\u70ED\u4E2D",listenerConfiguration:"\u76D1\u63A7\u914D\u7F6E",senderConfiguration:"\u53D1\u9001\u4E0E\u81EA\u52A8\u5316\u914D\u7F6E",activeListenerAccounts:"\u5F53\u524D\u76D1\u63A7\u53F7",activeSenderAccounts:"\u5F53\u524D\u53D1\u9001\u53F7",outreachAutomation:"\u81EA\u52A8\u5916\u8054\u4E0E\u8DDF\u8FDB",enableAutoReply:"\u542F\u7528\u81EA\u52A8\u56DE\u590D",autoReplyHint:"\u5F53\u6F5C\u5728\u5BA2\u6237\u72B6\u6001\u53D8\u4E3A\u201C\u5DF2\u56DE\u590D\u201D\u65F6\uFF0C\u81EA\u52A8\u53D1\u9001\u4E00\u6761\u6D88\u606F\u4EE5\u786E\u8BA4\u3002",autoReplyMessage:"\u81EA\u52A8\u56DE\u590D\u6D88\u606F",autoReplyEditHint:"\u7F16\u8F91\u6D88\u606F\u5185\u5BB9\uFF0C\u70B9\u51FB\u4FDD\u5B58\u4EE5\u66F4\u65B0",saveAutoReply:"\u4FDD\u5B58",settingsSaved:"\u8BBE\u7F6E\u5DF2\u4FDD\u5B58\uFF01",saveSettings:"\u4FDD\u5B58\u8BBE\u7F6E",settingsAutoSaveHint:"\u66F4\u6539\u8BBE\u7F6E\u65F6\u4F1A\u81EA\u52A8\u4FDD\u5B58\uFF0C\u4E5F\u53EF\u4EE5\u624B\u52A8\u70B9\u51FB\u4FDD\u5B58",sendingDelays:"\u968F\u673A\u53D1\u9001\u5EF6\u8FDF",delayRangeHint:"\u5728\u53D1\u9001\u7B2C\u4E00\u6761\u6D88\u606F\u524D\uFF0C\u968F\u673A\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\u3002",min:"\u6700\u5C0F (\u79D2)",max:"\u6700\u5927 (\u79D2)",noActiveListeners:"\u6CA1\u6709\u53EF\u7528\u7684\u76D1\u63A7\u53F7\u3002\u8BF7\u4E3A\u5728\u7EBF\u8D26\u6237\u5206\u914D\u201C\u76D1\u63A7\u53F7\u201D\u89D2\u8272\u3002",noActiveSenders:"\u6CA1\u6709\u53EF\u7528\u7684\u53D1\u9001\u53F7\u3002\u8BF7\u4E3A\u5728\u7EBF\u8D26\u6237\u5206\u914D\u201C\u53D1\u9001\u53F7\u201D\u89D2\u8272\u3002",sendingStrategy:"\u53D1\u9001\u7B56\u7565",sendImmediately:"\u7ACB\u5373\u53D1\u9001",sendWithinTimeWindow:"\u5728\u65F6\u95F4\u7A97\u53E3\u5185\u53D1\u9001",timeWindowHint:"\u4EC5\u5728\u8FD9\u4E9B\u672C\u5730\u65F6\u95F4\u4E4B\u95F4\u53D1\u9001\u6D88\u606F\u3002",from:"\u4ECE",to:"\u5230",smartSending:"\u667A\u80FD\u53D1\u9001",enableSmartSending:"\u542F\u7528\u667A\u80FD\u53D1\u9001",smartSendingHint:"\u4EC5\u5F53\u6F5C\u5728\u5BA2\u6237\u5728\u7EBF\u65F6\u53D1\u9001\u6D88\u606F\u3002\u5982\u679C\u79BB\u7EBF\u5219\u5C06\u6D88\u606F\u52A0\u5165\u961F\u5217\u3002",attachImage:"\u9644\u52A0\u56FE\u7247",attachFile:"\u9644\u52A0\u6587\u4EF6",checkStatus:"\u68C0\u67E5\u72B6\u6001","Proxy Error":"\u4EE3\u7406\u9519\u8BEF",selected:"\u5DF2\u9009\u62E9",bulkActions:"\u6279\u91CF\u64CD\u4F5C",assignRole:"\u5206\u914D\u89D2\u8272",assignGroup:"\u5206\u914D\u5206\u7EC4",enterGroupName:"\u8F93\u5165\u65B0\u5206\u7EC4\u540D\u79F0:",deleteSelected:"\u5220\u9664\u6240\u9009",keywordSets:"\u5173\u952E\u8BCD\u96C6",newKeywordSet:"\u65B0\u5173\u952E\u8BCD\u96C6\u540D\u79F0",assignKeywordSets:"\u5206\u914D\u5173\u952E\u8BCD\u96C6",addToDNC:"\u6DFB\u52A0\u5230\u201C\u8BF7\u52FF\u8054\u7CFB\u201D\u5217\u8868",userOnDNC:"\u7528\u6237\u5DF2\u5728\u201C\u8BF7\u52FF\u8054\u7CFB\u201D\u5217\u8868",automationCampaigns:"\u81EA\u52A8\u5316\u6D3B\u52A8",campaigns:"\u6D3B\u52A8\u5217\u8868",createCampaign:"\u521B\u5EFA\u65B0\u6D3B\u52A8",campaignName:"\u6D3B\u52A8\u540D\u79F0",triggers:"\u89E6\u53D1\u5668",campaignTriggerHint:"\u5F53\u6F5C\u5728\u5BA2\u6237\u6EE1\u8DB3\u6240\u6709\u9009\u5B9A\u6761\u4EF6\u65F6\uFF0C\u5C06\u89E6\u53D1\u6B64\u6D3B\u52A8\u3002",sourceGroups:"\u6765\u6E90\u7FA4\u7EC4",messageTemplate:"\u6D88\u606F\u6A21\u677F",selectTemplate:"\u9009\u62E9\u4E00\u4E2A\u6A21\u677F...",noCampaignsFound:"\u5C1A\u672A\u521B\u5EFA\u4EFB\u4F55\u6D3B\u52A8\u3002",campaign:"\u6D3B\u52A8",groups:"\u7FA4\u7EC4","Resting (Cooldown)":"\u4F11\u606F\u4E2D (\u51B7\u5374)",allCampaigns:"\u6240\u6709\u6D3B\u52A8",selectCampaign:"\u9009\u62E9\u6D3B\u52A8",campaignPerformance:"\u6D3B\u52A8\u6027\u80FD",replied:"\u5DF2\u56DE\u590D",campaignDetails:"\u6D3B\u52A8\u8BE6\u60C5",automationHub:"\u81EA\u52A8\u5316\u4E2D\u5FC3",monitoringTargets:"\u7B2C1\u6B65\uFF1A\u76D1\u63A7\u76EE\u6807",automationRules:"\u7B2C2\u6B65\uFF1A\u81EA\u52A8\u5316\u89C4\u5219",globalSendingConfig:"\u5168\u5C40\u53D1\u9001\u914D\u7F6E",accountStatus:"\u8D26\u6237\u72B6\u6001",addKeywordPlaceholder:"\u8F38\u5165\u95DC\u9375\u8A5E\u6216\u77ED\u8A9E\uFF08\u4F8B\u5982\uFF1Abitcoin, \u4ED8\u6B3E\uFF09",regexTooltip:'\u6B63\u5247\u8868\u9054\u5F0F\uFF1A\u4F7F\u7528\u6A21\u5F0F\u5339\u914D\u800C\u975E\u7CBE\u78BA\u6587\u5B57\u3002\u4F8B\u5982\uFF1Abitcoin|BTC \u53EF\u5339\u914D "bitcoin" \u6216 "BTC"',regexExamples:"\u6B63\u5247\u793A\u4F8B",regexExample1:"bitcoin|BTC - \u5339\u914D bitcoin \u6216 BTC",regexExample2:"pay.*ment - \u5339\u914D payment, payments \u7B49",regexExample3:"\\d+.*USD - \u5339\u914D\u6578\u5B57\u5F8C\u8DDF USD",addKeywordButton:"\u6DFB\u52A0",keywordAdded:"\u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0",keywordAddFailed:"\u6DFB\u52A0\u95DC\u9375\u8A5E\u5931\u6557",invalidRegex:"\u6B63\u5247\u8868\u9054\u5F0F\u8A9E\u6CD5\u932F\u8AA4",selectKeywordSetFirst:"\u8ACB\u5148\u9EDE\u64CA\u95DC\u9375\u8A5E\u96C6\u4EE5\u9078\u64C7",keywordEmpty:"\u95DC\u9375\u8A5E\u4E0D\u80FD\u70BA\u7A7A",testKeyword:"\u6E2C\u8A66",testKeywordPlaceholder:"\u8F38\u5165\u6E2C\u8A66\u6587\u672C...",keywordMatches:"\u5339\u914D",keywordNoMatch:"\u4E0D\u5339\u914D"}},Zi=class i{constructor(){this.language=C("zh");this.dictionary=C(Sf)}translate(e){let t=this.language();return this.dictionary()[t][e]||e}setLanguage(e){this.language.set(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var kn=class i{constructor(){this.ipcService=B(De)}downloadExcelTemplate(){this.ipcService.send("download-excel-template")}loadAccountsFromExcel(){this.ipcService.send("load-accounts-from-excel")}reloadSessionsAndAccounts(){this.ipcService.send("reload-sessions-and-accounts")}exportLeadsToExcel(e){this.ipcService.send("export-leads-to-excel",JSON.parse(JSON.stringify(e)))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac})}};var yf=(i,e)=>e.id,wf=(i,e)=>e.label;function Ef(i,e){if(i&1&&(O(0,"div",6),l(1),G()),i&2){let t=f().$implicit;d(),M(t.title)}}function Af(i,e){if(i&1){let t=T();O(0,"button",12),ge("click",function(){v(t);let o=f().$implicit,r=f();return x(r.handleNextStep(o))}),O(1,"span"),l(2,"\u2192"),G(),O(3,"span",13),l(4),G()()}if(i&2){let t=f().$implicit;d(4),M(t.nextStep.label)}}function Df(i,e){if(i&1){let t=T();O(0,"button",15),ge("click",function(){let o=v(t).$implicit,r=f(2).$implicit,c=f();return x(c.handleAction(r,o))}),l(1),G()}if(i&2){let t=e.$implicit;I("bg-white",t.variant==="primary")("text-slate-900",t.variant==="primary")("hover:bg-white/90",t.variant==="primary")("bg-white/20",t.variant==="secondary"||!t.variant)("text-white",t.variant==="secondary"||!t.variant)("hover:bg-white/30",t.variant==="secondary"||!t.variant)("bg-red-600",t.variant==="danger")("text-white",t.variant==="danger")("hover:bg-red-700",t.variant==="danger"),d(),A(" ",t.label," ")}}function Mf(i,e){if(i&1&&(O(0,"div",9),$(1,Df,2,19,"button",14,wf),G()),i&2){let t=f().$implicit;d(),H(t.actions)}}function Tf(i,e){if(i&1){let t=T();O(0,"button",16),ge("click",function(){v(t);let o=f().$implicit,r=f();return x(r.dismiss(o.id))}),te(),O(1,"svg",17),Ve(2,"path",18),G()()}}function If(i,e){if(i&1&&(O(0,"div",11),Ve(1,"div",19),G()),i&2){let t=f().$implicit;d(),j("width",t.progress,"%")}}function kf(i,e){if(i&1&&(O(0,"div",2)(1,"div",3)(2,"div",4),l(3),G(),O(4,"div",5),w(5,Ef,2,1,"div",6),O(6,"div",7),l(7),G(),w(8,Af,5,1,"button",8),w(9,Mf,3,0,"div",9),G(),w(10,Tf,3,0,"button",10),G(),w(11,If,2,2,"div",11),G()),i&2){let t=e.$implicit,n=f();I("bg-emerald-500/95",t.type==="success")("bg-red-500/95",t.type==="error")("bg-amber-500/95",t.type==="warning")("bg-blue-500/95",t.type==="info")("bg-slate-700/95",t.type==="progress")("border-emerald-400/50",t.type==="success")("border-red-400/50",t.type==="error")("border-amber-400/50",t.type==="warning")("border-blue-400/50",t.type==="info")("border-slate-600/50",t.type==="progress"),d(3),A(" ",t.icon||n.getDefaultIcon(t.type)," "),d(2),E(t.title?5:-1),d(2),A(" ",t.message," "),d(),E(t.nextStep?8:-1),d(),E(t.actions&&t.actions.length>0?9:-1),d(),E(t.dismissible!==!1?10:-1),d(),E(t.type==="progress"&&t.progress!==void 0?11:-1)}}var ji=class i{constructor(){this.toastService=B(me)}get toasts(){return this.toastService.getToasts()}getDefaultIcon(e){return{success:"\u2705",error:"\u274C",warning:"\u26A0\uFE0F",info:"\u2139\uFE0F",progress:"\u23F3"}[e]||"\u2139\uFE0F"}dismiss(e){this.toastService.dismiss(e)}handleNextStep(e){e.nextStep&&(e.nextStep.action(),this.dismiss(e.id))}handleAction(e,t){t.handler(),this.dismiss(e.id)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-toast"]],decls:3,vars:0,consts:[[1,"fixed","top-4","right-4","z-[9999]","space-y-3","max-w-md"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden",3,"bg-emerald-500/95","bg-red-500/95","bg-amber-500/95","bg-blue-500/95","bg-slate-700/95","border-emerald-400/50","border-red-400/50","border-amber-400/50","border-blue-400/50","border-slate-600/50"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden"],[1,"flex","items-start","gap-3","p-4"],[1,"flex-shrink-0","text-xl"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-white","mb-0.5"],[1,"text-white","text-sm"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors"],[1,"flex","items-center","gap-2","mt-3"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1"],[1,"h-1","bg-slate-600"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors",3,"click"],[1,"underline"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"bg-white","text-slate-900","hover:bg-white/90","bg-white/20","text-white","hover:bg-white/30","bg-red-600","hover:bg-red-700"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"click"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all","duration-300"]],template:function(t,n){t&1&&(O(0,"div",0),$(1,kf,12,27,"div",1,yf),G()),t&2&&(d(),H(n.toasts()))},dependencies:[oe],styles:["@keyframes _ngcontent-%COMP%_slide-in{0%{transform:translate(100%) scale(.95);opacity:0}to{transform:translate(0) scale(1);opacity:1}}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in .3s cubic-bezier(.34,1.56,.64,1)}"]})}};function Pf(i,e){i&1&&(s(0,"span",5),l(1,"\u2139\uFE0F"),a())}function Ff(i,e){i&1&&(s(0,"span",6),l(1,"\u26A0\uFE0F"),a())}function Rf(i,e){i&1&&(s(0,"span",7),l(1,"\u{1F5D1}\uFE0F"),a())}function Nf(i,e){if(i&1&&(s(0,"li",18),k(1,"span",20),s(2,"span",21),l(3),a()()),i&2){let t=e.$implicit,n=f(3);d(),I("bg-yellow-500",n.dialogService.state().type==="warning")("bg-red-500",n.dialogService.state().type==="danger")("bg-blue-500",n.dialogService.state().type==="info"),d(2),M(t)}}function Bf(i,e){if(i&1&&(s(0,"li",19),l(1),a()),i&2){let t=f(3);d(),A("...\u9084\u6709 ",t.dialogService.state().affectedItems.length-5," \u9805")}}function Vf(i,e){if(i&1&&(s(0,"div",11)(1,"p",16),l(2,"\u5C07\u6703\u53D7\u5230\u5F71\u97FF:"),a(),s(3,"ul",17),$(4,Nf,4,7,"li",18,ke),w(6,Bf,2,1,"li",19),a()()),i&2){let t=f(2);d(4),H(t.dialogService.state().affectedItems.slice(0,5)),d(2),E(t.dialogService.state().affectedItems.length>5?6:-1)}}function Lf(i,e){if(i&1){let t=T();s(0,"div",12)(1,"p",16),l(2," \u8F38\u5165\u300C"),s(3,"span",22),l(4),a(),l(5,"\u300D\u4EE5\u78BA\u8A8D "),a(),s(6,"input",23),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.confirmTextInput,o)||(r.confirmTextInput=o),x(o)}),a()()}if(i&2){let t=f(2);d(4),M(t.dialogService.state().confirmTextRequired),d(2),K("ngModel",t.confirmTextInput)}}function Of(i,e){if(i&1){let t=T();s(0,"div",0)(1,"div",1),b("click",function(){v(t);let o=f();return x(o.dialogService.onCancel())}),a(),s(2,"div",2)(3,"div",3)(4,"div",4),w(5,Pf,2,0,"span",5)(6,Ff,2,0,"span",6)(7,Rf,2,0,"span",7),a()(),s(8,"div",8)(9,"h3",9),l(10),a(),s(11,"p",10),l(12),a(),w(13,Vf,7,1,"div",11),w(14,Lf,7,2,"div",12),a(),s(15,"div",13)(16,"button",14),b("click",function(){v(t);let o=f();return x(o.dialogService.onCancel())}),l(17),a(),s(18,"button",15),b("click",function(){v(t);let o=f();return x(o.onConfirmClick())}),l(19),a()()()()}if(i&2){let t,n=f();d(4),I("bg-blue-500/20",n.dialogService.state().type==="info")("bg-yellow-500/20",n.dialogService.state().type==="warning")("bg-red-500/20",n.dialogService.state().type==="danger"),d(),E((t=n.dialogService.state().type)==="info"?5:t==="warning"?6:t==="danger"?7:-1),d(5),M(n.dialogService.state().title),d(2),M(n.dialogService.state().message),d(),E(n.dialogService.state().affectedItems&&n.dialogService.state().affectedItems.length>0?13:-1),d(),E(n.dialogService.state().requireConfirmText?14:-1),d(3),A(" ",n.dialogService.state().cancelText," "),d(),I("bg-blue-500",n.dialogService.state().type==="info")("hover:bg-blue-600",n.dialogService.state().type==="info")("bg-yellow-500",n.dialogService.state().type==="warning")("hover:bg-yellow-600",n.dialogService.state().type==="warning")("text-black",n.dialogService.state().type==="warning")("bg-red-500",n.dialogService.state().type==="danger")("hover:bg-red-600",n.dialogService.state().type==="danger")("text-white",n.dialogService.state().type!=="warning"),V("disabled",!n.canConfirm()),d(),A(" ",n.dialogService.state().confirmText," ")}}var eo=class i{constructor(){this.dialogService=B(Ks);this.confirmTextInput=""}canConfirm(){let e=this.dialogService.state();return e.requireConfirmText?this.confirmTextInput===e.confirmTextRequired:!0}onConfirmClick(){this.canConfirm()&&(this.confirmTextInput="",this.dialogService.onConfirm())}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-global-confirm-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"pt-6","text-center"],[1,"inline-flex","w-16","h-16","rounded-full","items-center","justify-center","text-3xl"],[1,"text-blue-400"],[1,"text-yellow-400"],[1,"text-red-400"],[1,"p-6","text-center"],[1,"text-lg","font-semibold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-4","whitespace-pre-line"],[1,"mt-4","p-3","bg-slate-700/50","rounded-lg","text-left","max-h-32","overflow-y-auto"],[1,"mt-4"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","rounded-lg","transition-colors","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-xs","text-slate-500","mb-2"],[1,"space-y-1"],[1,"text-sm","text-slate-300","flex","items-center","gap-2"],[1,"text-xs","text-slate-500"],[1,"w-1.5","h-1.5","rounded-full","flex-shrink-0"],[1,"truncate"],[1,"text-red-400","font-medium"],["type","text","placeholder","\u8ACB\u8F38\u5165\u78BA\u8A8D\u6587\u5B57",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-center","focus:border-red-500","focus:outline-none",3,"ngModelChange","ngModel"]],template:function(t,n){t&1&&w(0,Of,20,30,"div",0),t&2&&E(n.dialogService.state().isOpen?0:-1)},dependencies:[oe,ue,xe,fe,_e],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};var Gf=["inputRef"];function Uf(i,e){if(i&1&&(s(0,"p",6),l(1),a()),i&2){let t,n=f(2);d(),M((t=n.dialogService.inputDialog())==null?null:t.message)}}function qf(i,e){if(i&1){let t=T();s(0,"textarea",14,0),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.inputValue,o)||(r.inputValue=o),x(o)}),b("keydown.enter",function(o){v(t);let r=f(2);return x(r.onEnterKey(o))}),l(2,"              "),a()}if(i&2){let t,n=f(2);K("ngModel",n.inputValue),V("placeholder",((t=n.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function $f(i,e){if(i&1){let t=T();s(0,"input",15,0),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.inputValue,o)||(r.inputValue=o),x(o)}),b("keydown.enter",function(o){v(t);let r=f(2);return x(r.onEnterKey(o))}),a()}if(i&2){let t,n=f(2);K("ngModel",n.inputValue),V("placeholder",((t=n.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function Hf(i,e){if(i&1&&(s(0,"p",10)(1,"span"),l(2,"\u26A0\uFE0F"),a(),l(3),a()),i&2){let t=f(2);d(3),A(" ",t.dialogService.inputDialogError()," ")}}function Kf(i,e){if(i&1){let t=T();s(0,"div",1)(1,"div",2),b("click",function(){v(t);let o=f();return x(o.cancelDialog())}),a(),s(2,"div",3)(3,"div",4)(4,"h3",5)(5,"span"),l(6,"\u270F\uFE0F"),a(),l(7),a(),w(8,Uf,2,1,"p",6),a(),s(9,"div",7),b("click",function(o){v(t);let r=f();return x(r.focusInput(o))}),w(10,qf,3,2,"textarea",8)(11,$f,2,2,"input",9),w(12,Hf,4,1,"p",10),a(),s(13,"div",11)(14,"button",12),b("click",function(){v(t);let o=f();return x(o.cancelDialog())}),l(15),a(),s(16,"button",13),b("click",function(){v(t);let o=f();return x(o.confirmWithValue())}),l(17),a()()()()}if(i&2){let t,n,o,r,c,m=f();d(7),A(" ",(t=m.dialogService.inputDialog())==null?null:t.title," "),d(),E((n=m.dialogService.inputDialog())!=null&&n.message?8:-1),d(2),E(((o=m.dialogService.inputDialog())==null?null:o.inputType)==="textarea"?10:11),d(2),E(m.dialogService.inputDialogError()?12:-1),d(3),A(" ",((r=m.dialogService.inputDialog())==null?null:r.cancelText)||"\u53D6\u6D88"," "),d(2),A(" ",((c=m.dialogService.inputDialog())==null?null:c.confirmText)||"\u78BA\u5B9A"," ")}}var to=class i{constructor(){this.dialogService=B(ht);this.inputValue="";this.lastDialogState=!1}ngAfterViewChecked(){let e=!!this.dialogService.inputDialog();e&&!this.lastDialogState&&(this.inputValue=this.dialogService.inputDialog()?.defaultValue||"",setTimeout(()=>this.focusInput(),100),setTimeout(()=>this.focusInput(),300)),!e&&this.lastDialogState&&(this.inputValue=""),this.lastDialogState=e}focusInput(e){e&&e.stopPropagation(),this.inputRef?.nativeElement&&(this.inputRef.nativeElement.focus(),console.log("[InputDialog] Focus requested"))}onEnterKey(e){this.dialogService.inputDialog()?.inputType!=="textarea"&&(e.preventDefault(),this.confirmWithValue())}confirmWithValue(){this.dialogService.updateInputValue(this.inputValue),this.dialogService.confirmInput()}cancelDialog(){this.inputValue="",this.dialogService.cancelInput()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-global-input-dialog"]],viewQuery:function(t,n){if(t&1&&Ln(Gf,5),t&2){let o;hn(o=fn())&&(n.inputRef=o.first)}},decls:1,vars:1,consts:[["inputRef",""],[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"p-6","pb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-2"],[1,"px-6","pb-4",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModel","placeholder"],[1,"mt-2","text-sm","text-red-400","flex","items-center","gap-1"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","bg-purple-500","hover:bg-purple-600","text-white","rounded-lg","transition-colors","font-medium",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModelChange","keydown.enter","ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModelChange","keydown.enter","ngModel","placeholder"]],template:function(t,n){t&1&&w(0,Kf,18,6,"div",1),t&2&&E(n.dialogService.inputDialog()?0:-1)},dependencies:[oe,ue,xe,fe,_e],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};function zf(i,e){if(i&1&&(O(0,"p",9),l(1),G()),i&2){let t=f(2);d(),M(t.progressSignal().itemName)}}function Wf(i,e){if(i&1&&(O(0,"p",6),l(1),G()),i&2){let t=f(2);d(),M(t.progressSignal().message)}}function Jf(i,e){if(i&1){let t=T();O(0,"button",11),ge("click",function(){v(t);let o=f(2);return x(o.onCancel())}),l(1," \u53D6\u6D88 "),G()}}function Qf(i,e){if(i&1&&(O(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),l(4),G(),O(5,"div",4)(6,"div",5)(7,"span",6),l(8),G(),O(9,"span",6),l(10),G()(),O(11,"div",7),Ve(12,"div",8),G()(),w(13,zf,2,1,"p",9),w(14,Wf,2,1,"p",6),w(15,Jf,2,0,"button",10),G()()()),i&2){let t=f();d(4),M(t.titleSignal()),d(4),Y("",t.progressSignal().current," / ",t.progressSignal().total),d(2),A("",t.percentage(),"%"),d(2),j("width",t.percentage(),"%"),d(),E(t.progressSignal().itemName?13:-1),d(),E(t.progressSignal().message?14:-1),d(),E(t.cancellableSignal()?15:-1)}}var no=class i{constructor(){this._show=C(!1);this._title=C("\u5904\u7406\u4E2D...");this._progress=C({current:0,total:0});this._cancellable=C(!1);this.showSignal=L(()=>this._show());this.titleSignal=L(()=>this._title());this.progressSignal=L(()=>this._progress());this.cancellableSignal=L(()=>this._cancellable());this.percentage=L(()=>{let e=this._progress();return e.total>0?Math.round(e.current/e.total*100):0})}set show(e){this._show.set(e)}set title(e){this._title.set(e)}set progress(e){this._progress.set(e)}set cancellable(e){this._cancellable.set(e)}onCancel(){this.onCancelCallback&&this.onCancelCallback()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-progress-dialog"]],inputs:{show:"show",title:"title",progress:"progress",cancellable:"cancellable",onCancelCallback:"onCancelCallback"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","z-50","flex","items-center","justify-center"],[1,"bg-slate-800/90","dark:bg-slate-900/90","rounded-lg","p-6","shadow-xl","border","border-slate-700","min-w-[400px]"],[1,"flex","flex-col","gap-4"],[1,"text-lg","font-semibold","text-slate-200"],[1,"w-full"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-sm","text-slate-300"],[1,"w-full","bg-slate-700","rounded-full","h-3","overflow-hidden"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","h-full","transition-all","duration-300","ease-out"],[1,"text-sm","text-slate-400","text-center"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm",3,"click"]],template:function(t,n){t&1&&w(0,Qf,16,9,"div",0),t&2&&E(n.showSignal()?0:-1)},dependencies:[oe],styles:[".transition-all[_ngcontent-%COMP%]{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.3s}"]})}};function Yf(i,e){if(i&1&&(O(0,"span",3),l(1),G()),i&2){let t=f();d(),A(" ",t.membershipService.daysRemaining(),"\u5929 ")}}function Xf(i,e){if(i&1&&(O(0,"span"),l(1),Le(2,"date"),G()),i&2){let t,n=f(3);d(),A("\u5230\u671F\u6642\u9593\uFF1A",Fs(2,1,(t=n.membershipService.membership())==null?null:t.expiresAt,"yyyy-MM-dd"))}}function Zf(i,e){i&1&&(O(0,"span",19),l(1,"\u6703\u54E1\u5DF2\u904E\u671F"),G())}function jf(i,e){if(i&1&&(O(0,"div",8),w(1,Xf,3,4,"span")(2,Zf,2,0,"span",19),G()),i&2){let t=f(2);d(),E(t.membershipService.daysRemaining()>0?1:2)}}function e_(i,e){if(i&1){let t=T();O(0,"div",4)(1,"div",5)(2,"span",6),l(3),G(),O(4,"span",7),l(5),G()(),w(6,jf,3,1,"div",8),O(7,"div",9)(8,"div")(9,"div",10)(10,"span"),l(11,"\u4ECA\u65E5\u6D88\u606F"),G(),O(12,"span"),l(13),G()(),O(14,"div",11),Ve(15,"div",12),G()(),O(16,"div")(17,"div",10)(18,"span"),l(19,"\u4ECA\u65E5 AI"),G(),O(20,"span"),l(21),G()(),O(22,"div",11),Ve(23,"div",13),G()()(),O(24,"div",14)(25,"button",15),ge("click",function(){v(t);let o=f();return x(o.openActivate())}),l(26),G(),O(27,"button",16),ge("click",function(){v(t);let o=f();return x(o.showDetails=!1)}),te(),O(28,"svg",17),Ve(29,"path",18),G()()()()}if(i&2){let t=f();d(3),M(t.membershipService.levelIcon()),d(2),M(t.membershipService.levelName()),d(),E(t.membershipService.level()!=="bronze"?6:-1),d(7),Y("",t.usage().todayMessages," / ",t.quotaText("messages")),d(2),j("width",t.usagePercent().messages,"%"),d(6),Y("",t.usage().todayAiCalls," / ",t.quotaText("ai")),d(2),j("width",t.usagePercent().ai,"%"),d(3),A(" ",t.membershipService.level()==="bronze"?"\u6FC0\u6D3B\u6703\u54E1":"\u7E8C\u8CBB/\u5347\u7D1A"," ")}}var t_=(i,e)=>e.level;function n_(i,e){i&1&&(s(0,"div",22),l(1," \u63A8\u85A6 "),a())}function i_(i,e){i&1&&(s(0,"div",23),l(1," \u7576\u524D "),a())}function o_(i,e){i&1&&(s(0,"span",28),l(1,"\u514D\u8CBB"),a())}function r_(i,e){if(i&1&&(s(0,"span",5),l(1),a(),s(2,"span",33),l(3,"/\u6708"),a()),i&2){let t=f().$implicit;d(),A("",t.monthlyPrice," USDT")}}function s_(i,e){if(i&1&&(s(0,"div",29),l(1),a()),i&2){let t=f().$implicit,n=f(3);d(),Y(" \u5E74\u4ED8 ",t.yearlyPrice," USDT (\u7701 ",n.Math.round((1-t.yearlyPrice/(t.monthlyPrice*12))*100),"%) ")}}function a_(i,e){if(i&1&&(s(0,"li",31),te(),s(1,"svg",34),k(2,"path",35),a(),l(3),a()),i&2){let t=e.$implicit;d(3),A(" ",t," ")}}function l_(i,e){if(i&1){let t=T();s(0,"div",21),w(1,n_,2,0,"div",22),w(2,i_,2,0,"div",23),s(3,"div",24)(4,"span",25),l(5),a(),s(6,"h3",26),l(7),a(),s(8,"div",27),w(9,o_,2,0,"span",28)(10,r_,4,1),a(),w(11,s_,2,2,"div",29),a(),s(12,"ul",30),$(13,a_,4,1,"li",31,ke),a(),s(15,"button",32),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.selectPlan(o))}),l(16),a()()}if(i&2){let t=e.$implicit,n=f(3);I("border-cyan-500",t.level===n.membershipService.level())("border-slate-600",t.level!==n.membershipService.level())("bg-slate-700/50",t.level===n.membershipService.level())("bg-slate-800",t.level!==n.membershipService.level()),d(),E(t.recommended?1:-1),d(),E(t.level===n.membershipService.level()?2:-1),d(3),M(t.icon),d(2),M(t.name),d(2),E(t.monthlyPrice===0?9:10),d(2),E(t.yearlyPrice>0?11:-1),d(2),H(t.features),d(2),I("bg-gradient-to-r",t.level!=="bronze")("from-cyan-500",t.level!=="bronze")("to-blue-500",t.level!=="bronze")("text-white",t.level!=="bronze")("bg-slate-700",t.level==="bronze")("text-slate-400",t.level==="bronze"),V("disabled",t.level==="bronze"),d(),A(" ",t.level==="bronze"?"\u7576\u524D\u65B9\u6848":t.level===n.membershipService.level()?"\u7E8C\u8CBB":"\u9078\u64C7"," ")}}function c_(i,e){if(i&1&&(s(0,"div",14),$(1,l_,17,28,"div",15,t_),a(),s(3,"div",16)(4,"h4",17),l(5,"\u{1F4B3} \u8CFC\u8CB7\u65B9\u5F0F"),a(),s(6,"p",18),l(7," \u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6\uFF0C\u6216\u901A\u904E\u5B98\u65B9\u6E20\u9053\u7372\u53D6\u3002\u8CFC\u8CB7\u5F8C\u5728\u300C\u6FC0\u6D3B\u5361\u5BC6\u300D\u6A19\u7C64\u4E2D\u8F38\u5165\u6FC0\u6D3B\u78BC\u3002 "),a(),s(8,"div",19)(9,"a",20),l(10,"\u{1F4F1} \u806F\u7E6B\u5BA2\u670D"),a(),s(11,"a",20),l(12,"\u{1F310} \u5B98\u65B9\u5546\u57CE"),a()()()),i&2){let t=f(2);d(),H(t.plans)}}function d_(i,e){if(i&1){let t=T();s(0,"div",13)(1,"div",36)(2,"div",37),l(3,"\u{1F511}"),a(),s(4,"h3",38),l(5,"\u6FC0\u6D3B\u6703\u54E1\u5361\u5BC6"),a(),s(6,"p",39),l(7,"\u8F38\u5165\u60A8\u8CFC\u8CB7\u7684\u5361\u5BC6\u6FC0\u6D3B\u6703\u54E1"),a()(),s(8,"div",40)(9,"div")(10,"label",41),l(11,"\u5361\u5BC6"),a(),s(12,"input",42),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.licenseKey,o)||(r.licenseKey=o),x(o)}),a()(),s(13,"div")(14,"label",41),l(15,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u901A\u77E5)"),a(),s(16,"input",43),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.email,o)||(r.email=o),x(o)}),a()(),s(17,"button",44),b("click",function(){v(t);let o=f(2);return x(o.activateLicense())}),l(18),a()(),s(19,"div",16)(20,"h4",17),l(21,"\u{1F4CB} \u5361\u5BC6\u683C\u5F0F\u8AAA\u660E"),a(),s(22,"ul",45)(23,"li"),l(24,"\u2022 TGAI-B2-XXXX-XXXX-XXXX (\u{1F948} \u767D\u9280\u6708\u5361)"),a(),s(25,"li"),l(26,"\u2022 TGAI-G2-XXXX-XXXX-XXXX (\u{1F947} \u9EC3\u91D1\u6708\u5361)"),a(),s(27,"li"),l(28,"\u2022 TGAI-D2-XXXX-XXXX-XXXX (\u{1F48E} \u947D\u77F3\u6708\u5361)"),a(),s(29,"li"),l(30,"\u2022 TGAI-S2-XXXX-XXXX-XXXX (\u{1F31F} \u661F\u8000\u6708\u5361)"),a(),s(31,"li"),l(32,"\u2022 TGAI-K2-XXXX-XXXX-XXXX (\u{1F451} \u738B\u8005\u6708\u5361)"),a()()()()}if(i&2){let t=f(2);d(12),K("ngModel",t.licenseKey),d(4),K("ngModel",t.email),d(),V("disabled",t.isActivating()),d(),A(" ",t.isActivating()?"\u6FC0\u6D3B\u4E2D...":"\u6FC0\u6D3B"," ")}}function u_(i,e){if(i&1){let t=T();s(0,"div",13)(1,"div",36)(2,"div",37),l(3,"\u{1F381}"),a(),s(4,"h3",38),l(5,"\u9080\u8ACB\u597D\u53CB\uFF0C\u96D9\u65B9\u7372\u76CA"),a(),s(6,"p",39),l(7,"\u5206\u4EAB\u60A8\u7684\u9080\u8ACB\u78BC\uFF0C\u9080\u8ACB\u597D\u53CB\u8A3B\u518A"),a()(),s(8,"div",46)(9,"div",47)(10,"div",48),l(11,"\u6211\u7684\u9080\u8ACB\u78BC"),a(),s(12,"div",49),l(13),a(),s(14,"button",50),b("click",function(){v(t);let o=f(2);return x(o.copyInviteCode())}),l(15," \u{1F4CB} \u8907\u88FD\u9080\u8ACB\u78BC "),a()()(),s(16,"div",51)(17,"div",52)(18,"div",53),l(19),a(),s(20,"div",54),l(21,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),a()(),s(22,"div",52)(23,"div",28),l(24),a(),s(25,"div",54),l(26,"\u7372\u5F97\u734E\u52F5"),a()()(),s(27,"div",55)(28,"h4",56),l(29,"\u{1F3AF} \u734E\u52F5\u898F\u5247"),a(),s(30,"ul",57)(31,"li",58)(32,"span",59),l(33,"\u2713"),a(),l(34," \u9080\u8ACB 1 \u4EBA\u8A3B\u518A\uFF1A\u60A8\u7372\u5F97 3 \u5929\u6703\u54E1 "),a(),s(35,"li",58)(36,"span",59),l(37,"\u2713"),a(),l(38," \u88AB\u9080\u8ACB\u4EBA\u7372\u5F97\uFF1A1 \u5929\u6703\u54E1\u9AD4\u9A57 "),a(),s(39,"li",58)(40,"span",59),l(41,"\u2713"),a(),l(42," \u88AB\u9080\u8ACB\u4EBA\u9996\u6B21\u4ED8\u8CBB\uFF1A\u7372\u5F97\u8C50\u539A\u734E\u52F5 "),a(),s(43,"li",58)(44,"span",59),l(45,"\u2713"),a(),l(46," \u88AB\u9080\u8ACB\u4EBA\u91CD\u8907\u4ED8\u8CBB\uFF1A10% \u8FD4\u50AD "),a()()(),s(47,"div",60)(48,"h4",17),l(49,"\u{1F39F}\uFE0F \u4F7F\u7528\u9080\u8ACB\u78BC"),a(),s(50,"div",61)(51,"input",62),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.inviteCodeInput,o)||(r.inviteCodeInput=o),x(o)}),a(),s(52,"button",63),b("click",function(){v(t);let o=f(2);return x(o.applyInviteCode())}),l(53," \u4F7F\u7528 "),a()()()()}if(i&2){let t,n,o,r=f(2);d(13),A(" ",(t=r.membershipService.membership())==null?null:t.inviteCode," "),d(6),M(((n=r.membershipService.membership())==null?null:n.inviteCount)||0),d(5),A("",((o=r.membershipService.membership())==null?null:o.inviteRewards)||0,"\u5929"),d(27),K("ngModel",r.inviteCodeInput)}}function m_(i,e){if(i&1){let t=T();s(0,"div",1),b("click",function(){v(t);let o=f();return x(o.close())}),s(1,"div",2),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),l(6,"\u{1F680} \u5347\u7D1A\u60A8\u7684 TG-AI\u667A\u63A7\u738B"),a(),s(7,"p",6),l(8,"\u89E3\u9396\u66F4\u591A\u529F\u80FD\uFF0C\u63D0\u5347\u71DF\u92B7\u6548\u7387"),a()(),s(9,"button",7),b("click",function(){v(t);let o=f();return x(o.close())}),te(),s(10,"svg",8),k(11,"path",9),a()()(),le(),s(12,"div",10)(13,"button",11),b("click",function(){v(t);let o=f();return x(o.activeTab.set("plans"))}),l(14," \u6703\u54E1\u65B9\u6848 "),a(),s(15,"button",11),b("click",function(){v(t);let o=f();return x(o.activeTab.set("activate"))}),l(16," \u6FC0\u6D3B\u5361\u5BC6 "),a(),s(17,"button",11),b("click",function(){v(t);let o=f();return x(o.activeTab.set("invite"))}),l(18," \u9080\u8ACB\u734E\u52F5 "),a()()(),s(19,"div",12),w(20,c_,13,0),w(21,d_,33,4,"div",13),w(22,u_,54,4,"div",13),a()()()}if(i&2){let t=f();d(13),I("text-white",t.activeTab()==="plans")("text-white/60",t.activeTab()!=="plans")("border-white",t.activeTab()==="plans")("border-transparent",t.activeTab()!=="plans"),d(2),I("text-white",t.activeTab()==="activate")("text-white/60",t.activeTab()!=="activate")("border-white",t.activeTab()==="activate")("border-transparent",t.activeTab()!=="activate"),d(2),I("text-white",t.activeTab()==="invite")("text-white/60",t.activeTab()!=="invite")("border-white",t.activeTab()==="invite")("border-transparent",t.activeTab()!=="invite"),d(3),E(t.activeTab()==="plans"?20:-1),d(),E(t.activeTab()==="activate"?21:-1),d(),E(t.activeTab()==="invite"?22:-1)}}function p_(i,e){if(i&1&&(O(0,"li"),l(1),G()),i&2){let t=e.$implicit;d(),A("\u2728 ",t)}}function g_(i,e){if(i&1){let t=T();O(0,"div",0)(1,"button",1),ge("click",function(){v(t);let o=f();return x(o.dismiss())}),te(),O(2,"svg",2),Ve(3,"path",3),G()(),le(),O(4,"div",4)(5,"div",5),l(6,"\u26A1"),G(),O(7,"div",6)(8,"h4",7),l(9),G(),O(10,"p",8),l(11),G(),O(12,"ul",9),$(13,p_,2,1,"li",null,ke),G(),O(15,"button",10),ge("click",function(){v(t);let o=f();return x(o.upgrade())}),l(16),G()()()()}if(i&2){let t=f();d(9),M(t.message),d(2),A(" \u5347\u7D1A\u5230 ",t.nextLevelName," \u7372\u5F97\u66F4\u591A\u914D\u984D "),d(2),H(t.suggestion.benefits.slice(0,3)),d(3),A(" \u7ACB\u5373\u5347\u7D1A ",t.suggestion.price," USDT/\u6708 ")}}var Rc=class i{constructor(){this.membershipService=B(Ue);this.showDetails=!1;this.badgeClass=L(()=>this.membershipService.level());this.usage=L(()=>this.membershipService.usage());this.usagePercent=L(()=>this.membershipService.getUsagePercentage())}quotaText(e){let t=this.membershipService.quotas(),n=e==="messages"?t.dailyMessages:t.dailyAiCalls;return n===-1?"\u221E":n.toString()}openActivate(){this.showDetails=!1,window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-membership-badge"]],decls:7,vars:6,consts:[[1,"membership-badge","flex","items-center","gap-2","px-3","py-1.5","rounded-full","cursor-pointer","hover:opacity-80","transition-opacity",3,"click"],[1,"text-lg"],[1,"text-sm","font-medium"],[1,"text-xs","bg-red-500/50","px-1.5","py-0.5","rounded"],[1,"absolute","top-full","right-0","mt-2","w-72","bg-slate-800","rounded-lg","shadow-xl","border","border-slate-600","p-4","z-50"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-2xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-300","mb-3"],[1,"space-y-2","mb-4"],[1,"flex","justify-between","text-xs","text-slate-400","mb-1"],[1,"w-full","bg-slate-700","rounded-full","h-1.5"],[1,"bg-cyan-500","h-1.5","rounded-full","transition-all"],[1,"bg-purple-500","h-1.5","rounded-full","transition-all"],[1,"flex","gap-2"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","text-sm","py-2","rounded-lg","hover:opacity-90",3,"click"],[1,"px-3","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-red-400"]],template:function(t,n){t&1&&(O(0,"div",0),ge("click",function(){return n.showDetails=!n.showDetails}),O(1,"span",1),l(2),G(),O(3,"span",2),l(4),G(),w(5,Yf,2,1,"span",3),G(),w(6,e_,30,12,"div",4)),t&2&&(he(n.badgeClass()),d(2),M(n.membershipService.levelIcon()),d(2),M(n.membershipService.levelName()),d(),E(n.membershipService.daysRemaining()>0&&n.membershipService.daysRemaining()<=7?5:-1),d(),E(n.showDetails?6:-1))},dependencies:[oe,Bs],styles:["[_nghost-%COMP%]{position:relative;display:inline-block}.membership-badge.bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}.membership-badge.silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,silver,#a8a8a8);color:#1f2937}.membership-badge.gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:#1f2937}.membership-badge.diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b9f2ff,#87ceeb);color:#1f2937}.membership-badge.star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}.membership-badge.king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}"]})}},io=class i{constructor(){this.membershipService=B(Ue);this.toastService=B(me);this.show=C(!1);this.activeTab=C("plans");this.isActivating=C(!1);this.licenseKey="";this.email="";this.inviteCodeInput="";this.plans=this.membershipService.getPricingPlans();this.Math=Math;window.addEventListener("open-membership-dialog",()=>{this.show.set(!0)})}close(){this.show.set(!1)}selectPlan(e){e.level!=="bronze"&&(this.activeTab.set("activate"),this.toastService.info(`\u8ACB\u8CFC\u8CB7 ${e.name} \u5361\u5BC6\u5F8C\u5728\u6B64\u6FC0\u6D3B`))}async activateLicense(){if(!this.licenseKey.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u5361\u5BC6");return}this.isActivating.set(!0);try{let e=await this.membershipService.activateMembership(this.licenseKey.trim(),this.email.trim());e.success?(this.toastService.success(e.message,5e3),this.licenseKey="",this.email="",this.close()):this.toastService.error(e.message)}catch{this.toastService.error("\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isActivating.set(!1)}}copyInviteCode(){let e=this.membershipService.membership()?.inviteCode;e&&(navigator.clipboard.writeText(e),this.toastService.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD"))}async applyInviteCode(){if(!this.inviteCodeInput.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u9080\u8ACB\u78BC");return}let e=await this.membershipService.applyInviteCode(this.inviteCodeInput.trim());e.success?(this.toastService.success(e.message,5e3),this.inviteCodeInput=""):this.toastService.error(e.message)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-membership-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-600","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","gap-4","mt-4"],[1,"font-medium","pb-2","border-b-2","transition-colors",3,"click"],[1,"p-6","overflow-y-auto","max-h-[60vh]"],[1,"max-w-md","mx-auto"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"relative","rounded-xl","border-2","p-4","transition-all",3,"border-cyan-500","border-slate-600","bg-slate-700/50","bg-slate-800"],[1,"mt-6","p-4","bg-slate-700/50","rounded-lg"],[1,"font-medium","text-white","mb-2"],[1,"text-sm","text-slate-300"],[1,"flex","gap-4","mt-3"],["href","#",1,"text-sm","text-cyan-400","hover:underline"],[1,"relative","rounded-xl","border-2","p-4","transition-all"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-xs","px-3","py-1","rounded-full"],[1,"absolute","-top-3","right-2","bg-green-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center","mb-4"],[1,"text-3xl"],[1,"text-lg","font-bold","text-white","mt-2"],[1,"mt-2"],[1,"text-2xl","font-bold","text-green-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"space-y-2","text-sm"],[1,"flex","items-start","gap-2","text-slate-300"],[1,"w-full","mt-4","py-2","rounded-lg","font-medium","transition-colors",3,"click","disabled"],[1,"text-slate-400"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4","text-green-400","mt-0.5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-center","mb-6"],[1,"text-4xl","mb-2"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","mt-1"],[1,"space-y-4"],[1,"block","text-sm","text-slate-300","mb-1"],["type","text","placeholder","TGAI-XX-XXXX-XXXX-XXXX",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none","uppercase","tracking-wider","font-mono",3,"ngModelChange","ngModel"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","font-bold","py-3","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","text-slate-400","space-y-1"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-600/20","rounded-xl","p-6","mb-6"],[1,"text-center"],[1,"text-sm","text-slate-400","mb-2"],[1,"text-3xl","font-mono","font-bold","text-white","tracking-widest","mb-3"],[1,"bg-white/10","hover:bg-white/20","text-white","px-4","py-2","rounded-lg","transition-colors",3,"click"],[1,"grid","grid-cols-2","gap-4","mb-6"],[1,"bg-slate-700/50","rounded-lg","p-4","text-center"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400"],[1,"bg-slate-700/50","rounded-lg","p-4"],[1,"font-medium","text-white","mb-3"],[1,"space-y-2","text-sm","text-slate-300"],[1,"flex","items-center","gap-2"],[1,"text-green-400"],[1,"mt-6","p-4","border","border-dashed","border-slate-600","rounded-lg"],[1,"flex","gap-2"],["type","text","placeholder","\u8F38\u5165\u597D\u53CB\u7684\u9080\u8ACB\u78BC",1,"flex-1","bg-slate-700","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm","uppercase",3,"ngModelChange","ngModel"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","px-4","py-2","rounded-lg","text-sm",3,"click"]],template:function(t,n){t&1&&w(0,m_,23,27,"div",0),t&2&&E(n.show()?0:-1)},dependencies:[oe,ue,xe,fe,_e],encapsulation:2})}},oo=class i{constructor(){this.membershipService=B(Ue);this.show=!1;this.message="";this.suggestion=this.membershipService.getUpgradeSuggestion()}get nextLevelName(){return this.suggestion?.nextLevel?{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.suggestion.nextLevel]:""}showPrompt(e){this.message=e,this.suggestion=this.membershipService.getUpgradeSuggestion(),this.suggestion&&(this.show=!0)}dismiss(){this.show=!1}upgrade(){this.dismiss(),window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-upgrade-prompt"]],decls:1,vars:1,consts:[[1,"fixed","bottom-4","right-4","max-w-sm","bg-gradient-to-r","from-slate-800","to-slate-700","rounded-xl","shadow-2xl","border","border-slate-600","p-4","z-40","animate-slide-up"],[1,"absolute","top-2","right-2","text-slate-500","hover:text-white",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-start","gap-3"],[1,"text-3xl"],[1,"flex-1"],[1,"font-bold","text-white","mb-1"],[1,"text-sm","text-slate-300","mb-3"],[1,"text-xs","text-slate-400","space-y-1","mb-3"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-sm","font-medium","px-4","py-2","rounded-lg","hover:opacity-90",3,"click"]],template:function(t,n){t&1&&w(0,g_,17,3,"div",0),t&2&&E(n.show&&n.suggestion?0:-1)},dependencies:[oe],styles:["@keyframes _ngcontent-%COMP%_slide-up{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.animate-slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-up .3s ease-out}"]})}};var h_=(i,e)=>e.id;function f_(i,e){i&1&&(s(0,"div",21),l(1," \u63A8\u85A6 "),a())}function __(i,e){i&1&&(s(0,"div",22),l(1," \u71B1\u9580 "),a())}function C_(i,e){if(i&1){let t=T();s(0,"div",20),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.selectProduct(o))}),w(1,f_,2,0,"div",21),w(2,__,2,0,"div",22),s(3,"div",23)(4,"div",24),l(5),a(),s(6,"div",25),l(7),a(),s(8,"div",26)(9,"span",27),l(10),a()(),s(11,"div",28),l(12,"TRC20 \u7DB2\u7D61"),a()()()}if(i&2){let t,n,o,r=e.$implicit,c=f(3);I("border-cyan-500",((t=c.selectedProduct())==null?null:t.id)===r.id)("bg-cyan-500/10",((n=c.selectedProduct())==null?null:n.id)===r.id)("border-slate-600",((o=c.selectedProduct())==null?null:o.id)!==r.id),d(),E(r.recommended?1:-1),d(),E(r.popular?2:-1),d(3),M(r.levelName),d(2),M(r.durationName),d(3),A("",r.price," USDT")}}function v_(i,e){if(i&1){let t=T();s(0,"div",15),$(1,C_,13,11,"div",16,h_),a(),s(3,"div",17)(4,"button",18),b("click",function(){v(t);let o=f(2);return x(o.close())}),l(5," \u53D6\u6D88 "),a(),s(6,"button",19),b("click",function(){v(t);let o=f(2);return x(o.proceedToPayment())}),l(7," \u4E0B\u4E00\u6B65 "),a()()}if(i&2){let t=f(2);d(),H(t.products),d(5),V("disabled",!t.selectedProduct())}}function x_(i,e){if(i&1&&(s(0,"div",41)(1,"div",43)(2,"span"),l(3,"\u{1F48E}"),a(),s(4,"span",44),l(5,"USDT-TRC20 \u652F\u4ED8\uFF08\u63A8\u85A6\uFF09"),a()(),s(6,"div",45)(7,"div",46)(8,"div",47),l(9,"\u652F\u4ED8\u91D1\u984D"),a(),s(10,"div",48),l(11),a()(),s(12,"div",46)(13,"div",47),l(14,"\u7DB2\u7D61"),a(),s(15,"div",49),l(16,"TRC20"),a()()(),s(17,"div",50),l(18," \u26A0\uFE0F \u50C5\u652F\u6301 TRC20 \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC "),a()()),i&2){let t,n=f(3);d(11),A("",(t=n.selectedProduct())==null?null:t.price," USDT")}}function b_(i,e){if(i&1){let t=T();s(0,"div",29)(1,"div",30),l(2),a(),s(3,"div",31),l(4),a(),s(5,"div",32),l(6,"TRC20 \u7DB2\u7D61"),a()(),s(7,"div",33)(8,"label",34),l(9,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u8A02\u55AE\u901A\u77E5)"),a(),s(10,"input",35),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.email,o)||(r.email=o),x(o)}),a()(),s(11,"div",36)(12,"label",34),l(13,"\u9078\u64C7\u652F\u4ED8\u65B9\u5F0F"),a(),s(14,"div",37)(15,"button",38),b("click",function(){v(t);let o=f(2);return x(o.paymentMethod.set("alipay"))}),s(16,"span",39),l(17,"\u{1F499}"),a(),s(18,"span",40),l(19,"\u652F\u4ED8\u5BF6"),a()(),s(20,"button",38),b("click",function(){v(t);let o=f(2);return x(o.paymentMethod.set("wechat"))}),s(21,"span",39),l(22,"\u{1F49A}"),a(),s(23,"span",40),l(24,"\u5FAE\u4FE1\u652F\u4ED8"),a()(),s(25,"button",38),b("click",function(){v(t);let o=f(2);return x(o.paymentMethod.set("stripe"))}),s(26,"span",39),l(27,"\u{1F4B3}"),a(),s(28,"span",40),l(29,"\u570B\u969B\u5361"),a()(),s(30,"button",38),b("click",function(){v(t);let o=f(2);return x(o.paymentMethod.set("usdt"))}),s(31,"span",39),l(32,"\u{1F48E}"),a(),s(33,"span",40),l(34,"USDT"),a()()(),w(35,x_,19,1,"div",41),a(),s(36,"div",42)(37,"button",18),b("click",function(){v(t);let o=f(2);return x(o.step.set("select"))}),l(38," \u8FD4\u56DE "),a(),s(39,"button",19),b("click",function(){v(t);let o=f(2);return x(o.createOrder())}),l(40),a()()}if(i&2){let t,n,o=f(2);d(2),Y("",(t=o.selectedProduct())==null?null:t.levelName," - ",(t=o.selectedProduct())==null?null:t.durationName),d(2),A("",(n=o.selectedProduct())==null?null:n.price," USDT"),d(6),K("ngModel",o.email),d(5),I("border-cyan-500",o.paymentMethod()==="alipay")("bg-cyan-500/10",o.paymentMethod()==="alipay")("border-slate-600",o.paymentMethod()!=="alipay"),d(5),I("border-cyan-500",o.paymentMethod()==="wechat")("bg-cyan-500/10",o.paymentMethod()==="wechat")("border-slate-600",o.paymentMethod()!=="wechat"),d(5),I("border-cyan-500",o.paymentMethod()==="stripe")("bg-cyan-500/10",o.paymentMethod()==="stripe")("border-slate-600",o.paymentMethod()!=="stripe"),d(5),I("border-cyan-500",o.paymentMethod()==="usdt")("bg-cyan-500/10",o.paymentMethod()==="usdt")("border-slate-600",o.paymentMethod()!=="usdt"),d(5),E(o.paymentMethod()==="usdt"?35:-1),d(4),V("disabled",o.isProcessing()),d(),A(" ",o.isProcessing()?"\u8655\u7406\u4E2D...":"\u7ACB\u5373\u652F\u4ED8"," ")}}function S_(i,e){if(i&1){let t=T();s(0,"div",57)(1,"div",60)(2,"div",27),l(3),a(),s(4,"div",61),l(5,"TRC20 \u7DB2\u7D61\uFF08TRON\uFF09"),a()(),s(6,"div",33)(7,"div",62),l(8,"\u6536\u6B3E\u5730\u5740\uFF08TRC20\uFF09"),a(),s(9,"div",63)(10,"div",64)(11,"code",65),l(12),a(),s(13,"button",66),b("click",function(){v(t);let o=f(3);return x(o.copyUsdtAddress())}),l(14," \u{1F4CB} \u8907\u88FD "),a()()()(),s(15,"div",67)(16,"div",68)(17,"div",39),l(18,"\u{1F4DD}"),a(),s(19,"div")(20,"div",69),l(21,"\u8F49\u8CEC\u6B65\u9A5F"),a(),s(22,"ol",70)(23,"li"),l(24,"1. \u6253\u958B\u60A8\u7684\u52A0\u5BC6\u8CA8\u5E63\u9322\u5305\uFF08\u5982 Trust Wallet\u3001TokenPocket\uFF09"),a(),s(25,"li"),l(26,"2. \u9078\u64C7 USDT \u8CC7\u7522\uFF0C\u9EDE\u64CA\u300C\u767C\u9001\u300D"),a(),s(27,"li"),l(28,"3. \u7C98\u8CBC\u4E0A\u65B9\u5730\u5740\uFF0C\u9078\u64C7 "),s(29,"span",71),l(30,"TRC20"),a(),l(31," \u7DB2\u7D61"),a(),s(32,"li"),l(33,"4. \u8F38\u5165\u91D1\u984D "),s(34,"span",71),l(35),a()(),s(36,"li"),l(37,"5. \u78BA\u8A8D\u8F49\u8CEC\uFF0C\u7B49\u5F85\u5340\u584A\u78BA\u8A8D"),a()()()()(),s(38,"div",72)(39,"span"),l(40,"\u26A0\uFE0F"),a(),s(41,"div")(42,"strong"),l(43,"\u91CD\u8981\u63D0\u9192\uFF1A"),a(),s(44,"ul",73)(45,"li"),l(46,"\u2022 \u50C5\u652F\u6301 "),s(47,"strong"),l(48,"TRC20"),a(),l(49," \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC"),a(),s(50,"li"),l(51,"\u2022 \u8ACB\u78BA\u4FDD\u8F49\u8CEC\u91D1\u984D\u6B63\u78BA\uFF1A"),s(52,"strong"),l(53),a()(),s(54,"li"),l(55,"\u2022 \u8F49\u8CEC\u5F8C\u901A\u5E38 1-5 \u5206\u9418\u5167\u5230\u8CEC"),a()()()()()}if(i&2){let t,n,o,r=f(3);d(3),A("",(t=r.selectedProduct())==null?null:t.price," USDT"),d(9),M(r.USDT_CONFIG.walletAddress),d(23),A("",(n=r.selectedProduct())==null?null:n.price," USDT"),d(18),A("",(o=r.selectedProduct())==null?null:o.price," USDT")}}function y_(i,e){if(i&1){let t=T();s(0,"div",11)(1,"div",51),l(2),a(),s(3,"h3",52),l(4,"\u7B49\u5F85\u652F\u4ED8"),a(),s(5,"p",53),l(6),a(),s(7,"div",54)(8,"div",55),l(9,"\u8A02\u55AE\u865F"),a(),s(10,"div",56),l(11),a()(),w(12,S_,56,4,"div",57),s(13,"div",58),l(14),a(),s(15,"div",42)(16,"button",18),b("click",function(){v(t);let o=f(2);return x(o.cancelPayment())}),l(17," \u53D6\u6D88\u652F\u4ED8 "),a(),s(18,"button",59),b("click",function(){v(t);let o=f(2);return x(o.checkPaymentStatus())}),l(19),a()()()}if(i&2){let t,n=f(2);d(2),M(n.paymentMethod()==="usdt"?"\u{1F48E}":"\u23F3"),d(4),A(" ",n.paymentMethod()==="usdt"?"\u8ACB\u5411\u4EE5\u4E0B\u5730\u5740\u8F49\u8CEC USDT":"\u8ACB\u5728\u65B0\u7A97\u53E3\u5B8C\u6210\u652F\u4ED8"," "),d(5),M((t=n.currentOrder())==null?null:t.order_id),d(),E(n.paymentMethod()==="usdt"?12:-1),d(2),A(" ",n.paymentMethod()==="usdt"?"\u8F49\u8CEC\u6210\u529F\u5F8C\u9EDE\u64CA\u300C\u6211\u5DF2\u652F\u4ED8\u300D":"\u652F\u4ED8\u5B8C\u6210\u5F8C\u5C07\u81EA\u52D5\u6FC0\u6D3B\u6703\u54E1"," "),d(4),V("disabled",n.isChecking()),d(),A(" ",n.isChecking()?"\u6AA2\u67E5\u4E2D...":"\u6211\u5DF2\u652F\u4ED8"," ")}}function w_(i,e){if(i&1){let t=T();s(0,"div",74)(1,"div",55),l(2,"\u60A8\u7684\u5361\u5BC6"),a(),s(3,"div",56),l(4),a(),s(5,"button",76),b("click",function(){v(t);let o=f(3);return x(o.copyLicenseKey())}),l(6," \u{1F4CB} \u8907\u88FD\u5361\u5BC6 "),a()()}if(i&2){let t=f(3);d(4),M(t.activatedLicenseKey())}}function E_(i,e){if(i&1){let t=T();s(0,"div",11)(1,"div",51),l(2,"\u{1F389}"),a(),s(3,"h3",52),l(4,"\u652F\u4ED8\u6210\u529F\uFF01"),a(),s(5,"p",53),l(6,"\u60A8\u7684\u6703\u54E1\u5DF2\u6FC0\u6D3B"),a(),w(7,w_,7,1,"div",74),s(8,"button",75),b("click",function(){v(t);let o=f(2);return x(o.close())}),l(9," \u958B\u59CB\u4F7F\u7528 "),a()()}if(i&2){let t=f(2);d(7),E(t.activatedLicenseKey()?7:-1)}}function A_(i,e){if(i&1){let t=T();s(0,"div",1),b("click",function(){v(t);let o=f();return x(o.close())}),s(1,"div",2),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),l(6," \u{1F4B3} \u5347\u7D1A\u6703\u54E1 "),a(),s(7,"p",6),l(8,"\u9078\u64C7\u9069\u5408\u60A8\u7684\u65B9\u6848"),a()(),s(9,"button",7),b("click",function(){v(t);let o=f();return x(o.close())}),te(),s(10,"svg",8),k(11,"path",9),a()()()(),le(),s(12,"div",10),w(13,v_,8,1),w(14,b_,41,31),w(15,y_,20,7,"div",11),w(16,E_,10,1,"div",11),s(17,"div",12)(18,"p",13),l(19," \u9047\u5230\u554F\u984C\uFF1F "),s(20,"a",14),l(21,"\u806F\u7E6B\u5BA2\u670D"),a(),l(22," \u6216 "),s(23,"a",14),l(24,"\u67E5\u770B\u5E6B\u52A9"),a()()()()()()}if(i&2){let t=f();d(13),E(t.step()==="select"?13:-1),d(),E(t.step()==="payment"?14:-1),d(),E(t.step()==="pending"?15:-1),d(),E(t.step()==="success"?16:-1)}}var ro=class i{constructor(){this.licenseClient=B(Mt);this.membershipService=B(Ue);this.toastService=B(me);this.show=C(!1);this.step=C("select");this.products=this.licenseClient.products;this.selectedProduct=C(null);this.paymentMethod=C("usdt");this.USDT_CONFIG={network:"TRC20",walletAddress:"TYourTRC20WalletAddressHere",minAmount:1};this.email="";this.isProcessing=C(!1);this.isChecking=C(!1);this.currentOrder=C(null);this.activatedLicenseKey=C(null);this.checkInterval=null;window.addEventListener("open-payment-dialog",()=>{this.open()})}ngOnDestroy(){this.stopCheckInterval()}open(){this.show.set(!0),this.step.set("select"),this.selectedProduct.set(null),this.currentOrder.set(null),this.activatedLicenseKey.set(null)}close(){this.show.set(!1),this.stopCheckInterval()}selectProduct(e){this.selectedProduct.set(e)}proceedToPayment(){this.selectedProduct()&&this.step.set("payment")}async createOrder(){let e=this.selectedProduct();if(e){this.isProcessing.set(!0);try{let t=await this.licenseClient.createPayment(e.id,this.paymentMethod());t.success&&t.order?(this.currentOrder.set(t.order),this.step.set("pending"),window.open(t.order.payment_url,"_blank"),this.startCheckInterval()):this.toastService.error(t.message)}catch{this.toastService.error("\u5275\u5EFA\u8A02\u55AE\u5931\u6557")}finally{this.isProcessing.set(!1)}}}async checkPaymentStatus(){let e=this.currentOrder();if(e){this.isChecking.set(!0);try{let t=await this.licenseClient.checkPaymentStatus(e.orderId);t.paid?(this.stopCheckInterval(),this.activatedLicenseKey.set(t.licenseKey||null),this.step.set("success"),this.toastService.success("\u{1F389} \u652F\u4ED8\u6210\u529F\uFF0C\u6703\u54E1\u5DF2\u6FC0\u6D3B\uFF01"),t.licenseKey&&await this.membershipService.activateMembership(t.licenseKey,this.email)):this.toastService.info("\u652F\u4ED8\u5C1A\u672A\u5B8C\u6210\uFF0C\u8ACB\u7E7C\u7E8C\u652F\u4ED8")}catch{this.toastService.error("\u6AA2\u67E5\u652F\u4ED8\u72C0\u614B\u5931\u6557")}finally{this.isChecking.set(!1)}}}cancelPayment(){this.stopCheckInterval(),this.step.set("select"),this.currentOrder.set(null)}copyLicenseKey(){let e=this.activatedLicenseKey();e&&(navigator.clipboard.writeText(e),this.toastService.success("\u5361\u5BC6\u5DF2\u8907\u88FD"))}copyUsdtAddress(){navigator.clipboard.writeText(this.USDT_CONFIG.walletAddress),this.toastService.success("USDT TRC20 \u5730\u5740\u5DF2\u8907\u88FD")}startCheckInterval(){this.checkInterval=setInterval(()=>{this.checkPaymentStatus()},5e3)}stopCheckInterval(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-payment"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-gradient-to-br","from-slate-900","to-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","via-purple-500","to-pink-500","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-2"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2","rounded-full","hover:bg-white/10",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[70vh]"],[1,"text-center","py-8"],[1,"mt-6","pt-4","border-t","border-slate-700","text-center"],[1,"text-sm","text-slate-500"],["href","#",1,"text-cyan-400","hover:underline"],[1,"grid","grid-cols-2","gap-4"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"border-cyan-500","bg-cyan-500/10","border-slate-600"],[1,"mt-6","flex","gap-4"],[1,"flex-1","py-3","rounded-xl","bg-slate-700","text-slate-300","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"click"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-pink-500","to-purple-500","text-white","text-xs","px-3","py-1","rounded-full","font-medium"],[1,"absolute","-top-3","right-2","bg-orange-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-slate-400"],[1,"mt-2"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-center","mb-6"],[1,"text-lg","text-slate-300"],[1,"text-4xl","font-bold","text-emerald-400","mt-2"],[1,"text-sm","text-slate-500","mt-1"],[1,"mb-4"],[1,"block","text-sm","text-slate-400","mb-2"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"space-y-3","mb-6"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","justify-center","gap-2","p-4","rounded-xl","border-2","transition-all",3,"click"],[1,"text-2xl"],[1,"text-white","font-medium"],[1,"mt-3","p-4","bg-emerald-500/10","border","border-emerald-500/30","rounded-lg"],[1,"flex","gap-4"],[1,"flex","items-center","gap-2","text-emerald-400","text-sm","mb-3"],[1,"font-medium"],[1,"flex","items-center","gap-3","mb-3"],[1,"flex-1","p-2","bg-slate-800","rounded-lg"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-2"],[1,"text-6xl","mb-4"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-4"],[1,"bg-slate-700/50","rounded-xl","p-4","mb-4"],[1,"text-sm","text-slate-400"],[1,"text-lg","font-mono","text-cyan-400"],[1,"bg-emerald-500/10","border","border-emerald-500/30","rounded-xl","p-5","mb-4","text-left"],[1,"text-sm","text-slate-500","mb-6"],[1,"flex-1","py-3","rounded-xl","bg-cyan-500","text-white","font-bold","hover:bg-cyan-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-center","mb-4"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-xs","text-slate-400","mb-2"],[1,"bg-slate-800","rounded-lg","p-3"],[1,"flex","items-center","justify-between","gap-2"],[1,"text-sm","text-emerald-400","break-all","font-mono"],[1,"flex-shrink-0","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","px-3","py-1.5","rounded-lg","text-sm","transition-colors",3,"click"],[1,"bg-slate-800/50","rounded-lg","p-3","mb-4"],[1,"flex","items-start","gap-3"],[1,"text-sm","text-white","font-medium","mb-1"],[1,"text-xs","text-slate-400","space-y-1"],[1,"text-emerald-400","font-medium"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-3","flex","items-start","gap-2"],[1,"mt-1","space-y-0.5"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-500/20","rounded-xl","p-4","mb-6"],[1,"w-full","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity",3,"click"],[1,"mt-2","text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(t,n){t&1&&w(0,A_,25,4,"div",0),t&2&&E(n.show()?0:-1)},dependencies:[oe,ue,xe,fe,_e],encapsulation:2})}};var bs="TG-AI\u667A\u63A7\u738B-2026-Secure-Key",so=class i{constructor(){this._isSecure=C(!0);this.isSecure=this._isSecure.asReadonly();this.initSecurityChecks()}initSecurityChecks(){this.isProduction()&&(this.detectDevTools(),this.preventContextMenu(),this.preventKeyboardShortcuts())}isProduction(){return!window.location.href.includes("localhost")&&!window.location.href.includes("127.0.0.1")}detectDevTools(){setInterval(()=>{let n=window.outerWidth-window.innerWidth>160,o=window.outerHeight-window.innerHeight>160;n||o?(this._isSecure.set(!1),console.clear(),console.log("%c\u26A0\uFE0F \u6AA2\u6E2C\u5230\u958B\u767C\u8005\u5DE5\u5177","color: red; font-size: 20px;")):this._isSecure.set(!0)},1e3),setInterval(()=>{let n=performance.now();performance.now()-n>100&&this._isSecure.set(!1)},5e3)}preventContextMenu(){document.addEventListener("contextmenu",e=>(e.preventDefault(),!1))}preventKeyboardShortcuts(){document.addEventListener("keydown",e=>e.key==="F12"||e.ctrlKey&&e.shiftKey&&e.key==="I"||e.ctrlKey&&e.shiftKey&&e.key==="J"||e.ctrlKey&&e.key==="u"?(e.preventDefault(),!1):!0)}encrypt(e){if(!e)return"";try{let t=btoa(unescape(encodeURIComponent(e)));return"ENC:"+this.shuffle(t,bs)}catch(t){return console.error("Encryption failed:",t),e}}decrypt(e){if(!e)return"";if(!e.startsWith("ENC:"))return e;try{let t=e.substring(4),n=this.unshuffle(t,bs);return decodeURIComponent(escape(atob(n)))}catch(t){return console.error("Decryption failed:",t),""}}shuffle(e,t){let o=t.split("").reduce((r,c)=>r+c.charCodeAt(0),0)%26;return e.split("").map(r=>{let c=r.charCodeAt(0);return c>=65&&c<=90?String.fromCharCode((c-65+o)%26+65):c>=97&&c<=122?String.fromCharCode((c-97+o)%26+97):r}).join("")}unshuffle(e,t){let o=t.split("").reduce((r,c)=>r+c.charCodeAt(0),0)%26;return e.split("").map(r=>{let c=r.charCodeAt(0);return c>=65&&c<=90?String.fromCharCode((c-65-o+26)%26+65):c>=97&&c<=122?String.fromCharCode((c-97-o+26)%26+97):r}).join("")}secureStore(e,t){let n=this.encrypt(JSON.stringify(t));localStorage.setItem(e,n)}secureRetrieve(e,t){let n=localStorage.getItem(e);if(!n)return t;try{let o=this.decrypt(n);return JSON.parse(o)}catch{return t}}secureRemove(e){localStorage.removeItem(e)}storeApiKey(e,t){this.secureStore(`api_${e}`,t)}getApiKey(e){return this.secureRetrieve(`api_${e}`,"")}removeApiKey(e){this.secureRemove(`api_${e}`)}generateFingerprint(){let t=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||"unknown",navigator.deviceMemory||"unknown"].join("|");return this.hashString(t)}hashString(e){let t=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);t=(t<<5)-t+o,t=t&t}return"fp-"+Math.abs(t).toString(16)}signRequest(e,t){let n=JSON.stringify(e)+t+bs;return this.hashString(n)}verifySignature(e,t,n){let o=Date.now();return Math.abs(o-t)>300*1e3?!1:this.signRequest(e,t)===n}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ao=class i{constructor(){this.tasks=C(new Map);this.connectionState=C({stage:"connecting",progress:0,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()});this.showConnectionStatus=C(!0);this.isLoading=L(()=>{let e=this.tasks();for(let t of e.values())if(t.blocking!==!1)return!0;return!1});this.currentTask=L(()=>{let e=this.tasks();if(e.size===0)return null;let t=Array.from(e.values());return t[t.length-1]});this.message=L(()=>this.currentTask()?.message||"");this.progress=L(()=>this.currentTask()?.progress);this.taskCount=L(()=>this.tasks().size);this.connectionProgressTimer=null}start(e="\u8F09\u5165\u4E2D...",t){let n=t||this.generateId();return this.tasks.update(o=>{let r=new Map(o);return r.set(n,{id:n,message:e,startTime:Date.now(),type:"spinner"}),r}),n}startWithProgress(e,t){let n=t||this.generateId();return this.tasks.update(o=>{let r=new Map(o);return r.set(n,{id:n,message:e,progress:0,startTime:Date.now(),type:"progress"}),r}),n}updateProgress(e,t,n){this.tasks.update(o=>{let r=new Map(o),c=r.get(e);return c&&r.set(e,N(F({},c),{progress:Math.min(100,Math.max(0,t)),message:n||c.message})),r})}updateMessage(e,t){this.tasks.update(n=>{let o=new Map(n),r=o.get(e);return r&&o.set(e,N(F({},r),{message:t})),o})}stop(e){this.tasks.update(t=>{let n=new Map(t);return n.delete(e),n})}stopAll(){this.tasks.set(new Map)}async wrap(e,t="\u8F09\u5165\u4E2D..."){let n=this.start(t);try{return await e}finally{this.stop(n)}}async wrapWithProgress(e,t="\u8655\u7406\u4E2D..."){let n=this.startWithProgress(t);try{return await e((r,c)=>{this.updateProgress(n,r,c)})}finally{this.stop(n)}}generateId(){return"load-"+Date.now().toString(36)+Math.random().toString(36).substr(2,5)}startConnection(){this.showConnectionStatus.set(!0),this.connectionState.set({stage:"connecting",progress:5,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()}),this.simulateConnectionProgress()}simulateConnectionProgress(){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=setInterval(()=>{let e=this.connectionState();e.stage==="connecting"&&e.progress<25?this.connectionState.update(t=>N(F({},t),{progress:Math.min(25,t.progress+2)})):e.stage==="loading-data"&&e.progress<75&&this.connectionState.update(t=>N(F({},t),{progress:Math.min(75,t.progress+1)}))},200)}updateConnectionStage(e,t){let n={connecting:10,"loading-data":40,initializing:70,ready:100,error:0};this.connectionState.update(o=>N(F({},o),{stage:e,progress:n[e],message:t||this.getStageMessage(e)})),(e==="ready"||e==="error")&&(this.connectionProgressTimer&&(clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=null),e==="ready"&&setTimeout(()=>{this.showConnectionStatus.set(!1)},500))}connectionError(e){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionState.set({stage:"error",progress:0,message:"\u9023\u63A5\u5931\u6557",startTime:Date.now(),error:e})}hideConnectionStatus(){this.showConnectionStatus.set(!1)}getStageMessage(e){switch(e){case"connecting":return"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...";case"loading-data":return"\u6B63\u5728\u8F09\u5165\u6578\u64DA...";case"initializing":return"\u6B63\u5728\u521D\u59CB\u5316...";case"ready":return"\u9023\u63A5\u6210\u529F";case"error":return"\u9023\u63A5\u5931\u6557"}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var D_="TgMatrixCache",M_=1,Ft="appState",_t="offlineOperations",Nc="2.1.1",T_=1440*60*1e3,lo=class i{constructor(e){this.ngZone=e;this.db=null;this.dbReady=!1;this.networkStatus=C("online");this.isOnline=L(()=>this.networkStatus()!=="offline");this.isPageVisible=C(!0);this.pendingOperations=C([]);this.hasPendingOperations=L(()=>this.pendingOperations().length>0);this.cachedState=C(null);this.isCacheValid=L(()=>{let e=this.cachedState();return!(!e||e.version!==Nc||Date.now()-e.lastUpdated>T_)});this.initDatabase(),this.setupNetworkListener(),this.setupVisibilityListener()}async initDatabase(){return new Promise((e,t)=>{let n=indexedDB.open(D_,M_);n.onerror=()=>{console.error("[OfflineCache] Failed to open IndexedDB:",n.error),t(n.error)},n.onsuccess=()=>{this.db=n.result,this.dbReady=!0,console.log("[OfflineCache] \u2705 IndexedDB initialized"),this.loadCachedState(),this.loadPendingOperations(),e()},n.onupgradeneeded=o=>{let r=o.target.result;r.objectStoreNames.contains(Ft)||(r.createObjectStore(Ft,{keyPath:"id"}),console.log("[OfflineCache] Created state store")),r.objectStoreNames.contains(_t)||(r.createObjectStore(_t,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),console.log("[OfflineCache] Created operations store"))}})}setupNetworkListener(){if(window.addEventListener("online",()=>{this.ngZone.run(()=>{console.log("[OfflineCache] \u{1F310} Network online"),this.networkStatus.set("online"),this.syncPendingOperations()})}),window.addEventListener("offline",()=>{this.ngZone.run(()=>{console.log("[OfflineCache] \u{1F4F4} Network offline"),this.networkStatus.set("offline")})}),this.networkStatus.set(navigator.onLine?"online":"offline"),"connection"in navigator){let e=navigator.connection;e&&e.addEventListener("change",()=>{this.ngZone.run(()=>{let t=e.effectiveType;t==="slow-2g"||t==="2g"?this.networkStatus.set("slow"):navigator.onLine&&this.networkStatus.set("online")})})}}setupVisibilityListener(){document.addEventListener("visibilitychange",()=>{this.ngZone.run(()=>{let e=document.visibilityState==="visible";console.log(`[OfflineCache] \u{1F441}\uFE0F Page visibility: ${e?"visible":"hidden"}`),this.isPageVisible.set(e),e&&this.isOnline()&&window.dispatchEvent(new CustomEvent("page-became-visible"))})})}async cacheState(e){if(!this.dbReady||!this.db){console.warn("[OfflineCache] Database not ready");return}let t={accounts:e.accounts||[],keywordSets:e.keywordSets||[],monitoredGroups:e.monitoredGroups||[],campaigns:e.campaigns||[],leads:e.leads||[],settings:e.settings||{},lastUpdated:Date.now(),version:Nc};try{let o=this.db.transaction([Ft],"readwrite").objectStore(Ft);await new Promise((r,c)=>{let m=o.put(F({id:"main"},t));m.onsuccess=()=>r(),m.onerror=()=>c(m.error)}),this.cachedState.set(t),console.log("[OfflineCache] \u2705 State cached")}catch(n){console.error("[OfflineCache] Failed to cache state:",n)}}async loadCachedState(){if(!this.dbReady||!this.db)return null;try{let n=this.db.transaction([Ft],"readonly").objectStore(Ft),o=await new Promise((r,c)=>{let m=n.get("main");m.onsuccess=()=>r(m.result),m.onerror=()=>c(m.error)});if(o){let e=o,{id:r}=e,c=Rn(e,["id"]);return this.cachedState.set(c),console.log("[OfflineCache] \u2705 Loaded cached state from",new Date(c.lastUpdated).toLocaleString()),c}return null}catch(t){return console.error("[OfflineCache] Failed to load cached state:",t),null}}async addOfflineOperation(e,t){if(!this.dbReady||!this.db){console.warn("[OfflineCache] Database not ready, operation not queued");return}let n={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,command:e,payload:t,timestamp:Date.now(),retryCount:0};try{let r=this.db.transaction([_t],"readwrite").objectStore(_t);await new Promise((c,m)=>{let h=r.put(n);h.onsuccess=()=>c(),h.onerror=()=>m(h.error)}),this.pendingOperations.update(c=>[...c,n]),console.log("[OfflineCache] \u2795 Queued offline operation:",e)}catch(o){console.error("[OfflineCache] Failed to queue operation:",o)}}async loadPendingOperations(){if(!(!this.dbReady||!this.db))try{let t=this.db.transaction([_t],"readonly").objectStore(_t),n=await new Promise((o,r)=>{let c=t.getAll();c.onsuccess=()=>o(c.result||[]),c.onerror=()=>r(c.error)});this.pendingOperations.set(n),n.length>0&&console.log("[OfflineCache] \u{1F4CB} Loaded",n.length,"pending operations")}catch(e){console.error("[OfflineCache] Failed to load pending operations:",e)}}async syncPendingOperations(){let e=this.pendingOperations();e.length!==0&&(console.log("[OfflineCache] \u{1F504} Syncing",e.length,"pending operations"),window.dispatchEvent(new CustomEvent("sync-offline-operations",{detail:{operations:e}})))}async removeOperation(e){if(!(!this.dbReady||!this.db))try{let n=this.db.transaction([_t],"readwrite").objectStore(_t);await new Promise((o,r)=>{let c=n.delete(e);c.onsuccess=()=>o(),c.onerror=()=>r(c.error)}),this.pendingOperations.update(o=>o.filter(r=>r.id!==e)),console.log("[OfflineCache] \u2705 Removed operation:",e)}catch(t){console.error("[OfflineCache] Failed to remove operation:",t)}}async clearCache(){if(!(!this.dbReady||!this.db))try{let e=this.db.transaction([Ft,_t],"readwrite");await Promise.all([new Promise((t,n)=>{let o=e.objectStore(Ft).clear();o.onsuccess=()=>t(),o.onerror=()=>n(o.error)}),new Promise((t,n)=>{let o=e.objectStore(_t).clear();o.onsuccess=()=>t(),o.onerror=()=>n(o.error)})]),this.cachedState.set(null),this.pendingOperations.set([]),console.log("[OfflineCache] \u{1F5D1}\uFE0F Cache cleared")}catch(e){console.error("[OfflineCache] Failed to clear cache:",e)}}getCacheStats(){let e=this.cachedState();return{stateAge:e?Date.now()-e.lastUpdated:-1,pendingCount:this.pendingOperations().length,isValid:this.isCacheValid()}}static{this.\u0275fac=function(t){return new(t||i)(rt(At))}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var co=class i{constructor(e){this.ngZone=e;this.status=C({registered:!1,active:!1,waiting:!1,updateAvailable:!1,version:null});this.cacheStats=C({});this.isSupported="serviceWorker"in navigator;this.registration=null;this.isSupported?this.init():console.log("[SwManager] Service Worker not supported")}async init(){if(location.protocol!=="https:"&&location.hostname!=="localhost"){console.log("[SwManager] Skipping SW registration (not HTTPS)");return}try{navigator.serviceWorker.addEventListener("message",e=>{this.handleSwMessage(e)}),this.registration=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),console.log("[SwManager] \u2705 Service Worker registered"),this.ngZone.run(()=>{this.status.update(e=>N(F({},e),{registered:!0}))}),this.monitorRegistration(),this.checkForUpdates()}catch(e){console.error("[SwManager] Registration failed:",e)}}monitorRegistration(){this.registration&&(this.registration.active&&this.ngZone.run(()=>{this.status.update(e=>N(F({},e),{active:!0}))}),this.registration.waiting&&this.ngZone.run(()=>{this.status.update(e=>N(F({},e),{waiting:!0,updateAvailable:!0}))}),this.registration.addEventListener("updatefound",()=>{console.log("[SwManager] Update found");let e=this.registration.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(console.log("[SwManager] New version available"),this.ngZone.run(()=>{this.status.update(t=>N(F({},t),{updateAvailable:!0,waiting:!0}))}))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[SwManager] Controller changed")}))}handleSwMessage(e){console.log("[SwManager] Message from SW:",e.data),this.ngZone.run(()=>{switch(e.data.type){case"CACHE_STATS":this.cacheStats.set(e.data.stats);break;case"SYNC_OFFLINE_OPERATIONS":window.dispatchEvent(new CustomEvent("sync-offline-operations-from-sw"));break}})}async checkForUpdates(){if(!this.registration)return!1;try{return await this.registration.update(),console.log("[SwManager] Update check complete"),this.status().updateAvailable}catch(e){return console.error("[SwManager] Update check failed:",e),!1}}async applyUpdate(){if(!this.registration?.waiting){console.log("[SwManager] No waiting SW");return}console.log("[SwManager] Applying update..."),this.registration.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()},{once:!0})}async getCacheStats(){return navigator.serviceWorker.controller?new Promise(e=>{let t=new MessageChannel;t.port1.onmessage=n=>{n.data.type==="CACHE_STATS"&&e(n.data.stats)},navigator.serviceWorker.controller.postMessage({type:"GET_CACHE_STATS"},[t.port2]),setTimeout(()=>e({}),3e3)}):{}}async clearCache(){navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),console.log("[SwManager] Cache clear requested"))}async triggerSync(e="sync-offline-operations"){if(this.registration)if("sync"in this.registration)try{await this.registration.sync.register(e),console.log("[SwManager] Background sync registered:",e)}catch(t){console.error("[SwManager] Sync registration failed:",t)}else console.log("[SwManager] Background sync not supported")}async unregister(){if(!this.registration)return!1;try{let e=await this.registration.unregister();return console.log("[SwManager] Unregistered:",e),this.ngZone.run(()=>{this.status.set({registered:!1,active:!1,waiting:!1,updateAvailable:!1,version:null})}),e}catch(e){return console.error("[SwManager] Unregister failed:",e),!1}}static{this.\u0275fac=function(t){return new(t||i)(rt(At))}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var I_=(i,e)=>e.id;function k_(i,e){if(i&1&&Ve(0,"div",22),i&2){let t=f(2);j("left",t.highlightRect().left-8,"px")("top",t.highlightRect().top-8,"px")("width",t.highlightRect().width+16,"px")("height",t.highlightRect().height+16,"px")}}function P_(i,e){if(i&1){let t=T();O(0,"div",23),ge("click",function(){let o=v(t).$index,r=f(2);return x(r.goToStep(o))}),G()}if(i&2){let t=e.$index,n=f(2);I("bg-gradient-to-r",t<=n.currentIndex())("from-cyan-500",t<=n.currentIndex())("to-blue-500",t<=n.currentIndex())("bg-slate-700",t>n.currentIndex())}}function F_(i,e){if(i&1&&(O(0,"li",30)(1,"span",31),l(2,"\u2713"),G(),O(3,"span"),l(4),G()()),i&2){let t=e.$implicit;d(4),M(t)}}function R_(i,e){if(i&1&&(O(0,"div",27)(1,"ul",29),$(2,F_,5,1,"li",30,ke),G()()),i&2){let t=f();d(2),H(t.tips)}}function N_(i,e){if(i&1){let t=T();O(0,"button",32),ge("click",function(){v(t);let o=f(),r=f(2);return x(r.handleAction(o.actionTarget))}),l(1),G()}if(i&2){let t=f();d(),A(" ",t.actionLabel," \u2192 ")}}function B_(i,e){if(i&1&&(O(0,"div",11)(1,"div",24),l(2),G(),O(3,"h2",25),l(4),G(),O(5,"p",26),l(6),G(),w(7,R_,4,0,"div",27),w(8,N_,2,1,"button",28),G()),i&2){let t=e;d(2),A(" ",t.icon," "),d(2),A(" ",t.title," "),d(2),A(" ",t.description," "),d(),E(t.tips&&t.tips.length>0?7:-1),d(),E(t.actionLabel&&t.actionTarget?8:-1)}}function V_(i,e){if(i&1){let t=T();O(0,"button",33),ge("click",function(){v(t);let o=f(2);return x(o.next())}),l(1," \u4E0B\u4E00\u6B65 \u2192 "),G()}}function L_(i,e){if(i&1){let t=T();O(0,"button",34),ge("click",function(){v(t);let o=f(2);return x(o.complete())}),l(1," \u5F00\u59CB\u4F7F\u7528 \u{1F680} "),G()}}function O_(i,e){if(i&1){let t=T();O(0,"div",1),ge("click",function(o){v(t);let r=f();return x(r.onBackdropClick(o))}),Ve(1,"div",2),w(2,k_,1,8,"div",3),O(3,"div",4),ge("click",function(o){return v(t),x(o.stopPropagation())}),O(4,"div",5)(5,"div",6),$(6,P_,1,8,"div",7,I_),G(),O(8,"div",8)(9,"span"),l(10),G(),O(11,"button",9),ge("click",function(){v(t);let o=f();return x(o.skipAll())}),l(12," \u8DF3\u8FC7\u5F15\u5BFC "),G()()(),O(13,"div",10),w(14,B_,9,5,"div",11),G(),O(15,"div",12)(16,"div",13)(17,"label",14)(18,"input",15),ge("change",function(){v(t);let o=f();return x(o.toggleNeverShow())}),G(),O(19,"span"),l(20,"\u4EE5\u540E\u4E0D\u518D\u63D0\u793A"),G()()(),O(21,"div",16)(22,"button",17),ge("click",function(){v(t);let o=f();return x(o.previous())}),l(23," \u2190 \u4E0A\u4E00\u6B65 "),G(),w(24,V_,2,0,"button",18)(25,L_,2,0,"button",19),G()(),O(26,"div",20),l(27," \u6309 "),O(28,"kbd",21),l(29,"\u2190"),G(),O(30,"kbd",21),l(31,"\u2192"),G(),l(32," \u5BFC\u822A \xB7 "),O(33,"kbd",21),l(34,"ESC"),G(),l(35," \u5173\u95ED "),G()()()}if(i&2){let t,n,o=f();d(2),E((t=o.currentStep())!=null&&t.targetSelector&&o.highlightRect()?2:-1),d(4),H(o.steps),d(4),Y("\u6B65\u9AA4 ",o.currentIndex()+1," / ",o.steps.length),d(4),E((n=o.currentStep())?14:-1,n),d(4),xt("checked",o.neverShowAgain()),d(4),xt("disabled",o.currentIndex()===0),d(2),E(o.currentIndex()<o.steps.length-1?24:25)}}function G_(i,e){if(i&1){let t=T();O(0,"div",1),Ve(1,"div",2),O(2,"div",3),Ve(3,"div",4),O(4,"h4",5),l(5),G(),O(6,"p",6),l(7),G(),O(8,"button",7),ge("click",function(){v(t);let o=f();return x(o.dismiss())}),l(9,"\u77E5\u9053\u4E86"),G()()()}if(i&2){let t=f();j("top",t.position.top,"px")("left",t.position.left,"px"),d(5),M(t.title),d(2),M(t.description)}}var Ss="tg-ai-onboarding",cn="tg-ai-onboarding-never-show",uo=class i{constructor(){this.show=C(!1);this.currentIndex=C(0);this.neverShowAgain=C(!1);this.highlightRect=C(null);this.navigateEvent=Ee();this.steps=[{id:"welcome",title:"\u6B22\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B",description:"\u667A\u80FD Telegram \u8425\u9500\u7CFB\u7EDF\uFF0C\u5E2E\u52A9\u60A8\u9AD8\u6548\u83B7\u5BA2\u3001\u81EA\u52A8\u5316\u8FD0\u8425",icon:"\u{1F389}",position:"center",tips:["\u652F\u6301\u591A\u8D26\u53F7\u7BA1\u7406\u548C\u534F\u4F5C","AI \u667A\u80FD\u8425\u9500\u548C\u81EA\u52A8\u56DE\u590D","\u7FA4\u7EC4\u641C\u7D22\u548C\u8D44\u6E90\u7BA1\u7406"]},{id:"add-account",title:"\u7B2C\u4E00\u6B65\uFF1A\u6DFB\u52A0\u8D26\u53F7",description:"\u7ED1\u5B9A\u60A8\u7684 Telegram \u8D26\u53F7\uFF0C\u8FD9\u662F\u4F7F\u7528\u6240\u6709\u529F\u80FD\u7684\u524D\u63D0",icon:"\u{1F4F1}",targetSelector:'[data-tour="accounts"]',position:"right",tips:["\u652F\u6301\u624B\u673A\u53F7\u9A8C\u8BC1\u767B\u5F55","\u53EF\u6DFB\u52A0\u591A\u4E2A\u8D26\u53F7\u540C\u65F6\u8FD0\u8425","\u5EFA\u8BAE\u4F7F\u7528\u72EC\u7ACB\u8425\u9500\u53F7"],actionLabel:"\u53BB\u6DFB\u52A0\u8D26\u53F7",actionTarget:"accounts"},{id:"search-discovery",title:"\u7B2C\u4E8C\u6B65\uFF1A\u641C\u7D22\u53D1\u73B0",description:"\u641C\u7D22\u76EE\u6807\u7FA4\u7EC4\u548C\u9891\u9053\uFF0C\u53D1\u73B0\u6F5C\u5728\u5BA2\u6237\u8D44\u6E90",icon:"\u{1F50D}",targetSelector:'[data-tour="search-discovery"]',position:"right",tips:["\u652F\u6301\u591A\u6E20\u9053\u641C\u7D22\uFF08\u5B98\u65B9/\u4E2D\u6587\u641C\u7D22\uFF09","\u4E00\u952E\u52A0\u5165\u76EE\u6807\u7FA4\u7EC4","\u6536\u85CF\u548C\u7BA1\u7406\u641C\u7D22\u7ED3\u679C"],actionLabel:"\u53BB\u641C\u7D22\u53D1\u73B0",actionTarget:"search-discovery"},{id:"ai-marketing",title:"\u7B2C\u4E09\u6B65\uFF1AAI \u667A\u80FD\u8425\u9500",description:"\u8BA9 AI \u5E2E\u60A8\u5236\u5B9A\u8425\u9500\u7B56\u7565\uFF0C\u81EA\u52A8\u6267\u884C\u8425\u9500\u4EFB\u52A1",icon:"\u{1F916}",targetSelector:'[data-tour="ai-assistant"]',position:"right",tips:["AI \u4E00\u952E\u751F\u6210\u8425\u9500\u7B56\u7565","\u81EA\u52A8\u5316\u6267\u884C\u548C\u8DDF\u8FDB","\u6570\u636E\u5206\u6790\u548C\u6548\u679C\u8FFD\u8E2A"],actionLabel:"\u4F53\u9A8C AI \u8425\u9500",actionTarget:"ai-assistant"},{id:"complete",title:"\u51C6\u5907\u5C31\u7EEA\uFF01",description:"\u60A8\u5DF2\u4E86\u89E3\u6838\u5FC3\u529F\u80FD\uFF0C\u73B0\u5728\u53EF\u4EE5\u5F00\u59CB\u60A8\u7684\u8425\u9500\u4E4B\u65C5\u4E86",icon:"\u{1F680}",position:"center",tips:["\u4EEA\u8868\u76D8\u67E5\u770B\u6574\u4F53\u6570\u636E","\u6709\u95EE\u9898\u968F\u65F6\u70B9\u51FB\u53F3\u4E0A\u89D2 \u2753 \u5E2E\u52A9","\u795D\u60A8\u8425\u9500\u987A\u5229\uFF01"]}];this.currentStep=L(()=>this.steps[this.currentIndex()])}ngOnInit(){this.checkFirstRun(),this.loadNeverShowSetting()}handleKeydown(e){if(this.show())switch(e.key){case"Escape":this.skipAll();break;case"ArrowRight":case"Enter":this.currentIndex()<this.steps.length-1?this.next():this.complete();break;case"ArrowLeft":this.previous();break}}checkFirstRun(){let e=localStorage.getItem(Ss);localStorage.getItem(cn)!=="true"&&(e||setTimeout(()=>this.show.set(!0),800))}loadNeverShowSetting(){let e=localStorage.getItem(cn);this.neverShowAgain.set(e==="true")}toggleNeverShow(){let e=!this.neverShowAgain();this.neverShowAgain.set(e),localStorage.setItem(cn,String(e))}open(){this.currentIndex.set(0),this.show.set(!0),this.updateHighlight()}close(){this.show.set(!1),this.highlightRect.set(null)}next(){this.currentIndex()<this.steps.length-1&&(this.currentIndex.update(e=>e+1),this.updateHighlight())}previous(){this.currentIndex()>0&&(this.currentIndex.update(e=>e-1),this.updateHighlight())}goToStep(e){e>=0&&e<this.steps.length&&(this.currentIndex.set(e),this.updateHighlight())}skipAll(){this.markAsCompleted(),this.close()}complete(){this.markAsCompleted(),this.close()}markAsCompleted(){localStorage.setItem(Ss,new Date().toISOString()),this.neverShowAgain()&&localStorage.setItem(cn,"true")}handleAction(e){this.navigateEvent.emit(e),this.next()}onBackdropClick(e){}updateHighlight(){let e=this.currentStep();e?.targetSelector?setTimeout(()=>{let t=document.querySelector(e.targetSelector);t?(this.highlightRect.set(t.getBoundingClientRect()),t.scrollIntoView({behavior:"smooth",block:"center"})):this.highlightRect.set(null)},100):this.highlightRect.set(null)}reset(){localStorage.removeItem(Ss),localStorage.removeItem(cn),this.neverShowAgain.set(!1),this.currentIndex.set(0)}shouldShowOnboarding(){return localStorage.getItem(cn)!=="true"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-onboarding"]],hostBindings:function(t,n){t&1&&b("keydown",function(r){return n.handleKeydown(r)},As)},outputs:{navigateEvent:"navigateEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center"],[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center",3,"click"],[1,"absolute","inset-0","bg-black/80","backdrop-blur-sm"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none",3,"left","top","width","height"],[1,"relative","w-full","max-w-lg","mx-4","sm:mx-auto","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","rounded-2xl","sm:rounded-3xl","shadow-2xl","border","border-slate-600/50","overflow-hidden",3,"click"],[1,"px-4","sm:px-6","pt-4","sm:pt-5"],[1,"flex","items-center","gap-1.5","sm:gap-2"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"bg-gradient-to-r","from-cyan-500","to-blue-500","bg-slate-700"],[1,"flex","justify-between","items-center","mt-2","text-xs","text-slate-500"],[1,"hover:text-slate-300","transition-colors","px-2","py-1","-mr-2",3,"click"],[1,"p-4","sm:p-6"],[1,"text-center"],[1,"px-4","sm:px-6","pb-4","sm:pb-5"],[1,"flex","items-center","justify-center","mb-4"],[1,"flex","items-center","gap-2","cursor-pointer","text-sm","text-slate-500","hover:text-slate-400","transition-colors"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-cyan-500","focus:ring-cyan-500/50",3,"change","checked"],[1,"flex","justify-between","gap-3"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-slate-700/80","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-40","disabled:cursor-not-allowed","text-sm","sm:text-base",3,"click","disabled"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25"],[1,"hidden","sm:block","px-6","pb-4","text-center","text-xs","text-slate-600"],[1,"px-1.5","py-0.5","bg-slate-700","rounded","text-slate-400"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"click"],[1,"text-5xl","sm:text-6xl","mb-4","sm:mb-5","animate-bounce-slow"],[1,"text-xl","sm:text-2xl","font-bold","text-white","mb-2","sm:mb-3"],[1,"text-slate-300","text-sm","sm:text-base","mb-4","sm:mb-5","max-w-sm","mx-auto","leading-relaxed"],[1,"bg-slate-800/60","rounded-xl","p-3","sm:p-4","mb-4","sm:mb-5","text-left","max-w-sm","mx-auto","border","border-slate-700/50"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25"],[1,"space-y-2"],[1,"flex","items-start","gap-2","text-slate-400","text-sm"],[1,"text-cyan-400","mt-0.5","flex-shrink-0"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25",3,"click"]],template:function(t,n){t&1&&w(0,O_,36,7,"div",0),t&2&&E(n.show()?0:-1)},dependencies:[oe,ue],styles:["@keyframes _ngcontent-%COMP%_bounce-slow{0%,to{transform:translateY(0)}50%{transform:translateY(-8px)}}.animate-bounce-slow[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-slow 2s ease-in-out infinite}"]})}},Bc=class i{constructor(){this.show=C(!1);this.title="";this.description="";this.position={top:0,left:0}}highlight(e,t,n){let o=e.getBoundingClientRect();this.position={top:o.top,left:o.left},this.title=t,this.description=n,this.show.set(!0)}dismiss(){this.show.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-feature-highlight"]],decls:1,vars:1,consts:[[1,"fixed","z-[9998]",3,"top","left"],[1,"fixed","z-[9998]"],[1,"absolute","-inset-2","bg-cyan-500/20","rounded-xl","animate-pulse"],[1,"absolute","top-full","left-1/2","-translate-x-1/2","mt-4","w-64","bg-slate-800","rounded-xl","shadow-xl","border","border-slate-600","p-4","z-10"],[1,"absolute","-top-2","left-1/2","-translate-x-1/2","w-4","h-4","bg-slate-800","border-l","border-t","border-slate-600","rotate-45"],[1,"font-bold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(t,n){t&1&&w(0,G_,10,6,"div",0),t&2&&E(n.show()?0:-1)},dependencies:[oe],encapsulation:2})}};var U_=(i,e)=>e.code;function q_(i,e){if(i&1){let t=T();O(0,"div",7),ge("click",function(){let o=v(t).$implicit,r=f(2);return x(r.selectLocale(o.code))}),O(1,"span",2),l(2),G(),O(3,"span",8),l(4),G()()}if(i&2){let t=e.$implicit,n=f(2);I("active",t.code===n.i18n.locale()),d(2),M(t.flag),d(2),M(t.nativeName)}}function $_(i,e){if(i&1&&(O(0,"div",5),$(1,q_,5,4,"div",6,U_),G()),i&2){let t=f();d(),H(t.locales)}}var mo=class i{constructor(){this.i18n=B(Tt);this.locales=Js;this.isOpen=!1}toggleDropdown(){this.isOpen=!this.isOpen}selectLocale(e){this.i18n.setLocale(e),this.isOpen=!1}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-language-switcher-compact"]],decls:9,vars:5,consts:[[1,"language-switcher"],[1,"current-language",3,"click"],[1,"flag"],[1,"lang-name"],[1,"arrow"],[1,"dropdown"],[1,"option",3,"active"],[1,"option",3,"click"],[1,"name"]],template:function(t,n){t&1&&(O(0,"div",0)(1,"div",1),ge("click",function(){return n.toggleDropdown()}),O(2,"span",2),l(3),G(),O(4,"span",3),l(5),G(),O(6,"span",4),l(7,"\u25BC"),G()(),w(8,$_,3,0,"div",5),G()),t&2&&(d(3),M(n.i18n.currentLocaleInfo().flag),d(2),M(n.i18n.currentLocaleInfo().nativeName),d(),I("open",n.isOpen),d(2),E(n.isOpen?8:-1))},dependencies:[oe],styles:[".language-switcher[_ngcontent-%COMP%]{position:relative;display:inline-block}.current-language[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;cursor:pointer;transition:all .2s ease}.current-language[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.flag[_ngcontent-%COMP%]{font-size:18px}.lang-name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}.arrow[_ngcontent-%COMP%]{font-size:10px;color:var(--text-muted, #888);transition:transform .2s ease}.arrow.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin-top:4px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;overflow:hidden;z-index:100;box-shadow:0 4px 12px #0000004d}.option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 12px;cursor:pointer;transition:background .2s ease}.option[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.option.active[_ngcontent-%COMP%]{background:var(--primary-color, #7c3aed)}.option[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}"]})}};var H_=(i,e)=>e.api_id;function K_(i,e){i&1&&(O(0,"div",5),Ve(1,"span",7),O(2,"span"),l(3,"\u6B63\u5728\u5206\u6790\u6700\u4F73 API..."),G()())}function z_(i,e){if(i&1){let t=T();O(0,"div",8)(1,"div",9),l(2,"\u2B50 \u63A8\u85A6"),G(),O(3,"div",10)(4,"div",11),l(5),G(),O(6,"div",12),l(7),G()(),O(8,"div",13)(9,"div",14),Ve(10,"div",15),G(),O(11,"span",16),l(12),G()(),O(13,"button",17),ge("click",function(){v(t);let o=f(2);return x(o.useRecommended())}),l(14,"\u4F7F\u7528\u6B64 API"),G()(),O(15,"p",18),l(16,"\u{1F4A1} \u6B64 API \u8CA0\u8F09\u6700\u4F4E\uFF0C\u53EF\u7528\u7A7A\u9593\u5145\u8DB3"),G()}if(i&2){let t=f(2);d(5),M(t.safeDisplayName(t.recommendedApi().name,t.recommendedApi().api_id)),d(2),A("ID: ",t.recommendedApi().api_id),d(3),j("width",t.recommendedApi().account_count/t.recommendedApi().max_accounts*100,"%"),d(2),Y("",t.recommendedApi().account_count,"/",t.recommendedApi().max_accounts)}}function W_(i,e){if(i&1){let t=T();O(0,"div",6)(1,"span",19),l(2,"\u{1F4ED}"),G(),O(3,"p"),l(4,"\u66AB\u7121\u53EF\u7528\u7684 API"),G(),O(5,"p",20),l(6,"\u8ACB\u5148\u6DFB\u52A0 API \u5230\u60A8\u7684 API \u6C60"),G(),O(7,"button",21),ge("click",function(){v(t);let o=f(2);return x(o.selectMode("manual"))}),l(8,"\u2795 \u6DFB\u52A0\u65B0 API"),G()()}}function J_(i,e){if(i&1&&(O(0,"div",3),w(1,K_,4,0,"div",5)(2,z_,17,6)(3,W_,9,0,"div",6),G()),i&2){let t=f();d(),E(t.isLoading()?1:t.recommendedApi()?2:3)}}function Q_(i,e){if(i&1){let t=T();O(0,"div",6)(1,"span",19),l(2,"\u{1F4ED}"),G(),O(3,"p"),l(4,"\u60A8\u9084\u6C92\u6709\u6DFB\u52A0\u4EFB\u4F55 API"),G(),O(5,"button",21),ge("click",function(){v(t);let o=f(2);return x(o.selectMode("manual"))}),l(6,"\u2795 \u6DFB\u52A0\u7B2C\u4E00\u500B API"),G()()}}function Y_(i,e){i&1&&(O(0,"span",33),l(1,"\u505C\u7528"),G())}function X_(i,e){i&1&&(O(0,"span",34),l(1,"\u5DF2\u6EFF"),G())}function Z_(i,e){i&1&&(O(0,"span",35),l(1,"\u63A8\u85A6"),G())}function j_(i,e){if(i&1){let t=T();O(0,"div",27),ge("click",function(){let o=v(t).$implicit,r=f(3);return x(r.selectPoolApi(o))}),O(1,"div",28)(2,"span",29),l(3),G(),O(4,"span",30),l(5),G()(),O(6,"div",31)(7,"span",32),l(8),G(),w(9,Y_,2,0,"span",33)(10,X_,2,0,"span",34)(11,Z_,2,0,"span",35),G()()}if(i&2){let t,n=e.$implicit,o=f(3);I("selected",o.selectedPoolApi()===n.api_id)("disabled",!n.is_active||n.account_count>=n.max_accounts),d(3),M(o.safeDisplayName(n.name,n.api_id)),d(2),A("ID: ",n.api_id),d(2),I("warning",n.account_count>=n.max_accounts*.8)("full",n.account_count>=n.max_accounts),d(),Y(" ",n.account_count,"/",n.max_accounts," "),d(),E(n.is_active?n.account_count>=n.max_accounts?10:((t=o.recommendedApi())==null?null:t.api_id)===n.api_id?11:-1:9)}}function e1(i,e){if(i&1){let t=T();O(0,"button",36),ge("click",function(){v(t);let o=f(3);return x(o.confirmPoolSelection())}),l(1,"\u78BA\u8A8D\u9078\u64C7"),G()}}function t1(i,e){if(i&1){let t=T();O(0,"div",22),$(1,j_,12,13,"div",23,H_),G(),w(3,e1,2,0,"button",24),O(4,"div",25)(5,"button",26),ge("click",function(){v(t);let o=f(2);return x(o.selectMode("manual"))}),l(6,"\u2795 \u6DFB\u52A0\u65B0 API"),G()()}if(i&2){let t=f(2);d(),H(t.apiList()),d(2),E(t.selectedPoolApi()?3:-1)}}function n1(i,e){if(i&1&&(O(0,"div",3),w(1,Q_,7,0,"div",6)(2,t1,7,1),G()),i&2){let t=f();d(),E(t.apiList().length===0?1:2)}}function i1(i,e){if(i&1){let t=T();O(0,"div",37)(1,"label"),l(2,"API \u540D\u7A31\uFF08\u53EF\u9078\uFF09"),G(),O(3,"input",47),ge("input",function(o){v(t);let r=f(2);return x(r.manualApiName.set(o.target.value))}),G()()}if(i&2){let t=f(2);d(3),xt("value",t.manualApiName())}}function o1(i,e){if(i&1){let t=T();O(0,"div",3)(1,"div",37)(2,"label"),l(3,"API ID "),O(4,"span",38),l(5,"*"),G()(),O(6,"input",39),ge("input",function(o){v(t);let r=f();return x(r.manualApiId.set(o.target.value))}),G()(),O(7,"div",37)(8,"label"),l(9,"API Hash "),O(10,"span",38),l(11,"*"),G()(),O(12,"input",40),ge("input",function(o){v(t);let r=f();return x(r.manualApiHash.set(o.target.value))}),G()(),O(13,"div",41)(14,"input",42),ge("change",function(o){v(t);let r=f();return x(r.saveToPool.set(o.target.checked))}),G(),O(15,"label",43),l(16,"\u4FDD\u5B58\u5230\u6211\u7684 API \u6C60\uFF08\u65B9\u4FBF\u4E0B\u6B21\u4F7F\u7528\uFF09"),G()(),w(17,i1,4,1,"div",37),O(18,"button",44),ge("click",function(){v(t);let o=f();return x(o.confirmManualInput())}),l(19," \u78BA\u8A8D\u4F7F\u7528 "),G(),O(20,"div",45)(21,"span"),l(22,"\u{1F449}"),G(),O(23,"a",46),l(24,"\u524D\u5F80\u7533\u8ACB API \u6191\u64DA"),G()()()}if(i&2){let t=f();d(6),xt("value",t.manualApiId()),d(6),xt("value",t.manualApiHash()),d(2),xt("checked",t.saveToPool()),d(3),E(t.saveToPool()?17:-1),d(),xt("disabled",!t.isManualValid())}}function r1(i,e){if(i&1){let t=T();O(0,"div",4)(1,"div",48)(2,"span",49),l(3,"\u5DF2\u9078\u64C7\uFF1A"),G(),O(4,"span",50),l(5),G(),O(6,"span",51),l(7),G()(),O(8,"button",52),ge("click",function(){v(t);let o=f();return x(o.clearSelection())}),l(9,"\u2715"),G()()}if(i&2){let t=f();d(5),M(t.safeDisplayName(t.selectedApi().name,t.selectedApi().api_id)),d(2),A("ID: ",t.selectedApi().api_id)}}var dn=class i{constructor(){this.ipcService=B(De);this.toast=B(me);this.membershipService=B(Ue);this.showSelected=!0;this.apiSelected=new vt;this.selectionCleared=new vt;this.currentMode=C("recommend");this.isLoading=C(!1);this.apiList=C([]);this.selectedApi=C(null);this.recommendedApi=C(null);this.selectedPoolApi=C(null);this.manualApiId=C("");this.manualApiHash=C("");this.manualApiName=C("");this.saveToPool=C(!0);this.ipcChannels=[];this.isManualValid=L(()=>{let e=this.manualApiId(),t=this.manualApiHash();return e&&/^\d+$/.test(e)&&t&&/^[a-f0-9]{32}$/i.test(t)})}safeDisplayName(e,t){return e?/[\uFFFD\u0000-\u001F]/.test(e)||e.includes("\uFFFD")||/[\uE000-\uF8FF]/.test(e)||(e.match(/[\u4E00-\u9FFF]/g)?.length||0)===0&&/[^\x00-\x7F]/.test(e)&&e.length<10?`API ${t}`:e.replace(/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\w\s\-_@#$%&*()+=\[\]{}|;:'",.<>?/\\]/g,"").length>e.length*.3?`API ${t}`:e:`API ${t}`}ngOnInit(){this.setupIpcListeners(),this.loadApiList()}ngOnDestroy(){this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("api-credentials-updated",e=>{if(this.isLoading.set(!1),e.credentials){let t=e.credentials.filter(n=>!n.is_public&&n.is_active);this.apiList.set(t),this.findBestApi(t)}}),this.ipcChannels.push("api-credentials-updated"),this.ipcService.on("api-credential-added",e=>{e.success?(this.toast.success("\u2705 API \u6191\u64DA\u5DF2\u4FDD\u5B58\u5230 API \u6C60"),this.loadApiList()):this.toast.error(`\u4FDD\u5B58\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcChannels.push("api-credential-added")}loadApiList(){this.isLoading.set(!0),this.ipcService.send("get-api-credentials",{})}findBestApi(e){let t=e.filter(n=>n.is_active&&n.account_count<n.max_accounts);t.length>0?(t.sort((n,o)=>n.account_count/n.max_accounts-o.account_count/o.max_accounts),this.recommendedApi.set(t[0])):this.recommendedApi.set(null)}selectMode(e){this.currentMode.set(e)}useRecommended(){let e=this.recommendedApi();if(e&&e.api_hash){let t=this.safeDisplayName(e.name,e.api_id),n={api_id:e.api_id,api_hash:e.api_hash,name:t,source:"pool"};this.selectedApi.set(n),this.apiSelected.emit(n),this.toast.success(`\u5DF2\u9078\u64C7 ${t}`)}else e&&this.toast.error("\u6B64 API \u7F3A\u5C11 Hash\uFF0C\u8ACB\u91CD\u65B0\u6DFB\u52A0")}selectPoolApi(e){!e.is_active||e.account_count>=e.max_accounts||this.selectedPoolApi.set(e.api_id)}confirmPoolSelection(){let e=this.selectedPoolApi(),t=this.apiList().find(n=>n.api_id===e);if(t&&t.api_hash){let n=this.safeDisplayName(t.name,t.api_id),o={api_id:t.api_id,api_hash:t.api_hash,name:n,source:"pool"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success(`\u5DF2\u9078\u64C7 ${n}`)}}confirmManualInput(){if(!this.isManualValid())return;let e=this.manualApiId(),t=this.manualApiHash(),n=this.manualApiName()||`API ${e}`;this.saveToPool()&&this.ipcService.send("add-api-credential",{api_id:e,api_hash:t,name:n,source:"manual"});let o={api_id:e,api_hash:t,name:n,source:"manual"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success("API \u5DF2\u78BA\u8A8D")}clearSelection(){this.selectedApi.set(null),this.selectedPoolApi.set(null),this.manualApiId.set(""),this.manualApiHash.set(""),this.manualApiName.set(""),this.selectionCleared.emit()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-api-selector"]],inputs:{showSelected:"showSelected"},outputs:{apiSelected:"apiSelected",selectionCleared:"selectionCleared"},decls:12,vars:10,consts:[[1,"api-selector"],[1,"mode-tabs"],[1,"mode-tab",3,"click"],[1,"mode-content"],[1,"selected-display"],[1,"loading-state"],[1,"empty-state"],[1,"spinner"],[1,"recommended-card"],[1,"recommend-badge"],[1,"api-info"],[1,"api-name"],[1,"api-id"],[1,"api-quota"],[1,"quota-bar"],[1,"quota-fill"],[1,"quota-text"],[1,"use-btn",3,"click"],[1,"recommend-reason"],[1,"empty-icon"],[1,"hint"],[1,"add-btn",3,"click"],[1,"api-list"],[1,"api-item",3,"selected","disabled"],[1,"confirm-btn"],[1,"pool-footer"],[1,"add-more-btn",3,"click"],[1,"api-item",3,"click"],[1,"api-item-info"],[1,"api-item-name"],[1,"api-item-id"],[1,"api-item-right"],[1,"quota-badge"],[1,"status-badge","inactive"],[1,"status-badge","full"],[1,"status-badge","recommend"],[1,"confirm-btn",3,"click"],[1,"form-group"],[1,"required"],["type","text","placeholder","\u4F8B\u5982\uFF1A12345678",1,"form-input",3,"input","value"],["type","text","placeholder","\u4F8B\u5982\uFF1Aa1b2c3d4e5f6g7h8...",1,"form-input",3,"input","value"],[1,"save-option"],["type","checkbox","id","saveToPool",3,"change","checked"],["for","saveToPool"],[1,"confirm-btn",3,"click","disabled"],[1,"guide-link"],["href","https://my.telegram.org","target","_blank"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u4E3B\u529B API",1,"form-input",3,"input","value"],[1,"selected-info"],[1,"selected-label"],[1,"selected-name"],[1,"selected-id"],[1,"clear-btn",3,"click"]],template:function(t,n){t&1&&(O(0,"div",0)(1,"div",1)(2,"button",2),ge("click",function(){return n.selectMode("recommend")}),l(3," \u{1F3AF} \u667A\u80FD\u63A8\u85A6 "),G(),O(4,"button",2),ge("click",function(){return n.selectMode("pool")}),l(5," \u{1F4CB} \u6211\u7684 API "),G(),O(6,"button",2),ge("click",function(){return n.selectMode("manual")}),l(7," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),G()(),w(8,J_,4,1,"div",3),w(9,n1,3,1,"div",3),w(10,o1,25,5,"div",3),w(11,r1,10,2,"div",4),G()),t&2&&(d(2),I("active",n.currentMode()==="recommend"),d(2),I("active",n.currentMode()==="pool"),d(2),I("active",n.currentMode()==="manual"),d(2),E(n.currentMode()==="recommend"?8:-1),d(),E(n.currentMode()==="pool"?9:-1),d(),E(n.currentMode()==="manual"?10:-1),d(),E(n.selectedApi()&&n.showSelected?11:-1))},dependencies:[oe,ue],styles:[".api-selector[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;overflow:hidden}.mode-tabs[_ngcontent-%COMP%]{display:flex;background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.25rem}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.625rem .5rem;background:transparent;border:none;border-radius:.5rem;color:var(--text-muted, #94a3b8);font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s}.mode-tab[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.mode-tab.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.mode-content[_ngcontent-%COMP%]{padding:1rem}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:2rem;color:var(--text-muted, #94a3b8)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:1.5rem}.empty-icon[_ngcontent-%COMP%]{font-size:2rem;display:block;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-secondary, #cbd5e1)}.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);margin-bottom:1rem}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);border:none;border-radius:.5rem;color:#fff;font-size:.8rem;cursor:pointer}.recommended-card[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid var(--primary, #06b6d4);border-radius:.75rem;padding:1rem;position:relative}.recommend-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;right:12px;padding:.25rem .75rem;background:var(--primary, #06b6d4);border-radius:1rem;font-size:.7rem;color:#fff;font-weight:600}.api-info[_ngcontent-%COMP%]{margin-bottom:.75rem}.api-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white);font-size:1rem}.api-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-quota[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.quota-bar[_ngcontent-%COMP%]{flex:1;height:6px;background:#ffffff1a;border-radius:3px;overflow:hidden}.quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#22c55e,#06b6d4);border-radius:3px}.quota-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #cbd5e1);min-width:40px}.use-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.recommend-reason[_ngcontent-%COMP%]{margin:.75rem 0 0;font-size:.75rem;color:var(--text-muted, #94a3b8);text-align:center}.api-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto}.api-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.api-item[_ngcontent-%COMP%]:hover:not(.disabled){border-color:var(--primary, #06b6d4)}.api-item.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.api-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.api-item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.api-item-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white);font-size:.875rem}.api-item-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.api-item-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.quota-badge[_ngcontent-%COMP%]{padding:.125rem .5rem;background:#22c55e33;border-radius:.25rem;font-size:.7rem;color:#86efac}.quota-badge.warning[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.quota-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.status-badge[_ngcontent-%COMP%]{padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}.status-badge.recommend[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.status-badge.inactive[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.status-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.confirm-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;margin-top:.75rem}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.pool-footer[_ngcontent-%COMP%]{margin-top:.75rem;text-align:center}.add-more-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);font-size:.8rem;cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:.75rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.required[_ngcontent-%COMP%]{color:#ef4444}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;box-sizing:border-box}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.save-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.save-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.guide-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.25rem;margin-top:.75rem;font-size:.75rem}.guide-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.selected-display[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:#22c55e1a;border-top:1px solid rgba(34,197,94,.2)}.selected-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.selected-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.selected-name[_ngcontent-%COMP%]{font-weight:500;color:#86efac}.selected-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:1rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:var(--primary, #06b6d4);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};function s1(i,e){i&1&&(k(0,"span",21),l(1," \u751F\u6210\u4E2D... "))}function a1(i,e){i&1&&l(0," \u{1F4F7} \u751F\u6210\u4E8C\u7DAD\u78BC ")}function l1(i,e){if(i&1){let t=T();s(0,"div",6)(1,"div",7)(2,"p"),l(3,"\u4F7F\u7528 Telegram App \u6383\u63CF\u4E8C\u7DAD\u78BC\uFF0C\u5FEB\u901F\u6DFB\u52A0\u5E33\u865F\u3002"),a()(),s(4,"div",8)(5,"label",9),l(6,"\u{1F510} \u9078\u64C7 API \u6191\u64DA"),a(),s(7,"app-api-selector",10),b("apiSelected",function(o){v(t);let r=f();return x(r.onApiSelected(o))})("selectionCleared",function(){v(t);let o=f();return x(o.onApiCleared())}),a()(),s(8,"div",8)(9,"label",9),l(10,"\u{1F4F2} \u8A2D\u5099\u6A21\u64EC"),a(),s(11,"div",11)(12,"button",12),b("click",function(){v(t);let o=f();return x(o.deviceType.set("random"))}),l(13," \u{1F3B2} \u667A\u80FD\u96A8\u6A5F "),a(),s(14,"button",12),b("click",function(){v(t);let o=f();return x(o.deviceType.set("ios"))}),l(15," \u{1F4F1} iOS "),a(),s(16,"button",12),b("click",function(){v(t);let o=f();return x(o.deviceType.set("android"))}),l(17," \u{1F916} Android "),a(),s(18,"button",12),b("click",function(){v(t);let o=f();return x(o.deviceType.set("desktop"))}),l(19," \u{1F4BB} Desktop "),a()()(),s(20,"div",8)(21,"label",9),l(22,"\u{1F310} \u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),a(),s(23,"div",13)(24,"input",14),W("ngModelChange",function(o){v(t);let r=f();return z(r.proxyInput,o)||(r.proxyInput=o),x(o)}),a(),s(25,"button",15),b("click",function(){v(t);let o=f();return x(o.selectRandomProxy())}),l(26," \u{1F3B2} "),a()(),s(27,"div",16)(28,"input",17),W("ngModelChange",function(o){v(t);let r=f();return z(r.bindProxyToAccount,o)||(r.bindProxyToAccount=o),x(o)}),a(),s(29,"label",18),l(30,"\u70BA\u6B64\u5E33\u865F\u7D81\u5B9A\u6B64\u4EE3\u7406 IP\uFF08\u63A8\u85A6\uFF09"),a()()(),s(31,"div",8)(32,"label",9),l(33,"\u{1F510} \u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09"),a(),s(34,"input",19),W("ngModelChange",function(o){v(t);let r=f();return z(r.twoFactorPassword,o)||(r.twoFactorPassword=o),x(o)}),a()(),s(35,"button",20),b("click",function(){v(t);let o=f();return x(o.createQRLogin())}),w(36,s1,2,0)(37,a1,1,0),a()()}if(i&2){let t=f();d(7),V("showSelected",!1),d(5),I("active",t.deviceType()==="random"),d(2),I("active",t.deviceType()==="ios"),d(2),I("active",t.deviceType()==="android"),d(2),I("active",t.deviceType()==="desktop"),d(6),K("ngModel",t.proxyInput),d(4),K("ngModel",t.bindProxyToAccount),d(6),K("ngModel",t.twoFactorPassword),d(),V("disabled",t.isCreating()||!t.selectedApi()),d(),E(t.isCreating()?36:37)}}function c1(i,e){if(i&1&&k(0,"img",28),i&2){let t=f(3);V("src","data:image/png;base64,"+t.session().qrImageBase64,Bt)}}function d1(i,e){i&1&&(s(0,"div",29),k(1,"span",36),a())}function u1(i,e){if(i&1&&(s(0,"div",27),w(1,c1,1,1,"img",28)(2,d1,2,0,"div",29),a(),s(3,"div",30)(4,"div",31),l(5),a(),s(6,"p",32),l(7," 1. \u6253\u958B Telegram App"),k(8,"br"),l(9," 2. \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC"),k(10,"br"),l(11," 3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u767B\u5165 "),a()(),s(12,"div",33)(13,"span",34),l(14,"\u6A21\u64EC\u8A2D\u5099:"),a(),s(15,"span",35),l(16),a()()),i&2){let t,n=f(2);d(),E(n.session().qrImageBase64?1:2),d(3),I("warning",n.countdown()<=10),d(),A(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A",n.countdown()," \u79D2 "),d(11),Y("",(t=n.session().deviceInfo)==null?null:t.model," (",(t=n.session().deviceInfo)==null?null:t.system,")")}}function m1(i,e){i&1&&(k(0,"span",21),l(1," \u9A57\u8B49\u4E2D... "))}function p1(i,e){i&1&&l(0," \u78BA\u8A8D ")}function g1(i,e){if(i&1){let t=T();s(0,"div",23)(1,"div",37),l(2,"\u{1F510}"),a(),s(3,"h4"),l(4,"\u9700\u8981\u4E8C\u6B65\u9A57\u8B49"),a(),s(5,"p"),l(6,"\u8ACB\u8F38\u5165\u60A8\u7684\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF1A"),a(),s(7,"input",38),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.twoFactorInput,o)||(r.twoFactorInput=o),x(o)}),b("keyup.enter",function(){v(t);let o=f(2);return x(o.submit2FA())}),a(),s(8,"button",39),b("click",function(){v(t);let o=f(2);return x(o.submit2FA())}),w(9,m1,2,0)(10,p1,1,0),a()()}if(i&2){let t=f(2);d(7),K("ngModel",t.twoFactorInput),d(),V("disabled",!t.twoFactorInput||t.isSubmitting2FA()),d(),E(t.isSubmitting2FA()?9:10)}}function h1(i,e){if(i&1&&l(0),i&2){let t=f(4);A(" ",t.session().userInfo.lastName," ")}}function f1(i,e){if(i&1&&(s(0,"div",48),l(1),a()),i&2){let t=f(4);d(),M("@"+t.session().userInfo.username)}}function _1(i,e){if(i&1&&(s(0,"div",41)(1,"div",44),l(2),a(),s(3,"div",45)(4,"div",46),l(5),w(6,h1,1,1),a(),s(7,"div",47),l(8),a(),w(9,f1,2,1,"div",48),a()()),i&2){let t=f(3);d(2),A(" ",(t.session().userInfo.firstName||"?").charAt(0).toUpperCase()," "),d(3),A(" ",t.session().userInfo.firstName," "),d(),E(t.session().userInfo.lastName?6:-1),d(2),M(t.session().phone),d(),E(t.session().userInfo.username?9:-1)}}function C1(i,e){if(i&1){let t=T();s(0,"div",24)(1,"div",40),l(2,"\u2705"),a(),s(3,"h4"),l(4,"\u767B\u5165\u6210\u529F\uFF01"),a(),w(5,_1,10,5,"div",41),s(6,"p",42),l(7,"\u5E33\u865F\u5DF2\u6210\u529F\u6DFB\u52A0\uFF0C\u6B63\u5728\u5F8C\u53F0\u5347\u7D1A\u70BA\u539F\u751F API..."),a(),s(8,"button",43),b("click",function(){v(t);let o=f(2);return x(o.onClose())}),l(9,"\u5B8C\u6210"),a()()}if(i&2){let t=f(2);d(5),E(t.session().userInfo?5:-1)}}function v1(i,e){if(i&1){let t=T();s(0,"div",25)(1,"div",37),l(2,"\u23F0"),a(),s(3,"h4"),l(4,"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"),a(),s(5,"p"),l(6,"\u8ACB\u9EDE\u64CA\u4E0B\u65B9\u6309\u9215\u91CD\u65B0\u751F\u6210\u3002"),a(),s(7,"button",49),b("click",function(){v(t);let o=f(2);return x(o.refreshQR())}),l(8,"\u{1F504} \u91CD\u65B0\u751F\u6210"),a()()}}function x1(i,e){if(i&1){let t=T();s(0,"div",25)(1,"div",50),l(2,"\u274C"),a(),s(3,"h4"),l(4,"\u767B\u5165\u5931\u6557"),a(),s(5,"p"),l(6),a(),s(7,"button",49),b("click",function(){v(t);let o=f(2);return x(o.refreshQR())}),l(8,"\u{1F504} \u91CD\u8A66"),a()()}if(i&2){let t=f(2);d(6),M(t.session().message||"\u672A\u77E5\u932F\u8AA4")}}function b1(i,e){if(i&1){let t=T();s(0,"div",26)(1,"button",51),b("click",function(){v(t);let o=f(2);return x(o.refreshQR())}),l(2," \u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC "),a(),s(3,"button",52),b("click",function(){v(t);let o=f(2);return x(o.cancelLogin())}),l(4," \u274C \u53D6\u6D88 "),a()()}}function S1(i,e){if(i&1&&(s(0,"div",22),w(1,u1,17,6)(2,g1,11,3,"div",23)(3,C1,10,1,"div",24)(4,v1,9,0,"div",25)(5,x1,9,1,"div",25),a(),w(6,b1,5,0,"div",26)),i&2){let t,n=f();d(),E((t=n.session().status)==="pending"?1:t==="waiting_2fa"?2:t==="success"?3:t==="expired"?4:t==="error"?5:-1),d(5),E(n.session().status==="pending"?6:-1)}}var po=class i{constructor(){this.ipcService=B(De);this.toast=B(me);this.i18n=B(Tt);this.closed=new vt;this.loginSuccess=new vt;this.session=C(null);this.isCreating=C(!1);this.isSubmitting2FA=C(!1);this.countdown=C(60);this.deviceType=C("random");this.proxyInput="";this.twoFactorPassword="";this.twoFactorInput="";this.bindProxyToAccount=!0;this.selectedApi=C(null);this.countdownTimer=null;this.statusCheckTimer=null;this.createTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}onApiSelected(e){this.selectedApi.set(e)}onApiCleared(){this.selectedApi.set(null)}ngOnDestroy(){this.clearTimers(),this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.ipcChannels.forEach(e=>{this.ipcService.cleanup(e)}),this.ipcChannels=[]}setupIpcListeners(){this.ipcService.on("qr-login-created",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),console.log("[QR Login] QR code created successfully",e),e.success!==!1&&(this.session.set({sessionId:e.sessionId,qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,expiresIn:e.expiresIn,status:"pending",deviceInfo:e.deviceInfo,message:e.message}),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-created"),this.ipcService.on("qr-login-status",e=>{let t=this.session();t&&e.sessionId===t.sessionId&&this.session.set(N(F({},t),{status:e.status,message:e.message}))}),this.ipcChannels.push("qr-login-status"),this.ipcService.on("qr-login-success",e=>{this.clearTimers();let t=this.session();t&&this.session.set(N(F({},t),{status:"success",phone:e.phone,userInfo:e.userInfo,message:e.message})),this.toast.success(e.message||"\u767B\u5165\u6210\u529F\uFF01"),this.loginSuccess.emit(e)}),this.ipcChannels.push("qr-login-success"),this.ipcService.on("qr-login-refreshed",e=>{let t=this.session();t&&e.success!==!1&&(this.session.set(N(F({},t),{qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,status:"pending"})),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-refreshed"),this.ipcService.on("qr-login-error",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),this.isSubmitting2FA.set(!1),console.error("[QR Login] Error:",e.error);let t=this.session();t&&this.session.set(N(F({},t),{status:"error",message:e.error})),this.toast.error(e.error||"\u64CD\u4F5C\u5931\u6557")}),this.ipcChannels.push("qr-login-error"),this.ipcService.on("qr-login-2fa-success",e=>{this.isSubmitting2FA.set(!1)}),this.ipcChannels.push("qr-login-2fa-success")}createQRLogin(){let e=this.selectedApi();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API \u6191\u64DA");return}this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!0);let t={proxy:this.proxyInput||null,deviceType:this.deviceType()==="random"?null:this.deviceType(),twoFactorPassword:this.twoFactorPassword||null,bindProxy:this.bindProxyToAccount,customApiId:e.api_id,customApiHash:e.api_hash};console.log("[QR Login] Creating QR login...",N(F({},t),{customApiHash:"***"})),this.createTimeout=setTimeout(()=>{this.isCreating()&&(console.error("[QR Login] Timeout waiting for QR code generation (60s)"),this.isCreating.set(!1),this.toast.error(`\u751F\u6210\u4E8C\u7DAD\u78BC\u8D85\u6642\uFF0860\u79D2\uFF09\uFF0C\u8ACB\u6AA2\u67E5\uFF1A
1. \u5F8C\u7AEF\u65E5\u8A8C\u662F\u5426\u6709\u932F\u8AA4
2. \u7DB2\u7D61\u9023\u63A5\u662F\u5426\u6B63\u5E38
3. \u4EE3\u7406\u8A2D\u7F6E\u662F\u5426\u6B63\u78BA
4. \u662F\u5426\u5DF2\u5B89\u88DD telethon \u548C qrcode \u5EAB`),this.createTimeout=null)},6e4),this.ipcService.send("qr-login-create",t)}refreshQR(){let e=this.session();e?this.ipcService.send("qr-login-refresh",{sessionId:e.sessionId}):this.createQRLogin()}submit2FA(){let e=this.session();!e||!this.twoFactorInput||(this.isSubmitting2FA.set(!0),this.ipcService.send("qr-login-submit-2fa",{sessionId:e.sessionId,password:this.twoFactorInput}))}cancelLogin(){let e=this.session();e&&this.ipcService.send("qr-login-cancel",{sessionId:e.sessionId}),this.clearTimers(),this.session.set(null)}onClose(){this.cancelLogin(),this.closed.emit()}selectRandomProxy(){this.toast.info("\u4EE3\u7406\u6C60\u529F\u80FD\u5373\u5C07\u63A8\u51FA")}startCountdown(e){this.clearTimers(),this.countdown.set(e),this.countdownTimer=setInterval(()=>{let t=this.countdown();if(t<=1){this.clearTimers();let n=this.session();n&&n.status==="pending"&&this.session.set(N(F({},n),{status:"expired",message:"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"}))}else this.countdown.set(t-1)},1e3)}clearTimers(){this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null),this.statusCheckTimer&&(clearInterval(this.statusCheckTimer),this.statusCheckTimer=null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-qr-login"]],outputs:{closed:"closed",loginSuccess:"loginSuccess"},decls:11,vars:1,consts:[[1,"qr-login-container"],[1,"header"],[1,"title"],[1,"icon"],[1,"close-btn",3,"click"],[1,"content"],[1,"setup-section"],[1,"info-box"],[1,"option-group"],[1,"option-label"],[3,"apiSelected","selectionCleared","showSelected"],[1,"device-options"],[1,"device-btn",3,"click"],[1,"proxy-input-group"],["type","text","placeholder","socks5://host:port \u6216\u7559\u7A7A\u4F7F\u7528\u76F4\u9023",1,"proxy-input",3,"ngModelChange","ngModel"],["title","\u96A8\u6A5F\u9078\u64C7\u4EE3\u7406",1,"random-proxy-btn",3,"click"],[1,"checkbox-option"],["type","checkbox","id","bindProxy",3,"ngModelChange","ngModel"],["for","bindProxy"],["type","password","placeholder","\u53EF\u9078\uFF0C\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49",1,"form-input",3,"ngModelChange","ngModel"],[1,"create-btn",3,"click","disabled"],[1,"spinner"],[1,"qr-section"],[1,"tfa-section"],[1,"success-section"],[1,"error-section"],[1,"action-buttons"],[1,"qr-display"],["alt","QR Code",1,"qr-image",3,"src"],[1,"qr-placeholder"],[1,"qr-info"],[1,"countdown"],[1,"instruction"],[1,"device-info"],[1,"label"],[1,"value"],[1,"spinner","large"],[1,"status-icon","warning"],["type","password","placeholder","\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input","tfa-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"submit-btn",3,"click","disabled"],[1,"status-icon","success"],[1,"user-info-card"],[1,"success-message"],[1,"done-btn",3,"click"],[1,"user-avatar"],[1,"user-details"],[1,"user-name"],[1,"user-phone"],[1,"user-username"],[1,"refresh-btn",3,"click"],[1,"status-icon","error"],[1,"action-btn","secondary",3,"click"],[1,"action-btn","cancel",3,"click"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"h3",2)(3,"span",3),l(4,"\u{1F4F1}"),a(),l(5," \u6383\u78BC\u5FEB\u901F\u767B\u5165 "),a(),s(6,"button",4),b("click",function(){return n.onClose()}),l(7,"\xD7"),a()(),s(8,"div",5),w(9,l1,38,14,"div",6)(10,S1,7,2),a()()),t&2&&(d(9),E(n.session()?10:9))},dependencies:[oe,ue,xe,Jt,fe,_e,dn],styles:[".qr-login-container[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .95));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;width:420px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px -12px #00000080}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary, white)}.icon[_ngcontent-%COMP%]{font-size:1.25rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);font-size:1.5rem;cursor:pointer;padding:.25rem;line-height:1}.close-btn[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.content[_ngcontent-%COMP%]{padding:1.5rem}.setup-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.info-box[_ngcontent-%COMP%]{background:#06b6d41a;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:1rem}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-secondary, #cbd5e1);font-size:.875rem}.info-box[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.75rem;margin-top:.5rem}.option-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.option-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary, #cbd5e1)}.device-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem}.device-btn[_ngcontent-%COMP%]{padding:.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);font-size:.75rem;cursor:pointer;transition:all .2s}.device-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.device-btn.active[_ngcontent-%COMP%]{background:#06b6d433;border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.proxy-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.proxy-input[_ngcontent-%COMP%]{flex:1;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.proxy-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.random-proxy-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s}.random-proxy-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.checkbox-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.checkbox-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.create-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;margin-top:.5rem}.create-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.create-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.qr-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.qr-display[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:.75rem}.qr-image[_ngcontent-%COMP%]{width:200px;height:200px;display:block}.qr-placeholder[_ngcontent-%COMP%]{width:200px;height:200px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.qr-info[_ngcontent-%COMP%]{text-align:center}.countdown[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--primary, #06b6d4);margin-bottom:.5rem}.countdown.warning[_ngcontent-%COMP%]{color:#f59e0b;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.instruction[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-muted, #94a3b8);line-height:1.6;margin:0}.device-info[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.5rem 1rem;border-radius:.5rem}.device-info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-right:.5rem}.tfa-section[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:1rem}.status-icon[_ngcontent-%COMP%]{font-size:3rem}.status-icon.success[_ngcontent-%COMP%]{color:#22c55e}.status-icon.warning[_ngcontent-%COMP%]{color:#f59e0b}.status-icon.error[_ngcontent-%COMP%]{color:#ef4444}.tfa-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.tfa-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-muted, #94a3b8);font-size:.875rem}.tfa-input[_ngcontent-%COMP%]{max-width:250px;text-align:center}.submit-btn[_ngcontent-%COMP%], .done-btn[_ngcontent-%COMP%], .refresh-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.refresh-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.user-info-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;width:100%}.user-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:700;color:#fff}.user-details[_ngcontent-%COMP%]{text-align:left}.user-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.user-phone[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.user-username[_ngcontent-%COMP%]{font-size:.75rem;color:var(--primary, #06b6d4)}.success-message[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem;width:100%}.action-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1rem;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;font-size:.875rem;cursor:pointer;transition:all .2s}.action-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-secondary, #cbd5e1)}.action-btn.secondary[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.action-btn.cancel[_ngcontent-%COMP%]{background:#ef44441a;border-color:#ef44444d;color:#fca5a5}.action-btn.cancel[_ngcontent-%COMP%]:hover{background:#ef444433}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.spinner.large[_ngcontent-%COMP%]{width:40px;height:40px;border-width:3px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.warning-box[_ngcontent-%COMP%]{background:#ef444426;border:1px solid rgba(239,68,68,.4);border-radius:.75rem;overflow:hidden}.warning-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#ef444433;border-bottom:1px solid rgba(239,68,68,.3)}.warning-icon[_ngcontent-%COMP%]{font-size:1.25rem}.warning-title[_ngcontent-%COMP%]{flex:1;font-weight:600;color:#fca5a5}.dismiss-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fca5a5;font-size:1.25rem;cursor:pointer;padding:0;line-height:1}.warning-content[_ngcontent-%COMP%]{padding:.75rem 1rem}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#fecaca;font-size:.8rem}.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:.5rem 0;padding-left:1.25rem;color:#fca5a5;font-size:.75rem}.warning-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.warning-action[_ngcontent-%COMP%]{margin-top:.75rem!important;padding-top:.5rem;border-top:1px solid rgba(239,68,68,.2)}.warning-action[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa;text-decoration:underline}.api-section[_ngcontent-%COMP%]{background:#06b6d40d;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:.75rem}.option-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.checkbox-option.inline[_ngcontent-%COMP%]{font-size:.75rem}.api-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.api-input-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.input-label[_ngcontent-%COMP%]{width:70px;font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-input-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1}.api-hint[_ngcontent-%COMP%]{margin:0;font-size:.7rem;color:var(--text-muted, #64748b)}.api-hint[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.public-api-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#ef44441a;border-radius:.25rem;font-size:.75rem;color:#fca5a5}.warning-badge[_ngcontent-%COMP%]{background:#ef44444d;padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}"]})}};var y1=()=>[],w1=(i,e)=>e.index;function E1(i,e){if(i&1){let t=T();s(0,"div",9)(1,"div",13)(2,"h2"),l(3,"\u{1F510} \u9078\u64C7 API \u6191\u64DA"),a(),s(4,"p"),l(5,"\u9078\u64C7\u6216\u6DFB\u52A0 API \u6191\u64DA\u4EE5\u9023\u63A5 Telegram"),a()(),s(6,"app-api-selector",14),b("apiSelected",function(o){v(t);let r=f();return x(r.onApiSelected(o))})("selectionCleared",function(){v(t);let o=f();return x(o.onApiCleared())}),a(),s(7,"div",15)(8,"button",16),b("click",function(){v(t);let o=f();return x(o.goBack())}),l(9,"\u2190 \u8FD4\u56DE"),a(),s(10,"button",17),b("click",function(){v(t);let o=f();return x(o.proceedToLogin())}),l(11," \u4E0B\u4E00\u6B65\uFF1A\u9078\u64C7\u767B\u5165\u65B9\u5F0F \u2192 "),a()()()}if(i&2){let t=f();d(6),V("showSelected",!0),d(4),V("disabled",!t.selectedApiCredential())}}function A1(i,e){if(i&1){let t=T();s(0,"div",10)(1,"div",13)(2,"h2"),l(3,"\u9078\u64C7\u767B\u5165\u65B9\u5F0F"),a(),s(4,"p"),l(5,"\u9078\u64C7\u6700\u9069\u5408\u60A8\u7684\u5E33\u865F\u767B\u5165\u65B9\u5F0F"),a()(),s(6,"div",18)(7,"div",19),b("click",function(){v(t);let o=f();return x(o.selectLoginMethod("code"))}),s(8,"div",20),l(9,"\u2705 \u63A8\u85A6"),a(),s(10,"div",21),l(11,"\u{1F4AC}"),a(),s(12,"h3"),l(13,"\u9A57\u8B49\u78BC\u767B\u5165"),a(),s(14,"p"),l(15,"\u8F38\u5165\u624B\u6A5F\u865F\uFF0C\u63A5\u6536\u9A57\u8B49\u78BC\u5B8C\u6210\u767B\u5165"),a(),s(16,"ul")(17,"li"),l(18,"\u{1F7E2} \u6A19\u6E96\u5B98\u65B9\u767B\u5165\u65B9\u5F0F"),a(),s(19,"li"),l(20,"\u{1F7E2} \u98A8\u96AA\u6700\u4F4E"),a(),s(21,"li"),l(22,"\u{1F7E1} \u9700\u8981\u80FD\u6536\u5230\u9A57\u8B49\u78BC"),a()(),s(23,"div",22),l(24,"\u98A8\u96AA\uFF1A\u4F4E"),a()(),s(25,"div",23),b("click",function(){v(t);let o=f();return x(o.selectLoginMethod("tdata"))}),s(26,"div",20),l(27,"\u{1F6E1}\uFE0F \u6700\u5B89\u5168"),a(),s(28,"div",21),l(29,"\u{1F4C2}"),a(),s(30,"h3"),l(31,"TData \u5C0E\u5165"),a(),s(32,"p"),l(33,"\u5C0E\u5165\u5DF2\u6709\u7684 Session \u6587\u4EF6"),a(),s(34,"ul")(35,"li"),l(36,"\u{1F7E2} \u7121\u9700\u91CD\u65B0\u767B\u5165"),a(),s(37,"li"),l(38,"\u{1F7E2} \u98A8\u96AA\u6700\u4F4E"),a(),s(39,"li"),l(40,"\u{1F7E2} \u652F\u6301\u6279\u91CF\u5C0E\u5165"),a()(),s(41,"div",24),l(42,"\u98A8\u96AA\uFF1A\u6700\u4F4E"),a()(),s(43,"div",25),b("click",function(){v(t);let o=f();return x(o.selectLoginMethod("qr"))}),s(44,"div",20),l(45,"\u26A0\uFE0F \u9700\u8B39\u614E"),a(),s(46,"div",21),l(47,"\u{1F4F1}"),a(),s(48,"h3"),l(49,"\u6383\u78BC\u767B\u5165"),a(),s(50,"p"),l(51,"\u4F7F\u7528 Telegram APP \u6383\u63CF\u4E8C\u7DAD\u78BC"),a(),s(52,"ul")(53,"li"),l(54,"\u{1F7E2} \u7121\u9700\u9A57\u8B49\u78BC"),a(),s(55,"li"),l(56,"\u{1F7E1} \u9700\u8981\u624B\u6A5F\u5728\u65C1"),a(),s(57,"li"),l(58,"\u{1F534} \u7B2C\u4E09\u65B9\u7279\u5FB5\uFF0C\u98A8\u96AA\u8F03\u9AD8"),a()(),s(59,"div",26),l(60,"\u98A8\u96AA\uFF1A\u8F03\u9AD8"),a()()(),s(61,"div",15)(62,"button",16),b("click",function(){v(t);let o=f();return x(o.currentStep.set(1))}),l(63,"\u2190 \u8FD4\u56DE"),a()()()}}function D1(i,e){i&1&&(s(0,"span",32),l(1,"\u2713"),a())}function M1(i,e){if(i&1&&(s(0,"span",33),l(1),a()),i&2){let t=f(3);d(),M(t.phoneError())}}function T1(i,e){i&1&&(s(0,"span",34),l(1,"\u8ACB\u5305\u542B\u570B\u5BB6\u4EE3\u78BC\uFF0C\u4F8B\u5982 +63, +86, +1"),a())}function I1(i,e){i&1&&(k(0,"span",37),l(1," \u767C\u9001\u4E2D... "))}function k1(i,e){i&1&&l(0," \u767C\u9001\u9A57\u8B49\u78BC \u2192 ")}function P1(i,e){if(i&1){let t=T();s(0,"div",28)(1,"label"),l(2,"\u624B\u6A5F\u865F\u78BC "),s(3,"span",29),l(4,"*"),a()(),s(5,"div",30)(6,"input",31),b("ngModelChange",function(o){v(t);let r=f(2);return x(r.onPhoneChange(o))}),a(),w(7,D1,2,0,"span",32),a(),w(8,M1,2,1,"span",33)(9,T1,2,0,"span",34),a(),s(10,"div",28)(11,"label"),l(12,"\u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),a(),s(13,"input",35),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.proxyAddress,o)||(r.proxyAddress=o),x(o)}),a()(),s(14,"div",28)(15,"label"),l(16,"\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09"),a(),s(17,"input",36),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.twoFactorPassword,o)||(r.twoFactorPassword=o),x(o)}),a()(),s(18,"div",15)(19,"button",16),b("click",function(){v(t);let o=f(2);return x(o.currentLoginMethod.set("select"))}),l(20,"\u2190 \u8FD4\u56DE"),a(),s(21,"button",17),b("click",function(){v(t);let o=f(2);return x(o.sendVerificationCode())}),w(22,I1,2,0)(23,k1,1,0),a()()}if(i&2){let t=f(2);d(6),I("error",t.phoneError())("valid",t.phoneValid()),V("ngModel",t.phoneNumber),d(),E(t.phoneValid()?7:-1),d(),E(t.phoneError()?8:9),d(5),K("ngModel",t.proxyAddress),d(4),K("ngModel",t.twoFactorPassword),d(4),V("disabled",!t.phoneValid()||t.isSending()),d(),E(t.isSending()?22:23)}}function F1(i,e){if(i&1){let t=T();s(0,"div",28)(1,"label"),l(2,"\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC "),s(3,"span",29),l(4,"*"),a()(),s(5,"input",43),W("ngModelChange",function(o){v(t);let r=f(3);return z(r.twoFactorPassword,o)||(r.twoFactorPassword=o),x(o)}),a()()}if(i&2){let t=f(3);d(5),K("ngModel",t.twoFactorPassword)}}function R1(i,e){if(i&1&&l(0),i&2){let t=f(3);A(" ",t.resendCooldown(),"\u79D2\u5F8C\u53EF\u91CD\u767C ")}}function N1(i,e){i&1&&l(0," \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC ")}function B1(i,e){i&1&&(k(0,"span",37),l(1," \u9A57\u8B49\u4E2D... "))}function V1(i,e){i&1&&l(0," \u9A57\u8B49\u4E26\u767B\u5165 \u2192 ")}function L1(i,e){if(i&1){let t=T();s(0,"div",38)(1,"span",39),l(2,"\u{1F4F1}"),a(),l(3),a(),s(4,"div",28)(5,"label"),l(6,"\u9A57\u8B49\u78BC "),s(7,"span",29),l(8,"*"),a()(),s(9,"input",40),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.verificationCode,o)||(r.verificationCode=o),x(o)}),a()(),w(10,F1,6,1,"div",28),s(11,"div",41)(12,"button",42),b("click",function(){v(t);let o=f(2);return x(o.resendCode())}),w(13,R1,1,1)(14,N1,1,0),a()(),s(15,"div",15)(16,"button",16),b("click",function(){v(t);let o=f(2);return x(o.codeStep.set(!1))}),l(17,"\u2190 \u8FD4\u56DE"),a(),s(18,"button",17),b("click",function(){v(t);let o=f(2);return x(o.submitVerificationCode())}),w(19,B1,2,0)(20,V1,1,0),a()()}if(i&2){let t=f(2);d(3),A(" \u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 ",t.phoneNumber," "),d(6),K("ngModel",t.verificationCode),d(),E(t.needs2FA()?10:-1),d(2),V("disabled",t.resendCooldown()>0),d(),E(t.resendCooldown()>0?13:14),d(5),V("disabled",!t.verificationCode||t.isVerifying()),d(),E(t.isVerifying()?19:20)}}function O1(i,e){if(i&1&&(s(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4AC} \u9A57\u8B49\u78BC\u767B\u5165"),a()(),s(4,"div",27),w(5,P1,24,11)(6,L1,21,7),a()()),i&2){let t=f();d(5),E(t.codeStep()?6:5)}}function G1(i,e){if(i&1&&(s(0,"span",69),l(1),a()),i&2){let t=f().$implicit;d(),M(t.first_name||t.username)}}function U1(i,e){if(i&1&&(s(0,"span",70),l(1),a()),i&2){let t=f().$implicit;d(),M(t.error||"\u7121\u6CD5\u5C0E\u5165")}}function q1(i,e){if(i&1){let t=T();s(0,"label",65)(1,"input",66),b("change",function(){let o=v(t).$implicit,r=f(5);return x(r.toggleTdataAccount(o.index))}),a(),s(2,"div",67)(3,"span",68),l(4),a(),w(5,G1,2,1,"span",69),w(6,U1,2,1,"span",70),a()()}if(i&2){let t=e.$implicit,n=f(5);I("disabled",!t.can_import),d(),V("checked",n.selectedTdataAccounts().includes(t.index))("disabled",!t.can_import),d(3),M(t.phone),d(),E(t.first_name||t.username?5:-1),d(),E(t.can_import?-1:6)}}function $1(i,e){if(i&1&&(s(0,"div",61)(1,"h4"),l(2),a(),s(3,"div",63),$(4,q1,7,7,"label",64,w1),a()()),i&2){let t,n=f(4);d(2),A("\u{1F4CB} \u6AA2\u6E2C\u5230 ",((t=n.tdataScanResult().accounts)==null?null:t.length)||0," \u500B\u5E33\u865F"),d(2),H(n.tdataScanResult().accounts||_n(1,y1))}}function H1(i,e){if(i&1&&(s(0,"div",62)(1,"span",71),l(2,"\u274C"),a(),s(3,"span"),l(4),a()()),i&2){let t=f(4);d(4),M(t.tdataScanResult().error||"\u6383\u63CF\u5931\u6557")}}function K1(i,e){if(i&1&&w(0,$1,6,2,"div",61)(1,H1,5,1,"div",62),i&2){let t=f(3);E(t.tdataScanResult().success?0:1)}}function z1(i,e){i&1&&(s(0,"div",60),k(1,"span",37),s(2,"span"),l(3,"\u6B63\u5728\u6383\u63CF TData..."),a()())}function W1(i,e){if(i&1){let t=T();s(0,"div",48)(1,"h4"),l(2,"\u{1F4CD} TData \u4F4D\u7F6E"),a(),s(3,"div",49)(4,"code"),l(5),a(),s(6,"div",50)(7,"button",51),b("click",function(){v(t);let o=f(2);return x(o.copyTdataPath())}),l(8,"\u{1F4CB}"),a(),s(9,"button",52),b("click",function(){v(t);let o=f(2);return x(o.openTdataFolder())}),l(10,"\u{1F4C2}"),a()()()(),s(11,"div",53),b("dragover",function(o){v(t);let r=f(2);return x(r.onDragOver(o))})("dragleave",function(o){v(t);let r=f(2);return x(r.onDragLeave(o))})("drop",function(o){v(t);let r=f(2);return x(r.onDropTdata(o))}),s(12,"div",54),l(13,"\u{1F4C1}"),a(),s(14,"p",55),l(15,"\u62D6\u653E tdata \u6587\u4EF6\u593E\u5230\u9019\u88E1"),a(),s(16,"p",56),l(17,"\u652F\u6301\uFF1A\u6574\u500B\u6587\u4EF6\u593E / ZIP \u58D3\u7E2E\u5305"),a(),s(18,"div",57)(19,"button",58),b("click",function(){v(t);let o=f(2);return x(o.selectTdataFolder())}),l(20,"\u9078\u64C7\u6587\u4EF6\u593E"),a(),s(21,"button",59),b("click",function(){v(t);let o=f(2);return x(o.selectTdataZip())}),l(22,"\u9078\u64C7 ZIP"),a()()(),w(23,K1,2,1),w(24,z1,4,0,"div",60)}if(i&2){let t=f(2);d(5),M(t.getDefaultTdataPath()),d(6),I("dragging",t.isDragging()),d(12),E(t.tdataScanResult()?23:-1),d(),E(t.isScanningTdata()?24:-1)}}function J1(i,e){if(i&1){let t=T();s(0,"div",74)(1,"span",75),l(2,"\u{1F4C4}"),a(),s(3,"span",76),l(4),a(),s(5,"button",77),b("click",function(){v(t);let o=f(3);return x(o.clearSelectedFile())}),l(6,"\xD7"),a()()}if(i&2){let t=f(3);d(4),M(t.selectedFilePath())}}function Q1(i,e){if(i&1){let t=T();s(0,"div",72)(1,"h4"),l(2,"\u652F\u6301\u7684\u683C\u5F0F"),a(),s(3,"ul")(4,"li")(5,"strong"),l(6,".tgpkg"),a(),l(7," - TG-Matrix \u5C0E\u51FA\u5305\uFF08\u63A8\u85A6\uFF09"),a(),s(8,"li")(9,"strong"),l(10,".session"),a(),l(11," - Pyrogram Session \u6587\u4EF6"),a(),s(12,"li")(13,"strong"),l(14,".telethon.session"),a(),l(15," - Telethon Session \u6587\u4EF6"),a()()(),s(16,"div",73),b("dragover",function(o){v(t);let r=f(2);return x(r.onDragOver(o))})("dragleave",function(o){v(t);let r=f(2);return x(r.onDragLeave(o))})("drop",function(o){v(t);let r=f(2);return x(r.onDrop(o))})("click",function(){v(t);let o=f(2);return x(o.selectSessionFile())}),s(17,"div",54),l(18,"\u{1F4C4}"),a(),s(19,"p",55),l(20,"\u62D6\u653E Session \u6587\u4EF6\u5230\u9019\u88E1"),a(),s(21,"p",56),l(22,"\u6216\u9EDE\u64CA\u9078\u64C7\u6587\u4EF6"),a()(),w(23,J1,7,1,"div",74)}if(i&2){let t=f(2);d(16),I("dragging",t.isDragging()),d(7),E(t.selectedFilePath()?23:-1)}}function Y1(i,e){i&1&&(k(0,"span",37),l(1," \u5C0E\u5165\u4E2D... "))}function X1(i,e){if(i&1&&l(0),i&2){let t=f(3);A(" \u5C0E\u5165 ",t.selectedTdataAccounts().length," \u500B\u5E33\u865F \u2192 ")}}function Z1(i,e){if(i&1){let t=T();s(0,"button",17),b("click",function(){v(t);let o=f(2);return x(o.importTdataAccounts())}),w(1,Y1,2,0)(2,X1,1,1),a()}if(i&2){let t=f(2);V("disabled",t.selectedTdataAccounts().length===0||t.isImporting()),d(),E(t.isImporting()?1:2)}}function j1(i,e){i&1&&(k(0,"span",37),l(1," \u5C0E\u5165\u4E2D... "))}function eC(i,e){i&1&&l(0," \u5C0E\u5165 Session \u2192 ")}function tC(i,e){if(i&1){let t=T();s(0,"button",17),b("click",function(){v(t);let o=f(2);return x(o.importSession())}),w(1,j1,2,0)(2,eC,1,0),a()}if(i&2){let t=f(2);V("disabled",!t.selectedFilePath()||t.isImporting()),d(),E(t.isImporting()?1:2)}}function nC(i,e){if(i&1){let t=T();s(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4C2} TData / Session \u5C0E\u5165"),a()(),s(4,"div",27)(5,"div",44)(6,"button",45),b("click",function(){v(t);let o=f();return x(o.tdataImportMode.set("tdata"))}),l(7," \u{1F4C2} TData \u6587\u4EF6\u593E "),s(8,"span",46),l(9,"\u63A8\u85A6"),a()(),s(10,"button",45),b("click",function(){v(t);let o=f();return x(o.tdataImportMode.set("session"))}),l(11," \u{1F4C4} Session \u6587\u4EF6 "),a()(),w(12,W1,25,5),w(13,Q1,24,3),s(14,"div",15)(15,"button",16),b("click",function(){v(t);let o=f();return x(o.currentLoginMethod.set("select"))}),l(16,"\u2190 \u8FD4\u56DE"),a(),w(17,Z1,3,2,"button",47)(18,tC,3,2,"button",47),a()()()}if(i&2){let t=f();d(6),I("active",t.tdataImportMode()==="tdata"),d(4),I("active",t.tdataImportMode()==="session"),d(2),E(t.tdataImportMode()==="tdata"?12:-1),d(),E(t.tdataImportMode()==="session"?13:-1),d(4),E(t.tdataImportMode()==="tdata"?17:18)}}function iC(i,e){if(i&1){let t=T();s(0,"div",15)(1,"button",16),b("click",function(){v(t);let o=f(2);return x(o.currentLoginMethod.set("select"))}),l(2,"\u2190 \u8FD4\u56DE"),a(),s(3,"button",81),b("click",function(){v(t);let o=f(2);return x(o.generateQRCode())}),l(4,"\u751F\u6210\u4E8C\u7DAD\u78BC \u2192"),a()()}}function oC(i,e){if(i&1){let t=T();s(0,"div",82)(1,"div",83),k(2,"img",84),a(),s(3,"div",85),l(4),a(),s(5,"div",86)(6,"p"),l(7,"1. \u6253\u958B\u624B\u6A5F Telegram APP"),a(),s(8,"p"),l(9,"2. \u524D\u5F80 \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC"),a(),s(10,"p"),l(11,"3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u6388\u6B0A"),a()()(),s(12,"div",15)(13,"button",16),b("click",function(){v(t);let o=f(2);return x(o.currentLoginMethod.set("select"))}),l(14,"\u2190 \u8FD4\u56DE"),a(),s(15,"button",81),b("click",function(){v(t);let o=f(2);return x(o.refreshQRCode())}),l(16,"\u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC"),a()()}if(i&2){let t=f(2);d(2),V("src","data:image/png;base64,"+t.qrImageBase64(),Bt),d(),I("warning",t.qrCountdown()<=10),d(),A(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A",t.qrCountdown()," \u79D2 ")}}function rC(i,e){if(i&1){let t=T();s(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4F1} \u6383\u78BC\u767B\u5165"),a()(),s(4,"div",27)(5,"div",28)(6,"label"),l(7,"\u8A2D\u5099\u6A21\u64EC"),a(),s(8,"div",78)(9,"button",79),b("click",function(){v(t);let o=f();return x(o.deviceType.set("random"))}),l(10,"\u{1F3B2} \u96A8\u6A5F"),a(),s(11,"button",79),b("click",function(){v(t);let o=f();return x(o.deviceType.set("ios"))}),l(12,"\u{1F4F1} iOS"),a(),s(13,"button",79),b("click",function(){v(t);let o=f();return x(o.deviceType.set("android"))}),l(14,"\u{1F916} Android"),a()()(),s(15,"div",28)(16,"label"),l(17,"\u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),a(),s(18,"input",80),W("ngModelChange",function(o){v(t);let r=f();return z(r.proxyAddress,o)||(r.proxyAddress=o),x(o)}),a()(),w(19,iC,5,0,"div",15)(20,oC,17,4),a()()}if(i&2){let t=f();d(9),I("active",t.deviceType()==="random"),d(2),I("active",t.deviceType()==="ios"),d(2),I("active",t.deviceType()==="android"),d(5),K("ngModel",t.proxyAddress),d(),E(t.qrImageBase64()?20:19)}}function sC(i,e){if(i&1&&(s(0,"div",92),l(1),a()),i&2){let t=f(3);d(),M("@"+t.addedAccountInfo().username)}}function aC(i,e){if(i&1&&(s(0,"div",93)(1,"span",94),l(2),a()()),i&2){let t=f(3);d(2),A("\u{1F510} ",t.selectedApiCredential().name||"API "+t.selectedApiCredential().api_id)}}function lC(i,e){if(i&1&&(s(0,"div",89)(1,"div",90),l(2),a(),s(3,"div",91)(4,"div",69),l(5),a(),s(6,"div",68),l(7),a(),w(8,sC,2,1,"div",92),a()(),w(9,aC,3,1,"div",93)),i&2){let t=f(2);d(2),A(" ",(t.addedAccountInfo().firstName||t.addedAccountInfo().phone||"?").charAt(0).toUpperCase()," "),d(3),Y(" ",t.addedAccountInfo().firstName||""," ",t.addedAccountInfo().lastName||""," "),d(2),M(t.addedAccountInfo().phone),d(),E(t.addedAccountInfo().username?8:-1),d(),E(t.selectedApiCredential()?9:-1)}}function cC(i,e){if(i&1){let t=T();s(0,"div",12)(1,"div",87),l(2,"\u2705"),a(),s(3,"h2"),l(4,"\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01"),a(),w(5,lC,10,6),s(6,"div",88)(7,"button",16),b("click",function(){v(t);let o=f();return x(o.addAnother())}),l(8,"\u2795 \u7E7C\u7E8C\u6DFB\u52A0"),a(),s(9,"button",81),b("click",function(){v(t);let o=f();return x(o.goBack())}),l(10,"\u8FD4\u56DE\u5E33\u6236\u5217\u8868 \u2192"),a()()()}if(i&2){let t=f();d(5),E(t.addedAccountInfo()?5:-1)}}var go=class i{constructor(){this.ipcService=B(De);this.toast=B(me);this.membershipService=B(Ue);this.back=new vt;this.accountAdded=new vt;this.currentStep=C(1);this.currentLoginMethod=C("select");this.selectedApiCredential=C(null);this.phoneCodeHash="";this.loginAccountId="";this.phoneNumber="";this.verificationCode="";this.twoFactorPassword="";this.proxyAddress="";this.codeStep=C(!1);this.isSending=C(!1);this.isVerifying=C(!1);this.needs2FA=C(!1);this.resendCooldown=C(0);this.phoneError=C("");this.phoneValid=C(!1);this.deviceType=C("random");this.qrImageBase64=C("");this.qrCountdown=C(60);this.isDragging=C(!1);this.selectedFilePath=C("");this.isImporting=C(!1);this.tdataImportMode=C("tdata");this.tdataScanResult=C(null);this.selectedTdataAccounts=C([]);this.isScanningTdata=C(!1);this.defaultTdataPath=C("");this.addedAccountInfo=C(null);this.resendTimer=null;this.qrTimer=null;this.sendTimeout=null;this.verifyTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}ngOnDestroy(){this.resendTimer&&clearInterval(this.resendTimer),this.qrTimer&&clearInterval(this.qrTimer),this.sendTimeout&&clearTimeout(this.sendTimeout),this.verifyTimeout&&clearTimeout(this.verifyTimeout),this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("login-requires-code",e=>{this.isSending.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),(e.phone===this.phoneNumber||e.accountId)&&(this.phoneCodeHash=e.phoneCodeHash,this.loginAccountId=e.accountId,this.codeStep.set(!0),this.startResendCooldown(),(e.sendType||"app")==="sms"?this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3\u624B\u6A5F\u77ED\u4FE1"):this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 Telegram App"))}),this.ipcChannels.push("login-requires-code"),this.ipcService.on("login-success",e=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.addedAccountInfo.set(e.userInfo||{phone:this.phoneNumber}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u767B\u5165\u6210\u529F\uFF01")}),this.ipcChannels.push("login-success"),this.ipcService.on("login-requires-2fa",e=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.needs2FA.set(!0),this.toast.info("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC")}),this.ipcChannels.push("login-requires-2fa"),this.ipcService.on("login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("login-error"),this.ipcService.on("account-login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("account-login-error"),this.ipcService.on("qr-login-created",e=>{e.success!==!1&&e.qrImageBase64?(this.qrImageBase64.set(e.qrImageBase64),this.startQRCountdown()):this.toast.error(e.error||"\u751F\u6210\u4E8C\u7DAD\u78BC\u5931\u6557")}),this.ipcChannels.push("qr-login-created"),this.ipcService.on("qr-login-success",e=>{this.stopQRCountdown(),this.addedAccountInfo.set(e.userInfo||e),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u767B\u5165\u6210\u529F\uFF01")}),this.ipcChannels.push("qr-login-success"),this.ipcService.on("session-imported",e=>{this.isImporting.set(!1),e.success?(this.addedAccountInfo.set(e.account||{phone:e.phone}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u5C0E\u5165\u6210\u529F\uFF01")):this.toast.error(e.error||"\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("session-imported"),this.ipcService.on("session-file-selected",e=>{e.path&&this.selectedFilePath.set(e.path)}),this.ipcChannels.push("session-file-selected"),this.ipcService.on("tdata-folder-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-folder-selected"),this.ipcService.on("tdata-zip-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-zip-selected"),this.ipcService.on("tdata-scan-result",e=>{if(this.isScanningTdata.set(!1),this.tdataScanResult.set(e),e.success&&e.accounts?.length>0){let t=e.accounts.filter(n=>n.can_import).map(n=>n.index);this.selectedTdataAccounts.set(t),this.toast.success(`\u627E\u5230 ${e.accounts.length} \u500B\u5E33\u865F`)}else e.error&&this.toast.error(e.error)}),this.ipcChannels.push("tdata-scan-result"),this.ipcService.on("tdata-import-result",e=>{this.isImporting.set(!1),e.success?(this.addedAccountInfo.set({phone:e.phone,first_name:e.first_name,last_name:e.last_name,username:e.username}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success(`\u5E33\u865F ${e.phone} \u5C0E\u5165\u6210\u529F\uFF01`)):this.toast.error(e.error||"\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-import-result"),this.ipcService.on("tdata-batch-result",e=>{this.isImporting.set(!1),e.success_count>0?(this.currentStep.set(3),this.addedAccountInfo.set({batch:!0,count:e.success_count,failed:e.fail_count}),this.toast.success(`\u6210\u529F\u5C0E\u5165 ${e.success_count} \u500B\u5E33\u865F`),e.fail_count>0&&this.toast.warning(`${e.fail_count} \u500B\u5E33\u865F\u5C0E\u5165\u5931\u6557`)):this.toast.error(e.error||"\u6240\u6709\u5E33\u865F\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-batch-result"),this.ipcService.on("tdata-import-progress",e=>{console.log(`TData import progress: ${e.current}/${e.total}`)}),this.ipcChannels.push("tdata-import-progress")}onApiSelected(e){this.selectedApiCredential.set(e)}onApiCleared(){this.selectedApiCredential.set(null)}proceedToLogin(){this.selectedApiCredential()&&this.currentStep.set(2)}selectLoginMethod(e){this.currentLoginMethod.set(e)}goBack(){this.back.emit()}addAnother(){this.currentStep.set(1),this.currentLoginMethod.set("select"),this.selectedApiCredential.set(null),this.resetForm()}openUpgrade(){window.dispatchEvent(new CustomEvent("open-membership-dialog"))}resetForm(){this.phoneNumber="",this.verificationCode="",this.twoFactorPassword="",this.proxyAddress="",this.phoneCodeHash="",this.loginAccountId="",this.codeStep.set(!1),this.qrImageBase64.set(""),this.selectedFilePath.set(""),this.needs2FA.set(!1),this.addedAccountInfo.set(null)}validatePhone(e){if(!e)return{valid:!1,error:""};let t=e.trim();if(!t.startsWith("+"))return{valid:!1,error:"\u865F\u78BC\u5FC5\u9808\u4EE5 + \u958B\u982D\uFF0C\u4F8B\u5982 +63\u3001+86\u3001+1"};let n=t.slice(1);return/^\d+$/.test(n)?n.length<8?{valid:!1,error:"\u865F\u78BC\u9577\u5EA6\u4E0D\u8DB3\uFF08\u81F3\u5C11\u9700\u8981 8 \u4F4D\u6578\u5B57\uFF09"}:n.length>15?{valid:!1,error:"\u865F\u78BC\u9577\u5EA6\u904E\u9577\uFF08\u6700\u591A 15 \u4F4D\u6578\u5B57\uFF09"}:{valid:!0,error:""}:{valid:!1,error:"\u865F\u78BC\u53EA\u80FD\u5305\u542B\u6578\u5B57\uFF08+ \u865F\u5F8C\u9762\uFF09"}}onPhoneChange(e){this.phoneNumber=e;let t=this.validatePhone(e);this.phoneValid.set(t.valid),this.phoneError.set(t.error)}sendVerificationCode(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}if(!this.phoneNumber){this.phoneError.set("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC"),this.toast.error("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC");return}let t=this.validatePhone(this.phoneNumber);if(!t.valid){this.phoneError.set(t.error),this.toast.error(t.error);return}this.sendTimeout&&clearTimeout(this.sendTimeout),this.isSending.set(!0),this.phoneError.set(""),this.ipcService.send("add-account",{phone:this.phoneNumber,apiId:e.api_id,apiHash:e.api_hash,proxy:this.proxyAddress||null,twoFactorPassword:this.twoFactorPassword||null}),setTimeout(()=>{this.ipcService.send("login-account",{phone:this.phoneNumber,apiId:e.api_id,apiHash:e.api_hash,proxy:this.proxyAddress||null,twoFactorPassword:this.twoFactorPassword||null})},500),this.sendTimeout=setTimeout(()=>{this.isSending()&&(this.isSending.set(!1),this.phoneError.set("\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66"),this.toast.error("\u767C\u9001\u9A57\u8B49\u78BC\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},3e4)}submitVerificationCode(){if(!this.verificationCode){this.toast.error("\u8ACB\u8F38\u5165\u9A57\u8B49\u78BC");return}if(this.needs2FA()&&!this.twoFactorPassword){this.toast.error("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC");return}this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.isVerifying.set(!0);let e=this.selectedApiCredential();this.ipcService.send("login-account",{phone:this.phoneNumber,phoneCode:this.verificationCode,phoneCodeHash:this.phoneCodeHash,twoFactorPassword:this.twoFactorPassword||null,apiId:e?.api_id,apiHash:e?.api_hash}),this.verifyTimeout=setTimeout(()=>{this.isVerifying()&&(this.isVerifying.set(!1),this.toast.error("\u9A57\u8B49\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66"))},3e4)}resendCode(){this.sendVerificationCode()}handleLoginError(e){this.isSending.set(!1),this.isVerifying.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null);let t=e.friendlyMessage||e.error||e.message||"\u767B\u5165\u5931\u6557";if(t.includes("2FA")&&t.includes("\u5BC6\u78BC")){this.toast.error("\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\u932F\u8AA4\uFF0C\u8ACB\u91CD\u65B0\u8F38\u5165"),this.twoFactorPassword="";return}if(e.codeExpired){this.toast.error("\u9A57\u8B49\u78BC\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767C\u9001"),this.codeStep.set(!1),this.verificationCode="",this.phoneCodeHash="";return}this.toast.error(t)}startResendCooldown(){this.resendCooldown.set(60),this.resendTimer=setInterval(()=>{let e=this.resendCooldown();e<=1?(clearInterval(this.resendTimer),this.resendCooldown.set(0)):this.resendCooldown.set(e-1)},1e3)}generateQRCode(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}this.ipcService.send("qr-login-create",{proxy:this.proxyAddress||null,deviceType:this.deviceType()==="random"?null:this.deviceType(),customApiId:e.api_id,customApiHash:e.api_hash})}refreshQRCode(){this.qrImageBase64.set(""),this.generateQRCode()}startQRCountdown(){this.qrCountdown.set(60),this.qrTimer=setInterval(()=>{let e=this.qrCountdown();e<=1?this.stopQRCountdown():this.qrCountdown.set(e-1)},1e3)}stopQRCountdown(){this.qrTimer&&(clearInterval(this.qrTimer),this.qrTimer=null)}onDragOver(e){e.preventDefault(),this.isDragging.set(!0)}onDragLeave(e){e.preventDefault(),this.isDragging.set(!1)}onDrop(e){e.preventDefault(),this.isDragging.set(!1);let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0].path;n&&this.selectedFilePath.set(n)}}onDropTdata(e){e.preventDefault(),this.isDragging.set(!1);let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0].path;n&&this.scanTdata(n)}}selectSessionFile(){this.ipcService.send("select-session-file",{})}selectTdataFolder(){this.ipcService.send("select-tdata-folder",{})}selectTdataZip(){this.ipcService.send("select-tdata-zip",{})}scanTdata(e){this.isScanningTdata.set(!0),this.tdataScanResult.set(null),this.selectedTdataAccounts.set([]),this.ipcService.send("scan-tdata",{path:e})}toggleTdataAccount(e){this.selectedTdataAccounts.update(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])}getDefaultTdataPath(){let e=navigator.userAgent.includes("Windows"),t=navigator.userAgent.includes("Mac");return e?"%APPDATA%\\Telegram Desktop\\tdata":t?"~/Library/Application Support/Telegram Desktop/tdata":"~/.local/share/TelegramDesktop/tdata"}copyTdataPath(){let e=this.getDefaultTdataPath();navigator.clipboard.writeText(e.replace("%APPDATA%","").replace("~","")),this.toast.success("\u8DEF\u5F91\u5DF2\u8907\u88FD")}openTdataFolder(){this.ipcService.send("open-default-tdata-folder",{})}importTdataAccounts(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}let t=this.tdataScanResult();if(!t?.tdata_path){this.toast.error("\u8ACB\u5148\u6383\u63CF TData");return}let n=this.selectedTdataAccounts();if(n.length===0){this.toast.error("\u8ACB\u9078\u64C7\u8981\u5C0E\u5165\u7684\u5E33\u865F");return}this.isImporting.set(!0),n.length===1?this.ipcService.send("import-tdata-account",{tdataPath:t.tdata_path,accountIndex:n[0],apiId:e.api_id,apiHash:e.api_hash}):this.ipcService.send("import-tdata-batch",{tdataPath:t.tdata_path,accountIndices:n,apiId:e.api_id,apiHash:e.api_hash})}clearSelectedFile(){this.selectedFilePath.set("")}importSession(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}this.isImporting.set(!0),this.ipcService.send("import-session",{filePath:this.selectedFilePath(),apiId:e.api_id,apiHash:e.api_hash})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-add-account-page"]],outputs:{back:"back",accountAdded:"accountAdded"},decls:30,vars:20,consts:[[1,"add-account-page"],[1,"page-header"],[1,"back-btn",3,"click"],[1,"page-title"],[1,"step-indicator"],[1,"step"],[1,"step-number"],[1,"step-label"],[1,"step-line"],[1,"config-section"],[1,"login-selection"],[1,"login-form"],[1,"success-section"],[1,"section-header"],[3,"apiSelected","selectionCleared","showSelected"],[1,"form-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click","disabled"],[1,"login-cards"],[1,"login-card","recommended",3,"click"],[1,"login-badge"],[1,"login-icon"],[1,"login-risk","low"],[1,"login-card","safe",3,"click"],[1,"login-risk","lowest"],[1,"login-card","warning",3,"click"],[1,"login-risk","high"],[1,"form-card"],[1,"form-group"],[1,"required"],[1,"input-with-prefix"],["type","tel","placeholder","+639952947692",1,"form-input",3,"ngModelChange","ngModel"],[1,"input-status","valid"],[1,"error-text"],[1,"hint"],["type","text","placeholder","socks5://host:port \u6216\u7559\u7A7A",1,"form-input",3,"ngModelChange","ngModel"],["type","password","placeholder","\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49",1,"form-input",3,"ngModelChange","ngModel"],[1,"spinner"],[1,"code-sent-info"],[1,"info-icon"],["type","text","placeholder","\u8F38\u5165\u6536\u5230\u7684\u9A57\u8B49\u78BC","maxlength","6",1,"form-input","code-input",3,"ngModelChange","ngModel"],[1,"resend-section"],[1,"resend-btn",3,"click","disabled"],["type","password","placeholder","\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input",3,"ngModelChange","ngModel"],[1,"import-mode-tabs"],[1,"mode-tab",3,"click"],[1,"badge-recommend"],[1,"btn-primary",3,"disabled"],[1,"tdata-path-hint"],[1,"path-box"],[1,"path-actions"],["title","\u8907\u88FD\u8DEF\u5F91",1,"icon-btn",3,"click"],["title","\u6253\u958B\u6587\u4EF6\u593E",1,"icon-btn",3,"click"],[1,"drop-zone","large",3,"dragover","dragleave","drop"],[1,"drop-icon"],[1,"drop-text"],[1,"drop-hint"],[1,"drop-buttons"],[1,"select-btn",3,"click"],[1,"select-btn","secondary",3,"click"],[1,"scanning-indicator"],[1,"scan-result","success"],[1,"scan-result","error"],[1,"accounts-list"],[1,"account-item",3,"disabled"],[1,"account-item"],["type","checkbox",3,"change","checked","disabled"],[1,"account-info"],[1,"account-phone"],[1,"account-name"],[1,"account-error"],[1,"error-icon"],[1,"tdata-info"],[1,"drop-zone",3,"dragover","dragleave","drop","click"],[1,"selected-file"],[1,"file-icon"],[1,"file-path"],[1,"clear-btn",3,"click"],[1,"device-options"],[1,"device-btn",3,"click"],["type","text","placeholder","socks5://host:port",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"click"],[1,"qr-section"],[1,"qr-container"],["alt","QR Code",1,"qr-image",3,"src"],[1,"qr-countdown"],[1,"qr-instructions"],[1,"success-icon"],[1,"form-actions","center"],[1,"account-card"],[1,"account-avatar"],[1,"account-details"],[1,"account-username"],[1,"api-info"],[1,"api-badge","expert"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"button",2),b("click",function(){return n.goBack()}),l(3," \u2190 \u8FD4\u56DE\u5E33\u6236\u5217\u8868 "),a(),s(4,"h1",3),l(5,"\u2795 \u6DFB\u52A0\u65B0\u5E33\u6236"),a()(),s(6,"div",4)(7,"div",5)(8,"span",6),l(9,"1"),a(),s(10,"span",7),l(11,"\u9078\u64C7 API"),a()(),k(12,"div",8),s(13,"div",5)(14,"span",6),l(15,"2"),a(),s(16,"span",7),l(17,"\u767B\u5165\u5E33\u865F"),a()(),k(18,"div",8),s(19,"div",5)(20,"span",6),l(21,"3"),a(),s(22,"span",7),l(23,"\u5B8C\u6210"),a()()(),w(24,E1,12,2,"div",9),w(25,A1,64,0,"div",10),w(26,O1,7,1,"div",11),w(27,nC,19,7,"div",11),w(28,rC,21,8,"div",11),w(29,cC,11,1,"div",12),a()),t&2&&(d(7),I("active",n.currentStep()>=1)("completed",n.currentStep()>1),d(5),I("active",n.currentStep()>1),d(),I("active",n.currentStep()>=2)("completed",n.currentStep()>2),d(5),I("active",n.currentStep()>2),d(),I("active",n.currentStep()>=3),d(5),E(n.currentStep()===1?24:-1),d(),E(n.currentStep()===2&&n.currentLoginMethod()==="select"?25:-1),d(),E(n.currentStep()===2&&n.currentLoginMethod()==="code"?26:-1),d(),E(n.currentStep()===2&&n.currentLoginMethod()==="tdata"?27:-1),d(),E(n.currentStep()===2&&n.currentLoginMethod()==="qr"?28:-1),d(),E(n.currentStep()===3?29:-1))},dependencies:[oe,ue,xe,fe,Kn,_e,dn],styles:[".add-account-page[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:2rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem;margin-bottom:.5rem;padding:0}.back-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-title[_ngcontent-%COMP%]{margin:0;font-size:2rem;color:var(--text-primary, white)}.step-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:2rem;flex-wrap:wrap;gap:.5rem}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.step-number[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:var(--bg-tertiary, rgba(15, 23, 42, .5));display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.step-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%]{color:var(--text-primary, white)}.step-line[_ngcontent-%COMP%]{width:40px;height:2px;background:var(--bg-tertiary, rgba(15, 23, 42, .5))}.step-line.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4)}.mode-selection[_ngcontent-%COMP%], .login-selection[_ngcontent-%COMP%]{text-align:center}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .selection-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-primary, white);font-size:1.5rem}.section-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .selection-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 2rem;color:var(--text-muted, #94a3b8)}.mode-cards[_ngcontent-%COMP%], .login-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-bottom:2rem}@media(max-width:700px){.mode-cards[_ngcontent-%COMP%], .login-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}}.login-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}@media(max-width:800px){.login-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}}.mode-card[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:2px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;padding:1.5rem;cursor:pointer;transition:all .2s;position:relative;text-align:left}.mode-card[_ngcontent-%COMP%]:hover, .login-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 24px #0003}.mode-card.expert[_ngcontent-%COMP%]:hover{border-color:#22c55e}.mode-card.platform[_ngcontent-%COMP%]:hover{border-color:#06b6d4}.mode-card.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.mode-card.disabled[_ngcontent-%COMP%]:hover{transform:none}.login-card.recommended[_ngcontent-%COMP%]:hover{border-color:#22c55e}.login-card.safe[_ngcontent-%COMP%]:hover{border-color:#06b6d4}.login-card.warning[_ngcontent-%COMP%]:hover{border-color:#f59e0b}.mode-badge[_ngcontent-%COMP%], .login-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;right:1rem;padding:.25rem .75rem;border-radius:1rem;font-size:.7rem;font-weight:600}.mode-card.expert[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.mode-card.platform[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.login-card.recommended[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.login-card.safe[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.login-card.warning[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#f59e0b;color:#000}.mode-icon[_ngcontent-%COMP%], .login-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:.75rem}.mode-title[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-primary, white);font-size:1.25rem}.mode-subtitle[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:.875rem;color:var(--text-muted, #94a3b8)}.mode-features[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;font-size:.8rem}.mode-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.375rem;color:var(--text-secondary, #cbd5e1)}.mode-suitable[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);margin-bottom:1rem}.mode-risk[_ngcontent-%COMP%], .login-risk[_ngcontent-%COMP%]{padding:.375rem .75rem;border-radius:.5rem;font-size:.7rem;font-weight:500;display:inline-block;margin-bottom:1rem}.mode-risk.safe[_ngcontent-%COMP%], .login-risk.lowest[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.mode-risk.medium[_ngcontent-%COMP%], .login-risk.low[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.login-risk.high[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.quota-info[_ngcontent-%COMP%]{margin-bottom:1rem}.quota-bar[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.75rem;border-radius:.5rem}.quota-label[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8);margin-bottom:.375rem}.quota-progress[_ngcontent-%COMP%]{height:6px;background:var(--bg-tertiary, rgba(15, 23, 42, .8));border-radius:3px;overflow:hidden;margin-bottom:.375rem}.quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#22c55e);border-radius:3px}.quota-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #cbd5e1)}.quota-locked[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem;background:#f59e0b1a;border-radius:.5rem;font-size:.75rem;color:#fcd34d}.mode-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:none;border-radius:.5rem;font-weight:500;cursor:pointer;transition:all .2s}.mode-card.expert[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.mode-card.platform[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.mode-btn.upgrade[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#ef4444)}.help-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;text-align:left}@media(max-width:600px){.help-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.help-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .5));padding:1rem;border-radius:.75rem}.help-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.help-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.config-section[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.form-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.required[_ngcontent-%COMP%]{color:#ef4444}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;box-sizing:border-box}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.form-input.error[_ngcontent-%COMP%]{border-color:#ef4444;background:#ef44440d}.form-input.valid[_ngcontent-%COMP%]{border-color:#22c55e}.input-with-prefix[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-with-prefix[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1;padding-right:2.5rem}.input-status[_ngcontent-%COMP%]{position:absolute;right:.75rem;font-size:1rem}.input-status.valid[_ngcontent-%COMP%]{color:#22c55e}.form-input.code-input[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;letter-spacing:.5rem}.hint[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:var(--text-muted, #64748b)}.error-text[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:#ef4444}.guide-box[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:1rem;border-radius:.5rem;margin-bottom:1rem}.guide-box[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--text-primary, white)}.guide-box[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:0;padding-left:1.25rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.guide-box[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.375rem}.guide-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.warning-box[_ngcontent-%COMP%], .risk-warning[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding:1rem;background:#f59e0b1a;border:1px solid rgba(245,158,11,.3);border-radius:.5rem}.warning-icon[_ngcontent-%COMP%]{font-size:1.25rem}.warning-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#fcd34d;margin-bottom:.375rem;font-size:.875rem}.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding-left:1rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:0}.quota-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem}.membership-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.level-icon[_ngcontent-%COMP%]{font-size:2rem}.level-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.level-name[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--text-primary, white)}.level-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.quota-item[_ngcontent-%COMP%]{margin-bottom:1rem}.quota-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem}.quota-title[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.quota-value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-primary, white)}.quota-bar-large[_ngcontent-%COMP%]{height:8px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:4px;overflow:hidden}.quota-bar-large[_ngcontent-%COMP%]   .quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#22c55e)}.quota-summary[_ngcontent-%COMP%]{margin-top:1rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;text-align:center}.summary-good[_ngcontent-%COMP%]{color:#22c55e}.summary-bad[_ngcontent-%COMP%]{color:#ef4444}.upgrade-prompt[_ngcontent-%COMP%]{margin-top:1rem;text-align:center;padding:1rem;background:linear-gradient(135deg,#f59e0b1a,#ef44441a);border-radius:.5rem}.upgrade-prompt[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:#fcd34d}.btn-upgrade[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#ef4444);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.5rem;cursor:pointer}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;margin-top:1.5rem}.form-actions.center[_ngcontent-%COMP%]{justify-content:center}.btn-primary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;transition:all .2s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .3));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer}.device-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}.device-btn[_ngcontent-%COMP%]{padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.device-btn[_ngcontent-%COMP%]:hover, .device-btn.active[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--border-default, rgba(148, 163, 184, .3));border-radius:.75rem;padding:3rem;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:1rem}.drop-zone[_ngcontent-%COMP%]:hover, .drop-zone.dragging[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d40d}.drop-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:.75rem}.drop-text[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.drop-hint[_ngcontent-%COMP%]{margin:.5rem 0 0;font-size:.8rem;color:var(--text-muted, #94a3b8)}.selected-file[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.file-path[_ngcontent-%COMP%]{flex:1;color:var(--text-primary, white);font-size:.875rem;word-break:break-all}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:1.25rem}.qr-section[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.qr-container[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:.75rem;display:inline-block;margin-bottom:.75rem}.qr-image[_ngcontent-%COMP%]{width:180px;height:180px;display:block}.qr-countdown[_ngcontent-%COMP%]{font-size:1rem;color:var(--primary, #06b6d4);margin-bottom:.75rem}.qr-countdown.warning[_ngcontent-%COMP%]{color:#f59e0b;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.qr-instructions[_ngcontent-%COMP%]{text-align:left;display:inline-block;background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.75rem 1.25rem;border-radius:.5rem}.qr-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0;color:var(--text-muted, #94a3b8);font-size:.8rem}.code-sent-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#22c55e1a;border-radius:.5rem;margin-bottom:1rem;color:#86efac}.resend-section[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.resend-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem}.resend-btn[_ngcontent-%COMP%]:disabled{color:var(--text-muted, #94a3b8);cursor:not-allowed}.tdata-info[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:1rem;border-radius:.5rem;margin-bottom:1rem}.tdata-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.tdata-info[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.import-mode-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid transparent;border-radius:.5rem;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s;position:relative}.mode-tab[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8));color:var(--text-primary, white)}.mode-tab.active[_ngcontent-%COMP%]{background:var(--bg-secondary, rgba(30, 41, 59, .8));border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.badge-recommend[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#10b981,#059669);color:#fff;font-size:.65rem;padding:2px 6px;border-radius:4px}.tdata-path-hint[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border, rgba(100, 116, 139, .3));border-radius:.5rem;padding:1rem;margin-bottom:1rem}.tdata-path-hint[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.path-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:var(--bg-primary, rgba(2, 6, 23, .8));padding:.5rem 1rem;border-radius:.375rem}.path-box[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:.8rem;color:var(--primary, #06b6d4);word-break:break-all}.path-actions[_ngcontent-%COMP%]{display:flex;gap:.25rem}.icon-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:none;cursor:pointer;opacity:.7;transition:opacity .2s}.icon-btn[_ngcontent-%COMP%]:hover{opacity:1}.drop-zone.large[_ngcontent-%COMP%]{padding:2rem;min-height:180px}.drop-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem}.select-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);color:#fff;border:none;border-radius:.375rem;cursor:pointer;transition:background .2s}.select-btn[_ngcontent-%COMP%]:hover{background:var(--primary-dark, #0891b2)}.select-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border, rgba(100, 116, 139, .3))}.select-btn.secondary[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.scan-result[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;padding:1rem;margin:1rem 0}.scan-result.success[_ngcontent-%COMP%]{border:1px solid rgba(16,185,129,.3)}.scan-result.error[_ngcontent-%COMP%]{border:1px solid rgba(239,68,68,.3);display:flex;align-items:center;gap:.5rem;color:#f87171}.scan-result[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--text-primary, white)}.accounts-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto}.account-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem;background:var(--bg-primary, rgba(2, 6, 23, .8));border-radius:.375rem;cursor:pointer;transition:background .2s}.account-item[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.account-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.account-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem}.account-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.125rem}.account-phone[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-primary, white)}.account-name[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.account-error[_ngcontent-%COMP%]{font-size:.7rem;color:#f87171}.scanning-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--text-muted, #94a3b8)}.success-section[_ngcontent-%COMP%]{text-align:center;padding:2rem}.success-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.success-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--text-primary, white)}.account-card[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:1rem;padding:1rem 2rem;background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;margin-bottom:1rem}.account-avatar[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#fff}.account-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.account-phone[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1)}.account-username[_ngcontent-%COMP%]{font-size:.875rem;color:var(--primary, #06b6d4)}.api-info[_ngcontent-%COMP%]{margin:1rem 0}.api-badge[_ngcontent-%COMP%]{display:inline-block;padding:.5rem 1rem;border-radius:2rem;font-size:.8rem}.api-badge.expert[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.api-badge.platform[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};var fo=(i,e)=>e.key,dC=(i,e)=>e.id,uC=(i,e)=>e.name;function mC(i,e){if(i&1){let t=T();s(0,"button",53),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.filterTemplateCategory.set(o.key))}),l(1),a()}if(i&2){let t=e.$implicit,n=f(3);I("bg-blue-500",n.filterTemplateCategory()===t.key)("text-white",n.filterTemplateCategory()===t.key)("bg-slate-700",n.filterTemplateCategory()!==t.key)("text-slate-400",n.filterTemplateCategory()!==t.key),d(),Y(" ",t.icon," ",t.label," ")}}function pC(i,e){i&1&&(s(0,"div",50),te(),s(1,"svg",54),k(2,"circle",55)(3,"path",56),a(),le(),s(4,"span",57),l(5,"\u8F09\u5165\u6A21\u677F..."),a()())}function gC(i,e){i&1&&(s(0,"div",51)(1,"p"),l(2,"\u6C92\u6709\u627E\u5230\u6A21\u677F"),a(),s(3,"p",58),l(4,"\u8ACB\u5148\u5230\u300C\u804A\u5929\u6A21\u677F\u300D\u9801\u9762\u5275\u5EFA\u6A21\u677F"),a()())}function hC(i,e){if(i&1){let t=T();s(0,"button",60),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.selectTemplate(o))}),s(1,"div",61)(2,"span",62),l(3),a(),s(4,"span",23),l(5),a()(),s(6,"p",63),l(7),a()()}if(i&2){let t,n,o,r,c,m=e.$implicit,h=f(4);I("border-blue-500",((t=h.selectedTemplate())==null?null:t.id)===m.id)("bg-blue-500/10",((n=h.selectedTemplate())==null?null:n.id)===m.id)("border-slate-600",((o=h.selectedTemplate())==null?null:o.id)!==m.id)("bg-slate-800/50",((r=h.selectedTemplate())==null?null:r.id)!==m.id)("hover:border-slate-500",((c=h.selectedTemplate())==null?null:c.id)!==m.id),d(3),M(m.name),d(2),A("\u4F7F\u7528 ",m.usageCount," \u6B21"),d(2),M(m.content)}}function fC(i,e){if(i&1&&(s(0,"div",52),$(1,hC,8,13,"button",59,dC),a()),i&2){let t=f(3);d(),H(t.filteredTemplates())}}function _C(i,e){if(i&1){let t=T();s(0,"div",17)(1,"div",45)(2,"label",46),l(3,"\u9078\u64C7\u804A\u5929\u6A21\u677F"),a(),s(4,"button",47),b("click",function(){v(t);let o=f(2);return x(o.loadTemplates())}),l(5," \u{1F504} \u5237\u65B0 "),a()(),s(6,"div",48),$(7,mC,2,10,"button",49,fo),a(),w(9,pC,6,0,"div",50)(10,gC,5,0,"div",51)(11,fC,3,0,"div",52),a()}if(i&2){let t=f(2);d(7),H(t.templateCategories),d(2),E(t.isLoadingTemplates()?9:t.filteredTemplates().length===0?10:11)}}function CC(i,e){if(i&1&&(k(0,"span",73),s(1,"span"),l(2),a()),i&2){let t=f(4);d(2),A("\u5DF2\u9023\u63A5 ",t.aiStatus().model)}}function vC(i,e){i&1&&(k(0,"span",74),s(1,"span"),l(2,"\u4F7F\u7528\u672C\u5730\u6A21\u677F"),a())}function xC(i,e){if(i&1&&(s(0,"div",72),w(1,CC,3,1)(2,vC,3,0),a()),i&2){let t=f(3);I("bg-green-500/20",t.aiStatus().connected)("text-green-400",t.aiStatus().connected)("bg-amber-500/20",!t.aiStatus().connected)("text-amber-400",!t.aiStatus().connected),d(),E(t.aiStatus().connected?1:2)}}function bC(i,e){if(i&1){let t=T();s(0,"button",75),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.selectedAiStyle.set(o.key))}),l(1),a()}if(i&2){let t=e.$implicit,n=f(3);I("bg-purple-500",n.selectedAiStyle()===t.key)("text-white",n.selectedAiStyle()===t.key)("bg-slate-700",n.selectedAiStyle()!==t.key)("text-slate-400",n.selectedAiStyle()!==t.key),d(),A(" ",t.label," ")}}function SC(i,e){i&1&&(te(),s(0,"svg",76),k(1,"circle",55)(2,"path",56),a(),l(3," \u751F\u6210\u4E2D... "))}function yC(i,e){i&1&&l(0," \u2728 \u751F\u6210 5 \u7A2E\u4E0D\u540C\u8868\u9054 ")}function wC(i,e){if(i&1){let t=T();s(0,"label",82)(1,"input",83),b("change",function(){let o=v(t).$implicit,r=f(4);return x(r.toggleMessageSelection(o))}),a(),s(2,"span",84),l(3),a()()}if(i&2){let t=e.$implicit,n=f(4);I("border-purple-500",n.isMessageSelected(t))("bg-purple-500/10",n.isMessageSelected(t))("border-slate-600",!n.isMessageSelected(t))("bg-slate-800/50",!n.isMessageSelected(t)),d(),V("checked",n.isMessageSelected(t)),d(2),M(t)}}function EC(i,e){if(i&1){let t=T();s(0,"button",89),b("click",function(){let o=v(t).$implicit,r=f(5);return x(r.setSendStrategy(o.key))}),l(1),a()}if(i&2){let t=e.$implicit,n=f(5);I("bg-purple-500",n.sendStrategy()===t.key)("text-white",n.sendStrategy()===t.key)("bg-slate-700",n.sendStrategy()!==t.key)("text-slate-400",n.sendStrategy()!==t.key),V("title",t.desc),d(),A(" ",t.label," ")}}function AC(i,e){if(i&1&&(s(0,"div",81)(1,"span",85),l(2,"\u{1F4E4} \u767C\u9001\u7B56\u7565\uFF1A"),a(),s(3,"div",86),$(4,EC,2,10,"button",87,fo),a(),s(6,"p",88),l(7),a()()),i&2){let t=f(4);d(4),H(t.sendStrategies),d(3),A(" ",t.getStrategyDescription()," ")}}function DC(i,e){if(i&1){let t=T();s(0,"div",71)(1,"div",5)(2,"span",77),l(3),a(),s(4,"div",15)(5,"button",78),b("click",function(){v(t);let o=f(3);return x(o.selectAllMessages())}),l(6," \u5168\u9078 "),a(),s(7,"button",79),b("click",function(){v(t);let o=f(3);return x(o.clearSelectedMessages())}),l(8," \u6E05\u9664 "),a()()(),$(9,wC,4,10,"label",80,gt),w(11,AC,8,1,"div",81),a()}if(i&2){let t=f(3);d(3),A("\u53EF\u591A\u9078\u6A21\u677F\uFF08\u5DF2\u9078 ",t.selectedMessages().size," \u500B\uFF09\uFF1A"),d(6),H(t.aiGeneratedMessages()),d(2),E(t.selectedMessages().size>1?11:-1)}}function MC(i,e){if(i&1){let t=T();s(0,"div",18)(1,"div",45)(2,"label",64),l(3,"\u{1F916} AI \u667A\u80FD\u751F\u6210"),a(),w(4,xC,3,9,"div",65),a(),s(5,"div",66)(6,"div")(7,"span",67),l(8,"\u8A9E\u8A00\u98A8\u683C\uFF1A"),a(),s(9,"div",37),$(10,bC,2,9,"button",68,fo),a()(),s(12,"div")(13,"span",67),l(14,"\u6D88\u606F\u4E3B\u984C\uFF1A"),a(),s(15,"input",69),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.aiTopic,o)||(r.aiTopic=o),x(o)}),a()(),s(16,"button",70),b("click",function(){v(t);let o=f(2);return x(o.generateAiMessage())}),w(17,SC,4,0)(18,yC,1,0),a(),w(19,DC,12,2,"div",71),a()()}if(i&2){let t=f(2);d(4),E(t.aiStatus().source!=="unknown"?4:-1),d(6),H(t.aiStyles),d(5),K("ngModel",t.aiTopic),d(),V("disabled",t.isGeneratingAi()||!t.aiTopic.trim()),d(),E(t.isGeneratingAi()?17:18),d(2),E(t.aiGeneratedMessages().length>0?19:-1)}}function TC(i,e){if(i&1&&(s(0,"span",20),l(1),a()),i&2){let t,n=f(2);d(),A("\uFF08\u4F7F\u7528\u6A21\u677F\uFF1A",(t=n.selectedTemplate())==null?null:t.name,"\uFF09")}}function IC(i,e){if(i&1){let t=T();s(0,"button",90),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.insertVariable(o.key))}),s(1,"span",31),l(2),a(),s(3,"span",91),l(4,"|"),a(),s(5,"span",92),l(6),a()()}if(i&2){let t=e.$implicit;V("title","\u63D2\u5165 "+t.key),d(2),M(t.key),d(4),M(t.label)}}function kC(i,e){if(i&1){let t=T();s(0,"div",93)(1,"span",94),l(2),a(),s(3,"span",95),l(4),a(),s(5,"button",96),b("click",function(){let o=v(t).$index,r=f(3);return x(r.removeAttachment(o))}),te(),s(6,"svg",97),k(7,"path",12),a()()()}if(i&2){let t=e.$implicit;d(2),M(t.type.startsWith("image")?"\u{1F5BC}\uFE0F":"\u{1F4C4}"),d(2),M(t.name)}}function PC(i,e){if(i&1&&(s(0,"div",27),$(1,kC,8,2,"div",93,uC),a()),i&2){let t=f(2);d(),H(t.attachments())}}function FC(i,e){if(i&1&&(s(0,"span",38),l(1),a()),i&2){let t=e.$implicit;d(),A(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function RC(i,e){if(i&1&&(s(0,"span",39),l(1),a()),i&2){let t=f(2);d(),A(" +",t.targets().length-20," \u66F4\u591A... ")}}function NC(i,e){if(i&1&&(s(0,"div",103),l(1),a()),i&2){let t=f(3);d(),A(" \u{1F4E8} \u6B63\u5728\u767C\u9001\u7D66: ",t.currentTarget()," ")}}function BC(i,e){if(i&1&&(s(0,"span",106),l(1),a()),i&2){let t=e.$implicit;d(),Y(" ",t.label,": ",t.count," ")}}function VC(i,e){if(i&1&&(s(0,"div",104)(1,"div",105),l(2,"\u5931\u6557\u539F\u56E0\uFF1A"),a(),s(3,"div",37),$(4,BC,2,2,"span",106,gt),a()()),i&2){let t=f(3);d(4),H(t.failureReasonsList())}}function LC(i,e){if(i&1&&(s(0,"div",40)(1,"div",98)(2,"span",99),l(3,"\u767C\u9001\u9032\u5EA6"),a(),s(4,"span",9),l(5),a()(),s(6,"div",100),k(7,"div",101),a(),s(8,"div",102)(9,"span"),l(10),a(),s(11,"span"),l(12),a(),s(13,"span"),l(14),a()(),w(15,NC,2,1,"div",103),w(16,VC,6,0,"div",104),a()),i&2){let t=f(2);d(5),Y("",t.sentCount()," / ",t.targets().length),d(2),j("width",t.progressPercent(),"%"),d(3),A("\u2705 \u6210\u529F: ",t.successCount()),d(2),A("\u274C \u5931\u6557: ",t.failedCount()),d(2),A("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining()),d(),E(t.currentTarget()?15:-1),d(),E(t.failedCount()>0&&t.failureReasonsList().length>0?16:-1)}}function OC(i,e){i&1&&(s(0,"span",107),l(1,"\u23F3"),a(),l(2," \u767C\u9001\u4E2D... "))}function GC(i,e){if(i&1&&l(0),i&2){let t=f(2);A(" \u{1F4E8} \u958B\u59CB\u767C\u9001 (",t.targets().length," \u4EBA) ")}}function UC(i,e){if(i&1){let t=T();s(0,"div",2),b("click",function(o){v(t);let r=f();return x(r.onBackdropClick(o))}),s(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),l(6," \u{1F4E8} "),a(),s(7,"div")(8,"h2",8),l(9,"\u6279\u91CF\u767C\u9001\u6D88\u606F"),a(),s(10,"p",9),l(11),a()()(),s(12,"button",10),b("click",function(){v(t);let o=f();return x(o.close())}),te(),s(13,"svg",11),k(14,"path",12),a()()()(),le(),s(15,"div",13)(16,"div")(17,"label",14),l(18," \u{1F4DD} \u6D88\u606F\u4F86\u6E90 "),a(),s(19,"div",15)(20,"button",16),b("click",function(){v(t);let o=f();return x(o.setMessageSource("template"))}),l(21," \u{1F4C4} \u804A\u5929\u6A21\u677F "),a(),s(22,"button",16),b("click",function(){v(t);let o=f();return x(o.setMessageSource("custom"))}),l(23," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),a(),s(24,"button",16),b("click",function(){v(t);let o=f();return x(o.setMessageSource("ai"))}),l(25," \u{1F916} AI \u751F\u6210 "),a()()(),w(26,_C,12,1,"div",17),w(27,MC,20,5,"div",18),s(28,"div")(29,"label",19),l(30," \u{1F4DD} \u6D88\u606F\u5167\u5BB9 "),w(31,TC,2,1,"span",20),a(),s(32,"textarea",21),W("ngModelChange",function(o){v(t);let r=f();return z(r.messageContent,o)||(r.messageContent=o),x(o)}),l(33,"              "),a(),s(34,"div",22)(35,"span",23),l(36,"\u53EF\u7528\u8B8A\u91CF\uFF1A"),a(),$(37,IC,7,3,"button",24,fo),a()(),s(39,"div")(40,"label",19),l(41," \u{1F4CE} \u9644\u4EF6\uFF08\u53EF\u9078\uFF09 "),a(),s(42,"div",25)(43,"button",26),b("click",function(){v(t);let o=f();return x(o.selectImages())}),l(44," \u{1F5BC}\uFE0F \u6DFB\u52A0\u5716\u7247 "),a(),s(45,"button",26),b("click",function(){v(t);let o=f();return x(o.selectFiles())}),l(46," \u{1F4C4} \u6DFB\u52A0\u6587\u4EF6 "),a()(),w(47,PC,3,0,"div",27),a(),s(48,"div",17)(49,"label",14),l(50," \u2699\uFE0F \u767C\u9001\u8A2D\u7F6E "),a(),s(51,"div",28)(52,"div",6)(53,"span",29),l(54,"\u767C\u9001\u9593\u9694\uFF1A"),a(),s(55,"input",30),W("ngModelChange",function(o){v(t);let r=f();return z(r.minInterval,o)||(r.minInterval=o),x(o)}),a(),s(56,"span",31),l(57,"-"),a(),s(58,"input",32),W("ngModelChange",function(o){v(t);let r=f();return z(r.maxInterval,o)||(r.maxInterval=o),x(o)}),a(),s(59,"span",9),l(60,"\u79D2\uFF08\u96A8\u6A5F\uFF09"),a()(),s(61,"div",6)(62,"span",29),l(63,"\u5E33\u865F\u8F2A\u63DB\uFF1A"),a(),s(64,"label",33)(65,"input",34),W("ngModelChange",function(o){v(t);let r=f();return z(r.accountRotation,o)||(r.accountRotation=o),x(o)}),a(),k(66,"div",35),a(),s(67,"span",9),l(68,"\u555F\u7528\u591A\u5E33\u865F\u8F2A\u63DB\u767C\u9001"),a()()()(),s(69,"div")(70,"label",19),l(71),a(),s(72,"div",36)(73,"div",37),$(74,FC,2,1,"span",38,gt),w(76,RC,2,1,"span",39),a()()()(),w(77,LC,17,9,"div",40),s(78,"div",41)(79,"button",42),b("click",function(){v(t);let o=f();return x(o.close())}),l(80),a(),s(81,"button",43),b("click",function(){v(t);let o=f();return x(o.previewMessage())}),l(82," \u{1F441}\uFE0F \u9810\u89BD "),a(),s(83,"button",44),b("click",function(){v(t);let o=f();return x(o.startSending())}),w(84,OC,3,0)(85,GC,1,1),a()()()()}if(i&2){let t=f();d(11),A("\u5411 ",t.targets().length," \u500B\u7528\u6236\u767C\u9001\u6D88\u606F"),d(9),I("border-blue-500",t.messageSource()==="template")("bg-blue-500/20",t.messageSource()==="template")("text-blue-400",t.messageSource()==="template")("border-slate-600",t.messageSource()!=="template")("bg-slate-800/50",t.messageSource()!=="template")("text-slate-400",t.messageSource()!=="template"),d(2),I("border-cyan-500",t.messageSource()==="custom")("bg-cyan-500/20",t.messageSource()==="custom")("text-cyan-400",t.messageSource()==="custom")("border-slate-600",t.messageSource()!=="custom")("bg-slate-800/50",t.messageSource()!=="custom")("text-slate-400",t.messageSource()!=="custom"),d(2),I("border-purple-500",t.messageSource()==="ai")("bg-purple-500/20",t.messageSource()==="ai")("text-purple-400",t.messageSource()==="ai")("border-slate-600",t.messageSource()!=="ai")("bg-slate-800/50",t.messageSource()!=="ai")("text-slate-400",t.messageSource()!=="ai"),d(2),E(t.messageSource()==="template"?26:-1),d(),E(t.messageSource()==="ai"?27:-1),d(4),E(t.messageSource()==="template"&&t.selectedTemplate()?31:-1),d(),K("ngModel",t.messageContent),d(5),H(t.availableVariables),d(10),E(t.attachments().length>0?47:-1),d(8),K("ngModel",t.minInterval),d(3),K("ngModel",t.maxInterval),d(7),K("ngModel",t.accountRotation),d(6),A(" \u{1F465} \u767C\u9001\u76EE\u6A19\uFF08",t.targets().length," \u4EBA\uFF09 "),d(3),H(t.targets().slice(0,20)),d(2),E(t.targets().length>20?76:-1),d(),E(t.isSending()?77:-1),d(2),V("disabled",t.isSending()),d(),A(" ",t.isSending()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),d(),V("disabled",!t.canSend()||t.isSending()),d(2),V("disabled",!t.canSend()||t.isSending()),d(),E(t.isSending()?84:85)}}function qC(i,e){if(i&1&&(s(0,"div",111),l(1),a()),i&2){let t=f(2);d(),A(" \u{1F4CE} \u5305\u542B ",t.attachments().length," \u500B\u9644\u4EF6 ")}}function $C(i,e){if(i&1){let t=T();s(0,"div",1)(1,"div",108)(2,"h3",109),l(3,"\u{1F4F1} \u6D88\u606F\u9810\u89BD"),a(),s(4,"div",110),l(5),a(),w(6,qC,2,1,"div",111),s(7,"button",112),b("click",function(){v(t);let o=f();return x(o.showPreview.set(!1))}),l(8," \u95DC\u9589 "),a()()()}if(i&2){let t=f();d(5),A(" ",t.previewText()," "),d(),E(t.attachments().length>0?6:-1)}}var ho=class i{constructor(){this.ipc=B(De);this.toast=B(me);this.listeners=[];this.isOpen=tt(!1);this.targets=tt([]);this.closeDialog=Ee();this.sendComplete=Ee();this.messageSource=C("custom");this.chatTemplates=C([]);this.isLoadingTemplates=C(!1);this.selectedTemplate=C(null);this.filterTemplateCategory=C("all");this.templateCategories=[{key:"all",icon:"\u{1F4CB}",label:"\u5168\u90E8"},{key:"greeting",icon:"\u{1F44B}",label:"\u554F\u5019\u8A9E"},{key:"follow_up",icon:"\u{1F4E9}",label:"\u8DDF\u9032\u6D88\u606F"},{key:"promotion",icon:"\u{1F4E2}",label:"\u63A8\u5EE3\u6D88\u606F"},{key:"custom",icon:"\u270F\uFE0F",label:"\u81EA\u5B9A\u7FA9"}];this.filteredTemplates=L(()=>{let e=this.filterTemplateCategory(),t=this.chatTemplates();return e==="all"?t.filter(n=>n.isEnabled):t.filter(n=>n.isEnabled&&n.category===e)});this.selectedAiStyle=C("friendly");this.aiTopic="";this.isGeneratingAi=C(!1);this.aiGeneratedMessages=C([]);this.aiStatus=C({connected:!1,model:null,source:"unknown"});this.selectedMessages=C(new Set);this.sendStrategy=C("random");this.sendStrategies=[{key:"random",label:"\u{1F3B2} \u96A8\u6A5F\u767C\u9001",desc:"\u6BCF\u500B\u7528\u6236\u96A8\u6A5F\u9078\u64C7\u4E00\u500B\u6A21\u677F"},{key:"rotate",label:"\u{1F504} \u8F2A\u8F49\u767C\u9001",desc:"\u4F9D\u6B21\u4F7F\u7528\u6A21\u677F\uFF081\u21922\u21923\u21921...\uFF09"},{key:"sequential",label:"\u{1F4CB} \u9806\u5E8F\u767C\u9001",desc:"\u6309\u9806\u5E8F\u7528\u5B8C\u518D\u91CD\u8907"}];this.aiStyles=[{key:"friendly",label:"\u53CB\u597D\u89AA\u5207"},{key:"formal",label:"\u6B63\u5F0F\u5546\u52D9"},{key:"humorous",label:"\u8F15\u9B06\u5E7D\u9ED8"},{key:"concise",label:"\u7C21\u6F54\u660E\u4E86"},{key:"enthusiastic",label:"\u71B1\u60C5\u6D0B\u6EA2"}];this.messageContent="";this.attachments=C([]);this.minInterval=30;this.maxInterval=60;this.accountRotation=!0;this.availableVariables=[{key:"{firstName}",label:"\u540D\u5B57"},{key:"{lastName}",label:"\u59D3\u6C0F"},{key:"{username}",label:"\u7528\u6236\u540D"},{key:"{name}",label:"\u986F\u793A\u540D"},{key:"{fullName}",label:"\u5168\u540D"},{key:"{groupName}",label:"\u4F86\u6E90\u7FA4\u7D44"},{key:"{keyword}",label:"\u89F8\u767C\u95DC\u9375\u8A5E"},{key:"{source}",label:"\u4F86\u6E90\u6E20\u9053"},{key:"{greeting}",label:"\u554F\u5019\u8A9E"},{key:"{date}",label:"\u65E5\u671F"},{key:"{time}",label:"\u6642\u9593"},{key:"{day}",label:"\u661F\u671F"}];this.isSending=C(!1);this.sentCount=C(0);this.successCount=C(0);this.failedCount=C(0);this.currentTarget=C("");this.failureReasons=C({});this.failureReasonLabels={privacy_restricted:"\u{1F512} \u96B1\u79C1\u9650\u5236",flood_wait:"\u23F1\uFE0F API \u9650\u5236",user_not_found:"\u2753 \u7528\u6236\u4E0D\u5B58\u5728",user_blocked:"\u{1F6AB} \u88AB\u5C01\u9396",invalid_id:"\u26A0\uFE0F \u7121\u6548 ID",no_account:"\u{1F4F1} \u7121\u53EF\u7528\u5E33\u865F",cancelled:"\u23F9\uFE0F \u5DF2\u53D6\u6D88",other:"\u274C \u5176\u4ED6\u932F\u8AA4"};this.showPreview=C(!1);this.progressPercent=L(()=>{let e=this.targets().length;return e>0?this.sentCount()/e*100:0});this.failureReasonsList=L(()=>{let e=this.failureReasons();return Object.keys(e).map(t=>({key:t,label:this.failureReasonLabels[t]||t,count:e[t]}))});this.estimatedRemaining=L(()=>{let e=this.targets().length-this.sentCount(),t=(this.minInterval+this.maxInterval)/2,n=e*t;return n<60?`${Math.round(n)} \u79D2`:n<3600?`${Math.round(n/60)} \u5206\u9418`:`${Math.round(n/3600)} \u5C0F\u6642`});this.previewText=L(()=>{let e=this.targets()[0]||{};return this.replaceVariables(this.messageContent,e)});this.aiGenerateTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadTemplates()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-send:progress",r=>{this.sentCount.set(r.sent),this.successCount.set(r.success),this.failedCount.set(r.failed),r.currentTarget&&this.currentTarget.set(r.currentTarget),r.failureReasons&&this.failureReasons.set(r.failureReasons)});this.listeners.push(e);let t=this.ipc.on("batch-send:complete",r=>{if(this.isSending.set(!1),this.sendComplete.emit({success:r.success,failed:r.failed}),r.error)this.toast.error(`\u274C \u767C\u9001\u5931\u6557\uFF1A${r.error}`);else if(r.failed>0){let c=r.failureSummary||`\u5931\u6557 ${r.failed} \u500B`;this.toast.warning(`\u26A0\uFE0F \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${r.success}\uFF0C${c}`)}else this.toast.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${r.success} \u500B`);r.failureReasons&&this.failureReasons.set(r.failureReasons)});this.listeners.push(t);let n=this.ipc.on("get-chat-templates-result",r=>{this.isLoadingTemplates.set(!1),r.templates&&this.chatTemplates.set(r.templates)});this.listeners.push(n);let o=this.ipc.on("ai-generate-message-result",r=>{console.log("[AI] \u6536\u5230\u751F\u6210\u7D50\u679C:",r),this.aiGenerateTimeout&&(clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=null),this.isGeneratingAi.set(!1),r.success&&r.messages?(this.aiGeneratedMessages.set(r.messages),r.source==="ai"&&r.model?(this.aiStatus.set({connected:!0,model:r.model,source:"ai"}),this.toast.success(`\u{1F916} ${r.model} \u751F\u6210\u4E86 ${r.messages.length} \u689D\u6D88\u606F\uFF01`)):(this.aiStatus.set({connected:!1,model:null,source:"local"}),this.toast.info("\u{1F4CB} \u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F\u751F\u6210\u6D88\u606F"))):this.toast.error(r.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(o)}setMessageSource(e){this.messageSource.set(e),e==="template"&&this.loadTemplates()}loadTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectTemplate(e){this.selectedTemplate.set(e),this.messageContent=e.content,this.toast.info(`\u5DF2\u9078\u64C7\u6A21\u677F\uFF1A${e.name}`)}generateAiMessage(){if(!this.aiTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingAi.set(!0),this.aiGeneratedMessages.set([]),this.aiGenerateTimeout&&clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=setTimeout(()=>{this.isGeneratingAi()&&(this.isGeneratingAi.set(!1),this.toast.warning("AI \u751F\u6210\u8D85\u6642\uFF0C\u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F"),this.useLocalAiTemplates())},1e4),console.log("[AI] \u767C\u9001\u751F\u6210\u8ACB\u6C42:",{topic:this.aiTopic,style:this.selectedAiStyle()}),this.ipc.send("ai-generate-message",{topic:this.aiTopic,style:this.selectedAiStyle(),count:5,context:{targetCount:this.targets().length,sampleTarget:this.targets()[0]}})}useLocalAiTemplates(){let e=this.aiTopic||"\u6253\u62DB\u547C",t=this.selectedAiStyle(),n={friendly:["{greeting}\uFF01\u6211\u662F\u5728\u7FA4\u88E1\u770B\u5230\u4F60\u7684\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B~","Hi {name}\uFF01\u5F88\u9AD8\u8208\u80FD\u8A8D\u8B58\u4F60\uFF0C\u5E0C\u671B\u4EE5\u5F8C\u591A\u591A\u4EA4\u6D41 \u{1F60A}","{greeting}{name}\uFF0C\u6211\u89BA\u5F97\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u8A71\u984C\uFF0C\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F","\u55E8\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u60F3\u8DDF\u4F60\u4EA4\u500B\u670B\u53CB~",`{greeting}\uFF01\u6211\u662F${e}\u76F8\u95DC\u7684\uFF0C\u770B\u5230\u4F60\u4E5F\u5C0D\u9019\u500B\u611F\u8208\u8DA3\uFF1F`],formal:["{greeting}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u60A8\u3002\u6211\u6CE8\u610F\u5230\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u7684\u8208\u8DA3\u9EDE\uFF0C\u4E0D\u77E5\u662F\u5426\u65B9\u4FBF\u4EA4\u6D41\uFF1F",`\u60A8\u597D {name}\uFF0C\u5192\u6627\u6253\u64FE\u3002\u6211\u5C08\u6CE8\u65BC${e}\u9818\u57DF\uFF0C\u5E0C\u671B\u80FD\u8207\u60A8\u5EFA\u7ACB\u806F\u7E6B\u3002`,"{greeting}\uFF0C\u6211\u662F\u901A\u904E\u7FA4\u7D44\u8A8D\u8B58\u5230\u60A8\u7684\u3002\u5982\u6709\u5408\u4F5C\u6A5F\u6703\uFF0C\u671F\u5F85\u9032\u4E00\u6B65\u6E9D\u901A\u3002","\u5C0A\u656C\u7684 {name}\uFF0C\u5F88\u69AE\u5E78\u80FD\u5920\u8207\u60A8\u53D6\u5F97\u806F\u7E6B\u3002\u671F\u5F85\u672A\u4F86\u6709\u6A5F\u6703\u5408\u4F5C\u3002",`{greeting}\uFF0C\u6211\u5C0D${e}\u5F88\u611F\u8208\u8DA3\uFF0C\u770B\u5230\u60A8\u4E5F\u5728\u9019\u500B\u9818\u57DF\uFF0C\u60F3\u5411\u60A8\u8ACB\u6559\u3002`],humorous:["{greeting}\uFF01\u6211\u4E0D\u662F\u63A8\u92B7\u54E1\uFF0C\u53EA\u662F\u89BA\u5F97\u4F60\u770B\u8D77\u4F86\u5F88\u9177\u60F3\u8A8D\u8B58\u4E00\u4E0B \u{1F60E}",`Hi {name}\uFF01\u5225\u64D4\u5FC3\uFF0C\u6211\u53EA\u662F\u60F3\u804A\u804A${e}\u800C\u5DF2\uFF0C\u4E0D\u6703\u63A8\u92B7\u4EFB\u4F55\u6771\u897F \u{1F923}`,`{greeting}\uFF01\u80FD\u9047\u5230\u5C0D${e}\u611F\u8208\u8DA3\u7684\u4EBA\u771F\u662F\u592A\u96E3\u5F97\u4E86\uFF01`,"\u55E8\uFF01\u770B\u5230\u4F60\u5728\u7FA4\u88E1\u7684\u767C\u8A00\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u5FCD\u4E0D\u4F4F\u4F86\u6253\u500B\u62DB\u547C~","{greeting}\uFF01\u96E3\u5F97\u9047\u5230\u540C\u597D\uFF0C\u5FC5\u9808\u8A8D\u8B58\u4E00\u4E0B\uFF01"],concise:["{greeting}\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B\u3002",`Hi {name}\uFF0C\u95DC\u65BC${e}\u60F3\u548C\u4F60\u804A\u804A\u3002`,`\u60A8\u597D\uFF0C\u770B\u5230\u4F60\u5C0D${e}\u611F\u8208\u8DA3\uFF0C\u65B9\u4FBF\u4EA4\u6D41\u55CE\uFF1F`,`{greeting}\uFF0C\u6211\u4E5F\u95DC\u6CE8${e}\uFF0C\u4EA4\u500B\u670B\u53CB\uFF1F`,`Hi\uFF0C\u60F3\u8ACB\u6559\u4E00\u4E0B${e}\u76F8\u95DC\u7684\u554F\u984C\u3002`],enthusiastic:["{greeting}\uFF01\uFF01\u592A\u958B\u5FC3\u80FD\u8A8D\u8B58\u4F60\u4E86\uFF01\u{1F389}",`\u54C7\uFF01{name}\uFF01\u7D42\u65BC\u627E\u5230\u540C\u6A23\u559C\u6B61${e}\u7684\u4EBA\u4E86\uFF01\u2728`,"{greeting}\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u8D85\u8208\u596E\u7684\uFF01\u6211\u5011\u4E00\u5B9A\u6709\u5F88\u591A\u5171\u540C\u8A71\u984C\uFF01",`Hi {name}\uFF01\u2764\uFE0F \u8D85\u7D1A\u671F\u5F85\u548C\u4F60\u804A${e}\uFF01`,"{greeting}\uFF01\u9047\u5230\u4F60\u7C21\u76F4\u592A\u68D2\u4E86\uFF01\u{1F31F}"]},o=n[t]||n.friendly;this.aiGeneratedMessages.set(o),this.toast.info("\u5DF2\u751F\u6210\u672C\u5730\u6A21\u677F\u4F9B\u9078\u64C7")}selectAiMessage(e){this.messageContent=e}isMessageSelected(e){return this.selectedMessages().has(e)}toggleMessageSelection(e){let t=new Set(this.selectedMessages());t.has(e)?t.delete(e):t.add(e),this.selectedMessages.set(t),t.size===1?this.messageContent=Array.from(t)[0]:t.size>1?this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${t.size} \u500B\u6A21\u677F`:this.messageContent=""}selectAllMessages(){let e=new Set(this.aiGeneratedMessages());this.selectedMessages.set(e),this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${e.size} \u500B\u6A21\u677F`}clearSelectedMessages(){this.selectedMessages.set(new Set),this.messageContent=""}setSendStrategy(e){this.sendStrategy.set(e)}getStrategyDescription(){return{random:`\u5C07\u96A8\u6A5F\u9078\u64C7\u6A21\u677F\u767C\u9001\u7D66 ${this.targets().length} \u500B\u7528\u6236\uFF0C\u589E\u52A0\u6D88\u606F\u591A\u6A23\u6027`,rotate:"\u6A21\u677F\u5C07\u8F2A\u6D41\u4F7F\u7528\uFF0C\u78BA\u4FDD\u6BCF\u500B\u6A21\u677F\u88AB\u5747\u52FB\u4F7F\u7528",sequential:"\u6309\u9806\u5E8F\u4F9D\u6B21\u4F7F\u7528\u6BCF\u500B\u6A21\u677F"}[this.sendStrategy()]||""}canSend(){return this.selectedMessages().size>0?!0:this.messageContent.trim().length>0||this.attachments().length>0}insertVariable(e){this.messageContent+=e}async selectImages(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"Images",extensions:["jpg","jpeg","png","gif","webp"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(n=>({name:n.fileName,path:n.filePath,type:n.fileType}));this.attachments.update(n=>[...n,...t])}}catch(e){console.error("Select images failed:",e)}}async selectFiles(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"All Files",extensions:["*"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(n=>({name:n.fileName,path:n.filePath,type:n.fileType}));this.attachments.update(n=>[...n,...t])}}catch(e){console.error("Select files failed:",e)}}removeAttachment(e){this.attachments.update(t=>t.filter((n,o)=>o!==e))}previewMessage(){this.showPreview.set(!0)}replaceVariables(e,t){let n=e,o=t.firstName||t.first_name||"",r=t.lastName||t.last_name||"",c=t.username||"",m=t.displayName||t.name||o||c||"\u670B\u53CB",h=`${o} ${r}`.trim()||m,g=t.groupName||t.sourceGroup||t.source||"\u7FA4\u7D44",_=t.keyword||t.triggeredKeyword||t.matchedKeyword||"",S=t.source||t.sourceType||"";n=n.replace(/{firstName}/g,o),n=n.replace(/{first_name}/g,o),n=n.replace(/{lastName}/g,r),n=n.replace(/{last_name}/g,r),n=n.replace(/{username}/g,c),n=n.replace(/{displayName}/g,m),n=n.replace(/{name}/g,m),n=n.replace(/{fullName}/g,h),n=n.replace(/{full_name}/g,h),n=n.replace(/{groupName}/g,g),n=n.replace(/{group_name}/g,g),n=n.replace(/{keyword}/g,_),n=n.replace(/{source}/g,S);let y=new Date,D=y.getHours(),P="\u60A8\u597D";D>=5&&D<12?P="\u65E9\u4E0A\u597D":D>=12&&D<14?P="\u4E2D\u5348\u597D":D>=14&&D<18?P="\u4E0B\u5348\u597D":D>=18&&D<22?P="\u665A\u4E0A\u597D":P="\u591C\u6DF1\u4E86";let R=["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],q=`${y.getMonth()+1}\u6708${y.getDate()}\u65E5`,U=`${y.getHours().toString().padStart(2,"0")}:${y.getMinutes().toString().padStart(2,"0")}`,Q=R[y.getDay()];return n=n.replace(/{greeting}/g,P),n=n.replace(/{date}/g,q),n=n.replace(/{time}/g,U),n=n.replace(/{day}/g,Q),n}startSending(){if(!this.canSend())return;this.isSending.set(!0),this.sentCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.currentTarget.set(""),this.failureReasons.set({});let e=Array.from(this.selectedMessages()),t=e.length>1,n={targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,lastName:o.lastName,displayName:o.displayName,groupName:o.groupName,keyword:o.keyword,source:o.source})),attachments:this.attachments(),config:{minInterval:this.minInterval,maxInterval:this.maxInterval,accountRotation:this.accountRotation}};t?(n.messages=e,n.sendStrategy=this.sendStrategy(),n.message="",this.toast.info(`\u{1F4E8} \u4F7F\u7528 ${e.length} \u500B\u6A21\u677F${this.sendStrategy()==="random"?"\u96A8\u6A5F":this.sendStrategy()==="rotate"?"\u8F2A\u8F49":"\u9806\u5E8F"}\u767C\u9001...`)):e.length===1?n.message=e[0]:n.message=this.messageContent,this.ipc.send("batch-send:start",n),t||this.toast.info(`\u{1F4E8} \u958B\u59CB\u6279\u91CF\u767C\u9001 ${this.targets().length} \u689D\u6D88\u606F...`)}close(){if(this.isSending()){if(!confirm("\u767C\u9001\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-send:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isSending()&&this.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-batch-send-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"]},outputs:{closeDialog:"closeDialog",sendComplete:"sendComplete"},decls:2,vars:2,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/80","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-blue-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-blue-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"p-4","bg-purple-500/10","rounded-xl","border","border-purple-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"text-xs","text-blue-400","ml-2"],["rows","5","placeholder",`\u8F38\u5165\u6D88\u606F\u5167\u5BB9...

\u9EDE\u64CA\u4E0B\u65B9\u8B8A\u91CF\u6309\u9215\u53EF\u5FEB\u901F\u63D2\u5165\uFF0C\u4F8B\u5982\uFF1A
{greeting}{name}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u4F60\uFF01`,1,"w-full","bg-slate-800/50","border","border-slate-600","rounded-xl","p-4","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mt-2","flex","flex-wrap","gap-2","items-center"],[1,"text-xs","text-slate-500"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"title"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-800/50","border","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","hover:border-slate-500","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"mt-3","flex","flex-wrap","gap-2"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","10","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","10","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","ngModel"],[1,"w-11","h-6","bg-slate-700","peer-focus:ring-2","peer-focus:ring-blue-500","rounded-full","peer","peer-checked:after:translate-x-full","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-500"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-3","bg-slate-700","text-white","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-blue-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-blue-500/20",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium","text-slate-300"],[1,"text-xs","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","gap-2","mb-3","flex-wrap"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-blue-500","text-white","bg-slate-700","text-slate-400"],[1,"flex","items-center","justify-center","py-6"],[1,"text-center","py-6","text-slate-500"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"ml-2","text-slate-400","text-sm"],[1,"text-xs","mt-1"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"click"],[1,"flex","items-center","justify-between","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","line-clamp-2"],[1,"text-sm","font-medium","text-purple-300"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs",3,"bg-green-500/20","text-green-400","bg-amber-500/20","text-amber-400"],[1,"space-y-3"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u6253\u500B\u62DB\u547C\u3001\u4ECB\u7D39\u7522\u54C1\u3001\u9080\u8ACB\u52A0\u7FA4...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"w-full","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"space-y-3","mt-3"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs"],[1,"w-2","h-2","bg-green-500","rounded-full","animate-pulse"],[1,"w-2","h-2","bg-amber-500","rounded-full"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],[1,"text-xs","text-slate-400"],[1,"text-xs","px-2","py-1","bg-purple-500/20","text-purple-400","rounded","hover:bg-purple-500/30",3,"click"],[1,"text-xs","px-2","py-1","bg-slate-700","text-slate-400","rounded","hover:bg-slate-600",3,"click"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer"],["type","checkbox",1,"mt-1","w-4","h-4","rounded","bg-slate-700","border-slate-500","text-purple-500","focus:ring-purple-500",3,"change","checked"],[1,"flex-1","text-sm","text-slate-300"],[1,"text-xs","text-slate-400","block","mb-2"],[1,"flex","gap-2","flex-wrap"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400","title"],[1,"text-xs","text-slate-500","mt-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"click","title"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"click","title"],[1,"text-slate-500"],[1,"text-white"],[1,"flex","items-center","gap-2","px-3","py-2","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"text-lg"],[1,"text-sm","text-white","max-w-[150px]","truncate"],[1,"text-slate-400","hover:text-red-400",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-white"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-blue-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"mt-2","text-xs","text-cyan-400"],[1,"mt-3","p-2","bg-red-500/10","border","border-red-500/20","rounded-lg"],[1,"text-xs","text-red-400","font-medium","mb-1"],[1,"text-xs","px-2","py-0.5","bg-red-500/20","text-red-300","rounded"],[1,"animate-spin"],[1,"bg-slate-900","rounded-xl","p-6","max-w-md","w-full","border","border-slate-700"],[1,"text-lg","font-bold","text-white","mb-4"],[1,"p-4","bg-slate-800","rounded-lg","text-white","whitespace-pre-wrap"],[1,"mt-3","text-sm","text-slate-400"],[1,"mt-4","w-full","py-2","bg-slate-700","text-white","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"]],template:function(t,n){t&1&&(w(0,UC,86,53,"div",0),w(1,$C,9,2,"div",1)),t&2&&(E(n.isOpen()?0:-1),d(),E(n.showPreview()?1:-1))},dependencies:[oe,ue,xe,qn,Jt,fe,Hn,$n,_e],encapsulation:2})}};var HC=(i,e)=>e.telegramId,Vc=(i,e)=>e.id,KC=(i,e)=>e.key;function zC(i,e){i&1&&(s(0,"div",42),te(),s(1,"svg",45),k(2,"circle",46)(3,"path",47),a(),le(),s(4,"span",48),l(5,"\u8F09\u5165\u7FA4\u7D44\u5217\u8868..."),a()())}function WC(i,e){i&1&&(s(0,"div",43)(1,"p",49),l(2,"\u{1F605} \u6C92\u6709\u53EF\u7528\u7684\u7FA4\u7D44"),a(),s(3,"p",50),l(4,"\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44\u4E26\u4E14\u64C1\u6709\u9080\u8ACB\u6B0A\u9650"),a()())}function JC(i,e){i&1&&(s(0,"span",57),l(1,"\u7BA1\u7406\u54E1"),a())}function QC(i,e){i&1&&(s(0,"span",58),l(1,"\u6210\u54E1"),a())}function YC(i,e){i&1&&(te(),s(0,"svg",61),k(1,"path",62),a())}function XC(i,e){if(i&1){let t=T();s(0,"button",52),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.selectGroup(o))}),s(1,"div",53),l(2),a(),s(3,"div",54)(4,"div",55)(5,"span",56),l(6),a(),w(7,JC,2,0,"span",57)(8,QC,2,0,"span",58),a(),s(9,"div",59)(10,"span"),l(11),Le(12,"number"),a(),s(13,"span"),l(14,"\u2022"),a(),s(15,"span",60),l(16),a()()(),w(17,YC,2,0,":svg:svg",61),a()}if(i&2){let t,n,o,r,c,m,h=e.$implicit,g=f(4);I("border-emerald-500",((t=g.selectedGroup())==null?null:t.id)===h.id)("bg-emerald-500/10",((n=g.selectedGroup())==null?null:n.id)===h.id)("border-slate-600",((o=g.selectedGroup())==null?null:o.id)!==h.id)("bg-slate-800/50",((r=g.selectedGroup())==null?null:r.id)!==h.id)("hover:border-slate-500",((c=g.selectedGroup())==null?null:c.id)!==h.id),d(),I("from-blue-500",h.type==="group")("to-cyan-500",h.type==="group")("from-purple-500",h.type==="supergroup")("to-pink-500",h.type==="supergroup")("from-amber-500",h.type==="channel")("to-orange-500",h.type==="channel"),d(),A(" ",h.type==="channel"?"\u{1F4E2}":"\u{1F465}"," "),d(4),M(h.name),d(),E(h.isAdmin?7:8),d(4),A("\u{1F464} ",et(12,28,h.memberCount)," \u6210\u54E1"),d(5),M(h.url),d(),E(((m=g.selectedGroup())==null?null:m.id)===h.id?17:-1)}}function ZC(i,e){if(i&1&&(s(0,"div",44),$(1,XC,18,30,"button",51,Vc),a()),i&2){let t=f(3);d(),H(t.availableGroups())}}function jC(i,e){if(i&1&&(s(0,"div")(1,"label",30),l(2," \u9078\u64C7\u76EE\u6A19\u7FA4\u7D44 "),a(),w(3,zC,6,0,"div",42)(4,WC,5,0,"div",43)(5,ZC,3,0,"div",44),a()),i&2){let t=f(2);d(3),E(t.isLoadingGroups()?3:t.availableGroups().length===0?4:5)}}function ev(i,e){if(i&1){let t=T();s(0,"div")(1,"span",64),l(2,"\u7FA4\u7D44\u540D\u7A31\uFF1A"),a(),s(3,"input",71),W("ngModelChange",function(o){v(t);let r=f(3);return z(r.newGroupName,o)||(r.newGroupName=o),x(o)}),a(),s(4,"span",72),l(5),a()()}if(i&2){let t=f(3);d(3),K("ngModel",t.newGroupName),d(2),A("",t.newGroupName.length,"/128")}}function tv(i,e){if(i&1){let t=T();s(0,"button",76),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.selectedGroupNameStyle.set(o.key))}),l(1),a()}if(i&2){let t=e.$implicit,n=f(4);I("bg-purple-500",n.selectedGroupNameStyle()===t.key)("text-white",n.selectedGroupNameStyle()===t.key)("bg-slate-700",n.selectedGroupNameStyle()!==t.key)("text-slate-400",n.selectedGroupNameStyle()!==t.key),d(),A(" ",t.label," ")}}function nv(i,e){i&1&&(te(),s(0,"svg",77),k(1,"circle",46)(2,"path",78),a(),l(3," \u751F\u6210\u4E2D... "))}function iv(i,e){i&1&&l(0," \u2728 \u751F\u6210\u7FA4\u540D ")}function ov(i,e){if(i&1){let t=T();s(0,"button",81),b("click",function(){let o=v(t).$implicit,r=f(5);return x(r.selectGeneratedName(o))}),l(1),a()}if(i&2){let t=e.$implicit,n=f(5);I("border-purple-500",n.newGroupName===t)("bg-purple-500/10",n.newGroupName===t)("border-slate-600",n.newGroupName!==t)("bg-slate-800/50",n.newGroupName!==t),d(),A(" ",t," ")}}function rv(i,e){if(i&1&&(s(0,"div",26)(1,"span",79),l(2,"\u9078\u64C7\u4E00\u500B\uFF1A"),a(),$(3,ov,2,9,"button",80,gt),a()),i&2){let t=f(4);d(3),H(t.generatedGroupNames())}}function sv(i,e){if(i&1){let t=T();s(0,"div",27)(1,"div")(2,"span",64),l(3,"\u4E3B\u984C/\u95DC\u9375\u8A5E\uFF1A"),a(),s(4,"input",73),W("ngModelChange",function(o){v(t);let r=f(3);return z(r.aiGroupKeywords,o)||(r.aiGroupKeywords=o),x(o)}),a()(),s(5,"div")(6,"span",64),l(7,"\u98A8\u683C\uFF1A"),a(),s(8,"div",32),$(9,tv,2,9,"button",74,KC),a()(),s(11,"button",75),b("click",function(){v(t);let o=f(3);return x(o.generateGroupNames())}),w(12,nv,4,0)(13,iv,1,0),a(),w(14,rv,5,0,"div",26),a()}if(i&2){let t=f(3);d(4),K("ngModel",t.aiGroupKeywords),d(5),H(t.groupNameStyles),d(2),V("disabled",t.isGeneratingNames()||!t.aiGroupKeywords.trim()),d(),E(t.isGeneratingNames()?12:13),d(2),E(t.generatedGroupNames().length>0?14:-1)}}function av(i,e){if(i&1){let t=T();s(0,"div",16)(1,"label",63),l(2,"\u{1F4DD} \u65B0\u7FA4\u7D44\u4FE1\u606F"),a(),s(3,"div")(4,"span",64),l(5,"\u7FA4\u540D\u751F\u6210\uFF1A"),a(),s(6,"div",14)(7,"button",25),b("click",function(){v(t);let o=f(2);return x(o.groupNameMode.set("manual"))}),l(8," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),a(),s(9,"button",25),b("click",function(){v(t);let o=f(2);return x(o.groupNameMode.set("ai"))}),l(10," \u{1F916} AI \u751F\u6210 "),a()()(),w(11,ev,6,2,"div"),w(12,sv,15,4,"div",27),s(13,"div")(14,"span",64),l(15,"\u7FA4\u7D44\u985E\u578B\uFF1A"),a(),s(16,"div",65)(17,"label",66)(18,"input",67),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.newGroupType,o)||(r.newGroupType=o),x(o)}),a(),s(19,"span",68),l(20,"\u666E\u901A\u7FA4\u7D44 (\u6700\u591A 200 \u4EBA)"),a()(),s(21,"label",66)(22,"input",69),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.newGroupType,o)||(r.newGroupType=o),x(o)}),a(),s(23,"span",68),l(24,"\u8D85\u7D1A\u7FA4\u7D44 (\u6700\u591A 20 \u842C\u4EBA)"),a()()()(),s(25,"div")(26,"span",64),l(27,"\u7FA4\u7D44\u63CF\u8FF0\uFF08\u53EF\u9078\uFF09\uFF1A"),a(),s(28,"textarea",70),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.newGroupDescription,o)||(r.newGroupDescription=o),x(o)}),l(29,"                  "),a()()()}if(i&2){let t=f(2);d(7),I("bg-cyan-500",t.groupNameMode()==="manual")("text-white",t.groupNameMode()==="manual")("bg-slate-700",t.groupNameMode()!=="manual")("text-slate-400",t.groupNameMode()!=="manual"),d(2),I("bg-purple-500",t.groupNameMode()==="ai")("text-white",t.groupNameMode()==="ai")("bg-slate-700",t.groupNameMode()!=="ai")("text-slate-400",t.groupNameMode()!=="ai"),d(2),E(t.groupNameMode()==="manual"?11:-1),d(),E(t.groupNameMode()==="ai"?12:-1),d(6),K("ngModel",t.newGroupType),d(4),K("ngModel",t.newGroupType),d(6),K("ngModel",t.newGroupDescription)}}function lv(i,e){i&1&&(s(0,"div",82),te(),s(1,"svg",85),k(2,"circle",46)(3,"path",78),a(),le(),s(4,"span",86),l(5,"\u8F09\u5165\u6A21\u677F..."),a()())}function cv(i,e){i&1&&(s(0,"p",83),l(1,"\u6C92\u6709\u53EF\u7528\u7684\u6A21\u677F"),a())}function dv(i,e){if(i&1){let t=T();s(0,"button",81),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.selectWelcomeTemplate(o))}),s(1,"span",88),l(2),a(),s(3,"p",89),l(4),a()()}if(i&2){let t,n,o,r,c=e.$implicit,m=f(4);I("border-blue-500",((t=m.selectedWelcomeTemplate())==null?null:t.id)===c.id)("bg-blue-500/10",((n=m.selectedWelcomeTemplate())==null?null:n.id)===c.id)("border-slate-600",((o=m.selectedWelcomeTemplate())==null?null:o.id)!==c.id)("bg-slate-800/50",((r=m.selectedWelcomeTemplate())==null?null:r.id)!==c.id),d(2),M(c.name),d(2),M(c.content)}}function uv(i,e){if(i&1&&(s(0,"div",84),$(1,dv,5,10,"button",87,Vc),a()),i&2){let t=f(3);d(),H(t.welcomeTemplates())}}function mv(i,e){if(i&1&&(s(0,"div",26),w(1,lv,6,0,"div",82)(2,cv,2,0,"p",83)(3,uv,3,0,"div",84),a()),i&2){let t=f(2);d(),E(t.isLoadingTemplates()?1:t.welcomeTemplates().length===0?2:3)}}function pv(i,e){i&1&&(te(),s(0,"svg",77),k(1,"circle",46)(2,"path",78),a(),l(3," \u751F\u6210\u4E2D... "))}function gv(i,e){i&1&&l(0," \u2728 \u751F\u6210\u6B61\u8FCE\u6D88\u606F ")}function hv(i,e){if(i&1&&(s(0,"div",91)(1,"p",92),l(2),a()()),i&2){let t=f(3);d(2),M(t.generatedWelcomeMessage())}}function fv(i,e){if(i&1){let t=T();s(0,"div",27)(1,"input",90),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.aiWelcomeTopic,o)||(r.aiWelcomeTopic=o),x(o)}),a(),s(2,"button",75),b("click",function(){v(t);let o=f(2);return x(o.generateWelcomeMessage())}),w(3,pv,4,0)(4,gv,1,0),a(),w(5,hv,3,1,"div",91),a()}if(i&2){let t=f(2);d(),K("ngModel",t.aiWelcomeTopic),d(),V("disabled",t.isGeneratingWelcome()||!t.aiWelcomeTopic.trim()),d(),E(t.isGeneratingWelcome()?3:4),d(2),E(t.generatedWelcomeMessage()?5:-1)}}function _v(i,e){if(i&1){let t=T();s(0,"div",28)(1,"span",64),l(2,"\u6D88\u606F\u5167\u5BB9\uFF1A"),a(),s(3,"textarea",93),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.welcomeMessageContent,o)||(r.welcomeMessageContent=o),x(o)}),l(4,"                  "),a()()}if(i&2){let t=f(2);d(3),K("ngModel",t.welcomeMessageContent)}}function Cv(i,e){if(i&1&&(s(0,"span",98),l(1),a()),i&2){let t=f(3);d(),A("\u26A0\uFE0F \u5DF2\u5728\u7FA4\u5167: ",t.permissionCheck().alreadyInGroup," \u4EBA")}}function vv(i,e){if(i&1&&(s(0,"span",99),l(1),a()),i&2){let t=f(3);d(),A("\u274C \u96B1\u79C1\u9650\u5236: ",t.permissionCheck().privacyRestricted," \u4EBA")}}function xv(i,e){if(i&1&&(s(0,"div",94)(1,"h4",95),l(2,"\u{1F4CA} \u6B0A\u9650\u6AA2\u67E5\u7D50\u679C"),a(),s(3,"div",96)(4,"span",97),l(5),a(),w(6,Cv,2,1,"span",98),w(7,vv,2,1,"span",99),a()()),i&2){let t=f(2);I("bg-emerald-500/10",t.permissionCheck().canInvite>0)("border",!0)("border-emerald-500/30",t.permissionCheck().canInvite>0)("bg-amber-500/10",t.permissionCheck().canInvite===0)("border-amber-500/30",t.permissionCheck().canInvite===0),d(5),A("\u2705 \u53EF\u62C9\u5165: ",t.permissionCheck().canInvite," \u4EBA"),d(),E(t.permissionCheck().alreadyInGroup>0?6:-1),d(),E(t.permissionCheck().privacyRestricted>0?7:-1)}}function bv(i,e){if(i&1&&(s(0,"span",33),l(1),a()),i&2){let t=e.$implicit;d(),A(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function Sv(i,e){if(i&1&&(s(0,"span",34),l(1),a()),i&2){let t=f(2);d(),A(" +",t.targets().length-20," \u66F4\u591A... ")}}function yv(i,e){if(i&1&&(s(0,"div",35)(1,"div",100)(2,"span",92),l(3,"\u62C9\u7FA4\u9032\u5EA6"),a(),s(4,"span",8),l(5),a()(),s(6,"div",101),k(7,"div",102),a(),s(8,"div",103)(9,"span",104),l(10),a(),s(11,"span",98),l(12),a(),s(13,"span",99),l(14),a(),s(15,"span"),l(16),a()(),s(17,"p",105),l(18," \u{1F4A1} \u6210\u529F\u5305\u542B\uFF1A\u76F4\u63A5\u9080\u8ACB + \u5DF2\u767C\u9001\u9080\u8ACB\u93C8\u63A5 "),a()()),i&2){let t=f(2);d(5),Y("",t.invitedCount()," / ",t.targets().length),d(2),j("width",t.progressPercent(),"%"),d(3),A("\u2705 \u6210\u529F: ",t.successCount()),d(2),A("\u26A0\uFE0F \u8DF3\u904E: ",t.skippedCount()),d(2),A("\u274C \u5931\u6557: ",t.failedCount()),d(2),A("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining())}}function wv(i,e){i&1&&(s(0,"div",36)(1,"div",106)(2,"span"),l(3,"\u26A0\uFE0F"),a(),s(4,"span"),l(5,"\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F\u5F8C\u518D\u9032\u884C\u62C9\u7FA4\u64CD\u4F5C"),a()()())}function Ev(i,e){if(i&1&&(s(0,"div",37)(1,"div",107)(2,"span"),l(3,"\u{1F517}"),a(),s(4,"span"),l(5),a(),s(6,"span",108),l(7,"|"),a(),s(8,"span"),l(9),a()()()),i&2){let t,n=f(2);d(5),A("\u53EF\u7528\u5E33\u865F: ",n.onlineAccountsCount()," \u500B\u5728\u7DDA"),d(4),A("\u5C07\u4F7F\u7528: ",((t=n.preferredAccount())==null?null:t.firstName)||((t=n.preferredAccount())==null?null:t.phone)||"\u81EA\u52D5\u9078\u64C7")}}function Av(i,e){i&1&&l(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function Dv(i,e){if(i&1&&(l(0),w(1,Av,1,0)),i&2){let t=f(3);Y(" \u5275\u5EFA\u7FA4\u7D44\u300C",t.newGroupName,"\u300D\u2192 \u62C9\u5165 ",t.targets().length," \u4EBA "),d(),E(t.welcomeMessageSource()!=="none"?1:-1)}}function Mv(i,e){i&1&&l(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function Tv(i,e){if(i&1&&(l(0),w(1,Mv,1,0)),i&2){let t,n=f(3);Y(" \u62C9\u5165\u7FA4\u7D44\u300C",(t=n.selectedGroup())==null?null:t.name,"\u300D\u2192 ",n.targets().length," \u4EBA "),d(),E(n.welcomeMessageSource()!=="none"?1:-1)}}function Iv(i,e){if(i&1&&(s(0,"div",38)(1,"div",109)(2,"span"),l(3,"\u{1F4CB}"),a(),s(4,"span"),w(5,Dv,2,3)(6,Tv,2,3),a()()()),i&2){let t=f(2);d(5),E(t.groupSource()==="create"?5:6)}}function kv(i,e){if(i&1&&(s(0,"span",110),l(1,"\u23F3"),a(),l(2)),i&2){let t=f(2);d(2),A(" ",t.createGroupProgressMessage()||"\u5275\u5EFA\u7FA4\u7D44\u4E2D..."," ")}}function Pv(i,e){i&1&&(s(0,"span",110),l(1,"\u23F3"),a(),l(2," \u62C9\u7FA4\u4E2D... "))}function Fv(i,e){if(i&1&&l(0),i&2){let t=f(2);A(" \u{1F680} \u5275\u5EFA\u4E26\u62C9\u4EBA (",t.targets().length," \u4EBA) ")}}function Rv(i,e){if(i&1&&l(0),i&2){let t=f(2);A(" \u{1F465} \u958B\u59CB\u62C9\u7FA4 (",t.targets().length," \u4EBA) ")}}function Nv(i,e){if(i&1){let t=T();s(0,"div",1),b("click",function(o){v(t);let r=f();return x(r.onBackdropClick(o))}),s(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),l(6," \u{1F465} "),a(),s(7,"div")(8,"h2",7),l(9,"\u6279\u91CF\u62C9\u5165\u7FA4\u7D44"),a(),s(10,"p",8),l(11),a()()(),s(12,"button",9),b("click",function(){v(t);let o=f();return x(o.close())}),te(),s(13,"svg",10),k(14,"path",11),a()()()(),le(),s(15,"div",12)(16,"div")(17,"label",13),l(18," \u{1F3AF} \u7FA4\u7D44\u4F86\u6E90 "),a(),s(19,"div",14)(20,"button",15),b("click",function(){v(t);let o=f();return x(o.setGroupSource("existing"))}),l(21," \u{1F3E0} \u73FE\u6709\u7FA4\u7D44 "),a(),s(22,"button",15),b("click",function(){v(t);let o=f();return x(o.setGroupSource("create"))}),l(23," \u2795 \u5275\u5EFA\u65B0\u7FA4 "),a()()(),w(24,jC,6,1,"div"),w(25,av,30,21,"div",16),s(26,"div",17)(27,"label",13),l(28," \u2699\uFE0F \u62C9\u7FA4\u8A2D\u7F6E "),a(),s(29,"div",18)(30,"div",5)(31,"span",19),l(32,"\u6BCF\u6279\u6B21\u4EBA\u6578\uFF1A"),a(),s(33,"input",20),W("ngModelChange",function(o){v(t);let r=f();return z(r.batchSize,o)||(r.batchSize=o),x(o)}),a(),s(34,"span",8),l(35,"\u4EBA"),a()(),s(36,"div",5)(37,"span",19),l(38,"\u6279\u6B21\u9593\u9694\uFF1A"),a(),s(39,"input",21),W("ngModelChange",function(o){v(t);let r=f();return z(r.minInterval,o)||(r.minInterval=o),x(o)}),a(),s(40,"span",22),l(41,"-"),a(),s(42,"input",23),W("ngModelChange",function(o){v(t);let r=f();return z(r.maxInterval,o)||(r.maxInterval=o),x(o)}),a(),s(43,"span",8),l(44,"\u79D2"),a()()()(),s(45,"div",17)(46,"label",13),l(47," \u{1F4AC} \u6B61\u8FCE\u6D88\u606F "),a(),s(48,"div",24)(49,"button",25),b("click",function(){v(t);let o=f();return x(o.welcomeMessageSource.set("none"))}),l(50," \u274C \u4E0D\u767C\u9001 "),a(),s(51,"button",25),b("click",function(){v(t);let o=f();return x(o.welcomeMessageSource.set("template"))}),l(52," \u{1F4C4} \u9078\u6A21\u677F "),a(),s(53,"button",25),b("click",function(){v(t);let o=f();return x(o.welcomeMessageSource.set("ai"))}),l(54," \u{1F916} AI \u751F\u6210 "),a()(),w(55,mv,4,1,"div",26),w(56,fv,6,4,"div",27),w(57,_v,5,1,"div",28),a(),w(58,xv,8,13,"div",29),s(59,"div")(60,"label",30),l(61),a(),s(62,"div",31)(63,"div",32),$(64,bv,2,1,"span",33,HC),w(66,Sv,2,1,"span",34),a()()()(),w(67,yv,19,8,"div",35),w(68,wv,6,0,"div",36)(69,Ev,10,2,"div",37),w(70,Iv,7,1,"div",38),s(71,"div",39)(72,"button",40),b("click",function(){v(t);let o=f();return x(o.close())}),l(73),a(),s(74,"button",41),b("click",function(){v(t);let o=f();return x(o.startInviting())}),w(75,kv,3,1)(76,Pv,3,0)(77,Fv,1,1)(78,Rv,1,1),a()()()()}if(i&2){let t=f();d(11),A("\u5C07 ",t.targets().length," \u500B\u7528\u6236\u62C9\u5165\u7FA4\u7D44"),d(9),I("border-emerald-500",t.groupSource()==="existing")("bg-emerald-500/20",t.groupSource()==="existing")("text-emerald-400",t.groupSource()==="existing")("border-slate-600",t.groupSource()!=="existing")("bg-slate-800/50",t.groupSource()!=="existing")("text-slate-400",t.groupSource()!=="existing"),d(2),I("border-cyan-500",t.groupSource()==="create")("bg-cyan-500/20",t.groupSource()==="create")("text-cyan-400",t.groupSource()==="create")("border-slate-600",t.groupSource()!=="create")("bg-slate-800/50",t.groupSource()!=="create")("text-slate-400",t.groupSource()!=="create"),d(2),E(t.groupSource()==="existing"?24:-1),d(),E(t.groupSource()==="create"?25:-1),d(8),K("ngModel",t.batchSize),d(6),K("ngModel",t.minInterval),d(3),K("ngModel",t.maxInterval),d(7),I("bg-slate-600",t.welcomeMessageSource()==="none")("text-white",t.welcomeMessageSource()==="none")("bg-slate-700",t.welcomeMessageSource()!=="none")("text-slate-400",t.welcomeMessageSource()!=="none"),d(2),I("bg-blue-500",t.welcomeMessageSource()==="template")("text-white",t.welcomeMessageSource()==="template")("bg-slate-700",t.welcomeMessageSource()!=="template")("text-slate-400",t.welcomeMessageSource()!=="template"),d(2),I("bg-purple-500",t.welcomeMessageSource()==="ai")("text-white",t.welcomeMessageSource()==="ai")("bg-slate-700",t.welcomeMessageSource()!=="ai")("text-slate-400",t.welcomeMessageSource()!=="ai"),d(2),E(t.welcomeMessageSource()==="template"?55:-1),d(),E(t.welcomeMessageSource()==="ai"?56:-1),d(),E(t.welcomeMessageSource()!=="none"?57:-1),d(),E(t.selectedGroup()?58:-1),d(3),A(" \u{1F465} \u76EE\u6A19\u7528\u6236\uFF08",t.targets().length," \u4EBA\uFF09 "),d(3),H(t.targets().slice(0,20)),d(2),E(t.targets().length>20?66:-1),d(),E(t.isInviting()?67:-1),d(),E(t.onlineAccountsCount()===0?68:69),d(2),E(t.canInvite()?70:-1),d(2),V("disabled",t.isInviting()||t.isCreatingGroup()),d(),A(" ",t.isInviting()||t.isCreatingGroup()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),d(),V("disabled",!t.canInvite()||t.isInviting()||t.isCreatingGroup()),d(),E(t.isCreatingGroup()?75:t.isInviting()?76:t.groupSource()==="create"?77:78)}}var _o=class i{constructor(){this.ipc=B(De);this.toast=B(me);this.isOpen=tt(!1);this.targets=tt([]);this.accounts=tt([]);this.closeDialog=Ee();this.inviteComplete=Ee();this._currentInviteId=C(null);this.groupSource=C("existing");this.availableGroups=C([]);this.isLoadingGroups=C(!1);this.selectedGroup=C(null);this.groupNameMode=C("manual");this.newGroupName="";this.newGroupType="supergroup";this.newGroupDescription="";this.aiGroupKeywords="";this.selectedGroupNameStyle=C("professional");this.isGeneratingNames=C(!1);this.generatedGroupNames=C([]);this.groupNameStyles=[{key:"professional",label:"\u5C08\u696D\u6B63\u5F0F"},{key:"lively",label:"\u6D3B\u6F51\u6709\u8DA3"},{key:"mysterious",label:"\u795E\u79D8\u9AD8\u7AEF"},{key:"simple",label:"\u7C21\u7D04\u660E\u4E86"}];this.welcomeMessageSource=C("none");this.welcomeTemplates=C([]);this.isLoadingTemplates=C(!1);this.selectedWelcomeTemplate=C(null);this.welcomeMessageContent="";this.aiWelcomeTopic="";this.isGeneratingWelcome=C(!1);this.generatedWelcomeMessage=C("");this.batchSize=10;this.minInterval=60;this.maxInterval=120;this.isInviting=C(!1);this.invitedCount=C(0);this.successCount=C(0);this.failedCount=C(0);this.skippedCount=C(0);this.isCreatingGroup=C(!1);this.createdGroupId=C(null);this.createGroupProgressMessage=C("");this.listeners=[];this.progressPercent=L(()=>{let e=this.targets().length;return e>0?this.invitedCount()/e*100:0});this.estimatedRemaining=L(()=>{let e=this.targets().length-this.invitedCount(),t=(this.minInterval+this.maxInterval)/2,o=Math.ceil(e/this.batchSize)*t;return o<60?`${Math.round(o)} \u79D2`:o<3600?`${Math.round(o/60)} \u5206\u9418`:`${Math.round(o/3600)} \u5C0F\u6642`});this.permissionCheck=L(()=>{let e=this.targets().length;return{canInvite:Math.floor(e*.8),alreadyInGroup:Math.floor(e*.1),privacyRestricted:Math.floor(e*.1)}});this.onlineAccountsCount=L(()=>this.accounts().filter(e=>e.status==="Online").length);this.preferredAccount=L(()=>{let e=this.accounts().filter(n=>n.status==="Online");return e.find(n=>n.role==="Sender")||e[0]||null});this.createGroupTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadAvailableGroups(),this.loadWelcomeTemplates()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-invite:progress",g=>{this.invitedCount.set(g.invited),this.successCount.set(g.success),this.failedCount.set(g.failed),this.skippedCount.set(g.skipped)});this.listeners.push(e);let t=this.ipc.on("batch-invite:complete",g=>{let _=this._currentInviteId();if(g.inviteId&&_&&g.inviteId!==_){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08inviteId \u4E0D\u5339\u914D\uFF09:",g.inviteId,"!=",_);return}if(!this.isOpen()&&!this.isInviting()&&!_){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08\u5C0D\u8A71\u6846\u672A\u6253\u958B\u4E14\u7121\u6D3B\u8E8D\u9080\u8ACB\uFF09");return}this._currentInviteId.set(null),this.isInviting.set(!1),this.isCreatingGroup.set(!1),this.inviteComplete.emit({success:g.success,failed:g.failed,skipped:g.skipped}),g.success>0?this.toast.success(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u2705 \u6210\u529F/\u5DF2\u767C\u9001\u9080\u8ACB ${g.success} \u4EBA\uFF0C\u26A0\uFE0F \u8DF3\u904E ${g.skipped}\uFF0C\u274C \u5931\u6557 ${g.failed}`):g.skipped>0?this.toast.warning("\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6240\u6709\u7528\u6236\u5DF2\u5728\u7FA4\u5167\u6216\u96B1\u79C1\u9650\u5236"):this.toast.error("\u6279\u91CF\u62C9\u7FA4\u5931\u6557\uFF1A\u7121\u6CD5\u9080\u8ACB\u4EFB\u4F55\u7528\u6236\uFF0C\u8ACB\u6AA2\u67E5\u5E33\u865F\u72C0\u614B")});this.listeners.push(t);let n=this.ipc.on("get-admin-groups-result",g=>{this.isLoadingGroups.set(!1),g.groups&&this.availableGroups.set(g.groups)});this.listeners.push(n);let o=this.ipc.on("get-chat-templates-result",g=>{this.isLoadingTemplates.set(!1),g.templates&&this.welcomeTemplates.set(g.templates.filter(_=>_.isEnabled))});this.listeners.push(o);let r=this.ipc.on("ai-generate-group-names-result",g=>{this.isGeneratingNames.set(!1),g.success&&g.names?(this.generatedGroupNames.set(g.names),this.toast.success("\u7FA4\u540D\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(g.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(r);let c=this.ipc.on("ai-generate-welcome-result",g=>{this.isGeneratingWelcome.set(!1),g.success&&g.message?(this.generatedWelcomeMessage.set(g.message),this.welcomeMessageContent=g.message,this.toast.success("\u6B61\u8FCE\u6D88\u606F\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(g.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(c);let m=this.ipc.on("create-group-progress",g=>{console.log("[BatchInvite] \u5275\u5EFA\u9032\u5EA6:",g),this.createGroupProgressMessage.set(g.message)});this.listeners.push(m);let h=this.ipc.on("create-group-result",g=>{if(console.log("[BatchInvite] \u6536\u5230\u5275\u5EFA\u7FA4\u7D44\u7D50\u679C:",g),this.createGroupTimeout&&(clearTimeout(this.createGroupTimeout),this.createGroupTimeout=null),this.isCreatingGroup.set(!1),g.success&&g.groupId)this.createdGroupId.set(g.groupId),this.toast.success(`\u7FA4\u7D44\u300C${this.newGroupName}\u300D\u5275\u5EFA\u6210\u529F\uFF01`),this.startInvitingToGroup(g.groupId,g.groupUrl||"");else{let _=g.error||"\u5275\u5EFA\u7FA4\u7D44\u5931\u6557";_.includes("FLOOD")?this.toast.error("\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"):_.includes("not connected")||_.includes("Offline")?this.toast.error("\u5E33\u865F\u672A\u9023\u63A5\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"):_.includes("PEER_FLOOD")?this.toast.error("\u5E33\u865F\u88AB\u9650\u5236\uFF0C\u8ACB\u66F4\u63DB\u5E33\u865F\u6216\u7A0D\u5F8C\u518D\u8A66"):this.toast.error(_)}});this.listeners.push(h)}setGroupSource(e){this.groupSource.set(e),e==="existing"&&this.loadAvailableGroups()}loadAvailableGroups(){this.isLoadingGroups.set(!0),this.ipc.send("get-admin-groups",{})}loadWelcomeTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectGroup(e){this.selectedGroup.set(e)}selectGeneratedName(e){this.newGroupName=e}generateGroupNames(){if(!this.aiGroupKeywords.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u4E3B\u984C\u95DC\u9375\u8A5E");return}this.isGeneratingNames.set(!0),this.generatedGroupNames.set([]),this.ipc.send("ai-generate-group-names",{keywords:this.aiGroupKeywords,style:this.selectedGroupNameStyle(),count:5})}selectWelcomeTemplate(e){this.selectedWelcomeTemplate.set(e),this.welcomeMessageContent=e.content}generateWelcomeMessage(){if(!this.aiWelcomeTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingWelcome.set(!0),this.generatedWelcomeMessage.set(""),this.ipc.send("ai-generate-welcome",{topic:this.aiWelcomeTopic,groupName:this.newGroupName||this.selectedGroup()?.name||""})}canInvite(){return this.groupSource()==="existing"?this.selectedGroup()!==null&&this.targets().length>0:this.newGroupName.trim().length>0&&this.targets().length>0}startInviting(){this.canInvite()&&(this.groupSource()==="create"?this.createGroupAndInvite():this.startInvitingToGroup(this.selectedGroup().id,this.selectedGroup().url))}async createGroupAndInvite(){let e=await this.checkOnlineAccounts();if(e.length===0){this.toast.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.isCreatingGroup.set(!0),this.createGroupProgressMessage.set("\u6B63\u5728\u6E96\u5099\u5275\u5EFA\u7FA4\u7D44..."),this.createGroupTimeout&&clearTimeout(this.createGroupTimeout),this.createGroupTimeout=setTimeout(()=>{this.isCreatingGroup()&&(this.isCreatingGroup.set(!1),this.toast.error("\u5275\u5EFA\u7FA4\u7D44\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u6216\u5E33\u865F\u72C0\u614B\uFF0C\u6216\u5617\u8A66\u5275\u5EFA\u666E\u901A\u7FA4\u7D44"))},6e4),console.log("[BatchInvite] \u958B\u59CB\u5275\u5EFA\u7FA4\u7D44:",{name:this.newGroupName,type:this.newGroupType,account:e[0]?.phone}),this.ipc.send("create-group",{name:this.newGroupName,description:this.newGroupDescription,type:this.newGroupType,accountPhone:e[0]?.phone}),this.toast.info(`\u6B63\u5728\u4F7F\u7528\u5E33\u865F ${e[0]?.firstName||e[0]?.phone} \u5275\u5EFA\u7FA4\u7D44...`)}async checkOnlineAccounts(){let e=this.accounts(),t=e.filter(n=>n.status==="Online");return console.log("[BatchInvite] \u6AA2\u67E5\u5E33\u865F: \u7E3D\u6578",e.length,", \u5728\u7DDA",t.length),t.length===0&&this.toast.warning("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"),t}startInvitingToGroup(e,t){let n=`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this._currentInviteId.set(n),this.isInviting.set(!0),this.invitedCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.skippedCount.set(0),this.ipc.send("batch-invite:start",{inviteId:n,groupId:e,groupUrl:t,targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,displayName:o.displayName})),config:{batchSize:this.batchSize,minInterval:this.minInterval,maxInterval:this.maxInterval,sendWelcomeMessage:this.welcomeMessageSource()!=="none",welcomeMessage:this.welcomeMessageContent}}),this.toast.info("\u958B\u59CB\u6279\u91CF\u62C9\u7FA4..."),console.log("[BatchInvite] \u958B\u59CB\u9080\u8ACB\uFF0CinviteId:",n)}close(){if(this.isInviting()){if(!confirm("\u62C9\u7FA4\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-invite:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isInviting()&&this.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-batch-invite-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"],accounts:[1,"accounts"]},outputs:{closeDialog:"closeDialog",inviteComplete:"inviteComplete"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30","space-y-4"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","1","max","50",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],["type","number","min","30","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","30","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"flex","gap-2","mb-3"],[1,"flex-1","py-2","rounded-lg","text-sm","transition-all",3,"click"],[1,"space-y-2"],[1,"space-y-3"],[1,"mt-3"],[1,"p-4","rounded-xl",3,"bg-emerald-500/10","border","border-emerald-500/30","bg-amber-500/10","border-amber-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-red-500/10","border-t","border-red-500/30"],[1,"px-5","py-2","bg-slate-800/30","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-emerald-500/20",3,"click","disabled"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2","max-h-48","overflow-y-auto","pr-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-6","w-6","text-cyan-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"ml-2","text-slate-400"],[1,"text-lg","mb-2"],[1,"text-sm"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"border-emerald-500","bg-emerald-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","flex","items-center","justify-center","text-lg"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white","truncate"],[1,"px-1.5","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded"],[1,"px-1.5","py-0.5","bg-slate-600","text-slate-400","text-xs","rounded"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"truncate"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-emerald-400","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"block","text-sm","font-medium","text-cyan-300"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"flex","gap-3"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","radio","name","groupType","value","group",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300"],["type","radio","name","groupType","value","supergroup",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],["rows","2","placeholder","\u7C21\u77ED\u4ECB\u7D39\u7FA4\u7D44\u76EE\u7684...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-cyan-500","text-sm",3,"ngModelChange","ngModel"],["type","text","placeholder","\u8F38\u5165\u7FA4\u7D44\u540D\u7A31...","maxlength","128",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1","block"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u5E63\u5708\u3001\u4EA4\u6D41\u3001VIP...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],[1,"w-full","py-2","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-sm",3,"click","disabled"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"text-xs","text-slate-400"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"click"],[1,"flex","items-center","justify-center","py-4"],[1,"text-sm","text-slate-500","text-center","py-4"],[1,"max-h-32","overflow-y-auto","space-y-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],[1,"ml-2","text-slate-400","text-sm"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400","truncate","mt-1"],["type","text","placeholder","\u6B61\u8FCE\u6D88\u606F\u4E3B\u984C\uFF0C\u4F8B\u5982\uFF1A\u6B61\u8FCE\u52A0\u5165\u3001\u793E\u7FA4\u4ECB\u7D39...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"p-3","bg-slate-800/50","rounded-lg","border","border-purple-500/30"],[1,"text-sm","text-white"],["rows","2","placeholder","\u8F38\u5165\u6B61\u8FCE\u6D88\u606F\u5167\u5BB9...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-emerald-500","text-sm",3,"ngModelChange","ngModel"],[1,"p-4","rounded-xl"],[1,"text-sm","font-medium","text-slate-300","mb-2"],[1,"flex","items-center","gap-6","text-sm"],[1,"text-emerald-400"],[1,"text-amber-400"],[1,"text-red-400"],[1,"flex","items-center","justify-between","mb-2"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"text-green-400"],[1,"mt-1","text-xs","text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-red-400"],[1,"flex","items-center","gap-2","text-xs","text-slate-400"],[1,"text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-slate-400"],[1,"animate-spin"]],template:function(t,n){t&1&&w(0,Nv,79,67,"div",0),t&2&&E(n.isOpen()?0:-1)},dependencies:[oe,ue,xe,qn,Hs,fe,Kn,Hn,$n,_e,Wt],encapsulation:2})}};var Lc=(i,e)=>e.value;function Bv(i,e){if(i&1&&(s(0,"p",30),l(1),Le(2,"number"),a(),s(3,"p",31),l(4,"\u6210\u54E1\u6578"),a()),i&2){let t=f(3);d(),M(et(2,1,t.group().memberCount))}}function Vv(i,e){i&1&&(s(0,"p",32),l(1,"?"),a(),s(2,"p",33),l(3,"\u7121\u6578\u64DA"),a())}function Lv(i,e){i&1&&(s(0,"span",41),l(1,"\u23F3"),a(),s(2,"span"),l(3,"\u7372\u53D6\u4E2D..."),a())}function Ov(i,e){i&1&&(s(0,"span"),l(1,"\u{1F504}"),a(),s(2,"span"),l(3,"\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578"),a())}function Gv(i,e){if(i&1){let t=T();s(0,"div",27)(1,"div",34)(2,"span",35),l(3,"\u26A0\uFE0F"),a(),s(4,"div",24)(5,"p",36),l(6,"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\u64DA"),a(),s(7,"p",37),l(8,"\u53EF\u80FD\u539F\u56E0\uFF1A"),a(),s(9,"ul",38)(10,"li"),l(11,"\u5C1A\u672A\u52A0\u5165\u8A72\u7FA4\u7D44"),a(),s(12,"li"),l(13,"\u7FA4\u7D44\u5DF2\u8B8A\u70BA\u79C1\u6709"),a(),s(14,"li"),l(15,"\u983B\u9053\u985E\u578B\u4E0D\u652F\u6301\u63D0\u53D6\u6210\u54E1"),a(),s(16,"li"),l(17,"\u5E33\u865F\u88AB\u8E22\u51FA\u7FA4\u7D44"),a()(),s(18,"div",39)(19,"button",40),b("click",function(){v(t);let o=f(3);return x(o.refreshMemberCount())}),w(20,Lv,4,0)(21,Ov,4,0),a()()()()()}if(i&2){let t=f(3);d(19),V("disabled",t.isRefreshingCount()),d(),E(t.isRefreshingCount()?20:21)}}function Uv(i,e){i&1&&(s(0,"div",28)(1,"div",34)(2,"span",35),l(3,"\u{1F6AB}"),a(),s(4,"div",24)(5,"p",42),l(6,"\u983B\u9053\u4E0D\u652F\u6301\u6210\u54E1\u63D0\u53D6"),a(),s(7,"p",8),l(8," Telegram \u983B\u9053\uFF08Channel\uFF09\u6C92\u6709\u6210\u54E1\u5217\u8868\uFF0C\u53EA\u6709\u8A02\u95B1\u8005\u3002 \u5982\u9700\u7372\u53D6\u8A02\u95B1\u8005\u4FE1\u606F\uFF0C\u8ACB\u4F7F\u7528\u983B\u9053\u5206\u6790\u529F\u80FD\u3002 "),a()()()())}function qv(i,e){if(i&1){let t=T();s(0,"div",48)(1,"p",49),l(2,"\u{1F4CB} \u66FF\u4EE3\u65B9\u6848\uFF1A"),a(),s(3,"ul",50)(4,"li",51)(5,"span",52),l(6,"1."),a(),s(7,"span"),l(8,"\u78BA\u4FDD\u7FA4\u7D44\u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u767C\u8A00\u7528\u6236"),a()(),s(9,"li",51)(10,"span",52),l(11,"2."),a(),s(12,"span"),l(13,"\u5728\u300C\u5DF2\u6536\u96C6\u7528\u6236\u300D\u6A19\u7C64\u9801\u67E5\u770B\u76E3\u63A7\u671F\u9593\u6536\u96C6\u7684\u7528\u6236"),a()(),s(14,"li",51)(15,"span",52),l(16,"3."),a(),s(17,"span"),l(18,"\u6216\u806F\u7E6B\u7FA4\u4E3B\u7372\u53D6\u7BA1\u7406\u54E1\u6B0A\u9650"),a()()()(),s(19,"div",53)(20,"button",54),b("click",function(){v(t);let o=f(4);return x(o.checkMonitoringStatus())}),s(21,"span"),l(22,"\u{1F4E1}"),a(),s(23,"span"),l(24,"\u78BA\u8A8D\u76E3\u63A7\u72C0\u614B"),a()(),s(25,"button",55),b("click",function(){v(t);let o=f(4);return x(o.collectFromHistory())}),s(26,"span"),l(27,"\u{1F504}"),a(),s(28,"span"),l(29,"\u5F9E\u6B77\u53F2\u6536\u96C6"),a()(),s(30,"button",56),b("click",function(){v(t);let o=f(4);return x(o.viewCollectedUsers())}),s(31,"span"),l(32,"\u{1F465}"),a(),s(33,"span"),l(34),a()()()}if(i&2){let t=f(4);d(34),A("\u67E5\u770B\u5DF2\u6536\u96C6 (",t.collectedUsersCount(),")")}}function $v(i,e){if(i&1&&(s(0,"div",46)(1,"p",57)(2,"span"),l(3,"\u{1F4A1}"),a(),s(4,"span"),l(5),a()()()),i&2){let t=f(4);d(5),M(t.extractionError().suggestion)}}function Hv(i,e){if(i&1){let t=T();s(0,"button",58),b("click",function(){v(t);let o=f(4);return x(o.joinGroup())}),s(1,"span"),l(2,"\u2795"),a(),s(3,"span"),l(4,"\u52A0\u5165\u7FA4\u7D44"),a()()}}function Kv(i,e){if(i&1&&(s(0,"div",43)(1,"div",34)(2,"span",35),l(3),a(),s(4,"div",24)(5,"p",44),l(6),a(),s(7,"p",45),l(8),a(),w(9,qv,35,1)(10,$v,6,1,"div",46),w(11,Hv,5,0,"button",47),a()()()),i&2){let t=f(3);I("bg-red-500/10",t.extractionError().code==="ADMIN_REQUIRED")("border-red-500/30",t.extractionError().code==="ADMIN_REQUIRED")("bg-amber-500/10",t.extractionError().code!=="ADMIN_REQUIRED")("border-amber-500/30",t.extractionError().code!=="ADMIN_REQUIRED"),d(3),M(t.extractionError().code==="ADMIN_REQUIRED"?"\u{1F512}":"\u26A0\uFE0F"),d(2),I("text-red-400",t.extractionError().code==="ADMIN_REQUIRED")("text-amber-400",t.extractionError().code!=="ADMIN_REQUIRED"),d(),A(" ",t.extractionError().title," "),d(2),M(t.extractionError().reason),d(),E(t.extractionError().code==="ADMIN_REQUIRED"?9:10),d(2),E(t.extractionError().canAutoJoin?11:-1)}}function zv(i,e){if(i&1&&(s(0,"div",22)(1,"div",5)(2,"div",23),l(3),a(),s(4,"div",24)(5,"h3",25),l(6),a(),s(7,"p",8),l(8),a()(),s(9,"div",26),w(10,Bv,5,3)(11,Vv,4,0),a()()(),w(12,Gv,22,2,"div",27),w(13,Uv,9,0,"div",28),w(14,Kv,12,17,"div",29)),i&2){let t=f(2);d(3),A(" ",t.group().name[0]," "),d(3),M(t.group().name),d(2),M(t.group().url||"\u79C1\u5BC6\u7FA4\u7D44"),d(2),E(t.group().memberCount>0?10:11),d(2),E(t.group().memberCount===0?12:-1),d(),E(t.isChannel()?13:-1),d(),E(t.extractionError()?14:-1)}}function Wv(i,e){i&1&&(s(0,"span",79),l(1,"\u{1F512}"),a())}function Jv(i,e){if(i&1){let t=T();s(0,"button",78),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.setLimit(o.value))}),l(1),w(2,Wv,2,0,"span",79),a()}if(i&2){let t=e.$implicit,n=f(3);I("border-emerald-500",n.config().limit===t.value)("bg-emerald-500/20",n.config().limit===t.value)("text-emerald-400",n.config().limit===t.value)("border-slate-700",n.config().limit!==t.value)("bg-slate-800/50",n.config().limit!==t.value)("text-slate-400",n.config().limit!==t.value),V("disabled",t.value>n.maxLimit()),d(),A(" ",t.label," "),d(),E(t.value>n.maxLimit()?2:-1)}}function Qv(i,e){if(i&1){let t=T();s(0,"button",80),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.setOnlineStatus(o.value))}),l(1),a()}if(i&2){let t=e.$implicit,n=f(3);I("border-cyan-500",n.config().filters.onlineStatus===t.value)("bg-cyan-500/20",n.config().filters.onlineStatus===t.value)("text-cyan-400",n.config().filters.onlineStatus===t.value)("border-slate-700",n.config().filters.onlineStatus!==t.value)("bg-slate-800/50",n.config().filters.onlineStatus!==t.value)("text-slate-400",n.config().filters.onlineStatus!==t.value),d(),Y(" ",t.icon," ",t.label," ")}}function Yv(i,e){if(i&1){let t=T();s(0,"div",77)(1,"div")(2,"label",81),l(3,"\u23F0 \u6D3B\u8E8D\u5EA6\u7BE9\u9078"),a(),s(4,"div",82)(5,"span",83),l(6,"\u6700\u8FD1"),a(),s(7,"select",84),b("change",function(o){v(t);let r=f(3);return x(r.setActivityDays(o))}),s(8,"option",85),l(9,"\u4E0D\u9650"),a(),s(10,"option",86),l(11,"3 \u5929"),a(),s(12,"option",87),l(13,"7 \u5929"),a(),s(14,"option",88),l(15,"14 \u5929"),a(),s(16,"option",89),l(17,"30 \u5929"),a()(),s(18,"span",83),l(19,"\u5167\u6D3B\u52D5"),a()()(),s(20,"div",68)(21,"label",90)(22,"input",70),b("change",function(){v(t);let o=f(3);return x(o.toggleAdvanced("autoSaveToResources"))}),a(),s(23,"div")(24,"p",71),l(25,"\u81EA\u52D5\u4FDD\u5B58"),a(),s(26,"p",31),l(27,"\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3"),a()()(),s(28,"label",90)(29,"input",70),b("change",function(){v(t);let o=f(3);return x(o.toggleAdvanced("skipDuplicates"))}),a(),s(30,"div")(31,"p",71),l(32,"\u8DF3\u904E\u91CD\u8907"),a(),s(33,"p",31),l(34,"\u5DF2\u5B58\u5728\u7684\u6210\u54E1"),a()()(),s(35,"label",90)(36,"input",70),b("change",function(){v(t);let o=f(3);return x(o.toggleFilter("excludeAdmins"))}),a(),s(37,"div")(38,"p",71),l(39,"\u6392\u9664\u7BA1\u7406\u54E1"),a(),s(40,"p",31),l(41,"\u7FA4\u4E3B\u548C\u7BA1\u7406\u54E1"),a()()(),s(42,"label",90)(43,"input",70),b("change",function(){v(t);let o=f(3);return x(o.toggleAdvanced("shuffleOrder"))}),a(),s(44,"div")(45,"p",71),l(46,"\u96A8\u6A5F\u9806\u5E8F"),a(),s(47,"p",31),l(48,"\u6253\u4E82\u63D0\u53D6\u9806\u5E8F"),a()()()()()}if(i&2){let t=f(3);d(7),V("value",t.config().filters.minActivityDays||""),d(15),V("checked",t.config().advanced.autoSaveToResources),d(7),V("checked",t.config().advanced.skipDuplicates),d(7),V("checked",t.config().filters.excludeAdmins),d(7),V("checked",t.config().advanced.shuffleOrder)}}function Xv(i,e){if(i&1){let t=T();s(0,"div")(1,"label",59),l(2," \u26A1 \u5FEB\u901F\u6A21\u677F "),a(),s(3,"div",60)(4,"button",61),b("click",function(){v(t);let o=f(2);return x(o.selectTemplate("quick"))}),s(5,"div",62),l(6,"\u26A1"),a(),s(7,"p",63),l(8,"\u5FEB\u901F\u63D0\u53D6"),a(),s(9,"p",64),l(10,"100\u4EBA \xB7 \u50C5\u5728\u7DDA"),a()(),s(11,"button",61),b("click",function(){v(t);let o=f(2);return x(o.selectTemplate("deep"))}),s(12,"div",62),l(13,"\u{1F50D}"),a(),s(14,"p",63),l(15,"\u6DF1\u5EA6\u63D0\u53D6"),a(),s(16,"p",64),l(17,"500\u4EBA \xB7 \u5168\u72C0\u614B"),a()(),s(18,"button",61),b("click",function(){v(t);let o=f(2);return x(o.selectTemplate("precise"))}),s(19,"div",62),l(20,"\u{1F3AF}"),a(),s(21,"p",63),l(22,"\u7CBE\u6E96\u63D0\u53D6"),a(),s(23,"p",64),l(24,"\u81EA\u5B9A\u7FA9\u689D\u4EF6"),a()()()(),s(25,"div")(26,"label",59),l(27," \u{1F522} \u63D0\u53D6\u6578\u91CF "),a(),s(28,"div",53),$(29,Jv,3,15,"button",65,Lc),a()(),s(31,"div")(32,"label",59),l(33," \u{1F4CD} \u5728\u7DDA\u72C0\u614B "),a(),s(34,"div",66),$(35,Qv,2,14,"button",67,Lc),a()(),s(37,"div")(38,"label",59),l(39," \u{1F3F7}\uFE0F \u6210\u54E1\u5C6C\u6027 "),a(),s(40,"div",68)(41,"label",69)(42,"input",70),b("change",function(){v(t);let o=f(2);return x(o.toggleFilter("excludeBots"))}),a(),s(43,"div")(44,"p",71),l(45,"\u6392\u9664\u6A5F\u5668\u4EBA"),a(),s(46,"p",31),l(47,"\u904E\u6FFE Bot \u5E33\u865F"),a()()(),s(48,"label",69)(49,"input",70),b("change",function(){v(t);let o=f(2);return x(o.toggleFilter("hasUsername"))}),a(),s(50,"div")(51,"p",71),l(52,"\u9700\u6709\u7528\u6236\u540D"),a(),s(53,"p",31),l(54,"\u50C5\u63D0\u53D6\u6709 @username"),a()()(),s(55,"label",69)(56,"input",70),b("change",function(){v(t);let o=f(2);return x(o.toggleFilter("hasChinese"))}),a(),s(57,"div")(58,"p",71),l(59,"\u50C5\u83EF\u4EBA\u7528\u6236"),a(),s(60,"p",31),l(61,"\u4E2D\u6587\u540D\u7A31\u512A\u5148"),a()()(),s(62,"label",69)(63,"input",70),b("change",function(){v(t);let o=f(2);return x(o.toggleFilter("isPremium"))}),a(),s(64,"div")(65,"p",71),l(66,"Premium \u7528\u6236"),a(),s(67,"p",31),l(68,"\u50C5\u4ED8\u8CBB\u6703\u54E1 \u2B50"),a()()()()(),s(69,"div",72)(70,"button",73),b("click",function(){v(t);let o=f(2);return x(o.showAdvanced.set(!o.showAdvanced()))}),s(71,"span",74),l(72,"\u2699\uFE0F \u9AD8\u7D1A\u9078\u9805"),a(),te(),s(73,"svg",75),k(74,"path",76),a()(),w(75,Yv,49,5,"div",77),a()}if(i&2){let t=f(2);d(4),I("border-emerald-500",t.selectedTemplate()==="quick")("bg-emerald-500/20",t.selectedTemplate()==="quick")("border-slate-700",t.selectedTemplate()!=="quick")("bg-slate-800/50",t.selectedTemplate()!=="quick"),d(7),I("border-blue-500",t.selectedTemplate()==="deep")("bg-blue-500/20",t.selectedTemplate()==="deep")("border-slate-700",t.selectedTemplate()!=="deep")("bg-slate-800/50",t.selectedTemplate()!=="deep"),d(7),I("border-purple-500",t.selectedTemplate()==="precise")("bg-purple-500/20",t.selectedTemplate()==="precise")("border-slate-700",t.selectedTemplate()!=="precise")("bg-slate-800/50",t.selectedTemplate()!=="precise"),d(11),H(t.limitOptions),d(6),H(t.onlineStatusOptions),d(7),V("checked",t.config().filters.excludeBots),d(7),V("checked",t.config().filters.hasUsername===!0),d(7),V("checked",t.config().filters.hasChinese===!0),d(7),V("checked",t.config().filters.isPremium===!0),d(10),I("rotate-180",t.showAdvanced()),d(2),E(t.showAdvanced()?75:-1)}}function Zv(i,e){if(i&1){let t=T();s(0,"div",1),b("click",function(o){v(t);let r=f();return x(r.onBackdropClick(o))}),s(1,"div",2),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),l(6," \u{1F465} "),a(),s(7,"div")(8,"h2",7),l(9,"\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1"),a(),s(10,"p",8),l(11,"\u914D\u7F6E\u63D0\u53D6\u9078\u9805\u548C\u7BE9\u9078\u689D\u4EF6"),a()()(),s(12,"button",9),b("click",function(){v(t);let o=f();return x(o.close())}),te(),s(13,"svg",10),k(14,"path",11),a()()()(),le(),s(15,"div",12),w(16,zv,15,7),w(17,Xv,76,31),a(),s(18,"div",13)(19,"div",14)(20,"div",15)(21,"span",16),l(22," \u{1F4A1} \u9810\u8A08\u63D0\u53D6\uFF1A "),s(23,"span",17),l(24),a(),l(25," \u4EBA "),a()(),s(26,"div",16),l(27," \u{1F4CA} \u4ECA\u65E5\u914D\u984D\uFF1A "),s(28,"span",18),l(29),a(),l(30),a()(),s(31,"div",19)(32,"button",20),b("click",function(){v(t);let o=f();return x(o.close())}),l(33," \u53D6\u6D88 "),a(),s(34,"button",21),b("click",function(){v(t);let o=f();return x(o.startExtraction())}),s(35,"span"),l(36,"\u{1F465}"),a(),s(37,"span"),l(38),a()()()()()()}if(i&2){let t=f();d(16),E(t.group()?16:-1),d(),E(t.isChannel()?-1:17),d(7),M(t.estimatedCount()),d(5),M(t.remainingQuota()),d(),A(" / ",t.dailyQuota()," "),d(4),V("disabled",!t.canStart()),d(4),A("\u958B\u59CB\u63D0\u53D6 (",t.config().limit," \u4EBA)")}}var Co=class i{constructor(){this.isOpen=tt(!1);this.group=tt(null);this.closeDialog=Ee();this.startExtractionEvent=Ee();this.memberCountRefreshed=Ee();this.enableMonitoringEvent=Ee();this.joinGroupEvent=Ee();this.viewCollectedUsersEvent=Ee();this.ipcService=B(De);this.toast=B(me);this.showAdvanced=C(!1);this.selectedTemplate=C("quick");this.isRefreshingCount=C(!1);this.extractionError=C(null);this.collectedUsersCount=C(0);this.isMonitoring=C(!1);this.config=C({limit:100,filters:{onlineStatus:"all",hasChinese:null,hasUsername:null,isPremium:null,excludeBots:!0,excludeAdmins:!1,minActivityDays:null},advanced:{shuffleOrder:!1,skipDuplicates:!0,autoSaveToResources:!0,extractAvatar:!1}});this.limitOptions=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:-1,label:"\u5168\u90E8"}];this.onlineStatusOptions=[{value:"all",label:"\u5168\u90E8",icon:"\u{1F4CA}"},{value:"online",label:"\u5728\u7DDA",icon:"\u{1F7E2}"},{value:"recently",label:"\u6700\u8FD1",icon:"\u{1F7E1}"},{value:"offline",label:"\u96E2\u7DDA",icon:"\u26AB"}];this.maxLimit=L(()=>{let e=this.group()?.memberCount||0;return Math.min(e,1e4)});this.dailyQuota=C(1e3);this.remainingQuota=C(800);this.estimatedCount=L(()=>{let e=this.config().limit,t=this.group()?.memberCount||0;return e===-1?Math.min(t,this.remainingQuota()):Math.min(e,t,this.remainingQuota())});this.isChannel=L(()=>this.group()?.resourceType==="channel");this.canStart=L(()=>!this.group()||this.isChannel()?!1:this.estimatedCount()>0);this.listeners=[]}ngOnInit(){this.loadQuota(),this.listenForExtractionErrors(),this.loadCollectedUsersCount()}ngOnDestroy(){this.listeners.forEach(e=>e())}loadQuota(){let e=this.ipcService.on("extraction-quota",t=>{t&&(this.dailyQuota.set(t.daily||1e3),this.remainingQuota.set(t.remaining||800))});this.listeners.push(e),this.ipcService.send("get-extraction-quota",{})}listenForExtractionErrors(){let e=this.ipcService.on("members-extracted",t=>{let n=this.group();if(!(!n||String(t.resourceId)!==String(n.id)))if(!t.success&&t.error_code){let o=t.error_details||{},c={ADMIN_REQUIRED:{title:"\u9700\u8981\u7BA1\u7406\u54E1\u6B0A\u9650",defaultReason:"\u6B64\u7FA4\u7D44\u8A2D\u7F6E\u4E86\u6210\u54E1\u5217\u8868\u53EA\u5C0D\u7BA1\u7406\u54E1\u53EF\u898B"},PEER_ID_INVALID:{title:"\u5E33\u865F\u5C1A\u672A\u9023\u63A5\u6B64\u7FA4\u7D44",defaultReason:"Telegram \u8981\u6C42\u5E33\u865F\u5FC5\u9808\u5148\u52A0\u5165\u7FA4\u7D44"},NOT_PARTICIPANT:{title:"\u5E33\u865F\u4E0D\u662F\u7FA4\u7D44\u6210\u54E1",defaultReason:"\u7576\u524D\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44"},CHANNEL_PRIVATE:{title:"\u79C1\u6709\u7FA4\u7D44",defaultReason:"\u9019\u662F\u4E00\u500B\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u5148\u52A0\u5165"},CHANNEL_INVALID:{title:"\u7121\u6548\u7684\u7FA4\u7D44",defaultReason:"\u7FA4\u7D44\u53EF\u80FD\u5DF2\u88AB\u522A\u9664\u6216 ID \u7121\u6548"},USERNAME_NOT_OCCUPIED:{title:"\u7121\u6CD5\u89E3\u6790\u7FA4\u7D44",defaultReason:"\u9019\u53EF\u80FD\u662F\u79C1\u6709\u7FA4\u7D44\uFF0C\u6C92\u6709\u516C\u958B\u7684 username"}}[t.error_code]||{title:"\u63D0\u53D6\u5931\u6557",defaultReason:t.error||"\u672A\u77E5\u932F\u8AA4"};this.extractionError.set({code:t.error_code,title:c.title,reason:o.reason||c.defaultReason,suggestion:o.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66\u6216\u5617\u8A66\u5176\u4ED6\u65B9\u5F0F",alternative:o.alternative==="monitor_messages"?"monitor":void 0,canAutoJoin:o.can_auto_join})}else t.success&&this.extractionError.set(null)});this.listeners.push(e)}enableMonitoring(){let e=this.group();e&&(this.enableMonitoringEvent.emit(e),this.toast.info("\u{1F4E1} \u6B63\u5728\u958B\u555F\u6D88\u606F\u76E3\u63A7\uFF0C\u5C07\u81EA\u52D5\u6536\u96C6\u767C\u8A00\u7528\u6236"),this.close())}joinGroup(){let e=this.group();e&&(this.joinGroupEvent.emit(e),this.toast.info("\u2795 \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44..."))}selectTemplate(e){switch(this.selectedTemplate.set(e),e){case"quick":this.config.update(t=>N(F({},t),{limit:100,filters:N(F({},t.filters),{onlineStatus:"online",excludeBots:!0})}));break;case"deep":this.config.update(t=>N(F({},t),{limit:500,filters:N(F({},t.filters),{onlineStatus:"all",excludeBots:!0})}));break;case"precise":break}}setLimit(e){this.selectedTemplate.set("precise"),this.config.update(t=>N(F({},t),{limit:e}))}setOnlineStatus(e){this.selectedTemplate.set("precise"),this.config.update(t=>N(F({},t),{filters:N(F({},t.filters),{onlineStatus:e})}))}toggleFilter(e){this.selectedTemplate.set("precise"),this.config.update(t=>{let n=F({},t.filters);return e==="excludeBots"||e==="excludeAdmins"?n[e]=!n[e]:n[e]===null||n[e]===void 0?n[e]=!0:n[e]===!0?n[e]=!1:n[e]=null,N(F({},t),{filters:n})})}toggleAdvanced(e){this.config.update(t=>N(F({},t),{advanced:N(F({},t.advanced),{[e]:!t.advanced[e]})}))}setActivityDays(e){let t=e.target.value,n=t?parseInt(t,10):null;this.selectedTemplate.set("precise"),this.config.update(o=>N(F({},o),{filters:N(F({},o.filters),{minActivityDays:n})}))}refreshMemberCount(){let e=this.group();if(!e)return;this.isRefreshingCount.set(!0);let t=this.ipcService.on("group-member-count-result",n=>{this.isRefreshingCount.set(!1),t(),n.success&&n.memberCount>0?(this.toast.success(`\u2705 \u6210\u529F\u7372\u53D6\u6210\u54E1\u6578\uFF1A${n.memberCount} \u4EBA`),this.memberCountRefreshed.emit({groupId:e.id,memberCount:n.memberCount})):this.toast.error(n.error||"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\uFF0C\u8ACB\u78BA\u8A8D\u5DF2\u52A0\u5165\u8A72\u7FA4\u7D44")});this.listeners.push(t),this.ipcService.send("get-group-member-count",{groupId:e.id,url:e.url,telegramId:e.telegramId||e.id,accountPhone:e.accountPhone}),setTimeout(()=>{this.isRefreshingCount()&&(this.isRefreshingCount.set(!1),this.toast.error("\u7372\u53D6\u6210\u54E1\u6578\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"))},15e3)}startExtraction(){let e=this.group();if(!e){this.toast.error("\u7FA4\u7D44\u4FE1\u606F\u4E0D\u5B58\u5728");return}if(this.estimatedCount()===0){this.toast.warning("\u6210\u54E1\u6578\u64DA\u4E0D\u53EF\u7528\uFF0C\u8ACB\u5148\u9EDE\u64CA\u300C\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578\u300D");return}this.startExtractionEvent.emit({group:e,config:this.config()}),this.close()}close(){this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&this.close()}checkMonitoringStatus(){let e=this.group();if(!e)return;this.ipcService.send("get-group-monitoring-status",{groupId:e.id,telegramId:e.telegramId});let t=this.ipcService.on("group-monitoring-status",n=>{String(n.groupId)===String(e.id)&&(this.isMonitoring.set(n.isMonitoring),this.collectedUsersCount.set(n.collectedUsers||0),n.isMonitoring?this.toast.success(`\u2705 \u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u5DF2\u6536\u96C6 ${n.collectedUsers} \u4F4D\u7528\u6236`):this.toast.warning("\u26A0\uFE0F \u76E3\u63A7\u672A\u958B\u555F\uFF0C\u8ACB\u5728\u7FA4\u7D44\u8A73\u60C5\u4E2D\u958B\u555F\u76E3\u63A7"),t())});this.listeners.push(t),this.toast.info("\u{1F50D} \u6B63\u5728\u6AA2\u67E5\u76E3\u63A7\u72C0\u614B...")}viewCollectedUsers(){let e=this.group();e&&(this.viewCollectedUsersEvent.emit(e),this.close())}collectFromHistory(){let e=this.group();if(!e)return;this.toast.info("\u{1F504} \u6B63\u5728\u5F9E\u6B77\u53F2\u6D88\u606F\u4E2D\u6536\u96C6\u7528\u6236..."),this.ipcService.send("collect-users-from-history",{groupId:e.id,telegramId:e.telegramId,limit:500});let t=this.ipcService.on("collect-from-history-result",n=>{String(n.groupId)===String(e.id)&&(t(),n.success?(this.toast.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${n.collected} \u4F4D\u7528\u6236\uFF0C\u65B0\u589E ${n.newUsers||0} \u4F4D`),this.collectedUsersCount.update(o=>o+(n.newUsers||0))):this.toast.error(n.error||"\u6536\u96C6\u5931\u6557"))});this.listeners.push(t)}loadCollectedUsersCount(){let e=this.group();if(!e)return;this.ipcService.send("get-collected-users-count",{groupId:e.id,sourceType:"monitoring"});let t=this.ipcService.on("collected-users-count",n=>{String(n.groupId)===String(e.id)&&(this.collectedUsersCount.set(n.count||0),t())});this.listeners.push(t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-member-extraction-dialog"]],inputs:{isOpen:[1,"isOpen"],group:[1,"group"]},outputs:{closeDialog:"closeDialog",startExtractionEvent:"startExtractionEvent",memberCountRefreshed:"memberCountRefreshed",enableMonitoringEvent:"enableMonitoringEvent",joinGroupEvent:"joinGroupEvent",viewCollectedUsersEvent:"viewCollectedUsersEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col",3,"click"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","space-y-5"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"flex","items-center","justify-between","mb-4","text-sm"],[1,"flex","items-center","gap-4"],[1,"text-slate-400"],[1,"text-emerald-400","font-medium"],[1,"text-cyan-400","font-medium"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-colors","font-medium",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-emerald-500/20","to-cyan-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1"],[1,"font-medium","text-white"],[1,"text-right"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-4","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"border",3,"bg-red-500/10","border-red-500/30","bg-amber-500/10","border-amber-500/30"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-lg","font-bold","text-amber-400"],[1,"text-xs","text-amber-400"],[1,"flex","items-start","gap-3"],[1,"text-xl"],[1,"font-medium","text-amber-400","mb-1"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-slate-400","space-y-1","list-disc","list-inside","mb-3"],[1,"flex","gap-2"],[1,"px-3","py-1.5","bg-amber-500/20","hover:bg-amber-500/30","text-amber-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-1",3,"click","disabled"],[1,"animate-spin"],[1,"font-medium","text-red-400","mb-1"],[1,"border"],[1,"font-medium","mb-1"],[1,"text-sm","text-slate-400","mb-2"],[1,"p-3","bg-slate-800/50","rounded-lg"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2"],[1,"p-3","bg-slate-800/50","rounded-lg","mb-3"],[1,"text-sm","text-slate-300","mb-2"],[1,"text-sm","text-slate-400","space-y-1.5"],[1,"flex","items-start","gap-2"],[1,"text-emerald-400"],[1,"flex","flex-wrap","gap-2"],[1,"px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-orange-500/20","hover:bg-orange-500/30","text-orange-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-sm","text-cyan-400","flex","items-center","gap-2"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"grid","grid-cols-3","gap-3"],[1,"p-4","rounded-xl","border","transition-all","text-center","group",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","mt-1"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-emerald-500","bg-emerald-500/20","text-emerald-400","border-slate-700","bg-slate-800/50","text-slate-400","disabled"],[1,"grid","grid-cols-4","gap-2"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"border-cyan-500","bg-cyan-500/20","text-cyan-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","gap-3","p-3","bg-slate-800/50","rounded-xl","border","border-slate-700/50","cursor-pointer","hover:bg-slate-800","transition-colors"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600","text-emerald-500","focus:ring-emerald-500",3,"change","checked"],[1,"text-sm","text-white"],[1,"border","border-slate-700/50","rounded-xl","overflow-hidden"],[1,"w-full","p-4","bg-slate-800/30","flex","items-center","justify-between","hover:bg-slate-800/50","transition-colors",3,"click"],[1,"text-sm","font-medium","text-slate-300"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-400","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-4","space-y-4","border-t","border-slate-700/50"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"click","disabled"],[1,"ml-1","text-xs","text-orange-400"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"click"],[1,"block","text-sm","text-slate-400","mb-2"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-slate-300"],[1,"px-3","py-1.5","bg-slate-700","border","border-slate-600","rounded-lg","text-sm","text-white","focus:ring-emerald-500","focus:border-emerald-500",3,"change","value"],["value",""],["value","3"],["value","7"],["value","14"],["value","30"],[1,"flex","items-center","gap-3","cursor-pointer","p-2","bg-slate-700/30","rounded-lg","hover:bg-slate-700/50"]],template:function(t,n){t&1&&w(0,Zv,39,7,"div",0),t&2&&E(n.isOpen()?0:-1)},dependencies:[oe,ue,He,Ke,Wt],encapsulation:2})}};var jv=(i,e)=>e.title,ex=(i,e)=>e.id;function tx(i,e){i&1&&(s(0,"div",11)(1,"div",16),l(2,"\u{1F50D}"),a(),s(3,"p",17),l(4,"\u672A\u627E\u5230\u5339\u914D\u7684\u7D50\u679C"),a(),s(5,"p",18),l(6,"\u5617\u8A66\u5176\u4ED6\u95DC\u9375\u8A5E"),a()())}function nx(i,e){if(i&1&&(s(0,"div",26),l(1),a()),i&2){let t=f().$implicit;d(),M(t.subtitle)}}function ix(i,e){if(i&1&&(s(0,"kbd",9),l(1),a()),i&2){let t=f().$implicit;d(),A(" ",t.shortcut," ")}}function ox(i,e){if(i&1){let t=T();s(0,"div",22),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.executeCommand(o))})("mouseenter",function(){let o=v(t).$index,r=f().$implicit,c=f(3);return x(c.selectedIndex.set(c.getGlobalIndex(r,o)))}),s(1,"div",23),l(2),a(),s(3,"div",24)(4,"div",25),l(5),a(),w(6,nx,2,1,"div",26),a(),s(7,"span",27),l(8),a(),w(9,ix,2,1,"kbd",9),a()}if(i&2){let t=e.$implicit,n=e.$index,o=f().$implicit,r=f(3);I("bg-cyan-500/20",r.isSelected(o,n))("hover:bg-slate-800",!r.isSelected(o,n)),d(),I("bg-cyan-500/20",r.isSelected(o,n))("bg-slate-800",!r.isSelected(o,n)),d(),A(" ",t.icon," "),d(3),M(t.title),d(),E(t.subtitle?6:-1),d(),I("bg-blue-500/20",t.type==="page")("text-blue-400",t.type==="page")("bg-green-500/20",t.type==="action")("text-green-400",t.type==="action")("bg-purple-500/20",t.type==="contact")("text-purple-400",t.type==="contact")("bg-amber-500/20",t.type==="recent")("text-amber-400",t.type==="recent"),d(),A(" ",r.getTypeLabel(t.type)," "),d(),E(t.shortcut?9:-1)}}function rx(i,e){if(i&1&&(s(0,"div",19)(1,"div",20),l(2),a(),$(3,ox,10,29,"div",21,ex),a()),i&2){let t=e.$implicit;d(2),A(" ",t.title," "),d(),H(t.items)}}function sx(i,e){if(i&1&&$(0,rx,5,1,"div",19,jv),i&2){let t=f(2);H(t.filteredGroups())}}function ax(i,e){if(i&1){let t=T();s(0,"div",2),b("click",function(){v(t);let o=f();return x(o.close())}),k(1,"div",3),s(2,"div",4),b("click",function(o){return v(t),x(o.stopPropagation())}),s(3,"div",5),te(),s(4,"svg",6),k(5,"path",7),a(),le(),s(6,"input",8,0),W("ngModelChange",function(o){v(t);let r=f();return z(r.query,o)||(r.query=o),x(o)}),b("ngModelChange",function(o){v(t);let r=f();return x(r.onQueryChange(o))})("keydown",function(o){v(t);let r=f();return x(r.onKeyDown(o))}),a(),s(8,"kbd",9),l(9,"ESC"),a()(),s(10,"div",10),w(11,tx,7,0,"div",11)(12,sx,2,0),a(),s(13,"div",12)(14,"div",13)(15,"span",14)(16,"kbd",15),l(17,"\u2191"),a(),s(18,"kbd",15),l(19,"\u2193"),a(),l(20," \u5C0E\u822A "),a(),s(21,"span",14)(22,"kbd",15),l(23,"\u21B5"),a(),l(24," \u9078\u64C7 "),a(),s(25,"span",14)(26,"kbd",15),l(27,"ESC"),a(),l(28," \u95DC\u9589 "),a()(),s(29,"span"),l(30,"TG-Matrix \u547D\u4EE4\u9762\u677F"),a()()()()}if(i&2){let t=f();I("animate-fade-in",t.animateIn()),d(2),I("animate-slide-down",t.animateIn()),d(4),K("ngModel",t.query),d(5),E(t.filteredGroups().length===0?11:12)}}var vo=class i{constructor(){this.navigate=Ee();this.isOpen=C(!1);this.animateIn=C(!0);this.query="";this.selectedIndex=C(0);this.recentPages=C([]);this.commands=C([]);this.filteredGroups=L(()=>{let e=this.query.toLowerCase().trim(),t=this.commands();if(!e)return this.getDefaultGroups(t);let n=t.filter(o=>o.title.toLowerCase().includes(e)||o.subtitle?.toLowerCase().includes(e)||o.keywords.some(r=>r.toLowerCase().includes(e)));return this.groupByType(n)})}ngOnInit(){this.initCommands(),this.loadRecentPages()}ngOnDestroy(){}initCommands(){let e=[{id:"nav-dashboard",type:"page",icon:"\u{1F4CA}",title:"\u5100\u8868\u677F",subtitle:"\u67E5\u770B\u7CFB\u7D71\u6982\u89BD",keywords:["dashboard","\u9996\u9801","\u6982\u89BD"],action:()=>this.navigateTo("dashboard")},{id:"nav-accounts",type:"page",icon:"\u{1F464}",title:"\u5E33\u865F\u7BA1\u7406",subtitle:"\u7BA1\u7406 Telegram \u5E33\u865F",keywords:["accounts","\u5E33\u6236","\u767B\u9304"],action:()=>this.navigateTo("accounts")},{id:"nav-resource",type:"page",icon:"\u{1F4C7}",title:"\u8CC7\u6E90\u4E2D\u5FC3",subtitle:"\u7BA1\u7406\u806F\u7E6B\u4EBA\u548C\u7FA4\u7D44",keywords:["resource","\u806F\u7E6B\u4EBA","\u7FA4\u7D44","contacts"],action:()=>this.navigateTo("resource-center")},{id:"nav-ai-assistant",type:"page",icon:"\u{1F3AF}",title:"\u7B56\u7565\u898F\u5283",subtitle:"AI \u71DF\u92B7\u52A9\u624B",keywords:["ai","\u71DF\u92B7","\u7B56\u7565","marketing"],action:()=>this.navigateTo("ai-assistant")},{id:"nav-ai-team",type:"page",icon:"\u{1F916}",title:"\u81EA\u52D5\u57F7\u884C",subtitle:"AI \u5718\u968A\u92B7\u552E",keywords:["ai","\u5718\u968A","\u81EA\u52D5","team"],action:()=>this.navigateTo("ai-team")},{id:"nav-analytics",type:"page",icon:"\u{1F4C8}",title:"\u6578\u64DA\u6D1E\u5BDF",subtitle:"\u667A\u80FD\u5206\u6790\u5831\u544A",keywords:["analytics","\u5206\u6790","\u5831\u544A","\u7D71\u8A08"],action:()=>this.navigateTo("analytics")},{id:"nav-automation",type:"page",icon:"\u26A1",title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",subtitle:"\u76E3\u63A7\u548C\u81EA\u52D5\u56DE\u8986",keywords:["automation","\u81EA\u52D5\u5316","\u76E3\u63A7"],action:()=>this.navigateTo("automation")},{id:"nav-leads",type:"page",icon:"\u{1F3AF}",title:"\u6F5B\u5728\u5BA2\u6236",subtitle:"\u5BA2\u6236\u7BA1\u7406",keywords:["leads","\u5BA2\u6236","crm"],action:()=>this.navigateTo("leads")},{id:"nav-settings",type:"page",icon:"\u2699\uFE0F",title:"\u7CFB\u7D71\u8A2D\u7F6E",subtitle:"\u914D\u7F6E\u7CFB\u7D71\u9078\u9805",keywords:["settings","\u8A2D\u7F6E","\u914D\u7F6E"],action:()=>this.navigateTo("settings")},{id:"action-add-account",type:"action",icon:"\u2795",title:"\u6DFB\u52A0\u5E33\u865F",subtitle:"\u6DFB\u52A0\u65B0\u7684 Telegram \u5E33\u865F",keywords:["add","account","\u65B0\u589E"],shortcut:"\u2318N",action:()=>this.navigateTo("add-account")},{id:"action-send-message",type:"action",icon:"\u2709\uFE0F",title:"\u767C\u9001\u6D88\u606F",subtitle:"\u5411\u806F\u7E6B\u4EBA\u767C\u9001\u6D88\u606F",keywords:["send","message","\u767C\u9001"],action:()=>this.emitAction("send-message")},{id:"action-extract",type:"action",icon:"\u{1F4E5}",title:"\u63D0\u53D6\u6210\u54E1",subtitle:"\u5F9E\u7FA4\u7D44\u63D0\u53D6\u6210\u54E1",keywords:["extract","member","\u63D0\u53D6"],action:()=>this.emitAction("extract-members")},{id:"action-search-group",type:"action",icon:"\u{1F50D}",title:"\u641C\u7D22\u7FA4\u7D44",subtitle:"\u641C\u7D22 Telegram \u7FA4\u7D44",keywords:["search","group","\u641C\u7D22"],action:()=>this.emitAction("search-groups")},{id:"action-start-monitor",type:"action",icon:"\u{1F4E1}",title:"\u555F\u52D5\u76E3\u63A7",subtitle:"\u958B\u59CB\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F",keywords:["monitor","start","\u76E3\u63A7"],action:()=>this.emitAction("start-monitor")},{id:"action-refresh",type:"action",icon:"\u{1F504}",title:"\u5237\u65B0\u6578\u64DA",subtitle:"\u91CD\u65B0\u52A0\u8F09\u6578\u64DA",keywords:["refresh","reload","\u5237\u65B0"],shortcut:"\u2318R",action:()=>this.emitAction("refresh")},{id:"help-docs",type:"help",icon:"\u{1F4D6}",title:"\u5E6B\u52A9\u6587\u6A94",subtitle:"\u67E5\u770B\u4F7F\u7528\u6307\u5357",keywords:["help","docs","\u5E6B\u52A9","\u6587\u6A94"],action:()=>this.emitAction("open-docs")},{id:"help-shortcuts",type:"help",icon:"\u2328\uFE0F",title:"\u5FEB\u6377\u9375",subtitle:"\u67E5\u770B\u6240\u6709\u5FEB\u6377\u9375",keywords:["shortcuts","keyboard","\u5FEB\u6377\u9375"],action:()=>this.emitAction("show-shortcuts")},{id:"help-feedback",type:"help",icon:"\u{1F4AC}",title:"\u610F\u898B\u53CD\u994B",subtitle:"\u63D0\u4EA4\u554F\u984C\u6216\u5EFA\u8B70",keywords:["feedback","\u53CD\u994B","\u5EFA\u8B70"],action:()=>this.emitAction("open-feedback")}];this.commands.set(e)}getDefaultGroups(e){let t=this.recentPages(),n=[];if(t.length>0){let c=e.filter(m=>t.includes(m.id)).sort((m,h)=>t.indexOf(m.id)-t.indexOf(h.id)).slice(0,5).map(m=>N(F({},m),{type:"recent"}));c.length>0&&n.push({title:"\u6700\u8FD1\u8A2A\u554F",items:c})}let o=e.filter(c=>c.type==="page").slice(0,6);n.push({title:"\u9801\u9762",items:o});let r=e.filter(c=>c.type==="action").slice(0,4);return n.push({title:"\u5FEB\u901F\u64CD\u4F5C",items:r}),n}groupByType(e){let t=[],n=e.filter(m=>m.type==="page"),o=e.filter(m=>m.type==="action"),r=e.filter(m=>m.type==="contact"),c=e.filter(m=>m.type==="help");return n.length>0&&t.push({title:"\u9801\u9762",items:n}),o.length>0&&t.push({title:"\u64CD\u4F5C",items:o}),r.length>0&&t.push({title:"\u806F\u7E6B\u4EBA",items:r}),c.length>0&&t.push({title:"\u5E6B\u52A9",items:c}),t}onGlobalKeyDown(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),this.toggle()),e.key==="Escape"&&this.isOpen()&&(e.preventDefault(),this.close())}onKeyDown(e){let n=this.filteredGroups().reduce((o,r)=>o+r.items.length,0);switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex.update(r=>(r+1)%n);break;case"ArrowUp":e.preventDefault(),this.selectedIndex.update(r=>(r-1+n)%n);break;case"Enter":e.preventDefault();let o=this.getSelectedItem();o&&this.executeCommand(o);break}}onQueryChange(e){this.selectedIndex.set(0)}getSelectedItem(){let e=this.filteredGroups(),t=0;for(let n of e)for(let o of n.items){if(t===this.selectedIndex())return o;t++}return null}getGlobalIndex(e,t){let n=this.filteredGroups(),o=0;for(let r of n){if(r===e)return o+t;o+=r.items.length}return 0}isSelected(e,t){return this.getGlobalIndex(e,t)===this.selectedIndex()}getTypeLabel(e){return{page:"\u9801\u9762",action:"\u64CD\u4F5C",contact:"\u806F\u7E6B\u4EBA",recent:"\u6700\u8FD1",help:"\u5E6B\u52A9"}[e]}toggle(){this.isOpen()?this.close():this.open()}open(){this.query="",this.selectedIndex.set(0),this.animateIn.set(!0),this.isOpen.set(!0)}close(){this.animateIn.set(!1),setTimeout(()=>{this.isOpen.set(!1)},150)}executeCommand(e){e.type==="page"&&this.addToRecent(e.id),e.action(),this.close()}navigateTo(e){this.navigate.emit(e)}emitAction(e){this.navigate.emit(`action:${e}`)}addToRecent(e){this.recentPages.update(t=>{let n=t.filter(o=>o!==e);return[e,...n].slice(0,10)}),this.saveRecentPages()}loadRecentPages(){try{let e=localStorage.getItem("tg-matrix-recent-pages");e&&this.recentPages.set(JSON.parse(e))}catch{}}saveRecentPages(){try{localStorage.setItem("tg-matrix-recent-pages",JSON.stringify(this.recentPages()))}catch{}}addCommand(e){this.commands.update(t=>[...t,e])}addContactCommands(e){let t=e.map(n=>({id:`contact-${n.id}`,type:"contact",icon:"\u{1F464}",title:n.name,subtitle:n.username?`@${n.username}`:void 0,keywords:[n.name,n.username||""].filter(Boolean),action:()=>this.navigate.emit(`contact:${n.id}`)}));this.commands.update(n=>[...n.filter(o=>o.type!=="contact"),...t])}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-command-palette"]],hostBindings:function(t,n){t&1&&b("keydown",function(r){return n.onGlobalKeyDown(r)},Bn)},outputs:{navigate:"navigate"},decls:1,vars:1,consts:[["searchInput",""],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"animate-fade-in"],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"click"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm"],[1,"command-palette","relative","w-full","max-w-2xl","mx-4","bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden",3,"click"],[1,"flex","items-center","gap-3","p-4","border-b","border-slate-700/50"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text","placeholder","\u641C\u7D22\u9801\u9762\u3001\u529F\u80FD\u3001\u806F\u7E6B\u4EBA...","autofocus","",1,"flex-1","bg-transparent","text-white","placeholder-slate-500","outline-none","text-lg",3,"ngModelChange","keydown","ngModel"],[1,"px-2","py-1","text-xs","text-slate-400","bg-slate-800","rounded","border","border-slate-700"],[1,"max-h-[60vh]","overflow-y-auto"],[1,"p-8","text-center"],[1,"flex","items-center","justify-between","px-4","py-3","border-t","border-slate-700/50","text-xs","text-slate-500"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-1"],[1,"px-1.5","py-0.5","bg-slate-800","rounded"],[1,"text-4xl","mb-3"],[1,"text-slate-400"],[1,"text-sm","text-slate-500","mt-1"],[1,"py-2"],[1,"px-4","py-2","text-xs","font-semibold","text-slate-500","uppercase","tracking-wider"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"bg-cyan-500/20","hover:bg-slate-800"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"click","mouseenter"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","text-xl"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"px-2","py-0.5","text-xs","rounded-full"]],template:function(t,n){t&1&&w(0,ax,31,6,"div",1),t&2&&E(n.isOpen()?0:-1)},dependencies:[oe,ue,xe,fe,_e],styles:[".animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}.animate-slide-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-down .2s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_slide-down{0%{opacity:0;transform:translateY(-20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b}"]})}};var lx=(i,e)=>e.api_id;function cx(i,e){i&1&&(s(0,"span",37),l(1,"\u23F3"),a(),l(2," \u4FDD\u5B58\u4E2D... "))}function dx(i,e){i&1&&(s(0,"span"),l(1,"\u2795"),a(),l(2," \u6DFB\u52A0 "))}function ux(i,e){i&1&&(s(0,"div",34)(1,"div",38),l(2,"\u23F3"),a(),s(3,"p",39),l(4,"\u6B63\u5728\u52A0\u8F09..."),a()())}function mx(i,e){i&1&&(s(0,"div",34)(1,"div",40),l(2,"\u{1F4ED}"),a(),s(3,"p",41),l(4,"\u9084\u6C92\u6709\u4EFB\u4F55 API \u6191\u64DA"),a(),s(5,"p",39),l(6,"\u8ACB\u5728\u4E0A\u65B9\u8868\u55AE\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B API"),a()())}function px(i,e){i&1&&(s(0,"span",46),l(1,"\u516C\u5171"),a())}function gx(i,e){i&1&&(s(0,"span",47),l(1,"\u624B\u52D5\u6DFB\u52A0"),a())}function hx(i,e){if(i&1){let t=T();s(0,"button",52),b("click",function(){v(t);let o=f().$implicit,r=f(2);return x(r.toggleCredential(o.api_id,!o.is_active))}),l(1),a(),s(2,"button",53),b("click",function(){v(t);let o=f().$implicit,r=f(2);return x(r.confirmDelete(o))}),l(3," \u522A\u9664 "),a()}if(i&2){let t=f().$implicit;I("bg-green-500/20",!t.is_active)("text-green-400",!t.is_active)("hover:bg-green-500/30",!t.is_active)("bg-amber-500/20",t.is_active)("text-amber-400",t.is_active)("hover:bg-amber-500/30",t.is_active),d(),A(" ",t.is_active?"\u505C\u7528":"\u555F\u7528"," ")}}function fx(i,e){if(i&1&&(s(0,"div",42)(1,"div",2),k(2,"div",43),s(3,"div")(4,"div",44)(5,"span",45),l(6),a(),w(7,px,2,0,"span",46),w(8,gx,2,0,"span",47),a(),s(9,"div",12),l(10),a()()(),s(11,"div",2)(12,"div",48)(13,"div",49),l(14),a(),s(15,"div",50),k(16,"div",51),a()(),s(17,"div",44),w(18,hx,4,13),a()()()),i&2){let t=e.$implicit;d(2),I("bg-green-500",t.is_active)("bg-slate-500",!t.is_active),d(4),M(t.name),d(),E(t.is_public?7:-1),d(),E(t.source==="manual"?8:-1),d(2),je(" ID: ",t.api_id," \u2022 Hash: ",t.api_hash.slice(0,8),"...",t.api_hash.slice(-4)," "),d(3),I("text-green-400",t.account_count<t.max_accounts*.8)("text-amber-400",t.account_count>=t.max_accounts*.8&&t.account_count<t.max_accounts)("text-red-400",t.account_count>=t.max_accounts),d(),Y(" ",t.account_count,"/",t.max_accounts," \u5E33\u865F "),d(2),j("width",t.account_count/t.max_accounts*100,"%"),I("bg-green-500",t.account_count<t.max_accounts*.8)("bg-amber-500",t.account_count>=t.max_accounts*.8&&t.account_count<t.max_accounts)("bg-red-500",t.account_count>=t.max_accounts),d(2),E(t.is_public?-1:18)}}function _x(i,e){if(i&1&&(s(0,"div",35),$(1,fx,19,27,"div",42,lx),a()),i&2){let t=f();d(),H(t.credentials())}}function Cx(i,e){if(i&1&&(k(0,"br"),s(1,"span",62),l(2),a()),i&2){let t=f(2);d(2),A("\u26A0\uFE0F \u6B64 API \u76EE\u524D\u6709 ",t.deleteTarget().account_count," \u500B\u5E33\u865F\u5728\u4F7F\u7528\u3002")}}function vx(i,e){if(i&1){let t=T();s(0,"div",54),b("click",function(){v(t);let o=f();return x(o.cancelDelete())}),s(1,"div",55),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"h3",56),l(3,"\u78BA\u8A8D\u522A\u9664"),a(),s(4,"p",57),l(5," \u78BA\u5B9A\u8981\u522A\u9664 API\u300C"),s(6,"span",58),l(7),a(),l(8,"\u300D\u55CE\uFF1F "),w(9,Cx,3,1),a(),s(10,"div",59)(11,"button",60),b("click",function(){v(t);let o=f();return x(o.cancelDelete())}),l(12," \u53D6\u6D88 "),a(),s(13,"button",61),b("click",function(){v(t);let o=f();return x(o.doDelete())}),l(14," \u78BA\u8A8D\u522A\u9664 "),a()()()()}if(i&2){let t=f();d(7),M(t.deleteTarget().name),d(2),E(t.deleteTarget().account_count>0?9:-1)}}var xo=class i{constructor(){this.ipc=B(De);this.toast=B(me);this.nav=B(Qt);this.credentials=C([]);this.isLoading=C(!0);this.isSaving=C(!1);this.deleteTarget=C(null);this.newApiId="";this.newApiHash="";this.newApiName="";this.activeCount=()=>this.credentials().filter(e=>e.is_active&&!e.is_public).length;this.totalAccountsUsed=()=>this.credentials().reduce((e,t)=>e+t.account_count,0);this.totalCapacity=()=>this.credentials().filter(e=>!e.is_public).reduce((e,t)=>e+t.max_accounts,0);this.ipcCleanup=[]}ngOnInit(){this.setupIpcListeners(),this.refreshList()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("api-credentials-updated",r=>{this.isLoading.set(!1),r.credentials&&this.credentials.set(r.credentials)}),t=this.ipc.on("api-credential-added",r=>{this.isSaving.set(!1),r.success?(this.toast.success("\u2705 API \u6191\u64DA\u6DFB\u52A0\u6210\u529F\uFF01"),this.clearForm()):this.toast.error(`\u6DFB\u52A0\u5931\u6557: ${r.error||"\u672A\u77E5\u932F\u8AA4"}`)}),n=this.ipc.on("api-credential-removed",r=>{r.success?this.toast.success("\u{1F5D1}\uFE0F API \u6191\u64DA\u5DF2\u522A\u9664"):this.toast.error(`\u522A\u9664\u5931\u6557: ${r.error||"\u672A\u77E5\u932F\u8AA4"}`)}),o=this.ipc.on("api-credential-toggled",r=>{r.success?this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0"):this.toast.error(`\u64CD\u4F5C\u5931\u6557: ${r.error||"\u672A\u77E5\u932F\u8AA4"}`)});this.ipcCleanup.push(e,t,n,o)}refreshList(){this.isLoading.set(!0),this.ipc.send("get-api-credentials",{})}isFormValid(){let e=this.newApiId.trim(),t=this.newApiHash.trim();return e.length>0&&/^\d+$/.test(e)&&t.length===32&&/^[a-f0-9]{32}$/i.test(t)}addCredential(){if(!this.isFormValid()){this.toast.error("\u8ACB\u6AA2\u67E5 API ID \u548C API Hash \u683C\u5F0F");return}this.isSaving.set(!0),this.ipc.send("add-api-credential",{api_id:this.newApiId.trim(),api_hash:this.newApiHash.trim(),name:this.newApiName.trim()||`API_${this.newApiId.slice(-4)}`,source:"manual",max_accounts:5})}clearForm(){this.newApiId="",this.newApiHash="",this.newApiName=""}toggleCredential(e,t){this.ipc.send("toggle-api-credential",{api_id:e,is_active:t})}confirmDelete(e){this.deleteTarget.set(e)}cancelDelete(){this.deleteTarget.set(null)}doDelete(){let e=this.deleteTarget();e&&(this.ipc.send("remove-api-credential",{api_id:e.api_id}),this.deleteTarget.set(null))}goBack(){this.nav.navigateTo("accounts")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-api-credentials-view"]],decls:80,vars:14,consts:[[1,"max-w-6xl","mx-auto"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-2","text-slate-400","hover:text-white","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"flex","items-center","gap-2","px-4","py-2","bg-slate-800","hover:bg-slate-700","rounded-lg","transition-colors",3,"click","disabled"],[1,"text-3xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-8"],[1,"grid","grid-cols-4","gap-4","mb-8"],[1,"bg-gradient-to-br","from-cyan-500/10","to-blue-500/10","border","border-cyan-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400"],[1,"bg-gradient-to-br","from-green-500/10","to-emerald-500/10","border","border-green-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-green-400"],[1,"bg-gradient-to-br","from-amber-500/10","to-orange-500/10","border","border-amber-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-amber-400"],[1,"bg-gradient-to-br","from-purple-500/10","to-pink-500/10","border","border-purple-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-purple-400"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","rounded-xl","p-6","mb-8"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-slate-400","mb-1"],[1,"text-red-400"],["type","text","placeholder","\u4F8B\u5982: 12345678",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","text","placeholder","32\u4F4D\u5341\u516D\u9032\u5236\u5B57\u7B26\u4E32",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4F8B\u5982: \u4E3B\u529B API",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","items-end"],[1,"w-full","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-600","hover:to-blue-600","disabled:from-slate-600","disabled:to-slate-600","disabled:cursor-not-allowed","text-white","font-bold","py-2","px-4","rounded-lg","transition-all","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"mt-3","text-sm","text-slate-500","flex","items-center","gap-2"],["href","https://my.telegram.org","target","_blank",1,"text-cyan-400","hover:underline"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","rounded-xl","overflow-hidden"],[1,"p-4","border-b","border-slate-700"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"p-12","text-center"],[1,"divide-y","divide-slate-700"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"animate-spin"],[1,"animate-spin","text-4xl","mb-4"],[1,"text-slate-400"],[1,"text-6xl","mb-4"],[1,"text-xl","font-medium","text-white","mb-2"],[1,"p-4","hover:bg-slate-800/50","transition-colors","flex","items-center","justify-between"],[1,"w-3","h-3","rounded-full"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white"],[1,"text-xs","bg-amber-500/20","text-amber-400","px-2","py-0.5","rounded"],[1,"text-xs","bg-cyan-500/20","text-cyan-400","px-2","py-0.5","rounded"],[1,"text-right"],[1,"text-sm","font-medium"],[1,"w-24","h-1.5","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","transition-all"],[1,"px-3","py-1.5","rounded-lg","text-sm","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","text-red-400","hover:bg-red-500/30","rounded-lg","text-sm","transition-colors",3,"click"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-xl","p-6","max-w-md","w-full","mx-4",3,"click"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"text-slate-400","mb-6"],[1,"text-white"],[1,"flex","gap-3"],[1,"flex-1","px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2","bg-red-500","hover:bg-red-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"text-amber-400"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),b("click",function(){return n.goBack()}),te(),s(4,"svg",4),k(5,"path",5),a(),l(6," \u8FD4\u56DE\u5E33\u865F\u7BA1\u7406 "),a()(),le(),s(7,"button",6),b("click",function(){return n.refreshList()}),s(8,"span"),l(9,"\u{1F504}"),a(),l(10," \u5237\u65B0 "),a()(),s(11,"h1",7),l(12,"\u{1F510} API \u6191\u64DA\u6C60"),a(),s(13,"p",8),l(14,"\u7BA1\u7406\u60A8\u7684 Telegram API \u6191\u64DA\uFF0C\u6DFB\u52A0\u81EA\u5B9A\u7FA9 API \u4EE5\u7372\u5F97\u66F4\u597D\u7684\u7A69\u5B9A\u6027"),a(),s(15,"div",9)(16,"div",10)(17,"div",11),l(18),a(),s(19,"div",12),l(20,"\u7E3D API \u6578\u91CF"),a()(),s(21,"div",13)(22,"div",14),l(23),a(),s(24,"div",12),l(25,"\u6D3B\u8E8D\u4E2D"),a()(),s(26,"div",15)(27,"div",16),l(28),a(),s(29,"div",12),l(30,"\u5DF2\u7D81\u5B9A\u5E33\u865F"),a()(),s(31,"div",17)(32,"div",18),l(33),a(),s(34,"div",12),l(35,"\u7E3D\u5BB9\u91CF"),a()()(),s(36,"div",19)(37,"h3",20)(38,"span"),l(39,"\u2795"),a(),l(40," \u6DFB\u52A0\u65B0 API \u6191\u64DA "),a(),s(41,"div",21)(42,"div")(43,"label",22),l(44,"API ID "),s(45,"span",23),l(46,"*"),a()(),s(47,"input",24),W("ngModelChange",function(r){return z(n.newApiId,r)||(n.newApiId=r),r}),a()(),s(48,"div")(49,"label",22),l(50,"API Hash "),s(51,"span",23),l(52,"*"),a()(),s(53,"input",25),W("ngModelChange",function(r){return z(n.newApiHash,r)||(n.newApiHash=r),r}),a()(),s(54,"div")(55,"label",22),l(56,"\u540D\u7A31\uFF08\u53EF\u9078\uFF09"),a(),s(57,"input",26),W("ngModelChange",function(r){return z(n.newApiName,r)||(n.newApiName=r),r}),a()(),s(58,"div",27)(59,"button",28),b("click",function(){return n.addCredential()}),w(60,cx,3,0)(61,dx,3,0),a()()(),s(62,"div",29)(63,"span"),l(64,"\u{1F4A1}"),a(),s(65,"span"),l(66,"\u524D\u5F80 "),s(67,"a",30),l(68,"my.telegram.org"),a(),l(69," \u7533\u8ACB\u60A8\u81EA\u5DF1\u7684 API \u6191\u64DA"),a()()(),s(70,"div",31)(71,"div",32)(72,"h3",33)(73,"span"),l(74,"\u{1F4CB}"),a(),l(75," \u6211\u7684 API \u5217\u8868 "),a()(),w(76,ux,5,0,"div",34)(77,mx,7,0,"div",34)(78,_x,3,0,"div",35),a(),w(79,vx,15,2,"div",36),a()),t&2&&(d(7),V("disabled",n.isLoading()),d(),I("animate-spin",n.isLoading()),d(10),M(n.credentials().length),d(5),M(n.activeCount()),d(5),M(n.totalAccountsUsed()),d(5),M(n.totalCapacity()),d(14),K("ngModel",n.newApiId),d(6),K("ngModel",n.newApiHash),d(4),K("ngModel",n.newApiName),d(2),V("disabled",!n.isFormValid()||n.isSaving()),d(),E(n.isSaving()?60:61),d(16),E(n.isLoading()?76:n.credentials().length===0?77:78),d(3),E(n.deleteTarget()?79:-1))},dependencies:[oe,ue,xe,fe,_e],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}};var un=class i{constructor(){this._deviceCode=C(null);this._deviceDetails=C(null);this.deviceCode=L(()=>this._deviceCode());this.deviceDetails=L(()=>this._deviceDetails());this.initDeviceInfo()}async initDeviceInfo(){try{let e=await this.collectDeviceDetails();this._deviceDetails.set(e);let t=await this.generateDeviceCode(e);this._deviceCode.set(t)}catch(e){console.error("\u521D\u59CB\u5316\u8A2D\u5099\u4FE1\u606F\u5931\u6557:",e),this._deviceCode.set(this.generateFallbackDeviceCode())}}async getDeviceCode(){return this._deviceCode()?this._deviceCode():(await new Promise(e=>{let t=setInterval(()=>{this._deviceCode()&&(clearInterval(t),e())},100);setTimeout(()=>{clearInterval(t),this._deviceCode()||this._deviceCode.set(this.generateFallbackDeviceCode()),e()},3e3)}),this._deviceCode())}async collectDeviceDetails(){if(typeof window<"u"&&window.electronAPI!==void 0)try{let t=await window.electronAPI.invoke("get-system-info");if(t)return{platform:t.platform||"unknown",arch:t.arch||"unknown",hostname:t.hostname||"unknown",cpuModel:t.cpuModel||"unknown",cpuCores:t.cpuCores||1,totalMemory:t.totalMemory||0,osType:t.osType||"unknown",osVersion:t.osVersion||"unknown",username:t.username||"unknown",screenResolution:`${window.screen.width}x${window.screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language}}catch(t){console.warn("\u7121\u6CD5\u5F9E Electron \u7372\u53D6\u7CFB\u7D71\u4FE1\u606F:",t)}return{platform:navigator.platform||"web",arch:this.detectArch(),hostname:"browser",cpuModel:"unknown",cpuCores:navigator.hardwareConcurrency||1,totalMemory:navigator.deviceMemory||0,osType:this.detectOS(),osVersion:"unknown",username:"webuser",screenResolution:`${window.screen.width}x${window.screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language}}async generateDeviceCode(e){let t=[e.platform,e.arch,e.hostname,e.cpuCores.toString(),e.totalMemory.toString(),e.osType,e.screenResolution,e.timezone,e.language,this.getCanvasFingerprint(),this.getWebGLFingerprint()].join("|"),o=(await this.sha256(t)).substr(0,16).toUpperCase();return`TGM-${o.substr(0,4)}-${o.substr(4,4)}-${o.substr(8,4)}-${o.substr(12,4)}`}generateFallbackDeviceCode(){let e=localStorage.getItem("tgm_device_code");if(e)return e;let t=Math.random().toString(36).substr(2,16).toUpperCase(),n=`TGM-${t.substr(0,4)}-${t.substr(4,4)}-${t.substr(8,4)}-${t.substr(12,4)}`;return localStorage.setItem("tgm_device_code",n),n}async sha256(e){if(typeof crypto<"u"&&crypto.subtle){let t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(r=>r.toString(16).padStart(2,"0")).join("")}return this.simpleHash(e)}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);t=(t<<5)-t+o,t=t&t}return Math.abs(t).toString(16).padStart(16,"0")}detectOS(){let e=navigator.userAgent;return e.indexOf("Win")!==-1?"Windows":e.indexOf("Mac")!==-1?"macOS":e.indexOf("Linux")!==-1?"Linux":e.indexOf("Android")!==-1?"Android":e.indexOf("iOS")!==-1?"iOS":"Unknown"}detectArch(){let e=navigator.platform;return e.indexOf("64")!==-1?"x64":e.indexOf("ARM")!==-1?"arm":"x86"}getCanvasFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("TG-AI\u667A\u63A7\u738B",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("fingerprint",4,17),e.toDataURL().substr(-50)):"no-canvas"}catch{return"canvas-error"}}getWebGLFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"no-webgl";let n=t.getExtension("WEBGL_debug_renderer_info");if(n){let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),r=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return`${o}|${r}`.substr(0,50)}return"webgl-no-debug"}catch{return"webgl-error"}}getDeviceName(){let e=this._deviceDetails();if(!e)return"\u672A\u77E5\u8A2D\u5099";let t=e.osType,n=e.platform;return t==="Windows"?`Windows PC (${e.cpuCores} \u6838\u5FC3)`:t==="macOS"?`Mac (${e.cpuCores} \u6838\u5FC3)`:t==="Linux"?`Linux (${e.hostname})`:`${n} \u8A2D\u5099`}getShortDeviceId(){let e=this._deviceCode();return e?e.substr(4,9):"..."}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var mn=class i{constructor(){this.deviceService=B(un);this.injector=B(Es);this.licenseClient=B(Mt);this.SKIP_LOGIN=!!window.electronAPI||!!window.electron;this.DEFAULT_USER={id:1,username:"Admin",email:"admin@tgai.local",membershipLevel:"king",membershipExpires:new Date(Date.now()+365*100*24*60*60*1e3).toISOString(),inviteCode:"ADMIN-VIP",invitedCount:0,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),status:"active"};this._isAuthenticated=C(this.SKIP_LOGIN);this._user=C(this.SKIP_LOGIN?this.DEFAULT_USER:null);this._token=C(this.SKIP_LOGIN?"skip-login-token":null);this._isLoading=C(!1);this._devices=C([]);this._usageStats=C(null);this.isAuthenticated=L(()=>this._isAuthenticated());this.user=L(()=>this._user());this.isLoading=L(()=>this._isLoading());this.devices=L(()=>this._devices());this.usageStats=L(()=>this._usageStats());this.membershipLevel=L(()=>this._user()?.membershipLevel||"bronze");this.isPaid=L(()=>["silver","gold","diamond","star","king"].includes(this.membershipLevel()));this.isPremium=L(()=>["diamond","star","king"].includes(this.membershipLevel()));this.isElite=L(()=>["star","king"].includes(this.membershipLevel()));this.isKing=L(()=>this.membershipLevel()==="king");this.membershipExpiresSoon=L(()=>{let e=this._user()?.membershipExpires;if(!e)return!1;let t=Math.floor((new Date(e).getTime()-Date.now())/(1e3*60*60*24));return t<=7&&t>0});this.membershipDaysLeft=L(()=>{let e=this._user()?.membershipExpires;return e?Math.max(0,Math.floor((new Date(e).getTime()-Date.now())/(1e3*60*60*24))):0});if(this.SKIP_LOGIN){console.log("[AuthService] \u514D\u767B\u9304\u6A21\u5F0F\u5DF2\u555F\u7528\uFF0C\u9ED8\u8A8D\u70BA\u738B\u8005\u6703\u54E1");return}setTimeout(()=>{this.checkLocalAuth().catch(e=>{console.error("\u8A8D\u8B49\u521D\u59CB\u5316\u932F\u8AA4:",e),this._isAuthenticated.set(!1)})},0)}async checkLocalAuth(){try{if(typeof localStorage>"u")return;let e=localStorage.getItem("tgm_auth_token"),t=localStorage.getItem("tgm_user");if(e&&t){let n=JSON.parse(t),o=await this.deviceService.getDeviceCode();await this.verifyToken(e,o)?(this._token.set(e),this._user.set(n),this._isAuthenticated.set(!0),this.loadDevices().catch(c=>console.error("\u8F09\u5165\u8A2D\u5099\u5217\u8868\u5931\u6557:",c)),this.loadUsageStats().catch(c=>console.error("\u8F09\u5165\u4F7F\u7528\u7D71\u8A08\u5931\u6557:",c))):this.clearLocalAuth()}else this._isAuthenticated.set(!1)}catch(e){console.error("\u6AA2\u67E5\u672C\u5730\u8A8D\u8B49\u5931\u6557:",e),this.clearLocalAuth(),this._isAuthenticated.set(!1)}}async login(e,t){this._isLoading.set(!0);try{let n=await this.deviceService.getDeviceCode(),o=await this.callAuthApi("/api/auth/login",{username:e,password:t,deviceCode:n});return o.success&&o.user&&o.token&&await this.handleLoginSuccess(o.user,o.token),o}catch(n){return{success:!1,message:n.message||"\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}finally{this._isLoading.set(!1)}}async activateLicense(e,t,n){this._isLoading.set(!0);try{let o=await this.deviceService.getDeviceCode(),r=await this.callAuthApi("/api/auth/activate",{licenseKey:e,username:t,password:n,deviceCode:o});return r.success&&r.user&&r.token&&await this.handleLoginSuccess(r.user,r.token),r}catch(o){return{success:!1,message:o.message||"\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u5361\u5BC6\u662F\u5426\u6B63\u78BA"}}finally{this._isLoading.set(!1)}}async registerWithInvite(e,t,n,o){this._isLoading.set(!0);try{let r=await this.deviceService.getDeviceCode(),c=await this.callAuthApi("/api/auth/register",{inviteCode:e,username:t,password:n,email:o,deviceCode:r});return c.success&&c.user&&c.token&&await this.handleLoginSuccess(c.user,c.token),c}catch(r){return{success:!1,message:r.message||"\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}finally{this._isLoading.set(!1)}}async logout(){try{let e=this._token();e&&await this.callAuthApi("/api/auth/logout",{token:e})}catch(e){console.error("\u9000\u51FA API \u8ABF\u7528\u5931\u6557:",e)}finally{this.clearLocalAuth(),this._isAuthenticated.set(!1),this._user.set(null),this._token.set(null),this._devices.set([]),this._usageStats.set(null)}}async changePassword(e,t){try{return await this.callAuthApi("/api/auth/change-password",{oldPassword:e,newPassword:t,token:this._token()})}catch(n){return{success:!1,message:n.message||"\u4FEE\u6539\u5BC6\u78BC\u5931\u6557"}}}async renewMembership(e){try{let t=this._user(),n=t?.email||"",o=await this.licenseClient.activateLicense(e,n);if(o.success){let r="silver",c="",m="\u767D\u9280\u7CBE\u82F1",h="\u{1F948}";if(o.data?.level)r=o.data.level,c=o.data.expiresAt||"",m=o.data.levelName||this.getLevelName(r),h=o.data.levelIcon||this.getLevelIcon(r);else{let _=this.parseLicenseKey(e);_.valid&&(r=_.level,c=_.expiresAt,m=_.levelName,h=_.levelIcon)}if(t){let _=N(F({},t),{membershipLevel:r,membershipExpires:c});this._user.set(_),localStorage.setItem("tgm_user",JSON.stringify(_)),console.log("[AuthService] \u7528\u6236\u72C0\u614B\u5DF2\u66F4\u65B0:",{level:r,expires:c})}else{let _={id:1,username:n.split("@")[0]||"User",email:n,membershipLevel:r,membershipExpires:c,inviteCode:"",invitedCount:0,createdAt:new Date().toISOString(),status:"active"};this._user.set(_),localStorage.setItem("tgm_user",JSON.stringify(_)),console.log("[AuthService] \u65B0\u7528\u6236\u5DF2\u5275\u5EFA:",{level:r,expires:c})}return await this.loadUsageStats(),window.dispatchEvent(new CustomEvent("membership-updated",{detail:{level:r,levelName:m,levelIcon:h,expiresAt:c}})),{success:!0,message:o.message||`\u{1F389} ${h} ${m} \u6FC0\u6D3B\u6210\u529F\uFF01`,newExpires:c}}return{success:!1,message:o.message||"\u6FC0\u6D3B\u5931\u6557"}}catch(t){return console.error("\u6FC0\u6D3B\u5361\u5BC6\u5931\u6557:",t),{success:!1,message:t.message||"\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}}getLevelName(e){return{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[e]||"\u9752\u9285\u6230\u58EB"}getLevelIcon(e){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[e]||"\u2694\uFE0F"}async bindDevice(e,t){try{let n=await this.callAuthApi("/api/auth/bind-device",{deviceCode:e,deviceName:t,token:this._token()});return n.success&&await this.loadDevices(),n}catch(n){return{success:!1,message:n.message||"\u7D81\u5B9A\u8A2D\u5099\u5931\u6557"}}}async unbindDevice(e){try{let t=await this.callAuthApi("/api/auth/unbind-device",{deviceId:e,token:this._token()});return t.success&&await this.loadDevices(),t}catch(t){return{success:!1,message:t.message||"\u89E3\u7D81\u8A2D\u5099\u5931\u6557"}}}async loadDevices(){try{let e=await this.callAuthApi("/api/auth/devices",{token:this._token()});if(e.success&&e.devices){let t=await this.deviceService.getDeviceCode(),n=e.devices.map(o=>N(F({},o),{isCurrent:o.deviceCode===t}));this._devices.set(n)}}catch(e){console.error("\u8F09\u5165\u8A2D\u5099\u5217\u8868\u5931\u6557:",e)}}async loadUsageStats(){try{try{let{LicenseClientService:t}=await import("./chunk-MV4AOWDY.js"),o=await this.injector.get(t).getUsageStats();if(o.success&&o.stats){this._usageStats.set(o.stats);return}}catch(t){console.warn("\u4F7F\u7528 LicenseClientService \u8F09\u5165\u7D71\u8A08\u5931\u6557\uFF0C\u5617\u8A66\u4F7F\u7528 mock API:",t)}let e=await this.callAuthApi("/api/auth/usage-stats",{token:this._token()});e.success&&e.stats&&this._usageStats.set(e.stats)}catch(e){console.error("\u8F09\u5165\u4F7F\u7528\u7D71\u8A08\u5931\u6557:",e)}}async getInviteRewards(){try{let e=await this.callAuthApi("/api/auth/invite-rewards",{token:this._token()});return e.success?e:{inviteCode:this._user()?.inviteCode||"",invitedCount:0,rewardDays:0}}catch{return{inviteCode:this._user()?.inviteCode||"",invitedCount:0,rewardDays:0}}}async handleLoginSuccess(e,t){this._user.set(e),this._token.set(t),this._isAuthenticated.set(!0),localStorage.setItem("tgm_auth_token",t),localStorage.setItem("tgm_user",JSON.stringify(e)),await this.loadDevices(),await this.loadUsageStats()}async verifyToken(e,t){try{return(await this.callAuthApi("/api/auth/verify",{token:e,deviceCode:t})).success===!0}catch{return!1}}clearLocalAuth(){localStorage.removeItem("tgm_auth_token"),localStorage.removeItem("tgm_user")}async callAuthApi(e,t){if(this.isDevMode())return this.mockApiResponse(e,t);try{return await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t.token?`Bearer ${t.token}`:""},body:JSON.stringify(t)})).json()}catch{throw new Error("\u7DB2\u7D61\u9023\u63A5\u5931\u6557")}}isDevMode(){return typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")}mockApiResponse(e,t){return new Promise(n=>{setTimeout(()=>{switch(e){case"/api/auth/login":t.username&&t.password?n({success:!0,message:"\u767B\u5165\u6210\u529F",user:this.getMockUser(t.username),token:"mock_token_"+Date.now(),expiresAt:new Date(Date.now()+10080*60*1e3).toISOString()}):n({success:!1,message:"\u7528\u6236\u540D\u6216\u5BC6\u78BC\u932F\u8AA4"});break;case"/api/auth/activate":t.licenseKey&&t.licenseKey.length>=16?n({success:!0,message:"\u6FC0\u6D3B\u6210\u529F",user:this.getMockUser(t.username,"silver"),token:"mock_token_"+Date.now()}):n({success:!1,message:"\u5361\u5BC6\u7121\u6548\u6216\u5DF2\u4F7F\u7528"});break;case"/api/auth/register":t.inviteCode&&t.username&&t.password?n({success:!0,message:"\u8A3B\u518A\u6210\u529F",user:this.getMockUser(t.username),token:"mock_token_"+Date.now()}):n({success:!1,message:"\u9080\u8ACB\u78BC\u7121\u6548"});break;case"/api/auth/verify":n({success:!0});break;case"/api/auth/devices":n({success:!0,devices:[{id:1,deviceCode:t.deviceCode||"TGM-MOCK-001",deviceName:"\u7576\u524D\u8A2D\u5099",boundAt:new Date().toISOString(),lastSeen:new Date().toISOString(),status:"active"}]});break;case"/api/auth/usage-stats":n({success:!0,stats:{aiCalls:{used:150,limit:500},messagesSent:{used:2340,limit:1e4},accounts:{used:5,limit:10},storage:{used:45,limit:100}}});break;case"/api/auth/invite-rewards":n({success:!0,inviteCode:"INVITE-"+Math.random().toString(36).substr(2,6).toUpperCase(),invitedCount:3,rewardDays:9});break;case"/api/auth/renew":let o=this.parseLicenseKey(t.licenseKey);if(o.valid){let r=this._user();if(r){let c=N(F({},r),{membershipLevel:o.level,membershipExpires:o.expiresAt});n({success:!0,message:`\u{1F389} ${o.levelIcon} ${o.levelName} \u6FC0\u6D3B\u6210\u529F\uFF01\u6709\u6548\u671F\u81F3 ${new Date(o.expiresAt).toLocaleDateString()}`,user:c,newExpires:o.expiresAt})}else n({success:!1,message:"\u8ACB\u5148\u767B\u5165"})}else n({success:!1,message:o.message});break;default:n({success:!0,message:"OK"})}},500)})}getMockUser(e,t="silver"){return{id:1,username:e,email:`${e}@example.com`,membershipLevel:t,membershipExpires:new Date(Date.now()+720*60*60*1e3).toISOString(),inviteCode:"INVITE-"+Math.random().toString(36).substr(2,6).toUpperCase(),invitedCount:3,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),status:"active"}}parseLicenseKey(e){if(!e)return{valid:!1,message:"\u8ACB\u8F38\u5165\u5361\u5BC6",level:"bronze",levelName:"",levelIcon:"",durationDays:0,expiresAt:""};let t=/^TGAI-([BGDSK][123YL]|EXT)-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i,n=/^TGM-([BGDSK][123Y])-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i,o=e.toUpperCase().match(t);if(o||(o=e.toUpperCase().match(n)),!o)return{valid:!1,message:"\u2694\uFE0F \u5361\u5BC6\u683C\u5F0F\u4E0D\u6B63\u78BA\uFF0C\u8ACB\u6AA2\u67E5\u5F8C\u91CD\u8A66",level:"bronze",levelName:"",levelIcon:"",durationDays:0,expiresAt:""};let r=o[1],c=r[0],m=r[1]||"2",h={B:{level:"silver",name:"\u767D\u9280\u7CBE\u82F1",icon:"\u{1F948}"},G:{level:"gold",name:"\u9EC3\u91D1\u5927\u5E2B",icon:"\u{1F947}"},D:{level:"diamond",name:"\u947D\u77F3\u738B\u724C",icon:"\u{1F48E}"},S:{level:"star",name:"\u661F\u8000\u50B3\u8AAA",icon:"\u{1F31F}"},K:{level:"king",name:"\u69AE\u8000\u738B\u8005",icon:"\u{1F451}"},E:{level:"gold",name:"\u9EC3\u91D1\u5927\u5E2B",icon:"\u{1F947}"}},g={1:7,2:30,3:90,Y:365,L:36500,X:30},_=h[c]||{level:"silver",name:"\u767D\u9280\u7CBE\u82F1",icon:"\u{1F948}"},S=g[m]||30,y=this._user(),D=new Date;if(y?.membershipExpires){let P=new Date(y.membershipExpires);P>D&&(D=P)}return D.setDate(D.getDate()+S),{valid:!0,message:"\u5361\u5BC6\u6709\u6548",level:_.level,levelName:_.name,levelIcon:_.icon,durationDays:S,expiresAt:D.toISOString()}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var xx=()=>["bronze","silver"],bx=()=>["bronze","silver","gold"],Sx=(i,e)=>e.id;function yx(i,e){if(i&1&&(s(0,"p",10),l(1),s(2,"span",25),l(3),a()()),i&2){let t=f();d(),A(" \u6709\u6548\u671F\u81F3 ",t.formatDate(t.membershipExpires())," "),d(2),A("(\u5269\u9918 ",t.membershipDaysLeft()," \u5929)")}}function wx(i,e){i&1&&(s(0,"p",10),l(1,"\u6C38\u4E45\u514D\u8CBB\u7248"),a())}function Ex(i,e){if(i&1){let t=T();s(0,"button",26),b("click",function(){v(t);let o=f();return x(o.activeTab.set("upgrade"))}),l(1," \u{1F680} \u7ACB\u5373\u5347\u7D1A "),a()}}function Ax(i,e){if(i&1){let t=T();s(0,"div",24)(1,"div",27)(2,"h3",28),l(3,"\u{1F4CA} \u672C\u6708\u4F7F\u7528\u8A73\u60C5"),a(),s(4,"div",29)(5,"div",30)(6,"span",31),l(7,"\u{1F916} AI \u8ABF\u7528\u6B21\u6578"),a(),s(8,"div",32)(9,"div",33),k(10,"div",34),a()(),s(11,"span",35),l(12),a()(),s(13,"div",30)(14,"span",31),l(15,"\u{1F4E8} \u6D88\u606F\u767C\u9001"),a(),s(16,"div",32)(17,"div",33),k(18,"div",34),a()(),s(19,"span",35),l(20),a()(),s(21,"div",30)(22,"span",31),l(23,"\u{1F465} \u5E33\u865F\u6578\u91CF"),a(),s(24,"div",32)(25,"div",33),k(26,"div",34),a()(),s(27,"span",35),l(28),a()(),s(29,"div",30)(30,"span",31),l(31,"\u{1F4BE} \u5B58\u5132\u7A7A\u9593"),a(),s(32,"div",32)(33,"div",33),k(34,"div",34),a()(),s(35,"span",35),l(36),a()()()(),s(37,"div",36)(38,"h3",28),l(39,"\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5"),a(),s(40,"p",37),l(41,"\u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 "),s(42,"strong"),l(43,"3 \u5929\u767D\u9280\u7CBE\u82F1"),a(),l(44," \u734E\u52F5\uFF01"),a(),s(45,"div",38)(46,"span",39),l(47,"\u6211\u7684\u9080\u8ACB\u78BC"),a(),s(48,"span",40),l(49),a(),s(50,"button",41),b("click",function(){v(t);let o=f();return x(o.copyInviteCode())}),l(51,"\u{1F4CB} \u8907\u88FD"),a()(),s(52,"div",42)(53,"div",43)(54,"span",44),l(55),a(),s(56,"span",39),l(57,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),a()(),s(58,"div",43)(59,"span",44),l(60),a(),s(61,"span",39),l(62,"\u7372\u5F97\u734E\u52F5\u5929\u6578"),a()()()()()}if(i&2){let t,n,o,r,c=f();d(10),j("width",c.getAiUsagePercent(),"%"),d(2),Y("",((t=c.usageStats())==null||t.aiCalls==null?null:t.aiCalls.used)||0," / ",((t=c.usageStats())==null||t.aiCalls==null?null:t.aiCalls.limit)||50),d(6),j("width",c.getMessageUsagePercent(),"%"),d(2),Y("",((n=c.usageStats())==null||n.messagesSent==null?null:n.messagesSent.used)||0," / ",((n=c.usageStats())==null||n.messagesSent==null?null:n.messagesSent.limit)||100),d(6),j("width",c.getAccountUsagePercent(),"%"),d(2),Y("",((o=c.usageStats())==null||o.accounts==null?null:o.accounts.used)||0," / ",((o=c.usageStats())==null||o.accounts==null?null:o.accounts.limit)||2),d(6),j("width",c.getStorageUsagePercent(),"%"),d(2),Y("",((r=c.usageStats())==null||r.storage==null?null:r.storage.used)||0," MB / ",((r=c.usageStats())==null||r.storage==null?null:r.storage.limit)||10," MB"),d(13),M(c.inviteCode()),d(6),M(c.invitedCount()),d(5),M(c.rewardDays())}}function Dx(i,e){i&1&&(s(0,"div",24)(1,"div",45)(2,"table",46)(3,"thead")(4,"tr")(5,"th",47),l(6,"\u529F\u80FD"),a(),s(7,"th",48),l(8,"\u2694\uFE0F \u9752\u9285"),a(),s(9,"th",49),l(10,"\u{1F948} \u767D\u9280"),a(),s(11,"th",50),l(12,"\u{1F947} \u9EC3\u91D1"),a(),s(13,"th",51),l(14,"\u{1F48E} \u947D\u77F3"),a(),s(15,"th",52),l(16,"\u{1F31F} \u661F\u8000"),a(),s(17,"th",53),l(18,"\u{1F451} \u738B\u8005"),a()()(),s(19,"tbody")(20,"tr")(21,"td",54),l(22,"\u5E33\u865F\u6578\u91CF"),a(),s(23,"td"),l(24,"2 \u500B"),a(),s(25,"td"),l(26,"5 \u500B"),a(),s(27,"td"),l(28,"10 \u500B"),a(),s(29,"td"),l(30,"20 \u500B"),a(),s(31,"td"),l(32,"50 \u500B"),a(),s(33,"td"),l(34,"\u7121\u9650"),a()(),s(35,"tr")(36,"td",54),l(37,"\u6BCF\u65E5\u6D88\u606F"),a(),s(38,"td"),l(39,"20 \u689D"),a(),s(40,"td"),l(41,"100 \u689D"),a(),s(42,"td"),l(43,"300 \u689D"),a(),s(44,"td"),l(45,"1,000 \u689D"),a(),s(46,"td"),l(47,"\u7121\u9650"),a(),s(48,"td"),l(49,"\u7121\u9650"),a()(),s(50,"tr")(51,"td",54),l(52,"\u6BCF\u65E5 AI \u8ABF\u7528"),a(),s(53,"td"),l(54,"10 \u6B21"),a(),s(55,"td"),l(56,"50 \u6B21"),a(),s(57,"td"),l(58,"200 \u6B21"),a(),s(59,"td"),l(60,"\u7121\u9650"),a(),s(61,"td"),l(62,"\u7121\u9650"),a(),s(63,"td"),l(64,"\u7121\u9650"),a()(),s(65,"tr")(66,"td",54),l(67,"\u7FA4\u7D44\u6578\u91CF"),a(),s(68,"td"),l(69,"3 \u500B"),a(),s(70,"td"),l(71,"10 \u500B"),a(),s(72,"td"),l(73,"30 \u500B"),a(),s(74,"td"),l(75,"100 \u500B"),a(),s(76,"td"),l(77,"\u7121\u9650"),a(),s(78,"td"),l(79,"\u7121\u9650"),a()(),s(80,"tr")(81,"td",54),l(82,"\u5EE3\u544A\u767C\u9001"),a(),s(83,"td"),l(84,"\u274C"),a(),s(85,"td"),l(86,"\u2705"),a(),s(87,"td"),l(88,"\u2705"),a(),s(89,"td"),l(90,"\u2705"),a(),s(91,"td"),l(92,"\u2705"),a(),s(93,"td"),l(94,"\u2705"),a()(),s(95,"tr")(96,"td",54),l(97,"\u6279\u91CF\u64CD\u4F5C"),a(),s(98,"td"),l(99,"\u274C"),a(),s(100,"td"),l(101,"\u274C"),a(),s(102,"td"),l(103,"\u2705"),a(),s(104,"td"),l(105,"\u2705"),a(),s(106,"td"),l(107,"\u2705"),a(),s(108,"td"),l(109,"\u2705"),a()(),s(110,"tr")(111,"td",54),l(112,"AI \u92B7\u552E\u6F0F\u6597"),a(),s(113,"td"),l(114,"\u274C"),a(),s(115,"td"),l(116,"\u274C"),a(),s(117,"td"),l(118,"\u274C"),a(),s(119,"td"),l(120,"\u2705"),a(),s(121,"td"),l(122,"\u2705"),a(),s(123,"td"),l(124,"\u2705"),a()(),s(125,"tr")(126,"td",54),l(127,"\u667A\u80FD\u9632\u5C01"),a(),s(128,"td"),l(129,"\u274C"),a(),s(130,"td"),l(131,"\u274C"),a(),s(132,"td"),l(133,"\u274C"),a(),s(134,"td"),l(135,"\u274C"),a(),s(136,"td"),l(137,"\u2705"),a(),s(138,"td"),l(139,"\u2705"),a()(),s(140,"tr")(141,"td",54),l(142,"API \u63A5\u53E3"),a(),s(143,"td"),l(144,"\u274C"),a(),s(145,"td"),l(146,"\u274C"),a(),s(147,"td"),l(148,"\u274C"),a(),s(149,"td"),l(150,"\u274C"),a(),s(151,"td"),l(152,"\u274C"),a(),s(153,"td"),l(154,"\u2705"),a()(),s(155,"tr")(156,"td",54),l(157,"\u512A\u5148\u652F\u6301"),a(),s(158,"td"),l(159,"\u274C"),a(),s(160,"td"),l(161,"\u274C"),a(),s(162,"td"),l(163,"\u274C"),a(),s(164,"td"),l(165,"\u274C"),a(),s(166,"td"),l(167,"\u2705"),a(),s(168,"td"),l(169,"\u2705 \u5C08\u5C6C"),a()(),s(170,"tr",55)(171,"td",54),l(172,"\u50F9\u683C"),a(),s(173,"td",56),l(174,"\u514D\u8CBB"),a(),s(175,"td",56),l(176,"4.99 USDT/\u6708"),a(),s(177,"td",56),l(178,"19.9 USDT/\u6708"),a(),s(179,"td",56),l(180,"59.9 USDT/\u6708"),a(),s(181,"td",56),l(182,"199 USDT/\u6708"),a(),s(183,"td",56),l(184,"599 USDT/\u6708"),a()()()()()())}function Mx(i,e){i&1&&(s(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),a())}function Tx(i,e){if(i&1){let t=T();s(0,"button",80),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("silver","month"))}),l(1),a()}if(i&2){let t=f(2);d(),A(" ",t.membershipLevel()==="bronze"?"\u7ACB\u5373\u958B\u901A":"\u5207\u63DB\u65B9\u6848"," ")}}function Ix(i,e){if(i&1){let t=T();s(0,"button",81),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("silver","month"))}),l(1," \u7E8C\u8CBB "),a()}}function kx(i,e){i&1&&(s(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),a())}function Px(i,e){if(i&1){let t=T();s(0,"button",80),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("gold","month"))}),l(1),a()}if(i&2){let t=f(2);d(),A(" ",_n(1,xx).includes(t.membershipLevel())?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function Fx(i,e){if(i&1){let t=T();s(0,"button",81),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("gold","month"))}),l(1," \u7E8C\u8CBB "),a()}}function Rx(i,e){i&1&&(s(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),a())}function Nx(i,e){if(i&1){let t=T();s(0,"button",80),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("diamond","month"))}),l(1),a()}if(i&2){let t=f(2);d(),A(" ",_n(1,bx).includes(t.membershipLevel())?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function Bx(i,e){if(i&1){let t=T();s(0,"button",81),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("diamond","month"))}),l(1," \u7E8C\u8CBB "),a()}}function Vx(i,e){i&1&&(s(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),a())}function Lx(i,e){if(i&1){let t=T();s(0,"button",80),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("star","month"))}),l(1),a()}if(i&2){let t=f(2);d(),A(" ",t.membershipLevel()!=="king"?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function Ox(i,e){if(i&1){let t=T();s(0,"button",81),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("star","month"))}),l(1," \u7E8C\u8CBB "),a()}}function Gx(i,e){i&1&&(s(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),a())}function Ux(i,e){if(i&1){let t=T();s(0,"button",80),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("king","month"))}),l(1," \u7D42\u6975\u5347\u7D1A "),a()}}function qx(i,e){if(i&1){let t=T();s(0,"button",81),b("click",function(){v(t);let o=f(2);return x(o.onPurchase("king","month"))}),l(1," \u7E8C\u8CBB "),a()}}function $x(i,e){if(i&1){let t=T();s(0,"div",24)(1,"div",57)(2,"div",58),w(3,Mx,2,0,"div",59),s(4,"div",60),l(5,"\u{1F948}"),a(),s(6,"h3",61),l(7,"\u767D\u9280\u7CBE\u82F1"),a(),s(8,"div",62)(9,"span",63),l(10,"4.99 USDT"),a(),s(11,"span",64),l(12,"/\u6708"),a()(),s(13,"ul",65)(14,"li"),l(15,"\u2705 5 \u500B\u5E33\u865F"),a(),s(16,"li"),l(17,"\u2705 \u6BCF\u65E5 100 \u689D\u6D88\u606F"),a(),s(18,"li"),l(19,"\u2705 \u6BCF\u65E5 50 \u6B21 AI"),a(),s(20,"li"),l(21,"\u2705 10 \u500B\u7FA4\u7D44"),a(),s(22,"li"),l(23,"\u2705 \u5EE3\u544A\u767C\u9001"),a()(),w(24,Tx,2,1,"button",66)(25,Ix,2,0,"button",67),a(),s(26,"div",68),w(27,kx,2,0,"div",59),s(28,"div",60),l(29,"\u{1F947}"),a(),s(30,"h3",61),l(31,"\u9EC3\u91D1\u5927\u5E2B"),a(),s(32,"div",62)(33,"span",63),l(34,"19.9 USDT"),a(),s(35,"span",64),l(36,"/\u6708"),a()(),s(37,"ul",65)(38,"li"),l(39,"\u2705 15 \u500B\u5E33\u865F"),a(),s(40,"li"),l(41,"\u2705 \u6BCF\u65E5 500 \u689D\u6D88\u606F"),a(),s(42,"li"),l(43,"\u2705 \u6BCF\u65E5 300 \u6B21 AI"),a(),s(44,"li"),l(45,"\u2705 50 \u500B\u7FA4\u7D44"),a(),s(46,"li"),l(47,"\u2705 \u6279\u91CF\u64CD\u4F5C"),a(),s(48,"li"),l(49,"\u2705 \u6578\u64DA\u5C0E\u51FA"),a()(),w(50,Px,2,2,"button",66)(51,Fx,2,0,"button",67),a(),s(52,"div",69)(53,"div",70),l(54,"\u63A8\u85A6"),a(),w(55,Rx,2,0,"div",59),s(56,"div",60),l(57,"\u{1F48E}"),a(),s(58,"h3",61),l(59,"\u947D\u77F3\u738B\u724C"),a(),s(60,"div",62)(61,"span",63),l(62,"59.9 USDT"),a(),s(63,"span",64),l(64,"/\u6708"),a()(),s(65,"ul",65)(66,"li"),l(67,"\u2705 50 \u500B\u5E33\u865F"),a(),s(68,"li"),l(69,"\u2705 \u6BCF\u65E5 2000 \u689D\u6D88\u606F"),a(),s(70,"li"),l(71,"\u2705 \u7121\u9650 AI \u8ABF\u7528"),a(),s(72,"li"),l(73,"\u2705 200 \u500B\u7FA4\u7D44"),a(),s(74,"li"),l(75,"\u2705 AI \u92B7\u552E\u6F0F\u6597"),a(),s(76,"li"),l(77,"\u2705 \u9AD8\u7D1A\u5206\u6790"),a()(),w(78,Nx,2,2,"button",66)(79,Bx,2,0,"button",67),a(),s(80,"div",71),w(81,Vx,2,0,"div",59),s(82,"div",60),l(83,"\u{1F31F}"),a(),s(84,"h3",61),l(85,"\u661F\u8000\u50B3\u8AAA"),a(),s(86,"div",62)(87,"span",63),l(88,"199 USDT"),a(),s(89,"span",64),l(90,"/\u6708"),a()(),s(91,"ul",65)(92,"li"),l(93,"\u2705 100 \u500B\u5E33\u865F"),a(),s(94,"li"),l(95,"\u2705 \u7121\u9650\u6D88\u606F"),a(),s(96,"li"),l(97,"\u2705 \u7121\u9650 AI"),a(),s(98,"li"),l(99,"\u2705 \u7121\u9650\u7FA4\u7D44"),a(),s(100,"li"),l(101,"\u2705 \u667A\u80FD\u9632\u5C01"),a(),s(102,"li"),l(103,"\u2705 \u5718\u968A\u7BA1\u7406"),a()(),w(104,Lx,2,1,"button",66)(105,Ox,2,0,"button",67),a(),s(106,"div",72),w(107,Gx,2,0,"div",59),s(108,"div",60),l(109,"\u{1F451}"),a(),s(110,"h3",61),l(111,"\u69AE\u8000\u738B\u8005"),a(),s(112,"div",62)(113,"span",63),l(114,"599 USDT"),a(),s(115,"span",64),l(116,"/\u6708"),a()(),s(117,"div",73),l(118,"\u5C0A\u4EAB\u7279\u6B0A"),a(),s(119,"ul",65)(120,"li"),l(121,"\u2705 \u7121\u9650\u5E33\u865F"),a(),s(122,"li"),l(123,"\u2705 \u7121\u9650\u4E00\u5207"),a(),s(124,"li"),l(125,"\u2705 API \u63A5\u53E3"),a(),s(126,"li"),l(127,"\u2705 \u81EA\u5B9A\u7FA9\u54C1\u724C"),a(),s(128,"li"),l(129,"\u2705 \u5C08\u5C6C\u9867\u554F"),a(),s(130,"li"),l(131,"\u2705 \u65B0\u529F\u80FD\u5167\u6E2C"),a()(),w(132,Ux,2,0,"button",66)(133,qx,2,0,"button",67),a()(),s(134,"div",27)(135,"h3",28),l(136,"\u{1F3AB} \u4F7F\u7528\u5361\u5BC6\u6FC0\u6D3B"),a(),s(137,"div",74)(138,"input",75),W("ngModelChange",function(o){v(t);let r=f();return z(r.licenseKey,o)||(r.licenseKey=o),x(o)}),a(),s(139,"button",76),b("click",function(){v(t);let o=f();return x(o.onActivateLicense())}),l(140," \u6FC0\u6D3B "),a()()(),s(141,"div",27)(142,"h3",28),l(143,"\u{1F4B3} \u652F\u4ED8\u65B9\u5F0F"),a(),s(144,"div",77)(145,"button",78),b("click",function(){v(t);let o=f();return x(o.selectedPayment.set("alipay"))}),s(146,"span",79),l(147,"\u{1F499}"),a(),l(148," \u652F\u4ED8\u5BF6 "),a(),s(149,"button",78),b("click",function(){v(t);let o=f();return x(o.selectedPayment.set("wechat"))}),s(150,"span",79),l(151,"\u{1F49A}"),a(),l(152," \u5FAE\u4FE1\u652F\u4ED8 "),a(),s(153,"button",78),b("click",function(){v(t);let o=f();return x(o.selectedPayment.set("usdt"))}),s(154,"span",79),l(155,"\u{1F48E}"),a(),l(156," USDT "),a()()()()}if(i&2){let t=f();d(2),I("current",t.membershipLevel()==="silver"),d(),E(t.membershipLevel()==="silver"?3:-1),d(21),E(t.membershipLevel()!=="silver"?24:25),d(2),I("current",t.membershipLevel()==="gold"),d(),E(t.membershipLevel()==="gold"?27:-1),d(23),E(t.membershipLevel()!=="gold"?50:51),d(2),I("current",t.membershipLevel()==="diamond"),d(3),E(t.membershipLevel()==="diamond"?55:-1),d(23),E(t.membershipLevel()!=="diamond"?78:79),d(2),I("current",t.membershipLevel()==="star"),d(),E(t.membershipLevel()==="star"?81:-1),d(23),E(t.membershipLevel()!=="star"?104:105),d(2),I("current",t.membershipLevel()==="king"),d(),E(t.membershipLevel()==="king"?107:-1),d(25),E(t.membershipLevel()!=="king"?132:133),d(6),K("ngModel",t.licenseKey),d(),V("disabled",!t.licenseKey),d(6),I("active",t.selectedPayment()==="alipay"),d(4),I("active",t.selectedPayment()==="wechat"),d(4),I("active",t.selectedPayment()==="usdt")}}function Hx(i,e){i&1&&(s(0,"div",83),l(1,"\u8F09\u5165\u4E2D..."),a())}function Kx(i,e){i&1&&(s(0,"div",84),l(1,"\u66AB\u7121\u8A02\u95B1\u8A18\u9304"),a())}function zx(i,e){if(i&1&&(s(0,"div",85)(1,"div",86),l(2),a(),s(3,"div",87)(4,"div",88),l(5),a(),s(6,"div",89),l(7),a()(),s(8,"div",90),l(9),a()()),i&2){let t=e.$implicit,n=f(3);d(2),M(t.level_icon||"\u{1F3AB}"),d(3),Y("",t.level_name," ",t.duration_name,"\u6FC0\u6D3B"),d(2),A("",n.formatActivationDate(t.activated_at)," \xB7 \u5361\u5BC6\u6FC0\u6D3B"),d(),I("active",t.is_active)("used",!t.is_active),d(),A(" ",t.is_active?"\u751F\u6548\u4E2D":"\u5DF2\u904E\u671F"," ")}}function Wx(i,e){if(i&1&&$(0,zx,10,9,"div",85,Sx),i&2){let t=f(2);H(t.subscriptionHistory())}}function Jx(i,e){if(i&1&&(s(0,"div",24)(1,"div",27)(2,"h3",28),l(3,"\u{1F4DC} \u8A02\u95B1\u6B77\u53F2"),a(),s(4,"div",82),w(5,Hx,2,0,"div",83)(6,Kx,2,0,"div",84)(7,Wx,2,0),a()()()),i&2){let t=f();d(5),E(t.isLoadingHistory()?5:t.subscriptionHistory().length===0?6:7)}}var bo=class i{constructor(){this.authService=B(mn);this.membershipService=B(Ue);this.toast=B(me);this.licenseClient=B(Mt);this.cdr=B(zt);this.membershipUpdateHandler=null;this.activeTab=C("overview");this.selectedPayment=C("alipay");this.licenseKey="";this.user=L(()=>this.authService.user());this.membershipLevel=L(()=>this.authService.membershipLevel());this.membershipExpires=L(()=>this.authService.user()?.membershipExpires);this.membershipDaysLeft=L(()=>this.authService.membershipDaysLeft());this.usageStats=L(()=>this.authService.usageStats());this.inviteCode=C("");this.invitedCount=C(0);this.rewardDays=C(0);this.subscriptionHistory=C([]);this.isLoadingHistory=C(!1)}async ngOnInit(){let e=await this.authService.getInviteRewards();this.inviteCode.set(e.inviteCode),this.invitedCount.set(e.invitedCount),this.rewardDays.set(e.rewardDays),await this.loadSubscriptionHistory(),this.membershipUpdateHandler=t=>{console.log("[MembershipCenterComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",t.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler)}ngOnDestroy(){this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler)}async loadSubscriptionHistory(){this.isLoadingHistory.set(!0);try{let e=await this.licenseClient.getActivationHistory(50,0);e.success&&e.data&&this.subscriptionHistory.set(e.data)}catch(e){console.error("\u8F09\u5165\u8A02\u95B1\u8A18\u9304\u5931\u6557:",e)}finally{this.isLoadingHistory.set(!1)}}getMembershipIcon(){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[this.membershipLevel()]||"\u2694\uFE0F"}getMembershipName(){return{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.membershipLevel()]||"\u9752\u9285\u6230\u58EB"}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}getAiUsagePercent(){let e=this.usageStats();return e?.aiCalls?Math.min(100,e.aiCalls.used/e.aiCalls.limit*100):0}getMessageUsagePercent(){let e=this.usageStats();return e?.messagesSent?Math.min(100,e.messagesSent.used/e.messagesSent.limit*100):0}getAccountUsagePercent(){let e=this.usageStats();return e?.accounts?Math.min(100,e.accounts.used/e.accounts.limit*100):0}getStorageUsagePercent(){let e=this.usageStats();return e?.storage?Math.min(100,e.storage.used/e.storage.limit*100):0}copyInviteCode(){navigator.clipboard.writeText(this.inviteCode()),this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD")}onPurchase(e,t){this.toast.info(`\u6B63\u5728\u8DF3\u8F49\u5230\u652F\u4ED8\u9801\u9762... (${e} ${t})`)}async onActivateLicense(){let e=await this.authService.renewMembership(this.licenseKey);e.success?(this.toast.success(e.message||"\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01"),this.licenseKey="",await this.loadSubscriptionHistory(),this.cdr.detectChanges()):this.toast.error(e.message)}formatActivationDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-membership-center"]],decls:73,vars:32,consts:[[1,"membership-container"],[1,"page-header"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"membership-status-card"],[1,"status-left"],[1,"level-badge"],[1,"level-info"],[1,"level-name"],[1,"expires-info"],[1,"status-right"],[1,"upgrade-btn"],[1,"quick-stats"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-label"],[1,"stat-value"],[1,"stat-bar"],[1,"stat-fill"],[1,"stat-hint"],[1,"tabs"],[1,"tab-btn",3,"click"],[1,"tab-content"],[1,"days-left"],[1,"upgrade-btn",3,"click"],[1,"section-card"],[1,"section-title"],[1,"usage-details"],[1,"usage-row"],[1,"usage-name"],[1,"usage-bar-container"],[1,"usage-bar"],[1,"usage-fill"],[1,"usage-count"],[1,"section-card","invite-card"],[1,"invite-desc"],[1,"invite-code-display"],[1,"label"],[1,"code"],[1,"copy-btn",3,"click"],[1,"invite-stats-row"],[1,"invite-stat"],[1,"value"],[1,"benefits-table-container"],[1,"benefits-table"],[1,"feature-col"],[1,"level-col","bronze"],[1,"level-col","silver"],[1,"level-col","gold"],[1,"level-col","diamond"],[1,"level-col","star"],[1,"level-col","king"],[1,"feature-name"],[1,"price-row"],[1,"price"],[1,"pricing-cards"],[1,"pricing-card","silver"],[1,"current-badge"],[1,"plan-icon"],[1,"plan-name"],[1,"plan-price"],[1,"amount"],[1,"period"],[1,"plan-features"],[1,"buy-btn"],[1,"buy-btn","renew"],[1,"pricing-card","gold"],[1,"pricing-card","diamond","popular"],[1,"popular-badge"],[1,"pricing-card","star"],[1,"pricing-card","king"],[1,"savings"],[1,"license-input-row"],["type","text","placeholder","\u8F38\u5165\u5361\u5BC6\uFF1AXXXX-XXXX-XXXX-XXXX",1,"license-input",3,"ngModelChange","ngModel"],[1,"activate-btn",3,"click","disabled"],[1,"payment-methods"],[1,"payment-btn",3,"click"],[1,"payment-icon"],[1,"buy-btn",3,"click"],[1,"buy-btn","renew",3,"click"],[1,"history-list"],[1,"loading-state"],[1,"empty-state"],[1,"history-item"],[1,"history-icon"],[1,"history-info"],[1,"history-title"],[1,"history-meta"],[1,"history-status"]],template:function(t,n){if(t&1&&(s(0,"div",0)(1,"div",1)(2,"h1",2)(3,"span",3),l(4,"\u2B50"),a(),l(5," \u6703\u54E1\u4E2D\u5FC3 "),a(),s(6,"p",4),l(7,"\u7BA1\u7406\u60A8\u7684\u6703\u54E1\u6B0A\u76CA\u548C\u8A02\u95B1"),a()(),s(8,"div",5)(9,"div",6)(10,"div",7),l(11),a(),s(12,"div",8)(13,"h2",9),l(14),a(),w(15,yx,4,2,"p",10)(16,wx,2,0,"p",10),a()(),s(17,"div",11),w(18,Ex,2,0,"button",12),a()(),s(19,"div",13)(20,"div",14)(21,"div",15),l(22,"\u{1F916}"),a(),s(23,"div",16)(24,"div",17),l(25,"AI \u8ABF\u7528"),a(),s(26,"div",18),l(27),a(),s(28,"div",19),k(29,"div",20),a()()(),s(30,"div",14)(31,"div",15),l(32,"\u{1F4E8}"),a(),s(33,"div",16)(34,"div",17),l(35,"\u6D88\u606F\u767C\u9001"),a(),s(36,"div",18),l(37),a(),s(38,"div",19),k(39,"div",20),a()()(),s(40,"div",14)(41,"div",15),l(42,"\u{1F465}"),a(),s(43,"div",16)(44,"div",17),l(45,"\u5E33\u865F\u6578\u91CF"),a(),s(46,"div",18),l(47),a(),s(48,"div",19),k(49,"div",20),a()()(),s(50,"div",14)(51,"div",15),l(52,"\u{1F381}"),a(),s(53,"div",16)(54,"div",17),l(55,"\u9080\u8ACB\u734E\u52F5"),a(),s(56,"div",18),l(57),a(),s(58,"div",21),l(59),a()()()(),s(60,"div",22)(61,"button",23),b("click",function(){return n.activeTab.set("overview")}),l(62," \u{1F4CA} \u7E3D\u89BD "),a(),s(63,"button",23),b("click",function(){return n.activeTab.set("benefits")}),l(64," \u{1F3AF} \u6B0A\u76CA\u5C0D\u6BD4 "),a(),s(65,"button",23),b("click",function(){return n.activeTab.set("upgrade")}),l(66," \u{1F680} \u5347\u7D1A\u8CFC\u8CB7 "),a(),s(67,"button",23),b("click",function(){return n.activeTab.set("history")}),l(68," \u{1F4DC} \u8A02\u95B1\u8A18\u9304 "),a()(),w(69,Ax,63,19,"div",24),w(70,Dx,185,0,"div",24),w(71,$x,157,28,"div",24),w(72,Jx,8,1,"div",24),a()),t&2){let o,r,c;d(8),he("level-"+n.membershipLevel()),d(3),A(" ",n.getMembershipIcon()," "),d(3),M(n.getMembershipName()),d(),E(n.membershipExpires()?15:16),d(3),E(n.membershipLevel()!=="king"?18:-1),d(9),Y(" ",((o=n.usageStats())==null||o.aiCalls==null?null:o.aiCalls.used)||0," / ",((o=n.usageStats())==null||o.aiCalls==null?null:o.aiCalls.limit)||50," "),d(2),j("width",n.getAiUsagePercent(),"%"),d(8),Y(" ",((r=n.usageStats())==null||r.messagesSent==null?null:r.messagesSent.used)||0," / ",((r=n.usageStats())==null||r.messagesSent==null?null:r.messagesSent.limit)||100," "),d(2),j("width",n.getMessageUsagePercent(),"%"),d(8),Y(" ",((c=n.usageStats())==null||c.accounts==null?null:c.accounts.used)||0," / ",((c=n.usageStats())==null||c.accounts==null?null:c.accounts.limit)||2," "),d(2),j("width",n.getAccountUsagePercent(),"%"),d(8),A("",n.invitedCount()," \u4EBA"),d(2),A("\u5DF2\u7372 ",n.rewardDays()," \u5929\u734E\u52F5"),d(2),I("active",n.activeTab()==="overview"),d(2),I("active",n.activeTab()==="benefits"),d(2),I("active",n.activeTab()==="upgrade"),d(2),I("active",n.activeTab()==="history"),d(2),E(n.activeTab()==="overview"?69:-1),d(),E(n.activeTab()==="benefits"?70:-1),d(),E(n.activeTab()==="upgrade"?71:-1),d(),E(n.activeTab()==="history"?72:-1)}},dependencies:[oe,ue,xe,fe,_e],styles:[".membership-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary, white);display:flex;align-items:center;gap:.5rem;margin:0}.title-icon[_ngcontent-%COMP%]{font-size:1.75rem}.page-desc[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);margin:.5rem 0 0}.membership-status-card[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-radius:1rem;margin-bottom:1.5rem;border:1px solid}.membership-status-card.level-free[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4755694d,#3341554d);border-color:#47556980}.membership-status-card.level-vip[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b33,#d9770633);border-color:#f59e0b80}.membership-status-card.level-svip[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf633,#7c3aed33);border-color:#8b5cf680}.membership-status-card.level-mvp[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ec489933,#db277733);border-color:#ec489980}.status-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.level-badge[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:#ffffff1a;display:flex;align-items:center;justify-content:center;font-size:2rem}.level-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0}.expires-info[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);margin:.25rem 0 0}.days-left[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.upgrade-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.75rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s}.upgrade-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 20px -10px #06b6d480}.quick-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.75rem}.stat-icon[_ngcontent-%COMP%]{font-size:1.5rem}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.75rem}.stat-value[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.stat-bar[_ngcontent-%COMP%]{height:4px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:2px;margin-top:.5rem;overflow:hidden}.stat-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:2px}.stat-hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b)}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;flex-wrap:wrap}.tab-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.tab-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4)}.tab-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);border-color:transparent;color:#fff}.section-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;padding:1.5rem;margin-bottom:1rem}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary, white);margin:0 0 1rem}.usage-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.usage-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.usage-name[_ngcontent-%COMP%]{width:150px;color:var(--text-secondary, #cbd5e1)}.usage-bar-container[_ngcontent-%COMP%]{flex:1}.usage-bar[_ngcontent-%COMP%]{height:8px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:4px;overflow:hidden}.usage-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:4px}.usage-count[_ngcontent-%COMP%]{width:100px;text-align:right;color:var(--text-muted, #94a3b8);font-size:.875rem}.invite-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border-color:#06b6d44d}.invite-desc[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);margin-bottom:1rem}.invite-code-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;margin-bottom:1rem}.invite-code-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.invite-code-display[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{flex:1;font-family:monospace;font-size:1.25rem;font-weight:600;color:var(--primary, #06b6d4)}.copy-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary-bg, rgba(6, 182, 212, .1));border:1px solid var(--primary, #06b6d4);border-radius:.5rem;color:var(--primary, #06b6d4);cursor:pointer}.invite-stats-row[_ngcontent-%COMP%]{display:flex;gap:2rem}.invite-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.invite-stat[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--primary, #06b6d4)}.invite-stat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem}.benefits-table-container[_ngcontent-%COMP%]{overflow-x:auto}.benefits-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:center;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-primary, white);font-weight:600}.benefits-table[_ngcontent-%COMP%]   .feature-col[_ngcontent-%COMP%]{text-align:left;min-width:150px}.benefits-table[_ngcontent-%COMP%]   .feature-name[_ngcontent-%COMP%]{text-align:left;color:var(--text-secondary, #cbd5e1)}.benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--text-primary, white)}.benefits-table[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-weight:600;color:var(--primary, #06b6d4)}.pricing-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:1.5rem}.pricing-card[_ngcontent-%COMP%]{position:relative;padding:2rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:2px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;text-align:center}.pricing-card.vip[_ngcontent-%COMP%]{border-color:#f59e0b4d}.pricing-card.svip[_ngcontent-%COMP%]{border-color:#8b5cf64d}.pricing-card.mvp[_ngcontent-%COMP%]{border-color:#ec48994d}.pricing-card.popular[_ngcontent-%COMP%]{transform:scale(1.02);box-shadow:0 20px 40px -20px #8b5cf64d}.pricing-card.current[_ngcontent-%COMP%]{border-width:3px}.popular-badge[_ngcontent-%COMP%]{position:absolute;top:-12px;left:50%;transform:translate(-50%);padding:.25rem 1rem;background:linear-gradient(135deg,#8b5cf6,#7c3aed);border-radius:1rem;color:#fff;font-size:.75rem;font-weight:600}.current-badge[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;padding:.25rem .5rem;background:var(--success, #22c55e);border-radius:.25rem;color:#fff;font-size:.625rem;font-weight:600}.plan-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.plan-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0 0 .5rem}.plan-price[_ngcontent-%COMP%]{margin-bottom:.5rem}.plan-price[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--primary, #06b6d4)}.plan-price[_ngcontent-%COMP%]   .period[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.savings[_ngcontent-%COMP%]{font-size:.75rem;color:var(--success, #22c55e);margin-bottom:1rem}.plan-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:1rem 0;text-align:left}.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.5rem 0;color:var(--text-secondary, #cbd5e1)}.buy-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer}.buy-btn.renew[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a)}.license-input-row[_ngcontent-%COMP%]{display:flex;gap:.5rem}.license-input[_ngcontent-%COMP%]{flex:1;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-family:monospace}.activate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer}.activate-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.payment-methods[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.payment-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer;display:flex;align-items:center;gap:.5rem}.payment-btn.active[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4);background:#06b6d41a}.history-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.history-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem}.history-icon[_ngcontent-%COMP%]{font-size:1.5rem}.history-info[_ngcontent-%COMP%]{flex:1}.history-title[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white)}.history-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.history-status[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.history-status.active[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.history-status.used[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}"]})}};var Oc=(i,e)=>e.id;function Qx(i,e){if(i&1&&(s(0,"span",8),l(1),a()),i&2){let t=f();d(),A("\xB7 \u5269\u9918 ",t.membershipDaysLeft()," \u5929")}}function Yx(i,e){if(i&1){let t=T();s(0,"div",23)(1,"div",24)(2,"label"),l(3,"\u7576\u524D\u5BC6\u78BC"),a(),s(4,"input",25),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.passwordForm.oldPassword,o)||(r.passwordForm.oldPassword=o),x(o)}),a()(),s(5,"div",24)(6,"label"),l(7,"\u65B0\u5BC6\u78BC"),a(),s(8,"input",25),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.passwordForm.newPassword,o)||(r.passwordForm.newPassword=o),x(o)}),a()(),s(9,"div",24)(10,"label"),l(11,"\u78BA\u8A8D\u65B0\u5BC6\u78BC"),a(),s(12,"input",25),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.passwordForm.confirmPassword,o)||(r.passwordForm.confirmPassword=o),x(o)}),a()(),s(13,"div",26)(14,"button",27),b("click",function(){v(t);let o=f(2);return x(o.showChangePassword.set(!1))}),l(15,"\u53D6\u6D88"),a(),s(16,"button",28),b("click",function(){v(t);let o=f(2);return x(o.onChangePassword())}),l(17,"\u78BA\u8A8D\u4FEE\u6539"),a()()()}if(i&2){let t=f(2);d(4),K("ngModel",t.passwordForm.oldPassword),d(4),K("ngModel",t.passwordForm.newPassword),d(4),K("ngModel",t.passwordForm.confirmPassword)}}function Xx(i,e){if(i&1){let t=T();s(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F4CB} \u57FA\u672C\u4FE1\u606F"),a(),s(4,"div",15)(5,"div",16)(6,"span",17),l(7,"\u7528\u6236\u540D"),a(),s(8,"span",18),l(9),a()(),s(10,"div",16)(11,"span",17),l(12,"\u90F5\u7BB1"),a(),s(13,"span",18),l(14),a(),s(15,"button",19),l(16,"\u7DE8\u8F2F"),a()(),s(17,"div",16)(18,"span",17),l(19,"\u8A3B\u518A\u6642\u9593"),a(),s(20,"span",18),l(21),a()(),s(22,"div",16)(23,"span",17),l(24,"\u6700\u5F8C\u767B\u5165"),a(),s(25,"span",18),l(26),a()()()(),s(27,"div",13)(28,"h3",14),l(29,"\u{1F510} \u5B89\u5168\u8A2D\u7F6E"),a(),s(30,"div",20)(31,"button",21),b("click",function(){v(t);let o=f();return x(o.showChangePassword.set(!0))}),l(32," \u{1F511} \u4FEE\u6539\u5BC6\u78BC "),a(),s(33,"button",22),l(34," \u{1F4F1} \u5169\u6B65\u9A57\u8B49 "),a()(),w(35,Yx,18,3,"div",23),a()()}if(i&2){let t,n,o,r,c=f();d(9),M((t=c.user())==null?null:t.username),d(5),M(((n=c.user())==null?null:n.email)||"\u672A\u8A2D\u7F6E"),d(7),M(c.formatDate((o=c.user())==null?null:o.createdAt)),d(5),M(c.formatDate((r=c.user())==null?null:r.lastLogin)),d(9),E(c.showChangePassword()?35:-1)}}function Zx(i,e){i&1&&(s(0,"div",34),l(1,"\u8F09\u5165\u4E2D..."),a())}function jx(i,e){i&1&&(s(0,"div",35),l(1,"\u66AB\u7121\u6FC0\u6D3B\u8A18\u9304"),a())}function eb(i,e){if(i&1&&(s(0,"div",47)(1,"div",48)(2,"span",49),l(3),a(),s(4,"span",50),l(5),a()(),s(6,"div",51)(7,"span"),l(8),a(),s(9,"span",52),l(10),a()()()),i&2){let t=e.$implicit,n=f(3);d(3),M(n.formatLicenseKey(t.license_key)),d(2),je("",t.level_icon," ",t.level_name," ",t.duration_name),d(3),A("",n.formatActivationDate(t.activated_at)," \u6FC0\u6D3B"),d(),I("active",t.is_active)("used",!t.is_active),d(),A(" ",t.is_active?"\u6709\u6548":"\u5DF2\u904E\u671F"," ")}}function tb(i,e){if(i&1&&$(0,eb,11,10,"div",47,Oc),i&2){let t=f(2);H(t.activationHistory())}}function nb(i,e){if(i&1){let t=T();s(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F3AB} \u6FC0\u6D3B\u65B0\u5361\u5BC6"),a(),s(4,"div",29)(5,"input",30),W("ngModelChange",function(o){v(t);let r=f();return z(r.newLicenseKey,o)||(r.newLicenseKey=o),x(o)}),a(),s(6,"button",31),b("click",function(){v(t);let o=f();return x(o.onActivateLicense())}),l(7," \u6FC0\u6D3B "),a()(),s(8,"p",32),l(9,"\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u4EE5\u7E8C\u8CBB\u6216\u5347\u7D1A\u6703\u54E1"),a()(),s(10,"div",13)(11,"h3",14),l(12,"\u{1F4DC} \u6FC0\u6D3B\u8A18\u9304"),a(),s(13,"div",33),w(14,Zx,2,0,"div",34)(15,jx,2,0,"div",35)(16,tb,2,0),a()(),s(17,"div",13)(18,"h3",14),l(19,"\u{1F6D2} \u8CFC\u8CB7\u5361\u5BC6\uFF08\u738B\u8005\u69AE\u8000\u7B49\u7D1A\uFF09"),a(),s(20,"div",36)(21,"div",37)(22,"div",38),l(23,"\u{1F948} \u767D\u9280\u7CBE\u82F1"),a(),s(24,"div",39),l(25,"4.99 USDT/\u6708"),a(),s(26,"ul",40)(27,"li"),l(28,"5 \u500B\u5E33\u865F"),a(),s(29,"li"),l(30,"\u6BCF\u65E5 100 \u689D\u6D88\u606F"),a(),s(31,"li"),l(32,"\u6BCF\u65E5 50 \u6B21 AI"),a(),s(33,"li"),l(34,"10 \u500B\u7FA4\u7D44"),a()(),s(35,"button",41),l(36,"\u8CFC\u8CB7"),a()(),s(37,"div",42)(38,"div",38),l(39,"\u{1F947} \u9EC3\u91D1\u5927\u5E2B"),a(),s(40,"div",39),l(41,"19.9 USDT/\u6708"),a(),s(42,"div",43),l(43,"\u63A8\u85A6"),a(),s(44,"ul",40)(45,"li"),l(46,"15 \u500B\u5E33\u865F"),a(),s(47,"li"),l(48,"\u6BCF\u65E5 500 \u689D\u6D88\u606F"),a(),s(49,"li"),l(50,"\u6BCF\u65E5 300 \u6B21 AI"),a(),s(51,"li"),l(52,"\u6279\u91CF\u64CD\u4F5C"),a()(),s(53,"button",41),l(54,"\u8CFC\u8CB7"),a()(),s(55,"div",44)(56,"div",38),l(57,"\u{1F48E} \u947D\u77F3\u738B\u724C"),a(),s(58,"div",39),l(59,"59.9 USDT/\u6708"),a(),s(60,"ul",40)(61,"li"),l(62,"50 \u500B\u5E33\u865F"),a(),s(63,"li"),l(64,"\u6BCF\u65E5 2000 \u689D\u6D88\u606F"),a(),s(65,"li"),l(66,"\u7121\u9650 AI \u8ABF\u7528"),a(),s(67,"li"),l(68,"AI \u92B7\u552E\u6F0F\u6597"),a()(),s(69,"button",41),l(70,"\u8CFC\u8CB7"),a()(),s(71,"div",45)(72,"div",38),l(73,"\u{1F31F} \u661F\u8000\u50B3\u8AAA"),a(),s(74,"div",39),l(75,"199 USDT/\u6708"),a(),s(76,"ul",40)(77,"li"),l(78,"100 \u500B\u5E33\u865F"),a(),s(79,"li"),l(80,"\u7121\u9650\u6D88\u606F"),a(),s(81,"li"),l(82,"\u5718\u968A\u7BA1\u7406"),a(),s(83,"li"),l(84,"\u667A\u80FD\u9632\u5C01"),a()(),s(85,"button",41),l(86,"\u8CFC\u8CB7"),a()(),s(87,"div",46)(88,"div",38),l(89,"\u{1F451} \u69AE\u8000\u738B\u8005"),a(),s(90,"div",39),l(91,"599 USDT/\u6708"),a(),s(92,"ul",40)(93,"li"),l(94,"\u7121\u9650\u5E33\u865F"),a(),s(95,"li"),l(96,"\u7121\u9650\u4E00\u5207"),a(),s(97,"li"),l(98,"API \u63A5\u53E3"),a(),s(99,"li"),l(100,"\u5C08\u5C6C\u9867\u554F"),a()(),s(101,"button",41),l(102,"\u8CFC\u8CB7"),a()()()()()}if(i&2){let t=f();d(5),K("ngModel",t.newLicenseKey),d(),V("disabled",!t.newLicenseKey),d(8),E(t.isLoadingHistory()?14:t.activationHistory().length===0?15:16)}}function ib(i,e){i&1&&(s(0,"span",66),l(1,"\u672C\u6A5F"),a())}function ob(i,e){if(i&1){let t=T();s(0,"button",70),b("click",function(){v(t);let o=f().$implicit,r=f(2);return x(r.onUnbindDevice(o.id))}),l(1," \u89E3\u7D81 "),a()}if(i&2){let t=f(3);V("disabled",t.isUnbinding())}}function rb(i,e){if(i&1&&(s(0,"div",62)(1,"div",63),l(2),a(),s(3,"div",64)(4,"div",65),l(5),w(6,ib,2,0,"span",66),a(),s(7,"div",67),l(8),a(),s(9,"div",68),l(10),a()(),w(11,ob,2,1,"button",69),a()),i&2){let t=e.$implicit,n=f(2);I("current",t.isCurrent),d(2),A(" ",n.getDeviceIcon(t)," "),d(3),A(" ",t.deviceName," "),d(),E(t.isCurrent?6:-1),d(2),M(t.deviceCode),d(2),Y(" \u7D81\u5B9A\u65BC ",n.formatDate(t.boundAt)," \xB7 \u6700\u5F8C\u6D3B\u52D5 ",n.formatDate(t.lastSeen)," "),d(),E(t.isCurrent?-1:11)}}function sb(i,e){i&1&&(s(0,"div",35),l(1," \u66AB\u7121\u7D81\u5B9A\u8A2D\u5099\u8A18\u9304 "),a())}function ab(i,e){if(i&1){let t=T();s(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F4BB} \u5DF2\u7D81\u5B9A\u8A2D\u5099"),a(),s(4,"p",53),l(5),a(),s(6,"div",54),$(7,rb,12,9,"div",55,Oc,!1,sb,2,0,"div",35),a()(),s(10,"div",13)(11,"h3",14),l(12,"\u{1F4F1} \u7576\u524D\u8A2D\u5099"),a(),s(13,"div",56)(14,"div",57)(15,"span",58),l(16,"\u8A2D\u5099\u78BC"),a(),s(17,"span",59),l(18),a(),s(19,"button",60),b("click",function(){v(t);let o=f();return x(o.copyDeviceCode())}),l(20,"\u{1F4CB}"),a()(),s(21,"div",57)(22,"span",58),l(23,"\u8A2D\u5099\u540D\u7A31"),a(),s(24,"span",61),l(25),a()()()()()}if(i&2){let t=f();d(5),Y(" \u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u6700\u591A\u53EF\u7D81\u5B9A ",t.getMaxDevices()," \u53F0\u8A2D\u5099\uFF0C\u5DF2\u4F7F\u7528 ",t.devices().length," \u53F0 "),d(2),H(t.devices()),d(11),M(t.currentDeviceCode()),d(7),M(t.currentDeviceName())}}function lb(i,e){if(i&1&&(s(0,"div",71)(1,"div",72)(2,"div",73),l(3,"\u{1F916}"),a(),s(4,"div",74)(5,"div",75),l(6,"AI \u8ABF\u7528"),a(),s(7,"div",76),k(8,"div",77),a(),s(9,"div",78),l(10),a()()(),s(11,"div",72)(12,"div",73),l(13,"\u{1F4E8}"),a(),s(14,"div",74)(15,"div",75),l(16,"\u6D88\u606F\u767C\u9001"),a(),s(17,"div",76),k(18,"div",77),a(),s(19,"div",78),l(20),a()()(),s(21,"div",72)(22,"div",73),l(23,"\u{1F465}"),a(),s(24,"div",74)(25,"div",75),l(26,"\u5E33\u865F\u6578\u91CF"),a(),s(27,"div",76),k(28,"div",77),a(),s(29,"div",78),l(30),a()()(),s(31,"div",72)(32,"div",73),l(33,"\u{1F4BE}"),a(),s(34,"div",74)(35,"div",75),l(36,"\u5B58\u5132\u7A7A\u9593"),a(),s(37,"div",76),k(38,"div",77),a(),s(39,"div",78),l(40),a()()()()),i&2){let t=f(2);d(8),j("width",t.getUsagePercent(t.usageStats().aiCalls),"%"),d(2),Y(" ",t.usageStats().aiCalls.used," / ",t.usageStats().aiCalls.limit," \u6B21 "),d(8),j("width",t.getUsagePercent(t.usageStats().messagesSent),"%"),d(2),Y(" ",t.usageStats().messagesSent.used," / ",t.usageStats().messagesSent.limit," \u689D "),d(8),j("width",t.getUsagePercent(t.usageStats().accounts),"%"),d(2),Y(" ",t.usageStats().accounts.used," / ",t.usageStats().accounts.limit," \u500B "),d(8),j("width",t.getUsagePercent(t.usageStats().storage),"%"),d(2),Y(" ",t.usageStats().storage.used," / ",t.usageStats().storage.limit," MB ")}}function cb(i,e){i&1&&(s(0,"div",34),l(1,"\u8F09\u5165\u4E2D..."),a())}function db(i,e){if(i&1&&(s(0,"div",12)(1,"div",13)(2,"h3",14),l(3,"\u{1F4CA} \u672C\u6708\u4F7F\u7528\u60C5\u6CC1"),a(),w(4,lb,41,16,"div",71)(5,cb,2,0,"div",34),a(),s(6,"div",13)(7,"h3",14),l(8,"\u{1F4C8} \u6B77\u53F2\u8DA8\u52E2"),a(),s(9,"p",53),l(10,"\u656C\u8ACB\u671F\u5F85..."),a()()()),i&2){let t=f();d(4),E(t.usageStats()?4:5)}}function ub(i,e){if(i&1){let t=T();s(0,"div",12)(1,"div",79)(2,"h3",14),l(3,"\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5"),a(),s(4,"p",53),l(5," \u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 "),s(6,"strong"),l(7,"3 \u5929\u767D\u9280\u7CBE\u82F1"),a(),l(8," \u734E\u52F5\uFF01 "),a(),s(9,"div",80)(10,"span",81),l(11,"\u6211\u7684\u9080\u8ACB\u78BC"),a(),s(12,"div",82),l(13),a(),s(14,"button",60),b("click",function(){v(t);let o=f();return x(o.copyInviteCode())}),l(15," \u{1F4CB} \u8907\u88FD "),a()(),s(16,"div",83)(17,"span",81),l(18,"\u9080\u8ACB\u93C8\u63A5"),a(),k(19,"input",84),s(20,"button",60),b("click",function(){v(t);let o=f();return x(o.copyInviteLink())}),l(21," \u{1F4CB} \u8907\u88FD "),a()()(),s(22,"div",13)(23,"h3",14),l(24,"\u{1F4CA} \u9080\u8ACB\u7D71\u8A08"),a(),s(25,"div",85)(26,"div",86)(27,"div",87),l(28),a(),s(29,"div",88),l(30,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),a()(),s(31,"div",86)(32,"div",87),l(33),a(),s(34,"div",88),l(35,"\u7372\u5F97\u734E\u52F5\u5929\u6578"),a()()()()()}if(i&2){let t=f();d(13),M(t.inviteCode()),d(6),V("value",t.inviteLink()),d(9),M(t.invitedCount()),d(5),M(t.rewardDays())}}var So=class i{constructor(){this.authService=B(mn);this.deviceService=B(un);this.i18n=B(Tt);this.toast=B(me);this.licenseClient=B(Mt);this.cdr=B(zt);this.membershipUpdateHandler=null;this.activeTab=C("account");this.showChangePassword=C(!1);this.isUnbinding=C(!1);this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""};this.newLicenseKey="";this.user=L(()=>this.authService.user());this.membershipLevel=L(()=>this.authService.membershipLevel());this.membershipDaysLeft=L(()=>this.authService.membershipDaysLeft());this.devices=L(()=>this.authService.devices());this.usageStats=L(()=>this.authService.usageStats());this.currentDeviceCode=C("");this.currentDeviceName=C("");this.inviteCode=C("");this.invitedCount=C(0);this.rewardDays=C(0);this.activationHistory=C([]);this.isLoadingHistory=C(!1);this.inviteLink=L(()=>`https://tg-matrix.com/invite?code=${this.inviteCode()}`)}async ngOnInit(){this.currentDeviceCode.set(await this.deviceService.getDeviceCode()),this.currentDeviceName.set(this.deviceService.getDeviceName());let e=await this.authService.getInviteRewards();this.inviteCode.set(e.inviteCode),this.invitedCount.set(e.invitedCount),this.rewardDays.set(e.rewardDays),await this.loadActivationHistory(),this.membershipUpdateHandler=t=>{console.log("[ProfileComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",t.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler)}ngOnDestroy(){this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler)}async loadActivationHistory(){this.isLoadingHistory.set(!0);try{let e=await this.licenseClient.getActivationHistory(50,0);e.success&&e.data&&this.activationHistory.set(e.data)}catch(e){console.error("\u8F09\u5165\u6FC0\u6D3B\u8A18\u9304\u5931\u6557:",e)}finally{this.isLoadingHistory.set(!1)}}getMembershipIcon(){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[this.membershipLevel()]||"\u2694\uFE0F"}getMembershipName(){return{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.membershipLevel()]||"\u9752\u9285\u6230\u58EB"}getMaxDevices(){return{bronze:1,silver:2,gold:3,diamond:4,star:5,king:-1}[this.membershipLevel()]||1}getDeviceIcon(e){return e.deviceName.includes("Windows")?"\u{1F4BB}":e.deviceName.includes("Mac")?"\u{1F5A5}\uFE0F":e.deviceName.includes("Linux")?"\u{1F427}":"\u{1F4F1}"}getUsagePercent(e){return Math.min(100,e.used/e.limit*100)}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}async onLogout(){await this.authService.logout()}async onChangePassword(){if(this.passwordForm.newPassword!==this.passwordForm.confirmPassword){this.toast.error("\u5169\u6B21\u8F38\u5165\u7684\u5BC6\u78BC\u4E0D\u4E00\u81F4");return}let e=await this.authService.changePassword(this.passwordForm.oldPassword,this.passwordForm.newPassword);e.success?(this.toast.success("\u5BC6\u78BC\u4FEE\u6539\u6210\u529F"),this.showChangePassword.set(!1),this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""}):this.toast.error(e.message)}async onActivateLicense(){let e=await this.authService.renewMembership(this.newLicenseKey);e.success?(this.toast.success(e.message||"\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01"),this.newLicenseKey="",await this.loadActivationHistory(),this.cdr.detectChanges()):this.toast.error(e.message)}formatLicenseKey(e){return e?e.length>16?e.substring(0,12)+"-****":e:""}formatActivationDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}async onUnbindDevice(e){this.isUnbinding.set(!0);let t=await this.authService.unbindDevice(e);t.success?this.toast.success("\u8A2D\u5099\u5DF2\u89E3\u7D81"):this.toast.error(t.message),this.isUnbinding.set(!1)}copyDeviceCode(){navigator.clipboard.writeText(this.currentDeviceCode()),this.toast.success("\u8A2D\u5099\u78BC\u5DF2\u8907\u88FD")}copyInviteCode(){navigator.clipboard.writeText(this.inviteCode()),this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD")}copyInviteLink(){navigator.clipboard.writeText(this.inviteLink()),this.toast.success("\u9080\u8ACB\u93C8\u63A5\u5DF2\u8907\u88FD")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-profile"]],decls:31,vars:23,consts:[[1,"profile-container"],[1,"profile-header"],[1,"avatar-section"],[1,"avatar"],[1,"user-info"],[1,"username"],[1,"email"],[1,"membership-badge"],[1,"expires"],[1,"logout-btn",3,"click"],[1,"tabs"],[1,"tab-btn",3,"click"],[1,"tab-content"],[1,"section-card"],[1,"section-title"],[1,"info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value"],[1,"edit-btn"],[1,"security-actions"],[1,"action-btn",3,"click"],[1,"action-btn"],[1,"change-password-form"],[1,"form-group"],["type","password",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-actions"],[1,"cancel-btn",3,"click"],[1,"submit-btn",3,"click"],[1,"license-input-group"],["type","text","placeholder","XXXX-XXXX-XXXX-XXXX",1,"form-input","font-mono",3,"ngModelChange","ngModel"],[1,"activate-btn",3,"click","disabled"],[1,"hint-text"],[1,"license-history"],[1,"loading-state"],[1,"empty-state"],[1,"purchase-options"],[1,"purchase-card","silver"],[1,"plan-name"],[1,"plan-price"],[1,"plan-features"],[1,"buy-btn"],[1,"purchase-card","gold"],[1,"recommended"],[1,"purchase-card","diamond"],[1,"purchase-card","star"],[1,"purchase-card","king"],[1,"history-item"],[1,"history-info"],[1,"license-code"],[1,"license-type"],[1,"history-meta"],[1,"status"],[1,"section-desc"],[1,"device-list"],[1,"device-item",3,"current"],[1,"current-device-info"],[1,"info-row"],[1,"label"],[1,"value","font-mono"],[1,"copy-btn",3,"click"],[1,"value"],[1,"device-item"],[1,"device-icon"],[1,"device-info"],[1,"device-name"],[1,"current-badge"],[1,"device-code"],[1,"device-meta"],[1,"unbind-btn",3,"disabled"],[1,"unbind-btn",3,"click","disabled"],[1,"usage-grid"],[1,"usage-item"],[1,"usage-icon"],[1,"usage-info"],[1,"usage-label"],[1,"usage-bar"],[1,"usage-fill"],[1,"usage-text"],[1,"section-card","highlight"],[1,"invite-code-box"],[1,"invite-label"],[1,"invite-code"],[1,"invite-link-box"],["type","text","readonly","",1,"invite-link-input",3,"value"],[1,"invite-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"]],template:function(t,n){if(t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l(4),a(),s(5,"div",4)(6,"h2",5),l(7),a(),s(8,"p",6),l(9),a(),s(10,"div",7),l(11),w(12,Qx,2,1,"span",8),a()()(),s(13,"button",9),b("click",function(){return n.onLogout()}),l(14," \u{1F6AA} \u9000\u51FA "),a()(),s(15,"div",10)(16,"button",11),b("click",function(){return n.activeTab.set("account")}),l(17," \u{1F464} \u5E33\u865F\u4FE1\u606F "),a(),s(18,"button",11),b("click",function(){return n.activeTab.set("license")}),l(19," \u{1F511} \u5361\u5BC6\u7BA1\u7406 "),a(),s(20,"button",11),b("click",function(){return n.activeTab.set("devices")}),l(21," \u{1F4BB} \u8A2D\u5099\u7BA1\u7406 "),a(),s(22,"button",11),b("click",function(){return n.activeTab.set("usage")}),l(23," \u{1F4CA} \u4F7F\u7528\u7D71\u8A08 "),a(),s(24,"button",11),b("click",function(){return n.activeTab.set("invite")}),l(25," \u{1F381} \u9080\u8ACB\u734E\u52F5 "),a()(),w(26,Xx,36,5,"div",12),w(27,nb,103,3,"div",12),w(28,ab,26,5,"div",12),w(29,db,11,1,"div",12),w(30,ub,36,4,"div",12),a()),t&2){let o,r,c;d(4),A(" ",((o=n.user())==null||o.username==null?null:o.username.charAt(0).toUpperCase())||"?"," "),d(3),M(((r=n.user())==null?null:r.username)||"\u672A\u767B\u5165"),d(2),M(((c=n.user())==null?null:c.email)||"\u672A\u8A2D\u7F6E\u90F5\u7BB1"),d(),he("level-"+n.membershipLevel()),d(),Y(" ",n.getMembershipIcon()," ",n.getMembershipName()," "),d(),E(n.membershipDaysLeft()>0?12:-1),d(4),I("active",n.activeTab()==="account"),d(2),I("active",n.activeTab()==="license"),d(2),I("active",n.activeTab()==="devices"),d(2),I("active",n.activeTab()==="usage"),d(2),I("active",n.activeTab()==="invite"),d(2),E(n.activeTab()==="account"?26:-1),d(),E(n.activeTab()==="license"?27:-1),d(),E(n.activeTab()==="devices"?28:-1),d(),E(n.activeTab()==="usage"?29:-1),d(),E(n.activeTab()==="invite"?30:-1)}},dependencies:[oe,ue,xe,fe,_e],styles:[".profile-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:900px;margin:0 auto}.profile-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border:1px solid rgba(6,182,212,.2);border-radius:1rem;margin-bottom:1.5rem}.avatar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#fff}.username[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0}.email[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin:.25rem 0}.membership-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;border-radius:1rem;font-size:.75rem;font-weight:500}.membership-badge.level-bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}.membership-badge.level-silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,silver,#a8a8a8);color:#1e293b}.membership-badge.level-gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:#1e293b}.membership-badge.level-diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b9f2ff,#06b6d4);color:#1e293b}.membership-badge.level-star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}.membership-badge.level-king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}.expires[_ngcontent-%COMP%]{opacity:.8}.logout-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:.5rem;color:#fca5a5;cursor:pointer;transition:all .2s}.logout-btn[_ngcontent-%COMP%]:hover{background:#ef444433}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;flex-wrap:wrap}.tab-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s;font-size:.875rem}.tab-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.tab-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);border-color:transparent;color:#fff}.section-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;padding:1.5rem;margin-bottom:1rem}.section-card.highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border-color:#06b6d44d}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary, white);margin:0 0 1rem}.section-desc[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin-bottom:1rem}.info-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.info-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;min-width:80px}.info-value[_ngcontent-%COMP%]{color:var(--text-primary, white);flex:1}.edit-btn[_ngcontent-%COMP%], .copy-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.25rem;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:.75rem}.edit-btn[_ngcontent-%COMP%]:hover, .copy-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--text-secondary, #cbd5e1);font-size:.875rem;margin-bottom:.5rem}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.device-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.device-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.75rem}.device-item.current[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.device-icon[_ngcontent-%COMP%]{font-size:1.5rem}.device-info[_ngcontent-%COMP%]{flex:1}.device-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white);display:flex;align-items:center;gap:.5rem}.current-badge[_ngcontent-%COMP%]{font-size:.625rem;padding:.125rem .375rem;background:var(--primary, #06b6d4);border-radius:.25rem;color:#fff}.device-code[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--text-muted, #94a3b8)}.device-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);margin-top:.25rem}.unbind-btn[_ngcontent-%COMP%]{padding:.375rem .75rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:.375rem;color:#fca5a5;cursor:pointer;font-size:.75rem}.usage-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.usage-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem}.usage-icon[_ngcontent-%COMP%]{font-size:1.5rem}.usage-info[_ngcontent-%COMP%]{flex:1}.usage-label[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);font-size:.875rem;margin-bottom:.5rem}.usage-bar[_ngcontent-%COMP%]{height:8px;background:var(--bg-primary, #0f172a);border-radius:4px;overflow:hidden}.usage-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:4px;transition:width .3s}.usage-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);margin-top:.25rem}.invite-code-box[_ngcontent-%COMP%], .invite-link-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;margin-bottom:1rem}.invite-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;min-width:80px}.invite-code[_ngcontent-%COMP%]{font-family:monospace;font-size:1.25rem;font-weight:600;color:var(--primary, #06b6d4);flex:1}.invite-link-input[_ngcontent-%COMP%]{flex:1;padding:.5rem;background:transparent;border:none;color:var(--text-secondary, #cbd5e1);font-size:.875rem}.invite-stats[_ngcontent-%COMP%]{display:flex;gap:2rem;justify-content:center;padding:1rem}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--primary, #06b6d4)}.stat-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem}.purchase-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.purchase-card[_ngcontent-%COMP%]{padding:1.5rem;border-radius:1rem;text-align:center;border:1px solid var(--border-default, rgba(148, 163, 184, .1))}.purchase-card.silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,#c0c0c01a,#a8a8a81a);border-color:#c0c0c04d}.purchase-card.gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ffd7001a,#ffa5001a);border-color:#ffd7004d}.purchase-card.diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d426,#b9f2ff1a);border-color:#06b6d466}.purchase-card.star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b61a,#8e44ad1a);border-color:#9b59b64d}.purchase-card.king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b26,#ee5a5a1a);border-color:#ff6b6b66}.recommended[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#06b6d4,#3b82f6);color:#fff;font-size:.625rem;padding:.125rem .5rem;border-radius:.25rem;font-weight:600}.purchase-card[_ngcontent-%COMP%]{position:relative}.plan-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white);margin-bottom:.5rem}.plan-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--primary, #06b6d4);margin-bottom:1rem}.plan-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.25rem 0}.buy-btn[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;cursor:pointer;font-weight:500}.license-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:.5rem}.license-input-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1;font-family:monospace}.activate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}.activate-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #22c55e4d}.activate-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.hint-text[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin-top:.5rem}.empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--text-muted, #94a3b8)}"]})}};var mb=(i,e)=>e.id,Gc=(i,e)=>e.value,pb=(i,e)=>e.telegram_id;function gb(i,e){if(i&1){let t=T();s(0,"span",45),b("click",function(){v(t);let o=f();return x(o.forceEndSync())}),k(1,"span",46),l(2," \u540C\u6B65\u4E2D... (\u9EDE\u64CA\u53D6\u6D88) "),a()}}function hb(i,e){if(i&1){let t=T();s(0,"button",47),b("click",function(){let o=v(t).$implicit,r=f();return x(r.switchTab(o.id))}),l(1),a()}if(i&2){let t=e.$implicit,n=f();I("bg-purple-500",n.activeTab()===t.id)("text-white",n.activeTab()===t.id)("text-slate-400",n.activeTab()!==t.id)("hover:text-white",n.activeTab()!==t.id),d(),Y(" ",t.icon," ",t.label," ")}}function fb(i,e){if(i&1&&(s(0,"option",33),l(1),a()),i&2){let t=e.$implicit;V("value",t.value),d(),M(t.label)}}function _b(i,e){if(i&1&&(s(0,"option",33),l(1),a()),i&2){let t=e.$implicit;V("value",t),d(),M(t)}}function Cb(i,e){if(i&1){let t=T();s(0,"div",40)(1,"span",48),l(2),a(),s(3,"button",49),b("click",function(){v(t);let o=f();return x(o.showBatchTagDialog.set(!0))}),l(4," \u6279\u91CF\u6A19\u8A18 "),a(),s(5,"button",50),b("click",function(){v(t);let o=f();return x(o.showBatchStatusDialog.set(!0))}),l(6," \u66F4\u65B0\u72C0\u614B "),a(),s(7,"button",51),b("click",function(){v(t);let o=f();return x(o.batchSendMessage())}),l(8," \u6279\u91CF\u767C\u9001 "),a(),s(9,"button",52),b("click",function(){v(t);let o=f();return x(o.sendToAISales())}),s(10,"span"),l(11,"\u{1F4E4}"),a(),l(12," \u52A0\u5165\u767C\u9001\u968A\u5217 "),a(),s(13,"button",53),b("click",function(){v(t);let o=f();return x(o.confirmBatchDelete())}),l(14," \u522A\u9664 "),a(),s(15,"button",54),b("click",function(){v(t);let o=f();return x(o.contactsService.clearSelection())}),l(16," \u53D6\u6D88\u9078\u64C7 "),a()()}if(i&2){let t=f();d(2),A(" \u5DF2\u9078\u64C7 ",t.contactsService.selectedIds().size," \u9805 ")}}function vb(i,e){i&1&&(s(0,"div",42),k(1,"div",55),a())}function xb(i,e){if(i&1){let t=T();s(0,"div",43)(1,"div",56),l(2,"\u{1F4E6}"),a(),s(3,"p",57),l(4,"\u66AB\u7121\u8CC7\u6E90\u6578\u64DA"),a(),s(5,"p",58),l(6,"\u9EDE\u64CA\u300C\u540C\u6B65\u6578\u64DA\u300D\u5F9E\u5404\u4F86\u6E90\u6574\u5408\u6578\u64DA"),a(),s(7,"button",39),b("click",function(){v(t);let o=f();return x(o.syncData())}),l(8," \u540C\u6B65\u6578\u64DA "),a()()}}function bb(i,e){if(i&1&&(s(0,"div",73),l(1),a()),i&2){let t=f().$implicit;d(),A("@",t.username)}}function Sb(i,e){if(i&1&&(s(0,"div",78),l(1),a()),i&2){let t=f().$implicit;d(),A(" \u{1F4CD} ",t.source_name," ")}}function yb(i,e){if(i&1&&(s(0,"span",80),l(1),a()),i&2){let t=e.$implicit;d(),A(" ",t," ")}}function wb(i,e){if(i&1&&(s(0,"span",81),l(1),a()),i&2){let t=f().$implicit;d(),A(" +",t.tags.length-2," ")}}function Eb(i,e){if(i&1){let t=T();s(0,"button",90),b("click",function(){v(t);let o=f().$implicit,r=f(2);return x(r.sendMessage(o))}),te(),s(1,"svg",10),k(2,"path",91),a()()}}function Ab(i,e){if(i&1){let t=T();s(0,"tr",66)(1,"td",65)(2,"input",64),b("change",function(){let o=v(t).$implicit,r=f(2);return x(r.contactsService.toggleSelect(o.telegram_id))}),a()(),s(3,"td",65)(4,"div",7)(5,"div",71),l(6),a(),s(7,"div")(8,"div",72),l(9),a(),w(10,bb,2,1,"div",73),a()()(),s(11,"td",65)(12,"span",74),l(13),a()(),s(14,"td",65)(15,"div",75)(16,"span",76),l(17),a(),s(18,"span",77),l(19),a()(),w(20,Sb,2,1,"div",78),a(),s(21,"td",65)(22,"div",79),$(23,yb,2,1,"span",80,ke),w(25,wb,2,1,"span",81),a()(),s(26,"td",65)(27,"span",74),l(28),a()(),s(29,"td",65)(30,"div",68)(31,"div",82),k(32,"div",83),a(),s(33,"span",73),l(34),a()()(),s(35,"td",65)(36,"div",68),w(37,Eb,3,0,"button",84),s(38,"button",85),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.viewDetail(o))}),te(),s(39,"svg",10),k(40,"path",86)(41,"path",87),a()(),le(),s(42,"button",88),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.editContact(o))}),te(),s(43,"svg",10),k(44,"path",89),a()()()()()}if(i&2){let t=e.$implicit,n=f(2);d(2),V("checked",n.contactsService.selectedIds().has(t.telegram_id)),d(4),A(" ",n.getInitial(t)," "),d(3),M(t.display_name),d(),E(t.username?10:-1),d(2),I("bg-blue-500/20",t.contact_type==="user")("text-blue-400",t.contact_type==="user")("bg-green-500/20",t.contact_type==="group")("text-green-400",t.contact_type==="group")("bg-purple-500/20",t.contact_type==="channel")("text-purple-400",t.contact_type==="channel"),d(),A(" ",n.getTypeLabel(t.contact_type)," "),d(4),M(n.getSourceIcon(t.source_type)),d(),he(n.getSourceColor(t.source_type)),d(),A(" ",n.getSourceLabel(t.source_type)," "),d(),E(t.source_name?20:-1),d(3),H(t.tags.slice(0,2)),d(2),E(t.tags.length>2?25:-1),d(2),he(n.contactsService.getStatusColor(t.status)),I("text-white",!0),d(),A(" ",n.contactsService.getStatusLabel(t.status)," "),d(4),j("width",t.ai_score*100,"%"),d(2),M((t.ai_score*100).toFixed(0)),d(3),E(t.contact_type==="user"?37:-1)}}function Db(i,e){if(i&1){let t=T();s(0,"div",59)(1,"table",60)(2,"thead",61)(3,"tr",62)(4,"th",63)(5,"input",64),b("change",function(){v(t);let o=f();return x(o.contactsService.toggleSelectAll())}),a()(),s(6,"th",65),l(7,"\u540D\u7A31"),a(),s(8,"th",65),l(9,"\u985E\u578B"),a(),s(10,"th",65),l(11,"\u4F86\u6E90"),a(),s(12,"th",65),l(13,"\u6A19\u7C64"),a(),s(14,"th",65),l(15,"\u72C0\u614B"),a(),s(16,"th",65),l(17,"\u8A55\u5206"),a(),s(18,"th",65),l(19,"\u64CD\u4F5C"),a()()(),s(20,"tbody"),$(21,Ab,45,32,"tr",66,pb),a()()(),s(23,"div",67)(24,"div"),l(25),a(),s(26,"div",68)(27,"button",69),b("click",function(){v(t);let o=f();return x(o.prevPage())}),l(28," \u4E0A\u4E00\u9801 "),a(),s(29,"span",70),l(30),a(),s(31,"button",69),b("click",function(){v(t);let o=f();return x(o.nextPage())}),l(32," \u4E0B\u4E00\u9801 "),a()()()}if(i&2){let t=f();d(5),V("checked",t.isAllSelected()),d(16),H(t.contactsService.contacts()),d(4),Y(" \u986F\u793A ",t.contactsService.contacts().length," / ",t.contactsService.total()," \u689D "),d(2),V("disabled",t.currentPage()<=1),d(3),A("\u7B2C ",t.currentPage()," \u9801"),d(),V("disabled",!t.hasNextPage())}}function Mb(i,e){if(i&1){let t=T();s(0,"label",95)(1,"input",64),b("change",function(){let o=v(t).$implicit,r=f(2);return x(r.toggleBatchTag(o))}),a(),s(2,"span",99),l(3),a()()}if(i&2){let t=e.$implicit,n=f(2);d(),V("checked",n.selectedBatchTags().has(t)),d(2),M(t)}}function Tb(i,e){if(i&1){let t=T();s(0,"div",44)(1,"div",92)(2,"h3",93),l(3,"\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64"),a(),s(4,"div",94),$(5,Mb,4,2,"label",95,ke),a(),s(7,"div",96)(8,"button",97),b("click",function(){v(t);let o=f();return x(o.showBatchTagDialog.set(!1))}),l(9," \u53D6\u6D88 "),a(),s(10,"button",98),b("click",function(){v(t);let o=f();return x(o.applyBatchTags())}),l(11," \u61C9\u7528 "),a()()()()}if(i&2){let t=f();d(5),H(t.defaultTags)}}function Ib(i,e){if(i&1){let t=T();s(0,"button",103),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.applyBatchStatus(o.value))}),k(1,"span",104),s(2,"span",99),l(3),a()()}if(i&2){let t=e.$implicit;d(),he(t.color),d(2),M(t.label)}}function kb(i,e){if(i&1){let t=T();s(0,"div",44)(1,"div",92)(2,"h3",93),l(3,"\u66F4\u65B0\u72C0\u614B"),a(),s(4,"div",100),$(5,Ib,4,3,"button",101,Gc),a(),s(7,"button",102),b("click",function(){v(t);let o=f();return x(o.showBatchStatusDialog.set(!1))}),l(8," \u53D6\u6D88 "),a()()()}if(i&2){let t=f();d(5),H(t.statusOptions)}}function Pb(i,e){if(i&1){let t=T();s(0,"div",44)(1,"div",92)(2,"h3",105),l(3,"\u26A0\uFE0F \u78BA\u8A8D\u522A\u9664"),a(),s(4,"p",106),l(5),a(),s(6,"div",107)(7,"button",97),b("click",function(){v(t);let o=f();return x(o.showDeleteConfirm.set(!1))}),l(8," \u53D6\u6D88 "),a(),s(9,"button",108),b("click",function(){v(t);let o=f();return x(o.confirmDelete())}),l(10," \u78BA\u8A8D\u522A\u9664 "),a()()()()}if(i&2){let t=f();d(5),A(" \u78BA\u5B9A\u8981\u522A\u9664\u9078\u4E2D\u7684 ",t.contactsService.selectedIds().size," \u500B\u806F\u7E6B\u4EBA\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002 ")}}var yo=class i{constructor(){this.contactsService=B(zn);this.toast=B(me);this.nav=B(Qt);this.sendMessageEvent=Ee();this.viewDetailEvent=Ee();this.batchSendEvent=Ee();this.sendToAISalesEvent=Ee();this.statusChangedEvent=Ee();this.refreshDataEvent=Ee();this.tabs=[{id:"all",icon:"\u{1F4CA}",label:"\u5168\u90E8"},{id:"users",icon:"\u{1F464}",label:"\u6210\u54E1"},{id:"groups",icon:"\u{1F465}",label:"\u7FA4\u7D44"},{id:"channels",icon:"\u{1F4E2}",label:"\u983B\u9053"}];this.statusOptions=Ws;this.defaultTags=zs;this.activeTab=C("all");this.selectedStatus="";this.selectedTag="";this.searchKeyword="";this.pageSize=50;this.currentPage=C(1);this.showImportDialog=C(!1);this.showBatchTagDialog=C(!1);this.showBatchStatusDialog=C(!1);this.showDeleteConfirm=C(!1);this.selectedBatchTags=C(new Set)}ngOnInit(){console.log("[ResourceCenter] Initialized, using imported leads data"),console.log("[ResourceCenter] Current contacts:",this.contactsService.contacts().length),console.log("[ResourceCenter] Has imported data:",this.contactsService.hasData())}ngOnDestroy(){this.contactsService.forceEndSync()}forceEndSync(){this.contactsService.forceEndSync(),this.toast.info("\u5DF2\u53D6\u6D88",1500)}switchTab(e){this.activeTab.set(e);let t;switch(e){case"users":t="user";break;case"groups":t="group";break;case"channels":t="channel";break;default:t=void 0}this.contactsService.setFilter({contactType:t,offset:0}),this.currentPage.set(1)}syncData(){if(console.log("[ResourceCenter] ========== SYNC DATA CLICKED =========="),this.contactsService.isSyncing()){console.log("[ResourceCenter] Already syncing, skip"),this.toast.warning("\u6B63\u5728\u540C\u6B65\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}console.log("[ResourceCenter] Calling syncFromSources()..."),this.contactsService.syncFromSources(),this.toast.info("\u{1F504} \u6B63\u5728\u540C\u6B65\u6578\u64DA\uFF0C\u8ACB\u7A0D\u5019...",5e3),this.refreshDataEvent.emit()}search(){this.contactsService.search(this.searchKeyword),this.currentPage.set(1)}filterByStatus(e){this.contactsService.setFilter({status:e||void 0,offset:0}),this.currentPage.set(1)}filterByTag(e){this.contactsService.setFilter({tags:e?[e]:void 0,offset:0}),this.currentPage.set(1)}resetFilters(){this.selectedStatus="",this.selectedTag="",this.searchKeyword="",this.activeTab.set("all"),this.contactsService.resetFilter(),this.currentPage.set(1)}hasNextPage(){return this.currentPage()*this.pageSize<this.contactsService.total()}prevPage(){this.currentPage()>1&&(this.currentPage.update(e=>e-1),this.contactsService.setPage(this.currentPage(),this.pageSize))}nextPage(){this.hasNextPage()&&(this.currentPage.update(e=>e+1),this.contactsService.setPage(this.currentPage(),this.pageSize))}isAllSelected(){let e=this.contactsService.contacts(),t=this.contactsService.selectedIds();return e.length>0&&e.every(n=>t.has(n.telegram_id))}sendMessage(e){this.sendMessageEvent.emit(e)}viewDetail(e){this.viewDetailEvent.emit(e)}editContact(e){this.toast.info("\u7DE8\u8F2F\u529F\u80FD\u958B\u767C\u4E2D...",2e3)}batchSendMessage(){let t=this.contactsService.selectedContacts().filter(n=>n.contact_type==="user");if(t.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u7528\u6236",2e3);return}this.batchSendEvent.emit(t),this.toast.info(`\u6E96\u5099\u5411 ${t.length} \u500B\u7528\u6236\u767C\u9001\u6D88\u606F...`,2e3)}sendToAISales(){let e=this.contactsService.selectedContacts();if(e.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u806F\u7E6B\u4EBA",2e3);return}this.sendToAISalesEvent.emit(e),this.toast.success(`\u5DF2\u5C07 ${e.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165\u767C\u9001\u968A\u5217`,2e3),this.contactsService.clearSelection()}goToSendConsole(){this.nav.navigateTo("leads")}toggleBatchTag(e){let t=new Set(this.selectedBatchTags());t.has(e)?t.delete(e):t.add(e),this.selectedBatchTags.set(t)}applyBatchTags(){let e=Array.from(this.selectedBatchTags());if(e.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u6A19\u7C64",2e3);return}this.contactsService.addTagsToSelected(e),this.showBatchTagDialog.set(!1),this.selectedBatchTags.set(new Set),this.toast.success("\u6A19\u7C64\u5DF2\u6DFB\u52A0",2e3)}applyBatchStatus(e){let t=this.contactsService.selectedContacts();this.contactsService.updateSelectedStatus(e),this.showBatchStatusDialog.set(!1),this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0",2e3),t.length>0&&this.statusChangedEvent.emit({contacts:t,status:e})}confirmBatchDelete(){this.showDeleteConfirm.set(!0)}confirmDelete(){this.contactsService.deleteSelected(),this.showDeleteConfirm.set(!1),this.toast.success("\u5DF2\u522A\u9664",2e3)}exportData(){this.toast.info("\u5C0E\u51FA\u529F\u80FD\u958B\u767C\u4E2D...",2e3)}getInitial(e){return e.display_name?e.display_name.charAt(0).toUpperCase():"?"}getTypeLabel(e){switch(e){case"user":return"\u6210\u54E1";case"group":return"\u7FA4\u7D44";case"channel":return"\u983B\u9053";default:return e}}getSourceLabel(e){switch(e){case"member":return"\u7FA4\u7D44\u63D0\u53D6";case"resource":return"\u8CC7\u6E90\u767C\u73FE";case"lead":return"\u71DF\u92B7\u6F0F\u6597";case"manual":return"\u624B\u52D5\u6DFB\u52A0";case"import":return"\u6279\u91CF\u5C0E\u5165";default:return e||"\u672A\u77E5"}}getSourceIcon(e){switch(e){case"member":return"\u{1F465}";case"resource":return"\u{1F50D}";case"lead":return"\u{1F3AF}";case"manual":return"\u270B";case"import":return"\u{1F4E5}";default:return"\u{1F4CB}"}}getSourceColor(e){switch(e){case"member":return"text-blue-400 bg-blue-500/20";case"resource":return"text-green-400 bg-green-500/20";case"lead":return"text-orange-400 bg-orange-500/20";case"manual":return"text-purple-400 bg-purple-500/20";case"import":return"text-cyan-400 bg-cyan-500/20";default:return"text-slate-400 bg-slate-500/20"}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-resource-center"]],outputs:{sendMessageEvent:"sendMessageEvent",viewDetailEvent:"viewDetailEvent",batchSendEvent:"batchSendEvent",sendToAISalesEvent:"sendToAISalesEvent",statusChangedEvent:"statusChangedEvent",refreshDataEvent:"refreshDataEvent"},decls:92,vars:14,consts:[[1,"resource-center","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],["title","\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65",1,"flex","items-center","gap-2","px-3","py-1","bg-blue-500/20","text-blue-400","rounded-full","text-sm","cursor-pointer","hover:bg-blue-500/30"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-lg","hover:from-cyan-600","hover:to-blue-600","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-blue-500/20","text-blue-400","rounded-lg","hover:bg-blue-500/30","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"p-4","border-b","border-slate-700/30"],[1,"grid","grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-slate-800/80","to-slate-800/40","rounded-xl","p-4","border","border-slate-700/50"],[1,"text-slate-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"text-4xl","opacity-20"],[1,"bg-gradient-to-br","from-emerald-900/30","to-slate-800/40","rounded-xl","p-4","border","border-emerald-700/30"],[1,"text-emerald-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"bg-gradient-to-br","from-blue-900/30","to-slate-800/40","rounded-xl","p-4","border","border-blue-700/30"],[1,"text-blue-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-blue-400"],[1,"bg-gradient-to-br","from-yellow-900/30","to-slate-800/40","rounded-xl","p-4","border","border-yellow-700/30"],[1,"text-yellow-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-yellow-400"],[1,"flex","items-center","gap-4","flex-wrap"],[1,"flex","bg-slate-800/50","rounded-lg","p-1"],[1,"px-4","py-2","rounded-md","text-sm","transition-all",3,"bg-purple-500","text-white","text-slate-400","hover:text-white"],[1,"px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","text-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"flex-1","max-w-md"],[1,"relative"],["type","text","placeholder","\u641C\u7D22\u540D\u7A31\u3001\u7528\u6236\u540D\u6216 ID...",1,"w-full","px-4","py-2","pl-10","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","keyup.enter","ngModel"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"absolute","left-3","top-1/2","-translate-y-1/2","h-4","w-4","text-slate-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors",3,"click"],[1,"p-3","bg-purple-500/10","border-b","border-purple-500/30","flex","items-center","gap-4"],[1,"flex-1","overflow-y-auto","p-4"],[1,"flex","items-center","justify-center","h-64"],[1,"flex","flex-col","items-center","justify-center","h-64","text-slate-400"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],["title","\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65",1,"flex","items-center","gap-2","px-3","py-1","bg-blue-500/20","text-blue-400","rounded-full","text-sm","cursor-pointer","hover:bg-blue-500/30",3,"click"],[1,"animate-spin","h-4","w-4","border-2","border-blue-400","border-t-transparent","rounded-full"],[1,"px-4","py-2","rounded-md","text-sm","transition-all",3,"click"],[1,"text-purple-400","text-sm"],[1,"px-3","py-1.5","bg-blue-500/20","text-blue-400","rounded-lg","text-sm","hover:bg-blue-500/30",3,"click"],[1,"px-3","py-1.5","bg-green-500/20","text-green-400","rounded-lg","text-sm","hover:bg-green-500/30",3,"click"],[1,"px-3","py-1.5","bg-purple-500/20","text-purple-400","rounded-lg","text-sm","hover:bg-purple-500/30",3,"click"],[1,"px-3","py-1.5","bg-cyan-500/20","text-cyan-400","rounded-lg","text-sm","hover:bg-cyan-500/30","flex","items-center","gap-1",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","text-red-400","rounded-lg","text-sm","hover:bg-red-500/30",3,"click"],[1,"ml-auto","px-3","py-1.5","text-slate-400","text-sm","hover:text-white",3,"click"],[1,"animate-spin","rounded-full","h-12","w-12","border-t-2","border-b-2","border-purple-500"],[1,"text-5xl","mb-4"],[1,"text-lg","mb-2"],[1,"text-sm","mb-4"],[1,"bg-slate-800/30","rounded-xl","border","border-slate-700/50","overflow-hidden"],[1,"w-full"],[1,"bg-slate-800/50"],[1,"text-left","text-slate-400","text-sm"],[1,"p-3","w-12"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600",3,"change","checked"],[1,"p-3"],[1,"border-t","border-slate-700/30","hover:bg-slate-800/30","transition-colors"],[1,"flex","items-center","justify-between","mt-4","text-slate-400","text-sm"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-slate-800","rounded-lg","hover:bg-slate-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-white","font-bold"],[1,"font-medium","text-white"],[1,"text-sm","text-slate-400"],[1,"px-2","py-1","rounded-full","text-xs"],[1,"flex","items-center","gap-1"],[1,"text-sm"],[1,"text-sm","px-1.5","py-0.5","rounded"],[1,"text-xs","text-slate-500","truncate","max-w-32","mt-0.5"],[1,"flex","flex-wrap","gap-1"],[1,"px-2","py-0.5","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-0.5","bg-slate-700","text-slate-400","rounded","text-xs"],[1,"w-16","bg-slate-700","rounded-full","h-2"],[1,"bg-gradient-to-r","from-purple-500","to-pink-500","h-2","rounded-full"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","text-blue-400","hover:bg-blue-500/20","rounded-lg","transition-colors"],["title","\u67E5\u770B\u8A73\u60C5",1,"p-2","text-slate-400","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["title","\u7DE8\u8F2F",1,"p-2","text-slate-400","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","text-blue-400","hover:bg-blue-500/20","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-md","p-6","shadow-xl","border","border-slate-700"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"space-y-3","max-h-64","overflow-y-auto"],[1,"flex","items-center","gap-3","p-2","hover:bg-slate-700/50","rounded-lg","cursor-pointer"],[1,"flex","gap-3","mt-6"],[1,"flex-1","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],[1,"flex-1","py-2.5","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400",3,"click"],[1,"text-white"],[1,"space-y-2"],[1,"w-full","p-3","text-left","rounded-lg","hover:bg-slate-700/50","flex","items-center","gap-3"],[1,"w-full","mt-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],[1,"w-full","p-3","text-left","rounded-lg","hover:bg-slate-700/50","flex","items-center","gap-3",3,"click"],[1,"w-3","h-3","rounded-full"],[1,"text-xl","font-bold","text-red-400","mb-4"],[1,"text-slate-300","mb-6"],[1,"flex","gap-3"],[1,"flex-1","py-2.5","bg-red-500","text-white","rounded-lg","hover:bg-red-400",3,"click"]],template:function(t,n){if(t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u{1F4E6}"),a(),l(7," \u8CC7\u6E90\u4E2D\u5FC3 "),a(),w(8,gb,3,0,"span",6),a(),s(9,"div",7)(10,"button",8),b("click",function(){return n.goToSendConsole()}),s(11,"span"),l(12,"\u{1F4E4}"),a(),l(13," \u767C\u9001\u63A7\u5236\u53F0 "),a(),s(14,"button",9),b("click",function(){return n.syncData()}),te(),s(15,"svg",10),k(16,"path",11),a(),l(17," \u540C\u6B65\u6578\u64DA "),a(),le(),s(18,"button",12),b("click",function(){return n.showImportDialog.set(!0)}),l(19," \u5C0E\u5165 "),a(),s(20,"button",12),b("click",function(){return n.exportData()}),l(21," \u5C0E\u51FA "),a()()()(),s(22,"div",13)(23,"div",14)(24,"div",15)(25,"div",2)(26,"div")(27,"div",16),l(28,"\u{1F4CA} \u7E3D\u8CC7\u6E90"),a(),s(29,"div",17),l(30),a()(),s(31,"div",18),l(32,"\u{1F4E6}"),a()()(),s(33,"div",19)(34,"div",2)(35,"div")(36,"div",20),l(37,"\u{1F195} \u672C\u9031\u65B0\u589E"),a(),s(38,"div",21),l(39),a()(),s(40,"div",18),l(41,"\u{1F4C8}"),a()()(),s(42,"div",22)(43,"div",2)(44,"div")(45,"div",23),l(46,"\u{1F514} \u5F85\u8DDF\u9032"),a(),s(47,"div",24),l(48),a()(),s(49,"div",18),l(50,"\u{1F44B}"),a()()(),s(51,"div",25)(52,"div",2)(53,"div")(54,"div",26),l(55,"\u{1F4AC} \u5DF2\u806F\u7E6B"),a(),s(56,"div",27),l(57),a()(),s(58,"div",18),l(59,"\u2709\uFE0F"),a()()()()(),s(60,"div",13)(61,"div",28)(62,"div",29),$(63,hb,2,10,"button",30,mb),a(),s(65,"select",31),W("ngModelChange",function(r){return z(n.selectedStatus,r)||(n.selectedStatus=r),r}),b("ngModelChange",function(r){return n.filterByStatus(r)}),s(66,"option",32),l(67,"\u6240\u6709\u72C0\u614B"),a(),$(68,fb,2,2,"option",33,Gc),a(),s(70,"select",31),W("ngModelChange",function(r){return z(n.selectedTag,r)||(n.selectedTag=r),r}),b("ngModelChange",function(r){return n.filterByTag(r)}),s(71,"option",32),l(72,"\u6240\u6709\u6A19\u7C64"),a(),$(73,_b,2,2,"option",33,ke),a(),s(75,"div",34)(76,"div",35)(77,"input",36),W("ngModelChange",function(r){return z(n.searchKeyword,r)||(n.searchKeyword=r),r}),b("keyup.enter",function(){return n.search()}),a(),te(),s(78,"svg",37),k(79,"path",38),a()()(),le(),s(80,"button",39),b("click",function(){return n.search()}),l(81," \u641C\u7D22 "),a(),s(82,"button",12),b("click",function(){return n.resetFilters()}),l(83," \u91CD\u7F6E "),a()()(),w(84,Cb,17,1,"div",40),s(85,"div",41),w(86,vb,2,0,"div",42)(87,xb,9,0,"div",43)(88,Db,33,6),a(),w(89,Tb,12,0,"div",44),w(90,kb,9,0,"div",44),w(91,Pb,11,1,"div",44),a()),t&2){let o,r;d(8),E(n.contactsService.isSyncing()?8:-1),d(6),V("disabled",n.contactsService.isSyncing()),d(16),M(n.contactsService.stats().total),d(9),A("+",n.contactsService.stats().recent_added),d(9),M(((o=n.contactsService.stats().by_status)==null?null:o.new)||0),d(9),M(((r=n.contactsService.stats().by_status)==null?null:r.contacted)||0),d(6),H(n.tabs),d(2),K("ngModel",n.selectedStatus),d(3),H(n.statusOptions),d(2),K("ngModel",n.selectedTag),d(3),H(n.defaultTags),d(4),K("ngModel",n.searchKeyword),d(7),E(n.contactsService.selectedIds().size>0?84:-1),d(2),E(n.contactsService.isLoading()?86:n.contactsService.contacts().length===0?87:88),d(3),E(n.showBatchTagDialog()?89:-1),d(),E(n.showBatchStatusDialog()?90:-1),d(),E(n.showDeleteConfirm()?91:-1)}},dependencies:[oe,ue,He,Ke,xe,nt,fe,_e],styles:[".resource-center[_ngcontent-%COMP%]{min-height:100vh}"]})}};var Fb=`\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u7CBE\u901A\u5404\u884C\u696D\u7684\u5BA2\u6236\u7372\u53D6\u548C\u71DF\u92B7\u8A71\u8853\u3002

\u7528\u6236\u9700\u6C42\uFF1A{USER_INPUT}

\u8ACB\u6839\u64DA\u7528\u6236\u9700\u6C42\uFF0C\u751F\u6210\u4E00\u4EFD\u5B8C\u6574\u7684\u71DF\u92B7\u7B56\u7565\u3002\u8FD4\u56DE\u7D14 JSON \u683C\u5F0F\uFF08\u4E0D\u8981 markdown \u4EE3\u78BC\u584A\uFF09\uFF1A

{
  "industry": "\u8B58\u5225\u7684\u76EE\u6A19\u884C\u696D",
  "targetAudience": "\u76EE\u6A19\u53D7\u773E\u63CF\u8FF0",
  "keywords": {
    "highIntent": ["\u9AD8\u610F\u5411\u95DC\u9375\u8A5E1", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E2", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E3"],
    "mediumIntent": ["\u4E2D\u610F\u5411\u95DC\u9375\u8A5E1", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E2", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E3"],
    "extended": ["\u64F4\u5C55\u95DC\u9375\u8A5E1", "\u64F4\u5C55\u95DC\u9375\u8A5E2", "\u64F4\u5C55\u95DC\u9375\u8A5E3"]
  },
  "customerProfile": {
    "identity": ["\u8EAB\u4EFD\u7279\u5FB51", "\u8EAB\u4EFD\u7279\u5FB52", "\u8EAB\u4EFD\u7279\u5FB53"],
    "features": ["\u884C\u70BA\u7279\u5FB51", "\u884C\u70BA\u7279\u5FB52", "\u884C\u70BA\u7279\u5FB53"],
    "needs": ["\u6838\u5FC3\u9700\u6C421", "\u6838\u5FC3\u9700\u6C422", "\u6838\u5FC3\u9700\u6C423"]
  },
  "recommendedGroups": ["\u63A8\u85A6\u641C\u7D22\u7684\u7FA4\u7D44\u985E\u578B1", "\u63A8\u85A6\u7FA4\u7D44\u985E\u578B2"],
  "messageTemplates": {
    "firstTouch": "\u9996\u6B21\u89F8\u9054\u6D88\u606F\u6A21\u677F\uFF08\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF09",
    "followUp": "\u8DDF\u9032\u6D88\u606F\u6A21\u677F",
    "closing": "\u4FC3\u6210\u8F49\u5316\u6D88\u606F\u6A21\u677F"
  },
  "automationSettings": {
    "monitorMode": "24/7 \u5168\u5929\u5019",
    "responseDelay": 30,
    "followUpInterval": 7200
  }
}

\u8981\u6C42\uFF1A
1. \u95DC\u9375\u8A5E\u8981\u7CBE\u6E96\uFF0C\u8986\u84CB\u884C\u696D\u5E38\u7528\u8853\u8A9E\u548C\u641C\u7D22\u8A5E
2. \u6D88\u606F\u6A21\u677F\u8981\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF0C\u907F\u514D\u6A5F\u5668\u4EBA\u611F
3. \u5BA2\u6236\u756B\u50CF\u8981\u5177\u9AD4\uFF0C\u4FBF\u65BC\u8B58\u5225\u76EE\u6A19\u5BA2\u6236
4. \u53EA\u8FD4\u56DE JSON\uFF0C\u4E0D\u8981\u4EFB\u4F55\u5176\u4ED6\u89E3\u91CB`,wo=class i{constructor(){this.aiProviderService=B(Ea);this.aiCenterService=B(ha);this.toastService=B(me);this.ipcService=B(De);this._availableModels=C([]);this.availableModels=this._availableModels.asReadonly();this._selectedModelId=C("local-ollama");this.selectedModelId=this._selectedModelId.asReadonly();this._localAIConfig=C({endpoint:"https://ms-defysomwqybz.tail05a567.ts.net/api/chat",model:"huihui_ai/qwen2.5-abliterate",isConnected:!1,lastChecked:""});this.localAIConfig=this._localAIConfig.asReadonly();this._generationStatus=C({isGenerating:!1,currentProvider:"",progress:0,message:""});this.generationStatus=this._generationStatus.asReadonly();this._savedStrategies=C([]);this.savedStrategies=this._savedStrategies.asReadonly();this._currentStrategy=C(null);this.currentStrategy=this._currentStrategy.asReadonly();this.selectedModel=L(()=>this._availableModels().find(e=>e.id===this._selectedModelId()));this.loadConfig(),this.refreshAvailableModels()}async refreshAvailableModels(){let e=[],t=this.aiCenterService.models(),n=t.filter(m=>m.isLocal);if(n.length>0)for(let m of n)e.push({id:m.id,name:m.displayName||m.modelName,provider:"Ollama (\u672C\u5730)",icon:"\u{1F999}",isLocal:!0,isConnected:m.isConnected,endpoint:m.apiEndpoint}),m.apiEndpoint&&this._localAIConfig.update(h=>N(F({},h),{endpoint:m.apiEndpoint,model:m.modelName,isConnected:m.isConnected}));else{let m=this._localAIConfig();e.push({id:"local-ollama",name:`\u672C\u5730 AI (${m.model})`,provider:"Ollama (Tailscale)",icon:"\u{1F999}",isLocal:!0,isConnected:m.isConnected,endpoint:m.endpoint})}let o=t.filter(m=>!m.isLocal);for(let m of o){let h=this.getProviderInfo(m.provider),g=this.getModelCapability(m.modelName);e.push({id:m.id,name:m.displayName||m.modelName,provider:h.name,icon:h.icon,isLocal:!1,isConnected:m.isConnected,capability:g})}e.length===0&&console.log("[AIStrategy] \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B\uFF0C\u8ACB\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E"),e.sort((m,h)=>m.isConnected&&!h.isConnected?-1:!m.isConnected&&h.isConnected?1:m.isLocal&&!h.isLocal?-1:0),this._availableModels.set(e);let r=this._selectedModelId();if(!e.map(m=>m.id).includes(r)){let m=e.find(h=>h.isConnected);m?this._selectedModelId.set(m.id):e.length>0&&this._selectedModelId.set(e[0].id)}}selectModel(e){this._selectedModelId.set(e),this.saveConfig()}updateLocalAIConfig(e){this._localAIConfig.update(t=>F(F({},t),e)),this.saveConfig(),this.refreshAvailableModels()}async testLocalAIConnection(){let e=this._localAIConfig();try{this._generationStatus.set({isGenerating:!0,currentProvider:"\u672C\u5730 Ollama",progress:50,message:"\u6B63\u5728\u6E2C\u8A66\u9023\u63A5..."});let t=await fetch(e.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e.model,messages:[{role:"user",content:"Hi, please respond with OK."}],stream:!1,options:{temperature:.1,num_predict:10}}),signal:AbortSignal.timeout(1e4)});if(t.ok&&(await t.json()).message?.content)return this._localAIConfig.update(o=>N(F({},o),{isConnected:!0,lastChecked:new Date().toISOString()})),this.refreshAvailableModels(),this.toastService.success("\u672C\u5730 AI \u9023\u63A5\u6210\u529F\uFF01"),!0;throw new Error("\u7121\u6548\u97FF\u61C9")}catch(t){return this._localAIConfig.update(n=>N(F({},n),{isConnected:!1,lastChecked:new Date().toISOString()})),this.refreshAvailableModels(),this.toastService.error(`\u672C\u5730 AI \u9023\u63A5\u5931\u6557: ${t.message}`),!1}finally{this._generationStatus.set({isGenerating:!1,currentProvider:"",progress:0,message:""})}}async generateStrategy(e){let t=Fb.replace("{USER_INPUT}",e),n=[{role:"system",content:"\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u53EA\u8FD4\u56DE JSON \u683C\u5F0F\u7684\u7B56\u7565\u5206\u6790\u7D50\u679C\u3002"},{role:"user",content:t}],o=this.selectedModel(),r=o?.name||"\u672C\u5730 AI",c=o?.isLocal??!0;if(console.log(`[AIStrategy] \u4F7F\u7528\u6A21\u578B: ${r}, isLocal: ${c}`),c){this._generationStatus.set({isGenerating:!0,currentProvider:r,progress:20,message:`\u6B63\u5728\u4F7F\u7528 ${r} \u5206\u6790...`});try{let h=await this.callLocalAI(n);if(h){let g=this.parseStrategyResponse(h);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:r,progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(h){console.warn(`[AIStrategy] ${r} \u5931\u6557:`,h.message),this.toastService.warning(`${r} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u96F2\u7AEF\u56DE\u9000...`)}this._generationStatus.set({isGenerating:!0,currentProvider:"\u96F2\u7AEF AI (\u56DE\u9000)",progress:50,message:"\u672C\u5730 AI \u4E0D\u53EF\u7528\uFF0C\u6B63\u5728\u4F7F\u7528\u96F2\u7AEF AI..."});try{let h=await this.callCloudAI(n);if(h){let g=this.parseStrategyResponse(h);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:"\u96F2\u7AEF AI",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(h){console.warn("[AIStrategy] \u96F2\u7AEF AI \u56DE\u9000\u5931\u6557:",h.message)}}else{this._generationStatus.set({isGenerating:!0,currentProvider:r,progress:30,message:`\u6B63\u5728\u4F7F\u7528 ${r} \u5206\u6790...`});try{let h=await this.callSelectedCloudModel(n,o);if(h){let g=this.parseStrategyResponse(h);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:r,progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(h){console.warn(`[AIStrategy] ${r} \u5931\u6557:`,h.message),this.toastService.warning(`${r} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u5176\u4ED6\u6A21\u578B...`)}this._generationStatus.set({isGenerating:!0,currentProvider:"\u5176\u4ED6\u96F2\u7AEF\u6A21\u578B",progress:60,message:"\u5617\u8A66\u5176\u4ED6\u53EF\u7528\u6A21\u578B..."});try{let h=await this.callCloudAI(n);if(h){let g=this.parseStrategyResponse(h);if(g)return this._generationStatus.set({isGenerating:!1,currentProvider:"\u96F2\u7AEF AI",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),g}}catch(h){console.warn("[AIStrategy] \u6240\u6709\u96F2\u7AEF AI \u5931\u6557:",h.message)}}this._generationStatus.set({isGenerating:!0,currentProvider:"\u6A21\u677F\u56DE\u9000",progress:80,message:"AI \u4E0D\u53EF\u7528\uFF0C\u4F7F\u7528\u667A\u80FD\u6A21\u677F..."});let m=this.generateFromTemplate(e);return this._generationStatus.set({isGenerating:!1,currentProvider:"\u6A21\u677F\u56DE\u9000",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF08\u6A21\u677F\u6A21\u5F0F\uFF09"}),m}async callLocalAI(e){let t=this._localAIConfig(),n=await fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t.model,messages:e,stream:!1,options:{temperature:.7,num_predict:2048,top_p:.9}}),signal:AbortSignal.timeout(3e4)});if(!n.ok)throw new Error(`\u672C\u5730 AI \u8ACB\u6C42\u5931\u6557: ${n.status}`);return(await n.json()).message?.content||null}async callCloudAI(e){try{console.log("[AIStrategy] \u5617\u8A66\u901A\u904E\u5F8C\u7AEF IPC \u8ABF\u7528 AI...");let r=await this.callAIViaBackend(e);if(r)return console.log("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u6210\u529F"),r}catch(r){console.warn("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u5931\u6557:",r)}let t=this.aiCenterService.models(),n=t.filter(r=>r.isConnected&&!r.isLocal),o=n.length>0?n:t.filter(r=>!r.isLocal&&r.apiKey);for(let r of o)try{console.log(`[AIStrategy] \u5617\u8A66\u96F2\u7AEF\u6A21\u578B: ${r.modelName}`),this.aiProviderService.setConfig({provider:r.provider,model:r.modelName,apiKey:r.apiKey,baseUrl:r.apiEndpoint});let c=await this.aiProviderService.chat(e);if(c.content)return c.content}catch(c){console.warn(`[AIStrategy] \u96F2\u7AEF\u6A21\u578B ${r.modelName} \u5931\u6557:`,c)}if(this.aiProviderService.isConnected())try{return(await this.aiProviderService.chat(e)).content}catch(r){console.warn("[AIStrategy] AIProviderService \u8ABF\u7528\u5931\u6557:",r)}return null}callAIViaBackend(e){return new Promise((t,n)=>{let o=setTimeout(()=>{this.ipcService.off("ai-response",r),n(new Error("\u5F8C\u7AEF AI \u8ABF\u7528\u8D85\u6642"))},6e4),r=g=>{clearTimeout(o),this.ipcService.off("ai-response",r),g.success&&g.response?t(g.response):g.error?n(new Error(g.error)):t(null)};this.ipcService.on("ai-response",r);let c=e.find(g=>g.role==="system"),m=e.find(g=>g.role==="user"),h=this._localAIConfig();this.ipcService.send("generate-ai-response",{userId:"strategy-generator",message:m?.content||"",systemPrompt:c?.content||"",localAiEndpoint:h.endpoint,localAiModel:h.model})})}async callSelectedCloudModel(e,t){let o=this.aiCenterService.models().find(c=>c.id===t.id);return o?!o.apiKey&&!o.isConnected?(console.warn(`[AIStrategy] \u6A21\u578B ${t.name} \u672A\u914D\u7F6E API Key`),this.toastService.error(`\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E ${t.name} \u7684 API Key`),null):(console.log(`[AIStrategy] \u8ABF\u7528\u9078\u5B9A\u6A21\u578B: ${o.modelName}, provider: ${o.provider}`),this.aiProviderService.setConfig({provider:o.provider,model:o.modelName,apiKey:o.apiKey,baseUrl:o.apiEndpoint}),(await this.aiProviderService.chat(e)).content):(console.warn(`[AIStrategy] \u627E\u4E0D\u5230\u6A21\u578B\u914D\u7F6E: ${t.id}`),null)}getLocalAIFromCenter(){let e=this.aiCenterService.models().filter(t=>t.isLocal);if(e.length>0){let t=e[0];return{endpoint:t.apiEndpoint||"",model:t.modelName}}return null}syncLocalAIFromCenter(){let e=this.getLocalAIFromCenter();e&&e.endpoint&&this._localAIConfig.update(t=>N(F({},t),{endpoint:e.endpoint,model:e.model}))}parseStrategyResponse(e){try{let t=e,n=e.match(/```(?:json)?\s*([\s\S]*?)```/);n&&(t=n[1]);let o=t.indexOf("{"),r=t.lastIndexOf("}");o!==-1&&r!==-1&&(t=t.slice(o,r+1));let c=JSON.parse(t);if(!c.industry||!c.keywords)throw new Error("\u7F3A\u5C11\u5FC5\u8981\u5B57\u6BB5");return{industry:c.industry||"\u672A\u8B58\u5225\u884C\u696D",targetAudience:c.targetAudience||"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4",keywords:{highIntent:c.keywords?.highIntent||[],mediumIntent:c.keywords?.mediumIntent||[],extended:c.keywords?.extended||[]},customerProfile:{identity:c.customerProfile?.identity||[],features:c.customerProfile?.features||[],needs:c.customerProfile?.needs||[]},recommendedGroups:c.recommendedGroups||[],messageTemplates:{firstTouch:c.messageTemplates?.firstTouch||"",followUp:c.messageTemplates?.followUp||"",closing:c.messageTemplates?.closing||""},automationSettings:{monitorMode:c.automationSettings?.monitorMode||"24/7 \u5168\u5929\u5019",responseDelay:c.automationSettings?.responseDelay||30,followUpInterval:c.automationSettings?.followUpInterval||7200}}}catch(t){return console.error("[AIStrategy] \u89E3\u6790 AI \u97FF\u61C9\u5931\u6557:",t,e),null}}generateFromTemplate(e){let t="\u901A\u7528\u884C\u696D",n={highIntent:["\u5408\u4F5C","\u4EE3\u7406","\u5C0D\u63A5"],mediumIntent:["\u8CC7\u6E90","\u6E20\u9053","\u696D\u52D9"],extended:["\u4EA4\u6D41","\u4E86\u89E3","\u54A8\u8A62"]};return e.includes("\u652F\u4ED8")||e.includes("\u63DB\u532F")||e.includes("\u8DD1\u5206")?(t="\u652F\u4ED8/\u63DB\u532F",n={highIntent:["\u652F\u4ED8\u901A\u9053","U\u5546","\u63DB\u532F","USDT","\u4EE3\u6536\u4EE3\u4ED8","\u8DD1\u5206"],mediumIntent:["\u56DB\u65B9\u652F\u4ED8","\u4E09\u65B9\u652F\u4ED8","API\u5C0D\u63A5","\u627F\u514C\u5546"],extended:["OTC","\u6536\u6B3E","\u51FA\u6B3E","\u8CBB\u7387","T+0","T+1"]}):e.includes("\u5E63")||e.includes("\u52A0\u5BC6")||e.includes("BTC")?(t="\u52A0\u5BC6\u8CA8\u5E63",n={highIntent:["BTC","ETH","\u5408\u7D04","\u73FE\u8CA8","\u4EA4\u6613\u6240"],mediumIntent:["DeFi","NFT","\u9322\u5305","\u516C\u93C8"],extended:["\u6316\u7926","\u8CEA\u62BC","\u7A7A\u6295","IDO"]}):(e.includes("\u96FB\u5546")||e.includes("\u8DE8\u5883")||e.includes("\u4E9E\u99AC\u905C"))&&(t="\u96FB\u5546/\u8DE8\u5883",n={highIntent:["\u4E9E\u99AC\u905C","\u7368\u7ACB\u7AD9","Shopify","\u7269\u6D41","\u9078\u54C1"],mediumIntent:["FBA","\u6D77\u5916\u5009","\u6E05\u95DC","\u652F\u4ED8"],extended:["\u6E2C\u8A55","\u5237\u55AE","\u7AD9\u5916\u63A8\u5EE3"]}),{industry:t,targetAudience:this.extractAudience(e),keywords:n,customerProfile:{identity:["\u4EE3\u7406\u5546","\u9805\u76EE\u65B9","\u904B\u71DF\u4EBA\u54E1"],features:["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44","\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F","\u6709\u660E\u78BA\u9700\u6C42"],needs:["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34","\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE","\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]},recommendedGroups:[`${t}\u4EA4\u6D41\u7FA4`,"\u696D\u52D9\u5C0D\u63A5\u7FA4","\u9805\u76EE\u5408\u4F5C\u7FA4"],messageTemplates:{firstTouch:`\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${t}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,followUp:"\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",closing:"\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"},automationSettings:{monitorMode:"24/7 \u5168\u5929\u5019",responseDelay:30,followUpInterval:7200}}}extractAudience(e){return e.includes("\u4EE3\u7406")?"\u4EE3\u7406\u5546/\u6E20\u9053\u5546":e.includes("\u5BA2\u6236")?"\u7D42\u7AEF\u5BA2\u6236":e.includes("\u9805\u76EE")?"\u9805\u76EE\u65B9/\u904B\u71DF\u5546":"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4"}getProviderInfo(e){switch(e){case"openai":return{name:"OpenAI",icon:"\u{1F916}"};case"claude":return{name:"Anthropic",icon:"\u{1F9E0}"};case"gemini":return{name:"Google",icon:"\u2728"};default:return{name:e,icon:"\u{1F527}"}}}getModelCapability(e){let t=e.toLowerCase();return t.includes("flash")||t.includes("mini")||t.includes("haiku")||t.includes("3.5-turbo")?"fast":t.includes("opus")||t.includes("pro")||t.includes("gpt-4o")||t.includes("ultra")?"powerful":t.includes("mini")||t.includes("nano")||t.includes("lite")?"economic":"balanced"}loadConfig(){try{let e=localStorage.getItem("ai-strategy-config");if(e){let t=JSON.parse(e);t.localAIConfig&&this._localAIConfig.set(t.localAIConfig),t.selectedModelId&&this._selectedModelId.set(t.selectedModelId)}this.loadSavedStrategies()}catch(e){console.error("Failed to load AI strategy config:",e)}}saveConfig(){try{localStorage.setItem("ai-strategy-config",JSON.stringify({localAIConfig:this._localAIConfig(),selectedModelId:this._selectedModelId()}))}catch(e){console.error("Failed to save AI strategy config:",e)}}loadSavedStrategies(){try{let e=localStorage.getItem("ai-saved-strategies");if(e){let t=JSON.parse(e);this._savedStrategies.set(t),console.log(`[AIStrategy] \u5DF2\u52A0\u8F09 ${t.length} \u500B\u4FDD\u5B58\u7684\u7B56\u7565`)}}catch(e){console.error("Failed to load saved strategies:",e)}}saveStrategy(e,t){let n={id:`strategy-${Date.now()}`,name:t||`${e.industry} - ${new Date().toLocaleDateString("zh-TW")}`,strategy:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usedCount:0},o=[...this._savedStrategies(),n];this._savedStrategies.set(o),this._currentStrategy.set(e);try{localStorage.setItem("ai-saved-strategies",JSON.stringify(o))}catch(r){console.error("Failed to save strategies:",r)}return this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01"),n}loadStrategy(e){let t=this._savedStrategies().find(n=>n.id===e);return t?(t.usedCount++,t.updatedAt=new Date().toISOString(),this._currentStrategy.set(t.strategy),this.persistStrategies(),t.strategy):null}deleteStrategy(e){let t=this._savedStrategies().filter(n=>n.id!==e);this._savedStrategies.set(t),this.persistStrategies(),this.toastService.success("\u7B56\u7565\u5DF2\u522A\u9664")}setCurrentStrategy(e){this._currentStrategy.set(e)}persistStrategies(){try{localStorage.setItem("ai-saved-strategies",JSON.stringify(this._savedStrategies()))}catch(e){console.error("Failed to persist strategies:",e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var ys=(i,e)=>e.id;function Rb(i,e){if(i&1&&(s(0,"span",18),l(1),a()),i&2){let t=f(2);d(),A(" ",t.connectedModelsCount()," \u500B\u5DF2\u9023\u63A5 ")}}function Nb(i,e){i&1&&(s(0,"span",19),l(1,"\u672A\u914D\u7F6E"),a())}function Bb(i,e){if(i&1){let t=T();s(0,"div",21)(1,"p",26),l(2,"\u26A0\uFE0F \u5C1A\u672A\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B"),a(),s(3,"p",27),l(4,"\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E\u4E26\u6E2C\u8A66 AI \u6A21\u578B"),a(),s(5,"button",28),b("click",function(){v(t);let o=f(2);return x(o.goToAICenter())}),l(6," \u{1F680} \u524D\u5F80\u914D\u7F6E AI "),a()()}}function Vb(i,e){if(i&1&&(s(0,"span",38),l(1),a()),i&2){let t=f().$implicit,n=f(4);he(n.getCapabilityStyle(t.capability)),d(),A(" ",n.getCapabilityLabel(t.capability)," ")}}function Lb(i,e){if(i&1){let t=T();s(0,"button",35),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.selectModel(o.id))}),s(1,"span"),l(2),a(),s(3,"span"),l(4),a(),w(5,Vb,2,3,"span",36),k(6,"span",37),a()}if(i&2){let t=e.$implicit,n=f(4);he(n.selectedModelId()===t.id?"bg-emerald-500/30 text-emerald-400 border-2 border-emerald-500/50 shadow-lg shadow-emerald-500/20":"bg-slate-700/50 text-slate-300 border border-slate-600 hover:bg-slate-600/50 hover:border-emerald-500/30"),d(2),M(t.icon),d(2),M(t.name),d(),E(t.capability?5:-1)}}function Ob(i,e){if(i&1&&(s(0,"div")(1,"p",31),k(2,"span",32),l(3," \u53EF\u7528\u6A21\u578B "),a(),s(4,"div",33),$(5,Lb,7,5,"button",34,ys),a()()),i&2){let t=f(3);d(5),H(t.connectedModels())}}function Gb(i,e){if(i&1){let t=T();s(0,"button",41),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.selectModel(o.id))}),s(1,"span"),l(2),a(),s(3,"span"),l(4),a(),s(5,"span",42),l(6,"\u672A\u6E2C\u8A66"),a()()}if(i&2){let t=e.$implicit,n=f(4);he(n.selectedModelId()===t.id?"bg-slate-600/50 text-slate-300 border border-slate-500":"bg-slate-800/50 text-slate-500 border border-slate-700 hover:opacity-80"),d(2),M(t.icon),d(2),M(t.name)}}function Ub(i,e){if(i&1&&(s(0,"div")(1,"p",31),k(2,"span",39),l(3," \u672A\u9023\u63A5\uFF08\u9700\u8981\u6E2C\u8A66\uFF09 "),a(),s(4,"div",33),$(5,Gb,7,4,"button",40,ys),a()()),i&2){let t=f(3);d(5),H(t.disconnectedModels())}}function qb(i,e){i&1&&(s(0,"p",30),l(1," \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI\uFF08\u514D\u8CBB\u7121\u9650\uFF09\uFF0C\u96F2\u7AEF AI \u6309\u4F7F\u7528\u91CF\u8A08\u8CBB "),a())}function $b(i,e){if(i&1&&(s(0,"div",29),w(1,Ob,7,0,"div"),w(2,Ub,7,0,"div"),a(),w(3,qb,2,0,"p",30)),i&2){let t=f(2);d(),E(t.connectedModels().length>0?1:-1),d(),E(t.disconnectedModels().length>0?2:-1),d(),E(t.connectedModels().length>0?3:-1)}}function Hb(i,e){i&1&&(s(0,"span",45),l(1,"\u2713 \u5DF2\u9023\u63A5"),a())}function Kb(i,e){i&1&&(s(0,"span",46),l(1,"\u672A\u9023\u63A5"),a())}function zb(i,e){i&1&&k(0,"span",60)}function Wb(i,e){i&1&&(s(0,"span",42),l(1,"\u672A\u914D\u7F6E"),a())}function Jb(i,e){if(i&1){let t=T();s(0,"div",55),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.selectModel(o.id))}),s(1,"div",56)(2,"span",57),l(3),a(),s(4,"div",58)(5,"div",59),l(6),a(),s(7,"div",42),l(8),a()(),w(9,zb,1,0,"span",60)(10,Wb,2,0,"span",42),a()()}if(i&2){let t=e.$implicit,n=f(3);he(n.selectedModelId()===t.id?"bg-purple-500/20 border-purple-500/50":"bg-slate-800/50 border-slate-700 hover:border-slate-500"),d(3),M(t.icon),d(3),M(t.name),d(2),M(t.provider),d(),E(t.isConnected?9:t.isLocal?-1:10)}}function Qb(i,e){if(i&1){let t=T();s(0,"div",22)(1,"div",43)(2,"h4",44),l(3," \u{1F999} \u672C\u5730 Ollama \u914D\u7F6E "),w(4,Hb,2,0,"span",45)(5,Kb,2,0,"span",46),a(),s(6,"div",47)(7,"div")(8,"label",48),l(9,"API \u7AEF\u9EDE"),a(),s(10,"input",49),b("change",function(o){v(t);let r=f(2);return x(r.updateLocalEndpoint(o.target.value))}),a()(),s(11,"div")(12,"label",48),l(13,"\u6A21\u578B\u540D\u7A31"),a(),s(14,"input",50),b("change",function(o){v(t);let r=f(2);return x(r.updateLocalModel(o.target.value))}),a()()(),s(15,"button",51),b("click",function(){v(t);let o=f(2);return x(o.testLocalAI())}),l(16," \u{1F517} \u6E2C\u8A66\u9023\u63A5 "),a()(),s(17,"div")(18,"h4",52),l(19,"\u53EF\u7528\u6A21\u578B"),a(),s(20,"div",53),$(21,Jb,11,6,"div",54,ys),a()(),s(23,"p",42),l(24," \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI (\u514D\u8CBB\u3001\u96B1\u79C1)\uFF0C\u672C\u5730\u4E0D\u53EF\u7528\u6642\u81EA\u52D5\u5207\u63DB\u5230\u96F2\u7AEF AI "),a()()}if(i&2){let t=f(2);d(4),E(t.localAIConfig().isConnected?4:5),d(6),V("value",t.localAIConfig().endpoint),d(4),V("value",t.localAIConfig().model),d(7),H(t.availableModels())}}function Yb(i,e){i&1&&(s(0,"span",61),l(1,"\u27F3"),a(),l(2," AI \u5206\u6790\u4E2D... "))}function Xb(i,e){i&1&&l(0," \u{1F680} \u751F\u6210 AI \u71DF\u92B7\u7B56\u7565 ")}function Zb(i,e){if(i&1&&(s(0,"div",25)(1,"div",62)(2,"span",63),l(3),a(),s(4,"span",64),l(5),a()(),s(6,"div",65),k(7,"div",66),a()()),i&2){let t=f(2);d(3),M(t.generationStatus().message),d(2),M(t.generationStatus().currentProvider),d(2),j("width",t.generationStatus().progress,"%")}}function jb(i,e){if(i&1){let t=T();s(0,"div",7)(1,"div",9)(2,"label",10),l(3," \u{1F4AC} \u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u6A23\u7684\u5BA2\u6236\uFF1F "),a(),s(4,"textarea",11),W("ngModelChange",function(o){v(t);let r=f();return z(r.userInput,o)||(r.userInput=o),x(o)}),b("keydown.enter",function(o){v(t);let r=f();return x(o.ctrlKey&&r.generateStrategy())}),l(5,"                "),a(),s(6,"p",12),l(7,"\u{1F4A1} \u63D0\u793A\uFF1A\u63CF\u8FF0\u8D8A\u8A73\u7D30\uFF0CAI \u5206\u6790\u8D8A\u7CBE\u6E96"),a()(),s(8,"div",9)(9,"label",13),l(10,"\u26A1 \u5FEB\u901F\u9078\u64C7\u884C\u696D\u6A21\u677F"),a(),s(11,"div",14)(12,"button",15),b("click",function(){v(t);let o=f();return x(o.selectIndustry("payment"))}),l(13," \u{1F4B3} \u652F\u4ED8/\u63DB\u532F "),a(),s(14,"button",15),b("click",function(){v(t);let o=f();return x(o.selectIndustry("crypto"))}),l(15," \u{1FA99} \u52A0\u5BC6\u8CA8\u5E63 "),a(),s(16,"button",15),b("click",function(){v(t);let o=f();return x(o.selectIndustry("ecommerce"))}),l(17," \u{1F6D2} \u96FB\u5546/\u8DE8\u5883 "),a(),s(18,"button",15),b("click",function(){v(t);let o=f();return x(o.selectIndustry("custom"))}),l(19," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),a()()(),s(20,"div",9)(21,"div",16)(22,"label",17),l(23," \u{1F916} AI \u6A21\u578B "),w(24,Rb,2,1,"span",18)(25,Nb,2,0,"span",19),a(),s(26,"a",20),b("click",function(){v(t);let o=f();return x(o.goToAICenter())}),l(27," \u2699\uFE0F \u524D\u5F80 AI \u4E2D\u5FC3 "),a()(),w(28,Bb,7,0,"div",21)(29,$b,4,3),w(30,Qb,25,3,"div",22),a(),s(31,"div",23)(32,"button",24),b("click",function(){v(t);let o=f();return x(o.generateStrategy())}),w(33,Yb,3,0)(34,Xb,1,0),a(),w(35,Zb,8,4,"div",25),a()()}if(i&2){let t=f();d(4),K("ngModel",t.userInput),d(8),he(t.selectedIndustry()==="payment"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),d(2),he(t.selectedIndustry()==="crypto"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),d(2),he(t.selectedIndustry()==="ecommerce"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),d(2),he(t.selectedIndustry()==="custom"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),d(6),E(t.connectedModelsCount()>0?24:25),d(4),E(t.availableModels().length===0?28:29),d(2),E(t.showModelSettings()?30:-1),d(2),V("disabled",t.isGenerating()||!t.userInput&&t.selectedIndustry()==="custom"),d(),E(t.isGenerating()?33:34),d(2),E(t.isGenerating()?35:-1)}}function eS(i,e){if(i&1&&(s(0,"span",77),l(1),a()),i&2){let t=e.$implicit;d(),A(" ",t," ")}}function tS(i,e){if(i&1&&(s(0,"span",81),l(1),a()),i&2){let t=e.$implicit;d(),A(" ",t," ")}}function nS(i,e){if(i&1&&(s(0,"span",84),l(1),a()),i&2){let t=e.$implicit;d(),A(" ",t," ")}}function iS(i,e){if(i&1&&(s(0,"li",88)(1,"span",101),l(2,"\u2022"),a(),l(3),a()),i&2){let t=e.$implicit;d(3),A(" ",t," ")}}function oS(i,e){if(i&1&&(s(0,"li",88)(1,"span",102),l(2,"\u2022"),a(),l(3),a()),i&2){let t=e.$implicit;d(3),A(" ",t," ")}}function rS(i,e){if(i&1&&(s(0,"li",88)(1,"span",103),l(2,"\u2022"),a(),l(3),a()),i&2){let t=e.$implicit;d(3),A(" ",t," ")}}function sS(i,e){if(i&1){let t=T();s(0,"div",67)(1,"div",68)(2,"span",69),l(3,"\u2728"),a(),s(4,"div")(5,"p",70),l(6,"AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01"),a(),s(7,"p",5),l(8,"\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0CAI \u5DF2\u751F\u6210\u4EE5\u4E0B\u71DF\u92B7\u7B56\u7565"),a()()(),s(9,"div",9)(10,"h3",71)(11,"span"),l(12,"\u{1F4CA}"),a(),l(13," \u884C\u696D\u5206\u6790 "),a(),s(14,"div",72)(15,"div")(16,"label",63),l(17,"\u76EE\u6A19\u884C\u696D"),a(),s(18,"p",73),l(19),a()(),s(20,"div")(21,"label",63),l(22,"\u76EE\u6A19\u53D7\u773E"),a(),s(23,"p",73),l(24),a()()()(),s(25,"div",9)(26,"h3",71)(27,"span"),l(28,"\u{1F511}"),a(),l(29," AI \u63A8\u85A6\u95DC\u9375\u8A5E "),s(30,"span",74),l(31,"\u9EDE\u64CA\u53EF\u7DE8\u8F2F"),a()(),s(32,"div",75)(33,"div")(34,"label",76),k(35,"span",37),l(36," \u9AD8\u610F\u5411\u95DC\u9375\u8A5E "),a(),s(37,"div",33),$(38,eS,2,1,"span",77,gt),s(40,"button",78),b("click",function(){v(t);let o=f(2);return x(o.addKeyword("high"))}),l(41," + \u6DFB\u52A0 "),a()()(),s(42,"div")(43,"label",79),k(44,"span",80),l(45," \u4E2D\u610F\u5411\u95DC\u9375\u8A5E "),a(),s(46,"div",33),$(47,tS,2,1,"span",81,gt),s(49,"button",78),b("click",function(){v(t);let o=f(2);return x(o.addKeyword("medium"))}),l(50," + \u6DFB\u52A0 "),a()()(),s(51,"div")(52,"label",82),k(53,"span",83),l(54," \u64F4\u5C55\u95DC\u9375\u8A5E "),a(),s(55,"div",33),$(56,nS,2,1,"span",84,gt),s(58,"button",78),b("click",function(){v(t);let o=f(2);return x(o.addKeyword("extended"))}),l(59," + \u6DFB\u52A0 "),a()()()()(),s(60,"div",9)(61,"h3",71)(62,"span"),l(63,"\u{1F465}"),a(),l(64," \u76EE\u6A19\u5BA2\u6236\u756B\u50CF "),a(),s(65,"div",85)(66,"div")(67,"label",86),l(68,"\u8EAB\u4EFD\u7279\u5FB5"),a(),s(69,"ul",87),$(70,iS,4,1,"li",88,ke),a()(),s(72,"div")(73,"label",86),l(74,"\u884C\u70BA\u7279\u5FB5"),a(),s(75,"ul",87),$(76,oS,4,1,"li",88,ke),a()(),s(78,"div")(79,"label",86),l(80,"\u6838\u5FC3\u9700\u6C42"),a(),s(81,"ul",87),$(82,rS,4,1,"li",88,ke),a()()()(),s(84,"div",9)(85,"h3",71)(86,"span"),l(87,"\u{1F4AC}"),a(),l(88," AI \u751F\u6210\u8A71\u8853\u6A21\u677F "),a(),s(89,"div",75)(90,"div")(91,"label",89),l(92,"\u9996\u6B21\u89F8\u9054"),a(),s(93,"textarea",90),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.editableTemplates.firstTouch,o)||(r.editableTemplates.firstTouch=o),x(o)}),l(94,"                      "),a()(),s(95,"div")(96,"label",91),l(97,"\u8DDF\u9032\u8A71\u8853"),a(),s(98,"textarea",90),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.editableTemplates.followUp,o)||(r.editableTemplates.followUp=o),x(o)}),l(99,"                      "),a()(),s(100,"div")(101,"label",92),l(102,"\u4FC3\u6210\u8A71\u8853"),a(),s(103,"textarea",90),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.editableTemplates.closing,o)||(r.editableTemplates.closing=o),x(o)}),l(104,"                      "),a()()()(),s(105,"div",93)(106,"button",94),b("click",function(){v(t);let o=f(2);return x(o.backToInput())}),l(107," \u2190 \u8FD4\u56DE\u4FEE\u6539 "),a(),s(108,"div",95)(109,"button",96),b("click",function(){v(t);let o=f(2);return x(o.saveStrategy())}),l(110," \u{1F4BE} \u4FDD\u5B58\u7B56\u7565 "),a(),s(111,"button",97),b("click",function(){v(t);let o=f(2);return x(o.handoverToAITeam())}),l(112," \u{1F916} \u4EA4\u7D66 AI \u5718\u968A "),a(),s(113,"button",98),b("click",function(){v(t);let o=f(2);return x(o.startAutomation())}),l(114," \u{1F680} \u624B\u52D5\u57F7\u884C "),a()()(),s(115,"div",99)(116,"div",100)(117,"span",69),l(118,"\u{1F4A1}"),a(),s(119,"div")(120,"p",73),l(121,"\u63A8\u85A6\u4F7F\u7528\u300C\u4EA4\u7D66 AI \u5718\u968A\u300D"),a(),s(122,"p",5),l(123,"AI \u6703\u81EA\u52D5\u7D44\u5EFA\u5718\u968A\u3001\u5206\u914D\u89D2\u8272\u3001\u5236\u5B9A\u8A71\u8853\uFF0C24/7 \u667A\u80FD\u92B7\u552E"),a()()()()()}if(i&2){let t=f(2);d(19),M(t.strategyResult().industry),d(5),M(t.strategyResult().targetAudience),d(14),H(t.strategyResult().keywords.highIntent),d(9),H(t.strategyResult().keywords.mediumIntent),d(9),H(t.strategyResult().keywords.extended),d(14),H(t.strategyResult().customerProfile.identity),d(6),H(t.strategyResult().customerProfile.features),d(6),H(t.strategyResult().customerProfile.needs),d(11),K("ngModel",t.editableTemplates.firstTouch),d(5),K("ngModel",t.editableTemplates.followUp),d(5),K("ngModel",t.editableTemplates.closing)}}function aS(i,e){if(i&1&&w(0,sS,124,5,"div",67),i&2){let t=f();E(t.strategyResult()?0:-1)}}function lS(i,e){if(i&1){let t=T();s(0,"div",104),b("click",function(){v(t);let o=f();return x(o.cancelAddKeyword())}),s(1,"div",105),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"h3",106)(3,"span",107),l(4,"\u{1F3F7}\uFE0F"),a(),l(5),a(),s(6,"input",108),W("ngModelChange",function(o){v(t);let r=f();return z(r.newKeywordInput,o)||(r.newKeywordInput=o),x(o)}),b("keydown.enter",function(){v(t);let o=f();return x(o.confirmAddKeyword())})("keydown.escape",function(){v(t);let o=f();return x(o.cancelAddKeyword())}),a(),s(7,"div",109)(8,"button",110),b("click",function(){v(t);let o=f();return x(o.cancelAddKeyword())}),l(9," \u53D6\u6D88 "),a(),s(10,"button",111),b("click",function(){v(t);let o=f();return x(o.confirmAddKeyword())}),l(11," \u78BA\u5B9A\u6DFB\u52A0 "),a()()()()}if(i&2){let t=f();d(5),A(" \u6DFB\u52A0",t.getKeywordLevelLabel(t.keywordDialogLevel()),"\u95DC\u9375\u8A5E "),d(),K("ngModel",t.newKeywordInput),d(4),V("disabled",!t.newKeywordInput.trim())}}var Eo={payment:{industry:"\u652F\u4ED8/\u63DB\u532F",keywords:{highIntent:["\u652F\u4ED8\u901A\u9053","U\u5546","\u63DB\u532F","USDT","\u4EE3\u6536\u4EE3\u4ED8","\u8DD1\u5206"],mediumIntent:["\u56DB\u65B9\u652F\u4ED8","\u4E09\u65B9\u652F\u4ED8","API\u5C0D\u63A5","\u627F\u514C\u5546"],extended:["OTC","\u6536\u6B3E","\u51FA\u6B3E","\u8CBB\u7387","T+0","T+1"]},recommendedGroups:["\u652F\u4ED8\u884C\u696D\u4EA4\u6D41\u7FA4","USDT/\u63DB\u532F\u4EA4\u6613\u7FA4","\u9805\u76EE\u5C0D\u63A5\u7FA4"]},crypto:{industry:"\u52A0\u5BC6\u8CA8\u5E63",keywords:{highIntent:["BTC","ETH","\u5408\u7D04","\u73FE\u8CA8","\u4EA4\u6613\u6240"],mediumIntent:["DeFi","NFT","\u9322\u5305","\u516C\u93C8"],extended:["\u6316\u7926","\u8CEA\u62BC","\u7A7A\u6295","IDO"]},recommendedGroups:["\u5E63\u5708\u4EA4\u6D41\u7FA4","\u5408\u7D04\u4EA4\u6613\u7FA4","\u9805\u76EE\u9996\u767C\u7FA4"]},ecommerce:{industry:"\u96FB\u5546/\u8DE8\u5883",keywords:{highIntent:["\u4E9E\u99AC\u905C","\u7368\u7ACB\u7AD9","Shopify","\u7269\u6D41","\u9078\u54C1"],mediumIntent:["FBA","\u6D77\u5916\u5009","\u6E05\u95DC","\u652F\u4ED8"],extended:["\u6E2C\u8A55","\u5237\u55AE","\u7AD9\u5916\u63A8\u5EE3"]},recommendedGroups:["\u8DE8\u5883\u96FB\u5546\u4EA4\u6D41\u7FA4","\u4E9E\u99AC\u905C\u8CE3\u5BB6\u7FA4","\u7269\u6D41\u5C0D\u63A5\u7FA4"]}},Ao=class i{constructor(){this.ipcService=B(De);this.toastService=B(me);this.aiStrategyService=B(wo);this.startAutomationEvent=Ee();this.handoverToAITeamEvent=Ee();this.navigateEvent=Ee();this.currentStep=C("input");this.userInput="";this.selectedIndustry=C("custom");this.isGenerating=C(!1);this.strategyResult=C(null);this.showModelSettings=C(!1);this.availableModels=this.aiStrategyService.availableModels;this.selectedModelId=this.aiStrategyService.selectedModelId;this.showKeywordDialog=C(!1);this.keywordDialogLevel=C("high");this.newKeywordInput="";this.localAIConfig=this.aiStrategyService.localAIConfig;this.generationStatus=this.aiStrategyService.generationStatus;this.connectedModels=L(()=>this.availableModels().filter(e=>e.isConnected));this.disconnectedModels=L(()=>this.availableModels().filter(e=>!e.isConnected));this.connectedModelsCount=L(()=>this.connectedModels().length);this.editableTemplates={firstTouch:"",followUp:"",closing:""}}ngOnInit(){this.setupEventListeners(),this.aiStrategyService.refreshAvailableModels()}setupEventListeners(){this.ipcService.on("ai-strategy-generated",e=>{this.isGenerating.set(!1),e.success?(this.strategyResult.set(e.strategy),this.editableTemplates=F({},e.strategy.messageTemplates),this.currentStep.set("result"),this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01")):this.toastService.error(`\u751F\u6210\u5931\u6557: ${e.error}`)})}goToAICenter(){this.navigateEvent.emit("ai-center"),this.toastService.info("\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E\u6A21\u578B...")}selectModel(e){this.aiStrategyService.selectModel(e)}getCapabilityStyle(e){switch(e){case"fast":return"bg-cyan-500/20 text-cyan-400";case"powerful":return"bg-purple-500/20 text-purple-400";case"economic":return"bg-green-500/20 text-green-400";case"balanced":return"bg-amber-500/20 text-amber-400";default:return"bg-slate-500/20 text-slate-400"}}getCapabilityLabel(e){switch(e){case"fast":return"\u5FEB\u901F";case"powerful":return"\u5F37\u5927";case"economic":return"\u7D93\u6FDF";case"balanced":return"\u5747\u8861";default:return""}}async testLocalAI(){await this.aiStrategyService.testLocalAIConnection()}updateLocalEndpoint(e){this.aiStrategyService.updateLocalAIConfig({endpoint:e})}updateLocalModel(e){this.aiStrategyService.updateLocalAIConfig({model:e})}selectIndustry(e){if(this.selectedIndustry.set(e),e!=="custom"){let t=Eo[e];t&&(this.userInput=`\u6211\u60F3\u627E${t.industry}\u884C\u696D\u7684\u5BA2\u6236`)}}async generateStrategy(){if(!this.userInput&&this.selectedIndustry()==="custom"){this.toastService.warning("\u8ACB\u8F38\u5165\u60A8\u7684\u9700\u6C42\u6216\u9078\u64C7\u4E00\u500B\u884C\u696D\u6A21\u677F");return}this.isGenerating.set(!0);let e=this.userInput||`\u6211\u60F3\u627E${Eo[this.selectedIndustry()]?.industry||"\u76EE\u6A19\u884C\u696D"}\u7684\u5BA2\u6236`;try{let t=await this.aiStrategyService.generateStrategy(e);if(t){this.strategyResult.set(t),this.editableTemplates=F({},t.messageTemplates),this.currentStep.set("result");let n=this.generationStatus();n.currentProvider==="\u6A21\u677F\u56DE\u9000"?this.toastService.warning("\u96F2\u7AEF AI \u9023\u63A5\u5931\u6557\uFF0C\u5DF2\u4F7F\u7528\u667A\u80FD\u6A21\u677F\u751F\u6210\u3002\u8ACB\u6AA2\u67E5 AI \u4E2D\u5FC3\u914D\u7F6E\u3002"):n.currentProvider.includes("\u672C\u5730")?this.toastService.success(`\u2705 \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01\u4F7F\u7528\uFF1A${n.currentProvider}`):this.toastService.success(`\u2705 AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01(${n.currentProvider})`)}else this.toastService.error("\u7B56\u7565\u751F\u6210\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}catch(t){console.error("[AIMarketing] \u7B56\u7565\u751F\u6210\u5931\u6557:",t),this.toastService.error(`\u751F\u6210\u5931\u6557: ${t.message}`)}finally{this.isGenerating.set(!1)}}generateFromTemplate(){let e=this.selectedIndustry(),t=Eo[e]||Eo.payment,n={industry:t.industry||"\u81EA\u5B9A\u7FA9\u884C\u696D",targetAudience:this.extractAudience(this.userInput),keywords:t.keywords||{highIntent:[],mediumIntent:[],extended:[]},customerProfile:{identity:["\u4EE3\u7406\u5546","\u9805\u76EE\u65B9","\u904B\u71DF\u4EBA\u54E1"],features:["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44","\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F","\u6709\u660E\u78BA\u9700\u6C42"],needs:["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34","\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE","\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]},recommendedGroups:t.recommendedGroups||["\u884C\u696D\u4EA4\u6D41\u7FA4","\u696D\u52D9\u5C0D\u63A5\u7FA4"],messageTemplates:{firstTouch:`\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${t.industry||"\u9019\u500B"}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,followUp:"\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",closing:"\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"},automationSettings:{monitorMode:"24/7 \u5168\u5929\u5019",responseDelay:30,followUpInterval:7200}};this.strategyResult.set(n),this.editableTemplates=F({},n.messageTemplates),this.currentStep.set("result"),this.isGenerating.set(!1),this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01")}extractAudience(e){return e.includes("\u4EE3\u7406")?"\u4EE3\u7406\u5546/\u6E20\u9053\u5546":e.includes("\u5BA2\u6236")?"\u7D42\u7AEF\u5BA2\u6236":e.includes("\u9805\u76EE")?"\u9805\u76EE\u65B9/\u904B\u71DF\u5546":"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4"}addKeyword(e){this.keywordDialogLevel.set(e),this.newKeywordInput="",this.showKeywordDialog.set(!0)}confirmAddKeyword(){let e=this.newKeywordInput.trim();if(e&&this.strategyResult()){let t=F({},this.strategyResult());switch(this.keywordDialogLevel()){case"high":t.keywords.highIntent=[...t.keywords.highIntent,e];break;case"medium":t.keywords.mediumIntent=[...t.keywords.mediumIntent,e];break;case"extended":t.keywords.extended=[...t.keywords.extended,e];break}this.strategyResult.set(t),this.toastService.success(`\u5DF2\u6DFB\u52A0\u95DC\u9375\u8A5E: ${e}`)}this.showKeywordDialog.set(!1),this.newKeywordInput=""}cancelAddKeyword(){this.showKeywordDialog.set(!1),this.newKeywordInput=""}getKeywordLevelLabel(e){switch(e){case"high":return"\u9AD8\u610F\u5411";case"medium":return"\u4E2D\u610F\u5411";case"extended":return"\u64F4\u5C55"}}backToInput(){this.currentStep.set("input")}saveStrategy(){let e=this.strategyResult();e&&(e.messageTemplates=F({},this.editableTemplates),this.ipcService.send("save-ai-strategy",{strategy:e}),this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01"))}startAutomation(){let e=this.strategyResult();e&&(e.messageTemplates=F({},this.editableTemplates),this.startAutomationEvent.emit(e),this.toastService.success("\u6B63\u5728\u555F\u52D5\u624B\u52D5\u71DF\u92B7..."))}handoverToAITeam(){let e=this.strategyResult();e&&(e.messageTemplates=F({},this.editableTemplates),this.handoverToAITeamEvent.emit(e),this.toastService.success("\u{1F916} \u6B63\u5728\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A..."))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-marketing-assistant"]],outputs:{startAutomationEvent:"startAutomationEvent",handoverToAITeamEvent:"handoverToAITeamEvent",navigateEvent:"navigateEvent"},decls:14,vars:2,consts:[[1,"ai-assistant","h-full","flex","flex-col","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900"],[1,"p-6","border-b","border-slate-700/50"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-2xl","bg-gradient-to-br","from-purple-500","to-cyan-500","flex","items-center","justify-center","text-2xl","shadow-lg","shadow-purple-500/20"],[1,"text-2xl","font-bold","text-white"],[1,"text-slate-400","text-sm"],[1,"flex-1","overflow-y-auto","p-6"],[1,"max-w-3xl","mx-auto","space-y-6"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center"],[1,"bg-slate-800/50","rounded-2xl","p-6","border","border-slate-700/50"],[1,"block","text-lg","font-medium","text-white","mb-4"],["rows","4","placeholder","\u4F8B\u5982\uFF1A\u6211\u60F3\u627E\u652F\u4ED8\u884C\u696D\u7684\u4EE3\u7406\u5546\uFF0C\u4ED6\u5011\u9700\u8981\u6709\u63DB\u532F\u548C\u8DD1\u5206\u9700\u6C42...",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-xl","p-4","text-white","text-lg","placeholder-slate-500","focus:border-purple-500","focus:ring-2","focus:ring-purple-500/20","resize-none",3,"ngModelChange","keydown.enter","ngModel"],[1,"text-xs","text-slate-500","mt-2"],[1,"block","text-sm","font-medium","text-slate-400","mb-3"],[1,"flex","flex-wrap","gap-3"],[1,"px-4","py-2","rounded-xl","text-sm","font-medium","transition-all",3,"click"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-sm","font-medium","text-slate-400","flex","items-center","gap-2"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","rounded-full","text-xs"],[1,"px-2","py-0.5","bg-amber-500/20","text-amber-400","rounded-full","text-xs"],[1,"text-sm","text-purple-400","hover:text-purple-300","cursor-pointer","flex","items-center","gap-1",3,"click"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl","text-center"],[1,"mt-4","pt-4","border-t","border-slate-700/50","space-y-4"],[1,"flex","flex-col","items-center","gap-4"],[1,"px-8","py-4","bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","text-lg","font-bold","rounded-2xl","shadow-lg","shadow-purple-500/30","transition-all","flex","items-center","gap-3",3,"click","disabled"],[1,"w-full","max-w-md","bg-slate-800/80","rounded-xl","p-4","border","border-slate-700/50"],[1,"text-amber-400","mb-2"],[1,"text-sm","text-slate-400","mb-3"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"space-y-3"],[1,"text-xs","text-slate-500","mt-3","flex","items-center","gap-1"],[1,"text-xs","text-slate-500","mb-2","flex","items-center","gap-1"],[1,"w-1.5","h-1.5","bg-emerald-500","rounded-full"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5",3,"class"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5",3,"click"],[1,"text-[10px]","px-1.5","py-0.5","rounded-full",3,"class"],[1,"w-2","h-2","bg-emerald-500","rounded-full"],[1,"text-[10px]","px-1.5","py-0.5","rounded-full"],[1,"w-1.5","h-1.5","bg-slate-500","rounded-full"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5","opacity-60",3,"class"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5","opacity-60",3,"click"],[1,"text-xs","text-slate-500"],[1,"bg-slate-900/50","rounded-xl","p-4"],[1,"text-sm","font-medium","text-white","mb-3","flex","items-center","gap-2"],[1,"text-emerald-400","text-xs"],[1,"text-amber-400","text-xs"],[1,"grid","grid-cols-2","gap-3"],[1,"text-xs","text-slate-500","block","mb-1"],["type","text","placeholder","https://your-ollama.ts.net/api/chat",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm",3,"change","value"],["type","text","placeholder","qwen2.5",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm",3,"change","value"],[1,"mt-3","px-4","py-2","bg-cyan-500/20","text-cyan-400","rounded-lg","text-sm","hover:bg-cyan-500/30","transition-colors",3,"click"],[1,"text-sm","font-medium","text-white","mb-2"],[1,"grid","grid-cols-2","gap-2","max-h-48","overflow-y-auto"],[1,"p-3","rounded-lg","cursor-pointer","transition-all","border",3,"class"],[1,"p-3","rounded-lg","cursor-pointer","transition-all","border",3,"click"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-white","truncate"],[1,"w-2","h-2","bg-emerald-500","rounded-full","flex-shrink-0"],[1,"animate-spin"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-slate-400"],[1,"text-sm","text-purple-400"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-purple-500","to-cyan-500","transition-all","duration-500"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","rounded-2xl","p-4","border","border-emerald-500/30","flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-emerald-400","font-medium"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-4"],[1,"text-white","font-medium"],[1,"text-xs","text-slate-500","font-normal","ml-2"],[1,"space-y-4"],[1,"text-sm","text-emerald-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-emerald-500/20","text-emerald-400","rounded-lg","text-sm","border","border-emerald-500/30","cursor-pointer","hover:bg-emerald-500/30","transition-all"],[1,"px-3","py-1.5","bg-slate-700","text-slate-400","rounded-lg","text-sm","hover:bg-slate-600",3,"click"],[1,"text-sm","text-amber-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"w-2","h-2","bg-amber-500","rounded-full"],[1,"px-3","py-1.5","bg-amber-500/20","text-amber-400","rounded-lg","text-sm","border","border-amber-500/30","cursor-pointer","hover:bg-amber-500/30","transition-all"],[1,"text-sm","text-slate-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"w-2","h-2","bg-slate-500","rounded-full"],[1,"px-3","py-1.5","bg-slate-700","text-slate-300","rounded-lg","text-sm","border","border-slate-600","cursor-pointer","hover:bg-slate-600","transition-all"],[1,"grid","grid-cols-3","gap-4"],[1,"text-sm","text-slate-400","mb-2","block"],[1,"space-y-1"],[1,"text-white","text-sm","flex","items-center","gap-2"],[1,"text-sm","text-emerald-400","font-medium","mb-2","block"],["rows","2",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-lg","p-3","text-white","text-sm","resize-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-amber-400","font-medium","mb-2","block"],[1,"text-sm","text-purple-400","font-medium","mb-2","block"],[1,"flex","justify-between","items-center","pt-4"],[1,"px-6","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-all",3,"click"],[1,"flex","gap-3"],[1,"px-6","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-all","flex","items-center","gap-2",3,"click"],[1,"px-6","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","font-bold","rounded-xl","shadow-lg","shadow-emerald-500/30","transition-all","flex","items-center","gap-2",3,"click"],[1,"px-8","py-3","bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","text-white","font-bold","rounded-xl","shadow-lg","shadow-purple-500/30","transition-all","flex","items-center","gap-2",3,"click"],[1,"mt-4","p-4","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10","border","border-emerald-500/30","rounded-xl"],[1,"flex","items-center","gap-3"],[1,"text-purple-400"],[1,"text-cyan-400"],[1,"text-emerald-400"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center",3,"click"],[1,"bg-slate-800","rounded-2xl","p-6","w-full","max-w-md","mx-4","border","border-slate-700","shadow-2xl",3,"click"],[1,"text-lg","font-bold","text-white","mb-4","flex","items-center","gap-2"],[1,"text-xl"],["type","text","placeholder","\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E...","autofocus","",1,"w-full","px-4","py-3","bg-slate-900","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:ring-2","focus:ring-purple-500/20","outline-none","transition-all",3,"ngModelChange","keydown.enter","keydown.escape","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-all","font-medium",3,"click"],[1,"flex-1","px-4","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","hover:from-purple-600","hover:to-pink-600","text-white","rounded-xl","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(t,n){if(t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l(4," \u{1F916} "),a(),s(5,"div")(6,"h1",4),l(7,"AI \u71DF\u92B7\u52A9\u624B"),a(),s(8,"p",5),l(9,"\u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u5BA2\u6236\uFF0CAI \u5E6B\u4F60\u5B8C\u6210\u4E00\u5207"),a()()()(),s(10,"div",6),w(11,jb,36,15,"div",7)(12,aS,1,1),a(),w(13,lS,12,3,"div",8),a()),t&2){let o;d(11),E((o=n.currentStep())==="input"?11:o==="result"?12:-1),d(2),E(n.showKeywordDialog()?13:-1)}},dependencies:[oe,ue,xe,fe,_e],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})}};var Kt=(i,e)=>e.id;function cS(i,e){i&1&&(s(0,"span",6),k(1,"span",22),l(2," \u57F7\u884C\u4E2D "),a())}function dS(i,e){if(i&1&&(s(0,"span",16),l(1),a()),i&2){let t=f();d(),M(t.runningCount())}}function uS(i,e){if(i&1){let t=T();s(0,"div",23)(1,"div",2)(2,"div",39)(3,"span",5),l(4,"\u{1F517}"),a(),s(5,"div")(6,"p",40),l(7,"\u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565"),a(),s(8,"p",41),l(9,"\u7B56\u7565\u5DF2\u81EA\u52D5\u586B\u5165\uFF0C\u78BA\u8A8D\u5F8C\u5373\u53EF\u958B\u59CB\u57F7\u884C"),a()()(),s(10,"button",42),b("click",function(){v(t);let o=f(2);return x(o.clearIncomingStrategy())}),l(11," \u2715 \u6E05\u9664 "),a()()()}}function mS(i,e){i&1&&(s(0,"span",43),l(1,"\u23F3"),a(),l(2," \u7B56\u5283\u4E2D... "))}function pS(i,e){i&1&&(s(0,"span"),l(1,"\u{1F680}"),a(),l(2," AI \u958B\u59CB\u5DE5\u4F5C "))}function gS(i,e){if(i&1){let t=T();s(0,"button",44),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.quickStart(o.goal))}),s(1,"div",36),l(2),a(),s(3,"div",45),l(4),a(),s(5,"div",38),l(6),a()()}if(i&2){let t=e.$implicit;d(2),M(t.icon),d(2),M(t.name),d(2),M(t.description)}}function hS(i,e){if(i&1){let t=T();s(0,"div",18),w(1,uS,12,0,"div",23),s(2,"div",24)(3,"div",25)(4,"h2",26),l(5,"\u{1F3AF} \u4E00\u53E5\u8A71\uFF0C\u555F\u52D5\u4F60\u7684 AI \u92B7\u552E\u5718\u968A"),a(),s(6,"p",27),l(7,"\u544A\u8A34 AI \u4F60\u60F3\u8981\u4EC0\u9EBC\uFF0C\u5269\u4E0B\u7684\u4EA4\u7D66\u6211\u5011"),a()(),s(8,"div",28)(9,"textarea",29),W("ngModelChange",function(o){v(t);let r=f();return z(r.userGoal,o)||(r.userGoal=o),x(o)}),b("keydown.enter",function(o){v(t);let r=f();return x(r.onEnterKey(o))}),l(10,"                  "),a(),s(11,"button",30),b("click",function(){v(t);let o=f();return x(o.startFromGoal())}),w(12,mS,3,0)(13,pS,3,0),a()()(),s(14,"div")(15,"h3",31)(16,"span"),l(17,"\u{1F4A1}"),a(),l(18," \u6216\u9078\u64C7\u5E38\u898B\u76EE\u6A19\uFF0C\u4E00\u9375\u958B\u59CB "),a(),s(19,"div",32),$(20,gS,7,3,"button",33,Kt),a()(),s(22,"div",34)(23,"div",35)(24,"div",36),l(25,"\u{1F3AD}"),a(),s(26,"div",37),l(27,"\u50CF\u771F\u4EBA\u4E00\u6A23"),a(),s(28,"div",38),l(29,"\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E\u3001\u81EA\u7136\u5F15\u5C0E"),a()(),s(30,"div",35)(31,"div",36),l(32,"\u{1F504}"),a(),s(33,"div",37),l(34,"\u5BE6\u6642\u8ABF\u6574"),a(),s(35,"div",38),l(36,"\u6BCF10\u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21"),a()(),s(37,"div",35)(38,"div",36),l(39,"\u{1F91D}"),a(),s(40,"div",37),l(41,"\u591A\u89D2\u8272\u914D\u5408"),a(),s(42,"div",38),l(43,"AI \u81EA\u52D5\u5354\u8ABF\u6700\u4F73\u7D44\u5408"),a()()()()}if(i&2){let t=f();d(),E(t.hasIncomingStrategy()?1:-1),d(8),K("ngModel",t.userGoal),d(2),V("disabled",!t.userGoal.trim()||t.engine.isProcessing()),d(),E(t.engine.isProcessing()?12:13),d(8),H(t.presetGoals)}}function fS(i,e){if(i&1){let t=T();s(0,"div",46)(1,"div",47),l(2,"\u{1F680}"),a(),s(3,"p",48),l(4,"\u66AB\u7121\u57F7\u884C\u4E2D\u7684\u4EFB\u52D9"),a(),s(5,"p",49),l(6,"\u524D\u5F80\u300C\u4E00\u9375\u555F\u52D5\u300D\u5275\u5EFA\u65B0\u4EFB\u52D9"),a(),s(7,"button",50),b("click",function(){v(t);let o=f(2);return x(o.activeTab.set("start"))}),l(8," \u{1F680} \u5275\u5EFA\u4EFB\u52D9 "),a()()}}function _S(i,e){if(i&1){let t=T();s(0,"button",70),b("click",function(){v(t);let o=f(2).$implicit,r=f(3);return x(r.confirmStart(o))}),l(1," \u25B6\uFE0F \u78BA\u8A8D\u958B\u59CB "),a()}}function CS(i,e){if(i&1){let t=T();s(0,"button",71),b("click",function(){v(t);let o=f(2).$implicit,r=f(3);return x(r.pauseExecution(o))}),l(1," \u23F8\uFE0F \u66AB\u505C "),a()}}function vS(i,e){if(i&1){let t=T();s(0,"button",72),b("click",function(){v(t);let o=f(2).$implicit,r=f(3);return x(r.resumeExecution(o))}),l(1," \u25B6\uFE0F \u7E7C\u7E8C "),a()}}function xS(i,e){if(i&1&&(s(0,"div",62)(1,"div",73)(2,"span"),l(3,"\u{1F916}"),a(),l(4," AI \u7406\u89E3 "),a(),s(5,"p",74),l(6),a(),s(7,"div",75)(8,"span"),l(9),a(),s(10,"span"),l(11),a(),s(12,"span"),l(13),a()()()),i&2){let t=f(2).$implicit;d(6),M(t.intent.goal),d(3),A("\u7F6E\u4FE1\u5EA6: ",t.intent.confidence,"%"),d(2),A("\u76EE\u6A19\u7FA4\u9AD4: ",t.intent.targetAudience),d(2),A("\u5EFA\u8B70\u9031\u671F: ",t.intent.suggestedDuration)}}function bS(i,e){if(i&1&&(s(0,"div",78)(1,"span",79),l(2),a(),s(3,"div")(4,"div",80),l(5),a(),s(6,"div",66),l(7),a()()()),i&2){let t=e.$implicit;d(2),M(t.icon),d(3),M(t.name),d(2),M(t.purpose)}}function SS(i,e){if(i&1&&(s(0,"div",63)(1,"div",76),l(2,"\u{1F3AD} AI \u5718\u968A"),a(),s(3,"div",77),$(4,bS,8,3,"div",78,Kt),a()()),i&2){let t=f(2).$implicit;d(4),H(t.roles)}}function yS(i,e){i&1&&(te(),s(0,"svg",83),k(1,"path",84),a())}function wS(i,e){if(i&1&&(s(0,"div",81)(1,"div",82),l(2),a(),w(3,yS,2,0,":svg:svg",83),a()),i&2){let t=e.$implicit,n=e.$index,o=f(3).$implicit;d(),I("bg-green-500",n<o.stats.currentPhase)("text-white",n<o.stats.currentPhase)("bg-purple-500",n===o.stats.currentPhase)("text-white",n===o.stats.currentPhase)("bg-slate-700",n>o.stats.currentPhase)("text-slate-400",n>o.stats.currentPhase),d(),A(" ",t.name," "),d(),E(n<o.strategy.phases.length-1?3:-1)}}function ES(i,e){if(i&1&&(s(0,"div",63)(1,"div",76),l(2,"\u{1F4CB} \u57F7\u884C\u968E\u6BB5"),a(),s(3,"div",56),$(4,wS,4,14,"div",81,Kt),a()()),i&2){let t=f(2).$implicit;d(4),H(t.strategy.phases)}}function AS(i,e){if(i&1&&(s(0,"div",68)(1,"div",85)(2,"span"),l(3,"\u{1F50D}"),a(),l(4," AI \u6700\u65B0\u5206\u6790 "),a(),s(5,"p",86),l(6),a(),s(7,"div",87),l(8),a()()),i&2){let t=f(2).$implicit;d(6),M(t.stats.lastAnalysis.suggestions.reasoning),d(2),A(" \u5EFA\u8B70: ",t.stats.lastAnalysis.suggestions.topicSuggestion," ")}}function DS(i,e){if(i&1){let t=T();s(0,"div",69)(1,"div",2)(2,"div")(3,"div",88)(4,"span"),l(5,"\u{1F3AF}"),a(),l(6," \u9AD8\u610F\u5411\u5BA2\u6236 "),a(),s(7,"p",86),l(8,"\u6AA2\u6E2C\u5230\u9AD8\u610F\u5411\u5BA2\u6236\uFF0C\u5EFA\u8B70\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\u9032\u884C\u591A\u89D2\u8272\u5354\u4F5C\u6210\u4EA4"),a()(),s(9,"button",89),b("click",function(){v(t);let o=f(2).$implicit,r=f(3);return x(r.createGroupForExecution(o))}),s(10,"span"),l(11,"\u{1F465}"),a(),l(12," \u4E00\u9375\u5EFA\u7FA4 "),a()()()}}function MS(i,e){if(i&1){let t=T();s(0,"div",51)(1,"div",52)(2,"div",3),k(3,"div",53),s(4,"div")(5,"div",54),l(6),a(),s(7,"div",55)(8,"span"),l(9),a(),s(10,"span"),l(11,"\xB7"),a(),s(12,"span"),l(13),a()()()(),s(14,"div",56),w(15,_S,2,0,"button",57),w(16,CS,2,0,"button",58),w(17,vS,2,0,"button",59),s(18,"button",60),b("click",function(){v(t);let o=f().$implicit,r=f(3);return x(r.stopExecution(o))}),l(19," \u23F9\uFE0F \u505C\u6B62 "),a()()(),s(20,"div",61),w(21,xS,14,4,"div",62),w(22,SS,6,0,"div",63),w(23,ES,6,0,"div",63),s(24,"div",64)(25,"div",65)(26,"div",12),l(27),a(),s(28,"div",66),l(29,"\u5DF2\u767C\u6D88\u606F"),a()(),s(30,"div",65)(31,"div",9),l(32),a(),s(33,"div",66),l(34,"\u6536\u5230\u56DE\u8986"),a()(),s(35,"div",65)(36,"div",13),l(37),a(),s(38,"div",66),l(39,"\u8208\u8DA3\u5EA6"),a()(),s(40,"div",65)(41,"div",67),l(42),a(),s(43,"div",66),l(44,"\u7576\u524D\u968E\u6BB5"),a()()(),w(45,AS,9,2,"div",68),w(46,DS,13,0,"div",69),a()()}if(i&2){let t=f().$implicit,n=f(3);d(3),I("bg-green-500",t.status==="running")("bg-yellow-500",t.status==="planning")("bg-orange-500",t.status==="paused")("animate-pulse",t.status==="running"),d(3),M(t.goal),d(3),M(n.getStatusLabel(t.status)),d(4),M(n.getExecutionDuration(t)),d(2),E(t.status==="planning"?15:-1),d(),E(t.status==="running"?16:-1),d(),E(t.status==="paused"?17:-1),d(4),E(t.intent?21:-1),d(),E(t.roles.length>0?22:-1),d(),E(t.strategy?23:-1),d(4),M(t.stats.messagesSent),d(5),M(t.stats.responsesReceived),d(5),A("",t.stats.interestScore,"%"),d(5),Y("",t.stats.currentPhase+1,"/",(t.strategy==null||t.strategy.phases==null?null:t.strategy.phases.length)||0),d(3),E(t.stats.lastAnalysis?45:-1),d(),E(t.stats.interestScore>=50&&t.status==="running"?46:-1)}}function TS(i,e){i&1&&w(0,MS,47,24,"div",51),i&2&&E(0)}function IS(i,e){if(i&1&&$(0,TS,1,1,null,null,Kt),i&2){let t=f(2);H(t.activeExecutions())}}function kS(i,e){if(i&1&&(s(0,"div",19),w(1,fS,9,0,"div",46)(2,IS,2,0),a()),i&2){let t=f();d(),E(t.activeExecutions().length===0?1:2)}}function PS(i,e){i&1&&(s(0,"div",46)(1,"div",47),l(2,"\u{1F4DC}"),a(),s(3,"p",48),l(4,"\u66AB\u7121\u6B77\u53F2\u8A18\u9304"),a(),s(5,"p",27),l(6,"\u5B8C\u6210\u7684\u4EFB\u52D9\u6703\u986F\u793A\u5728\u9019\u88E1"),a()())}function FS(i,e){if(i&1&&(s(0,"div",90)(1,"div",2)(2,"div")(3,"div",54),l(4),a(),s(5,"div",91),l(6),a()(),s(7,"div",92)(8,"div",93),l(9),a(),s(10,"div",94),l(11,"\u5DF2\u5B8C\u6210"),a()()()()),i&2){let t=e.$implicit,n=f(3);d(4),M(t.goal),d(2),Y(" ",t.intent==null?null:t.intent.goal," \xB7 ",t.stats.messagesSent," \u689D\u6D88\u606F "),d(3),M(n.formatDate(t.stats.startTime))}}function RS(i,e){if(i&1&&$(0,FS,12,4,"div",90,Kt),i&2){let t=f(2);H(t.completedExecutions())}}function NS(i,e){if(i&1&&(s(0,"div",20),w(1,PS,7,0,"div",46)(2,RS,2,0),a()),i&2){let t=f();d(),E(t.completedExecutions().length===0?1:2)}}function BS(i,e){if(i&1&&(s(0,"div",103)(1,"div",113)(2,"span",5),l(3),a(),s(4,"span",114),l(5),a()(),s(6,"p",66),l(7),a(),s(8,"p",115),l(9),a()()),i&2){let t=e.$implicit;d(3),M(t.icon),d(2),M(t.name),d(2),M(t.purpose),d(2),M(t.entryTiming)}}function VS(i,e){if(i&1&&(s(0,"div",110)(1,"div",116),l(2),a(),s(3,"div",117)(4,"div",2)(5,"span",114),l(6),a(),s(7,"span",66),l(8),a()(),s(9,"p",91),l(10),a()()()),i&2){let t=e.$implicit,n=e.$index;d(2),A(" ",n+1," "),d(4),M(t.name),d(2),M(t.duration),d(2),M(t.goal)}}function LS(i,e){if(i&1&&(s(0,"div",99)(1,"div",103)(2,"div",76),l(3,"\u{1F3AF} AI \u7406\u89E3\u7684\u76EE\u6A19"),a(),s(4,"p",74),l(5),a(),s(6,"div",104)(7,"span",105),l(8),a(),s(9,"span",106),l(10),a()()(),s(11,"div")(12,"div",107),l(13,"\u{1F3AD} AI \u63A8\u85A6\u7684\u5718\u968A"),a(),s(14,"div",108),$(15,BS,10,4,"div",103,Kt),a()(),s(17,"div")(18,"div",107),l(19,"\u{1F4CB} \u57F7\u884C\u8A08\u5283"),a(),s(20,"div",109),$(21,VS,11,4,"div",110,Kt),a()(),s(23,"div",111)(24,"div",85)(25,"span"),l(26,"\u{1F4A1}"),a(),l(27," AI \u6703\u9019\u6A23\u505A "),a(),s(28,"ul",112)(29,"li"),l(30,"\u2022 \u50CF\u771F\u4EBA\u4E00\u6A23\u5728\u7FA4\u88E1\u804A\u5929\uFF0C\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E"),a(),s(31,"li"),l(32,"\u2022 \u81EA\u7136\u5730\u5F15\u5165\u7522\u54C1\u8A71\u984C\uFF0C\u4E0D\u751F\u786C\u63A8\u92B7"),a(),s(33,"li"),l(34,"\u2022 \u6BCF 10 \u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21\uFF0C\u52D5\u614B\u8ABF\u6574\u7B56\u7565"),a(),s(35,"li"),l(36,"\u2022 \u6839\u64DA\u5BA2\u6236\u53CD\u61C9\u9748\u6D3B\u5207\u63DB\u89D2\u8272"),a()()()()),i&2){let t,n,o,r,c,m=f(2);d(5),M((t=m.pendingExecution())==null||t.intent==null?null:t.intent.goal),d(3),A("\u7F6E\u4FE1\u5EA6: ",(n=m.pendingExecution())==null||n.intent==null?null:n.intent.confidence,"%"),d(2),A("\u5EFA\u8B70\u9031\u671F: ",(o=m.pendingExecution())==null||o.intent==null?null:o.intent.suggestedDuration),d(5),H((r=m.pendingExecution())==null?null:r.roles),d(6),H((c=m.pendingExecution())==null||c.strategy==null?null:c.strategy.phases)}}function OS(i,e){if(i&1){let t=T();s(0,"div",21)(1,"div",95)(2,"div",96)(3,"div",3)(4,"div",97),l(5," \u{1F916} "),a(),s(6,"div")(7,"h2",98),l(8,"AI \u7B56\u5283\u5B8C\u6210\uFF01"),a(),s(9,"p",27),l(10,"\u78BA\u8A8D\u4EE5\u4E0B\u65B9\u6848\uFF0C\u5373\u53EF\u958B\u59CB\u57F7\u884C"),a()()()(),w(11,LS,37,3,"div",99),s(12,"div",100)(13,"button",101),b("click",function(){v(t);let o=f();return x(o.cancelPendingExecution())}),l(14," \u53D6\u6D88 "),a(),s(15,"button",102),b("click",function(){v(t);let o=f();return x(o.confirmPendingExecution())}),s(16,"span"),l(17,"\u25B6\uFE0F"),a(),l(18," \u78BA\u8A8D\u958B\u59CB "),a()()()()}if(i&2){let t=f();d(11),E(t.pendingExecution()?11:-1)}}var Do=class i{constructor(){this.engine=B(Da);this.toast=B(me);this.autoGroup=B(Aa);this.incomingStrategy=tt(null);this.activeTab=C("start");this.userGoal="";this.hasIncomingStrategy=C(!1);this.receivedStrategy=null;this.showPlanningResult=C(!1);this.pendingExecution=C(null);this.presetGoals=[{id:"convert",icon:"\u{1F4B0}",name:"\u4FC3\u9032\u6210\u4EA4",description:"\u591A\u89D2\u8272\u914D\u5408\uFF0C\u4FC3\u6210\u7336\u8C6B\u5BA2\u6236\u4E0B\u55AE",goal:"\u8B93\u7FA4\u88E1\u5C0D\u7522\u54C1\u611F\u8208\u8DA3\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u6F5B\u5728\u5BA2\u6236\u5B8C\u6210\u8CFC\u8CB7"},{id:"recovery",icon:"\u{1F49D}",name:"\u633D\u56DE\u6D41\u5931",description:"\u95DC\u61F7\u56DE\u8A2A + \u7279\u5225\u512A\u60E0",goal:"\u633D\u56DE\u5DF2\u7D93\u6D41\u5931\u6216\u6C89\u9ED8\u7684\u8001\u5BA2\u6236\uFF0C\u8B93\u4ED6\u5011\u91CD\u65B0\u8CFC\u8CB7"},{id:"active",icon:"\u{1F389}",name:"\u793E\u7FA4\u6D3B\u8E8D",description:"\u8A71\u984C\u5F15\u5C0E + \u4E92\u52D5\u6FC0\u52F5",goal:"\u63D0\u5347\u793E\u7FA4\u6D3B\u8E8D\u5EA6\uFF0C\u8B93\u7FA4\u6210\u54E1\u66F4\u9858\u610F\u4E92\u52D5\u548C\u8A0E\u8AD6"},{id:"support",icon:"\u{1F527}",name:"\u552E\u5F8C\u670D\u52D9",description:"\u5FEB\u901F\u97FF\u61C9 + \u554F\u984C\u89E3\u6C7A",goal:"\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C\uFF0C\u63D0\u5347\u5BA2\u6236\u6EFF\u610F\u5EA6"},{id:"nurture",icon:"\u{1F331}",name:"\u6F5B\u5BA2\u57F9\u80B2",description:"\u50F9\u503C\u8F38\u51FA + \u4FE1\u4EFB\u5EFA\u7ACB",goal:"\u901A\u904E\u6301\u7E8C\u7684\u50F9\u503C\u8F38\u51FA\u57F9\u80B2\u6F5B\u5728\u5BA2\u6236\uFF0C\u63D0\u5347\u8CFC\u8CB7\u610F\u9858"},{id:"brand",icon:"\u{1F3C6}",name:"\u54C1\u724C\u63A8\u5EE3",description:"\u53E3\u7891\u50B3\u64AD + \u5F62\u8C61\u5EFA\u7ACB",goal:"\u63D0\u5347\u54C1\u724C\u77E5\u540D\u5EA6\u548C\u597D\u611F\u5EA6\uFF0C\u8B93\u66F4\u591A\u4EBA\u4E86\u89E3\u6211\u5011"}];this.runningCount=L(()=>this.engine.executions().filter(e=>e.status==="running").length);this.todayMessages=L(()=>this.engine.executions().filter(e=>e.status==="running").reduce((e,t)=>e+t.stats.messagesSent,0));this.todayConversions=L(()=>0);this.completedExecutions=L(()=>this.engine.executions().filter(e=>e.status==="completed"));this.activeExecutions=L(()=>this.engine.executions().filter(e=>e.status==="running"||e.status==="planning"||e.status==="paused"));gn(()=>{let e=this.incomingStrategy();e&&this.handleIncomingStrategy(e)})}ngOnInit(){}ngOnDestroy(){}onEnterKey(e){let t=e;t.shiftKey||(t.preventDefault(),this.startFromGoal())}async startFromGoal(){if(!this.userGoal.trim())return;let e=await this.engine.startFromOnePhrase(this.userGoal);e&&(this.pendingExecution.set(e),this.showPlanningResult.set(!0))}quickStart(e){this.userGoal=e,this.startFromGoal()}confirmPendingExecution(){let e=this.pendingExecution();e&&(this.engine.confirmAndStart(e.id),this.showPlanningResult.set(!1),this.pendingExecution.set(null),this.userGoal="",this.activeTab.set("running"))}cancelPendingExecution(){let e=this.pendingExecution();e&&this.engine.stopExecution(e.id),this.showPlanningResult.set(!1),this.pendingExecution.set(null)}confirmStart(e){this.engine.confirmAndStart(e.id)}pauseExecution(e){this.engine.pauseExecution(e.id),this.toast.info("\u5DF2\u66AB\u505C\u57F7\u884C")}resumeExecution(e){this.engine.resumeExecution(e.id),this.toast.success("\u5DF2\u6062\u5FA9\u57F7\u884C")}stopExecution(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u9019\u500B\u4EFB\u52D9\u55CE\uFF1F")&&(this.engine.stopExecution(e.id),this.toast.info("\u4EFB\u52D9\u5DF2\u505C\u6B62"))}getStatusLabel(e){return{idle:"\u5F85\u547D",planning:"\u7B56\u5283\u4E2D",running:"\u57F7\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210"}[e]}getExecutionDuration(e){let t=new Date(e.stats.startTime),o=new Date().getTime()-t.getTime(),r=Math.floor(o/6e4);if(r<60)return`${r} \u5206\u9418`;let c=Math.floor(r/60);return c<24?`${c} \u5C0F\u6642`:`${Math.floor(c/24)} \u5929`}formatDate(e){return new Date(e).toLocaleDateString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}async createGroupForExecution(e){if(!e.targetUsers||e.targetUsers.length===0){this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u76EE\u6A19\u7528\u6236\uFF0C\u8ACB\u7E7C\u7E8C\u7B49\u5F85...");return}let t=e.targetUsers.filter(c=>c.intentScore>=50);if(t.length===0){this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u7528\u6236\u53EF\u5EFA\u7FA4");return}let n=t[0],o={targetCustomer:{id:n.id.toString(),username:n.username,firstName:n.firstName||n.username},groupName:this.autoGroup.generateGroupName(n.firstName||n.username||"VIP","{\u5BA2\u6236\u540D}\u5C08\u5C6C\u670D\u52D9\u7FA4"),roleAccounts:e.roles.map((c,m)=>({roleId:c.id,accountId:c.accountId||m+1})),scriptId:void 0,inviteMessage:`\u60A8\u597D ${n.firstName||""}\uFF01\u6211\u5011\u70BA\u60A8\u5275\u5EFA\u4E86\u5C08\u5C6C\u670D\u52D9\u7FA4\u7D44\uFF0C\u6211\u5011\u7684\u5C08\u696D\u5718\u968A\u5C07\u70BA\u60A8\u63D0\u4F9B\u4E00\u5C0D\u4E00\u670D\u52D9\u3002`,intentScore:n.intentScore};this.toast.info("\u6B63\u5728\u70BA\u9AD8\u610F\u5411\u5BA2\u6236\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44...");let r=await this.autoGroup.createGroup(o);r.success?this.toast.success(`\u{1F389} \u5DF2\u70BA ${n.firstName||n.username} \u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\uFF01`):this.toast.error(`\u5EFA\u7FA4\u5931\u6557: ${r.error}`)}handleIncomingStrategy(e){console.log("[AITeamHub] \u6536\u5230 AI \u71DF\u92B7\u52A9\u624B\u7B56\u7565:",e),this.hasIncomingStrategy.set(!0),this.receivedStrategy=e;let t=[`\u5728${e.industry}\u884C\u696D`,`\u5C0B\u627E${e.targetAudience}`];e.keywords.highIntent.length>0&&t.push(`\u95DC\u6CE8\u300C${e.keywords.highIntent.slice(0,3).join("\u3001")}\u300D\u7B49\u95DC\u9375\u8A5E`),e.customerProfile.needs.length>0&&t.push(`\u6EFF\u8DB3\u5BA2\u6236\u300C${e.customerProfile.needs[0]}\u300D\u7684\u9700\u6C42`);let n=t.join("\uFF0C")+"\uFF0C\u4FC3\u6210\u6210\u4EA4";this.userGoal=n,this.toast.success(`\u{1F916} \u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565\uFF01\u884C\u696D: ${e.industry}`),this.activeTab.set("start"),setTimeout(()=>{this.startWithFullStrategy()},500)}clearIncomingStrategy(){this.hasIncomingStrategy.set(!1),this.receivedStrategy=null,this.userGoal=""}async startWithFullStrategy(){if(!this.receivedStrategy){this.startFromGoal();return}let e=this.receivedStrategy,t=await this.engine.startWithMarketingStrategy(this.userGoal,e);t&&(this.pendingExecution.set(t),this.showPlanningResult.set(!0),this.hasIncomingStrategy.set(!1))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-team-hub"]],inputs:{incomingStrategy:[1,"incomingStrategy"]},decls:46,vars:37,consts:[[1,"ai-team-hub","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-2","px-3","py-1","bg-green-500/20","text-green-400","rounded-full","text-sm","animate-pulse"],[1,"flex","items-center","gap-4","px-4","py-2","bg-slate-800/80","rounded-xl","border","border-slate-700/50"],[1,"text-center"],[1,"text-lg","font-bold","text-green-400"],[1,"text-xs","text-slate-500"],[1,"w-px","h-8","bg-slate-700"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-lg","font-bold","text-purple-400"],[1,"flex","gap-1","mt-4","bg-slate-800/50","p-1","rounded-xl","w-fit"],[1,"px-6","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"click"],[1,"bg-white/20","px-2","py-0.5","rounded-full","text-xs"],[1,"flex-1","overflow-y-auto","p-6"],[1,"max-w-3xl","mx-auto","space-y-8"],[1,"space-y-6"],[1,"space-y-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"w-2","h-2","bg-green-500","rounded-full"],[1,"p-4","bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","border","border-emerald-500/30","rounded-2xl"],[1,"bg-gradient-to-br","from-purple-500/10","via-pink-500/10","to-cyan-500/10","rounded-3xl","border","border-purple-500/30","p-8"],[1,"text-center","mb-6"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-400"],[1,"relative"],["rows","3","placeholder","\u4F8B\u5982\uFF1A\u6211\u60F3\u8B93\u7FA4\u88E1\u90A3\u4E9B\u770B\u904E\u7522\u54C1\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u4EBA\u8CFC\u8CB7...",1,"w-full","px-6","py-4","bg-slate-800/80","border","border-slate-600","rounded-2xl","text-white","text-lg","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"ngModelChange","keydown.enter","ngModel"],[1,"absolute","right-3","bottom-3","px-6","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"text-sm","text-slate-400","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl","text-left","hover:bg-slate-800","hover:border-purple-500/30","transition-all","group"],[1,"grid","grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/30","rounded-xl","text-center"],[1,"text-2xl","mb-2"],[1,"text-sm","text-white","font-medium"],[1,"text-xs","text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"text-emerald-400","font-medium"],[1,"text-slate-400","text-sm"],[1,"p-2","text-slate-400","hover:text-white","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],[1,"animate-spin"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl","text-left","hover:bg-slate-800","hover:border-purple-500/30","transition-all","group",3,"click"],[1,"font-medium","text-white","group-hover:text-purple-400","transition-colors"],[1,"text-center","py-16"],[1,"text-6xl","mb-4"],[1,"text-xl","text-white","mb-2"],[1,"text-slate-400","mb-6"],[1,"px-6","py-3","bg-purple-500","text-white","rounded-xl","hover:bg-purple-400","transition-colors",3,"click"],[1,"bg-slate-800/50","border","border-slate-700/50","rounded-2xl","overflow-hidden"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"w-3","h-3","rounded-full"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"flex","items-center","gap-2"],[1,"px-4","py-2","bg-green-500","text-white","rounded-lg","hover:bg-green-400","transition-colors","text-sm"],[1,"px-4","py-2","bg-orange-500/20","text-orange-400","rounded-lg","hover:bg-orange-500/30","transition-colors","text-sm"],[1,"px-4","py-2","bg-green-500/20","text-green-400","rounded-lg","hover:bg-green-500/30","transition-colors","text-sm"],[1,"px-4","py-2","bg-red-500/20","text-red-400","rounded-lg","hover:bg-red-500/30","transition-colors","text-sm",3,"click"],[1,"p-4"],[1,"mb-4","p-3","bg-purple-500/10","border","border-purple-500/20","rounded-xl"],[1,"mb-4"],[1,"grid","grid-cols-4","gap-4"],[1,"p-3","bg-slate-700/30","rounded-lg","text-center"],[1,"text-xs","text-slate-400"],[1,"text-lg","font-bold","text-yellow-400"],[1,"mt-4","p-3","bg-cyan-500/10","border","border-cyan-500/20","rounded-xl"],[1,"mt-4","p-4","bg-gradient-to-r","from-amber-500/10","to-orange-500/10","border","border-amber-500/20","rounded-xl"],[1,"px-4","py-2","bg-green-500","text-white","rounded-lg","hover:bg-green-400","transition-colors","text-sm",3,"click"],[1,"px-4","py-2","bg-orange-500/20","text-orange-400","rounded-lg","hover:bg-orange-500/30","transition-colors","text-sm",3,"click"],[1,"px-4","py-2","bg-green-500/20","text-green-400","rounded-lg","hover:bg-green-500/30","transition-colors","text-sm",3,"click"],[1,"flex","items-center","gap-2","text-purple-400","text-sm","mb-2"],[1,"text-white"],[1,"flex","items-center","gap-4","mt-2","text-xs","text-slate-400"],[1,"text-sm","text-slate-400","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"flex","items-center","gap-2","px-3","py-2","bg-slate-700/50","rounded-lg"],[1,"text-xl"],[1,"text-sm","text-white"],[1,"flex","items-center"],[1,"px-3","py-1.5","rounded-lg","text-xs"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500","mx-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"flex","items-center","gap-2","text-cyan-400","text-sm","mb-2"],[1,"text-white","text-sm"],[1,"text-xs","text-slate-400","mt-2"],[1,"flex","items-center","gap-2","text-amber-400","text-sm","mb-1"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","text-white","rounded-lg","hover:from-amber-400","hover:to-orange-400","transition-all","text-sm","font-medium","flex","items-center","gap-2","whitespace-nowrap",3,"click"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-right"],[1,"text-sm","text-slate-400"],[1,"text-xs","text-green-400"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-purple-500/30","overflow-hidden","max-h-[90vh]","overflow-y-auto"],[1,"p-6","bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border-b","border-slate-700/50"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-2xl"],[1,"text-xl","font-bold","text-white"],[1,"p-6","space-y-6"],[1,"p-6","border-t","border-slate-700/50","flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-slate-800/50","rounded-xl"],[1,"flex","items-center","gap-4","mt-2","text-xs"],[1,"text-purple-400"],[1,"text-cyan-400"],[1,"text-sm","text-slate-400","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"space-y-3"],[1,"flex","items-start","gap-4","p-3","bg-slate-800/50","rounded-lg"],[1,"p-4","bg-cyan-500/10","border","border-cyan-500/20","rounded-xl"],[1,"text-sm","text-slate-300","space-y-1"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-white","font-medium"],[1,"text-xs","text-cyan-400","mt-1"],[1,"w-8","h-8","rounded-full","bg-purple-500/30","text-purple-400","flex","items-center","justify-center","flex-shrink-0"],[1,"flex-1"]],template:function(t,n){if(t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u{1F916}"),a(),l(7," AI \u5718\u968A\u92B7\u552E "),a(),w(8,cS,3,0,"span",6),a(),s(9,"div",7)(10,"div",8)(11,"div",9),l(12),a(),s(13,"div",10),l(14,"\u57F7\u884C\u4E2D"),a()(),k(15,"div",11),s(16,"div",8)(17,"div",12),l(18),a(),s(19,"div",10),l(20,"\u4ECA\u65E5\u6D88\u606F"),a()(),k(21,"div",11),s(22,"div",8)(23,"div",13),l(24),a(),s(25,"div",10),l(26,"\u6210\u4EA4"),a()()()(),s(27,"div",14)(28,"button",15),b("click",function(){return n.activeTab.set("start")}),s(29,"span"),l(30,"\u{1F680}"),a(),l(31," \u4E00\u9375\u555F\u52D5 "),a(),s(32,"button",15),b("click",function(){return n.activeTab.set("running")}),s(33,"span"),l(34,"\u{1F4CA}"),a(),l(35," \u57F7\u884C\u76E3\u63A7 "),w(36,dS,2,1,"span",16),a(),s(37,"button",15),b("click",function(){return n.activeTab.set("history")}),s(38,"span"),l(39,"\u{1F4DC}"),a(),l(40," \u6B77\u53F2\u8A18\u9304 "),a()()(),s(41,"div",17),w(42,hS,44,4,"div",18)(43,kS,3,1,"div",19)(44,NS,3,1,"div",20),a(),w(45,OS,19,1,"div",21),a()),t&2){let o,r;d(8),E(((o=n.engine.currentExecution())==null?null:o.status)==="running"?8:-1),d(4),M(n.runningCount()),d(6),M(n.todayMessages()),d(6),M(n.todayConversions()),d(4),I("bg-gradient-to-r",n.activeTab()==="start")("from-purple-500",n.activeTab()==="start")("to-pink-500",n.activeTab()==="start")("text-white",n.activeTab()==="start")("text-slate-400",n.activeTab()!=="start"),d(4),I("bg-gradient-to-r",n.activeTab()==="running")("from-green-500",n.activeTab()==="running")("to-emerald-500",n.activeTab()==="running")("text-white",n.activeTab()==="running")("text-slate-400",n.activeTab()!=="running"),d(4),E(n.runningCount()>0?36:-1),d(),I("bg-gradient-to-r",n.activeTab()==="history")("from-slate-600",n.activeTab()==="history")("to-slate-500",n.activeTab()==="history")("text-white",n.activeTab()==="history")("text-slate-400",n.activeTab()!=="history"),d(5),E((r=n.activeTab())==="start"?42:r==="running"?43:r==="history"?44:-1),d(3),E(n.showPlanningResult()?45:-1)}},dependencies:[oe,ue,xe,fe,_e],encapsulation:2})}};var GS=(i,e)=>e.group,US=(i,e)=>e.user_id;function qS(i,e){if(i&1){let t=T();s(0,"div",9)(1,"button",50),b("click",function(){v(t);let o=f();return o.deduplicateMembers(),x(o.showAdvancedMenu.set(!1))}),l(2," \u{1F504} \u667A\u80FD\u53BB\u91CD "),s(3,"span",51),l(4,"\u8DE8\u7FA4\u7D44\u5408\u4F75"),a()(),s(5,"button",50),b("click",function(){v(t);let o=f();return o.recalculateScores(),x(o.showAdvancedMenu.set(!1))}),l(6," \u{1F4CA} \u91CD\u7B97\u8A55\u5206 "),s(7,"span",51),l(8,"\u66F4\u65B0\u50F9\u503C\u7B49\u7D1A"),a()(),k(9,"div",52),s(10,"button",50),b("click",function(){v(t);let o=f();return o.showGroupProfile(),x(o.showAdvancedMenu.set(!1))}),l(11," \u{1F4C8} \u7FA4\u7D44\u756B\u50CF "),s(12,"span",51),l(13,"\u8CEA\u91CF\u5206\u6790"),a()(),s(14,"button",50),b("click",function(){v(t);let o=f();return o.compareGroups(),x(o.showAdvancedMenu.set(!1))}),l(15," \u{1F4CA} \u7FA4\u7D44\u5C0D\u6BD4 "),s(16,"span",51),l(17,"\u591A\u7FA4\u5C0D\u6BD4"),a()(),k(18,"div",52),s(19,"button",50),b("click",function(){v(t);let o=f();return o.viewExtractionStats(),x(o.showAdvancedMenu.set(!1))}),l(20," \u{1F4C9} \u63D0\u53D6\u7D71\u8A08 "),s(21,"span",51),l(22,"\u6210\u529F\u7387/\u6548\u80FD"),a()()()}}function $S(i,e){if(i&1&&(s(0,"div",18),l(1),a()),i&2){let t=f();d(),A("+",t.stats().todayNew," \u4ECA\u65E5")}}function HS(i,e){if(i&1){let t=T();s(0,"button",53),b("click",function(){v(t);let o=f();return x(o.clearSearch())}),l(1,"\u2715"),a()}}function KS(i,e){if(i&1&&(s(0,"option",33),l(1),a()),i&2){let t=e.$implicit;V("value",t.group),d(),Y("",t.title," (",t.count,")")}}function zS(i,e){if(i&1){let t=T();s(0,"button",54),b("click",function(){v(t);let o=f();return x(o.clearFilters())}),l(1," \u{1F5D1}\uFE0F \u6E05\u9664\u7BE9\u9078 "),a()}}function WS(i,e){i&1&&(s(0,"div",48),k(1,"div",55),s(2,"p"),l(3,"\u6B63\u5728\u8F09\u5165\u6210\u54E1\u6578\u64DA..."),a()())}function JS(i,e){i&1&&(s(0,"div",49)(1,"div",56),l(2,"\u{1F4ED}"),a(),s(3,"h3"),l(4,"\u66AB\u7121\u6210\u54E1\u6578\u64DA"),a(),s(5,"p"),l(6,"\u8ACB\u5148\u5F9E\u300C\u8CC7\u6E90\u767C\u73FE\u300D\u9801\u9762\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1"),a()())}function QS(i,e){if(i&1){let t=T();s(0,"div",57)(1,"span",78),l(2),a(),s(3,"div",79)(4,"button",80),b("click",function(){v(t);let o=f(2);return x(o.batchSendMessage())}),l(5," \u{1F4E8} \u6279\u91CF\u767C\u6D88\u606F "),a(),s(6,"button",80),b("click",function(){v(t);let o=f(2);return x(o.batchAddTags())}),l(7," \u{1F3F7}\uFE0F \u6279\u91CF\u6A19\u7C64 "),a(),s(8,"button",80),b("click",function(){v(t);let o=f(2);return x(o.batchMarkContacted())}),l(9," \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B "),a(),s(10,"button",80),b("click",function(){v(t);let o=f(2);return x(o.batchExport())}),l(11," \u{1F4E5} \u5C0E\u51FA\u9078\u4E2D "),a(),s(12,"button",81),b("click",function(){v(t);let o=f(2);return x(o.clearSelection())}),l(13," \u2715 \u53D6\u6D88\u9078\u64C7 "),a()()()}if(i&2){let t=f(2);d(2),A("\u5DF2\u9078\u64C7 ",t.selectedMemberIds().length," \u500B\u6210\u54E1")}}function YS(i,e){if(i&1&&(s(0,"span"),l(1),a()),i&2){let t=f(2);d(),M(t.sortDirection==="asc"?"\u2191":"\u2193")}}function XS(i,e){if(i&1&&(s(0,"span"),l(1),a()),i&2){let t=f(2);d(),M(t.sortDirection==="asc"?"\u2191":"\u2193")}}function ZS(i,e){if(i&1&&(s(0,"span"),l(1),a()),i&2){let t=f(2);d(),M(t.sortDirection==="asc"?"\u2191":"\u2193")}}function jS(i,e){if(i&1&&(s(0,"span"),l(1),a()),i&2){let t=f(2);d(),M(t.sortDirection==="asc"?"\u2191":"\u2193")}}function ey(i,e){i&1&&(s(0,"span",92),l(1,"\u2B50"),a())}function ty(i,e){i&1&&(s(0,"span",93),l(1,"\u2713"),a())}function ny(i,e){i&1&&(s(0,"span",94),l(1,"\u{1F1E8}\u{1F1F3}"),a())}function iy(i,e){if(i&1&&(s(0,"span",95),l(1),a()),i&2){let t=f().$implicit;V("title",t.bio),d(),M(t.bio)}}function oy(i,e){if(i&1){let t=T();s(0,"a",112),b("click",function(o){return v(t),x(o.stopPropagation())}),l(1),a()}if(i&2){let t=f().$implicit;V("href","https://t.me/"+t.username,Bt),d(),A(" @",t.username," ")}}function ry(i,e){i&1&&(s(0,"span",97),l(1,"-"),a())}function sy(i,e){if(i&1&&(s(0,"span",113),l(1),a()),i&2){let t=e.$implicit;d(),M(t)}}function ay(i,e){if(i&1&&(s(0,"span",114),l(1),a()),i&2){let t=f(2).$implicit,n=f(2);d(),A("+",n.getMemberTags(t).length-2)}}function ly(i,e){if(i&1&&(s(0,"div",103),$(1,sy,2,1,"span",113,ke),w(3,ay,2,1,"span",114),a()),i&2){let t=f().$implicit,n=f(2);d(),H(n.getMemberTags(t).slice(0,2)),d(2),E(n.getMemberTags(t).length>2?3:-1)}}function cy(i,e){i&1&&(s(0,"span",104),l(1,"-"),a())}function dy(i,e){i&1&&(s(0,"span",105),l(1," \u2705 \u5DF2\u806F\u7E6B "),a())}function uy(i,e){i&1&&(s(0,"span",106),l(1," \u{1F4ED} \u672A\u806F\u7E6B "),a())}function my(i,e){if(i&1){let t=T();s(0,"tr",82),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.openMemberDetail(o))}),s(1,"td",83),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"input",84),b("change",function(){let o=v(t).$implicit,r=f(2);return x(r.toggleMemberSelection(o.user_id))}),a()(),s(3,"td",85)(4,"span",86),l(5),a()(),s(6,"td",87)(7,"div",88)(8,"div",89),l(9),a(),s(10,"div",90)(11,"span",91),l(12),w(13,ey,2,0,"span",92),w(14,ty,2,0,"span",93),w(15,ny,2,0,"span",94),a(),w(16,iy,2,2,"span",95),a()()(),s(17,"td",64),w(18,oy,2,2,"a",96)(19,ry,2,0,"span",97),a(),s(20,"td",98)(21,"span",99),l(22),a()(),s(23,"td",100)(24,"span",101),l(25),a()(),s(26,"td",67)(27,"span",102),l(28),a()(),s(29,"td",68),w(30,ly,4,1,"div",103)(31,cy,2,0,"span",104),a(),s(32,"td",69),w(33,dy,2,0,"span",105)(34,uy,2,0,"span",106),a(),s(35,"td",107),b("click",function(o){return v(t),x(o.stopPropagation())}),s(36,"div",108)(37,"button",109),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.sendMessage(o))}),l(38," \u{1F4AC} "),a(),s(39,"button",110),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.addToFunnel(o))}),l(40," \u{1F4E4} "),a(),s(41,"button",111),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.openMemberDetail(o))}),l(42," \u{1F441}\uFE0F "),a()()()()}if(i&2){let t=e.$implicit,n=f(2);I("selected",n.isMemberSelected(t.user_id)),d(2),V("checked",n.isMemberSelected(t.user_id)),d(2),V("title",t.user_id),d(),M(t.user_id),d(3),I("has-photo",t.has_photo),d(),A(" ",n.getAvatarLetter(t)," "),d(3),Y(" ",t.first_name," ",t.last_name," "),d(),E(t.is_premium?13:-1),d(),E(t.is_verified?14:-1),d(),E(n.isChinese(t)?15:-1),d(),E(t.bio?16:-1),d(2),E(t.username?18:19),d(3),he("status-"+t.online_status),d(),Y(" ",n.getStatusIcon(t.online_status)," ",n.getStatusText(t.online_status)," "),d(2),he("level-"+t.value_level),d(),A(" ",t.value_level," "),d(2),V("title",t.source_chat_title),d(),A(" ",t.source_chat_title||"\u672A\u77E5"," "),d(2),E(n.getMemberTags(t).length>0?30:31),d(3),E(t.contacted?33:34)}}function py(i,e){if(i&1){let t=T();w(0,QS,14,1,"div",57),s(1,"div",58)(2,"table",59)(3,"thead")(4,"tr")(5,"th",60)(6,"input",61),b("change",function(){v(t);let o=f();return x(o.toggleSelectAll())}),a()(),s(7,"th",62),b("click",function(){v(t);let o=f();return x(o.sortBy("user_id"))}),l(8," ID "),w(9,YS,2,1,"span"),a(),s(10,"th",63),b("click",function(){v(t);let o=f();return x(o.sortBy("first_name"))}),l(11," \u7528\u6236 "),w(12,XS,2,1,"span"),a(),s(13,"th",64),l(14,"\u7528\u6236\u540D"),a(),s(15,"th",65),b("click",function(){v(t);let o=f();return x(o.sortBy("online_status"))}),l(16," \u72C0\u614B "),w(17,ZS,2,1,"span"),a(),s(18,"th",66),b("click",function(){v(t);let o=f();return x(o.sortBy("value_level"))}),l(19," \u7B49\u7D1A "),w(20,jS,2,1,"span"),a(),s(21,"th",67),l(22,"\u4F86\u6E90\u7FA4\u7D44"),a(),s(23,"th",68),l(24,"\u6A19\u7C64"),a(),s(25,"th",69),l(26,"\u806F\u7E6B\u72C0\u614B"),a(),s(27,"th",70),l(28,"\u64CD\u4F5C"),a()()(),s(29,"tbody"),$(30,my,43,26,"tr",71,US),a()()(),s(32,"div",72)(33,"div",73),l(34),a(),s(35,"div",74)(36,"button",75),b("click",function(){v(t);let o=f();return x(o.goToPage(1))}),l(37," \u23EE\uFE0F "),a(),s(38,"button",75),b("click",function(){v(t);let o=f();return x(o.goToPage(o.currentPage-1))}),l(39," \u25C0\uFE0F "),a(),s(40,"span",76),l(41),a(),s(42,"button",75),b("click",function(){v(t);let o=f();return x(o.goToPage(o.currentPage+1))}),l(43," \u25B6\uFE0F "),a(),s(44,"button",75),b("click",function(){v(t);let o=f();return x(o.goToPage(o.totalPages()))}),l(45," \u23ED\uFE0F "),a(),s(46,"select",77),W("ngModelChange",function(o){v(t);let r=f();return z(r.pageSize,o)||(r.pageSize=o),x(o)}),b("ngModelChange",function(){v(t);let o=f();return x(o.onPageSizeChange())}),s(47,"option",33),l(48,"25 / \u9801"),a(),s(49,"option",33),l(50,"50 / \u9801"),a(),s(51,"option",33),l(52,"100 / \u9801"),a(),s(53,"option",33),l(54,"200 / \u9801"),a()()()()}if(i&2){let t=f();E(t.selectedMemberIds().length>0?0:-1),d(6),V("checked",t.isAllSelected())("indeterminate",t.isPartialSelected()),d(3),E(t.sortField==="user_id"?9:-1),d(3),E(t.sortField==="first_name"?12:-1),d(5),E(t.sortField==="online_status"?17:-1),d(3),E(t.sortField==="value_level"?20:-1),d(10),H(t.paginatedMembers()),d(4),je(" \u986F\u793A ",t.getPageStart()," - ",t.getPageEnd()," / ",t.filteredMembers().length," \u500B\u6210\u54E1 "),d(2),V("disabled",t.currentPage===1),d(2),V("disabled",t.currentPage===1),d(3),Y("",t.currentPage," / ",t.totalPages()),d(),V("disabled",t.currentPage>=t.totalPages()),d(2),V("disabled",t.currentPage>=t.totalPages()),d(2),K("ngModel",t.pageSize),d(),V("value",25),d(2),V("value",50),d(2),V("value",100),d(2),V("value",200)}}function gy(i,e){i&1&&(s(0,"span",125),l(1,"\u2B50"),a())}function hy(i,e){if(i&1&&(s(0,"a",126),l(1),a()),i&2){let t=f(2);V("href","https://t.me/"+t.selectedMember().username,Bt),d(),A(" @",t.selectedMember().username," ")}}function fy(i,e){if(i&1&&(s(0,"div",129)(1,"span",130),l(2,"\u96FB\u8A71\u865F\u78BC"),a(),s(3,"span",133),l(4),a()()),i&2){let t=f(2);d(4),M(t.selectedMember().phone)}}function _y(i,e){if(i&1&&(s(0,"div",129)(1,"span",130),l(2,"\u8A9E\u8A00"),a(),s(3,"span",133),l(4),a()()),i&2){let t=f(2);d(4),M(t.selectedMember().language_code)}}function Cy(i,e){i&1&&(s(0,"span",135),l(1,"\u2B50 Premium"),a())}function vy(i,e){i&1&&(s(0,"span",136),l(1,"\u2713 \u5DF2\u9A57\u8B49"),a())}function xy(i,e){i&1&&(s(0,"span",137),l(1,"\u{1F4F7} \u6709\u982D\u50CF"),a())}function by(i,e){i&1&&(s(0,"span",138),l(1,"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA"),a())}function Sy(i,e){i&1&&(s(0,"span",139),l(1,"\u26A0\uFE0F \u8A50\u9A19\u6A19\u8A18"),a())}function yy(i,e){i&1&&(s(0,"span",140),l(1,"\u{1F5D1}\uFE0F \u5DF2\u522A\u9664"),a())}function wy(i,e){if(i&1&&(s(0,"div",120)(1,"h4",127),l(2,"\u{1F4DD} \u500B\u4EBA\u7C21\u4ECB"),a(),s(3,"p",156),l(4),a()()),i&2){let t=f(2);d(4),M(t.selectedMember().bio)}}function Ey(i,e){if(i&1&&(s(0,"div",142)(1,"span",143),l(2),a()()),i&2){let t=f().$implicit;d(2),A("\u7FA4\u7D44 ",t)}}function Ay(i,e){if(i&1&&w(0,Ey,3,1,"div",142),i&2){let t=e.$implicit,n=f(2);E(t!==n.selectedMember().source_chat_id?0:-1)}}function Dy(i,e){if(i&1){let t=T();s(0,"span",146),l(1),s(2,"button",157),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.removeTag(r.selectedMember(),o))}),l(3,"\u2715"),a()()}if(i&2){let t=e.$implicit;d(),A(" ",t," ")}}function My(i,e){if(i&1&&(s(0,"div",150)(1,"span",151),l(2,"\u806F\u7E6B\u6642\u9593"),a(),s(3,"span",152),l(4),a()()),i&2){let t=f(2);d(4),M(t.formatDate(t.selectedMember().contacted_at))}}function Ty(i,e){if(i&1&&(s(0,"div",150)(1,"span",151),l(2,"\u56DE\u8986\u72C0\u614B"),a(),s(3,"span",152),l(4),a()()),i&2){let t=f(2);d(4),M(t.selectedMember().response_status)}}function Iy(i,e){if(i&1){let t=T();s(0,"button",8),b("click",function(){v(t);let o=f(2);return x(o.markAsContacted(o.selectedMember()))}),l(1," \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B "),a()}}function ky(i,e){if(i&1){let t=T();s(0,"div",115),b("click",function(){v(t);let o=f();return x(o.closeMemberDetail())}),a(),s(1,"div",116)(2,"div",117)(3,"h2"),l(4,"\u6210\u54E1\u8A73\u60C5"),a(),s(5,"button",118),b("click",function(){v(t);let o=f();return x(o.closeMemberDetail())}),l(6,"\u2715"),a()(),s(7,"div",119)(8,"div",120)(9,"div",121)(10,"div",122),l(11),a(),s(12,"div",123)(13,"h3",124),l(14),w(15,gy,2,0,"span",125),a(),w(16,hy,2,2,"a",126),s(17,"span",99),l(18),a()()()(),s(19,"div",120)(20,"h4",127),l(21,"\u{1F4CB} \u57FA\u672C\u4FE1\u606F"),a(),s(22,"div",128)(23,"div",129)(24,"span",130),l(25,"Telegram ID"),a(),s(26,"span",131),b("click",function(){v(t);let o=f();return x(o.copyToClipboard(o.selectedMember().user_id))}),l(27),s(28,"span",132),l(29,"\u{1F4CB}"),a()()(),w(30,fy,5,1,"div",129),w(31,_y,5,1,"div",129),s(32,"div",129)(33,"span",130),l(34,"\u50F9\u503C\u7B49\u7D1A"),a(),s(35,"span",133)(36,"span",101),l(37),a()()(),s(38,"div",129)(39,"span",130),l(40,"\u6D3B\u8E8D\u5EA6\u8A55\u5206"),a(),s(41,"span",133),l(42),a()()()(),s(43,"div",120)(44,"h4",127),l(45,"\u{1F516} \u5E33\u865F\u72C0\u614B"),a(),s(46,"div",134),w(47,Cy,2,0,"span",135),w(48,vy,2,0,"span",136),w(49,xy,2,0,"span",137),w(50,by,2,0,"span",138),w(51,Sy,2,0,"span",139),w(52,yy,2,0,"span",140),a()(),w(53,wy,5,1,"div",120),s(54,"div",120)(55,"h4",127),l(56,"\u{1F4CD} \u4F86\u6E90\u7FA4\u7D44"),a(),s(57,"div",141)(58,"div",142)(59,"span",143),l(60),a(),s(61,"span",144),l(62),a()(),$(63,Ay,1,1,null,null,ke),a()(),s(65,"div",120)(66,"h4",127),l(67,"\u{1F3F7}\uFE0F \u6A19\u7C64"),a(),s(68,"div",145),$(69,Dy,4,1,"span",146,ke),s(71,"button",147),b("click",function(){v(t);let o=f();return x(o.openAddTagDialog())}),l(72,"+ \u6DFB\u52A0\u6A19\u7C64"),a()()(),s(73,"div",120)(74,"h4",127),l(75,"\u{1F4DD} \u5099\u8A3B"),a(),s(76,"textarea",148),W("ngModelChange",function(o){v(t);let r=f();return z(r.memberNotes,o)||(r.memberNotes=o),x(o)}),b("blur",function(){v(t);let o=f();return x(o.saveMemberNotes())}),a()(),s(77,"div",120)(78,"h4",127),l(79,"\u{1F4CA} \u71DF\u92B7\u72C0\u614B"),a(),s(80,"div",149)(81,"div",150)(82,"span",151),l(83,"\u806F\u7E6B\u72C0\u614B"),a(),s(84,"span",152),l(85),a()(),w(86,My,5,1,"div",150),w(87,Ty,5,1,"div",150),s(88,"div",150)(89,"span",151),l(90,"\u8F49\u5316\u72C0\u614B"),a(),s(91,"span",152),l(92),a()()()()(),s(93,"div",153)(94,"button",154),b("click",function(){v(t);let o=f();return x(o.sendMessage(o.selectedMember()))}),l(95," \u{1F4AC} \u767C\u6D88\u606F "),a(),s(96,"button",8),b("click",function(){v(t);let o=f();return x(o.addToFunnel(o.selectedMember()))}),l(97," \u{1F4E4} \u52A0\u5165\u6F0F\u6597 "),a(),w(98,Iy,2,0,"button",155),a()()}if(i&2){let t=f();d(10),I("has-photo",t.selectedMember().has_photo),d(),A(" ",t.getAvatarLetter(t.selectedMember())," "),d(3),Y(" ",t.selectedMember().first_name," ",t.selectedMember().last_name," "),d(),E(t.selectedMember().is_premium?15:-1),d(),E(t.selectedMember().username?16:-1),d(),he("status-"+t.selectedMember().online_status),d(),Y(" ",t.getStatusIcon(t.selectedMember().online_status)," ",t.getStatusText(t.selectedMember().online_status)," "),d(9),A(" ",t.selectedMember().user_id," "),d(3),E(t.selectedMember().phone?30:-1),d(),E(t.selectedMember().language_code?31:-1),d(5),he("level-"+t.selectedMember().value_level),d(),A(" ",t.selectedMember().value_level," \u7D1A "),d(5),A("",t.selectedMember().activity_score,"/100"),d(5),E(t.selectedMember().is_premium?47:-1),d(),E(t.selectedMember().is_verified?48:-1),d(),E(t.selectedMember().has_photo?49:-1),d(),E(t.isChinese(t.selectedMember())?50:-1),d(),E(t.selectedMember().is_scam?51:-1),d(),E(t.selectedMember().is_deleted?52:-1),d(),E(t.selectedMember().bio?53:-1),d(7),M(t.selectedMember().source_chat_title),d(2),M(t.formatDate(t.selectedMember().extracted_at)),d(),H(t.getGroupsList(t.selectedMember())),d(6),H(t.getMemberTags(t.selectedMember())),d(7),K("ngModel",t.memberNotes),d(8),I("contacted",t.selectedMember().contacted),d(),A(" ",t.selectedMember().contacted?"\u2705 \u5DF2\u806F\u7E6B":"\u{1F4ED} \u672A\u806F\u7E6B"," "),d(),E(t.selectedMember().contacted_at?86:-1),d(),E(t.selectedMember().response_status?87:-1),d(4),I("converted",t.selectedMember().converted),d(),A(" ",t.selectedMember().converted?"\u2705 \u5DF2\u8F49\u5316":"\u23F3 \u5F85\u8F49\u5316"," "),d(6),E(t.selectedMember().contacted?-1:98)}}function Py(i,e){if(i&1){let t=T();s(0,"button",168),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.addSuggestedTag(o))}),l(1),a()}if(i&2){let t=e.$implicit;d(),M(t)}}function Fy(i,e){if(i&1){let t=T();s(0,"div",158),b("click",function(){v(t);let o=f();return x(o.closeAddTagDialog())}),a(),s(1,"div",159)(2,"div",160)(3,"h3"),l(4,"\u6DFB\u52A0\u6A19\u7C64"),a(),s(5,"button",118),b("click",function(){v(t);let o=f();return x(o.closeAddTagDialog())}),l(6,"\u2715"),a()(),s(7,"div",161)(8,"input",162),W("ngModelChange",function(o){v(t);let r=f();return z(r.newTagName,o)||(r.newTagName=o),x(o)}),b("keyup.enter",function(){v(t);let o=f();return x(o.addTag())}),a(),s(9,"div",163)(10,"p",164),l(11,"\u5E38\u7528\u6A19\u7C64\uFF1A"),a(),s(12,"div",165),$(13,Py,2,1,"button",166,ke),a()()(),s(15,"div",167)(16,"button",8),b("click",function(){v(t);let o=f();return x(o.closeAddTagDialog())}),l(17,"\u53D6\u6D88"),a(),s(18,"button",11),b("click",function(){v(t);let o=f();return x(o.addTag())}),l(19,"\u6DFB\u52A0"),a()()()}if(i&2){let t=f();d(8),K("ngModel",t.newTagName),d(5),H(t.suggestedTags),d(5),V("disabled",!t.newTagName)}}var Mo=class i{constructor(){this.ipcService=B(De);this.toastService=B(me);this.sendMessageEvent=Ee();this.addToFunnelEvent=Ee();this.batchSendMessageEvent=Ee();this.members=C([]);this.filteredMembers=C([]);this.isLoading=C(!1);this.stats=C({total:0,online:0,recently:0,premium:0,chinese:0,contacted:0,converted:0,todayNew:0,byValueLevel:{},bySource:[]});this.sourceGroups=C([]);this.searchQuery="";this.selectedSource="";this.selectedOnlineStatus="";this.selectedValueLevel="";this.filterPremium=!1;this.filterChinese=!1;this.filterHasUsername=!1;this.filterNotContacted=!1;this.filterHasPhoto=!1;this.sortField="extracted_at";this.sortDirection="desc";this.currentPage=1;this.pageSize=50;this.selectedMemberIds=C([]);this.selectedMember=C(null);this.memberNotes="";this.showAddTagDialog=C(!1);this.newTagName="";this.suggestedTags=["\u9AD8\u610F\u5411","\u5E63\u5708","DeFi","NFT","\u6295\u8CC7","\u4EA4\u6613","\u91CF\u5316","\u7926\u5DE5","\u958B\u767C\u8005","\u904B\u71DF"];this.showAdvancedMenu=C(!1);this.loadTimeout=null;this.paginatedMembers=L(()=>{let e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.filteredMembers().slice(e,t)});this.totalPages=L(()=>Math.ceil(this.filteredMembers().length/this.pageSize)||1)}ngOnInit(){this.loadMembers(),this.setupEventListeners()}ngOnDestroy(){}setupEventListeners(){this.ipcService.on("extracted-members-list",e=>{console.log("[MemberDatabase] Received extracted-members-list event:",e),this.loadTimeout&&(clearTimeout(this.loadTimeout),this.loadTimeout=null),e.success?(console.log(`[MemberDatabase] Loaded ${e.members?.length||0} members`),this.members.set(e.members||[]),this.applyFilters(),this.calculateStats(),this.isLoading.set(!1)):(console.error("[MemberDatabase] Load failed:",e.error),this.toastService.error(`\u8F09\u5165\u5931\u6557: ${e.error}`),this.isLoading.set(!1))}),this.ipcService.on("member-stats",e=>{e.success&&this.stats.update(t=>F(F({},t),e))})}loadMembers(){console.log("[MemberDatabase] loadMembers called"),this.isLoading.set(!0),this.loadTimeout&&clearTimeout(this.loadTimeout),this.loadTimeout=setTimeout(()=>{this.isLoading()&&(console.warn("[MemberDatabase] Load timeout after 15 seconds"),this.isLoading.set(!1),this.toastService.error("\u8F09\u5165\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},15e3),console.log("[MemberDatabase] Sending get-extracted-members request"),this.ipcService.send("get-extracted-members",{limit:500,offset:0})}refreshMembers(){this.loadMembers(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u6578\u64DA...")}onSearchChange(e){this.searchQuery=e,this.applyFilters()}clearSearch(){this.searchQuery="",this.applyFilters()}applyFilters(){let e=[...this.members()];if(this.searchQuery){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.user_id.includes(t)||n.username?.toLowerCase().includes(t)||n.first_name?.toLowerCase().includes(t)||n.last_name?.toLowerCase().includes(t))}this.selectedSource&&(e=e.filter(t=>t.source_chat_id===this.selectedSource)),this.selectedOnlineStatus&&(e=e.filter(t=>t.online_status===this.selectedOnlineStatus)),this.selectedValueLevel&&(e=e.filter(t=>t.value_level===this.selectedValueLevel)),this.filterPremium&&(e=e.filter(t=>t.is_premium)),this.filterChinese&&(e=e.filter(t=>this.isChinese(t))),this.filterHasUsername&&(e=e.filter(t=>t.username)),this.filterNotContacted&&(e=e.filter(t=>!t.contacted)),this.filterHasPhoto&&(e=e.filter(t=>t.has_photo)),e.sort((t,n)=>{let o=t[this.sortField],r=n[this.sortField];return typeof o=="string"&&(o=o.toLowerCase()),typeof r=="string"&&(r=r.toLowerCase()),o<r?this.sortDirection==="asc"?-1:1:o>r?this.sortDirection==="asc"?1:-1:0}),this.filteredMembers.set(e),this.currentPage=1}hasActiveFilters(){return!!(this.searchQuery||this.selectedSource||this.selectedOnlineStatus||this.selectedValueLevel||this.filterPremium||this.filterChinese||this.filterHasUsername||this.filterNotContacted||this.filterHasPhoto)}clearFilters(){this.searchQuery="",this.selectedSource="",this.selectedOnlineStatus="",this.selectedValueLevel="",this.filterPremium=!1,this.filterChinese=!1,this.filterHasUsername=!1,this.filterNotContacted=!1,this.filterHasPhoto=!1,this.applyFilters()}sortBy(e){this.sortField===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=e,this.sortDirection="asc"),this.applyFilters()}getPageStart(){return(this.currentPage-1)*this.pageSize+1}getPageEnd(){return Math.min(this.currentPage*this.pageSize,this.filteredMembers().length)}goToPage(e){e>=1&&e<=this.totalPages()&&(this.currentPage=e)}onPageSizeChange(){this.currentPage=1}isAllSelected(){return this.paginatedMembers().length>0&&this.paginatedMembers().every(e=>this.selectedMemberIds().includes(e.user_id))}isPartialSelected(){let e=this.paginatedMembers().filter(t=>this.selectedMemberIds().includes(t.user_id));return e.length>0&&e.length<this.paginatedMembers().length}toggleSelectAll(){if(this.isAllSelected()){let e=this.paginatedMembers().map(t=>t.user_id);this.selectedMemberIds.update(t=>t.filter(n=>!e.includes(n)))}else{let e=this.paginatedMembers().map(t=>t.user_id);this.selectedMemberIds.update(t=>[...new Set([...t,...e])])}}isMemberSelected(e){return this.selectedMemberIds().includes(e)}toggleMemberSelection(e){this.selectedMemberIds.update(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])}clearSelection(){this.selectedMemberIds.set([])}calculateStats(){let e=this.members(),t=new Date().toDateString(),n={total:e.length,online:e.filter(r=>r.online_status==="online").length,recently:e.filter(r=>r.online_status==="recently").length,premium:e.filter(r=>r.is_premium).length,chinese:e.filter(r=>this.isChinese(r)).length,contacted:e.filter(r=>r.contacted).length,converted:e.filter(r=>r.converted).length,todayNew:e.filter(r=>new Date(r.created_at).toDateString()===t).length,byValueLevel:{},bySource:[]},o=new Map;e.forEach(r=>{if(r.source_chat_id){let c=o.get(r.source_chat_id);c?c.count++:o.set(r.source_chat_id,{title:r.source_chat_title||r.source_chat_id,count:1})}}),this.sourceGroups.set(Array.from(o.entries()).map(([r,c])=>({group:r,title:c.title,count:c.count})).sort((r,c)=>c.count-r.count)),this.stats.set(n)}getOnlinePercent(){let e=this.stats().total;return e>0?(this.stats().online/e*100).toFixed(1):"0"}getPremiumPercent(){let e=this.stats().total;return e>0?(this.stats().premium/e*100).toFixed(1):"0"}getChinesePercent(){let e=this.stats().total;return e>0?(this.stats().chinese/e*100).toFixed(1):"0"}getContactedPercent(){let e=this.stats().total;return e>0?(this.stats().contacted/e*100).toFixed(1):"0"}getConvertedPercent(){let e=this.stats().contacted;return e>0?(this.stats().converted/e*100).toFixed(1):"0"}getAvatarLetter(e){return(e.first_name||e.username||"?").charAt(0).toUpperCase()}getStatusIcon(e){switch(e){case"online":return"\u{1F7E2}";case"recently":return"\u{1F7E1}";case"last_week":return"\u{1F7E0}";case"last_month":return"\u26AA";default:return"\u26AA"}}getStatusText(e){switch(e){case"online":return"\u5728\u7DDA";case"recently":return"\u6700\u8FD1";case"last_week":return"\u672C\u9031";case"last_month":return"\u672C\u6708";case"long_ago":return"\u96E2\u7DDA";default:return"\u672A\u77E5"}}isChinese(e){let t=(e.first_name||"")+(e.last_name||""),n=e.bio||"",o=/[\u4e00-\u9fff]/;return o.test(t)||o.test(n)}getMemberTags(e){if(!e.tags)return[];try{return JSON.parse(e.tags)}catch{return[]}}getGroupsList(e){if(!e.groups)return[];try{return JSON.parse(e.groups)}catch{return[]}}formatDate(e){if(!e)return"-";try{return new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return e}}copyToClipboard(e){navigator.clipboard.writeText(e),this.toastService.success("\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u677F")}openMemberDetail(e){this.selectedMember.set(e),this.memberNotes=e.notes||""}closeMemberDetail(){this.selectedMember.set(null),this.memberNotes=""}saveMemberNotes(){let e=this.selectedMember();e&&(this.ipcService.send("update-member",{userId:e.user_id,updates:{notes:this.memberNotes}}),this.members.update(t=>t.map(n=>n.user_id===e.user_id?N(F({},n),{notes:this.memberNotes}):n)))}openAddTagDialog(){this.showAddTagDialog.set(!0),this.newTagName=""}closeAddTagDialog(){this.showAddTagDialog.set(!1),this.newTagName=""}addTag(){if(!this.newTagName.trim())return;let e=this.selectedMember();if(!e)return;let t=this.getMemberTags(e);t.includes(this.newTagName)||(t.push(this.newTagName),this.ipcService.send("update-member",{userId:e.user_id,updates:{tags:JSON.stringify(t)}}),this.members.update(n=>n.map(o=>o.user_id===e.user_id?N(F({},o),{tags:JSON.stringify(t)}):o)),this.selectedMember.update(n=>n?N(F({},n),{tags:JSON.stringify(t)}):null)),this.closeAddTagDialog()}addSuggestedTag(e){this.newTagName=e,this.addTag()}removeTag(e,t){let n=this.getMemberTags(e).filter(o=>o!==t);this.ipcService.send("update-member",{userId:e.user_id,updates:{tags:JSON.stringify(n)}}),this.members.update(o=>o.map(r=>r.user_id===e.user_id?N(F({},r),{tags:JSON.stringify(n)}):r)),this.selectedMember.update(o=>o?N(F({},o),{tags:JSON.stringify(n)}):null)}sendMessage(e){this.sendMessageEvent.emit(e)}addToFunnel(e){this.addToFunnelEvent.emit(e)}markAsContacted(e){this.ipcService.send("update-member",{userId:e.user_id,updates:{contacted:!0,contacted_at:new Date().toISOString()}}),this.members.update(t=>t.map(n=>n.user_id===e.user_id?N(F({},n),{contacted:!0,contacted_at:new Date().toISOString()}):n)),this.selectedMember.update(t=>t?N(F({},t),{contacted:!0,contacted_at:new Date().toISOString()}):null),this.calculateStats(),this.toastService.success("\u5DF2\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B")}batchSendMessage(){let e=this.members().filter(t=>this.selectedMemberIds().includes(t.user_id));e.length>0&&this.batchSendMessageEvent.emit(e)}batchAddTags(){this.toastService.info("\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64\u529F\u80FD\u958B\u767C\u4E2D...")}batchMarkContacted(){let e=this.selectedMemberIds(),t=new Date().toISOString();e.forEach(n=>{this.ipcService.send("update-member",{userId:n,updates:{contacted:!0,contacted_at:t}})}),this.members.update(n=>n.map(o=>e.includes(o.user_id)?N(F({},o),{contacted:!0,contacted_at:t}):o)),this.calculateStats(),this.applyFilters(),this.clearSelection(),this.toastService.success(`\u5DF2\u5C07 ${e.length} \u500B\u6210\u54E1\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B`)}batchExport(){let e=this.selectedMemberIds(),t=this.members().filter(n=>e.includes(n.user_id));this.exportMembersToCSV(t)}exportMembers(){this.exportMembersToCSV(this.filteredMembers())}exportMembersToCSV(e){let t=["Telegram ID","\u7528\u6236\u540D","\u59D3","\u540D","\u96FB\u8A71","\u7C21\u4ECB","\u8A9E\u8A00","Premium","\u5DF2\u9A57\u8B49","\u6709\u982D\u50CF","\u5728\u7DDA\u72C0\u614B","\u6700\u5F8C\u5728\u7DDA","\u6D3B\u8E8D\u5206\u6578","\u50F9\u503C\u7B49\u7D1A","\u4F86\u6E90\u7FA4\u7D44","\u4F86\u6E90\u7FA4\u7D44ID","\u63D0\u53D6\u6642\u9593","\u6A19\u7C64","\u5099\u8A3B","\u5DF2\u806F\u7E6B","\u806F\u7E6B\u6642\u9593","\u5DF2\u8F49\u5316"],n=e.map(g=>[g.user_id,g.username||"",g.last_name||"",g.first_name||"",g.phone||"",g.bio||"",g.language_code||"",g.is_premium?"\u662F":"\u5426",g.is_verified?"\u662F":"\u5426",g.has_photo?"\u662F":"\u5426",this.getStatusText(g.online_status),g.last_online||"",g.activity_score?.toString()||"",g.value_level||"",g.source_chat_title||"",g.source_chat_id||"",g.extracted_at||"",this.getMemberTags(g).join("; "),g.notes||"",g.contacted?"\u662F":"\u5426",g.contacted_at||"",g.converted?"\u662F":"\u5426"]),o=g=>g.includes(",")||g.includes('"')||g.includes(`
`)?`"${g.replace(/"/g,'""')}"`:g,r=[t,...n].map(g=>g.map(o).join(",")).join(`
`),c=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8"}),m=URL.createObjectURL(c),h=document.createElement("a");h.href=m,h.download=`members_${new Date().toISOString().slice(0,10)}.csv`,h.click(),URL.revokeObjectURL(m),this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}deduplicateMembers(){this.toastService.info("\u{1F504} \u6B63\u5728\u57F7\u884C\u667A\u80FD\u53BB\u91CD..."),this.ipcService.send("deduplicate-members",{});let e=this.ipcService.on("members-deduplicated",t=>{e(),t.success?(this.toastService.success(`\u2705 \u53BB\u91CD\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${t.mergedCount||0} \u500B\u91CD\u8907\u6210\u54E1`),this.loadMembers()):this.toastService.error(`\u53BB\u91CD\u5931\u6557: ${t.error}`)})}recalculateScores(){this.toastService.info("\u{1F4CA} \u6B63\u5728\u91CD\u65B0\u8A08\u7B97\u8A55\u5206..."),this.ipcService.send("recalculate-scores",{});let e=this.ipcService.on("scores-recalculated",t=>{e(),t.success?(this.toastService.success(`\u2705 \u8A55\u5206\u8A08\u7B97\u5B8C\u6210\uFF01\u66F4\u65B0\u4E86 ${t.updatedCount||0} \u500B\u6210\u54E1`),this.loadMembers()):this.toastService.error(`\u8A08\u7B97\u5931\u6557: ${t.error}`)})}showGroupProfile(){if(!this.selectedSource){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u4F86\u6E90\u7FA4\u7D44");return}this.toastService.info("\u{1F4C8} \u6B63\u5728\u751F\u6210\u7FA4\u7D44\u756B\u50CF..."),this.ipcService.send("get-group-profile",{chatId:this.selectedSource});let e=this.ipcService.on("group-profile-result",t=>{if(e(),t.success&&t.profile){let n=t.profile;this.toastService.success(`
          \u{1F4CA} \u7FA4\u7D44\u756B\u50CF\uFF1A
          \u8CEA\u91CF\u5206\u6578: ${n.qualityScore}/100
          \u7E3D\u6210\u54E1: ${n.totalMembers}
          Premium: ${n.premiumRate}%
          \u6D3B\u8E8D\u7387: ${n.activeRate}%
        `.trim())}else this.toastService.error(`\u7372\u53D6\u756B\u50CF\u5931\u6557: ${t.error}`)})}compareGroups(){let e=this.sourceGroups();if(e.length<2){this.toastService.warning("\u9700\u8981\u81F3\u5C112\u500B\u7FA4\u7D44\u624D\u80FD\u9032\u884C\u5C0D\u6BD4");return}let t=e.slice(0,5).map(o=>o.group);this.toastService.info("\u{1F4CA} \u6B63\u5728\u5C0D\u6BD4\u7FA4\u7D44..."),this.ipcService.send("compare-groups",{chatIds:t});let n=this.ipcService.on("groups-compared",o=>{if(n(),o.success&&o.comparison){let r=o.comparison;this.toastService.success(`
          \u{1F4CA} \u7FA4\u7D44\u5C0D\u6BD4\u5B8C\u6210\uFF01
          \u6700\u9AD8\u8CEA\u91CF: ${r.bestGroup?.name||"\u672A\u77E5"}
          \u5E73\u5747\u8CEA\u91CF: ${r.avgQuality}/100
          \u5C0D\u6BD4\u7FA4\u7D44\u6578: ${r.groupCount}
        `.trim())}else this.toastService.error(`\u5C0D\u6BD4\u5931\u6557: ${o.error}`)})}viewExtractionStats(){this.toastService.info("\u{1F4C9} \u6B63\u5728\u7372\u53D6\u63D0\u53D6\u7D71\u8A08..."),this.ipcService.send("get-extraction-stats",{});let e=this.ipcService.on("extraction-stats-result",t=>{if(e(),t.success&&t.stats){let n=t.stats;this.toastService.success(`
          \u{1F4C9} \u63D0\u53D6\u7D71\u8A08\uFF1A
          \u6210\u529F\u7387: ${n.successRate}%
          \u7E3D\u63D0\u53D6: ${n.totalExtractions}
          \u6210\u529F: ${n.successCount}
          \u5931\u6557: ${n.failedCount}
        `.trim())}else this.toastService.error(`\u7372\u53D6\u7D71\u8A08\u5931\u6557: ${t.error}`)})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-member-database"]],outputs:{sendMessageEvent:"sendMessageEvent",addToFunnelEvent:"addToFunnelEvent",batchSendMessageEvent:"batchSendMessageEvent"},decls:156,vars:47,consts:[[1,"member-database-container"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"relative","inline-block",2,"position","relative"],[1,"btn-secondary",3,"click"],[1,"absolute","right-0","mt-2","w-56","bg-slate-800","rounded-xl","shadow-xl","border","border-slate-700","py-2","z-50",2,"position","absolute","right","0","margin-top","8px","width","240px"],[1,"btn-secondary",3,"click","disabled"],[1,"btn-primary",3,"click","disabled"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-value"],[1,"stat-label"],[1,"stat-badge","success"],[1,"stat-card","online"],[1,"stat-percent"],[1,"stat-card","premium"],[1,"stat-card","chinese"],[1,"stat-card","contacted"],[1,"stat-card","converted"],[1,"filter-section"],[1,"filter-row"],[1,"search-box"],[1,"search-icon"],["type","text","placeholder","\u641C\u7D22\u59D3\u540D\u3001\u7528\u6236\u540D\u3001ID...",1,"search-input",3,"ngModelChange","ngModel"],[1,"search-clear"],[1,"filter-select",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["value","online"],["value","recently"],["value","last_week"],["value","long_ago"],["value","S"],["value","A"],["value","B"],["value","C"],["value","D"],[1,"filter-checkbox"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"btn-text"],[1,"filter-result"],[1,"member-list-section"],[1,"loading-state"],[1,"empty-state"],[1,"w-full","px-4","py-2","text-left","hover:bg-slate-700","flex","items-center","gap-2",2,"display","flex","align-items","center","padding","8px 16px",3,"click"],[1,"ml-auto","text-xs","text-slate-400",2,"margin-left","auto","font-size","11px","color","#94a3b8"],[1,"border-t","border-slate-700","my-1",2,"border-top","1px solid #334155","margin","4px 0"],[1,"search-clear",3,"click"],[1,"btn-text",3,"click"],[1,"loading-spinner"],[1,"empty-icon"],[1,"batch-action-bar"],[1,"member-table-container"],[1,"member-table"],[1,"col-checkbox"],["type","checkbox",3,"change","checked","indeterminate"],[1,"col-id",3,"click"],[1,"col-user",3,"click"],[1,"col-username"],[1,"col-status",3,"click"],[1,"col-level",3,"click"],[1,"col-source"],[1,"col-tags"],[1,"col-contacted"],[1,"col-actions"],[3,"selected"],[1,"pagination"],[1,"page-info"],[1,"page-controls"],[1,"page-btn",3,"click","disabled"],[1,"page-number"],[1,"page-size-select",3,"ngModelChange","ngModel"],[1,"selected-count"],[1,"batch-actions"],[1,"btn-batch",3,"click"],[1,"btn-batch","danger",3,"click"],[3,"click"],[1,"col-checkbox",3,"click"],["type","checkbox",3,"change","checked"],[1,"col-id"],[1,"user-id",3,"title"],[1,"col-user"],[1,"user-info"],[1,"user-avatar"],[1,"user-name-wrapper"],[1,"user-name"],["title","Premium",1,"premium-badge"],["title","\u5DF2\u9A57\u8B49",1,"verified-badge"],["title","\u83EF\u4EBA",1,"chinese-badge"],[1,"user-bio",3,"title"],["target","_blank",1,"username-link",3,"href"],[1,"no-username"],[1,"col-status"],[1,"status-badge"],[1,"col-level"],[1,"level-badge"],[1,"source-name",3,"title"],[1,"tags-container"],[1,"no-tags"],[1,"contacted-badge","yes"],[1,"contacted-badge","no"],[1,"col-actions",3,"click"],[1,"action-buttons"],["title","\u767C\u6D88\u606F",1,"action-btn",3,"click"],["title","\u52A0\u5165\u6F0F\u6597",1,"action-btn",3,"click"],["title","\u67E5\u770B\u8A73\u60C5",1,"action-btn",3,"click"],["target","_blank",1,"username-link",3,"click","href"],[1,"tag"],[1,"tag-more"],[1,"member-detail-overlay",3,"click"],[1,"member-detail-drawer"],[1,"drawer-header"],[1,"close-btn",3,"click"],[1,"drawer-content"],[1,"detail-section"],[1,"member-profile"],[1,"profile-avatar"],[1,"profile-info"],[1,"profile-name"],[1,"premium-badge"],["target","_blank",1,"profile-username",3,"href"],[1,"section-title"],[1,"detail-grid"],[1,"detail-item"],[1,"detail-label"],[1,"detail-value","copyable",3,"click"],[1,"copy-icon"],[1,"detail-value"],[1,"status-tags"],[1,"status-tag","premium"],[1,"status-tag","verified"],[1,"status-tag","photo"],[1,"status-tag","chinese"],[1,"status-tag","danger"],[1,"status-tag","deleted"],[1,"source-list"],[1,"source-item"],[1,"source-name"],[1,"source-date"],[1,"tags-edit"],[1,"tag","editable"],[1,"add-tag-btn",3,"click"],["placeholder","\u6DFB\u52A0\u8DDF\u9032\u5099\u8A3B...",1,"notes-textarea",3,"ngModelChange","blur","ngModel"],[1,"marketing-status"],[1,"status-item"],[1,"status-label"],[1,"status-value"],[1,"drawer-footer"],[1,"btn-primary",3,"click"],[1,"btn-secondary"],[1,"bio-text"],[1,"tag-remove",3,"click"],[1,"dialog-overlay",3,"click"],[1,"dialog"],[1,"dialog-header"],[1,"dialog-content"],["type","text","placeholder","\u8F38\u5165\u6A19\u7C64\u540D\u7A31...",1,"tag-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"suggested-tags"],[1,"suggested-title"],[1,"suggested-list"],[1,"suggested-tag"],[1,"dialog-footer"],[1,"suggested-tag",3,"click"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u{1F4C1}"),a(),l(6," \u6210\u54E1\u8CC7\u6599\u5EAB "),a(),s(7,"p",5),l(8,"\u7BA1\u7406\u548C\u5206\u6790\u63D0\u53D6\u7684 Telegram \u6210\u54E1\u6578\u64DA"),a()(),s(9,"div",6)(10,"div",7)(11,"button",8),b("click",function(){return n.showAdvancedMenu.set(!n.showAdvancedMenu())}),l(12," \u{1F6E0}\uFE0F \u9AD8\u7D1A\u5DE5\u5177 \u25BE "),a(),w(13,qS,23,0,"div",9),a(),s(14,"button",10),b("click",function(){return n.refreshMembers()}),s(15,"span"),l(16,"\u{1F504}"),a(),l(17),a(),s(18,"button",11),b("click",function(){return n.exportMembers()}),l(19," \u{1F4E5} \u5C0E\u51FA CSV "),a()()(),s(20,"div",12)(21,"div",13)(22,"div",14),l(23,"\u{1F465}"),a(),s(24,"div",15)(25,"div",16),l(26),Le(27,"number"),a(),s(28,"div",17),l(29,"\u7E3D\u6210\u54E1\u6578"),a()(),w(30,$S,2,1,"div",18),a(),s(31,"div",19)(32,"div",14),l(33,"\u{1F7E2}"),a(),s(34,"div",15)(35,"div",16),l(36),Le(37,"number"),a(),s(38,"div",17),l(39,"\u5728\u7DDA\u6210\u54E1"),a()(),s(40,"div",20),l(41),a()(),s(42,"div",21)(43,"div",14),l(44,"\u2B50"),a(),s(45,"div",15)(46,"div",16),l(47),Le(48,"number"),a(),s(49,"div",17),l(50,"Premium \u7528\u6236"),a()(),s(51,"div",20),l(52),a()(),s(53,"div",22)(54,"div",14),l(55,"\u{1F1E8}\u{1F1F3}"),a(),s(56,"div",15)(57,"div",16),l(58),Le(59,"number"),a(),s(60,"div",17),l(61,"\u83EF\u4EBA\u6210\u54E1"),a()(),s(62,"div",20),l(63),a()(),s(64,"div",23)(65,"div",14),l(66,"\u{1F4AC}"),a(),s(67,"div",15)(68,"div",16),l(69),Le(70,"number"),a(),s(71,"div",17),l(72,"\u5DF2\u806F\u7E6B"),a()(),s(73,"div",20),l(74),a()(),s(75,"div",24)(76,"div",14),l(77,"\u2705"),a(),s(78,"div",15)(79,"div",16),l(80),Le(81,"number"),a(),s(82,"div",17),l(83,"\u5DF2\u8F49\u5316"),a()(),s(84,"div",20),l(85),a()()(),s(86,"div",25)(87,"div",26)(88,"div",27)(89,"span",28),l(90,"\u{1F50D}"),a(),s(91,"input",29),W("ngModelChange",function(r){return z(n.searchQuery,r)||(n.searchQuery=r),r}),b("ngModelChange",function(r){return n.onSearchChange(r)}),a(),w(92,HS,2,0,"button",30),a(),s(93,"select",31),W("ngModelChange",function(r){return z(n.selectedSource,r)||(n.selectedSource=r),r}),b("ngModelChange",function(){return n.applyFilters()}),s(94,"option",32),l(95,"\u6240\u6709\u4F86\u6E90\u7FA4\u7D44"),a(),$(96,KS,2,3,"option",33,GS),a(),s(98,"select",31),W("ngModelChange",function(r){return z(n.selectedOnlineStatus,r)||(n.selectedOnlineStatus=r),r}),b("ngModelChange",function(){return n.applyFilters()}),s(99,"option",32),l(100,"\u6240\u6709\u72C0\u614B"),a(),s(101,"option",34),l(102,"\u{1F7E2} \u5728\u7DDA"),a(),s(103,"option",35),l(104,"\u{1F7E1} \u6700\u8FD1\u4E0A\u7DDA"),a(),s(105,"option",36),l(106,"\u{1F7E0} \u672C\u9031\u4E0A\u7DDA"),a(),s(107,"option",37),l(108,"\u26AA \u9577\u671F\u96E2\u7DDA"),a()(),s(109,"select",31),W("ngModelChange",function(r){return z(n.selectedValueLevel,r)||(n.selectedValueLevel=r),r}),b("ngModelChange",function(){return n.applyFilters()}),s(110,"option",32),l(111,"\u6240\u6709\u7B49\u7D1A"),a(),s(112,"option",38),l(113,"S \u7D1A - \u9802\u7D1A"),a(),s(114,"option",39),l(115,"A \u7D1A - \u512A\u8CEA"),a(),s(116,"option",40),l(117,"B \u7D1A - \u666E\u901A"),a(),s(118,"option",41),l(119,"C \u7D1A - \u4E00\u822C"),a(),s(120,"option",42),l(121,"D \u7D1A - \u4F4E\u50F9\u503C"),a()()(),s(122,"div",26)(123,"label",43)(124,"input",44),W("ngModelChange",function(r){return z(n.filterPremium,r)||(n.filterPremium=r),r}),b("ngModelChange",function(){return n.applyFilters()}),a(),s(125,"span"),l(126,"\u2B50 Premium"),a()(),s(127,"label",43)(128,"input",44),W("ngModelChange",function(r){return z(n.filterChinese,r)||(n.filterChinese=r),r}),b("ngModelChange",function(){return n.applyFilters()}),a(),s(129,"span"),l(130,"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA"),a()(),s(131,"label",43)(132,"input",44),W("ngModelChange",function(r){return z(n.filterHasUsername,r)||(n.filterHasUsername=r),r}),b("ngModelChange",function(){return n.applyFilters()}),a(),s(133,"span"),l(134,"\u{1F4DB} \u6709\u7528\u6236\u540D"),a()(),s(135,"label",43)(136,"input",44),W("ngModelChange",function(r){return z(n.filterNotContacted,r)||(n.filterNotContacted=r),r}),b("ngModelChange",function(){return n.applyFilters()}),a(),s(137,"span"),l(138,"\u{1F4ED} \u672A\u806F\u7E6B"),a()(),s(139,"label",43)(140,"input",44),W("ngModelChange",function(r){return z(n.filterHasPhoto,r)||(n.filterHasPhoto=r),r}),b("ngModelChange",function(){return n.applyFilters()}),a(),s(141,"span"),l(142,"\u{1F4F7} \u6709\u982D\u50CF"),a()(),w(143,zS,2,0,"button",45),s(144,"div",46),l(145," \u627E\u5230 "),s(146,"strong"),l(147),Le(148,"number"),a(),l(149," \u500B\u6210\u54E1 "),a()()(),s(150,"div",47),w(151,WS,4,0,"div",48)(152,JS,7,0,"div",49)(153,py,55,21),a(),w(154,ky,99,37),w(155,Fy,20,2),a()),t&2&&(d(13),E(n.showAdvancedMenu()?13:-1),d(),V("disabled",n.isLoading()),d(),I("animate-spin",n.isLoading()),d(2),A(" ",n.isLoading()?"\u8F09\u5165\u4E2D...":"\u5237\u65B0"," "),d(),V("disabled",n.filteredMembers().length===0),d(8),M(et(27,33,n.stats().total)),d(4),E(n.stats().todayNew>0?30:-1),d(6),M(et(37,35,n.stats().online)),d(5),A("",n.getOnlinePercent(),"%"),d(6),M(et(48,37,n.stats().premium)),d(5),A("",n.getPremiumPercent(),"%"),d(6),M(et(59,39,n.stats().chinese)),d(5),A("",n.getChinesePercent(),"%"),d(6),M(et(70,41,n.stats().contacted)),d(5),A("",n.getContactedPercent(),"%"),d(6),M(et(81,43,n.stats().converted)),d(5),A("",n.getConvertedPercent(),"%"),d(6),K("ngModel",n.searchQuery),d(),E(n.searchQuery?92:-1),d(),K("ngModel",n.selectedSource),d(3),H(n.sourceGroups()),d(2),K("ngModel",n.selectedOnlineStatus),d(11),K("ngModel",n.selectedValueLevel),d(15),K("ngModel",n.filterPremium),d(4),K("ngModel",n.filterChinese),d(4),K("ngModel",n.filterHasUsername),d(4),K("ngModel",n.filterNotContacted),d(4),K("ngModel",n.filterHasPhoto),d(3),E(n.hasActiveFilters()?143:-1),d(4),M(et(148,45,n.filteredMembers().length)),d(4),E(n.isLoading()?151:n.filteredMembers().length===0?152:153),d(3),E(n.selectedMember()?154:-1),d(),E(n.showAddTagDialog()?155:-1))},dependencies:[oe,ue,He,Ke,xe,Jt,nt,fe,_e,Wt],styles:[".member-database-container[_ngcontent-%COMP%]{padding:1.5rem;height:100%;overflow-y:auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#fff;display:flex;align-items:center;gap:.5rem;margin:0}.title-icon[_ngcontent-%COMP%]{font-size:1.75rem}.page-desc[_ngcontent-%COMP%]{color:#94a3b8;margin:.25rem 0 0;font-size:.875rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.btn-primary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .2s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#47556980;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#e2e8f0;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .2s}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#475569b3;border-color:#94a3b84d}.btn-secondary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-text[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:none;color:#94a3b8;cursor:pointer;font-size:.875rem}.btn-text[_ngcontent-%COMP%]:hover{color:#f87171}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{background:#1e293bcc;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;padding:1rem;display:flex;align-items:center;gap:.75rem;position:relative}.stat-icon[_ngcontent-%COMP%]{font-size:1.5rem}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:.75rem;color:#94a3b8}.stat-badge[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem;padding:.125rem .375rem;border-radius:.25rem;font-size:.625rem;font-weight:600}.stat-badge.success[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.stat-percent[_ngcontent-%COMP%]{font-size:.875rem;color:#94a3b8}.stat-card.online[_ngcontent-%COMP%]{border-left:3px solid #22c55e}.stat-card.premium[_ngcontent-%COMP%]{border-left:3px solid #f59e0b}.stat-card.chinese[_ngcontent-%COMP%]{border-left:3px solid #ef4444}.stat-card.contacted[_ngcontent-%COMP%]{border-left:3px solid #3b82f6}.stat-card.converted[_ngcontent-%COMP%]{border-left:3px solid #8b5cf6}.filter-section[_ngcontent-%COMP%]{background:#1e293b99;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;padding:1rem;margin-bottom:1rem}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:.75rem;margin-bottom:.75rem}.filter-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.search-box[_ngcontent-%COMP%]{position:relative;flex:1;min-width:200px;max-width:300px}.search-icon[_ngcontent-%COMP%]{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);font-size:.875rem}.search-input[_ngcontent-%COMP%]{width:100%;padding:.5rem 2rem .5rem 2.25rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.search-clear[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;color:#94a3b8;cursor:pointer;font-size:.75rem}.filter-select[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;min-width:140px}.filter-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.filter-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;padding:.375rem .75rem;background:#0f172a4d;border:1px solid rgba(148,163,184,.15);border-radius:.5rem;color:#e2e8f0;font-size:.8rem;cursor:pointer;transition:all .2s}.filter-checkbox[_ngcontent-%COMP%]:hover{background:#0f172a80;border-color:#94a3b840}.filter-checkbox[_ngcontent-%COMP%]:has(input:checked){background:#06b6d426;border-color:#06b6d466}.filter-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.filter-result[_ngcontent-%COMP%]{margin-left:auto;color:#94a3b8;font-size:.875rem}.member-list-section[_ngcontent-%COMP%]{background:#1e293b99;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;overflow:hidden}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:#94a3b8}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(6,182,212,.2);border-top-color:#06b6d4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;margin:0 0 .5rem}.batch-action-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;background:#06b6d41a;border-bottom:1px solid rgba(6,182,212,.2)}.selected-count[_ngcontent-%COMP%]{color:#22d3ee;font-weight:500}.batch-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.btn-batch[_ngcontent-%COMP%]{padding:.375rem .75rem;background:#1e293bcc;border:1px solid rgba(148,163,184,.2);border-radius:.375rem;color:#e2e8f0;font-size:.8rem;cursor:pointer;transition:all .2s}.btn-batch[_ngcontent-%COMP%]:hover{background:#334155cc}.btn-batch.danger[_ngcontent-%COMP%]{color:#f87171}.btn-batch.danger[_ngcontent-%COMP%]:hover{background:#ef444433}.member-table-container[_ngcontent-%COMP%]{overflow-x:auto}.member-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:left;background:#0f172a80;color:#94a3b8;font-weight:500;border-bottom:1px solid rgba(148,163,184,.1);cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover{background:#0f172ab3}.member-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;border-bottom:1px solid rgba(148,163,184,.05);color:#e2e8f0}.member-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s}.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#3341554d}.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background:#06b6d41a}.col-checkbox[_ngcontent-%COMP%]{width:40px}.col-id[_ngcontent-%COMP%]{width:120px}.col-user[_ngcontent-%COMP%]{min-width:180px}.col-username[_ngcontent-%COMP%]{width:120px}.col-status[_ngcontent-%COMP%]{width:100px}.col-level[_ngcontent-%COMP%]{width:60px}.col-source[_ngcontent-%COMP%]{width:150px}.col-tags[_ngcontent-%COMP%]{width:120px}.col-contacted[_ngcontent-%COMP%], .col-actions[_ngcontent-%COMP%]{width:100px}.user-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:#94a3b8}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#475569,#334155);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:500;font-size:.875rem}.user-avatar.has-photo[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.user-name-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.premium-badge[_ngcontent-%COMP%], .verified-badge[_ngcontent-%COMP%], .chinese-badge[_ngcontent-%COMP%]{font-size:.75rem}.user-bio[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.username-link[_ngcontent-%COMP%]{color:#22d3ee;text-decoration:none}.username-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.no-username[_ngcontent-%COMP%], .no-tags[_ngcontent-%COMP%]{color:#475569}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.status-badge.status-online[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.status-badge.status-recently[_ngcontent-%COMP%]{background:#eab30833;color:#fde047}.status-badge.status-last_week[_ngcontent-%COMP%]{background:#f9731633;color:#fdba74}.status-badge.status-last_month[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.status-badge.status-long_ago[_ngcontent-%COMP%], .status-badge.status-unknown[_ngcontent-%COMP%]{background:#47556933;color:#64748b}.level-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;font-size:.75rem;font-weight:600}.level-badge.level-S[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.level-badge.level-A[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff}.level-badge.level-B[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.level-badge.level-C[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.level-badge.level-D[_ngcontent-%COMP%]{background:#47556980;color:#94a3b8}.source-name[_ngcontent-%COMP%]{max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block}.tags-container[_ngcontent-%COMP%]{display:flex;gap:.25rem;flex-wrap:wrap}.tag[_ngcontent-%COMP%]{padding:.125rem .375rem;background:#3b82f633;border-radius:.25rem;font-size:.7rem;color:#93c5fd}.tag-more[_ngcontent-%COMP%]{padding:.125rem .375rem;background:#4755694d;border-radius:.25rem;font-size:.7rem;color:#94a3b8}.contacted-badge[_ngcontent-%COMP%]{font-size:.75rem}.contacted-badge.yes[_ngcontent-%COMP%]{color:#86efac}.contacted-badge.no[_ngcontent-%COMP%]{color:#94a3b8}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem}.action-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;font-size:.875rem;cursor:pointer;transition:all .2s}.action-btn[_ngcontent-%COMP%]:hover{background:#475569b3}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:#0f172a4d;border-top:1px solid rgba(148,163,184,.1)}.page-info[_ngcontent-%COMP%]{color:#94a3b8;font-size:.875rem}.page-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.page-btn[_ngcontent-%COMP%]{padding:.375rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;font-size:.75rem;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#475569b3}.page-number[_ngcontent-%COMP%]{color:#fff;font-size:.875rem;padding:0 .5rem}.page-size-select[_ngcontent-%COMP%]{padding:.375rem .5rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;color:#fff;font-size:.75rem}.member-detail-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:100}.member-detail-drawer[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:400px;max-width:90vw;height:100vh;background:#1e293b;border-left:1px solid rgba(148,163,184,.1);z-index:101;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%)}to{transform:translate(0)}}.drawer-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.25rem;border-bottom:1px solid rgba(148,163,184,.1)}.drawer-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;color:#fff}.close-btn[_ngcontent-%COMP%]{padding:.375rem;background:#47556980;border:none;border-radius:.375rem;color:#94a3b8;cursor:pointer;font-size:1rem}.close-btn[_ngcontent-%COMP%]:hover{background:#475569cc;color:#fff}.drawer-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.25rem}.detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.section-title[_ngcontent-%COMP%]{font-size:.875rem;color:#94a3b8;margin:0 0 .75rem;display:flex;align-items:center;gap:.375rem}.member-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.profile-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#475569,#334155);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:1.5rem}.profile-avatar.has-photo[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.profile-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.profile-name[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;color:#fff;display:flex;align-items:center;gap:.375rem}.profile-username[_ngcontent-%COMP%]{color:#22d3ee;text-decoration:none;font-size:.875rem}.profile-username[_ngcontent-%COMP%]:hover{text-decoration:underline}.detail-grid[_ngcontent-%COMP%]{display:grid;gap:.75rem}.detail-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.detail-label[_ngcontent-%COMP%]{color:#64748b;font-size:.875rem}.detail-value[_ngcontent-%COMP%]{color:#fff;font-size:.875rem}.detail-value.copyable[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;gap:.375rem}.detail-value.copyable[_ngcontent-%COMP%]:hover{color:#22d3ee}.copy-icon[_ngcontent-%COMP%]{font-size:.75rem;opacity:.5}.status-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.status-tag[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.status-tag.premium[_ngcontent-%COMP%]{background:#f59e0b33;color:#fbbf24}.status-tag.verified[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.status-tag.photo[_ngcontent-%COMP%]{background:#3b82f633;color:#93c5fd}.status-tag.chinese[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.status-tag.danger[_ngcontent-%COMP%]{background:#ef44444d;color:#f87171}.status-tag.deleted[_ngcontent-%COMP%]{background:#4755694d;color:#94a3b8}.bio-text[_ngcontent-%COMP%]{color:#cbd5e1;font-size:.875rem;line-height:1.5;background:#0f172a80;padding:.75rem;border-radius:.5rem;margin:0}.source-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.source-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:#0f172a80;border-radius:.375rem}.source-item[_ngcontent-%COMP%]   .source-name[_ngcontent-%COMP%]{color:#fff;font-size:.875rem}.source-date[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem}.tags-edit[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.tag.editable[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.tag-remove[_ngcontent-%COMP%]{background:none;border:none;color:#64748b;cursor:pointer;font-size:.625rem;padding:0}.tag-remove[_ngcontent-%COMP%]:hover{color:#f87171}.add-tag-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px dashed rgba(148,163,184,.3);border-radius:.25rem;color:#94a3b8;font-size:.75rem;cursor:pointer}.add-tag-btn[_ngcontent-%COMP%]:hover{background:#334155b3;color:#fff}.notes-textarea[_ngcontent-%COMP%]{width:100%;min-height:80px;padding:.75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;resize:vertical}.notes-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.marketing-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.status-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:#0f172a4d;border-radius:.375rem}.status-label[_ngcontent-%COMP%]{color:#64748b;font-size:.875rem}.status-value[_ngcontent-%COMP%]{font-size:.875rem}.status-value.contacted[_ngcontent-%COMP%]{color:#86efac}.status-value.converted[_ngcontent-%COMP%]{color:#c084fc}.drawer-footer[_ngcontent-%COMP%]{padding:1rem 1.25rem;border-top:1px solid rgba(148,163,184,.1);display:flex;gap:.75rem}.drawer-footer[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], .drawer-footer[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{flex:1;justify-content:center}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:200}.dialog[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;max-width:90vw;background:#1e293b;border:1px solid rgba(148,163,184,.2);border-radius:.75rem;z-index:201}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.25rem;border-bottom:1px solid rgba(148,163,184,.1)}.dialog-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff}.dialog-content[_ngcontent-%COMP%]{padding:1.25rem}.tag-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;margin-bottom:1rem}.tag-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.suggested-tags[_ngcontent-%COMP%]{margin-top:1rem}.suggested-title[_ngcontent-%COMP%]{color:#94a3b8;font-size:.75rem;margin:0 0 .5rem}.suggested-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.suggested-tag[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;color:#e2e8f0;font-size:.75rem;cursor:pointer}.suggested-tag[_ngcontent-%COMP%]:hover{background:#06b6d433;border-color:#06b6d466}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.25rem;border-top:1px solid rgba(148,163,184,.1)}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"],changeDetection:0})}};var Ct=class i{constructor(e,t){this.ipcService=e;this.toastService=t;this._isInitialized=C(!1);this._isLoading=C(!1);this._isSearching=C(!1);this._stats=C(null);this._recentKnowledge=C([]);this._learningEvents=C([]);this._searchResults=C([]);this._buildProgress=C(null);this._healthScore=C(0);this._knowledgeGaps=C([]);this._healthReport=C(null);this._guidedQuestion=C(null);this._guidedAnswers=C({});this._lastImportResult=C(null);this._lastError=C(null);this.lastError=L(()=>this._lastError());this._pendingRequests=new Map;this.REQUEST_TIMEOUT=15e3;this._currentRequest=C(null);this._requestStartTime=C(0);this.currentRequest=L(()=>this._currentRequest());this.requestElapsed=L(()=>{let e=this._requestStartTime();return e?Date.now()-e:0});this.isInitialized=L(()=>this._isInitialized());this.isLoading=L(()=>this._isLoading());this.isSearching=L(()=>this._isSearching());this.stats=L(()=>this._stats());this.recentKnowledge=L(()=>this._recentKnowledge());this.learningEvents=L(()=>this._learningEvents());this.searchResults=L(()=>this._searchResults());this.buildProgress=L(()=>this._buildProgress());this.healthScore=L(()=>this._healthScore());this.knowledgeGaps=L(()=>this._knowledgeGaps());this.healthReport=L(()=>this._healthReport());this.guidedQuestion=L(()=>this._guidedQuestion());this.gapsCount=L(()=>this._knowledgeGaps().length);this.totalKnowledge=L(()=>this._stats()?.totalKnowledge||0);this.hitRate=L(()=>{let e=this._stats();return!e||e.totalKnowledge===0?0:Math.round(e.totalUses/Math.max(1,e.totalKnowledge*10)*100)});this.todayLearned=L(()=>this._learningEvents().filter(e=>{let t=new Date().toDateString();return new Date(e.timestamp).toDateString()===t}).length);this.setupEventListeners()}clearLastError(){this._lastError.set(null)}startRequestWithTimeout(e,t=this.REQUEST_TIMEOUT){this.cancelRequest(e),this._currentRequest.set(e),this._requestStartTime.set(Date.now());let n=setTimeout(()=>{console.warn(`[RAGBrain] Request timeout: ${e}`),this._isLoading.set(!1),this._currentRequest.set(null),this._requestStartTime.set(0),this._pendingRequests.delete(e),this.toastService.error(`\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66 (${this.getRequestDisplayName(e)})`),(e==="build"||e==="guided-build")&&this._buildProgress.set(null),e==="search"&&this._searchResults.set([])},t);this._pendingRequests.set(e,n)}getRequestDisplayName(e){return{initialize:"\u521D\u59CB\u5316",search:"\u641C\u7D22",build:"\u69CB\u5EFA\u77E5\u8B58\u5EAB","guided-build":"\u5F15\u5C0E\u5F0F\u69CB\u5EFA","import-url":"\u7DB2\u9801\u5C0E\u5165","import-doc":"\u6587\u6A94\u5C0E\u5165"}[e]||e}getCurrentRequestName(){let e=this._currentRequest();return e?this.getRequestDisplayName(e):""}completeRequest(e){let t=this._pendingRequests.get(e);t&&(clearTimeout(t),this._pendingRequests.delete(e)),this._currentRequest()===e&&(this._currentRequest.set(null),this._requestStartTime.set(0))}cancelRequest(e){let t=this._pendingRequests.get(e);t&&(clearTimeout(t),this._pendingRequests.delete(e)),this._currentRequest()===e&&(this._currentRequest.set(null),this._requestStartTime.set(0))}cancelAllRequests(){this._pendingRequests.forEach(e=>clearTimeout(e)),this._pendingRequests.clear(),this._currentRequest.set(null),this._requestStartTime.set(0)}cancelCurrentRequest(){let e=this._currentRequest();e&&(this.cancelRequest(e),this._isLoading.set(!1),this._buildProgress.set(null),this.toastService.info("\u5DF2\u53D6\u6D88\u8ACB\u6C42"))}setupEventListeners(){this.ipcService.on("rag-initialized",e=>{console.log("[RAGBrain] System initialized:",e),this.completeRequest("initialize"),this._isLoading.set(!1),e.success?(this._isInitialized.set(!0),this.refreshStats(),this.toastService.success("\u{1F9E0} AI \u77E5\u8B58\u5927\u8166\u5DF2\u555F\u52D5")):this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-search-results",e=>{console.log("[RAGBrain] Search results:",e),this.completeRequest("search"),this._isLoading.set(!1),e.success&&e.results?this._searchResults.set(e.results.map(this.mapSearchResult)):e.success||(this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`),this._searchResults.set([]))}),this.ipcService.on("rag-stats-updated",e=>{console.log("[RAGBrain] Stats updated:",e),e.success&&e.stats&&(this._stats.set(this.mapStats(e.stats)),this.calculateHealthScore())}),this.ipcService.on("rag-knowledge-added",e=>{console.log("[RAGBrain] Knowledge added:",e),e.success&&(this.addLearningEvent({type:"new_knowledge",description:`\u6DFB\u52A0\u4E86\u65B0${this.getTypeName(e.knowledgeType)}\u77E5\u8B58`,details:{knowledgeType:e.knowledgeType}}),this.refreshStats())}),this.ipcService.on("rag-auto-learned",e=>{if(console.log("[RAGBrain] Auto learned:",e),e.success&&e.result){let t=e.result,n=(t.qa_extracted||0)+(t.scripts_extracted||0)+(t.objections_extracted||0);n>0&&(this.addLearningEvent({type:"auto_learn",description:`\u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${n} \u689D\u77E5\u8B58`,details:{userId:e.userId,count:n,quality:t.quality_score}}),this.refreshStats(),this.toastService.info(`\u{1F4AC} \u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${n} \u689D\u77E5\u8B58`))}}),this.ipcService.on("rag-build-progress",e=>{console.log("[RAGBrain] Build progress:",e),e.progress&&this._buildProgress.set(e.progress)}),this.ipcService.on("rag-build-complete",e=>{console.log("[RAGBrain] Build complete:",e),this.completeRequest("build"),this._buildProgress.set(null),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u901A\u904E\u5C0D\u8A71\u69CB\u5EFA\u4E86 ${e.totalItems} \u689D\u77E5\u8B58`,details:{count:e.totalItems}}),this.refreshStats(),this._lastImportResult.set({success:!0,totalItems:e.totalItems||0,stats:e.stats||{},source:"conversation"}),this.toastService.success(`\u2728 \u77E5\u8B58\u5927\u8166\u69CB\u5EFA\u5B8C\u6210\uFF01\u5171 ${e.totalItems} \u689D\u77E5\u8B58`)):this.toastService.error(`\u69CB\u5EFA\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-url-imported",e=>{console.log("[RAGBrain] URL imported:",e),this.completeRequest("import-url"),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u5F9E\u7DB2\u9801\u5C0E\u5165\u4E86 ${e.itemsCount} \u689D\u77E5\u8B58`,details:{count:e.itemsCount}}),this.refreshStats(),this.toastService.success(`\u{1F310} \u5DF2\u5F9E\u7DB2\u9801\u5C0E\u5165 ${e.itemsCount} \u689D\u77E5\u8B58`)):e.needsApiKey?(this.toastService.error(`\u26A0\uFE0F ${e.error}`,8e3),this._lastError.set({type:"api_key_missing",message:e.error,action:"configure_ai"})):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-document-imported",e=>{console.log("[RAGBrain] Document imported:",e),this.completeRequest("import-doc"),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u5F9E\u6587\u6A94\u5C0E\u5165\u4E86 ${e.itemsCount} \u689D\u77E5\u8B58`,details:{count:e.itemsCount}}),this.refreshStats(),this.toastService.success(`\u{1F4C4} \u5DF2\u5F9E\u6587\u6A94\u5C0E\u5165 ${e.itemsCount} \u689D\u77E5\u8B58`)):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-gaps-list",e=>{console.log("[RAGBrain] Gaps list:",e),e.success&&e.gaps&&this._knowledgeGaps.set(e.gaps)}),this.ipcService.on("rag-gap-resolved",e=>{console.log("[RAGBrain] Gap resolved:",e),e.success&&(this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e.gapId)),this.toastService.success("\u2705 \u77E5\u8B58\u7F3A\u53E3\u5DF2\u89E3\u6C7A\uFF01"),this.refreshStats())}),this.ipcService.on("rag-gap-ignored",e=>{e.success&&this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e.gapId))}),this.ipcService.on("rag-gap-suggestion",e=>{console.log("[RAGBrain] Gap suggestion:",e),e.success&&e.suggestedAnswer&&this._knowledgeGaps.update(t=>t.map(n=>n.id===e.gapId?N(F({},n),{suggestedAnswer:e.suggestedAnswer}):n))}),this.ipcService.on("rag-health-report",e=>{console.log("[RAGBrain] Health report:",e),e.success&&e.report&&(this._healthReport.set(e.report),this._healthScore.set(e.report.overallScore||0))}),this.ipcService.on("rag-guided-question",e=>{console.log("[RAGBrain] Guided question:",e),this.completeRequest("guided-build"),this._isLoading.set(!1),e.success?this._guidedQuestion.set({step:e.step,totalSteps:e.totalSteps,title:e.title,question:e.question,type:e.type,options:e.options,placeholder:e.placeholder,suggestions:e.suggestions}):this.toastService.error(`\u5F15\u5C0E\u5F0F\u69CB\u5EFA\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-error",e=>{console.error("[RAGBrain] Error event:",e),this.cancelAllRequests(),this._isLoading.set(!1),this._buildProgress.set(null),this.toastService.error(`RAG \u932F\u8AA4: ${e.error||"\u64CD\u4F5C\u5931\u6557"}`)}),this.ipcService.on("backend-status",e=>{e.running||(console.warn("[RAGBrain] Backend disconnected, resetting states"),this.cancelAllRequests(),this._isLoading.set(!1),this._isInitialized.set(!1),this._buildProgress.set(null))})}async initialize(){this._isInitialized()||this._isLoading()||(console.log("[RAGBrain] Initializing..."),this._isLoading.set(!0),this.startRequestWithTimeout("initialize",3e4),this.ipcService.send("rag-initialize",{useChromadb:!0,useNeural:!0}))}refreshStats(){this.ipcService.send("rag-get-stats",{})}search(e,t){this._isLoading()||(this._isLoading.set(!0),this._searchResults.set([]),this.startRequestWithTimeout("search"),this.ipcService.send("rag-search",{query:e,limit:t?.limit||5,knowledgeType:t?.type,minScore:t?.minScore||.3}))}async buildFromConversation(e){this._isLoading()||(this._isLoading.set(!0),this._buildProgress.set({step:1,totalSteps:5,currentAction:"\u5206\u6790\u696D\u52D9\u63CF\u8FF0...",itemsGenerated:0}),this.startRequestWithTimeout("build",12e4),this.ipcService.send("rag-build-from-conversation",e))}importFromUrl(e){this._isLoading()||(this._isLoading.set(!0),this.startRequestWithTimeout("import-url",6e4),this.toastService.info("\u{1F50D} \u6B63\u5728\u89E3\u6790\u7DB2\u9801\u5167\u5BB9..."),this.ipcService.send("rag-import-url",{url:e}))}importFromDocument(e,t){this._isLoading()||(this._isLoading.set(!0),this.startRequestWithTimeout("import-doc",6e4),this.toastService.info("\u{1F4D6} \u6B63\u5728\u89E3\u6790\u6587\u6A94..."),this.ipcService.send("rag-import-document",{filePath:e,fileType:t}))}addKnowledge(e,t,n,o){this.ipcService.send("rag-add-knowledge",{knowledgeType:e,question:t,answer:n,context:o||""})}recordFeedback(e,t){this.ipcService.send("rag-record-feedback",{knowledgeId:e,isPositive:t}),this.addLearningEvent({type:"feedback",description:`\u6536\u5230${t?"\u6B63\u9762":"\u8CA0\u9762"}\u53CD\u994B`,details:{}})}getRecentKnowledge(e=20){this.ipcService.send("rag-get-recent",{limit:e})}cleanupLowQuality(){this.ipcService.send("rag-cleanup",{minScore:.2,minUses:0,daysOld:30})}mergeSimilar(){this.ipcService.send("rag-merge-similar",{similarityThreshold:.9})}getKnowledgeGaps(e=1){this.ipcService.send("rag-get-gaps",{status:"pending",limit:50,minHits:e})}resolveGap(e,t,n,o){this.ipcService.send("rag-resolve-gap",{gapId:e,knowledgeType:t,question:n,answer:o})}ignoreGap(e){this.ipcService.send("rag-ignore-gap",{gapId:e})}deleteGap(e){this.ipcService.send("rag-delete-gap",{gapId:e}),this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e))}deleteGapsBatch(e){this.ipcService.send("rag-delete-gaps-batch",{gapIds:e}),this._knowledgeGaps.update(t=>t.filter(n=>!e.includes(n.id)))}cleanupDuplicateGaps(){this.ipcService.send("rag-cleanup-duplicate-gaps",{}),setTimeout(()=>this.getKnowledgeGaps(),1e3)}suggestGapAnswer(e,t){this.ipcService.send("rag-suggest-gap-answer",{gapId:e,query:t})}getHealthReport(){this.ipcService.send("rag-get-health-report",{})}startGuidedBuild(){this._isLoading()||(this._guidedAnswers.set({}),this._isLoading.set(!0),this.startRequestWithTimeout("guided-build",3e4),this.ipcService.send("rag-start-guided-build",{step:1,answers:{}}))}answerGuidedQuestion(e){let t=this._guidedQuestion();if(!t)return;let n=`step${t.step}`;this._guidedAnswers.update(c=>N(F({},c),{[n]:e}));let o=t.step+1;this._isLoading.set(!0);let r=o>t.totalSteps?12e4:3e4;this.startRequestWithTimeout("guided-build",r),o<=t.totalSteps?this.ipcService.send("rag-start-guided-build",{step:o,answers:this._guidedAnswers()}):(this._guidedQuestion.set(null),this.ipcService.send("rag-start-guided-build",{step:o,answers:this._guidedAnswers()}))}cancelGuidedBuild(){this.cancelRequest("guided-build"),this._guidedQuestion.set(null),this._guidedAnswers.set({}),this._isLoading.set(!1)}addLearningEvent(e){let t=F({id:`event_${Date.now()}`,timestamp:new Date().toISOString()},e);this._learningEvents.update(n=>[t,...n].slice(0,50))}calculateHealthScore(){let e=this._stats();if(!e){this._healthScore.set(0);return}let t=0;t+=Math.min(25,e.totalKnowledge*.5),t+=e.avgScore*25;let n=e.totalUses/Math.max(1,e.totalKnowledge);t+=Math.min(25,n*5);let o=Object.keys(e.byType).length;t+=Math.min(25,o*5),this._healthScore.set(Math.round(t))}mapSearchResult(e){return{item:{id:e.item.id,type:e.item.knowledge_type||e.item.type,question:e.item.question,answer:e.item.answer,context:e.item.context,keywords:e.item.keywords||[],successScore:e.item.success_score||e.item.successScore||.5,useCount:e.item.use_count||e.item.useCount||0,feedbackPositive:e.item.feedback_positive||0,feedbackNegative:e.item.feedback_negative||0,createdAt:e.item.created_at||e.item.createdAt||"",updatedAt:e.item.updated_at||e.item.updatedAt||""},similarity:e.similarity,source:e.source}}mapStats(e){return{totalKnowledge:e.total_knowledge||e.totalKnowledge||0,totalUses:e.total_uses||e.totalUses||0,avgScore:e.avg_score||e.avgScore||0,byType:e.by_type||e.byType||{},vectorCount:e.vector_count||e.vectorCount,chromadbEnabled:e.chromadb_enabled??e.chromadbEnabled??!1,neuralEmbedding:e.neural_embedding??e.neuralEmbedding??!1,learning:e.learning?{sessionsProcessed:e.learning.sessions_processed||0,totalQaExtracted:e.learning.total_qa_extracted||0,totalScriptsExtracted:e.learning.total_scripts_extracted||0,avgQualityScore:e.learning.avg_quality_score||0}:void 0}}getTypeName(e){return{qa:"\u554F\u7B54",script:"\u8A71\u8853",product:"\u7522\u54C1",objection:"\u7570\u8B70\u8655\u7406",greeting:"\u958B\u5834\u767D",closing:"\u6210\u4EA4",faq:"FAQ",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)(rt(De),rt(me))}}static{this.\u0275prov=Te({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Ry=(i,e)=>e.item.id,Io=(i,e)=>e.id,Ny=(i,e)=>e.message,By=(i,e)=>e.name;function Vy(i,e){if(i&1){let t=T();s(0,"div",52),b("click",function(){v(t);let o=f(2);return x(o.scrollToGaps())}),s(1,"span",53),l(2,"\u{1F534}"),a(),s(3,"span",54),l(4),a(),s(5,"span",55),l(6,"\u7ACB\u5373\u8655\u7406 \u2192"),a()()}if(i&2){let t=f(2);d(4),A("",t.ragService.gapsCount()," \u500B\u77E5\u8B58\u7F3A\u53E3\u5F85\u8655\u7406")}}function Ly(i,e){if(i&1&&(s(0,"div",50)(1,"span",56),l(2,"\u{1F7E1}"),a(),s(3,"span",54),l(4),a(),s(5,"span",55),l(6,"\u512A\u5316 \u2192"),a()()),i&2){let t=f(2);d(4),A("\u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u504F\u4F4E (",t.ragService.healthScore(),"%)")}}function Oy(i,e){if(i&1){let t=T();s(0,"div",57),b("click",function(){v(t);let o=f(2);return x(o.focusBuildInput())}),s(1,"span",58),l(2,"\u{1F7E2}"),a(),s(3,"span",54),l(4,"\u5EFA\u8B70\u6DFB\u52A0\u66F4\u591A\u77E5\u8B58"),a(),s(5,"span",55),l(6,"\u958B\u59CB \u2192"),a()()}}function Gy(i,e){if(i&1&&(s(0,"div",45)(1,"div",46)(2,"span",47),l(3,"\u{1F4CC}"),a(),s(4,"span"),l(5,"\u4ECA\u65E5\u5F85\u8FA6"),a()(),s(6,"div",48),w(7,Vy,7,1,"div",49),w(8,Ly,7,1,"div",50),w(9,Oy,7,0,"div",51),a()()),i&2){let t=f();d(7),E(t.ragService.gapsCount()>0?7:-1),d(),E(t.ragService.healthScore()<60?8:-1),d(),E(t.ragService.totalKnowledge()<10?9:-1)}}function Uy(i,e){if(i&1&&(s(0,"div",19)(1,"div",59),k(2,"div",60),a(),s(3,"div",61),l(4),a()()),i&2){let t=e;d(2),j("width",t.step/t.totalSteps*100,"%"),d(2),Y(" ",t.currentAction," (",t.itemsGenerated," \u689D) ")}}function qy(i,e){i&1&&(k(0,"span",62),l(1," \u69CB\u5EFA\u4E2D... "))}function $y(i,e){i&1&&(s(0,"span",14),l(1,"\u2728"),a(),l(2," \u4E00\u9375\u69CB\u5EFA\u77E5\u8B58\u5EAB "))}function Hy(i,e){if(i&1){let t=T();s(0,"button",63),b("click",function(){v(t);let o=f();return x(o.cancelCurrentRequest())}),l(1," \u2715 \u53D6\u6D88 "),a()}}function Ky(i,e){if(i&1){let t=T();s(0,"div",31),k(1,"span",62),l(2," \u6B63\u5728\u641C\u7D22... "),s(3,"button",64),b("click",function(){v(t);let o=f();return x(o.cancelCurrentRequest())}),l(4,"\u53D6\u6D88"),a()()}}function zy(i,e){if(i&1){let t=T();s(0,"div",66)(1,"div",67)(2,"span",68),l(3),a(),s(4,"span",69),l(5),a()(),s(6,"div",70),l(7),a(),s(8,"div",71),l(9),a(),s(10,"div",72)(11,"button",73),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.recordFeedback(o.item.id,!0))}),l(12," \u{1F44D} \u6709\u7528 "),a(),s(13,"button",74),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.recordFeedback(o.item.id,!1))}),l(14," \u{1F44E} \u7121\u7528 "),a()()()}if(i&2){let t=e.$implicit,n=f(2);I("high-match",t.similarity>=.8),d(2),Vn("data-type",t.item.type),d(),A(" ",n.getTypeName(t.item.type)," "),d(2),A(" \u5339\u914D\u5EA6: ",(t.similarity*100).toFixed(0),"% "),d(2),M(t.item.question),d(2),M(t.item.answer)}}function Wy(i,e){if(i&1&&$(0,zy,15,7,"div",65,Ry),i&2){let t=f();H(t.ragService.searchResults())}}function Jy(i,e){if(i&1){let t=T();s(0,"div",32)(1,"span",14),l(2,"\u{1F50D}"),a(),s(3,"p"),l(4,"\u672A\u627E\u5230\u76F8\u95DC\u77E5\u8B58"),a(),s(5,"button",75),b("click",function(){v(t);let o=f();return x(o.addNewKnowledge())}),l(6,"\u6DFB\u52A0\u9019\u689D\u77E5\u8B58"),a()()}}function Qy(i,e){i&1&&(s(0,"div",33)(1,"span",14),l(2,"\u{1F4A1}"),a(),s(3,"p"),l(4,"\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u7528\u8A9E\u7FA9\u7406\u89E3\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58"),a()())}function Yy(i,e){i&1&&l(0," \u{1F4DA} ")}function Xy(i,e){i&1&&l(0," \u{1F4AC} ")}function Zy(i,e){i&1&&l(0," \u{1F44D} ")}function jy(i,e){i&1&&l(0," \u{1F4C8} ")}function e2(i,e){if(i&1&&(s(0,"div",76)(1,"div",77),w(2,Yy,1,0)(3,Xy,1,0)(4,Zy,1,0)(5,jy,1,0),a(),s(6,"div",78)(7,"div",79),l(8),a(),s(9,"div",80),l(10),a()()()),i&2){let t,n=e.$implicit,o=f(2);Vn("data-type",n.type),d(2),E((t=n.type)==="new_knowledge"?2:t==="auto_learn"?3:t==="feedback"?4:t==="quality_update"?5:-1),d(6),M(n.description),d(2),M(o.formatTime(n.timestamp))}}function t2(i,e){if(i&1&&$(0,e2,11,4,"div",76,Io),i&2){let t=f();H(t.ragService.learningEvents().slice(0,10))}}function n2(i,e){i&1&&(s(0,"div",37)(1,"p"),l(2,"\u7B49\u5F85\u5B78\u7FD2\u4E8B\u4EF6..."),a(),s(3,"p",81),l(4,"AI \u6703\u5F9E\u5C0D\u8A71\u4E2D\u81EA\u52D5\u5B78\u7FD2"),a()())}function i2(i,e){if(i&1){let t=T();s(0,"button",91),b("click",function(){v(t);let o=f(2);return x(o.deleteSelectedGaps())}),l(1),a()}if(i&2){let t=f(2);d(),A(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedGapIds().length,") ")}}function o2(i,e){i&1&&(s(0,"span",99),l(1,"\u{1F525} \u71B1\u9580"),a())}function r2(i,e){if(i&1&&(s(0,"span",107),l(1),a()),i&2){let t=f().$implicit,n=f(2);he("cat-"+t.category),d(),A(" ",n.getCategoryLabel(t.category)," ")}}function s2(i,e){if(i&1&&(s(0,"div",102)(1,"span",108),l(2,"\u{1F4A1} AI:"),a(),s(3,"span",109),l(4),a()()),i&2){let t=f().$implicit;d(4),M(t.suggestedAnswer.length>80?t.suggestedAnswer.slice(0,80)+"...":t.suggestedAnswer)}}function a2(i,e){if(i&1){let t=T();s(0,"button",110),b("click",function(){v(t);let o=f().$implicit,r=f(2);return x(r.suggestAnswer(o))}),l(1," \u{1F916} \u751F\u6210 "),a()}}function l2(i,e){if(i&1){let t=T();s(0,"div",92)(1,"div",93)(2,"input",94),b("change",function(){let o=v(t).$implicit,r=f(2);return x(r.toggleGapSelection(o.id))}),a()(),s(3,"div",95)(4,"div",96)(5,"span",97),l(6),a(),s(7,"div",98),w(8,o2,2,0,"span",99),w(9,r2,2,3,"span",100),s(10,"span",101),l(11),a()()(),w(12,s2,5,1,"div",102),s(13,"div",103),w(14,a2,2,0,"button",104),s(15,"button",105),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.resolveGap(o))}),l(16," \u2705 \u63A1\u7528 "),a(),s(17,"button",106),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.deleteGap(o))}),l(18," \u{1F5D1}\uFE0F "),a()()()()}if(i&2){let t=e.$implicit,n=f(2);I("selected",n.isGapSelected(t.id)),d(2),V("checked",n.isGapSelected(t.id)),d(3),V("title",t.query),d(),A(" ",t.query.length>60?t.query.slice(0,60)+"...":t.query," "),d(2),E(t.hitCount>=5?8:-1),d(),E(t.category?9:-1),d(2),A("",t.hitCount,"\u6B21"),d(),E(t.suggestedAnswer?12:-1),d(2),E(t.suggestedAnswer?-1:14)}}function c2(i,e){if(i&1&&(s(0,"div",90)(1,"span"),l(2),a()()),i&2){let t=f(2);d(2),A("\u9084\u6709 ",t.ragService.gapsCount()-15," \u689D\u672A\u986F\u793A")}}function d2(i,e){if(i&1){let t=T();s(0,"div",41)(1,"div",82)(2,"h3",13)(3,"span",14),l(4,"\u{1F514}"),a(),l(5," \u77E5\u8B58\u7F3A\u53E3 "),s(6,"span",83),l(7),a()(),s(8,"div",84)(9,"button",85),b("click",function(){v(t);let o=f();return x(o.cleanupDuplicateGaps())}),l(10," \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 "),a(),w(11,i2,2,1,"button",86),a()(),s(12,"p",87),l(13,"\u{1F4A1} \u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u597D\u7B54\u6848\u7684\u554F\u984C\uFF0C\u5EFA\u8B70\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C"),a(),s(14,"div",88),$(15,l2,19,10,"div",89,Io),a(),w(17,c2,3,1,"div",90),a()}if(i&2){let t=f();d(7),A("(",t.ragService.gapsCount(),")"),d(4),E(t.selectedGapIds().length>0?11:-1),d(4),H(t.ragService.knowledgeGaps().slice(0,15)),d(2),E(t.ragService.gapsCount()>15?17:-1)}}function u2(i,e){i&1&&(s(0,"div",42)(1,"span",111),l(2,"\u2728"),a(),s(3,"p"),l(4,"\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u66AB\u7121\u77E5\u8B58\u7F3A\u53E3"),a()())}function m2(i,e){if(i&1&&(s(0,"div",124)(1,"span",125),l(2),a(),l(3),a()),i&2){let t=e.$implicit;Vn("data-priority",t.priority),d(2),M(t.priority==="high"?"\u{1F534}":t.priority==="medium"?"\u{1F7E1}":"\u{1F7E2}"),d(),A(" ",t.message," ")}}function p2(i,e){if(i&1&&(s(0,"div",123)(1,"h4"),l(2,"\u{1F4A1} \u512A\u5316\u5EFA\u8B70"),a(),$(3,m2,4,3,"div",124,Ny),a()),i&2){let t=f(2);d(3),H(t.suggestions)}}function g2(i,e){if(i&1&&(s(0,"div",112)(1,"h3",13)(2,"span",14),l(3,"\u{1F4CA}"),a(),l(4," \u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u5831\u544A "),a(),s(5,"div",113)(6,"div",114)(7,"span",115),l(8),a(),s(9,"span",116),l(10,"\u7E3D\u5206"),a()(),s(11,"div",117)(12,"div",118)(13,"span",119),l(14,"\u5B8C\u6574\u6027"),a(),s(15,"div",120),k(16,"div",121),a(),s(17,"span",122),l(18),a()(),s(19,"div",118)(20,"span",119),l(21,"\u6548\u679C"),a(),s(22,"div",120),k(23,"div",121),a(),s(24,"span",122),l(25),a()(),s(26,"div",118)(27,"span",119),l(28,"\u6642\u6548\u6027"),a(),s(29,"div",120),k(30,"div",121),a(),s(31,"span",122),l(32),a()()()(),w(33,p2,5,0,"div",123),a()),i&2){let t=f();d(6),I("healthy",t.overallScore>=70)("warning",t.overallScore>=40&&t.overallScore<70)("danger",t.overallScore<40),d(2),M(t.overallScore),d(8),j("width",(t.completeness==null?null:t.completeness.score)||0,"%"),d(2),A("",(t.completeness==null?null:t.completeness.score)||0,"%"),d(5),j("width",(t.effectiveness==null?null:t.effectiveness.score)||0,"%"),d(2),A("",(t.effectiveness==null?null:t.effectiveness.score)||0,"%"),d(5),j("width",(t.freshness==null?null:t.freshness.score)||0,"%"),d(2),A("",(t.freshness==null?null:t.freshness.score)||0,"%"),d(),E(t.suggestions&&t.suggestions.length>0?33:-1)}}function h2(i,e){i&1&&w(0,g2,34,17,"div",112),i&2&&E(e.overallScore!==void 0?0:-1)}function f2(i,e){if(i&1&&(s(0,"div",127)(1,"div",128),l(2),a(),s(3,"div",129)(4,"span",130),l(5),a(),s(6,"span",131),l(7),a()(),s(8,"div",132),k(9,"div",121),a()()),i&2){let t=e.$implicit,n=f(),o=f();d(2),M(t.name),d(3),A("",t.count," \u689D"),d(2),A("\u8A55\u5206: ",t.avgScore),d(2),j("width",t.count/n.totalKnowledge*100,"%")("background",o.getTypeColor(t.key))}}function _2(i,e){if(i&1&&(s(0,"div",43)(1,"h3"),l(2,"\u77E5\u8B58\u5206\u5E03"),a(),s(3,"div",126),$(4,f2,10,7,"div",127,By),a()()),i&2){let t=f();d(4),H(t.getStatTypes(e.byType))}}function C2(i,e){if(i&1){let t=T();s(0,"button",145),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.guidedAnswer=o.id)}),l(1),a()}if(i&2){let t=e.$implicit,n=f(3);I("selected",n.guidedAnswer===t.id),d(),A(" ",t.label," ")}}function v2(i,e){if(i&1&&(s(0,"div",139),$(1,C2,2,3,"button",144,Io),a()),i&2){let t=f();d(),H(t.options)}}function x2(i,e){if(i&1){let t=T();s(0,"button",145),b("click",function(){let o=v(t).$implicit,r=f(3);return x(r.toggleOption(o.id))}),l(1),a()}if(i&2){let t=e.$implicit,n=f(3);I("selected",n.isOptionSelected(t.id)),d(),A(" ",t.label," ")}}function b2(i,e){if(i&1&&(s(0,"div",140),$(1,x2,2,3,"button",144,Io),a()),i&2){let t=f();d(),H(t.options)}}function S2(i,e){if(i&1){let t=T();s(0,"button",150),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.addSuggestion(o))}),l(1),a()}if(i&2){let t=e.$implicit;d(),M(t)}}function y2(i,e){if(i&1&&(s(0,"div",147)(1,"span",148),l(2,"\u5E38\u898B:"),a(),$(3,S2,2,1,"button",149,ke),a()),i&2){let t=f(2);d(3),H(t.suggestions)}}function w2(i,e){if(i&1){let t=T();s(0,"textarea",146),W("ngModelChange",function(o){v(t);let r=f(2);return z(r.guidedAnswer,o)||(r.guidedAnswer=o),x(o)}),a(),w(1,y2,5,0,"div",147)}if(i&2){let t=f(),n=f();K("ngModel",n.guidedAnswer),V("placeholder",t.placeholder||""),d(),E(t.suggestions&&t.suggestions.length?1:-1)}}function E2(i,e){i&1&&l(0," \u4E0B\u4E00\u6B65 \u2192 ")}function A2(i,e){i&1&&l(0," \u958B\u59CB\u69CB\u5EFA \u2728 ")}function D2(i,e){if(i&1){let t=T();s(0,"div",44)(1,"div",133)(2,"div",134)(3,"span",135),l(4),a(),s(5,"h3"),l(6),a(),s(7,"button",136),b("click",function(){v(t);let o=f();return x(o.cancelGuidedBuild())}),l(8,"\u2715"),a()(),s(9,"div",137)(10,"p",138),l(11),a(),w(12,v2,3,0,"div",139)(13,b2,3,0,"div",140)(14,w2,2,3),a(),s(15,"div",141)(16,"button",142),b("click",function(){v(t);let o=f();return x(o.cancelGuidedBuild())}),l(17,"\u53D6\u6D88"),a(),s(18,"button",143),b("click",function(){v(t);let o=f();return x(o.submitGuidedAnswer())}),w(19,E2,1,0)(20,A2,1,0),a()()()()}if(i&2){let t,n=e,o=f();d(4),Y("\u6B65\u9A5F ",n.step," / ",n.totalSteps),d(2),M(n.title),d(5),M(n.question),d(),E((t=n.type)==="select"?12:t==="multiselect"?13:t==="textarea"?14:-1),d(6),V("disabled",!o.guidedAnswer||o.ragService.isLoading()),d(),E(n.step<n.totalSteps?19:20)}}var To=class i{constructor(){this.ragService=B(Ct);this.dialogService=B(ht);this.toastService=B(me);this.businessDescription="";this.searchQuery="";this.guidedAnswer="";this.selectedOptions=[];this.selectedGapIds=C([])}ngOnInit(){this.ragService.initialize(),this.ragService.refreshStats(),this.ragService.getKnowledgeGaps(),this.ragService.getHealthReport()}isGapSelected(e){return this.selectedGapIds().includes(e)}toggleGapSelection(e){let t=this.selectedGapIds();t.includes(e)?this.selectedGapIds.set(t.filter(n=>n!==e)):this.selectedGapIds.set([...t,e])}deleteSelectedGaps(){let e=this.selectedGapIds();e.length!==0&&(this.ragService.deleteGapsBatch(e),this.selectedGapIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D\u7F3A\u53E3`))}getCategoryLabel(e){return{price:"\u{1F4B0} \u50F9\u683C",process:"\u{1F4CB} \u6D41\u7A0B",product:"\u{1F4E6} \u7522\u54C1",support:"\u{1F6E0}\uFE0F \u552E\u5F8C",other:"\u2753 \u5176\u4ED6"}[e]||e}hasPendingTasks(){return this.ragService.gapsCount()>0||this.ragService.healthScore()<60||this.ragService.totalKnowledge()<10}scrollToGaps(){let e=document.querySelector(".gaps-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}focusBuildInput(){let e=document.querySelector(".build-textarea");e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}))}async startBuild(){this.businessDescription.trim()&&await this.ragService.buildFromConversation({businessDescription:this.businessDescription})}importFromUrl(){this.ragService.lastError()?.type==="api_key_missing"&&this.ragService.clearLastError?.(),this.dialogService.prompt({title:"\u5F9E\u7DB2\u9801\u5C0E\u5165\u77E5\u8B58",message:`\u8F38\u5165\u7DB2\u9801 URL\uFF0CAI \u6703\u81EA\u52D5\u63D0\u53D6\u77E5\u8B58\uFF1A

\u{1F4A1} \u63D0\u793A\uFF1A\u9700\u8981\u5148\u5728\u300CAI \u4E2D\u5FC3\u300D\u2192\u300C\u6A21\u578B\u8A2D\u5B9A\u300D\u914D\u7F6E AI API Key`,placeholder:"https://example.com/about",confirmText:"\u5C0E\u5165",onConfirm:t=>{t&&this.ragService.importFromUrl(t)}})}importFromDocument(){let e=document.createElement("input");e.type="file",e.accept=".txt,.pdf,.doc,.docx",e.onchange=t=>{let n=t.target.files?.[0];if(n){let o=n.name.split(".").pop()||"";this.toastService.info(`\u9078\u64C7\u4E86\u6587\u4EF6: ${n.name}\uFF0C\u6B63\u5728\u8655\u7406...`)}},e.click()}openTemplateSelector(){this.dialogService.prompt({title:"\u9078\u64C7\u884C\u696D\u6A21\u677F",message:"\u8F38\u5165\u884C\u696D\u985E\u578B\uFF08payment/ecommerce/education/realestate/finance/healthcare/travel/legal\uFF09\uFF1A",placeholder:"payment",confirmText:"\u61C9\u7528",onConfirm:e=>{e&&this.toastService.info(`\u6B63\u5728\u61C9\u7528\u300C${e}\u300D\u6A21\u677F...`)}})}search(){this.searchQuery.trim()&&this.ragService.search(this.searchQuery)}recordFeedback(e,t){this.ragService.recordFeedback(e,t),this.toastService.success(t?"\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF01":"\u5DF2\u8A18\u9304\uFF0C\u6211\u5011\u6703\u6539\u9032")}addNewKnowledge(){this.dialogService.prompt({title:"\u6DFB\u52A0\u65B0\u77E5\u8B58",message:"\u8F38\u5165\u56DE\u7B54\u5167\u5BB9\uFF1A",placeholder:"\u5C08\u696D\u7684\u56DE\u7B54...",confirmText:"\u6DFB\u52A0",onConfirm:e=>{e&&this.ragService.addKnowledge("qa",this.searchQuery,e)}})}cleanupKnowledge(){this.dialogService.confirm({title:"\u6E05\u7406\u4F4E\u8CEA\u91CF\u77E5\u8B58",message:"\u5C07\u522A\u9664\u8A55\u5206\u4F4E\u65BC 0.2 \u4E14\u672A\u88AB\u4F7F\u7528\u7684\u820A\u77E5\u8B58\uFF0C\u78BA\u8A8D\u7E7C\u7E8C\uFF1F",confirmText:"\u6E05\u7406",type:"warning",onConfirm:()=>{this.ragService.cleanupLowQuality(),this.toastService.info("\u6B63\u5728\u6E05\u7406...")}})}mergeKnowledge(){this.ragService.mergeSimilar(),this.toastService.info("\u6B63\u5728\u5408\u4F75\u76F8\u4F3C\u77E5\u8B58...")}refreshStats(){this.ragService.refreshStats(),this.toastService.success("\u5DF2\u5237\u65B0\u7D71\u8A08")}cancelCurrentRequest(){this.ragService.cancelCurrentRequest()}getTypeName(e){return{qa:"\u554F\u7B54",script:"\u8A71\u8853",product:"\u7522\u54C1",objection:"\u7570\u8B70\u8655\u7406",greeting:"\u958B\u5834\u767D",closing:"\u6210\u4EA4",faq:"FAQ",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}getTypeColor(e){return{"Q&A \u554F\u7B54":"#667eea",\u6210\u529F\u8A71\u8853:"#10b981",\u7522\u54C1\u4FE1\u606F:"#f59e0b",\u7570\u8B70\u8655\u7406:"#ef4444",\u958B\u5834\u767D:"#8b5cf6",\u6210\u4EA4\u8A71\u8853:"#06b6d4",FAQ:"#ec4899",\u81EA\u5B9A\u7FA9:"#6b7280"}[e]||"#667eea"}getStatTypes(e){return Object.entries(e||{}).map(([t,n])=>({key:t,name:t,count:n.count||0,avgScore:n.avg_score||n.avgScore||0}))}formatTime(e){let t=new Date(e),o=new Date().getTime()-t.getTime();return o<6e4?"\u525B\u525B":o<36e5?`${Math.floor(o/6e4)} \u5206\u9418\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u6642\u524D`:t.toLocaleDateString("zh-TW")}suggestAnswer(e){this.ragService.suggestGapAnswer(e.id,e.query),this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...")}resolveGap(e){let t=e.suggestedAnswer||"";this.dialogService.prompt({title:"\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",message:`\u554F\u984C: "${e.query}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,placeholder:t||"\u5C08\u696D\u7684\u56DE\u7B54...",defaultValue:t,confirmText:"\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",onConfirm:n=>{n&&this.ragService.resolveGap(e.id,"faq",e.query,n)}})}ignoreGap(e){this.ragService.ignoreGap(e.id)}deleteGap(e){this.ragService.deleteGap(e.id),this.toastService.success("\u5DF2\u522A\u9664")}cleanupDuplicateGaps(){this.ragService.cleanupDuplicateGaps(),this.toastService.info("\u6B63\u5728\u6E05\u7406\u91CD\u8907\u7F3A\u53E3...")}startGuidedBuild(){this.guidedAnswer="",this.selectedOptions=[],this.ragService.startGuidedBuild()}isOptionSelected(e){return this.selectedOptions.includes(e)}toggleOption(e){this.selectedOptions.includes(e)?this.selectedOptions=this.selectedOptions.filter(t=>t!==e):this.selectedOptions.push(e),this.guidedAnswer=this.selectedOptions}addSuggestion(e){typeof this.guidedAnswer=="string"&&(this.guidedAnswer=this.guidedAnswer?`${this.guidedAnswer}
${e}`:e)}submitGuidedAnswer(){this.ragService.answerGuidedQuestion(this.guidedAnswer),this.guidedAnswer="",this.selectedOptions=[]}cancelGuidedBuild(){this.ragService.cancelGuidedBuild(),this.guidedAnswer="",this.selectedOptions=[]}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-ai-brain"]],decls:106,vars:20,consts:[[1,"ai-brain-container"],["class","task-banner",4,"ngIf"],[1,"brain-header"],[1,"brain-title"],[1,"brain-icon"],[1,"version-badge"],[1,"brain-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],[1,"stat-item","health"],[1,"brain-content"],[1,"build-section"],[1,"section-title"],[1,"icon"],[1,"conversation-builder"],[1,"chat-bubble","ai"],[1,"bubble-content"],["placeholder","\u4F8B\u5982\uFF1A\u6211\u662F\u505A\u8DE8\u5883\u652F\u4ED8\u7684\uFF0C\u4E3B\u8981\u5E6B\u5BA2\u6236\u514C\u63DB USDT\uFF0C\u532F\u7387\u6BD4\u5E02\u5834\u9AD8 0.5%\uFF0C10 \u5206\u9418\u5230\u8CEC...","rows","4",1,"business-input",3,"ngModelChange","ngModel"],[1,"build-progress"],[1,"build-btn",3,"click","disabled"],[1,"cancel-request-btn"],[1,"quick-import"],[1,"import-buttons"],[1,"import-btn","guided",3,"click"],[1,"import-btn",3,"click"],[1,"search-section"],[1,"search-box"],["type","text","placeholder","\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58...",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-btn",3,"click","disabled"],[1,"search-results"],[1,"loading-state"],[1,"empty-state"],[1,"placeholder-state"],[1,"learning-section"],[1,"live-badge"],[1,"learning-feed"],[1,"empty-learning"],[1,"maintenance-section"],[1,"maintenance-buttons"],[1,"maint-btn",3,"click"],[1,"gaps-section"],[1,"gaps-empty"],[1,"knowledge-distribution"],[1,"guided-overlay"],[1,"task-banner"],[1,"task-title"],[1,"task-icon"],[1,"task-list"],[1,"task-item","priority-high"],[1,"task-item","priority-medium"],[1,"task-item","priority-low"],[1,"task-item","priority-high",3,"click"],[1,"task-badge","high"],[1,"task-text"],[1,"task-action"],[1,"task-badge","medium"],[1,"task-item","priority-low",3,"click"],[1,"task-badge","low"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"spinner"],[1,"cancel-request-btn",3,"click"],[1,"cancel-link",3,"click"],[1,"result-card",3,"high-match"],[1,"result-card"],[1,"result-header"],[1,"type-badge"],[1,"similarity"],[1,"result-question"],[1,"result-answer"],[1,"result-actions"],[1,"action-btn","positive",3,"click"],[1,"action-btn","negative",3,"click"],[1,"add-btn",3,"click"],[1,"learning-event"],[1,"event-icon"],[1,"event-content"],[1,"event-desc"],[1,"event-time"],[1,"hint"],[1,"gaps-header"],[1,"gap-count"],[1,"gaps-actions-bar"],["title","\u4E00\u9375\u6E05\u7406\u6240\u6709\u5783\u573E\u6578\u64DA",1,"batch-btn","cleanup",3,"click"],[1,"batch-btn","delete-selected"],[1,"gaps-hint"],[1,"gaps-list"],[1,"gap-card",3,"selected"],[1,"gaps-more"],[1,"batch-btn","delete-selected",3,"click"],[1,"gap-card"],[1,"gap-select"],["type","checkbox",3,"change","checked"],[1,"gap-main"],[1,"gap-top"],[1,"gap-query",3,"title"],[1,"gap-tags"],[1,"tag","hot"],[1,"tag","category",3,"class"],[1,"tag","hits"],[1,"gap-suggestion"],[1,"gap-actions"],["title","\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848",1,"gap-btn","suggest"],["title","\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",1,"gap-btn","resolve",3,"click"],["title","\u76F4\u63A5\u522A\u9664",1,"gap-btn","delete",3,"click"],[1,"tag","category"],[1,"suggestion-label"],[1,"suggestion-text"],["title","\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848",1,"gap-btn","suggest",3,"click"],[1,"empty-icon"],[1,"health-dashboard"],[1,"health-overview"],[1,"health-score-circle"],[1,"score-value"],[1,"score-label"],[1,"health-metrics"],[1,"metric"],[1,"metric-label"],[1,"metric-bar"],[1,"bar-fill"],[1,"metric-value"],[1,"health-suggestions"],[1,"suggestion-item"],[1,"priority-badge"],[1,"distribution-grid"],[1,"type-card"],[1,"type-name"],[1,"type-stats"],[1,"count"],[1,"score"],[1,"type-bar"],[1,"guided-dialog"],[1,"guided-header"],[1,"step-indicator"],[1,"close-btn",3,"click"],[1,"guided-content"],[1,"question-text"],[1,"options-grid"],[1,"options-grid","multi"],[1,"guided-footer"],[1,"cancel-btn",3,"click"],[1,"next-btn",3,"click","disabled"],[1,"option-btn",3,"selected"],[1,"option-btn",3,"click"],[1,"guided-textarea",3,"ngModelChange","ngModel","placeholder"],[1,"suggestions"],[1,"label"],[1,"suggestion-chip"],[1,"suggestion-chip",3,"click"]],template:function(t,n){if(t&1&&(s(0,"div",0),Ts(1,Gy,10,3,"div",1),s(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F9E0}"),a(),s(6,"span"),l(7,"AI \u77E5\u8B58\u5927\u8166"),a(),s(8,"span",5),l(9,"2.0"),a()(),s(10,"div",6)(11,"div",7)(12,"span",8),l(13),a(),s(14,"span",9),l(15,"\u77E5\u8B58\u7E3D\u6578"),a()(),s(16,"div",7)(17,"span",8),l(18),a(),s(19,"span",9),l(20,"\u547D\u4E2D\u7387"),a()(),s(21,"div",7)(22,"span",8),l(23),a(),s(24,"span",9),l(25,"\u4ECA\u65E5\u5B78\u7FD2"),a()(),s(26,"div",10)(27,"span",8),l(28),a(),s(29,"span",9),l(30,"\u5065\u5EB7\u5EA6"),a()()()(),s(31,"div",11)(32,"div",12)(33,"h3",13)(34,"span",14),l(35,"\u{1F4AC}"),a(),l(36," \u5C0D\u8A71\u5F0F\u77E5\u8B58\u69CB\u5EFA "),a(),s(37,"div",15)(38,"div",16)(39,"div",17),l(40," \u544A\u8A34\u6211\u4F60\u7684\u696D\u52D9\uFF0C\u6211\u4F86\u5E6B\u4F60\u69CB\u5EFA\u77E5\u8B58\u5EAB... "),a()(),s(41,"textarea",18),W("ngModelChange",function(r){return z(n.businessDescription,r)||(n.businessDescription=r),r}),a(),w(42,Uy,5,4,"div",19),s(43,"button",20),b("click",function(){return n.startBuild()}),w(44,qy,2,0)(45,$y,3,0),a(),w(46,Hy,2,0,"button",21),a(),s(47,"div",22)(48,"h4"),l(49,"\u6216\u8005\u5FEB\u901F\u5C0E\u5165"),a(),s(50,"div",23)(51,"button",24),b("click",function(){return n.startGuidedBuild()}),s(52,"span",14),l(53,"\u{1F3AF}"),a(),l(54," \u5F15\u5C0E\u5F0F\u69CB\u5EFA (\u63A8\u85A6) "),a(),s(55,"button",25),b("click",function(){return n.importFromUrl()}),s(56,"span",14),l(57,"\u{1F310}"),a(),l(58," \u5F9E\u7DB2\u9801\u5C0E\u5165 "),a(),s(59,"button",25),b("click",function(){return n.importFromDocument()}),s(60,"span",14),l(61,"\u{1F4C4}"),a(),l(62," \u4E0A\u50B3\u6587\u6A94 "),a(),s(63,"button",25),b("click",function(){return n.openTemplateSelector()}),s(64,"span",14),l(65,"\u{1F4DA}"),a(),l(66," \u884C\u696D\u6A21\u677F "),a()()()(),s(67,"div",26)(68,"h3",13)(69,"span",14),l(70,"\u{1F50D}"),a(),l(71," \u8A9E\u7FA9\u641C\u7D22 "),a(),s(72,"div",27)(73,"input",28),W("ngModelChange",function(r){return z(n.searchQuery,r)||(n.searchQuery=r),r}),b("keyup.enter",function(){return n.search()}),a(),s(74,"button",29),b("click",function(){return n.search()}),l(75," \u641C\u7D22 "),a()(),s(76,"div",30),w(77,Ky,5,0,"div",31)(78,Wy,2,0)(79,Jy,7,0,"div",32)(80,Qy,5,0,"div",33),a()(),s(81,"div",34)(82,"h3",13)(83,"span",14),l(84,"\u{1F534}"),a(),s(85,"span",35),l(86,"LIVE"),a(),l(87," \u5BE6\u6642\u5B78\u7FD2 "),a(),s(88,"div",36),w(89,t2,2,0)(90,n2,5,0,"div",37),a(),s(91,"div",38)(92,"h4"),l(93,"\u77E5\u8B58\u7DAD\u8B77"),a(),s(94,"div",39)(95,"button",40),b("click",function(){return n.cleanupKnowledge()}),l(96," \u{1F9F9} \u6E05\u7406\u4F4E\u8CEA\u91CF "),a(),s(97,"button",40),b("click",function(){return n.mergeKnowledge()}),l(98," \u{1F504} \u5408\u4F75\u76F8\u4F3C "),a(),s(99,"button",40),b("click",function(){return n.refreshStats()}),l(100," \u{1F4CA} \u5237\u65B0\u7D71\u8A08 "),a()()()()(),w(101,d2,18,3,"div",41)(102,u2,5,0,"div",42),w(103,h2,1,1),w(104,_2,6,0,"div",43),w(105,D2,21,7,"div",44),a()),t&2){let o,r,c,m;d(),V("ngIf",n.hasPendingTasks()),d(12),M(n.ragService.totalKnowledge()),d(5),A("",n.ragService.hitRate(),"%"),d(5),A("+",n.ragService.todayLearned()),d(3),I("healthy",n.ragService.healthScore()>=70),d(2),A("",n.ragService.healthScore(),"%"),d(13),K("ngModel",n.businessDescription),d(),E((o=n.ragService.buildProgress())?42:-1,o),d(),V("disabled",!n.businessDescription||n.ragService.isLoading()),d(),E(n.ragService.isLoading()&&n.ragService.currentRequest()==="build"?44:45),d(2),E(n.ragService.isLoading()&&n.ragService.currentRequest()==="build"?46:-1),d(27),K("ngModel",n.searchQuery),d(),V("disabled",!n.searchQuery),d(3),E(n.ragService.isLoading()&&n.ragService.currentRequest()==="search"?77:n.ragService.searchResults().length>0?78:n.searchQuery&&!n.ragService.isLoading()?79:80),d(12),E(n.ragService.learningEvents().length>0?89:90),d(12),E(n.ragService.knowledgeGaps().length>0?101:102),d(2),E((r=n.ragService.healthReport())?103:-1,r),d(),E((c=n.ragService.stats())?104:-1,c),d(),E((m=n.ragService.guidedQuestion())?105:-1,m)}},dependencies:[oe,Ns,ue,xe,fe,_e],styles:[".ai-brain-container[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.task-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#a855f726,#3b82f626);border:1px solid rgba(168,85,247,.3);border-radius:16px;padding:16px 20px;margin-bottom:20px}.task-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:16px;font-weight:600;color:#e0e0e0;margin-bottom:12px}.task-icon[_ngcontent-%COMP%]{font-size:18px}.task-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.task-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 14px;background:#0000004d;border-radius:10px;cursor:pointer;transition:all .2s}.task-item[_ngcontent-%COMP%]:hover{background:#00000080;transform:translate(4px)}.task-badge[_ngcontent-%COMP%]{font-size:12px}.task-text[_ngcontent-%COMP%]{flex:1;font-size:14px;color:#ccc}.task-action[_ngcontent-%COMP%]{font-size:12px;color:#a855f7;font-weight:500}.task-item.priority-high[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#f87171}.task-item.priority-medium[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#fbbf24}.task-item.priority-low[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#34d399}.brain-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding:16px 24px;background:#ffffff0d;border-radius:16px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.brain-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700}.brain-icon[_ngcontent-%COMP%]{font-size:32px}.version-badge[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600}.brain-stats[_ngcontent-%COMP%]{display:flex;gap:32px}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-value[_ngcontent-%COMP%]{display:block;font-size:24px;font-weight:700;color:#667eea}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-item.health[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f59e0b}.stat-item.health.healthy[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#10b981}.brain-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:24px;margin-bottom:24px}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px;font-size:16px;font-weight:600}.live-badge[_ngcontent-%COMP%]{background:#ef4444;padding:2px 8px;border-radius:4px;font-size:10px;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.build-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.conversation-builder[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.chat-bubble.ai[_ngcontent-%COMP%]{background:#667eea33;padding:12px 16px;border-radius:16px 16px 16px 4px;font-size:14px}.business-input[_ngcontent-%COMP%]{background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;color:#fff;font-size:14px;resize:none}.business-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.build-progress[_ngcontent-%COMP%]{padding:12px;background:#667eea1a;border-radius:8px}.progress-bar[_ngcontent-%COMP%]{height:4px;background:#ffffff1a;border-radius:2px;overflow:hidden;margin-bottom:8px}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);transition:width .3s}.progress-text[_ngcontent-%COMP%]{font-size:12px;color:#888}.build-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s}.build-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 20px #667eea66}.build-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.quick-import[_ngcontent-%COMP%]{margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,.1)}.quick-import[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:12px}.import-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.import-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 14px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:13px;cursor:pointer;transition:all .2s}.import-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#667eea}.import-btn.guided[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea33,#764ba233);border-color:#667eea}.search-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.search-box[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:12px 16px;background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:14px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.search-btn[_ngcontent-%COMP%]{padding:12px 20px;background:#667eea;border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer}.search-btn[_ngcontent-%COMP%]:disabled{opacity:.5}.search-results[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.result-card[_ngcontent-%COMP%]{background:#0003;border:1px solid rgba(255,255,255,.05);border-radius:12px;padding:14px;margin-bottom:12px}.result-card.high-match[_ngcontent-%COMP%]{border-color:#10b981}.result-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.type-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;background:#667eea33;color:#667eea}.similarity[_ngcontent-%COMP%]{font-size:12px;color:#10b981}.result-question[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px;font-size:14px}.result-answer[_ngcontent-%COMP%]{font-size:13px;color:#aaa;line-height:1.5}.result-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:12px}.action-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;transition:all .2s}.action-btn.positive[_ngcontent-%COMP%]{background:#10b9811a;border:1px solid rgba(16,185,129,.3);color:#10b981}.action-btn.negative[_ngcontent-%COMP%]{background:#ef44441a;border:1px solid rgba(239,68,68,.3);color:#ef4444}.action-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.empty-state[_ngcontent-%COMP%], .placeholder-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#888}.empty-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .placeholder-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px}.add-btn[_ngcontent-%COMP%]{margin-top:12px;padding:10px 20px;background:#667eea;border:none;border-radius:8px;color:#fff;cursor:pointer}.learning-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.learning-feed[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.learning-event[_ngcontent-%COMP%]{display:flex;gap:12px;padding:10px;background:#0003;border-radius:8px;margin-bottom:8px}.event-icon[_ngcontent-%COMP%]{font-size:20px}.event-desc[_ngcontent-%COMP%]{font-size:13px}.event-time[_ngcontent-%COMP%]{font-size:11px;color:#666}.empty-learning[_ngcontent-%COMP%]{text-align:center;padding:30px;color:#666}.empty-learning[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:12px;color:#555}.maintenance-section[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1)}.maintenance-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:12px}.maintenance-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.maint-btn[_ngcontent-%COMP%]{padding:8px 12px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#aaa;font-size:12px;cursor:pointer;transition:all .2s}.maint-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.knowledge-distribution[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.knowledge-distribution[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:16px;font-size:16px}.distribution-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}.type-card[_ngcontent-%COMP%]{background:#0003;border-radius:8px;padding:12px}.type-name[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.type-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;color:#888;margin-bottom:8px}.type-bar[_ngcontent-%COMP%]{height:4px;background:#ffffff1a;border-radius:2px;overflow:hidden}.bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:2px}.spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.cancel-request-btn[_ngcontent-%COMP%]{display:block;width:100%;margin-top:8px;padding:10px;background:#ef444433;border:1px solid rgba(239,68,68,.4);border-radius:8px;color:#ef4444;font-size:13px;cursor:pointer;transition:all .2s}.cancel-request-btn[_ngcontent-%COMP%]:hover{background:#ef44444d}.cancel-link[_ngcontent-%COMP%]{display:block;margin-top:8px;background:none;border:none;color:#888;font-size:12px;cursor:pointer;text-decoration:underline}.cancel-link[_ngcontent-%COMP%]:hover{color:#ef4444}@media(max-width:1200px){.brain-content[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.learning-section[_ngcontent-%COMP%]{grid-column:span 2}}@media(max-width:768px){.brain-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.learning-section[_ngcontent-%COMP%]{grid-column:auto}.brain-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.brain-stats[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}}.gaps-section[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef444414,#a855f714);border:1px solid rgba(239,68,68,.2);border-radius:16px;padding:20px;margin-bottom:24px}.gaps-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.gap-count[_ngcontent-%COMP%]{color:#ef4444;font-weight:700}.gaps-actions-bar[_ngcontent-%COMP%]{display:flex;gap:8px}.gaps-hint[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:16px}.gaps-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.gap-card[_ngcontent-%COMP%]{display:flex;gap:12px;background:#0000004d;border-radius:12px;padding:12px;transition:all .2s;border:1px solid transparent}.gap-card[_ngcontent-%COMP%]:hover{background:#0006;border-color:#a855f74d}.gap-card.selected[_ngcontent-%COMP%]{background:#a855f726;border-color:#a855f780}.gap-select[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding-top:4px}.gap-select[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:#a855f7}.gap-main[_ngcontent-%COMP%]{flex:1;min-width:0}.gap-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:8px}.gap-query[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;flex:1;line-height:1.4}.gap-tags[_ngcontent-%COMP%]{display:flex;gap:6px;flex-shrink:0}.tag[_ngcontent-%COMP%]{font-size:11px;padding:2px 8px;border-radius:10px;white-space:nowrap}.tag.hot[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.tag.hits[_ngcontent-%COMP%]{background:#64748b4d;color:#94a3b8}.tag.category[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.tag.cat-price[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.tag.cat-process[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.tag.cat-product[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.tag.cat-support[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gap-suggestion[_ngcontent-%COMP%]{display:flex;gap:6px;font-size:12px;color:#888;margin-bottom:8px;padding:6px 10px;background:#a855f71a;border-radius:6px}.suggestion-label[_ngcontent-%COMP%]{color:#a855f7;flex-shrink:0}.suggestion-text[_ngcontent-%COMP%]{color:#aaa}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:6px}.gap-btn[_ngcontent-%COMP%]{padding:4px 10px;border-radius:6px;border:none;font-size:12px;cursor:pointer;transition:all .2s}.gap-btn.suggest[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.gap-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.gap-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gap-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.batch-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:none;font-size:12px;cursor:pointer;transition:all .2s}.batch-btn.cleanup[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.batch-btn.delete-selected[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gaps-more[_ngcontent-%COMP%]{text-align:center;padding:12px;color:#666;font-size:13px}.gaps-empty[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.gaps-empty[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:48px;display:block;margin-bottom:12px}.gaps-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.gap-card[_ngcontent-%COMP%]{background:#0000004d;border-radius:12px;padding:14px}.gap-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px}.gap-query[_ngcontent-%COMP%]{font-weight:600;color:#fff}.gap-hits[_ngcontent-%COMP%]{background:#ef4444;padding:2px 8px;border-radius:10px;font-size:11px}.gap-suggestion[_ngcontent-%COMP%]{background:#667eea1a;padding:10px;border-radius:8px;font-size:13px;color:#aaa;margin-bottom:10px}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.gap-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;border:none;transition:all .2s}.gap-btn.suggest[_ngcontent-%COMP%]{background:#667eea33;color:#667eea}.gap-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#10b981}.gap-btn.ignore[_ngcontent-%COMP%]{background:#6b728033;color:#9ca3af}.gap-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#ef4444}.gap-btn.delete[_ngcontent-%COMP%]:hover{background:#ef444466}.gap-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.batch-btn[_ngcontent-%COMP%]{margin-left:auto;padding:6px 12px;border:none;border-radius:8px;font-size:12px;cursor:pointer;transition:all .2s}.batch-btn.cleanup[_ngcontent-%COMP%]{background:#f59e0b33;color:#f59e0b}.batch-btn.cleanup[_ngcontent-%COMP%]:hover{background:#f59e0b66}.health-dashboard[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px;margin-bottom:24px}.health-overview[_ngcontent-%COMP%]{display:flex;gap:30px;align-items:center}.health-score-circle[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#0000004d;border:3px solid #667eea}.health-score-circle.healthy[_ngcontent-%COMP%]{border-color:#10b981}.health-score-circle.warning[_ngcontent-%COMP%]{border-color:#f59e0b}.health-score-circle.danger[_ngcontent-%COMP%]{border-color:#ef4444}.score-value[_ngcontent-%COMP%]{font-size:28px;font-weight:700}.score-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.health-metrics[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:12px}.metric[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.metric-label[_ngcontent-%COMP%]{width:60px;font-size:13px;color:#888}.metric-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:#ffffff1a;border-radius:4px;overflow:hidden}.metric-bar[_ngcontent-%COMP%]   .bar-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:4px}.metric-value[_ngcontent-%COMP%]{width:40px;text-align:right;font-size:13px;font-weight:600}.health-suggestions[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1)}.health-suggestions[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;margin-bottom:12px}.suggestion-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#0003;border-radius:8px;margin-bottom:8px;font-size:13px}.guided-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000}.guided-dialog[_ngcontent-%COMP%]{background:#1a1a2e;border-radius:20px;width:90%;max-width:600px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}.guided-header[_ngcontent-%COMP%]{padding:20px;border-bottom:1px solid rgba(255,255,255,.1);position:relative}.step-indicator[_ngcontent-%COMP%]{font-size:12px;color:#667eea;margin-bottom:4px;display:block}.guided-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}.close-btn[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;background:none;border:none;color:#888;font-size:20px;cursor:pointer}.guided-content[_ngcontent-%COMP%]{padding:20px;flex:1;overflow-y:auto}.question-text[_ngcontent-%COMP%]{font-size:16px;margin-bottom:20px}.options-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}.options-grid.multi[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}.option-btn[_ngcontent-%COMP%]{padding:14px;background:#ffffff0d;border:2px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:14px;cursor:pointer;transition:all .2s;text-align:left}.option-btn[_ngcontent-%COMP%]:hover{border-color:#667eea}.option-btn.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea33}.guided-textarea[_ngcontent-%COMP%]{width:100%;min-height:120px;padding:14px;background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:14px;resize:vertical}.suggestions[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}.suggestions[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#888}.suggestion-chip[_ngcontent-%COMP%]{padding:4px 10px;background:#667eea33;border:none;border-radius:12px;color:#667eea;font-size:12px;cursor:pointer}.guided-footer[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid rgba(255,255,255,.1);display:flex;justify-content:flex-end;gap:12px}.cancel-btn[_ngcontent-%COMP%]{padding:10px 20px;background:transparent;border:1px solid rgba(255,255,255,.2);border-radius:8px;color:#888;cursor:pointer}.next-btn[_ngcontent-%COMP%]{padding:10px 24px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer}.next-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})}};var M2=(i,e)=>e.id;function T2(i,e){if(i&1){let t=T();s(0,"button",38),b("click",function(){v(t);let o=f();return x(o.deleteSelected())}),l(1),a(),s(2,"button",39),b("click",function(){v(t);let o=f();return x(o.batchResolve())}),l(3," \u2705 \u6279\u91CF\u63A1\u7528 "),a()}if(i&2){let t=f();d(),A(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedIds().length,") ")}}function I2(i,e){i&1&&(s(0,"div",36),k(1,"span",40),s(2,"span"),l(3,"\u8F09\u5165\u4E2D..."),a()())}function k2(i,e){i&1&&(s(0,"div",37)(1,"span",41),l(2,"\u2728"),a(),s(3,"h3"),l(4,"\u6C92\u6709\u5F85\u8655\u7406\u7684\u77E5\u8B58\u7F3A\u53E3"),a(),s(5,"p"),l(6,"\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01"),a()())}function P2(i,e){if(i&1&&(s(0,"div",52)(1,"span",61),l(2,"\u{1F4A1} AI:"),a(),l(3),a()),i&2){let t=f().$implicit,n=f(2);d(3),A(" ",n.truncateText(t.suggestedAnswer,100)," ")}}function F2(i,e){i&1&&(s(0,"span",55),l(1,"\u{1F525}"),a())}function R2(i,e){if(i&1){let t=T();s(0,"button",62),b("click",function(){v(t);let o=f().$implicit,r=f(2);return x(r.generateAnswer(o))}),l(1," \u{1F916} "),a()}}function N2(i,e){if(i&1){let t=T();s(0,"div",44)(1,"div",45)(2,"input",46),b("change",function(){let o=v(t).$implicit,r=f(2);return x(r.toggleSelect(o.id))}),a()(),s(3,"div",47),l(4),a(),s(5,"div",48)(6,"span",49),l(7),a()(),s(8,"div",50)(9,"div",51),l(10),a(),w(11,P2,4,1,"div",52),a(),s(12,"div",53)(13,"span",54),l(14),a(),w(15,F2,2,0,"span",55),a(),s(16,"div",56),l(17),a(),s(18,"div",57),w(19,R2,2,0,"button",58),s(20,"button",59),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.resolveGap(o))}),l(21," \u2705 "),a(),s(22,"button",60),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.deleteGap(o))}),l(23," \u{1F5D1}\uFE0F "),a()()()}if(i&2){let t=e.$implicit,n=e.$index,o=f(2);I("selected",o.isSelected(t.id)),d(2),V("checked",o.isSelected(t.id)),d(2),M((o.currentPage()-1)*o.pageSize+n+1),d(2),he("cat-"+(t.category||"other")),d(),A(" ",o.getCategoryIcon(t.category)," "),d(2),V("title",t.query),d(),A(" ",o.truncateText(t.query,80)," "),d(),E(t.suggestedAnswer?11:-1),d(2),I("hot",t.hitCount>=5),d(),A(" ",t.hitCount,"\u6B21 "),d(),E(t.hitCount>=5?15:-1),d(2),A(" ",o.formatTime(t.createdAt)," "),d(2),E(t.suggestedAnswer?-1:19)}}function B2(i,e){if(i&1){let t=T();s(0,"div",43)(1,"button",63),b("click",function(){v(t);let o=f(2);return x(o.goToPage(o.currentPage()-1))}),l(2," \u2190 \u4E0A\u4E00\u9801 "),a(),s(3,"span",64),l(4),a(),s(5,"button",63),b("click",function(){v(t);let o=f(2);return x(o.goToPage(o.currentPage()+1))}),l(6," \u4E0B\u4E00\u9801 \u2192 "),a()()}if(i&2){let t=f(2);d(),V("disabled",t.currentPage()===1),d(3),je(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801 \uFF08\u5171 ",t.filteredGaps().length," \u689D\uFF09 "),d(),V("disabled",t.currentPage()===t.totalPages())}}function V2(i,e){if(i&1&&($(0,N2,24,16,"div",42,M2),w(2,B2,7,5,"div",43)),i&2){let t=f();H(t.paginatedGaps()),d(2),E(t.totalPages()>1?2:-1)}}var ko=class i{constructor(){this.ragService=B(Ct);this.dialogService=B(ht);this.toastService=B(me);this.isLoading=C(!1);this.gaps=C([]);this.selectedIds=C([]);this.currentPage=C(1);this.pageSize=20;this.categoryFilter="all";this.sortOption="hitCount";this.filteredGaps=L(()=>{let e=[...this.gaps()];return this.categoryFilter!=="all"&&(e=e.filter(t=>(t.category||"other")===this.categoryFilter)),e.sort((t,n)=>{switch(this.sortOption){case"hitCount":return n.hitCount-t.hitCount;case"createdAt":return new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime();case"category":return(t.category||"z").localeCompare(n.category||"z");default:return 0}}),e});this.paginatedGaps=L(()=>{let e=(this.currentPage()-1)*this.pageSize;return this.filteredGaps().slice(e,e+this.pageSize)});this.totalPages=L(()=>Math.ceil(this.filteredGaps().length/this.pageSize));this.totalGaps=L(()=>this.gaps().length);this.hotGapsCount=L(()=>this.gaps().filter(e=>e.hitCount>=5).length);this.categoryStats=L(()=>{let e={price:0,process:0,product:0,support:0,other:0};return this.gaps().forEach(t=>{let n=t.category||"other";e[n]!==void 0&&e[n]++}),e})}ngOnInit(){this.loadGaps()}async loadGaps(){this.isLoading.set(!0);try{await this.ragService.getKnowledgeGaps(),this.gaps.set(this.ragService.knowledgeGaps())}finally{this.isLoading.set(!1)}}refreshGaps(){this.loadGaps(),this.toastService.success("\u5DF2\u5237\u65B0")}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(e){return this.selectedIds().includes(e)}toggleSelect(e){let t=this.selectedIds();t.includes(e)?this.selectedIds.set(t.filter(n=>n!==e)):this.selectedIds.set([...t,e])}isAllSelected(){let e=this.paginatedGaps();return e.length>0&&e.every(t=>this.selectedIds().includes(t.id))}isPartialSelected(){let e=this.paginatedGaps(),t=e.filter(n=>this.selectedIds().includes(n.id));return t.length>0&&t.length<e.length}toggleSelectAll(){let e=this.paginatedGaps();if(this.isAllSelected()){let t=e.map(n=>n.id);this.selectedIds.set(this.selectedIds().filter(n=>!t.includes(n)))}else{let t=[...new Set([...this.selectedIds(),...e.map(n=>n.id)])];this.selectedIds.set(t)}}generateAnswer(e){this.ragService.suggestGapAnswer(e.id,e.query),this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...")}resolveGap(e){let t=e.suggestedAnswer||"";this.dialogService.prompt({title:"\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",message:`\u554F\u984C: "${this.truncateText(e.query,60)}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,placeholder:t||"\u5C08\u696D\u7684\u56DE\u7B54...",defaultValue:t,confirmText:"\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",onConfirm:n=>{n&&(this.ragService.resolveGap(e.id,"faq",e.query,n),this.toastService.success("\u5DF2\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB"),this.loadGaps())}})}deleteGap(e){this.ragService.deleteGap(e.id),this.gaps.set(this.gaps().filter(t=>t.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664")}deleteSelected(){let e=this.selectedIds();e.length!==0&&(this.ragService.deleteGapsBatch(e),this.gaps.set(this.gaps().filter(t=>!e.includes(t.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D`))}batchResolve(){let e=this.paginatedGaps().filter(t=>this.selectedIds().includes(t.id)&&t.suggestedAnswer);if(e.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u6709 AI \u5EFA\u8B70\u7684\u7F3A\u53E3");return}e.forEach(t=>{this.ragService.resolveGap(t.id,"faq",t.query,t.suggestedAnswer)}),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u6279\u91CF\u63A1\u7528 ${e.length} \u689D`),this.loadGaps()}cleanupAllInvalid(){this.ragService.cleanupDuplicateGaps(),this.toastService.info("\u6B63\u5728\u6DF1\u5EA6\u6E05\u7406..."),setTimeout(()=>this.loadGaps(),1500)}goToPage(e){e>=1&&e<=this.totalPages()&&(this.currentPage.set(e),this.selectedIds.set([]))}truncateText(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}getCategoryIcon(e){return{price:"\u{1F4B0}",process:"\u{1F4CB}",product:"\u{1F4E6}",support:"\u{1F6E0}\uFE0F",other:"\u2753"}[e||"other"]||"\u2753"}formatTime(e){if(!e)return"";let t=new Date(e),o=new Date().getTime()-t.getTime();return o<6e4?"\u525B\u525B":o<36e5?`${Math.floor(o/6e4)} \u5206\u9418\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u6642\u524D`:o<6048e5?`${Math.floor(o/864e5)} \u5929\u524D`:t.toLocaleDateString("zh-TW")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-knowledge-gaps"]],decls:93,vars:11,consts:[[1,"gaps-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","cleanup",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","hot"],[1,"stat-card","price"],[1,"stat-card","process"],[1,"stat-card","product"],[1,"filter-bar"],[1,"filter-left"],[1,"select-all"],["type","checkbox",3,"change","checked","indeterminate"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","price"],["value","process"],["value","product"],["value","support"],["value","other"],["value","hitCount"],["value","createdAt"],["value","category"],[1,"filter-right"],[1,"gaps-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"batch-btn","resolve",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"gap-row",3,"selected"],[1,"pagination"],[1,"gap-row"],[1,"gap-checkbox"],["type","checkbox",3,"change","checked"],[1,"gap-index"],[1,"gap-category"],[1,"category-tag"],[1,"gap-content"],[1,"gap-query",3,"title"],[1,"gap-answer"],[1,"gap-hits"],[1,"hits-badge"],[1,"hot-tag"],[1,"gap-time"],[1,"gap-actions"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate"],["title","\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",1,"btn-icon","resolve",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"answer-label"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u2753"),a(),l(6," \u77E5\u8B58\u7F3A\u53E3\u7BA1\u7406 "),a(),s(7,"p",5),l(8,"\u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u7B54\u6848\u7684\u554F\u984C\uFF0C\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C\u53EF\u63D0\u5347 AI \u56DE\u8986\u8CEA\u91CF"),a()(),s(9,"div",6)(10,"button",7),b("click",function(){return n.cleanupAllInvalid()}),l(11," \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 "),a(),s(12,"button",8),b("click",function(){return n.refreshGaps()}),l(13," \u{1F504} \u5237\u65B0 "),a()()(),s(14,"div",9)(15,"div",10)(16,"div",11),l(17,"\u{1F4CB}"),a(),s(18,"div",12)(19,"span",13),l(20),a(),s(21,"span",14),l(22,"\u5F85\u8655\u7406"),a()()(),s(23,"div",15)(24,"div",11),l(25,"\u{1F525}"),a(),s(26,"div",12)(27,"span",13),l(28),a(),s(29,"span",14),l(30,"\u71B1\u9580\u554F\u984C"),a()()(),s(31,"div",16)(32,"div",11),l(33,"\u{1F4B0}"),a(),s(34,"div",12)(35,"span",13),l(36),a(),s(37,"span",14),l(38,"\u50F9\u683C\u76F8\u95DC"),a()()(),s(39,"div",17)(40,"div",11),l(41,"\u{1F4CB}"),a(),s(42,"div",12)(43,"span",13),l(44),a(),s(45,"span",14),l(46,"\u6D41\u7A0B\u76F8\u95DC"),a()()(),s(47,"div",18)(48,"div",11),l(49,"\u{1F4E6}"),a(),s(50,"div",12)(51,"span",13),l(52),a(),s(53,"span",14),l(54,"\u7522\u54C1\u76F8\u95DC"),a()()()(),s(55,"div",19)(56,"div",20)(57,"label",21)(58,"input",22),b("change",function(){return n.toggleSelectAll()}),a(),s(59,"span"),l(60,"\u5168\u9078"),a()(),s(61,"div",23)(62,"label"),l(63,"\u5206\u985E\uFF1A"),a(),s(64,"select",24),W("ngModelChange",function(r){return z(n.categoryFilter,r)||(n.categoryFilter=r),r}),b("change",function(){return n.applyFilters()}),s(65,"option",25),l(66,"\u5168\u90E8"),a(),s(67,"option",26),l(68,"\u{1F4B0} \u50F9\u683C"),a(),s(69,"option",27),l(70,"\u{1F4CB} \u6D41\u7A0B"),a(),s(71,"option",28),l(72,"\u{1F4E6} \u7522\u54C1"),a(),s(73,"option",29),l(74,"\u{1F6E0}\uFE0F \u552E\u5F8C"),a(),s(75,"option",30),l(76,"\u2753 \u5176\u4ED6"),a()()(),s(77,"div",23)(78,"label"),l(79,"\u6392\u5E8F\uFF1A"),a(),s(80,"select",24),W("ngModelChange",function(r){return z(n.sortOption,r)||(n.sortOption=r),r}),b("change",function(){return n.applyFilters()}),s(81,"option",31),l(82,"\u{1F525} \u71B1\u5EA6"),a(),s(83,"option",32),l(84,"\u{1F550} \u6642\u9593"),a(),s(85,"option",33),l(86,"\u{1F4C2} \u5206\u985E"),a()()()(),s(87,"div",34),w(88,T2,4,1),a()(),s(89,"div",35),w(90,I2,4,0,"div",36)(91,k2,7,0,"div",37)(92,V2,3,1),a()()),t&2&&(d(20),M(n.totalGaps()),d(8),M(n.hotGapsCount()),d(8),M(n.categoryStats().price),d(8),M(n.categoryStats().process),d(8),M(n.categoryStats().product),d(6),V("checked",n.isAllSelected())("indeterminate",n.isPartialSelected()),d(6),K("ngModel",n.categoryFilter),d(16),K("ngModel",n.sortOption),d(8),E(n.selectedIds().length>0?88:-1),d(2),E(n.isLoading()?90:n.filteredGaps().length===0?91:92))},dependencies:[oe,ue,He,Ke,nt,fe,_e],styles:[".gaps-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.cleanup[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08);transition:all .2s}.stat-card[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#ffffff26}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.hot[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.stat-card.price[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.process[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.select-all[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;color:#aaa}.select-all[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;cursor:pointer}.filter-right[_ngcontent-%COMP%]{display:flex;gap:10px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.batch-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.batch-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.gaps-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.gap-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 40px 50px 1fr 80px 80px 100px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.gap-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.gap-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.gap-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.gap-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7;cursor:pointer}.gap-index[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-category[_ngcontent-%COMP%]{text-align:center}.category-tag[_ngcontent-%COMP%]{font-size:18px}.gap-content[_ngcontent-%COMP%]{min-width:0}.gap-query[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;line-height:1.4;margin-bottom:4px}.gap-answer[_ngcontent-%COMP%]{font-size:12px;color:#888;padding:6px 10px;background:#a855f71a;border-radius:6px;margin-top:6px}.answer-label[_ngcontent-%COMP%]{color:#a855f7;margin-right:4px}.gap-hits[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;justify-content:center}.hits-badge[_ngcontent-%COMP%]{padding:3px 8px;background:#64748b33;border-radius:10px;font-size:12px;color:#94a3b8}.hits-badge.hot[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.hot-tag[_ngcontent-%COMP%]{font-size:14px}.gap-time[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}.btn-icon.generate[_ngcontent-%COMP%]{background:#a855f733}.btn-icon.resolve[_ngcontent-%COMP%]{background:#10b98133}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media(max-width:900px){.gap-row[_ngcontent-%COMP%]{grid-template-columns:40px 40px 1fr 60px 80px}.gap-category[_ngcontent-%COMP%], .gap-time[_ngcontent-%COMP%]{display:none}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media(max-width:600px){.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.filter-left[_ngcontent-%COMP%], .filter-right[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}};var L2=(i,e)=>e.id;function O2(i,e){if(i&1){let t=T();s(0,"button",42),b("click",function(){v(t);let o=f();return x(o.deleteSelected())}),l(1),a()}if(i&2){let t=f();d(),A(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedIds().length,") ")}}function G2(i,e){i&1&&(s(0,"div",40),k(1,"span",43),s(2,"span"),l(3,"\u8F09\u5165\u4E2D..."),a()())}function U2(i,e){if(i&1){let t=T();s(0,"div",41)(1,"span",44),l(2,"\u{1F4DA}"),a(),s(3,"h3"),l(4,"\u66AB\u7121\u77E5\u8B58"),a(),s(5,"p"),l(6,"\u9EDE\u64CA\u300C\u6DFB\u52A0\u77E5\u8B58\u300D\u958B\u59CB\u69CB\u5EFA\u77E5\u8B58\u5EAB"),a(),s(7,"button",45),b("click",function(){v(t);let o=f();return x(o.addKnowledge())}),l(8,"\u2795 \u6DFB\u52A0\u77E5\u8B58"),a()()}}function q2(i,e){if(i&1){let t=T();s(0,"div",48)(1,"div",49)(2,"input",50),b("change",function(){let o=v(t).$implicit,r=f(2);return x(r.toggleSelect(o.id))}),a()(),s(3,"div",51)(4,"span",52),l(5),a()(),s(6,"div",53),l(7),a(),s(8,"div",54),l(9),a(),s(10,"div",55)(11,"span",56),l(12),a()(),s(13,"div",57),l(14),a(),s(15,"div",58)(16,"button",59),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.editKnowledge(o))}),l(17," \u270F\uFE0F "),a(),s(18,"button",60),b("click",function(){let o=v(t).$implicit,r=f(2);return x(r.deleteKnowledge(o))}),l(19," \u{1F5D1}\uFE0F "),a()()()}if(i&2){let t=e.$implicit,n=f(2);I("selected",n.isSelected(t.id)),d(2),V("checked",n.isSelected(t.id)),d(2),he("type-"+t.type),d(),Y(" ",n.getTypeIcon(t.type)," ",n.getTypeName(t.type)," "),d(),V("title",t.question),d(),A(" ",n.truncateText(t.question,60)," "),d(),V("title",t.answer),d(),A(" ",n.truncateText(t.answer,80)," "),d(2),I("high",t.successScore>=.7)("low",t.successScore<.4),d(),A(" ",(t.successScore*10).toFixed(1)," "),d(2),A(" ",t.useCount,"\u6B21 ")}}function $2(i,e){if(i&1){let t=T();s(0,"div",47)(1,"button",61),b("click",function(){v(t);let o=f(2);return x(o.goToPage(o.currentPage()-1))}),l(2," \u2190 \u4E0A\u4E00\u9801 "),a(),s(3,"span",62),l(4),a(),s(5,"button",61),b("click",function(){v(t);let o=f(2);return x(o.goToPage(o.currentPage()+1))}),l(6," \u4E0B\u4E00\u9801 \u2192 "),a()()}if(i&2){let t=f(2);d(),V("disabled",t.currentPage()===1),d(3),je(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801 \uFF08\u5171 ",t.filteredKnowledge().length," \u689D\uFF09 "),d(),V("disabled",t.currentPage()===t.totalPages())}}function H2(i,e){if(i&1&&($(0,q2,20,17,"div",46,L2),w(2,$2,7,5,"div",47)),i&2){let t=f();H(t.paginatedKnowledge()),d(2),E(t.totalPages()>1?2:-1)}}var Po=class i{constructor(){this.ragService=B(Ct);this.dialogService=B(ht);this.toastService=B(me);this.ipc=B(De);this.isLoading=C(!1);this.knowledge=C([]);this.selectedIds=C([]);this.currentPage=C(1);this.pageSize=20;this.searchQuery="";this.typeFilter="all";this.sortOption="createdAt";this.filteredKnowledge=L(()=>{let e=[...this.knowledge()];if(this.searchQuery.trim()){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.question.toLowerCase().includes(t)||n.answer.toLowerCase().includes(t))}return this.typeFilter!=="all"&&(e=e.filter(t=>t.type===this.typeFilter)),e.sort((t,n)=>{switch(this.sortOption){case"createdAt":return new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime();case"useCount":return n.useCount-t.useCount;case"successScore":return n.successScore-t.successScore;case"type":return t.type.localeCompare(n.type);default:return 0}}),e});this.paginatedKnowledge=L(()=>{let e=(this.currentPage()-1)*this.pageSize;return this.filteredKnowledge().slice(e,e+this.pageSize)});this.totalPages=L(()=>Math.ceil(this.filteredKnowledge().length/this.pageSize));this.totalKnowledge=L(()=>this.knowledge().length);this.typeStats=L(()=>{let e={product:0,qa:0,script:0,faq:0,objection:0,greeting:0,closing:0};return this.knowledge().forEach(t=>{let n=t.type;e[n]!==void 0&&e[n]++}),e});this.avgScore=L(()=>{let e=this.knowledge();return e.length===0?0:e.reduce((t,n)=>t+n.successScore,0)/e.length})}ngOnInit(){this.loadKnowledge()}async loadKnowledge(){this.isLoading.set(!0);try{let e=await this.ipc.invoke("rag-get-all-knowledge",{});e?.success&&e.knowledge&&this.knowledge.set(e.knowledge.map(t=>({id:t.id,type:t.knowledge_type||t.type||"qa",question:t.question||"",answer:t.answer||"",context:t.context||"",successScore:t.success_score||t.successScore||.5,useCount:t.use_count||t.useCount||0,feedbackPositive:t.feedback_positive||0,feedbackNegative:t.feedback_negative||0,isActive:t.is_active!==!1,createdAt:t.created_at||t.createdAt||new Date().toISOString(),updatedAt:t.updated_at||t.updatedAt})))}catch(e){console.error("Failed to load knowledge:",e),this.toastService.error("\u8F09\u5165\u77E5\u8B58\u5931\u6557")}finally{this.isLoading.set(!1)}}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(e){return this.selectedIds().includes(e)}toggleSelect(e){let t=this.selectedIds();t.includes(e)?this.selectedIds.set(t.filter(n=>n!==e)):this.selectedIds.set([...t,e])}addKnowledge(){this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:"\u8ACB\u8F38\u5165\u554F\u984C\uFF1A",placeholder:"\u4F8B\u5982\uFF1A\u8CBB\u7387\u662F\u591A\u5C11\uFF1F",confirmText:"\u4E0B\u4E00\u6B65",onConfirm:e=>{e&&this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:`\u554F\u984C: "${e}"

\u8ACB\u8F38\u5165\u7B54\u6848\uFF1A`,placeholder:"\u5C08\u696D\u7684\u56DE\u7B54...",confirmText:"\u6DFB\u52A0",onConfirm:async t=>{if(t)try{await this.ipc.invoke("rag-add-knowledge",{type:"qa",question:e,answer:t}),this.toastService.success("\u6DFB\u52A0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u6DFB\u52A0\u5931\u6557")}}})}})}editKnowledge(e){this.dialogService.prompt({title:"\u7DE8\u8F2F\u77E5\u8B58",message:`\u554F\u984C: "${e.question}"

\u8ACB\u4FEE\u6539\u7B54\u6848\uFF1A`,placeholder:e.answer,defaultValue:e.answer,confirmText:"\u4FDD\u5B58",onConfirm:async t=>{if(t&&t!==e.answer)try{await this.ipc.invoke("rag-update-knowledge",{id:e.id,answer:t}),this.toastService.success("\u66F4\u65B0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u66F4\u65B0\u5931\u6557")}}})}async deleteKnowledge(e){try{await this.ipc.invoke("rag-delete-knowledge",{id:e.id}),this.knowledge.set(this.knowledge().filter(t=>t.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664")}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}async deleteSelected(){let e=this.selectedIds();if(e.length!==0)try{await this.ipc.invoke("rag-delete-knowledge-batch",{ids:e}),this.knowledge.set(this.knowledge().filter(t=>!e.includes(t.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D`)}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}goToPage(e){e>=1&&e<=this.totalPages()&&this.currentPage.set(e)}truncateText(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}getTypeIcon(e){return{product:"\u{1F4E6}",qa:"\u{1F4AC}",script:"\u{1F4DC}",faq:"\u2753",objection:"\u{1F6E1}\uFE0F",greeting:"\u{1F44B}",closing:"\u{1F3AF}"}[e]||"\u{1F4DD}"}getTypeName(e){return{product:"\u7522\u54C1",qa:"\u554F\u7B54",script:"\u8A71\u8853",faq:"FAQ",objection:"\u7570\u8B70",greeting:"\u958B\u5834",closing:"\u6210\u4EA4"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-knowledge-manage"]],decls:97,vars:10,consts:[[1,"knowledge-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","add",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","product"],[1,"stat-card","qa"],[1,"stat-card","script"],[1,"stat-card","score"],[1,"filter-bar"],[1,"filter-left"],[1,"search-box"],["type","text","placeholder","\u641C\u7D22\u77E5\u8B58...",3,"ngModelChange","input","ngModel"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","product"],["value","qa"],["value","script"],["value","faq"],["value","objection"],["value","greeting"],["value","closing"],["value","createdAt"],["value","useCount"],["value","successScore"],["value","type"],[1,"filter-right"],[1,"batch-btn","delete"],[1,"knowledge-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"add-btn",3,"click"],[1,"knowledge-row",3,"selected"],[1,"pagination"],[1,"knowledge-row"],[1,"item-checkbox"],["type","checkbox",3,"change","checked"],[1,"item-type"],[1,"type-tag"],[1,"item-question",3,"title"],[1,"item-answer",3,"title"],[1,"item-score"],[1,"score-badge"],[1,"item-usage"],[1,"item-actions"],["title","\u7DE8\u8F2F",1,"btn-icon","edit",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u{1F4DD}"),a(),l(6," \u77E5\u8B58\u7BA1\u7406 "),a(),s(7,"p",5),l(8,"\u67E5\u770B\u548C\u7BA1\u7406\u5DF2\u5C0E\u5165\u7684\u6240\u6709\u77E5\u8B58\uFF0C\u652F\u6301\u7DE8\u8F2F\u548C\u522A\u9664"),a()(),s(9,"div",6)(10,"button",7),b("click",function(){return n.addKnowledge()}),l(11," \u2795 \u6DFB\u52A0\u77E5\u8B58 "),a(),s(12,"button",8),b("click",function(){return n.loadKnowledge()}),l(13," \u{1F504} \u5237\u65B0 "),a()()(),s(14,"div",9)(15,"div",10)(16,"div",11),l(17,"\u{1F4DA}"),a(),s(18,"div",12)(19,"span",13),l(20),a(),s(21,"span",14),l(22,"\u77E5\u8B58\u7E3D\u6578"),a()()(),s(23,"div",15)(24,"div",11),l(25,"\u{1F4E6}"),a(),s(26,"div",12)(27,"span",13),l(28),a(),s(29,"span",14),l(30,"\u7522\u54C1\u4FE1\u606F"),a()()(),s(31,"div",16)(32,"div",11),l(33,"\u{1F4AC}"),a(),s(34,"div",12)(35,"span",13),l(36),a(),s(37,"span",14),l(38,"\u554F\u7B54"),a()()(),s(39,"div",17)(40,"div",11),l(41,"\u{1F4DC}"),a(),s(42,"div",12)(43,"span",13),l(44),a(),s(45,"span",14),l(46,"\u8A71\u8853"),a()()(),s(47,"div",18)(48,"div",11),l(49,"\u2B50"),a(),s(50,"div",12)(51,"span",13),l(52),a(),s(53,"span",14),l(54,"\u5E73\u5747\u8A55\u5206"),a()()()(),s(55,"div",19)(56,"div",20)(57,"div",21)(58,"input",22),W("ngModelChange",function(r){return z(n.searchQuery,r)||(n.searchQuery=r),r}),b("input",function(){return n.applyFilters()}),a()(),s(59,"div",23)(60,"label"),l(61,"\u985E\u578B\uFF1A"),a(),s(62,"select",24),W("ngModelChange",function(r){return z(n.typeFilter,r)||(n.typeFilter=r),r}),b("change",function(){return n.applyFilters()}),s(63,"option",25),l(64,"\u5168\u90E8"),a(),s(65,"option",26),l(66,"\u{1F4E6} \u7522\u54C1"),a(),s(67,"option",27),l(68,"\u{1F4AC} \u554F\u7B54"),a(),s(69,"option",28),l(70,"\u{1F4DC} \u8A71\u8853"),a(),s(71,"option",29),l(72,"\u2753 FAQ"),a(),s(73,"option",30),l(74,"\u{1F6E1}\uFE0F \u7570\u8B70\u8655\u7406"),a(),s(75,"option",31),l(76,"\u{1F44B} \u958B\u5834\u767D"),a(),s(77,"option",32),l(78,"\u{1F3AF} \u6210\u4EA4"),a()()(),s(79,"div",23)(80,"label"),l(81,"\u6392\u5E8F\uFF1A"),a(),s(82,"select",24),W("ngModelChange",function(r){return z(n.sortOption,r)||(n.sortOption=r),r}),b("change",function(){return n.applyFilters()}),s(83,"option",33),l(84,"\u{1F550} \u6642\u9593"),a(),s(85,"option",34),l(86,"\u{1F4CA} \u4F7F\u7528\u6B21\u6578"),a(),s(87,"option",35),l(88,"\u2B50 \u8A55\u5206"),a(),s(89,"option",36),l(90,"\u{1F4C2} \u985E\u578B"),a()()()(),s(91,"div",37),w(92,O2,2,1,"button",38),a()(),s(93,"div",39),w(94,G2,4,0,"div",40)(95,U2,9,0,"div",41)(96,H2,3,1),a()()),t&2&&(d(20),M(n.totalKnowledge()),d(8),M(n.typeStats().product),d(8),M(n.typeStats().qa),d(8),M(n.typeStats().script),d(8),M(n.avgScore().toFixed(1)),d(6),K("ngModel",n.searchQuery),d(4),K("ngModel",n.typeFilter),d(20),K("ngModel",n.sortOption),d(10),E(n.selectedIds().length>0?92:-1),d(2),E(n.isLoading()?94:n.filteredKnowledge().length===0?95:96))},dependencies:[oe,ue,He,Ke,xe,nt,fe,_e],styles:[".knowledge-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.add[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08)}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.stat-card.qa[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.script[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.score[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 14px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;width:200px}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;cursor:pointer}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.knowledge-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.knowledge-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 100px 1fr 1.5fr 60px 60px 80px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.knowledge-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.knowledge-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.knowledge-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.item-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.type-tag[_ngcontent-%COMP%]{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:500;white-space:nowrap}.type-tag.type-product[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.type-tag.type-qa[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.type-tag.type-script[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.type-tag.type-faq[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.type-tag.type-objection[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.type-tag.type-greeting[_ngcontent-%COMP%]{background:#06b6d433;color:#22d3ee}.type-tag.type-closing[_ngcontent-%COMP%]{background:#ec489933;color:#f472b6}.item-question[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0}.item-answer[_ngcontent-%COMP%]{font-size:13px;color:#888}.score-badge[_ngcontent-%COMP%]{padding:3px 8px;border-radius:10px;font-size:12px;background:#64748b33;color:#94a3b8}.score-badge.high[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.score-badge.low[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.item-usage[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.item-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}.btn-icon.edit[_ngcontent-%COMP%]{background:#3b82f633}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0 0 20px}.add-btn[_ngcontent-%COMP%]{padding:12px 24px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:10px;color:#fff;font-size:14px;cursor:pointer}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 80px 1fr 60px 60px}.item-answer[_ngcontent-%COMP%]{display:none}}@media(max-width:768px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 1fr 60px 60px}.item-type[_ngcontent-%COMP%]{display:none}}"]})}};var K2=(i,e)=>e.stage,z2=(i,e)=>e.comboId;function W2(i,e){if(i&1&&(s(0,"span",48),l(1),a()),i&2){let t=f();I("bg-green-500/20",t.comparison().changes.sessions>0)("text-green-400",t.comparison().changes.sessions>0)("bg-red-500/20",t.comparison().changes.sessions<0)("text-red-400",t.comparison().changes.sessions<0),d(),Y(" ",t.comparison().changes.sessions>0?"+":"","",t.comparison().changes.sessions.toFixed(1),"% ")}}function J2(i,e){if(i&1&&(s(0,"span",48),l(1),a()),i&2){let t=f();I("bg-green-500/20",t.comparison().changes.conversions>0)("text-green-400",t.comparison().changes.conversions>0)("bg-red-500/20",t.comparison().changes.conversions<0)("text-red-400",t.comparison().changes.conversions<0),d(),Y(" ",t.comparison().changes.conversions>0?"+":"","",t.comparison().changes.conversions.toFixed(1),"% ")}}function Q2(i,e){if(i&1&&(s(0,"span",48),l(1),a()),i&2){let t=f();I("bg-green-500/20",t.comparison().changes.revenue>0)("text-green-400",t.comparison().changes.revenue>0)("bg-red-500/20",t.comparison().changes.revenue<0)("text-red-400",t.comparison().changes.revenue<0),d(),Y(" ",t.comparison().changes.revenue>0?"+":"","",t.comparison().changes.revenue.toFixed(1),"% ")}}function Y2(i,e){if(i&1&&(s(0,"div",28)(1,"div",49)(2,"span",50),l(3),a(),s(4,"span",17),l(5),a()(),s(6,"div",51),k(7,"div",52),a()()),i&2){let t=e.$implicit,n=e.$index,o=f();d(3),M(o.getStageName(t.stage)),d(2),Y("",t.count," (",t.rate.toFixed(1),"%)"),d(2),he(o.getFunnelColor(n)),j("width",t.rate,"%")}}function X2(i,e){i&1&&(s(0,"div",29),l(1," \u66AB\u7121\u6578\u64DA "),a())}function Z2(i,e){i&1&&(s(0,"span",58),l(1,"\u2191"),a())}function j2(i,e){i&1&&(s(0,"span",59),l(1,"\u2193"),a())}function e5(i,e){if(i&1&&(s(0,"div",30)(1,"div",13)(2,"div",53)(3,"span",54),l(4),a(),s(5,"span",55),l(6),a()(),s(7,"div",56)(8,"span",57),l(9),a(),w(10,Z2,2,0,"span",58)(11,j2,2,0,"span",59),a()(),s(12,"div",60)(13,"span",61),l(14),a(),s(15,"span",62),l(16),a()(),s(17,"div",63),k(18,"div",64),a()()),i&2){let t=e.$implicit,n=e.$index,o=f();d(4),M(o.getMedalEmoji(n)),d(2),M(t.comboName),d(3),A("",t.conversionRate.toFixed(1),"%"),d(),E(t.trend==="up"?10:t.trend==="down"?11:-1),d(4),Y(" ",t.totalSessions," \u6B21\u4F7F\u7528 \xB7 ",t.conversions," \u6B21\u8F49\u5316 "),d(2),A(" \u5E73\u5747 ",t.avgMessageCount.toFixed(0)," \u689D\u6D88\u606F "),d(2),j("width",t.conversionRate,"%")}}function t5(i,e){i&1&&(s(0,"div",29)(1,"div",65),l(2,"\u{1F4CA}"),a(),s(3,"div"),l(4,"\u958B\u59CB\u71DF\u92B7\u5F8C\u5C07\u986F\u793A\u89D2\u8272\u7D44\u5408\u6548\u679C"),a()())}function n5(i,e){if(i&1&&(s(0,"div",47)(1,"div",66)(2,"div",67),l(3,"\u{1F4A1}"),a(),s(4,"div",68)(5,"h4",69),l(6,"\u63A8\u85A6\u4F7F\u7528\u89D2\u8272\u7D44\u5408"),a(),s(7,"p",70),l(8," \u6839\u64DA\u6B77\u53F2\u6578\u64DA\uFF0C\u300C"),s(9,"span",71),l(10),a(),l(11,"\u300D \u7D44\u5408\u8868\u73FE\u6700\u4F73\uFF0C\u8F49\u5316\u7387\u9054 "),s(12,"span",57),l(13),a()()(),s(14,"button",72),l(15," \u4F7F\u7528\u6B64\u7D44\u5408 "),a()()()),i&2){let t=f();d(10),M(t.recommendedCombo().comboName),d(3),A("",t.recommendedCombo().conversionRate.toFixed(1),"%")}}var Fo=class i{constructor(){this.analytics=B(fa);this.selectedPeriod="week";this.todayDate=new Date().toLocaleDateString("zh-TW");this.totalStats=this.analytics.totalStats;this.todayStats=this.analytics.todayStats;this.topCombos=this.analytics.topRoleCombos;this.userProfiles=this.analytics.userProfiles;this.roleCombos=this.analytics.roleComboStats;this.todayReport=C(this.getEmptyReport());this.funnelData=C([]);this.comparison=C({current:{sessions:0,conversions:0,revenue:0},previous:{sessions:0,conversions:0,revenue:0},changes:{sessions:0,conversions:0,revenue:0}});this.recommendedCombo=C(null)}ngOnInit(){this.refreshData()}refreshData(){let e=this.analytics.generateDailyReport();this.todayReport.set(e),this.funnelData.set(e.funnel);let t=this.analytics.generatePeriodComparison(7);this.comparison.set(t);let n=this.analytics.recommendRoleCombo();this.recommendedCombo.set(n)}onPeriodChange(){this.refreshData()}getStageName(e){return{opening:"\u958B\u5834\u968E\u6BB5",building_trust:"\u5EFA\u7ACB\u4FE1\u4EFB",discovering_needs:"\u767C\u73FE\u9700\u6C42",presenting_value:"\u5C55\u793A\u50F9\u503C",handling_objections:"\u8655\u7406\u7570\u8B70",closing:"\u4FC3\u6210\u6210\u4EA4",follow_up:"\u8DDF\u9032\u670D\u52D9"}[e]||e}getFunnelColor(e){let t=["bg-blue-500","bg-cyan-500","bg-teal-500","bg-green-500","bg-lime-500","bg-amber-500","bg-orange-500"];return t[e%t.length]}getMedalEmoji(e){return["\u{1F947}","\u{1F948}","\u{1F949}","4\uFE0F\u20E3","5\uFE0F\u20E3"][e]||"\u{1F3C5}"}formatNumber(e){return e>=1e4?(e/1e4).toFixed(1)+"\u842C":e.toLocaleString()}getEmptyReport(){return{date:new Date().toISOString().split("T")[0],totalSessions:0,newUsers:0,activeUsers:0,conversions:0,conversionRate:0,totalRevenue:0,totalMessages:0,avgResponseTime:0,accountUsage:[],topRoleCombos:[],funnel:[]}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-marketing-report"]],decls:139,vars:21,consts:[[1,"marketing-report","p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white",3,"ngModelChange","change","ngModel"],["value","today"],["value","week"],["value","month"],["value","all"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-600","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-blue-500/20","to-blue-600/10","border","border-blue-500/30","rounded-xl","p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-blue-400","text-2xl"],[1,"text-xs","px-2","py-1","rounded-full",3,"bg-green-500/20","text-green-400","bg-red-500/20","text-red-400"],[1,"text-3xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"bg-gradient-to-br","from-green-500/20","to-green-600/10","border","border-green-500/30","rounded-xl","p-4"],[1,"text-green-400","text-2xl"],[1,"bg-gradient-to-br","from-purple-500/20","to-purple-600/10","border","border-purple-500/30","rounded-xl","p-4"],[1,"text-purple-400","text-2xl"],[1,"bg-gradient-to-br","from-amber-500/20","to-amber-600/10","border","border-amber-500/30","rounded-xl","p-4"],[1,"text-amber-400","text-2xl"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-slate-800/50","border","border-slate-700","rounded-xl","p-5"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"space-y-3"],[1,"relative"],[1,"text-center","py-8","text-slate-500"],[1,"p-3","bg-slate-900/50","rounded-lg","border","border-slate-700/50"],[1,"text-center","p-4","bg-slate-900/50","rounded-lg"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-2xl","font-bold","text-pink-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"text-2xl","font-bold","text-indigo-400"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"grid","grid-cols-2","md:grid-cols-5","gap-4"],[1,"text-center"],[1,"text-xl","font-bold","text-white"],[1,"text-xs","text-slate-400"],[1,"text-xl","font-bold","text-green-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-amber-400"],[1,"bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border","border-purple-500/30","rounded-xl","p-5"],[1,"text-xs","px-2","py-1","rounded-full"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","text-slate-300"],[1,"h-8","bg-slate-700","rounded-lg","overflow-hidden"],[1,"h-full","transition-all","duration-500"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"text-white","font-medium"],[1,"flex","items-center","gap-1"],[1,"text-green-400","font-bold"],[1,"text-green-400"],[1,"text-red-400"],[1,"flex","items-center","justify-between","text-sm"],[1,"text-slate-400"],[1,"text-slate-500"],[1,"mt-2","h-1.5","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-green-500","to-emerald-400","rounded-full"],[1,"text-3xl","mb-2"],[1,"flex","items-center","gap-4"],[1,"text-4xl"],[1,"flex-1"],[1,"text-white","font-semibold"],[1,"text-slate-300","mt-1"],[1,"text-purple-400","font-medium"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-600"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2)(4,"span"),l(5,"\u{1F4CA}"),a(),l(6," \u71DF\u92B7\u6578\u64DA\u5831\u8868 "),a(),s(7,"p",3),l(8,"\u8FFD\u8E64\u71DF\u92B7\u6548\u679C\uFF0C\u512A\u5316\u89D2\u8272\u7D44\u5408"),a()(),s(9,"div",4)(10,"select",5),W("ngModelChange",function(r){return z(n.selectedPeriod,r)||(n.selectedPeriod=r),r}),b("change",function(){return n.onPeriodChange()}),s(11,"option",6),l(12,"\u4ECA\u65E5"),a(),s(13,"option",7),l(14,"\u672C\u9031"),a(),s(15,"option",8),l(16,"\u672C\u6708"),a(),s(17,"option",9),l(18,"\u5168\u90E8"),a()(),s(19,"button",10),b("click",function(){return n.refreshData()}),s(20,"span"),l(21,"\u{1F504}"),a(),l(22," \u5237\u65B0 "),a()()(),s(23,"div",11)(24,"div",12)(25,"div",13)(26,"span",14),l(27,"\u{1F4EC}"),a(),w(28,W2,2,10,"span",15),a(),s(29,"div",16),l(30),a(),s(31,"div",17),l(32,"\u7E3D\u6703\u8A71\u6578"),a()(),s(33,"div",18)(34,"div",13)(35,"span",19),l(36,"\u2705"),a(),w(37,J2,2,10,"span",15),a(),s(38,"div",16),l(39),a(),s(40,"div",17),l(41,"\u6210\u529F\u8F49\u5316"),a()(),s(42,"div",20)(43,"div",13)(44,"span",21),l(45,"\u{1F4C8}"),a()(),s(46,"div",16),l(47),a(),s(48,"div",17),l(49,"\u8F49\u5316\u7387"),a()(),s(50,"div",22)(51,"div",13)(52,"span",23),l(53,"\u{1F4B0}"),a(),w(54,Q2,2,10,"span",15),a(),s(55,"div",16),l(56),a(),s(57,"div",17),l(58,"\u7E3D\u6536\u5165"),a()()(),s(59,"div",24)(60,"div",25)(61,"h3",26)(62,"span"),l(63,"\u{1F53B}"),a(),l(64," \u8F49\u5316\u6F0F\u6597 "),a(),s(65,"div",27),$(66,Y2,8,7,"div",28,K2),a(),w(68,X2,2,0,"div",29),a(),s(69,"div",25)(70,"h3",26)(71,"span"),l(72,"\u{1F3C6}"),a(),l(73," \u6700\u4F73\u89D2\u8272\u7D44\u5408 "),a(),s(74,"div",27),$(75,e5,19,9,"div",30,z2),w(77,t5,5,0,"div",29),a()()(),s(78,"div",25)(79,"h3",26)(80,"span"),l(81,"\u{1F465}"),a(),l(82," \u7528\u6236\u4E92\u52D5\u5206\u6790 "),a(),s(83,"div",11)(84,"div",31)(85,"div",32),l(86),a(),s(87,"div",33),l(88,"\u5E73\u5747\u8208\u8DA3\u5EA6"),a()(),s(89,"div",31)(90,"div",34),l(91),a(),s(92,"div",33),l(93,"\u5E73\u5747\u53C3\u8207\u5EA6"),a()(),s(94,"div",31)(95,"div",35),l(96),a(),s(97,"div",33),l(98,"\u7528\u6236\u756B\u50CF\u6578"),a()(),s(99,"div",31)(100,"div",36),l(101),a(),s(102,"div",33),l(103,"\u89D2\u8272\u7D44\u5408\u6578"),a()()()(),s(104,"div",25)(105,"div",37)(106,"h3",38)(107,"span"),l(108,"\u{1F4C5}"),a(),l(109," \u4ECA\u65E5\u8A73\u60C5 "),a(),s(110,"span",17),l(111),a()(),s(112,"div",39)(113,"div",40)(114,"div",41),l(115),a(),s(116,"div",42),l(117,"\u6703\u8A71"),a()(),s(118,"div",40)(119,"div",43),l(120),a(),s(121,"div",42),l(122,"\u8F49\u5316"),a()(),s(123,"div",40)(124,"div",44),l(125),a(),s(126,"div",42),l(127,"\u8F49\u5316\u7387"),a()(),s(128,"div",40)(129,"div",45),l(130),a(),s(131,"div",42),l(132,"\u6D88\u606F\u6578"),a()(),s(133,"div",40)(134,"div",46),l(135),a(),s(136,"div",42),l(137,"\u6536\u5165"),a()()()(),w(138,n5,16,2,"div",47),a()),t&2&&(d(10),K("ngModel",n.selectedPeriod),d(18),E(n.comparison().changes.sessions!==0?28:-1),d(2),M(n.totalStats().totalSessions),d(7),E(n.comparison().changes.conversions!==0?37:-1),d(2),M(n.totalStats().conversions),d(8),A("",n.totalStats().conversionRate.toFixed(1),"%"),d(7),E(n.comparison().changes.revenue!==0?54:-1),d(2),A("\xA5",n.formatNumber(n.totalStats().totalRevenue)),d(10),H(n.funnelData()),d(2),E(n.funnelData().length===0?68:-1),d(7),H(n.topCombos()),d(2),E(n.topCombos().length===0?77:-1),d(9),M(n.totalStats().avgInterestScore.toFixed(0)),d(5),M(n.totalStats().avgEngagementScore.toFixed(0)),d(5),M(n.userProfiles().length),d(5),M(n.roleCombos().length),d(10),M(n.todayDate),d(4),M(n.todayReport().totalSessions),d(5),M(n.todayReport().conversions),d(5),A("",n.todayReport().conversionRate.toFixed(1),"%"),d(5),M(n.todayReport().totalMessages),d(5),A("\xA5",n.formatNumber(n.todayReport().totalRevenue)),d(3),E(n.recommendedCombo()?138:-1))},dependencies:[oe,ue,He,Ke,nt,fe,_e],styles:[".marketing-report[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}"]})}};var i5=["onboardingRef"],o5=["monitoringGroupsRef"],No=(i,e)=>e.id,r5=(i,e)=>e.name,s5=(i,e)=>e.phone;function a5(i,e){i&1&&(s(0,"p",15),l(1,"\u4F7F\u7528\u7DE9\u5B58\u6578\u64DA"),a())}function l5(i,e){if(i&1&&(s(0,"p",16),l(1),a()),i&2){let t=f(3);d(),A("",t.offlineCache.pendingOperations().length," \u500B\u5F85\u540C\u6B65\u64CD\u4F5C")}}function c5(i,e){if(i&1&&(s(0,"div",10),k(1,"div",11),s(2,"div",12)(3,"div",13)(4,"p",14),l(5,"\u{1F4F4} \u96E2\u7DDA\u6A21\u5F0F"),a(),w(6,a5,2,0,"p",15),w(7,l5,2,1,"p",16),a()()()),i&2){let t=f(2);d(6),E(t.offlineCache.isCacheValid()?6:-1),d(),E(t.offlineCache.hasPendingOperations()?7:-1)}}function d5(i,e){if(i&1&&(s(0,"div",10),k(1,"div",17),s(2,"div",12)(3,"div",13)(4,"p",18),l(5),a()()()()),i&2){let t=f(2);d(5),M(t.backendConnectionMessage())}}function u5(i,e){if(i&1){let t=T();s(0,"div",10)(1,"div",19),b("click",function(){v(t);let o=f(2);return x(o.retryConnection())}),a(),s(2,"div",12)(3,"div",13)(4,"p",20),l(5,"\u964D\u7D1A\u6A21\u5F0F\uFF08\u9EDE\u64CA\u91CD\u9023\uFF09"),a()()()()}}function m5(i,e){if(i&1){let t=T();s(0,"div",10)(1,"div",21),b("click",function(){v(t);let o=f(2);return x(o.retryConnection())}),a(),s(2,"div",12)(3,"div",13)(4,"p",22),l(5),a(),s(6,"p",15),l(7,"\u9EDE\u64CA\u91CD\u8A66"),a()()()()}if(i&2){let t=f(2);d(5),M(t.backendConnectionMessage())}}function p5(i,e){if(i&1&&(s(0,"div",1),w(1,c5,8,2,"div",10)(2,d5,6,1,"div",10)(3,u5,6,0,"div",10)(4,m5,8,1,"div",10),a()),i&2){let t=f();d(),E(t.offlineCache.isOnline()?t.backendConnectionState()==="connecting"?2:t.backendConnectionState()==="timeout"?3:t.backendConnectionState()==="error"?4:-1:1)}}function g5(i,e){if(i&1&&(s(0,"p",32),l(1),a()),i&2){let t,n=f(2);d(),M((t=n.successOverlayConfig())==null?null:t.subtitle)}}function h5(i,e){if(i&1&&(s(0,"div",2),k(1,"div",23),s(2,"div",24),k(3,"div",25),s(4,"div",26)(5,"div",27)(6,"div",28)(7,"span",29),l(8),a()()(),s(9,"div",30)(10,"h3",31),l(11),a(),w(12,g5,2,1,"p",32),a(),k(13,"div",33)(14,"div",34)(15,"div",35)(16,"div",36),a()()()),i&2){let t,n,o,r=f();d(8),M(((t=r.successOverlayConfig())==null?null:t.icon)||"\u2705"),d(3),M(((n=r.successOverlayConfig())==null?null:n.title)||"\u64CD\u4F5C\u6210\u529F"),d(),E((o=r.successOverlayConfig())!=null&&o.subtitle?12:-1)}}function f5(i,e){if(i&1){let t=T();s(0,"div",7)(1,"div",37),b("click",function(){v(t);let o=f();return x(o.closeQrLogin())}),a(),s(2,"div",38)(3,"app-qr-login",39),b("closed",function(){v(t);let o=f();return x(o.closeQrLogin())})("loginSuccess",function(o){v(t);let r=f();return x(r.onQrLoginSuccess(o))}),a()()()}}function _5(i,e){if(i&1&&(s(0,"p",126),l(1," \u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236 "),s(2,"span",132),l(3),a(),l(4," \u55CE\uFF1F "),a()),i&2){let t,n=f(3);d(3),A("@",((t=n.deleteConfirmDialog().lead)==null?null:t.username)||((t=n.deleteConfirmDialog().lead)==null?null:t.userId))}}function C5(i,e){if(i&1&&(s(0,"p",126),l(1," \u78BA\u5B9A\u8981\u522A\u9664 "),s(2,"span",133),l(3),a(),l(4," \u500B\u9078\u4E2D\u7684\u5BA2\u6236\u55CE\uFF1F "),a()),i&2){let t=f(3);d(3),M(t.deleteConfirmDialog().count)}}function v5(i,e){if(i&1){let t=T();s(0,"div",116),b("click",function(){v(t);let o=f(2);return x(o.cancelDeleteLeads())}),s(1,"div",117),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",118)(3,"div",119),te(),s(4,"svg",120),k(5,"path",121)(6,"line",122)(7,"line",123),a()(),le(),s(8,"h3",124),l(9,"\u78BA\u8A8D\u522A\u9664"),a()(),s(10,"div",125),w(11,_5,5,1,"p",126)(12,C5,5,1,"p",126),s(13,"div",127),l(14," \u26A0\uFE0F \u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\uFF0C\u6240\u6709\u76F8\u95DC\u8A18\u9304\u5C07\u88AB\u6C38\u4E45\u522A\u9664\u3002 "),a()(),s(15,"div",128)(16,"button",129),b("click",function(){v(t);let o=f(2);return x(o.cancelDeleteLeads())}),l(17," \u53D6\u6D88 "),a(),s(18,"button",130),b("click",function(){v(t);let o=f(2);return x(o.executeDeleteLeads())}),te(),s(19,"svg",131),k(20,"path",121),a(),l(21," \u78BA\u8A8D\u522A\u9664 "),a()()()()}if(i&2){let t=f(2);d(11),E(t.deleteConfirmDialog().type==="single"?11:12)}}function x5(i,e){if(i&1){let t=T();s(0,"div",137)(1,"p",141),l(2,"\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44"),a(),s(3,"button",142),b("click",function(){v(t);let o=f(3);return o.currentView.set("multi-role"),x(o.showInviteGroupDialog.set(!1))}),l(4," \u53BB\u5275\u5EFA\u7FA4\u7D44 \u2192 "),a()()}}function b5(i,e){if(i&1){let t=T();s(0,"button",144),b("click",function(){let o=v(t).$implicit,r=f(4);return x(r.executeInviteToGroup(o.id))}),s(1,"div",145)(2,"div")(3,"p",146),l(4),a(),s(5,"p",147),l(6),a()(),s(7,"span",148),l(8,"\u2192"),a()()()}if(i&2){let t=e.$implicit;d(4),M(t.name),d(2),A("",(t.members==null?null:t.members.length)||0," \u500B\u6210\u54E1")}}function S5(i,e){if(i&1&&(s(0,"div",138),$(1,b5,9,2,"button",143,No),a()),i&2){let t=f(3);d(),H(t.collabGroups())}}function y5(i,e){if(i&1){let t=T();s(0,"div",116),b("click",function(){v(t);let o=f(2);return x(o.showInviteGroupDialog.set(!1))}),s(1,"div",117),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",118)(3,"div",134)(4,"span",135),l(5,"\u{1F465}"),a()(),s(6,"div")(7,"h3",124),l(8,"\u9080\u8ACB\u9032\u7FA4"),a(),s(9,"p",32),l(10,"\u9078\u64C7\u5354\u4F5C\u7FA4\u7D44"),a()()(),s(11,"div",136),w(12,x5,5,0,"div",137)(13,S5,3,0,"div",138),a(),s(14,"div",139)(15,"button",140),b("click",function(){v(t);let o=f(2);return x(o.showInviteGroupDialog.set(!1))}),l(16," \u53D6\u6D88 "),a()()()()}if(i&2){let t=f(2);d(12),E(t.collabGroups().length===0?12:13)}}function w5(i,e){if(i&1&&(s(0,"div")(1,"h1",149),l(2),a(),s(3,"p",150),l(4),a()()),i&2){let t=f(2);d(2),M(t.t("title")),d(2),M(t.t("subtitle"))}}function E5(i,e){i&1&&(s(0,"span",152),l(1,"\u{1F948}"),a())}function A5(i,e){i&1&&(s(0,"span",152),l(1,"\u{1F947}"),a())}function D5(i,e){i&1&&(s(0,"span",152),l(1,"\u{1F48E}"),a())}function M5(i,e){i&1&&(s(0,"span",152),l(1,"\u{1F31F}"),a())}function T5(i,e){i&1&&(s(0,"span",153),l(1,"\u{1F451}"),a())}function I5(i,e){if(i&1&&(s(0,"div",151),w(1,E5,2,0,"span",152)(2,A5,2,0,"span",152)(3,D5,2,0,"span",152)(4,M5,2,0,"span",152)(5,T5,2,0,"span",153),a()),i&2){let t,n=f(2);I("badge-silver",n.userMembershipLevel()==="silver")("badge-gold",n.userMembershipLevel()==="gold")("badge-diamond",n.userMembershipLevel()==="diamond")("badge-star",n.userMembershipLevel()==="star")("badge-king",n.userMembershipLevel()==="king"),d(),E((t=n.userMembershipLevel())==="silver"?1:t==="gold"?2:t==="diamond"?3:t==="star"?4:t==="king"?5:-1)}}function k5(i,e){i&1&&(s(0,"span",73)(1,"span",154),l(2,"\u{1F948}"),a(),s(3,"span",155),l(4,"\u767D\u9280\u7CBE\u82F1"),a()())}function P5(i,e){i&1&&(s(0,"span",74)(1,"span",154),l(2,"\u{1F947}"),a(),s(3,"span",155),l(4,"\u9EC3\u91D1\u5927\u5E2B"),a()())}function F5(i,e){i&1&&(s(0,"span",75)(1,"span",154),l(2,"\u{1F48E}"),a(),s(3,"span",155),l(4,"\u947D\u77F3\u738B\u724C"),a()())}function R5(i,e){i&1&&(s(0,"span",76)(1,"span",154),l(2,"\u{1F31F}"),a(),s(3,"span",155),l(4,"\u661F\u8000\u50B3\u8AAA"),a()())}function N5(i,e){i&1&&(s(0,"span",77)(1,"span",154),l(2,"\u{1F451}"),a(),s(3,"span",155),l(4,"\u69AE\u8000\u738B\u8005"),a()())}function B5(i,e){i&1&&(s(0,"span",78)(1,"span",154),l(2,"\u2694\uFE0F"),a(),s(3,"span",155),l(4,"\u9752\u9285\u6230\u58EB"),a()())}function V5(i,e){if(i&1){let t=T();s(0,"div",95)(1,"a",156),b("click",function(){v(t);let o=f(2);return x(o.changeView("accounts"))}),te(),s(2,"svg",84),k(3,"path",157)(4,"circle",158)(5,"path",159)(6,"path",160),a(),le(),s(7,"span"),l(8),a()(),s(9,"a",161),b("click",function(){v(t);let o=f(2);return x(o.changeView("search-discovery"))}),te(),s(10,"svg",84),k(11,"circle",162)(12,"path",163),a(),le(),s(13,"span"),l(14,"\u641C\u7D22\u767C\u73FE"),a(),s(15,"span",164),l(16,"NEW"),a()(),s(17,"a",165),b("click",function(){v(t);let o=f(2);return x(o.changeView("resource-center"))}),te(),s(18,"svg",84),k(19,"ellipse",166)(20,"path",167)(21,"path",168),a(),le(),s(22,"span"),l(23,"\u8CC7\u6E90\u4E2D\u5FC3"),a()(),s(24,"a",83),b("click",function(){v(t);let o=f(2);return x(o.changeView("leads"))}),te(),s(25,"svg",84),k(26,"path",169)(27,"path",170),a(),le(),s(28,"span"),l(29,"\u767C\u9001\u63A7\u5236\u53F0"),a()()()}if(i&2){f();let t=Dt(50),n=f();d(),j("background-color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-item-active)":"transparent")("color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",t==="accounts"||t==="add-account"||t==="api-credentials"),d(7),M(n.t("accounts")),d(),j("background-color",t==="search-discovery"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="search-discovery"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="search-discovery"),d(8),j("background-color",t==="resource-center"||t==="resources"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="resource-center"||t==="resources"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="resource-center"||t==="resources"),d(7),j("background-color",t==="leads"?"var(--sidebar-item-active)":"transparent")("color",t==="leads"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",t==="leads")}}function L5(i,e){if(i&1){let t=T();s(0,"div",95)(1,"a",171),b("click",function(){v(t);let o=f(2);return x(o.changeView("automation"))}),s(2,"div",172)(3,"span",173),l(4,"\u{1F4CA}"),a()(),s(5,"div",174)(6,"span",175),l(7,"\u81EA\u52D5\u5316\u7E3D\u89BD"),a(),s(8,"span",176),l(9,"\u914D\u7F6E\u8207\u76E3\u63A7\u72C0\u614B"),a()()(),s(10,"a",177),b("click",function(){v(t);let o=f(2);return x(o.changeView("monitoring-accounts"))}),s(11,"span",178),l(12,"\u{1F4F1}"),a(),s(13,"span"),l(14,"\u76E3\u63A7\u5E33\u865F"),a()(),s(15,"a",177),b("click",function(){v(t);let o=f(2);return x(o.changeView("monitoring-groups"))}),s(16,"span",178),l(17,"\u{1F4AC}"),a(),s(18,"span"),l(19,"\u76E3\u63A7\u7FA4\u7D44"),a()(),s(20,"a",177),b("click",function(){v(t);let o=f(2);return x(o.changeView("keyword-sets"))}),s(21,"span",178),l(22,"\u{1F511}"),a(),s(23,"span"),l(24,"\u95DC\u9375\u8A5E\u96C6"),a()(),s(25,"a",177),b("click",function(){v(t);let o=f(2);return x(o.changeView("chat-templates"))}),s(26,"span",178),l(27,"\u{1F4DD}"),a(),s(28,"span"),l(29,"\u804A\u5929\u6A21\u677F"),a()(),s(30,"a",177),b("click",function(){v(t);let o=f(2);return x(o.changeView("trigger-rules"))}),s(31,"span",178),l(32,"\u26A1"),a(),s(33,"span"),l(34,"\u89F8\u767C\u898F\u5247"),a()(),s(35,"a",177),b("click",function(){v(t);let o=f(2);return x(o.changeView("collected-users"))}),s(36,"span",178),l(37,"\u{1F465}"),a(),s(38,"span"),l(39,"\u6536\u96C6\u7528\u6236"),a(),s(40,"span",179),l(41,"NEW"),a()()()}if(i&2){f();let t=Dt(50);d(),j("background-color",t==="automation"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="automation"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="automation"),d(),I("bg-gradient-to-br",t==="automation")("from-cyan-500",t==="automation")("to-blue-500",t==="automation")("bg-slate-700/50",t!=="automation")("group-hover:bg-slate-700",t!=="automation"),d(8),j("background-color",t==="monitoring-accounts"?"rgba(6, 182, 212, 0.1)":"transparent")("color",t==="monitoring-accounts"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="monitoring-accounts"),d(5),j("background-color",t==="monitoring-groups"?"rgba(16, 185, 129, 0.1)":"transparent")("color",t==="monitoring-groups"?"#34d399":"var(--sidebar-text)"),I("active",t==="monitoring-groups"),d(5),j("background-color",t==="keyword-sets"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="keyword-sets"?"#a78bfa":"var(--sidebar-text)"),I("active",t==="keyword-sets"),d(5),j("background-color",t==="chat-templates"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="chat-templates"?"#f472b6":"var(--sidebar-text)"),I("active",t==="chat-templates"),d(5),j("background-color",t==="trigger-rules"?"rgba(251, 146, 60, 0.1)":"transparent")("color",t==="trigger-rules"?"#fb923c":"var(--sidebar-text)"),I("active",t==="trigger-rules"),d(5),j("background-color",t==="collected-users"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="collected-users"?"#a78bfa":"var(--sidebar-text)"),I("active",t==="collected-users")}}function O5(i,e){i&1&&(s(0,"span",181),l(1,"1"),a())}function G5(i,e){i&1&&(s(0,"span",182),l(1,"\u{1F48E}"),a())}function U5(i,e){i&1&&(s(0,"span",184),l(1,"2"),a())}function q5(i,e){i&1&&(s(0,"span",182),l(1,"\u{1F48E}"),a())}function $5(i,e){i&1&&(s(0,"span",185),l(1,"3"),a())}function H5(i,e){i&1&&(s(0,"span",182),l(1,"\u{1F947}"),a())}function K5(i,e){if(i&1){let t=T();s(0,"div",95)(1,"a",180),b("click",function(){v(t);let o=f(2);return x(o.changeView("ai-assistant"))}),s(2,"div",172)(3,"span",173),l(4,"\u{1F3AF}"),a()(),s(5,"div",174)(6,"span",175),l(7,"\u7B56\u7565\u898F\u5283"),a(),s(8,"span",176),l(9,"AI \u71DF\u92B7\u52A9\u624B"),a()(),w(10,O5,2,0,"span",181)(11,G5,2,0,"span",182),a(),s(12,"a",183),b("click",function(){v(t);let o=f(2);return x(o.changeView("ai-team"))}),s(13,"div",172)(14,"span",173),l(15,"\u{1F916}"),a()(),s(16,"div",174)(17,"span",175),l(18,"\u81EA\u52D5\u57F7\u884C"),a(),s(19,"span",176),l(20,"AI \u5718\u968A\u92B7\u552E"),a()(),w(21,U5,2,0,"span",184)(22,q5,2,0,"span",182),a(),s(23,"a",183),b("click",function(){v(t);let o=f(2);return x(o.changeView("analytics"))}),s(24,"div",172)(25,"span",173),l(26,"\u{1F4CA}"),a()(),s(27,"div",174)(28,"span",175),l(29,"\u6578\u64DA\u6D1E\u5BDF"),a(),s(30,"span",176),l(31,"\u667A\u80FD\u5206\u6790\u5831\u544A"),a()(),w(32,$5,2,0,"span",185)(33,H5,2,0,"span",182),a()()}if(i&2){f();let t=Dt(50),n=f();d(),j("background-color",t==="ai-assistant"?"rgba(249, 115, 22, 0.15)":"transparent")("color",t==="ai-assistant"?"#fb923c":"var(--sidebar-text)"),I("active",t==="ai-assistant")("opacity-50",!n.membershipService.hasFeature("strategyPlanning")),V("title",n.membershipService.hasFeature("strategyPlanning")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),d(),I("bg-gradient-to-br",t==="ai-assistant")("from-orange-500",t==="ai-assistant")("to-amber-500",t==="ai-assistant")("bg-slate-700/50",t!=="ai-assistant")("group-hover:bg-slate-700",t!=="ai-assistant"),d(8),E(n.membershipService.hasFeature("strategyPlanning")?10:11),d(2),j("background-color",t==="ai-team"?"rgba(168, 85, 247, 0.15)":"transparent")("color",t==="ai-team"?"#c084fc":"var(--sidebar-text)"),I("active",t==="ai-team")("opacity-50",!n.membershipService.hasFeature("autoExecution")),V("title",n.membershipService.hasFeature("autoExecution")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),d(),I("bg-gradient-to-br",t==="ai-team")("from-purple-500",t==="ai-team")("to-pink-500",t==="ai-team")("bg-slate-700/50",t!=="ai-team")("group-hover:bg-slate-700",t!=="ai-team"),d(8),E(n.membershipService.hasFeature("autoExecution")?21:22),d(2),j("background-color",t==="analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="analytics")("opacity-50",!n.membershipService.hasFeature("dataInsightsBasic")),V("title",n.membershipService.hasFeature("dataInsightsBasic")?"":"\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),d(),I("bg-gradient-to-br",t==="analytics")("from-cyan-500",t==="analytics")("to-blue-500",t==="analytics")("bg-slate-700/50",t!=="analytics")("group-hover:bg-slate-700",t!=="analytics"),d(8),E(n.membershipService.hasFeature("dataInsightsBasic")?32:33)}}function z5(i,e){i&1&&(s(0,"span",193),l(1,"\u{1F48E}"),a())}function W5(i,e){if(i&1){let t=T();s(0,"div",95)(1,"a",83),b("click",function(){v(t);let o=f(2);return x(o.changeView("analytics-center"))}),te(),s(2,"svg",84),k(3,"path",186)(4,"path",187)(5,"path",188),a(),le(),s(6,"span"),l(7,"\u5206\u6790\u4E2D\u5FC3"),a()(),s(8,"a",83),b("click",function(){v(t);let o=f(2);return x(o.changeView("lead-nurturing"))}),te(),s(9,"svg",84),k(10,"path",189)(11,"circle",190),a(),le(),s(12,"span"),l(13,"\u5BA2\u6236\u57F9\u80B2"),a(),s(14,"span",191),l(15,"AI"),a()(),s(16,"a",192),b("click",function(){v(t);let o=f(2);return o.changeView("multi-role"),x(o.loadMultiRoleData())}),te(),s(17,"svg",84),k(18,"path",157)(19,"circle",158)(20,"path",159)(21,"path",160),a(),le(),s(22,"span"),l(23,"\u591A\u89D2\u8272\u5354\u4F5C"),a(),w(24,z5,2,0,"span",193),a()()}if(i&2){f();let t=Dt(50),n=f();d(),j("background-color",t==="analytics-center"||t==="nurturing-analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics-center"||t==="nurturing-analytics"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="analytics-center"||t==="nurturing-analytics"),d(7),j("background-color",t==="lead-nurturing"?"rgba(236, 72, 153, 0.15)":"transparent")("color",t==="lead-nurturing"?"#f472b6":"var(--sidebar-text)"),I("active",t==="lead-nurturing"),d(8),j("background-color",t==="multi-role"?"rgba(99, 102, 241, 0.15)":"transparent")("color",t==="multi-role"?"#a5b4fc":n.membershipService.hasFeature("multiRole")?"var(--sidebar-text)":"var(--sidebar-text-muted)"),I("active",t==="multi-role")("opacity-50",!n.membershipService.hasFeature("multiRole"))("cursor-not-allowed",!n.membershipService.hasFeature("multiRole")),V("title",n.membershipService.hasFeature("multiRole")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),d(8),E(n.membershipService.hasFeature("multiRole")?-1:24)}}function J5(i,e){if(i&1&&(s(0,"span",201),l(1),a()),i&2){let t=f(4);d(),M(t.ragBrainService.gapsCount())}}function Q5(i,e){if(i&1){let t=T();s(0,"div",197)(1,"a",199),b("click",function(){v(t);let o=f(3);return x(o.changeView("knowledge-brain"))}),s(2,"span"),l(3,"\u{1F4CA}"),a(),s(4,"span"),l(5,"\u7E3D\u89BD"),a()(),s(6,"a",199),b("click",function(){v(t);let o=f(3);return x(o.changeView("knowledge-manage"))}),s(7,"span"),l(8,"\u{1F4DD}"),a(),s(9,"span"),l(10,"\u77E5\u8B58\u7BA1\u7406"),a()(),s(11,"a",200),b("click",function(){v(t);let o=f(3);return x(o.changeView("knowledge-gaps"))}),s(12,"span"),l(13,"\u2753"),a(),s(14,"span"),l(15,"\u77E5\u8B58\u7F3A\u53E3"),a(),w(16,J5,2,1,"span",201),a()()}if(i&2){f(2);let t=Dt(50),n=f();d(),j("background-color",t==="knowledge-brain"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-brain"?"#f472b6":"var(--sidebar-text-muted)"),I("active",t==="knowledge-brain"),d(5),j("background-color",t==="knowledge-manage"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-manage"?"#f472b6":"var(--sidebar-text-muted)"),I("active",t==="knowledge-manage"),d(5),j("background-color",t==="knowledge-gaps"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-gaps"?"#f472b6":"var(--sidebar-text-muted)"),I("active",t==="knowledge-gaps"),d(5),E(n.ragBrainService.gapsCount()>0?16:-1)}}function Y5(i,e){if(i&1){let t=T();s(0,"div",95)(1,"div",194)(2,"a",83),b("click",function(){v(t);let o=f(2);return x(o.toggleKnowledgeMenu())}),s(3,"span",173),l(4,"\u{1F9E0}"),a(),s(5,"span",195),l(6,"\u77E5\u8B58\u5927\u8166"),a(),s(7,"span",196),l(8,"\u25BC"),a()(),w(9,Q5,17,19,"div",197),a(),s(10,"a",83),b("click",function(){v(t);let o=f(2);return x(o.changeView("ai-center"))}),te(),s(11,"svg",84),k(12,"path",198),a(),le(),s(13,"span"),l(14),a()()()}if(i&2){f();let t=Dt(50),n=f();d(2),j("background-color",n.isKnowledgeView()?"rgba(236, 72, 153, 0.15)":"transparent")("color",n.isKnowledgeView()?"#f472b6":"var(--sidebar-text)"),I("active",n.isKnowledgeView()),d(5),I("rotate-180",n.knowledgeMenuExpanded()),d(2),E(n.knowledgeMenuExpanded()?9:-1),d(),j("background-color",t==="ai-center"?"rgba(168, 85, 247, 0.15)":"transparent")("color",t==="ai-center"?"#c084fc":"var(--sidebar-text)"),I("active",t==="ai-center"),d(4),M(n.t("aiCenter"))}}function X5(i,e){if(i&1){let t=T();s(0,"div",95)(1,"a",83),b("click",function(){v(t);let o=f(2);return x(o.changeView("settings"))}),te(),s(2,"svg",84),k(3,"circle",202)(4,"path",203),a(),le(),s(5,"span"),l(6),a()()()}if(i&2){f();let t=Dt(50),n=f();d(),j("background-color",t==="settings"?"var(--sidebar-item-active)":"transparent")("color",t==="settings"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",t==="settings"),d(5),M(n.t("settings"))}}function Z5(i,e){i&1&&k(0,"app-dashboard-view")}function j5(i,e){i&1&&k(0,"app-accounts-view")}function ew(i,e){if(i&1){let t=T();s(0,"app-add-account-page",204),b("accountAdded",function(o){v(t);let r=f(2);return x(r.onAccountAdded(o))})("back",function(){v(t);let o=f(2);return x(o.changeView("accounts"))}),a()}}function tw(i,e){i&1&&k(0,"app-api-credentials-view")}function nw(i,e){i&1&&k(0,"app-settings-view")}function iw(i,e){i&1&&k(0,"app-leads-view")}function ow(i,e){i&1&&k(0,"app-automation-view")}function rw(i,e){i&1&&k(0,"app-resource-discovery-view")}function sw(i,e){i&1&&k(0,"app-resource-discovery-view")}function aw(i,e){i&1&&k(0,"app-ai-center-view")}function lw(i,e){i&1&&(s(0,"div",109),k(1,"app-ai-brain"),a())}function cw(i,e){i&1&&(s(0,"div",110),k(1,"app-knowledge-gaps"),a())}function dw(i,e){i&1&&(s(0,"div",110),k(1,"app-knowledge-manage"),a())}function uw(i,e){i&1&&k(0,"app-multi-role-view")}function mw(i,e){i&1&&k(0,"app-analytics-view")}function pw(i,e){i&1&&k(0,"app-monitoring-view")}function gw(i,e){i&1&&k(0,"app-monitoring-view")}function hw(i,e){i&1&&k(0,"app-monitoring-view")}function fw(i,e){i&1&&k(0,"app-monitoring-view")}function _w(i,e){i&1&&k(0,"app-monitoring-view")}function Cw(i,e){i&1&&k(0,"app-monitoring-view")}function vw(i,e){i&1&&k(0,"app-monitoring-view")}function xw(i,e){i&1&&k(0,"app-runtime-logs-view")}function bw(i,e){i&1&&k(0,"app-membership-center")}function Sw(i,e){i&1&&k(0,"app-profile")}function yw(i,e){i&1&&k(0,"app-resource-center")}function ww(i,e){i&1&&k(0,"app-search-discovery")}function Ew(i,e){i&1&&k(0,"app-ai-marketing-assistant")}function Aw(i,e){i&1&&k(0,"app-ai-team-hub")}function Dw(i,e){i&1&&k(0,"app-member-database")}function Mw(i,e){i&1&&k(0,"app-leads-view")}function Tw(i,e){i&1&&k(0,"app-analytics-view")}function Iw(i,e){i&1&&k(0,"app-analytics-view")}function kw(i,e){i&1&&k(0,"app-automation-view")}function Pw(i,e){i&1&&k(0,"app-automation-view")}function Fw(i,e){i&1&&k(0,"app-analytics-view")}function Rw(i,e){i&1&&k(0,"app-marketing-report")}function Nw(i,e){i&1&&k(0,"app-runtime-logs-view")}function Bw(i,e){i&1&&k(0,"app-runtime-logs-view")}function Vw(i,e){i&1&&k(0,"app-runtime-logs-view")}function Lw(i,e){i&1&&k(0,"app-dashboard-view")}function Ow(i,e){if(i&1&&l(0),i&2){let t=f();A(" @",t.username," ")}}function Gw(i,e){if(i&1&&l(0),i&2){let t=f();Y(" ",t.firstName," ",t.lastName||""," ")}}function Uw(i,e){if(i&1&&(l(0),Le(1,"slice")),i&2){let t=f();A(" ID: ",On(1,1,t.userId,0,12)," ")}}function qw(i,e){if(i&1&&(s(0,"p",214),l(1),a()),i&2){let t=f();d(),A("\u{1F4F1} ",t.phone)}}function $w(i,e){if(i&1&&(s(0,"span",216),l(1),Le(2,"slice"),a()),i&2){let t=f();d(),A("\u{1F4CD} ",On(2,1,t.sourceGroup,0,20))}}function Hw(i,e){if(i&1&&(s(0,"span",217),l(1),Le(2,"slice"),a()),i&2){let t=f();d(),A("\u{1F511} ",On(2,1,t.triggeredKeyword,0,15))}}function Kw(i,e){if(i&1&&(s(0,"span",226),l(1),a()),i&2){let t=f(),n=f(2);he(n.getIntentLevelColor(t.intentLevel)),d(),Y("",n.getIntentLevelEmoji(t.intentLevel)," ",n.t(t.intentLevel))}}function zw(i,e){if(i&1&&(s(0,"option",230),l(1),a()),i&2){let t=f(4);d(),M(t.t("noSenderAccounts"))}}function Ww(i,e){if(i&1&&(s(0,"option",251),l(1),a()),i&2){let t=e.$implicit,n=f(5);V("value",t.id),d(),Y("",t.phone," (",t.username||n.t(t.status),")")}}function Jw(i,e){if(i&1&&(s(0,"option",230),l(1,"\u9078\u64C7\u767C\u9001\u5E33\u865F..."),a(),$(2,Ww,2,3,"option",251,No)),i&2){let t=f(4);d(2),H(t.senderAccounts())}}function Qw(i,e){if(i&1){let t=T();s(0,"div",231)(1,"p",20),l(2),a(),s(3,"a",252),b("click",function(){v(t);let o=f(4);return o.currentView.set("accounts"),x(o.closeLeadDetailModal())}),l(4,"\u524D\u5F80\u5E33\u865F\u7BA1\u7406 \u2192"),a()()}if(i&2){let t=f(4);d(2),A("\u26A0\uFE0F ",t.t("noSenderAccountsHint"))}}function Yw(i,e){i&1&&(s(0,"span",254),l(1,"\u2713 \u5DF2\u9023\u63A5"),a())}function Xw(i,e){i&1&&(s(0,"span",255),l(1,"\u{1F4DA} RAG \u5DF2\u555F\u7528"),a())}function Zw(i,e){if(i&1&&l(0),i&2){let t=f(6);A(" | \u4F86\u6E90: ",t.generationState().lead.sourceGroup," ")}}function jw(i,e){if(i&1&&l(0),i&2){let t=f(6);A(" | \u89F8\u767C\u8A5E: ",t.generationState().lead.triggerKeyword," ")}}function eE(i,e){if(i&1&&(s(0,"div",256)(1,"strong",265),l(2,"\u5BA2\u6236\u8CC7\u8A0A\uFF1A"),a(),l(3),w(4,Zw,1,1),w(5,jw,1,1),a()),i&2){let t=f(5);d(3),A(" @",t.generationState().lead.username," "),d(),E(t.generationState().lead.sourceGroup?4:-1),d(),E(t.generationState().lead.triggerKeyword?5:-1)}}function tE(i,e){if(i&1&&(s(0,"span",266),l(1,"\u27F3"),a(),s(2,"span"),l(3),a()),i&2){let t=f(5);d(3),M(t.t("generating"))}}function nE(i,e){if(i&1&&(s(0,"span"),l(1,"\u2728"),a(),s(2,"span"),l(3),a()),i&2){let t=f(5);d(3),M(t.t("generateWithAi"))}}function iE(i,e){if(i&1){let t=T();s(0,"button",267),b("click",function(){v(t);let o=f(5);return x(o.generateMessage())}),l(1," \u{1F504} "),a()}}function oE(i,e){if(i&1){let t=T();s(0,"div",262),l(1),s(2,"a",268),b("click",function(){v(t);let o=f(5);return o.currentView.set("settings"),x(o.closeLeadDetailModal())}),l(3),a()()}if(i&2){let t=f(5);d(),A(" \u26A0\uFE0F ",t.t("aiNotConfigured")," "),d(2),M(t.t("goToSettings"))}}function rE(i,e){if(i&1){let t=T();s(0,"div",263)(1,"strong"),l(2),a(),l(3),s(4,"button",269),b("click",function(){v(t);let o=f(5);return x(o.generateMessage())}),l(5,"\u91CD\u8A66"),a()()}if(i&2){let t=f(5);d(2),A("",t.t("error"),":"),d(),A(" ",t.generationState().error," ")}}function sE(i,e){i&1&&(s(0,"div",264)(1,"p",270),l(2,"\u2713 AI \u5DF2\u751F\u6210\u6D88\u606F\uFF0C\u60A8\u53EF\u4EE5\u5728\u4E0B\u65B9\u7DE8\u8F2F\u5F8C\u767C\u9001"),a()())}function aE(i,e){if(i&1){let t=T();s(0,"div",236)(1,"div",253)(2,"div",211)(3,"span",173),l(4,"\u{1F916}"),a(),s(5,"span",32),l(6),a(),w(7,Yw,2,0,"span",254),a(),w(8,Xw,2,0,"span",255),a(),w(9,eE,6,3,"div",256),s(10,"div")(11,"label",257),l(12),a(),s(13,"textarea",258),b("ngModelChange",function(o){v(t);let r=f(4);return x(r.updateCustomPrompt(o))}),l(14,"                        "),a()(),s(15,"div",259)(16,"button",260),b("click",function(){v(t);let o=f(4);return x(o.generateMessage())}),w(17,tE,4,1)(18,nE,4,1),a(),w(19,iE,2,0,"button",261),a(),w(20,oE,4,2,"div",262),w(21,rE,6,2,"div",263),w(22,sE,3,0,"div",264),a()}if(i&2){let t=f(4);d(6),A(" ",t.aiApiType()==="local"?"\u672C\u5730 AI":t.aiApiType()==="openai"?"OpenAI":t.aiApiType()==="custom"?"\u81EA\u5B9A\u7FA9 API":"Gemini"," "),d(),E(t.isAiConfigured()?7:-1),d(),E(t.ragEnabled()?8:-1),d(),E(t.generationState().lead?9:-1),d(3),M(t.t("customizePrompt")),d(),V("ngModel",t.generationState().customPrompt)("placeholder",t.t("aiPromptPlaceholder")),d(3),V("disabled",t.generationState().status==="loading"||!t.isAiConfigured()),d(),E(t.generationState().status==="loading"?17:18),d(2),E(t.generationState().status==="success"?19:-1),d(),E(t.isAiConfigured()?-1:20),d(),E(t.generationState().status==="error"?21:-1),d(),E(t.generationState().status==="success"&&t.generationState().generatedMessage?22:-1)}}function lE(i,e){if(i&1&&(s(0,"option",251),l(1),a()),i&2){let t=e.$implicit;V("value",t.id),d(),M(t.name)}}function cE(i,e){if(i&1){let t=T();s(0,"div",227)(1,"label",228),l(2),a(),s(3,"select",271),b("change",function(o){v(t);let r=f(4);return x(r.applyTemplate(o))}),s(4,"option",230),l(5),a(),$(6,lE,2,2,"option",251,No),a()()}if(i&2){let t=f(4);d(2),A("\u{1F4CB} ",t.t("selectTemplate")),d(3),M(t.t("selectTemplatePlaceholder")),d(),H(t.messageTemplates())}}function dE(i,e){if(i&1){let t=T();s(0,"button",272),b("click",function(){v(t);let o=f(4);return x(o.addMoreAttachments("file"))}),l(1," \u2795 \u6DFB\u52A0\u66F4\u591A "),a(),s(2,"button",273),b("click",function(){v(t);let o=f(4);return x(o.clearAllAttachments())}),l(3," \u{1F5D1}\uFE0F \u6E05\u7A7A "),a()}}function uE(i,e){i&1&&(s(0,"span",278),l(1,"\u{1F5BC}\uFE0F"),a())}function mE(i,e){i&1&&(s(0,"span",279),l(1,"\u{1F4C4}"),a())}function pE(i,e){if(i&1&&(s(0,"span",281),l(1),a()),i&2){let t=f().$implicit;d(),A(" (",(t.fileSize/1024/1024).toFixed(2)," MB) ")}}function gE(i,e){i&1&&(s(0,"span",282),l(1,"\u2713"),a())}function hE(i,e){if(i&1){let t=T();s(0,"div",276)(1,"div",277),w(2,uE,2,0,"span",278)(3,mE,2,0,"span",279),s(4,"span",280),l(5),a(),w(6,pE,2,1,"span",281),w(7,gE,2,0,"span",282),a(),s(8,"button",283),b("click",function(){let o=v(t).$index,r=f(5);return x(r.removeAttachmentByIndex(o))}),l(9,"\xD7"),a()()}if(i&2){let t=e.$implicit;d(2),E(t.type==="image"?2:3),d(3),M(t.name),d(),E(t.fileSize?6:-1),d(),E(t.filePath?7:-1)}}function fE(i,e){if(i&1&&(s(0,"div",243)(1,"div",237)(2,"span",274),l(3),a(),s(4,"span",147),l(5),a()(),s(6,"div",275),$(7,hE,10,4,"div",276,r5),a()()),i&2){let t=f(4);d(3),A("\u{1F4CE} \u9644\u4EF6\u5217\u8868 (",t.generationState().attachments.length,")"),d(2),A(" \u7E3D\u5927\u5C0F: ",t.getTotalAttachmentSize()," MB "),d(2),H(t.generationState().attachments)}}function _E(i,e){i&1&&l(0," \u26A0\uFE0F \u7121\u53EF\u7528\u767C\u9001\u5E33\u865F ")}function CE(i,e){i&1&&l(0," \u26A0\uFE0F \u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F ")}function vE(i,e){i&1&&l(0," \u26A0\uFE0F \u8ACB\u8F38\u5165\u8A0A\u606F\u5167\u5BB9\u6216\u6DFB\u52A0\u9644\u4EF6 ")}function xE(i,e){if(i&1&&(s(0,"div",244)(1,"p",284),w(2,_E,1,0)(3,CE,1,0)(4,vE,1,0),a()()),i&2){let t=f(4);d(2),E(t.senderAccounts().length===0?2:t.selectedSenderId()?t.editableMessage().trim().length===0&&!t.generationState().attachment&&t.generationState().attachments.length===0?4:-1:3)}}function bE(i,e){i&1&&(s(0,"div",245)(1,"p",285),l(2,"\u{1F6AB} \u6B64\u5BA2\u6236\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE\uFF0C\u7121\u6CD5\u767C\u9001\u8A0A\u606F"),a()())}function SE(i,e){if(i&1){let t=T();s(0,"div",224)(1,"div",227)(2,"label",228),l(3),a(),s(4,"select",229),b("ngModelChange",function(o){v(t);let r=f(3);return x(r.selectedSenderId.set(o))}),w(5,zw,2,1,"option",230)(6,Jw,4,0),a(),w(7,Qw,5,1,"div",231),a(),s(8,"div",232)(9,"label",233),b("click",function(){v(t);let o=f(3);return x(o.messageMode.set("manual"))}),s(10,"div",234),l(11,"\u{1F4DD}"),a(),s(12,"span",235),l(13),a()(),s(14,"label",233),b("click",function(){v(t);let o=f(3);return x(o.messageMode.set("ai"))}),s(15,"div",234),l(16,"\u{1F916}"),a(),s(17,"span",235),l(18),a()(),s(19,"label",233),b("click",function(){v(t);let o=f(3);return x(o.messageMode.set("template"))}),s(20,"div",234),l(21,"\u{1F4CB}"),a(),s(22,"span",235),l(23),a()()(),w(24,aE,23,13,"div",236),w(25,cE,8,2,"div",227),s(26,"div",227)(27,"div",237)(28,"label",238),l(29),a(),s(30,"span",239),l(31),a()(),s(32,"textarea",240),b("ngModelChange",function(o){v(t);let r=f(3);return x(r.editableMessage.set(o))}),l(33,"                "),a()(),s(34,"div",236)(35,"div",241)(36,"button",242),b("click",function(){v(t);let o=f(3);return x(o.selectAttachment("image",!0))}),l(37),a(),s(38,"button",242),b("click",function(){v(t);let o=f(3);return x(o.selectAttachment("file",!0))}),l(39),a(),w(40,dE,4,0),a(),w(41,fE,9,2,"div",243),a(),w(42,xE,5,1,"div",244),w(43,bE,3,0,"div",245),s(44,"div",246)(45,"button",247),b("click",function(){v(t);let o=f(),r=f(2);return x(r.addToDoNotContact(o.id))}),l(46),a(),s(47,"div",248)(48,"button",249),b("click",function(){v(t);let o=f(3);return x(o.closeLeadDetailModal())}),l(49),a(),s(50,"button",250),b("click",function(){v(t);let o=f(3);return x(o.sendMessageToLead())}),l(51),a()()()()}if(i&2){let t=f(),n=f(2);d(3),A("\u{1F4E4} ",n.t("selectSenderAccount")),d(),V("ngModel",n.selectedSenderId()),d(),E(n.senderAccounts().length===0?5:6),d(2),E(n.senderAccounts().length===0?7:-1),d(2),he(n.messageMode()==="manual"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),d(4),M(n.t("manualInput")),d(),he(n.messageMode()==="ai"?"bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),d(4),M(n.t("aiGenerate")),d(),he(n.messageMode()==="template"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),d(4),M(n.t("useTemplate")),d(),E(n.messageMode()==="ai"?24:-1),d(),E(n.messageMode()==="template"?25:-1),d(4),A("\u270F\uFE0F ",n.t("messageContent")),d(2),Y("",n.editableMessage().length," ",n.t("characters")),d(),V("ngModel",n.editableMessage())("placeholder",n.t("messageContentPlaceholder")),d(5),A(" \u{1F5BC}\uFE0F ",n.t("attachImage")," "),d(2),A(" \u{1F4CE} ",n.t("attachFile")," "),d(),E(n.generationState().attachments.length>0?40:-1),d(),E(n.generationState().attachments.length>0?41:-1),d(),E(!n.canSendMessage()&&!t.doNotContact?42:-1),d(),E(t.doNotContact?43:-1),d(2),V("disabled",t.doNotContact),d(),A(" \u{1F6AB} ",t.doNotContact?n.t("userOnDNC"):n.t("addToDNC")," "),d(3),A(" ",n.t("cancel")," "),d(),V("disabled",!n.canSendMessage()||t.doNotContact),d(),A(" \u2708\uFE0F ",n.t("sendMessage")," ")}}function yE(i,e){i&1&&(s(0,"span",266),l(1,"\u27F3"),a(),s(2,"span"),l(3,"\u52A0\u8F09\u4E2D..."),a())}function wE(i,e){i&1&&(s(0,"span"),l(1,"\u{1F4AC}"),a(),s(2,"span"),l(3,"\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304"),a())}function EE(i,e){if(i&1&&(s(0,"span",147),l(1),a()),i&2){let t=f(4);d(),A("\u5171 ",t.chatHistory().length," \u689D\u6D88\u606F")}}function AE(i,e){if(i&1&&(s(0,"div",296)(1,"div",298)(2,"div",299)(3,"p",300),l(4),a()(),s(5,"p",15),l(6),a()()()),i&2){let t=f().$implicit,n=f(5);d(4),M(t.content),d(2),M(n.formatTimestamp(t.timestamp))}}function DE(i,e){if(i&1&&(s(0,"div",297)(1,"div",298)(2,"div",301)(3,"p",300),l(4),a()(),s(5,"div",302)(6,"span",147),l(7),a(),s(8,"span",303),l(9,"\u{1F916} AI"),a()()()()),i&2){let t=f().$implicit,n=f(5);d(4),M(t.content),d(3),M(n.formatTimestamp(t.timestamp))}}function ME(i,e){if(i&1&&w(0,AE,7,2,"div",296)(1,DE,10,2,"div",297),i&2){let t=e.$implicit;E(t.role==="user"?0:t.role==="assistant"?1:-1)}}function TE(i,e){i&1&&(s(0,"div",294)(1,"span",304),l(2,"\u27F3"),a(),s(3,"span",305),l(4,"\u52A0\u8F09\u4E2D..."),a()())}function IE(i,e){if(i&1){let t=T();s(0,"div",295)(1,"button",306),b("click",function(){v(t);let o=f(5);return x(o.loadMoreChatHistory())}),l(2," \u52A0\u8F09\u66F4\u591A\u6D88\u606F "),a()()}}function kE(i,e){if(i&1){let t=T();s(0,"div",293),b("scroll",function(o){v(t);let r=f(4);return x(r.onChatHistoryScroll(o))}),$(1,ME,2,1,null,null,Lo().trackByChatMessageId,!0),w(3,TE,5,0,"div",294),w(4,IE,3,0,"div",295),a()}if(i&2){let t=f(4);d(),H(t.chatHistory()),d(2),E(t.chatHistoryLoadingMore()?3:-1),d(),E(t.chatHistoryHasMore()&&!t.chatHistoryLoadingMore()?4:-1)}}function PE(i,e){i&1&&(s(0,"span",303),l(1,"\u{1F916} AI"),a())}function FE(i,e){if(i&1&&(s(0,"div",297)(1,"div",298)(2,"div",301)(3,"p",300),l(4),a()(),s(5,"div",302)(6,"span",147),l(7),a(),w(8,PE,2,0,"span",303),a()()()),i&2){let t=f().$implicit,n=f(4);d(4),M(t.content),d(3),M(n.formatTimestamp(t.timestamp)),d(),E(t.type.includes("AI")?8:-1)}}function RE(i,e){if(i&1&&(s(0,"div",296)(1,"div",298)(2,"div",299)(3,"p",300),l(4),a()(),s(5,"p",15),l(6),a()()()),i&2){let t=f().$implicit,n=f(4);d(4),M(t.content),d(2),M(n.formatTimestamp(t.timestamp))}}function NE(i,e){if(i&1&&(s(0,"div",307)(1,"div",308),l(2),a()()),i&2){let t=f().$implicit,n=f(4);d(2),je(" ",t.type,": ",t.content," \xB7 ",n.formatTimestamp(t.timestamp)," ")}}function BE(i,e){if(i&1&&w(0,FE,9,3,"div",297)(1,RE,7,2,"div",296)(2,NE,3,3,"div",307),i&2){let t=e.$implicit;E(t.type.includes("Sent")||t.type.includes("Message")?0:t.type.includes("Reply")||t.type.includes("Received")?1:2)}}function VE(i,e){if(i&1&&(s(0,"div",291)(1,"div",309),l(2,"\u{1F4AC}"),a(),s(3,"p",310),l(4),a(),s(5,"p",311),l(6,"\u9EDE\u64CA\u300C\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304\u300D\u67E5\u770B\u6240\u6709\u5C0D\u8A71"),a()()),i&2){let t=f(4);d(4),M(t.t("noHistoryFound"))}}function LE(i,e){if(i&1&&(s(0,"div",292)(1,"h4",312)(2,"span"),l(3,"\u{1F4CA}"),a(),l(4," AI \u5C0D\u8A71\u5206\u6790 "),a(),s(5,"div",313)(6,"div",314)(7,"p",315),l(8,"\u7E3D\u4E92\u52D5"),a(),s(9,"p",124),l(10),a()(),s(11,"div",314)(12,"p",315),l(13,"\u5C0D\u8A71\u968E\u6BB5"),a(),s(14,"p",316),l(15),a()(),s(16,"div",314)(17,"p",315),l(18,"\u8208\u8DA3\u7A0B\u5EA6"),a(),s(19,"p",173),l(20,"\u2B50\u2B50\u2B50"),a()()()()),i&2){let t=f(2);d(10),M(t.interactionHistory.length),d(5),M(t.status||"\u521D\u6B21\u63A5\u89F8")}}function OE(i,e){if(i&1){let t=T();s(0,"div",225)(1,"div",286)(2,"button",287),b("click",function(){v(t);let o=f(),r=f(2);return x(r.loadChatHistory(o.userId))}),w(3,yE,4,0)(4,wE,4,0),a(),w(5,EE,2,1,"span",147),a(),w(6,kE,5,2,"div",288),s(7,"div",289)(8,"div",290),$(9,BE,3,1,null,null,Lo().trackByChatMessageId,!0),a()(),w(11,VE,7,1,"div",291),w(12,LE,21,2,"div",292),a()}if(i&2){let t=f(),n=f(2);d(2),V("disabled",n.isLoadingChatHistory()),d(),E(n.isLoadingChatHistory()?3:4),d(2),E(n.selectedChatUserId()===t.userId&&n.chatHistory().length>0?5:-1),d(),E(n.selectedChatUserId()===t.userId&&n.chatHistory().length>0?6:-1),d(3),H(t.interactionHistory),d(2),E(t.interactionHistory.length===0&&(!n.selectedChatUserId()||n.chatHistory().length===0)?11:-1),d(),E(t.interactionHistory.length>0?12:-1)}}function GE(i,e){if(i&1){let t=T();s(0,"div",205),b("click",function(){v(t);let o=f(2);return x(o.closeLeadDetailModal())}),s(1,"div",206),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",207)(3,"div",208)(4,"div",209)(5,"div",210),l(6),a(),s(7,"div")(8,"div",211)(9,"h3",212),w(10,Ow,1,1)(11,Gw,1,2)(12,Uw,2,5),a(),k(13,"span",213),a(),w(14,qw,2,1,"p",214),s(15,"div",215),w(16,$w,3,5,"span",216),w(17,Hw,3,5,"span",217),w(18,Kw,2,4,"span",218),a()()(),s(19,"button",219),b("click",function(){v(t);let o=f(2);return x(o.closeLeadDetailModal())}),l(20,"\u2715"),a()()(),s(21,"div",220)(22,"nav",221)(23,"a",222),b("click",function(){v(t);let o=f(2);return x(o.leadDetailView.set("sendMessage"))}),l(24),a(),s(25,"a",222),b("click",function(){v(t);let o=f(2);return x(o.leadDetailView.set("history"))}),l(26),a()()(),s(27,"div",223),w(28,SE,52,31,"div",224),w(29,OE,13,6,"div",225),a()()()}if(i&2){let t=e,n=f(2);d(6),A(" ",(t.username||t.firstName||t.userId||"?")[0].toUpperCase()," "),d(4),E(t.username?10:t.firstName?11:12),d(3),he(n.getOnlineStatusColor(t.onlineStatus)),d(),E(t.phone?14:-1),d(2),E(t.sourceGroup?16:-1),d(),E(t.triggeredKeyword&&t.triggeredKeyword!=="\u7121"?17:-1),d(),E(t.intentLevel?18:-1),d(5),I("border-cyan-400",n.leadDetailView()==="sendMessage")("text-cyan-400",n.leadDetailView()==="sendMessage")("bg-cyan-500/10",n.leadDetailView()==="sendMessage"),d(),A(" \u{1F4AC} ",n.t("sendMessageTab")," "),d(),I("border-cyan-400",n.leadDetailView()==="history")("text-cyan-400",n.leadDetailView()==="history")("bg-cyan-500/10",n.leadDetailView()==="history"),d(),A(" \u{1F4CB} ",n.t("historyTab")," "),d(2),E(n.leadDetailView()==="sendMessage"?28:-1),d(),E(n.leadDetailView()==="history"?29:-1)}}function UE(i,e){i&1&&(s(0,"div",330),te(),s(1,"svg",333),k(2,"circle",334)(3,"path",335),a(),le(),s(4,"p"),l(5,"\u66AB\u7121\u64CD\u4F5C\u6B77\u53F2"),a()())}function qE(i,e){i&1&&(s(0,"span",340),l(1,"\uFF08\u5DF2\u64A4\u92B7\uFF09"),a())}function $E(i,e){if(i&1&&(s(0,"span",341),l(1),a()),i&2){let t=f().$implicit;d(),A("",t.failureCount," \u5931\u6557")}}function HE(i,e){if(i&1){let t=T();s(0,"button",343),b("click",function(){v(t);let o=f().$implicit,r=f(4);return x(r.undoBatchOperation(o.id))}),l(1," \u64A4\u92B7 "),a()}}function KE(i,e){if(i&1&&(s(0,"div",337)(1,"div",145)(2,"div",64)(3,"div",338),te(),s(4,"svg",131),k(5,"rect",86)(6,"rect",87)(7,"rect",88)(8,"rect",89),a()(),le(),s(9,"div")(10,"p",339),l(11),a(),s(12,"p",147),l(13),w(14,qE,2,0,"span",340),a()()(),s(15,"div",64)(16,"div",300)(17,"span",278),l(18),a(),w(19,$E,2,1,"span",341),a(),w(20,HE,2,0,"button",342),a()()()),i&2){let t=e.$implicit,n=f(4);I("opacity-50",t.reversed),d(3),I("bg-cyan-500/20",t.operationType==="update_status")("bg-blue-500/20",t.operationType==="add_tag")("bg-red-500/20",t.operationType==="delete"||t.operationType==="add_to_dnc"),d(),I("text-cyan-400",t.operationType==="update_status")("text-blue-400",t.operationType==="add_tag")("text-red-400",t.operationType==="delete"||t.operationType==="add_to_dnc"),d(7),M(n.getOperationTypeName(t.operationType)),d(2),Y(" ",t.itemCount," \u9805 \xB7 ",n.formatBatchOperationDate(t.createdAt)," "),d(),E(t.reversed?14:-1),d(4),A("",t.successCount," \u6210\u529F"),d(),E(t.failureCount>0?19:-1),d(),E(t.isReversible&&!t.reversed?20:-1)}}function zE(i,e){if(i&1&&(s(0,"div",236),$(1,KE,21,21,"div",336,No),a()),i&2){let t=f(3);d(),H(t.batchOperationHistory())}}function WE(i,e){if(i&1){let t=T();s(0,"div",317),b("click",function(){v(t);let o=f(2);return x(o.showBatchOperationHistory.set(!1))}),s(1,"div",318),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",319)(3,"h3",320),te(),s(4,"svg",321),k(5,"path",322)(6,"path",323)(7,"path",324),a(),l(8," \u6279\u91CF\u64CD\u4F5C\u6B77\u53F2 "),a(),le(),s(9,"button",325),b("click",function(){v(t);let o=f(2);return x(o.showBatchOperationHistory.set(!1))}),te(),s(10,"svg",326),k(11,"line",327)(12,"line",328),a()()(),le(),s(13,"div",329),w(14,UE,6,0,"div",330)(15,zE,3,0,"div",236),a(),s(16,"div",331)(17,"button",332),b("click",function(){v(t);let o=f(2);return x(o.showBatchOperationHistory.set(!1))}),l(18," \u95DC\u9589 "),a()()()()}if(i&2){let t=f(2);d(14),E(t.batchOperationHistory().length===0?14:15)}}function JE(i,e){i&1&&(s(0,"div",351)(1,"div",357)(2,"div",358)(3,"div",359),l(4,"\u{1F916}"),a(),s(5,"div",360),l(6,"AI \u81EA\u52D5\u56DE\u8986"),a(),s(7,"div",14),l(8,"\u667A\u80FD\u5BA2\u670D\u52A9\u624B"),a()(),s(9,"div",358)(10,"div",359),l(11,"\u{1F50D}"),a(),s(12,"div",360),l(13,"\u8CC7\u6E90\u767C\u73FE"),a(),s(14,"div",14),l(15,"\u81EA\u52D5\u641C\u7D22\u7FA4\u7D44"),a()(),s(16,"div",358)(17,"div",359),l(18,"\u{1F4CA}"),a(),s(19,"div",360),l(20,"\u6578\u64DA\u5206\u6790"),a(),s(21,"div",14),l(22,"\u8F49\u5316\u8FFD\u8E64\u5831\u8868"),a()()(),s(23,"p",361),l(24," TG-AI\u667A\u63A7\u738B \u5C07\u5E6B\u52A9\u60A8\u81EA\u52D5\u5316 Telegram \u71DF\u92B7\u6D41\u7A0B\uFF0C"),k(25,"br"),l(26," \u8B93\u60A8\u5C08\u6CE8\u65BC\u696D\u52D9\u589E\u9577\u800C\u975E\u91CD\u8907\u64CD\u4F5C\u3002 "),a()())}function QE(i,e){if(i&1&&(s(0,"option",251),l(1),a()),i&2){let t=e.$implicit;V("value",t),d(),M(t)}}function YE(i,e){if(i&1){let t=T();s(0,"select",370),b("ngModelChange",function(o){v(t);let r=f(5);return x(r.localAiModel.set(o))}),$(1,QE,2,2,"option",251,ke),a()}if(i&2){let t=f(5);V("ngModel",t.localAiModel()),d(),H(t.detectedOllamaModels())}}function XE(i,e){if(i&1){let t=T();s(0,"input",371),b("ngModelChange",function(o){v(t);let r=f(5);return x(r.localAiModel.set(o))}),a()}if(i&2){let t=f(5);V("ngModel",t.localAiModel())}}function ZE(i,e){if(i&1&&(s(0,"div",358)(1,"label",367),l(2,"\u9078\u64C7 AI \u6A21\u578B"),a(),w(3,YE,3,1,"select",368)(4,XE,1,1,"input",369),s(5,"p",15),l(6,"\u63A8\u85A6\uFF1Aqwen2:7b\uFF08\u4E2D\u82F1\u6587\u901A\u7528\uFF09"),a()()),i&2){let t=f(4);d(3),E(t.detectedOllamaModels().length>0?3:4)}}function jE(i,e){if(i&1){let t=T();s(0,"div",377)(1,"select",378),b("ngModelChange",function(o){v(t);let r=f(5);return x(r.aiBackupProvider.set(o))}),s(2,"option",379),l(3,"Google Gemini\uFF08\u514D\u8CBB\u984D\u5EA6\uFF09"),a(),s(4,"option",380),l(5,"OpenAI GPT"),a()()()}if(i&2){let t=f(5);d(),V("ngModel",t.aiBackupProvider())}}function e3(i,e){if(i&1){let t=T();s(0,"div",358)(1,"div",372)(2,"p",175),l(3,"\u{1F4E6} \u5B89\u88DD Ollama\uFF08\u514D\u8CBB\uFF09\uFF1A"),a(),s(4,"code",373),l(5," curl -fsSL https://ollama.com/install.sh | sh "),a(),s(6,"p",147),l(7," \u5B89\u88DD\u5F8C\u904B\u884C "),s(8,"code",265),l(9,"ollama pull qwen2:7b"),a(),l(10," \u4E0B\u8F09\u6A21\u578B "),a()()(),s(11,"div",358)(12,"label",374)(13,"input",375),b("change",function(){v(t);let o=f(4);return x(o.aiAutoFallback.set(!o.aiAutoFallback()))}),a(),s(14,"span",376),l(15,"\u4F7F\u7528\u96F2\u7AEF AI \u4F5C\u70BA\u5099\u9078"),a()(),w(16,jE,6,1,"div",377),a()}if(i&2){let t=f(4);d(13),V("checked",t.aiAutoFallback()),d(3),E(t.aiAutoFallback()?16:-1)}}function t3(i,e){if(i&1){let t=T();s(0,"div",224)(1,"h3",362),l(2,"\u{1F999} AI \u670D\u52D9\u914D\u7F6E"),a(),s(3,"div",363)(4,"div",145)(5,"div",64)(6,"span",364),l(7),a(),s(8,"div")(9,"div",365),l(10),a(),s(11,"div",32),l(12),a()()(),s(13,"button",366),b("click",function(){v(t);let o=f(3);return x(o.detectOllama())}),l(14),a()()(),w(15,ZE,7,1,"div",358)(16,e3,17,2),a()}if(i&2){let t=f(3);d(3),he(t.ollamaDetected()?"bg-green-500/20 border border-green-500/30":"bg-yellow-500/20 border border-yellow-500/30"),d(4),M(t.ollamaDetected()?"\u2705":"\u26A0\uFE0F"),d(3),A(" ",t.ollamaDetected()?"Ollama \u5DF2\u6AA2\u6E2C\u5230":"Ollama \u672A\u904B\u884C"," "),d(2),A(" ",t.ollamaDetected()?"\u672C\u5730 AI \u670D\u52D9\u53EF\u7528":"\u5EFA\u8B70\u5B89\u88DD Ollama \u7372\u5F97\u514D\u8CBB AI \u80FD\u529B"," "),d(),V("disabled",t.isDetectingOllama()),d(),A(" ",t.isDetectingOllama()?"\u6AA2\u6E2C\u4E2D...":"\u91CD\u65B0\u6AA2\u6E2C"," "),d(),E(t.ollamaDetected()?15:16)}}function n3(i,e){if(i&1&&(s(0,"p"),l(1),a()),i&2){let t=f(4);d(),A("\u2705 \u6A21\u578B\uFF1A",t.localAiModel())}}function i3(i,e){if(i&1&&(s(0,"div",351)(1,"div",381),l(2,"\u{1F389}"),a(),s(3,"h3",382),l(4,"\u8A2D\u7F6E\u5B8C\u6210\uFF01"),a(),s(5,"p",361),l(6," \u60A8\u5DF2\u6E96\u5099\u597D\u958B\u59CB\u4F7F\u7528 TG-AI\u667A\u63A7\u738B\u3002"),k(7,"br"),l(8," \u63A5\u4E0B\u4F86\u8ACB\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B Telegram \u5E33\u865F\u3002 "),a(),s(9,"div",383)(10,"div",384)(11,"p"),l(12),a(),w(13,n3,2,1,"p"),s(14,"p"),l(15),a()()()()),i&2){let t=f(3);d(12),A("\u2705 AI \u670D\u52D9\uFF1A",t.ollamaDetected()?"Ollama \u672C\u5730 AI":"\u96F2\u7AEF AI"),d(),E(t.ollamaDetected()?13:-1),d(2),A("\u2705 \u81EA\u52D5\u964D\u7D1A\uFF1A",t.aiAutoFallback()?"\u5DF2\u555F\u7528":"\u5DF2\u7981\u7528")}}function o3(i,e){if(i&1){let t=T();s(0,"button",385),b("click",function(){v(t);let o=f(3);return x(o.welcomeStep.set(o.welcomeStep()-1))}),l(1," \u4E0A\u4E00\u6B65 "),a()}}function r3(i,e){if(i&1){let t=T();s(0,"button",386),b("click",function(){v(t);let o=f(3);return x(o.welcomeStep.set(o.welcomeStep()+1))}),l(1," \u4E0B\u4E00\u6B65 "),a()}}function s3(i,e){if(i&1){let t=T();s(0,"button",387),b("click",function(){v(t);let o=f(3);return x(o.completeFirstRunSetup())}),l(1," \u958B\u59CB\u4F7F\u7528 \u{1F680} "),a()}}function a3(i,e){if(i&1){let t=T();s(0,"div",113)(1,"div",344)(2,"div",345)(3,"h1",346),l(4,"\u{1F680} \u6B61\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B"),a(),s(5,"p",347),l(6,"AI \u9A45\u52D5\u7684 Telegram \u71DF\u92B7\u81EA\u52D5\u5316\u5E73\u53F0"),a()(),s(7,"div",348),k(8,"div",349)(9,"div",349)(10,"div",349),a(),s(11,"div",350),w(12,JE,27,0,"div",351)(13,t3,17,8,"div",224)(14,i3,16,3,"div",351),a(),s(15,"div",352)(16,"button",353),b("click",function(){v(t);let o=f(2);return x(o.skipFirstRunSetup())}),l(17," \u8DF3\u904E\u8A2D\u7F6E "),a(),s(18,"div",248),w(19,o3,2,0,"button",354),w(20,r3,2,0,"button",355)(21,s3,2,0,"button",356),a()()()()}if(i&2){let t,n=f(2);d(8),he(n.welcomeStep()>=1?"bg-cyan-500":"bg-slate-600"),d(),he(n.welcomeStep()>=2?"bg-cyan-500":"bg-slate-600"),d(),he(n.welcomeStep()>=3?"bg-cyan-500":"bg-slate-600"),d(2),E((t=n.welcomeStep())===1?12:t===2?13:t===3?14:-1),d(7),E(n.welcomeStep()>1?19:-1),d(),E(n.welcomeStep()<3?20:21)}}function l3(i,e){if(i&1&&(s(0,"p",403),l(1),a()),i&2){let t=f().$implicit;d(),Y(" \u2713 \u6709\u5143\u6578\u64DA: ",t.metadata.firstName||""," ",t.metadata.username?"@"+t.metadata.username:""," ")}}function c3(i,e){i&1&&(s(0,"p",404),l(1,"\u26A0 \u7121\u5143\u6578\u64DA\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u9304\u9A57\u8B49"),a())}function d3(i,e){if(i&1&&(s(0,"div",396)(1,"div",64)(2,"span",364),l(3,"\u{1F4F1}"),a(),s(4,"div")(5,"p",402),l(6),a(),w(7,l3,2,2,"p",403)(8,c3,2,0,"p",404),a()()()),i&2){let t=e.$implicit;d(6),A("+",t.phone),d(),E(t.hasMetadata&&t.metadata?7:8)}}function u3(i,e){i&1&&(s(0,"span",266),l(1,"\u23F3"),a(),s(2,"span"),l(3,"\u6062\u5FA9\u4E2D..."),a())}function m3(i,e){i&1&&(s(0,"span"),l(1,"\u{1F504}"),a(),s(2,"span"),l(3,"\u6062\u5FA9\u5E33\u865F"),a())}function p3(i,e){if(i&1){let t=T();s(0,"div",113)(1,"div",388)(2,"div",389)(3,"div",390),l(4,"\u{1F504}"),a(),s(5,"h2",391),l(6,"\u767C\u73FE\u53EF\u6062\u5FA9\u7684\u5E33\u865F"),a(),s(7,"p",392),l(8),a()(),s(9,"div",393)(10,"p",394),l(11," \u9019\u4E9B Session \u6587\u4EF6\u5B58\u5728\u65BC\u7CFB\u7D71\u4E2D\uFF0C\u4F46\u672A\u5728\u6578\u64DA\u5EAB\u4E2D\u627E\u5230\u5C0D\u61C9\u7684\u5E33\u865F\u8A18\u9304\u3002 \u60A8\u53EF\u4EE5\u5617\u8A66\u6062\u5FA9\u9019\u4E9B\u5E33\u865F\uFF0C\u6216\u9078\u64C7\u5FFD\u7565\u3002 "),a(),s(12,"div",395),$(13,d3,9,2,"div",396,s5),a(),s(15,"div",397)(16,"p",398),l(17," \u{1F4A1} "),s(18,"strong"),l(19,"\u63D0\u793A\uFF1A"),a(),l(20," \u6062\u5FA9\u5F8C\uFF0C\u5E33\u865F\u5C07\u4EE5\u300C\u96E2\u7DDA\u300D\u72C0\u614B\u6DFB\u52A0\u5230\u5217\u8868\u4E2D\u3002 \u60A8\u9700\u8981\u9EDE\u64CA\u300C\u767B\u9304\u300D\u4F86\u91CD\u65B0\u9023\u63A5\u5E33\u865F\u3002 "),a()()(),s(21,"div",399)(22,"button",400),b("click",function(){v(t);let o=f(2);return x(o.dismissOrphanSessionDialog())}),l(23," \u7A0D\u5F8C\u8655\u7406 "),a(),s(24,"button",401),b("click",function(){v(t);let o=f(2);return x(o.recoverOrphanSessions())}),w(25,u3,4,0)(26,m3,4,0),a()()()()}if(i&2){let t=f(2);d(8),A(" \u767C\u73FE ",t.orphanSessions().length," \u500B Session \u6587\u4EF6\u9700\u8981\u624B\u52D5\u6062\u5FA9 "),d(5),H(t.orphanSessions()),d(11),V("disabled",t.isRecoveringOrphanSessions()),d(),E(t.isRecoveringOrphanSessions()?25:26)}}function g3(i,e){if(i&1&&(s(0,"div",413)(1,"p",414)(2,"span",175),l(3,"\u932F\u8AA4\u8A73\u60C5\uFF1A"),a(),l(4),a()()),i&2){let t=f(3);d(4),A(" ",t.backendError()," ")}}function h3(i,e){if(i&1){let t=T();s(0,"div",113)(1,"div",405)(2,"div",406)(3,"div",390),l(4,"\u26A0\uFE0F"),a(),s(5,"h2",407),l(6,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),a()(),s(7,"div",393)(8,"p",361),l(9," \u7A0B\u5E8F\u9700\u8981 Python \u74B0\u5883\u624D\u80FD\u6B63\u5E38\u904B\u884C\u3002\u8ACB\u78BA\u4FDD\uFF1A "),a(),s(10,"div",408)(11,"div",409)(12,"span",265),l(13,"1."),a(),s(14,"div")(15,"p",402),l(16,"\u5B89\u88DD Python 3.9+"),a(),s(17,"a",410),l(18," https://www.python.org/downloads/ "),a()()(),s(19,"div",409)(20,"span",265),l(21,"2."),a(),s(22,"div")(23,"p",402),l(24,'\u5B89\u88DD\u6642\u52FE\u9078 "Add Python to PATH"'),a(),s(25,"p",411),l(26,"\u78BA\u4FDD Python \u6DFB\u52A0\u5230\u7CFB\u7D71\u74B0\u5883\u8B8A\u91CF"),a()()(),s(27,"div",409)(28,"span",265),l(29,"3."),a(),s(30,"div")(31,"p",402),l(32,"\u5B89\u88DD\u4F9D\u8CF4"),a(),s(33,"code",412),l(34," pip install pyrogram tgcrypto aiosqlite "),a()()(),s(35,"div",409)(36,"span",265),l(37,"4."),a(),s(38,"div")(39,"p",402),l(40,"\u91CD\u65B0\u555F\u52D5\u7A0B\u5E8F"),a()()()(),w(41,g3,5,1,"div",413),a(),s(42,"div",399)(43,"button",400),b("click",function(){v(t);let o=f(2);return x(o.showBackendErrorDialog.set(!1))}),l(44," \u6211\u77E5\u9053\u4E86 "),a()()()()}if(i&2){let t=f(2);d(41),E(t.backendError()?41:-1)}}function f3(i,e){if(i&1){let t=T();s(0,"div",415),b("click",function(){v(t);let o=f(2);return x(o.showBackendErrorDialog.set(!0))}),s(1,"span",152),l(2,"\u26A0\uFE0F"),a(),s(3,"span",235),l(4,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),a()()}}function _3(i,e){if(i&1){let t=T();s(0,"div",416),b("click",function(){v(t);let o=f(2);return x(o.cancelNewKeywordSet())}),s(1,"div",417),b("click",function(o){return v(t),x(o.stopPropagation())}),s(2,"div",418)(3,"h2",419)(4,"span"),l(5,"\u{1F511}"),a(),l(6," \u5275\u5EFA\u95DC\u9375\u8A5E\u96C6 "),a()(),s(7,"div",350)(8,"label",420),l(9,"\u95DC\u9375\u8A5E\u96C6\u540D\u7A31"),a(),s(10,"input",421),b("input",function(o){v(t);let r=f(2);return x(r.newKeywordSet.set({name:o.target.value}))})("keyup.enter",function(){v(t);let o=f(2);return x(o.submitNewKeywordSet())}),a(),s(11,"p",311),l(12," \u{1F4A1} \u5275\u5EFA\u5F8C\u53EF\u5728\u8A5E\u96C6\u4E2D\u6DFB\u52A0\u591A\u500B\u95DC\u9375\u8A5E "),a()(),s(13,"div",399)(14,"button",400),b("click",function(){v(t);let o=f(2);return x(o.cancelNewKeywordSet())}),l(15," \u53D6\u6D88 "),a(),s(16,"button",422),b("click",function(){v(t);let o=f(2);return x(o.submitNewKeywordSet())}),l(17," \u5275\u5EFA "),a()()()()}if(i&2){let t=f(2);d(10),V("value",t.newKeywordSet().name)}}function C3(i,e){if(i&1){let t=T();s(0,"div",8)(1,"app-onboarding",40,0),b("navigateEvent",function(o){v(t);let r=f();return x(r.handleOnboardingNavigate(o))}),a(),k(3,"app-progress-dialog",41),w(4,v5,22,1,"div",42),w(5,y5,17,1,"div",42),s(6,"aside",43)(7,"div",44)(8,"button",45),b("click",function(){v(t);let o=f();return x(o.toggleSidebarCollapse())}),te(),s(9,"svg",46),k(10,"polyline",47),a()(),le(),s(11,"div",48)(12,"div",49),k(13,"div",50),te(),s(14,"svg",51),k(15,"path",52)(16,"path",53)(17,"path",54)(18,"path",55)(19,"circle",56),s(20,"defs")(21,"linearGradient",57),k(22,"stop",58)(23,"stop",59),a(),s(24,"linearGradient",60),k(25,"stop",61)(26,"stop",62),a()()()(),w(27,w5,5,2,"div"),a(),le(),s(28,"div",63),b("click",function(){v(t);let o=f();return x(o.changeView("profile"))}),s(29,"div",64)(30,"div",65),k(31,"div",66),s(32,"div",67)(33,"div",68),l(34),a()(),w(35,I5,6,11,"div",69),a(),s(36,"div",70)(37,"div",71),l(38),a(),s(39,"div",72),w(40,k5,5,0,"span",73)(41,P5,5,0,"span",74)(42,F5,5,0,"span",75)(43,R5,5,0,"span",76)(44,N5,5,0,"span",77)(45,B5,5,0,"span",78),a()(),s(46,"div",79),te(),s(47,"svg",80),k(48,"polyline",81),a()()()()(),le(),s(49,"nav",82),Is(50),s(51,"a",83),b("click",function(){v(t);let o=f();return x(o.changeView("membership-center"))}),te(),s(52,"svg",84),k(53,"polygon",85),a(),le(),s(54,"span"),l(55,"\u6703\u54E1\u4E2D\u5FC3"),a()(),s(56,"a",83),b("click",function(){v(t);let o=f();return x(o.changeView("dashboard"))}),te(),s(57,"svg",84),k(58,"rect",86)(59,"rect",87)(60,"rect",88)(61,"rect",89),a(),le(),s(62,"span"),l(63),a()(),s(64,"div",90)(65,"button",91),b("click",function(){v(t);let o=f();return x(o.toggleSidebarGroup("manual"))}),s(66,"span",92),l(67," \u{1F527} \u624B\u52D5\u64CD\u4F5C "),a(),te(),s(68,"svg",93),k(69,"polyline",94),a()(),w(70,V5,30,25,"div",95),a(),le(),s(71,"div",90)(72,"button",91),b("click",function(){v(t);let o=f();return x(o.toggleSidebarGroup("monitoring"))}),s(73,"span",96)(74,"span",97),l(75,"\u{1F4E1}"),a(),l(76," \u76E3\u63A7\u4E2D\u5FC3 "),a(),te(),s(77,"svg",93),k(78,"polyline",94),a()(),w(79,L5,42,52,"div",95),a(),le(),s(80,"div",90)(81,"button",91),b("click",function(){v(t);let o=f();return x(o.toggleSidebarGroup("marketing"))}),s(82,"span",96)(83,"span",98),l(84,"AI"),a(),l(85," \u667A\u80FD\u71DF\u92B7 "),a(),te(),s(86,"svg",93),k(87,"polyline",94),a()(),w(88,K5,34,60,"div",95),a(),le(),s(89,"div",90)(90,"button",91),b("click",function(){v(t);let o=f();return x(o.toggleSidebarGroup("analytics"))}),s(91,"span",92),l(92," \u{1F4CA} \u6578\u64DA\u5206\u6790 "),a(),te(),s(93,"svg",93),k(94,"polyline",94),a()(),w(95,W5,25,24,"div",95),a(),le(),s(96,"div",90)(97,"button",91),b("click",function(){v(t);let o=f();return x(o.toggleSidebarGroup("ai"))}),s(98,"span",92),l(99),a(),te(),s(100,"svg",93),k(101,"polyline",94),a()(),w(102,Y5,15,16,"div",95),a(),le(),s(103,"div",90)(104,"button",91),b("click",function(){v(t);let o=f();return x(o.toggleSidebarGroup("system"))}),s(105,"span",92),l(106),a(),te(),s(107,"svg",93),k(108,"polyline",94),a()(),w(109,X5,7,7,"div",95),a()(),le(),s(110,"div",99)(111,"button",100),b("click",function(){v(t);let o=f();return x(o.openOnboarding())}),s(112,"span",101),l(113,"\u2753"),a(),s(114,"span"),l(115,"\u4F7F\u7528\u5E2E\u52A9"),a()(),s(116,"div")(117,"label",102),l(118),a(),k(119,"app-language-switcher-compact"),a(),s(120,"div")(121,"label",102),l(122),a(),s(123,"div",103)(124,"button",104),b("click",function(){v(t);let o=f();return x(o.theme.set("light"))}),te(),s(125,"svg",105),k(126,"path",106),a()(),le(),s(127,"button",104),b("click",function(){v(t);let o=f();return x(o.theme.set("dark"))}),te(),s(128,"svg",105),k(129,"path",107),a()()()()()(),le(),s(130,"main",108),w(131,Z5,1,0,"app-dashboard-view")(132,j5,1,0,"app-accounts-view")(133,ew,1,0,"app-add-account-page")(134,tw,1,0,"app-api-credentials-view")(135,nw,1,0,"app-settings-view")(136,iw,1,0,"app-leads-view")(137,ow,1,0,"app-automation-view")(138,rw,1,0,"app-resource-discovery-view")(139,sw,1,0,"app-resource-discovery-view")(140,aw,1,0,"app-ai-center-view")(141,lw,2,0,"div",109)(142,cw,2,0,"div",110)(143,dw,2,0,"div",110)(144,uw,1,0,"app-multi-role-view")(145,mw,1,0,"app-analytics-view")(146,pw,1,0,"app-monitoring-view")(147,gw,1,0,"app-monitoring-view")(148,hw,1,0,"app-monitoring-view")(149,fw,1,0,"app-monitoring-view")(150,_w,1,0,"app-monitoring-view")(151,Cw,1,0,"app-monitoring-view")(152,vw,1,0,"app-monitoring-view")(153,xw,1,0,"app-runtime-logs-view")(154,bw,1,0,"app-membership-center")(155,Sw,1,0,"app-profile")(156,yw,1,0,"app-resource-center")(157,ww,1,0,"app-search-discovery")(158,Ew,1,0,"app-ai-marketing-assistant")(159,Aw,1,0,"app-ai-team-hub")(160,Dw,1,0,"app-member-database")(161,Mw,1,0,"app-leads-view")(162,Tw,1,0,"app-analytics-view")(163,Iw,1,0,"app-analytics-view")(164,kw,1,0,"app-automation-view")(165,Pw,1,0,"app-automation-view")(166,Fw,1,0,"app-analytics-view")(167,Rw,1,0,"app-marketing-report")(168,Nw,1,0,"app-runtime-logs-view")(169,Bw,1,0,"app-runtime-logs-view")(170,Vw,1,0,"app-runtime-logs-view")(171,Lw,1,0,"app-dashboard-view"),a(),w(172,GE,30,24,"div",111),w(173,WE,19,1,"div",112),w(174,a3,22,9,"div",113),w(175,p3,27,3,"div",113),w(176,h3,45,1,"div",113),w(177,f3,5,0,"div",114),w(178,_3,18,1,"div",115),a()}if(i&2){let t,n,o,r,c,m=f();d(3),V("show",m.progressDialog().show)("title",m.progressDialog().title)("progress",m.progressDialog().progress)("cancellable",m.progressDialog().cancellable),d(),E(m.deleteConfirmDialog().show?4:-1),d(),E(m.showInviteGroupDialog()?5:-1),d(),I("w-64",!m.sidebarCollapsed())("w-16",m.sidebarCollapsed()),d(2),V("title",m.sidebarCollapsed()?"\u5C55\u958B\u5074\u908A\u6B04":"\u6536\u7E2E\u5074\u908A\u6B04"),d(),I("rotate-180",m.sidebarCollapsed()),d(2),I("justify-center",m.sidebarCollapsed()),d(16),E(m.sidebarCollapsed()?-1:27),d(),I("level-bronze",m.userMembershipLevel()==="bronze")("level-silver",m.userMembershipLevel()==="silver")("level-gold",m.userMembershipLevel()==="gold")("level-diamond",m.userMembershipLevel()==="diamond")("level-star",m.userMembershipLevel()==="star")("level-king",m.userMembershipLevel()==="king"),d(3),I("glow-bronze",m.userMembershipLevel()==="bronze")("glow-silver",m.userMembershipLevel()==="silver")("glow-gold",m.userMembershipLevel()==="gold")("glow-diamond",m.userMembershipLevel()==="diamond")("glow-star",m.userMembershipLevel()==="star")("glow-king",m.userMembershipLevel()==="king"),d(),I("border-bronze",m.userMembershipLevel()==="bronze")("border-silver",m.userMembershipLevel()==="silver")("border-gold",m.userMembershipLevel()==="gold")("border-diamond",m.userMembershipLevel()==="diamond")("border-star",m.userMembershipLevel()==="star")("border-king",m.userMembershipLevel()==="king"),d(),I("avatar-bronze",m.userMembershipLevel()==="bronze")("avatar-silver",m.userMembershipLevel()==="silver")("avatar-gold",m.userMembershipLevel()==="gold")("avatar-diamond",m.userMembershipLevel()==="diamond")("avatar-star",m.userMembershipLevel()==="star")("avatar-king",m.userMembershipLevel()==="king"),d(),A(" ",((t=m.currentUser())==null||t.username==null?null:t.username.charAt(0).toUpperCase())||"?"," "),d(),E(m.userMembershipLevel()!=="bronze"?35:-1),d(3),A(" ",((n=m.currentUser())==null?null:n.username)||"\u7528\u6236"," "),d(2),E((o=m.userMembershipLevel())==="silver"?40:o==="gold"?41:o==="diamond"?42:o==="star"?43:o==="king"?44:45),d(10);let h=ks(m.currentView());d(),j("background-color",h==="membership-center"?"var(--sidebar-item-active)":"transparent")("color",h==="membership-center"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",h==="membership-center"),d(5),j("background-color",h==="dashboard"?"var(--sidebar-item-active)":"transparent")("color",h==="dashboard"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",h==="dashboard"),d(7),M(m.t("dashboard")),d(5),I("rotate-180",!m.isSidebarGroupExpanded("manual")),d(2),E(m.isSidebarGroupExpanded("manual")?70:-1),d(7),I("rotate-180",!m.isSidebarGroupExpanded("monitoring")),d(2),E(m.isSidebarGroupExpanded("monitoring")?79:-1),d(7),I("rotate-180",!m.isSidebarGroupExpanded("marketing")),d(2),E(m.isSidebarGroupExpanded("marketing")?88:-1),d(5),I("rotate-180",!m.isSidebarGroupExpanded("analytics")),d(2),E(m.isSidebarGroupExpanded("analytics")?95:-1),d(4),A(" \u{1F9E0} ",m.t("aiIntelligence")," "),d(),I("rotate-180",!m.isSidebarGroupExpanded("ai")),d(2),E(m.isSidebarGroupExpanded("ai")?102:-1),d(4),A(" \u2699\uFE0F ",m.t("systemMonitor")," "),d(),I("rotate-180",!m.isSidebarGroupExpanded("system")),d(2),E(m.isSidebarGroupExpanded("system")?109:-1),d(9),M(m.t("language")),d(4),M(m.t("appearance")),d(2),j("background-color",m.theme()==="light"?"var(--bg-card)":"transparent")("color",m.theme()==="light"?"var(--primary)":"var(--text-muted)")("box-shadow",m.theme()==="light"?"var(--shadow-sm)":"none"),d(3),j("background-color",m.theme()==="dark"?"var(--primary-bg)":"transparent")("color",m.theme()==="dark"?"var(--primary)":"var(--text-muted)")("box-shadow",m.theme()==="dark"?"var(--shadow-sm)":"none"),d(4),E((r=m.currentView())==="dashboard"?131:r==="accounts"?132:r==="add-account"?133:r==="api-credentials"?134:r==="settings"?135:r==="leads"?136:r==="automation"?137:r==="resource-discovery"?138:r==="resources"?139:r==="ai-center"?140:r==="knowledge-brain"?141:r==="knowledge-gaps"?142:r==="knowledge-manage"?143:r==="multi-role"?144:r==="analytics"?145:r==="monitoring"?146:r==="monitoring-accounts"?147:r==="monitoring-groups"?148:r==="keyword-sets"?149:r==="chat-templates"?150:r==="trigger-rules"?151:r==="collected-users"?152:r==="runtime-logs"?153:r==="membership-center"?154:r==="profile"?155:r==="resource-center"?156:r==="search-discovery"?157:r==="ai-assistant"?158:r==="ai-team"?159:r==="member-database"?160:r==="lead-nurturing"?161:r==="nurturing-analytics"?162:r==="user-tracking"?163:r==="ads"?164:r==="campaigns"?165:r==="analytics-center"?166:r==="marketing-report"?167:r==="performance"?168:r==="alerts"?169:r==="logs"?170:171),d(41),E((c=m.generationState().lead)?172:-1,c),d(),E(m.showBatchOperationHistory()?173:-1),d(),E(m.showWelcomeDialog()?174:-1),d(),E(m.showOrphanSessionDialog()?175:-1),d(),E(m.showBackendErrorDialog()?176:-1),d(),E(m.backendRunning()?-1:177),d(),E(m.showKeywordSetCreator()?178:-1)}}function v3(i,e){i&1&&(s(0,"div",9),k(1,"router-outlet"),a())}var Ro=class i{constructor(){this.router=B(Un);this.geminiService=B(Xi);this.translationService=B(Zi);this.accountLoaderService=B(kn);this.ipcService=B(De);this.offlineCache=B(lo);this.swManager=B(co);this.toastService=B(me);this.membershipService=B(Ue);this.securityService=B(so);this.loadingService=B(ao);this.contactsService=B(zn);this.backupService=B(pa);this.i18n=B(Tt);this.authService=B(Qs);this.navBridge=B(Qt);this.navShortcuts=B(Xs);this.unifiedNav=B(Ys);this.navigationService=B(ea);this.monitoringMgmt=B(ta);this.leadMgmt=B(na);this.campaignMgmt=B(Zs);this.templateMgmt=B(js);this.groupMgmt=B(ia);this.messageMgmt=B(oa);this.facade=B(ra);this.animationConfig=B(sa);this.settingsService=B(aa);this.aiChatService=B(la);this.resourceService=B(ca);this.exportService=B(da);this.ragService=B(ua);this.ragBrainService=B(Ct);this.vectorMemoryService=B(ma);this.schedulerService=B(ga);this.dialogService=B(ht);this.document=B(Nn);this.cdr=B(zt);this.ngZone=B(At);this.membershipUpdateHandler=null;this.Math=Math;this.isAuthenticated=L(()=>this.authService.isAuthenticated());this.currentUser=L(()=>this.authService.user());this.userMembershipLevel=L(()=>this.authService.membershipLevel());this.t=(e,t)=>this.i18n.t(e,t);this.theme=C("dark");this.currentView=C("dashboard");this.dashboardMode=C("smart");this.useRouterMode=C(!0);this.navMode=C("classic");this.leadDetailView=C("sendMessage");this.leadsViewMode=C("kanban");this.leadStatusFilter=C("all");this.leadSourceFilter=C("all");this.leadSortBy=C("time");this.showLeadsViewMenu=C(!1);this.showLeadsActionMenu=C(!1);this.aiCenterTab=C("config");this.automationTab=C("targets");this.knowledgeMenuExpanded=C(!0);this.sidebarGroups=C({manual:!0,monitoring:!0,marketing:!0,analytics:!1,advanced:!1,ai:!0,system:!1});this.sidebarCollapsed=C(!1);this.aiTeamIncomingStrategy=C(null);this.showBatchMessageDialogState=C(!1);this.batchSelectedLeads=C([]);this.batchSendTargets=C([]);this.showBatchInviteDialogState=C(!1);this.batchInviteTargets=C([]);this.migrationStatus=C({currentVersion:0,latestVersion:0,appliedCount:0,pendingCount:0,appliedMigrations:[],pendingMigrations:[]});this.isLoadingMigration=C(!1);this.isRunningMigration=C(!1);this.schedulerStatus=C({isRunning:!1,tasks:[]});this.schedulerTab=C("tasks");this.logFiles=C([]);this.logStats=C({totalFiles:0,totalSize:0,totalSizeFormatted:"0 B",compressedFiles:0,oldestFile:null,newestFile:null});this.isLoadingLogs=C(!1);this.isRotatingLogs=C(!1);this.selectedLogFile=C(null);this.logFileContent=C("");this.showResourceBatchMenu=C(!1);this.resourceBatchAction=C(null);this.showMembershipDialog=C(!1);this.settingsTab=C("backup");this.vectorMemoryStats=C({totalMemories:0,byType:{},totalUsers:0,avgImportance:0});this.vectorMemorySearchQuery="";this.vectorMemorySearchResults=C([]);this.isSearchingMemory=C(!1);this.isAddingMemory=C(!1);this.showAddMemoryDialog=C(!1);this.newMemory={userId:"",content:"",type:"conversation",importance:.5};this.selectedMemoryUserId=C("");this.memoryUserList=C([]);this.showVoiceRecordingDialog=C(!1);this.voiceCloneTab=C("manage");this.messageMode=C("manual");this.editableMessage=C("");this.selectedSenderId=C(null);this.aiApiKey=C("");this.aiApiType=C("gemini");this.customApiEndpoint=C("");this.showApiKey=C(!1);this.isTestingAi=C(!1);this.aiConnectionStatus=C(null);this.aiConnectionError=C("");this.localAiEndpoint=C("http://localhost:11434");this.localAiModel=C("qwen2:7b");this.localAiProvider=C("ollama");this.isTestingLocalAi=C(!1);this.localAiStatus=C(null);this.localAiError=C("");this.availableOllamaModels=C([]);this.aiAutoFallback=C(!0);this.aiBackupProvider=C("gemini");this.aiShowProviderLabel=C(!0);this.isFirstRun=C(!1);this.showWelcomeDialog=C(!1);this.welcomeStep=C(1);this.isDetectingOllama=C(!1);this.ollamaDetected=C(!1);this.detectedOllamaModels=C([]);this.autoSelectedModel=C("");this.backendRunning=C(!0);this.backendError=C("");this.showBackendErrorDialog=C(!1);this.showOrphanSessionDialog=C(!1);this.orphanSessions=C([]);this.isRecoveringOrphanSessions=C(!1);this.showMembershipStats=C(!1);this.ttsEndpoint=C("");this.ttsEnabled=C(!1);this.ttsVoice=C("");this.isTestingTts=C(!1);this.ttsStatus=C(null);this.ttsError=C("");this.sttEndpoint=C("");this.sttEnabled=C(!1);this.isTestingStt=C(!1);this.sttStatus=C(null);this.sttError=C("");this.aiAutoChatEnabled=C(!1);this.aiAutoChatMode=C("semi");this.aiTypingSpeed=C(50);this.aiReplyDelay=C([2,8]);this.aiSystemPrompt=C("");this.aiMaxContextMessages=C(20);this.aiEnableMemory=C(!0);this.aiAutoGreeting=C(!1);this.aiGreetingMessage=C("");this.ragEnabled=C(!0);this.aiGreetingSuggestion=C(null);this.showAiGreetingDialog=C(!1);this.knowledgeStats=C({documents:0,images:0,videos:0,qa_pairs:0});this.knowledgeDocuments=C([]);this.knowledgeImages=C([]);this.knowledgeVideos=C([]);this.knowledgeQaPairs=C([]);this.knowledgeTab=C("documents");this.isLoadingKnowledge=C(!1);this.showAddDocumentDialog=C(!1);this.showAddMediaDialog=C(!1);this.showAddQaDialog=C(!1);this.newDocument=C({title:"",category:"general",tags:"",content:""});this.newMedia=C({name:"",category:"general",description:"",mediaType:"image"});this.newQaPair=C({question:"",answer:"",category:"general",keywords:""});this.ragSystemInitialized=C(!1);this.isInitializingRag=C(!1);this.isRagLearning=C(!1);this.isReindexing=C(!1);this.isCleaningRag=C(!1);this.isSearchingRag=C(!1);this.ragSearchQuery="";this.ragSearchResults=C([]);this.ragStats=C({total_knowledge:0,qa_count:0,scripts_count:0,total_uses:0,avg_score:0,chromadb_enabled:!1,neural_embedding:!1,by_type:{}});this.showAddRagKnowledgeDialog=C(!1);this.newRagKnowledge={type:"qa",question:"",answer:"",context:""};this.ragTypeKeys=L(()=>Object.keys(this.ragStats().by_type));this.resourceDiscoveryInitialized=C(!1);this.isSearchingResources=C(!1);this.isProcessingJoinQueue=C(!1);this.resourceSearchQuery="";this.pendingSearchQuery="";this.resourceSearchType=C("all");this.searchError=C({hasError:!1,message:"",details:"",suggestions:[]});this.currentSearchSessionId=C("");this.currentSearchKeyword=C("");this.showSearchHistory=C(!1);this.searchHistoryKeywords=C([]);this.savedResources=C(new Set);this.showSearchSuggestions=C(!1);this.hotSearchKeywords=C(["\u652F\u4ED8","USDT","\u4EA4\u6613","\u62DB\u8058","\u4EE3\u8CFC","\u52A0\u5BC6\u8CA8\u5E63","\u96FB\u5F71","\u97F3\u6A02","\u8CC7\u6E90\u5206\u4EAB","\u4EA4\u6D41\u7FA4"]);this.resourceAccountId=C(null);this.showResourceAccountSelector=C(!1);this.resourceMinMembers=C(0);this.showSearchOptions=C(!1);this.searchReplaceMode=C(!0);this.isRefreshing=C(!1);this.linkAnalysisInput="";this.isAnalyzingLink=C(!1);this.discoveredResources=C([]);this.resourceStats=C({total_resources:0,by_status:{},by_type:{},today_discovered:0,pending_joins:0,joined_count:0,avg_score:0});this.discoveryKeywords=C([]);this.showAddResourceDialog=C(!1);this.showAddKeywordDialog=C(!1);this.showChannelManageDialog=C(!1);this.showAddChannelDialog=C(!1);this.newResourceKeyword="";this.systemChannels=C([]);this.customChannels=C([]);this.newChannelUsername="";this.newChannelDisplayName="";this.newChannelQueryFormat="{keyword}";this.newChannelPriority="backup";this.showJoinMonitorDialog=C(!1);this.joinMonitorResource=C(null);this.joinMonitorSelectedPhone=C("");this.joinMonitorSelectedPhones=C([]);this.joinMonitorKeywords=C([]);this.joinMonitorSelectedKeywordSetIds=C([]);this.joinMonitorNewKeyword="";this.joinMonitorAutoEnable=C(!0);this.joinMonitorBatchMode=C(!0);this.joinMonitorBatchInterval=C(45);this.isJoiningResource=C(!1);this.showQuickCreateKeywordSet=C(!1);this.quickCreateKeywordSetName="";this.showChangeMonitorAccount=C(!1);this.openResourceMenuId=C(null);this.quickCreateKeywordSetKeywords=C([]);this.quickCreateKeywordSetNewKeyword="";this.showBatchJoinMonitorDialog=C(!1);this.batchJoinResources=C([]);this.batchJoinProgress=C({current:0,total:0,status:""});this.showMemberListDialog=C(!1);this.memberListResource=C(null);this.memberListData=C([]);this.memberListLoading=C(!1);this.memberListProgress=C({extracted:0,total:0,status:""});this.selectedMemberIds=C([]);this.memberExtractStarted=C(!1);this.memberListFilter=C("all");this.memberExtractConfig=C({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}});this.extractPresets=[{id:"precise",name:"\u{1F3AF} \u7CBE\u6E96\u6D3B\u8E8D",desc:"\u73FE\u5728\u5728\u7DDA+\u6709\u7528\u6236\u540D",config:{activityFilters:{onlineNow:!0,within3Days:!0},accountFeatures:{hasUsername:!0}}},{id:"chinese",name:"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA\u512A\u5148",desc:"\u83EF\u4EBA+7\u5929\u5167\u6D3B\u8E8D",config:{userTypes:{chinese:!0},activityFilters:{within7Days:!0}}},{id:"premium",name:"\u{1F48E} \u9AD8\u50F9\u503C",desc:"Premium+\u6D3B\u8E8D\u7528\u6236",config:{accountFeatures:{premium:!0},activityFilters:{within7Days:!0}}},{id:"all",name:"\u{1F4E6} \u5168\u90E8\u63D0\u53D6",desc:"\u4E0D\u7BE9\u9078\uFF0C\u63D0\u53D6\u6240\u6709",config:{}}];this.selectedPreset=C("");this.showExtractionSummaryDialog=C(!1);this.extractionSummary=C({groupName:"",groupUrl:"",totalExtracted:0,totalInGroup:0,onlineCount:0,recentlyCount:0,premiumCount:0,chineseCount:0,hasUsernameCount:0,botCount:0,valueLevelDistribution:{S:0,A:0,B:0,C:0,D:0},extractedAt:"",duration:0});this.extractionStartTime=C(0);this.showMemberExtractionDialog=C(!1);this.memberExtractionGroup=C(null);this.showSingleMessageDialog=C(!1);this.singleMessageResource=C(null);this.singleMessageContent="";this.singleMessageScheduled=C(!1);this.singleMessageScheduleTime="";this.singleMessageAccountId=C("");this.accountQuotas=C([]);this.newChannelNotes="";this.isTestingChannel=C(!1);this.selectedResourceIds=C([]);this.resourceFilterStatus=C("");this.resourceFilterType=C("");this.resourceFilterLink=C("");this.selectedSearchSources=C(["telegram","jiso"]);this.showBatchJoinMenu=C(!1);this.searchResultsCache=new Map;this.CACHE_EXPIRY_MS=300*1e3;this.showBatchMessageDialog=C(!1);this.showBatchInviteDialog=C(!1);this.batchMessageContent="";this.batchMessageTargets=[];this.batchMessageConfig={delayMin:60,delayMax:120,dailyLimit:50,smartAntiBlock:!0,accountMode:"rotate",scheduled:!1,scheduleTime:""};this.batchInviteConfig={selectedMemberIds:[],selectAll:!1,delayMin:120,delayMax:300,perGroupLimit:10,smartAntiBlock:!0};this.availableMembersForInvite=C([]);this.discussionWatcherInitialized=C(!1);this.channelDiscussions=C([]);this.discussionMessages=C([]);this.discussionStats=C({total_discussions:0,monitoring_count:0,total_messages:0,matched_messages:0,leads_from_discussions:0,today_messages:0,today_leads:0});this.selectedDiscussionId=C("");this.discoverChannelId="";this.resourcesTab=C("resources");this.resourceCenterTab=C("manage");this.isLoadingDiscussionMessages=C(!1);this.discussionReplyText=C("");this.clonedVoices=C([]);this.selectedClonedVoice=C("");this.isUploadingVoice=C(!1);this.voiceUploadProgress=C(0);this.voiceCloneError=C("");this.isRecording=C(!1);this.recordingTime=C(0);this.recordingTimer=null;this.mediaRecorder=null;this.audioChunks=[];this.voicePromptText=C("");this.voiceName=C("");this.showRecordingDialog=C(!1);this.recordedAudioBlob=C(null);this.recordedAudioUrl=C("");this.accounts=C([]);this.keywordSets=C([]);this.monitoredGroups=C([]);this.leads=C([]);this.leadsTotal=C(0);this.leadsHasMore=C(!1);this.leadsLoading=C(!1);this.logs=C([]);this.selectedLeadForInvite=C(null);this.showInviteGroupDialog=C(!1);this.realtimeMatches=C([]);this.todayStats=C({matchCount:0,newLeads:0,messagesSent:0,conversions:0});this.chatList=C([]);this.chatHistory=C([]);this.selectedChatUserId=C(null);this.isLoadingChatHistory=C(!1);this.chatListSearch=C("");this.chatListFunnelFilter=C("");this.chatHistoryPage=C(0);this.chatHistoryPageSize=C(50);this.chatHistoryHasMore=C(!1);this.chatHistoryLoadingMore=C(!1);this.chatHistoryAllMessages=C([]);this.lastQueueStatusRefresh=0;this.queueStatuses=C({});this.queueMessages=C([]);this.selectedQueuePhone=C(null);this.queueStats=C({pending:0,sending:0,sent:0,failed:0,retrying:0,totalToday:0,successRate:0,avgSendTime:0});this.sendingStatsData=C(null);this.queueLengthHistoryData=C(null);this.accountComparisonData=C(null);this.campaignPerformanceData=C(null);this.alerts=C([]);this.unacknowledgedAlertsCount=L(()=>this.alerts().filter(e=>!e.acknowledged&&!e.resolved).length);this.selectedLeadIds=C(new Set);this.isSelectAllLeads=C(!1);this.showBatchOperationMenu=C(!1);this.showFloatingMoreMenu=C(!1);this.batchOperationInProgress=C(!1);this.batchOperationHistory=C([]);this.showBatchOperationHistory=C(!1);this.allTags=C([]);this.newTagName=C("");this.newTagColor=C("#3B82F6");this.showAddTagDialog=C(!1);this.batchTagInput=C("");this.showBatchTagSelector=C(!1);this.showBatchRemoveTagSelector=C(!1);this.leadSearchQuery=C("");this.leadSearchResults=C([]);this.isSearchingLeads=C(!1);this.leadSearchTimeout=null;this.backups=C([]);this.isCreatingBackup=C(!1);this.isRestoringBackup=C(!1);this.selectedLeadsCount=L(()=>this.selectedLeadIds().size);this.hasSelectedLeads=L(()=>this.selectedLeadIds().size>0);this.adTemplates=C([]);this.adSchedules=C([]);this.adSendLogs=C([]);this.adOverviewStats=C(null);this.showAdTemplateForm=C(!1);this.showAdScheduleForm=C(!1);this.editingAdTemplate=C(null);this.editingAdSchedule=C(null);this.newAdTemplate=C({name:"",content:"",mediaType:"text"});this.newAdSchedule=C({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]});this.spintaxPreview=C([]);this.isPreviewingSpintax=C(!1);this.adSystemTab=C("templates");this.trackedUsers=C([]);this.userGroups=C([]);this.highValueGroups=C([]);this.trackingStats=C(null);this.showAddUserForm=C(!1);this.newTrackedUser=C({userId:"",username:"",notes:""});this.selectedTrackedUser=C(null);this.isTrackingUser=C(!1);this.userTrackingTab=C("users");this.userValueFilter=C("");this.selectedCampaign=C(null);this.unifiedOverview=C(null);this.funnelAnalysis=C(null);this.showCampaignForm=C(!1);this.campaignKeywordInput=C("");this.campaignFormData=C({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]});this.roleTemplates=C({});this.allRoles=C([]);this.scriptTemplates=C([]);this.collabGroups=C([]);this.collabStats=C(null);this.roleStats=C(null);this.showRoleAssignForm=C(!1);this.multiRoleTab=C("roles");this.newRoleAssign=C({accountPhone:"",roleType:"seller",roleName:""});this.validationErrors=C({});this.progressDialog=C({show:!1,title:"\u5904\u7406\u4E2D...",progress:{current:0,total:0},cancellable:!1});this.logFilterType=C("");this.logFilterStartDate=C("");this.logFilterEndDate=C("");this.logFilterSearch=C("");this.filteredLogs=L(()=>{let e=this.logs(),t=this.logFilterType(),n=this.logFilterStartDate(),o=this.logFilterEndDate(),r=this.logFilterSearch();return e.filter(c=>{if(t&&c.type!==t)return!1;if(n){let m=new Date(n);if(c.timestamp<m)return!1}if(o){let m=new Date(o);if(m.setHours(23,59,59,999),c.timestamp>m)return!1}if(r){let m=r.toLowerCase();if(!c.message.toLowerCase().includes(m))return!1}return!0})});this.generationState=C({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]});this.messageTemplates=C([]);this.doNotContactList=C(new Set);this.campaigns=C([]);this.spintaxEnabled=C(!0);this.autoReplyEnabled=C(!1);this.autoReplyMessage=C("Thanks for getting back to me! I'll read your message and respond shortly.");this.smartSendingEnabled=C(!0);this.saveSettingsTimer=null;this.searchTimeout=null;this.showPostJoinDialog=C(!1);this.postJoinResource=C(null);this.postJoinPhone=C("");this.showSuccessOverlay=C(!1);this.successOverlayConfig=C(null);this.newAccount=C({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""});this.newKeyword=C({setId:null,keyword:"",isRegex:!1});this.testKeywordText=C("");this.keywordTestResult=C(null);this.newKeywordSet=C({name:""});this.newGroup=C({url:"",keywordSetIds:[]});this.newTemplate=C({name:"",prompt:""});this.showTemplateCreator=C(!1);this.showKeywordSetCreator=C(!1);this.newCampaign=C(this.getEmptyCampaignForm());this.loginState=C({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1});this.loginCode=C("");this.login2FAPassword=C("");this.accountRoles=["Listener","Sender","Unassigned"];this.selectedAccountGroup=C("All");this.accountGroups=L(()=>["All",...new Set(this.accounts().map(e=>e.group).filter(Boolean))]);this.filteredAccounts=L(()=>{let e=this.accounts(),t=this.selectedAccountGroup();return t==="All"?e:e.filter(n=>n.group===t)});this.selectedAccounts=L(()=>this.accounts().filter(e=>e.selected));this.isAllAccountsSelected=L(()=>{let e=this.filteredAccounts();return e.length>0&&e.every(t=>t.selected)});this.listenerAccounts=L(()=>this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online"));this.senderAccounts=L(()=>this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up")));this.leadStatuses=["New","Contacted","Replied","Follow-up","Closed-Won","Closed-Lost"];this.openLeadMenuId=C(null);this.displayLeads=L(()=>this.leadSearchQuery().trim()&&this.leadSearchResults().length>0?this.leadSearchResults():this.leads());this.leadsByStatusMap=L(()=>{let e=this.displayLeads(),t=new Map;return this.leadStatuses.forEach(n=>t.set(n,[])),e.forEach(n=>{t.has(n.status)&&t.get(n.status).push(n)}),t});this.filteredLeads=L(()=>{let e=this.leadStatusFilter(),t=this.leadSourceFilter(),n=this.leadSortBy(),o=this.displayLeads();return e!=="all"&&(o=o.filter(r=>r.status===e)),t!=="all"&&(o=o.filter(r=>r.sourceType===t)),o.sort((r,c)=>n==="intent"?(c.intentScore||0)-(r.intentScore||0):n==="time"?new Date(c.timestamp).getTime()-new Date(r.timestamp).getTime():(r.username||"").localeCompare(c.username||""))});this.leadsBySource=L(()=>{let e=this.leads();return{group_extract:e.filter(t=>t.sourceType==="group_extract").length,keyword_trigger:e.filter(t=>t.sourceType==="keyword_trigger").length,import:e.filter(t=>t.sourceType==="import").length,unknown:e.filter(t=>!t.sourceType||t.sourceType==="unknown").length}});this.funnelStats=C({stages:{},tags:[],interest_distribution:{},today_new:0,week_converted:0});this.funnelOverview=C({stages:[],totalLeads:0,convertedLeads:0,averageConversionDays:0,conversionRate:0});this.showFunnelVisualization=C(!1);this.isLoadingFunnel=C(!1);this.selectedJourneyUserId=C("");this.userJourneyData=C(null);this.isLoadingJourney=C(!1);this.leadsTab=C("kanban");this.marketingCampaigns=C([]);this.marketingStats=C({totalCampaigns:0,running:0,completed:0,totalMessages:0,totalInvites:0,successRate:0});this.showCreateCampaignDialog=C(!1);this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""};this.isLoadingMarketing=C(!1);this.warmupDetails=C({});this.showWarmupConfig=C(!1);this.selectedWarmupAccountId=C(null);this.usersWithProfiles=C({users:[],total:0,limit:50,offset:0});this.userFilterStage=C("");this.userFilterTags=C("");this.userFilterSearch=C("");this.selectedUserIds=C([]);this.funnelStages=[{key:"new",name:"\u65B0\u5BA2\u6236",color:"bg-blue-500"},{key:"contacted",name:"\u5DF2\u806F\u7E6B",color:"bg-cyan-500"},{key:"replied",name:"\u5DF2\u56DE\u5FA9",color:"bg-green-500"},{key:"interested",name:"\u6709\u8208\u8DA3",color:"bg-yellow-500"},{key:"negotiating",name:"\u6D3D\u8AC7\u4E2D",color:"bg-orange-500"},{key:"follow_up",name:"\u9700\u8DDF\u9032",color:"bg-purple-500"},{key:"converted",name:"\u5DF2\u6210\u4EA4",color:"bg-emerald-500"},{key:"churned",name:"\u5DF2\u6D41\u5931",color:"bg-red-500"}];this.dashboardStats=L(()=>{let e=this.accounts(),t=this.leads(),n=e.filter(m=>m.status==="Online").length,o=new Date;o.setHours(0,0,0,0);let r=t.filter(m=>new Date(m.timestamp)>=o).length,c=e.reduce((m,h)=>m+h.dailySendCount,0);return{totalAccounts:e.length,onlineAccounts:n,totalLeads:t.length,leadsToday:r,messagesSentToday:c}});this.selectedAnalyticsCampaignId=C("all");this.filteredAnalyticsLeads=L(()=>{let e=this.leads(),t=this.selectedAnalyticsCampaignId();return t==="all"?e:e.filter(n=>n.campaignId===t)});this.analyticsData=L(()=>{let e=this.filteredAnalyticsLeads(),t=new Date;t.setHours(0,0,0,0);let n=[];for(let c=6;c>=0;c--){let m=new Date(t);m.setDate(t.getDate()-c);let h=e.filter(g=>{let _=new Date(g.timestamp);return _.setHours(0,0,0,0),_.getTime()===m.getTime()}).length;n.push({date:m,count:h})}let o=Math.max(...n.map(c=>c.count),1),r={new:e.length,contacted:e.filter(c=>c.status!=="New").length,replied:e.filter(c=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(c.status)).length};return{leadsByDay:n,maxLeadsInPeriod:o,funnel:r}});this.campaignPerformance=L(()=>{let e=this.leads();return this.campaigns().map(t=>{let n=e.filter(m=>m.campaignId===t.id),o=n.filter(m=>m.status!=="New").length,r=n.filter(m=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(m.status)).length,c=o>0?r/o*100:0;return{id:t.id,name:t.name,isActive:t.isActive,leads:n.length,contacted:o,replied:r,replyRate:c}})});this.isMonitoring=C(!1);this.coreDataLoaded=C(!1);this.senderRoundRobinIndex=C(0);this.oneClickStarting=C(!1);this.oneClickProgress=C(0);this.oneClickMessage=C("");this.oneClickStartReport=C(null);this.showStartReport=C(!1);this.systemStatus=C({accounts:{total:0,online:0,offline:0},monitoring:{active:!1,groups:0},ai:{enabled:!1,mode:"semi",endpoint:""},keywords:{sets:0,total:0},campaigns:{total:0,active:0},templates:{total:0,active:0},poller:{running:!1}});this.lastInitialStateTime=0;this.isPageVisible=!0;this.backendConnectionState=C("connecting");this.backendConnectionMessage=C("\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...");this.backendConnectionProgress=C(0);this.connectionStartTime=0;this.connectionTimeoutId=null;this.isStartingMonitoring=C(!1);this.lastConfigCheck=C(null);this.errorNavigationMap={NO_LISTENER:{view:"accounts",elementId:"accounts-section"},LISTENER_OFFLINE:{view:"accounts",elementId:"accounts-section"},NO_SENDER:{view:"accounts",elementId:"accounts-section"},SENDER_OFFLINE:{view:"accounts",elementId:"accounts-section"},SENDER_LIMIT_REACHED:{view:"accounts",elementId:"accounts-section"},NO_GROUPS:{view:"automation",elementId:"monitored-groups-section"},NO_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},EMPTY_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},GROUP_NO_KEYWORD:{view:"automation",elementId:"monitored-groups-section"},NO_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_ACTIVE_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},CAMPAIGN_INCOMPLETE:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_TEMPLATE:{view:"automation",elementId:"templates-section"},AI_NOT_ENABLED:{view:"ai-center",elementId:"ai-settings-section"}};this.selectedDays=C(7);this.alertManagementTab=C("alerts");this.alertRules=C([]);this.alertHistory=C([]);this.showAddAlertRuleDialog=C(!1);this.deleteConfirmDialog=C({show:!1,type:"single"});this.isSubmittingCampaign=C(!1);let e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.theme.set(e?"dark":"light"),gn(()=>{this.document.documentElement.className=this.theme()}),gn(()=>{let t=this.navBridge.currentView(),n=this.currentView();t&&t!==n&&(console.log("[AppComponent] \u540C\u6B65\u5C0E\u822A:",t,"\u2190 from NavBridge"),this.currentView.set(t))})}get routerUrl(){return this.router?.url||"N/A"}toggleSidebarGroup(e){let t=this.sidebarGroups();this.sidebarGroups.set(N(F({},t),{[e]:!t[e]})),localStorage.setItem("sidebar_groups",JSON.stringify(this.sidebarGroups()))}isSidebarGroupExpanded(e){return this.sidebarGroups()[e]??!0}loadSidebarGroupsState(){try{let e=localStorage.getItem("sidebar_groups");if(e){let n=JSON.parse(e);this.sidebarGroups.set(F(F({},this.sidebarGroups()),n))}localStorage.getItem("sidebar_collapsed")==="true"&&this.sidebarCollapsed.set(!0)}catch(e){console.warn("[Sidebar] Failed to load sidebar groups state:",e)}}toggleSidebarCollapse(){let e=!this.sidebarCollapsed();this.sidebarCollapsed.set(e),localStorage.setItem("sidebar_collapsed",String(e))}get showQrLoginDialog(){return this.dialogService.showQrLoginDialog}hideSearchSuggestions(){setTimeout(()=>this.showSearchSuggestions.set(!1),200)}isInSearchResultMode(){return this.currentSearchKeyword().length>0}exitSearchResultMode(){this.currentSearchKeyword.set(""),this.loadResources()}saveSettings(){this.saveSettingsTimer&&clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=setTimeout(()=>{this.ipcService.send("save-settings",{settings:{spintaxEnabled:this.spintaxEnabled(),autoReplyEnabled:this.autoReplyEnabled(),autoReplyMessage:this.autoReplyMessage(),smartSendingEnabled:this.smartSendingEnabled()}}),this.saveSettingsTimer=null},500)}showSettingsSavedToast(){this.toastService.success(this.t("settingsSaved"),2e3)}async testAiConnection(){if(this.aiApiType()==="local"){await this.testLocalAiConnection();return}if(this.aiApiKey()){this.isTestingAi.set(!0),this.aiConnectionStatus.set(null);try{this.ipcService.send("test-ai-connection",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint()}),await new Promise(t=>setTimeout(t,1500));let e=this.aiApiKey();this.aiApiType()==="gemini"&&e.startsWith("AIza")?this.aiConnectionStatus.set("success"):this.aiApiType()==="openai"&&e.startsWith("sk-")?this.aiConnectionStatus.set("success"):this.aiApiType()==="custom"&&e.length>10?this.aiConnectionStatus.set("success"):(this.aiConnectionStatus.set("error"),this.aiConnectionError.set(this.t("invalidApiKeyFormat")))}catch(e){this.aiConnectionStatus.set("error"),this.aiConnectionError.set(e.message)}finally{this.isTestingAi.set(!1)}}}async testLocalAiConnection(){let e=this.localAiEndpoint();if(e){this.isTestingLocalAi.set(!0),this.localAiStatus.set(null);try{this.ipcService.send("test-local-ai",{endpoint:e,provider:this.localAiProvider(),model:this.localAiModel()}),this.localAiProvider()==="ollama"&&this.ipcService.send("get-ollama-models",{endpoint:e}),await new Promise(t=>setTimeout(t,3e3)),e.startsWith("http://")||e.startsWith("https://")?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success("\u672C\u5730 AI \u670D\u52D9\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(this.t("invalidEndpointFormat")))}catch(t){this.localAiStatus.set("error"),this.localAiError.set(t.message)}finally{this.isTestingLocalAi.set(!1)}}}refreshOllamaModels(){let e=this.localAiEndpoint();e&&(this.toastService.info("\u6B63\u5728\u7372\u53D6\u6A21\u578B\u5217\u8868..."),this.ipcService.send("get-ollama-models",{endpoint:e}))}setLocalAiPresets(e){switch(this.localAiProvider.set(e),e){case"ollama":this.localAiEndpoint.set("http://localhost:11434"),this.localAiModel.set("qwen2:7b");break;case"lmstudio":this.localAiEndpoint.set("http://localhost:1234"),this.localAiModel.set("");break;case"custom":this.localAiEndpoint.set(""),this.localAiModel.set("");break}}async testTtsConnection(){let e=this.ttsEndpoint();if(e){this.isTestingTts.set(!0),this.ttsStatus.set(null);try{this.ipcService.send("test-tts-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.ttsStatus.set("success"):(this.ttsStatus.set("error"),this.ttsError.set(this.t("invalidEndpointFormat")))}catch(t){this.ttsStatus.set("error"),this.ttsError.set(t.message)}finally{this.isTestingTts.set(!1)}}}async testSttConnection(){let e=this.sttEndpoint();if(e){this.isTestingStt.set(!0),this.sttStatus.set(null);try{this.ipcService.send("test-stt-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.sttStatus.set("success"):(this.sttStatus.set("error"),this.sttError.set(this.t("invalidEndpointFormat")))}catch(t){this.sttStatus.set("error"),this.sttError.set(t.message)}finally{this.isTestingStt.set(!1)}}}saveAiSettings(){localStorage.setItem("ai_api_key",this.aiApiKey()),localStorage.setItem("ai_api_type",this.aiApiType()),localStorage.setItem("ai_custom_endpoint",this.customApiEndpoint()),localStorage.setItem("local_ai_endpoint",this.localAiEndpoint()),localStorage.setItem("local_ai_model",this.localAiModel()),localStorage.setItem("tts_endpoint",this.ttsEndpoint()),localStorage.setItem("tts_enabled",String(this.ttsEnabled())),localStorage.setItem("tts_voice",this.ttsVoice()),localStorage.setItem("stt_endpoint",this.sttEndpoint()),localStorage.setItem("stt_enabled",String(this.sttEnabled())),this.ipcService.send("save-ai-settings",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint(),localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel(),ttsEndpoint:this.ttsEndpoint(),ttsEnabled:this.ttsEnabled(),ttsVoice:this.ttsVoice(),sttEndpoint:this.sttEndpoint(),sttEnabled:this.sttEnabled()}),this.aiApiType()==="gemini"&&this.aiApiKey()&&this.geminiService.setApiKey(this.aiApiKey()),this.toastService.success(this.t("aiSettingsSaved"),2e3)}toggleAiAutoChat(){this.aiAutoChatEnabled.set(!this.aiAutoChatEnabled()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoChatEnabled()?"AI \u81EA\u52D5\u804A\u5929\u5DF2\u958B\u555F":"AI \u81EA\u52D5\u804A\u5929\u5DF2\u95DC\u9589",2e3)}toggleAiAutoGreeting(){this.aiAutoGreeting.set(!this.aiAutoGreeting()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoGreeting()?"\u81EA\u52D5\u554F\u5019\u5DF2\u958B\u555F":"\u81EA\u52D5\u554F\u5019\u5DF2\u95DC\u9589",2e3)}saveAiChatSettings(){localStorage.setItem("ai_auto_chat_enabled",String(this.aiAutoChatEnabled())),localStorage.setItem("ai_auto_chat_mode",this.aiAutoChatMode()),localStorage.setItem("ai_typing_speed",String(this.aiTypingSpeed())),localStorage.setItem("ai_reply_delay",JSON.stringify(this.aiReplyDelay())),localStorage.setItem("ai_system_prompt",this.aiSystemPrompt()),localStorage.setItem("ai_max_context_messages",String(this.aiMaxContextMessages())),localStorage.setItem("ai_enable_memory",String(this.aiEnableMemory())),localStorage.setItem("ai_auto_greeting",String(this.aiAutoGreeting())),localStorage.setItem("ai_greeting_message",this.aiGreetingMessage()),this.ipcService.send("update-ai-chat-settings",{settings:{auto_chat_enabled:this.aiAutoChatEnabled()?1:0,auto_chat_mode:this.aiAutoChatMode(),typing_speed:this.aiTypingSpeed(),reply_delay_min:this.aiReplyDelay()[0],reply_delay_max:this.aiReplyDelay()[1],system_prompt:this.aiSystemPrompt(),max_context_messages:this.aiMaxContextMessages(),enable_memory:this.aiEnableMemory()?1:0,auto_greeting:this.aiAutoGreeting()?1:0,greeting_message:this.aiGreetingMessage()},localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel()}),this.toastService.success(this.t("aiSettingsSaved"),2e3)}loadAiChatSettings(){let e=localStorage.getItem("ai_auto_chat_enabled"),t=localStorage.getItem("ai_auto_chat_mode"),n=localStorage.getItem("ai_typing_speed"),o=localStorage.getItem("ai_reply_delay"),r=localStorage.getItem("ai_system_prompt"),c=localStorage.getItem("ai_max_context_messages"),m=localStorage.getItem("ai_enable_memory"),h=localStorage.getItem("ai_auto_greeting"),g=localStorage.getItem("ai_greeting_message");if(e&&this.aiAutoChatEnabled.set(e==="true"),t&&this.aiAutoChatMode.set(t),n&&this.aiTypingSpeed.set(parseInt(n)),o)try{this.aiReplyDelay.set(JSON.parse(o))}catch{}r&&this.aiSystemPrompt.set(r),c&&this.aiMaxContextMessages.set(parseInt(c)),m&&this.aiEnableMemory.set(m==="true"),h&&this.aiAutoGreeting.set(h==="true"),g&&this.aiGreetingMessage.set(g)}initRagSystem(){this.isInitializingRag.set(!0),this.ipcService.send("init-rag-system",{})}triggerRagLearning(){this.isRagLearning.set(!0),this.ipcService.send("trigger-rag-learning",{})}reindexHighValueConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30})}cleanupRagKnowledge(){this.isCleaningRag.set(!0),this.ipcService.send("cleanup-rag-knowledge",{minScore:.2,daysOld:30,mergeSimilar:!0})}reindexConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30}),this.toastService.info("\u958B\u59CB\u91CD\u5EFA\u7D22\u5F15...")}refreshRagStats(){this.ipcService.send("get-rag-stats",{})}searchRagKnowledge(){this.ragSearchQuery.trim()&&(this.isSearchingRag.set(!0),this.ipcService.send("search-rag",{query:this.ragSearchQuery,limit:10}))}sendRagFeedback(e,t){this.ipcService.send("rag-feedback",{knowledgeId:e,isPositive:t}),this.toastService.info(t?"\u{1F44D} \u611F\u8B1D\u53CD\u994B\uFF01":"\u{1F44E} \u5DF2\u8A18\u9304\u53CD\u994B")}addRagKnowledge(){if(!this.newRagKnowledge.answer.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u56DE\u7B54\u5167\u5BB9");return}this.ipcService.send("add-rag-knowledge",{type:this.newRagKnowledge.type,question:this.newRagKnowledge.question,answer:this.newRagKnowledge.answer,context:this.newRagKnowledge.context}),this.newRagKnowledge={type:"qa",question:"",answer:"",context:""},this.showAddRagKnowledgeDialog.set(!1)}searchVectorMemory(){this.vectorMemorySearchQuery.trim()&&(this.isSearchingMemory.set(!0),this.ipcService.send("search-vector-memories",{userId:this.selectedMemoryUserId()||"",query:this.vectorMemorySearchQuery,limit:10}))}addVectorMemory(){if(!this.newMemory.content.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u8A18\u61B6\u5167\u5BB9");return}this.isAddingMemory.set(!0),this.ipcService.send("add-vector-memory",{userId:this.newMemory.userId||"manual",content:this.newMemory.content,type:this.newMemory.type,importance:this.newMemory.importance})}refreshMemoryStats(){this.ipcService.send("get-memory-stats",{userId:""})}deleteVectorMemory(e){this.ipcService.send("delete-vector-memory",{memoryId:e})}loadMemoryUserList(){this.ipcService.send("get-memory-user-list",{})}cleanupOldMemories(){this.ipcService.send("cleanup-old-memories",{daysOld:90})}mergeSimilarMemories(){let e=this.selectedMemoryUserId();if(!e){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("merge-similar-memories",{userId:e,threshold:.85})}getResourceDiscoveryAccounts(){return this.accounts().filter(t=>t.status==="Online").sort((t,n)=>{let o={Explorer:1,Listener:2,Sender:3,AI:4,Backup:5,Unassigned:6};return(o[t.role]||99)-(o[n.role]||99)})}getSelectedResourceAccount(){let e=this.resourceAccountId();if(e)return this.accounts().find(n=>n.id===e)||null;let t=this.getResourceDiscoveryAccounts();return t.length>0?t[0]:null}selectResourceAccount(e){this.resourceAccountId.set(e);let t=this.accounts().find(n=>n.id===e);t&&this.toastService.success(`\u8CC7\u6E90\u767C\u73FE\u5C07\u4F7F\u7528: ${t.phone}`),this.showResourceAccountSelector.set(!1)}getRoleDisplayName(e){return{Explorer:"\u{1F50D} \u63A2\u7D22\u865F",Listener:"\u{1F441}\uFE0F \u76E3\u63A7\u865F",Sender:"\u{1F4E4} \u767C\u9001\u865F",AI:"\u{1F916} AI\u865F",Backup:"\u26A1 \u5099\u7528\u865F",Unassigned:"\u2B55 \u672A\u5206\u914D"}[e]||"\u2B55 \u672A\u5206\u914D"}initResourceDiscovery(){let e=this.getSelectedResourceAccount();if(!e){this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.toastService.info(`\u6B63\u5728\u4F7F\u7528 ${e.phone} \u521D\u59CB\u5316\u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71...`),this.ipcService.send("init-resource-discovery",{accountId:e.id,phone:e.phone})}autoInitResourceDiscovery(){this.resourceDiscoveryInitialized()||this.initResourceDiscovery(),this.refreshResourceStats(),this.loadDiscoveryKeywords()}generateSearchSessionId(){return`search_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}generateSearchCacheKey(e,t){let n=e.toLowerCase().trim(),o=[...t].sort().join(",");return`${n}|${o}`}getSearchCache(e){let t=this.searchResultsCache.get(e);return t?Date.now()-t.timestamp>this.CACHE_EXPIRY_MS?(this.searchResultsCache.delete(e),null):t.results:null}setSearchCache(e,t){if(this.searchResultsCache.size>20){let n=Array.from(this.searchResultsCache.entries());n.sort((r,c)=>r[1].timestamp-c[1].timestamp),n.slice(0,n.length-20).forEach(([r])=>this.searchResultsCache.delete(r))}this.searchResultsCache.set(e,{results:[...t],timestamp:Date.now()}),console.log(`[Search Cache] \u5DF2\u7DE9\u5B58\u641C\u7D22\u7D50\u679C: "${e}" (${t.length} \u689D)`)}clearSearchCache(){this.searchResultsCache.clear(),console.log("[Search Cache] \u5DF2\u6E05\u9664\u6240\u6709\u7DE9\u5B58")}searchResources(){if(!this.resourceSearchQuery.trim()){this.toastService.error(this.t("searchPlaceholder"));return}if(this.selectedSearchSources().length===0){this.toastService.error("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u641C\u7D22\u6E20\u9053");return}if(this.getOnlineAccountsCount()===0){this.toastService.error("\u8ACB\u5148\u767B\u9304\u5E33\u865F");return}let e=this.resourceSearchQuery.trim(),t=this.selectedSearchSources(),n=this.generateSearchCacheKey(e,t),o=this.getSearchCache(n);if(o){console.log(`[Search Cache] \u4F7F\u7528\u7DE9\u5B58\u7D50\u679C: "${e}" (${o.length} \u689D)`),this.currentSearchKeyword.set(e),this.discoveredResources.set(o),this.showSearchHistory.set(!1);let g=this.searchHistoryKeywords(),_=[e,...g.filter(S=>S!==e)].slice(0,10);this.searchHistoryKeywords.set(_);return}let r=this.generateSearchSessionId();this.currentSearchSessionId.set(r),this.currentSearchKeyword.set(e),this.showSearchHistory.set(!1);let c=this.searchHistoryKeywords(),m=[e,...c.filter(g=>g!==e)].slice(0,10);this.searchHistoryKeywords.set(m),this.discoveredResources.set([]);let h=e.split(/[,;]/).map(g=>g.trim()).filter(g=>g.length>0);h.length>1?(console.log(`[Search] \u6B63\u5728\u641C\u7D22 ${h.length} \u4E2A\u5173\u952E\u8BCD...`),this.searchMultipleKeywords(h)):(this.isSearchingResources.set(!0),this.searchError.set({hasError:!1,message:"",details:"",suggestions:[]}),console.log(`[Search] \u6B63\u5728\u641C\u7D22 "${e}"...`),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u7A0D\u540E\u518D\u8BD5"))},7e4),this.executeMultiSourceSearch(e,t))}executeMultiSourceSearch(e,t){let n=this.getSelectedResourceAccount()?.phone,o=this.currentSearchSessionId();(t.includes("telegram")||t.includes("local"))&&this.ipcService.send("search-resources",{query:e,phone:n,sources:t.filter(r=>r!=="jiso"),limit:50,searchType:this.resourceSearchType(),minMembers:this.resourceMinMembers(),replaceMode:!0,searchSessionId:o,searchKeyword:e}),t.includes("jiso")&&(console.log("[Search] \u6B63\u5728\u901A\u8FC7\u6781\u641C Bot \u641C\u7D22..."),this.ipcService.send("search-jiso",{keyword:e,phone:n,limit:50,searchSessionId:o,searchKeyword:e})),t.includes("tgstat")}searchMultipleKeywords(e){this.isSearchingResources.set(!0);let t=this.selectedSearchSources();this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6"))},e.length*1e4+3e4),e.forEach((n,o)=>{setTimeout(()=>{this.executeMultiSourceSearch(n,t)},o*5e3)})}openTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link;t?this.ipcService.send("open-external-link",{url:t}):this.toastService.warning("\u6B64\u7FA4\u7D44\u6C92\u6709\u516C\u958B\u93C8\u63A5")}copyTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||"";t?(navigator.clipboard.writeText(t),this.toastService.success("\u93C8\u63A5\u5DF2\u8907\u88FD")):(navigator.clipboard.writeText(e.title),this.toastService.warning("\u6B64\u7FA4\u7D44\u7121\u516C\u958B\u93C8\u63A5\uFF0C\u5DF2\u8907\u88FD\u7FA4\u7D44\u540D\u7A31\uFF0C\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u641C\u7D22"))}copyUsername(e){let t=`@${e}`;navigator.clipboard.writeText(t),this.toastService.success("\u5DF2\u8907\u88FD "+t)}getResourceTypeIcon(e){switch(e){case"channel":return"\u{1F4E2}";case"supergroup":return"\u{1F465}";case"group":return"\u{1F4AC}";default:return"\u{1F4CC}"}}getResourceTypeLabel(e){switch(e){case"channel":return"\u983B\u9053";case"supergroup":return"\u8D85\u7D1A\u7FA4\u7D44";case"group":return"\u7FA4\u7D44";default:return"\u672A\u77E5"}}formatMemberCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}quickJoinResource(e){this.ipcService.send("batch-join-resources",{resourceIds:[e]}),this.toastService.info("\u6B63\u5728\u5617\u8A66\u52A0\u5165...")}loadResources(){this.ipcService.send("get-resources",{status:this.resourceFilterStatus()||void 0,type:this.resourceFilterType()||void 0,limit:100,offset:0})}filterResourcesByLink(){let e=this.resourceFilterLink();if(!e){this.loadResources();return}let n=this.discoveredResources().filter(o=>{let r=!!(o.username||o.invite_link);return e==="has_link"?r:e==="no_link"?!r:!0});this.discoveredResources.set(n)}refreshResourceStats(){this.ipcService.send("get-resource-stats",{})}openChannelManageDialog(){this.loadSearchChannels(),this.showChannelManageDialog.set(!0)}closeChannelManageDialog(){this.showChannelManageDialog.set(!1)}loadSearchChannels(){this.ipcService.send("get-search-channels",{})}openAddChannelDialog(){this.newChannelUsername="",this.newChannelDisplayName="",this.newChannelQueryFormat="{keyword}",this.newChannelPriority="backup",this.newChannelNotes="",this.showAddChannelDialog.set(!0)}closeAddChannelDialog(){this.showAddChannelDialog.set(!1)}addSearchChannel(){if(!this.newChannelUsername.trim()){this.toastService.error("\u8ACB\u8F38\u5165 Bot \u7528\u6236\u540D");return}this.ipcService.send("add-search-channel",{botUsername:this.newChannelUsername.trim(),displayName:this.newChannelDisplayName.trim()||this.newChannelUsername.trim(),queryFormat:this.newChannelQueryFormat,priority:this.newChannelPriority,notes:this.newChannelNotes})}deleteSearchChannel(e){if(e<0){this.toastService.warning("\u7121\u6CD5\u522A\u9664\u7CFB\u7D71\u6E20\u9053");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u500B\u641C\u7D22\u6E20\u9053\u55CE\uFF1F")&&this.ipcService.send("delete-search-channel",{channelId:e})}testSearchChannel(e){this.isTestingChannel.set(!0),this.toastService.info(`\u6B63\u5728\u6E2C\u8A66 @${e}...`),this.ipcService.send("test-search-channel",{botUsername:e})}toggleChannelEnabled(e,t){if(e<0){this.toastService.warning("\u7121\u6CD5\u4FEE\u6539\u7CFB\u7D71\u6E20\u9053");return}this.ipcService.send("update-search-channel",{channelId:e,enabled:!t})}getChannelStatusColor(e){switch(e){case"online":return"text-green-400";case"offline":return"text-red-400";case"captcha":return"text-yellow-400";default:return"text-gray-400"}}getChannelStatusIcon(e){switch(e){case"online":return"\u{1F7E2}";case"offline":return"\u{1F534}";case"captcha":return"\u{1F7E1}";default:return"\u26AA"}}openJoinAndMonitorDialog(e){this.joinMonitorResource.set(e),this.joinMonitorKeywords.set([]),this.joinMonitorNewKeyword="",this.joinMonitorAutoEnable.set(!0),this.loadAccountQuotas(),e.joined_by_phone?this.joinMonitorSelectedPhone.set(e.joined_by_phone):this.joinMonitorSelectedPhone.set("");let t=this.monitoredGroups().find(n=>n.url===e.username||n.url===`@${e.username}`||n.url===e.telegram_id||n.id===e.id);t&&t.keywordSetIds?this.joinMonitorSelectedKeywordSetIds.set([...t.keywordSetIds]):this.joinMonitorSelectedKeywordSetIds.set([]),this.showQuickCreateKeywordSet.set(!1),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword="",this.showJoinMonitorDialog.set(!0)}closeJoinMonitorDialog(){this.showJoinMonitorDialog.set(!1),this.joinMonitorResource.set(null),this.showChangeMonitorAccount.set(!1)}getAvailableAccountsForMonitor(){return this.accounts().filter(e=>e.status==="Online")}selectMonitorAccount(e){this.joinMonitorSelectedPhone.set(e),this.showChangeMonitorAccount.set(!1)}stopMonitoringGroup(e){if(!e)return;let t=e.telegram_id||e.id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u8B58\u5225\u7FA4\u7D44");return}this.ipcService.send("remove-group",{groupId:t,id:e.id,telegramId:e.telegram_id,username:e.username,link:e.link||e.invite_link}),this.updateResourceStatusLocally(e,"joined"),this.closeJoinMonitorDialog(),this.closeResourceMenu(),this.toastService.info("\u6B63\u5728\u505C\u6B62\u76E3\u63A7..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},500)}confirmLeaveGroup(e){if(!e)return;let t=e.title||e.username||"\u6B64\u7FA4\u7D44";confirm(`\u78BA\u5B9A\u8981\u9000\u51FA\u300C${t}\u300D\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\uFF1A
\u2022 \u5F9E Telegram \u9000\u51FA\u7FA4\u7D44
\u2022 \u505C\u6B62\u6240\u6709\u76E3\u63A7
\u2022 \u522A\u9664\u76F8\u95DC\u6578\u64DA`)&&this.leaveGroup(e)}leaveGroup(e){if(!e)return;let t=e.joined_by_phone||this.joinMonitorSelectedPhone(),n=e.telegram_id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u78BA\u5B9A\u4F7F\u7528\u7684\u5E33\u865F");return}this.ipcService.send("leave-group",{phone:t,groupId:n,resourceId:e.id}),this.updateResourceStatusLocally(e,"discovered"),this.closeJoinMonitorDialog(),this.toastService.info("\u6B63\u5728\u9000\u51FA\u7FA4\u7D44..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},1e3)}openInTelegram(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||e.link;t?window.open(t,"_blank"):this.toastService.warning("\u6C92\u6709\u53EF\u7528\u7684\u93C8\u63A5")}deleteResource(e){if(e?.id&&confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u300C${e.title||"\u6B64\u8CC7\u6E90"}\u300D\u7684\u8A18\u9304\u55CE\uFF1F`)){this.ipcService.send("delete-resource",{resourceId:e.id});let t=this.discoveredResources();this.discoveredResources.set(t.filter(n=>n.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664\u8CC7\u6E90\u8A18\u9304"),this.refreshResourceStats()}}updateResourceStatusLocally(e,t,n,o){if(!e)return;let r=this.discoveredResources(),c=e.telegram_id||e.username||e.title,m=r.map(h=>{if((h.telegram_id||h.username||h.title)===c){let _=N(F({},h),{status:t,joined_at:new Date().toISOString()});return n&&(_.joined_by_phone=n),o&&o>0&&(_.member_count=o),_}return h});this.discoveredResources.set(m),console.log(`[Frontend] Updated resource status: ${c} -> ${t}`)}showPostJoinOptions(e,t,n){this.showJoinMonitorDialog.set(!1),this.showSuccessAnimation({icon:"\u{1F680}",title:"\u52A0\u5165\u6210\u529F\uFF01",subtitle:e?.title||"\u7FA4\u7D44\u5DF2\u6DFB\u52A0\u5230\u76E3\u63A7",duration:1200}),setTimeout(()=>{this.postJoinResource.set(e),this.postJoinPhone.set(t),this.showPostJoinDialog.set(!0)},1200)}closePostJoinDialog(){this.showPostJoinDialog.set(!1),this.postJoinResource.set(null),this.postJoinPhone.set("")}showSuccessAnimation(e){this.successOverlayConfig.set(e),this.showSuccessOverlay.set(!0);let t=e.duration||1500;setTimeout(()=>{this.hideSuccessAnimation()},t)}hideSuccessAnimation(){this.showSuccessOverlay.set(!1),this.successOverlayConfig.set(null)}postJoinExtractMembers(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openMemberListDialog(e))}postJoinSendMessage(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openSingleMessageDialog(e))}postJoinContinue(){this.closePostJoinDialog(),this.toastService.info("\u7E7C\u7E8C\u700F\u89BD\u5176\u4ED6\u7FA4\u7D44",2e3)}loadAccountQuotas(){let n=this.accounts().filter(o=>o.status==="Online").map(o=>{let r=Math.floor(o.dailySendCount/10)||0,c=20,m=Math.floor(o.dailySendCount/5)||0,h=o.healthScore||0,g=c>0?(c-m)/c*100:0,_=h*.5+g*.5;return{phone:o.phone,nickname:o.group||o.phone,joinedGroups:r,dailyLimit:c,dailyUsed:Math.min(m,c),isRecommended:!1,recommendScore:_,healthScore:h}}).sort((o,r)=>r.recommendScore-o.recommendScore).map((o,r)=>{let c=o.healthScore>=70&&o.dailyUsed<o.dailyLimit*.8,m=r<2&&c;return N(F({},o),{isRecommended:m})});if(this.accountQuotas.set(n),!this.joinMonitorSelectedPhone()){let o=n.find(r=>r.isRecommended);o?this.joinMonitorSelectedPhone.set(o.phone):n.length>0&&this.joinMonitorSelectedPhone.set(n[0].phone)}}toggleKeywordSetSelection(e){let t=this.joinMonitorSelectedKeywordSetIds();if(t.includes(e))this.joinMonitorSelectedKeywordSetIds.set(t.filter(n=>n!==e));else{let n=this.keywordSets().find(o=>o.id===e);if(n&&(!n.keywords||n.keywords.length===0)){this.toastService.warning(`\u26A0\uFE0F \u300C${n.name}\u300D\u6C92\u6709\u95DC\u9375\u8A5E\uFF0C\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u518D\u4F7F\u7528`);return}this.joinMonitorSelectedKeywordSetIds.set([...t,e])}}isKeywordSetSelected(e){return this.joinMonitorSelectedKeywordSetIds().includes(e)}openQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!0),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword=""}closeQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!1)}addQuickKeyword(){let e=this.quickCreateKeywordSetNewKeyword.trim();e&&!this.quickCreateKeywordSetKeywords().includes(e)&&(this.quickCreateKeywordSetKeywords.update(t=>[...t,e]),this.quickCreateKeywordSetNewKeyword="")}removeQuickKeyword(e){this.quickCreateKeywordSetKeywords.update(t=>t.filter(n=>n!==e))}addQuickRecommendedKeyword(e){this.quickCreateKeywordSetKeywords().includes(e)||this.quickCreateKeywordSetKeywords.update(t=>[...t,e])}executeQuickCreateKeywordSet(){let e=this.quickCreateKeywordSetName.trim(),t=this.quickCreateKeywordSetKeywords();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u8A5E\u96C6\u540D\u7A31");return}if(t.length===0){this.toastService.warning("\u8ACB\u81F3\u5C11\u6DFB\u52A0\u4E00\u500B\u95DC\u9375\u8A5E");return}this.ipcService.send("add-keyword-set",{name:e});let n=o=>{if(o.success&&o.setId){for(let r of t)this.ipcService.send("add-keyword",{setId:o.setId,keyword:r,isRegex:!1});this.joinMonitorSelectedKeywordSetIds.update(r=>[...r,o.setId]),this.toastService.success(`\u5DF2\u5275\u5EFA\u4E26\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6\u300C${e}\u300D`),this.closeQuickCreateKeywordSet(),this.ipcService.send("get-keyword-sets")}this.ipcService.off("keyword-set-added",n)};this.ipcService.on("keyword-set-added",n)}addMonitorKeyword(){let e=this.joinMonitorNewKeyword.trim();e&&!this.joinMonitorKeywords().includes(e)&&(this.joinMonitorKeywords.update(t=>[...t,e]),this.joinMonitorNewKeyword="")}removeMonitorKeyword(e){this.joinMonitorKeywords.update(t=>t.filter(n=>n!==e))}addRecommendedKeyword(e){this.joinMonitorKeywords().includes(e)||this.joinMonitorKeywords.update(t=>[...t,e])}getRecommendedKeywords(){let e=this.joinMonitorResource();if(!e)return[];let t=e.title||"",n=[];return(t.includes("\u4E8C\u624B")||t.includes("\u4EA4\u6613"))&&n.push("\u6C42\u8CFC","\u51FA\u552E","\u8F49\u8B93"),(t.includes("\u62DB\u8058")||t.includes("\u6C42\u8077"))&&n.push("\u62DB\u4EBA","\u6C42\u8077","\u517C\u8077"),(t.includes("\u83EF\u4EBA")||t.includes("\u6D77\u5916"))&&n.push("\u5408\u4F5C","\u8CC7\u6E90","\u6C42\u52A9"),n.length===0&&n.push("\u6C42\u8CFC","\u5408\u4F5C","\u8AEE\u8A62"),n.filter(o=>!this.joinMonitorKeywords().includes(o))}getKeywordPreview(e){if(!e||e.length===0)return"";let t=e.slice(0,3).map(n=>n.keyword||n.text||n).join(", ");return e.length>3?t+"...":t}executeJoinAndMonitor(){let e=this.joinMonitorResource(),t=this.joinMonitorSelectedPhone();if(!e){this.toastService.error("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}if(e.status!=="joined"&&e.status!=="monitoring"&&!t){this.toastService.error("\u8ACB\u9078\u64C7\u52A0\u5165\u5E33\u865F");return}this.isJoiningResource.set(!0);let n=this.joinMonitorSelectedKeywordSetIds(),o={resourceId:e.id||0,phone:t,keywordSetIds:n,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable()};if(!e.id||e.id===0){let r=e.link||e.invite_link||"",c=e.username||"";if(c&&c.toLowerCase().endsWith("bot")&&(console.log(`[Frontend] \u904E\u6FFE bot username: ${c}`),c=""),r&&/t\.me\/[^/]+\/\d+/.test(r)&&(console.log(`[Frontend] \u904E\u6FFE\u6D88\u606F\u93C8\u63A5: ${r}`),r=""),!r&&!c){let h=e.title||"\u6B64\u7FA4\u7D44";this.toastService.error(`\u7121\u6CD5\u52A0\u5165\u300C${h}\u300D\uFF1A
\u2022 \u6B64\u641C\u7D22\u7D50\u679C\u6C92\u6709\u63D0\u4F9B\u7FA4\u7D44\u7684\u9080\u8ACB\u93C8\u63A5
\u2022 \u8ACB\u5728 Telegram \u4E2D\u9EDE\u64CA\u641C\u7D22\u6A5F\u5668\u4EBA\u7684\u7D50\u679C
\u2022 \u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5\u5F8C\u518D\u8A66`),this.isJoiningResource.set(!1);return}let m="";e.telegram_id&&e.telegram_id!==e.title&&!e.telegram_id.toLowerCase().endsWith("bot")?m=e.telegram_id:c&&(m=c),o.resourceInfo={username:c,telegram_id:m,title:e.title||c||"\u672A\u547D\u540D\u7FA4\u7D44",description:e.description||"",member_count:e.member_count||0,resource_type:e.resource_type||"supergroup",link:r||(c?`https://t.me/${c}`:"")},console.log("[Frontend] Sending resourceInfo:",o.resourceInfo)}if(this.ipcService.send("join-and-monitor-with-account",o),e.status==="joined"||e.status==="monitoring"){let r=e.username?`@${e.username}`:e.telegram_id;this.ipcService.send("add-group",{url:r,keywordSetIds:n})}}openMonitorSettings(e){this.openJoinAndMonitorDialog(e)}openBatchJoinMonitorDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.batchJoinResources.set(t),this.joinMonitorSelectedPhones.set([]),this.joinMonitorKeywords.set([]),this.joinMonitorSelectedKeywordSetIds.set([]),this.joinMonitorBatchMode.set(!0),this.joinMonitorBatchInterval.set(45),this.loadAccountQuotas(),this.showBatchJoinMonitorDialog.set(!0)}getBatchJoinTotalMembers(){return this.batchJoinResources().reduce((e,t)=>e+(t.member_count||0),0)}closeBatchJoinMonitorDialog(){this.showBatchJoinMonitorDialog.set(!1),this.batchJoinResources.set([])}toggleAccountSelection(e){let t=this.joinMonitorSelectedPhones();t.includes(e)?this.joinMonitorSelectedPhones.set(t.filter(n=>n!==e)):this.joinMonitorSelectedPhones.set([...t,e])}selectAllAccounts(){let e=this.accountQuotas().map(t=>t.phone);this.joinMonitorSelectedPhones.set(e)}executeBatchJoinMonitor(){let e=this.batchJoinResources(),t=this.joinMonitorSelectedPhones();if(e.length===0){this.toastService.error("\u6C92\u6709\u9078\u64C7\u7FA4\u7D44");return}if(t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u5E33\u865F");return}this.isJoiningResource.set(!0),this.batchJoinProgress.set({current:0,total:e.length,status:"\u6E96\u5099\u4E2D..."});let n=this.joinMonitorSelectedKeywordSetIds();this.ipcService.send("batch-join-and-monitor",{resourceIds:e.map(o=>o.id),phones:t,keywordSetIds:n,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable(),batchMode:this.joinMonitorBatchMode(),batchInterval:this.joinMonitorBatchInterval()}),this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44\uFF0C\u4F7F\u7528 ${t.length} \u500B\u5E33\u865F`)}openMemberListDialog(e){this.memberListResource.set(e),this.memberListData.set([]),this.memberListLoading.set(!1),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:""}),this.selectedMemberIds.set([]),this.memberExtractStarted.set(!1),this.memberListFilter.set("all"),this.memberExtractConfig.set({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}}),this.showMemberListDialog.set(!0)}closeMemberListDialog(){this.showMemberListDialog.set(!1),this.memberListResource.set(null),this.memberListData.set([])}loadMemberList(e){if(!e||!e.telegram_id){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44\u4FE1\u606F");return}this.memberListLoading.set(!0),this.memberListProgress.update(t=>N(F({},t),{status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:0})}extractMoreMembers(){let e=this.memberListResource(),t=this.memberListData().length;e&&(this.memberListLoading.set(!0),this.memberListProgress.update(n=>N(F({},n),{status:"\u6B63\u5728\u63D0\u53D6\u66F4\u591A\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:t}))}toggleMemberIdSelection(e){let t=this.selectedMemberIds();t.includes(e)?this.selectedMemberIds.set(t.filter(n=>n!==e)):this.selectedMemberIds.set([...t,e])}selectAllMembers(){let e=this.memberListData().map(t=>t.user_id);this.selectedMemberIds.set(e)}exportMembersToCSV(){let e=this.getFilteredMembers();if(e.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u6210\u54E1");return}let t=this.memberListResource(),n=`members_${t?.username||t?.telegram_id}_${new Date().toISOString().slice(0,10)}.csv`,o=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u5168\u540D","\u96FB\u8A71\u865F\u78BC","\u500B\u4EBA\u7C21\u4ECB","\u8A9E\u8A00","DC","\u5728\u7DDA\u72C0\u614B","\u6700\u5F8C\u4E0A\u7DDA","\u89D2\u8272","\u52A0\u5165\u65E5\u671F","Premium","\u5DF2\u8A8D\u8B49","Bot","\u6709\u982D\u50CF","\u8A50\u9A19","\u5047\u5E33\u865F","\u53D7\u9650\u5236","\u5DF2\u522A\u9664","\u83EF\u4EBA","\u6D3B\u8E8D\u5EA6","\u50F9\u503C\u7B49\u7D1A","\u4F86\u6E90\u7FA4\u7D44","\u63D0\u53D6\u6642\u9593"],r=S=>{if(S==null)return"";let y=String(S);return y.includes(",")||y.includes('"')||y.includes(`
`)?`"${y.replace(/"/g,'""')}"`:y},c=e.map(S=>[S.user_id,S.username||"",S.first_name||"",S.last_name||"",S.full_name||`${S.first_name||""} ${S.last_name||""}`.trim(),S.phone||"",r(S.bio||""),S.language_code||"",S.dc_id||"",S.online_status||"",S.last_online||"",S.chat_member_status||"member",S.joined_date||"",S.is_premium?"\u662F":"\u5426",S.is_verified?"\u662F":"\u5426",S.is_bot?"\u662F":"\u5426",S.has_photo?"\u662F":"\u5426",S.is_scam?"\u662F":"\u5426",S.is_fake?"\u662F":"\u5426",S.is_restricted?"\u662F":"\u5426",S.is_deleted?"\u662F":"\u5426",this.isChineseMember(S)?"\u662F":"\u5426",S.activity_score?(S.activity_score*100).toFixed(0)+"%":"",S.value_level||"",S.source_chat_title||"",S.extracted_at||""]),m=[o,...c].map(S=>S.map(r).join(",")).join(`
`),h=new Blob(["\uFEFF"+m],{type:"text/csv;charset=utf-8"}),g=URL.createObjectURL(h),_=document.createElement("a");_.href=g,_.download=n,_.click(),URL.revokeObjectURL(g),this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}setMemberExtractLimit(e){this.memberExtractConfig.update(t=>N(F({},t),{limit:e}))}applyExtractPreset(e){this.selectedPreset.set(e);let t=this.extractPresets.find(n=>n.id===e);t&&(this.memberExtractConfig.update(n=>N(F({},n),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),t.config.userTypes&&this.memberExtractConfig.update(n=>N(F({},n),{userTypes:F(F({},n.userTypes),t.config.userTypes)})),t.config.activityFilters&&this.memberExtractConfig.update(n=>N(F({},n),{activityFilters:F(F({},n.activityFilters),t.config.activityFilters)})),t.config.accountFeatures&&this.memberExtractConfig.update(n=>N(F({},n),{accountFeatures:F(F({},n.accountFeatures),t.config.accountFeatures)})),this.toastService.info(`\u5DF2\u61C9\u7528\u300C${t.name}\u300D\u9810\u8A2D`))}toggleUserType(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>N(F({},t),{userTypes:N(F({},t.userTypes),{[e]:!t.userTypes[e]})}))}toggleActivityFilter(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>N(F({},t),{activityFilters:N(F({},t.activityFilters),{[e]:!t.activityFilters[e]})}))}toggleAccountFeature(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>N(F({},t),{accountFeatures:N(F({},t.accountFeatures),{[e]:!t.accountFeatures[e]})}))}toggleExcludeFilter(e){this.memberExtractConfig.update(t=>N(F({},t),{excludeFilters:N(F({},t.excludeFilters),{[e]:!t.excludeFilters[e]})}))}getActiveFilterCount(){let e=this.memberExtractConfig(),t=0;return Object.values(e.userTypes).forEach(n=>n&&t++),Object.values(e.activityFilters).forEach(n=>n&&t++),Object.values(e.accountFeatures).forEach(n=>n&&t++),t}clearAllFilters(){this.selectedPreset.set(""),this.memberExtractConfig.update(e=>N(F({},e),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),this.toastService.info("\u5DF2\u6E05\u9664\u6240\u6709\u7BE9\u9078\u689D\u4EF6")}startMemberExtraction(){console.log("[Frontend] startMemberExtraction called");let e=this.memberListResource();if(console.log("[Frontend] Resource:",e),!e){console.error("[Frontend] No resource selected"),this.toastService.error("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u7FA4\u7D44");return}this.memberExtractStarted.set(!0),this.memberListLoading.set(!0),this.memberListData.set([]),this.extractionStartTime.set(Date.now());let t=this.memberExtractConfig(),n=t.limit===-1?t.customLimit:t.limit===0?99999:t.limit;console.log("[Frontend] Extraction config:",{limit:n,config:t}),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."});let o={resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:n,offset:0,filters:{onlineOnly:t.activityFilters.onlineNow,chineseOnly:t.userTypes.chinese,premiumOnly:t.accountFeatures.premium,hasUsername:t.accountFeatures.hasUsername,excludeBots:t.excludeFilters.bots}};console.log("[Frontend] Sending extract-members IPC:",o),this.toastService.info("\u{1F4E4} \u6B63\u5728\u767C\u9001\u63D0\u53D6\u8ACB\u6C42..."),this.ipcService.send("extract-members",o),t.backgroundMode&&(this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C"),this.closeMemberListDialog())}pauseMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>N(F({},e),{status:"\u5DF2\u66AB\u505C"})),this.toastService.info("\u23F8\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u66AB\u505C")}stopMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>N(F({},e),{status:"\u5DF2\u505C\u6B62"})),this.toastService.info("\u23F9\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u505C\u6B62")}toggleMemberExtractBackground(){this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C\uFF0C\u5B8C\u6210\u5F8C\u6703\u901A\u77E5\u60A8"),this.closeMemberListDialog()}handleMemberExtractionError(e){let t=e.error_code||"UNKNOWN",n=e.error_details||{};switch(this.memberListProgress.update(o=>N(F({},o),{status:"\u63D0\u53D6\u5931\u6557"})),t){case"PEER_ID_INVALID":case"NOT_PARTICIPANT":case"CHANNEL_PRIVATE":let o=n.attempts||0;o>1?this.showExtractionErrorWithAction("\u26A0\uFE0F \u7FA4\u7D44\u540C\u6B65\u672A\u5B8C\u6210",n.reason||`\u5DF2\u5617\u8A66 ${o} \u6B21\uFF0CTelegram \u670D\u52D9\u5668\u5C1A\u672A\u540C\u6B65`,n.suggestion||"\u8ACB\u7B49\u5F85 30 \u79D2\u5F8C\u518D\u8A66\uFF0C\u6216\u91CD\u65B0\u52A0\u5165\u7FA4\u7D44",void 0):this.showExtractionErrorWithAction("\u26A0\uFE0F \u7121\u6CD5\u63D0\u53D6\u6210\u54E1",n.reason||"\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44",n.suggestion||"\u8ACB\u5148\u52A0\u5165\u7FA4\u7D44\u518D\u5617\u8A66\u63D0\u53D6",n.can_auto_join?"join":void 0);break;case"ADMIN_REQUIRED":this.showExtractionErrorWithAction("\u{1F512} \u6210\u54E1\u5217\u8868\u53D7\u9650",n.reason||"\u7FA4\u7D44\u8A2D\u7F6E\u9650\u5236\u4E86\u6210\u54E1\u5217\u8868\u8A2A\u554F",n.suggestion||"\u53EF\u5617\u8A66\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u6536\u96C6\u6D3B\u8E8D\u7528\u6236",n.alternative==="monitor_messages"?"monitor":void 0);break;case"FLOOD_WAIT":this.toastService.warning(`\u23F3 ${e.error}

${n.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}`);break;case"CHANNEL_INVALID":this.toastService.error(`\u274C ${e.error}

${n.suggestion||"\u8ACB\u5237\u65B0\u8CC7\u6E90\u5217\u8868"}`);break;default:this.toastService.error(`\u274C \u63D0\u53D6\u5931\u6557: ${e.error}`)}}showExtractionErrorWithAction(e,t,n,o){let r=this.memberListResource(),c=`${e}

\u539F\u56E0\uFF1A${t}

\u{1F4A1} ${n}`;o==="join"&&r?(c+=`

\u9EDE\u64CA\u300C\u52A0\u5165\u7FA4\u7D44\u300D\u6309\u9215\u5F8C\u91CD\u8A66`,this.toastService.warning(c),this.memberListProgress.update(m=>N(F({},m),{status:"\u9700\u8981\u5148\u52A0\u5165\u7FA4\u7D44"}))):o==="monitor"&&r?(c+=`

\u5EFA\u8B70\uFF1A\u555F\u52D5\u6D88\u606F\u76E3\u63A7\u4F86\u6536\u96C6\u6D3B\u8E8D\u7528\u6236`,this.toastService.warning(c),this.memberListProgress.update(m=>N(F({},m),{status:"\u5EFA\u8B70\u4F7F\u7528\u6D88\u606F\u76E3\u63A7"}))):this.toastService.error(c)}async autoJoinAndExtract(){let e=this.memberListResource();if(!e)return;this.toastService.info("\u{1F680} \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44...");let t=this.accounts().find(n=>n.status==="Online");t?(this.ipcService.send("join-group",{phone:t.phone,groupUrl:e.username?`https://t.me/${e.username}`:e.invite_link}),this.ipcService.once("group-join-result",n=>{n.success?(this.toastService.success("\u2705 \u6210\u529F\u52A0\u5165\u7FA4\u7D44\uFF0C\u6B63\u5728\u91CD\u65B0\u63D0\u53D6..."),setTimeout(()=>{this.startMemberExtraction()},2e3)):this.toastService.error(`\u274C \u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${n.error}`)})):this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F")}getFirstOnlineAccount(){return this.accounts().find(e=>e.status==="Online")}calculateAndShowExtractionSummary(e){let t=this.memberListResource(),n=this.extractionStartTime(),o=n>0?Math.round((Date.now()-n)/1e3):0,r=0,c=0,m=0,h=0,g=0,_=0,S={S:0,A:0,B:0,C:0,D:0};for(let y of e){y.online_status==="online"?r++:y.online_status==="recently"&&c++,y.is_premium&&m++,this.isChineseMember(y)&&h++,y.username&&g++,y.is_bot&&_++;let D=y.value_level||this.calculateMemberValueLevel(y);D&&S.hasOwnProperty(D)&&S[D]++}this.extractionSummary.set({groupName:t?.title||t?.name||"\u672A\u77E5\u7FA4\u7D44",groupUrl:t?.username?`t.me/${t.username}`:t?.url||"",totalExtracted:e.length,totalInGroup:t?.member_count||0,onlineCount:r,recentlyCount:c,premiumCount:m,chineseCount:h,hasUsernameCount:g,botCount:_,valueLevelDistribution:S,extractedAt:new Date().toLocaleString("zh-TW"),duration:o}),this.showExtractionSummaryDialog.set(!0),this.toastService.success(`\u2705 \u6210\u529F\u63D0\u53D6 ${e.length} \u500B\u6210\u54E1`)}calculateMemberValueLevel(e){let t=0;return e.is_premium&&(t+=30),e.online_status==="online"?t+=25:e.online_status==="recently"?t+=20:e.online_status==="last_week"&&(t+=10),e.username&&(t+=15),this.isChineseMember(e)&&(t+=10),e.is_bot&&(t-=50),e.activity_score&&(t+=Math.min(e.activity_score,20)),t>=70?"S":t>=50?"A":t>=30?"B":t>=10?"C":"D"}closeExtractionSummaryDialog(){this.showExtractionSummaryDialog.set(!1)}goToMemberDatabaseFromSummary(){this.closeExtractionSummaryDialog(),this.closeMemberListDialog(),this.currentView.set("member-database")}startBatchMarketingFromSummary(){this.closeExtractionSummaryDialog(),this.toastService.info("\u{1F4A1} \u8ACB\u5728\u6210\u54E1\u5217\u8868\u4E2D\u9078\u64C7\u8981\u71DF\u92B7\u7684\u7528\u6236\uFF0C\u7136\u5F8C\u9EDE\u64CA\u300C\u6279\u91CF\u767C\u9001\u300D")}getValueLevelPercent(e){let t=this.extractionSummary(),n=t.totalExtracted;if(n===0)return 0;let o=t.valueLevelDistribution[e]||0;return Math.round(o/n*100)}setMemberFilter(e){this.memberListFilter.set(e)}getFilteredMembers(){let e=this.memberListData();switch(this.memberListFilter()){case"chinese":return e.filter(n=>this.isChineseMember(n));case"online":return e.filter(n=>n.online_status==="online"||n.online_status==="recently");case"premium":return e.filter(n=>n.is_premium);case"hasUsername":return e.filter(n=>!!n.username);default:return e}}isChineseMember(e){let t=/[\u4e00-\u9fa5]/,n=(e.first_name||"")+(e.last_name||"");return t.test(n)}getChineseMemberCount(){return this.memberListData().filter(e=>this.isChineseMember(e)).length}getOnlineMemberCount(){return this.memberListData().filter(e=>e.online_status==="online"||e.online_status==="recently").length}getPremiumMemberCount(){return this.memberListData().filter(e=>e.is_premium).length}getMemberExtractPercent(){let e=this.memberListProgress();return e.total===0?0:Math.min(100,Math.round(this.memberListData().length/e.total*100))}isAllMembersSelected(){let e=this.getFilteredMembers();return e.length>0&&e.every(t=>this.selectedMemberIds().includes(t.user_id))}toggleSelectAllMembersList(){let e=this.getFilteredMembers();this.isAllMembersSelected()?this.selectedMemberIds.set([]):this.selectedMemberIds.set(e.map(t=>t.user_id))}sendPrivateMessage(e){if(!e.username){this.toastService.warning("\u8A72\u7528\u6236\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u79C1\u4FE1");return}this.toastService.info(`\u{1F4E8} \u6E96\u5099\u767C\u9001\u79C1\u4FE1\u7D66 @${e.username}`)}batchSendPrivateMessage(){let e=this.selectedMemberIds().length;this.toastService.info(`\u{1F4E8} \u6E96\u5099\u6279\u91CF\u767C\u9001\u79C1\u4FE1\u7D66 ${e} \u500B\u6210\u54E1`)}batchAddFriend(){let e=this.selectedMemberIds().length;this.toastService.info(`\u2795 \u6E96\u5099\u6279\u91CF\u6DFB\u52A0 ${e} \u500B\u597D\u53CB`)}addMemberToFunnel(e){let t={userId:e.user_id,username:e.username||"",firstName:e.first_name||"",lastName:e.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u624B\u52D5\u6DFB\u52A0",onlineStatus:e.online_status||"unknown"};this.ipcService.send("add-lead",t),this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${e.first_name||e.username||"ID:"+e.user_id} \u52A0\u5165\u71DF\u92B7\u6F0F\u6597`)}batchAddToFunnel(){let e=this.selectedMemberIds(),t=this.memberListData().filter(o=>e.includes(o.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let n=0;for(let o of t){let r={userId:o.user_id,username:o.username||"",firstName:o.first_name||"",lastName:o.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u6279\u91CF\u6DFB\u52A0",onlineStatus:o.online_status||"unknown"};this.ipcService.send("add-lead",r),n++}this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${n} \u500B\u6210\u54E1\u52A0\u5165\u71DF\u92B7\u6F0F\u6597`),this.clearMemberSelection()}clearMemberSelection(){this.selectedMemberIds.set([])}exportSelectedMembersToCSV(){let e=this.selectedMemberIds(),t=this.memberListData().filter(h=>e.includes(h.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let n=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u8A55\u7D1A","\u5728\u7DDA\u72C0\u614B","Premium","\u4F86\u6E90\u7FA4\u7D44"],o=t.map(h=>[h.user_id,h.username||"",h.first_name||"",h.last_name||"",this.calculateMemberValueLevel(h),h.online_status||"unknown",h.is_premium?"\u662F":"\u5426",this.memberListResource()?.title||""]),r=[n.join(","),...o.map(h=>h.join(","))].join(`
`),c=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a");m.href=URL.createObjectURL(c),m.download=`selected-members-${new Date().toISOString().split("T")[0]}.csv`,m.click(),this.toastService.success(`\u{1F4E5} \u5DF2\u5C0E\u51FA ${t.length} \u500B\u6210\u54E1`)}selectHighValueMembers(){let t=this.memberListData().filter(n=>{let o=this.calculateMemberValueLevel(n);return o==="S"||o==="A"}).map(n=>n.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B S/A \u7D1A\u6210\u54E1`)}selectOnlineMembers(){let t=this.memberListData().filter(n=>n.online_status==="online"||n.online_status==="recently").map(n=>n.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B\u5728\u7DDA/\u6700\u8FD1\u6D3B\u8E8D\u6210\u54E1`)}selectAllMembersInList(){let e=this.getFilteredMembers();this.selectedMemberIds.set(e.map(t=>t.user_id)),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${e.length} \u500B\u6210\u54E1`)}openBatchMemberExtractDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u63D0\u53D6 ${e.length} \u500B\u7FA4\u7D44\u7684\u6210\u54E1`),this.ipcService.send("batch-extract-members",{resourceIds:e,limit:100,safeMode:!0})}openSingleMessageDialog(e){this.singleMessageResource.set(e),this.singleMessageContent="",this.singleMessageScheduled.set(!1),this.singleMessageScheduleTime="",this.singleMessageAccountId.set(""),this.loadAccountQuotas(),this.showSingleMessageDialog.set(!0)}closeSingleMessageDialog(){this.showSingleMessageDialog.set(!1),this.singleMessageResource.set(null)}executeSingleMessage(){let e=this.singleMessageResource(),t=this.singleMessageContent.trim();if(!e){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44");return}if(!t){this.toastService.error("\u8ACB\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let n=this.singleMessageAccountId();if(!n){this.toastService.error("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.singleMessageScheduled()&&this.singleMessageScheduleTime?(this.ipcService.send("schedule-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:n,scheduledTime:this.singleMessageScheduleTime}),this.toastService.success(`\u23F0 \u6D88\u606F\u5DF2\u6392\u7A0B\uFF0C\u5C07\u65BC ${this.singleMessageScheduleTime} \u767C\u9001`)):(this.ipcService.send("send-group-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:n}),this.toastService.info("\u{1F4E8} \u6B63\u5728\u767C\u9001\u6D88\u606F...")),this.closeSingleMessageDialog()}refreshAllResources(){this.isRefreshing.set(!0),this.toastService.info("\u6B63\u5728\u5237\u65B0\u8CC7\u6E90\u6578\u64DA..."),this.refreshResourceStats(),this.loadResources(),this.loadDiscoveryKeywords(),setTimeout(()=>{this.isRefreshing.set(!1),this.toastService.success("\u5237\u65B0\u5B8C\u6210")},2e3)}clearSearchResults(){let e=this.discoveredResources().length;if(e===0){this.toastService.warning("\u6C92\u6709\u53EF\u6E05\u7A7A\u7684\u8CC7\u6E90");return}confirm(`\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709 ${e} \u689D\u641C\u7D22\u7D50\u679C\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u8CC7\u6E90\u8A18\u9304\uFF0C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&this.ngZone.run(()=>{this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.refreshResourceStats(),this.cdr.detectChanges()})}deleteAllDiscoveredResources(){let e=this.discoveredResources().filter(t=>t.status==="discovered").map(t=>t.id);if(e.length===0){this.toastService.info("\u6C92\u6709\u53EF\u522A\u9664\u7684\u672A\u8655\u7406\u8CC7\u6E90");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6240\u6709\u672A\u8655\u7406\u7684\u8CC7\u6E90\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002")&&(this.ipcService.send("delete-resources-batch",{resourceIds:e}),this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u522A\u9664 ${e.length} \u500B\u8CC7\u6E90`),setTimeout(()=>this.loadResources(),500))}clearDiscoveredResources(){this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.toastService.info("\u5DF2\u6E05\u7A7A\u7576\u524D\u641C\u7D22\u7D50\u679C")}clearHistoryData(e="all"){confirm(`\u78BA\u5B9A\u8981\u6E05\u7406 ${{all:"\u6240\u6709\u8CC7\u6E90\u6578\u64DA",old_data:"\u820A\u6578\u64DA",search_history:"\u641C\u7D22\u6B77\u53F2\uFF08\u4FDD\u7559\u6536\u85CF\uFF09"}[e]} \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&(this.toastService.info("\u{1F9F9} \u6B63\u5728\u6E05\u7406..."),this.ipcService.send("clear-resources",{type:e,daysToKeep:e==="old_data"?7:0}))}clearAllSearchHistory(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2\u55CE\uFF1F\u6B64\u64CD\u4F5C\u6703\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u641C\u7D22\u7D50\u679C\u3002")&&(this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.searchHistoryKeywords.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.showSearchHistory.set(!1),this.toastService.success("\u5DF2\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2"))}toggleSearchHistoryMode(){let e=!this.showSearchHistory();this.showSearchHistory.set(e),e?(this.loadResources(),this.toastService.info("\u6B63\u5728\u8F09\u5165\u6B77\u53F2\u641C\u7D22\u7D50\u679C...")):this.currentSearchKeyword()||this.discoveredResources.set([])}searchFromHistory(e){this.resourceSearchQuery=e,this.showSearchHistory.set(!1),this.searchResources()}handleSearchDiscoverySearch(e){this.resourceSearchQuery=e.query,this.selectedSearchSources.set(e.sources),this.searchResources()}handleSearchDiscoverySelectAccount(e){this.selectResourceAccount(e.id)}handleOnboardingNavigate(e){console.log("[Onboarding] \u5BFC\u822A\u5230:",e),this.changeView(e)}openOnboarding(){this.onboardingComponent&&this.onboardingComponent.open()}resetOnboarding(){this.onboardingComponent&&(this.onboardingComponent.reset(),this.onboardingComponent.open())}saveResource(e){if(!e.telegram_id){this.toastService.error("\u7121\u6CD5\u6536\u85CF\uFF1A\u7F3A\u5C11\u8CC7\u6E90 ID");return}this.ipcService.send("save-resource",{telegram_id:e.telegram_id,username:e.username,title:e.title,description:e.description,member_count:e.member_count,resource_type:e.resource_type,overall_score:e.overall_score,discovery_keyword:this.currentSearchKeyword()});let t=new Set(this.savedResources());t.add(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(r=>r.telegram_id===e.telegram_id?N(F({},r),{is_saved:!0}):r);this.discoveredResources.set(o),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF\u300C${e.title}\u300D`)}unsaveResource(e){if(!e.telegram_id)return;this.ipcService.send("unsave-resource",{telegram_id:e.telegram_id});let t=new Set(this.savedResources());t.delete(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(r=>r.telegram_id===e.telegram_id?N(F({},r),{is_saved:!1}):r);this.discoveredResources.set(o),this.toastService.info(`\u5DF2\u53D6\u6D88\u6536\u85CF\u300C${e.title}\u300D`)}batchSaveResources(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u6536\u85CF\u7684\u8CC7\u6E90");return}let t=this.discoveredResources().filter(n=>e.includes(n.id)||e.some(o=>String(o)===n.telegram_id));t.forEach(n=>this.saveResource(n)),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF ${t.length} \u500B\u8CC7\u6E90`)}isResourceSaved(e){return e.is_saved||this.savedResources().has(e.telegram_id)}syncContactsData(){this.contactsService.syncFromSources(),this.toastService.info("\u6B63\u5728\u540C\u6B65\u6578\u64DA...",2e3)}joinAndMonitor(e){let t=this.discoveredResources().find(n=>n.id===e);if(!t){this.toastService.error("\u627E\u4E0D\u5230\u8A72\u8CC7\u6E90");return}this.toastService.info(`\u6B63\u5728\u52A0\u5165\u4E26\u76E3\u63A7: ${t.title}`),this.ipcService.send("join-and-monitor-resource",{resourceId:e,username:t.username,telegramId:t.telegram_id,title:t.title})}batchJoinAndMonitor(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}this.toastService.info(`\u6B63\u5728\u6279\u91CF\u52A0\u5165\u4E26\u76E3\u63A7 ${e.length} \u500B\u7FA4\u7D44...`),this.ipcService.send("batch-join-and-monitor",{resourceIds:e})}loadDiscoveryKeywords(){this.ipcService.send("get-discovery-keywords",{})}addDiscoveryKeyword(){if(!this.newResourceKeyword.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E");return}this.ipcService.send("add-discovery-keyword",{keyword:this.newResourceKeyword.trim(),category:"general",priority:5})}searchWithKeyword(e){this.resourceSearchQuery=e,this.searchResources()}toggleResourceSelection(e){let t=this.selectedResourceIds();t.includes(e)?this.selectedResourceIds.set(t.filter(n=>n!==e)):this.selectedResourceIds.set([...t,e])}toggleSelectAllResources(){let e=this.discoveredResources();this.selectedResourceIds().length===e.length?this.selectedResourceIds.set([]):this.selectedResourceIds.set(e.map(n=>n.id))}addSelectedToJoinQueue(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("add-to-join-queue",{resourceIds:e,priority:5})}processJoinQueue(){this.isProcessingJoinQueue.set(!0),this.ipcService.send("process-join-queue",{limit:5})}toggleSearchSource(e){let t=this.selectedSearchSources();t.includes(e)?this.selectedSearchSources.set(t.filter(n=>n!==e)):this.selectedSearchSources.set([...t,e])}selectAllSearchSources(){this.selectedSearchSources.set(["telegram","jiso","tgstat","local"])}enterGroup(e){this.changeView("resources"),this.toastService.info(`\u6E96\u5099\u9032\u5165\u7FA4\u7D44\uFF1A${e.title}`)}batchEnterGroups(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.toastService.info(`\u6E96\u5099\u9032\u5165 ${t.length} \u500B\u7FA4\u7D44\u67E5\u770B\u6210\u54E1`)}sendGroupMessage(e){this.selectedResourceIds.set([e.id]),this.showBatchMessageDialog.set(!0)}executeBatchMessage(){let e=this.selectedResourceIds();if(e.length===0||!this.batchMessageContent.trim()){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u4E26\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.toastService.success(`\u958B\u59CB\u5411 ${t.length} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!1)}inviteMembersToGroup(e){this.selectedResourceIds.set([e.id]),this.loadAvailableMembers(),this.showBatchInviteDialog.set(!0)}executeBatchInvite(){let e=this.selectedResourceIds(),t=this.batchInviteConfig.selectedMemberIds;if(e.length===0||t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u548C\u6210\u54E1");return}this.toastService.success(`\u958B\u59CB\u9080\u8ACB ${t.length} \u4F4D\u6210\u54E1\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44`),this.showBatchInviteDialog.set(!1)}loadAvailableMembers(){this.availableMembersForInvite.set([{id:"1",name:"\u793A\u4F8B\u6210\u54E11",username:"member1"},{id:"2",name:"\u793A\u4F8B\u6210\u54E12",username:"member2"}])}toggleSelectAllMembers(e){e.target.checked?(this.batchInviteConfig.selectedMemberIds=this.availableMembersForInvite().map(n=>n.id),this.batchInviteConfig.selectAll=!0):(this.batchInviteConfig.selectedMemberIds=[],this.batchInviteConfig.selectAll=!1)}toggleMemberSelection(e,t){let n=t.target.checked,o=this.batchInviteConfig.selectedMemberIds;n?this.batchInviteConfig.selectedMemberIds=[...o,e]:this.batchInviteConfig.selectedMemberIds=o.filter(r=>r!==e),this.batchInviteConfig.selectAll=this.batchInviteConfig.selectedMemberIds.length===this.availableMembersForInvite().length}batchJoinSelected(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("batch-join-resources",{resourceIds:e,delayMin:30,delayMax:60})}toggleResourceMenu(e,t){t&&t.stopPropagation(),this.openResourceMenuId()===e?this.openResourceMenuId.set(null):this.openResourceMenuId.set(e)}closeResourceMenu(){this.openResourceMenuId.set(null)}getResourceStatusColor(e){return{discovered:"bg-blue-500",queued:"bg-yellow-500",joining:"bg-orange-500",joined:"bg-green-500",monitoring:"bg-emerald-500",left:"bg-gray-500",blocked:"bg-red-500",invalid:"bg-slate-500"}[e]||"bg-gray-500"}getSizeGrade(e){return e>=1e5?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",label:"\u8D85\u5927\u578B"}:e>=1e4?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",label:"\u5927\u578B"}:e>=1e3?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",label:"\u4E2D\u578B"}:e>=100?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",label:"\u5C0F\u578B"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",label:"\u5FAE\u578B"}}getScoreGrade(e){let t=e*100;return t>=90?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",icon:"\u{1F3C6}"}:t>=75?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",icon:"\u2B50"}:t>=60?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",icon:"\u{1F44D}"}:t>=40?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",icon:"\u{1F44C}"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",icon:"\u26A0\uFE0F"}}getScoreBarColor(e){let t=e*100;return t>=90?"bg-amber-400":t>=75?"bg-green-400":t>=60?"bg-blue-400":t>=40?"bg-slate-400":"bg-red-400"}getResourceStatusName(e){return{discovered:"\u5DF2\u767C\u73FE",queued:"\u968A\u5217\u4E2D",joining:"\u52A0\u5165\u4E2D",joined:"\u5DF2\u52A0\u5165",monitoring:"\u76E3\u63A7\u4E2D",left:"\u5DF2\u9000\u51FA",blocked:"\u88AB\u5C01\u7981",invalid:"\u7121\u6548"}[e]||e}getResourceTypeName(e){return{group:"\u7FA4\u7D44",supergroup:"\u8D85\u7D1A\u7FA4\u7D44",channel:"\u983B\u9053",bot:"\u6A5F\u5668\u4EBA"}[e]||e}getResourceTypeStyle(e){return{channel:{icon:"\u{1F4E2}",label:"\u983B\u9053",bgClass:"bg-purple-500/20",textClass:"text-purple-400",canMessage:!1,canExtract:!1},supergroup:{icon:"\u{1F465}",label:"\u8D85\u7D1A\u7FA4\u7D44",bgClass:"bg-blue-500/20",textClass:"text-blue-400",canMessage:!0,canExtract:!0},group:{icon:"\u{1F4AC}",label:"\u7FA4\u7D44",bgClass:"bg-green-500/20",textClass:"text-green-400",canMessage:!0,canExtract:!0},bot:{icon:"\u{1F916}",label:"\u6A5F\u5668\u4EBA",bgClass:"bg-orange-500/20",textClass:"text-orange-400",canMessage:!0,canExtract:!1}}[e]||{icon:"\u{1F4CC}",label:"\u672A\u77E5",bgClass:"bg-slate-500/20",textClass:"text-slate-400",canMessage:!1,canExtract:!1}}isChannel(e){return e?.resource_type==="channel"}canSendMessageToResource(e){return!this.isChannel(e)}canExtractMembers(e){return!this.isChannel(e)}showChannelMemberWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u63D0\u53D6\u6210\u54E1\u5217\u8868

Telegram \u4E0D\u5141\u8A31\u67E5\u770B\u983B\u9053\u7684\u8A02\u95B1\u8005\u5217\u8868\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u5C0B\u627E\u8A72\u983B\u9053\u7684\u95DC\u806F\u8A0E\u8AD6\u7FA4\u7D44`)}showChannelMessageWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u767C\u9001\u6D88\u606F

\u53EA\u6709\u983B\u9053\u7BA1\u7406\u54E1\u53EF\u4EE5\u767C\u5E03\u5167\u5BB9\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u95DC\u6CE8\u983B\u9053\u7372\u53D6\u8CC7\u8A0A\uFF0C\u6216\u5C0B\u627E\u8A0E\u8AD6\u7FA4\u7D44`)}verifyResourceType(e){if(!e?.id){this.toastService.error("\u7121\u6548\u7684\u8CC7\u6E90");return}this.toastService.info(`\u{1F50D} \u6B63\u5728\u9A57\u8B49: ${e.title||e.username}...`),this.ipcService.send("verify-resource-type",{resourceId:e.id})}getResourcePermissionStatus(e){return this.isChannel(e)?{icon:"\u{1F4E2}",text:"\u50C5\u8A02\u95B1",class:"text-purple-400"}:{icon:"\u2705",text:"\u53EF\u4E92\u52D5",class:"text-green-400"}}getSelectedChannelCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type==="channel").length}getSelectedGroupCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel").length}getSelectedMessageableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel")}getSelectedExtractableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel")}openBatchMessageWithFilter(){let e=this.getSelectedChannelCount();e>0&&this.toastService.info(`\u{1F4E2} \u5DF2\u81EA\u52D5\u6392\u9664 ${e} \u500B\u983B\u9053\uFF0C\u5C07\u5C0D ${this.getSelectedGroupCount()} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!0)}initDiscussionWatcher(){this.ipcService.send("init-discussion-watcher",{})}discoverDiscussion(){if(!this.discoverChannelId.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u983B\u9053 ID \u6216 username");return}this.ipcService.send("discover-discussion",{channelId:this.discoverChannelId.trim()}),this.discoverChannelId=""}discoverDiscussionsFromResources(){this.ipcService.send("discover-discussions-from-resources",{})}loadChannelDiscussions(){this.ipcService.send("get-channel-discussions",{activeOnly:!0})}refreshDiscussionStats(){this.ipcService.send("get-discussion-stats",{})}startDiscussionMonitoring(e){this.ipcService.send("start-discussion-monitoring",{discussionId:e})}stopDiscussionMonitoring(e){this.ipcService.send("stop-discussion-monitoring",{discussionId:e})}loadDiscussionMessages(e){this.selectedDiscussionId.set(e),this.isLoadingDiscussionMessages.set(!0),this.ipcService.send("get-discussion-messages",{discussionId:e,limit:50,matchedOnly:!1})}replyToDiscussion(e,t,n){if(!n||!n.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u56DE\u5FA9\u5167\u5BB9");return}this.ipcService.send("reply-to-discussion",{discussionId:t,messageId:e,replyText:n.trim()}),this.discussionReplyText.set("")}initKnowledgeBase(){this.ipcService.send("init-knowledge-base",{})}loadKnowledgeData(){this.isLoadingKnowledge.set(!0),this.ipcService.send("get-knowledge-stats",{}),this.refreshCurrentKnowledgeTab()}refreshCurrentKnowledgeTab(){switch(this.knowledgeTab()){case"documents":this.ipcService.send("get-documents",{});break;case"images":this.ipcService.send("get-media",{mediaType:"image"});break;case"videos":this.ipcService.send("get-media",{mediaType:"video"});break;case"qa":this.ipcService.send("get-qa-pairs",{});break}}switchKnowledgeTab(e){this.knowledgeTab.set(e),this.refreshCurrentKnowledgeTab()}addDocument(){let e=this.newDocument();if(!e.title&&!e.content){this.toastService.error(this.t("documentTitle")+" required",2e3);return}this.ipcService.send("add-document",{title:e.title,content:e.content,category:e.category,tags:e.tags.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})}async uploadDocumentFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0],o=this.newDocument(),r=new FileReader;r.onload=()=>{let c=r.result;this.ipcService.send("add-document",{title:o.title||n.name.replace(/\.[^/.]+$/,""),content:c,category:o.category,tags:o.tags.split(",").map(m=>m.trim()).filter(m=>m)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})},n.type==="application/pdf"?this.toastService.info("PDF \u6587\u4EF6\u5C07\u7531\u5F8C\u7AEF\u8655\u7406",2e3):r.readAsText(n),t.value=""}deleteDocument(e){this.ipcService.send("delete-document",{id:e}),this.knowledgeDocuments.update(t=>t.filter(n=>n.id!==e))}async uploadMediaFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0],o=this.newMedia(),c=n.type.startsWith("video/")?"video":"image",m=new FileReader;m.onload=()=>{let h=m.result.split(",")[1];this.ipcService.send("add-media",{base64Data:h,name:o.name||n.name.replace(/\.[^/.]+$/,""),category:o.category,description:o.description,mediaType:c}),this.showAddMediaDialog.set(!1),this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"})},m.readAsDataURL(n),t.value=""}deleteMedia(e,t){this.ipcService.send("delete-media",{id:e}),t==="image"?this.knowledgeImages.update(n=>n.filter(o=>o.id!==e)):this.knowledgeVideos.update(n=>n.filter(o=>o.id!==e))}addQaPair(){let e=this.newQaPair();if(!e.question||!e.answer){this.toastService.error(this.t("question")+" & "+this.t("answer")+" required",2e3);return}this.ipcService.send("add-qa-pair",{question:e.question,answer:e.answer,category:e.category,keywords:e.keywords.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddQaDialog.set(!1),this.newQaPair.set({question:"",answer:"",category:"general",keywords:""})}deleteQaPair(e){this.knowledgeQaPairs.update(t=>t.filter(n=>n.id!==e))}openAddImageDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"}),this.showAddMediaDialog.set(!0)}openAddVideoDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"video"}),this.showAddMediaDialog.set(!0)}updateNewDocumentField(e,t){let n=this.newDocument();this.newDocument.set(N(F({},n),{[e]:t}))}updateNewMediaField(e,t){let n=this.newMedia();this.newMedia.set(N(F({},n),{[e]:t}))}updateNewQaPairField(e,t){let n=this.newQaPair();this.newQaPair.set(N(F({},n),{[e]:t}))}searchKnowledge(e){e.trim()&&this.ipcService.send("search-knowledge",{query:e,includeDocs:!0,includeImages:!0,includeVideos:!0,limit:20})}sendAiGreeting(){let e=this.aiGreetingSuggestion();e&&(this.ipcService.send("send-message",{phone:e.accountPhone,recipientId:e.userId,text:e.suggestedGreeting,leadId:e.leadId}),this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null),this.toastService.success(`\u2713 \u554F\u5019\u6D88\u606F\u5DF2\u767C\u9001\u7D66 @${e.username||e.firstName}`))}editAiGreeting(e){let t=this.aiGreetingSuggestion();t&&this.aiGreetingSuggestion.set(N(F({},t),{suggestedGreeting:e}))}dismissAiGreeting(){this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null)}formatFileSize(e){if(!e)return"0 B";let t=1024,n=["B","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}async uploadVoiceSample(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0];if(!["audio/wav","audio/mp3","audio/mpeg","audio/ogg","audio/flac"].includes(n.type)){this.voiceCloneError.set(this.t("invalidAudioFormat"));return}if(n.size>50*1024*1024){this.voiceCloneError.set(this.t("audioFileTooLarge"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0),this.voiceCloneError.set("");try{let r=new FileReader;r.onprogress=c=>{c.lengthComputable&&this.voiceUploadProgress.set(Math.round(c.loaded/c.total*50))},r.onload=async()=>{let c=r.result.split(",")[1],m=n.name.replace(/\.[^/.]+$/,"");this.ipcService.send("upload-voice-sample",{name:m,audioData:c,fileName:n.name,fileType:n.type}),this.voiceUploadProgress.set(100),setTimeout(()=>{let h={id:Date.now().toString(),name:m,audioPath:n.name,promptText:"",createdAt:new Date};this.clonedVoices.update(g=>[...g,h]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3)},500)},r.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},r.readAsDataURL(n)}catch(r){this.voiceCloneError.set(r.message),this.isUploadingVoice.set(!1)}t.value=""}selectClonedVoice(e){this.selectedClonedVoice.set(e);let t=this.clonedVoices().find(n=>n.id===e);t&&this.ttsVoice.set(t.audioPath)}deleteClonedVoice(e){this.clonedVoices.update(t=>t.filter(n=>n.id!==e)),this.selectedClonedVoice()===e&&(this.selectedClonedVoice.set(""),this.ttsVoice.set("")),this.saveClonedVoicesToStorage(),this.ipcService.send("delete-voice-sample",{voiceId:e}),this.toastService.success(this.t("voiceDeleted"),2e3)}async previewClonedVoice(e){let t=this.clonedVoices().find(n=>n.id===e);t&&this.ipcService.send("preview-voice-sample",{voiceId:e,audioPath:t.audioPath})}async generateWithClonedVoice(e){let t=this.ttsEndpoint(),n=this.selectedClonedVoice();if(!t){this.toastService.error(this.t("ttsEndpointRequired"),2e3);return}if(!n){this.toastService.error(this.t("selectVoiceFirst"),2e3);return}let o=this.clonedVoices().find(r=>r.id===n);o&&this.ipcService.send("generate-cloned-voice",{endpoint:t,text:e,voiceId:n,audioPath:o.audioPath})}saveClonedVoicesToStorage(){let e=this.clonedVoices().map(t=>N(F({},t),{createdAt:t.createdAt.toISOString()}));localStorage.setItem("cloned_voices",JSON.stringify(e))}loadClonedVoicesFromStorage(){let e=localStorage.getItem("cloned_voices");if(e)try{let t=JSON.parse(e).map(n=>N(F({},n),{createdAt:new Date(n.createdAt)}));this.clonedVoices.set(t)}catch(t){console.error("Failed to load cloned voices:",t)}}openRecordingDialog(){this.showRecordingDialog.set(!0),this.voiceName.set(""),this.voicePromptText.set(""),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.voiceCloneError.set(""),this.recordingTime.set(0)}closeRecordingDialog(){this.stopRecording(),this.showRecordingDialog.set(!1),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl())}async startRecording(){try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:44100,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});this.audioChunks=[],this.mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"}),this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.onstop=()=>{let t=new Blob(this.audioChunks,{type:"audio/webm"});this.recordedAudioBlob.set(t),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioUrl.set(URL.createObjectURL(t)),e.getTracks().forEach(n=>n.stop())},this.mediaRecorder.start(100),this.isRecording.set(!0),this.recordingTime.set(0),this.recordingTimer=setInterval(()=>{this.recordingTime.update(t=>t+1),this.recordingTime()>=10&&this.stopRecording()},1e3)}catch(e){console.error("Recording error:",e),this.voiceCloneError.set(this.t("microphoneAccessDenied"))}}stopRecording(){this.mediaRecorder&&this.isRecording()&&(this.mediaRecorder.stop(),this.isRecording.set(!1),this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null))}async confirmAndUploadRecording(){let e=this.recordedAudioBlob(),t=this.voiceName().trim(),n=this.voicePromptText().trim();if(!t){this.voiceCloneError.set(this.t("voiceNameRequired"));return}if(!e){this.voiceCloneError.set(this.t("noRecordingToUpload"));return}let o=this.recordingTime();if(o<3){this.voiceCloneError.set(this.t("recordingTooShort"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0);try{let r=new FileReader;r.onprogress=c=>{c.lengthComputable&&this.voiceUploadProgress.set(Math.round(c.loaded/c.total*50))},r.onload=async()=>{let c=r.result.split(",")[1];this.ipcService.send("upload-voice-sample",{name:t,audioData:c,fileName:`${t}.webm`,fileType:"audio/webm",promptText:n,duration:o}),this.voiceUploadProgress.set(100);let m={id:Date.now().toString(),name:t,audioPath:`${t}.webm`,promptText:n,createdAt:new Date};this.clonedVoices.update(h=>[...h,m]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3),this.closeRecordingDialog()},r.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},r.readAsDataURL(e)}catch(r){this.voiceCloneError.set(r.message),this.isUploadingVoice.set(!1)}}resetRecording(){this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.recordingTime.set(0),this.voiceCloneError.set("")}loadAiSettings(){let e=localStorage.getItem("ai_api_key"),t=localStorage.getItem("ai_api_type"),n=localStorage.getItem("ai_custom_endpoint");e&&this.aiApiKey.set(e),t&&this.aiApiType.set(t),n&&this.customApiEndpoint.set(n);let o=localStorage.getItem("local_ai_endpoint"),r=localStorage.getItem("local_ai_model");o&&this.localAiEndpoint.set(o),r&&this.localAiModel.set(r);let c=localStorage.getItem("tts_endpoint"),m=localStorage.getItem("tts_enabled"),h=localStorage.getItem("tts_voice"),g=localStorage.getItem("stt_endpoint"),_=localStorage.getItem("stt_enabled");c&&this.ttsEndpoint.set(c),m&&this.ttsEnabled.set(m==="true"),h&&this.ttsVoice.set(h),g&&this.sttEndpoint.set(g),_&&this.sttEnabled.set(_==="true"),this.loadClonedVoicesFromStorage(),this.loadAiChatSettings()}isRegexValid(e){if(!e)return!0;try{return new RegExp(e),!0}catch{return!1}}getRegexError(e){if(!e)return null;try{return new RegExp(e),null}catch(t){return t.message}}getListenerAccounts(){return this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online")}getSenderAccounts(){return this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up"))}getOnlineAccountsCount(){return this.accounts().filter(e=>e.status==="Online").length}navigateToView(e){this.changeView(e)}navigateToAutomationTab(e){this.currentView.set("automation"),this.automationTab.set(e)}toggleKnowledgeMenu(){this.knowledgeMenuExpanded.set(!this.knowledgeMenuExpanded())}isKnowledgeView(){let e=this.currentView();return e==="knowledge-brain"||e==="knowledge-manage"||e==="knowledge-gaps"}leadsByStatus(e){return this.leadsByStatusMap().get(e)||[]}todayNewLeads(){let e=new Date;return e.setHours(0,0,0,0),this.leads().filter(t=>new Date(t.timestamp)>=e).length}getConversionRate(){let e=this.leads().length;return e===0?"0.0":(this.leadsByStatus("Closed-Won").length/e*100).toFixed(1)}getContactRate(){let e=this.leads().length;if(e===0)return"0.0";let t=this.leadsByStatus("New").length;return((e-t)/e*100).toFixed(1)}getReplyRate(){let e=this.leads().length-this.leadsByStatus("New").length;return e===0?"0.0":((this.leadsByStatus("Replied").length+this.leadsByStatus("Follow-up").length+this.leadsByStatus("Closed-Won").length+this.leadsByStatus("Closed-Lost").length)/e*100).toFixed(1)}loadFunnelStats(){this.ipcService.send("get-funnel-stats",{})}loadFunnelOverview(){this.isLoadingFunnel.set(!0),this.ipcService.send("get-funnel-overview",{})}loadUserJourney(e){e&&(this.isLoadingJourney.set(!0),this.selectedJourneyUserId.set(e),this.ipcService.send("get-user-journey",{userId:e}))}transitionFunnelStage(e,t,n){this.ipcService.send("transition-funnel-stage",{userId:e,stage:t,reason:n||"\u624B\u52D5\u8F49\u63DB"})}loadMarketingStats(){this.isLoadingMarketing.set(!0),this.ipcService.send("get-marketing-stats",{})}loadMarketingCampaigns(){this.ipcService.send("get-marketing-campaigns",{})}createMarketingCampaign(){if(!this.newMarketingCampaign.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}this.ipcService.send("create-marketing-campaign",{name:this.newMarketingCampaign.name,type:this.newMarketingCampaign.type,targetGroup:this.newMarketingCampaign.targetGroup,messageTemplate:this.newMarketingCampaign.messageTemplate})}startMarketingCampaign(e){this.ipcService.send("start-marketing-campaign",{campaignId:e})}loadWarmupDetails(e){this.ipcService.send("get-warmup-progress",{accountId:e})}loadAllWarmupDetails(){this.accounts().forEach(t=>{t.id&&this.loadWarmupDetails(t.id)})}toggleWarmup(e,t){this.ipcService.send("update-account",{id:e,warmupEnabled:t}),this.toastService.info(t?"\u5DF2\u555F\u7528\u9810\u71B1":"\u5DF2\u505C\u7528\u9810\u71B1")}getWarmupStageColor(e){return{1:"text-blue-400",2:"text-cyan-400",3:"text-yellow-400",4:"text-green-400"}[e]||"text-slate-400"}getWarmupStageIcon(e){return{1:"\u{1F507}",2:"\u{1F4AC}",3:"\u{1F4C8}",4:"\u2705"}[e]||"\u2753"}loadMigrationStatus(){this.isLoadingMigration.set(!0),this.ipcService.send("migration-status",{})}runMigration(e){this.isRunningMigration.set(!0),this.ipcService.send("migrate",{targetVersion:e})}rollbackMigration(e){confirm(`\u78BA\u5B9A\u8981\u56DE\u6EFE\u5230\u7248\u672C ${e} \u55CE\uFF1F\u9019\u53EF\u80FD\u6703\u5C0E\u81F4\u6578\u64DA\u4E1F\u5931\uFF01`)&&(this.isRunningMigration.set(!0),this.ipcService.send("rollback-migration",{targetVersion:e}))}loadSchedulerStatus(){this.ipcService.send("get-scheduler-status",{})}startScheduler(){this.ipcService.send("start-scheduler",{})}stopScheduler(){this.ipcService.send("stop-scheduler",{})}runSchedulerTask(e){this.ipcService.send("run-scheduler-task",{taskName:e})}updateSchedulerInterval(e,t){this.ipcService.send("update-scheduler-interval",{taskName:e,interval:t})}loadLogFiles(){this.isLoadingLogs.set(!0),this.ipcService.send("list-log-files",{})}loadLogStats(){this.ipcService.send("get-log-stats",{})}rotateLogs(){this.isRotatingLogs.set(!0),this.ipcService.send("rotate-logs",{})}viewLogFile(e){this.selectedLogFile.set(e),this.ipcService.send("read-log-file",{filename:e})}downloadLogFile(e){this.ipcService.send("download-log-file",{filename:e})}deleteLogFile(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u65E5\u8A8C\u6587\u4EF6 ${e} \u55CE\uFF1F`)&&this.ipcService.send("delete-log-file",{filename:e})}hasSelectedResources(){return this.selectedResourceIds().length>0}selectedResourceCount(){return this.selectedResourceIds().length}batchApproveResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"approved"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchRejectResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"rejected"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchSetResourcePriority(e){let t=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:t,priority:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchDeleteResources(){if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${this.selectedResourceCount()} \u500B\u8CC7\u6E90\u55CE\uFF1F`))return;let e=this.selectedResourceIds();this.ipcService.send("batch-delete-resources",{resourceIds:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}loadUsersWithProfiles(){this.ipcService.send("get-users-with-profiles",{stage:this.userFilterStage()||void 0,tags:this.userFilterTags()||void 0,search:this.userFilterSearch()||void 0,limit:50,offset:0})}toggleUserSelection(e){let t=this.selectedUserIds();t.includes(e)?this.selectedUserIds.set(t.filter(n=>n!==e)):this.selectedUserIds.set([...t,e])}selectAllUsers(){let e=this.usersWithProfiles().users.map(t=>t.user_id);this.selectedUserIds.set(e)}deselectAllUsers(){this.selectedUserIds.set([])}bulkUpdateTags(e,t){let n=this.selectedUserIds();if(n.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-tags",{userIds:n,tags:e,action:t})}bulkUpdateStage(e){let t=this.selectedUserIds();if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-stage",{userIds:t,stage:e})}getStageName(e){let t=this.funnelStages.find(n=>n.key===e);return t?t.name:e}getStageColor(e){let t=this.funnelStages.find(n=>n.key===e);return t?t.color:"bg-gray-500"}onDocumentClick(e){this.openResourceMenuId()!==null&&this.openResourceMenuId.set(null)}ngOnInit(){console.log("[App] ngOnInit called, coreDataLoaded:",this.coreDataLoaded()),console.log("[App] Current URL:",window.location.href),console.log("[App] Router URL:",this.router.url),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[App] Angular ready event dispatched")},100),this.translationService.setLanguage("zh"),this.loadAiSettings(),this.loadSidebarGroupsState(),this.setupVisibilityListener(),this.setupIpcListeners(),this.checkFirstRun(),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),this.loadCachedStateIfAvailable(),window.addEventListener("page-became-visible",()=>{console.log("[App] Page became visible, refreshing data..."),this.ipcService.send("get-initial-state")}),window.addEventListener("sync-offline-operations",(e=>{this.syncOfflineOperations(e.detail.operations)})),console.log("[App] Current URL:",window.location.href),this.ipcService.send("get-initial-state"),this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4),setTimeout(()=>{this.refreshQueueStatusThrottled()},2e3),this.watchViewChanges(),this.setupKeyboardShortcuts(),this.membershipUpdateHandler=e=>{console.log("[AppComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",e.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler),window.addEventListener("save-ai-settings",(e=>{let t=e.detail;console.log("[AppComponent] \u6536\u5230 AI \u8A2D\u7F6E\u4FDD\u5B58\u4E8B\u4EF6:",t),t.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(t.auto_chat_enabled===1),t.auto_chat_mode&&this.aiAutoChatMode.set(t.auto_chat_mode),t.auto_greeting!==void 0&&this.aiAutoGreeting.set(t.auto_greeting===1),this.ipcService.send("update-ai-chat-settings",{settings:t}),this.toastService.success("AI \u8A2D\u7F6E\u5DF2\u4FDD\u5B58",2e3)})),window.addEventListener("get-sender-accounts",(()=>{let t=this.accounts().filter(n=>n.role==="Sender"&&n.status==="Online").map(n=>({phone:n.phone,username:n.username||n.first_name||n.phone,avatar:n.avatar,sentToday:n.sentToday||n.dailySendCount||0,dailyLimit:n.dailySendLimit||50}));window.dispatchEvent(new CustomEvent("sender-accounts-loaded",{detail:t}))}))}checkFirstRun(){this.ipcService.send("check-first-run",{})}detectOllama(){this.isDetectingOllama.set(!0),this.ipcService.send("detect-ollama",{})}completeFirstRunSetup(){let e={aiConfig:{primaryProvider:this.ollamaDetected()?"local":"cloud",localAi:{provider:"ollama",endpoint:this.localAiEndpoint(),model:this.autoSelectedModel()||this.localAiModel(),autoDetect:!0},cloudAi:{enabled:!this.ollamaDetected(),provider:this.aiApiType(),apiKey:this.aiApiKey()},autoFallback:{enabled:this.aiAutoFallback(),fallbackProvider:this.aiBackupProvider()}},settings:{language:"zh",theme:this.theme(),firstRun:{completed:!0,completedAt:new Date().toISOString()}}};this.ipcService.send("save-first-run-settings",e),this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.success("\u{1F389} \u8A2D\u7F6E\u5B8C\u6210\uFF01\u6B61\u8FCE\u4F7F\u7528 TG-Matrix")}skipFirstRunSetup(){this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.info("\u60A8\u53EF\u4EE5\u7A0D\u5F8C\u5728\u8A2D\u7F6E\u4E2D\u914D\u7F6E AI")}watchViewChanges(){let e=null,t=()=>{let n=this.currentView();n!==e&&(e=n,n==="leads"?(this.loadFunnelStats(),this.loadUsersWithProfiles()):n==="resources"?(this.refreshResourceStats(),this.isInSearchResultMode()||this.loadResources(),this.loadDiscoveryKeywords()):n==="ai-center"&&this.refreshRagStats())};t(),this.viewCheckInterval=setInterval(t,2e3)}setupVisibilityListener(){this.visibilityChangeHandler=()=>{this.isPageVisible=!document.hidden,this.isPageVisible?(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u53EF\u898B\uFF0C\u6062\u5FA9\u5237\u65B0"),this.resumeRefreshIntervals()):(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u96B1\u85CF\uFF0C\u66AB\u505C\u5237\u65B0"),this.pauseRefreshIntervals())},document.addEventListener("visibilitychange",this.visibilityChangeHandler)}pauseRefreshIntervals(){this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0)}resumeRefreshIntervals(){if(!this.viewCheckInterval){let e="",t=()=>{let n=this.currentView();n!==e&&(e=n)};this.viewCheckInterval=setInterval(t,2e3)}this.queueRefreshInterval||(this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4))}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&e.key==="n"&&this.currentView()==="accounts"&&(e.preventDefault(),setTimeout(()=>{let t=document.querySelector('[name="phone"]');t&&t.focus()},100)),e.key==="Escape"&&(this.selectedQueuePhone()&&this.closeQueueDetails(),this.progressDialog().show&&this.progressDialog().cancellable&&this.progressDialog.set(N(F({},this.progressDialog()),{show:!1}))),!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement)&&(e.key==="1"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("dashboard")):e.key==="2"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("accounts")):e.key==="3"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("automation")):e.key==="4"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("leads")):e.key==="5"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("ads")):e.key==="6"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("campaigns")):e.key==="7"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.changeView("settings")))})}ngOnDestroy(){this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler),this.ipcService.cleanup("log-entry"),this.ipcService.cleanup("monitoring-status-changed"),this.ipcService.cleanup("monitoring-status-report"),this.ipcService.cleanup("monitoring-start-failed"),this.ipcService.cleanup("monitoring-config-check"),this.ipcService.cleanup("initial-state"),this.ipcService.cleanup("accounts-updated"),this.ipcService.cleanup("new-lead-captured"),this.ipcService.cleanup("queue-status"),this.ipcService.cleanup("queue-messages"),this.ipcService.cleanup("sending-stats"),this.ipcService.cleanup("queue-length-history"),this.ipcService.cleanup("account-sending-comparison"),this.ipcService.cleanup("campaign-performance-stats"),this.ipcService.cleanup("alert-triggered"),this.ipcService.cleanup("alerts-loaded"),this.ipcService.cleanup("account-validation-error"),this.ipcService.cleanup("keyword-set-validation-error"),this.ipcService.cleanup("keyword-validation-error"),this.ipcService.cleanup("group-validation-error"),this.ipcService.cleanup("group-membership-status"),this.ipcService.cleanup("group-join-result"),this.ipcService.cleanup("template-validation-error"),this.ipcService.cleanup("campaign-validation-error"),this.ipcService.cleanup("keyword-sets-updated"),this.ipcService.cleanup("groups-updated"),this.ipcService.cleanup("templates-updated"),this.ipcService.cleanup("campaigns-updated"),this.ipcService.cleanup("leads-updated"),this.ipcService.cleanup("funnel-stats"),this.ipcService.cleanup("users-with-profiles"),this.ipcService.cleanup("bulk-update-complete"),this.ipcService.cleanup("login-requires-code"),this.ipcService.cleanup("login-requires-2fa"),this.ipcService.cleanup("account-login-error"),this.ipcService.cleanup("session-files-cleaned"),this.ipcService.cleanup("session-files-cleanup-error"),this.ipcService.cleanup("session-import-result"),this.ipcService.cleanup("session-import-needs-credentials"),this.ipcService.cleanup("orphan-sessions-detected"),this.ipcService.cleanup("orphan-sessions-scanned"),this.ipcService.cleanup("orphan-sessions-recovered"),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0),this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.initialStateDebounceTimer&&(clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=void 0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),this.saveSettingsTimer&&(clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=null),this.queueStatusRefreshThrottleTimer&&(clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=void 0),this.chatListSearchDebounceTimer&&(clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=void 0),this.logFilterDebounceTimer&&(clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=void 0)}startConnectionTimeout(){setTimeout(()=>{this.backendConnectionState()==="connecting"&&(this.backendConnectionMessage.set("\u6B63\u5728\u9023\u63A5..."),this.backendConnectionProgress.set(50))},3e3)}hideConnectionIndicator(){setTimeout(()=>{this.backendConnectionState()},2e3)}async loadCachedStateIfAvailable(){try{let e=await this.offlineCache.loadCachedState();e&&this.offlineCache.isCacheValid()&&(console.log("[App] \u{1F680} Loading cached state for fast startup"),e.accounts?.length>0&&this.accounts.set(e.accounts),e.keywordSets?.length>0&&this.keywordSets.set(e.keywordSets),e.leads?.length>0&&this.leads.set(e.leads.map(t=>this.mapLeadFromBackend(t))),e.settings&&this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),console.log("[App] \u2705 Cached state applied, waiting for fresh data..."))}catch(e){console.warn("[App] Failed to load cached state:",e)}}async syncOfflineOperations(e){if(!this.offlineCache.isOnline()){console.log("[App] Still offline, skipping sync");return}console.log("[App] \u{1F504} Syncing",e.length,"offline operations");for(let t of e)try{this.ipcService.send(t.command,t.payload),await this.offlineCache.removeOperation(t.id),console.log("[App] \u2705 Synced operation:",t.command)}catch(n){console.error("[App] Failed to sync operation:",t.command,n)}e.length>0&&this.toastService.success(`\u2705 \u5DF2\u540C\u6B65 ${e.length} \u500B\u96E2\u7DDA\u64CD\u4F5C`)}retryConnection(){this.backendConnectionState.set("connecting"),this.backendConnectionMessage.set("\u6B63\u5728\u91CD\u65B0\u9023\u63A5..."),this.backendConnectionProgress.set(0),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),this.ipcService.send("get-initial-state")}setupIpcListeners(){this.ipcService.on("connection-confirmed",e=>{console.log("[Frontend] \u2705 Connection confirmed:",e),this.backendConnectionState.set("connected"),this.backendConnectionProgress.set(100),this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.hideConnectionIndicator()}),this.ipcService.on("connection-error",e=>{console.log("[Frontend] \u274C Connection error:",e),this.backendConnectionState()==="connecting"&&(this.backendConnectionState.set("error"),this.backendConnectionMessage.set(e.message||"\u9023\u63A5\u5931\u6557"))}),this.ipcService.on("connection-mode-changed",e=>{console.log("[Frontend] Connection mode changed:",e.mode),e.mode==="polling"?console.log("[Frontend] \u26A0\uFE0F Running in degraded mode (HTTP polling)"):e.mode==="websocket"&&console.log("[Frontend] \u2705 WebSocket connection restored")}),this.ipcService.on("loading-progress",e=>{console.log("[Frontend] Loading progress:",e),this.backendConnectionProgress.set(e.progress),this.backendConnectionMessage.set(e.message),e.step==="complete"&&(this.backendConnectionState.set("connected"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.hideConnectionIndicator())}),this.ipcService.on("log-entry",e=>{e.timestamp=new Date(e.timestamp),this.logs.update(t=>[e,...t].slice(0,100))}),this.ipcService.on("log-entries-batch",e=>{if(e.entries&&e.entries.length>0){let t=e.entries.map(n=>N(F({},n),{timestamp:new Date(n.timestamp)}));this.logs.update(n=>[...t.reverse(),...n].slice(0,100))}}),this.ipcService.on("monitoring-status-changed",e=>{this.isMonitoring.set(e),this.isStartingMonitoring.set(!1)}),this.ipcService.on("monitoring-start-failed",e=>{if(console.log("[Frontend] Monitoring start failed:",e),this.isStartingMonitoring.set(!1),e.reason==="config_check_failed"){let t=e.issues||[],n=e.warnings||[],o=t.some(r=>r.message?.includes("\u96E2\u7DDA")||r.message?.includes("offline")||r.code==="no_online_accounts");if(t.length>0){let r=t.map(c=>`\u2022 ${c.message}`).join(`
`);o?this.toastService.withActions("error",`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${r}`,[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],15e3):this.toastService.error(`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${r}`,1e4)}n.length>0&&setTimeout(()=>{let r=n.slice(0,3).map(c=>c.message).join("\uFF1B");this.toastService.warning(`\u26A0 \u5176\u4ED6\u554F\u984C\uFF1A${r}`,8e3)},1e3)}else if(e.reason==="no_online_listeners")this.toastService.withActions("error","\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u5728\u7DDA\u7684\u76E3\u807D\u8CEC\u6236",[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],1e4);else if(e.reason==="no_groups")this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",5e3);else if(e.reason==="no_accessible_groups"){let t=e.cannot_join_list||[];if(t.length>0){let n=t.map(o=>`\u2022 ${o.url}: ${o.reason||"\u672A\u77E5\u539F\u56E0"}`).join(`
`);this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002
${n}`,12e3)}else this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002\u8ACB\u78BA\u4FDD\u76E3\u63A7\u865F\u5DF2\u52A0\u5165\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",8e3)}else e.reason==="exception"?this.toastService.error(e.message||"\u555F\u52D5\u76E3\u63A7\u6642\u767C\u751F\u932F\u8AA4",8e3):this.toastService.error(e.message||"\u555F\u52D5\u76E3\u63A7\u5931\u6557",5e3)}),this.ipcService.on("monitoring-config-check",e=>{if(console.log("[Frontend] Monitoring config check:",e),this.lastConfigCheck.set(e),e.passed&&e.warnings.length>0){let t=e.warnings.slice(0,2);for(let n of t){let o=n.code||"";this.errorNavigationMap[o]?this.toastService.warningWithAction(`\u26A0 ${n.message}`,"\u53BB\u8A2D\u7F6E",()=>this.navigateToError(o)):this.toastService.warning(`\u26A0 ${n.message}
\u4FEE\u5FA9: ${n.fix}`,8e3)}e.summary.can_send_messages||setTimeout(()=>{this.toastService.warningWithAction("\u76E3\u63A7\u5C07\u904B\u884C\uFF0C\u4F46 Lead \u4E0D\u6703\u81EA\u52D5\u767C\u9001\u6D88\u606F\u3002","\u914D\u7F6E\u898F\u5247",()=>this.navigateToError("NO_CAMPAIGN"))},2e3)}}),this.ipcService.on("monitoring-status-report",e=>{if(console.log("[Frontend] Monitoring status report:",e),e.accessible_groups>0){let t=e.accessible_list.slice(0,3).map(o=>o.title||o.url).join(", "),n=e.accessible_groups>3?`\u7B49 ${e.accessible_groups} \u500B\u7FA4\u7D44`:"";this.toastService.success(`\u2713 \u53EF\u76E3\u63A7\u7FA4\u7D44: ${t}${n}`,4e3)}if(e.groups_needing_join>0){let t=e.needing_join_list.slice(0,2).map(o=>o.url).join(", "),n=e.groups_needing_join>2?`\u7B49 ${e.groups_needing_join} \u500B`:"";this.toastService.warning(`\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u7FA4\u7D44: ${t}${n}\u3002\u6B63\u5728\u5617\u8A66\u81EA\u52D5\u52A0\u5165...`,6e3)}e.accessible_groups===0&&e.groups_needing_join>0&&this.toastService.warning("\u76E3\u63A7\u865F\u5C1A\u672A\u52A0\u5165\u4EFB\u4F55\u76E3\u63A7\u7FA4\u7D44\u3002\u7CFB\u7D71\u5C07\u5617\u8A66\u81EA\u52D5\u52A0\u5165\u516C\u958B\u7FA4\u7D44\u3002",5e3)}),this.ipcService.on("template-already-exists",e=>{console.log("[Frontend] Template already exists:",e),this.toastService.warning(e.message||`\u6A21\u677F "${e.name}" \u5DF2\u5B58\u5728`,3e3)}),this.ipcService.on("accounts-updated",e=>{console.log("[Frontend] Received accounts-updated event:",e.length,"accounts");let t=this.accounts().length,n=this.accounts();this.accounts.set(e),e.forEach(o=>{let r=n.find(c=>c.id===o.id);if(r&&r.status!==o.status)if(console.log(`[Frontend] Account ${o.phone} status changed: ${r.status} -> ${o.status}`),o.status==="Online")this.toastService.success(`\u8D26\u6237 ${o.phone} \u767B\u5F55\u6210\u529F`),this.cancelLogin();else if(o.status==="Logging in...")this.toastService.info(`\u8D26\u6237 ${o.phone} \u6B63\u5728\u767B\u5F55...`);else if(o.status==="Waiting Code"){let c=this.loginState();c.accountId===o.id&&!c.requiresCode&&this.toastService.info(`\u8D26\u6237 ${o.phone} \u7B49\u5F85\u9A8C\u8BC1\u7801`)}else if(o.status==="Waiting 2FA"){let c=this.loginState();c.accountId===o.id&&!c.requires2FA&&(this.loginState.set({accountId:o.id,phone:o.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info(`\u8D26\u6237 ${o.phone} \u7B49\u5F85 2FA \u5BC6\u7801`))}else(o.status.includes("Error")||o.status==="Error")&&(this.toastService.error(`\u8D26\u6237 ${o.phone} \u767B\u5F55\u5931\u8D25`),this.cancelLogin())}),e.length>t&&this.toastService.success(`\u8D26\u6237\u5217\u8868\u5DF2\u66F4\u65B0\uFF08${e.length} \u4E2A\u8D26\u6237\uFF09`)}),this.ipcService.on("account-validation-error",e=>{console.error("Account validation error:",e);let t=Array.isArray(e.errors)?e.errors:[e.errors||"\u9A8C\u8BC1\u5931\u8D25"];if((e.error_type||"validation")==="duplicate"||t.some(c=>c.includes("\u5DF2\u5B58\u5728")||c.includes("already exists"))){this.validationErrors.set({account:t}),this.toastService.error(t.join("; "));return}this.accounts().length===0?(this.validationErrors.set({account:t}),this.toastService.error(`\u6DFB\u52A0\u8D26\u6237\u5931\u8D25: ${t.join("; ")}`)):console.warn("Validation error received but accounts already exist, ignoring:",t)}),this.ipcService.on("new-lead-captured",e=>{e.timestamp=new Date(e.timestamp),e.interactionHistory.forEach(t=>t.timestamp=new Date(t.timestamp)),this.leads.update(t=>[e,...t])}),this.ipcService.on("keyword-matched",e=>{console.log("[Frontend] Keyword matched event:",e),this.realtimeMatches.update(t=>[e,...t].slice(0,50)),this.todayStats.update(t=>N(F({},t),{matchCount:t.matchCount+1}))}),this.ipcService.on("lead-captured",e=>{console.log("[Frontend] Lead captured event received:",e),this.todayStats.update(n=>N(F({},n),{newLeads:n.newLeads+1})),this.showNotification("\u65B0\u6F5B\u5728\u5BA2\u6236\u5DF2\u6355\u7372",`@${e.username||e.firstName||"\u7528\u6236"} \u5DF2\u6355\u7372`,{requireInteraction:!0}),e.interactionHistory||(e.interactionHistory=[]),e.status||(e.status="New"),e.doNotContact===void 0&&(e.doNotContact=!1),e.timestamp=new Date(e.timestamp||new Date),e.interactionHistory&&e.interactionHistory.forEach(n=>n.timestamp=new Date(n.timestamp)),this.leads.update(n=>{let o=n.findIndex(r=>r.userId===e.userId);return o>=0?(n[o]=e,[...n]):[e,...n]});let t=e.username?`@${e.username}`:e.firstName||e.userId;this.toastService.success(`\u{1F3AF} ${this.t("newLeadCaptured")}: ${t}`,4e3)}),this.ipcService.on("session-files-cleaned",e=>{this.toastService.success(`\u6E05\u7406\u5B8C\u6210\uFF1A\u5220\u9664\u4E86 ${e.deleted_count} \u4E2A\u5B64\u7ACB\u6587\u4EF6\uFF0C\u4FDD\u7559\u4E86 ${e.kept_count} \u4E2A\u6709\u6548\u6587\u4EF6`),console.log("[Frontend] Session files cleaned:",e)}),this.ipcService.on("session-files-cleanup-error",e=>{this.toastService.error(`\u6E05\u7406\u5931\u8D25\uFF1A${e.error}`),console.error("[Frontend] Session files cleanup error:",e)}),this.ipcService.on("session-import-result",e=>{console.log("[Frontend] Session import result:",e),e.success?(this.toastService.success(e.phone?`\u2705 Session \u5C0E\u5165\u6210\u529F: ${e.phone}`:`\u2705 \u5C0E\u5165\u5B8C\u6210: ${e.count||1} \u500B\u5E33\u865F`,3e3),this.ipcService.send("get-initial-state")):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.message}`,4e3)}),this.ipcService.on("session-import-needs-credentials",e=>{console.log("[Frontend] Session import needs credentials:",e),this.toastService.warning(`\u26A0\uFE0F \u5C0E\u5165 ${e.phoneNumber} \u9700\u8981 API \u6191\u64DA`,4e3),this.toastService.info("\u8ACB\u5148\u5728\u300CAPI \u6191\u64DA\u6C60\u300D\u9801\u9762\u6DFB\u52A0 API \u6191\u64DA\uFF0C\u7136\u5F8C\u91CD\u8A66\u5C0E\u5165",5e3)}),this.ipcService.on("orphan-sessions-detected",e=>{console.log("[Frontend] Orphan sessions detected:",e),e.count>0&&(this.orphanSessions.set(e.sessions),this.showOrphanSessionDialog.set(!0),this.toastService.warning(`\u767C\u73FE ${e.count} \u500B\u9700\u8981\u624B\u52D5\u6062\u5FA9\u7684 Session \u6587\u4EF6`,5e3))}),this.ipcService.on("orphan-sessions-scanned",e=>{console.log("[Frontend] Orphan sessions scanned:",e),e.success&&e.orphan_sessions.length>0&&this.orphanSessions.set(e.orphan_sessions)}),this.ipcService.on("orphan-sessions-recovered",e=>{console.log("[Frontend] Orphan sessions recovered:",e),this.isRecoveringOrphanSessions.set(!1),e.success?(this.toastService.success(`\u6210\u529F\u6062\u5FA9 ${e.recovered_count} \u500B\u5E33\u865F`,3e3),this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([]),this.ipcService.send("get-accounts")):this.toastService.error(`\u6062\u5FA9\u5931\u6557: ${e.message}`,4e3)}),this.ipcService.on("keyword-set-validation-error",e=>{console.error("[Frontend] Keyword set validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${t}`)}),this.ipcService.on("keyword-set-error",e=>{if(console.log("[Frontend] Keyword set error event:",e),e.success)e.message&&this.toastService.success(e.message),this.newKeywordSet.set({name:""});else{let t=e.error||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";console.warn("[Frontend] Keyword set error:",t,e.details),t.includes("\u5DF2\u5B58\u5728")||t.includes("already exists")?this.toastService.warning("\u5173\u952E\u8BCD\u96C6\u5DF2\u5B58\u5728",3e3):t.includes("\u4E0D\u5B58\u5728")||t.includes("not found")?console.log("[Frontend] Keyword set already deleted, ignoring"):t.includes("\u6570\u636E\u5EAB")||t.includes("\u6570\u636E\u5E93")||t.includes("\u640D\u58DE")||t.includes("\u635F\u574F")?this.toastService.error(`\u6570\u636E\u5E93\u9519\u8BEF: ${t}\u3002\u8BF7\u4F7F\u7528 rebuild_database.py \u91CD\u5EFA\u6570\u636E\u5E93\u3002`,1e4):this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${t}`)}}),this.ipcService.on("keyword-validation-error",e=>{console.error("[Frontend] Keyword validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u9519\u8BEF: ${t}`)}),this.ipcService.on("group-validation-error",e=>{console.error("[Frontend] Group validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u7FA4\u7EC4\u5931\u8D25";this.toastService.error(`\u7FA4\u7EC4\u9519\u8BEF: ${t}`)}),this.ipcService.on("group-membership-status",e=>{console.log("[Frontend] Group membership status:",e),e.status.is_member?this.toastService.success(`\u2713 \u76E3\u63A7\u865F\u5DF2\u5728\u7FA4\u7D44\u4E2D: ${e.status.chat_title||e.url}`,3e3):e.status.can_join&&(e.status.is_private?this.toastService.warning("\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u624B\u52D5\u5C07\u76E3\u63A7\u865F\u52A0\u5165\u7FA4\u7D44",5e3):this.toastService.info("\u2139 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u7FA4\u7D44\uFF0C\u555F\u52D5\u76E3\u63A7\u6642\u5C07\u81EA\u52D5\u52A0\u5165",4e3))}),this.ipcService.on("group-join-result",e=>{console.log("[Frontend] Group join result:",e),e.success?e.alreadyMember?this.toastService.success(`${e.phone} \u5DF2\u7D93\u5728\u7FA4\u7D44 ${e.chatTitle||e.groupUrl} \u4E2D`,3e3):this.toastService.success(`${e.phone} \u6210\u529F\u52A0\u5165\u7FA4\u7D44 ${e.chatTitle||e.groupUrl}`,4e3):this.toastService.error(`\u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${e.error}`,5e3)}),this.ipcService.on("template-validation-error",e=>{console.error("[Frontend] Template validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u6A21\u677F\u5931\u8D25";this.toastService.error(`\u6A21\u677F\u9519\u8BEF: ${t}`)}),this.ipcService.on("campaign-validation-error",e=>{console.error("[Frontend] Campaign validation error:",e);let t=e.errors?.join("; ")||"\u521B\u5EFA\u6D3B\u52A8\u5931\u8D25";this.toastService.error(`\u6D3B\u52A8\u9519\u8BEF: ${t}`)}),this.ipcService.on("login-requires-code",e=>{console.log("[Frontend] Received login-requires-code event:",e),console.log("[Frontend] Current loginState before update:",this.loginState()),this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!1,canRetrySMS:e.canRetrySMS||!1,waitSeconds:e.waitSeconds}),console.log("[Frontend] Updated loginState:",this.loginState()),console.log("[Frontend] requiresCode value:",this.loginState().requiresCode),this.loginCode.set(""),e.message?e.sendType==="app"?this.toastService.info(e.message,8e3):this.toastService.info(e.message):e.sendType==="app"?this.toastService.info("\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230\u60A8\u7684 Telegram \u5E94\u7528\u3002\u8BF7\u68C0\u67E5\u60A8\u624B\u673A\u4E0A\u5DF2\u767B\u5F55\u7684 Telegram \u5E94\u7528\uFF0C\u67E5\u770B\u9A8C\u8BC1\u7801\u6D88\u606F\u3002",8e3):e.sendType==="sms"?this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${e.phone} \u7684\u77ED\u4FE1\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`):this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${e.phone}\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`)}),this.ipcService.on("login-requires-2fa",e=>{console.log("[Frontend] Received login-requires-2fa event:",e),this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info("\u8BF7\u8F93\u5165 2FA \u5BC6\u7801")}),this.ipcService.on("account-login-error",e=>{if(console.error("[Frontend] Account login error:",e),e.floodWait){let n=e.floodWait,o=Math.floor(n/3600),r=Math.floor(n%3600/60),c=n%60,m="";o>0?(m=`${o} \u5C0F\u65F6`,r>0&&(m+=` ${r} \u5206\u949F`)):r>0?(m=`${r} \u5206\u949F`,c>0&&(m+=` ${c} \u79D2`)):m=`${c} \u79D2`;let h=`\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7B49\u5F85 ${m} \u540E\u518D\u8BD5\u3002\u9A8C\u8BC1\u7801\u672A\u53D1\u9001\u3002`;this.toastService.error(h),console.error("FloodWait error:",{waitSeconds:n,timeStr:m})}else this.toastService.error(e.friendlyMessage||e.message);console.error("Login error details:",{accountId:e.accountId,phone:e.phone,status:e.status,message:e.message,codeExpired:e.codeExpired,floodWait:e.floodWait});let t=this.loginState();if(this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:t.requiresCode,requires2FA:t.requires2FA,phoneCodeHash:t.phoneCodeHash,isSubmittingCode:!1}),e.floodWait){this.cancelLogin();return}e.codeExpired?(this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set("")):e.message&&(e.message.includes("banned")||e.message.includes("invalid phone"))?this.cancelLogin():e.message&&e.message.includes("Invalid verification code")&&this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:t.phoneCodeHash,isSubmittingCode:!1})}),this.ipcService.on("account-status-updated",e=>{}),this.ipcService.on("initial-state-core",e=>{console.log("[Frontend] \u{1F680} Received initial-state-core (accounts + settings)"),e?.accounts&&(this.accounts.set(e.accounts),console.log("[Frontend] Accounts loaded:",e.accounts.length)),e?.settings&&(this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(e.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(e.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.settings.smartSendingEnabled??!0)),e?.isMonitoring!==void 0&&this.isMonitoring.set(e.isMonitoring),console.log("[App] Setting coreDataLoaded to true"),this.coreDataLoaded.set(!0),console.log("[App] coreDataLoaded is now:",this.coreDataLoaded())}),this.ipcService.on("initial-state-config",e=>{console.log("[Frontend] \u{1F4CB} Received initial-state-config"),e?.keywordSets&&this.keywordSets.set(e.keywordSets),e?.monitoredGroups&&this.monitoredGroups.set(e.monitoredGroups),e?.campaigns&&this.campaigns.set(e.campaigns),e?.messageTemplates&&this.messageTemplates.set(e.messageTemplates)}),this.ipcService.on("initial-state-data",e=>{if(console.log("[Frontend] \u{1F4CA} Received initial-state-data (leads + logs)"),console.log("[Frontend] leads count:",e?.leads?.length,"total:",e?.leadsTotal,"hasMore:",e?.leadsHasMore),e?.leads){let t=(e.leads||[]).map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.contactsService.importLeadsDirectly(t),console.log("[Frontend] Initial leads synced to resource center:",t.length)}e?.leadsTotal!==void 0&&this.leadsTotal.set(e.leadsTotal),e?.leadsHasMore!==void 0&&this.leadsHasMore.set(e.leadsHasMore),e?.leads&&e?.leadsTotal&&e.leads.length<e.leadsTotal&&(console.log("[Frontend] \u{1F504} Auto-loading remaining leads..."),this.leadsHasMore.set(!0),this.leadsLoading.set(!1),setTimeout(()=>this.loadRemainingLeads(),500)),e?.logs&&this.logs.set(e.logs)}),this.ipcService.on("initial-state",e=>{console.log("[Frontend] \u2605\u2605\u2605 Received initial-state event \u2605\u2605\u2605"),console.log("[Frontend] initial-state payload:",e),console.log("[Frontend] accounts in payload:",e?.accounts?.length||0);let t=Date.now();if(t-this.lastInitialStateTime<500){this.initialStateDebounceTimer&&clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=setTimeout(()=>{try{this.applyInitialState(e)}catch(n){console.error("[Frontend] Error applying initial state:",n)}finally{this.initialStateDebounceTimer=void 0}},500);return}this.lastInitialStateTime=t;try{this.applyInitialState(e)}catch(n){console.error("[Frontend] Error applying initial state:",n)}}),this.ipcService.on("keyword-sets-updated",e=>{typeof console<"u"&&console.log&&console.log("[Frontend] Received keyword-sets-updated:",e.keywordSets?.length||0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),e.keywordSets&&Array.isArray(e.keywordSets)?this.keywordSetsUpdateDebounceTimer=setTimeout(()=>{try{let t=new Set,n=e.keywordSets.filter(c=>!c||typeof c.id!="number"||t.has(c.id)?!1:(t.add(c.id),!0)).map(c=>{let m=Array.isArray(c.keywords)?c.keywords:[],h=new Set,g=m.filter(_=>{if(!_||typeof _.keyword!="string")return!1;let S=`${_.keyword}_${_.isRegex}`;return h.has(S)?!1:(h.add(S),!0)});return N(F({},c),{keywords:g})}),o=this.keywordSets();JSON.stringify(o)!==JSON.stringify(n)&&this.keywordSets.set(n)}catch(t){console.error("[Frontend] Error processing keyword-sets-updated:",t)}finally{this.keywordSetsUpdateDebounceTimer=void 0}},150):this.keywordSets().length>0&&this.keywordSets.set([])}),this.ipcService.on("keyword-validation-error",e=>{console.log("[Frontend] Keyword validation error:",e),e.errors&&e.errors.length>0&&(this.toastService.error(`\u95DC\u9375\u8A5E\u9A57\u8B49\u5931\u6557: ${e.errors.join(", ")}`,4e3),setTimeout(()=>{},1e3))}),this.ipcService.on("groups-updated",e=>{console.log("[Frontend] Received groups-updated:",e.monitoredGroups?.length||0),this.monitoredGroups.set(e.monitoredGroups||[])}),this.ipcService.on("templates-updated",e=>{console.log("[Frontend] Received templates-updated:",e.messageTemplates?.length||0),this.messageTemplates.set(e.messageTemplates||[])}),this.ipcService.on("campaigns-updated",e=>{console.log("[Frontend] Received campaigns-updated:",e.campaigns?.length||0),this.campaigns.set(e.campaigns||[]),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-already-exists",e=>{console.log("[Frontend] Campaign already exists:",e),this.toastService.warning(e.message||`\u6D3B\u52D5 "${e.name}" \u5DF2\u5B58\u5728`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-validation-error",e=>{console.log("[Frontend] Campaign validation error:",e),e.errors&&e.errors.length>0&&this.toastService.error(`\u6D3B\u52D5\u9A57\u8B49\u5931\u6557: ${e.errors.join(", ")}`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("search-leads-result",e=>{this.isSearchingLeads.set(!1),e.success&&e.results?(this.leadSearchResults.set(e.results),e.results.length===0&&this.toastService.info("\u672A\u627E\u5230\u5339\u914D\u7684\u6F5C\u5728\u5BA2\u6237")):(this.toastService.error(e.error||"\u641C\u7D22\u5931\u8D25"),this.leadSearchResults.set([]))}),this.ipcService.on("backup-created",e=>{this.isCreatingBackup.set(!1),e.success?(this.toastService.success("\u5907\u4EFD\u521B\u5EFA\u6210\u529F"),this.loadBackups()):this.toastService.error(e.error||"\u5907\u4EFD\u521B\u5EFA\u5931\u8D25")}),this.ipcService.on("backups-list",e=>{e.success&&e.backups&&this.backups.set(e.backups)}),this.ipcService.on("backup-restored",e=>{this.isRestoringBackup.set(!1),e.success?this.toastService.success("\u5907\u4EFD\u6062\u590D\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u9875\u9762"):this.toastService.error(e.error||"\u5907\u4EFD\u6062\u590D\u5931\u8D25")}),this.ipcService.on("backup-deleted",e=>{e.success?(this.toastService.success("\u5907\u4EFD\u5DF2\u5220\u9664"),this.loadBackups()):this.toastService.error(e.error||"\u5220\u9664\u5907\u4EFD\u5931\u8D25")}),this.ipcService.on("leads-updated",e=>{let t=e.total??e.leads?.length??0;console.log("[Frontend] Received leads-updated:",e.leads?.length||0,"total:",t);let n=(e.leads||[]).map(o=>this.mapLeadFromBackend(o));this.leads.set(n),this.leadsTotal.set(t),this.contactsService.importLeadsDirectly(n)}),this.ipcService.on("leads-paginated",e=>{if(console.log("[Frontend] Received leads-paginated:",e.leads?.length||0,"total:",e.total),this.leadsLoading.set(!1),e.leads&&e.leads.length>0){let t=e.leads.map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.leadsTotal.set(e.total),this.leadsHasMore.set(e.hasMore),this.contactsService.importLeadsDirectly(t),console.log("[Frontend] \u2705 Synced to resource center:",t.length,"leads"),e.hasMore||this.toastService.success(`\u6578\u64DA\u52A0\u8F09\u5B8C\u6210\uFF1A\u5171 ${t.length} \u689D`)}}),this.ipcService.on("funnel-stats",e=>{console.log("[Frontend] Received funnel-stats:",e),e.error||this.funnelStats.set(e)}),this.ipcService.on("funnel-overview",e=>{this.isLoadingFunnel.set(!1),e.success&&this.funnelOverview.set({stages:e.stages||[],totalLeads:e.total_leads||0,convertedLeads:e.converted_leads||0,averageConversionDays:e.average_days||0,conversionRate:e.conversion_rate||0})}),this.ipcService.on("user-journey",e=>{this.isLoadingJourney.set(!1),e.success&&e.journey&&this.userJourneyData.set({userId:e.userId,stages:e.journey.transitions||[],currentStage:e.journey.current_stage||"new",totalDays:e.journey.total_days||0,isConverted:e.journey.is_converted||!1})}),this.ipcService.on("funnel-stage-transitioned",e=>{e.success?(this.toastService.success(`\u2705 \u6F0F\u6597\u968E\u6BB5\u5DF2\u66F4\u65B0: ${e.stage}`),this.loadFunnelOverview(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("marketing-stats",e=>{this.isLoadingMarketing.set(!1),e.success!==!1&&this.marketingStats.set({totalCampaigns:e.total_campaigns||0,running:e.running||0,completed:e.completed||0,totalMessages:e.total_messages||0,totalInvites:e.total_invites||0,successRate:e.success_rate||0})}),this.ipcService.on("marketing-campaigns",e=>{e.success&&e.campaigns&&this.marketingCampaigns.set(e.campaigns)}),this.ipcService.on("campaign-created",e=>{e.success?(this.toastService.success("\u2705 \u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.showCreateCampaignDialog.set(!1),this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""},this.loadMarketingCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}),this.ipcService.on("campaign-started",e=>{e.success&&(this.toastService.info("\u{1F680} \u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadMarketingCampaigns())}),this.ipcService.on("campaign-complete",e=>{e.success&&(this.toastService.success(`\u2705 \u6D3B\u52D5\u5B8C\u6210\uFF01\u6210\u529F: ${e.stats?.success||0}, \u5931\u6557: ${e.stats?.failed||0}`),this.loadMarketingStats(),this.loadMarketingCampaigns())}),this.ipcService.on("warmup-progress",e=>{e.success&&e.accountId&&this.warmupDetails.update(t=>N(F({},t),{[e.accountId]:{enabled:e.enabled||!1,startDate:e.start_date||null,stage:e.stage?.stage||0,stageName:e.stage?.stage_name||"",daysCompleted:e.days_completed||0,totalDays:e.total_days||14,progressPercent:e.progress_percentage||0,dailyLimit:e.stage?.daily_limit||0,allowedActions:e.stage?.allowed_actions||[]}}))}),this.ipcService.on("migration-status",e=>{this.isLoadingMigration.set(!1),e.error||this.migrationStatus.set({currentVersion:e.current_version||0,latestVersion:e.latest_version||0,appliedCount:e.applied_count||0,pendingCount:e.pending_count||0,appliedMigrations:e.applied_migrations||[],pendingMigrations:e.pending_migrations||[]})}),this.ipcService.on("migration-completed",e=>{this.isRunningMigration.set(!1),e.error?this.toastService.error(`\u9077\u79FB\u5931\u6557: ${e.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u9077\u79FB\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("rollback-completed",e=>{this.isRunningMigration.set(!1),e.error?this.toastService.error(`\u56DE\u6EFE\u5931\u6557: ${e.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u56DE\u6EFE\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("scheduler-status",e=>{e.success!==!1&&this.schedulerStatus.set({isRunning:e.is_running||!1,tasks:e.tasks||[]})}),this.ipcService.on("scheduler-started",e=>{e.success&&(this.toastService.success("\u2705 \u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-stopped",e=>{e.success&&(this.toastService.info("\u8ABF\u5EA6\u5668\u5DF2\u505C\u6B62"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-task-result",e=>{e.success?this.toastService.success(`\u2705 \u4EFB\u52D9 ${e.taskName} \u57F7\u884C\u5B8C\u6210`):this.toastService.error(`\u4EFB\u52D9\u57F7\u884C\u5931\u6557: ${e.error}`),this.loadSchedulerStatus()}),this.ipcService.on("log-files",e=>{this.isLoadingLogs.set(!1),e.files&&this.logFiles.set(e.files.map(t=>({name:t.name,size:t.size,sizeFormatted:this.formatFileSize(t.size),modifiedAt:t.modified_at,isCompressed:t.name.endsWith(".gz")})))}),this.ipcService.on("log-stats",e=>{e.error||this.logStats.set({totalFiles:e.total_files||0,totalSize:e.total_size||0,totalSizeFormatted:this.formatFileSize(e.total_size||0),compressedFiles:e.compressed_files||0,oldestFile:e.oldest_file,newestFile:e.newest_file})}),this.ipcService.on("logs-rotated",e=>{this.isRotatingLogs.set(!1),e.success?(this.toastService.success(`\u2705 \u65E5\u8A8C\u8F2A\u8F49\u5B8C\u6210\uFF0C\u8F2A\u8F49\u4E86 ${e.rotated_count||0} \u500B\u6587\u4EF6`),this.loadLogFiles(),this.loadLogStats()):this.toastService.error(`\u65E5\u8A8C\u8F2A\u8F49\u5931\u6557: ${e.error}`)}),this.ipcService.on("log-file-content",e=>{e.content&&this.logFileContent.set(e.content)}),this.ipcService.on("log-file-deleted",e=>{e.success&&(this.toastService.success("\u2705 \u65E5\u8A8C\u6587\u4EF6\u5DF2\u522A\u9664"),this.loadLogFiles(),this.loadLogStats())}),this.ipcService.on("resources-batch-updated",e=>{e.success&&(this.toastService.success(`\u2705 \u5DF2\u66F4\u65B0 ${e.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-batch-deleted",e=>{e.success&&(this.toastService.success(`\u2705 \u5DF2\u522A\u9664 ${e.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-cleared",e=>{e.success?(this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u6E05\u7A7A\u6240\u6709\u8CC7\u6E90\uFF0C\u5171 ${e.deletedCount||0} \u689D`),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7A7A\u5931\u6557: ${e.error}`)}),this.ipcService.on("clear-resources-complete",e=>{e.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF0C\u5DF2\u522A\u9664 ${e.deleted_count||0} \u689D\u8A18\u9304`),this.discoveredResources.set([]),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("users-with-profiles",e=>{console.log("[Frontend] Received users-with-profiles:",e.users?.length||0),e.error||this.usersWithProfiles.set(e)}),this.ipcService.on("one-click-start-progress",e=>{console.log("[Frontend] One-click progress:",e),this.oneClickProgress.set(e.progress),this.oneClickMessage.set(e.message)}),this.ipcService.on("group-join-progress",e=>{let t=`\u{1F465} \u6B63\u5728\u6AA2\u67E5\u7FA4\u7D44 ${e.current}/${e.total}...`;this.oneClickMessage.set(t);let n=42+e.current/e.total*6;this.oneClickProgress.set(Math.round(n))}),this.ipcService.on("group-join-complete",e=>{console.log("[Frontend] Group join complete:",e);let t=e.skipped_cached?` (${e.skipped_cached} \u500B\u7DE9\u5B58\u547D\u4E2D)`:"";this.oneClickMessage.set(`\u2705 \u7FA4\u7D44\u52A0\u5165\u5B8C\u6210: ${e.success_count}/${e.total} \u6210\u529F${t}`)}),this.ipcService.on("one-click-start-result",e=>{console.log("[Frontend] One-click result:",e),this.oneClickStarting.set(!1),this.oneClickStartReport.set(e),this.showStartReport.set(!0),e.overall_success?this.toastService.success("\u{1F389} \u4E00\u9375\u555F\u52D5\u6210\u529F\uFF01\u7CFB\u7D71\u5DF2\u5C31\u7DD2",5e3):this.toastService.warning("\u26A0\uFE0F \u90E8\u5206\u529F\u80FD\u555F\u52D5\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u65E5\u8A8C",5e3),this.loadSystemStatus()}),this.ipcService.on("one-click-stop-result",e=>{console.log("[Frontend] One-click stop result:",e),e.success&&this.toastService.info("\u{1F6D1} \u6240\u6709\u670D\u52D9\u5DF2\u505C\u6B62",3e3),this.loadSystemStatus()}),this.ipcService.on("system-status",e=>{console.log("[Frontend] System status:",e),e.error||this.systemStatus.set(e)}),this.ipcService.on("trigger-rules-result",e=>{e.success&&setTimeout(()=>this.loadSystemStatus(),100)}),this.ipcService.on("ai-settings-updated",e=>{console.log("[Frontend] AI settings updated:",e),e.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(e.auto_chat_enabled),e.auto_chat_mode&&this.aiAutoChatMode.set(e.auto_chat_mode)}),this.ipcService.on("bulk-update-complete",e=>{console.log("[Frontend] Bulk update complete:",e),e.success?(this.toastService.success(`\u5DF2\u66F4\u65B0 ${e.count} \u500B\u7528\u6236`),this.selectedUserIds.set([]),this.loadUsersWithProfiles(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("settings-updated",e=>{e&&(this.spintaxEnabled.set(e.spintaxEnabled??!0),this.autoReplyEnabled.set(e.autoReplyEnabled??!1),this.autoReplyMessage.set(e.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.smartSendingEnabled??!0))}),this.ipcService.on("queue-status",e=>{if(typeof e=="object"&&"phone"in e){let h=e;this.queueStatuses.update(g=>N(F({},g),{[h.phone]:h}))}else{let h=e;this.queueStatuses.set(h)}let t=Object.values(this.queueStatuses()),n=t.reduce((h,g)=>h+(g.pending||0),0),o=t.reduce((h,g)=>h+(g.processing||0),0),r=t.reduce((h,g)=>h+(g.stats?.completed||0),0),c=t.reduce((h,g)=>h+(g.failed||0),0),m=r+c;this.queueStats.set({pending:n,sending:o,sent:r,failed:c,retrying:t.reduce((h,g)=>h+(g.retrying||0),0),totalToday:m,successRate:m>0?r/m:0,avgSendTime:t.reduce((h,g)=>h+(g.stats?.avg_time||0),0)/(t.length||1)})}),this.ipcService.on("queue-messages",e=>{this.queueMessages.set(e.messages)}),this.ipcService.on("sending-stats",e=>{let t={labels:e.stats.map(n=>n.date),datasets:[{label:"\u6210\u529F\u53D1\u9001",data:e.stats.map(n=>n.successful||0),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5931\u8D25",data:e.stats.map(n=>n.failed||0),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0}]};this.sendingStatsData.set(t)}),this.ipcService.on("queue-length-history",e=>{let t={labels:e.history.map(n=>n.date),datasets:[{label:"\u961F\u5217\u957F\u5EA6",data:e.history.map(n=>n.queue_length||0),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]};this.queueLengthHistoryData.set(t)}),this.ipcService.on("account-sending-comparison",e=>{let t={labels:e.comparison.map(n=>n.phone),datasets:[{label:"\u603B\u53D1\u9001",data:e.comparison.map(n=>n.total_sent||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u6210\u529F",data:e.comparison.map(n=>n.successful||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5931\u8D25",data:e.comparison.map(n=>n.failed||0),backgroundColor:"rgba(239, 68, 68, 0.8)"}]};this.accountComparisonData.set(t)}),this.ipcService.on("campaign-performance-stats",e=>{let t={labels:e.stats.map(n=>n.campaign_name||"Unknown"),datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:e.stats.map(n=>n.leads_captured||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u5DF2\u8054\u7CFB",data:e.stats.map(n=>n.leads_contacted||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5DF2\u56DE\u590D",data:e.stats.map(n=>n.leads_replied||0),backgroundColor:"rgba(168, 85, 247, 0.8)"}]};this.campaignPerformanceData.set(t)}),this.ipcService.on("ai-greeting-suggestion",e=>{console.log("[AI] Received greeting suggestion:",e),this.aiGreetingSuggestion.set(e),this.showAiGreetingDialog.set(!0),this.toastService.info(`\u{1F916} AI \u5DF2\u70BA @${e.username||e.firstName} \u751F\u6210\u554F\u5019\u5EFA\u8B70`,5e3)}),this.ipcService.on("alert-triggered",e=>{e.timestamp=new Date(e.timestamp).toISOString(),this.alerts.update(t=>t.some(o=>o.alert_type===e.alert_type&&o.message===e.message&&Math.abs(new Date(o.timestamp).getTime()-new Date(e.timestamp).getTime())<6e4)?t:[e,...t].slice(0,100)),this.showBrowserNotification(e),this.showNotification(`\u544A\u8B66: ${e.level.toUpperCase()}`,e.message,{requireInteraction:e.level==="critical"})}),this.ipcService.on("alert-rules-loaded",e=>{e.success&&e.rules&&this.alertRules.set(e.rules)}),this.ipcService.on("alert-rule-updated",e=>{e.success?(this.toastService.success("\u544A\u8B66\u89C4\u5219\u5DF2\u66F4\u65B0"),this.loadAlertRules()):this.toastService.error(e.error||"\u66F4\u65B0\u5931\u8D25")}),this.ipcService.on("alert-history-loaded",e=>{e.success&&e.history&&this.alertHistory.set(e.history)}),this.ipcService.on("alerts-loaded",e=>{this.alerts.set(e.alerts)}),this.ipcService.on("rag-initialized",e=>{this.isInitializingRag.set(!1),e.success?(this.ragSystemInitialized.set(!0),this.toastService.success("\u2705 RAG \u7CFB\u7D71\u521D\u59CB\u5316\u5B8C\u6210"),this.refreshRagStats()):this.toastService.error(`RAG \u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-stats",e=>{if(e.success&&e.rag){let t=e.rag,n=t.by_type||{},o=0,r=0;for(let c of Object.keys(n))(c.toLowerCase().includes("qa")||c.toLowerCase().includes("\u554F\u7B54"))&&(o+=n[c].count||0),(c.toLowerCase().includes("script")||c.toLowerCase().includes("\u8A71\u8853"))&&(r+=n[c].count||0);this.ragStats.set({total_knowledge:t.total_knowledge||0,qa_count:o,scripts_count:r,total_uses:t.total_uses||0,avg_score:t.avg_score||0,chromadb_enabled:t.chromadb_enabled||!1,neural_embedding:t.neural_embedding||!1,by_type:n}),t.total_knowledge>0&&this.ragSystemInitialized.set(!0)}}),this.ipcService.on("rag-search-result",e=>{this.isSearchingRag.set(!1),e.success&&e.results?this.ragSearchResults.set(e.results):e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-learning-triggered",e=>{this.isRagLearning.set(!1),e.success?(this.toastService.success(`\u{1F393} \u5B78\u7FD2\u5B8C\u6210\uFF01\u8655\u7406 ${e.conversationsProcessed||0} \u500B\u5C0D\u8A71\uFF0C\u63D0\u53D6 ${e.knowledgeExtracted||0} \u689D\u77E5\u8B58`),this.refreshRagStats()):this.toastService.error(`\u5B78\u7FD2\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-reindex-complete",e=>{this.isReindexing.set(!1),e.success?(this.toastService.success(`\u{1F504} \u91CD\u65B0\u7D22\u5F15\u5B8C\u6210\uFF01\u8655\u7406 ${e.conversations_processed||0} \u500B\u5C0D\u8A71`),this.refreshRagStats()):this.toastService.error(`\u91CD\u65B0\u7D22\u5F15\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-cleanup-complete",e=>{this.isCleaningRag.set(!1),e.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664 ${e.deleted||0} \u689D\uFF0C\u5408\u4F75 ${e.merged||0} \u689D`),this.refreshRagStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-knowledge-added",e=>{e.success?(this.toastService.success("\u2705 \u77E5\u8B58\u5DF2\u6DFB\u52A0"),this.refreshRagStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-feedback-recorded",e=>{e.success||this.toastService.error(`\u53CD\u994B\u8A18\u9304\u5931\u6557: ${e.error}`)}),this.ipcService.on("memories-searched",e=>{this.isSearchingMemory.set(!1),e.success&&e.memories?this.vectorMemorySearchResults.set(e.memories.map(t=>({id:t.id,userId:t.user_id,content:t.content,memoryType:t.memory_type,importance:t.importance,similarity:t.similarity||0,createdAt:t.created_at}))):e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("memory-added",e=>{this.isAddingMemory.set(!1),e.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u6DFB\u52A0"),this.newMemory={userId:"",content:"",type:"conversation",importance:.5},this.showAddMemoryDialog.set(!1),this.refreshMemoryStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("memory-stats",e=>{e.success&&this.vectorMemoryStats.set({totalMemories:e.totalMemories||0,byType:e.byType||{},totalUsers:e.totalUsers||0,avgImportance:e.avgImportance||0})}),this.ipcService.on("memory-user-list",e=>{e.success&&e.users&&this.memoryUserList.set(e.users)}),this.ipcService.on("memory-deleted",e=>{e.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u522A\u9664"),this.vectorMemorySearchResults.update(t=>t.filter(n=>n.id!==e.memoryId)),this.refreshMemoryStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("memories-merged",e=>{e.success?(this.toastService.success(`\u2705 \u5408\u4F75\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${e.mergedCount||0} \u689D\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u5408\u4F75\u5931\u6557: ${e.error}`)}),this.ipcService.on("old-memories-cleaned",e=>{e.success?(this.toastService.success(`\u2705 \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664\u4E86 ${e.deletedCount||0} \u689D\u820A\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("batch-operation-result",e=>{this.handleBatchOperationResult(e)}),this.ipcService.on("batch-operation-progress",e=>{this.handleBatchOperationProgress(e)}),this.ipcService.on("batch-undo-result",e=>{this.handleBatchUndoResult(e)}),this.ipcService.on("batch-operation-history",e=>{this.handleBatchOperationHistory(e)}),this.ipcService.on("all-tags",e=>{this.handleAllTags(e)}),this.ipcService.on("tag-created",e=>{this.handleTagCreated(e)}),this.ipcService.on("tag-deleted",e=>{this.handleTagDeleted(e)}),this.ipcService.on("ad-templates",e=>{this.handleAdTemplates(e)}),this.ipcService.on("ad-schedules",e=>{this.handleAdSchedules(e)}),this.ipcService.on("ad-send-logs",e=>{this.handleAdSendLogs(e)}),this.ipcService.on("ad-overview-stats",e=>{this.handleAdOverviewStats(e)}),this.ipcService.on("ad-template-created",e=>{this.handleAdTemplateCreated(e)}),this.ipcService.on("ad-template-deleted",e=>{this.handleAdTemplateDeleted(e)}),this.ipcService.on("ad-template-toggled",e=>{e.success&&this.loadAdTemplates()}),this.ipcService.on("ad-schedule-created",e=>{this.handleAdScheduleCreated(e)}),this.ipcService.on("ad-schedule-deleted",e=>{this.handleAdScheduleDeleted(e)}),this.ipcService.on("ad-schedule-toggled",e=>{e.success&&this.loadAdSchedules()}),this.ipcService.on("ad-schedule-run-result",e=>{this.handleAdScheduleRunResult(e)}),this.ipcService.on("spintax-validated",e=>{this.handleSpintaxValidated(e)}),this.ipcService.on("ad-sent",e=>{this.toastService.success(`\u5EE3\u544A\u5DF2\u767C\u9001\u5230 ${e.groupTitle||e.groupId}`)}),this.ipcService.on("ad-send-failed",e=>{this.toastService.error(`\u767C\u9001\u5931\u6557: ${e.error}`)}),this.ipcService.on("broadcast-progress",e=>{this.progressDialog.set({show:!0,title:"\u5EE3\u544A\u767C\u9001\u4E2D...",progress:{current:e.current,total:e.total,message:`\u5DF2\u767C\u9001 ${e.sent}\uFF0C\u5931\u6557 ${e.failed}`},cancellable:!1})}),this.ipcService.on("broadcast-completed",e=>{this.progressDialog.update(t=>N(F({},t),{show:!1})),this.toastService.success(`\u5EE3\u544A\u767C\u9001\u5B8C\u6210: ${e.sent} \u6210\u529F, ${e.failed} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()}),this.ipcService.on("tracked-users",e=>{this.handleTrackedUsers(e)}),this.ipcService.on("user-groups",e=>{this.handleUserGroups(e)}),this.ipcService.on("high-value-groups",e=>{this.handleHighValueGroups(e)}),this.ipcService.on("tracking-stats",e=>{this.handleTrackingStats(e)}),this.ipcService.on("user-added-to-track",e=>{this.handleUserAddedToTrack(e)}),this.ipcService.on("user-added-from-lead",e=>{e.success?this.toastService.success("Lead \u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("user-removed",e=>{this.handleUserRemoved(e)}),this.ipcService.on("user-tracking-started",e=>{this.isTrackingUser.set(!0)}),this.ipcService.on("user-tracking-completed",e=>{this.handleUserTrackingCompleted(e)}),this.ipcService.on("user-tracking-failed",e=>{this.handleUserTrackingFailed(e)}),this.ipcService.on("user-value-updated",e=>{e.success&&this.loadTrackedUsers()}),this.ipcService.on("batch-tracking-progress",e=>{this.progressDialog.set({show:!0,title:"\u6279\u91CF\u8FFD\u8E64\u4E2D...",progress:{current:e.current,total:e.total,message:`\u6B63\u5728\u8FFD\u8E64\u7528\u6236 ${e.userId}`},cancellable:!1})}),this.ipcService.on("batch-tracking-completed",e=>{this.progressDialog.update(t=>N(F({},t),{show:!1})),this.toastService.success(`\u6279\u91CF\u8FFD\u8E64\u5B8C\u6210: ${e.completed} \u6210\u529F, ${e.failed} \u5931\u6557`),this.loadTrackedUsers(),this.loadTrackingStats()}),this.ipcService.on("campaigns",e=>{this.handleCampaigns(e)}),this.ipcService.on("campaign-created",e=>{this.handleCampaignCreated(e)}),this.ipcService.on("campaign-deleted",e=>{this.handleCampaignDeleted(e)}),this.ipcService.on("campaign-started",e=>{e.success!==!1&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadCampaigns())}),this.ipcService.on("campaign-paused",e=>{e.success&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u66AB\u505C"),this.loadCampaigns())}),this.ipcService.on("campaign-stopped",e=>{e.success!==!1&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u505C\u6B62"),this.loadCampaigns())}),this.ipcService.on("campaign-completed",e=>{this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u57F7\u884C\u5B8C\u6210"),this.loadCampaigns(),this.loadUnifiedOverview()}),this.ipcService.on("campaign-step-started",e=>{this.progressDialog.set({show:!0,title:"\u57F7\u884C\u71DF\u92B7\u6D3B\u52D5...",progress:{current:0,total:0,message:`\u57F7\u884C\u6B65\u9A5F: ${e.actionType}`},cancellable:!1})}),this.ipcService.on("campaign-step-completed",e=>{this.progressDialog.update(t=>N(F({},t),{show:!1}))}),this.ipcService.on("unified-overview",e=>{this.handleUnifiedOverview(e)}),this.ipcService.on("funnel-analysis",e=>{this.handleFunnelAnalysis(e)}),this.ipcService.on("role-templates",e=>{this.handleRoleTemplates(e)}),this.ipcService.on("all-roles",e=>{this.handleAllRoles(e)}),this.ipcService.on("role-assigned",e=>{e.success?(this.toastService.success("\u89D2\u8272\u5DF2\u5206\u914D"),this.loadAllRoles(),this.loadRoleStats()):this.toastService.error(`\u5206\u914D\u5931\u6557: ${e.error}`)}),this.ipcService.on("role-removed",e=>{e.success&&(this.toastService.success("\u89D2\u8272\u5DF2\u79FB\u9664"),this.loadAllRoles(),this.loadRoleStats())}),this.ipcService.on("role-stats",e=>{this.handleRoleStats(e)}),this.ipcService.on("script-templates",e=>{this.handleScriptTemplates(e)}),this.ipcService.on("collab-groups",e=>{this.handleCollabGroups(e)}),this.ipcService.on("collab-stats",e=>{this.handleCollabStats(e)}),this.ipcService.on("collab-group-created",e=>{e.success!==!1&&(this.toastService.success("\u5354\u4F5C\u7FA4\u7D44\u5DF2\u5275\u5EFA"),this.loadCollabGroups())}),this.ipcService.on("resource-discovery-initialized",e=>{if(e.success){if(this.resourceDiscoveryInitialized.set(!0),this.toastService.success("\u2705 \u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71\u5DF2\u521D\u59CB\u5316"),this.refreshResourceStats(),this.loadDiscoveryKeywords(),this.pendingSearchQuery){let t=this.pendingSearchQuery;this.pendingSearchQuery="",this.toastService.info(`\u6B63\u5728\u641C\u7D22 "${t}"...`),setTimeout(()=>this.searchResources(),500)}}else this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-results-direct",e=>{if(this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),e.success&&e.results){let t=e.results,n=e.query?.toLowerCase()||"",o=t.sort((m,h)=>{let g=(m.title||"").toLowerCase(),_=(h.title||"").toLowerCase(),S=g.includes(n)?1:0,y=_.includes(n)?1:0;return S!==y?y-S:(h.overall_score||0)-(m.overall_score||0)}),r=new Set,c=o.filter(m=>r.has(m.telegram_id)?!1:(r.add(m.telegram_id),!0));if(this.discoveredResources.set(c),this.currentSearchKeyword.set(n),c.length>0){let m=this.generateSearchCacheKey(e.query||"",this.selectedSearchSources());this.setSearchCache(m,c)}c.length===0?console.log(`[Search] \u672A\u627E\u5230\u8207\u300C${e.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`):console.log(`[Search] \u627E\u5230 ${c.length} \u500B\u8207\u300C${e.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`)}else e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-resources-complete",e=>{this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),e.success?(e.found===0?console.log("[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C"):console.log(`[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u627E\u5230 ${e.found} \u4E2A`),this.refreshResourceStats()):this.toastService.error(`\u641C\u7D22\u5931\u8D25: ${e.error}`)}),this.ipcService.on("search-jiso-complete",e=>{if(e.success&&e.results){let n=e.results.length;if(n===0)console.log("[Search] \u6781\u641C\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C");else{let o=e.cached?"\uFF08\u7F13\u5B58\uFF09":"",r=e.bot?`\uFF08\u4F86\u81EA @${e.bot}\uFF09`:"";console.log(`[Search] \u6781\u641C\u5B8C\u6210${o}\uFF1A\u627E\u5230 ${n} \u4E2A\u7FA4\u7EC4${r}`);let c=this.discoveredResources(),m=new Set(c.map(g=>g.telegram_id||g.username)),h=e.results.filter(g=>!m.has(g.telegram_id)&&!m.has(g.username)).map(g=>{let _=g.username||"";_&&_.toLowerCase().endsWith("bot")&&(_="");let S=g.link||"";return S&&/t\.me\/[^/]+\/\d+/.test(S)&&(S=""),{id:0,telegram_id:g.telegram_id&&/^-?\d+$/.test(String(g.telegram_id))?String(g.telegram_id):"",username:_,title:g.title||"",description:g.description||"",member_count:g.member_count||0,resource_type:g.chat_type||g.resource_type||"group",activity_score:.5,relevance_score:.6,overall_score:.6,status:"discovered",discovery_source:"jiso",discovery_keyword:this.currentSearchKeyword(),created_at:new Date().toISOString(),invite_link:S,link:S||(_?`https://t.me/${_}`:""),is_saved:!1,can_join:!!(S||_)}});if(h.length>0){let g=[...c,...h];this.discoveredResources.set(g),console.log(`[Search] \u5DF2\u5408\u4F75 ${h.length} \u500B\u65B0\u7D50\u679C`);let _=this.currentSearchKeyword();if(_&&g.length>0){let S=this.generateSearchCacheKey(_,this.selectedSearchSources());this.setSearchCache(S,g)}}}this.refreshResourceStats()}else if(e.error){let n=e.error,o=[],r="";n.includes("Username not found")||n.includes("\u4E0D\u53EF\u7528")?(o=["\u641C\u7D22\u6A5F\u5668\u4EBA\u9996\u6B21\u4F7F\u7528\u9700\u8981\u6FC0\u6D3B","\u8ACB\u5728 Telegram \u4E2D\u6253\u958B @smss \u4E26\u767C\u9001 /start","\u6216\u8005\u6253\u958B @jisou3 \u4E26\u767C\u9001 /start","\u6FC0\u6D3B\u5F8C\u91CD\u65B0\u641C\u7D22"],r="\u641C\u7D22\u6A5F\u5668\u4EBA\u5C1A\u672A\u6FC0\u6D3B"):n.includes("FloodWait")||n.includes("\u9650\u5236")?(o=["\u7B49\u5F85\u5E7E\u5206\u9418\u5F8C\u91CD\u8A66","\u6E1B\u5C11\u641C\u7D22\u983B\u7387","\u4F7F\u7528\u5176\u4ED6\u5E33\u865F\u641C\u7D22"],r="Telegram \u8ACB\u6C42\u983B\u7387\u9650\u5236"):n.includes("\u6CA1\u6709\u53EF\u7528")?(o=["\u6AA2\u67E5\u5E33\u865F\u662F\u5426\u5DF2\u767B\u9304","\u78BA\u4FDD\u81F3\u5C11\u6709\u4E00\u500B\u5E33\u865F\u5728\u7DDA"],r="\u6C92\u6709\u53EF\u7528\u5E33\u865F"):o=["\u91CD\u8A66\u641C\u7D22","\u4F7F\u7528\u4E0D\u540C\u95DC\u9375\u8A5E"],this.searchError.set({hasError:!0,message:n,details:r,suggestions:o}),this.toastService.error(`\u6781\u641C\u5931\u6557: ${r||n}`)}let t=this.selectedSearchSources();t.length===1&&t[0]==="jiso"&&(this.isSearchingResources.set(!1),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null))}),this.ipcService.on("jiso-search-progress",e=>{e.status==="searching"?console.log(`[Search] \u6781\u641C\uFF1A${e.message}`):e.status==="waiting"&&console.log(`[Search] \u6781\u641C\u7B49\u5F85\uFF1A${e.message}`)}),this.ipcService.on("search-channels-list",e=>{e.success&&(this.systemChannels.set(e.system_channels||[]),this.customChannels.set(e.custom_channels||[]))}),this.ipcService.on("search-channel-added",e=>{e.success?(this.toastService.success(`\u2705 \u5DF2\u6DFB\u52A0\u6E20\u9053 @${e.botUsername}`),this.showAddChannelDialog.set(!1),this.loadSearchChannels()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-updated",e=>{e.success?(this.toastService.success("\u2705 \u6E20\u9053\u5DF2\u66F4\u65B0"),this.loadSearchChannels()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-deleted",e=>{e.success?(this.toastService.success("\u{1F5D1}\uFE0F \u6E20\u9053\u5DF2\u522A\u9664"),this.loadSearchChannels()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-tested",e=>{this.isTestingChannel.set(!1),e.success?(this.toastService.success(`\u2705 @${e.botUsername} \u6E2C\u8A66\u6210\u529F (${e.responseTime?.toFixed(1)}s)`),this.loadSearchChannels()):(this.toastService.warning(`\u274C @${e.botUsername} \u6E2C\u8A66\u5931\u6557: ${e.error}`),this.loadSearchChannels())}),this.ipcService.on("resources-list",e=>{if(this.isInSearchResultMode()){console.log("[\u8CC7\u6E90\u4E2D\u5FC3] \u5FFD\u7565 resources-list\uFF0C\u7576\u524D\u8655\u65BC\u641C\u7D22\u7D50\u679C\u6A21\u5F0F");return}if(e.success&&e.resources){this.discoveredResources.set(e.resources);let t=e.resources.filter(n=>!n.type_verified&&n.username);if(t.length>0){let o=t.slice(0,10).map(r=>r.id);this.ipcService.send("batch-verify-resource-types",{resourceIds:o})}}}),this.ipcService.on("resource-stats",e=>{e.success&&(this.resourceStats.set({total_resources:e.total_resources||0,by_status:e.by_status||{},by_type:e.by_type||{},today_discovered:e.today_discovered||0,pending_joins:e.pending_joins||0,joined_count:e.joined_count||0,avg_score:e.avg_score||0}),e.total_resources&&e.total_resources>0&&this.resourceDiscoveryInitialized.set(!0))}),this.ipcService.on("resource-added",e=>{e.success?(this.toastService.success("\u2705 \u8CC7\u6E90\u5DF2\u6DFB\u52A0"),this.showAddResourceDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("resource-type-verified",e=>{e.success?(e.oldType!==e.newType?this.toastService.success(`\u2705 \u985E\u578B\u5DF2\u66F4\u65B0: ${e.oldType} \u2192 ${e.newType}`):this.toastService.info(`\u{1F4CB} \u985E\u578B\u78BA\u8A8D: ${e.newType}`),this.loadResources()):this.toastService.error(`\u9A57\u8B49\u5931\u6557: ${e.error}`)}),this.ipcService.on("resources-types-verified",e=>{e.success&&e.count&&e.count>0&&this.loadResources()}),this.ipcService.on("resource-deleted",e=>{e.success?(this.toastService.success("\u{1F5D1}\uFE0F \u8CC7\u6E90\u5DF2\u522A\u9664"),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("leave-group-complete",e=>{e.success?(this.toastService.success("\u{1F6AA} \u5DF2\u9000\u51FA\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):this.toastService.error(`\u9000\u51FA\u7FA4\u7D44\u5931\u6557: ${e.error}`)}),this.ipcService.on("remove-group-result",e=>{e.success?(this.toastService.success("\u2705 \u5DF2\u505C\u6B62\u76E3\u63A7\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):(this.toastService.error(`\u505C\u6B62\u76E3\u63A7\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`),this.loadResources())}),this.ipcService.on("join-queue-updated",e=>{e.success?(this.toastService.success(`\u{1F4CB} \u5DF2\u6DFB\u52A0 ${e.added} \u500B\u8CC7\u6E90\u5230\u52A0\u5165\u968A\u5217`),this.refreshResourceStats(),this.selectedResourceIds.set([])):this.toastService.error(`\u6DFB\u52A0\u5230\u968A\u5217\u5931\u6557: ${e.error}`)}),this.ipcService.on("join-queue-processed",e=>{this.isProcessingJoinQueue.set(!1),e.success?(this.toastService.success(`\u{1F680} \u8655\u7406\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}`),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u8655\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("batch-join-started",e=>{e.success&&this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${e.count} \u500B\u8CC7\u6E90`)}),this.ipcService.on("batch-join-complete",e=>{e.success&&(this.toastService.success(`\u2705 \u6279\u91CF\u52A0\u5165\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}\uFF0C\u8DF3\u904E ${e.skipped}`),this.loadResources(),this.refreshResourceStats())}),this.ipcService.on("join-and-monitor-complete",e=>{this.isJoiningResource.set(!1),e.success?(this.toastService.success("\u2705 \u5DF2\u52A0\u5165\u4E26\u6DFB\u52A0\u5230\u76E3\u63A7"),this.showJoinMonitorDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u52A0\u5165\u5931\u6557: ${e.error}`)}),this.ipcService.on("join-and-monitor-with-account-complete",e=>{if(this.isJoiningResource.set(!1),e.success){let t=this.joinMonitorSelectedKeywordSetIds().length,n=this.joinMonitorResource(),o=e.status==="pending_approval"?"pending_approval":"joined";this.updateResourceStatusLocally(n,o,e.phone,e.memberCount),e.status==="pending_approval"?(this.toastService.info(`\u{1F4E8} \u52A0\u5165\u8ACB\u6C42\u5DF2\u767C\u9001\uFF0C\u7B49\u5F85\u7BA1\u7406\u54E1\u6279\u51C6
\u5E33\u865F: ${e.phone}`,5e3),this.showJoinMonitorDialog.set(!1)):this.showPostJoinOptions(n,e.phone,t),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")}else{let t=e.error||"\u672A\u77E5\u932F\u8AA4";t.includes("\u7F3A\u5C11\u52A0\u5165\u65B9\u5F0F")||t.includes("username")?this.toastService.error(`\u274C \u7121\u6CD5\u52A0\u5165\uFF1A\u6B64\u7FA4\u7D44\u6C92\u6709\u63D0\u4F9B\u6709\u6548\u7684\u52A0\u5165\u93C8\u63A5
\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5`,6e3):this.toastService.error(`\u274C \u52A0\u5165\u5931\u6557: ${t}`,5e3)}}),this.ipcService.on("batch-join-and-monitor-complete",e=>{if(this.isJoiningResource.set(!1),this.closeBatchJoinMonitorDialog(),e.success){let t=this.joinMonitorSelectedKeywordSetIds().length,n=t>0?`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}\uFF0C\u5DF2\u7D81\u5B9A ${t} \u500B\u95DC\u9375\u8A5E\u96C6`:`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}`;this.toastService.success(n),this.loadResources(),this.refreshResourceStats(),this.selectedResourceIds.set([]),this.ipcService.send("get-monitored-groups")}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${e.error}`)}),this.ipcService.on("members-extraction-progress",e=>{this.memberListProgress.set({extracted:e.extracted,total:e.total,status:e.status})}),this.ipcService.on("members-extracted",e=>{if(this.memberListLoading.set(!1),e.success&&e.members){let t=new Set(this.memberListData().map(o=>o.user_id)),n=e.members.filter(o=>!t.has(o.user_id));this.memberListData.update(o=>[...o,...n]),this.memberListProgress.update(o=>N(F({},o),{extracted:this.memberListData().length,status:`\u5DF2\u63D0\u53D6 ${this.memberListData().length} \u500B\u6210\u54E1`})),n.length>0?this.calculateAndShowExtractionSummary(n):this.toastService.info("\u6C92\u6709\u66F4\u591A\u65B0\u6210\u54E1")}else e.error&&this.handleMemberExtractionError(e)}),this.ipcService.on("batch-members-extracted",e=>{e.success?this.toastService.success(`\u2705 \u6279\u91CF\u63D0\u53D6\u5B8C\u6210\uFF1A${e.totalGroups} \u500B\u7FA4\u7D44\uFF0C\u5171 ${e.totalMembers} \u500B\u6210\u54E1`):this.toastService.error(`\u6279\u91CF\u63D0\u53D6\u5931\u6557: ${e.error}`)}),this.ipcService.on("group-message-sent",e=>{e.success?this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001\u5230\u7FA4\u7D44"):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("message-queued",e=>{console.log("[Frontend] Message queued:",e),this.toastService.info("\u{1F4E4} \u6D88\u606F\u5DF2\u52A0\u5165\u767C\u9001\u968A\u5217")}),this.ipcService.on("message-sent",e=>{console.log("[Frontend] Message sent result:",e),e.success?(this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001"),this.closeLeadDetailModal(),this.ipcService.send("get-leads",{})):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("link-analysis-complete",e=>{this.isAnalyzingLink.set(!1),e.success?e.isPrivate?this.toastService.warning(e.message||"\u9019\u662F\u79C1\u6709\u93C8\u63A5"):(this.toastService.success("\u2705 \u5206\u6790\u5B8C\u6210"),console.log("Link analysis result:",e)):this.toastService.error(`\u5206\u6790\u5931\u6557: ${e.error}`)}),this.ipcService.on("ollama-models",e=>{e.success&&e.models?(this.availableOllamaModels.set(e.models),this.toastService.success(`\u627E\u5230 ${e.models.length} \u500B\u6A21\u578B`)):e.error&&this.toastService.error(`\u7372\u53D6\u6A21\u578B\u5217\u8868\u5931\u6557: ${e.error}`)}),this.ipcService.on("local-ai-test-result",e=>{this.isTestingLocalAi.set(!1),e.success?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success(e.message||"\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(e.error||"\u9023\u63A5\u5931\u6557"),this.toastService.error(e.error||"\u9023\u63A5\u5931\u6557"))}),this.ipcService.on("first-run-status",e=>{this.isFirstRun.set(e.isFirstRun),e.isFirstRun&&(console.log("[App] \u9996\u6B21\u904B\u884C\uFF0C\u5F8C\u53F0\u975C\u9ED8\u914D\u7F6E AI\uFF08\u4E0D\u5F37\u5236\u986F\u793A\u5411\u5C0E\uFF09"),setTimeout(()=>this.detectOllama(),1e3))}),this.ipcService.on("backend-status",e=>{console.log("[App] Backend status:",e),this.backendRunning.set(e.running),!e.running&&e.error&&(this.backendError.set(e.error),this.showBackendErrorDialog.set(!0),this.toastService.error("\u274C Python \u5F8C\u7AEF\u672A\u904B\u884C\uFF0C\u90E8\u5206\u529F\u80FD\u7121\u6CD5\u4F7F\u7528"))}),this.ipcService.on("ollama-detected",e=>{if(this.isDetectingOllama.set(!1),e.success&&(this.ollamaDetected.set(e.available||!1),e.models&&e.models.length>0)){this.detectedOllamaModels.set(e.models);let n=["qwen2:7b","qwen:7b","llama3:8b","mistral:7b"].find(o=>e.models.some(r=>r.includes(o.split(":")[0])))||e.models[0];this.autoSelectedModel.set(n),this.localAiModel.set(n)}}),this.ipcService.on("first-run-settings-saved",e=>{e.success?console.log("[App] \u9996\u6B21\u8A2D\u7F6E\u5DF2\u4FDD\u5B58"):console.error("[App] \u9996\u6B21\u8A2D\u7F6E\u4FDD\u5B58\u5931\u6557:",e.error)}),this.ipcService.on("discovery-keywords",e=>{e.success&&e.keywords&&this.discoveryKeywords.set(e.keywords)}),this.ipcService.on("discovery-keyword-added",e=>{e.success?(this.toastService.success(`\u2795 \u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0: ${e.keyword}`),this.showAddKeywordDialog.set(!1),this.newResourceKeyword="",this.loadDiscoveryKeywords()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-watcher-initialized",e=>{e.success?(this.discussionWatcherInitialized.set(!0),this.toastService.success("\u2705 \u8A0E\u8AD6\u7D44\u76E3\u63A7\u670D\u52D9\u5DF2\u521D\u59CB\u5316"),this.loadChannelDiscussions(),this.refreshDiscussionStats()):this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-discovered",e=>{e.success&&e.discussion?(this.toastService.success(`\u2705 \u767C\u73FE\u8A0E\u8AD6\u7D44: ${e.discussion.discussion_title}`),this.loadChannelDiscussions()):this.toastService.error(e.error||"\u672A\u627E\u5230\u8A0E\u8AD6\u7D44")}),this.ipcService.on("discussions-batch-discovered",e=>{e.success?(this.toastService.success(`\u2705 \u767C\u73FE\u4E86 ${e.count} \u500B\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u767C\u73FE\u5931\u6557: ${e.error}`)}),this.ipcService.on("channel-discussions-list",e=>{e.success&&e.discussions&&this.channelDiscussions.set(e.discussions)}),this.ipcService.on("discussion-monitoring-status",e=>{e.success?(this.toastService.success(`${e.status==="monitoring"?"\u{1F7E2} \u958B\u59CB":"\u{1F534} \u505C\u6B62"}\u76E3\u63A7\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u64CD\u4F5C\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-messages",e=>{this.isLoadingDiscussionMessages.set(!1),e.success&&e.messages?this.discussionMessages.set(e.messages):(this.toastService.error(e.error||"\u52A0\u8F7D\u6D88\u606F\u5931\u8D25"),this.discussionMessages.set([]))}),this.ipcService.on("discussion-message",e=>{e.is_matched&&this.toastService.info(`\u{1F3AF} \u95DC\u9375\u8A5E\u5339\u914D: @${e.username} - ${e.keywords.join(", ")}`)}),this.ipcService.on("discussion-lead-captured",e=>{this.toastService.success(`\u{1F464} \u65B0\u6F5B\u5728\u5BA2\u6236: @${e.username}`),this.refreshDiscussionStats()}),this.ipcService.on("discussion-reply-result",e=>{e.success?(this.toastService.success("\u2705 \u56DE\u5FA9\u5DF2\u767C\u9001"),this.selectedDiscussionId()&&this.loadDiscussionMessages(this.selectedDiscussionId())):this.toastService.error(`\u56DE\u5FA9\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-stats",e=>{e.success&&(this.discussionStats.set({total_discussions:e.total_discussions||0,monitoring_count:e.monitoring_count||0,total_messages:e.total_messages||0,matched_messages:e.matched_messages||0,leads_from_discussions:e.leads_from_discussions||0,today_messages:e.today_messages||0,today_leads:e.today_leads||0}),e.total_discussions>0&&this.discussionWatcherInitialized.set(!0))}),this.ipcService.on("chat-list",e=>{e.success&&e.chats?this.chatList.set(e.chats):console.error("[Frontend] Chat list error:",e.error)}),this.ipcService.on("chat-history-full",e=>{if(console.log("[Frontend] Received chat-history-full event:",e),e.success&&e.messages){let t=this.chatHistoryPage();if(t===0)this.chatHistoryAllMessages.set(e.messages),this.chatHistory.set(e.messages),console.log("[Frontend] Loaded first page:",e.messages.length,"messages");else{let o=[...this.chatHistoryAllMessages(),...e.messages];this.chatHistoryAllMessages.set(o),this.chatHistory.set(o),console.log("[Frontend] Loaded page",t,":",e.messages.length,"messages, total:",o.length)}this.chatHistoryHasMore.set(e.hasMore||!1),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1),console.log("[Frontend] Chat history loaded. Has more:",e.hasMore,"Total:",e.total)}else console.error("[Frontend] Chat history error:",e.error),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}),this.ipcService.on("chat-message-received",e=>{this.selectedChatUserId()===e.userId&&this.loadChatHistory(e.userId),this.loadChatList()}),this.ipcService.on("ai-response-generated",e=>{this.selectedChatUserId()===e.userId&&this.loadChatHistory(e.userId)}),this.ipcService.on("monitoring-status",e=>{e.success&&console.log("[Frontend] Monitoring status:",e)}),this.ipcService.on("monitoring-health",e=>{e.success&&(e.issues&&e.issues.length>0&&console.warn("[Frontend] Monitoring issues:",e.issues),e.warnings&&e.warnings.length>0&&console.warn("[Frontend] Monitoring warnings:",e.warnings))}),this.ipcService.on("alerts-loaded",e=>{let t=e.alerts.map(n=>N(F({},n),{timestamp:new Date(n.timestamp).toISOString(),acknowledged_at:n.acknowledged_at?new Date(n.acknowledged_at).toISOString():void 0,resolved_at:n.resolved_at?new Date(n.resolved_at).toISOString():void 0}));this.alerts.set(t)})}applyInitialState(e){console.log("Received initial state from backend:",e),this.backendConnectionState.set("connected"),this.backendConnectionProgress.set(100),this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.accounts.set(e.accounts||[]),this.keywordSets.set(e.keywordSets||[]),this.monitoredGroups.set(e.monitoredGroups||[]),this.campaigns.set(e.campaigns||[]),this.messageTemplates.set(e.messageTemplates||[]),e.isMonitoring!==void 0&&this.isMonitoring.set(e.isMonitoring);let t=(e.leads||[]).map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.leadsTotal.set(e.leadsTotal??e.leads?.length??0),this.contactsService.importLeadsDirectly(t),this.logs.set((e.logs||[]).map(n=>N(F({},n),{timestamp:new Date(n.timestamp)}))),e.settings&&(this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(e.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(e.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.settings.smartSendingEnabled??!0)),this.offlineCache.cacheState({accounts:e.accounts||[],keywordSets:e.keywordSets||[],monitoredGroups:e.monitoredGroups||[],campaigns:e.campaigns||[],leads:e.leads||[],settings:e.settings||{}})}setLanguage(e){this.translationService.setLanguage(e)}changeView(e){if(e==="ads"&&!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="multi-role"&&!this.membershipService.hasFeature("multiRole")){this.toastService.warning("\u{1F48E} \u591A\u89D2\u8272\u5354\u4F5C\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="user-tracking"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u7528\u6236\u8FFD\u8E64\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="campaigns"&&!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-team"&&!this.membershipService.hasFeature("autoExecution")){this.toastService.warning("\u{1F48E} AI\u5718\u968A\u92B7\u552E\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-assistant"&&!this.membershipService.hasFeature("strategyPlanning")){this.toastService.warning("\u{1F48E} AI\u7B56\u7565\u898F\u5283\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u6D1E\u5BDF\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics-center"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5206\u6790\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="lead-nurturing"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u5BA2\u6236\u57F9\u80B2\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="nurturing-analytics"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u57F9\u80B2\u5206\u6790\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(this.navBridge.navigateTo(e),this.currentView.set(e),e==="resources"){let t=this.leads();t.length>0&&(this.syncLeadsToResourceCenter(t),console.log("[changeView] Synced leads to resource center:",t.length))}}switchDashboardMode(e){if(e==="smart"&&!this.membershipService.hasFeature("smartMode")){this.toastService.warning("\u{1F947} \u667A\u80FD\u6A21\u5F0F\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.dashboardMode.set(e)}handleDashboardNavigation(e){let n={"monitoring-accounts":"monitoring-accounts","monitoring-groups":"monitoring-groups","keyword-sets":"keyword-sets","chat-templates":"chat-templates","trigger-rules":"trigger-rules","collected-users":"collected-users","automation-rules":"trigger-rules",resources:"resources",rules:"trigger-rules","send-settings":"leads",analytics:"analytics"}[e];n&&this.changeView(n)}handleDashboardConfigAction(e){this.handleDashboardNavigation(e)}checkBatchOperationPermission(){return this.membershipService.hasFeature("batchOperations")?!0:(this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),!1)}addAccount(){let e=this.membershipService.canAddAccount(this.accounts().length);if(!e.allowed){this.toastService.warning(e.message||"\u5DF2\u9054\u5230\u8CEC\u6236\u6578\u91CF\u4E0A\u9650"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newAccount();this.validationErrors.set({});let n=[],o=t.phone.trim().replace(/[\s\-\(\)]/g,"");if(o?/^\+\d{1,15}$/.test(o)||n.push("Phone number must be in format +1234567890 (with country code)"):n.push("Phone number is required"),t.apiId&&!/^\d+$/.test(t.apiId.trim())&&n.push("API ID must be a positive integer"),t.apiHash&&!/^[a-fA-F0-9]{32}$/.test(t.apiHash.trim())&&n.push("API Hash must be a 32-character hexadecimal string"),t.proxy&&!/^(socks5|http|https):\/\/([^:]+(:[^@]+)?@)?[^:]+(:\d+)?$/.test(t.proxy.trim())&&n.push("Proxy must be in format: socks5://host:port or http://host:port"),n.length>0){this.validationErrors.set({account:n}),this.toastService.error(`\u9A8C\u8BC1\u5931\u8D25: ${n.join("; ")}`),console.error("Account validation errors:",n);return}let c={phone:t.phone.trim().replace(/[\s\-\(\)]/g,""),apiId:t.apiId.trim(),apiHash:t.apiHash.trim(),proxy:t.proxy.trim()||"",group:t.group.trim()||"",twoFactorPassword:t.twoFactorPassword.trim()||"",role:"Unassigned",enableWarmup:t.enableWarmup||!1};console.log("Sending add-account command:",c),this.ipcService.send("add-account",c),this.newAccount.set({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""}),this.toastService.info("\u6B63\u5728\u6DFB\u52A0\u8D26\u6237\uFF0C\u8BF7\u7A0D\u5019...")}onAccountAdded(e){console.log("[Frontend] Account added from add-account page:",e),this.toastService.success("\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01"),this.changeView("accounts")}goToAddAccount(){this.changeView("add-account")}loginAccount(e){console.log("[Frontend] loginAccount called with accountId:",e);let t=this.accounts().find(n=>n.id===e);if(!t){console.error("[Frontend] Account not found:",e),this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}console.log("[Frontend] Found account:",t.phone,"Status:",t.status),this.toastService.info("\u6B63\u5728\u767B\u5F55\u8D26\u6237..."),this.loginState.set({accountId:e,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set(""),console.log("[Frontend] Sending login-account command to IPC"),this.ipcService.send("login-account",e)}logoutAccount(e){let t=this.accounts().find(n=>n.id===e);if(!t){this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}confirm(`\u786E\u5B9A\u8981\u9000\u51FA\u8D26\u6237 ${t.phone} \u5417\uFF1F`)&&(this.toastService.info("\u6B63\u5728\u9000\u51FA\u8D26\u6237..."),this.ipcService.send("logout-account",e),this.ipcService.once("logout-account-result",n=>{n.success?this.toastService.success(`\u8D26\u6237 ${t.phone} \u5DF2\u9000\u51FA`):this.toastService.error(`\u9000\u51FA\u5931\u8D25: ${n.error||"\u672A\u77E5\u9519\u8BEF"}`)}))}editAccount(e){this.toastService.info(`\u7DE8\u8F2F\u5E33\u6236: ${e.phone}`)}submitLoginCode(){let e=this.loginState();!e.accountId||!e.phoneCodeHash||!this.loginCode().trim()||(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!0}),this.toastService.info("\u6B63\u5728\u9A8C\u8BC1\u9A8C\u8BC1\u7801..."),this.ipcService.send("login-account",{accountId:e.accountId,phoneCode:this.loginCode().trim(),phoneCodeHash:e.phoneCodeHash}),this.loginCode.set(""))}submitLogin2FA(){let e=this.loginState();!e.accountId||!this.login2FAPassword().trim()||(this.ipcService.send("login-account",{accountId:e.accountId,twoFactorPassword:this.login2FAPassword().trim()}),this.login2FAPassword.set(""))}cancelLogin(){this.loginState.set({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set("")}resendVerificationCode(){let e=this.loginState();e.accountId&&(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.toastService.info("\u6B63\u5728\u91CD\u65B0\u53D1\u9001\u9A8C\u8BC1\u7801\u5230\u60A8\u7684 Telegram \u5E94\u7528...",5e3),this.ipcService.send("login-account",e.accountId))}checkAccountStatus(e){this.ipcService.send("check-account-status",e)}navigateToError(e){let t=this.errorNavigationMap[e];if(!t){console.log("[Frontend] No navigation defined for error:",e);return}this.changeView(t.view),setTimeout(()=>{if(t.elementId){let n=document.getElementById(t.elementId);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("highlight-pulse"),setTimeout(()=>{n.classList.remove("highlight-pulse")},3e3))}t.action&&t.action()},300),this.toastService.info("\u5DF2\u8DF3\u8F49\u5230\u76F8\u95DC\u8A2D\u7F6E\u5340\u57DF",2e3)}startMonitoring(){if(this.isStartingMonitoring()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u76E3\u63A7\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.listenerAccounts();if(e.length===0){let n=this.accounts().filter(o=>o.role==="Listener");if(n.length>0){let o=n.filter(r=>r.status!=="Online");o.length>0?this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6709 ${n.length} \u500B\u76E3\u807D\u8CEC\u6236\uFF0C\u4F46\u6C92\u6709\u5728\u7DDA\u7684\u8CEC\u6236\u3002

\u8ACB\u5148\u767B\u9304\u4EE5\u4E0B\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA\uFF1A
`+o.map(r=>`- ${r.phone} (${r.status})`).join(`
`),8e3):this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u7570\u5E38\uFF0C\u8ACB\u6AA2\u67E5\u8CEC\u6236\u72C0\u614B\u3002",5e3)}else this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u807D\u8CEC\u6236\u3002

\u8ACB\u5148\uFF1A
1. \u5728"\u8CEC\u6236\u7BA1\u7406"\u4E2D\u6DFB\u52A0\u8CEC\u6236
2. \u5C07\u8CEC\u6236\u89D2\u8272\u8A2D\u7F6E\u70BA"\u76E3\u807D"
3. \u767B\u9304\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA`,6e3);return}if(this.monitoredGroups().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44\u3002",4e3);return}if(this.keywordSets().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u95DC\u9375\u8A5E\u96C6\u3002\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u96C6\u3002",4e3);return}if(e.filter(n=>n.status==="Online").length===0){this.toastService.warning("\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u4E0D\u7A69\u5B9A\uFF0C\u8ACB\u7B49\u5F85\u8CEC\u6236\u5B8C\u5168\u4E0A\u7DDA\u5F8C\u518D\u8A66\u3002",4e3);return}this.isStartingMonitoring.set(!0),this.ipcService.send("start-monitoring"),setTimeout(()=>{this.isStartingMonitoring.set(!1)},5e3)}stopMonitoring(){this.ipcService.send("stop-monitoring")}oneClickStart(){if(this.oneClickStarting()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.accounts().length;if(e===0){this.toastService.error("\u274C \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55\u5E33\u865F\uFF0C\u8ACB\u5148\u6DFB\u52A0\u5E33\u865F",4e3);return}this.oneClickStarting.set(!0),this.oneClickProgress.set(0),this.oneClickMessage.set(`\u{1F680} \u958B\u59CB\u555F\u52D5 (${e} \u500B\u5E33\u865F)...`),this.ipcService.send("one-click-start",{forceRefresh:!0}),this.toastService.info(`\u{1F680} \u958B\u59CB\u4E00\u9375\u555F\u52D5\uFF0C\u5F8C\u7AEF\u5C07\u81EA\u52D5\u9023\u63A5 ${e} \u500B\u5E33\u865F`,3e3)}oneClickStop(){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6240\u6709\u670D\u52D9\u55CE\uFF1F\u9019\u5C07\u505C\u6B62\u76E3\u63A7\u548C AI \u81EA\u52D5\u804A\u5929\u3002")&&this.ipcService.send("one-click-stop")}loadSystemStatus(){this.ipcService.send("get-system-status")}clearLogs(){confirm("\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u65E5\u5FD7\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-logs"),this.logs.set([]),this.toastService.success("\u65E5\u5FD7\u5DF2\u6E05\u9664"))}refreshQueueStatus(e){this.ipcService.send("get-queue-status",e?{phone:e}:{})}clearPendingQueue(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5F85\u767C\u9001\u6D88\u606F\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002")&&(this.ipcService.send("clear-queue",{status:"pending"}),this.toastService.success("\u5F85\u767C\u9001\u968A\u5217\u5DF2\u6E05\u7A7A"))}retryMessage(e){this.ipcService.send("retry-message",{messageId:e}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u767C\u9001...")}cancelMessage(e){this.ipcService.send("cancel-message",{messageId:e}),this.toastService.success("\u6D88\u606F\u5DF2\u53D6\u6D88"),this.refreshQueueStatus()}clearQueue(e,t){confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u961F\u5217\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-queue",{phone:e,status:t}),this.toastService.info("\u6B63\u5728\u6E05\u7A7A\u961F\u5217..."))}pauseQueue(e){this.ipcService.send("pause-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6682\u505C\u961F\u5217...")}resumeQueue(e){this.ipcService.send("resume-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6062\u590D\u961F\u5217...")}deleteQueueMessage(e,t){confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u6D88\u606F\u5417\uFF1F")&&(this.ipcService.send("delete-queue-message",{phone:e,messageId:t}),this.toastService.info("\u6B63\u5728\u5220\u9664\u6D88\u606F..."))}updateQueueMessagePriority(e,t,n){let o=n==="HIGH"||n==="NORMAL"||n==="LOW"?n:"NORMAL";this.ipcService.send("update-queue-message-priority",{phone:e,messageId:t,priority:o})}getQueueMessages(e,t,n=100){this.ipcService.send("get-queue-messages",{phone:e,status:t,limit:n})}viewQueueDetails(e){this.selectedQueuePhone.set(e),this.getQueueMessages(e)}closeQueueDetails(){this.selectedQueuePhone.set(null),this.queueMessages.set([])}loadSendingStats(e=7,t){this.ipcService.send("get-sending-stats",{days:e,phone:t})}loadQueueLengthHistory(e=7){this.ipcService.send("get-queue-length-history",{days:e})}loadAccountSendingComparison(e=7){this.ipcService.send("get-account-sending-comparison",{days:e})}loadCampaignPerformanceStats(e=7){this.ipcService.send("get-campaign-performance-stats",{days:e})}onDaysChange(e){this.selectedDays.set(e),this.loadAllAnalytics(e)}loadAllAnalytics(e=7){this.loadSendingStats(e),this.loadQueueLengthHistory(e),this.loadAccountSendingComparison(e),this.loadCampaignPerformanceStats(e)}capturesChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),n=new Date;n.setHours(0,0,0,0);let o=[],r=[];for(let c=t-1;c>=0;c--){let m=new Date(n);m.setDate(n.getDate()-c);let h=m.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(h);let g=e.filter(_=>{let S=new Date(_.timestamp);return S.setHours(0,0,0,0),S.getTime()===m.getTime()}).length;r.push(g)}return{labels:o,datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:r,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]}}conversionsChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),n=new Date;n.setHours(0,0,0,0);let o=[],r=[],c=[];for(let m=t-1;m>=0;m--){let h=new Date(n);h.setDate(n.getDate()-m);let g=h.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(g);let _=e.filter(S=>{let y=new Date(S.timestamp);return y.setHours(0,0,0,0),y.getTime()===h.getTime()});r.push(_.filter(S=>S.status!=="New").length),c.push(_.filter(S=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(S.status)).length)}return{labels:o,datasets:[{label:"\u5DF2\u8054\u7CFB",data:r,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5DF2\u56DE\u590D",data:c,borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",fill:!0}]}}messagesChartData(){return this.sendingStatsData()}funnelChartData(){let e=this.funnelStats();if(!e||!e.stages||Object.keys(e.stages).length===0)return null;let t=this.funnelStages,n=t.map(r=>r.name),o=t.map(r=>{let c=e.stages[r.key];return c?c.count:0});return{labels:n,datasets:[{label:"\u6F0F\u6597\u6570\u636E",data:o,backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(34, 197, 94, 0.8)","rgba(168, 85, 247, 0.8)","rgba(239, 68, 68, 0.8)","rgba(245, 158, 11, 0.8)","rgba(236, 72, 153, 0.8)","rgba(16, 185, 129, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(34, 197, 94)","rgb(168, 85, 247)","rgb(239, 68, 68)","rgb(245, 158, 11)","rgb(236, 72, 153)","rgb(16, 185, 129)","rgb(239, 68, 68)"],borderWidth:1}]}}loadAlerts(e=!1,t){this.ipcService.send("get-alerts",{limit:50,unresolvedOnly:e,level:t})}acknowledgeAlert(e){this.ipcService.send("acknowledge-alert",{alertId:e})}resolveAlert(e){this.ipcService.send("resolve-alert",{alertId:e})}loadAlertHistory(e=30){this.ipcService.send("get-alert-history",{days:e})}loadAlertRules(){this.ipcService.send("get-alert-rules",{})}toggleAlertRule(e){this.ipcService.send("toggle-alert-rule",{ruleId:e})}editAlertRule(e){this.showAddAlertRuleDialog.set(!0)}deleteAlertRule(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u544A\u8B66\u89C4\u5219\u5417\uFF1F")&&this.ipcService.send("delete-alert-rule",{ruleId:e})}async showNotification(e,t,n){"Notification"in window&&(Notification.permission==="granted"?new Notification(e,F({body:t,icon:"/assets/icon.png",badge:"/assets/badge.png",tag:"tg-matrix-notification",requireInteraction:!1},n)):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&this.showNotification(e,t,n))}showBrowserNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification(`\u544A\u8B66: ${e.level.toUpperCase()}`,{body:e.message,icon:"/assets/icon.ico",tag:`alert-${e.id}`,requireInteraction:e.level==="critical"||e.level==="error"})}async requestNotificationPermission(){"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()}formatDate(e){return new Date(e).toLocaleString()}mapLeadFromBackend(e){let t="unknown",n=e.notes||"",o=e.triggered_keyword||e.triggeredKeyword||"";return n.includes("\u89F8\u767C\u8A5E")||o?t="keyword_trigger":e.extracted_by_phone||e.source_chat_id?t="group_extract":(n.includes("\u5C0E\u5165")||n.includes("import"))&&(t="import"),{id:e.id,userId:e.user_id||e.userId||"",username:e.username||"",firstName:e.first_name||e.firstName||"",lastName:e.last_name||e.lastName||"",sourceGroup:e.source_chat_title||e.sourceGroup||e.source_group||"",triggeredKeyword:n||o||"",timestamp:new Date(e.created_at||e.timestamp||e.extracted_at||Date.now()),status:e.status||e.response_status||"New",onlineStatus:e.online_status||e.onlineStatus||"hidden",assignedTemplateId:e.assignedTemplateId||e.assigned_template_id,interactionHistory:e.interactionHistory||e.interaction_history||[],doNotContact:!!e.doNotContact||!!e.do_not_contact,campaignId:e.campaignId||e.campaign_id,intentScore:e.intent_score||e.intentScore||0,intentLevel:e.intent_level||e.intentLevel||"none",sourceType:e.source_type||e.sourceType||t}}syncLeadsToResourceCenter(e){let t=(e||[]).map(n=>this.mapLeadFromBackend(n));this.contactsService.importLeadsDirectly(t),console.log("[Frontend] Synced",t.length,"leads to resource center")}loadRemainingLeads(){if(console.log("[Frontend] loadRemainingLeads called, loading:",this.leadsLoading(),"hasMore:",this.leadsHasMore()),this.leadsLoading()){console.log("[Frontend] \u23F3 Already loading, skipping...");return}let e=this.leads().length,t=this.leadsTotal();if(e>=t&&t>0){console.log("[Frontend] \u2705 All data already loaded:",e,"/",t);return}console.log("[Frontend] \u{1F4E5} Loading remaining leads:",e,"/",t),this.leadsLoading.set(!0),this.ipcService.send("get-leads-paginated",{page:1,pageSize:500,status:null,search:null})}safeFormatDate(e,t="MM/dd HH:mm"){if(!e)return"-";try{let n=e instanceof Date?e:new Date(e);if(isNaN(n.getTime()))return"-";let o=_=>_.toString().padStart(2,"0"),r=o(n.getMonth()+1),c=o(n.getDate()),m=o(n.getHours()),h=o(n.getMinutes()),g=n.getFullYear();return t==="MM/dd HH:mm"?`${r}/${c} ${m}:${h}`:t==="yyyy-MM-dd HH:mm"?`${g}-${r}-${c} ${m}:${h}`:t==="HH:mm:ss"?`${m}:${h}:${o(n.getSeconds())}`:`${r}/${c} ${m}:${h}`}catch{return"-"}}getQueueStatusForAccount(e){return this.queueStatuses()[e]||null}getTotalQueueStats(){let e=this.queueStatuses(),t=0,n=0,o=0,r=0,c=0,m=0;return Object.values(e).forEach(h=>{t+=h.pending,n+=h.processing,o+=h.retrying,r+=h.failed,c+=h.stats.completed,m+=h.stats.failed}),{pending:t,processing:n,retrying:o,failed:r,completed:c,failedCount:m,totalAccounts:Object.keys(e).length}}applyLogFilter(){this.ipcService.send("get-logs",{limit:1e3,type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}resetLogFilter(){this.logFilterType.set(""),this.logFilterStartDate.set(""),this.logFilterEndDate.set(""),this.logFilterSearch.set(""),this.ipcService.send("get-logs",{limit:100})}exportLogs(){this.ipcService.send("export-logs",{type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}onExcelFileSelected(){this.accountLoaderService.loadAccountsFromExcel()}onDownloadTemplate(){this.accountLoaderService.downloadExcelTemplate()}reloadSessionsAndAccounts(){this.accountLoaderService.reloadSessionsAndAccounts()}openQrLogin(){this.dialogService.openQrLogin()}closeQrLogin(){this.dialogService.closeQrLogin()}onQrLoginSuccess(e){this.dialogService.closeQrLogin(),this.toastService.success(`\u5E33\u865F ${e.phone||""} \u5DF2\u6210\u529F\u6DFB\u52A0\uFF01`),this.reloadSessionsAndAccounts()}exportLeads(){if(!this.membershipService.hasFeature("dataExport")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5C0E\u51FA\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.accountLoaderService.exportLeadsToExcel(this.leads())}importSession(){this.ipcService.send("import-session")}exportSession(e){this.ipcService.send("export-session",e)}cleanupSessionFiles(){confirm("\u786E\u5B9A\u8981\u6E05\u7406\u6240\u6709\u5B64\u7ACB\u7684 session \u6587\u4EF6\u5417\uFF1F\u8FD9\u5C06\u5220\u9664\u6240\u6709\u5E26\u65F6\u95F4\u6233\u7684 session \u6587\u4EF6\u548C\u4E0D\u5728\u6570\u636E\u5E93\u4E2D\u7684 session \u6587\u4EF6\u3002")&&(this.ipcService.send("cleanup-session-files"),this.toastService.info("\u6B63\u5728\u6E05\u7406\u5B64\u7ACB\u7684 session \u6587\u4EF6..."))}scanOrphanSessions(){this.toastService.info("\u6B63\u5728\u6383\u63CF\u5B64\u7ACB\u7684 Session \u6587\u4EF6...",2e3),this.ipcService.send("scan-orphan-sessions",{})}recoverOrphanSessions(){let e=this.orphanSessions();if(e.length===0){this.toastService.warning("\u6C92\u6709\u9700\u8981\u6062\u5FA9\u7684 Session \u6587\u4EF6");return}this.isRecoveringOrphanSessions.set(!0),this.toastService.info(`\u6B63\u5728\u6062\u5FA9 ${e.length} \u500B\u5E33\u865F...`,2e3),this.ipcService.send("recover-orphan-sessions",{sessions:e})}dismissOrphanSessionDialog(){this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([])}toggleAllAccountSelection(e){let t=e.target.checked,n=new Set(this.filteredAccounts().map(o=>o.id));this.accounts.update(o=>o.map(r=>n.has(r.id)?N(F({},r),{selected:t}):r))}bulkAssignRole(e){let t=this.selectedAccounts().map(n=>n.id);if(t.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u89D2\u8272...",progress:{current:0,total:t.length},cancellable:!1}),this.simulateBulkOperationProgress(t.length,()=>{this.ipcService.send("bulk-assign-role",{accountIds:t,role:e}),this.toastService.success(`\u5DF2\u4E3A ${t.length} \u4E2A\u8D26\u6237\u5206\u914D\u89D2\u8272`)})}bulkAssignGroup(e){let t=e||window.prompt(this.t("enterGroupName"));if(t){let n=this.selectedAccounts().map(o=>o.id);if(n.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u5206\u7EC4...",progress:{current:0,total:n.length},cancellable:!1}),this.simulateBulkOperationProgress(n.length,()=>{this.ipcService.send("bulk-assign-group",{accountIds:n,group:t}),this.toastService.success(`\u5DF2\u4E3A ${n.length} \u4E2A\u8D26\u6237\u5206\u914D\u5206\u7EC4`)})}}bulkDelete(){let e=this.selectedAccounts().map(t=>t.id);if(e.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u8D26\u6237");return}window.confirm(`\u786E\u5B9A\u8981\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`)&&(this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5220\u9664\u8D26\u6237...",progress:{current:0,total:e.length},cancellable:!1}),this.simulateBulkOperationProgress(e.length,()=>{this.ipcService.send("bulk-delete-accounts",{accountIds:e}),this.toastService.success(`\u5DF2\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237`)}))}simulateBulkOperationProgress(e,t){let n=0,o=setInterval(()=>{n+=Math.max(1,Math.floor(e/20)),n>=e&&(n=e,clearInterval(o),setTimeout(()=>{this.progressDialog.set(N(F({},this.progressDialog()),{show:!1})),t()},300)),this.progressDialog.set(N(F({},this.progressDialog()),{progress:{current:n,total:e,message:`\u5904\u7406\u4E2D ${n}/${e}`}}))},50)}updateAccountRole(e,t){this.ipcService.send("update-account-data",{id:e,updates:{role:t}})}showAddGroupDialog(){this.toastService.info("\u8ACB\u5728\u76E3\u63A7\u7FA4\u7D44\u5340\u584A\u4E2D\u9EDE\u64CA\u300C+ \u6DFB\u52A0\u7FA4\u7D44\u300D")}showAddKeywordSetDialog(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.newKeywordSet.set({name:""}),this.showKeywordSetCreator.set(!0)}submitNewKeywordSet(){let t=this.newKeywordSet().name.trim();t?(console.log("[Frontend] Sending add-keyword-set command:",t),this.ipcService.send("add-keyword-set",{name:t}),this.toastService.success("\u6B63\u5728\u5275\u5EFA\u95DC\u9375\u8A5E\u96C6...",2e3),this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})):this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}cancelNewKeywordSet(){this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})}addKeywordSet(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let n=this.newKeywordSet().name.trim();if(n){if(!n){this.toastService.warning("\u95DC\u9375\u8A5E\u96C6\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A",3e3);return}console.log("[Frontend] Sending add-keyword-set command:",n),this.ipcService.send("add-keyword-set",{name:n})}else this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}handleSaveGroupConfig(e){console.log("[Frontend] Saving group config:",e);let t=this.monitoredGroups().find(n=>n.id===e.groupId);t?(this.ipcService.send("add-group",{url:t.url,keywordSetIds:e.keywordSetIds}),this.toastService.success("\u7FA4\u7D44\u914D\u7F6E\u5DF2\u4FDD\u5B58",2e3)):(console.error("[Frontend] Group not found for config save:",e.groupId),this.toastService.error("\u627E\u4E0D\u5230\u7FA4\u7D44\uFF0C\u7121\u6CD5\u4FDD\u5B58\u914D\u7F6E"))}handleSaveKeywordSetConfig(e){console.log("[Frontend] Saving keyword set config:",e);let n=this.keywordSets().find(r=>r.id===e.setId)?.keywords?.map(r=>r.keyword)||[],o=e.keywords.filter(r=>!n.includes(r));for(let r of o)console.log("[Frontend] Adding keyword:",r,"to set:",e.setId),this.ipcService.send("add-keyword",{setId:e.setId,keyword:r,isRegex:!1});o.length>0?this.toastService.success(`\u5DF2\u6DFB\u52A0 ${o.length} \u500B\u95DC\u9375\u8A5E`,2e3):this.toastService.info("\u6C92\u6709\u65B0\u95DC\u9375\u8A5E\u9700\u8981\u6DFB\u52A0",2e3)}handleExtractMembersFromAutomation(e){console.log("[Frontend] Extract members from automation center:",e);try{let t="";e.groupUrl&&(t=e.groupUrl.replace("@","").replace("https://t.me/","").replace("http://t.me/","").replace("t.me/","").split("/")[0]);let n=this.monitoredGroups().find(c=>c.id===parseInt(e.groupId,10)||c.url===e.groupUrl||c.url===`@${t}`||c.url===t),o=this.discoveredResources().find(c=>c.username===t||c.id===parseInt(e.groupId,10)),r={id:o?.id||parseInt(e.groupId,10)||0,title:e.groupName,username:t,telegram_id:o?.telegram_id||n?.telegram_id||t||e.groupId,member_count:e.memberCount||n?.member_count||0,resource_type:"group"};if(console.log("[Frontend] Opening member list dialog with resource:",r),!r.telegram_id&&!r.username){this.toastService.error("\u7121\u6CD5\u7372\u53D6\u7FA4\u7D44\u4FE1\u606F\uFF0C\u8ACB\u5F9E\u8CC7\u6E90\u767C\u73FE\u9801\u9762\u63D0\u53D6\u6210\u54E1");return}this.currentView.set("resources"),setTimeout(()=>{this.openMemberListDialog(r)},100)}catch(t){console.error("[Frontend] Error opening member list dialog:",t),this.toastService.error("\u6253\u958B\u6210\u54E1\u63D0\u53D6\u5C0D\u8A71\u6846\u5931\u6557")}}addKeyword(){let e=this.newKeyword();if(!e.setId){this.toastService.warning(this.t("selectKeywordSetFirst"),3e3);return}if(!e.keyword.trim()){this.toastService.warning(this.t("keywordEmpty"),3e3);return}if(e.isRegex)try{new RegExp(e.keyword)}catch(m){this.toastService.error(`${this.t("invalidRegex")}: ${m.message}`,4e3);return}let t=e.keyword.trim(),n=this.keywordSets().find(m=>m.id===e.setId);if(!n){this.toastService.error("\u95DC\u9375\u8A5E\u96C6\u4E0D\u5B58\u5728",3e3);return}if(n.keywords.some(m=>m.keyword===t&&m.isRegex===e.isRegex)){this.toastService.warning("\u8A72\u95DC\u9375\u8A5E\u5DF2\u5B58\u5728\u65BC\u6B64\u95DC\u9375\u8A5E\u96C6\u4E2D",3e3);return}let c={id:Date.now(),keyword:t,isRegex:e.isRegex};this.keywordSets.update(m=>m.map(h=>h.id===e.setId?N(F({},h),{keywords:[...h.keywords,c]}):h)),this.newKeyword.set({setId:e.setId,keyword:"",isRegex:!1}),this.testKeywordText.set(""),this.keywordTestResult.set(null),this.ipcService.send("add-keyword",{setId:e.setId,keyword:t,isRegex:e.isRegex}),this.toastService.success(this.t("keywordAdded"),2e3)}onTestTextInput(e){e.target.value.trim()||this.keywordTestResult.set(null)}testKeyword(){let e=this.newKeyword(),t=this.testKeywordText().trim();if(!e.keyword.trim()){this.toastService.warning("\u8ACB\u5148\u8F38\u5165\u95DC\u9375\u8A5E",2e3),this.keywordTestResult.set(null);return}if(!t){this.keywordTestResult.set(null);return}try{let n=!1;if(e.isRegex)try{n=new RegExp(e.keyword,"i").test(t)}catch(o){this.keywordTestResult.set({matches:!1,error:o.message}),this.toastService.error(`${this.t("invalidRegex")}: ${o.message}`,4e3);return}else n=t.toLowerCase().includes(e.keyword.toLowerCase());this.keywordTestResult.set({matches:n})}catch(n){this.keywordTestResult.set({matches:!1,error:n.message}),this.toastService.error(`\u6E2C\u8A66\u5931\u6557: ${n.message}`,3e3)}}removeKeywordFromSet(e,t){let n=this.keywordSets().find(r=>r.id===e),o=n?.keywords.find(r=>r.id===t);n&&o?(this.keywordSets.update(r=>r.map(c=>c.id===e?N(F({},c),{keywords:c.keywords.filter(m=>m.id!==t)}):c)),this.ipcService.send("remove-keyword",{setId:e,keywordId:t}),this.toastService.success("\u95DC\u9375\u8A5E\u5DF2\u522A\u9664",2e3)):this.toastService.warning("\u95DC\u9375\u8A5E\u4E0D\u5B58\u5728",2e3)}addGroup(){let e=this.membershipService.quotas();if(e.maxGroups!==-1&&this.monitoredGroups().length>=e.maxGroups){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxGroups} \u500B\u7FA4\u7D44`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newGroup();t.url.trim()&&(this.monitoredGroups().some(o=>o.url===t.url.trim())&&this.toastService.warning("\u8A72\u7FA4\u7D44\u5DF2\u5B58\u5728\uFF0C\u5C07\u66F4\u65B0\u95DC\u9375\u8A5E\u96C6\u914D\u7F6E",3e3),this.ipcService.send("add-group",{url:t.url.trim(),keywordSetIds:t.keywordSetIds}),this.newGroup.set({url:"",keywordSetIds:[]}))}joinGroup(e){console.log("[Frontend] joinGroup called with:",e),console.log("[Frontend] All accounts:",this.accounts());let t=this.accounts(),n=t.filter(r=>r.role==="Listener"&&r.status==="Online");if(console.log("[Frontend] Listener accounts:",n),n.length===0){let r=t.filter(c=>c.status==="Online");if(console.log("[Frontend] Online accounts (any role):",r),r.length===0){this.toastService.error("\u6C92\u6709\u5728\u7DDA\u7684\u5E33\u865F\uFF0C\u7121\u6CD5\u52A0\u5165\u7FA4\u7D44",3e3);return}n=r,this.toastService.warning("\u6C92\u6709\u76E3\u63A7\u5E33\u865F\uFF0C\u4F7F\u7528\u5176\u4ED6\u5728\u7DDA\u5E33\u865F\u52A0\u5165",3e3)}let o=n[0].phone;console.log("[Frontend] Using phone to join:",o),this.toastService.info(`\u6B63\u5728\u5617\u8A66\u8B93 ${o} \u52A0\u5165\u7FA4\u7D44...`,3e3),this.ipcService.send("join-group",{phone:o,groupUrl:e})}toggleArrayItem(e,t){let n=[...e],o=n.indexOf(t);return o>-1?n.splice(o,1):n.push(t),n}toggleKeywordSetForNewGroup(e){this.newGroup.update(t=>t?N(F({},t),{keywordSetIds:this.toggleArrayItem(t.keywordSetIds||[],e)}):{url:"",keywordSetIds:[e]})}toggleTriggerGroup(e,t){this.campaigns.update(n=>n.map(o=>o.id===e?N(F({},o),{trigger:N(F({},o.trigger),{sourceGroupIds:this.toggleArrayItem(o.trigger.sourceGroupIds,t)})}):o))}toggleTriggerKeywordSet(e,t){this.campaigns.update(n=>n.map(o=>o.id===e?N(F({},o),{trigger:N(F({},o.trigger),{keywordSetIds:this.toggleArrayItem(o.trigger.keywordSetIds,t)})}):o))}toggleNewCampaignSourceGroup(e){this.newCampaign.update(t=>N(F({},t),{trigger:N(F({},t.trigger),{sourceGroupIds:this.toggleArrayItem(t.trigger.sourceGroupIds,e)})}))}toggleNewCampaignKeywordSet(e){this.newCampaign.update(t=>N(F({},t),{trigger:N(F({},t.trigger),{keywordSetIds:this.toggleArrayItem(t.trigger.keywordSetIds,e)})}))}removeById(e,t,n){console.log(`[Frontend] Removing ${n} with id: ${t}`);let o=e();o.find(c=>c.id===t)?(e.set(o.filter(c=>c.id!==t)),console.log(`[Frontend] Optimistically removed ${n} ${t} from local list`),this.toastService.success(`${n==="keyword-set"?"\u95DC\u9375\u8A5E\u96C6":n} \u522A\u9664\u6210\u529F`,2e3)):console.warn(`[Frontend] ${n} ${t} not found in local list`),this.ipcService.send(`remove-${n.replace(" ","-")}`,{id:t})}openLeadDetailModal(e){let t=this.messageTemplates().find(o=>o.id===e.assignedTemplateId);this.generationState.set({status:"idle",lead:e,generatedMessage:"",error:null,customPrompt:t?.prompt||"",attachment:null,attachments:[]}),this.leadDetailView.set("sendMessage"),this.messageMode.set("manual"),this.editableMessage.set("");let n=this.senderAccounts();n.length>0&&!this.selectedSenderId()&&this.selectedSenderId.set(n[0].id)}closeLeadDetailModal(){this.generationState.set({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]}),this.editableMessage.set(""),this.messageMode.set("manual")}startAiChat(e){this.openLeadDetailModal(e),this.messageMode.set("ai"),this.toastService.info(`\u{1F916} \u5DF2\u958B\u555F AI \u804A\u5929\u6A21\u5F0F\uFF0C\u70BA @${e.username||e.userId} \u751F\u6210\u667A\u80FD\u56DE\u8986`)}inviteToGroup(e){if(this.collabGroups().length===0){this.toastService.warning("\u26A0\uFE0F \u8ACB\u5148\u5728\u300C\u591A\u89D2\u8272\u5354\u4F5C\u300D\u4E2D\u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44"),this.currentView.set("multi-role");return}this.selectedLeadForInvite.set(e),this.showInviteGroupDialog.set(!0),this.toastService.info(`\u{1F465} \u9078\u64C7\u8981\u9080\u8ACB @${e.username||e.userId} \u7684\u7FA4\u7D44`)}executeInviteToGroup(e){let t=this.selectedLeadForInvite();t&&(this.ipcService.send("invite-lead-to-collab-group",{leadId:t.id,userId:t.userId,username:t.username,groupId:e}),this.showInviteGroupDialog.set(!1),this.selectedLeadForInvite.set(null),this.toastService.success("\u2713 \u5DF2\u767C\u9001\u9080\u8ACB\u8ACB\u6C42"))}addToDnc(e){this.ipcService.send("add-to-dnc",{leadId:e.id,userId:e.userId}),this.toastService.success(`\u{1F6AB} \u5DF2\u5C07 @${e.username||e.userId} \u52A0\u5165\u9ED1\u540D\u55AE`)}async generateMessage(){let e=this.membershipService.canUseAi();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5 AI \u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState();if(t.lead){this.generationState.update(n=>N(F({},n),{status:"loading",error:null}));try{let n=t.customPrompt;this.spintaxEnabled()&&(n=this.parseSpintax(n));let o=this.aiApiType(),r="";o==="local"||o==="custom"?r=await this.generateWithLocalAI(t.lead,n):o==="openai"?r=await this.generateWithOpenAI(t.lead,n):r=await this.geminiService.generateOutreachMessage(t.lead,n),this.membershipService.recordAiCall(1),this.generationState.update(c=>N(F({},c),{status:"success",generatedMessage:r})),this.editableMessage.set(r)}catch(n){this.generationState.update(o=>N(F({},o),{status:"error",error:n.message}))}}}async generateWithLocalAI(e,t){let n=this.aiApiType()==="local"?this.localAiEndpoint():this.customApiEndpoint(),o=this.localAiModel()||"default";if(!n)throw new Error("\u672C\u5730 AI \u7AEF\u9EDE\u672A\u914D\u7F6E");let r=`\u4F60\u662F\u4E00\u500B\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\u6D88\u606F\u3002
\u898F\u5247\uFF1A
1. \u6D88\u606F\u5FC5\u9808\u7C21\u77ED\uFF0815-40\u5B57\u4EE5\u5167\uFF09
2. \u50CF\u670B\u53CB\u804A\u5929\u4E00\u6A23\u81EA\u7136\uFF0C\u4E0D\u8981\u592A\u6B63\u5F0F
3. \u4E0D\u8981\u4F7F\u7528"\u60A8\u597D"\u7B49\u904E\u65BC\u6B63\u5F0F\u7684\u958B\u982D
4. \u53EF\u4EE5\u7528"\u55E8"\u3001"\u54C8\u56C9"\u3001"hi"\u7B49\u8F15\u9B06\u554F\u5019
5. \u76F4\u63A5\u5207\u5165\u8A71\u984C\uFF0C\u4E0D\u8981\u56C9\u55E6
6. \u8A9E\u6C23\u8F15\u9B06\u53CB\u597D\uFF0C\u50CF\u662F\u5728\u5FAE\u4FE1\u804A\u5929`,c=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\u3002
\u7528\u4E00\u53E5\u8A71\u6253\u500B\u62DB\u547C\uFF0C\u7C21\u77ED\u81EA\u7136\u5C31\u597D\u3002`;return new Promise((m,h)=>{let g=setTimeout(()=>{h(new Error("AI \u751F\u6210\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u670D\u52D9\u9023\u63A5"))},6e4);this.ipcService.once("ai-response",_=>{clearTimeout(g),console.log("[AI] Received ai-response:",_),_?.success&&_?.response?m(_.response):h(new Error(_?.error||"AI \u751F\u6210\u5931\u6557"))}),console.log("[AI] Sending generate-ai-response with endpoint:",n),this.ipcService.send("generate-ai-response",{userId:e.id||e.username,message:c,systemPrompt:r,localAiEndpoint:n,localAiModel:o})})}async generateWithOpenAI(e,t){let n=this.aiApiKey();if(!n)throw new Error("OpenAI API Key \u672A\u914D\u7F6E");let o="\u4F60\u662F\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\uFF0815-40\u5B57\uFF09\uFF0C\u50CF\u670B\u53CB\u804A\u5929\uFF0C\u4E0D\u8981\u6B63\u5F0F\u3002",r=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\uFF0C\u7528\u4E00\u53E5\u8A71\u6253\u62DB\u547C\u3002`,c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:o},{role:"user",content:r}],max_tokens:500,temperature:.7})});if(!c.ok)throw new Error(`OpenAI API \u932F\u8AA4: ${c.status}`);return(await c.json()).choices?.[0]?.message?.content||"\u751F\u6210\u5931\u6557"}updateCustomPrompt(e){this.generationState.update(t=>N(F({},t),{customPrompt:e}))}applyTemplate(e){let t=e.target,n=parseInt(t.value,10);if(!n)return;let o=this.messageTemplates().find(r=>r.id===n);if(o){let r=o.prompt;this.spintaxEnabled()&&(r=this.parseSpintax(r)),this.editableMessage.set(r)}}isAiConfigured(){let e=this.aiApiType();return e==="local"?!!this.localAiEndpoint():e==="custom"?!!this.customApiEndpoint()&&!!this.aiApiKey():this.geminiService.isConfigured()||!!this.aiApiKey()}canSendMessage(){let e=this.editableMessage().trim().length>0,t=this.generationState(),n=t.attachment!==null||t.attachments.length>0,o=this.selectedSenderId()!==null&&this.senderAccounts().length>0;return(e||n)&&o}sendMessageToLead(){let e=this.membershipService.canSendMessage();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5\u6D88\u606F\u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState(),n=t.lead;if(!n)return;let o=this.editableMessage().trim(),r=t.attachment!==null;if(!o&&!r){this.toastService.error(this.t("messageRequired"),3e3);return}let c=this.selectedSenderId();if(!c){this.toastService.error(this.t("selectSenderFirst"),3e3);return}let m=this.accounts().find(g=>g.id===c);if(!m){this.toastService.error(this.t("senderAccountNotFound"),3e3);return}let h=t.attachments.length>0?t.attachments:t.attachment?[t.attachment]:[];h.length===0?this.ipcService.send("send-message",{leadId:n.id,accountPhone:m.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:o,attachment:null}):h.length===1?this.ipcService.send("send-message",{leadId:n.id,accountPhone:m.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:o,attachment:h[0]}):h.forEach((g,_)=>{this.ipcService.send("send-message",{leadId:n.id,accountPhone:m.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:_===0?o:"",attachment:g})}),this.membershipService.recordMessageSent(1),this.toastService.success(this.t("messageQueued"),2e3),this.closeLeadDetailModal()}sendMessage(){this.sendMessageToLead()}onFileAttached(e,t){let n=e.target;if(!n.files?.length)return;let o=n.files[0];o.size>10*1024*1024&&this.toastService.warning("\u5927\u6587\u4EF6\u5EFA\u8B70\u4F7F\u7528\u300C\u9078\u64C7\u6587\u4EF6\u300D\u6309\u9215\u4E0A\u50B3",3e3);let r=new FileReader;r.onload=()=>{let c={name:o.name,type:t,dataUrl:r.result,fileSize:o.size};this.generationState.update(m=>N(F({},m),{attachment:c}))},r.readAsDataURL(o),n.value=""}async selectAttachment(e,t=!1){let n=await this.ipcService.selectFileForAttachment(e,t);if(!n.success){n.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}if(t&&n.files){let o=n.files.map(m=>({name:m.fileName,type:m.fileType,filePath:m.filePath,fileSize:m.fileSize}));this.generationState.update(m=>N(F({},m),{attachments:[...m.attachments,...o],attachment:o[0]}));let c=(o.reduce((m,h)=>m+(h.fileSize||0),0)/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7 ${o.length} \u500B\u6587\u4EF6 (\u5171 ${c} MB)`,2e3)}else{let o={name:n.fileName,type:n.fileType,filePath:n.filePath,fileSize:n.fileSize};this.generationState.update(c=>N(F({},c),{attachment:o,attachments:[o]}));let r=(n.fileSize/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7: ${n.fileName} (${r} MB)`,2e3)}}async addMoreAttachments(e){let t=await this.ipcService.selectFileForAttachment(e,!0);if(!t.success||!t.files){t.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}let n=t.files.map(o=>({name:o.fileName,type:o.fileType,filePath:o.filePath,fileSize:o.fileSize}));this.generationState.update(o=>N(F({},o),{attachments:[...o.attachments,...n],attachment:o.attachment||n[0]})),this.toastService.success(`\u5DF2\u6DFB\u52A0 ${n.length} \u500B\u6587\u4EF6`,2e3)}removeAttachmentByIndex(e){this.generationState.update(t=>{let n=t.attachments.filter((o,r)=>r!==e);return N(F({},t),{attachments:n,attachment:n.length>0?n[0]:null})})}clearAllAttachments(){this.generationState.update(e=>N(F({},e),{attachments:[],attachment:null}))}getTotalAttachmentSize(){return(this.generationState().attachments.reduce((n,o)=>n+(o.fileSize||0),0)/1024/1024).toFixed(2)}removeAttachment(){this.clearAllAttachments()}parseSpintax(e){let t=/\{([^{}]+)\}/g;for(;t.test(e);)e=e.replace(t,(n,o)=>{let r=o.split("|");return r[Math.floor(Math.random()*r.length)]});return e}addInteractionHistory(e,t,n,o){let r={id:Date.now(),timestamp:new Date,type:t,content:n};if(o&&o.id===e){o.interactionHistory.unshift(r);return}this.leads.update(c=>c.map(m=>m.id===e?N(F({},m),{interactionHistory:[r,...m.interactionHistory]}):m))}updateLeadStatus(e,t,n=!0){this.ipcService.send("update-lead-status",{leadId:e,newStatus:t})}toggleLeadMenu(e){this.openLeadMenuId()===e?this.openLeadMenuId.set(null):this.openLeadMenuId.set(e)}closeLeadMenu(){this.openLeadMenuId.set(null)}addToDoNotContact(e){let t=this.leads().find(n=>n.id===e);t&&(this.ipcService.send("add-to-dnc",{userId:t.userId}),this.closeLeadDetailModal())}toggleLeadSelection(e){this.selectedLeadIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}),this.isSelectAllLeads.set(this.selectedLeadIds().size===this.leads().length)}toggleSelectAllLeads(){if(this.isSelectAllLeads())this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1);else{let e=this.leads(),t=new Set(e.map(n=>n.id));this.selectedLeadIds.set(t),this.isSelectAllLeads.set(!0),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}}clearLeadSelection(){this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1),this.showBatchOperationMenu.set(!1)}isLeadSelected(e){return this.selectedLeadIds().has(e)}selectAllFilteredLeads(){let e=this.filteredLeads(),t=new Set(e.map(n=>n.id));this.selectedLeadIds.set(t),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}confirmDeleteLead(e){this.deleteConfirmDialog.set({show:!0,type:"single",lead:e})}confirmBatchDeleteLeads(){let e=this.selectedLeadsCount();if(e===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u522A\u9664\u7684\u5BA2\u6236");return}this.deleteConfirmDialog.set({show:!0,type:"batch",count:e})}executeDeleteLeads(){let e=this.deleteConfirmDialog();if(this.deleteConfirmDialog.set({show:!1,type:"single"}),e.type==="single"&&e.lead)this.ipcService.send("delete-lead",{leadId:e.lead.id}),this.leads.update(t=>t.filter(n=>n.id!==e.lead.id)),this.toastService.success(`\u5DF2\u522A\u9664\u5BA2\u6236 @${e.lead.username||e.lead.userId}`);else if(e.type==="batch"){let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u6C92\u6709\u9078\u4E2D\u7684\u5BA2\u6236");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-delete-leads",{leadIds:t}),this.leads.update(n=>n.filter(o=>!this.selectedLeadIds().has(o.id))),this.toastService.success(`\u6B63\u5728\u522A\u9664 ${t.length} \u500B\u5BA2\u6236...`),this.clearLeadSelection()}}cancelDeleteLeads(){this.deleteConfirmDialog.set({show:!1,type:"single"})}exportSelectedLeads(){let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u5C0E\u51FA\u7684\u5BA2\u6236");return}let t=this.leads().filter(g=>e.includes(g.id)),n=["ID","\u7528\u6236\u540D","\u59D3\u540D","\u72C0\u614B","\u4F86\u6E90","\u95DC\u9375\u8A5E","\u6642\u9593"],o=t.map(g=>[g.userId,g.username||"",`${g.firstName||""} ${g.lastName||""}`.trim(),g.status,g.sourceGroup,g.triggeredKeyword,new Date(g.timestamp).toLocaleString()]),r=[n.join(","),...o.map(g=>g.join(","))].join(`
`),c=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(c),h=document.createElement("a");h.href=m,h.download=`leads_export_${new Date().toISOString().slice(0,10)}.csv`,h.click(),URL.revokeObjectURL(m),this.toastService.success(`\u5DF2\u5C0E\u51FA ${t.length} \u500B\u5BA2\u6236`)}batchUpdateLeadStatus(e){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-lead-status",{leadIds:t,newStatus:e})}batchAddTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}if(!e||!e.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.batchOperationInProgress.set(!0),this.showBatchTagSelector.set(!1),this.ipcService.send("batch-add-tag",{leadIds:t,tag:e.trim()})}batchRemoveTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.ipcService.send("batch-remove-tag",{leadIds:t,tag:e})}batchAddToDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}confirm(`\u78BA\u5B9A\u8981\u5C07 ${e.length} \u500B Lead \u6DFB\u52A0\u5230 DNC \u5217\u8868\u55CE\uFF1F`)&&(this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-add-to-dnc",{leadIds:e}))}batchRemoveFromDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-remove-from-dnc",{leadIds:e})}batchUpdateFunnelStage(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-funnel-stage",{leadIds:t,newStage:e})}batchDeleteLeads(){if(!this.checkBatchOperationPermission())return;if(Array.from(this.selectedLeadIds()).length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.confirmBatchDeleteLeads()}undoBatchOperation(e){confirm("\u78BA\u5B9A\u8981\u64A4\u92B7\u6B64\u64CD\u4F5C\u55CE\uFF1F")&&this.ipcService.send("undo-batch-operation",{operationId:e})}loadBatchOperationHistory(){this.ipcService.send("get-batch-operation-history",{limit:50,offset:0}),this.showBatchOperationHistory.set(!0)}openBatchOperationMenu(){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u9EDE\u64CA\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),this.showLeadsActionMenu.set(!1);return}this.showBatchOperationMenu.set(!this.showBatchOperationMenu()),this.loadAllTags(),this.showLeadsActionMenu.set(!1)}loadAllTags(){this.ipcService.send("get-all-tags",{})}createTag(){let e=this.newTagName().trim();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.ipcService.send("create-tag",{name:e,color:this.newTagColor()}),this.newTagName.set(""),this.showAddTagDialog.set(!1)}deleteTag(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A19\u7C64 "${e}" \u55CE\uFF1F\u6B64\u6A19\u7C64\u5C07\u5F9E\u6240\u6709 Lead \u4E2D\u79FB\u9664\u3002`)&&this.ipcService.send("delete-tag",{name:e})}onLeadSearchInput(){this.leadSearchTimeout&&clearTimeout(this.leadSearchTimeout);let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.leadSearchTimeout=setTimeout(()=>{this.searchLeads()},500)}searchLeads(){let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.isSearchingLeads.set(!0),this.ipcService.send("search-leads",{query:e,limit:100})}clearLeadSearch(){this.leadSearchQuery.set(""),this.leadSearchResults.set([]),this.leadSearchTimeout&&(clearTimeout(this.leadSearchTimeout),this.leadSearchTimeout=null)}createBackup(){this.isCreatingBackup.set(!0),this.ipcService.send("create-backup",{name:`backup_${new Date().toISOString().replace(/[:.]/g,"-")}`,description:"Manual backup"})}loadBackups(){this.ipcService.send("list-backups",{})}restoreBackup(e){confirm("\u786E\u5B9A\u8981\u6062\u590D\u6B64\u5907\u4EFD\u5417\uFF1F\u5F53\u524D\u6570\u636E\u5C06\u88AB\u8986\u76D6\uFF01")&&(this.isRestoringBackup.set(!0),this.ipcService.send("restore-backup",{backupId:e}))}deleteBackup(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5907\u4EFD\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF01")&&this.ipcService.send("delete-backup",{backupId:e})}handleBatchOperationResult(e){if(this.batchOperationInProgress.set(!1),e.success){let t=e.successCount||0,n=e.failureCount||0;n>0?this.toastService.warning(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u6210\u529F, ${n} \u5931\u6557`):this.toastService.success(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u9805\u5DF2\u8655\u7406`),this.clearLeadSelection(),this.ipcService.send("get-initial-state",{})}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationProgress(e){this.progressDialog.set({show:!0,title:"\u6279\u91CF\u64CD\u4F5C\u9032\u884C\u4E2D...",progress:{current:e.current,total:e.total,message:e.message},cancellable:!1}),e.current>=e.total&&setTimeout(()=>{this.progressDialog.update(t=>N(F({},t),{show:!1}))},500)}handleBatchUndoResult(e){e.success?(this.toastService.success("\u64CD\u4F5C\u5DF2\u64A4\u92B7"),this.ipcService.send("get-initial-state",{}),this.loadBatchOperationHistory()):this.toastService.error(`\u64A4\u92B7\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationHistory(e){e.success&&this.batchOperationHistory.set(e.operations||[])}handleAllTags(e){e.success&&this.allTags.set(e.tags||[])}handleTagCreated(e){e.success?(this.toastService.success("\u6A19\u7C64\u5275\u5EFA\u6210\u529F"),this.loadAllTags()):this.toastService.error(`\u5275\u5EFA\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleTagDeleted(e){e.success?(this.toastService.success("\u6A19\u7C64\u5DF2\u522A\u9664"),this.loadAllTags()):this.toastService.error(`\u522A\u9664\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}getOperationTypeName(e){return{update_status:"\u66F4\u65B0\u72C0\u614B",add_tag:"\u6DFB\u52A0\u6A19\u7C64",remove_tag:"\u79FB\u9664\u6A19\u7C64",add_to_dnc:"\u6DFB\u52A0\u5230 DNC",remove_from_dnc:"\u5F9E DNC \u79FB\u9664",update_funnel_stage:"\u66F4\u65B0\u6F0F\u6597\u968E\u6BB5",delete:"\u522A\u9664"}[e]||e}formatBatchOperationDate(e){return new Date(e).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}loadAdTemplates(){this.ipcService.send("get-ad-templates",{activeOnly:!1})}loadAdSchedules(){this.ipcService.send("get-ad-schedules",{activeOnly:!1})}loadAdSendLogs(){this.ipcService.send("get-ad-send-logs",{limit:100})}loadAdOverviewStats(){this.ipcService.send("get-ad-overview-stats",{days:7})}loadAdSystemData(){this.loadAdTemplates(),this.loadAdSchedules(),this.loadAdOverviewStats()}createAdTemplate(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdTemplate();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31");return}if(!e.content.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9");return}this.ipcService.send("create-ad-template",{name:e.name,content:e.content,mediaType:e.mediaType}),this.newAdTemplate.set({name:"",content:"",mediaType:"text"}),this.showAdTemplateForm.set(!1)}deleteAdTemplate(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u6A21\u677F\u55CE\uFF1F")&&this.ipcService.send("delete-ad-template",{templateId:e})}toggleAdTemplateStatus(e){this.ipcService.send("toggle-ad-template-status",{templateId:e})}previewSpintax(e){if(!e.trim()){this.spintaxPreview.set([]);return}this.isPreviewingSpintax.set(!0),this.ipcService.send("validate-spintax",{content:e})}createAdSchedule(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdSchedule();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u8A08\u5283\u540D\u7A31");return}if(!e.templateId){this.toastService.warning("\u8ACB\u9078\u64C7\u5EE3\u544A\u6A21\u677F");return}if(e.targetGroups.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u76EE\u6A19\u7FA4\u7D44");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.ipcService.send("create-ad-schedule",e),this.newAdSchedule.set({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]}),this.showAdScheduleForm.set(!1)}deleteAdSchedule(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u8A08\u5283\u55CE\uFF1F")&&this.ipcService.send("delete-ad-schedule",{scheduleId:e})}toggleAdScheduleStatus(e){this.ipcService.send("toggle-ad-schedule-status",{scheduleId:e})}runAdScheduleNow(e){confirm("\u78BA\u5B9A\u8981\u7ACB\u5373\u57F7\u884C\u6B64\u8A08\u5283\u55CE\uFF1F")&&(this.ipcService.send("run-ad-schedule-now",{scheduleId:e}),this.toastService.info("\u6B63\u5728\u57F7\u884C..."))}getSendModeLabel(e){return{scheduled:"\u5B9A\u6642\u767C\u9001",triggered:"\u95DC\u9375\u8A5E\u89F8\u767C",relay:"\u63A5\u529B\u767C\u9001",interval:"\u9593\u9694\u5FAA\u74B0"}[e]||e}getScheduleTypeLabel(e){return{once:"\u4E00\u6B21\u6027",daily:"\u6BCF\u65E5",interval:"\u9593\u9694",cron:"Cron"}[e]||e}getAccountStrategyLabel(e){return{single:"\u55AE\u4E00\u5E33\u865F",rotate:"\u8F2A\u63DB\u5E33\u865F",relay:"\u63A5\u529B\u767C\u9001",random:"\u96A8\u6A5F\u9078\u64C7"}[e]||e}getAdStatusColor(e){return{sent:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",deleted:"bg-yellow-500/20 text-yellow-400",banned:"bg-red-600/20 text-red-500"}[e]||"bg-slate-500/20 text-slate-400"}toggleAccountForSchedule(e){this.newAdSchedule.update(t=>{let n=[...t.assignedAccounts],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),N(F({},t),{assignedAccounts:n})})}updateScheduleTargetGroups(e){let t=e.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);this.newAdSchedule.update(n=>N(F({},n),{targetGroups:t}))}handleAdTemplates(e){e.success&&this.adTemplates.set(e.templates||[])}handleAdSchedules(e){e.success&&this.adSchedules.set(e.schedules||[])}handleAdSendLogs(e){e.success&&this.adSendLogs.set(e.logs||[])}handleAdOverviewStats(e){e.success&&this.adOverviewStats.set(e.overview||null)}handleAdTemplateCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u5275\u5EFA"),this.loadAdTemplates()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdTemplateDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u522A\u9664"),this.loadAdTemplates())}handleAdScheduleCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u5275\u5EFA"),this.loadAdSchedules()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdScheduleDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u522A\u9664"),this.loadAdSchedules())}handleSpintaxValidated(e){this.isPreviewingSpintax.set(!1),e.success||e.valid?this.spintaxPreview.set(e.variants||[]):(this.toastService.error(`Spintax \u8A9E\u6CD5\u932F\u8AA4: ${e.error}`),this.spintaxPreview.set([]))}handleAdScheduleRunResult(e){e.success?(this.toastService.success(`\u8A08\u5283\u57F7\u884C\u5B8C\u6210: ${e.sent||0} \u6210\u529F, ${e.failed||0} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()):this.toastService.error(`\u57F7\u884C\u5931\u6557: ${e.error}`)}loadTrackedUsers(){this.ipcService.send("get-tracked-users",{limit:100,valueLevel:this.userValueFilter()||void 0})}loadTrackingStats(){this.ipcService.send("get-tracking-stats",{})}loadHighValueGroups(){this.ipcService.send("get-high-value-groups",{limit:50})}loadUserTrackingData(){this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups()}addUserToTrack(){let e=this.newTrackedUser();if(!e.userId.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u7528\u6236 ID");return}this.ipcService.send("add-user-to-track",{userId:e.userId.trim(),username:e.username.trim()||void 0,notes:e.notes.trim()||void 0,source:"manual"}),this.newTrackedUser.set({userId:"",username:"",notes:""}),this.showAddUserForm.set(!1)}addLeadToTracking(e){this.ipcService.send("add-user-from-lead",{leadId:e})}removeTrackedUser(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u7528\u6236\u8FFD\u8E64\u55CE\uFF1F")&&this.ipcService.send("remove-tracked-user",{userId:e})}trackUserGroups(e){let t=this.accounts().filter(n=>n.status==="Online");if(t.length===0){this.toastService.warning("\u6C92\u6709\u5728\u7DDA\u5E33\u865F\u53EF\u7528\u65BC\u8FFD\u8E64");return}this.isTrackingUser.set(!0),this.ipcService.send("track-user-groups",{userId:e,accountPhone:t[0].phone})}viewUserGroups(e){this.selectedTrackedUser.set(e),this.ipcService.send("get-user-groups",{userId:e.userId})}updateUserValueLevel(e,t){this.ipcService.send("update-user-value-level",{userId:e,valueLevel:t})}getValueLevelLabel(e){return{vip:"VIP",high:"\u9AD8\u50F9\u503C",medium:"\u4E2D\u7B49",low:"\u4F4E"}[e]||e}getValueLevelColor(e){return{vip:"bg-purple-500/20 text-purple-400 border-purple-500/30",high:"bg-orange-500/20 text-orange-400 border-orange-500/30",medium:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",low:"bg-slate-500/20 text-slate-400 border-slate-500/30"}[e]||"bg-slate-500/20 text-slate-400"}getTrackingStatusLabel(e){return{pending:"\u5F85\u8FFD\u8E64",tracking:"\u8FFD\u8E64\u4E2D",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getTrackingStatusColor(e){return{pending:"bg-yellow-500/20 text-yellow-400",tracking:"bg-blue-500/20 text-blue-400",completed:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}handleTrackedUsers(e){e.success&&this.trackedUsers.set(e.users||[])}handleUserGroups(e){e.success&&this.userGroups.set(e.groups||[])}handleHighValueGroups(e){e.success&&this.highValueGroups.set(e.groups||[])}handleTrackingStats(e){e.success&&this.trackingStats.set(e.stats||null)}handleUserAddedToTrack(e){e.success?(this.toastService.success("\u7528\u6236\u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"),this.loadTrackedUsers()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}handleUserRemoved(e){e.success&&(this.toastService.success("\u7528\u6236\u5DF2\u79FB\u9664"),this.loadTrackedUsers())}handleUserTrackingCompleted(e){this.isTrackingUser.set(!1),e.success&&(this.toastService.success(`\u8FFD\u8E64\u5B8C\u6210: \u767C\u73FE ${e.groupsFound} \u500B\u7FA4\u7D44, ${e.highValueGroups} \u500B\u9AD8\u50F9\u503C`),this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups())}handleUserTrackingFailed(e){this.isTrackingUser.set(!1),this.toastService.error(`\u8FFD\u8E64\u5931\u6557: ${e.error}`),this.loadTrackedUsers()}loadCampaigns(){this.ipcService.send("get-campaigns",{limit:50})}loadUnifiedOverview(){this.ipcService.send("get-unified-overview",{days:7})}loadFunnelAnalysis(){this.ipcService.send("get-funnel-analysis",{})}loadCampaignData(){this.loadCampaigns(),this.loadUnifiedOverview(),this.loadFunnelAnalysis()}createCampaignFromForm(){if(!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.campaignFormData();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}this.ipcService.send("create-campaign",{name:e.name,description:e.description,phases:e.phases,keywords:e.keywords,targetGroups:e.targetGroups,assignedAccounts:e.assignedAccounts}),this.campaignFormData.set({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]}),this.showCampaignForm.set(!1)}startCampaign(e){confirm("\u78BA\u5B9A\u8981\u555F\u52D5\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("start-campaign",{campaignId:e})}pauseCampaign(e){this.ipcService.send("pause-campaign",{campaignId:e})}resumeCampaign(e){this.ipcService.send("resume-campaign",{campaignId:e})}stopCampaign(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("stop-campaign",{campaignId:e})}deleteCampaign(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("delete-campaign",{campaignId:e})}viewCampaignDetails(e){this.selectedCampaign.set(e),this.ipcService.send("get-campaign-logs",{campaignId:e.id})}getCampaignStatusLabel(e){return{draft:"\u8349\u7A3F",scheduled:"\u5DF2\u6392\u7A0B",running:"\u904B\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getCampaignStatusColor(e){return{draft:"bg-slate-500/20 text-slate-400",scheduled:"bg-blue-500/20 text-blue-400",running:"bg-green-500/20 text-green-400",paused:"bg-yellow-500/20 text-yellow-400",completed:"bg-cyan-500/20 text-cyan-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}getPhaseLabel(e){return{discovery:"\u8CC7\u6E90\u767C\u73FE",monitoring:"\u76E3\u63A7\u7372\u5BA2",outreach:"\u5EE3\u544A\u89F8\u9054",tracking:"\u7528\u6236\u8FFD\u8E64",conversion:"\u8F49\u5316\u6210\u4EA4"}[e]||e}toggleCampaignPhase(e){this.campaignFormData.update(t=>{let n=[...t.phases],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),N(F({},t),{phases:n})})}addCampaignKeyword(){let e=this.campaignKeywordInput().trim();e&&(this.campaignFormData.update(t=>N(F({},t),{keywords:[...t.keywords,e]})),this.campaignKeywordInput.set(""))}removeCampaignKeyword(e){this.campaignFormData.update(t=>N(F({},t),{keywords:t.keywords.filter(n=>n!==e)}))}toggleCampaignAccount(e){this.campaignFormData.update(t=>{let n=[...t.assignedAccounts],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),N(F({},t),{assignedAccounts:n})})}handleCampaigns(e){e.success&&this.campaigns.set(e.campaigns||[])}handleCampaignCreated(e){e.success?(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.loadCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleCampaignDeleted(e){e.success&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u522A\u9664"),this.loadCampaigns())}handleUnifiedOverview(e){e.success&&this.unifiedOverview.set(e)}handleFunnelAnalysis(e){e.success&&this.funnelAnalysis.set(e)}loadRoleTemplates(){this.ipcService.send("get-role-templates",{})}loadAllRoles(){this.ipcService.send("get-all-roles",{activeOnly:!0})}loadScriptTemplates(){this.ipcService.send("get-script-templates",{activeOnly:!0})}loadCollabGroups(){this.ipcService.send("get-collab-groups",{limit:50})}loadCollabStats(){this.ipcService.send("get-collab-stats",{})}loadRoleStats(){this.ipcService.send("get-role-stats",{})}loadMultiRoleData(){this.loadRoleTemplates(),this.loadAllRoles(),this.loadScriptTemplates(),this.loadCollabGroups(),this.loadCollabStats(),this.loadRoleStats()}assignRole(){let e=this.newRoleAssign();if(!e.accountPhone){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}if(!e.roleName.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31");return}this.ipcService.send("assign-role",{accountPhone:e.accountPhone,roleType:e.roleType,roleName:e.roleName}),this.newRoleAssign.set({accountPhone:"",roleType:"seller",roleName:""}),this.showRoleAssignForm.set(!1)}removeRole(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u89D2\u8272\u55CE\uFF1F")&&this.ipcService.send("remove-role",{roleId:e})}getRoleIcon(e){return{seller:"\u{1F9D1}\u200D\u{1F4BC}",expert:"\u{1F468}\u200D\u{1F52C}",satisfied:"\u{1F60A}",hesitant:"\u{1F914}",converted:"\u{1F389}",curious:"\u2753",manager:"\u{1F454}",support:"\u{1F6E0}\uFE0F"}[e]||"\u{1F464}"}getRoleLabel(e){return{seller:"\u92B7\u552E\u9867\u554F",expert:"\u5C08\u696D\u9867\u554F",satisfied:"\u6EFF\u610F\u5BA2\u6236",hesitant:"\u7336\u8C6B\u5BA2\u6236",converted:"\u6210\u4EA4\u5BA2\u6236",curious:"\u597D\u5947\u8005",manager:"\u7D93\u7406\u4E3B\u7BA1",support:"\u552E\u5F8C\u5BA2\u670D"}[e]||e}getScenarioLabel(e){return{group_conversion:"\u7FA4\u804A\u8F49\u5316",private_followup:"\u79C1\u804A\u8DDF\u9032",objection_handling:"\u7570\u8B70\u8655\u7406",product_intro:"\u7522\u54C1\u4ECB\u7D39",trust_building:"\u5EFA\u7ACB\u4FE1\u4EFB",urgency_creation:"\u88FD\u9020\u7DCA\u8FEB\u611F",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}getCollabStatusLabel(e){return{warming:"\u9810\u71B1\u4E2D",active:"\u6D3B\u8E8D\u4E2D",completed:"\u5DF2\u5B8C\u6210",archived:"\u5DF2\u6B78\u6A94"}[e]||e}getCollabStatusColor(e){return{warming:"bg-yellow-500/20 text-yellow-400",active:"bg-green-500/20 text-green-400",completed:"bg-blue-500/20 text-blue-400",archived:"bg-slate-500/20 text-slate-400"}[e]||"bg-slate-500/20 text-slate-400"}handleRoleTemplates(e){e.success&&this.roleTemplates.set(e.templates||{})}handleAllRoles(e){e.success&&this.allRoles.set(e.roles||[])}handleScriptTemplates(e){e.success&&this.scriptTemplates.set(e.templates||[])}handleCollabGroups(e){e.success&&this.collabGroups.set(e.groups||[])}handleCollabStats(e){e.success&&this.collabStats.set(e)}handleRoleStats(e){e.success&&this.roleStats.set(e)}updateAdTemplateName(e){this.newAdTemplate.update(t=>N(F({},t),{name:e}))}updateAdTemplateContent(e){this.newAdTemplate.update(t=>N(F({},t),{content:e}))}updateAdTemplateMediaType(e){this.newAdTemplate.update(t=>N(F({},t),{mediaType:e}))}updateAdScheduleName(e){this.newAdSchedule.update(t=>N(F({},t),{name:e}))}updateAdScheduleTemplateId(e){this.newAdSchedule.update(t=>N(F({},t),{templateId:e}))}updateAdScheduleSendMode(e){this.newAdSchedule.update(t=>N(F({},t),{sendMode:e}))}updateAdScheduleType(e){this.newAdSchedule.update(t=>N(F({},t),{scheduleType:e}))}updateAdScheduleTime(e){this.newAdSchedule.update(t=>N(F({},t),{scheduleTime:e}))}updateAdScheduleInterval(e){this.newAdSchedule.update(t=>N(F({},t),{intervalMinutes:e}))}updateAdScheduleStrategy(e){this.newAdSchedule.update(t=>N(F({},t),{accountStrategy:e}))}updateTrackedUserId(e){this.newTrackedUser.update(t=>N(F({},t),{userId:e}))}updateTrackedUserName(e){this.newTrackedUser.update(t=>N(F({},t),{username:e}))}updateTrackedUserNotes(e){this.newTrackedUser.update(t=>N(F({},t),{notes:e}))}updateCampaignFormName(e){this.campaignFormData.update(t=>N(F({},t),{name:e}))}updateCampaignFormDesc(e){this.campaignFormData.update(t=>N(F({},t),{description:e}))}updateRoleAssignPhone(e){this.newRoleAssign.update(t=>N(F({},t),{accountPhone:e}))}updateRoleAssignType(e){this.newRoleAssign.update(t=>N(F({},t),{roleType:e}))}updateRoleAssignName(e){this.newRoleAssign.update(t=>N(F({},t),{roleName:e}))}getRolesOfType(e){return this.allRoles().filter(t=>t.roleType===e)}addTemplate(){let e=this.newTemplate();e.name.trim()&&e.prompt.trim()?(this.ipcService.send("add-template",{name:e.name,prompt:e.prompt}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F")):this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}addTemplateQuick(e,t){if(e?.trim()&&t?.trim()){if(this.messageTemplates().some(o=>o.name===e.trim())){this.toastService.warning("\u6A21\u677F\u540D\u7A31\u5DF2\u5B58\u5728\uFF0C\u7121\u6CD5\u5275\u5EFA\u91CD\u8907\u6A21\u677F",3e3);return}this.ipcService.send("add-template",{name:e.trim(),prompt:t.trim()}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F"),this.messageTemplates().length>0&&this.showTemplateCreator.set(!1)}else this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}updateTemplateName(e){this.newTemplate.update(t=>N(F({},t),{name:e}))}updateTemplatePrompt(e){this.newTemplate.update(t=>N(F({},t),{prompt:e}))}insertTemplateVariable(e,t){let n=e.selectionStart,o=e.selectionEnd,r=e.value,c=r.substring(0,n)+t+r.substring(o);e.value=c,this.updateTemplatePrompt(c),setTimeout(()=>{e.focus(),e.selectionStart=e.selectionEnd=n+t.length},0)}toggleTemplateStatus(e){this.ipcService.send("toggle-template-status",{id:e})}removeTemplate(e){let t=this.messageTemplates().find(o=>o.id===e);if(!t)return;let n=this.campaigns().filter(o=>o.actions.some(r=>r.templateId===e));if(n.length>0){let o=n.map(r=>r.name).join(", ");if(!confirm(`\u6A21\u677F "${t.name}" \u6B63\u5728\u88AB\u4EE5\u4E0B\u6D3B\u52D5\u4F7F\u7528\uFF1A${o}

\u522A\u9664\u6A21\u677F\u5F8C\uFF0C\u9019\u4E9B\u6D3B\u52D5\u5C07\u7121\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002

\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F`))return}else if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F "${t.name}" \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002`))return;this.ipcService.send("remove-template",{id:e}),this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664")}getTemplateName(e){return e?this.messageTemplates().find(t=>t.id===e)?.name||"Unknown Template":"N/A"}getKeywordSetName(e){return this.keywordSets().find(t=>t.id===e)?.name||"Unknown Set"}getGroupName(e){return this.monitoredGroups().find(t=>t.id===e)?.name||"Unknown Group"}getCampaignName(e){return e?this.campaigns().find(t=>t.id===e)?.name||"Unknown Campaign":"N/A"}getCampaignById(e){if(e!==void 0)return this.campaigns().find(t=>t.id===e)}getEmptyCampaignForm(){return{name:"",trigger:{sourceGroupIds:[],keywordSetIds:[]},action:{templateId:0,minDelaySeconds:30,maxDelaySeconds:120}}}addCampaign(){if(this.isSubmittingCampaign()){this.toastService.warning("\u6B63\u5728\u5275\u5EFA\u6D3B\u52D5\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.newCampaign(),t=[];if(e.name?.trim()||t.push("\u6D3B\u52A8\u540D\u79F0"),(!e.action.templateId||e.action.templateId===0)&&t.push("\u6D88\u606F\u6A21\u677F"),e.trigger.sourceGroupIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6765\u6E90\u7FA4\u7EC4"),e.trigger.keywordSetIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5173\u952E\u8BCD\u96C6"),t.length>0){this.toastService.error(`\u8BF7\u5B8C\u5584\u4EE5\u4E0B\u5185\u5BB9: ${t.join(", ")}`);return}let n=e.name.trim();if(this.campaigns().find(r=>r.name===n)){this.toastService.warning(`\u6D3B\u52D5 "${n}" \u5DF2\u5B58\u5728\uFF0C\u8ACB\u4F7F\u7528\u4E0D\u540C\u7684\u540D\u7A31`,4e3);return}this.isSubmittingCampaign.set(!0),this.newCampaign.set(this.getEmptyCampaignForm()),this.ipcService.send("add-campaign",F({},e)),setTimeout(()=>{this.isSubmittingCampaign.set(!1)},3e3)}toggleCampaignStatus(e){this.ipcService.send("toggle-campaign-status",{id:e})}getLogColor(e){switch(e){case"info":return"text-cyan-400";case"success":return"text-green-400";case"warning":return"text-yellow-400";case"error":return"text-red-400";default:return"text-slate-400"}}formatTimestamp(e){if(!e)return"";try{let t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString()+" "+t.toLocaleTimeString()}catch{return""}}async loadChatList(){try{let e=this.chatListSearch(),t=this.chatListFunnelFilter();this.ipcService.send("get-chat-list",{limit:50,offset:0,search:e||void 0,funnelStage:t||void 0})}catch(e){console.error("[Frontend] Error loading chat list:",e)}}onChatListSearchChange(e){this.chatListSearch.set(e),this.chatListSearchDebounceTimer&&clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=setTimeout(()=>{this.loadChatList(),this.chatListSearchDebounceTimer=void 0},300)}onLogFilterChange(){this.logFilterDebounceTimer&&clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=setTimeout(()=>{this.applyLogFilter(),this.logFilterDebounceTimer=void 0},500)}refreshQueueStatusThrottled(){let e=Date.now(),t=e-this.lastQueueStatusRefresh;t>=2e3?(this.lastQueueStatusRefresh=e,this.refreshQueueStatus()):(this.queueStatusRefreshThrottleTimer&&clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=setTimeout(()=>{this.lastQueueStatusRefresh=Date.now(),this.queueStatusRefreshThrottleTimer=void 0,this.refreshQueueStatus()},2e3-t))}getAccountQueueStatuses(){let e=this.queueStatuses();return Object.entries(e).map(([t,n])=>{let o=this.accounts().find(r=>r.phone===t);return{phone:t,displayName:t,status:n.processing>0?"active":(n.pending>0,"idle"),pending:n.pending,processing:n.processing,completed:n.stats.completed,failed:n.stats.failed,retrying:n.retrying,sendRate:n.processing>0?1.5:0,avgResponseTime:500,dailyLimit:o?.dailySendLimit??100,dailyUsed:o?.dailySendCount??0,estimatedMinutes:n.pending>0?Math.ceil(n.pending/1.5):0,lastError:n.failed>0?"\u90E8\u5206\u6D88\u606F\u767C\u9001\u5931\u6557":void 0}})}pauseAllQueues(){this.ipcService.send("pause-all-queues",{}),this.toastService.info("\u6B63\u5728\u66AB\u505C\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}resumeAllQueues(){this.ipcService.send("resume-all-queues",{}),this.toastService.info("\u6B63\u5728\u6062\u5FA9\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}retryAllFailed(){this.ipcService.send("retry-all-failed",{}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u6240\u6709\u5931\u6557\u7684\u6D88\u606F...",2e3)}checkAutomationConfig(){this.toastService.info("\u6B63\u5728\u6AA2\u67E5\u914D\u7F6E...",2e3),this.ipcService.send("check-automation-config",{accounts:this.accounts().map(e=>({phone:e.phone,role:e.role,status:e.status})),groups:this.monitoredGroups(),keywords:this.keywordSets(),campaigns:this.campaigns()})}handleWorkflowNavigation(e){this.changeView(e.view),e.handler&&setTimeout(()=>{switch(e.handler){case"start-monitoring":this.startMonitoring();break;case"scan-sessions":this.scanOrphanSessions();break;case"new-campaign":break;case"export-leads":this.exportLeads();break;default:console.log("[Workflow] Unknown handler:",e.handler)}},300)}onWorkflowCompleted(e){this.toastService.success(`\u{1F389} \u5DE5\u4F5C\u6D41\u300C${e.title}\u300D\u5DF2\u5B8C\u6210\uFF01`,4e3),console.log("[Workflow] Completed:",e.id)}async loadChatHistory(e,t=!0){try{console.log("[Frontend] Loading chat history for user:",e,"reset:",t),t?(this.isLoadingChatHistory.set(!0),this.chatHistoryPage.set(0),this.chatHistoryAllMessages.set([])):this.chatHistoryLoadingMore.set(!0),this.selectedChatUserId.set(e);let n=this.chatHistoryPage(),o=this.chatHistoryPageSize(),r=n*o;console.log("[Frontend] Sending get-chat-history-full:",{userId:e,limit:o,offset:r}),this.ipcService.send("get-chat-history-full",{userId:e,limit:o,offset:r})}catch(n){console.error("[Frontend] Error loading chat history:",n),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}}async loadMoreChatHistory(){let e=this.selectedChatUserId();!e||this.chatHistoryLoadingMore()||!this.chatHistoryHasMore()||(this.chatHistoryPage.update(t=>t+1),await this.loadChatHistory(e,!1))}onChatHistoryScroll(e){let t=e.target;if(!t)return;let n=t.scrollTop,o=t.scrollHeight,r=t.clientHeight;o-n-r<200&&this.chatHistoryHasMore()&&!this.chatHistoryLoadingMore()&&this.loadMoreChatHistory()}async sendAiResponse(e,t){try{let n=this.generationState().lead;if(!n)return;this.ipcService.send("send-ai-response",{userId:e,message:t,accountPhone:this.senderAccounts().find(o=>o.id===this.selectedSenderId())?.phone,sourceGroup:n.sourceGroup,username:n.username}),setTimeout(()=>{this.loadChatHistory(e)},1e3)}catch(n){console.error("[Frontend] Error sending AI response:",n)}}async checkMonitoringStatus(){try{this.ipcService.send("get-monitoring-status",{})}catch(e){console.error("[Frontend] Error checking monitoring status:",e)}}async checkMonitoringHealth(){try{this.ipcService.send("check-monitoring-health",{})}catch(e){console.error("[Frontend] Error checking monitoring health:",e)}}trackByChatMessageId(e,t){return t.id||e}trackByChatId(e,t){return t.userId||e}trackByLogId(e,t){let n=0;return t.timestamp&&(t.timestamp instanceof Date?n=t.timestamp.getTime():typeof t.timestamp=="number"?n=t.timestamp:typeof t.timestamp=="string"&&(n=new Date(t.timestamp).getTime()||0)),`${t.id}-${n}-${e}`}isValidAlertDetails(e){if(!e||typeof e!="object"||e===null||Array.isArray(e))return!1;try{return Object.keys(e).length>0}catch{return!1}}safeStringify(e){try{return JSON.stringify(e,null,2)}catch{return"\u7121\u6CD5\u986F\u793A\u8A73\u60C5"}}getStatusColor(e){switch(e){case"Online":return"bg-green-500/10 text-green-400";case"Offline":return"bg-slate-500/10 text-slate-400";case"Banned":return"bg-red-500/10 text-red-400";case"Proxy Error":return"bg-orange-500/10 text-orange-400";case"Logging in...":return"bg-blue-500/10 text-blue-400 animate-pulse";case"Resting (Cooldown)":return"bg-yellow-500/10 text-yellow-400";case"Warming Up":return"bg-indigo-500/10 text-indigo-400 animate-pulse";case"New":return"bg-blue-500/10 text-blue-400";case"Contacted":return"bg-yellow-500/10 text-yellow-400";case"Replied":return"bg-green-500/10 text-green-400";case"Follow-up":return"bg-purple-500/10 text-purple-400";case"Closed-Won":return"bg-teal-500/10 text-teal-400";case"Closed-Lost":return"bg-red-500/10 text-red-400";default:return"bg-slate-700/20 text-slate-300"}}getStatusBarColor(e){switch(e){case"New":return"bg-amber-500";case"Contacted":return"bg-cyan-500";case"Replied":return"bg-purple-500";case"Follow-up":return"bg-orange-500";case"Closed-Won":return"bg-emerald-500";case"Closed-Lost":return"bg-red-500";default:return"bg-slate-500"}}getHealthColor(e){return e>80?"bg-green-500":e>50?"bg-yellow-500":"bg-red-500"}getOnlineStatusColor(e){switch(e){case"Online":return"bg-green-500";case"Recently":return"bg-yellow-500";case"Offline":return"bg-slate-500";default:return"bg-slate-400"}}getIntentLevelColor(e){switch(e){case"HOT":return"bg-red-500/20 text-red-400 border border-red-500/30";case"WARM":return"bg-orange-500/20 text-orange-400 border border-orange-500/30";case"NEUTRAL":return"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30";case"COLD":return"bg-blue-500/20 text-blue-400 border border-blue-500/30";case"NONE":return"bg-slate-500/20 text-slate-400 border border-slate-500/30";default:return"bg-slate-500/20 text-slate-400 border border-slate-500/30"}}getIntentLevelEmoji(e){switch(e){case"HOT":return"\u{1F525}";case"WARM":return"\u{1F321}\uFE0F";case"NEUTRAL":return"\u{1F610}";case"COLD":return"\u2744\uFE0F";case"NONE":return"\u26AA";default:return"\u26AA"}}handleMemberSendMessage(e){let t=this.convertMemberToLead(e);this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.first_name||e.username||e.user_id}`)}handleMemberAddToFunnel(e){let t=this.leads().find(o=>o.userId===e.user_id);if(t){this.toastService.warning(`\u26A0\uFE0F ${e.first_name||e.username||e.user_id} \u5DF2\u5728\u92B7\u552E\u6F0F\u6597\u4E2D`),this.currentView.set("leads"),setTimeout(()=>this.openLeadDetailModal(t),100);return}let n=this.convertMemberToLead(e);this.ipcService.send("add-lead",{user_id:e.user_id,username:e.username,first_name:e.first_name,last_name:e.last_name,source_chat_title:e.source_chat_title,source_chat_id:e.source_chat_id,notes:`\u5F9E\u6210\u54E1\u8CC7\u6599\u5EAB\u6DFB\u52A0 (${e.value_level}\u7D1A)`}),this.leads.update(o=>[n,...o]),this.toastService.success(`\u2705 \u5DF2\u5C07 ${e.first_name||e.username||e.user_id} \u52A0\u5165\u92B7\u552E\u6F0F\u6597`),this.currentView.set("leads")}handleResourceSendMessage(e){let t={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:"New",onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.display_name||e.username||e.telegram_id}`)}handleResourceViewDetail(e){let t="New";e.status==="converted"?t="Closed-Won":e.status==="contacted"?t="Contacted":e.status==="interested"&&(t="Replied");let n={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:t,onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(n)}handleResourceBatchSend(e){if(e.length===0)return;let t=e.map(n=>({telegramId:n.telegram_id,username:n.username||"",firstName:n.first_name,lastName:n.last_name,displayName:n.display_name||n.first_name||n.username||n.telegram_id,groupName:n.source_name||n.source_chat_title||"",keyword:n.triggered_keyword||"",source:n.source_type||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u7528\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}handleBatchSendComplete(e){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u5931\u6557 ${e.failed}`)}closeBatchSendDialog(){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([])}openBatchSendForLeads(){let e=this.leads().filter(n=>this.selectedLeadIds().has(n.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u767C\u9001\u6D88\u606F\u7684\u5BA2\u6236");return}let t=e.map(n=>({telegramId:n.userId||String(n.id),username:n.username,firstName:n.firstName,lastName:n.lastName,displayName:n.firstName||n.username||"\u672A\u77E5",groupName:n.sourceGroup||"",keyword:n.triggeredKeyword||"",source:n.sourceType||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u5BA2\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}openBatchInviteForLeads(){let e=this.leads().filter(n=>this.selectedLeadIds().has(n.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u62C9\u7FA4\u7684\u5BA2\u6236");return}let t=e.map(n=>({telegramId:n.userId||String(n.id),username:n.username,firstName:n.firstName,displayName:n.firstName||n.username||"\u672A\u77E5"}));this.batchInviteTargets.set(t),this.showBatchInviteDialogState.set(!0),this.toastService.info(`\u{1F465} \u6E96\u5099\u5C07 ${e.length} \u500B\u5BA2\u6236\u62C9\u5165\u7FA4\u7D44`)}closeBatchInviteDialog(){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([])}handleBatchInviteComplete(e){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u8DF3\u904E ${e.skipped}\uFF0C\u5931\u6557 ${e.failed}`)}openMemberExtractionDialog(e){let t={id:String(e.id),name:e.name||e.title||"\u672A\u77E5\u7FA4\u7D44",url:e.url||"",telegramId:e.telegramId||e.telegram_id||"",memberCount:e.memberCount||e.member_count||0,accountPhone:e.accountPhone,resourceType:e.resourceType||e.resource_type||"group"};this.memberExtractionGroup.set(t),this.showMemberExtractionDialog.set(!0)}closeMemberExtractionDialog(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null)}closeMemberExtractionDialogUnified(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null),this.dialogService.closeMemberExtraction()}handleMemberCountRefreshed(e){console.log("[Frontend] Member count refreshed:",e);let t=this.memberExtractionGroup();t&&t.id===e.groupId&&this.memberExtractionGroup.set(N(F({},t),{memberCount:e.memberCount})),this.monitoredGroups.update(n=>n.map(o=>String(o.id)===e.groupId?N(F({},o),{memberCount:e.memberCount,member_count:e.memberCount}):o))}handleMemberExtractionStart(e){if(this.showMemberExtractionDialog.set(!1),this.monitoringGroupsRef)this.monitoringGroupsRef.executeExtraction({limit:e.config.limit,filters:e.config.filters,advanced:e.config.advanced});else{let t=e.group,n="";if(t.url){let o=t.url.match(/t\.me\/([+\w]+)/);o&&(n=o[1])}this.ipcService.send("extract-members",{chatId:n||t.url,username:n,telegramId:t.telegramId,resourceId:t.id,groupName:t.name,phone:e.config.accountPhone||t.accountPhone||null,limit:e.config.limit===-1?void 0:e.config.limit,filters:{bots:!e.config.filters.excludeBots,onlineStatus:e.config.filters.onlineStatus,offline:e.config.filters.onlineStatus==="offline",online:e.config.filters.onlineStatus==="online",chinese:e.config.filters.hasChinese,hasUsername:e.config.filters.hasUsername,isPremium:e.config.filters.isPremium,excludeAdmins:e.config.filters.excludeAdmins},autoSave:e.config.advanced.autoSaveToResources,skipDuplicates:e.config.advanced.skipDuplicates}),this.toastService.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${t.name} \u7684\u6210\u54E1...`)}}handleMonitoringConfigAction(e){switch(e){case"goto-resource-center":this.currentView.set("resource-center");break;case"goto-accounts":this.currentView.set("monitoring-accounts");break;case"goto-keywords":this.currentView.set("keyword-sets");break;case"goto-templates":this.currentView.set("chat-templates");break;case"goto-triggers":this.currentView.set("trigger-rules");break;default:console.log("[Frontend] Unknown config action:",e)}}handleResourceSendToAISales(e){e.length!==0&&(this.ipcService.send("ai-team:add-targets",{targets:e.map(t=>({telegramId:t.telegram_id,username:t.username,displayName:t.display_name,sourceType:t.source_type}))}),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07 ${e.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165 AI \u92B7\u552E\u968A\u5217`))}handleResourceStatusChanged(e){if(!e.contacts.length)return;console.log("[Frontend] Syncing status change to leads:",e.contacts.length,"contacts, status:",e.status);let t=new Set(e.contacts.map(r=>r.telegram_id)),o={new:"New",contacted:"Contacted",interested:"Interested",negotiating:"Negotiating",converted:"Closed-Won",lost:"Closed-Lost",blocked:"Unsubscribed"}[e.status]||e.status;this.leads.update(r=>r.map(c=>t.has(String(c.userId))?N(F({},c),{status:o}):c)),this.ipcService.send("sync-resource-status-to-leads",{telegramIds:Array.from(t),status:o}),console.log("[Frontend] Status synced for",e.contacts.length,"contacts")}refreshLeadsData(){console.log("[Frontend] Refreshing leads data for resource center...");let e=this.leads();e.length>0&&(this.syncLeadsToResourceCenter(e),console.log("[Frontend] Synced current leads to resource center:",e.length)),this.leadsHasMore()&&!this.leadsLoading()?(this.loadRemainingLeads(),this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u66F4\u591A\u6578\u64DA... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3)):this.leadsLoading()?this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u4E2D... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3):this.toastService.success(`\u6578\u64DA\u5DF2\u540C\u6B65 (\u5171 ${e.length} \u689D)`)}handleCommandNavigation(e){if(!e.startsWith("action:")&&!e.startsWith("contact:")){this.currentView.set(e);return}if(e.startsWith("action:")){switch(e.replace("action:","")){case"send-message":this.toastService.info("\u8ACB\u5148\u9078\u64C7\u806F\u7E6B\u4EBA"),this.currentView.set("resource-center");break;case"extract-members":this.currentView.set("resource-center");break;case"search-groups":this.currentView.set("resource-center");break;case"start-monitor":this.startMonitoring();break;case"refresh":this.ipcService.send("get-initial-state"),this.toastService.success("\u6578\u64DA\u5DF2\u5237\u65B0");break;case"open-docs":window.open("https://docs.tg-matrix.com","_blank");break;case"show-shortcuts":this.toastService.info(`\u2318K \u6253\u958B\u547D\u4EE4\u9762\u677F
\u2318R \u5237\u65B0\u6578\u64DA
\u2318N \u6DFB\u52A0\u5E33\u865F`);break;case"open-feedback":this.toastService.info("\u8ACB\u767C\u9001\u90F5\u4EF6\u81F3 support@tg-matrix.com");break}return}if(e.startsWith("contact:")){let t=e.replace("contact:","");this.toastService.info(`\u6B63\u5728\u67E5\u770B\u806F\u7E6B\u4EBA ${t}`)}}handleMemberBatchSendMessage(e){if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let t=e.filter(n=>n.username);if(t.length===0){this.toastService.warning("\u6240\u9078\u6210\u54E1\u90FD\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u6D88\u606F");return}t.length<e.length&&this.toastService.warning(`${e.length-t.length} \u500B\u6210\u54E1\u6C92\u6709\u7528\u6236\u540D\uFF0C\u5C07\u88AB\u8DF3\u904E`),this.batchMessageTargets=t.map(n=>({userId:n.user_id,username:n.username,firstName:n.first_name,lastName:n.last_name,displayName:`${n.first_name||""} ${n.last_name||""}`.trim()||n.username})),this.showBatchMessageDialog.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${t.length} \u500B\u6210\u54E1\u767C\u9001\u6D88\u606F`)}handleNavigate(e){console.log("[Frontend] Navigate to:",e),this.currentView.set(e)}handleAIStrategyStart(e){console.log("[Frontend] AI Strategy started:",e),this.ipcService.send("execute-ai-strategy",{strategy:e}),this.currentView.set("automation"),this.toastService.success(`\u{1F680} AI \u7B56\u7565\u5DF2\u555F\u52D5: ${e.industry}`)}handleAIStrategyHandover(e){console.log("[Frontend] Handover strategy to AI Team:",e),this.aiTeamIncomingStrategy.set(e),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A: ${e.industry}`)}convertMemberToLead(e){return{id:parseInt(e.user_id)||Date.now(),userId:e.user_id,username:e.username,firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_chat_title,triggeredKeyword:"",timestamp:new Date(e.extracted_at||new Date),status:e.contacted?"Contacted":"New",onlineStatus:this.mapOnlineStatus(e.online_status),interactionHistory:[],doNotContact:!1,intentScore:this.mapValueLevelToScore(e.value_level),intentLevel:this.mapValueLevelToIntent(e.value_level),sourceType:"group_extract"}}mapOnlineStatus(e){switch(e){case"online":return"Online";case"recently":return"Recently";default:return"Offline"}}mapValueLevelToScore(e){switch(e){case"S":return 90;case"A":return 75;case"B":return 55;case"C":return 35;case"D":return 15;default:return 30}}mapValueLevelToIntent(e){switch(e){case"S":return"HOT";case"A":return"WARM";case"B":return"NEUTRAL";case"C":return"COLD";case"D":return"NONE";default:return"NEUTRAL"}}log(e,t){let n={id:Date.now(),timestamp:new Date,message:e,type:t};this.logs.update(o=>[n,...o].slice(0,100))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ie({type:i,selectors:[["app-root"]],viewQuery:function(t,n){if(t&1&&Ln(i5,5)(o5,5),t&2){let o;hn(o=fn())&&(n.onboardingComponent=o.first),hn(o=fn())&&(n.monitoringGroupsRef=o.first)}},hostBindings:function(t,n){t&1&&b("click",function(r){return n.onDocumentClick(r)},Bn)},features:[Ps([kn,me])],decls:15,vars:11,consts:[["onboardingRef",""],[1,"fixed","bottom-4","right-4","z-50"],[1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","pointer-events-none"],[3,"navigate"],[3,"closeDialog","sendComplete","isOpen","targets"],[3,"closeDialog","inviteComplete","isOpen","targets","accounts"],[3,"closeDialog","startExtractionEvent","memberCountRefreshed","isOpen","group"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"flex","h-screen",2,"background-color","var(--bg-primary)","color","var(--text-primary)"],[1,"auth-wrapper",2,"min-height","100vh","background","linear-gradient(to bottom right, #0f172a, #1e293b, #0f172a)"],[1,"group","relative"],[1,"w-3","h-3","rounded-full","bg-slate-500","cursor-default"],[1,"absolute","bottom-full","right-0","mb-2","hidden","group-hover:block"],[1,"bg-slate-800/95","backdrop-blur-sm","rounded-lg","px-3","py-2","shadow-lg","border","border-slate-700","whitespace-nowrap"],[1,"text-xs","text-slate-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-xs","text-amber-400","mt-1"],[1,"w-3","h-3","rounded-full","bg-cyan-500","animate-pulse","cursor-default"],[1,"text-xs","text-slate-300"],[1,"w-3","h-3","rounded-full","bg-amber-500","cursor-pointer",3,"click"],[1,"text-xs","text-amber-400"],[1,"w-3","h-3","rounded-full","bg-red-500","cursor-pointer","animate-pulse",3,"click"],[1,"text-xs","text-red-400"],[1,"absolute","inset-0","bg-black/40","animate-fade-in"],[1,"relative","z-10","animate-success-pop"],[1,"absolute","inset-0","-m-8","rounded-full","bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","blur-xl","animate-pulse"],[1,"relative","bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","p-8","shadow-2xl","border","border-emerald-500/30"],[1,"flex","justify-center","mb-4"],[1,"w-20","h-20","rounded-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","flex","items-center","justify-center","shadow-lg","shadow-emerald-500/30"],[1,"text-4xl","animate-bounce"],[1,"text-center"],[1,"text-xl","font-bold","text-white","mb-1"],[1,"text-sm","text-slate-400"],[1,"absolute","-top-2","-left-2","w-4","h-4","bg-emerald-400","rounded-full","animate-ping"],[1,"absolute","-top-1","-right-3","w-3","h-3","bg-cyan-400","rounded-full","animate-ping",2,"animation-delay","0.1s"],[1,"absolute","-bottom-2","-left-1","w-2","h-2","bg-emerald-300","rounded-full","animate-ping",2,"animation-delay","0.2s"],[1,"absolute","-bottom-1","-right-2","w-3","h-3","bg-cyan-300","rounded-full","animate-ping",2,"animation-delay","0.3s"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm",3,"click"],[1,"relative","z-10"],[3,"closed","loginSuccess"],[3,"navigateEvent"],[3,"show","title","progress","cancellable"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center"],[1,"backdrop-blur-sm","flex-shrink-0","flex","flex-col","sidebar","h-screen","transition-all","duration-300",2,"background-color","var(--bg-sidebar)","border-right","1px solid var(--border-default)"],[1,"flex-shrink-0"],[1,"absolute","top-3","-right-3","z-50","w-6","h-6","rounded-full","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 8px rgba(6, 182, 212, 0.4)",3,"click","title"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","text-white","transition-transform","duration-200"],["points","15 18 9 12 15 6"],[1,"flex","items-center","gap-3","p-4"],[1,"relative","flex-shrink-0"],[1,"absolute","inset-0","rounded-xl","blur-md","opacity-50",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)"],["viewBox","0 0 64 64","fill","none",1,"h-10","w-10","relative","z-10"],["d","M32 8L52 20V44L32 56L12 44V20L32 8Z","fill","url(#sidebarLogoGrad)","stroke","url(#sidebarLogoStroke)","stroke-width","1.5"],["d","M22 28L40 22L34 36L28 32L22 28Z","fill","white","opacity","0.95"],["d","M28 32L34 36L32 42L28 32Z","fill","white","opacity","0.8"],["d","M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z","fill","#fbbf24"],["cx","32","cy","8","r","1.2","fill","#fef3c7"],["id","sidebarLogoGrad","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#0891b2"],["offset","100%","stop-color","#7c3aed"],["id","sidebarLogoStroke","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#22d3ee"],["offset","100%","stop-color","#a78bfa"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","cursor-pointer","transition-all","duration-300","hover:scale-[1.02]","group",3,"click"],[1,"flex","items-center","gap-3"],[1,"avatar-wrapper","relative"],[1,"avatar-glow","absolute","inset-0","rounded-full","opacity-0","group-hover:opacity-100","transition-opacity","duration-300"],[1,"avatar-border","w-12","h-12","rounded-full","p-[2px]"],[1,"w-full","h-full","rounded-full","flex","items-center","justify-center","text-white","font-bold","text-lg","avatar-inner"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg",3,"badge-silver","badge-gold","badge-diamond","badge-star","badge-king"],[1,"flex-1","min-w-0"],[1,"text-sm","font-semibold","truncate",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-1.5","mt-0.5"],[1,"vip-tag","vip-tag-silver"],[1,"vip-tag","vip-tag-gold"],[1,"vip-tag","vip-tag-diamond"],[1,"vip-tag","vip-tag-star"],[1,"vip-tag","vip-tag-king"],[1,"vip-tag","vip-tag-bronze"],[1,"arrow-icon","transition-transform","duration-300","group-hover:translate-x-1"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4",2,"color","var(--text-muted)"],["points","9 18 15 12 9 6"],[1,"flex-1","overflow-y-auto","overflow-x-hidden","sidebar-nav","mt-2","px-2","pb-2"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","sidebar-icon"],["points","12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"],["x","3","y","3","width","7","height","7"],["x","14","y","3","width","7","height","7"],["x","14","y","14","width","7","height","7"],["x","3","y","14","width","7","height","7"],[1,"sidebar-group"],[1,"w-full","flex","items-center","justify-between","px-3","py-2","mt-2","rounded-md","hover:bg-white/5","transition-colors","cursor-pointer","group",3,"click"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","transition-transform","duration-200",2,"color","var(--sidebar-group-title)"],["points","6 9 12 15 18 9"],[1,"sidebar-group-content","overflow-hidden"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","font-semibold","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-cyan-500","to-blue-500","text-center","leading-5","text-[10px]"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-violet-500","to-fuchsia-500","text-center","leading-5","text-[10px]"],[1,"flex-shrink-0","p-4","space-y-3","border-t",2,"border-color","var(--border-default)","background-color","var(--bg-sidebar)"],[1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2.5","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10","hover:from-cyan-500/20","hover:to-blue-500/20","border","border-cyan-500/30","hover:border-cyan-500/50","text-cyan-400","rounded-xl","transition-all","text-sm","font-medium","group",3,"click"],[1,"text-lg","group-hover:animate-bounce"],[1,"block","text-sm","font-medium","mb-2",2,"color","var(--sidebar-group-title)"],[1,"flex","rounded-md","shadow-sm","p-1",2,"background-color","var(--bg-tertiary)"],[1,"w-full","text-sm","py-1.5","rounded","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"],[1,"flex-1","p-8","overflow-y-auto",2,"background-color","var(--bg-primary)"],[1,"h-full","p-6","overflow-auto"],[1,"h-full","overflow-auto"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","backdrop-blur-sm"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden",3,"click"],[1,"px-6","py-4","border-b","border-slate-700","flex","items-center","gap-3"],[1,"p-2","bg-red-500/20","rounded-lg"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-6","w-6","text-red-400"],["d","M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],[1,"text-lg","font-bold","text-white"],[1,"px-6","py-6"],[1,"text-slate-300","mb-4"],[1,"bg-red-500/10","border","border-red-500/20","rounded-lg","p-3","text-sm","text-red-300"],[1,"px-6","py-4","border-t","border-slate-700","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-red-500","hover:bg-red-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],[1,"font-bold","text-cyan-400"],[1,"font-bold","text-red-400"],[1,"p-2","bg-emerald-500/20","rounded-lg"],[1,"text-xl"],[1,"px-6","py-4","max-h-64","overflow-y-auto"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2"],[1,"px-6","py-4","border-t","border-slate-700"],[1,"w-full","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"mb-2"],[1,"text-cyan-400","hover:underline","text-sm",3,"click"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group",3,"click"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-white","group-hover:text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-emerald-400","opacity-0","group-hover:opacity-100","transition-opacity"],[1,"text-xl","font-bold","bg-gradient-to-r","from-cyan-400","to-purple-400","bg-clip-text","text-transparent"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg"],[1,"animate-pulse"],[1,"animate-bounce"],[1,"vip-icon"],[1,"vip-text"],["data-tour","accounts",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["d","M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"],["cx","9","cy","7","r","4"],["d","M23 21v-2a4 4 0 0 0-3-3.87"],["d","M16 3.13a4 4 0 0 1 0 7.75"],["data-tour","search-discovery",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","11","cy","11","r","8"],["d","M21 21l-4.35-4.35"],[1,"absolute","right-2","px-1.5","py-0.5","text-[10px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","12","cy","5","rx","9","ry","3"],["d","M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"],["d","M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"],["d","M22 2L11 13"],["d","M22 2L15 22L11 13L2 9L22 2Z"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1","relative","group",3,"click"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","transition-all"],[1,"text-lg"],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-[10px]","opacity-60"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],[1,"text-lg","ml-1"],[1,"ml-auto","text-xs","px-1.5","py-0.5","bg-violet-500/20","text-violet-400","rounded"],["data-tour","ai-assistant",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-orange-500","to-amber-500","text-white","rounded-full","font-bold","shadow-lg","shadow-orange-500/20"],[1,"absolute","right-2","text-xs"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-full","font-bold","shadow-lg","shadow-purple-500/20"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold","shadow-lg","shadow-cyan-500/20"],["d","M18 20V10"],["d","M12 20V4"],["d","M6 20v-6"],["d","M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"],["cx","12","cy","12","r","4"],[1,"ml-auto","px-1.5","py-0.5","text-xs","bg-pink-500/20","text-pink-400","rounded"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click","title"],[1,"ml-auto","text-xs","opacity-60"],[1,"knowledge-menu"],[1,"flex-1"],[1,"text-xs","transition-transform","duration-200"],[1,"pl-6","space-y-1"],["d","M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"],[1,"sidebar-item","flex","items-center","gap-2","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","text-sm",3,"click"],[1,"sidebar-item","flex","items-center","gap-2","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","text-sm","relative",3,"click"],[1,"ml-auto","text-xs","font-bold","rounded-full","px-1.5","py-0.5",2,"background-color","rgba(239, 68, 68, 0.2)","color","#f87171"],["cx","12","cy","12","r","3"],["d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"],[3,"accountAdded","back"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-gradient-to-br","from-slate-900","via-slate-900","to-slate-800","border","border-cyan-500/30","rounded-2xl","shadow-2xl","shadow-cyan-500/10","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","text-slate-200",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/10","via-blue-500/10","to-purple-500/10","border-b","border-cyan-500/20","p-5"],[1,"flex","justify-between","items-start"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold","text-xl","shadow-lg","shadow-cyan-500/30"],[1,"flex","items-center","gap-2"],[1,"text-xl","font-bold","text-white"],[1,"h-2.5","w-2.5","rounded-full","animate-pulse"],[1,"text-sm","text-cyan-400"],[1,"flex","items-center","gap-2","mt-1","flex-wrap"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-purple-500/20","text-purple-400","border","border-purple-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-cyan-500/20","text-cyan-400","border","border-cyan-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full",3,"class"],[1,"text-slate-400","hover:text-white","text-2xl","leading-none","transition-colors","p-2","hover:bg-white/10","rounded-lg",3,"click"],[1,"border-b","border-cyan-500/20","bg-slate-900/50"],["aria-label","Tabs",1,"flex","px-5"],[1,"whitespace-nowrap","py-3","px-4","border-b-2","border-transparent","font-medium","text-sm","cursor-pointer","text-slate-400","hover:text-cyan-400","hover:bg-cyan-500/5","transition-all","rounded-t-lg","flex","items-center","gap-2",3,"click"],[1,"overflow-y-auto","max-h-[calc(90vh-220px)]","p-5"],[1,"space-y-4"],[1,"py-4"],[1,"text-xs","px-2","py-0.5","rounded-full"],[1,"bg-slate-800/50","rounded-xl","p-4","border","border-slate-700/50"],[1,"block","text-sm","font-medium","text-cyan-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","focus:border-cyan-500",3,"ngModelChange","ngModel"],["value",""],[1,"mt-2","p-2","bg-amber-500/10","border","border-amber-500/30","rounded-lg"],[1,"grid","grid-cols-3","gap-3"],[1,"cursor-pointer","p-3","rounded-xl","border-2","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"text-sm","font-medium"],[1,"space-y-3"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-cyan-400"],[1,"text-xs","text-slate-500","bg-slate-700/50","px-2","py-1","rounded"],["rows","5",1,"form-textarea","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-3","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","resize-none","placeholder-slate-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","gap-3","flex-wrap"],[1,"flex","items-center","gap-2","bg-slate-800/50","hover:bg-cyan-500/20","text-slate-300","hover:text-cyan-400","text-sm","font-medium","py-2","px-4","rounded-lg","transition-all","border","border-slate-700/50","hover:border-cyan-500/30",3,"click"],[1,"p-3","rounded-xl","bg-cyan-500/10","border","border-cyan-500/30"],[1,"p-3","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-3","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"flex","justify-between","items-center","pt-4","border-t","border-cyan-500/20"],[1,"text-sm","text-red-400","hover:text-red-300","disabled:text-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-1.5","px-3","py-2","rounded-lg","hover:bg-red-500/10","transition-all",3,"click","disabled"],[1,"flex","gap-3"],[1,"bg-slate-700/80","hover:bg-slate-600","text-slate-300","font-medium","py-2.5","px-5","rounded-xl","transition-all","border","border-slate-600/50","hover:border-slate-500",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-400","hover:to-blue-400","text-white","font-bold","py-2.5","px-6","rounded-xl","shadow-lg","shadow-cyan-500/30","disabled:from-slate-500","disabled:to-slate-600","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2","transition-all",3,"click","disabled"],[3,"value"],[1,"text-xs","text-cyan-400","hover:underline","cursor-pointer","mt-1","inline-block",3,"click"],[1,"flex","items-center","justify-between","p-2","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg"],[1,"text-xs","text-green-400"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-2","py-1","rounded"],[1,"p-2","bg-cyan-500/10","border","border-cyan-500/20","rounded-lg","text-xs","text-slate-400"],[1,"block","text-sm","font-medium","text-slate-500","dark:text-slate-400","mb-1"],["rows","2",1,"form-textarea","w-full","bg-slate-200/50","dark:bg-slate-800/50","border-slate-300","dark:border-slate-700","rounded-lg","py-2","px-3","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","justify-center","gap-3"],[1,"bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","text-white","font-bold","py-2","px-6","rounded-lg","transition","duration-200","shadow-lg","disabled:from-slate-400","disabled:to-slate-500","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg"],[1,"p-3","bg-amber-500/10","border","border-amber-500/20","text-amber-400","rounded-lg","text-sm","text-center"],[1,"p-3","bg-red-500/10","border","border-red-500/20","text-red-400","rounded-lg","text-sm"],[1,"p-3","bg-green-500/10","border","border-green-500/20","rounded-lg"],[1,"text-cyan-400"],[1,"animate-spin"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg",3,"click"],[1,"text-cyan-400","hover:underline","cursor-pointer","ml-1",3,"click"],[1,"ml-2","text-cyan-400","hover:underline",3,"click"],[1,"text-xs","text-green-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"change"],[1,"flex","items-center","gap-2","bg-green-500/20","hover:bg-green-500/30","text-green-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-green-500/30",3,"click"],[1,"flex","items-center","gap-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-red-500/30",3,"click"],[1,"text-sm","text-cyan-400","font-medium"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"flex","items-center","justify-between","text-sm","bg-slate-800/50","rounded-lg","px-3","py-2"],[1,"flex","items-center","gap-2","truncate","flex-1","min-w-0"],[1,"text-green-400"],[1,"text-blue-400"],[1,"truncate","text-white"],[1,"text-slate-500","text-xs","whitespace-nowrap"],[1,"text-green-500","text-xs"],[1,"text-red-400","hover:text-red-300","text-lg","font-bold","p-1","hover:bg-red-500/20","rounded","ml-2",3,"click"],[1,"text-sm","text-amber-400"],[1,"text-sm","text-red-400"],[1,"mb-4","flex","items-center","justify-between"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","font-bold","py-2","px-4","rounded-lg","text-sm","disabled:bg-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4"],[1,"h-96","overflow-y-auto"],[1,"space-y-3","mb-4"],[1,"text-center","py-8"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-cyan-500/20"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4",3,"scroll"],[1,"text-center","py-4"],[1,"text-center","py-2"],[1,"flex","justify-start"],[1,"flex","justify-end"],[1,"max-w-[75%]"],[1,"bg-slate-700","text-white","rounded-2xl","rounded-bl-sm","px-4","py-2"],[1,"text-sm"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","rounded-2xl","rounded-br-sm","px-4","py-2","shadow-lg"],[1,"flex","items-center","justify-end","gap-2","mt-1"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-1.5","py-0.5","rounded"],[1,"animate-spin","text-cyan-400"],[1,"ml-2","text-sm","text-slate-500"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","justify-center"],[1,"bg-slate-800/50","text-slate-400","text-xs","px-3","py-1","rounded-full"],[1,"text-4xl","mb-2"],[1,"text-slate-500","dark:text-slate-400"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-sm","font-medium","text-cyan-400","mb-2","flex","items-center","gap-2"],[1,"grid","grid-cols-3","gap-2","text-center","text-xs"],[1,"p-2","bg-slate-700/50","rounded"],[1,"text-slate-400"],[1,"text-sm","font-bold","text-cyan-400"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","backdrop-blur-sm",3,"click"],[1,"bg-slate-100","dark:bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-300","dark:border-slate-700","w-full","max-w-3xl","max-h-[80vh]","overflow-hidden",3,"click"],[1,"p-4","border-b","border-slate-300","dark:border-slate-700","flex","items-center","justify-between","bg-slate-200/50","dark:bg-slate-800/50"],[1,"text-lg","font-bold","text-slate-900","dark:text-white","flex","items-center","gap-2"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-purple-500"],["d","M3 3v5h5"],["d","M3.05 13A9 9 0 1 0 6 5.3L3 8"],["d","M12 7v5l4 2"],[1,"text-slate-500","hover:text-slate-700","dark:text-slate-400","dark:hover:text-white",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"p-4","overflow-y-auto","max-h-[60vh]"],[1,"text-center","py-8","text-slate-500"],[1,"p-4","border-t","border-slate-300","dark:border-slate-700","bg-slate-200/50","dark:bg-slate-800/50","flex","justify-end"],[1,"px-4","py-2","bg-slate-300","dark:bg-slate-700","hover:bg-slate-400","dark:hover:bg-slate-600","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-12","w-12","mx-auto","mb-3","text-slate-400"],["cx","12","cy","12","r","10"],["d","M12 8v4l3 3"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700",3,"opacity-50"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700"],[1,"p-2","rounded-lg"],[1,"font-medium","text-slate-900","dark:text-white"],[1,"text-yellow-500","ml-2"],[1,"text-red-400","ml-2"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded",3,"click"],[1,"bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","shadow-2xl","w-full","max-w-2xl","mx-4","overflow-hidden","border","border-cyan-500/30"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","p-6","text-center"],[1,"text-3xl","font-bold","text-white","mb-2"],[1,"text-cyan-100"],[1,"flex","justify-center","gap-2","py-4","bg-slate-800/50"],[1,"w-3","h-3","rounded-full","transition-all"],[1,"p-6"],[1,"text-center","space-y-6"],[1,"p-6","bg-slate-800/50","flex","justify-between","items-center"],[1,"text-sm","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all"],[1,"grid","grid-cols-3","gap-4","mb-6"],[1,"p-4","bg-slate-700/50","rounded-xl"],[1,"text-3xl","mb-2"],[1,"text-sm","font-medium","text-white"],[1,"text-slate-300"],[1,"text-lg","font-semibold","text-white","text-center","mb-4"],[1,"p-4","rounded-xl"],[1,"text-2xl"],[1,"font-medium","text-white"],[1,"px-3","py-1","bg-slate-700","hover:bg-slate-600","rounded","text-sm","text-white","disabled:opacity-50",3,"click","disabled"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300","space-y-2"],[1,"block","bg-slate-800","p-2","rounded","text-cyan-400","text-xs"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-cyan-500","rounded",3,"change","checked"],[1,"text-sm","text-slate-300"],[1,"mt-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded","py-1","px-2","text-sm","text-white",3,"ngModelChange","ngModel"],["value","gemini"],["value","openai"],[1,"text-6xl","mb-4"],[1,"text-2xl","font-bold","text-white"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30"],[1,"text-sm","text-slate-300","space-y-1"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-amber-500/50"],[1,"bg-amber-500/20","p-6","text-center","border-b","border-amber-500/30"],[1,"text-5xl","mb-3"],[1,"text-xl","font-bold","text-amber-400"],[1,"text-slate-400","text-sm","mt-2"],[1,"p-6","space-y-4"],[1,"text-slate-300","text-sm"],[1,"bg-slate-700/50","rounded-lg","p-3","max-h-48","overflow-y-auto","space-y-2"],[1,"flex","items-center","justify-between","p-2","bg-slate-600/50","rounded-lg"],[1,"bg-blue-500/10","border","border-blue-500/30","rounded-lg","p-3"],[1,"text-blue-400","text-sm"],[1,"p-4","bg-slate-700/30","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-amber-500","hover:bg-amber-600","disabled:opacity-50","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click","disabled"],[1,"text-white","font-medium"],[1,"text-green-400","text-xs"],[1,"text-amber-400","text-xs"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-red-500/50"],[1,"bg-red-500/20","p-6","text-center","border-b","border-red-500/30"],[1,"text-xl","font-bold","text-red-400"],[1,"bg-slate-700/50","rounded-lg","p-4","space-y-3"],[1,"flex","items-start","gap-3"],["href","https://www.python.org/downloads/","target","_blank",1,"text-cyan-400","text-sm","hover:underline"],[1,"text-slate-400","text-sm"],[1,"block","bg-slate-800","text-green-400","text-sm","p-2","rounded","mt-1"],[1,"bg-red-500/10","border","border-red-500/30","rounded-lg","p-3"],[1,"text-red-400","text-sm"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600",3,"click"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden","border","border-cyan-500/30",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/20","to-blue-500/20","p-4","border-b","border-slate-700/50"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],[1,"block","text-sm","text-slate-400","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u8CB7\u5BB6\u610F\u5411\u3001\u7522\u54C1\u8AEE\u8A62...","autofocus","",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-lg","px-4","py-3","text-white","focus:border-cyan-500","focus:ring-1","focus:ring-cyan-500","transition-colors",3,"input","keyup.enter","value"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","transition-colors","font-medium",3,"click"]],template:function(t,n){t&1&&(k(0,"app-toast")(1,"app-global-confirm-dialog")(2,"app-global-input-dialog"),w(3,p5,5,1,"div",1),w(4,h5,17,3,"div",2),s(5,"app-command-palette",3),b("navigate",function(r){return n.handleCommandNavigation(r)}),a(),s(6,"app-batch-send-dialog",4),b("closeDialog",function(){return n.dialogService.closeBatchSend()})("sendComplete",function(r){return n.handleBatchSendComplete(r)}),a(),s(7,"app-batch-invite-dialog",5),b("closeDialog",function(){return n.dialogService.closeBatchInvite()})("inviteComplete",function(r){return n.handleBatchInviteComplete(r)}),a(),s(8,"app-member-extraction-dialog",6),b("closeDialog",function(){return n.closeMemberExtractionDialogUnified()})("startExtractionEvent",function(r){return n.handleMemberExtractionStart(r)})("memberCountRefreshed",function(r){return n.handleMemberCountRefreshed(r)}),a(),k(9,"app-membership-dialog")(10,"app-payment")(11,"app-upgrade-prompt"),w(12,f5,4,0,"div",7),w(13,C3,179,124,"div",8)(14,v3,2,0,"div",9)),t&2&&(d(3),E(n.backendConnectionState()!=="connected"||!n.offlineCache.isOnline()?3:-1),d(),E(n.showSuccessOverlay()?4:-1),d(2),V("isOpen",n.dialogService.showBatchMessageDialog())("targets",n.dialogService.batchSendTargets()),d(),V("isOpen",n.dialogService.showBatchInviteDialog())("targets",n.dialogService.batchInviteTargets())("accounts",n.accounts()),d(),V("isOpen",n.dialogService.showMemberExtractionDialog()||n.showMemberExtractionDialog())("group",n.dialogService.memberExtractionGroup()||n.memberExtractionGroup()),d(4),E(n.showQrLoginDialog()?12:-1),d(),E(n.isAuthenticated()?13:14))},dependencies:[oe,ue,He,Ke,xe,nt,fe,_e,qs,_a,Ca,va,xa,ba,ya,wa,Ma,Ta,Ia,go,bo,So,yo,Sa,Ao,Do,Mo,xo,To,ko,Po,Fo,ji,eo,to,no,io,oo,ro,uo,mo,po,ho,_o,Co,vo,Vs],styles:['[_nghost-%COMP%]     .highlight-pulse{animation:_ngcontent-%COMP%_highlight-pulse 1.5s ease-in-out 2}@keyframes _ngcontent-%COMP%_highlight-pulse{0%,to{box-shadow:0 0 #06b6d400;border-color:inherit}50%{box-shadow:0 0 20px 5px #06b6d480;border-color:#06b6d4}}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_success-pop{0%{transform:scale(.5);opacity:0}50%{transform:scale(1.1)}to{transform:scale(1);opacity:1}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .3s ease-out forwards}.animate-success-pop[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_success-pop .5s cubic-bezier(.68,-.55,.265,1.55) forwards}[_nghost-%COMP%]     .page-content{animation:_ngcontent-%COMP%_page-fade-in .3s ease-out}@keyframes _ngcontent-%COMP%_page-fade-in{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}[_nghost-%COMP%]     .card-hover{transition:all .2s ease}[_nghost-%COMP%]     .card-hover:hover{transform:translateY(-2px);box-shadow:0 8px 25px -5px #0000004d}[_nghost-%COMP%]     .sidebar-item{position:relative;overflow:hidden}[_nghost-%COMP%]     .sidebar-item:before{content:"";position:absolute;left:0;top:50%;width:3px;height:0;background:linear-gradient(to bottom,#06b6d4,#8b5cf6);transition:height .2s ease;transform:translateY(-50%);border-radius:0 2px 2px 0}[_nghost-%COMP%]     .sidebar-item:hover:before, [_nghost-%COMP%]     .sidebar-item.active:before{height:60%}[_nghost-%COMP%]     .btn-ripple{position:relative;overflow:hidden}[_nghost-%COMP%]     .btn-ripple:after{content:"";position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none;background-image:radial-gradient(circle,#fff 10%,transparent 10.01%);background-repeat:no-repeat;background-position:50%;transform:scale(10);opacity:0;transition:transform .5s,opacity .5s}[_nghost-%COMP%]     .btn-ripple:active:after{transform:scale(0);opacity:.3;transition:0s}[_nghost-%COMP%]     .animate-number{animation:_ngcontent-%COMP%_number-pop .3s ease-out}@keyframes _ngcontent-%COMP%_number-pop{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}[_nghost-%COMP%]     .gradient-border{position:relative;background:linear-gradient(var(--card-bg),var(--card-bg)) padding-box,linear-gradient(135deg,#06b6d4,#8b5cf6) border-box;border:1px solid transparent}'],changeDetection:0})}};var x3={dashboard:{},accounts:{},settings:{},leads:{requiredFeature:"leadManagement",membershipLevel:"bronze",membershipMessage:"\u6F5B\u5728\u5BA2\u6236\u7BA1\u7406\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},automation:{requiredFeature:"automation",membershipLevel:"silver",membershipMessage:"\u81EA\u52D5\u5316\u4E2D\u5FC3\u9700\u8981\u767D\u9280\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"resource-discovery":{requiredFeature:"resourceDiscovery",membershipLevel:"bronze",membershipMessage:"\u8CC7\u6E90\u767C\u73FE\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"ai-center":{requiredFeature:"aiCenter",membershipLevel:"gold",membershipMessage:"AI \u4E2D\u5FC3\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"multi-role":{requiredFeature:"multiRole",membershipLevel:"diamond",membershipMessage:"\u591A\u89D2\u8272\u5354\u4F5C\u9700\u8981\u947D\u77F3\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},analytics:{requiredFeature:"dataInsightsBasic",membershipLevel:"gold",membershipMessage:"\u6578\u64DA\u5206\u6790\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},monitoring:{}},Uc={free:0,bronze:1,silver:2,gold:3,diamond:4,star:5,king:6};function b3(i,e){let t=Uc[i]??0,n=Uc[e]??0;return t>=n}var Rt=(i,e)=>{let t=B(Ue),n=B(me),o=B(Un);if(t.level()==="king")return!0;let c=i.routeConfig?.path||"",m=x3[c];if(!m||!m.requiredFeature&&!m.membershipLevel)return!0;if(m.requiredFeature&&!t.hasFeature(m.requiredFeature))return n.warning(m.membershipMessage||"\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD"),o.navigate(["/dashboard"]),!1;if(m.membershipLevel){let h=t.membership()?.level||"free";if(!b3(h,m.membershipLevel))return n.warning(m.membershipMessage||"\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD"),o.navigate(["/dashboard"]),!1}return!0};var qc=[{path:"auth",loadChildren:()=>import("./chunk-AMBYG3VM.js").then(i=>i.AUTH_ROUTES)},{path:"login",redirectTo:"auth/login",pathMatch:"full"},{path:"register",redirectTo:"auth/register",pathMatch:"full"},{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-U2FRFDXB.js").then(i=>i.DashboardViewComponent),title:"\u5100\u8868\u677F",canActivate:[bt]},{path:"accounts",loadComponent:()=>import("./chunk-ZIKTH3K3.js").then(i=>i.AccountsViewComponent),title:"\u5E33\u865F\u7BA1\u7406",canActivate:[bt]},{path:"settings",loadComponent:()=>import("./chunk-N7CUFQKH.js").then(i=>i.SettingsViewComponent),title:"\u8A2D\u5B9A",canActivate:[bt]},{path:"user-settings",loadComponent:()=>import("./chunk-HRJWECC3.js").then(i=>i.UserSettingsViewComponent),title:"\u7528\u6236\u8A2D\u7F6E",canActivate:[bt]},{path:"upgrade",loadComponent:()=>import("./chunk-JKWLUSIN.js").then(i=>i.UpgradeViewComponent),title:"\u5347\u7D1A\u65B9\u6848",canActivate:[bt]},{path:"quota",loadComponent:()=>import("./chunk-5FGLTPXL.js").then(i=>i.QuotaDashboardViewComponent),title:"\u914D\u984D\u7BA1\u7406",canActivate:[bt]},{path:"billing",loadComponent:()=>import("./chunk-FNOGZZWL.js").then(i=>i.BillingViewComponent),title:"\u8A08\u8CBB\u7BA1\u7406",canActivate:[bt]},{path:"payment",loadComponent:()=>import("./chunk-DAHT6XX7.js").then(i=>i.PaymentViewComponent),title:"\u652F\u4ED8\u4E2D\u5FC3",canActivate:[bt]},{path:"leads",loadComponent:()=>import("./chunk-3JWOLB7Q.js").then(i=>i.LeadsViewComponent),title:"\u6F5B\u5728\u5BA2\u6236",canActivate:[Rt]},{path:"automation",loadComponent:()=>import("./chunk-VMQ67BLJ.js").then(i=>i.AutomationViewComponent),title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",canActivate:[Rt]},{path:"resource-discovery",loadComponent:()=>import("./chunk-S5FVEYIJ.js").then(i=>i.ResourceDiscoveryViewComponent),title:"\u8CC7\u6E90\u767C\u73FE",canActivate:[Rt]},{path:"marketing-hub",loadComponent:()=>import("./chunk-FGRBJCWQ.js").then(i=>i.SmartMarketingViewComponent),title:"\u71DF\u92B7\u4EFB\u52D9\u4E2D\u5FC3",canActivate:[Rt]},{path:"role-library",loadComponent:()=>import("./chunk-I6KJ4554.js").then(i=>i.MultiRoleViewComponent),title:"\u89D2\u8272\u8CC7\u6E90\u5EAB",canActivate:[Rt]},{path:"ai-engine",loadComponent:()=>import("./chunk-Z3B76O2P.js").then(i=>i.AiCenterViewComponent),title:"\u667A\u80FD\u5F15\u64CE",canActivate:[Rt]},{path:"ai-center",redirectTo:"ai-engine",pathMatch:"full"},{path:"multi-role",redirectTo:"role-library",pathMatch:"full"},{path:"smart-marketing",redirectTo:"marketing-hub",pathMatch:"full"},{path:"analytics",loadComponent:()=>import("./chunk-YJMJUFDV.js").then(i=>i.AnalyticsViewComponent),title:"\u6578\u64DA\u5206\u6790",canActivate:[Rt]},{path:"monitoring",loadComponent:()=>import("./chunk-FXWTRQHB.js").then(i=>i.MonitoringViewComponent),title:"\u76E3\u63A7\u4E2D\u5FC3"},{path:"performance",redirectTo:"settings",pathMatch:"full"},{path:"alerts",redirectTo:"settings",pathMatch:"full"},{path:"**",redirectTo:"dashboard"}],S3={dashboard:"/dashboard",accounts:"/accounts",settings:"/settings","marketing-hub":"/marketing-hub","marketing-tasks":"/marketing-hub","marketing-monitor":"/marketing-hub","role-library":"/role-library","role-store":"/role-library","my-roles":"/role-library","scene-templates":"/role-library","script-editor":"/role-library","ai-engine":"/ai-engine","ai-models":"/ai-engine","ai-brain":"/ai-engine","ai-persona":"/ai-engine",automation:"/automation","monitoring-groups":"/monitoring","keyword-sets":"/monitoring","trigger-rules":"/monitoring","chat-templates":"/monitoring","collected-users":"/monitoring",leads:"/leads","lead-nurturing":"/leads","member-database":"/leads","user-tracking":"/leads",analytics:"/analytics","analytics-center":"/analytics","search-discovery":"/resource-discovery",monitoring:"/monitoring",performance:"/settings",alerts:"/settings","ai-center":"/ai-engine","multi-role":"/role-library","smart-marketing":"/marketing-hub"},b7=Object.entries(S3).reduce((i,[e,t])=>(i[t]=e,i),{});console.log("[Bootstrap] index.tsx loaded, starting Angular bootstrap...");console.log("[Bootstrap] Angular imports completed");console.log("[Bootstrap] AppComponent and routes imported, calling bootstrapApplication...");Os(Ro,{providers:[Rs(),Gs(),Dl(),$s(qc)]}).then(()=>{console.log("[TG-AI\u667A\u63A7\u738B] Application started successfully"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[TG-AI\u667A\u63A7\u738B] angular-ready event dispatched")},50)}).catch(i=>{console.error("[TG-AI\u667A\u63A7\u738B] Application failed to start:",i);let e=document.getElementById("app-loading"),t=document.getElementById("error-container"),n=document.getElementById("error-message"),o=document.getElementById("loading-status"),r=document.getElementById("loading-progress");o&&(o.textContent="\u8F09\u5165\u5931\u6557"),r&&(r.style.background="#ef4444",r.style.width="100%"),t&&(t.style.display="block"),n&&(n.textContent="\u932F\u8AA4: "+(i?.message||i))});
