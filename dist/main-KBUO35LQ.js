import{a as He}from"./chunk-LKDVYEXP.js";import{a as gl}from"./chunk-VRXCIZIX.js";import{a as xt}from"./chunk-3YDZENAI.js";import{a as il,b as rl}from"./chunk-2NCS3Z33.js";import{b as nl,f as ol}from"./chunk-U6TMQBR5.js";import{a as sl}from"./chunk-2CISY3UY.js";import{a as Sa,b as al}from"./chunk-2OA7LACJ.js";import{a as cl}from"./chunk-WSS7XQIP.js";import{a as dl}from"./chunk-2EORXRVT.js";import{a as ul}from"./chunk-ZAJDT53A.js";import{a as ml}from"./chunk-7CYSJ7XL.js";import{a as pl}from"./chunk-MH73GVDM.js";import{a as ll}from"./chunk-JKWWU3OM.js";import{a as Ja}from"./chunk-CLBGTLIH.js";import{b as Wa}from"./chunk-HCWSPVSO.js";import{a as Qa}from"./chunk-E5QESGOH.js";import{a as Ya}from"./chunk-LTZ7XG57.js";import{a as ii,b as Xa}from"./chunk-BM5OI7EY.js";import{a as Za}from"./chunk-OBZBMA5D.js";import"./chunk-OO4LYYQ2.js";import{a as ja,b as el}from"./chunk-G6HU2XLB.js";import{a as tl}from"./chunk-C2SSRUUS.js";import{a as we,b as ut,c as ba,d as pr,e as zt,f as Zn,g as kn,h as bt,i as Ta,j as ka,k as Ia,l as Fa,m as Na,n as Ra,o as Oa,q as Ba,r as Va,s as La,t as Ga,u as Ua,v as qa,w as $a,x as Ha,y as za}from"./chunk-JVCW4UCO.js";import{c as Ka}from"./chunk-YQZANNAS.js";import{a as _a,b as Ca,d as xa,e as It,g as ya}from"./chunk-PHWS6WVI.js";import{a as wa,b as Ea,c as ni}from"./chunk-6CC5VJPY.js";import{a as gr}from"./chunk-SIDS6FGB.js";import"./chunk-SHW2YL4T.js";import"./chunk-GQQBGSXN.js";import{b as va}from"./chunk-V2IXOMTS.js";import{a as Pa}from"./chunk-AHIGNWD7.js";import{a as ue,b as Re,c as Da,d as sn,e as Ma}from"./chunk-ITEZR6M3.js";import{a as ye}from"./chunk-3V3KVMT4.js";import{a as Aa,b as Xe}from"./chunk-CXXWQ5XE.js";import{b as rn}from"./chunk-BBG7G54H.js";import{a as nn,b as xe,c as _e,f as Ce,h as jn,i as on,k as lt,l as Qe,m as Ye,n as ei,o as ti,s as Pt,t as me}from"./chunk-36YFMG3E.js";import{$ as Jn,$a as w,Aa as c,Ab as Y,B as ia,Bb as st,Ea as aa,Eb as z,F as oa,Fb as K,Ga as la,Gb as W,Hb as ua,Ib as ma,J as Ae,Jb as kt,Lb as pa,M as be,Mb as $t,Na as ee,Nb as ur,Ob as ke,Pb as Ne,Q as Ke,Qa as ca,Qb as Ht,R as O,Rb as Yn,Sa as da,Ub as ga,Vb as G,W as v,X as b,Xb as Me,Y as ne,Ya as Et,Yb as at,Z as ge,Za as dr,Zb as mr,_a as S,_b as en,a as F,ab as vt,b as B,bb as Pe,c as Kn,ca as ot,cb as $,da as We,db as H,eb as V,fb as r,g as Wn,ga as _,gb as s,h as ta,hb as k,ia as Dn,ib as P,jb as N,kb as Ge,lb as M,mb as Je,mc as ha,na as ra,nb as x,nc as Xn,o as sr,ob as oe,oc as tn,pb as g,pc as fa,qb as Qn,qc as te,rb as Mn,sa as cr,sb as Tn,ub as X,v as ar,vb as I,w as na,wa as Ut,wb as de,x as lr,xb as l,ya as sa,yb as A,za as qt,zb as D}from"./chunk-YLSLTE5F.js";function hl(i){return new Ae(3e3,!1)}function Nd(){return new Ae(3100,!1)}function Rd(){return new Ae(3101,!1)}function Od(i){return new Ae(3001,!1)}function Bd(i){return new Ae(3003,!1)}function Vd(i){return new Ae(3004,!1)}function _l(i,e){return new Ae(3005,!1)}function Cl(){return new Ae(3006,!1)}function vl(){return new Ae(3007,!1)}function bl(i,e){return new Ae(3008,!1)}function xl(i){return new Ae(3002,!1)}function yl(i,e,t,n,o){return new Ae(3010,!1)}function Sl(){return new Ae(3011,!1)}function wl(){return new Ae(3012,!1)}function El(){return new Ae(3200,!1)}function Al(){return new Ae(3202,!1)}function Dl(){return new Ae(3013,!1)}function Ml(i){return new Ae(3014,!1)}function Tl(i){return new Ae(3015,!1)}function kl(i){return new Ae(3016,!1)}function Il(i,e){return new Ae(3404,!1)}function Ld(i){return new Ae(3502,!1)}function Pl(i){return new Ae(3503,!1)}function Fl(){return new Ae(3300,!1)}function Nl(i){return new Ae(3504,!1)}function Rl(i){return new Ae(3301,!1)}function Ol(i,e){return new Ae(3302,!1)}function Bl(i){return new Ae(3303,!1)}function Vl(i,e){return new Ae(3400,!1)}function Ll(i){return new Ae(3401,!1)}function Gl(i){return new Ae(3402,!1)}function Ul(i,e){return new Ae(3505,!1)}function At(i){switch(i.length){case 0:return new zt;case 1:return i[0];default:return new Zn(i)}}function Cr(i,e,t=new Map,n=new Map){let o=[],a=[],d=-1,m=null;if(e.forEach(f=>{let h=f.get("offset"),C=h==d,y=C&&m||new Map;f.forEach((E,T)=>{let R=T,L=E;if(T!=="offset")switch(R=i.normalizePropertyName(R,o),L){case kn:L=t.get(T);break;case ut:L=n.get(T);break;default:L=i.normalizeStyleValue(T,R,L,o);break}y.set(R,L)}),C||a.push(y),m=y,d=h}),o.length)throw Ld(o);return a}function oi(i,e,t,n){switch(e){case"start":i.onStart(()=>n(t&&hr(t,"start",i)));break;case"done":i.onDone(()=>n(t&&hr(t,"done",i)));break;case"destroy":i.onDestroy(()=>n(t&&hr(t,"destroy",i)));break}}function hr(i,e,t){let n=t.totalTime,o=!!t.disabled,a=ri(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,n??i.totalTime,o),d=i._data;return d!=null&&(a._data=d),a}function ri(i,e,t,n,o="",a=0,d){return{element:i,triggerName:e,fromState:t,toState:n,phaseName:o,totalTime:a,disabled:!!d}}function Ze(i,e,t){let n=i.get(e);return n||i.set(e,n=t),n}function vr(i){let e=i.indexOf(":"),t=i.substring(1,e),n=i.slice(e+1);return[t,n]}var Gd=typeof document>"u"?null:document.documentElement;function si(i){let e=i.parentNode||i.host||null;return e===Gd?null:e}function Ud(i){return i.substring(1,6)=="ebkit"}var Kt=null,fl=!1;function ql(i){Kt||(Kt=qd()||{},fl=Kt.style?"WebkitAppearance"in Kt.style:!1);let e=!0;return Kt.style&&!Ud(i)&&(e=i in Kt.style,!e&&fl&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in Kt.style)),e}function qd(){return typeof document<"u"?document.body:null}function br(i,e){for(;e;){if(e===i)return!0;e=si(e)}return!1}function xr(i,e,t){if(t)return Array.from(i.querySelectorAll(e));let n=i.querySelector(e);return n?[n]:[]}var $d=1e3,yr="{{",Hd="}}",Sr="ng-enter",ai="ng-leave",In="ng-trigger",Pn=".ng-trigger",wr="ng-animating",li=".ng-animating";function yt(i){if(typeof i=="number")return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:fr(parseFloat(e[1]),e[2])}function fr(i,e){switch(e){case"s":return i*$d;default:return i}}function Fn(i,e,t){return i.hasOwnProperty("duration")?i:Kd(i,e,t)}var zd=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function Kd(i,e,t){let n,o=0,a="";if(typeof i=="string"){let d=i.match(zd);if(d===null)return e.push(hl(i)),{duration:0,delay:0,easing:""};n=fr(parseFloat(d[1]),d[2]);let m=d[3];m!=null&&(o=fr(parseFloat(m),d[4]));let f=d[5];f&&(a=f)}else n=i;if(!t){let d=!1,m=e.length;n<0&&(e.push(Nd()),d=!0),o<0&&(e.push(Rd()),d=!0),d&&e.splice(m,0,hl(i))}return{duration:n,delay:o,easing:a}}function $l(i){return i.length?i[0]instanceof Map?i:i.map(e=>new Map(Object.entries(e))):[]}function mt(i,e,t){e.forEach((n,o)=>{let a=ci(o);t&&!t.has(o)&&t.set(o,i.style[a]),i.style[a]=n})}function Ft(i,e){e.forEach((t,n)=>{let o=ci(n);i.style[o]=""})}function an(i){return Array.isArray(i)?i.length==1?i[0]:ba(i):i}function Hl(i,e,t){let n=e.params||{},o=Er(i);o.length&&o.forEach(a=>{n.hasOwnProperty(a)||t.push(Od(a))})}var _r=new RegExp(`${yr}\\s*(.+?)\\s*${Hd}`,"g");function Er(i){let e=[];if(typeof i=="string"){let t;for(;t=_r.exec(i);)e.push(t[1]);_r.lastIndex=0}return e}function ln(i,e,t){let n=`${i}`,o=n.replace(_r,(a,d)=>{let m=e[d];return m==null&&(t.push(Bd(d)),m=""),m.toString()});return o==n?i:o}var Wd=/-+([a-z0-9])/g;function ci(i){return i.replace(Wd,(...e)=>e[1].toUpperCase())}function zl(i,e){return i===0||e===0}function Kl(i,e,t){if(t.size&&e.length){let n=e[0],o=[];if(t.forEach((a,d)=>{n.has(d)||o.push(d),n.set(d,a)}),o.length)for(let a=1;a<e.length;a++){let d=e[a];o.forEach(m=>d.set(m,di(i,m)))}}return e}function je(i,e,t){switch(e.type){case we.Trigger:return i.visitTrigger(e,t);case we.State:return i.visitState(e,t);case we.Transition:return i.visitTransition(e,t);case we.Sequence:return i.visitSequence(e,t);case we.Group:return i.visitGroup(e,t);case we.Animate:return i.visitAnimate(e,t);case we.Keyframes:return i.visitKeyframes(e,t);case we.Style:return i.visitStyle(e,t);case we.Reference:return i.visitReference(e,t);case we.AnimateChild:return i.visitAnimateChild(e,t);case we.AnimateRef:return i.visitAnimateRef(e,t);case we.Query:return i.visitQuery(e,t);case we.Stagger:return i.visitStagger(e,t);default:throw Vd(e.type)}}function di(i,e){return window.getComputedStyle(i)[e]}var qr=(()=>{class i{validateStyleProperty(t){return ql(t)}containsElement(t,n){return br(t,n)}getParentElement(t){return si(t)}query(t,n,o){return xr(t,n,o)}computeStyle(t,n,o){return o||""}animate(t,n,o,a,d,m=[],f){return new zt(o,a)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=be({token:i,factory:i.\u0275fac})}return i})(),Jt=class{static NOOP=new qr},Qt=class{};var Jd=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),hi=class extends Qt{normalizePropertyName(e,t){return ci(e)}normalizeStyleValue(e,t,n,o){let a="",d=n.toString().trim();if(Jd.has(t)&&n!==0&&n!=="0")if(typeof n=="number")a="px";else{let m=n.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&m[1].length==0&&o.push(_l(e,n))}return d+a}};var fi="*";function Qd(i,e){let t=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>Yd(n,t,e)):t.push(i),t}function Yd(i,e,t){if(i[0]==":"){let f=Xd(i,t);if(typeof f=="function"){e.push(f);return}i=f}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(Tl(i)),e;let o=n[1],a=n[2],d=n[3];e.push(Wl(o,d));let m=o==fi&&d==fi;a[0]=="<"&&!m&&e.push(Wl(d,o))}function Xd(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(kl(i)),"* => *"}}var ui=new Set(["true","1"]),mi=new Set(["false","0"]);function Wl(i,e){let t=ui.has(i)||mi.has(i),n=ui.has(e)||mi.has(e);return(o,a)=>{let d=i==fi||i==o,m=e==fi||e==a;return!d&&t&&typeof o=="boolean"&&(d=o?ui.has(i):mi.has(i)),!m&&n&&typeof a=="boolean"&&(m=a?ui.has(e):mi.has(e)),d&&m}}var ic=":self",Zd=new RegExp(`s*${ic}s*,?`,"g");function oc(i,e,t,n){return new Ir(i).build(e,t,n)}var Jl="",Ir=class{_driver;constructor(e){this._driver=e}build(e,t,n){let o=new Pr(t);return this._resetContextStyleTimingState(o),je(this,an(e),o)}_resetContextStyleTimingState(e){e.currentQuerySelector=Jl,e.collectedStyles=new Map,e.collectedStyles.set(Jl,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,o=t.depCount=0,a=[],d=[];return e.name.charAt(0)=="@"&&t.errors.push(Cl()),e.definitions.forEach(m=>{if(this._resetContextStyleTimingState(t),m.type==we.State){let f=m,h=f.name;h.toString().split(/\s*,\s*/).forEach(C=>{f.name=C,a.push(this.visitState(f,t))}),f.name=h}else if(m.type==we.Transition){let f=this.visitTransition(m,t);n+=f.queryCount,o+=f.depCount,d.push(f)}else t.errors.push(vl())}),{type:we.Trigger,name:e.name,states:a,transitions:d,queryCount:n,depCount:o,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),o=e.options&&e.options.params||null;if(n.containsDynamicStyles){let a=new Set,d=o||{};n.styles.forEach(m=>{m instanceof Map&&m.forEach(f=>{Er(f).forEach(h=>{d.hasOwnProperty(h)||a.add(h)})})}),a.size&&t.errors.push(bl(e.name,[...a.values()]))}return{type:we.State,name:e.name,style:n,options:o?{params:o}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=je(this,an(e.animation),t),o=Qd(e.expr,t.errors);return{type:we.Transition,matchers:o,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:Wt(e.options)}}visitSequence(e,t){return{type:we.Sequence,steps:e.steps.map(n=>je(this,n,t)),options:Wt(e.options)}}visitGroup(e,t){let n=t.currentTime,o=0,a=e.steps.map(d=>{t.currentTime=n;let m=je(this,d,t);return o=Math.max(o,t.currentTime),m});return t.currentTime=o,{type:we.Group,steps:a,options:Wt(e.options)}}visitAnimate(e,t){let n=nu(e.timings,t.errors);t.currentAnimateTimings=n;let o,a=e.styles?e.styles:pr({});if(a.type==we.Keyframes)o=this.visitKeyframes(a,t);else{let d=e.styles,m=!1;if(!d){m=!0;let h={};n.easing&&(h.easing=n.easing),d=pr(h)}t.currentTime+=n.duration+n.delay;let f=this.visitStyle(d,t);f.isEmptyStep=m,o=f}return t.currentAnimateTimings=null,{type:we.Animate,timings:n,style:o,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],o=Array.isArray(e.styles)?e.styles:[e.styles];for(let m of o)typeof m=="string"?m===ut?n.push(m):t.errors.push(xl(m)):n.push(new Map(Object.entries(m)));let a=!1,d=null;return n.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!a)){for(let f of m.values())if(f.toString().indexOf(yr)>=0){a=!0;break}}}),{type:we.Style,styles:n,easing:d,offset:e.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,o=t.currentTime,a=t.currentTime;n&&a>0&&(a-=n.duration+n.delay),e.styles.forEach(d=>{typeof d!="string"&&d.forEach((m,f)=>{let h=t.collectedStyles.get(t.currentQuerySelector),C=h.get(f),y=!0;C&&(a!=o&&a>=C.startTime&&o<=C.endTime&&(t.errors.push(yl(f,C.startTime,C.endTime,a,o)),y=!1),a=C.startTime),y&&h.set(f,{startTime:a,endTime:o}),t.options&&Hl(m,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:we.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(Sl()),n;let o=1,a=0,d=[],m=!1,f=!1,h=0,C=e.steps.map(U=>{let Q=this._makeStyleAst(U,t),J=Q.offset!=null?Q.offset:tu(Q.styles),ie=0;return J!=null&&(a++,ie=Q.offset=J),f=f||ie<0||ie>1,m=m||ie<h,h=ie,d.push(ie),Q});f&&t.errors.push(wl()),m&&t.errors.push(El());let y=e.steps.length,E=0;a>0&&a<y?t.errors.push(Al()):a==0&&(E=o/(y-1));let T=y-1,R=t.currentTime,L=t.currentAnimateTimings,q=L.duration;return C.forEach((U,Q)=>{let J=E>0?Q==T?1:E*Q:d[Q],ie=J*q;t.currentTime=R+L.delay+ie,L.duration=ie,this._validateStyleAst(U,t),U.offset=J,n.styles.push(U)}),n}visitReference(e,t){return{type:we.Reference,animation:je(this,an(e.animation),t),options:Wt(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:we.AnimateChild,options:Wt(e.options)}}visitAnimateRef(e,t){return{type:we.AnimateRef,animation:this.visitReference(e.animation,t),options:Wt(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,o=e.options||{};t.queryCount++,t.currentQuery=e;let[a,d]=jd(e.selector);t.currentQuerySelector=n.length?n+" "+a:a,Ze(t.collectedStyles,t.currentQuerySelector,new Map);let m=je(this,an(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:we.Query,selector:a,limit:o.limit||0,optional:!!o.optional,includeSelf:d,animation:m,originalSelector:e.selector,options:Wt(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(Dl());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:Fn(e.timings,t.errors,!0);return{type:we.Stagger,animation:je(this,an(e.animation),t),timings:n,options:null}}};function jd(i){let e=!!i.split(/\s*,\s*/).find(t=>t==ic);return e&&(i=i.replace(Zd,"")),i=i.replace(/@\*/g,Pn).replace(/@\w+/g,t=>Pn+"-"+t.slice(1)).replace(/:animating/g,li),[i,e]}function eu(i){return i?F({},i):null}var Pr=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(e){this.errors=e}};function tu(i){if(typeof i=="string")return null;let e=null;if(Array.isArray(i))i.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let t=i;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function nu(i,e){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let a=Fn(i,e).duration;return Ar(a,0,"")}let t=i;if(t.split(/\s+/).some(a=>a.charAt(0)=="{"&&a.charAt(1)=="{")){let a=Ar(0,0,"");return a.dynamic=!0,a.strValue=t,a}let o=Fn(t,e);return Ar(o.duration,o.delay,o.easing)}function Wt(i){return i?(i=F({},i),i.params&&(i.params=eu(i.params))):i={},i}function Ar(i,e,t){return{duration:i,delay:e,easing:t}}function $r(i,e,t,n,o,a,d=null,m=!1){return{type:1,element:i,keyframes:e,preStyleProps:t,postStyleProps:n,duration:o,delay:a,totalTime:o+a,easing:d,subTimeline:m}}var Rn=class{_map=new Map;get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},iu=1,ou=":enter",ru=new RegExp(ou,"g"),su=":leave",au=new RegExp(su,"g");function rc(i,e,t,n,o,a=new Map,d=new Map,m,f,h=[]){return new Fr().buildKeyframes(i,e,t,n,o,a,d,m,f,h)}var Fr=class{buildKeyframes(e,t,n,o,a,d,m,f,h,C=[]){h=h||new Rn;let y=new Nr(e,t,h,o,a,C,[]);y.options=f;let E=f.delay?yt(f.delay):0;y.currentTimeline.delayNextStep(E),y.currentTimeline.setStyles([d],null,y.errors,f),je(this,n,y);let T=y.timelines.filter(R=>R.containsAnimation());if(T.length&&m.size){let R;for(let L=T.length-1;L>=0;L--){let q=T[L];if(q.element===t){R=q;break}}R&&!R.allowOnlyTimelineStyles()&&R.setStyles([m],null,y.errors,f)}return T.length?T.map(R=>R.buildKeyframes()):[$r(t,[],[],[],0,E,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let o=t.createSubContext(e.options),a=t.currentTimeline.currentTime,d=this._visitSubInstructions(n,o,o.options);a!=d&&t.transformIntoNewTimeline(d)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let o of e){let a=o?.delay;if(a){let d=typeof a=="number"?a:yt(ln(a,o?.params??{},t.errors));n.delayNextStep(d)}}}_visitSubInstructions(e,t,n){let a=t.currentTimeline.currentTime,d=n.duration!=null?yt(n.duration):null,m=n.delay!=null?yt(n.delay):null;return d!==0&&e.forEach(f=>{let h=t.appendInstructionToTimeline(f,d,m);a=Math.max(a,h.duration+h.delay)}),a}visitReference(e,t){t.updateOptions(e.options,!0),je(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,o=t,a=e.options;if(a&&(a.params||a.delay)&&(o=t.createSubContext(a),o.transformIntoNewTimeline(),a.delay!=null)){o.previousNode.type==we.Style&&(o.currentTimeline.snapshotCurrentStyles(),o.previousNode=_i);let d=yt(a.delay);o.delayNextStep(d)}e.steps.length&&(e.steps.forEach(d=>je(this,d,o)),o.currentTimeline.applyStylesToKeyframe(),o.subContextCount>n&&o.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],o=t.currentTimeline.currentTime,a=e.options&&e.options.delay?yt(e.options.delay):0;e.steps.forEach(d=>{let m=t.createSubContext(e.options);a&&m.delayNextStep(a),je(this,d,m),o=Math.max(o,m.currentTimeline.currentTime),n.push(m.currentTimeline)}),n.forEach(d=>t.currentTimeline.mergeTimelineCollectedStyles(d)),t.transformIntoNewTimeline(o),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,o=t.params?ln(n,t.params,t.errors):n;return Fn(o,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),o=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),o.snapshotCurrentStyles());let a=e.style;a.type==we.Keyframes?this.visitKeyframes(a,t):(t.incrementTime(n.duration),this.visitStyle(a,t),o.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,o=t.currentAnimateTimings;!o&&n.hasCurrentStyleProperties()&&n.forwardFrame();let a=o&&o.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(a):n.setStyles(e.styles,a,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,o=t.currentTimeline.duration,a=n.duration,m=t.createSubContext().currentTimeline;m.easing=n.easing,e.styles.forEach(f=>{let h=f.offset||0;m.forwardTime(h*a),m.setStyles(f.styles,f.easing,t.errors,t.options),m.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(m),t.transformIntoNewTimeline(o+a),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,o=e.options||{},a=o.delay?yt(o.delay):0;a&&(t.previousNode.type===we.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=_i);let d=n,m=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!o.optional,t.errors);t.currentQueryTotal=m.length;let f=null;m.forEach((h,C)=>{t.currentQueryIndex=C;let y=t.createSubContext(e.options,h);a&&y.delayNextStep(a),h===t.element&&(f=y.currentTimeline),je(this,e.animation,y),y.currentTimeline.applyStylesToKeyframe();let E=y.currentTimeline.currentTime;d=Math.max(d,E)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(d),f&&(t.currentTimeline.mergeTimelineCollectedStyles(f),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,o=t.currentTimeline,a=e.timings,d=Math.abs(a.duration),m=d*(t.currentQueryTotal-1),f=d*t.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":f=m-f;break;case"full":f=n.currentStaggerTime;break}let C=t.currentTimeline;f&&C.delayNextStep(f);let y=C.currentTime;je(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=o.currentTime-y+(o.startTime-n.currentTimeline.startTime)}},_i={},Nr=class i{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=_i;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(e,t,n,o,a,d,m,f){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=o,this._leaveClassName=a,this.errors=d,this.timelines=m,this.currentTimeline=f||new Ci(this._driver,t,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,o=this.options;n.duration!=null&&(o.duration=yt(n.duration)),n.delay!=null&&(o.delay=yt(n.delay));let a=n.params;if(a){let d=o.params;d||(d=this.options.params={}),Object.keys(a).forEach(m=>{(!t||!d.hasOwnProperty(m))&&(d[m]=ln(a[m],d,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(o=>{n[o]=t[o]})}}return e}createSubContext(e=null,t,n){let o=t||this.element,a=new i(this._driver,o,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(o,n||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(e),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(e){return this.previousNode=_i,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let o={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},a=new Rr(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,o,e.stretchStartingKeyframe);return this.timelines.push(a),o}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,o,a,d){let m=[];if(o&&m.push(this.element),e.length>0){e=e.replace(ru,"."+this._enterClassName),e=e.replace(au,"."+this._leaveClassName);let f=n!=1,h=this._driver.query(this.element,e,f);n!==0&&(h=n<0?h.slice(h.length+n,h.length):h.slice(0,n)),m.push(...h)}return!a&&m.length==0&&d.push(Ml(t)),m}},Ci=class i{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(e,t,n,o){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=o,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new i(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=iu,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||ut),this._currentKeyframe.set(t,ut);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,o){t&&this._previousKeyframe.set("easing",t);let a=o&&o.params||{},d=lu(e,this._globalTimelineStyles);for(let[m,f]of d){let h=ln(f,a,n);this._pendingStyles.set(m,h),this._localTimelineStyles.has(m)||this._backFill.set(m,this._globalTimelineStyles.get(m)??ut),this._updateStyle(m,h)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let o=this._styleSummary.get(n);(!o||t.time>o.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,o=[];this._keyframes.forEach((m,f)=>{let h=new Map([...this._backFill,...m]);h.forEach((C,y)=>{C===kn?e.add(y):C===ut&&t.add(y)}),n||h.set("offset",f/this.duration),o.push(h)});let a=[...e.values()],d=[...t.values()];if(n){let m=o[0],f=new Map(m);m.set("offset",0),f.set("offset",1),o=[m,f]}return $r(this.element,o,a,d,this.duration,this.startTime,this.easing,!1)}},Rr=class extends Ci{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(e,t,n,o,a,d,m=!1){super(e,t,d.delay),this.keyframes=n,this.preStyleProps=o,this.postStyleProps=a,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:o}=this.timings;if(this._stretchStartingKeyframe&&t){let a=[],d=n+t,m=t/d,f=new Map(e[0]);f.set("offset",0),a.push(f);let h=new Map(e[0]);h.set("offset",Ql(m)),a.push(h);let C=e.length-1;for(let y=1;y<=C;y++){let E=new Map(e[y]),T=E.get("offset"),R=t+T*n;E.set("offset",Ql(R/d)),a.push(E)}n=d,t=0,o="",e=a}return $r(this.element,e,this.preStyleProps,this.postStyleProps,n,t,o,!0)}};function Ql(i,e=3){let t=Math.pow(10,e-1);return Math.round(i*t)/t}function lu(i,e){let t=new Map,n;return i.forEach(o=>{if(o==="*"){n??=e.keys();for(let a of n)t.set(a,ut)}else for(let[a,d]of o)t.set(a,d)}),t}function Yl(i,e,t,n,o,a,d,m,f,h,C,y,E){return{type:0,element:i,triggerName:e,isRemovalTransition:o,fromState:t,fromStyles:a,toState:n,toStyles:d,timelines:m,queriedElements:f,preStyleProps:h,postStyleProps:C,totalTime:y,errors:E}}var Dr={},vi=class{_triggerName;ast;_stateStyles;constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,o){return cu(this.ast.matchers,e,t,n,o)}buildStyles(e,t,n){let o=this._stateStyles.get("*");return e!==void 0&&(o=this._stateStyles.get(e?.toString())||o),o?o.buildStyles(t,n):new Map}build(e,t,n,o,a,d,m,f,h,C){let y=[],E=this.ast.options&&this.ast.options.params||Dr,T=m&&m.params||Dr,R=this.buildStyles(n,T,y),L=f&&f.params||Dr,q=this.buildStyles(o,L,y),U=new Set,Q=new Map,J=new Map,ie=o==="void",se={params:sc(L,E),delay:this.ast.options?.delay},he=C?[]:rc(e,t,this.ast.animation,a,d,R,q,se,h,y),ae=0;return he.forEach(Se=>{ae=Math.max(Se.duration+Se.delay,ae)}),y.length?Yl(t,this._triggerName,n,o,ie,R,q,[],[],Q,J,ae,y):(he.forEach(Se=>{let ce=Se.element,ve=Ze(Q,ce,new Set);Se.preStyleProps.forEach(Ue=>ve.add(Ue));let Be=Ze(J,ce,new Set);Se.postStyleProps.forEach(Ue=>Be.add(Ue)),ce!==t&&U.add(ce)}),Yl(t,this._triggerName,n,o,ie,R,q,he,[...U.values()],Q,J,ae))}};function cu(i,e,t,n,o){return i.some(a=>a(e,t,n,o))}function sc(i,e){let t=F({},e);return Object.entries(i).forEach(([n,o])=>{o!=null&&(t[n]=o)}),t}var Or=class{styles;defaultParams;normalizer;constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,o=sc(e,this.defaultParams);return this.styles.styles.forEach(a=>{typeof a!="string"&&a.forEach((d,m)=>{d&&(d=ln(d,o,t));let f=this.normalizer.normalizePropertyName(m,t);d=this.normalizer.normalizeStyleValue(m,f,d,t),n.set(m,d)})}),n}};function du(i,e,t){return new Br(i,e,t)}var Br=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,t.states.forEach(o=>{let a=o.options&&o.options.params||{};this.states.set(o.name,new Or(o.style,a,n))}),Xl(this.states,"true","1"),Xl(this.states,"false","0"),t.transitions.forEach(o=>{this.transitionFactories.push(new vi(e,o,this.states))}),this.fallbackTransition=uu(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,o){return this.transitionFactories.find(d=>d.match(e,t,n,o))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function uu(i,e,t){let n=[(d,m)=>!0],o={type:we.Sequence,steps:[],options:null},a={type:we.Transition,animation:o,matchers:n,options:null,queryCount:0,depCount:0};return new vi(i,a,e)}function Xl(i,e,t){i.has(e)?i.has(t)||i.set(t,i.get(e)):i.has(t)&&i.set(e,i.get(t))}var mu=new Rn,Vr=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n}register(e,t){let n=[],o=[],a=oc(this._driver,t,n,o);if(n.length)throw Pl(n);this._animations.set(e,a)}_buildPlayer(e,t,n){let o=e.element,a=Cr(this._normalizer,e.keyframes,t,n);return this._driver.animate(o,a,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let o=[],a=this._animations.get(e),d,m=new Map;if(a?(d=rc(this._driver,t,a,Sr,ai,new Map,new Map,n,mu,o),d.forEach(C=>{let y=Ze(m,C.element,new Map);C.postStyleProps.forEach(E=>y.set(E,null))})):(o.push(Fl()),d=[]),o.length)throw Nl(o);m.forEach((C,y)=>{C.forEach((E,T)=>{C.set(T,this._driver.computeStyle(y,T,ut))})});let f=d.map(C=>{let y=m.get(C.element);return this._buildPlayer(C,new Map,y)}),h=At(f);return this._playersById.set(e,h),h.onDestroy(()=>this.destroy(e)),this.players.push(h),h}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw Rl(e);return t}listen(e,t,n,o){let a=ri(t,"","","");return oi(this._getPlayer(e),n,a,o),()=>{}}command(e,t,n,o){if(n=="register"){this.register(e,o[0]);return}if(n=="create"){let d=o[0]||{};this.create(e,t,d);return}let a=this._getPlayer(e);switch(n){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(o[0]));break;case"destroy":this.destroy(e);break}}},Zl="ng-animate-queued",pu=".ng-animate-queued",Mr="ng-animate-disabled",gu=".ng-animate-disabled",hu="ng-star-inserted",fu=".ng-star-inserted",_u=[],ac={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Cu={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},pt="__ng_removed",On=class{namespaceId;value;options;get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),o=n?e.value:e;if(this.value=bu(o),n){let a=e,{value:d}=a,m=Kn(a,["value"]);this.options=m}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(o=>{n[o]==null&&(n[o]=t[o])})}}},Nn="void",Tr=new On(Nn),Lr=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this._hostClassName="ng-tns-"+e,ct(t,this._hostClassName)}listen(e,t,n,o){if(!this._triggers.has(t))throw Ol(n,t);if(n==null||n.length==0)throw Bl(t);if(!xu(n))throw Vl(n,t);let a=Ze(this._elementListeners,e,[]),d={name:t,phase:n,callback:o};a.push(d);let m=Ze(this._engine.statesByElement,e,new Map);return m.has(t)||(ct(e,In),ct(e,In+"-"+t),m.set(t,Tr)),()=>{this._engine.afterFlush(()=>{let f=a.indexOf(d);f>=0&&a.splice(f,1),this._triggers.has(t)||m.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw Ll(e);return t}trigger(e,t,n,o=!0){let a=this._getTrigger(t),d=new Bn(this.id,t,e),m=this._engine.statesByElement.get(e);m||(ct(e,In),ct(e,In+"-"+t),this._engine.statesByElement.set(e,m=new Map));let f=m.get(t),h=new On(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&f&&h.absorbOptions(f.options),m.set(t,h),f||(f=Tr),!(h.value===Nn)&&f.value===h.value){if(!wu(f.params,h.params)){let L=[],q=a.matchStyles(f.value,f.params,L),U=a.matchStyles(h.value,h.params,L);L.length?this._engine.reportError(L):this._engine.afterFlush(()=>{Ft(e,q),mt(e,U)})}return}let E=Ze(this._engine.playersByElement,e,[]);E.forEach(L=>{L.namespaceId==this.id&&L.triggerName==t&&L.queued&&L.destroy()});let T=a.matchTransition(f.value,h.value,e,h.params),R=!1;if(!T){if(!o)return;T=a.fallbackTransition,R=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:T,fromState:f,toState:h,player:d,isFallbackTransition:R}),R||(ct(e,Zl),d.onStart(()=>{cn(e,Zl)})),d.onDone(()=>{let L=this.players.indexOf(d);L>=0&&this.players.splice(L,1);let q=this._engine.playersByElement.get(e);if(q){let U=q.indexOf(d);U>=0&&q.splice(U,1)}}),this.players.push(d),E.push(d),d}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(o=>o.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,Pn,!0);n.forEach(o=>{if(o[pt])return;let a=this._engine.fetchNamespacesByElement(o);a.size?a.forEach(d=>d.triggerLeaveAnimation(o,t,!1,!0)):this.clearElementCache(o)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(o=>this.clearElementCache(o)))}triggerLeaveAnimation(e,t,n,o){let a=this._engine.statesByElement.get(e),d=new Map;if(a){let m=[];if(a.forEach((f,h)=>{if(d.set(h,f.value),this._triggers.has(h)){let C=this.trigger(e,h,Nn,o);C&&m.push(C)}}),m.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,d),n&&At(m).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let o=new Set;t.forEach(a=>{let d=a.name;if(o.has(d))return;o.add(d);let f=this._triggers.get(d).fallbackTransition,h=n.get(d)||Tr,C=new On(Nn),y=new Bn(this.id,d,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:d,transition:f,fromState:h,toState:C,player:y,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let o=!1;if(n.totalAnimations){let a=n.players.length?n.playersByQueriedElement.get(e):[];if(a&&a.length)o=!0;else{let d=e;for(;d=d.parentNode;)if(n.statesByElement.get(d)){o=!0;break}}}if(this.prepareLeaveAnimationListeners(e),o)n.markElementAsRemoved(this.id,e,!1,t);else{let a=e[pt];(!a||a===ac)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){ct(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let o=n.player;if(o.destroyed)return;let a=n.element,d=this._elementListeners.get(a);d&&d.forEach(m=>{if(m.name==n.triggerName){let f=ri(a,n.triggerName,n.fromState.value,n.toState.value);f._data=e,oi(n.player,m.phase,f,m.callback)}}),o.markedForDestroy?this._engine.afterFlush(()=>{o.destroy()}):t.push(n)}),this._queue=[],t.sort((n,o)=>{let a=n.transition.ast.depCount,d=o.transition.ast.depCount;return a==0||d==0?a-d:this._engine.driver.containsElement(n.element,o.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},Gr=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(e,t)=>{};_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new Lr(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,o=this.namespacesByHostElement;if(n.length-1>=0){let d=!1,m=this.driver.getParentElement(t);for(;m;){let f=o.get(m);if(f){let h=n.indexOf(f);n.splice(h+1,0,e),d=!0;break}m=this.driver.getParentElement(m)}d||n.unshift(e)}else n.push(e);return o.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let o=this._namespaceLookup[e];o&&o.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let o=this._namespaceList.indexOf(n);o>=0&&this._namespaceList.splice(o,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let o of n.values())if(o.namespaceId){let a=this._fetchNamespace(o.namespaceId);a&&t.add(a)}}return t}trigger(e,t,n,o){if(pi(t)){let a=this._fetchNamespace(e);if(a)return a.trigger(t,n,o),!0}return!1}insertNode(e,t,n,o){if(!pi(t))return;let a=t[pt];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;let d=this.collectedLeaveElements.indexOf(t);d>=0&&this.collectedLeaveElements.splice(d,1)}if(e){let d=this._fetchNamespace(e);d&&d.insertNode(t,n)}o&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),ct(e,Mr)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),cn(e,Mr))}removeNode(e,t,n){if(pi(t)){let o=e?this._fetchNamespace(e):null;o?o.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let a=this.namespacesByHostElement.get(t);a&&a.id!==e&&a.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,o,a){this.collectedLeaveElements.push(t),t[pt]={namespaceId:e,setForRemoval:o,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:a}}listen(e,t,n,o,a){return pi(t)?this._fetchNamespace(e).listen(t,n,o,a):()=>{}}_buildInstruction(e,t,n,o,a){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,o,e.fromState.options,e.toState.options,t,a)}destroyInnerAnimations(e){let t=this.driver.query(e,Pn,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,li,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return At(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[pt];if(t&&t.setForRemoval){if(e[pt]=ac,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Mr)&&this.markElementAsDisabled(e,!1),this.driver.query(e,gu,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,o)=>this._balanceNamespaceList(n,o)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let o=this.collectedEnterElements[n];ct(o,hu)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let o=0;o<n.length;o++)n[o]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let o=this.collectedLeaveElements[n];this.processLeaveNode(o)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?At(t).onDone(()=>{n.forEach(o=>o())}):n.forEach(o=>o())}}reportError(e){throw Gl(e)}_flushAnimations(e,t){let n=new Rn,o=[],a=new Map,d=[],m=new Map,f=new Map,h=new Map,C=new Set;this.disabledNodes.forEach(j=>{C.add(j);let re=this.driver.query(j,pu,!0);for(let pe=0;pe<re.length;pe++)C.add(re[pe])});let y=this.bodyNode,E=Array.from(this.statesByElement.keys()),T=tc(E,this.collectedEnterElements),R=new Map,L=0;T.forEach((j,re)=>{let pe=Sr+L++;R.set(re,pe),j.forEach(Ee=>ct(Ee,pe))});let q=[],U=new Set,Q=new Set;for(let j=0;j<this.collectedLeaveElements.length;j++){let re=this.collectedLeaveElements[j],pe=re[pt];pe&&pe.setForRemoval&&(q.push(re),U.add(re),pe.hasAnimation?this.driver.query(re,fu,!0).forEach(Ee=>U.add(Ee)):Q.add(re))}let J=new Map,ie=tc(E,Array.from(U));ie.forEach((j,re)=>{let pe=ai+L++;J.set(re,pe),j.forEach(Ee=>ct(Ee,pe))}),e.push(()=>{T.forEach((j,re)=>{let pe=R.get(re);j.forEach(Ee=>cn(Ee,pe))}),ie.forEach((j,re)=>{let pe=J.get(re);j.forEach(Ee=>cn(Ee,pe))}),q.forEach(j=>{this.processLeaveNode(j)})});let se=[],he=[];for(let j=this._namespaceList.length-1;j>=0;j--)this._namespaceList[j].drainQueuedTransitions(t).forEach(pe=>{let Ee=pe.player,Le=pe.element;if(se.push(Ee),this.collectedEnterElements.length){let qe=Le[pt];if(qe&&qe.setForMove){if(qe.previousTriggersValues&&qe.previousTriggersValues.has(pe.triggerName)){let Gt=qe.previousTriggersValues.get(pe.triggerName),rt=this.statesByElement.get(pe.element);if(rt&&rt.has(pe.triggerName)){let zn=rt.get(pe.triggerName);zn.value=Gt,rt.set(pe.triggerName,zn)}}Ee.destroy();return}}let Ct=!y||!this.driver.containsElement(y,Le),it=J.get(Le),Tt=R.get(Le),Fe=this._buildInstruction(pe,n,Tt,it,Ct);if(Fe.errors&&Fe.errors.length){he.push(Fe);return}if(Ct){Ee.onStart(()=>Ft(Le,Fe.fromStyles)),Ee.onDestroy(()=>mt(Le,Fe.toStyles)),o.push(Ee);return}if(pe.isFallbackTransition){Ee.onStart(()=>Ft(Le,Fe.fromStyles)),Ee.onDestroy(()=>mt(Le,Fe.toStyles)),o.push(Ee);return}let ea=[];Fe.timelines.forEach(qe=>{qe.stretchStartingKeyframe=!0,this.disabledNodes.has(qe.element)||ea.push(qe)}),Fe.timelines=ea,n.append(Le,Fe.timelines);let Fd={instruction:Fe,player:Ee,element:Le};d.push(Fd),Fe.queriedElements.forEach(qe=>Ze(m,qe,[]).push(Ee)),Fe.preStyleProps.forEach((qe,Gt)=>{if(qe.size){let rt=f.get(Gt);rt||f.set(Gt,rt=new Set),qe.forEach((zn,rr)=>rt.add(rr))}}),Fe.postStyleProps.forEach((qe,Gt)=>{let rt=h.get(Gt);rt||h.set(Gt,rt=new Set),qe.forEach((zn,rr)=>rt.add(rr))})});if(he.length){let j=[];he.forEach(re=>{j.push(Ul(re.triggerName,re.errors))}),se.forEach(re=>re.destroy()),this.reportError(j)}let ae=new Map,Se=new Map;d.forEach(j=>{let re=j.element;n.has(re)&&(Se.set(re,re),this._beforeAnimationBuild(j.player.namespaceId,j.instruction,ae))}),o.forEach(j=>{let re=j.element;this._getPreviousPlayers(re,!1,j.namespaceId,j.triggerName,null).forEach(Ee=>{Ze(ae,re,[]).push(Ee),Ee.destroy()})});let ce=q.filter(j=>nc(j,f,h)),ve=new Map;ec(ve,this.driver,Q,h,ut).forEach(j=>{nc(j,f,h)&&ce.push(j)});let Ue=new Map;T.forEach((j,re)=>{ec(Ue,this.driver,new Set(j),f,kn)}),ce.forEach(j=>{let re=ve.get(j),pe=Ue.get(j);ve.set(j,new Map([...re?.entries()??[],...pe?.entries()??[]]))});let Ie=[],nt=[],An={};d.forEach(j=>{let{element:re,player:pe,instruction:Ee}=j;if(n.has(re)){if(C.has(re)){pe.onDestroy(()=>mt(re,Ee.toStyles)),pe.disabled=!0,pe.overrideTotalTime(Ee.totalTime),o.push(pe);return}let Le=An;if(Se.size>1){let it=re,Tt=[];for(;it=it.parentNode;){let Fe=Se.get(it);if(Fe){Le=Fe;break}Tt.push(it)}Tt.forEach(Fe=>Se.set(Fe,Le))}let Ct=this._buildAnimation(pe.namespaceId,Ee,ae,a,Ue,ve);if(pe.setRealPlayer(Ct),Le===An)Ie.push(pe);else{let it=this.playersByElement.get(Le);it&&it.length&&(pe.parentPlayer=At(it)),o.push(pe)}}else Ft(re,Ee.fromStyles),pe.onDestroy(()=>mt(re,Ee.toStyles)),nt.push(pe),C.has(re)&&o.push(pe)}),nt.forEach(j=>{let re=a.get(j.element);if(re&&re.length){let pe=At(re);j.setRealPlayer(pe)}}),o.forEach(j=>{j.parentPlayer?j.syncPlayerEvents(j.parentPlayer):j.destroy()});for(let j=0;j<q.length;j++){let re=q[j],pe=re[pt];if(cn(re,ai),pe&&pe.hasAnimation)continue;let Ee=[];if(m.size){let Ct=m.get(re);Ct&&Ct.length&&Ee.push(...Ct);let it=this.driver.query(re,li,!0);for(let Tt=0;Tt<it.length;Tt++){let Fe=m.get(it[Tt]);Fe&&Fe.length&&Ee.push(...Fe)}}let Le=Ee.filter(Ct=>!Ct.destroyed);Le.length?yu(this,re,Le):this.processLeaveNode(re)}return q.length=0,Ie.forEach(j=>{this.players.push(j),j.onDone(()=>{j.destroy();let re=this.players.indexOf(j);this.players.splice(re,1)}),j.play()}),Ie}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,o,a){let d=[];if(t){let m=this.playersByQueriedElement.get(e);m&&(d=m)}else{let m=this.playersByElement.get(e);if(m){let f=!a||a==Nn;m.forEach(h=>{h.queued||!f&&h.triggerName!=o||d.push(h)})}}return(n||o)&&(d=d.filter(m=>!(n&&n!=m.namespaceId||o&&o!=m.triggerName))),d}_beforeAnimationBuild(e,t,n){let o=t.triggerName,a=t.element,d=t.isRemovalTransition?void 0:e,m=t.isRemovalTransition?void 0:o;for(let f of t.timelines){let h=f.element,C=h!==a,y=Ze(n,h,[]);this._getPreviousPlayers(h,C,d,m,t.toState).forEach(T=>{let R=T.getRealPlayer();R.beforeDestroy&&R.beforeDestroy(),T.destroy(),y.push(T)})}Ft(a,t.fromStyles)}_buildAnimation(e,t,n,o,a,d){let m=t.triggerName,f=t.element,h=[],C=new Set,y=new Set,E=t.timelines.map(R=>{let L=R.element;C.add(L);let q=L[pt];if(q&&q.removedBeforeQueried)return new zt(R.duration,R.delay);let U=L!==f,Q=Su((n.get(L)||_u).map(ae=>ae.getRealPlayer())).filter(ae=>{let Se=ae;return Se.element?Se.element===L:!1}),J=a.get(L),ie=d.get(L),se=Cr(this._normalizer,R.keyframes,J,ie),he=this._buildPlayer(R,se,Q);if(R.subTimeline&&o&&y.add(L),U){let ae=new Bn(e,m,L);ae.setRealPlayer(he),h.push(ae)}return he});h.forEach(R=>{Ze(this.playersByQueriedElement,R.element,[]).push(R),R.onDone(()=>vu(this.playersByQueriedElement,R.element,R))}),C.forEach(R=>ct(R,wr));let T=At(E);return T.onDestroy(()=>{C.forEach(R=>cn(R,wr)),mt(f,t.toStyles)}),y.forEach(R=>{Ze(o,R,[]).push(T)}),T}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new zt(e.duration,e.delay)}},Bn=class{namespaceId;triggerName;element;_player=new zt;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(o=>oi(e,n,void 0,o))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Ze(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function vu(i,e,t){let n=i.get(e);if(n){if(n.length){let o=n.indexOf(t);n.splice(o,1)}n.length==0&&i.delete(e)}return n}function bu(i){return i??null}function pi(i){return i&&i.nodeType===1}function xu(i){return i=="start"||i=="done"}function jl(i,e){let t=i.style.display;return i.style.display=e??"none",t}function ec(i,e,t,n,o){let a=[];t.forEach(f=>a.push(jl(f)));let d=[];n.forEach((f,h)=>{let C=new Map;f.forEach(y=>{let E=e.computeStyle(h,y,o);C.set(y,E),(!E||E.length==0)&&(h[pt]=Cu,d.push(h))}),i.set(h,C)});let m=0;return t.forEach(f=>jl(f,a[m++])),d}function tc(i,e){let t=new Map;if(i.forEach(m=>t.set(m,[])),e.length==0)return t;let n=1,o=new Set(e),a=new Map;function d(m){if(!m)return n;let f=a.get(m);if(f)return f;let h=m.parentNode;return t.has(h)?f=h:o.has(h)?f=n:f=d(h),a.set(m,f),f}return e.forEach(m=>{let f=d(m);f!==n&&t.get(f).push(m)}),t}function ct(i,e){i.classList?.add(e)}function cn(i,e){i.classList?.remove(e)}function yu(i,e,t){At(t).onDone(()=>i.processLeaveNode(e))}function Su(i){let e=[];return lc(i,e),e}function lc(i,e){for(let t=0;t<i.length;t++){let n=i[t];n instanceof Zn?lc(n.players,e):e.push(n)}}function wu(i,e){let t=Object.keys(i),n=Object.keys(e);if(t.length!=n.length)return!1;for(let o=0;o<t.length;o++){let a=t[o];if(!e.hasOwnProperty(a)||i[a]!==e[a])return!1}return!0}function nc(i,e,t){let n=t.get(i);if(!n)return!1;let o=e.get(i);return o?n.forEach(a=>o.add(a)):e.set(i,n),t.delete(i),!0}var dn=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(e,t)=>{};constructor(e,t,n){this._driver=t,this._normalizer=n,this._transitionEngine=new Gr(e.body,t,n),this._timelineEngine=new Vr(e.body,t,n),this._transitionEngine.onRemovalComplete=(o,a)=>this.onRemovalComplete(o,a)}registerTrigger(e,t,n,o,a){let d=e+"-"+o,m=this._triggerCache[d];if(!m){let f=[],h=[],C=oc(this._driver,a,f,h);if(f.length)throw Il(o,f);m=du(o,C,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(t,o,m)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,o){this._transitionEngine.insertNode(e,t,n,o)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,o){if(n.charAt(0)=="@"){let[a,d]=vr(n),m=o;this._timelineEngine.command(a,t,d,m)}else this._transitionEngine.trigger(e,t,n,o)}listen(e,t,n,o,a){if(n.charAt(0)=="@"){let[d,m]=vr(n);return this._timelineEngine.listen(d,t,m,a)}return this._transitionEngine.listen(e,t,n,o,a)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function Eu(i,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=kr(e[0]),e.length>1&&(n=kr(e[e.length-1]))):e instanceof Map&&(t=kr(e)),t||n?new Au(i,t,n):null}var Au=(()=>{class i{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(t,n,o){this._element=t,this._startStyles=n,this._endStyles=o;let a=i.initialStylesByElement.get(t);a||i.initialStylesByElement.set(t,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&mt(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(mt(this._element,this._initialStyles),this._endStyles&&(mt(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(Ft(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ft(this._element,this._endStyles),this._endStyles=null),mt(this._element,this._initialStyles),this._state=3)}}return i})();function kr(i){let e=null;return i.forEach((t,n)=>{Du(n)&&(e=e||new Map,e.set(n,t))}),e}function Du(i){return i==="display"||i==="position"}var bi=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer=null;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(e,t,n,o){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=o,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer()&&this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return this.domPlayer;this._initialized=!0;let e=this.keyframes,t=this._triggerWebAnimation(this.element,e,this.options);if(!t)return this._onFinish(),null;this.domPlayer=t,this._finalKeyframe=e.length?e[e.length-1]:new Map;let n=()=>this._onFinish();return t.addEventListener("finish",n),this.onDestroy(()=>{t.removeEventListener("finish",n)}),t}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer?.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){let o=this._convertKeyframesToObject(t);try{return e.animate(o,n)}catch{return null}}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){let e=this._buildPlayer();e&&(this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),e.play())}pause(){this.init(),this.domPlayer?.pause()}finish(){this.init(),this.domPlayer&&(this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish())}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer?.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer||this.init(),this.domPlayer&&(this.domPlayer.currentTime=e*this.time)}getPosition(){return this.domPlayer?+(this.domPlayer.currentTime??0)/this.time:this._initialized?1:0}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,o)=>{o!=="offset"&&e.set(o,this._finished?n:di(this.element,o))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},xi=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return br(e,t)}getParentElement(e){return si(e)}query(e,t,n){return xr(e,t,n)}computeStyle(e,t,n){return di(e,t)}animate(e,t,n,o,a,d=[]){let m=o==0?"both":"forwards",f={duration:n,delay:o,fill:m};a&&(f.easing=a);let h=new Map,C=d.filter(T=>T instanceof bi);zl(n,o)&&C.forEach(T=>{T.currentSnapshot.forEach((R,L)=>h.set(L,R))});let y=$l(t).map(T=>new Map(T));y=Kl(e,y,h);let E=Eu(e,y);return new bi(e,y,f,E)}};var gi="@",cc="@.disabled",yi=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(e,t,n,o){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=o}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,o=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,o)}removeChild(e,t,n,o){if(o){this.delegate.removeChild(e,t,n,o);return}this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,o){this.delegate.setAttribute(e,t,n,o)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,o){this.delegate.setStyle(e,t,n,o)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==gi&&t==cc?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n,o){return this.delegate.listen(e,t,n,o)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},Ur=class extends yi{factory;constructor(e,t,n,o,a){super(t,n,o,a),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==gi?t.charAt(1)=="."&&t==cc?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n,o){if(t.charAt(0)==gi){let a=Mu(e),d=t.slice(1),m="";return d.charAt(0)!=gi&&([d,m]=Tu(d)),this.engine.listen(this.namespaceId,a,d,m,f=>{let h=f._data||-1;this.factory.scheduleListenerCallback(h,n,f)})}return this.delegate.listen(e,t,n,o)}};function Mu(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function Tu(i){let e=i.indexOf("."),t=i.substring(0,e),n=i.slice(e+1);return[t,n]}var Si=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,t.onRemovalComplete=(o,a)=>{a?.removeChild(null,o)}}createRenderer(e,t){let o=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let h=this._rendererCache,C=h.get(o);if(!C){let y=()=>h.delete(o);C=new yi("",o,this.engine,y),h.set(o,C)}return C}let a=t.id,d=t.id+"-"+this._currentId;this._currentId++,this.engine.register(d,e);let m=h=>{Array.isArray(h)?h.forEach(m):this.engine.registerTrigger(a,d,e,h.name,h)};return t.data.animation.forEach(m),new Ur(this,d,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let o=this._animationCallbacksBuffer;o.length==0&&queueMicrotask(()=>{this._zone.run(()=>{o.forEach(a=>{let[d,m]=a;d(m)}),this._animationCallbacksBuffer=[]})}),o.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(e){this.engine.flush(),this.delegate.componentReplaced?.(e)}};var Iu=(()=>{class i extends dn{constructor(t,n,o){super(t,n,o)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||i)(Ke(Jn),Ke(Jt),Ke(Qt))};static \u0275prov=be({token:i,factory:i.\u0275fac})}return i})();function Pu(){return new hi}function Fu(){return new Si(O(_a),O(dn),O(We))}var dc=[{provide:Qt,useFactory:Pu},{provide:dn,useClass:Iu},{provide:la,useFactory:Fu}],_A=[{provide:Jt,useClass:qr},{provide:cr,useValue:"NoopAnimations"},...dc],Nu=[{provide:Jt,useFactory:()=>new xi},{provide:cr,useFactory:()=>"BrowserAnimations"},...dc];function uc(){return aa("NgEagerAnimations"),[...Nu]}var Ru,Ou;function Bu(){return{geminiUrl:Ru,vertexUrl:Ou}}function Vu(i,e,t,n){var o,a;if(!i?.baseUrl){let d=Bu();return e?(o=d.vertexUrl)!==null&&o!==void 0?o:t:(a=d.geminiUrl)!==null&&a!==void 0?a:n}return i.baseUrl}var ft=class{};function Z(i,e){let t=/\{([^}]+)\}/g;return i.replace(t,(n,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){let a=e[o];return a!=null?String(a):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function p(i,e,t){for(let a=0;a<e.length-1;a++){let d=e[a];if(d.endsWith("[]")){let m=d.slice(0,-2);if(!(m in i))if(Array.isArray(t))i[m]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${d}`);if(Array.isArray(i[m])){let f=i[m];if(Array.isArray(t))for(let h=0;h<f.length;h++){let C=f[h];p(C,e.slice(a+1),t[h])}else for(let h of f)p(h,e.slice(a+1),t)}return}else if(d.endsWith("[0]")){let m=d.slice(0,-3);m in i||(i[m]=[{}]);let f=i[m];p(f[0],e.slice(a+1),t);return}(!i[d]||typeof i[d]!="object")&&(i[d]={}),i=i[d]}let n=e[e.length-1],o=i[n];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function u(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;let o=e[n];if(o.endsWith("[]")){let a=o.slice(0,-2);if(a in i){let d=i[a];return Array.isArray(d)?d.map(m=>u(m,e.slice(n+1),t)):t}else return t}else i=i[o]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function Lu(i,e){for(let[t,n]of Object.entries(e)){let o=t.split("."),a=n.split("."),d=new Set,m=-1;for(let f=0;f<o.length;f++)if(o[f]==="*"){m=f;break}if(m!==-1&&a.length>m)for(let f=m;f<a.length;f++){let h=a[f];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&d.add(h)}Kr(i,o,a,0,d)}}function Kr(i,e,t,n,o){if(n>=e.length||typeof i!="object"||i===null)return;let a=e[n];if(a.endsWith("[]")){let d=a.slice(0,-2),m=i;if(d in m&&Array.isArray(m[d]))for(let f of m[d])Kr(f,e,t,n+1,o)}else if(a==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let d=i,m=Object.keys(d).filter(h=>!h.startsWith("_")&&!o.has(h)),f={};for(let h of m)f[h]=d[h];for(let[h,C]of Object.entries(f)){let y=[];for(let E of t.slice(n))E==="*"?y.push(h):y.push(E);p(d,y,C)}for(let h of m)delete d[h]}}else{let d=i;a in d&&Kr(d[a],e,t,n+1,o)}}function Hs(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function Gu(i){let e={},t=u(i,["operationName"]);t!=null&&p(e,["operationName"],t);let n=u(i,["resourceName"]);return n!=null&&p(e,["_url","resourceName"],n),e}function Uu(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["response","generateVideoResponse"]);return d!=null&&p(e,["response"],$u(d)),e}function qu(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["response"]);return d!=null&&p(e,["response"],Hu(d)),e}function $u(i){let e={},t=u(i,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>zu(d))),p(e,["generatedVideos"],a)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function Hu(i){let e={},t=u(i,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>Ku(d))),p(e,["generatedVideos"],a)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function zu(i){let e={},t=u(i,["video"]);return t!=null&&p(e,["video"],Zu(t)),e}function Ku(i){let e={},t=u(i,["_self"]);return t!=null&&p(e,["video"],ju(t)),e}function Wu(i){let e={},t=u(i,["operationName"]);return t!=null&&p(e,["_url","operationName"],t),e}function Ju(i){let e={},t=u(i,["operationName"]);return t!=null&&p(e,["_url","operationName"],t),e}function Qu(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["response"]);return d!=null&&p(e,["response"],Yu(d)),e}function Yu(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["parent"]);n!=null&&p(e,["parent"],n);let o=u(i,["documentName"]);return o!=null&&p(e,["documentName"],o),e}function Bc(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["response"]);return d!=null&&p(e,["response"],Xu(d)),e}function Xu(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["parent"]);n!=null&&p(e,["parent"],n);let o=u(i,["documentName"]);return o!=null&&p(e,["documentName"],o),e}function Zu(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["uri"],t);let n=u(i,["encodedVideo"]);n!=null&&p(e,["videoBytes"],Hs(n));let o=u(i,["encoding"]);return o!=null&&p(e,["mimeType"],o),e}function ju(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["uri"],t);let n=u(i,["bytesBase64Encoded"]);n!=null&&p(e,["videoBytes"],Hs(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}var Zt=(function(i){return i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL",i})(Zt||{});var Wr=(function(i){return i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO",i})(Wr||{});var Vc=(function(i){return i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",i})(Vc||{});var Ln=(function(i){return i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT",i})(Ln||{});var Un=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var Xt=class{get text(){var e,t,n,o,a,d,m,f;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",C=!1,y=[];for(let E of(f=(m=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||m===void 0?void 0:m.parts)!==null&&f!==void 0?f:[]){for(let[T,R]of Object.entries(E))T!=="text"&&T!=="thought"&&T!=="thoughtSignature"&&(R!==null||R!==void 0)&&y.push(T);if(typeof E.text=="string"){if(typeof E.thought=="boolean"&&E.thought)continue;C=!0,h+=E.text}}return y.length>0&&console.warn(`there are non-text parts ${y} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),C?h:void 0}get data(){var e,t,n,o,a,d,m,f;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="",C=[];for(let y of(f=(m=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||m===void 0?void 0:m.parts)!==null&&f!==void 0?f:[]){for(let[E,T]of Object.entries(y))E!=="inlineData"&&(T!==null||T!==void 0)&&C.push(E);y.inlineData&&typeof y.inlineData.data=="string"&&(h+=atob(y.inlineData.data))}return C.length>0&&console.warn(`there are non-data parts ${C} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,t,n,o,a,d,m,f;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let h=(f=(m=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||m===void 0?void 0:m.parts)===null||f===void 0?void 0:f.filter(C=>C.functionCall).map(C=>C.functionCall).filter(C=>C!==void 0);if(h?.length!==0)return h}get executableCode(){var e,t,n,o,a,d,m,f,h;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let C=(f=(m=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||m===void 0?void 0:m.parts)===null||f===void 0?void 0:f.filter(y=>y.executableCode).map(y=>y.executableCode).filter(y=>y!==void 0);if(C?.length!==0)return(h=C?.[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,t,n,o,a,d,m,f,h;if(((o=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let C=(f=(m=(d=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content)===null||m===void 0?void 0:m.parts)===null||f===void 0?void 0:f.filter(y=>y.codeExecutionResult).map(y=>y.codeExecutionResult).filter(y=>y!==void 0);if(C?.length!==0)return(h=C?.[0])===null||h===void 0?void 0:h.output}},Ii=class{},Pi=class{},Jr=class{},Qr=class{},Yr=class{},Xr=class{},Fi=class{},Ni=class{},Ri=class{},Zr=class{};var Oi=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,o,a=e;return t?o=qu(a):o=Uu(a),Object.assign(n,o),n}},Bi=class{},Vi=class{},Li=class{},Gi=class{},jr=class{},es=class{},ts=class{};var ns=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,a=Qu(e);return Object.assign(n,a),n}},is=class{},os=class{},rs=class{};var Ui=class{};var ss=class{get text(){var e,t,n;let o="",a=!1,d=[];for(let m of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[f,h]of Object.entries(m))f!=="text"&&f!=="thought"&&h!==null&&d.push(f);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;a=!0,o+=m.text}}return d.length>0&&console.warn(`there are non-text parts ${d} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),a?o:void 0}get data(){var e,t,n;let o="",a=[];for(let d of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[m,f]of Object.entries(d))m!=="inlineData"&&f!==null&&a.push(m);d.inlineData&&typeof d.inlineData.data=="string"&&(o+=atob(d.inlineData.data))}return a.length>0&&console.warn(`there are non-data parts ${a} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}};var as=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var ls=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,a=Bc(e);return Object.assign(n,a),n}};function Te(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Lc(i,e){let t=Te(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function Gc(i){return Array.isArray(i)?i.map(e=>qi(e)):[qi(i)]}function qi(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function Uc(i){let e=qi(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function qc(i){let e=qi(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function mc(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function $c(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>mc(e)):[mc(i)]}function cs(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function pc(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function gc(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function $e(i){if(i==null)throw new Error("ContentUnion is required");return cs(i)?i:{role:"user",parts:$c(i)}}function zs(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=$e(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){let t=$e(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>$e(t)):[$e(e)]}function dt(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(pc(i)||gc(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[$e(i)]}let e=[],t=[],n=cs(i[0]);for(let o of i){let a=cs(o);if(a!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(o);else{if(pc(o)||gc(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return n||e.push({role:"user",parts:$c(t)}),e}function e0(i,e){i.includes("null")&&(e.nullable=!0);let t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(Zt).includes(t[0].toUpperCase())?t[0].toUpperCase():Zt.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(Zt).includes(n.toUpperCase())?n.toUpperCase():Zt.TYPE_UNSPECIFIED})}}function mn(i){let e={},t=["items"],n=["anyOf"],o=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");let a=i.anyOf;a!=null&&a.length==2&&(a[0].type==="null"?(e.nullable=!0,i=a[1]):a[1].type==="null"&&(e.nullable=!0,i=a[0])),i.type instanceof Array&&e0(i.type,e);for(let[d,m]of Object.entries(i))if(m!=null)if(d=="type"){if(m==="null")throw new Error("type: null can not be the only possible type for the field.");if(m instanceof Array)continue;e.type=Object.values(Zt).includes(m.toUpperCase())?m.toUpperCase():Zt.TYPE_UNSPECIFIED}else if(t.includes(d))e[d]=mn(m);else if(n.includes(d)){let f=[];for(let h of m){if(h.type=="null"){e.nullable=!0;continue}f.push(mn(h))}e[d]=f}else if(o.includes(d)){let f={};for(let[h,C]of Object.entries(m))f[h]=mn(C);e[d]=f}else{if(d==="additionalProperties")continue;e[d]=m}return e}function Ks(i){return mn(i)}function Ws(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function Js(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function fn(i){if(i.functionDeclarations)for(let e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=mn(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=mn(e.response));return i}function _n(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of i)e.push(t);return e}function t0(i,e,t,n=1){let o=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:o?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function Mt(i,e){if(typeof e!="string")throw new Error("name must be a string");return t0(i,e,"cachedContents")}function Hc(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function Nt(i){return Hs(i)}function n0(i){return i!=null&&typeof i=="object"&&"name"in i}function i0(i){return i!=null&&typeof i=="object"&&"video"in i}function o0(i){return i!=null&&typeof i=="object"&&"uri"in i}function zc(i){var e;let t;if(n0(i)&&(t=i.name),!(o0(i)&&(t=i.uri,t===void 0))&&!(i0(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Kc(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Wc(i){for(let e of["models","tunedModels","publisherModels"])if(r0(i,e))return i[e];return[]}function r0(i,e){return i!==null&&typeof i=="object"&&e in i}function s0(i,e={}){let t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function a0(i,e={}){let t=[],n=new Set;for(let o of i){let a=o.name;if(n.has(a))throw new Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);n.add(a);let d=s0(o,e);d.functionDeclarations&&t.push(...d.functionDeclarations)}return{functionDeclarations:t}}function Jc(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(o>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function l0(i){if(typeof i!="string")return i;let e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Qc(i){if(typeof i!="object"||i===null)return{};let e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;let o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return i;let a=!1;for(let d of o){if(typeof d!="object"||d===null)continue;let f=d.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){a=!0;break}}return a&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function Cn(i,e){let t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function Yc(i){let e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function c0(i){let e={},t=u(i,["responsesFile"]);t!=null&&p(e,["fileName"],t);let n=u(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>$0(d))),p(e,["inlinedResponses"],a)}let o=u(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["inlinedEmbedContentResponses"],a)}return e}function d0(i){let e={},t=u(i,["predictionsFormat"]);t!=null&&p(e,["format"],t);let n=u(i,["gcsDestination","outputUriPrefix"]);n!=null&&p(e,["gcsUri"],n);let o=u(i,["bigqueryDestination","outputUri"]);return o!=null&&p(e,["bigqueryUri"],o),e}function u0(i){let e={},t=u(i,["format"]);t!=null&&p(e,["predictionsFormat"],t);let n=u(i,["gcsUri"]);n!=null&&p(e,["gcsDestination","outputUriPrefix"],n);let o=u(i,["bigqueryUri"]);if(o!=null&&p(e,["bigqueryDestination","outputUri"],o),u(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(u(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Ti(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata","displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["metadata","state"]);o!=null&&p(e,["state"],Yc(o));let a=u(i,["metadata","createTime"]);a!=null&&p(e,["createTime"],a);let d=u(i,["metadata","endTime"]);d!=null&&p(e,["endTime"],d);let m=u(i,["metadata","updateTime"]);m!=null&&p(e,["updateTime"],m);let f=u(i,["metadata","model"]);f!=null&&p(e,["model"],f);let h=u(i,["metadata","output"]);return h!=null&&p(e,["dest"],c0(Qc(h))),e}function ds(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["state"]);o!=null&&p(e,["state"],Yc(o));let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["createTime"]);d!=null&&p(e,["createTime"],d);let m=u(i,["startTime"]);m!=null&&p(e,["startTime"],m);let f=u(i,["endTime"]);f!=null&&p(e,["endTime"],f);let h=u(i,["updateTime"]);h!=null&&p(e,["updateTime"],h);let C=u(i,["model"]);C!=null&&p(e,["model"],C);let y=u(i,["inputConfig"]);y!=null&&p(e,["src"],m0(y));let E=u(i,["outputConfig"]);E!=null&&p(e,["dest"],d0(Qc(E)));let T=u(i,["completionStats"]);return T!=null&&p(e,["completionStats"],T),e}function m0(i){let e={},t=u(i,["instancesFormat"]);t!=null&&p(e,["format"],t);let n=u(i,["gcsSource","uris"]);n!=null&&p(e,["gcsUri"],n);let o=u(i,["bigquerySource","inputUri"]);return o!=null&&p(e,["bigqueryUri"],o),e}function p0(i,e){let t={};if(u(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(u(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=u(e,["fileName"]);n!=null&&p(t,["fileName"],n);let o=u(e,["inlinedRequests"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>q0(i,d))),p(t,["requests","requests"],a)}return t}function g0(i){let e={},t=u(i,["format"]);t!=null&&p(e,["instancesFormat"],t);let n=u(i,["gcsUri"]);n!=null&&p(e,["gcsSource","uris"],n);let o=u(i,["bigqueryUri"]);if(o!=null&&p(e,["bigquerySource","inputUri"],o),u(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function h0(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function f0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Cn(i,n)),t}function _0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Cn(i,n)),t}function C0(i){let e={},t=u(i,["content"]);t!=null&&p(e,["content"],t);let n=u(i,["citationMetadata"]);n!=null&&p(e,["citationMetadata"],v0(n));let o=u(i,["tokenCount"]);o!=null&&p(e,["tokenCount"],o);let a=u(i,["finishReason"]);a!=null&&p(e,["finishReason"],a);let d=u(i,["avgLogprobs"]);d!=null&&p(e,["avgLogprobs"],d);let m=u(i,["groundingMetadata"]);m!=null&&p(e,["groundingMetadata"],m);let f=u(i,["index"]);f!=null&&p(e,["index"],f);let h=u(i,["logprobsResult"]);h!=null&&p(e,["logprobsResult"],h);let C=u(i,["safetyRatings"]);if(C!=null){let E=C;Array.isArray(E)&&(E=E.map(T=>T)),p(e,["safetyRatings"],E)}let y=u(i,["urlContextMetadata"]);return y!=null&&p(e,["urlContextMetadata"],y),e}function v0(i){let e={},t=u(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),p(e,["citations"],n)}return e}function Xc(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>Y0(a))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function b0(i,e){let t={},n=u(i,["displayName"]);if(e!==void 0&&n!=null&&p(e,["batch","displayName"],n),u(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function x0(i,e){let t={},n=u(i,["displayName"]);e!==void 0&&n!=null&&p(e,["displayName"],n);let o=u(i,["dest"]);return e!==void 0&&o!=null&&p(e,["outputConfig"],u0(l0(o))),t}function hc(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["src"]);o!=null&&p(t,["batch","inputConfig"],p0(i,Jc(i,o)));let a=u(e,["config"]);return a!=null&&b0(a,t),t}function y0(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["model"],Te(i,n));let o=u(e,["src"]);o!=null&&p(t,["inputConfig"],g0(Jc(i,o)));let a=u(e,["config"]);return a!=null&&x0(a,t),t}function S0(i,e){let t={},n=u(i,["displayName"]);return e!==void 0&&n!=null&&p(e,["batch","displayName"],n),t}function w0(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["src"]);o!=null&&p(t,["batch","inputConfig"],I0(i,o));let a=u(e,["config"]);return a!=null&&S0(a,t),t}function E0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Cn(i,n)),t}function A0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Cn(i,n)),t}function D0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);return a!=null&&p(e,["error"],a),e}function M0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);return a!=null&&p(e,["error"],a),e}function T0(i,e){let t={},n=u(e,["contents"]);if(n!=null){let a=zs(i,n);Array.isArray(a)&&(a=a.map(d=>d)),p(t,["requests[]","request","content"],a)}let o=u(e,["config"]);return o!=null&&(p(t,["_self"],k0(o,t)),Lu(t,{"requests[].*":"requests[].request.*"})),t}function k0(i,e){let t={},n=u(i,["taskType"]);e!==void 0&&n!=null&&p(e,["requests[]","taskType"],n);let o=u(i,["title"]);e!==void 0&&o!=null&&p(e,["requests[]","title"],o);let a=u(i,["outputDimensionality"]);if(e!==void 0&&a!=null&&p(e,["requests[]","outputDimensionality"],a),u(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function I0(i,e){let t={},n=u(e,["fileName"]);n!=null&&p(t,["file_name"],n);let o=u(e,["inlinedRequests"]);return o!=null&&p(t,["requests"],T0(i,o)),t}function P0(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function F0(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function N0(i){let e={},t=u(i,["mode"]);t!=null&&p(e,["mode"],t);let n=u(i,["allowedFunctionNames"]);if(n!=null&&p(e,["allowedFunctionNames"],n),u(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function R0(i,e,t){let n={},o=u(e,["systemInstruction"]);t!==void 0&&o!=null&&p(t,["systemInstruction"],Xc($e(o)));let a=u(e,["temperature"]);a!=null&&p(n,["temperature"],a);let d=u(e,["topP"]);d!=null&&p(n,["topP"],d);let m=u(e,["topK"]);m!=null&&p(n,["topK"],m);let f=u(e,["candidateCount"]);f!=null&&p(n,["candidateCount"],f);let h=u(e,["maxOutputTokens"]);h!=null&&p(n,["maxOutputTokens"],h);let C=u(e,["stopSequences"]);C!=null&&p(n,["stopSequences"],C);let y=u(e,["responseLogprobs"]);y!=null&&p(n,["responseLogprobs"],y);let E=u(e,["logprobs"]);E!=null&&p(n,["logprobs"],E);let T=u(e,["presencePenalty"]);T!=null&&p(n,["presencePenalty"],T);let R=u(e,["frequencyPenalty"]);R!=null&&p(n,["frequencyPenalty"],R);let L=u(e,["seed"]);L!=null&&p(n,["seed"],L);let q=u(e,["responseMimeType"]);q!=null&&p(n,["responseMimeType"],q);let U=u(e,["responseSchema"]);U!=null&&p(n,["responseSchema"],Ks(U));let Q=u(e,["responseJsonSchema"]);if(Q!=null&&p(n,["responseJsonSchema"],Q),u(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let J=u(e,["safetySettings"]);if(t!==void 0&&J!=null){let Ie=J;Array.isArray(Ie)&&(Ie=Ie.map(nt=>X0(nt))),p(t,["safetySettings"],Ie)}let ie=u(e,["tools"]);if(t!==void 0&&ie!=null){let Ie=_n(ie);Array.isArray(Ie)&&(Ie=Ie.map(nt=>j0(fn(nt)))),p(t,["tools"],Ie)}let se=u(e,["toolConfig"]);if(t!==void 0&&se!=null&&p(t,["toolConfig"],Z0(se)),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let he=u(e,["cachedContent"]);t!==void 0&&he!=null&&p(t,["cachedContent"],Mt(i,he));let ae=u(e,["responseModalities"]);ae!=null&&p(n,["responseModalities"],ae);let Se=u(e,["mediaResolution"]);Se!=null&&p(n,["mediaResolution"],Se);let ce=u(e,["speechConfig"]);if(ce!=null&&p(n,["speechConfig"],Ws(ce)),u(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let ve=u(e,["thinkingConfig"]);ve!=null&&p(n,["thinkingConfig"],ve);let Be=u(e,["imageConfig"]);Be!=null&&p(n,["imageConfig"],U0(Be));let Ue=u(e,["enableEnhancedCivicAnswers"]);return Ue!=null&&p(n,["enableEnhancedCivicAnswers"],Ue),n}function O0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["candidates"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>C0(h))),p(e,["candidates"],f)}let o=u(i,["modelVersion"]);o!=null&&p(e,["modelVersion"],o);let a=u(i,["promptFeedback"]);a!=null&&p(e,["promptFeedback"],a);let d=u(i,["responseId"]);d!=null&&p(e,["responseId"],d);let m=u(i,["usageMetadata"]);return m!=null&&p(e,["usageMetadata"],m),e}function B0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Cn(i,n)),t}function V0(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Cn(i,n)),t}function L0(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function G0(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function U0(i){let e={},t=u(i,["aspectRatio"]);t!=null&&p(e,["aspectRatio"],t);let n=u(i,["imageSize"]);if(n!=null&&p(e,["imageSize"],n),u(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function q0(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["request","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let m=dt(o);Array.isArray(m)&&(m=m.map(f=>Xc(f))),p(t,["request","contents"],m)}let a=u(e,["metadata"]);a!=null&&p(t,["metadata"],a);let d=u(e,["config"]);return d!=null&&p(t,["request","generationConfig"],R0(i,d,u(t,["request"],{}))),t}function $0(i){let e={},t=u(i,["response"]);t!=null&&p(e,["response"],O0(t));let n=u(i,["error"]);return n!=null&&p(e,["error"],n),e}function H0(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);if(e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),u(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function z0(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);e!==void 0&&o!=null&&p(e,["_query","pageToken"],o);let a=u(i,["filter"]);return e!==void 0&&a!=null&&p(e,["_query","filter"],a),t}function K0(i){let e={},t=u(i,["config"]);return t!=null&&H0(t,e),e}function W0(i){let e={},t=u(i,["config"]);return t!=null&&z0(t,e),e}function J0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["operations"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>Ti(d))),p(e,["batchJobs"],a)}return e}function Q0(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["batchPredictionJobs"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>ds(d))),p(e,["batchJobs"],a)}return e}function Y0(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let a=u(i,["fileData"]);a!=null&&p(e,["fileData"],P0(a));let d=u(i,["functionCall"]);d!=null&&p(e,["functionCall"],F0(d));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let f=u(i,["inlineData"]);f!=null&&p(e,["inlineData"],h0(f));let h=u(i,["text"]);h!=null&&p(e,["text"],h);let C=u(i,["thought"]);C!=null&&p(e,["thought"],C);let y=u(i,["thoughtSignature"]);y!=null&&p(e,["thoughtSignature"],y);let E=u(i,["videoMetadata"]);return E!=null&&p(e,["videoMetadata"],E),e}function X0(i){let e={},t=u(i,["category"]);if(t!=null&&p(e,["category"],t),u(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=u(i,["threshold"]);return n!=null&&p(e,["threshold"],n),e}function Z0(i){let e={},t=u(i,["functionCallingConfig"]);t!=null&&p(e,["functionCallingConfig"],N0(t));let n=u(i,["retrievalConfig"]);return n!=null&&p(e,["retrievalConfig"],n),e}function j0(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>y)),p(e,["functionDeclarations"],C)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let a=u(i,["fileSearch"]);a!=null&&p(e,["fileSearch"],a);let d=u(i,["codeExecution"]);if(d!=null&&p(e,["codeExecution"],d),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],L0(m));let f=u(i,["googleSearch"]);f!=null&&p(e,["googleSearch"],G0(f));let h=u(i,["urlContext"]);return h!=null&&p(e,["urlContext"],h),e}var Rt=(function(i){return i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents",i})(Rt||{}),Dt=class{constructor(e,t,n,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,o)}init(e,t,n){var o,a;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let d={config:{}};!n||Object.keys(n).length===0?d={config:{}}:typeof n=="object"?d=Object.assign({},n):d=n,d.config&&(d.config.pageToken=t.nextPageToken),this.paramsInternal=d,this.pageInternalSize=(a=(o=d.config)===null||o===void 0?void 0:o.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var us=class extends ft{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Dt(Rt.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=hc(this.apiClient,e),n=t._url,o=Z("{model}:batchGenerateContent",n),m=t.batch.inputConfig.requests,f=m.requests,h=[];for(let C of f){let y=Object.assign({},C);if(y.systemInstruction){let E=y.systemInstruction;delete y.systemInstruction;let T=y.request;T.systemInstruction=E,y.request=T}h.push(y)}return m.requests=h,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},o=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${o}`),n.dest===void 0){let a=this.getGcsUri(e),d=this.getBigqueryUri(e);if(a)a.endsWith(".jsonl")?n.dest=`${a.slice(0,-6)}/dest`:n.dest=`${a}_dest_${o}`;else if(d)n.dest=`${d}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=y0(this.apiClient,e);return m=Z("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>ds(C))}else{let h=hc(this.apiClient,e);return m=Z("{model}:batchGenerateContent",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>Ti(C))}}async createEmbeddingsInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=w0(this.apiClient,e);return a=Z("{model}:asyncBatchEmbedContent",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>Ti(f))}}async get(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=V0(this.apiClient,e);return m=Z("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>ds(C))}else{let h=B0(this.apiClient,e);return m=Z("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>Ti(C))}}async cancel(e){var t,n,o,a;let d="",m={};if(this.apiClient.isVertexAI()){let f=_0(this.apiClient,e);d=Z("batchPredictionJobs/{name}:cancel",f._url),m=f._query,delete f._url,delete f._query,await this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let f=f0(this.apiClient,e);d=Z("batches/{name}:cancel",f._url),m=f._query,delete f._url,delete f._query,await this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=W0(e);return m=Z("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Q0(C),E=new Ui;return Object.assign(E,y),E})}else{let h=K0(e);return m=Z("batches",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=J0(C),E=new Ui;return Object.assign(E,y),E})}}async delete(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=A0(this.apiClient,e);return m=Z("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>M0(C))}else{let h=E0(this.apiClient,e);return m=Z("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>D0(C))}}};function em(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function fc(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>Sm(a))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function tm(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);e!==void 0&&o!=null&&p(e,["expireTime"],o);let a=u(i,["displayName"]);e!==void 0&&a!=null&&p(e,["displayName"],a);let d=u(i,["contents"]);if(e!==void 0&&d!=null){let C=dt(d);Array.isArray(C)&&(C=C.map(y=>fc(y))),p(e,["contents"],C)}let m=u(i,["systemInstruction"]);e!==void 0&&m!=null&&p(e,["systemInstruction"],fc($e(m)));let f=u(i,["tools"]);if(e!==void 0&&f!=null){let C=f;Array.isArray(C)&&(C=C.map(y=>Em(y))),p(e,["tools"],C)}let h=u(i,["toolConfig"]);if(e!==void 0&&h!=null&&p(e,["toolConfig"],wm(h)),u(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function nm(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);e!==void 0&&o!=null&&p(e,["expireTime"],o);let a=u(i,["displayName"]);e!==void 0&&a!=null&&p(e,["displayName"],a);let d=u(i,["contents"]);if(e!==void 0&&d!=null){let y=dt(d);Array.isArray(y)&&(y=y.map(E=>E)),p(e,["contents"],y)}let m=u(i,["systemInstruction"]);e!==void 0&&m!=null&&p(e,["systemInstruction"],$e(m));let f=u(i,["tools"]);if(e!==void 0&&f!=null){let y=f;Array.isArray(y)&&(y=y.map(E=>Am(E))),p(e,["tools"],y)}let h=u(i,["toolConfig"]);e!==void 0&&h!=null&&p(e,["toolConfig"],h);let C=u(i,["kmsKeyName"]);return e!==void 0&&C!=null&&p(e,["encryption_spec","kmsKeyName"],C),t}function im(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["model"],Lc(i,n));let o=u(e,["config"]);return o!=null&&tm(o,t),t}function om(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["model"],Lc(i,n));let o=u(e,["config"]);return o!=null&&nm(o,t),t}function rm(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Mt(i,n)),t}function sm(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Mt(i,n)),t}function am(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function lm(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function cm(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function dm(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function um(i){let e={},t=u(i,["mode"]);t!=null&&p(e,["mode"],t);let n=u(i,["allowedFunctionNames"]);if(n!=null&&p(e,["allowedFunctionNames"],n),u(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function mm(i){let e={};if(u(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=u(i,["description"]);t!=null&&p(e,["description"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["parameters"]);o!=null&&p(e,["parameters"],o);let a=u(i,["parametersJsonSchema"]);a!=null&&p(e,["parametersJsonSchema"],a);let d=u(i,["response"]);d!=null&&p(e,["response"],d);let m=u(i,["responseJsonSchema"]);return m!=null&&p(e,["responseJsonSchema"],m),e}function pm(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Mt(i,n)),t}function gm(i,e){let t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],Mt(i,n)),t}function hm(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function fm(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function _m(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function Cm(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function vm(i){let e={},t=u(i,["config"]);return t!=null&&_m(t,e),e}function bm(i){let e={},t=u(i,["config"]);return t!=null&&Cm(t,e),e}function xm(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["cachedContents"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["cachedContents"],a)}return e}function ym(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["cachedContents"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["cachedContents"],a)}return e}function Sm(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let a=u(i,["fileData"]);a!=null&&p(e,["fileData"],cm(a));let d=u(i,["functionCall"]);d!=null&&p(e,["functionCall"],dm(d));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let f=u(i,["inlineData"]);f!=null&&p(e,["inlineData"],em(f));let h=u(i,["text"]);h!=null&&p(e,["text"],h);let C=u(i,["thought"]);C!=null&&p(e,["thought"],C);let y=u(i,["thoughtSignature"]);y!=null&&p(e,["thoughtSignature"],y);let E=u(i,["videoMetadata"]);return E!=null&&p(e,["videoMetadata"],E),e}function wm(i){let e={},t=u(i,["functionCallingConfig"]);t!=null&&p(e,["functionCallingConfig"],um(t));let n=u(i,["retrievalConfig"]);return n!=null&&p(e,["retrievalConfig"],n),e}function Em(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>y)),p(e,["functionDeclarations"],C)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let a=u(i,["fileSearch"]);a!=null&&p(e,["fileSearch"],a);let d=u(i,["codeExecution"]);if(d!=null&&p(e,["codeExecution"],d),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],hm(m));let f=u(i,["googleSearch"]);f!=null&&p(e,["googleSearch"],fm(f));let h=u(i,["urlContext"]);return h!=null&&p(e,["urlContext"],h),e}function Am(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let y=t;Array.isArray(y)&&(y=y.map(E=>mm(E))),p(e,["functionDeclarations"],y)}let n=u(i,["retrieval"]);n!=null&&p(e,["retrieval"],n);let o=u(i,["googleSearchRetrieval"]);o!=null&&p(e,["googleSearchRetrieval"],o);let a=u(i,["computerUse"]);if(a!=null&&p(e,["computerUse"],a),u(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let d=u(i,["codeExecution"]);d!=null&&p(e,["codeExecution"],d);let m=u(i,["enterpriseWebSearch"]);m!=null&&p(e,["enterpriseWebSearch"],m);let f=u(i,["googleMaps"]);f!=null&&p(e,["googleMaps"],f);let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],h);let C=u(i,["urlContext"]);return C!=null&&p(e,["urlContext"],C),e}function Dm(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);return e!==void 0&&o!=null&&p(e,["expireTime"],o),t}function Mm(i,e){let t={},n=u(i,["ttl"]);e!==void 0&&n!=null&&p(e,["ttl"],n);let o=u(i,["expireTime"]);return e!==void 0&&o!=null&&p(e,["expireTime"],o),t}function Tm(i,e){let t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],Mt(i,n));let o=u(e,["config"]);return o!=null&&Dm(o,t),t}function km(i,e){let t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],Mt(i,n));let o=u(e,["config"]);return o!=null&&Mm(o,t),t}var ms=class extends ft{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Dt(Rt.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=om(this.apiClient,e);return m=Z("cachedContents",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>C)}else{let h=im(this.apiClient,e);return m=Z("cachedContents",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>C)}}async get(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=gm(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>C)}else{let h=pm(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>C)}}async delete(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=sm(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=lm(C),E=new Li;return Object.assign(E,y),E})}else{let h=rm(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=am(C),E=new Li;return Object.assign(E,y),E})}}async update(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=km(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>C)}else{let h=Tm(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>C)}}async listInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=bm(e);return m=Z("cachedContents",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=ym(C),E=new Gi;return Object.assign(E,y),E})}else{let h=vm(e);return m=Z("cachedContents",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=xm(C),E=new Gi;return Object.assign(E,y),E})}}};function $i(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(i);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(i,n[o])&&(t[n[o]]=i[n[o]]);return t}function _c(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fe(i){return this instanceof fe?(this.v=i,this):new fe(i)}function gt(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),o,a=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),m("next"),m("throw"),m("return",d),o[Symbol.asyncIterator]=function(){return this},o;function d(T){return function(R){return Promise.resolve(R).then(T,y)}}function m(T,R){n[T]&&(o[T]=function(L){return new Promise(function(q,U){a.push([T,L,q,U])>1||f(T,L)})},R&&(o[T]=R(o[T])))}function f(T,R){try{h(n[T](R))}catch(L){E(a[0][3],L)}}function h(T){T.value instanceof fe?Promise.resolve(T.value.v).then(C,y):E(a[0][2],T)}function C(T){f("next",T)}function y(T){f("throw",T)}function E(T,R){T(R),a.shift(),a.length&&f(a[0][0],a[0][1])}}function ht(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof _c=="function"?_c(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=i[a]&&function(d){return new Promise(function(m,f){d=i[a](d),o(m,f,d.done,d.value)})}}function o(a,d,m,f){Promise.resolve(f).then(function(h){a({value:h,done:m})},d)}}function Im(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Zc(t)}function Zc(i){if(i.parts===void 0||i.parts.length===0)return!1;for(let e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Pm(i){if(i.length!==0){for(let e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Cc(i){if(i===void 0||i.length===0)return[];let e=[],t=i.length,n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{let o=[],a=!0;for(;n<t&&i[n].role==="model";)o.push(i[n]),a&&!Zc(i[n])&&(a=!1),n++;a?e.push(...o):e.pop()}return e}var ps=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new gs(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},gs=class{constructor(e,t,n,o={},a=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=o,this.history=a,this.sendPromise=Promise.resolve(),Pm(a)}async sendMessage(e){var t;await this.sendPromise;let n=$e(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var a,d,m;let f=await o,h=(d=(a=f.candidates)===null||a===void 0?void 0:a[0])===null||d===void 0?void 0:d.content,C=f.automaticFunctionCallingHistory,y=this.getHistory(!0).length,E=[];C!=null&&(E=(m=C.slice(y))!==null&&m!==void 0?m:[]);let T=h?[h]:[];this.recordHistory(n,T,E)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;let n=$e(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});let a=await o;return this.processStreamResponse(a,n)}getHistory(e=!1){let t=e?Cc(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return gt(this,arguments,function*(){var o,a,d,m,f,h;let C=[];try{for(var y=!0,E=ht(e),T;T=yield fe(E.next()),o=T.done,!o;y=!0){m=T.value,y=!1;let R=m;if(Im(R)){let L=(h=(f=R.candidates)===null||f===void 0?void 0:f[0])===null||h===void 0?void 0:h.content;L!==void 0&&C.push(L)}yield yield fe(R)}}catch(R){a={error:R}}finally{try{!y&&!o&&(d=E.return)&&(yield fe(d.call(E)))}finally{if(a)throw a.error}}this.recordHistory(t,C)})}recordHistory(e,t,n){let o=[];t.length>0&&t.every(a=>a.role!==void 0)?o=t:o.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...Cc(n)):this.history.push(e),this.history.push(...o)}};var Hi=class i extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,i.prototype)}};function Fm(i){let e={},t=u(i,["file"]);return t!=null&&p(e,["file"],t),e}function Nm(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function Rm(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","file"],zc(t)),e}function Om(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function Bm(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","file"],zc(t)),e}function Vm(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function Lm(i){let e={},t=u(i,["config"]);return t!=null&&Vm(t,e),e}function Gm(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["files"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["files"],a)}return e}var hs=class extends ft{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Dt(Rt.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Lm(e);return a=Z("files",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(h=>{let C=h;return C.sdkHttpResponse={headers:f.headers},C})),o.then(f=>{let h=Gm(f),C=new is;return Object.assign(C,h),C})}}async createInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Fm(e);return a=Z("upload/v1beta/files",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>{let h=Nm(f),C=new os;return Object.assign(C,h),C})}}async get(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Bm(e);return a=Z("files/{file}",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Rm(e);return a=Z("files/{file}",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(h=>{let C=h;return C.sdkHttpResponse={headers:f.headers},C})),o.then(f=>{let h=Om(f),C=new rs;return Object.assign(C,h),C})}}};function ki(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Um(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>ip(a))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function qm(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function $m(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Hm(i){let e={};if(u(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=u(i,["description"]);t!=null&&p(e,["description"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["parameters"]);o!=null&&p(e,["parameters"],o);let a=u(i,["parametersJsonSchema"]);a!=null&&p(e,["parametersJsonSchema"],a);let d=u(i,["response"]);d!=null&&p(e,["response"],d);let m=u(i,["responseJsonSchema"]);return m!=null&&p(e,["responseJsonSchema"],m),e}function zm(i){let e={},t=u(i,["modelSelectionConfig"]);t!=null&&p(e,["modelConfig"],t);let n=u(i,["responseJsonSchema"]);n!=null&&p(e,["responseJsonSchema"],n);let o=u(i,["audioTimestamp"]);o!=null&&p(e,["audioTimestamp"],o);let a=u(i,["candidateCount"]);a!=null&&p(e,["candidateCount"],a);let d=u(i,["enableAffectiveDialog"]);d!=null&&p(e,["enableAffectiveDialog"],d);let m=u(i,["frequencyPenalty"]);m!=null&&p(e,["frequencyPenalty"],m);let f=u(i,["logprobs"]);f!=null&&p(e,["logprobs"],f);let h=u(i,["maxOutputTokens"]);h!=null&&p(e,["maxOutputTokens"],h);let C=u(i,["mediaResolution"]);C!=null&&p(e,["mediaResolution"],C);let y=u(i,["presencePenalty"]);y!=null&&p(e,["presencePenalty"],y);let E=u(i,["responseLogprobs"]);E!=null&&p(e,["responseLogprobs"],E);let T=u(i,["responseMimeType"]);T!=null&&p(e,["responseMimeType"],T);let R=u(i,["responseModalities"]);R!=null&&p(e,["responseModalities"],R);let L=u(i,["responseSchema"]);L!=null&&p(e,["responseSchema"],L);let q=u(i,["routingConfig"]);q!=null&&p(e,["routingConfig"],q);let U=u(i,["seed"]);U!=null&&p(e,["seed"],U);let Q=u(i,["speechConfig"]);Q!=null&&p(e,["speechConfig"],Q);let J=u(i,["stopSequences"]);J!=null&&p(e,["stopSequences"],J);let ie=u(i,["temperature"]);ie!=null&&p(e,["temperature"],ie);let se=u(i,["thinkingConfig"]);se!=null&&p(e,["thinkingConfig"],se);let he=u(i,["topK"]);he!=null&&p(e,["topK"],he);let ae=u(i,["topP"]);if(ae!=null&&p(e,["topP"],ae),u(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Km(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function Wm(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function Jm(i,e){let t={},n=u(i,["generationConfig"]);e!==void 0&&n!=null&&p(e,["setup","generationConfig"],n);let o=u(i,["responseModalities"]);e!==void 0&&o!=null&&p(e,["setup","generationConfig","responseModalities"],o);let a=u(i,["temperature"]);e!==void 0&&a!=null&&p(e,["setup","generationConfig","temperature"],a);let d=u(i,["topP"]);e!==void 0&&d!=null&&p(e,["setup","generationConfig","topP"],d);let m=u(i,["topK"]);e!==void 0&&m!=null&&p(e,["setup","generationConfig","topK"],m);let f=u(i,["maxOutputTokens"]);e!==void 0&&f!=null&&p(e,["setup","generationConfig","maxOutputTokens"],f);let h=u(i,["mediaResolution"]);e!==void 0&&h!=null&&p(e,["setup","generationConfig","mediaResolution"],h);let C=u(i,["seed"]);e!==void 0&&C!=null&&p(e,["setup","generationConfig","seed"],C);let y=u(i,["speechConfig"]);e!==void 0&&y!=null&&p(e,["setup","generationConfig","speechConfig"],Js(y));let E=u(i,["thinkingConfig"]);e!==void 0&&E!=null&&p(e,["setup","generationConfig","thinkingConfig"],E);let T=u(i,["enableAffectiveDialog"]);e!==void 0&&T!=null&&p(e,["setup","generationConfig","enableAffectiveDialog"],T);let R=u(i,["systemInstruction"]);e!==void 0&&R!=null&&p(e,["setup","systemInstruction"],Um($e(R)));let L=u(i,["tools"]);if(e!==void 0&&L!=null){let he=_n(L);Array.isArray(he)&&(he=he.map(ae=>rp(fn(ae)))),p(e,["setup","tools"],he)}let q=u(i,["sessionResumption"]);e!==void 0&&q!=null&&p(e,["setup","sessionResumption"],op(q));let U=u(i,["inputAudioTranscription"]);e!==void 0&&U!=null&&p(e,["setup","inputAudioTranscription"],U);let Q=u(i,["outputAudioTranscription"]);e!==void 0&&Q!=null&&p(e,["setup","outputAudioTranscription"],Q);let J=u(i,["realtimeInputConfig"]);e!==void 0&&J!=null&&p(e,["setup","realtimeInputConfig"],J);let ie=u(i,["contextWindowCompression"]);e!==void 0&&ie!=null&&p(e,["setup","contextWindowCompression"],ie);let se=u(i,["proactivity"]);if(e!==void 0&&se!=null&&p(e,["setup","proactivity"],se),u(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function Qm(i,e){let t={},n=u(i,["generationConfig"]);e!==void 0&&n!=null&&p(e,["setup","generationConfig"],zm(n));let o=u(i,["responseModalities"]);e!==void 0&&o!=null&&p(e,["setup","generationConfig","responseModalities"],o);let a=u(i,["temperature"]);e!==void 0&&a!=null&&p(e,["setup","generationConfig","temperature"],a);let d=u(i,["topP"]);e!==void 0&&d!=null&&p(e,["setup","generationConfig","topP"],d);let m=u(i,["topK"]);e!==void 0&&m!=null&&p(e,["setup","generationConfig","topK"],m);let f=u(i,["maxOutputTokens"]);e!==void 0&&f!=null&&p(e,["setup","generationConfig","maxOutputTokens"],f);let h=u(i,["mediaResolution"]);e!==void 0&&h!=null&&p(e,["setup","generationConfig","mediaResolution"],h);let C=u(i,["seed"]);e!==void 0&&C!=null&&p(e,["setup","generationConfig","seed"],C);let y=u(i,["speechConfig"]);e!==void 0&&y!=null&&p(e,["setup","generationConfig","speechConfig"],Js(y));let E=u(i,["thinkingConfig"]);e!==void 0&&E!=null&&p(e,["setup","generationConfig","thinkingConfig"],E);let T=u(i,["enableAffectiveDialog"]);e!==void 0&&T!=null&&p(e,["setup","generationConfig","enableAffectiveDialog"],T);let R=u(i,["systemInstruction"]);e!==void 0&&R!=null&&p(e,["setup","systemInstruction"],$e(R));let L=u(i,["tools"]);if(e!==void 0&&L!=null){let ae=_n(L);Array.isArray(ae)&&(ae=ae.map(Se=>sp(fn(Se)))),p(e,["setup","tools"],ae)}let q=u(i,["sessionResumption"]);e!==void 0&&q!=null&&p(e,["setup","sessionResumption"],q);let U=u(i,["inputAudioTranscription"]);e!==void 0&&U!=null&&p(e,["setup","inputAudioTranscription"],U);let Q=u(i,["outputAudioTranscription"]);e!==void 0&&Q!=null&&p(e,["setup","outputAudioTranscription"],Q);let J=u(i,["realtimeInputConfig"]);e!==void 0&&J!=null&&p(e,["setup","realtimeInputConfig"],J);let ie=u(i,["contextWindowCompression"]);e!==void 0&&ie!=null&&p(e,["setup","contextWindowCompression"],ie);let se=u(i,["proactivity"]);e!==void 0&&se!=null&&p(e,["setup","proactivity"],se);let he=u(i,["explicitVadSignal"]);return e!==void 0&&he!=null&&p(e,["setup","explicitVadSignal"],he),t}function Ym(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["setup","model"],Te(i,n));let o=u(e,["config"]);return o!=null&&p(t,["config"],Jm(o,t)),t}function Xm(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["setup","model"],Te(i,n));let o=u(e,["config"]);return o!=null&&p(t,["config"],Qm(o,t)),t}function Zm(i){let e={},t=u(i,["musicGenerationConfig"]);return t!=null&&p(e,["musicGenerationConfig"],t),e}function jm(i){let e={},t=u(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),p(e,["weightedPrompts"],n)}return e}function ep(i){let e={},t=u(i,["media"]);if(t!=null){let h=Gc(t);Array.isArray(h)&&(h=h.map(C=>ki(C))),p(e,["mediaChunks"],h)}let n=u(i,["audio"]);n!=null&&p(e,["audio"],ki(qc(n)));let o=u(i,["audioStreamEnd"]);o!=null&&p(e,["audioStreamEnd"],o);let a=u(i,["video"]);a!=null&&p(e,["video"],ki(Uc(a)));let d=u(i,["text"]);d!=null&&p(e,["text"],d);let m=u(i,["activityStart"]);m!=null&&p(e,["activityStart"],m);let f=u(i,["activityEnd"]);return f!=null&&p(e,["activityEnd"],f),e}function tp(i){let e={},t=u(i,["media"]);if(t!=null){let h=Gc(t);Array.isArray(h)&&(h=h.map(C=>C)),p(e,["mediaChunks"],h)}let n=u(i,["audio"]);n!=null&&p(e,["audio"],qc(n));let o=u(i,["audioStreamEnd"]);o!=null&&p(e,["audioStreamEnd"],o);let a=u(i,["video"]);a!=null&&p(e,["video"],Uc(a));let d=u(i,["text"]);d!=null&&p(e,["text"],d);let m=u(i,["activityStart"]);m!=null&&p(e,["activityStart"],m);let f=u(i,["activityEnd"]);return f!=null&&p(e,["activityEnd"],f),e}function np(i){let e={},t=u(i,["setupComplete"]);t!=null&&p(e,["setupComplete"],t);let n=u(i,["serverContent"]);n!=null&&p(e,["serverContent"],n);let o=u(i,["toolCall"]);o!=null&&p(e,["toolCall"],o);let a=u(i,["toolCallCancellation"]);a!=null&&p(e,["toolCallCancellation"],a);let d=u(i,["usageMetadata"]);d!=null&&p(e,["usageMetadata"],ap(d));let m=u(i,["goAway"]);m!=null&&p(e,["goAway"],m);let f=u(i,["sessionResumptionUpdate"]);f!=null&&p(e,["sessionResumptionUpdate"],f);let h=u(i,["voiceActivityDetectionSignal"]);return h!=null&&p(e,["voiceActivityDetectionSignal"],h),e}function ip(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let a=u(i,["fileData"]);a!=null&&p(e,["fileData"],qm(a));let d=u(i,["functionCall"]);d!=null&&p(e,["functionCall"],$m(d));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let f=u(i,["inlineData"]);f!=null&&p(e,["inlineData"],ki(f));let h=u(i,["text"]);h!=null&&p(e,["text"],h);let C=u(i,["thought"]);C!=null&&p(e,["thought"],C);let y=u(i,["thoughtSignature"]);y!=null&&p(e,["thoughtSignature"],y);let E=u(i,["videoMetadata"]);return E!=null&&p(e,["videoMetadata"],E),e}function op(i){let e={},t=u(i,["handle"]);if(t!=null&&p(e,["handle"],t),u(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function rp(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>y)),p(e,["functionDeclarations"],C)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let a=u(i,["fileSearch"]);a!=null&&p(e,["fileSearch"],a);let d=u(i,["codeExecution"]);if(d!=null&&p(e,["codeExecution"],d),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],Km(m));let f=u(i,["googleSearch"]);f!=null&&p(e,["googleSearch"],Wm(f));let h=u(i,["urlContext"]);return h!=null&&p(e,["urlContext"],h),e}function sp(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let y=t;Array.isArray(y)&&(y=y.map(E=>Hm(E))),p(e,["functionDeclarations"],y)}let n=u(i,["retrieval"]);n!=null&&p(e,["retrieval"],n);let o=u(i,["googleSearchRetrieval"]);o!=null&&p(e,["googleSearchRetrieval"],o);let a=u(i,["computerUse"]);if(a!=null&&p(e,["computerUse"],a),u(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let d=u(i,["codeExecution"]);d!=null&&p(e,["codeExecution"],d);let m=u(i,["enterpriseWebSearch"]);m!=null&&p(e,["enterpriseWebSearch"],m);let f=u(i,["googleMaps"]);f!=null&&p(e,["googleMaps"],f);let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],h);let C=u(i,["urlContext"]);return C!=null&&p(e,["urlContext"],C),e}function ap(i){let e={},t=u(i,["promptTokenCount"]);t!=null&&p(e,["promptTokenCount"],t);let n=u(i,["cachedContentTokenCount"]);n!=null&&p(e,["cachedContentTokenCount"],n);let o=u(i,["candidatesTokenCount"]);o!=null&&p(e,["responseTokenCount"],o);let a=u(i,["toolUsePromptTokenCount"]);a!=null&&p(e,["toolUsePromptTokenCount"],a);let d=u(i,["thoughtsTokenCount"]);d!=null&&p(e,["thoughtsTokenCount"],d);let m=u(i,["totalTokenCount"]);m!=null&&p(e,["totalTokenCount"],m);let f=u(i,["promptTokensDetails"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(R=>R)),p(e,["promptTokensDetails"],T)}let h=u(i,["cacheTokensDetails"]);if(h!=null){let T=h;Array.isArray(T)&&(T=T.map(R=>R)),p(e,["cacheTokensDetails"],T)}let C=u(i,["candidatesTokensDetails"]);if(C!=null){let T=C;Array.isArray(T)&&(T=T.map(R=>R)),p(e,["responseTokensDetails"],T)}let y=u(i,["toolUsePromptTokensDetails"]);if(y!=null){let T=y;Array.isArray(T)&&(T=T.map(R=>R)),p(e,["toolUsePromptTokensDetails"],T)}let E=u(i,["trafficType"]);return E!=null&&p(e,["trafficType"],E),e}function lp(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function cp(i){let e={},t=u(i,["content"]);t!=null&&p(e,["content"],t);let n=u(i,["citationMetadata"]);n!=null&&p(e,["citationMetadata"],dp(n));let o=u(i,["tokenCount"]);o!=null&&p(e,["tokenCount"],o);let a=u(i,["finishReason"]);a!=null&&p(e,["finishReason"],a);let d=u(i,["avgLogprobs"]);d!=null&&p(e,["avgLogprobs"],d);let m=u(i,["groundingMetadata"]);m!=null&&p(e,["groundingMetadata"],m);let f=u(i,["index"]);f!=null&&p(e,["index"],f);let h=u(i,["logprobsResult"]);h!=null&&p(e,["logprobsResult"],h);let C=u(i,["safetyRatings"]);if(C!=null){let E=C;Array.isArray(E)&&(E=E.map(T=>T)),p(e,["safetyRatings"],E)}let y=u(i,["urlContextMetadata"]);return y!=null&&p(e,["urlContextMetadata"],y),e}function dp(i){let e={},t=u(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>o)),p(e,["citations"],n)}return e}function up(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let a=dt(o);Array.isArray(a)&&(a=a.map(d=>d)),p(t,["contents"],a)}return t}function mp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["tokensInfo"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),p(e,["tokensInfo"],o)}return e}function pp(i){let e={},t=u(i,["values"]);t!=null&&p(e,["values"],t);let n=u(i,["statistics"]);return n!=null&&p(e,["statistics"],gp(n)),e}function gp(i){let e={},t=u(i,["truncated"]);t!=null&&p(e,["truncated"],t);let n=u(i,["token_count"]);return n!=null&&p(e,["tokenCount"],n),e}function ro(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>Sg(a))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function hp(i){let e={},t=u(i,["controlType"]);t!=null&&p(e,["controlType"],t);let n=u(i,["enableControlImageComputation"]);return n!=null&&p(e,["computeControl"],n),e}function fp(i){let e={};if(u(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(u(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(u(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function _p(i,e){let t={},n=u(i,["systemInstruction"]);e!==void 0&&n!=null&&p(e,["systemInstruction"],$e(n));let o=u(i,["tools"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(m=>nd(m))),p(e,["tools"],d)}let a=u(i,["generationConfig"]);return e!==void 0&&a!=null&&p(e,["generationConfig"],lg(a)),t}function Cp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let d=dt(o);Array.isArray(d)&&(d=d.map(m=>ro(m))),p(t,["contents"],d)}let a=u(e,["config"]);return a!=null&&fp(a),t}function vp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let d=dt(o);Array.isArray(d)&&(d=d.map(m=>m)),p(t,["contents"],d)}let a=u(e,["config"]);return a!=null&&_p(a,t),t}function bp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["totalTokens"]);n!=null&&p(e,["totalTokens"],n);let o=u(i,["cachedContentTokenCount"]);return o!=null&&p(e,["cachedContentTokenCount"],o),e}function xp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["totalTokens"]);return n!=null&&p(e,["totalTokens"],n),e}function yp(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Te(i,n)),t}function Sp(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Te(i,n)),t}function wp(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function Ep(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}function Ap(i,e){let t={},n=u(i,["outputGcsUri"]);e!==void 0&&n!=null&&p(e,["parameters","storageUri"],n);let o=u(i,["negativePrompt"]);e!==void 0&&o!=null&&p(e,["parameters","negativePrompt"],o);let a=u(i,["numberOfImages"]);e!==void 0&&a!=null&&p(e,["parameters","sampleCount"],a);let d=u(i,["aspectRatio"]);e!==void 0&&d!=null&&p(e,["parameters","aspectRatio"],d);let m=u(i,["guidanceScale"]);e!==void 0&&m!=null&&p(e,["parameters","guidanceScale"],m);let f=u(i,["seed"]);e!==void 0&&f!=null&&p(e,["parameters","seed"],f);let h=u(i,["safetyFilterLevel"]);e!==void 0&&h!=null&&p(e,["parameters","safetySetting"],h);let C=u(i,["personGeneration"]);e!==void 0&&C!=null&&p(e,["parameters","personGeneration"],C);let y=u(i,["includeSafetyAttributes"]);e!==void 0&&y!=null&&p(e,["parameters","includeSafetyAttributes"],y);let E=u(i,["includeRaiReason"]);e!==void 0&&E!=null&&p(e,["parameters","includeRaiReason"],E);let T=u(i,["language"]);e!==void 0&&T!=null&&p(e,["parameters","language"],T);let R=u(i,["outputMimeType"]);e!==void 0&&R!=null&&p(e,["parameters","outputOptions","mimeType"],R);let L=u(i,["outputCompressionQuality"]);e!==void 0&&L!=null&&p(e,["parameters","outputOptions","compressionQuality"],L);let q=u(i,["addWatermark"]);e!==void 0&&q!=null&&p(e,["parameters","addWatermark"],q);let U=u(i,["labels"]);e!==void 0&&U!=null&&p(e,["labels"],U);let Q=u(i,["editMode"]);e!==void 0&&Q!=null&&p(e,["parameters","editMode"],Q);let J=u(i,["baseSteps"]);return e!==void 0&&J!=null&&p(e,["parameters","editConfig","baseSteps"],J),t}function Dp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let a=u(e,["referenceImages"]);if(a!=null){let m=a;Array.isArray(m)&&(m=m.map(f=>Tg(f))),p(t,["instances[0]","referenceImages"],m)}let d=u(e,["config"]);return d!=null&&Ap(d,t),t}function Mp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>so(a))),p(e,["generatedImages"],o)}return e}function Tp(i,e){let t={},n=u(i,["taskType"]);e!==void 0&&n!=null&&p(e,["requests[]","taskType"],n);let o=u(i,["title"]);e!==void 0&&o!=null&&p(e,["requests[]","title"],o);let a=u(i,["outputDimensionality"]);if(e!==void 0&&a!=null&&p(e,["requests[]","outputDimensionality"],a),u(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function kp(i,e){let t={},n=u(i,["taskType"]);e!==void 0&&n!=null&&p(e,["instances[]","task_type"],n);let o=u(i,["title"]);e!==void 0&&o!=null&&p(e,["instances[]","title"],o);let a=u(i,["outputDimensionality"]);e!==void 0&&a!=null&&p(e,["parameters","outputDimensionality"],a);let d=u(i,["mimeType"]);e!==void 0&&d!=null&&p(e,["instances[]","mimeType"],d);let m=u(i,["autoTruncate"]);return e!==void 0&&m!=null&&p(e,["parameters","autoTruncate"],m),t}function Ip(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let m=zs(i,o);Array.isArray(m)&&(m=m.map(f=>f)),p(t,["requests[]","content"],m)}let a=u(e,["config"]);a!=null&&Tp(a,t);let d=u(e,["model"]);return d!==void 0&&p(t,["requests[]","model"],Te(i,d)),t}function Pp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let d=zs(i,o);Array.isArray(d)&&(d=d.map(m=>m)),p(t,["instances[]","content"],d)}let a=u(e,["config"]);return a!=null&&kp(a,t),t}function Fp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["embeddings"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["embeddings"],a)}let o=u(i,["metadata"]);return o!=null&&p(e,["metadata"],o),e}function Np(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions[]","embeddings"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>pp(d))),p(e,["embeddings"],a)}let o=u(i,["metadata"]);return o!=null&&p(e,["metadata"],o),e}function Rp(i){let e={},t=u(i,["endpoint"]);t!=null&&p(e,["name"],t);let n=u(i,["deployedModelId"]);return n!=null&&p(e,["deployedModelId"],n),e}function Op(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Bp(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Vp(i){let e={},t=u(i,["mode"]);t!=null&&p(e,["mode"],t);let n=u(i,["allowedFunctionNames"]);if(n!=null&&p(e,["allowedFunctionNames"],n),u(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Lp(i){let e={};if(u(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=u(i,["description"]);t!=null&&p(e,["description"],t);let n=u(i,["name"]);n!=null&&p(e,["name"],n);let o=u(i,["parameters"]);o!=null&&p(e,["parameters"],o);let a=u(i,["parametersJsonSchema"]);a!=null&&p(e,["parametersJsonSchema"],a);let d=u(i,["response"]);d!=null&&p(e,["response"],d);let m=u(i,["responseJsonSchema"]);return m!=null&&p(e,["responseJsonSchema"],m),e}function Gp(i,e,t){let n={},o=u(e,["systemInstruction"]);t!==void 0&&o!=null&&p(t,["systemInstruction"],ro($e(o)));let a=u(e,["temperature"]);a!=null&&p(n,["temperature"],a);let d=u(e,["topP"]);d!=null&&p(n,["topP"],d);let m=u(e,["topK"]);m!=null&&p(n,["topK"],m);let f=u(e,["candidateCount"]);f!=null&&p(n,["candidateCount"],f);let h=u(e,["maxOutputTokens"]);h!=null&&p(n,["maxOutputTokens"],h);let C=u(e,["stopSequences"]);C!=null&&p(n,["stopSequences"],C);let y=u(e,["responseLogprobs"]);y!=null&&p(n,["responseLogprobs"],y);let E=u(e,["logprobs"]);E!=null&&p(n,["logprobs"],E);let T=u(e,["presencePenalty"]);T!=null&&p(n,["presencePenalty"],T);let R=u(e,["frequencyPenalty"]);R!=null&&p(n,["frequencyPenalty"],R);let L=u(e,["seed"]);L!=null&&p(n,["seed"],L);let q=u(e,["responseMimeType"]);q!=null&&p(n,["responseMimeType"],q);let U=u(e,["responseSchema"]);U!=null&&p(n,["responseSchema"],Ks(U));let Q=u(e,["responseJsonSchema"]);if(Q!=null&&p(n,["responseJsonSchema"],Q),u(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let J=u(e,["safetySettings"]);if(t!==void 0&&J!=null){let Ie=J;Array.isArray(Ie)&&(Ie=Ie.map(nt=>kg(nt))),p(t,["safetySettings"],Ie)}let ie=u(e,["tools"]);if(t!==void 0&&ie!=null){let Ie=_n(ie);Array.isArray(Ie)&&(Ie=Ie.map(nt=>Bg(fn(nt)))),p(t,["tools"],Ie)}let se=u(e,["toolConfig"]);if(t!==void 0&&se!=null&&p(t,["toolConfig"],Og(se)),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let he=u(e,["cachedContent"]);t!==void 0&&he!=null&&p(t,["cachedContent"],Mt(i,he));let ae=u(e,["responseModalities"]);ae!=null&&p(n,["responseModalities"],ae);let Se=u(e,["mediaResolution"]);Se!=null&&p(n,["mediaResolution"],Se);let ce=u(e,["speechConfig"]);if(ce!=null&&p(n,["speechConfig"],Ws(ce)),u(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let ve=u(e,["thinkingConfig"]);ve!=null&&p(n,["thinkingConfig"],ve);let Be=u(e,["imageConfig"]);Be!=null&&p(n,["imageConfig"],pg(Be));let Ue=u(e,["enableEnhancedCivicAnswers"]);return Ue!=null&&p(n,["enableEnhancedCivicAnswers"],Ue),n}function Up(i,e,t){let n={},o=u(e,["systemInstruction"]);t!==void 0&&o!=null&&p(t,["systemInstruction"],$e(o));let a=u(e,["temperature"]);a!=null&&p(n,["temperature"],a);let d=u(e,["topP"]);d!=null&&p(n,["topP"],d);let m=u(e,["topK"]);m!=null&&p(n,["topK"],m);let f=u(e,["candidateCount"]);f!=null&&p(n,["candidateCount"],f);let h=u(e,["maxOutputTokens"]);h!=null&&p(n,["maxOutputTokens"],h);let C=u(e,["stopSequences"]);C!=null&&p(n,["stopSequences"],C);let y=u(e,["responseLogprobs"]);y!=null&&p(n,["responseLogprobs"],y);let E=u(e,["logprobs"]);E!=null&&p(n,["logprobs"],E);let T=u(e,["presencePenalty"]);T!=null&&p(n,["presencePenalty"],T);let R=u(e,["frequencyPenalty"]);R!=null&&p(n,["frequencyPenalty"],R);let L=u(e,["seed"]);L!=null&&p(n,["seed"],L);let q=u(e,["responseMimeType"]);q!=null&&p(n,["responseMimeType"],q);let U=u(e,["responseSchema"]);U!=null&&p(n,["responseSchema"],Ks(U));let Q=u(e,["responseJsonSchema"]);Q!=null&&p(n,["responseJsonSchema"],Q);let J=u(e,["routingConfig"]);J!=null&&p(n,["routingConfig"],J);let ie=u(e,["modelSelectionConfig"]);ie!=null&&p(n,["modelConfig"],ie);let se=u(e,["safetySettings"]);if(t!==void 0&&se!=null){let j=se;Array.isArray(j)&&(j=j.map(re=>re)),p(t,["safetySettings"],j)}let he=u(e,["tools"]);if(t!==void 0&&he!=null){let j=_n(he);Array.isArray(j)&&(j=j.map(re=>nd(fn(re)))),p(t,["tools"],j)}let ae=u(e,["toolConfig"]);t!==void 0&&ae!=null&&p(t,["toolConfig"],ae);let Se=u(e,["labels"]);t!==void 0&&Se!=null&&p(t,["labels"],Se);let ce=u(e,["cachedContent"]);t!==void 0&&ce!=null&&p(t,["cachedContent"],Mt(i,ce));let ve=u(e,["responseModalities"]);ve!=null&&p(n,["responseModalities"],ve);let Be=u(e,["mediaResolution"]);Be!=null&&p(n,["mediaResolution"],Be);let Ue=u(e,["speechConfig"]);Ue!=null&&p(n,["speechConfig"],Ws(Ue));let Ie=u(e,["audioTimestamp"]);Ie!=null&&p(n,["audioTimestamp"],Ie);let nt=u(e,["thinkingConfig"]);nt!=null&&p(n,["thinkingConfig"],nt);let An=u(e,["imageConfig"]);if(An!=null&&p(n,["imageConfig"],gg(An)),u(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function vc(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let d=dt(o);Array.isArray(d)&&(d=d.map(m=>ro(m))),p(t,["contents"],d)}let a=u(e,["config"]);return a!=null&&p(t,["generationConfig"],Gp(i,a,t)),t}function bc(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["contents"]);if(o!=null){let d=dt(o);Array.isArray(d)&&(d=d.map(m=>m)),p(t,["contents"],d)}let a=u(e,["config"]);return a!=null&&p(t,["generationConfig"],Up(i,a,t)),t}function xc(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["candidates"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>cp(h))),p(e,["candidates"],f)}let o=u(i,["modelVersion"]);o!=null&&p(e,["modelVersion"],o);let a=u(i,["promptFeedback"]);a!=null&&p(e,["promptFeedback"],a);let d=u(i,["responseId"]);d!=null&&p(e,["responseId"],d);let m=u(i,["usageMetadata"]);return m!=null&&p(e,["usageMetadata"],m),e}function yc(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["candidates"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(C=>C)),p(e,["candidates"],h)}let o=u(i,["createTime"]);o!=null&&p(e,["createTime"],o);let a=u(i,["modelVersion"]);a!=null&&p(e,["modelVersion"],a);let d=u(i,["promptFeedback"]);d!=null&&p(e,["promptFeedback"],d);let m=u(i,["responseId"]);m!=null&&p(e,["responseId"],m);let f=u(i,["usageMetadata"]);return f!=null&&p(e,["usageMetadata"],f),e}function qp(i,e){let t={};if(u(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=u(i,["numberOfImages"]);e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n);let o=u(i,["aspectRatio"]);e!==void 0&&o!=null&&p(e,["parameters","aspectRatio"],o);let a=u(i,["guidanceScale"]);if(e!==void 0&&a!=null&&p(e,["parameters","guidanceScale"],a),u(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let d=u(i,["safetyFilterLevel"]);e!==void 0&&d!=null&&p(e,["parameters","safetySetting"],d);let m=u(i,["personGeneration"]);e!==void 0&&m!=null&&p(e,["parameters","personGeneration"],m);let f=u(i,["includeSafetyAttributes"]);e!==void 0&&f!=null&&p(e,["parameters","includeSafetyAttributes"],f);let h=u(i,["includeRaiReason"]);e!==void 0&&h!=null&&p(e,["parameters","includeRaiReason"],h);let C=u(i,["language"]);e!==void 0&&C!=null&&p(e,["parameters","language"],C);let y=u(i,["outputMimeType"]);e!==void 0&&y!=null&&p(e,["parameters","outputOptions","mimeType"],y);let E=u(i,["outputCompressionQuality"]);if(e!==void 0&&E!=null&&p(e,["parameters","outputOptions","compressionQuality"],E),u(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(u(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let T=u(i,["imageSize"]);if(e!==void 0&&T!=null&&p(e,["parameters","sampleImageSize"],T),u(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function $p(i,e){let t={},n=u(i,["outputGcsUri"]);e!==void 0&&n!=null&&p(e,["parameters","storageUri"],n);let o=u(i,["negativePrompt"]);e!==void 0&&o!=null&&p(e,["parameters","negativePrompt"],o);let a=u(i,["numberOfImages"]);e!==void 0&&a!=null&&p(e,["parameters","sampleCount"],a);let d=u(i,["aspectRatio"]);e!==void 0&&d!=null&&p(e,["parameters","aspectRatio"],d);let m=u(i,["guidanceScale"]);e!==void 0&&m!=null&&p(e,["parameters","guidanceScale"],m);let f=u(i,["seed"]);e!==void 0&&f!=null&&p(e,["parameters","seed"],f);let h=u(i,["safetyFilterLevel"]);e!==void 0&&h!=null&&p(e,["parameters","safetySetting"],h);let C=u(i,["personGeneration"]);e!==void 0&&C!=null&&p(e,["parameters","personGeneration"],C);let y=u(i,["includeSafetyAttributes"]);e!==void 0&&y!=null&&p(e,["parameters","includeSafetyAttributes"],y);let E=u(i,["includeRaiReason"]);e!==void 0&&E!=null&&p(e,["parameters","includeRaiReason"],E);let T=u(i,["language"]);e!==void 0&&T!=null&&p(e,["parameters","language"],T);let R=u(i,["outputMimeType"]);e!==void 0&&R!=null&&p(e,["parameters","outputOptions","mimeType"],R);let L=u(i,["outputCompressionQuality"]);e!==void 0&&L!=null&&p(e,["parameters","outputOptions","compressionQuality"],L);let q=u(i,["addWatermark"]);e!==void 0&&q!=null&&p(e,["parameters","addWatermark"],q);let U=u(i,["labels"]);e!==void 0&&U!=null&&p(e,["labels"],U);let Q=u(i,["imageSize"]);e!==void 0&&Q!=null&&p(e,["parameters","sampleImageSize"],Q);let J=u(i,["enhancePrompt"]);return e!==void 0&&J!=null&&p(e,["parameters","enhancePrompt"],J),t}function Hp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let a=u(e,["config"]);return a!=null&&qp(a,t),t}function zp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let a=u(e,["config"]);return a!=null&&$p(a,t),t}function Kp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>og(d))),p(e,["generatedImages"],a)}let o=u(i,["positivePromptSafetyAttributes"]);return o!=null&&p(e,["positivePromptSafetyAttributes"],ed(o)),e}function Wp(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>so(d))),p(e,["generatedImages"],a)}let o=u(i,["positivePromptSafetyAttributes"]);return o!=null&&p(e,["positivePromptSafetyAttributes"],td(o)),e}function Jp(i,e){let t={},n=u(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n),u(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let o=u(i,["durationSeconds"]);if(e!==void 0&&o!=null&&p(e,["parameters","durationSeconds"],o),u(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let a=u(i,["aspectRatio"]);e!==void 0&&a!=null&&p(e,["parameters","aspectRatio"],a);let d=u(i,["resolution"]);e!==void 0&&d!=null&&p(e,["parameters","resolution"],d);let m=u(i,["personGeneration"]);if(e!==void 0&&m!=null&&p(e,["parameters","personGeneration"],m),u(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let f=u(i,["negativePrompt"]);e!==void 0&&f!=null&&p(e,["parameters","negativePrompt"],f);let h=u(i,["enhancePrompt"]);if(e!==void 0&&h!=null&&p(e,["parameters","enhancePrompt"],h),u(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let C=u(i,["lastFrame"]);e!==void 0&&C!=null&&p(e,["instances[0]","lastFrame"],ao(C));let y=u(i,["referenceImages"]);if(e!==void 0&&y!=null){let E=y;Array.isArray(E)&&(E=E.map(T=>Yg(T))),p(e,["instances[0]","referenceImages"],E)}if(u(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(u(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function Qp(i,e){let t={},n=u(i,["numberOfVideos"]);e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n);let o=u(i,["outputGcsUri"]);e!==void 0&&o!=null&&p(e,["parameters","storageUri"],o);let a=u(i,["fps"]);e!==void 0&&a!=null&&p(e,["parameters","fps"],a);let d=u(i,["durationSeconds"]);e!==void 0&&d!=null&&p(e,["parameters","durationSeconds"],d);let m=u(i,["seed"]);e!==void 0&&m!=null&&p(e,["parameters","seed"],m);let f=u(i,["aspectRatio"]);e!==void 0&&f!=null&&p(e,["parameters","aspectRatio"],f);let h=u(i,["resolution"]);e!==void 0&&h!=null&&p(e,["parameters","resolution"],h);let C=u(i,["personGeneration"]);e!==void 0&&C!=null&&p(e,["parameters","personGeneration"],C);let y=u(i,["pubsubTopic"]);e!==void 0&&y!=null&&p(e,["parameters","pubsubTopic"],y);let E=u(i,["negativePrompt"]);e!==void 0&&E!=null&&p(e,["parameters","negativePrompt"],E);let T=u(i,["enhancePrompt"]);e!==void 0&&T!=null&&p(e,["parameters","enhancePrompt"],T);let R=u(i,["generateAudio"]);e!==void 0&&R!=null&&p(e,["parameters","generateAudio"],R);let L=u(i,["lastFrame"]);e!==void 0&&L!=null&&p(e,["instances[0]","lastFrame"],_t(L));let q=u(i,["referenceImages"]);if(e!==void 0&&q!=null){let J=q;Array.isArray(J)&&(J=J.map(ie=>Xg(ie))),p(e,["instances[0]","referenceImages"],J)}let U=u(i,["mask"]);e!==void 0&&U!=null&&p(e,["instances[0]","mask"],Qg(U));let Q=u(i,["compressionQuality"]);return e!==void 0&&Q!=null&&p(e,["parameters","compressionQuality"],Q),t}function Yp(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["response","generateVideoResponse"]);return d!=null&&p(e,["response"],eg(d)),e}function Xp(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["response"]);return d!=null&&p(e,["response"],tg(d)),e}function Zp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let a=u(e,["image"]);a!=null&&p(t,["instances[0]","image"],ao(a));let d=u(e,["video"]);d!=null&&p(t,["instances[0]","video"],id(d));let m=u(e,["source"]);m!=null&&ng(m,t);let f=u(e,["config"]);return f!=null&&Jp(f,t),t}function jp(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["prompt"]);o!=null&&p(t,["instances[0]","prompt"],o);let a=u(e,["image"]);a!=null&&p(t,["instances[0]","image"],_t(a));let d=u(e,["video"]);d!=null&&p(t,["instances[0]","video"],od(d));let m=u(e,["source"]);m!=null&&ig(m,t);let f=u(e,["config"]);return f!=null&&Qp(f,t),t}function eg(i){let e={},t=u(i,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>sg(d))),p(e,["generatedVideos"],a)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function tg(i){let e={},t=u(i,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(d=>ag(d))),p(e,["generatedVideos"],a)}let n=u(i,["raiMediaFilteredCount"]);n!=null&&p(e,["raiMediaFilteredCount"],n);let o=u(i,["raiMediaFilteredReasons"]);return o!=null&&p(e,["raiMediaFilteredReasons"],o),e}function ng(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["image"]);e!==void 0&&o!=null&&p(e,["instances[0]","image"],ao(o));let a=u(i,["video"]);return e!==void 0&&a!=null&&p(e,["instances[0]","video"],id(a)),t}function ig(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["image"]);e!==void 0&&o!=null&&p(e,["instances[0]","image"],_t(o));let a=u(i,["video"]);return e!==void 0&&a!=null&&p(e,["instances[0]","video"],od(a)),t}function og(i){let e={},t=u(i,["_self"]);t!=null&&p(e,["image"],hg(t));let n=u(i,["raiFilteredReason"]);n!=null&&p(e,["raiFilteredReason"],n);let o=u(i,["_self"]);return o!=null&&p(e,["safetyAttributes"],ed(o)),e}function so(i){let e={},t=u(i,["_self"]);t!=null&&p(e,["image"],jc(t));let n=u(i,["raiFilteredReason"]);n!=null&&p(e,["raiFilteredReason"],n);let o=u(i,["_self"]);o!=null&&p(e,["safetyAttributes"],td(o));let a=u(i,["prompt"]);return a!=null&&p(e,["enhancedPrompt"],a),e}function rg(i){let e={},t=u(i,["_self"]);t!=null&&p(e,["mask"],jc(t));let n=u(i,["labels"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),p(e,["labels"],o)}return e}function sg(i){let e={},t=u(i,["video"]);return t!=null&&p(e,["video"],Wg(t)),e}function ag(i){let e={},t=u(i,["_self"]);return t!=null&&p(e,["video"],Jg(t)),e}function lg(i){let e={},t=u(i,["modelSelectionConfig"]);t!=null&&p(e,["modelConfig"],t);let n=u(i,["responseJsonSchema"]);n!=null&&p(e,["responseJsonSchema"],n);let o=u(i,["audioTimestamp"]);o!=null&&p(e,["audioTimestamp"],o);let a=u(i,["candidateCount"]);a!=null&&p(e,["candidateCount"],a);let d=u(i,["enableAffectiveDialog"]);d!=null&&p(e,["enableAffectiveDialog"],d);let m=u(i,["frequencyPenalty"]);m!=null&&p(e,["frequencyPenalty"],m);let f=u(i,["logprobs"]);f!=null&&p(e,["logprobs"],f);let h=u(i,["maxOutputTokens"]);h!=null&&p(e,["maxOutputTokens"],h);let C=u(i,["mediaResolution"]);C!=null&&p(e,["mediaResolution"],C);let y=u(i,["presencePenalty"]);y!=null&&p(e,["presencePenalty"],y);let E=u(i,["responseLogprobs"]);E!=null&&p(e,["responseLogprobs"],E);let T=u(i,["responseMimeType"]);T!=null&&p(e,["responseMimeType"],T);let R=u(i,["responseModalities"]);R!=null&&p(e,["responseModalities"],R);let L=u(i,["responseSchema"]);L!=null&&p(e,["responseSchema"],L);let q=u(i,["routingConfig"]);q!=null&&p(e,["routingConfig"],q);let U=u(i,["seed"]);U!=null&&p(e,["seed"],U);let Q=u(i,["speechConfig"]);Q!=null&&p(e,["speechConfig"],Q);let J=u(i,["stopSequences"]);J!=null&&p(e,["stopSequences"],J);let ie=u(i,["temperature"]);ie!=null&&p(e,["temperature"],ie);let se=u(i,["thinkingConfig"]);se!=null&&p(e,["thinkingConfig"],se);let he=u(i,["topK"]);he!=null&&p(e,["topK"],he);let ae=u(i,["topP"]);if(ae!=null&&p(e,["topP"],ae),u(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function cg(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Te(i,n)),t}function dg(i,e){let t={},n=u(e,["model"]);return n!=null&&p(t,["_url","name"],Te(i,n)),t}function ug(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function mg(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function pg(i){let e={},t=u(i,["aspectRatio"]);t!=null&&p(e,["aspectRatio"],t);let n=u(i,["imageSize"]);if(n!=null&&p(e,["imageSize"],n),u(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function gg(i){let e={},t=u(i,["aspectRatio"]);t!=null&&p(e,["aspectRatio"],t);let n=u(i,["imageSize"]);n!=null&&p(e,["imageSize"],n);let o=u(i,["outputMimeType"]);o!=null&&p(e,["imageOutputOptions","mimeType"],o);let a=u(i,["outputCompressionQuality"]);return a!=null&&p(e,["imageOutputOptions","compressionQuality"],a),e}function hg(i){let e={},t=u(i,["bytesBase64Encoded"]);t!=null&&p(e,["imageBytes"],Nt(t));let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function jc(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["gcsUri"],t);let n=u(i,["bytesBase64Encoded"]);n!=null&&p(e,["imageBytes"],Nt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function ao(i){let e={};if(u(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=u(i,["imageBytes"]);t!=null&&p(e,["bytesBase64Encoded"],Nt(t));let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function _t(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["gcsUri"],t);let n=u(i,["imageBytes"]);n!=null&&p(e,["bytesBase64Encoded"],Nt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function fg(i,e,t){let n={},o=u(e,["pageSize"]);t!==void 0&&o!=null&&p(t,["_query","pageSize"],o);let a=u(e,["pageToken"]);t!==void 0&&a!=null&&p(t,["_query","pageToken"],a);let d=u(e,["filter"]);t!==void 0&&d!=null&&p(t,["_query","filter"],d);let m=u(e,["queryBase"]);return t!==void 0&&m!=null&&p(t,["_url","models_url"],Kc(i,m)),n}function _g(i,e,t){let n={},o=u(e,["pageSize"]);t!==void 0&&o!=null&&p(t,["_query","pageSize"],o);let a=u(e,["pageToken"]);t!==void 0&&a!=null&&p(t,["_query","pageToken"],a);let d=u(e,["filter"]);t!==void 0&&d!=null&&p(t,["_query","filter"],d);let m=u(e,["queryBase"]);return t!==void 0&&m!=null&&p(t,["_url","models_url"],Kc(i,m)),n}function Cg(i,e){let t={},n=u(e,["config"]);return n!=null&&fg(i,n,t),t}function vg(i,e){let t={},n=u(e,["config"]);return n!=null&&_g(i,n,t),t}function bg(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["_self"]);if(o!=null){let a=Wc(o);Array.isArray(a)&&(a=a.map(d=>fs(d))),p(e,["models"],a)}return e}function xg(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["_self"]);if(o!=null){let a=Wc(o);Array.isArray(a)&&(a=a.map(d=>_s(d))),p(e,["models"],a)}return e}function yg(i){let e={},t=u(i,["maskMode"]);t!=null&&p(e,["maskMode"],t);let n=u(i,["segmentationClasses"]);n!=null&&p(e,["maskClasses"],n);let o=u(i,["maskDilation"]);return o!=null&&p(e,["dilation"],o),e}function fs(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);o!=null&&p(e,["description"],o);let a=u(i,["version"]);a!=null&&p(e,["version"],a);let d=u(i,["_self"]);d!=null&&p(e,["tunedModelInfo"],Vg(d));let m=u(i,["inputTokenLimit"]);m!=null&&p(e,["inputTokenLimit"],m);let f=u(i,["outputTokenLimit"]);f!=null&&p(e,["outputTokenLimit"],f);let h=u(i,["supportedGenerationMethods"]);h!=null&&p(e,["supportedActions"],h);let C=u(i,["temperature"]);C!=null&&p(e,["temperature"],C);let y=u(i,["maxTemperature"]);y!=null&&p(e,["maxTemperature"],y);let E=u(i,["topP"]);E!=null&&p(e,["topP"],E);let T=u(i,["topK"]);T!=null&&p(e,["topK"],T);let R=u(i,["thinking"]);return R!=null&&p(e,["thinking"],R),e}function _s(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["displayName"]);n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);o!=null&&p(e,["description"],o);let a=u(i,["versionId"]);a!=null&&p(e,["version"],a);let d=u(i,["deployedModels"]);if(d!=null){let y=d;Array.isArray(y)&&(y=y.map(E=>Rp(E))),p(e,["endpoints"],y)}let m=u(i,["labels"]);m!=null&&p(e,["labels"],m);let f=u(i,["_self"]);f!=null&&p(e,["tunedModelInfo"],Lg(f));let h=u(i,["defaultCheckpointId"]);h!=null&&p(e,["defaultCheckpointId"],h);let C=u(i,["checkpoints"]);if(C!=null){let y=C;Array.isArray(y)&&(y=y.map(E=>E)),p(e,["checkpoints"],y)}return e}function Sg(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let a=u(i,["fileData"]);a!=null&&p(e,["fileData"],Op(a));let d=u(i,["functionCall"]);d!=null&&p(e,["functionCall"],Bp(d));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let f=u(i,["inlineData"]);f!=null&&p(e,["inlineData"],lp(f));let h=u(i,["text"]);h!=null&&p(e,["text"],h);let C=u(i,["thought"]);C!=null&&p(e,["thought"],C);let y=u(i,["thoughtSignature"]);y!=null&&p(e,["thoughtSignature"],y);let E=u(i,["videoMetadata"]);return E!=null&&p(e,["videoMetadata"],E),e}function wg(i){let e={},t=u(i,["productImage"]);return t!=null&&p(e,["image"],_t(t)),e}function Eg(i,e){let t={},n=u(i,["numberOfImages"]);e!==void 0&&n!=null&&p(e,["parameters","sampleCount"],n);let o=u(i,["baseSteps"]);e!==void 0&&o!=null&&p(e,["parameters","baseSteps"],o);let a=u(i,["outputGcsUri"]);e!==void 0&&a!=null&&p(e,["parameters","storageUri"],a);let d=u(i,["seed"]);e!==void 0&&d!=null&&p(e,["parameters","seed"],d);let m=u(i,["safetyFilterLevel"]);e!==void 0&&m!=null&&p(e,["parameters","safetySetting"],m);let f=u(i,["personGeneration"]);e!==void 0&&f!=null&&p(e,["parameters","personGeneration"],f);let h=u(i,["addWatermark"]);e!==void 0&&h!=null&&p(e,["parameters","addWatermark"],h);let C=u(i,["outputMimeType"]);e!==void 0&&C!=null&&p(e,["parameters","outputOptions","mimeType"],C);let y=u(i,["outputCompressionQuality"]);e!==void 0&&y!=null&&p(e,["parameters","outputOptions","compressionQuality"],y);let E=u(i,["enhancePrompt"]);e!==void 0&&E!=null&&p(e,["parameters","enhancePrompt"],E);let T=u(i,["labels"]);return e!==void 0&&T!=null&&p(e,["labels"],T),t}function Ag(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["source"]);o!=null&&Mg(o,t);let a=u(e,["config"]);return a!=null&&Eg(a,t),t}function Dg(i){let e={},t=u(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>so(o))),p(e,["generatedImages"],n)}return e}function Mg(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["personImage"]);e!==void 0&&o!=null&&p(e,["instances[0]","personImage","image"],_t(o));let a=u(i,["productImages"]);if(e!==void 0&&a!=null){let d=a;Array.isArray(d)&&(d=d.map(m=>wg(m))),p(e,["instances[0]","productImages"],d)}return t}function Tg(i){let e={},t=u(i,["referenceImage"]);t!=null&&p(e,["referenceImage"],_t(t));let n=u(i,["referenceId"]);n!=null&&p(e,["referenceId"],n);let o=u(i,["referenceType"]);o!=null&&p(e,["referenceType"],o);let a=u(i,["maskImageConfig"]);a!=null&&p(e,["maskImageConfig"],yg(a));let d=u(i,["controlImageConfig"]);d!=null&&p(e,["controlImageConfig"],hp(d));let m=u(i,["styleImageConfig"]);m!=null&&p(e,["styleImageConfig"],m);let f=u(i,["subjectImageConfig"]);return f!=null&&p(e,["subjectImageConfig"],f),e}function ed(i){let e={},t=u(i,["safetyAttributes","categories"]);t!=null&&p(e,["categories"],t);let n=u(i,["safetyAttributes","scores"]);n!=null&&p(e,["scores"],n);let o=u(i,["contentType"]);return o!=null&&p(e,["contentType"],o),e}function td(i){let e={},t=u(i,["safetyAttributes","categories"]);t!=null&&p(e,["categories"],t);let n=u(i,["safetyAttributes","scores"]);n!=null&&p(e,["scores"],n);let o=u(i,["contentType"]);return o!=null&&p(e,["contentType"],o),e}function kg(i){let e={},t=u(i,["category"]);if(t!=null&&p(e,["category"],t),u(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=u(i,["threshold"]);return n!=null&&p(e,["threshold"],n),e}function Ig(i){let e={},t=u(i,["image"]);return t!=null&&p(e,["image"],_t(t)),e}function Pg(i,e){let t={},n=u(i,["mode"]);e!==void 0&&n!=null&&p(e,["parameters","mode"],n);let o=u(i,["maxPredictions"]);e!==void 0&&o!=null&&p(e,["parameters","maxPredictions"],o);let a=u(i,["confidenceThreshold"]);e!==void 0&&a!=null&&p(e,["parameters","confidenceThreshold"],a);let d=u(i,["maskDilation"]);e!==void 0&&d!=null&&p(e,["parameters","maskDilation"],d);let m=u(i,["binaryColorThreshold"]);e!==void 0&&m!=null&&p(e,["parameters","binaryColorThreshold"],m);let f=u(i,["labels"]);return e!==void 0&&f!=null&&p(e,["labels"],f),t}function Fg(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["source"]);o!=null&&Rg(o,t);let a=u(e,["config"]);return a!=null&&Pg(a,t),t}function Ng(i){let e={},t=u(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(o=>rg(o))),p(e,["generatedMasks"],n)}return e}function Rg(i,e){let t={},n=u(i,["prompt"]);e!==void 0&&n!=null&&p(e,["instances[0]","prompt"],n);let o=u(i,["image"]);e!==void 0&&o!=null&&p(e,["instances[0]","image"],_t(o));let a=u(i,["scribbleImage"]);return e!==void 0&&a!=null&&p(e,["instances[0]","scribble"],Ig(a)),t}function Og(i){let e={},t=u(i,["functionCallingConfig"]);t!=null&&p(e,["functionCallingConfig"],Vp(t));let n=u(i,["retrievalConfig"]);return n!=null&&p(e,["retrievalConfig"],n),e}function Bg(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>y)),p(e,["functionDeclarations"],C)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let a=u(i,["fileSearch"]);a!=null&&p(e,["fileSearch"],a);let d=u(i,["codeExecution"]);if(d!=null&&p(e,["codeExecution"],d),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],ug(m));let f=u(i,["googleSearch"]);f!=null&&p(e,["googleSearch"],mg(f));let h=u(i,["urlContext"]);return h!=null&&p(e,["urlContext"],h),e}function nd(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let y=t;Array.isArray(y)&&(y=y.map(E=>Lp(E))),p(e,["functionDeclarations"],y)}let n=u(i,["retrieval"]);n!=null&&p(e,["retrieval"],n);let o=u(i,["googleSearchRetrieval"]);o!=null&&p(e,["googleSearchRetrieval"],o);let a=u(i,["computerUse"]);if(a!=null&&p(e,["computerUse"],a),u(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let d=u(i,["codeExecution"]);d!=null&&p(e,["codeExecution"],d);let m=u(i,["enterpriseWebSearch"]);m!=null&&p(e,["enterpriseWebSearch"],m);let f=u(i,["googleMaps"]);f!=null&&p(e,["googleMaps"],f);let h=u(i,["googleSearch"]);h!=null&&p(e,["googleSearch"],h);let C=u(i,["urlContext"]);return C!=null&&p(e,["urlContext"],C),e}function Vg(i){let e={},t=u(i,["baseModel"]);t!=null&&p(e,["baseModel"],t);let n=u(i,["createTime"]);n!=null&&p(e,["createTime"],n);let o=u(i,["updateTime"]);return o!=null&&p(e,["updateTime"],o),e}function Lg(i){let e={},t=u(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&p(e,["baseModel"],t);let n=u(i,["createTime"]);n!=null&&p(e,["createTime"],n);let o=u(i,["updateTime"]);return o!=null&&p(e,["updateTime"],o),e}function Gg(i,e){let t={},n=u(i,["displayName"]);e!==void 0&&n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);e!==void 0&&o!=null&&p(e,["description"],o);let a=u(i,["defaultCheckpointId"]);return e!==void 0&&a!=null&&p(e,["defaultCheckpointId"],a),t}function Ug(i,e){let t={},n=u(i,["displayName"]);e!==void 0&&n!=null&&p(e,["displayName"],n);let o=u(i,["description"]);e!==void 0&&o!=null&&p(e,["description"],o);let a=u(i,["defaultCheckpointId"]);return e!==void 0&&a!=null&&p(e,["defaultCheckpointId"],a),t}function qg(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","name"],Te(i,n));let o=u(e,["config"]);return o!=null&&Gg(o,t),t}function $g(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["config"]);return o!=null&&Ug(o,t),t}function Hg(i,e){let t={},n=u(i,["outputGcsUri"]);e!==void 0&&n!=null&&p(e,["parameters","storageUri"],n);let o=u(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&p(e,["parameters","safetySetting"],o);let a=u(i,["personGeneration"]);e!==void 0&&a!=null&&p(e,["parameters","personGeneration"],a);let d=u(i,["includeRaiReason"]);e!==void 0&&d!=null&&p(e,["parameters","includeRaiReason"],d);let m=u(i,["outputMimeType"]);e!==void 0&&m!=null&&p(e,["parameters","outputOptions","mimeType"],m);let f=u(i,["outputCompressionQuality"]);e!==void 0&&f!=null&&p(e,["parameters","outputOptions","compressionQuality"],f);let h=u(i,["enhanceInputImage"]);e!==void 0&&h!=null&&p(e,["parameters","upscaleConfig","enhanceInputImage"],h);let C=u(i,["imagePreservationFactor"]);e!==void 0&&C!=null&&p(e,["parameters","upscaleConfig","imagePreservationFactor"],C);let y=u(i,["labels"]);e!==void 0&&y!=null&&p(e,["labels"],y);let E=u(i,["numberOfImages"]);e!==void 0&&E!=null&&p(e,["parameters","sampleCount"],E);let T=u(i,["mode"]);return e!==void 0&&T!=null&&p(e,["parameters","mode"],T),t}function zg(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["_url","model"],Te(i,n));let o=u(e,["image"]);o!=null&&p(t,["instances[0]","image"],_t(o));let a=u(e,["upscaleFactor"]);a!=null&&p(t,["parameters","upscaleConfig","upscaleFactor"],a);let d=u(e,["config"]);return d!=null&&Hg(d,t),t}function Kg(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>so(a))),p(e,["generatedImages"],o)}return e}function Wg(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["uri"],t);let n=u(i,["encodedVideo"]);n!=null&&p(e,["videoBytes"],Nt(n));let o=u(i,["encoding"]);return o!=null&&p(e,["mimeType"],o),e}function Jg(i){let e={},t=u(i,["gcsUri"]);t!=null&&p(e,["uri"],t);let n=u(i,["bytesBase64Encoded"]);n!=null&&p(e,["videoBytes"],Nt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function Qg(i){let e={},t=u(i,["image"]);t!=null&&p(e,["_self"],_t(t));let n=u(i,["maskMode"]);return n!=null&&p(e,["maskMode"],n),e}function Yg(i){let e={},t=u(i,["image"]);t!=null&&p(e,["image"],ao(t));let n=u(i,["referenceType"]);return n!=null&&p(e,["referenceType"],n),e}function Xg(i){let e={},t=u(i,["image"]);t!=null&&p(e,["image"],_t(t));let n=u(i,["referenceType"]);return n!=null&&p(e,["referenceType"],n),e}function id(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["uri"],t);let n=u(i,["videoBytes"]);n!=null&&p(e,["encodedVideo"],Nt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["encoding"],o),e}function od(i){let e={},t=u(i,["uri"]);t!=null&&p(e,["gcsUri"],t);let n=u(i,["videoBytes"]);n!=null&&p(e,["bytesBase64Encoded"],Nt(n));let o=u(i,["mimeType"]);return o!=null&&p(e,["mimeType"],o),e}function Zg(i,e){let t={},n=u(i,["displayName"]);return e!==void 0&&n!=null&&p(e,["displayName"],n),t}function jg(i){let e={},t=u(i,["config"]);return t!=null&&Zg(t,e),e}function eh(i,e){let t={},n=u(i,["force"]);return e!==void 0&&n!=null&&p(e,["_query","force"],n),t}function th(i){let e={},t=u(i,["name"]);t!=null&&p(e,["_url","name"],t);let n=u(i,["config"]);return n!=null&&eh(n,e),e}function nh(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","name"],t),e}function ih(i,e){let t={},n=u(i,["customMetadata"]);if(e!==void 0&&n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["customMetadata"],a)}let o=u(i,["chunkingConfig"]);return e!==void 0&&o!=null&&p(e,["chunkingConfig"],o),t}function oh(i){let e={},t=u(i,["name"]);t!=null&&p(e,["name"],t);let n=u(i,["metadata"]);n!=null&&p(e,["metadata"],n);let o=u(i,["done"]);o!=null&&p(e,["done"],o);let a=u(i,["error"]);a!=null&&p(e,["error"],a);let d=u(i,["response"]);return d!=null&&p(e,["response"],sh(d)),e}function rh(i){let e={},t=u(i,["fileSearchStoreName"]);t!=null&&p(e,["_url","file_search_store_name"],t);let n=u(i,["fileName"]);n!=null&&p(e,["fileName"],n);let o=u(i,["config"]);return o!=null&&ih(o,e),e}function sh(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["parent"]);n!=null&&p(e,["parent"],n);let o=u(i,["documentName"]);return o!=null&&p(e,["documentName"],o),e}function ah(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function lh(i){let e={},t=u(i,["config"]);return t!=null&&ah(t,e),e}function ch(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["fileSearchStores"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["fileSearchStores"],a)}return e}function rd(i,e){let t={},n=u(i,["mimeType"]);e!==void 0&&n!=null&&p(e,["mimeType"],n);let o=u(i,["displayName"]);e!==void 0&&o!=null&&p(e,["displayName"],o);let a=u(i,["customMetadata"]);if(e!==void 0&&a!=null){let m=a;Array.isArray(m)&&(m=m.map(f=>f)),p(e,["customMetadata"],m)}let d=u(i,["chunkingConfig"]);return e!==void 0&&d!=null&&p(e,["chunkingConfig"],d),t}function dh(i){let e={},t=u(i,["fileSearchStoreName"]);t!=null&&p(e,["_url","file_search_store_name"],t);let n=u(i,["config"]);return n!=null&&rd(n,e),e}function uh(i){let e={},t=u(i,["sdkHttpResponse"]);return t!=null&&p(e,["sdkHttpResponse"],t),e}var mh="Content-Type",ph="X-Server-Timeout",gh="User-Agent",Cs="x-goog-api-client",hh="1.34.0",fh=`google-genai-sdk/${hh}`,_h="v1beta1",Ch="v1beta",vs=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:_h,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Ch,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let o=[this.getRequestUrlInternal(t)];return n&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[d,m]of Object.entries(e.queryParams))o.searchParams.append(d,String(m));let a={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else a.body=e.body;return a=await this.includeExtraHttpOptionsToRequestInit(a,t,o.toString(),e.abortSignal),this.unaryApiCall(o,a,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[o,a]of Object.entries(t))typeof a=="object"?n[o]=Object.assign(Object.assign({},n[o]),a):a!==void 0&&(n[o]=a);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,n);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let a={};return a.body=e.body,a=await this.includeExtraHttpOptionsToRequestInit(a,t,o.toString(),e.abortSignal),this.streamApiCall(o,a,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,o){if(t&&t.timeout||o){let a=new AbortController,d=a.signal;if(t.timeout&&t?.timeout>0){let m=setTimeout(()=>a.abort(),t.timeout);m&&typeof m.unref=="function"&&m.unref()}o&&o.addEventListener("abort",()=>{a.abort()}),e.signal=d}return t&&t.extraBody!==null&&vh(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async o=>(await Sc(o),new Un(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async o=>(await Sc(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return gt(this,arguments,function*(){var n;let o=(n=e?.body)===null||n===void 0?void 0:n.getReader(),a=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let d="",m="data:",f=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:h,value:C}=yield fe(o.read());if(h){if(d.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let y=a.decode(C,{stream:!0});try{let R=JSON.parse(y);if("error"in R){let L=JSON.parse(JSON.stringify(R.error)),q=L.status,U=L.code,Q=`got status: ${q}. ${JSON.stringify(R)}`;if(U>=400&&U<600)throw new Hi({message:Q,status:U})}}catch(R){if(R.name==="ApiError")throw R}d+=y;let E=-1,T=0;for(;;){E=-1,T=0;for(let q of f){let U=d.indexOf(q);U!==-1&&(E===-1||U<E)&&(E=U,T=q.length)}if(E===-1)break;let R=d.substring(0,E);d=d.substring(E+T);let L=R.trim();if(L.startsWith(m)){let q=L.substring(m.length).trim();try{let U=new Response(q,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield fe(new Un(U))}catch(U){throw new Error(`exception parsing stream chunk ${q}. ${U}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=fh+" "+this.clientOptions.userAgentExtra;return e[gh]=t,e[Cs]=t,e[mh]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[o,a]of Object.entries(e.headers))n.append(o,a);e.timeout&&e.timeout>0&&n.append(ph,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);let a=this.clientOptions.uploader,d=await a.stat(e);o.sizeBytes=String(d.size);let m=(n=t?.mimeType)!==null&&n!==void 0?n:d.type;if(m===void 0||m==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=m;let f={file:o},h=this.getFileName(e),C=Z("upload/v1beta/files",f._url),y=await this.fetchUploadUrl(C,o.sizeBytes,o.mimeType,h,f,t?.httpOptions);return a.upload(e,y,this)}async uploadFileToFileSearchStore(e,t,n){var o;let a=this.clientOptions.uploader,d=await a.stat(t),m=String(d.size),f=(o=n?.mimeType)!==null&&o!==void 0?o:d.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let h=`upload/v1beta/${e}:uploadToFileSearchStore`,C=this.getFileName(t),y={};n!=null&&rd(n,y);let E=await this.fetchUploadUrl(h,m,f,C,y,n?.httpOptions);return a.uploadToFileSearchStore(t,E,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,o,a,d){var m;let f={};d?f=d:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},o?{"X-Goog-Upload-File-Name":o}:{})};let h=await this.request({path:e,body:JSON.stringify(a),httpMethod:"POST",httpOptions:f});if(!h||!h?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let C=(m=h?.headers)===null||m===void 0?void 0:m["x-goog-upload-url"];if(C===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return C}};async function Sc(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){let t=i.status,n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};let o=JSON.stringify(n);throw t>=400&&t<600?new Hi({message:o,status:t}):new Error(o)}}function vh(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{let a=JSON.parse(i.body);if(typeof a=="object"&&a!==null&&!Array.isArray(a))t=a;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(a,d){let m=Object.assign({},a);for(let f in d)if(Object.prototype.hasOwnProperty.call(d,f)){let h=d[f],C=m[f];h&&typeof h=="object"&&!Array.isArray(h)&&C&&typeof C=="object"&&!Array.isArray(C)?m[f]=n(C,h):(C&&h&&typeof C!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof C}, New type: ${typeof h}. Overwriting.`),m[f]=h)}return m}let o=n(t,e);i.body=JSON.stringify(o)}var bh="mcp_used/unknown",xh=!1;function sd(i){for(let e of i)if(yh(e)||typeof e=="object"&&"inputSchema"in e)return!0;return xh}function ad(i){var e;let t=(e=i[Cs])!==null&&e!==void 0?e:"";i[Cs]=(t+` ${bh}`).trimStart()}function yh(i){return i!==null&&typeof i=="object"&&i instanceof bs}function Sh(i){return gt(this,arguments,function*(t,n=100){let o,a=0;for(;a<n;){let d=yield fe(t.listTools({cursor:o}));for(let m of d.tools)yield yield fe(m),a++;if(!d.nextCursor)break;o=d.nextCursor}})}var bs=class i{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new i(e,t)}async initialize(){var e,t,n,o;if(this.mcpTools.length>0)return;let a={},d=[];for(let C of this.mcpClients)try{for(var m=!0,f=(t=void 0,ht(Sh(C))),h;h=await f.next(),e=h.done,!e;m=!0){o=h.value,m=!1;let y=o;d.push(y);let E=y.name;if(a[E])throw new Error(`Duplicate function name ${E} found in MCP tools. Please ensure function names are unique.`);a[E]=C}}catch(y){t={error:y}}finally{try{!m&&!e&&(n=f.return)&&await n.call(f)}finally{if(t)throw t.error}}this.mcpTools=d,this.functionNameToMcpClient=a}async tool(){return await this.initialize(),a0(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let o=this.functionNameToMcpClient[n.name],a;this.config.timeout&&(a={timeout:this.config.timeout});let d=await o.callTool({name:n.name,arguments:n.args},void 0,a);t.push({functionResponse:{name:n.name,response:d.isError?{error:d}:d}})}return t}};async function wh(i,e,t){let n=new as,o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data),Object.assign(n,o),e(n)}var xs=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let o=this.apiClient.getWebsocketBaseUrl(),a=this.apiClient.getApiVersion(),d=Ah(this.apiClient.getDefaultHeaders()),m=this.apiClient.getApiKey(),f=`${o}/ws/google.ai.generativelanguage.${a}.GenerativeService.BidiGenerateMusic?key=${m}`,h=()=>{},C=new Promise(J=>{h=J}),y=e.callbacks,E=function(){h({})},T=this.apiClient,R={onopen:E,onmessage:J=>{wh(T,y.onmessage,J)},onerror:(t=y?.onerror)!==null&&t!==void 0?t:function(J){},onclose:(n=y?.onclose)!==null&&n!==void 0?n:function(J){}},L=this.webSocketFactory.create(f,Eh(d),R);L.connect(),await C;let Q={setup:{model:Te(this.apiClient,e.model)}};return L.send(JSON.stringify(Q)),new ys(L,this.apiClient)}},ys=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=jm(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=Zm(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Ln.PLAY)}pause(){this.sendPlaybackControl(Ln.PAUSE)}stop(){this.sendPlaybackControl(Ln.STOP)}resetContext(){this.sendPlaybackControl(Ln.RESET_CONTEXT)}close(){this.conn.close()}};function Eh(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function Ah(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var Dh="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Mh(i,e,t){let n=new ss,o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;let a=JSON.parse(o);if(i.isVertexAI()){let d=np(a);Object.assign(n,d)}else Object.assign(n,a);e(n)}var Ss=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new xs(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,o,a,d,m;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let f=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion(),C,y=this.apiClient.getHeaders();e.config&&e.config.tools&&sd(e.config.tools)&&ad(y);let E=Ih(y);if(this.apiClient.isVertexAI())C=`${f}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(E,C);else{let ce=this.apiClient.getApiKey(),ve="BidiGenerateContent",Be="key";ce?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),ve="BidiGenerateContentConstrained",Be="access_token"),C=`${f}/ws/google.ai.generativelanguage.${h}.GenerativeService.${ve}?${Be}=${ce}`}let T=()=>{},R=new Promise(ce=>{T=ce}),L=e.callbacks,q=function(){var ce;(ce=L?.onopen)===null||ce===void 0||ce.call(L),T({})},U=this.apiClient,Q={onopen:q,onmessage:ce=>{Mh(U,L.onmessage,ce)},onerror:(t=L?.onerror)!==null&&t!==void 0?t:function(ce){},onclose:(n=L?.onclose)!==null&&n!==void 0?n:function(ce){}},J=this.webSocketFactory.create(C,kh(E),Q);J.connect(),await R;let ie=Te(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&ie.startsWith("publishers/")){let ce=this.apiClient.getProject(),ve=this.apiClient.getLocation();ie=`projects/${ce}/locations/${ve}/`+ie}let se={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Wr.AUDIO]}:e.config.responseModalities=[Wr.AUDIO]),!((a=e.config)===null||a===void 0)&&a.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let he=(m=(d=e.config)===null||d===void 0?void 0:d.tools)!==null&&m!==void 0?m:[],ae=[];for(let ce of he)if(this.isCallableTool(ce)){let ve=ce;ae.push(await ve.tool())}else ae.push(ce);ae.length>0&&(e.config.tools=ae);let Se={model:ie,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?se=Xm(this.apiClient,Se):se=Ym(this.apiClient,Se),delete se.config,J.send(JSON.stringify(se)),new ws(J,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},Th={turnComplete:!0},ws=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=dt(t.turns),e.isVertexAI()||(n=n.map(o=>ro(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let a of n){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!e.isVertexAI()&&!("id"in a))throw new Error(Dh)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Th),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:tp(e)}:t={realtimeInput:ep(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function kh(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function Ih(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var wc=10;function Ec(i){var e,t,n;if(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(let d of(t=i?.tools)!==null&&t!==void 0?t:[])if(pn(d)){o=!0;break}if(!o)return!0;let a=(n=i?.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return a&&(a<0||!Number.isInteger(a))||a==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",a),!0):!1}function pn(i){return"callTool"in i&&typeof i.callTool=="function"}function Ph(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>pn(o)))!==null&&n!==void 0?n:!1}function Ac(i){var e;let t=[];return!((e=i?.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,o)=>{if(pn(n))return;let a=n;a.functionDeclarations&&a.functionDeclarations.length>0&&t.push(o)}),t}function Dc(i){var e;return!(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var Es=class extends ft{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,o,a,d,m;let f=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!Ph(t)||Ec(t.config))return await this.generateContentInternal(f);let h=Ac(t);if(h.length>0){let L=h.map(q=>`tools[${q}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${L}.`)}let C,y,E=dt(f.contents),T=(a=(o=(n=f.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&a!==void 0?a:wc,R=0;for(;R<T&&(C=await this.generateContentInternal(f),!(!C.functionCalls||C.functionCalls.length===0));){let L=C.candidates[0].content,q=[];for(let U of(m=(d=t.config)===null||d===void 0?void 0:d.tools)!==null&&m!==void 0?m:[])if(pn(U)){let J=await U.callTool(C.functionCalls);q.push(...J)}R++,y={role:"user",parts:q},f.contents=dt(f.contents),f.contents.push(L),f.contents.push(y),Dc(f.config)&&(E.push(L),E.push(y))}return Dc(f.config)&&(C.automaticFunctionCallingHistory=E),C},this.generateContentStream=async t=>{var n,o,a,d,m;if(this.maybeMoveToResponseJsonSchem(t),Ec(t.config)){let y=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(y)}let f=Ac(t);if(f.length>0){let y=f.map(E=>`tools[${E}]`).join(", ");throw new Error(`Incompatible tools found at ${y}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let h=(a=(o=(n=t?.config)===null||n===void 0?void 0:n.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||a===void 0?void 0:a.streamFunctionCallArguments,C=(m=(d=t?.config)===null||d===void 0?void 0:d.automaticFunctionCalling)===null||m===void 0?void 0:m.disable;if(h&&!C)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var o;let a,d=[];if(n?.generatedImages)for(let f of n.generatedImages)f&&f?.safetyAttributes&&((o=f?.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?a=f?.safetyAttributes:d.push(f);let m;return a?m={generatedImages:d,positivePromptSafetyAttributes:a,sdkHttpResponse:n.sdkHttpResponse}:m={generatedImages:d,sdkHttpResponse:n.sdkHttpResponse},m}),this.list=async t=>{var n;let d={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!d.config.queryBase){if(!((n=d.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");d.config.filter="labels.tune-type:*"}return new Dt(Rt.PAGED_ITEM_MODELS,m=>this.listInternal(m),await this.listInternal(d),d)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{var n,o,a,d,m,f;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((o=t.video)===null||o===void 0)&&o.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((d=(a=t.source)===null||a===void 0?void 0:a.video)===null||d===void 0)&&d.uri&&(!((f=(m=t.source)===null||m===void 0?void 0:m.video)===null||f===void 0)&&f.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,o;let a=(t=e.config)===null||t===void 0?void 0:t.tools;if(!a)return e;let d=await Promise.all(a.map(async f=>pn(f)?await f.tool():f)),m={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:d})};if(m.config.tools=d,e.config&&e.config.tools&&sd(e.config.tools)){let f=(o=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&o!==void 0?o:{},h=Object.assign({},f);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),ad(h),m.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return m}async initAfcToolsMap(e){var t,n,o;let a=new Map;for(let d of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(pn(d)){let m=d,f=await m.tool();for(let h of(o=f.functionDeclarations)!==null&&o!==void 0?o:[]){if(!h.name)throw new Error("Function declaration name is required.");if(a.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);a.set(h.name,m)}}return a}async processAfcStream(e){var t,n,o;let a=(o=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&o!==void 0?o:wc,d=!1,m=0,f=await this.initAfcToolsMap(e);return(function(h,C,y){return gt(this,arguments,function*(){for(var E,T,R,L,q,U;m<a;){d&&(m++,d=!1);let se=yield fe(h.processParamsMaybeAddMcpUsage(y)),he=yield fe(h.generateContentStreamInternal(se)),ae=[],Se=[];try{for(var Q=!0,J=(T=void 0,ht(he)),ie;ie=yield fe(J.next()),E=ie.done,!E;Q=!0){L=ie.value,Q=!1;let ce=L;if(yield yield fe(ce),ce.candidates&&(!((q=ce.candidates[0])===null||q===void 0)&&q.content)){Se.push(ce.candidates[0].content);for(let ve of(U=ce.candidates[0].content.parts)!==null&&U!==void 0?U:[])if(m<a&&ve.functionCall){if(!ve.functionCall.name)throw new Error("Function call name was not returned by the model.");if(C.has(ve.functionCall.name)){let Be=yield fe(C.get(ve.functionCall.name).callTool([ve.functionCall]));ae.push(...Be)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${C.keys()}, mising tool: ${ve.functionCall.name}`)}}}}catch(ce){T={error:ce}}finally{try{!Q&&!E&&(R=J.return)&&(yield fe(R.call(J)))}finally{if(T)throw T.error}}if(ae.length>0){d=!0;let ce=new Xt;ce.candidates=[{content:{role:"user",parts:ae}}],yield yield fe(ce);let ve=[];ve.push(...Se),ve.push({role:"user",parts:ae});let Be=dt(y.contents).concat(ve);y.contents=Be}else break}})})(this,f,e)}async generateContentInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=bc(this.apiClient,e);return m=Z("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=yc(C),E=new Xt;return Object.assign(E,y),E})}else{let h=vc(this.apiClient,e);return m=Z("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=xc(C),E=new Xt;return Object.assign(E,y),E})}}async generateContentStreamInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=bc(this.apiClient,e);return m=Z("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.requestStream({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),d.then(function(y){return gt(this,arguments,function*(){var E,T,R,L;try{for(var q=!0,U=ht(y),Q;Q=yield fe(U.next()),E=Q.done,!E;q=!0){L=Q.value,q=!1;let J=L,ie=yc(yield fe(J.json()));ie.sdkHttpResponse={headers:J.headers};let se=new Xt;Object.assign(se,ie),yield yield fe(se)}}catch(J){T={error:J}}finally{try{!q&&!E&&(R=U.return)&&(yield fe(R.call(U)))}finally{if(T)throw T.error}}})})}else{let h=vc(this.apiClient,e);return m=Z("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.requestStream({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}),d.then(function(y){return gt(this,arguments,function*(){var E,T,R,L;try{for(var q=!0,U=ht(y),Q;Q=yield fe(U.next()),E=Q.done,!E;q=!0){L=Q.value,q=!1;let J=L,ie=xc(yield fe(J.json()));ie.sdkHttpResponse={headers:J.headers};let se=new Xt;Object.assign(se,ie),yield yield fe(se)}}catch(J){T={error:J}}finally{try{!q&&!E&&(R=U.return)&&(yield fe(R.call(U)))}finally{if(T)throw T.error}}})})}}async embedContent(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=Pp(this.apiClient,e);return m=Z("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Np(C),E=new Ii;return Object.assign(E,y),E})}else{let h=Ip(this.apiClient,e);return m=Z("{model}:batchEmbedContents",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Fp(C),E=new Ii;return Object.assign(E,y),E})}}async generateImagesInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=zp(this.apiClient,e);return m=Z("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Wp(C),E=new Pi;return Object.assign(E,y),E})}else{let h=Hp(this.apiClient,e);return m=Z("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Kp(C),E=new Pi;return Object.assign(E,y),E})}}async editImageInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let m=Dp(this.apiClient,e);return a=Z("{model}:predict",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(h=>{let C=h;return C.sdkHttpResponse={headers:f.headers},C})),o.then(f=>{let h=Mp(f),C=new Jr;return Object.assign(C,h),C})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let m=zg(this.apiClient,e);return a=Z("{model}:predict",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(h=>{let C=h;return C.sdkHttpResponse={headers:f.headers},C})),o.then(f=>{let h=Kg(f),C=new Qr;return Object.assign(C,h),C})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let m=Ag(this.apiClient,e);return a=Z("{model}:predict",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>{let h=Dg(f),C=new Yr;return Object.assign(C,h),C})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let m=Fg(this.apiClient,e);return a=Z("{model}:predict",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>{let h=Ng(f),C=new Xr;return Object.assign(C,h),C})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=dg(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>_s(C))}else{let h=cg(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>fs(C))}}async listInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=vg(this.apiClient,e);return m=Z("{models_url}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=xg(C),E=new Fi;return Object.assign(E,y),E})}else{let h=Cg(this.apiClient,e);return m=Z("{models_url}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=bg(C),E=new Fi;return Object.assign(E,y),E})}}async update(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=$g(this.apiClient,e);return m=Z("{model}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>_s(C))}else{let h=qg(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>fs(C))}}async delete(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=Sp(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Ep(C),E=new Ni;return Object.assign(E,y),E})}else{let h=yp(this.apiClient,e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=wp(C),E=new Ni;return Object.assign(E,y),E})}}async countTokens(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=vp(this.apiClient,e);return m=Z("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=xp(C),E=new Ri;return Object.assign(E,y),E})}else{let h=Cp(this.apiClient,e);return m=Z("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=bp(C),E=new Ri;return Object.assign(E,y),E})}}async computeTokens(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let m=up(this.apiClient,e);return a=Z("{model}:computeTokens",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(h=>{let C=h;return C.sdkHttpResponse={headers:f.headers},C})),o.then(f=>{let h=mp(f),C=new Zr;return Object.assign(C,h),C})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=jp(this.apiClient,e);return m=Z("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d.then(C=>{let y=Xp(C),E=new Oi;return Object.assign(E,y),E})}else{let h=Zp(this.apiClient,e);return m=Z("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d.then(C=>{let y=Yp(C),E=new Oi;return Object.assign(E,y),E})}}};var As=class extends ft{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],a;n&&"httpOptions"in n&&(a=n.httpOptions);let d=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:a}});return t._fromAPIResponse({apiResponse:d,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=t.name.split("/operations/")[0],a;n&&"httpOptions"in n&&(a=n.httpOptions);let d=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:a}});return t._fromAPIResponse({apiResponse:d,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=Ju(e);return m=Z("{operationName}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json()),d}else{let h=Wu(e);return m=Z("{operationName}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json()),d}}async fetchPredictVideosOperationInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let m=Gu(e);return a=Z("{resourceName}:fetchPredictOperation",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}};function Fh(i){let e={},t=u(i,["data"]);if(t!=null&&p(e,["data"],t),u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Nh(i){let e={},t=u(i,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>$h(a))),p(e,["parts"],o)}let n=u(i,["role"]);return n!=null&&p(e,["role"],n),e}function Rh(i,e,t){let n={},o=u(e,["expireTime"]);t!==void 0&&o!=null&&p(t,["expireTime"],o);let a=u(e,["newSessionExpireTime"]);t!==void 0&&a!=null&&p(t,["newSessionExpireTime"],a);let d=u(e,["uses"]);t!==void 0&&d!=null&&p(t,["uses"],d);let m=u(e,["liveConnectConstraints"]);t!==void 0&&m!=null&&p(t,["bidiGenerateContentSetup"],qh(i,m));let f=u(e,["lockAdditionalFields"]);return t!==void 0&&f!=null&&p(t,["fieldMask"],f),n}function Oh(i,e){let t={},n=u(e,["config"]);return n!=null&&p(t,["config"],Rh(i,n,t)),t}function Bh(i){let e={};if(u(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=u(i,["fileUri"]);t!=null&&p(e,["fileUri"],t);let n=u(i,["mimeType"]);return n!=null&&p(e,["mimeType"],n),e}function Vh(i){let e={},t=u(i,["id"]);t!=null&&p(e,["id"],t);let n=u(i,["args"]);n!=null&&p(e,["args"],n);let o=u(i,["name"]);if(o!=null&&p(e,["name"],o),u(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Lh(i){let e={};if(u(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=u(i,["enableWidget"]);return t!=null&&p(e,["enableWidget"],t),e}function Gh(i){let e={};if(u(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=u(i,["timeRangeFilter"]);return t!=null&&p(e,["timeRangeFilter"],t),e}function Uh(i,e){let t={},n=u(i,["generationConfig"]);e!==void 0&&n!=null&&p(e,["setup","generationConfig"],n);let o=u(i,["responseModalities"]);e!==void 0&&o!=null&&p(e,["setup","generationConfig","responseModalities"],o);let a=u(i,["temperature"]);e!==void 0&&a!=null&&p(e,["setup","generationConfig","temperature"],a);let d=u(i,["topP"]);e!==void 0&&d!=null&&p(e,["setup","generationConfig","topP"],d);let m=u(i,["topK"]);e!==void 0&&m!=null&&p(e,["setup","generationConfig","topK"],m);let f=u(i,["maxOutputTokens"]);e!==void 0&&f!=null&&p(e,["setup","generationConfig","maxOutputTokens"],f);let h=u(i,["mediaResolution"]);e!==void 0&&h!=null&&p(e,["setup","generationConfig","mediaResolution"],h);let C=u(i,["seed"]);e!==void 0&&C!=null&&p(e,["setup","generationConfig","seed"],C);let y=u(i,["speechConfig"]);e!==void 0&&y!=null&&p(e,["setup","generationConfig","speechConfig"],Js(y));let E=u(i,["thinkingConfig"]);e!==void 0&&E!=null&&p(e,["setup","generationConfig","thinkingConfig"],E);let T=u(i,["enableAffectiveDialog"]);e!==void 0&&T!=null&&p(e,["setup","generationConfig","enableAffectiveDialog"],T);let R=u(i,["systemInstruction"]);e!==void 0&&R!=null&&p(e,["setup","systemInstruction"],Nh($e(R)));let L=u(i,["tools"]);if(e!==void 0&&L!=null){let he=_n(L);Array.isArray(he)&&(he=he.map(ae=>zh(fn(ae)))),p(e,["setup","tools"],he)}let q=u(i,["sessionResumption"]);e!==void 0&&q!=null&&p(e,["setup","sessionResumption"],Hh(q));let U=u(i,["inputAudioTranscription"]);e!==void 0&&U!=null&&p(e,["setup","inputAudioTranscription"],U);let Q=u(i,["outputAudioTranscription"]);e!==void 0&&Q!=null&&p(e,["setup","outputAudioTranscription"],Q);let J=u(i,["realtimeInputConfig"]);e!==void 0&&J!=null&&p(e,["setup","realtimeInputConfig"],J);let ie=u(i,["contextWindowCompression"]);e!==void 0&&ie!=null&&p(e,["setup","contextWindowCompression"],ie);let se=u(i,["proactivity"]);if(e!==void 0&&se!=null&&p(e,["setup","proactivity"],se),u(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function qh(i,e){let t={},n=u(e,["model"]);n!=null&&p(t,["setup","model"],Te(i,n));let o=u(e,["config"]);return o!=null&&p(t,["config"],Uh(o,t)),t}function $h(i){let e={},t=u(i,["mediaResolution"]);t!=null&&p(e,["mediaResolution"],t);let n=u(i,["codeExecutionResult"]);n!=null&&p(e,["codeExecutionResult"],n);let o=u(i,["executableCode"]);o!=null&&p(e,["executableCode"],o);let a=u(i,["fileData"]);a!=null&&p(e,["fileData"],Bh(a));let d=u(i,["functionCall"]);d!=null&&p(e,["functionCall"],Vh(d));let m=u(i,["functionResponse"]);m!=null&&p(e,["functionResponse"],m);let f=u(i,["inlineData"]);f!=null&&p(e,["inlineData"],Fh(f));let h=u(i,["text"]);h!=null&&p(e,["text"],h);let C=u(i,["thought"]);C!=null&&p(e,["thought"],C);let y=u(i,["thoughtSignature"]);y!=null&&p(e,["thoughtSignature"],y);let E=u(i,["videoMetadata"]);return E!=null&&p(e,["videoMetadata"],E),e}function Hh(i){let e={},t=u(i,["handle"]);if(t!=null&&p(e,["handle"],t),u(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function zh(i){let e={},t=u(i,["functionDeclarations"]);if(t!=null){let C=t;Array.isArray(C)&&(C=C.map(y=>y)),p(e,["functionDeclarations"],C)}if(u(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(i,["googleSearchRetrieval"]);n!=null&&p(e,["googleSearchRetrieval"],n);let o=u(i,["computerUse"]);o!=null&&p(e,["computerUse"],o);let a=u(i,["fileSearch"]);a!=null&&p(e,["fileSearch"],a);let d=u(i,["codeExecution"]);if(d!=null&&p(e,["codeExecution"],d),u(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let m=u(i,["googleMaps"]);m!=null&&p(e,["googleMaps"],Lh(m));let f=u(i,["googleSearch"]);f!=null&&p(e,["googleSearch"],Gh(f));let h=u(i,["urlContext"]);return h!=null&&p(e,["urlContext"],h),e}function Kh(i){let e=[];for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let o=Object.keys(n).map(a=>`${t}.${a}`);e.push(...o)}else e.push(t)}return e.join(",")}function Wh(i,e){let t=null,n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let a=n.setup;typeof a=="object"&&a!==null?(i.bidiGenerateContentSetup=a,t=a):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;let o=i.fieldMask;if(t){let a=Kh(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)a?i.fieldMask=a:delete i.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){let d=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],m=[];o.length>0&&(m=o.map(h=>d.includes(h)?`generationConfig.${h}`:h));let f=[];a&&f.push(a),m.length>0&&f.push(...m),f.length>0?i.fieldMask=f.join(","):delete i.fieldMask}else delete i.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?i.fieldMask=o.join(","):delete i.fieldMask;return i}var Ds=class extends ft{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let m=Oh(this.apiClient,e);a=Z("auth_tokens",m._url),d=m._query,delete m.config,delete m._url,delete m._query;let f=Wh(m,e.config);return o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),o.then(h=>h)}}};function Jh(i,e){let t={},n=u(i,["force"]);return e!==void 0&&n!=null&&p(e,["_query","force"],n),t}function Qh(i){let e={},t=u(i,["name"]);t!=null&&p(e,["_url","name"],t);let n=u(i,["config"]);return n!=null&&Jh(n,e),e}function Yh(i){let e={},t=u(i,["name"]);return t!=null&&p(e,["_url","name"],t),e}function Xh(i,e){let t={},n=u(i,["pageSize"]);e!==void 0&&n!=null&&p(e,["_query","pageSize"],n);let o=u(i,["pageToken"]);return e!==void 0&&o!=null&&p(e,["_query","pageToken"],o),t}function Zh(i){let e={},t=u(i,["parent"]);t!=null&&p(e,["_url","parent"],t);let n=u(i,["config"]);return n!=null&&Xh(n,e),e}function jh(i){let e={},t=u(i,["sdkHttpResponse"]);t!=null&&p(e,["sdkHttpResponse"],t);let n=u(i,["nextPageToken"]);n!=null&&p(e,["nextPageToken"],n);let o=u(i,["documents"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(d=>d)),p(e,["documents"],a)}return e}var Ms=class extends ft{constructor(e){super(),this.apiClient=e,this.list=async t=>new Dt(Rt.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Yh(e);return a=Z("{name}",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,n;let o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let d=Qh(e);o=Z("{name}",d._url),a=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=Zh(e);return a=Z("{parent}/documents",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>{let h=jh(f),C=new jr;return Object.assign(C,h),C})}}};var Ts=class extends ft{constructor(e,t=new Ms(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new Dt(Rt.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=jg(e);return a=Z("fileSearchStores",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async get(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=nh(e);return a=Z("{name}",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,n;let o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let d=th(e);o=Z("{name}",d._url),a=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=lh(e);return a=Z("fileSearchStores",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>{let h=ch(f),C=new es;return Object.assign(C,h),C})}}async uploadToFileSearchStoreInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=dh(e);return a=Z("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>{let h=uh(f),C=new ts;return Object.assign(C,h),C})}}async importFile(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=rh(e);return a=Z("{file_search_store_name}:importFile",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),o.then(f=>{let h=oh(f),C=new ns;return Object.assign(C,h),C})}}};var ld=function(){let{crypto:i}=globalThis;if(i?.randomUUID)return ld=i.randomUUID.bind(i),i.randomUUID();let e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},ef=()=>ld();function ks(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}var Is=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){let e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};var et=class extends Error{},tt=class i extends et{constructor(e,t,n,o){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=o,this.error=t}static makeMessage(e,t,n){let o=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,t,n,o){if(!e||!o)return new gn({message:n,cause:Is(t)});let a=t;return e===400?new Ki(e,a,n,o):e===401?new Wi(e,a,n,o):e===403?new Ji(e,a,n,o):e===404?new Qi(e,a,n,o):e===409?new Yi(e,a,n,o):e===422?new Xi(e,a,n,o):e===429?new Zi(e,a,n,o):e>=500?new ji(e,a,n,o):new i(e,a,n,o)}},qn=class extends tt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},gn=class extends tt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},zi=class extends gn{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ki=class extends tt{},Wi=class extends tt{},Ji=class extends tt{},Qi=class extends tt{},Yi=class extends tt{},Xi=class extends tt{},Zi=class extends tt{},ji=class extends tt{};var tf=/^[a-z][a-z0-9+.-]*:/i,nf=i=>tf.test(i),Ps=i=>(Ps=Array.isArray,Ps(i)),of=Ps,rf=of,Mc=rf;function sf(i){if(!i)return!0;for(let e in i)return!1;return!0}function af(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var lf=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new et(`${i} must be an integer`);if(e<0)throw new et(`${i} must be a positive integer`);return e},cf=i=>{try{return JSON.parse(i)}catch{return}};var df=i=>new Promise(e=>setTimeout(e,i));var un="0.0.1";function uf(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var mf=()=>{var i,e,t,n,o;let a=uf();if(a==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":un,"X-Stainless-OS":kc(Deno.build.os),"X-Stainless-Arch":Tc(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":un,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(a==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":un,"X-Stainless-OS":kc((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":Tc((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};let d=pf();return d?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":un,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${d.browser}`,"X-Stainless-Runtime-Version":d.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":un,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function pf(){if(typeof navigator>"u"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let n=t.exec(navigator.userAgent);if(n){let o=n[1]||0,a=n[2]||0,d=n[3]||0;return{browser:e,version:`${o}.${a}.${d}`}}}return null}var Tc=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",kc=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),wi,gf=()=>wi??(wi=mf());function hf(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function cd(...i){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function ff(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return cd({start(){},async pull(t){let{done:n,value:o}=await e.next();n?t.close():t.enqueue(o)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function dd(i){if(i[Symbol.asyncIterator])return i;let e=i.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function _f(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=i.getReader(),o=n.cancel();n.releaseLock(),await o}var Cf=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var ud=()=>{var i;if(typeof File>"u"){let{process:e}=globalThis,t=typeof((i=e?.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Hr(i,e,t){return ud(),new File(i,e??"unknown_file",t)}function vf(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}var bf=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var md=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",xf=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&md(i),yf=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function Sf(i,e,t){if(ud(),i=await i,xf(i))return i instanceof File?i:Hr([await i.arrayBuffer()],i.name);if(yf(i)){let o=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),Hr(await Fs(o),e,t)}let n=await Fs(i);if(e||(e=vf(i)),!t?.type){let o=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof o=="string"&&(t=Object.assign(Object.assign({},t),{type:o}))}return Hr(n,e,t)}async function Fs(i){var e,t,n,o,a;let d=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)d.push(i);else if(md(i))d.push(i instanceof Blob?i:await i.arrayBuffer());else if(bf(i))try{for(var m=!0,f=ht(i),h;h=await f.next(),e=h.done,!e;m=!0){o=h.value,m=!1;let C=o;d.push(...await Fs(C))}}catch(C){t={error:C}}finally{try{!m&&!e&&(n=f.return)&&await n.call(f)}finally{if(t)throw t.error}}else{let C=(a=i?.constructor)===null||a===void 0?void 0:a.name;throw new Error(`Unexpected data type: ${typeof i}${C?`; constructor: ${C}`:""}${wf(i)}`)}return d}function wf(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}var Ef=(()=>{class i{constructor(t){this._client=t}}i._key=[];return i})();function pd(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Ic=Object.freeze(Object.create(null)),Af=(i=pd)=>function(t,...n){if(t.length===1)return t[0];let o=!1,a=[],d=t.reduce((C,y,E)=>{var T,R,L;/[?#]/.test(y)&&(o=!0);let q=n[E],U=(o?encodeURIComponent:i)(""+q);return E!==n.length&&(q==null||typeof q=="object"&&q.toString===((L=Object.getPrototypeOf((R=Object.getPrototypeOf((T=q.hasOwnProperty)!==null&&T!==void 0?T:Ic))!==null&&R!==void 0?R:Ic))===null||L===void 0?void 0:L.toString))&&(U=q+"",a.push({start:C.length+y.length,length:U.length,error:`Value of type ${Object.prototype.toString.call(q).slice(8,-1)} is not a valid path parameter`})),C+y+(E===n.length?"":U)},""),m=d.split(/[?#]/,1)[0],f=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,h;for(;(h=f.exec(m))!==null;)a.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(a.sort((C,y)=>C.start-y.start),a.length>0){let C=0,y=a.reduce((E,T)=>{let R=" ".repeat(T.start-C),L="^".repeat(T.length);return C=T.start+T.length,E+R+L},"");throw new et(`Path parameters result in path with invalid segments:
${a.map(E=>E.error).join(`
`)}
${d}
${y}`)}return d},Ei=Af(pd);var eo=class extends Ef{create(e,t){var n;let{api_version:o=this._client.apiVersion}=e,a=$i(e,["api_version"]);if("model"in a&&"agent_config"in a)throw new et("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in a&&"generation_config"in a)throw new et("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Ei`/${o}/interactions`,Object.assign(Object.assign({body:a},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:o=this._client.apiVersion}=t??{};return this._client.delete(Ei`/${o}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:o=this._client.apiVersion}=t??{};return this._client.post(Ei`/${o}/interactions/${e}/cancel`,n)}get(e,t={},n){var o;let a=t??{},{api_version:d=this._client.apiVersion}=a,m=$i(a,["api_version"]);return this._client.get(Ei`/${d}/interactions/${e}`,Object.assign(Object.assign({query:m},n),{stream:(o=t?.stream)!==null&&o!==void 0?o:!1}))}};eo._key=Object.freeze(["interactions"]);var to=class extends eo{};function Df(i){let e=0;for(let o of i)e+=o.length;let t=new Uint8Array(e),n=0;for(let o of i)t.set(o,n),n+=o.length;return t}var Ai;function Qs(i){let e;return(Ai??(e=new globalThis.TextEncoder,Ai=e.encode.bind(e)))(i)}var Di;function Pc(i){let e;return(Di??(e=new globalThis.TextDecoder,Di=e.decode.bind(e)))(i)}var hn=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Qs(e):e;this.buffer=Df([this.buffer,t]);let n=[],o;for(;(o=Mf(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){n.push(Pc(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let a=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,d=Pc(this.buffer.subarray(0,a));n.push(d),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};hn.NEWLINE_CHARS=new Set([`
`,"\r"]);hn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Mf(i,e){for(let o=e??0;o<i.length;o++){if(i[o]===10)return{preceding:o,index:o+1,carriage:!1};if(i[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function Tf(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}var no={off:0,error:200,warn:300,info:400,debug:500},Fc=(i,e,t)=>{if(i){if(af(no,i))return i;ze(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(no))}`)}};function Gn(){}function Mi(i,e,t){return!e||no[i]>no[t]?Gn:e[i].bind(e)}var kf={error:Gn,warn:Gn,info:Gn,debug:Gn},Nc=new WeakMap;function ze(i){var e;let t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return kf;let o=Nc.get(t);if(o&&o[0]===n)return o[1];let a={error:Mi("error",t,n),warn:Mi("warn",t,n),info:Mi("info",t,n),debug:Mi("debug",t,n)};return Nc.set(t,[n,a]),a}var Yt=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);var Ns=class i{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let o=!1,a=n?ze(n):console;function d(){return gt(this,arguments,function*(){var f,h,C,y;if(o)throw new et("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let E=!1;try{try{for(var T=!0,R=ht(If(e,t)),L;L=yield fe(R.next()),f=L.done,!f;T=!0){y=L.value,T=!1;let q=y;if(!E)if(q.data.startsWith("[DONE]")){E=!0;continue}else try{yield yield fe(JSON.parse(q.data))}catch(U){throw a.error("Could not parse message into JSON:",q.data),a.error("From chunk:",q.raw),U}}}catch(q){h={error:q}}finally{try{!T&&!f&&(C=R.return)&&(yield fe(C.call(R)))}finally{if(h)throw h.error}}E=!0}catch(q){if(ks(q))return yield fe(void 0);throw q}finally{E||t.abort()}})}return new i(d,t,n)}static fromReadableStream(e,t,n){let o=!1;function a(){return gt(this,arguments,function*(){var f,h,C,y;let E=new hn,T=dd(e);try{for(var R=!0,L=ht(T),q;q=yield fe(L.next()),f=q.done,!f;R=!0){y=q.value,R=!1;let U=y;for(let Q of E.decode(U))yield yield fe(Q)}}catch(U){h={error:U}}finally{try{!R&&!f&&(C=L.return)&&(yield fe(C.call(L)))}finally{if(h)throw h.error}}for(let U of E.flush())yield yield fe(U)})}function d(){return gt(this,arguments,function*(){var f,h,C,y;if(o)throw new et("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let E=!1;try{try{for(var T=!0,R=ht(a()),L;L=yield fe(R.next()),f=L.done,!f;T=!0){y=L.value,T=!1;let q=y;E||q&&(yield yield fe(JSON.parse(q)))}}catch(q){h={error:q}}finally{try{!T&&!f&&(C=R.return)&&(yield fe(C.call(R)))}finally{if(h)throw h.error}}E=!0}catch(q){if(ks(q))return yield fe(void 0);throw q}finally{E||t.abort()}})}return new i(d,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),o=a=>({next:()=>{if(a.length===0){let d=n.next();e.push(d),t.push(d)}return a.shift()}});return[new i(()=>o(e),this.controller,this.client),new i(()=>o(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return cd({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:o,done:a}=await t.next();if(a)return n.close();let d=Qs(JSON.stringify(o)+`
`);n.enqueue(d)}catch(o){n.error(o)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function If(i,e){return gt(this,arguments,function*(){var n,o,a,d;if(!i.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new et("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new et("Attempted to iterate over a response with no body");let m=new Rs,f=new hn,h=dd(i.body);try{for(var C=!0,y=ht(Pf(h)),E;E=yield fe(y.next()),n=E.done,!n;C=!0){d=E.value,C=!1;let T=d;for(let R of f.decode(T)){let L=m.decode(R);L&&(yield yield fe(L))}}}catch(T){o={error:T}}finally{try{!C&&!n&&(a=y.return)&&(yield fe(a.call(y)))}finally{if(o)throw o.error}}for(let T of f.flush()){let R=m.decode(T);R&&(yield yield fe(R))}})}function Pf(i){return gt(this,arguments,function*(){var t,n,o,a;let d=new Uint8Array;try{for(var m=!0,f=ht(i),h;h=yield fe(f.next()),t=h.done,!t;m=!0){a=h.value,m=!1;let C=a;if(C==null)continue;let y=C instanceof ArrayBuffer?new Uint8Array(C):typeof C=="string"?Qs(C):C,E=new Uint8Array(d.length+y.length);E.set(d),E.set(y,d.length),d=E;let T;for(;(T=Tf(d))!==-1;)yield yield fe(d.slice(0,T)),d=d.slice(T)}}catch(C){n={error:C}}finally{try{!m&&!t&&(o=f.return)&&(yield fe(o.call(f)))}finally{if(n)throw n.error}}d.length>0&&(yield yield fe(d))})}var Rs=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,o]=Ff(e,":");return o.startsWith(" ")&&(o=o.substring(1)),t==="event"?this.event=o:t==="data"&&this.data.push(o),null}};function Ff(i,e){let t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}async function Nf(i,e){let{response:t,requestLogID:n,retryOfRequestLogID:o,startTime:a}=e,d=await(async()=>{var m;if(e.options.stream)return ze(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):Ns.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let f=t.headers.get("content-type"),h=(m=f?.split(";")[0])===null||m===void 0?void 0:m.trim();return h?.includes("application/json")||h?.endsWith("+json")?await t.json():await t.text()})();return ze(i).debug(`[${n}] response parsed`,Yt({retryOfRequestLogID:o,url:t.url,status:t.status,body:d,durationMs:Date.now()-a})),d}var Os=class i extends Promise{constructor(e,t,n=Nf){super(o=>{o(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var gd=Symbol("brand.privateNullableHeaders");function*Rf(i){if(!i)return;if(gd in i){let{values:n,nulls:o}=i;yield*n.entries();for(let a of o)yield[a,null];return}let e=!1,t;i instanceof Headers?t=i.entries():Mc(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let n of t){let o=n[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let a=Mc(n[1])?n[1]:[n[1]],d=!1;for(let m of a)m!==void 0&&(e&&!d&&(d=!0,yield[o,null]),yield[o,m])}}var Vn=i=>{let e=new Headers,t=new Set;for(let n of i){let o=new Set;for(let[a,d]of Rf(n)){let m=a.toLowerCase();o.has(m)||(e.delete(a),o.add(m)),d===null?(e.delete(a),t.add(m)):(e.append(a,d),t.delete(m))}}return{[gd]:!0,values:e,nulls:t}};var zr=i=>{var e,t,n,o,a,d;if(typeof globalThis.process<"u")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(d=(a=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||a===void 0?void 0:a.call(o,i))===null||d===void 0?void 0:d.trim()};var hd,Of=(()=>{class i{constructor(t){var n,o,a,d,m,f,h,{baseURL:C=zr("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:y=(n=zr("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:E="v1beta"}=t,T=$i(t,["baseURL","apiKey","apiVersion"]);let R=Object.assign(Object.assign({apiKey:y,apiVersion:E},T),{baseURL:C||"https://generativelanguage.googleapis.com"});this.baseURL=R.baseURL,this.timeout=(o=R.timeout)!==null&&o!==void 0?o:i.DEFAULT_TIMEOUT,this.logger=(a=R.logger)!==null&&a!==void 0?a:console;let L="warn";this.logLevel=L,this.logLevel=(m=(d=Fc(R.logLevel,"ClientOptions.logLevel",this))!==null&&d!==void 0?d:Fc(zr("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&m!==void 0?m:L,this.fetchOptions=R.fetchOptions,this.maxRetries=(f=R.maxRetries)!==null&&f!==void 0?f:2,this.fetch=(h=R.fetch)!==null&&h!==void 0?h:hf(),this.encoder=Cf,this._options=R,this.apiKey=y,this.apiVersion=E,this.clientAdapter=R.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){let n=Vn([t.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return Vn([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Vn([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([n,o])=>typeof o<"u").map(([n,o])=>{if(typeof o=="string"||typeof o=="number"||typeof o=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(o)}`;if(o===null)return`${encodeURIComponent(n)}=`;throw new et(`Cannot stringify type ${typeof o}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${un}`}defaultIdempotencyKey(){return`stainless-node-retry-${ef()}`}makeStatusError(t,n,o,a){return tt.generate(t,n,o,a)}buildURL(t,n,o){let a=!this.baseURLOverridden()&&o||this.baseURL,d=nf(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),m=this.defaultQuery();return sf(m)||(n=Object.assign(Object.assign({},m),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(d.search=this.stringifyQuery(n)),d.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){let n=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(t,{url:n,options:o}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,o){return this.request(Promise.resolve(o).then(a=>Object.assign({method:t,path:n},a)))}request(t,n=null){return new Os(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,o){var a,d,m;let f=await t,h=(a=f.maxRetries)!==null&&a!==void 0?a:this.maxRetries;n==null&&(n=h),await this.prepareOptions(f);let{req:C,url:y,timeout:E}=await this.buildRequest(f,{retryCount:h-n});await this.prepareRequest(C,{url:y,options:f});let T="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),R=o===void 0?"":`, retryOf: ${o}`,L=Date.now();if(ze(this).debug(`[${T}] sending request`,Yt({retryOfRequestLogID:o,method:f.method,url:y,options:f,headers:C.headers})),!((d=f.signal)===null||d===void 0)&&d.aborted)throw new qn;let q=new AbortController,U=await this.fetchWithTimeout(y,C,E,q).catch(Is),Q=Date.now();if(U instanceof globalThis.Error){let ie=`retrying, ${n} attempts remaining`;if(!((m=f.signal)===null||m===void 0)&&m.aborted)throw new qn;let se=ks(U)||/timed? ?out/i.test(String(U)+("cause"in U?String(U.cause):""));if(n)return ze(this).info(`[${T}] connection ${se?"timed out":"failed"} - ${ie}`),ze(this).debug(`[${T}] connection ${se?"timed out":"failed"} (${ie})`,Yt({retryOfRequestLogID:o,url:y,durationMs:Q-L,message:U.message})),this.retryRequest(f,n,o??T);throw ze(this).info(`[${T}] connection ${se?"timed out":"failed"} - error; no more retries left`),ze(this).debug(`[${T}] connection ${se?"timed out":"failed"} (error; no more retries left)`,Yt({retryOfRequestLogID:o,url:y,durationMs:Q-L,message:U.message})),se?new zi:new gn({cause:U})}let J=`[${T}${R}] ${C.method} ${y} ${U.ok?"succeeded":"failed"} with status ${U.status} in ${Q-L}ms`;if(!U.ok){let ie=await this.shouldRetry(U);if(n&&ie){let ve=`retrying, ${n} attempts remaining`;return await _f(U.body),ze(this).info(`${J} - ${ve}`),ze(this).debug(`[${T}] response error (${ve})`,Yt({retryOfRequestLogID:o,url:U.url,status:U.status,headers:U.headers,durationMs:Q-L})),this.retryRequest(f,n,o??T,U.headers)}let se=ie?"error; no more retries left":"error; not retryable";ze(this).info(`${J} - ${se}`);let he=await U.text().catch(ve=>Is(ve).message),ae=cf(he),Se=ae?void 0:he;throw ze(this).debug(`[${T}] response error (${se})`,Yt({retryOfRequestLogID:o,url:U.url,status:U.status,headers:U.headers,message:Se,durationMs:Date.now()-L})),this.makeStatusError(U.status,ae,Se,U.headers)}return ze(this).info(J),ze(this).debug(`[${T}] response start`,Yt({retryOfRequestLogID:o,url:U.url,status:U.status,headers:U.headers,durationMs:Q-L})),{response:U,options:f,controller:q,requestLogID:T,retryOfRequestLogID:o,startTime:L}}async fetchWithTimeout(t,n,o,a){let d=n||{},{signal:m,method:f}=d,h=$i(d,["signal","method"]);m&&m.addEventListener("abort",()=>a.abort());let C=setTimeout(()=>a.abort(),o),y=globalThis.ReadableStream&&h.body instanceof globalThis.ReadableStream||typeof h.body=="object"&&h.body!==null&&Symbol.asyncIterator in h.body,E=Object.assign(Object.assign(Object.assign({signal:a.signal},y?{duplex:"half"}:{}),{method:"GET"}),h);f&&(E.method=f.toUpperCase());try{return await this.fetch.call(void 0,t,E)}finally{clearTimeout(C)}}async shouldRetry(t){let n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,o,a){var d;let m,f=a?.get("retry-after-ms");if(f){let C=parseFloat(f);Number.isNaN(C)||(m=C)}let h=a?.get("retry-after");if(h&&!m){let C=parseFloat(h);Number.isNaN(C)?m=Date.parse(h)-Date.now():m=C*1e3}if(!(m&&0<=m&&m<60*1e3)){let C=(d=t.maxRetries)!==null&&d!==void 0?d:this.maxRetries;m=this.calculateDefaultRetryTimeoutMillis(n,C)}return await df(m),this.makeRequest(t,n-1,o)}calculateDefaultRetryTimeoutMillis(t,n){let d=n-t,m=Math.min(.5*Math.pow(2,d),8),f=1-Math.random()*.25;return m*f*1e3}async buildRequest(t,{retryCount:n=0}={}){var o,a,d;let m=Object.assign({},t),{method:f,path:h,query:C,defaultBaseURL:y}=m,E=this.buildURL(h,C,y);"timeout"in m&&lf("timeout",m.timeout),m.timeout=(o=m.timeout)!==null&&o!==void 0?o:this.timeout;let{bodyHeaders:T,body:R}=this.buildBody({options:m}),L=await this.buildHeaders({options:t,method:f,bodyHeaders:T,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:f,headers:L},m.signal&&{signal:m.signal}),globalThis.ReadableStream&&R instanceof globalThis.ReadableStream&&{duplex:"half"}),R&&{body:R}),(a=this.fetchOptions)!==null&&a!==void 0?a:{}),(d=m.fetchOptions)!==null&&d!==void 0?d:{}),url:E,timeout:m.timeout}}async buildHeaders({options:t,method:n,bodyHeaders:o,retryCount:a}){let d={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),d[this.idempotencyHeader]=t.idempotencyKey);let m=await this.authHeaders(t),f=Vn([d,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),gf()),this._options.defaultHeaders,o,t.headers,m]);return this.validateHeaders(f),f.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};let o=Vn([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&o.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:ff(t)}:this.encoder({body:t,headers:o})}}return i.DEFAULT_TIMEOUT=6e4,i})(),Ve=class extends Of{constructor(){super(...arguments),this.interactions=new to(this)}};hd=Ve;Ve.GeminiNextGenAPIClient=hd;Ve.GeminiNextGenAPIClientError=et;Ve.APIError=tt;Ve.APIConnectionError=gn;Ve.APIConnectionTimeoutError=zi;Ve.APIUserAbortError=qn;Ve.NotFoundError=Qi;Ve.ConflictError=Yi;Ve.RateLimitError=Zi;Ve.BadRequestError=Ki;Ve.AuthenticationError=Wi;Ve.InternalServerError=ji;Ve.PermissionDeniedError=Ji;Ve.UnprocessableEntityError=Xi;Ve.toFile=Sf;Ve.Interactions=to;function Bf(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function Vf(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function Lf(i,e){let t={},n=u(i,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function Gf(i,e){let t={},n=u(i,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function Uf(i,e,t){let n={};if(u(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let o=u(i,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&p(e,["displayName"],o),u(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let a=u(i,["epochCount"]);e!==void 0&&a!=null&&p(e,["tuningTask","hyperparameters","epochCount"],a);let d=u(i,["learningRateMultiplier"]);if(d!=null&&p(n,["tuningTask","hyperparameters","learningRateMultiplier"],d),u(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(u(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(u(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let m=u(i,["batchSize"]);e!==void 0&&m!=null&&p(e,["tuningTask","hyperparameters","batchSize"],m);let f=u(i,["learningRate"]);if(e!==void 0&&f!=null&&p(e,["tuningTask","hyperparameters","learningRate"],f),u(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(u(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function qf(i,e,t){let n={},o=u(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let T=u(i,["validationDataset"]);e!==void 0&&T!=null&&p(e,["supervisedTuningSpec"],Rc(T))}else if(o==="PREFERENCE_TUNING"){let T=u(i,["validationDataset"]);e!==void 0&&T!=null&&p(e,["preferenceOptimizationSpec"],Rc(T))}let a=u(i,["tunedModelDisplayName"]);e!==void 0&&a!=null&&p(e,["tunedModelDisplayName"],a);let d=u(i,["description"]);e!==void 0&&d!=null&&p(e,["description"],d);let m=u(t,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){let T=u(i,["epochCount"]);e!==void 0&&T!=null&&p(e,["supervisedTuningSpec","hyperParameters","epochCount"],T)}else if(m==="PREFERENCE_TUNING"){let T=u(i,["epochCount"]);e!==void 0&&T!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],T)}let f=u(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){let T=u(i,["learningRateMultiplier"]);e!==void 0&&T!=null&&p(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],T)}else if(f==="PREFERENCE_TUNING"){let T=u(i,["learningRateMultiplier"]);e!==void 0&&T!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],T)}let h=u(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){let T=u(i,["exportLastCheckpointOnly"]);e!==void 0&&T!=null&&p(e,["supervisedTuningSpec","exportLastCheckpointOnly"],T)}else if(h==="PREFERENCE_TUNING"){let T=u(i,["exportLastCheckpointOnly"]);e!==void 0&&T!=null&&p(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],T)}let C=u(t,["config","method"]);if(C===void 0&&(C="SUPERVISED_FINE_TUNING"),C==="SUPERVISED_FINE_TUNING"){let T=u(i,["adapterSize"]);e!==void 0&&T!=null&&p(e,["supervisedTuningSpec","hyperParameters","adapterSize"],T)}else if(C==="PREFERENCE_TUNING"){let T=u(i,["adapterSize"]);e!==void 0&&T!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],T)}if(u(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(u(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let y=u(i,["labels"]);e!==void 0&&y!=null&&p(e,["labels"],y);let E=u(i,["beta"]);return e!==void 0&&E!=null&&p(e,["preferenceOptimizationSpec","hyperParameters","beta"],E),n}function $f(i,e){let t={},n=u(i,["baseModel"]);n!=null&&p(t,["baseModel"],n);let o=u(i,["preTunedModel"]);o!=null&&p(t,["preTunedModel"],o);let a=u(i,["trainingDataset"]);a!=null&&e_(a);let d=u(i,["config"]);return d!=null&&Uf(d,t),t}function Hf(i,e){let t={},n=u(i,["baseModel"]);n!=null&&p(t,["baseModel"],n);let o=u(i,["preTunedModel"]);o!=null&&p(t,["preTunedModel"],o);let a=u(i,["trainingDataset"]);a!=null&&t_(a,t,e);let d=u(i,["config"]);return d!=null&&qf(d,t,e),t}function zf(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function Kf(i,e){let t={},n=u(i,["name"]);return n!=null&&p(t,["_url","name"],n),t}function Wf(i,e,t){let n={},o=u(i,["pageSize"]);e!==void 0&&o!=null&&p(e,["_query","pageSize"],o);let a=u(i,["pageToken"]);e!==void 0&&a!=null&&p(e,["_query","pageToken"],a);let d=u(i,["filter"]);return e!==void 0&&d!=null&&p(e,["_query","filter"],d),n}function Jf(i,e,t){let n={},o=u(i,["pageSize"]);e!==void 0&&o!=null&&p(e,["_query","pageSize"],o);let a=u(i,["pageToken"]);e!==void 0&&a!=null&&p(e,["_query","pageToken"],a);let d=u(i,["filter"]);return e!==void 0&&d!=null&&p(e,["_query","filter"],d),n}function Qf(i,e){let t={},n=u(i,["config"]);return n!=null&&Wf(n,t),t}function Yf(i,e){let t={},n=u(i,["config"]);return n!=null&&Jf(n,t),t}function Xf(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["nextPageToken"]);o!=null&&p(t,["nextPageToken"],o);let a=u(i,["tunedModels"]);if(a!=null){let d=a;Array.isArray(d)&&(d=d.map(m=>fd(m))),p(t,["tuningJobs"],d)}return t}function Zf(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["nextPageToken"]);o!=null&&p(t,["nextPageToken"],o);let a=u(i,["tuningJobs"]);if(a!=null){let d=a;Array.isArray(d)&&(d=d.map(m=>Bs(m))),p(t,["tuningJobs"],d)}return t}function jf(i,e){let t={},n=u(i,["name"]);n!=null&&p(t,["model"],n);let o=u(i,["name"]);return o!=null&&p(t,["endpoint"],o),t}function e_(i,e){let t={};if(u(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=u(i,["examples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),p(t,["examples","examples"],o)}return t}function t_(i,e,t){let n={},o=u(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let d=u(i,["gcsUri"]);e!==void 0&&d!=null&&p(e,["supervisedTuningSpec","trainingDatasetUri"],d)}else if(o==="PREFERENCE_TUNING"){let d=u(i,["gcsUri"]);e!==void 0&&d!=null&&p(e,["preferenceOptimizationSpec","trainingDatasetUri"],d)}let a=u(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let d=u(i,["vertexDatasetResource"]);e!==void 0&&d!=null&&p(e,["supervisedTuningSpec","trainingDatasetUri"],d)}else if(a==="PREFERENCE_TUNING"){let d=u(i,["vertexDatasetResource"]);e!==void 0&&d!=null&&p(e,["preferenceOptimizationSpec","trainingDatasetUri"],d)}if(u(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function fd(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["name"]);o!=null&&p(t,["name"],o);let a=u(i,["state"]);a!=null&&p(t,["state"],Hc(a));let d=u(i,["createTime"]);d!=null&&p(t,["createTime"],d);let m=u(i,["tuningTask","startTime"]);m!=null&&p(t,["startTime"],m);let f=u(i,["tuningTask","completeTime"]);f!=null&&p(t,["endTime"],f);let h=u(i,["updateTime"]);h!=null&&p(t,["updateTime"],h);let C=u(i,["description"]);C!=null&&p(t,["description"],C);let y=u(i,["baseModel"]);y!=null&&p(t,["baseModel"],y);let E=u(i,["_self"]);return E!=null&&p(t,["tunedModel"],jf(E)),t}function Bs(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["name"]);o!=null&&p(t,["name"],o);let a=u(i,["state"]);a!=null&&p(t,["state"],Hc(a));let d=u(i,["createTime"]);d!=null&&p(t,["createTime"],d);let m=u(i,["startTime"]);m!=null&&p(t,["startTime"],m);let f=u(i,["endTime"]);f!=null&&p(t,["endTime"],f);let h=u(i,["updateTime"]);h!=null&&p(t,["updateTime"],h);let C=u(i,["error"]);C!=null&&p(t,["error"],C);let y=u(i,["description"]);y!=null&&p(t,["description"],y);let E=u(i,["baseModel"]);E!=null&&p(t,["baseModel"],E);let T=u(i,["tunedModel"]);T!=null&&p(t,["tunedModel"],T);let R=u(i,["preTunedModel"]);R!=null&&p(t,["preTunedModel"],R);let L=u(i,["supervisedTuningSpec"]);L!=null&&p(t,["supervisedTuningSpec"],L);let q=u(i,["preferenceOptimizationSpec"]);q!=null&&p(t,["preferenceOptimizationSpec"],q);let U=u(i,["tuningDataStats"]);U!=null&&p(t,["tuningDataStats"],U);let Q=u(i,["encryptionSpec"]);Q!=null&&p(t,["encryptionSpec"],Q);let J=u(i,["partnerModelTuningSpec"]);J!=null&&p(t,["partnerModelTuningSpec"],J);let ie=u(i,["customBaseModel"]);ie!=null&&p(t,["customBaseModel"],ie);let se=u(i,["experiment"]);se!=null&&p(t,["experiment"],se);let he=u(i,["labels"]);he!=null&&p(t,["labels"],he);let ae=u(i,["outputUri"]);ae!=null&&p(t,["outputUri"],ae);let Se=u(i,["pipelineJob"]);Se!=null&&p(t,["pipelineJob"],Se);let ce=u(i,["serviceAccount"]);ce!=null&&p(t,["serviceAccount"],ce);let ve=u(i,["tunedModelDisplayName"]);ve!=null&&p(t,["tunedModelDisplayName"],ve);let Be=u(i,["veoTuningSpec"]);return Be!=null&&p(t,["veoTuningSpec"],Be),t}function n_(i,e){let t={},n=u(i,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);let o=u(i,["name"]);o!=null&&p(t,["name"],o);let a=u(i,["metadata"]);a!=null&&p(t,["metadata"],a);let d=u(i,["done"]);d!=null&&p(t,["done"],d);let m=u(i,["error"]);return m!=null&&p(t,["error"],m),t}function Rc(i,e){let t={},n=u(i,["gcsUri"]);n!=null&&p(t,["validationDatasetUri"],n);let o=u(i,["vertexDatasetResource"]);return o!=null&&p(t,["validationDatasetUri"],o),t}var Vs=class extends ft{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Dt(Rt.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let o={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(o.checkpointId=t.config.preTunedModelCheckpointId);let a=Object.assign(Object.assign({},t),{preTunedModel:o});return a.baseModel=void 0,await this.tuneInternal(a)}else{let o=Object.assign({},t);return await this.tuneInternal(o)}else{let o=Object.assign({},t),a=await this.tuneMldevInternal(o),d="";return a.metadata!==void 0&&a.metadata.tunedModel!==void 0?d=a.metadata.tunedModel:a.name!==void 0&&a.name.includes("/operations/")&&(d=a.name.split("/operations/")[0]),{name:d,state:Vc.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=Kf(e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>Bs(C))}else{let h=zf(e);return m=Z("{name}",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>fd(C))}}async listInternal(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=Yf(e);return m=Z("tuningJobs",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Zf(C),E=new Bi;return Object.assign(E,y),E})}else{let h=Qf(e);return m=Z("tunedModels",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Xf(C),E=new Bi;return Object.assign(E,y),E})}}async cancel(e){var t,n,o,a;let d,m="",f={};if(this.apiClient.isVertexAI()){let h=Vf(e);return m=Z("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Gf(C),E=new Vi;return Object.assign(E,y),E})}else{let h=Bf(e);return m=Z("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,d=this.apiClient.request({path:m,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(C=>C.json().then(y=>{let E=y;return E.sdkHttpResponse={headers:C.headers},E})),d.then(C=>{let y=Lf(C),E=new Vi;return Object.assign(E,y),E})}}async tuneInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI()){let m=Hf(e,e);return a=Z("tuningJobs",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(h=>{let C=h;return C.sdkHttpResponse={headers:f.headers},C})),o.then(f=>Bs(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let o,a="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let m=$f(e);return a=Z("tunedModels",m._url),d=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(h=>{let C=h;return C.sdkHttpResponse={headers:f.headers},C})),o.then(f=>n_(f))}}};var Ls=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},i_=1024*1024*8,o_=3,r_=1e3,s_=2,io="x-goog-upload-status";async function a_(i,e,t){var n;let o=await _d(i,e,t),a=await o?.json();if(((n=o?.headers)===null||n===void 0?void 0:n[io])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return a.file}async function l_(i,e,t){var n;let o=await _d(i,e,t),a=await o?.json();if(((n=o?.headers)===null||n===void 0?void 0:n[io])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let d=Bc(a),m=new ls;return Object.assign(m,d),m}async function _d(i,e,t){var n,o;let a=0,d=0,m=new Un(new Response),f="upload";for(a=i.size;d<a;){let h=Math.min(i_,a-d),C=i.slice(d,d+h);d+h>=a&&(f+=", finalize");let y=0,E=r_;for(;y<o_&&(m=await t.request({path:"",body:C,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(d),"Content-Length":String(h)}}}),!(!((n=m?.headers)===null||n===void 0)&&n[io]));)y++,await d_(E),E=E*s_;if(d+=h,((o=m?.headers)===null||o===void 0?void 0:o[io])!=="active")break;if(a<=d)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return m}async function c_(i){return{size:i.size,type:i.type}}function d_(i){return new Promise(e=>setTimeout(e,i))}var Gs=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await a_(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await l_(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await c_(e)}};var Us=class{create(e,t,n){return new qs(e,t,n)}},qs=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var Oc="x-goog-api-key",$s=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(Oc)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Oc,this.apiKey)}}};var u_="gl-node/",oo=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Ve({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=Vu(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let o=new $s(this.apiKey);this.apiClient=new vs({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:u_+"web",uploader:new Gs,downloader:new Ls}),this.models=new Es(this.apiClient),this.live=new Ss(this.apiClient,o,new Us),this.batches=new us(this.apiClient),this.chats=new ps(this.models,this.apiClient),this.caches=new ms(this.apiClient),this.files=new hs(this.apiClient),this.operations=new As(this.apiClient),this.authTokens=new Ds(this.apiClient),this.tunings=new Vs(this.apiClient),this.fileSearchStores=new Ts(this.apiClient)}};var lo=class i{constructor(){this.genAI=null;this.apiKey="";this.ipc=O(ye);this.isInitialized=!1;this.loadApiKeyFromBackend()}loadApiKeyFromBackend(){let e=localStorage.getItem("ai_api_key");e&&this.setApiKeyInternal(e),this.ipc.on("ai-settings-loaded",t=>{t?.geminiApiKey&&(this.setApiKeyInternal(t.geminiApiKey),localStorage.setItem("ai_api_key",t.geminiApiKey),console.log("[GeminiService] API key loaded from backend"))}),this.ipc.send("get-ai-settings",{}),setTimeout(()=>{this.isConfigured()||console.warn("Gemini API Key not found. AI features will be disabled until configured.")},2e3)}setApiKeyInternal(e){e&&(this.apiKey=e,this.genAI=new oo({apiKey:e}),this.isInitialized=!0)}setApiKey(e){e&&(this.setApiKeyInternal(e),localStorage.setItem("ai_api_key",e),this.ipc.send("save-ai-settings",{geminiApiKey:e}),console.log("[GeminiService] API key configured and saved to backend"))}isConfigured(){return this.genAI!==null&&this.apiKey.length>0}getApiKey(){return this.apiKey}async generateOutreachMessage(e,t){if(!this.genAI)throw new Error("Gemini API is not initialized. Please ensure the API_KEY environment variable is set.");let n="gemini-2.5-flash",o="You are an expert marketing assistant for a tool called TG-AI\u667A\u63A7\u738B. You write friendly, professional, and short direct messages (DMs). Do not use markdown formatting. Just return the plain text of the message.",a=`
      A user was found in the Telegram group "${e.sourceGroup}" because they mentioned the keyword "${e.triggeredKeyword}".
      Their username is @${e.username}.

      Based on the following instruction, write a direct message to this user.

      Instruction: "${t}"
    `;try{return(await this.genAI.models.generateContent({model:n,contents:a,config:{systemInstruction:o}})).text}catch(d){throw console.error("Error generating content with Gemini:",d),new Error("Failed to generate message. Check console for details.")}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var $n=class i{constructor(){this.ipcService=O(ye)}downloadExcelTemplate(){this.ipcService.send("download-excel-template")}loadAccountsFromExcel(){this.ipcService.send("load-accounts-from-excel")}reloadSessionsAndAccounts(){this.ipcService.send("reload-sessions-and-accounts")}exportLeadsToExcel(e){this.ipcService.send("export-leads-to-excel",JSON.parse(JSON.stringify(e)))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac})}};var m_=(i,e)=>e.id,p_=(i,e)=>e.label;function g_(i,e){if(i&1&&(P(0,"div",6),l(1),N()),i&2){let t=g().$implicit;c(),A(t.title)}}function h_(i,e){if(i&1){let t=M();P(0,"button",12),oe("click",function(){v(t);let o=g().$implicit,a=g();return b(a.handleNextStep(o))}),P(1,"span"),l(2,"\u2192"),N(),P(3,"span",13),l(4),N()()}if(i&2){let t=g().$implicit;c(4),A(t.nextStep.label)}}function f_(i,e){if(i&1){let t=M();P(0,"button",15),oe("click",function(){let o=v(t).$implicit,a=g(2).$implicit,d=g();return b(d.handleAction(a,o))}),l(1),N()}if(i&2){let t=e.$implicit;I("bg-white",t.variant==="primary")("text-slate-900",t.variant==="primary")("hover:bg-white/90",t.variant==="primary")("bg-white/20",t.variant==="secondary"||!t.variant)("text-white",t.variant==="secondary"||!t.variant)("hover:bg-white/30",t.variant==="secondary"||!t.variant)("bg-red-600",t.variant==="danger")("text-white",t.variant==="danger")("hover:bg-red-700",t.variant==="danger"),c(),D(" ",t.label," ")}}function __(i,e){if(i&1&&(P(0,"div",9),$(1,f_,2,19,"button",14,p_),N()),i&2){let t=g().$implicit;c(),H(t.actions)}}function C_(i,e){if(i&1){let t=M();P(0,"button",16),oe("click",function(){v(t);let o=g().$implicit,a=g();return b(a.dismiss(o.id))}),ne(),P(1,"svg",17),Ge(2,"path",18),N()()}}function v_(i,e){if(i&1&&(P(0,"div",11),Ge(1,"div",19),N()),i&2){let t=g().$implicit;c(),X("width",t.progress,"%")}}function b_(i,e){if(i&1&&(P(0,"div",2)(1,"div",3)(2,"div",4),l(3),N(),P(4,"div",5),S(5,g_,2,1,"div",6),P(6,"div",7),l(7),N(),S(8,h_,5,1,"button",8),S(9,__,3,0,"div",9),N(),S(10,C_,3,0,"button",10),N(),S(11,v_,2,2,"div",11),N()),i&2){let t=e.$implicit,n=g();I("bg-emerald-500/95",t.type==="success")("bg-red-500/95",t.type==="error")("bg-amber-500/95",t.type==="warning")("bg-blue-500/95",t.type==="info")("bg-slate-700/95",t.type==="progress")("border-emerald-400/50",t.type==="success")("border-red-400/50",t.type==="error")("border-amber-400/50",t.type==="warning")("border-blue-400/50",t.type==="info")("border-slate-600/50",t.type==="progress"),c(3),D(" ",t.icon||n.getDefaultIcon(t.type)," "),c(2),w(t.title?5:-1),c(2),D(" ",t.message," "),c(),w(t.nextStep?8:-1),c(),w(t.actions&&t.actions.length>0?9:-1),c(),w(t.dismissible!==!1?10:-1),c(),w(t.type==="progress"&&t.progress!==void 0?11:-1)}}var co=class i{constructor(){this.toastService=O(ue)}get toasts(){return this.toastService.getToasts()}getDefaultIcon(e){return{success:"\u2705",error:"\u274C",warning:"\u26A0\uFE0F",info:"\u2139\uFE0F",progress:"\u23F3"}[e]||"\u2139\uFE0F"}dismiss(e){this.toastService.dismiss(e)}handleNextStep(e){e.nextStep&&(e.nextStep.action(),this.dismiss(e.id))}handleAction(e,t){t.handler(),this.dismiss(e.id)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-toast"]],decls:3,vars:0,consts:[[1,"fixed","top-4","right-4","z-[9999]","space-y-3","max-w-md"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden",3,"bg-emerald-500/95","bg-red-500/95","bg-amber-500/95","bg-blue-500/95","bg-slate-700/95","border-emerald-400/50","border-red-400/50","border-amber-400/50","border-blue-400/50","border-slate-600/50"],[1,"toast-item","rounded-xl","shadow-2xl","backdrop-blur-md","border","animate-slide-in","overflow-hidden"],[1,"flex","items-start","gap-3","p-4"],[1,"flex-shrink-0","text-xl"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-white","mb-0.5"],[1,"text-white","text-sm"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors"],[1,"flex","items-center","gap-2","mt-3"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1"],[1,"h-1","bg-slate-600"],[1,"mt-2","text-xs","text-white/90","hover:text-white","flex","items-center","gap-1","transition-colors",3,"click"],[1,"underline"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"bg-white","text-slate-900","hover:bg-white/90","bg-white/20","text-white","hover:bg-white/30","bg-red-600","hover:bg-red-700"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-all",3,"click"],[1,"flex-shrink-0","text-white/60","hover:text-white","transition-colors","p-1","-mr-1","-mt-1",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"h-full","bg-gradient-to-r","from-cyan-500","to-blue-500","transition-all","duration-300"]],template:function(t,n){t&1&&(P(0,"div",0),$(1,b_,12,27,"div",1,m_),N()),t&2&&(c(),H(n.toasts()))},dependencies:[te],styles:["@keyframes _ngcontent-%COMP%_slide-in{0%{transform:translate(100%) scale(.95);opacity:0}to{transform:translate(0) scale(1);opacity:1}}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in .3s cubic-bezier(.34,1.56,.64,1)}"]})}};function x_(i,e){i&1&&(r(0,"span",5),l(1,"\u2139\uFE0F"),s())}function y_(i,e){i&1&&(r(0,"span",6),l(1,"\u26A0\uFE0F"),s())}function S_(i,e){i&1&&(r(0,"span",7),l(1,"\u{1F5D1}\uFE0F"),s())}function w_(i,e){if(i&1&&(r(0,"li",18),k(1,"span",20),r(2,"span",21),l(3),s()()),i&2){let t=e.$implicit,n=g(3);c(),I("bg-yellow-500",n.dialogService.state().type==="warning")("bg-red-500",n.dialogService.state().type==="danger")("bg-blue-500",n.dialogService.state().type==="info"),c(2),A(t)}}function E_(i,e){if(i&1&&(r(0,"li",19),l(1),s()),i&2){let t=g(3);c(),D("...\u9084\u6709 ",t.dialogService.state().affectedItems.length-5," \u9805")}}function A_(i,e){if(i&1&&(r(0,"div",11)(1,"p",16),l(2,"\u5C07\u6703\u53D7\u5230\u5F71\u97FF:"),s(),r(3,"ul",17),$(4,w_,4,7,"li",18,Pe),S(6,E_,2,1,"li",19),s()()),i&2){let t=g(2);c(4),H(t.dialogService.state().affectedItems.slice(0,5)),c(2),w(t.dialogService.state().affectedItems.length>5?6:-1)}}function D_(i,e){if(i&1){let t=M();r(0,"div",12)(1,"p",16),l(2," \u8F38\u5165\u300C"),r(3,"span",22),l(4),s(),l(5,"\u300D\u4EE5\u78BA\u8A8D "),s(),r(6,"input",23),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.confirmTextInput,o)||(a.confirmTextInput=o),b(o)}),s()()}if(i&2){let t=g(2);c(4),A(t.dialogService.state().confirmTextRequired),c(2),z("ngModel",t.confirmTextInput)}}function M_(i,e){if(i&1){let t=M();r(0,"div",0)(1,"div",1),x("click",function(){v(t);let o=g();return b(o.dialogService.onCancel())}),s(),r(2,"div",2)(3,"div",3)(4,"div",4),S(5,x_,2,0,"span",5)(6,y_,2,0,"span",6)(7,S_,2,0,"span",7),s()(),r(8,"div",8)(9,"h3",9),l(10),s(),r(11,"p",10),l(12),s(),S(13,A_,7,1,"div",11),S(14,D_,7,2,"div",12),s(),r(15,"div",13)(16,"button",14),x("click",function(){v(t);let o=g();return b(o.dialogService.onCancel())}),l(17),s(),r(18,"button",15),x("click",function(){v(t);let o=g();return b(o.onConfirmClick())}),l(19),s()()()()}if(i&2){let t,n=g();c(4),I("bg-blue-500/20",n.dialogService.state().type==="info")("bg-yellow-500/20",n.dialogService.state().type==="warning")("bg-red-500/20",n.dialogService.state().type==="danger"),c(),w((t=n.dialogService.state().type)==="info"?5:t==="warning"?6:t==="danger"?7:-1),c(5),A(n.dialogService.state().title),c(2),A(n.dialogService.state().message),c(),w(n.dialogService.state().affectedItems&&n.dialogService.state().affectedItems.length>0?13:-1),c(),w(n.dialogService.state().requireConfirmText?14:-1),c(3),D(" ",n.dialogService.state().cancelText," "),c(),I("bg-blue-500",n.dialogService.state().type==="info")("hover:bg-blue-600",n.dialogService.state().type==="info")("bg-yellow-500",n.dialogService.state().type==="warning")("hover:bg-yellow-600",n.dialogService.state().type==="warning")("text-black",n.dialogService.state().type==="warning")("bg-red-500",n.dialogService.state().type==="danger")("hover:bg-red-600",n.dialogService.state().type==="danger")("text-white",n.dialogService.state().type!=="warning"),V("disabled",!n.canConfirm()),c(),D(" ",n.dialogService.state().confirmText," ")}}var uo=class i{constructor(){this.dialogService=O(Sa);this.confirmTextInput=""}canConfirm(){let e=this.dialogService.state();return e.requireConfirmText?this.confirmTextInput===e.confirmTextRequired:!0}onConfirmClick(){this.canConfirm()&&(this.confirmTextInput="",this.dialogService.onConfirm())}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-global-confirm-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"pt-6","text-center"],[1,"inline-flex","w-16","h-16","rounded-full","items-center","justify-center","text-3xl"],[1,"text-blue-400"],[1,"text-yellow-400"],[1,"text-red-400"],[1,"p-6","text-center"],[1,"text-lg","font-semibold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-4","whitespace-pre-line"],[1,"mt-4","p-3","bg-slate-700/50","rounded-lg","text-left","max-h-32","overflow-y-auto"],[1,"mt-4"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","rounded-lg","transition-colors","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-xs","text-slate-500","mb-2"],[1,"space-y-1"],[1,"text-sm","text-slate-300","flex","items-center","gap-2"],[1,"text-xs","text-slate-500"],[1,"w-1.5","h-1.5","rounded-full","flex-shrink-0"],[1,"truncate"],[1,"text-red-400","font-medium"],["type","text","placeholder","\u8ACB\u8F38\u5165\u78BA\u8A8D\u6587\u5B57",1,"w-full","px-3","py-2","bg-slate-700","border","border-slate-600","rounded-lg","text-white","text-center","focus:border-red-500","focus:outline-none",3,"ngModelChange","ngModel"]],template:function(t,n){t&1&&S(0,M_,20,30,"div",0),t&2&&w(n.dialogService.state().isOpen?0:-1)},dependencies:[te,me,xe,_e,Ce],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};var mo=class i{constructor(e,t){this.ipc=e;this.ngZone=t;this.allEvents$=new Wn;this.connectionState$=new ta("disconnected");this.recentEvents=[];this.maxRecentEvents=100;this.eventCounts=new Map;this.listenerCleanup=null;this.initialize()}async initialize(){try{await this.ipc.invoke("events:register-receiver"),this.setupEventListener(),await this.fetchHistory(),this.connectionState$.next("connected"),console.log("[RealtimeEvents] Initialized successfully")}catch(e){console.error("[RealtimeEvents] Initialization failed:",e),this.connectionState$.next("disconnected")}}setupEventListener(){window.electronAPI?.onEvent&&window.electronAPI.onEvent(e=>{this.ngZone.run(()=>{this.handleIncomingEvent(e)})})}handleIncomingEvent(e){this.recentEvents.push(e),this.recentEvents.length>this.maxRecentEvents&&this.recentEvents.shift();let t=this.eventCounts.get(e.type)||0;this.eventCounts.set(e.type,t+1),this.allEvents$.next(e),console.log(`[RealtimeEvents] Received: ${e.type}`,e.data)}async fetchHistory(){try{let e=await this.ipc.invoke("events:get-history",{limit:50});e&&Array.isArray(e)&&(this.recentEvents=e)}catch(e){console.error("[RealtimeEvents] Failed to fetch history:",e)}}events(){return this.allEvents$.asObservable()}on(e){return this.allEvents$.pipe(lr(t=>t.type===e))}onAny(e){return this.allEvents$.pipe(lr(t=>e.includes(t.type)))}onAlerts(){return this.onAny(["alert.new","alert.resolved","alert.cleared"])}onCapacity(){return this.onAny(["capacity.warning","capacity.critical","capacity.normal"])}onApiStatus(){return this.onAny(["api.added","api.removed","api.disabled","api.recovered","api.exhausted"])}onLogin(){return this.onAny(["login.success","login.failed","login.batch_complete"])}getConnectionState(){return this.connectionState$.asObservable()}getRecentEvents(e=20){return this.recentEvents.slice(-e)}getRecentByType(e,t=10){return this.recentEvents.filter(n=>n.type===e).slice(-t)}getStats(){return Array.from(this.eventCounts.entries()).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count)}async refreshHistory(){await this.fetchHistory()}ngOnDestroy(){this.listenerCleanup&&this.listenerCleanup(),this.allEvents$.complete()}static{this.\u0275fac=function(t){return new(t||i)(Ke(ye),Ke(We))}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Cd=(i,e)=>e.id;function T_(i,e){if(i&1){let t=M();P(0,"div",4),oe("click",function(){let o=v(t).$implicit,a=g();return b(a.handleClick(o))}),P(1,"div",5),l(2),N(),P(3,"div",6)(4,"div",7),l(5),N(),P(6,"div",8),l(7),N(),P(8,"div",9),l(9),N()(),P(10,"button",10),oe("click",function(o){let a=v(t).$implicit,d=g();return b(d.dismiss(a,o))}),l(11,"\xD7"),N()()}if(i&2){let t=e.$implicit,n=g();de("level-"+t.level),V("@slideIn",void 0),c(2),A(n.getIcon(t.level)),c(3),A(t.title),c(2),A(t.message),c(2),A(n.formatTime(t.timestamp))}}function k_(i,e){if(i&1){let t=M();P(0,"div",11),oe("click",function(){v(t);let o=g();return b(o.togglePanel())}),P(1,"span",12),l(2,"\u{1F514}"),N(),P(3,"span",13),l(4),N()()}if(i&2){let t=g();c(4),A(t.unreadCount())}}function I_(i,e){i&1&&(P(0,"div",18),l(1,"\u6682\u65E0\u544A\u8B66"),N())}function P_(i,e){if(i&1&&(P(0,"div",21)(1,"span",22),l(2),N(),P(3,"div",23)(4,"div",24),l(5),N(),P(6,"div",25),l(7),N()()()),i&2){let t=e.$implicit,n=g(2);de("level-"+t.level),c(2),A(n.getIcon(t.level)),c(3),A(t.title),c(2),A(n.formatTime(t.timestamp))}}function F_(i,e){if(i&1){let t=M();P(0,"div",14),oe("click",function(o){return v(t),b(o.stopPropagation())}),P(1,"div",15)(2,"h4"),l(3,"\u7CFB\u7EDF\u544A\u8B66"),N(),P(4,"button",16),oe("click",function(){v(t);let o=g();return b(o.markAllRead())}),l(5,"\u5168\u90E8\u5DF2\u8BFB"),N()(),P(6,"div",17),S(7,I_,2,0,"div",18),$(8,P_,8,5,"div",19,Cd),N(),P(10,"div",20)(11,"a",16),oe("click",function(){v(t);let o=g();return b(o.goToAlerts())}),l(12,"\u67E5\u770B\u5168\u90E8 \u2192"),N()()()}if(i&2){let t=g();c(7),w(t.allNotifications().length===0?7:-1),c(),H(t.allNotifications().slice(0,5))}}var po=class i{constructor(){this.ipcService=O(ye);this.realtimeEvents=O(mo);this.allNotifications=_([]);this.visibleNotifications=_([]);this.unreadCount=_(0);this.showPanel=_(!1);this.isConnected=_(!1);this.eventSubscription=null;this.dismissTimeouts=new Map}ngOnInit(){this.loadAlerts(),this.subscribeToEvents(),this.pollInterval=setInterval(()=>this.loadAlerts(),3e4),document.addEventListener("click",this.closePanel.bind(this))}ngOnDestroy(){this.eventSubscription&&this.eventSubscription.unsubscribe(),this.pollInterval&&clearInterval(this.pollInterval),document.removeEventListener("click",this.closePanel.bind(this)),this.dismissTimeouts.forEach(e=>clearTimeout(e))}subscribeToEvents(){this.eventSubscription=this.realtimeEvents.onAlerts().subscribe({next:e=>{this.handleRealtimeEvent(e)},error:e=>{console.error("[AlertNotification] Realtime subscription error:",e)}}),this.realtimeEvents.getConnectionState().subscribe(e=>{this.isConnected.set(e==="connected")})}handleRealtimeEvent(e){switch(console.log("[AlertNotification] Received realtime event:",e.type),e.type){case"alert.new":let t=e.data,n={id:t.id||e.id,type:t.type||"system",level:t.level||"warning",title:t.title||"\u7CFB\u7EDF\u544A\u8B66",message:t.message||"",timestamp:e.timestamp,dismissed:!1},o=this.allNotifications();o.find(d=>d.id===n.id)||(this.allNotifications.set([n,...o]),this.unreadCount.update(d=>d+1),this.showNotification(n));break;case"alert.resolved":let a=e.data.alert_id;this.allNotifications.update(d=>d.filter(m=>m.id!==a));break;case"alert.cleared":this.allNotifications.set([]),this.unreadCount.set(0);break}}async loadAlerts(){try{let e=await this.ipcService.invoke("alerts:get",{});if(e?.success){let t=e.data?.active||[];if(!this.isConnected()){let n=new Set(this.allNotifications().map(a=>a.id)),o=t.filter(a=>!n.has(a.id));for(let a of o)this.showNotification(a)}this.allNotifications.set(t),this.unreadCount.set(t.filter(n=>!n.dismissed).length)}}catch(e){console.error("Load alerts failed:",e)}}showNotification(e){let t=this.visibleNotifications();t.length>=3&&this.dismiss(t[0]),this.visibleNotifications.set([...t,e]);let n=this.getDismissDuration(e.level);if(n>0){let o=setTimeout(()=>this.dismiss(e),n);this.dismissTimeouts.set(e.id,o)}}getDismissDuration(e){return{info:5e3,warning:8e3,critical:15e3,urgent:0}[e]??8e3}dismiss(e,t){t&&t.stopPropagation();let n=this.dismissTimeouts.get(e.id);n&&(clearTimeout(n),this.dismissTimeouts.delete(e.id)),this.visibleNotifications.set(this.visibleNotifications().filter(o=>o.id!==e.id))}handleClick(e){this.dismiss(e),this.goToAlerts()}togglePanel(){this.showPanel.set(!this.showPanel())}closePanel(){this.showPanel.set(!1)}async markAllRead(){try{await this.ipcService.send("alerts:mark-read",{}),this.unreadCount.set(0)}catch(e){console.error("Mark all read failed:",e)}}goToAlerts(){window.dispatchEvent(new CustomEvent("changeView",{detail:"admin/alerts"})),this.closePanel()}getIcon(e){return{urgent:"\u{1F6A8}",critical:"\u26D4",warning:"\u26A0\uFE0F",info:"\u2139\uFE0F"}[e]||"\u{1F514}"}formatTime(e){let t=new Date(e*1e3),o=(new Date().getTime()-t.getTime())/1e3;return o<60?"\u521A\u521A":o<3600?`${Math.floor(o/60)} \u5206\u949F\u524D`:o<86400?`${Math.floor(o/3600)} \u5C0F\u65F6\u524D`:t.toLocaleDateString()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-alert-notification"]],decls:5,vars:2,consts:[[1,"notification-container"],[1,"notification",3,"class"],[1,"alert-badge"],[1,"quick-panel"],[1,"notification",3,"click"],[1,"notification-icon"],[1,"notification-content"],[1,"notification-title"],[1,"notification-message"],[1,"notification-time"],[1,"notification-close",3,"click"],[1,"alert-badge",3,"click"],[1,"badge-icon"],[1,"badge-count"],[1,"quick-panel",3,"click"],[1,"panel-header"],[3,"click"],[1,"panel-content"],[1,"panel-empty"],[1,"panel-item",3,"class"],[1,"panel-footer"],[1,"panel-item"],[1,"item-icon"],[1,"item-content"],[1,"item-title"],[1,"item-time"]],template:function(t,n){t&1&&(P(0,"div",0),$(1,T_,12,7,"div",1,Cd),N(),S(3,k_,5,1,"div",2),S(4,F_,13,1,"div",3)),t&2&&(c(),H(n.visibleNotifications()),c(2),w(n.unreadCount()>0?3:-1),c(),w(n.showPanel()?4:-1))},dependencies:[te],styles:[".notification-container[_ngcontent-%COMP%]{position:fixed;top:1rem;right:1rem;z-index:10000;display:flex;flex-direction:column;gap:.75rem;max-width:400px;pointer-events:none}.notification[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;padding:1rem;background:#1e293bfa;border-radius:.75rem;box-shadow:0 4px 20px #0000004d;border-left:4px solid #6b7280;pointer-events:auto;cursor:pointer;animation:_ngcontent-%COMP%_slideIn .3s ease-out;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}.notification.level-urgent[_ngcontent-%COMP%]{border-left-color:#ef4444;background:#ef444426;animation:_ngcontent-%COMP%_slideIn .3s ease-out,_ngcontent-%COMP%_urgentPulse 2s infinite}@keyframes _ngcontent-%COMP%_urgentPulse{0%,to{box-shadow:0 4px 20px #ef44444d}50%{box-shadow:0 4px 30px #ef444480}}.notification.level-critical[_ngcontent-%COMP%]{border-left-color:#f97316;background:#f9731626}.notification.level-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.notification.level-info[_ngcontent-%COMP%]{border-left-color:#3b82f6}.notification-icon[_ngcontent-%COMP%]{font-size:1.5rem;flex-shrink:0}.notification-content[_ngcontent-%COMP%]{flex:1;min-width:0}.notification-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#f1f5f9;margin-bottom:.25rem}.notification-message[_ngcontent-%COMP%]{font-size:.8rem;color:#d1d5db;line-height:1.4}.notification-time[_ngcontent-%COMP%]{font-size:.7rem;color:#6b7280;margin-top:.375rem}.notification-close[_ngcontent-%COMP%]{background:transparent;border:none;color:#6b7280;font-size:1.25rem;cursor:pointer;padding:0;line-height:1;transition:color .2s}.notification-close[_ngcontent-%COMP%]:hover{color:#f1f5f9}.alert-badge[_ngcontent-%COMP%]{position:fixed;top:1rem;right:1rem;z-index:9999;display:flex;align-items:center;gap:.25rem;padding:.5rem .75rem;background:#ef4444e6;border-radius:2rem;cursor:pointer;box-shadow:0 2px 10px #ef444466;animation:_ngcontent-%COMP%_badgePulse 2s infinite}@keyframes _ngcontent-%COMP%_badgePulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.badge-icon[_ngcontent-%COMP%]{font-size:1rem}.badge-count[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#fff}.quick-panel[_ngcontent-%COMP%]{position:fixed;top:4rem;right:1rem;z-index:9998;width:320px;background:#1e293bfa;border-radius:.75rem;box-shadow:0 4px 20px #0000004d;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1)}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid rgba(255,255,255,.1)}.panel-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:#f1f5f9}.panel-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent;border:none;color:#3b82f6;font-size:.75rem;cursor:pointer}.panel-content[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.panel-empty[_ngcontent-%COMP%]{padding:2rem;text-align:center;color:#6b7280;font-size:.875rem}.panel-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;border-left:3px solid #6b7280;cursor:pointer;transition:background .2s}.panel-item[_ngcontent-%COMP%]:hover{background:#ffffff0d}.panel-item.level-urgent[_ngcontent-%COMP%]{border-left-color:#ef4444}.panel-item.level-critical[_ngcontent-%COMP%]{border-left-color:#f97316}.panel-item.level-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.panel-item.level-info[_ngcontent-%COMP%]{border-left-color:#3b82f6}.item-icon[_ngcontent-%COMP%]{font-size:1rem}.item-content[_ngcontent-%COMP%]{flex:1;min-width:0}.item-title[_ngcontent-%COMP%]{font-size:.8rem;color:#f1f5f9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-time[_ngcontent-%COMP%]{font-size:.7rem;color:#6b7280}.panel-footer[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid rgba(255,255,255,.1);text-align:center}.panel-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3b82f6;font-size:.8rem;cursor:pointer}.panel-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})}};var N_=["inputRef"];function R_(i,e){if(i&1&&(r(0,"p",6),l(1),s()),i&2){let t,n=g(2);c(),A((t=n.dialogService.inputDialog())==null?null:t.message)}}function O_(i,e){if(i&1){let t=M();r(0,"textarea",14,0),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.inputValue,o)||(a.inputValue=o),b(o)}),x("keydown.enter",function(o){v(t);let a=g(2);return b(a.onEnterKey(o))}),l(2,"              "),s()}if(i&2){let t,n=g(2);z("ngModel",n.inputValue),V("placeholder",((t=n.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function B_(i,e){if(i&1){let t=M();r(0,"input",15,0),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.inputValue,o)||(a.inputValue=o),b(o)}),x("keydown.enter",function(o){v(t);let a=g(2);return b(a.onEnterKey(o))}),s()}if(i&2){let t,n=g(2);z("ngModel",n.inputValue),V("placeholder",((t=n.dialogService.inputDialog())==null?null:t.placeholder)||"\u8ACB\u8F38\u5165...")}}function V_(i,e){if(i&1&&(r(0,"p",10)(1,"span"),l(2,"\u26A0\uFE0F"),s(),l(3),s()),i&2){let t=g(2);c(3),D(" ",t.dialogService.inputDialogError()," ")}}function L_(i,e){if(i&1){let t=M();r(0,"div",1)(1,"div",2),x("click",function(){v(t);let o=g();return b(o.cancelDialog())}),s(),r(2,"div",3)(3,"div",4)(4,"h3",5)(5,"span"),l(6,"\u270F\uFE0F"),s(),l(7),s(),S(8,R_,2,1,"p",6),s(),r(9,"div",7),x("click",function(o){v(t);let a=g();return b(a.focusInput(o))}),S(10,O_,3,2,"textarea",8)(11,B_,2,2,"input",9),S(12,V_,4,1,"p",10),s(),r(13,"div",11)(14,"button",12),x("click",function(){v(t);let o=g();return b(o.cancelDialog())}),l(15),s(),r(16,"button",13),x("click",function(){v(t);let o=g();return b(o.confirmWithValue())}),l(17),s()()()()}if(i&2){let t,n,o,a,d,m=g();c(7),D(" ",(t=m.dialogService.inputDialog())==null?null:t.title," "),c(),w((n=m.dialogService.inputDialog())!=null&&n.message?8:-1),c(2),w(((o=m.dialogService.inputDialog())==null?null:o.inputType)==="textarea"?10:11),c(2),w(m.dialogService.inputDialogError()?12:-1),c(3),D(" ",((a=m.dialogService.inputDialog())==null?null:a.cancelText)||"\u53D6\u6D88"," "),c(2),D(" ",((d=m.dialogService.inputDialog())==null?null:d.confirmText)||"\u78BA\u5B9A"," ")}}var go=class i{constructor(){this.dialogService=O(bt);this.inputValue="";this.lastDialogState=!1}ngAfterViewChecked(){let e=!!this.dialogService.inputDialog();e&&!this.lastDialogState&&(this.inputValue=this.dialogService.inputDialog()?.defaultValue||"",setTimeout(()=>this.focusInput(),100),setTimeout(()=>this.focusInput(),300)),!e&&this.lastDialogState&&(this.inputValue=""),this.lastDialogState=e}focusInput(e){e&&e.stopPropagation(),this.inputRef?.nativeElement&&(this.inputRef.nativeElement.focus(),console.log("[InputDialog] Focus requested"))}onEnterKey(e){this.dialogService.inputDialog()?.inputType!=="textarea"&&(e.preventDefault(),this.confirmWithValue())}confirmWithValue(){this.dialogService.updateInputValue(this.inputValue),this.dialogService.confirmInput()}cancelDialog(){this.inputValue="",this.dialogService.cancelInput()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-global-input-dialog"]],viewQuery:function(t,n){if(t&1&&Qn(N_,5),t&2){let o;Mn(o=Tn())&&(n.inputRef=o.first)}},decls:1,vars:1,consts:[["inputRef",""],[1,"fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-4"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm","animate-fade-in",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","transform","animate-scale-in"],[1,"p-6","pb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"text-sm","text-slate-400","mt-2"],[1,"px-6","pb-4",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModel","placeholder"],[1,"mt-2","text-sm","text-red-400","flex","items-center","gap-1"],[1,"flex","gap-3","p-4","border-t","border-slate-700"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","bg-purple-500","hover:bg-purple-600","text-white","rounded-lg","transition-colors","font-medium",3,"click"],["rows","4",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","resize-none","transition-all",3,"ngModelChange","keydown.enter","ngModel","placeholder"],["type","text",1,"w-full","px-4","py-3","bg-slate-700","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:outline-none","focus:ring-2","focus:ring-purple-500/20","transition-all","cursor-text",3,"ngModelChange","keydown.enter","ngModel","placeholder"]],template:function(t,n){t&1&&S(0,L_,18,6,"div",1),t&2&&w(n.dialogService.inputDialog()?0:-1)},dependencies:[te,me,xe,_e,Ce],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}"]})}};function G_(i,e){if(i&1&&(P(0,"p",9),l(1),N()),i&2){let t=g(2);c(),A(t.progressSignal().itemName)}}function U_(i,e){if(i&1&&(P(0,"p",6),l(1),N()),i&2){let t=g(2);c(),A(t.progressSignal().message)}}function q_(i,e){if(i&1){let t=M();P(0,"button",11),oe("click",function(){v(t);let o=g(2);return b(o.onCancel())}),l(1," \u53D6\u6D88 "),N()}}function $_(i,e){if(i&1&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),l(4),N(),P(5,"div",4)(6,"div",5)(7,"span",6),l(8),N(),P(9,"span",6),l(10),N()(),P(11,"div",7),Ge(12,"div",8),N()(),S(13,G_,2,1,"p",9),S(14,U_,2,1,"p",6),S(15,q_,2,0,"button",10),N()()()),i&2){let t=g();c(4),A(t.titleSignal()),c(4),Y("",t.progressSignal().current," / ",t.progressSignal().total),c(2),D("",t.percentage(),"%"),c(2),X("width",t.percentage(),"%"),c(),w(t.progressSignal().itemName?13:-1),c(),w(t.progressSignal().message?14:-1),c(),w(t.cancellableSignal()?15:-1)}}var ho=class i{constructor(){this._show=_(!1);this._title=_("\u5904\u7406\u4E2D...");this._progress=_({current:0,total:0});this._cancellable=_(!1);this.showSignal=G(()=>this._show());this.titleSignal=G(()=>this._title());this.progressSignal=G(()=>this._progress());this.cancellableSignal=G(()=>this._cancellable());this.percentage=G(()=>{let e=this._progress();return e.total>0?Math.round(e.current/e.total*100):0})}set show(e){this._show.set(e)}set title(e){this._title.set(e)}set progress(e){this._progress.set(e)}set cancellable(e){this._cancellable.set(e)}onCancel(){this.onCancelCallback&&this.onCancelCallback()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-progress-dialog"]],inputs:{show:"show",title:"title",progress:"progress",cancellable:"cancellable",onCancelCallback:"onCancelCallback"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","z-50","flex","items-center","justify-center"],[1,"bg-slate-800/90","dark:bg-slate-900/90","rounded-lg","p-6","shadow-xl","border","border-slate-700","min-w-[400px]"],[1,"flex","flex-col","gap-4"],[1,"text-lg","font-semibold","text-slate-200"],[1,"w-full"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-sm","text-slate-300"],[1,"w-full","bg-slate-700","rounded-full","h-3","overflow-hidden"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","h-full","transition-all","duration-300","ease-out"],[1,"text-sm","text-slate-400","text-center"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm"],[1,"mt-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","font-bold","py-2","px-4","rounded-lg","transition","duration-200","text-sm",3,"click"]],template:function(t,n){t&1&&S(0,$_,16,9,"div",0),t&2&&w(n.showSignal()?0:-1)},dependencies:[te],styles:[".transition-all[_ngcontent-%COMP%]{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.3s}"]})}};function H_(i,e){if(i&1&&(P(0,"span",3),l(1),N()),i&2){let t=g();c(),D(" ",t.membershipService.daysRemaining(),"\u5929 ")}}function z_(i,e){if(i&1&&(P(0,"span"),l(1),ke(2,"date"),N()),i&2){let t,n=g(3);c(),D("\u5230\u671F\u6642\u9593\uFF1A",Ht(2,1,(t=n.membershipService.membership())==null?null:t.expiresAt,"yyyy-MM-dd"))}}function K_(i,e){i&1&&(P(0,"span",19),l(1,"\u6703\u54E1\u5DF2\u904E\u671F"),N())}function W_(i,e){if(i&1&&(P(0,"div",8),S(1,z_,3,4,"span")(2,K_,2,0,"span",19),N()),i&2){let t=g(2);c(),w(t.membershipService.daysRemaining()>0?1:2)}}function J_(i,e){if(i&1){let t=M();P(0,"div",4)(1,"div",5)(2,"span",6),l(3),N(),P(4,"span",7),l(5),N()(),S(6,W_,3,1,"div",8),P(7,"div",9)(8,"div")(9,"div",10)(10,"span"),l(11,"\u4ECA\u65E5\u6D88\u606F"),N(),P(12,"span"),l(13),N()(),P(14,"div",11),Ge(15,"div",12),N()(),P(16,"div")(17,"div",10)(18,"span"),l(19,"\u4ECA\u65E5 AI"),N(),P(20,"span"),l(21),N()(),P(22,"div",11),Ge(23,"div",13),N()()(),P(24,"div",14)(25,"button",15),oe("click",function(){v(t);let o=g();return b(o.openActivate())}),l(26),N(),P(27,"button",16),oe("click",function(){v(t);let o=g();return b(o.showDetails=!1)}),ne(),P(28,"svg",17),Ge(29,"path",18),N()()()()}if(i&2){let t=g();c(3),A(t.membershipService.levelIcon()),c(2),A(t.membershipService.levelName()),c(),w(t.membershipService.level()!=="bronze"?6:-1),c(7),Y("",t.usage().todayMessages," / ",t.quotaText("messages")),c(2),X("width",t.usagePercent().messages,"%"),c(6),Y("",t.usage().todayAiCalls," / ",t.quotaText("ai")),c(2),X("width",t.usagePercent().ai,"%"),c(3),D(" ",t.membershipService.level()==="bronze"?"\u6FC0\u6D3B\u6703\u54E1":"\u7E8C\u8CBB/\u5347\u7D1A"," ")}}var Q_=(i,e)=>e.level;function Y_(i,e){i&1&&(r(0,"div",22),l(1," \u63A8\u85A6 "),s())}function X_(i,e){i&1&&(r(0,"div",23),l(1," \u7576\u524D "),s())}function Z_(i,e){i&1&&(r(0,"span",28),l(1,"\u514D\u8CBB"),s())}function j_(i,e){if(i&1&&(r(0,"span",5),l(1),s(),r(2,"span",33),l(3,"/\u6708"),s()),i&2){let t=g().$implicit;c(),D("",t.monthlyPrice," USDT")}}function e1(i,e){if(i&1&&(r(0,"div",29),l(1),s()),i&2){let t=g().$implicit,n=g(3);c(),Y(" \u5E74\u4ED8 ",t.yearlyPrice," USDT (\u7701 ",n.Math.round((1-t.yearlyPrice/(t.monthlyPrice*12))*100),"%) ")}}function t1(i,e){if(i&1&&(r(0,"li",31),ne(),r(1,"svg",34),k(2,"path",35),s(),l(3),s()),i&2){let t=e.$implicit;c(3),D(" ",t," ")}}function n1(i,e){if(i&1){let t=M();r(0,"div",21),S(1,Y_,2,0,"div",22),S(2,X_,2,0,"div",23),r(3,"div",24)(4,"span",25),l(5),s(),r(6,"h3",26),l(7),s(),r(8,"div",27),S(9,Z_,2,0,"span",28)(10,j_,4,1),s(),S(11,e1,2,2,"div",29),s(),r(12,"ul",30),$(13,t1,4,1,"li",31,Pe),s(),r(15,"button",32),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.selectPlan(o))}),l(16),s()()}if(i&2){let t=e.$implicit,n=g(3);I("border-cyan-500",t.level===n.membershipService.level())("border-slate-600",t.level!==n.membershipService.level())("bg-slate-700/50",t.level===n.membershipService.level())("bg-slate-800",t.level!==n.membershipService.level()),c(),w(t.recommended?1:-1),c(),w(t.level===n.membershipService.level()?2:-1),c(3),A(t.icon),c(2),A(t.name),c(2),w(t.monthlyPrice===0?9:10),c(2),w(t.yearlyPrice>0?11:-1),c(2),H(t.features),c(2),I("bg-gradient-to-r",t.level!=="bronze")("from-cyan-500",t.level!=="bronze")("to-blue-500",t.level!=="bronze")("text-white",t.level!=="bronze")("bg-slate-700",t.level==="bronze")("text-slate-400",t.level==="bronze"),V("disabled",t.level==="bronze"),c(),D(" ",t.level==="bronze"?"\u7576\u524D\u65B9\u6848":t.level===n.membershipService.level()?"\u7E8C\u8CBB":"\u9078\u64C7"," ")}}function i1(i,e){if(i&1&&(r(0,"div",14),$(1,n1,17,28,"div",15,Q_),s(),r(3,"div",16)(4,"h4",17),l(5,"\u{1F4B3} \u8CFC\u8CB7\u65B9\u5F0F"),s(),r(6,"p",18),l(7," \u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6\uFF0C\u6216\u901A\u904E\u5B98\u65B9\u6E20\u9053\u7372\u53D6\u3002\u8CFC\u8CB7\u5F8C\u5728\u300C\u6FC0\u6D3B\u5361\u5BC6\u300D\u6A19\u7C64\u4E2D\u8F38\u5165\u6FC0\u6D3B\u78BC\u3002 "),s(),r(8,"div",19)(9,"a",20),l(10,"\u{1F4F1} \u806F\u7E6B\u5BA2\u670D"),s(),r(11,"a",20),l(12,"\u{1F310} \u5B98\u65B9\u5546\u57CE"),s()()()),i&2){let t=g(2);c(),H(t.plans)}}function o1(i,e){if(i&1){let t=M();r(0,"div",13)(1,"div",36)(2,"div",37),l(3,"\u{1F511}"),s(),r(4,"h3",38),l(5,"\u6FC0\u6D3B\u6703\u54E1\u5361\u5BC6"),s(),r(6,"p",39),l(7,"\u8F38\u5165\u60A8\u8CFC\u8CB7\u7684\u5361\u5BC6\u6FC0\u6D3B\u6703\u54E1"),s()(),r(8,"div",40)(9,"div")(10,"label",41),l(11,"\u5361\u5BC6"),s(),r(12,"input",42),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.licenseKey,o)||(a.licenseKey=o),b(o)}),s()(),r(13,"div")(14,"label",41),l(15,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u901A\u77E5)"),s(),r(16,"input",43),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.email,o)||(a.email=o),b(o)}),s()(),r(17,"button",44),x("click",function(){v(t);let o=g(2);return b(o.activateLicense())}),l(18),s()(),r(19,"div",16)(20,"h4",17),l(21,"\u{1F4CB} \u5361\u5BC6\u683C\u5F0F\u8AAA\u660E"),s(),r(22,"ul",45)(23,"li"),l(24,"\u2022 TGAI-B2-XXXX-XXXX-XXXX (\u{1F948} \u767D\u9280\u6708\u5361)"),s(),r(25,"li"),l(26,"\u2022 TGAI-G2-XXXX-XXXX-XXXX (\u{1F947} \u9EC3\u91D1\u6708\u5361)"),s(),r(27,"li"),l(28,"\u2022 TGAI-D2-XXXX-XXXX-XXXX (\u{1F48E} \u947D\u77F3\u6708\u5361)"),s(),r(29,"li"),l(30,"\u2022 TGAI-S2-XXXX-XXXX-XXXX (\u{1F31F} \u661F\u8000\u6708\u5361)"),s(),r(31,"li"),l(32,"\u2022 TGAI-K2-XXXX-XXXX-XXXX (\u{1F451} \u738B\u8005\u6708\u5361)"),s()()()()}if(i&2){let t=g(2);c(12),z("ngModel",t.licenseKey),c(4),z("ngModel",t.email),c(),V("disabled",t.isActivating()),c(),D(" ",t.isActivating()?"\u6FC0\u6D3B\u4E2D...":"\u6FC0\u6D3B"," ")}}function r1(i,e){if(i&1){let t=M();r(0,"div",13)(1,"div",36)(2,"div",37),l(3,"\u{1F381}"),s(),r(4,"h3",38),l(5,"\u9080\u8ACB\u597D\u53CB\uFF0C\u96D9\u65B9\u7372\u76CA"),s(),r(6,"p",39),l(7,"\u5206\u4EAB\u60A8\u7684\u9080\u8ACB\u78BC\uFF0C\u9080\u8ACB\u597D\u53CB\u8A3B\u518A"),s()(),r(8,"div",46)(9,"div",47)(10,"div",48),l(11,"\u6211\u7684\u9080\u8ACB\u78BC"),s(),r(12,"div",49),l(13),s(),r(14,"button",50),x("click",function(){v(t);let o=g(2);return b(o.copyInviteCode())}),l(15," \u{1F4CB} \u8907\u88FD\u9080\u8ACB\u78BC "),s()()(),r(16,"div",51)(17,"div",52)(18,"div",53),l(19),s(),r(20,"div",54),l(21,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),s()(),r(22,"div",52)(23,"div",28),l(24),s(),r(25,"div",54),l(26,"\u7372\u5F97\u734E\u52F5"),s()()(),r(27,"div",55)(28,"h4",56),l(29,"\u{1F3AF} \u734E\u52F5\u898F\u5247"),s(),r(30,"ul",57)(31,"li",58)(32,"span",59),l(33,"\u2713"),s(),l(34," \u9080\u8ACB 1 \u4EBA\u8A3B\u518A\uFF1A\u60A8\u7372\u5F97 3 \u5929\u6703\u54E1 "),s(),r(35,"li",58)(36,"span",59),l(37,"\u2713"),s(),l(38," \u88AB\u9080\u8ACB\u4EBA\u7372\u5F97\uFF1A1 \u5929\u6703\u54E1\u9AD4\u9A57 "),s(),r(39,"li",58)(40,"span",59),l(41,"\u2713"),s(),l(42," \u88AB\u9080\u8ACB\u4EBA\u9996\u6B21\u4ED8\u8CBB\uFF1A\u7372\u5F97\u8C50\u539A\u734E\u52F5 "),s(),r(43,"li",58)(44,"span",59),l(45,"\u2713"),s(),l(46," \u88AB\u9080\u8ACB\u4EBA\u91CD\u8907\u4ED8\u8CBB\uFF1A10% \u8FD4\u50AD "),s()()(),r(47,"div",60)(48,"h4",17),l(49,"\u{1F39F}\uFE0F \u4F7F\u7528\u9080\u8ACB\u78BC"),s(),r(50,"div",61)(51,"input",62),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.inviteCodeInput,o)||(a.inviteCodeInput=o),b(o)}),s(),r(52,"button",63),x("click",function(){v(t);let o=g(2);return b(o.applyInviteCode())}),l(53," \u4F7F\u7528 "),s()()()()}if(i&2){let t,n,o,a=g(2);c(13),D(" ",(t=a.membershipService.membership())==null?null:t.inviteCode," "),c(6),A(((n=a.membershipService.membership())==null?null:n.inviteCount)||0),c(5),D("",((o=a.membershipService.membership())==null?null:o.inviteRewards)||0,"\u5929"),c(27),z("ngModel",a.inviteCodeInput)}}function s1(i,e){if(i&1){let t=M();r(0,"div",1),x("click",function(){v(t);let o=g();return b(o.close())}),r(1,"div",2),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),l(6,"\u{1F680} \u5347\u7D1A\u60A8\u7684 TG-AI\u667A\u63A7\u738B"),s(),r(7,"p",6),l(8,"\u89E3\u9396\u66F4\u591A\u529F\u80FD\uFF0C\u63D0\u5347\u71DF\u92B7\u6548\u7387"),s()(),r(9,"button",7),x("click",function(){v(t);let o=g();return b(o.close())}),ne(),r(10,"svg",8),k(11,"path",9),s()()(),ge(),r(12,"div",10)(13,"button",11),x("click",function(){v(t);let o=g();return b(o.activeTab.set("plans"))}),l(14," \u6703\u54E1\u65B9\u6848 "),s(),r(15,"button",11),x("click",function(){v(t);let o=g();return b(o.activeTab.set("activate"))}),l(16," \u6FC0\u6D3B\u5361\u5BC6 "),s(),r(17,"button",11),x("click",function(){v(t);let o=g();return b(o.activeTab.set("invite"))}),l(18," \u9080\u8ACB\u734E\u52F5 "),s()()(),r(19,"div",12),S(20,i1,13,0),S(21,o1,33,4,"div",13),S(22,r1,54,4,"div",13),s()()()}if(i&2){let t=g();c(13),I("text-white",t.activeTab()==="plans")("text-white/60",t.activeTab()!=="plans")("border-white",t.activeTab()==="plans")("border-transparent",t.activeTab()!=="plans"),c(2),I("text-white",t.activeTab()==="activate")("text-white/60",t.activeTab()!=="activate")("border-white",t.activeTab()==="activate")("border-transparent",t.activeTab()!=="activate"),c(2),I("text-white",t.activeTab()==="invite")("text-white/60",t.activeTab()!=="invite")("border-white",t.activeTab()==="invite")("border-transparent",t.activeTab()!=="invite"),c(3),w(t.activeTab()==="plans"?20:-1),c(),w(t.activeTab()==="activate"?21:-1),c(),w(t.activeTab()==="invite"?22:-1)}}function a1(i,e){if(i&1&&(P(0,"li"),l(1),N()),i&2){let t=e.$implicit;c(),D("\u2728 ",t)}}function l1(i,e){if(i&1){let t=M();P(0,"div",0)(1,"button",1),oe("click",function(){v(t);let o=g();return b(o.dismiss())}),ne(),P(2,"svg",2),Ge(3,"path",3),N()(),ge(),P(4,"div",4)(5,"div",5),l(6,"\u26A1"),N(),P(7,"div",6)(8,"h4",7),l(9),N(),P(10,"p",8),l(11),N(),P(12,"ul",9),$(13,a1,2,1,"li",null,Pe),N(),P(15,"button",10),oe("click",function(){v(t);let o=g();return b(o.upgrade())}),l(16),N()()()()}if(i&2){let t=g();c(9),A(t.message),c(2),D(" \u5347\u7D1A\u5230 ",t.nextLevelName," \u7372\u5F97\u66F4\u591A\u914D\u984D "),c(2),H(t.suggestion.benefits.slice(0,3)),c(3),D(" \u7ACB\u5373\u5347\u7D1A ",t.suggestion.price," USDT/\u6708 ")}}var vd=class i{constructor(){this.membershipService=O(Re);this.showDetails=!1;this.badgeClass=G(()=>this.membershipService.level());this.usage=G(()=>this.membershipService.usage());this.usagePercent=G(()=>this.membershipService.getUsagePercentage())}quotaText(e){let t=this.membershipService.quotas(),n=e==="messages"?t.dailyMessages:t.dailyAiCalls;return n===-1?"\u221E":n.toString()}openActivate(){this.showDetails=!1,window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-membership-badge"]],decls:7,vars:6,consts:[[1,"membership-badge","flex","items-center","gap-2","px-3","py-1.5","rounded-full","cursor-pointer","hover:opacity-80","transition-opacity",3,"click"],[1,"text-lg"],[1,"text-sm","font-medium"],[1,"text-xs","bg-red-500/50","px-1.5","py-0.5","rounded"],[1,"absolute","top-full","right-0","mt-2","w-72","bg-slate-800","rounded-lg","shadow-xl","border","border-slate-600","p-4","z-50"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-2xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-300","mb-3"],[1,"space-y-2","mb-4"],[1,"flex","justify-between","text-xs","text-slate-400","mb-1"],[1,"w-full","bg-slate-700","rounded-full","h-1.5"],[1,"bg-cyan-500","h-1.5","rounded-full","transition-all"],[1,"bg-purple-500","h-1.5","rounded-full","transition-all"],[1,"flex","gap-2"],[1,"flex-1","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","text-sm","py-2","rounded-lg","hover:opacity-90",3,"click"],[1,"px-3","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-red-400"]],template:function(t,n){t&1&&(P(0,"div",0),oe("click",function(){return n.showDetails=!n.showDetails}),P(1,"span",1),l(2),N(),P(3,"span",2),l(4),N(),S(5,H_,2,1,"span",3),N(),S(6,J_,30,12,"div",4)),t&2&&(de(n.badgeClass()),c(2),A(n.membershipService.levelIcon()),c(2),A(n.membershipService.levelName()),c(),w(n.membershipService.daysRemaining()>0&&n.membershipService.daysRemaining()<=7?5:-1),c(),w(n.showDetails?6:-1))},dependencies:[te,Xn],styles:["[_nghost-%COMP%]{position:relative;display:inline-block}.membership-badge.bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}.membership-badge.silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,silver,#a8a8a8);color:#1f2937}.membership-badge.gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:#1f2937}.membership-badge.diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b9f2ff,#87ceeb);color:#1f2937}.membership-badge.star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}.membership-badge.king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}"]})}},fo=class i{constructor(){this.membershipService=O(Re);this.toastService=O(ue);this.show=_(!1);this.activeTab=_("plans");this.isActivating=_(!1);this.licenseKey="";this.email="";this.inviteCodeInput="";this.plans=this.membershipService.getPricingPlans();this.Math=Math;window.addEventListener("open-membership-dialog",()=>{this.show.set(!0)})}close(){this.show.set(!1)}selectPlan(e){e.level!=="bronze"&&(this.activeTab.set("activate"),this.toastService.info(`\u8ACB\u8CFC\u8CB7 ${e.name} \u5361\u5BC6\u5F8C\u5728\u6B64\u6FC0\u6D3B`))}async activateLicense(){if(!this.licenseKey.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u5361\u5BC6");return}this.isActivating.set(!0);try{let e=await this.membershipService.activateMembership(this.licenseKey.trim(),this.email.trim());e.success?(this.toastService.success(e.message,5e3),this.licenseKey="",this.email="",this.close()):this.toastService.error(e.message)}catch{this.toastService.error("\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isActivating.set(!1)}}copyInviteCode(){let e=this.membershipService.membership()?.inviteCode;e&&(navigator.clipboard.writeText(e),this.toastService.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD"))}async applyInviteCode(){if(!this.inviteCodeInput.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u9080\u8ACB\u78BC");return}let e=await this.membershipService.applyInviteCode(this.inviteCodeInput.trim());e.success?(this.toastService.success(e.message,5e3),this.inviteCodeInput=""):this.toastService.error(e.message)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-membership-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","border","border-slate-600","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","gap-4","mt-4"],[1,"font-medium","pb-2","border-b-2","transition-colors",3,"click"],[1,"p-6","overflow-y-auto","max-h-[60vh]"],[1,"max-w-md","mx-auto"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"relative","rounded-xl","border-2","p-4","transition-all",3,"border-cyan-500","border-slate-600","bg-slate-700/50","bg-slate-800"],[1,"mt-6","p-4","bg-slate-700/50","rounded-lg"],[1,"font-medium","text-white","mb-2"],[1,"text-sm","text-slate-300"],[1,"flex","gap-4","mt-3"],["href","#",1,"text-sm","text-cyan-400","hover:underline"],[1,"relative","rounded-xl","border-2","p-4","transition-all"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-xs","px-3","py-1","rounded-full"],[1,"absolute","-top-3","right-2","bg-green-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center","mb-4"],[1,"text-3xl"],[1,"text-lg","font-bold","text-white","mt-2"],[1,"mt-2"],[1,"text-2xl","font-bold","text-green-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"space-y-2","text-sm"],[1,"flex","items-start","gap-2","text-slate-300"],[1,"w-full","mt-4","py-2","rounded-lg","font-medium","transition-colors",3,"click","disabled"],[1,"text-slate-400"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4","text-green-400","mt-0.5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-center","mb-6"],[1,"text-4xl","mb-2"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","mt-1"],[1,"space-y-4"],[1,"block","text-sm","text-slate-300","mb-1"],["type","text","placeholder","TGAI-XX-XXXX-XXXX-XXXX",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none","uppercase","tracking-wider","font-mono",3,"ngModelChange","ngModel"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","font-bold","py-3","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","text-slate-400","space-y-1"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-600/20","rounded-xl","p-6","mb-6"],[1,"text-center"],[1,"text-sm","text-slate-400","mb-2"],[1,"text-3xl","font-mono","font-bold","text-white","tracking-widest","mb-3"],[1,"bg-white/10","hover:bg-white/20","text-white","px-4","py-2","rounded-lg","transition-colors",3,"click"],[1,"grid","grid-cols-2","gap-4","mb-6"],[1,"bg-slate-700/50","rounded-lg","p-4","text-center"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400"],[1,"bg-slate-700/50","rounded-lg","p-4"],[1,"font-medium","text-white","mb-3"],[1,"space-y-2","text-sm","text-slate-300"],[1,"flex","items-center","gap-2"],[1,"text-green-400"],[1,"mt-6","p-4","border","border-dashed","border-slate-600","rounded-lg"],[1,"flex","gap-2"],["type","text","placeholder","\u8F38\u5165\u597D\u53CB\u7684\u9080\u8ACB\u78BC",1,"flex-1","bg-slate-700","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm","uppercase",3,"ngModelChange","ngModel"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","px-4","py-2","rounded-lg","text-sm",3,"click"]],template:function(t,n){t&1&&S(0,s1,23,27,"div",0),t&2&&w(n.show()?0:-1)},dependencies:[te,me,xe,_e,Ce],encapsulation:2})}},_o=class i{constructor(){this.membershipService=O(Re);this.show=!1;this.message="";this.suggestion=this.membershipService.getUpgradeSuggestion()}get nextLevelName(){return this.suggestion?.nextLevel?{bronze:"\u9752\u9285\u6230\u58EB",silver:"\u767D\u9280\u7CBE\u82F1",gold:"\u9EC3\u91D1\u5927\u5E2B",diamond:"\u947D\u77F3\u738B\u724C",star:"\u661F\u8000\u50B3\u8AAA",king:"\u69AE\u8000\u738B\u8005"}[this.suggestion.nextLevel]:""}showPrompt(e){this.message=e,this.suggestion=this.membershipService.getUpgradeSuggestion(),this.suggestion&&(this.show=!0)}dismiss(){this.show=!1}upgrade(){this.dismiss(),window.dispatchEvent(new CustomEvent("open-membership-dialog"))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-upgrade-prompt"]],decls:1,vars:1,consts:[[1,"fixed","bottom-4","right-4","max-w-sm","bg-gradient-to-r","from-slate-800","to-slate-700","rounded-xl","shadow-2xl","border","border-slate-600","p-4","z-40","animate-slide-up"],[1,"absolute","top-2","right-2","text-slate-500","hover:text-white",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-start","gap-3"],[1,"text-3xl"],[1,"flex-1"],[1,"font-bold","text-white","mb-1"],[1,"text-sm","text-slate-300","mb-3"],[1,"text-xs","text-slate-400","space-y-1","mb-3"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-600","text-white","text-sm","font-medium","px-4","py-2","rounded-lg","hover:opacity-90",3,"click"]],template:function(t,n){t&1&&S(0,l1,17,3,"div",0),t&2&&w(n.show&&n.suggestion?0:-1)},dependencies:[te],styles:["@keyframes _ngcontent-%COMP%_slide-up{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.animate-slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-up .3s ease-out}"]})}};var c1="tgai-license-secret-2026",Co=class i{constructor(){this.ngZone=O(We);this._machineId=_("");this._deviceFingerprint=_("");this.tokenRefreshInterval=null;this.lastTokenRefresh=_(null);this.initializeDeviceInfo(),this.startTokenRefreshTimer()}ngOnDestroy(){this.stopTokenRefreshTimer()}initializeDeviceInfo(){this._machineId.set(this.getMachineId()),this._deviceFingerprint.set(this.generateDeviceFingerprint())}getMachineId(){let e=localStorage.getItem("tgai-machine-id");return e||(e=this.generateMachineId(),localStorage.setItem("tgai-machine-id",e)),e}generateMachineId(){let e=[navigator.userAgent,navigator.language,screen.width,screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||0,navigator.deviceMemory||0];return`M-${this.hashString(e.join("|")).substring(0,16).toUpperCase()}`}generateDeviceFingerprint(){let e=[navigator.userAgent,navigator.platform,navigator.language,screen.width+"x"+screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||0,navigator.deviceMemory||0,navigator.maxTouchPoints||0,this.getCanvasFingerprint(),this.getWebGLFingerprint()];return this.hashString(e.join("::"))}getCanvasFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("TG-AI\u667A\u63A7\u738B",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("TG-AI\u667A\u63A7\u738B",4,17),e.toDataURL().substring(0,100)):""}catch{return""}}getWebGLFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"";let n=t.getExtension("WEBGL_debug_renderer_info");if(n){let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),a=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return`${o}|${a}`}return""}catch{return""}}generateRequestSignature(e,t,n){let o=`${e}:${t}:${n}:${c1}`;return this.hashString(o)}generateNonce(){let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}createSecureHeaders(){let e=Math.floor(Date.now()/1e3),t=this.generateNonce(),n=this._machineId();return{"X-Signature":this.generateRequestSignature(e,t,n),"X-Timestamp":e.toString(),"X-Nonce":t,"X-Machine-Id":n}}createSignedRequestBody(e){let t=Math.floor(Date.now()/1e3),n=this.generateNonce();return B(F({},e),{timestamp:t,nonce:n,machine_id:this._machineId(),device_fingerprint:this._deviceFingerprint()})}startTokenRefreshTimer(){this.tokenRefreshInterval=setInterval(()=>{this.ngZone.run(()=>{window.dispatchEvent(new CustomEvent("refresh-token"))})},1200*60*1e3)}stopTokenRefreshTimer(){this.tokenRefreshInterval&&(clearInterval(this.tokenRefreshInterval),this.tokenRefreshInterval=null)}shouldRefreshToken(e){return e?(e.getTime()-Date.now())/(1e3*60*60)<4:!1}hashString(e){return this.sha256(e)}sha256(e){let n=new TextEncoder().encode(e),o=0;for(let d=0;d<e.length;d++){let m=e.charCodeAt(d);o=(o<<5)-o+m,o=o&o}let a=Math.abs(o).toString(16).padStart(8,"0");return(a+a+a+a+a+a+a+a).substring(0,64)}async sha256Async(e){let t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("")}get machineId(){return this._machineId()}get deviceFingerprint(){return this._deviceFingerprint()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Ot=class i{constructor(){this.membershipService=O(Re);this.toastService=O(ue);this.securityService=O(Co);this.ngZone=O(We);this.serverUrl=_("");this.token=_(null);this.heartbeatInterval=null;this.tokenRefreshInterval=null;this.isOnline=_(!0);this.lastHeartbeat=_(null);this.offlineGracePeriod=10080*60*1e3;this.products=[{id:"silver_week",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"week",durationName:"\u5468\u5361",price:1.99},{id:"silver_month",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"month",durationName:"\u6708\u5361",price:4.99},{id:"silver_quarter",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"quarter",durationName:"\u5B63\u5361",price:12.99},{id:"silver_year",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"year",durationName:"\u5E74\u5361",price:49.9},{id:"gold_week",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"week",durationName:"\u5468\u5361",price:6.99},{id:"gold_month",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"month",durationName:"\u6708\u5361",price:19.9},{id:"gold_quarter",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"quarter",durationName:"\u5B63\u5361",price:49.9},{id:"gold_year",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"year",durationName:"\u5E74\u5361",price:199},{id:"diamond_week",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"week",durationName:"\u5468\u5361",price:19.9},{id:"diamond_month",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"month",durationName:"\u6708\u5361",price:59.9},{id:"diamond_quarter",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"quarter",durationName:"\u5B63\u5361",price:149},{id:"diamond_year",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"year",durationName:"\u5E74\u5361",price:599},{id:"star_week",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"week",durationName:"\u5468\u5361",price:59.9},{id:"star_month",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"month",durationName:"\u6708\u5361",price:199},{id:"star_quarter",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"quarter",durationName:"\u5B63\u5361",price:499},{id:"star_year",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"year",durationName:"\u5E74\u5361",price:1999},{id:"king_week",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"week",durationName:"\u5468\u5361",price:199},{id:"king_month",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"month",durationName:"\u6708\u5361",price:599},{id:"king_quarter",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"quarter",durationName:"\u5B63\u5361",price:1499},{id:"king_year",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"year",durationName:"\u5E74\u5361",price:5999},{id:"king_lifetime",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"lifetime",durationName:"\u7D42\u8EAB",price:14999}];this.loadToken(),this.loadServerUrl(),this.startHeartbeat(),this.startTokenRefresh(),this.listenForTokenRefresh()}ngOnDestroy(){this.stopHeartbeat(),this.stopTokenRefresh()}loadToken(){let e=localStorage.getItem("tgai-license-token");e&&this.token.set(e)}loadServerUrl(){let e=localStorage.getItem("tgai-license-server");e&&this.serverUrl.set(e)}saveToken(e){this.token.set(e),localStorage.setItem("tgai-license-token",e)}clearToken(){this.token.set(null),localStorage.removeItem("tgai-license-token")}startTokenRefresh(){this.tokenRefreshInterval=setInterval(()=>{this.ngZone.run(()=>{this.refreshToken()})},1200*60*1e3)}stopTokenRefresh(){this.tokenRefreshInterval&&(clearInterval(this.tokenRefreshInterval),this.tokenRefreshInterval=null)}listenForTokenRefresh(){window.addEventListener("refresh-token",()=>{this.refreshToken()})}async refreshToken(){if(!this.isServerConfigured()||!this.token())return{success:!1,message:"\u672A\u914D\u7F6E\u670D\u52D9\u5668\u6216\u7121 Token"};try{let e=this.securityService.createSignedRequestBody({token:this.token(),machine_id:this.securityService.machineId,device_fingerprint:this.securityService.deviceFingerprint}),t=this.securityService.createSecureHeaders(),o=await(await fetch(`${this.serverUrl()}/api/token/refresh`,{method:"POST",headers:F({"Content-Type":"application/json"},t),body:JSON.stringify(e)})).json();return o.success&&o.data?.token?(this.saveToken(o.data.token),{success:!0,message:"Token \u5237\u65B0\u6210\u529F"}):{success:!1,message:o.message||"Token \u5237\u65B0\u5931\u6557"}}catch{return{success:!1,message:"\u7DB2\u7D61\u932F\u8AA4"}}}setServerUrl(e){this.serverUrl.set(e.replace(/\/$/,"")),localStorage.setItem("tgai-license-server",e)}getServerUrl(){return this.serverUrl()}isServerConfigured(){return!!this.serverUrl()}async validateLicense(e){if(!this.isServerConfigured())return this.localValidate(e);try{let n=await(await fetch(`${this.serverUrl()}/api/license/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({license_key:e})})).json();return this.isOnline.set(!0),{success:n.success,message:n.message,data:n.data}}catch{return this.isOnline.set(!1),this.localValidate(e)}}async activateLicense(e,t="",n=""){let o=this.getMachineId(),a=this.getDeviceId();if(!this.isServerConfigured()){let d=await this.membershipService.activateMembership(e,t);return{success:d.success,message:d.message}}try{let m=await(await fetch(`${this.serverUrl()}/api/license/activate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({license_key:e,machine_id:o,device_id:a,email:t,invite_code:n})})).json();if(this.isOnline.set(!0),m.success){m.data?.token&&this.saveToken(m.data.token);let f=await this.membershipService.activateMembership(e,t);if(!m.data?.level||!m.data?.expiresAt){let h=this.membershipService.membership();h&&(m.data=B(F({},m.data),{level:h.level,levelName:h.levelName,levelIcon:h.levelIcon,expiresAt:h.expiresAt?.toISOString()||"",durationDays:30}))}}return{success:m.success,message:m.message,data:m.data}}catch{this.isOnline.set(!1);let m=await this.membershipService.activateMembership(e,t);return{success:m.success,message:m.message+" (\u96E2\u7DDA\u6A21\u5F0F)"}}}async sendHeartbeat(){if(!this.isServerConfigured()||!this.token())return{success:!0,message:"\u96E2\u7DDA\u6A21\u5F0F"};try{let e=this.membershipService.usage(),n=await(await fetch(`${this.serverUrl()}/api/license/heartbeat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:this.token(),machine_id:this.getMachineId(),usage:e})})).json();return this.ngZone.run(()=>{this.isOnline.set(!0),this.lastHeartbeat.set(new Date),localStorage.setItem("tgai-last-online",Date.now().toString()),n.success&&n.data?.token&&this.saveToken(n.data.token),n.data?.isExpired&&this.toastService.warning("\u60A8\u7684\u6703\u54E1\u5DF2\u904E\u671F\uFF0C\u8ACB\u7E8C\u8CBB\u7E7C\u7E8C\u4F7F\u7528")}),{success:n.success,message:n.message,data:n.data}}catch{this.ngZone.run(()=>{this.isOnline.set(!1)});let t=localStorage.getItem("tgai-last-online");return t&&Date.now()-parseInt(t)>this.offlineGracePeriod?{success:!1,message:"\u96E2\u7DDA\u6642\u9593\u904E\u9577\uFF0C\u8ACB\u9023\u63A5\u7DB2\u7D61\u9A57\u8B49"}:{success:!0,message:"\u96E2\u7DDA\u6A21\u5F0F"}}}async getUserProfile(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let t=await(await fetch(`${this.serverUrl()}/api/user/profile`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:t.success,data:t.data}}catch{return{success:!1}}}async getActivationHistory(e=50,t=0){if(!this.isServerConfigured())return{success:!1};try{let n=this.getMachineId(),o=`${this.serverUrl()}/api/user/activation-history?machine_id=${n}&limit=${e}&offset=${t}`,a={"Content-Type":"application/json"};this.token()&&(a.Authorization=`Bearer ${this.token()}`);let m=await(await fetch(o,{headers:a})).json();return{success:m.success,data:m.data||[]}}catch{return{success:!1,data:[]}}}async getUserQuota(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let t=await(await fetch(`${this.serverUrl()}/api/user/quota`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:t.success,data:t.data}}catch{return{success:!1}}}async getUsageStats(){if(!this.isServerConfigured())return{success:!1};try{let e=this.getMachineId(),t=`${this.serverUrl()}/api/user/usage-stats?machine_id=${e}`,n={"Content-Type":"application/json"};this.token()&&(n.Authorization=`Bearer ${this.token()}`);let a=await(await fetch(t,{headers:n})).json();return{success:a.success,stats:a.stats}}catch{return{success:!1}}}async getInviteInfo(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let t=await(await fetch(`${this.serverUrl()}/api/invite/info`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:t.success,data:t.data}}catch{return{success:!1}}}async getInviteList(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let t=await(await fetch(`${this.serverUrl()}/api/invite/list`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:t.success,data:t.data}}catch{return{success:!1}}}async fetchProducts(){if(!this.isServerConfigured())return{success:!0,data:this.products};try{let t=await(await fetch(`${this.serverUrl()}/api/products`)).json();return{success:t.success,data:t.data}}catch{return{success:!0,data:this.products}}}async createPayment(e,t="usdt"){if(!this.isServerConfigured())return{success:!1,message:"\u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6"};try{let o=await(await fetch(`${this.serverUrl()}/api/payment/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,machine_id:this.getMachineId(),payment_method:t})})).json();return o.success?{success:!0,message:"\u8A02\u55AE\u5275\u5EFA\u6210\u529F",order:o.data}:{success:!1,message:o.message}}catch{return{success:!1,message:"\u5275\u5EFA\u8A02\u55AE\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}}async checkPaymentStatus(e){if(!this.isServerConfigured())return{success:!1,paid:!1,message:"\u670D\u52D9\u5668\u672A\u914D\u7F6E"};try{let n=await(await fetch(`${this.serverUrl()}/api/payment/status/${e}`)).json();return{success:n.success,paid:n.data?.status==="paid",licenseKey:n.data?.license_key,message:n.message}}catch{return{success:!1,paid:!1,message:"\u67E5\u8A62\u652F\u4ED8\u72C0\u614B\u5931\u6557"}}}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.sendHeartbeat()},300*1e3),setTimeout(()=>this.sendHeartbeat(),5e3),window.addEventListener("online",()=>{this.isOnline.set(!0),localStorage.setItem("tgai-last-online",Date.now().toString()),this.sendHeartbeat()}),window.addEventListener("offline",()=>{this.isOnline.set(!1)})}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}getMachineId(){let e=localStorage.getItem("tgai-machine-id");return e||(e="mid-"+this.generateId(),localStorage.setItem("tgai-machine-id",e)),e}getDeviceId(){let e=localStorage.getItem("tgai-device-id");return e||(e="dev-"+this.generateId().substring(0,12),localStorage.setItem("tgai-device-id",e)),e}generateId(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}localValidate(e){let t=/^TGAI-([BGDSK][123YL]|EXT)-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i;if(!e.toUpperCase().match(t)){let o=/^TGM-([BGDSK][123Y])-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i;if(!e.toUpperCase().match(o))return{success:!1,message:"\u5361\u5BC6\u683C\u5F0F\u4E0D\u6B63\u78BA"}}return{success:!0,message:"\u5361\u5BC6\u683C\u5F0F\u6709\u6548 (\u96E2\u7DDA\u9A57\u8B49)",data:{level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",expiresAt:"",durationDays:30}}}getProductsByLevel(){let e={bronze:[],silver:[],gold:[],diamond:[],star:[],king:[]};for(let t of this.products)e[t.level]&&e[t.level].push(t);return e}getRecommendedProducts(){return[this.products.find(e=>e.id==="gold_month"),this.products.find(e=>e.id==="diamond_month"),this.products.find(e=>e.id==="star_year")].filter(Boolean)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var d1=(i,e)=>e.id;function u1(i,e){i&1&&(r(0,"div",21),l(1," \u63A8\u85A6 "),s())}function m1(i,e){i&1&&(r(0,"div",22),l(1," \u71B1\u9580 "),s())}function p1(i,e){if(i&1){let t=M();r(0,"div",20),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.selectProduct(o))}),S(1,u1,2,0,"div",21),S(2,m1,2,0,"div",22),r(3,"div",23)(4,"div",24),l(5),s(),r(6,"div",25),l(7),s(),r(8,"div",26)(9,"span",27),l(10),s()(),r(11,"div",28),l(12,"TRC20 \u7DB2\u7D61"),s()()()}if(i&2){let t,n,o,a=e.$implicit,d=g(3);I("border-cyan-500",((t=d.selectedProduct())==null?null:t.id)===a.id)("bg-cyan-500/10",((n=d.selectedProduct())==null?null:n.id)===a.id)("border-slate-600",((o=d.selectedProduct())==null?null:o.id)!==a.id),c(),w(a.recommended?1:-1),c(),w(a.popular?2:-1),c(3),A(a.levelName),c(2),A(a.durationName),c(3),D("",a.price," USDT")}}function g1(i,e){if(i&1){let t=M();r(0,"div",15),$(1,p1,13,11,"div",16,d1),s(),r(3,"div",17)(4,"button",18),x("click",function(){v(t);let o=g(2);return b(o.close())}),l(5," \u53D6\u6D88 "),s(),r(6,"button",19),x("click",function(){v(t);let o=g(2);return b(o.proceedToPayment())}),l(7," \u4E0B\u4E00\u6B65 "),s()()}if(i&2){let t=g(2);c(),H(t.products),c(5),V("disabled",!t.selectedProduct())}}function h1(i,e){if(i&1&&(r(0,"div",41)(1,"div",43)(2,"span"),l(3,"\u{1F48E}"),s(),r(4,"span",44),l(5,"USDT-TRC20 \u652F\u4ED8\uFF08\u63A8\u85A6\uFF09"),s()(),r(6,"div",45)(7,"div",46)(8,"div",47),l(9,"\u652F\u4ED8\u91D1\u984D"),s(),r(10,"div",48),l(11),s()(),r(12,"div",46)(13,"div",47),l(14,"\u7DB2\u7D61"),s(),r(15,"div",49),l(16,"TRC20"),s()()(),r(17,"div",50),l(18," \u26A0\uFE0F \u50C5\u652F\u6301 TRC20 \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC "),s()()),i&2){let t,n=g(3);c(11),D("",(t=n.selectedProduct())==null?null:t.price," USDT")}}function f1(i,e){if(i&1){let t=M();r(0,"div",29)(1,"div",30),l(2),s(),r(3,"div",31),l(4),s(),r(5,"div",32),l(6,"TRC20 \u7DB2\u7D61"),s()(),r(7,"div",33)(8,"label",34),l(9,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u8A02\u55AE\u901A\u77E5)"),s(),r(10,"input",35),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.email,o)||(a.email=o),b(o)}),s()(),r(11,"div",36)(12,"label",34),l(13,"\u9078\u64C7\u652F\u4ED8\u65B9\u5F0F"),s(),r(14,"div",37)(15,"button",38),x("click",function(){v(t);let o=g(2);return b(o.paymentMethod.set("alipay"))}),r(16,"span",39),l(17,"\u{1F499}"),s(),r(18,"span",40),l(19,"\u652F\u4ED8\u5BF6"),s()(),r(20,"button",38),x("click",function(){v(t);let o=g(2);return b(o.paymentMethod.set("wechat"))}),r(21,"span",39),l(22,"\u{1F49A}"),s(),r(23,"span",40),l(24,"\u5FAE\u4FE1\u652F\u4ED8"),s()(),r(25,"button",38),x("click",function(){v(t);let o=g(2);return b(o.paymentMethod.set("stripe"))}),r(26,"span",39),l(27,"\u{1F4B3}"),s(),r(28,"span",40),l(29,"\u570B\u969B\u5361"),s()(),r(30,"button",38),x("click",function(){v(t);let o=g(2);return b(o.paymentMethod.set("usdt"))}),r(31,"span",39),l(32,"\u{1F48E}"),s(),r(33,"span",40),l(34,"USDT"),s()()(),S(35,h1,19,1,"div",41),s(),r(36,"div",42)(37,"button",18),x("click",function(){v(t);let o=g(2);return b(o.step.set("select"))}),l(38," \u8FD4\u56DE "),s(),r(39,"button",19),x("click",function(){v(t);let o=g(2);return b(o.createOrder())}),l(40),s()()}if(i&2){let t,n,o=g(2);c(2),Y("",(t=o.selectedProduct())==null?null:t.levelName," - ",(t=o.selectedProduct())==null?null:t.durationName),c(2),D("",(n=o.selectedProduct())==null?null:n.price," USDT"),c(6),z("ngModel",o.email),c(5),I("border-cyan-500",o.paymentMethod()==="alipay")("bg-cyan-500/10",o.paymentMethod()==="alipay")("border-slate-600",o.paymentMethod()!=="alipay"),c(5),I("border-cyan-500",o.paymentMethod()==="wechat")("bg-cyan-500/10",o.paymentMethod()==="wechat")("border-slate-600",o.paymentMethod()!=="wechat"),c(5),I("border-cyan-500",o.paymentMethod()==="stripe")("bg-cyan-500/10",o.paymentMethod()==="stripe")("border-slate-600",o.paymentMethod()!=="stripe"),c(5),I("border-cyan-500",o.paymentMethod()==="usdt")("bg-cyan-500/10",o.paymentMethod()==="usdt")("border-slate-600",o.paymentMethod()!=="usdt"),c(5),w(o.paymentMethod()==="usdt"?35:-1),c(4),V("disabled",o.isProcessing()),c(),D(" ",o.isProcessing()?"\u8655\u7406\u4E2D...":"\u7ACB\u5373\u652F\u4ED8"," ")}}function _1(i,e){if(i&1){let t=M();r(0,"div",57)(1,"div",60)(2,"div",27),l(3),s(),r(4,"div",61),l(5,"TRC20 \u7DB2\u7D61\uFF08TRON\uFF09"),s()(),r(6,"div",33)(7,"div",62),l(8,"\u6536\u6B3E\u5730\u5740\uFF08TRC20\uFF09"),s(),r(9,"div",63)(10,"div",64)(11,"code",65),l(12),s(),r(13,"button",66),x("click",function(){v(t);let o=g(3);return b(o.copyUsdtAddress())}),l(14," \u{1F4CB} \u8907\u88FD "),s()()()(),r(15,"div",67)(16,"div",68)(17,"div",39),l(18,"\u{1F4DD}"),s(),r(19,"div")(20,"div",69),l(21,"\u8F49\u8CEC\u6B65\u9A5F"),s(),r(22,"ol",70)(23,"li"),l(24,"1. \u6253\u958B\u60A8\u7684\u52A0\u5BC6\u8CA8\u5E63\u9322\u5305\uFF08\u5982 Trust Wallet\u3001TokenPocket\uFF09"),s(),r(25,"li"),l(26,"2. \u9078\u64C7 USDT \u8CC7\u7522\uFF0C\u9EDE\u64CA\u300C\u767C\u9001\u300D"),s(),r(27,"li"),l(28,"3. \u7C98\u8CBC\u4E0A\u65B9\u5730\u5740\uFF0C\u9078\u64C7 "),r(29,"span",71),l(30,"TRC20"),s(),l(31," \u7DB2\u7D61"),s(),r(32,"li"),l(33,"4. \u8F38\u5165\u91D1\u984D "),r(34,"span",71),l(35),s()(),r(36,"li"),l(37,"5. \u78BA\u8A8D\u8F49\u8CEC\uFF0C\u7B49\u5F85\u5340\u584A\u78BA\u8A8D"),s()()()()(),r(38,"div",72)(39,"span"),l(40,"\u26A0\uFE0F"),s(),r(41,"div")(42,"strong"),l(43,"\u91CD\u8981\u63D0\u9192\uFF1A"),s(),r(44,"ul",73)(45,"li"),l(46,"\u2022 \u50C5\u652F\u6301 "),r(47,"strong"),l(48,"TRC20"),s(),l(49," \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC"),s(),r(50,"li"),l(51,"\u2022 \u8ACB\u78BA\u4FDD\u8F49\u8CEC\u91D1\u984D\u6B63\u78BA\uFF1A"),r(52,"strong"),l(53),s()(),r(54,"li"),l(55,"\u2022 \u8F49\u8CEC\u5F8C\u901A\u5E38 1-5 \u5206\u9418\u5167\u5230\u8CEC"),s()()()()()}if(i&2){let t,n,o,a=g(3);c(3),D("",(t=a.selectedProduct())==null?null:t.price," USDT"),c(9),A(a.USDT_CONFIG.walletAddress),c(23),D("",(n=a.selectedProduct())==null?null:n.price," USDT"),c(18),D("",(o=a.selectedProduct())==null?null:o.price," USDT")}}function C1(i,e){if(i&1){let t=M();r(0,"div",11)(1,"div",51),l(2),s(),r(3,"h3",52),l(4,"\u7B49\u5F85\u652F\u4ED8"),s(),r(5,"p",53),l(6),s(),r(7,"div",54)(8,"div",55),l(9,"\u8A02\u55AE\u865F"),s(),r(10,"div",56),l(11),s()(),S(12,_1,56,4,"div",57),r(13,"div",58),l(14),s(),r(15,"div",42)(16,"button",18),x("click",function(){v(t);let o=g(2);return b(o.cancelPayment())}),l(17," \u53D6\u6D88\u652F\u4ED8 "),s(),r(18,"button",59),x("click",function(){v(t);let o=g(2);return b(o.checkPaymentStatus())}),l(19),s()()()}if(i&2){let t,n=g(2);c(2),A(n.paymentMethod()==="usdt"?"\u{1F48E}":"\u23F3"),c(4),D(" ",n.paymentMethod()==="usdt"?"\u8ACB\u5411\u4EE5\u4E0B\u5730\u5740\u8F49\u8CEC USDT":"\u8ACB\u5728\u65B0\u7A97\u53E3\u5B8C\u6210\u652F\u4ED8"," "),c(5),A((t=n.currentOrder())==null?null:t.order_id),c(),w(n.paymentMethod()==="usdt"?12:-1),c(2),D(" ",n.paymentMethod()==="usdt"?"\u8F49\u8CEC\u6210\u529F\u5F8C\u9EDE\u64CA\u300C\u6211\u5DF2\u652F\u4ED8\u300D":"\u652F\u4ED8\u5B8C\u6210\u5F8C\u5C07\u81EA\u52D5\u6FC0\u6D3B\u6703\u54E1"," "),c(4),V("disabled",n.isChecking()),c(),D(" ",n.isChecking()?"\u6AA2\u67E5\u4E2D...":"\u6211\u5DF2\u652F\u4ED8"," ")}}function v1(i,e){if(i&1){let t=M();r(0,"div",74)(1,"div",55),l(2,"\u60A8\u7684\u5361\u5BC6"),s(),r(3,"div",56),l(4),s(),r(5,"button",76),x("click",function(){v(t);let o=g(3);return b(o.copyLicenseKey())}),l(6," \u{1F4CB} \u8907\u88FD\u5361\u5BC6 "),s()()}if(i&2){let t=g(3);c(4),A(t.activatedLicenseKey())}}function b1(i,e){if(i&1){let t=M();r(0,"div",11)(1,"div",51),l(2,"\u{1F389}"),s(),r(3,"h3",52),l(4,"\u652F\u4ED8\u6210\u529F\uFF01"),s(),r(5,"p",53),l(6,"\u60A8\u7684\u6703\u54E1\u5DF2\u6FC0\u6D3B"),s(),S(7,v1,7,1,"div",74),r(8,"button",75),x("click",function(){v(t);let o=g(2);return b(o.close())}),l(9," \u958B\u59CB\u4F7F\u7528 "),s()()}if(i&2){let t=g(2);c(7),w(t.activatedLicenseKey()?7:-1)}}function x1(i,e){if(i&1){let t=M();r(0,"div",1),x("click",function(){v(t);let o=g();return b(o.close())}),r(1,"div",2),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),l(6," \u{1F4B3} \u5347\u7D1A\u6703\u54E1 "),s(),r(7,"p",6),l(8,"\u9078\u64C7\u9069\u5408\u60A8\u7684\u65B9\u6848"),s()(),r(9,"button",7),x("click",function(){v(t);let o=g();return b(o.close())}),ne(),r(10,"svg",8),k(11,"path",9),s()()()(),ge(),r(12,"div",10),S(13,g1,8,1),S(14,f1,41,31),S(15,C1,20,7,"div",11),S(16,b1,10,1,"div",11),r(17,"div",12)(18,"p",13),l(19," \u9047\u5230\u554F\u984C\uFF1F "),r(20,"a",14),l(21,"\u806F\u7E6B\u5BA2\u670D"),s(),l(22," \u6216 "),r(23,"a",14),l(24,"\u67E5\u770B\u5E6B\u52A9"),s()()()()()()}if(i&2){let t=g();c(13),w(t.step()==="select"?13:-1),c(),w(t.step()==="payment"?14:-1),c(),w(t.step()==="pending"?15:-1),c(),w(t.step()==="success"?16:-1)}}var vo=class i{constructor(){this.licenseClient=O(Ot);this.membershipService=O(Re);this.toastService=O(ue);this.show=_(!1);this.step=_("select");this.products=this.licenseClient.products;this.selectedProduct=_(null);this.paymentMethod=_("usdt");this.USDT_CONFIG={network:"TRC20",walletAddress:"TYourTRC20WalletAddressHere",minAmount:1};this.email="";this.isProcessing=_(!1);this.isChecking=_(!1);this.currentOrder=_(null);this.activatedLicenseKey=_(null);this.checkInterval=null;window.addEventListener("open-payment-dialog",()=>{this.open()})}ngOnDestroy(){this.stopCheckInterval()}open(){this.show.set(!0),this.step.set("select"),this.selectedProduct.set(null),this.currentOrder.set(null),this.activatedLicenseKey.set(null)}close(){this.show.set(!1),this.stopCheckInterval()}selectProduct(e){this.selectedProduct.set(e)}proceedToPayment(){this.selectedProduct()&&this.step.set("payment")}async createOrder(){let e=this.selectedProduct();if(e){this.isProcessing.set(!0);try{let t=await this.licenseClient.createPayment(e.id,this.paymentMethod());t.success&&t.order?(this.currentOrder.set(t.order),this.step.set("pending"),window.open(t.order.payment_url,"_blank"),this.startCheckInterval()):this.toastService.error(t.message)}catch{this.toastService.error("\u5275\u5EFA\u8A02\u55AE\u5931\u6557")}finally{this.isProcessing.set(!1)}}}async checkPaymentStatus(){let e=this.currentOrder();if(e){this.isChecking.set(!0);try{let t=await this.licenseClient.checkPaymentStatus(e.orderId);t.paid?(this.stopCheckInterval(),this.activatedLicenseKey.set(t.licenseKey||null),this.step.set("success"),this.toastService.success("\u{1F389} \u652F\u4ED8\u6210\u529F\uFF0C\u6703\u54E1\u5DF2\u6FC0\u6D3B\uFF01"),t.licenseKey&&await this.membershipService.activateMembership(t.licenseKey,this.email)):this.toastService.info("\u652F\u4ED8\u5C1A\u672A\u5B8C\u6210\uFF0C\u8ACB\u7E7C\u7E8C\u652F\u4ED8")}catch{this.toastService.error("\u6AA2\u67E5\u652F\u4ED8\u72C0\u614B\u5931\u6557")}finally{this.isChecking.set(!1)}}}cancelPayment(){this.stopCheckInterval(),this.step.set("select"),this.currentOrder.set(null)}copyLicenseKey(){let e=this.activatedLicenseKey();e&&(navigator.clipboard.writeText(e),this.toastService.success("\u5361\u5BC6\u5DF2\u8907\u88FD"))}copyUsdtAddress(){navigator.clipboard.writeText(this.USDT_CONFIG.walletAddress),this.toastService.success("USDT TRC20 \u5730\u5740\u5DF2\u8907\u88FD")}startCheckInterval(){this.checkInterval=setInterval(()=>{this.checkPaymentStatus()},5e3)}stopCheckInterval(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-payment"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-gradient-to-br","from-slate-900","to-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","via-purple-500","to-pink-500","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-2"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2","rounded-full","hover:bg-white/10",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[70vh]"],[1,"text-center","py-8"],[1,"mt-6","pt-4","border-t","border-slate-700","text-center"],[1,"text-sm","text-slate-500"],["href","#",1,"text-cyan-400","hover:underline"],[1,"grid","grid-cols-2","gap-4"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"border-cyan-500","bg-cyan-500/10","border-slate-600"],[1,"mt-6","flex","gap-4"],[1,"flex-1","py-3","rounded-xl","bg-slate-700","text-slate-300","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"click"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-pink-500","to-purple-500","text-white","text-xs","px-3","py-1","rounded-full","font-medium"],[1,"absolute","-top-3","right-2","bg-orange-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-slate-400"],[1,"mt-2"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-center","mb-6"],[1,"text-lg","text-slate-300"],[1,"text-4xl","font-bold","text-emerald-400","mt-2"],[1,"text-sm","text-slate-500","mt-1"],[1,"mb-4"],[1,"block","text-sm","text-slate-400","mb-2"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"space-y-3","mb-6"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","justify-center","gap-2","p-4","rounded-xl","border-2","transition-all",3,"click"],[1,"text-2xl"],[1,"text-white","font-medium"],[1,"mt-3","p-4","bg-emerald-500/10","border","border-emerald-500/30","rounded-lg"],[1,"flex","gap-4"],[1,"flex","items-center","gap-2","text-emerald-400","text-sm","mb-3"],[1,"font-medium"],[1,"flex","items-center","gap-3","mb-3"],[1,"flex-1","p-2","bg-slate-800","rounded-lg"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-2"],[1,"text-6xl","mb-4"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-4"],[1,"bg-slate-700/50","rounded-xl","p-4","mb-4"],[1,"text-sm","text-slate-400"],[1,"text-lg","font-mono","text-cyan-400"],[1,"bg-emerald-500/10","border","border-emerald-500/30","rounded-xl","p-5","mb-4","text-left"],[1,"text-sm","text-slate-500","mb-6"],[1,"flex-1","py-3","rounded-xl","bg-cyan-500","text-white","font-bold","hover:bg-cyan-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-center","mb-4"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-xs","text-slate-400","mb-2"],[1,"bg-slate-800","rounded-lg","p-3"],[1,"flex","items-center","justify-between","gap-2"],[1,"text-sm","text-emerald-400","break-all","font-mono"],[1,"flex-shrink-0","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","px-3","py-1.5","rounded-lg","text-sm","transition-colors",3,"click"],[1,"bg-slate-800/50","rounded-lg","p-3","mb-4"],[1,"flex","items-start","gap-3"],[1,"text-sm","text-white","font-medium","mb-1"],[1,"text-xs","text-slate-400","space-y-1"],[1,"text-emerald-400","font-medium"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-3","flex","items-start","gap-2"],[1,"mt-1","space-y-0.5"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-500/20","rounded-xl","p-4","mb-6"],[1,"w-full","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity",3,"click"],[1,"mt-2","text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(t,n){t&1&&S(0,x1,25,4,"div",0),t&2&&w(n.show()?0:-1)},dependencies:[te,me,xe,_e,Ce],encapsulation:2})}};var Ys="TG-AI\u667A\u63A7\u738B-2026-Secure-Key",bo=class i{constructor(){this._isSecure=_(!0);this.isSecure=this._isSecure.asReadonly();this.initSecurityChecks()}initSecurityChecks(){this.isProduction()&&(this.detectDevTools(),this.preventContextMenu(),this.preventKeyboardShortcuts())}isProduction(){return!window.location.href.includes("localhost")&&!window.location.href.includes("127.0.0.1")}detectDevTools(){setInterval(()=>{let n=window.outerWidth-window.innerWidth>160,o=window.outerHeight-window.innerHeight>160;n||o?(this._isSecure.set(!1),console.clear(),console.log("%c\u26A0\uFE0F \u6AA2\u6E2C\u5230\u958B\u767C\u8005\u5DE5\u5177","color: red; font-size: 20px;")):this._isSecure.set(!0)},1e3),setInterval(()=>{let n=performance.now();performance.now()-n>100&&this._isSecure.set(!1)},5e3)}preventContextMenu(){document.addEventListener("contextmenu",e=>(e.preventDefault(),!1))}preventKeyboardShortcuts(){document.addEventListener("keydown",e=>e.key==="F12"||e.ctrlKey&&e.shiftKey&&e.key==="I"||e.ctrlKey&&e.shiftKey&&e.key==="J"||e.ctrlKey&&e.key==="u"?(e.preventDefault(),!1):!0)}encrypt(e){if(!e)return"";try{let t=btoa(unescape(encodeURIComponent(e)));return"ENC:"+this.shuffle(t,Ys)}catch(t){return console.error("Encryption failed:",t),e}}decrypt(e){if(!e)return"";if(!e.startsWith("ENC:"))return e;try{let t=e.substring(4),n=this.unshuffle(t,Ys);return decodeURIComponent(escape(atob(n)))}catch(t){return console.error("Decryption failed:",t),""}}shuffle(e,t){let o=t.split("").reduce((a,d)=>a+d.charCodeAt(0),0)%26;return e.split("").map(a=>{let d=a.charCodeAt(0);return d>=65&&d<=90?String.fromCharCode((d-65+o)%26+65):d>=97&&d<=122?String.fromCharCode((d-97+o)%26+97):a}).join("")}unshuffle(e,t){let o=t.split("").reduce((a,d)=>a+d.charCodeAt(0),0)%26;return e.split("").map(a=>{let d=a.charCodeAt(0);return d>=65&&d<=90?String.fromCharCode((d-65-o+26)%26+65):d>=97&&d<=122?String.fromCharCode((d-97-o+26)%26+97):a}).join("")}secureStore(e,t){let n=this.encrypt(JSON.stringify(t));localStorage.setItem(e,n)}secureRetrieve(e,t){let n=localStorage.getItem(e);if(!n)return t;try{let o=this.decrypt(n);return JSON.parse(o)}catch{return t}}secureRemove(e){localStorage.removeItem(e)}storeApiKey(e,t){this.secureStore(`api_${e}`,t)}getApiKey(e){return this.secureRetrieve(`api_${e}`,"")}removeApiKey(e){this.secureRemove(`api_${e}`)}generateFingerprint(){let t=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||"unknown",navigator.deviceMemory||"unknown"].join("|");return this.hashString(t)}hashString(e){let t=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);t=(t<<5)-t+o,t=t&t}return"fp-"+Math.abs(t).toString(16)}signRequest(e,t){let n=JSON.stringify(e)+t+Ys;return this.hashString(n)}verifySignature(e,t,n){let o=Date.now();return Math.abs(o-t)>300*1e3?!1:this.signRequest(e,t)===n}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var y1={LCP:{good:2500,poor:4e3},FID:{good:100,poor:300},CLS:{good:.1,poor:.25},FCP:{good:1800,poor:3e3},TTFB:{good:800,poor:1800},INP:{good:200,poor:500}},xo=class i{constructor(){this.observers=[];this.metrics=[];this.reported=!1;this.reportTimeout=null;typeof window<"u"&&typeof PerformanceObserver<"u"&&(this.initObservers(),this.scheduleReport())}ngOnDestroy(){this.observers.forEach(e=>{try{e.disconnect()}catch{}}),this.reportTimeout&&clearTimeout(this.reportTimeout)}initObservers(){this.observe("largest-contentful-paint",n=>{let o=n[n.length-1];o&&this.recordMetric("LCP",o.startTime)}),this.observe("first-input",n=>{let o=n[0];if(o){let a=o.processingStart-o.startTime;this.recordMetric("FID",a)}});let e=0,t=[];this.observe("layout-shift",n=>{for(let o of n){let a=o;a.hadRecentInput||(e+=a.value,t.push(o))}this.recordMetric("CLS",e)}),this.observe("paint",n=>{for(let o of n)o.name==="first-contentful-paint"&&this.recordMetric("FCP",o.startTime)}),this.observe("navigation",n=>{let o=n[0];if(o){let a=o.responseStart-o.requestStart;this.recordMetric("TTFB",a)}}),this.observe("event",n=>{let o=0;for(let a of n){let d=a;d.duration>o&&(o=d.duration)}o>0&&this.recordMetric("INP",o)},{durationThreshold:40})}observe(e,t,n){try{if(!PerformanceObserver.supportedEntryTypes?.includes(e))return;let o=new PerformanceObserver(d=>{t(d.getEntries())}),a=F({type:e,buffered:!0},n);o.observe(a),this.observers.push(o)}catch{}}recordMetric(e,t){let n=y1[e],o="good";n&&(t>n.poor?o="poor":t>n.good&&(o="needs-improvement"));let a=this.metrics.findIndex(m=>m.name===e),d={name:e,value:Math.round(t*100)/100,rating:o,timestamp:Date.now()};a>=0?this.metrics[a]=d:this.metrics.push(d)}scheduleReport(){document.readyState==="complete"?this.reportTimeout=setTimeout(()=>this.sendReport(),1e4):window.addEventListener("load",()=>{this.reportTimeout=setTimeout(()=>this.sendReport(),1e4)},{once:!0}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&!this.reported&&this.sendReport()})}sendReport(){if(this.reported||this.metrics.length===0)return;this.reported=!0;let e={metrics:[...this.metrics],navigation:this.getNavigationTiming(),url:window.location.pathname,userAgent:navigator.userAgent,connection:this.getConnectionInfo()},t=JSON.stringify(e);try{navigator.sendBeacon?navigator.sendBeacon("/api/v1/performance",t):fetch("/api/v1/performance",{method:"POST",body:t,headers:{"Content-Type":"application/json"},keepalive:!0}).catch(()=>{})}catch{}}getNavigationTiming(){try{let e=performance.getEntriesByType("navigation")[0];return e?{type:e.type,redirectCount:e.redirectCount,loadTime:Math.round(e.loadEventEnd-e.startTime),domContentLoaded:Math.round(e.domContentLoadedEventEnd-e.startTime),domInteractive:Math.round(e.domInteractive-e.startTime)}:null}catch{return null}}getConnectionInfo(){try{let e=navigator.connection;return e?{effectiveType:e.effectiveType||"unknown",downlink:e.downlink||0,rtt:e.rtt||0}:void 0}catch{return}}getMetrics(){return[...this.metrics]}recordCustomMetric(e,t){this.recordMetric(e,t)}measureDuration(e){let t=performance.now();return()=>{let n=performance.now()-t;this.recordMetric(e,n)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var S1="TgMatrixCache",w1=1,Bt="appState",St="offlineOperations",bd="2.1.1",E1=1440*60*1e3,bn=class i{constructor(e){this.ngZone=e;this.db=null;this.dbReady=!1;this.networkStatus=_("online");this.isOnline=G(()=>this.networkStatus()!=="offline");this.isPageVisible=_(!0);this.pendingOperations=_([]);this.hasPendingOperations=G(()=>this.pendingOperations().length>0);this.cachedState=_(null);this.isCacheValid=G(()=>{let e=this.cachedState();return!(!e||e.version!==bd||Date.now()-e.lastUpdated>E1)});this.initDatabase(),this.setupNetworkListener(),this.setupVisibilityListener()}async initDatabase(){return new Promise((e,t)=>{let n=indexedDB.open(S1,w1);n.onerror=()=>{console.error("[OfflineCache] Failed to open IndexedDB:",n.error),t(n.error)},n.onsuccess=()=>{this.db=n.result,this.dbReady=!0,console.log("[OfflineCache] \u2705 IndexedDB initialized"),this.loadCachedState(),this.loadPendingOperations(),e()},n.onupgradeneeded=o=>{let a=o.target.result;a.objectStoreNames.contains(Bt)||(a.createObjectStore(Bt,{keyPath:"id"}),console.log("[OfflineCache] Created state store")),a.objectStoreNames.contains(St)||(a.createObjectStore(St,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),console.log("[OfflineCache] Created operations store"))}})}setupNetworkListener(){if(window.addEventListener("online",()=>{this.ngZone.run(()=>{console.log("[OfflineCache] \u{1F310} Network online"),this.networkStatus.set("online"),this.syncPendingOperations()})}),window.addEventListener("offline",()=>{this.ngZone.run(()=>{console.log("[OfflineCache] \u{1F4F4} Network offline"),this.networkStatus.set("offline")})}),this.networkStatus.set(navigator.onLine?"online":"offline"),"connection"in navigator){let e=navigator.connection;e&&e.addEventListener("change",()=>{this.ngZone.run(()=>{let t=e.effectiveType;t==="slow-2g"||t==="2g"?this.networkStatus.set("slow"):navigator.onLine&&this.networkStatus.set("online")})})}}setupVisibilityListener(){document.addEventListener("visibilitychange",()=>{this.ngZone.run(()=>{let e=document.visibilityState==="visible";console.log(`[OfflineCache] \u{1F441}\uFE0F Page visibility: ${e?"visible":"hidden"}`),this.isPageVisible.set(e),e&&this.isOnline()&&window.dispatchEvent(new CustomEvent("page-became-visible"))})})}async cacheState(e){if(!this.dbReady||!this.db){console.warn("[OfflineCache] Database not ready");return}let t={accounts:e.accounts||[],keywordSets:e.keywordSets||[],monitoredGroups:e.monitoredGroups||[],campaigns:e.campaigns||[],leads:e.leads||[],settings:e.settings||{},lastUpdated:Date.now(),version:bd};try{let o=this.db.transaction([Bt],"readwrite").objectStore(Bt);await new Promise((a,d)=>{let m=o.put(F({id:"main"},t));m.onsuccess=()=>a(),m.onerror=()=>d(m.error)}),this.cachedState.set(t),console.log("[OfflineCache] \u2705 State cached")}catch(n){console.error("[OfflineCache] Failed to cache state:",n)}}async loadCachedState(){if(!this.dbReady||!this.db)return null;try{let n=this.db.transaction([Bt],"readonly").objectStore(Bt),o=await new Promise((a,d)=>{let m=n.get("main");m.onsuccess=()=>a(m.result),m.onerror=()=>d(m.error)});if(o){let e=o,{id:a}=e,d=Kn(e,["id"]);return this.cachedState.set(d),console.log("[OfflineCache] \u2705 Loaded cached state from",new Date(d.lastUpdated).toLocaleString()),d}return null}catch(t){return console.error("[OfflineCache] Failed to load cached state:",t),null}}async addOfflineOperation(e,t){if(!this.dbReady||!this.db){console.warn("[OfflineCache] Database not ready, operation not queued");return}let n={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,command:e,payload:t,timestamp:Date.now(),retryCount:0};try{let a=this.db.transaction([St],"readwrite").objectStore(St);await new Promise((d,m)=>{let f=a.put(n);f.onsuccess=()=>d(),f.onerror=()=>m(f.error)}),this.pendingOperations.update(d=>[...d,n]),console.log("[OfflineCache] \u2795 Queued offline operation:",e)}catch(o){console.error("[OfflineCache] Failed to queue operation:",o)}}async loadPendingOperations(){if(!(!this.dbReady||!this.db))try{let t=this.db.transaction([St],"readonly").objectStore(St),n=await new Promise((o,a)=>{let d=t.getAll();d.onsuccess=()=>o(d.result||[]),d.onerror=()=>a(d.error)});this.pendingOperations.set(n),n.length>0&&console.log("[OfflineCache] \u{1F4CB} Loaded",n.length,"pending operations")}catch(e){console.error("[OfflineCache] Failed to load pending operations:",e)}}async syncPendingOperations(){let e=this.pendingOperations();e.length!==0&&(console.log("[OfflineCache] \u{1F504} Syncing",e.length,"pending operations"),window.dispatchEvent(new CustomEvent("sync-offline-operations",{detail:{operations:e}})))}async removeOperation(e){if(!(!this.dbReady||!this.db))try{let n=this.db.transaction([St],"readwrite").objectStore(St);await new Promise((o,a)=>{let d=n.delete(e);d.onsuccess=()=>o(),d.onerror=()=>a(d.error)}),this.pendingOperations.update(o=>o.filter(a=>a.id!==e)),console.log("[OfflineCache] \u2705 Removed operation:",e)}catch(t){console.error("[OfflineCache] Failed to remove operation:",t)}}async clearCache(){if(!(!this.dbReady||!this.db))try{let e=this.db.transaction([Bt,St],"readwrite");await Promise.all([new Promise((t,n)=>{let o=e.objectStore(Bt).clear();o.onsuccess=()=>t(),o.onerror=()=>n(o.error)}),new Promise((t,n)=>{let o=e.objectStore(St).clear();o.onsuccess=()=>t(),o.onerror=()=>n(o.error)})]),this.cachedState.set(null),this.pendingOperations.set([]),console.log("[OfflineCache] \u{1F5D1}\uFE0F Cache cleared")}catch(e){console.error("[OfflineCache] Failed to clear cache:",e)}}getCacheStats(){let e=this.cachedState();return{stateAge:e?Date.now()-e.lastUpdated:-1,pendingCount:this.pendingOperations().length,isValid:this.isCacheValid()}}static{this.\u0275fac=function(t){return new(t||i)(Ke(We))}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Hn=new Set,yo=null;function A1(i){mr()&&(Hn.has(i)||(Hn.add(i),yo&&clearTimeout(yo),yo=setTimeout(()=>{Hn.size>0&&console.warn(`[i18n] ${Hn.size} missing translation key(s):`,Array.from(Hn).sort().join(", ")),yo=null},2e3)))}var xn=class i{constructor(){this.i18n=O(Xe)}transform(e,t){if(!e)return"";let n=this.i18n.t(e,t);return n===e&&mr()&&A1(e),n}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275pipe=ca({name:"i18n",type:i,pure:!1})}};var xd=i=>({count:i});function D1(i,e){if(i&1&&(l(0),ke(1,"i18n")),i&2){let t=g(3);D(" \xB7 ",Ht(1,1,"offline.pendingSync",ur(4,xd,t.pendingCount()))," ")}}function M1(i,e){if(i&1&&(P(0,"span",3),l(1,"\u{1F4F4}"),N(),P(2,"span",4),l(3),ke(4,"i18n"),S(5,D1,2,6),N()),i&2){let t=g(2);c(3),D(" ",Ne(4,2,"offline.networkOffline")," "),c(2),w(t.pendingCount()>0?5:-1)}}function T1(i,e){i&1&&(P(0,"span",3),l(1,"\u{1F40C}"),N(),P(2,"span",4),l(3),ke(4,"i18n"),N()),i&2&&(c(3),A(Ne(4,1,"offline.slowNetwork")))}function k1(i,e){if(i&1&&(P(0,"span",5),l(1,"\u{1F504}"),N(),P(2,"span",4),l(3),ke(4,"i18n"),N()),i&2){let t=g(2);c(3),A(Ht(4,1,"offline.syncing",ur(4,xd,t.pendingCount())))}}function I1(i,e){if(i&1&&(P(0,"div",1)(1,"div",2),S(2,M1,6,4),S(3,T1,5,3),S(4,k1,5,6),N()()),i&2){let t=g();de(t.barClass()),c(2),w(t.status()==="offline"?2:-1),c(),w(t.status()==="slow"?3:-1),c(),w(t.status()==="online"&&t.pendingCount()>0?4:-1)}}var So=class i{constructor(){this.offlineCache=O(bn);this.status=G(()=>this.offlineCache.networkStatus());this.pendingCount=G(()=>this.offlineCache.pendingOperations().length);this.shouldShow=G(()=>{let e=this.status(),t=this.pendingCount();return e==="offline"||e==="slow"||e==="online"&&t>0});this.barClass=G(()=>{let e=this.status(),t=this.pendingCount();return e==="offline"?"bar-offline":e==="slow"?"bar-slow":e==="online"&&t>0?"bar-syncing":""})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-offline-indicator"]],decls:1,vars:1,consts:[["role","alert","aria-live","assertive",1,"offline-bar",3,"class"],["role","alert","aria-live","assertive",1,"offline-bar"],[1,"offline-content"],[1,"offline-icon"],[1,"offline-text"],[1,"offline-icon","sync-spin"]],template:function(t,n){t&1&&S(0,I1,5,5,"div",0),t&2&&w(n.shouldShow()?0:-1)},dependencies:[te,xn],styles:[".offline-bar[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;z-index:9999;padding:8px 16px;font-size:13px;font-weight:500;transition:all .3s ease;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.offline-bar.bar-offline[_ngcontent-%COMP%]{background:#eab308f2;color:#92400e}.offline-bar.bar-slow[_ngcontent-%COMP%]{background:#f97316e6;color:#7c2d12}.offline-bar.bar-syncing[_ngcontent-%COMP%]{background:#22c55ee6;color:#14532d}.offline-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.offline-icon[_ngcontent-%COMP%]{font-size:16px}.sync-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})}};var yd={default:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdHWAgoOBgX98fX19e3t7e3t7e3t7e3t7e3t7e3t7fHx9fX5+f4CAgoKDhIWFhYWEg4KBgH9+fXx7enp5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl6enp7e3x8fX1+fn9/gICBgYKCg4ODhISEhISEg4OCgoGBgH9/fn59fXx8e3t7e3t7e3t7e3t7e3t7e3t7fHx9fX5+f4CAgoKDhIWFhYWEg4KBgH9+fXx7enp5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl6enp7e3x8fX1+fn9/gICBgYKCg4ODhISEhISEg4OCgoGBgH9/fn59fXx8e3t7e3t7e3t7e3t7e3t7e3t7",success:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAABhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=",warning:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACAgICAgICAgICAgH9/f39/f39/f39/f39/f4CAgICAgIGBgYGBgYGBgYGBgYGBgYCAgICAgH9/f39/f39/f39/f39/f39/gICAgICAgYGBgYGBgYGBgYGBgYGBgICAgICAf39/f39/f39/f39/f39/f3+AgICAgICBgYGBgYGBgYGBgYGBgYGAgICAgIB/f39/f39/f39/f39/f39/f4CAgICAgIGBgYGBgYGBgYGBgYGBgYCAgICAf39/f39/f39/f39/f39/f39/gICAgICAgYGBgYGBgYGBgYGBgYGBgICAgICA",error:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAAD/////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA////////////////////////gICAgICAgICAgICA",lead:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAABVVldYWVpbXF1eX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=",message:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAABgYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7//w=="},Sd={enabled:!0,desktop:!0,sound:!0,soundVolume:.5,doNotDisturb:!1,doNotDisturbSchedule:{enabled:!1,startTime:"22:00",endTime:"08:00"},priorities:{low:{enabled:!0,sound:!1,desktop:!1},normal:{enabled:!0,sound:!0,desktop:!0},high:{enabled:!0,sound:!0,desktop:!0},urgent:{enabled:!0,sound:!0,desktop:!0}},types:{info:{enabled:!0,sound:"default"},success:{enabled:!0,sound:"success"},warning:{enabled:!0,sound:"warning"},error:{enabled:!0,sound:"error"},lead:{enabled:!0,sound:"lead"},message:{enabled:!0,sound:"message"},system:{enabled:!0,sound:"default"}}},yn=class i{constructor(){this._notifications=_([]);this.notifications=this._notifications.asReadonly();this._settings=_(Sd);this.settings=this._settings.asReadonly();this.unreadCount=G(()=>this._notifications().filter(e=>!e.read).length);this.unreadByPriority=G(()=>{let e=this._notifications().filter(t=>!t.read);return{urgent:e.filter(t=>t.priority==="urgent").length,high:e.filter(t=>t.priority==="high").length,normal:e.filter(t=>t.priority==="normal").length,low:e.filter(t=>t.priority==="low").length}});this._desktopPermission=_("default");this.desktopPermission=this._desktopPermission.asReadonly();this.loadSettings(),this.loadNotifications(),this.checkDesktopPermission()}notify(e){let t={id:"notif-"+Date.now().toString(36)+Math.random().toString(36).substr(2,5),type:e.type||"info",priority:e.priority||"normal",title:e.title,body:e.body,icon:e.icon||this.getDefaultIcon(e.type||"info"),timestamp:new Date,read:!1,data:e.data,actions:e.actions,sound:e.sound??!0,desktop:e.desktop??!0,persistent:e.persistent??!1};return this.shouldNotify(t)?(this.addToHistory(t),t.sound&&this._settings().sound&&this.playSound(t.type),t.desktop&&this._settings().desktop&&this.showDesktopNotification(t),t):(this.addToHistory(t),t)}info(e,t,n){return this.notify(B(F({},n),{type:"info",title:e,body:t}))}success(e,t,n){return this.notify(B(F({},n),{type:"success",title:e,body:t}))}warning(e,t,n){return this.notify(B(F({},n),{type:"warning",priority:"high",title:e,body:t}))}error(e,t,n){return this.notify(B(F({},n),{type:"error",priority:"urgent",title:e,body:t}))}lead(e,t,n){return this.notify(B(F({},n),{type:"lead",priority:"high",title:"\u{1F3AF} \u65B0\u6F5B\u5728\u5BA2\u6236",body:`${e} \u4F86\u81EA ${t}`,icon:"\u{1F3AF}"}))}message(e,t,n){return this.notify(B(F({},n),{type:"message",title:`\u{1F4AC} ${e}`,body:t.length>100?t.substring(0,100)+"...":t,icon:"\u{1F4AC}"}))}markAsRead(e){this._notifications.update(t=>t.map(n=>n.id===e?B(F({},n),{read:!0}):n)),this.saveNotifications()}markAllAsRead(){this._notifications.update(e=>e.map(t=>B(F({},t),{read:!0}))),this.saveNotifications()}remove(e){this._notifications.update(t=>t.filter(n=>n.id!==e)),this.saveNotifications()}clearAll(){this._notifications.set([]),this.saveNotifications()}clearRead(){this._notifications.update(e=>e.filter(t=>!t.read)),this.saveNotifications()}updateSettings(e){this._settings.update(t=>F(F({},t),e)),this.saveSettings()}toggleDoNotDisturb(){this._settings.update(e=>B(F({},e),{doNotDisturb:!e.doNotDisturb})),this.saveSettings()}async requestDesktopPermission(){if(!("Notification"in window))return!1;let e=await Notification.requestPermission();return this._desktopPermission.set(e),e==="granted"}addToHistory(e){this._notifications.update(t=>[e,...t].slice(0,100)),this.saveNotifications()}shouldNotify(e){let t=this._settings();return!(!t.enabled||t.doNotDisturb&&e.priority!=="urgent"||t.doNotDisturbSchedule?.enabled&&this.isInDoNotDisturbTime()&&e.priority!=="urgent"||!t.priorities[e.priority].enabled||!t.types[e.type].enabled)}isInDoNotDisturbTime(){let e=this._settings().doNotDisturbSchedule;if(!e?.enabled)return!1;let t=new Date,n=t.getHours()*60+t.getMinutes(),[o,a]=e.startTime.split(":").map(Number),[d,m]=e.endTime.split(":").map(Number),f=o*60+a,h=d*60+m;return f<h?n>=f&&n<h:n>=f||n<h}playSound(e){let t=this._settings(),n=t.types[e]?.sound||"default",o=yd[n]||yd.default;try{let a=new Audio(o);a.volume=t.soundVolume,a.play().catch(d=>console.warn("Failed to play notification sound:",d))}catch(a){console.warn("Failed to create audio:",a)}}showDesktopNotification(e){if("Notification"in window&&Notification.permission==="granted")try{let t=new Notification(e.title,{body:e.body,icon:e.icon,tag:e.id,requireInteraction:e.persistent});t.onclick=()=>{window.focus(),this.markAsRead(e.id),t.close()},e.persistent||setTimeout(()=>t.close(),5e3)}catch(t){console.warn("Failed to show desktop notification:",t)}}getDefaultIcon(e){return{info:"\u2139\uFE0F",success:"\u2705",warning:"\u26A0\uFE0F",error:"\u274C",lead:"\u{1F3AF}",message:"\u{1F4AC}",system:"\u2699\uFE0F"}[e]}checkDesktopPermission(){"Notification"in window&&this._desktopPermission.set(Notification.permission)}loadSettings(){try{let e=localStorage.getItem("tg-matrix-notification-settings");e&&this._settings.set(F(F({},Sd),JSON.parse(e)))}catch(e){console.error("Failed to load notification settings:",e)}}saveSettings(){try{localStorage.setItem("tg-matrix-notification-settings",JSON.stringify(this._settings()))}catch(e){console.error("Failed to save notification settings:",e)}}loadNotifications(){try{let e=localStorage.getItem("tg-matrix-notifications");if(e){let t=JSON.parse(e).map(n=>B(F({},n),{timestamp:new Date(n.timestamp)}));this._notifications.set(t)}}catch(e){console.error("Failed to load notifications:",e)}}saveNotifications(){try{localStorage.setItem("tg-matrix-notifications",JSON.stringify(this._notifications()))}catch(e){console.error("Failed to save notifications:",e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Sn=class i{constructor(){this._isOnline=_(navigator.onLine);this._status=_(navigator.onLine?"online":"offline");this._lastOfflineTime=_(null);this._networkEvents=new Wn;this.isOnline=G(()=>this._isOnline());this.status=G(()=>this._status());this.isOffline=G(()=>!this._isOnline());this.networkEvents$=this._networkEvents.asObservable();this.online$=na(ar(window,"online").pipe(sr(()=>!0)),ar(window,"offline").pipe(sr(()=>!1))).pipe(oa(navigator.onLine),ia()),this.online$.subscribe(e=>{if(this._isOnline.set(e),this._status.set(e?"online":"offline"),!e)this._lastOfflineTime.set(Date.now()),this._networkEvents.next({status:"offline",timestamp:Date.now(),message:"\u7DB2\u7D61\u9023\u63A5\u5DF2\u65B7\u958B"}),console.warn("[NetworkService] Network offline");else{let t=this._lastOfflineTime()?Math.round((Date.now()-this._lastOfflineTime())/1e3):0;this._networkEvents.next({status:"online",timestamp:Date.now(),message:t>0?`\u7DB2\u7D61\u5DF2\u6062\u5FA9\uFF08\u96E2\u7DDA ${t} \u79D2\uFF09`:"\u7DB2\u7D61\u5DF2\u9023\u63A5"}),console.log("[NetworkService] Network online")}}),this.checkNetworkSpeed()}ngOnDestroy(){this._networkEvents.complete()}checkNetworkSpeed(){let e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e&&e.addEventListener("change",()=>{let t=e.effectiveType;["slow-2g","2g"].includes(t)?(this._status.set("slow"),this._networkEvents.next({status:"slow",timestamp:Date.now(),message:"\u7DB2\u7D61\u9023\u63A5\u8F03\u6162\uFF0C\u90E8\u5206\u529F\u80FD\u53EF\u80FD\u5EF6\u9072"})):this._status()==="slow"&&this._isOnline()&&this._status.set("online")})}async checkConnection(){try{let t=(await fetch("/api/health",{method:"HEAD",cache:"no-store"})).ok;return this._isOnline.set(t),this._status.set(t?"online":"offline"),t}catch{return this._isOnline.set(!1),this._status.set("offline"),!1}}getStatusMessage(){switch(this._status()){case"online":return"\u7DB2\u7D61\u9023\u63A5\u6B63\u5E38";case"offline":return"\u7DB2\u7D61\u5DF2\u65B7\u958B\uFF0C\u8ACB\u6AA2\u67E5\u60A8\u7684\u7DB2\u7D61\u9023\u63A5";case"slow":return"\u7DB2\u7D61\u9023\u63A5\u8F03\u6162\uFF0C\u8ACB\u8010\u5FC3\u7B49\u5F85";default:return""}}getStatusIcon(){switch(this._status()){case"online":return"\u{1F7E2}";case"offline":return"\u{1F534}";case"slow":return"\u{1F7E1}";default:return""}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var wo=class i{constructor(){this.authService=O(xt);this.networkService=O(Sn);this.authEvents=O(rn);this.ws=null;this.reconnectTimer=null;this.heartbeatTimer=null;this.networkSubscription=null;this.authSubscription=null;this.HEARTBEAT_INTERVAL=3e4;this.RECONNECT_DELAY=3e3;this.MAX_RECONNECT_ATTEMPTS=10;this._isConnected=_(!1);this._reconnectAttempts=_(0);this._connectionId=_("");this.isConnected=G(()=>this._isConnected());this.connectionId=G(()=>this._connectionId());this.handlers=new Map;this.offlineQueue=[];this.subscriptions=new Set;gr.apiMode==="http"&&(this.initConnectionWatcher(),this.initNetworkWatcher(),this.initAuthWatcher())}ngOnDestroy(){this.disconnect(),this.networkSubscription?.unsubscribe(),this.authSubscription?.unsubscribe()}initConnectionWatcher(){let e=()=>{this.authService.isAuthenticated()&&!this._isConnected()?this.connect():!this.authService.isAuthenticated()&&this._isConnected()&&this.disconnect()};setInterval(e,5e3),setTimeout(e,1e3)}initNetworkWatcher(){this.networkSubscription=this.networkService.online$.subscribe(e=>{e&&this.authService.isAuthenticated()&&!this._isConnected()&&(console.log("[RealtimeService] Network restored, reconnecting WebSocket..."),this._reconnectAttempts.set(0),this.connect())})}initAuthWatcher(){this.authSubscription=this.authEvents.authEvents$.subscribe(e=>{e.type==="login"?(console.log("[RealtimeService] Login event, connecting WebSocket..."),setTimeout(()=>this.connect(),500)):e.type==="logout"&&(console.log("[RealtimeService] Logout event, disconnecting WebSocket..."),this.disconnect())})}connect(){if(gr.apiMode!=="ipc"&&this.ws?.readyState!==WebSocket.OPEN)try{let e=this.getWebSocketUrl(),t=this.authService.accessToken();if(!t){console.warn("No access token, skipping WebSocket connection");return}this.ws=new WebSocket(`${e}?token=${t}`),this.ws.onopen=()=>{console.log("WebSocket connected"),this._isConnected.set(!0),this._reconnectAttempts.set(0),this.startHeartbeat(),this.processOfflineQueue(),this.resubscribe()},this.ws.onmessage=n=>{this.handleMessage(n.data)},this.ws.onclose=n=>{console.log("WebSocket closed:",n.code,n.reason),this._isConnected.set(!1),this.stopHeartbeat(),this._reconnectAttempts()<this.MAX_RECONNECT_ATTEMPTS&&this.scheduleReconnect()},this.ws.onerror=n=>{console.error("WebSocket error:",n)}}catch(e){console.error("WebSocket connection error:",e)}}disconnect(){this.clearReconnectTimer(),this.stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=null),this._isConnected.set(!1)}send(e,t={}){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return!1;try{return this.ws.send(JSON.stringify({type:e,data:t})),!0}catch(n){return console.error("Send error:",n),!1}}subscribe(e){this.subscriptions.add(e),this._isConnected()?this.send("subscribe",{channel:e}):this.offlineQueue.push({channel:e,action:"subscribe"})}unsubscribe(e){this.subscriptions.delete(e),this._isConnected()?this.send("unsubscribe",{channel:e}):this.offlineQueue.push({channel:e,action:"unsubscribe"})}on(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{this.off(e,t)}}off(e,t){let n=this.handlers.get(e);n&&n.delete(t)}once(e,t){let n=o=>{t(o),this.off(e,n)};return this.on(e,n)}handleMessage(e){try{let t=JSON.parse(e);if(t.type==="connected"){this._connectionId.set(t.data?.connection_id||"");return}if(t.type==="pong")return;if(t.type==="ping"){this.send("pong");return}let n=this.handlers.get(t.type);n&&n.forEach(a=>{try{a(t)}catch(d){console.error("Event handler error:",d)}});let o=this.handlers.get("*");o&&o.forEach(a=>{try{a(t)}catch(d){console.error("Wildcard handler error:",d)}})}catch(t){console.error("Parse message error:",t)}}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=setInterval(()=>{this.send("ping")},this.HEARTBEAT_INTERVAL)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}scheduleReconnect(){this.clearReconnectTimer();let e=this._reconnectAttempts(),t=this.RECONNECT_DELAY*Math.pow(1.5,e);console.log(`Reconnecting in ${t}ms (attempt ${e+1})`),this.reconnectTimer=setTimeout(()=>{this._reconnectAttempts.update(n=>n+1),this.connect()},t)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}processOfflineQueue(){for(;this.offlineQueue.length>0;){let e=this.offlineQueue.shift();this.send(e.action,{channel:e.channel})}}resubscribe(){for(let e of this.subscriptions)this.send("subscribe",{channel:e})}getWebSocketUrl(){return window.location.hostname==="localhost"&&window.location.port==="4200"?"ws://localhost:8000/ws":`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Eo=class i{constructor(){this.realtime=O(wo);this.bizApi=O(ii);this.notifService=O(yn);this._notifications=_([]);this.notifications=this._notifications.asReadonly();this.unreadCount=G(()=>this._notifications().filter(e=>!e.read).length);this._lastEvent=_(null);this.lastEvent=this._lastEvent.asReadonly();this._queueStats=_({completed:0,retrying:0,deadLetter:0,lastUpdated:""});this.queueStats=this._queueStats.asReadonly();this.unsubscribers=[];this.initSubscriptions()}ngOnDestroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[]}initSubscriptions(){this.realtime.subscribe("business:event"),this.realtime.subscribe("lead:scoring"),this.realtime.subscribe("ab:test"),this.realtime.subscribe("message:status"),this.unsubscribers.push(this.realtime.on("business:event",e=>this.handleBusinessEvent(e)),this.realtime.on("lead:scoring",e=>this.handleScoringEvent(e)),this.realtime.on("ab:test",e=>this.handleABTestEvent(e)),this.realtime.on("message:status",e=>this.handleMessageStatus(e)))}handleBusinessEvent(e){this._lastEvent.set(e),(e.data?.event||"")==="dedup:completed"&&(this.addNotification("success","\u53BB\u91CD\u5B8C\u6210",`\u767C\u73FE ${e.data?.groups||0} \u7D44\u91CD\u8907\u806F\u7E6B\u4EBA`),this.bizApi.scanDuplicates())}handleScoringEvent(e){this._lastEvent.set(e);let t=e.data||{};this.addNotification("success","\u7DDA\u7D22\u8A55\u5206\u5B8C\u6210",`\u5DF2\u8A55\u5206 ${t.scored_count||0} \u689D\u7DDA\u7D22\uFF0C${t.hot||0} \u689D\u71B1\u9580`),this.bizApi.loadSummary()}handleABTestEvent(e){this._lastEvent.set(e);let t=e.data||{},n=t.event||"";n==="ab_test:completed"?(this.addNotification("success","A/B \u6E2C\u8A66\u5B8C\u6210",`${t.test_name||"N/A"} \u6E2C\u8A66\u5B8C\u6210\uFF0C\u8D0F\u5BB6: ${t.winner||"N/A"}`),this.bizApi.loadABTests()):n==="ab_test:created"&&(this.addNotification("info","\u65B0 A/B \u6E2C\u8A66",`\u5DF2\u5275\u5EFA\u6E2C\u8A66: ${t.test_name||"N/A"}`),this.bizApi.loadABTests())}handleMessageStatus(e){let t=e.data||{},n=t.event||"";this._queueStats.update(o=>{let a=B(F({},o),{lastUpdated:new Date().toISOString()});return n==="message:completed"?a.completed=o.completed+1:n==="message:retrying"?a.retrying=o.retrying+1:n==="message:dead_letter"&&(a.deadLetter=o.deadLetter+1,this.addNotification("warning","\u6D88\u606F\u9001\u9054\u5931\u6557",`\u6D88\u606F ${t.message_id||""} \u5DF2\u9032\u5165\u6B7B\u4FE1\u968A\u5217: ${t.reason||""}`)),a})}addNotification(e,t,n){let o={id:`n_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,type:e,title:t,message:n,timestamp:new Date,read:!1};this._notifications.update(d=>[o,...d].slice(0,50));let a={info:"info",success:"success",warning:"warning",error:"error"};try{this.notifService.notify({type:a[e]||"info",title:t,body:n,priority:e==="warning"||e==="error"?"high":"normal"})}catch{}}markAsRead(e){this._notifications.update(t=>t.map(n=>n.id===e?B(F({},n),{read:!0}):n))}markAllAsRead(){this._notifications.update(e=>e.map(t=>B(F({},t),{read:!0})))}clearNotifications(){this._notifications.set([])}resetQueueStats(){this._queueStats.set({completed:0,retrying:0,deadLetter:0,lastUpdated:""})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var wd=(i,e)=>e.id;function P1(i,e){if(i&1&&(P(0,"span",3),l(1),N()),i&2){let t=g();c(),A(t.unreadCount()>99?"99+":t.unreadCount())}}function F1(i,e){if(i&1){let t=M();P(0,"button",15),ke(1,"i18n"),oe("click",function(){v(t);let o=g(2);return b(o.markAllRead())}),l(2),ke(3,"i18n"),N()}i&2&&(Je("title",Ne(1,2,"notification.markAllRead")),c(2),D(" \u2713 ",Ne(3,4,"notification.markAllRead")," "))}function N1(i,e){if(i&1){let t=M();P(0,"button",16),oe("click",function(){v(t);let o=g(2);return b(o.clearAll())}),l(1," \u{1F5D1}\uFE0F "),N()}}function R1(i,e){if(i&1&&(P(0,"span",19),l(1),N()),i&2){let t=g(3);c(),D("\u{1F480} ",t.queueStats().deadLetter)}}function O1(i,e){if(i&1&&(P(0,"div",10)(1,"span",17),l(2),N(),P(3,"span",18),l(4),N(),S(5,R1,2,1,"span",19),N()),i&2){let t=g(2);c(2),D("\u2705 ",t.queueStats().completed),c(2),D("\u{1F504} ",t.queueStats().retrying),c(),w(t.queueStats().deadLetter>0?5:-1)}}function B1(i,e){if(i&1&&(P(0,"span",21),l(1),N()),i&2){let t=g().$implicit,n=g(2);c(),A(n.getCountByType(t.id))}}function V1(i,e){if(i&1){let t=M();P(0,"button",20),oe("click",function(){let o=v(t).$implicit,a=g(2);return b(a.activeFilter.set(o.id))}),l(1),S(2,B1,2,1,"span",21),N()}if(i&2){let t=e.$implicit,n=g(2);I("active",n.activeFilter()===t.id),Et("aria-selected",n.activeFilter()===t.id),c(),D(" ",t.label," "),c(),w(t.id!=="all"&&n.getCountByType(t.id)>0?2:-1)}}function L1(i,e){i&1&&(P(0,"div",14)(1,"span",22),l(2,"\u{1F4ED}"),N(),P(3,"p"),l(4),ke(5,"i18n"),N()()),i&2&&(c(4),A(Ne(5,1,"notification.empty")))}function G1(i,e){if(i&1){let t=M();P(0,"div",24),oe("click",function(){let o=v(t).$implicit,a=g(3);return b(a.onNotifClick(o))}),P(1,"div",25),l(2),N(),P(3,"div",26)(4,"div",27),l(5),N(),P(6,"div",28),l(7),N(),P(8,"div",29),l(9),ke(10,"date"),N()(),P(11,"button",30),oe("click",function(o){let a=v(t).$implicit,d=g(3);return b(d.dismiss(a.id,o))}),l(12," \xD7 "),N()()}if(i&2){let t=e.$implicit,n=g(3);I("unread",!t.read),c(2),A(n.getTypeIcon(t.type)),c(3),A(t.title),c(2),A(t.body),c(2),A(Ht(10,6,t.timestamp,"MM/dd HH:mm"))}}function U1(i,e){if(i&1&&$(0,G1,13,9,"div",23,wd),i&2){let t=g(2);H(t.filteredNotifications())}}function q1(i,e){if(i&1&&(P(0,"div",4)(1,"div",5)(2,"h3",6),l(3),ke(4,"i18n"),N(),P(5,"div",7),S(6,F1,4,6,"button",8),S(7,N1,2,0,"button",9),N()(),S(8,O1,6,3,"div",10),P(9,"div",11),$(10,V1,3,5,"button",12,wd),N(),P(12,"div",13),S(13,L1,6,3,"div",14)(14,U1,2,0),N()()),i&2){let t=g();c(3),A(Ne(4,5,"notification.center")),c(3),w(t.unreadCount()>0?6:-1),c(),w(t.filteredNotifications().length>0?7:-1),c(),w(t.queueStats().lastUpdated?8:-1),c(2),H(t.filterTabs),c(3),w(t.filteredNotifications().length===0?13:14)}}var Ao=class i{constructor(){this.notifService=O(yn);this.bizEvents=O(Eo);this.elementRef=O(ra);this.isOpen=_(!1);this.activeFilter=_("all");this.unreadCount=G(()=>this.notifService.unreadCount());this.queueStats=this.bizEvents.queueStats;this.filterTabs=[{id:"all",label:"\u5168\u90E8"},{id:"system",label:"\u7CFB\u7D71"},{id:"warning",label:"\u544A\u8B66"},{id:"error",label:"\u932F\u8AA4"},{id:"lead",label:"\u6F5B\u5BA2"},{id:"success",label:"\u6210\u529F"}];this.filteredNotifications=G(()=>{let e=this.notifService.notifications(),t=this.activeFilter();return[...t==="all"?e:e.filter(o=>o.type===t)].sort((o,a)=>o.read!==a.read?o.read?1:-1:new Date(a.timestamp).getTime()-new Date(o.timestamp).getTime())})}onDocumentClick(e){this.isOpen()&&!this.elementRef.nativeElement.contains(e.target)&&this.isOpen.set(!1)}onEscPress(){this.isOpen.set(!1)}togglePanel(){this.isOpen.update(e=>!e)}markAllRead(){this.notifService.markAllAsRead()}clearAll(){this.notifService.clearAll()}dismiss(e,t){t.stopPropagation(),this.notifService.remove(e)}onNotifClick(e){e.read||this.notifService.markAsRead(e.id),e.actions?.length&&(e.actions[0].handler(),this.isOpen.set(!1))}getTypeIcon(e){return{info:"\u2139\uFE0F",success:"\u2705",warning:"\u26A0\uFE0F",error:"\u274C",lead:"\u{1F3AF}",message:"\u{1F4AC}",system:"\u{1F527}"}[e]||"\u{1F4CC}"}getCountByType(e){return e==="all"?this.notifService.notifications().length:this.notifService.notifications().filter(t=>t.type===e&&!t.read).length}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-notification-center"]],hostBindings:function(t,n){t&1&&x("click",function(a){return n.onDocumentClick(a)},qt)("keydown.escape",function(){return n.onEscPress()},qt)},decls:8,vars:9,consts:[["role","region","aria-label","\u901A\u77E5\u4E2D\u5FC3",1,"notification-center"],["aria-haspopup","true",1,"bell-btn",3,"click","title"],["aria-hidden","true",1,"bell-icon"],["aria-hidden","true",1,"badge"],["role","dialog","aria-label","\u901A\u77E5\u5217\u8868","tabindex","-1",1,"panel"],[1,"panel-header"],["id","notification-panel-title",1,"panel-title"],[1,"panel-actions"],[1,"action-btn",3,"title"],["title","\u6E05\u7A7A",1,"action-btn","danger"],[1,"queue-stats-bar"],["role","tablist","aria-label","\u901A\u77E5\u5206\u985E",1,"filter-tabs"],["role","tab",1,"filter-tab",3,"active"],["role","tabpanel","aria-label","\u901A\u77E5\u5217\u8868",1,"notification-list"],[1,"empty-state"],[1,"action-btn",3,"click","title"],["title","\u6E05\u7A7A",1,"action-btn","danger",3,"click"],[1,"qs-item","qs-ok"],[1,"qs-item","qs-retry"],[1,"qs-item","qs-dead"],["role","tab",1,"filter-tab",3,"click"],[1,"tab-count"],[1,"empty-icon"],[1,"notification-item",3,"unread"],[1,"notification-item",3,"click"],[1,"notif-icon"],[1,"notif-content"],[1,"notif-title"],[1,"notif-body"],[1,"notif-time"],["title","\u79FB\u9664",1,"notif-dismiss",3,"click"]],template:function(t,n){t&1&&(P(0,"div",0)(1,"button",1),ke(2,"i18n"),ke(3,"i18n"),oe("click",function(){return n.togglePanel()}),P(4,"span",2),l(5,"\u{1F514}"),N(),S(6,P1,2,1,"span",3),N(),S(7,q1,15,7,"div",4),N()),t&2&&(c(),Je("title",Ne(2,5,"notification.title")+" ("+n.unreadCount()+")"),Et("aria-expanded",n.isOpen())("aria-label",Ne(3,7,"notification.title")+", "+n.unreadCount()+" \u672A\u8B80"),c(5),w(n.unreadCount()>0?6:-1),c(),w(n.isOpen()?7:-1))},dependencies:[te,Xn,xn],styles:[".notification-center[_ngcontent-%COMP%]{position:relative}.bell-btn[_ngcontent-%COMP%]{position:relative;background:none;border:none;cursor:pointer;padding:6px 8px;border-radius:8px;transition:background .2s;font-size:18px}.bell-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.badge[_ngcontent-%COMP%]{position:absolute;top:0;right:0;min-width:18px;height:18px;background:#ef4444;color:#fff;font-size:10px;font-weight:700;border-radius:9px;display:flex;align-items:center;justify-content:center;padding:0 4px;line-height:1}.panel[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:380px;max-height:520px;background:var(--theme-surface, #1e293b);border:1px solid var(--theme-border, #334155);border-radius:12px;box-shadow:0 20px 60px #0006;z-index:10000;display:flex;flex-direction:column;overflow:hidden;animation:_ngcontent-%COMP%_slideDown .2s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 10px;border-bottom:1px solid var(--theme-border, #334155)}.panel-title[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:var(--theme-text, #e2e8f0);margin:0}.panel-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.action-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--theme-text-muted, #94a3b8);cursor:pointer;font-size:12px;padding:4px 8px;border-radius:6px;transition:all .15s}.action-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;color:var(--theme-text, #e2e8f0)}.action-btn.danger[_ngcontent-%COMP%]:hover{color:#ef4444}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:2px;padding:8px 12px;overflow-x:auto;border-bottom:1px solid var(--theme-border, #334155)}.filter-tab[_ngcontent-%COMP%]{background:none;border:none;color:var(--theme-text-muted, #94a3b8);cursor:pointer;font-size:12px;padding:4px 10px;border-radius:6px;white-space:nowrap;transition:all .15s;display:flex;align-items:center;gap:4px}.filter-tab[_ngcontent-%COMP%]:hover{background:#ffffff0f}.filter-tab.active[_ngcontent-%COMP%]{background:var(--theme-primary, #3b82f6);color:#fff}.tab-count[_ngcontent-%COMP%]{background:#fff3;border-radius:8px;padding:0 5px;font-size:10px;min-width:16px;text-align:center}.notification-list[_ngcontent-%COMP%]{overflow-y:auto;flex:1;max-height:380px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:var(--theme-text-muted, #94a3b8)}.empty-icon[_ngcontent-%COMP%]{font-size:32px;margin-bottom:8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.notification-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:10px;padding:12px 16px;border-bottom:1px solid var(--theme-border, rgba(255,255,255,.05));cursor:pointer;transition:background .15s;position:relative}.notification-item[_ngcontent-%COMP%]:hover{background:#ffffff0a}.notification-item.unread[_ngcontent-%COMP%]{background:#3b82f60f;border-left:3px solid var(--theme-primary, #3b82f6)}.notif-icon[_ngcontent-%COMP%]{font-size:20px;flex-shrink:0;margin-top:2px}.notif-content[_ngcontent-%COMP%]{flex:1;min-width:0}.notif-title[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:var(--theme-text, #e2e8f0);line-height:1.3}.notif-body[_ngcontent-%COMP%]{font-size:12px;color:var(--theme-text-muted, #94a3b8);margin-top:2px;line-height:1.4;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.notif-time[_ngcontent-%COMP%]{font-size:11px;color:var(--theme-text-muted, #64748b);margin-top:4px}.notif-dismiss[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;background:none;border:none;color:var(--theme-text-muted, #64748b);cursor:pointer;font-size:16px;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .15s}.notification-item[_ngcontent-%COMP%]:hover   .notif-dismiss[_ngcontent-%COMP%]{opacity:1}.notif-dismiss[_ngcontent-%COMP%]:hover{color:#ef4444;background:#ef44441a}.queue-stats-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:6px 16px;background:#0f172a80;border-bottom:1px solid var(--theme-border, #334155);font-size:11px}.qs-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:3px}.qs-ok[_ngcontent-%COMP%]{color:#22c55e}.qs-retry[_ngcontent-%COMP%]{color:#f59e0b}.qs-dead[_ngcontent-%COMP%]{color:#ef4444;font-weight:600}@media(max-width:480px){.panel[_ngcontent-%COMP%]{position:fixed;top:60px;left:8px;right:8px;width:auto;max-height:calc(100vh - 80px)}}"]})}};var Ed="tg-matrix-audit-log",Xs=500,$1=300*1e3,Do=class i{constructor(){this.ipc=O(ye);this._entries=_([]);this.entries=this._entries.asReadonly();this.entryCount=G(()=>this._entries().length);this.reportTimer=null;this.pendingReport=[];this.loadFromStorage(),this.startPeriodicReport()}ngOnDestroy(){this.reportTimer&&clearInterval(this.reportTimer),this.flushReport()}track(e,t={},n="info"){let o={id:`audit_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,action:e,severity:n,timestamp:Date.now(),details:t,userId:this.getCurrentUserId()};this._entries.update(a=>{let d=[o,...a];return d.length>Xs?d.slice(0,Xs):d}),this.pendingReport.push(o),this.saveToStorage()}trackLogin(e){this.track("auth.login",{username:e})}trackLogout(){this.track("auth.logout",{})}trackAccountAdd(e,t){this.track("account.add",{accountId:e,phone:t})}trackAccountRemove(e){this.track("account.remove",{accountId:e})}trackViewChange(e,t){this.track("nav.view_change",{from:e,to:t},"info")}trackSettingsChange(e,t,n){this.track("settings.profile_update",{setting:e,oldValue:t,newValue:n})}trackError(e,t){this.track("system.error",F({error:e},t),"error")}trackQuotaExceeded(e,t,n){this.track("quota.exceeded",{quotaType:e,current:t,limit:n},"warning")}query(e={}){let t=this._entries();return e.action&&(t=t.filter(n=>n.action===e.action)),e.severity&&(t=t.filter(n=>n.severity===e.severity)),e.startTime&&(t=t.filter(n=>n.timestamp>=e.startTime)),e.endTime&&(t=t.filter(n=>n.timestamp<=e.endTime)),e.limit&&(t=t.slice(0,e.limit)),t}exportAsJson(){return JSON.stringify(this._entries(),null,2)}clearLocal(){this._entries.set([]),this.saveToStorage()}getCurrentUserId(){try{let e=localStorage.getItem("tg-matrix-user");if(e){let t=JSON.parse(e);return t.id?.toString()||t.username}}catch{}}loadFromStorage(){try{let e=localStorage.getItem(Ed);if(e){let t=JSON.parse(e);this._entries.set(t.slice(0,Xs))}}catch(e){console.warn("[AuditTracker] Failed to load from storage:",e)}}saveToStorage(){try{localStorage.setItem(Ed,JSON.stringify(this._entries()))}catch(e){console.warn("[AuditTracker] Failed to save to storage:",e)}}startPeriodicReport(){this.reportTimer=setInterval(()=>this.flushReport(),$1)}flushReport(){if(this.pendingReport.length===0)return;let e=[...this.pendingReport];this.pendingReport=[];try{this.ipc.send("audit-log-batch",{entries:e})}catch{this.pendingReport.push(...e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Mo=class i{constructor(){this.tasks=_(new Map);this.connectionState=_({stage:"connecting",progress:0,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()});this.showConnectionStatus=_(!0);this.isLoading=G(()=>{let e=this.tasks();for(let t of e.values())if(t.blocking!==!1)return!0;return!1});this.currentTask=G(()=>{let e=this.tasks();if(e.size===0)return null;let t=Array.from(e.values());return t[t.length-1]});this.message=G(()=>this.currentTask()?.message||"");this.progress=G(()=>this.currentTask()?.progress);this.taskCount=G(()=>this.tasks().size);this.connectionProgressTimer=null}start(e="\u8F09\u5165\u4E2D...",t){let n=t||this.generateId();return this.tasks.update(o=>{let a=new Map(o);return a.set(n,{id:n,message:e,startTime:Date.now(),type:"spinner"}),a}),n}startWithProgress(e,t){let n=t||this.generateId();return this.tasks.update(o=>{let a=new Map(o);return a.set(n,{id:n,message:e,progress:0,startTime:Date.now(),type:"progress"}),a}),n}updateProgress(e,t,n){this.tasks.update(o=>{let a=new Map(o),d=a.get(e);return d&&a.set(e,B(F({},d),{progress:Math.min(100,Math.max(0,t)),message:n||d.message})),a})}updateMessage(e,t){this.tasks.update(n=>{let o=new Map(n),a=o.get(e);return a&&o.set(e,B(F({},a),{message:t})),o})}stop(e){this.tasks.update(t=>{let n=new Map(t);return n.delete(e),n})}stopAll(){this.tasks.set(new Map)}async wrap(e,t="\u8F09\u5165\u4E2D..."){let n=this.start(t);try{return await e}finally{this.stop(n)}}async wrapWithProgress(e,t="\u8655\u7406\u4E2D..."){let n=this.startWithProgress(t);try{return await e((a,d)=>{this.updateProgress(n,a,d)})}finally{this.stop(n)}}generateId(){return"load-"+Date.now().toString(36)+Math.random().toString(36).substr(2,5)}startConnection(){this.showConnectionStatus.set(!0),this.connectionState.set({stage:"connecting",progress:5,message:"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",startTime:Date.now()}),this.simulateConnectionProgress()}simulateConnectionProgress(){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=setInterval(()=>{let e=this.connectionState();e.stage==="connecting"&&e.progress<25?this.connectionState.update(t=>B(F({},t),{progress:Math.min(25,t.progress+2)})):e.stage==="loading-data"&&e.progress<75&&this.connectionState.update(t=>B(F({},t),{progress:Math.min(75,t.progress+1)}))},200)}updateConnectionStage(e,t){let n={connecting:10,"loading-data":40,initializing:70,ready:100,error:0};this.connectionState.update(o=>B(F({},o),{stage:e,progress:n[e],message:t||this.getStageMessage(e)})),(e==="ready"||e==="error")&&(this.connectionProgressTimer&&(clearInterval(this.connectionProgressTimer),this.connectionProgressTimer=null),e==="ready"&&setTimeout(()=>{this.showConnectionStatus.set(!1)},500))}connectionError(e){this.connectionProgressTimer&&clearInterval(this.connectionProgressTimer),this.connectionState.set({stage:"error",progress:0,message:"\u9023\u63A5\u5931\u6557",startTime:Date.now(),error:e})}hideConnectionStatus(){this.showConnectionStatus.set(!1)}getStageMessage(e){switch(e){case"connecting":return"\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...";case"loading-data":return"\u6B63\u5728\u8F09\u5165\u6578\u64DA...";case"initializing":return"\u6B63\u5728\u521D\u59CB\u5316...";case"ready":return"\u9023\u63A5\u6210\u529F";case"error":return"\u9023\u63A5\u5931\u6557"}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var To=class i{constructor(e){this.ngZone=e;this.status=_({registered:!1,active:!1,waiting:!1,updateAvailable:!1,version:null});this.cacheStats=_({});this.isSupported="serviceWorker"in navigator;this.registration=null;this.isSupported?this.init():console.log("[SwManager] Service Worker not supported")}async init(){if(location.protocol!=="https:"&&location.hostname!=="localhost"){console.log("[SwManager] Skipping SW registration (not HTTPS)");return}try{navigator.serviceWorker.addEventListener("message",e=>{this.handleSwMessage(e)}),this.registration=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),console.log("[SwManager] \u2705 Service Worker registered"),this.ngZone.run(()=>{this.status.update(e=>B(F({},e),{registered:!0}))}),this.monitorRegistration(),this.checkForUpdates()}catch(e){console.error("[SwManager] Registration failed:",e)}}monitorRegistration(){this.registration&&(this.registration.active&&this.ngZone.run(()=>{this.status.update(e=>B(F({},e),{active:!0}))}),this.registration.waiting&&this.ngZone.run(()=>{this.status.update(e=>B(F({},e),{waiting:!0,updateAvailable:!0}))}),this.registration.addEventListener("updatefound",()=>{console.log("[SwManager] Update found");let e=this.registration.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(console.log("[SwManager] New version available"),this.ngZone.run(()=>{this.status.update(t=>B(F({},t),{updateAvailable:!0,waiting:!0}))}))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[SwManager] Controller changed")}))}handleSwMessage(e){console.log("[SwManager] Message from SW:",e.data),this.ngZone.run(()=>{switch(e.data.type){case"CACHE_STATS":this.cacheStats.set(e.data.stats);break;case"SYNC_OFFLINE_OPERATIONS":window.dispatchEvent(new CustomEvent("sync-offline-operations-from-sw"));break}})}async checkForUpdates(){if(!this.registration)return!1;try{return await this.registration.update(),console.log("[SwManager] Update check complete"),this.status().updateAvailable}catch(e){return console.error("[SwManager] Update check failed:",e),!1}}async applyUpdate(){if(!this.registration?.waiting){console.log("[SwManager] No waiting SW");return}console.log("[SwManager] Applying update..."),this.registration.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()},{once:!0})}async getCacheStats(){return navigator.serviceWorker.controller?new Promise(e=>{let t=new MessageChannel;t.port1.onmessage=n=>{n.data.type==="CACHE_STATS"&&e(n.data.stats)},navigator.serviceWorker.controller.postMessage({type:"GET_CACHE_STATS"},[t.port2]),setTimeout(()=>e({}),3e3)}):{}}async clearCache(){navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),console.log("[SwManager] Cache clear requested"))}async triggerSync(e="sync-offline-operations"){if(this.registration)if("sync"in this.registration)try{await this.registration.sync.register(e),console.log("[SwManager] Background sync registered:",e)}catch(t){console.error("[SwManager] Sync registration failed:",t)}else console.log("[SwManager] Background sync not supported")}async unregister(){if(!this.registration)return!1;try{let e=await this.registration.unregister();return console.log("[SwManager] Unregistered:",e),this.ngZone.run(()=>{this.status.set({registered:!1,active:!1,waiting:!1,updateAvailable:!1,version:null})}),e}catch(e){return console.error("[SwManager] Unregister failed:",e),!1}}static{this.\u0275fac=function(t){return new(t||i)(Ke(We))}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var H1=(i,e)=>e.id;function z1(i,e){if(i&1&&Ge(0,"div",22),i&2){let t=g(2);X("left",t.highlightRect().left-8,"px")("top",t.highlightRect().top-8,"px")("width",t.highlightRect().width+16,"px")("height",t.highlightRect().height+16,"px")}}function K1(i,e){if(i&1){let t=M();P(0,"div",23),oe("click",function(){let o=v(t).$index,a=g(2);return b(a.goToStep(o))}),N()}if(i&2){let t=e.$index,n=g(2);I("bg-gradient-to-r",t<=n.currentIndex())("from-cyan-500",t<=n.currentIndex())("to-blue-500",t<=n.currentIndex())("bg-slate-700",t>n.currentIndex())}}function W1(i,e){if(i&1&&(P(0,"li",30)(1,"span",31),l(2,"\u2713"),N(),P(3,"span"),l(4),N()()),i&2){let t=e.$implicit;c(4),A(t)}}function J1(i,e){if(i&1&&(P(0,"div",27)(1,"ul",29),$(2,W1,5,1,"li",30,Pe),N()()),i&2){let t=g();c(2),H(t.tips)}}function Q1(i,e){if(i&1){let t=M();P(0,"button",32),oe("click",function(){v(t);let o=g(),a=g(2);return b(a.handleAction(o.actionTarget))}),l(1),N()}if(i&2){let t=g();c(),D(" ",t.actionLabel," \u2192 ")}}function Y1(i,e){if(i&1&&(P(0,"div",11)(1,"div",24),l(2),N(),P(3,"h2",25),l(4),N(),P(5,"p",26),l(6),N(),S(7,J1,4,0,"div",27),S(8,Q1,2,1,"button",28),N()),i&2){let t=e;c(2),D(" ",t.icon," "),c(2),D(" ",t.title," "),c(2),D(" ",t.description," "),c(),w(t.tips&&t.tips.length>0?7:-1),c(),w(t.actionLabel&&t.actionTarget?8:-1)}}function X1(i,e){if(i&1){let t=M();P(0,"button",33),oe("click",function(){v(t);let o=g(2);return b(o.next())}),l(1," \u4E0B\u4E00\u6B65 \u2192 "),N()}}function Z1(i,e){if(i&1){let t=M();P(0,"button",34),oe("click",function(){v(t);let o=g(2);return b(o.complete())}),l(1," \u5F00\u59CB\u4F7F\u7528 \u{1F680} "),N()}}function j1(i,e){if(i&1){let t=M();P(0,"div",1),oe("click",function(o){v(t);let a=g();return b(a.onBackdropClick(o))}),Ge(1,"div",2),S(2,z1,1,8,"div",3),P(3,"div",4),oe("click",function(o){return v(t),b(o.stopPropagation())}),P(4,"div",5)(5,"div",6),$(6,K1,1,8,"div",7,H1),N(),P(8,"div",8)(9,"span"),l(10),N(),P(11,"button",9),oe("click",function(){v(t);let o=g();return b(o.skipAll())}),l(12," \u8DF3\u8FC7\u5F15\u5BFC "),N()()(),P(13,"div",10),S(14,Y1,9,5,"div",11),N(),P(15,"div",12)(16,"div",13)(17,"label",14)(18,"input",15),oe("change",function(){v(t);let o=g();return b(o.toggleNeverShow())}),N(),P(19,"span"),l(20,"\u4EE5\u540E\u4E0D\u518D\u63D0\u793A"),N()()(),P(21,"div",16)(22,"button",17),oe("click",function(){v(t);let o=g();return b(o.previous())}),l(23," \u2190 \u4E0A\u4E00\u6B65 "),N(),S(24,X1,2,0,"button",18)(25,Z1,2,0,"button",19),N()(),P(26,"div",20),l(27," \u6309 "),P(28,"kbd",21),l(29,"\u2190"),N(),P(30,"kbd",21),l(31,"\u2192"),N(),l(32," \u5BFC\u822A \xB7 "),P(33,"kbd",21),l(34,"ESC"),N(),l(35," \u5173\u95ED "),N()()()}if(i&2){let t,n,o=g();c(2),w((t=o.currentStep())!=null&&t.targetSelector&&o.highlightRect()?2:-1),c(4),H(o.steps),c(4),Y("\u6B65\u9AA4 ",o.currentIndex()+1," / ",o.steps.length),c(4),w((n=o.currentStep())?14:-1,n),c(4),Je("checked",o.neverShowAgain()),c(4),Je("disabled",o.currentIndex()===0),c(2),w(o.currentIndex()<o.steps.length-1?24:25)}}function eC(i,e){if(i&1){let t=M();P(0,"div",1),Ge(1,"div",2),P(2,"div",3),Ge(3,"div",4),P(4,"h4",5),l(5),N(),P(6,"p",6),l(7),N(),P(8,"button",7),oe("click",function(){v(t);let o=g();return b(o.dismiss())}),l(9,"\u77E5\u9053\u4E86"),N()()()}if(i&2){let t=g();X("top",t.position.top,"px")("left",t.position.left,"px"),c(5),A(t.title),c(2),A(t.description)}}var Zs="tg-ai-onboarding",wn="tg-ai-onboarding-never-show",ko=class i{constructor(){this.show=_(!1);this.currentIndex=_(0);this.neverShowAgain=_(!1);this.highlightRect=_(null);this.navigateEvent=Me();this.steps=[{id:"welcome",title:"\u6B22\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B",description:"\u667A\u80FD Telegram \u8425\u9500\u7CFB\u7EDF\uFF0C\u5E2E\u52A9\u60A8\u9AD8\u6548\u83B7\u5BA2\u3001\u81EA\u52A8\u5316\u8FD0\u8425",icon:"\u{1F389}",position:"center",tips:["\u652F\u6301\u591A\u8D26\u53F7\u7BA1\u7406\u548C\u534F\u4F5C","AI \u667A\u80FD\u8425\u9500\u548C\u81EA\u52A8\u56DE\u590D","\u7FA4\u7EC4\u641C\u7D22\u548C\u8D44\u6E90\u7BA1\u7406"]},{id:"add-account",title:"\u7B2C\u4E00\u6B65\uFF1A\u6DFB\u52A0\u8D26\u53F7",description:"\u7ED1\u5B9A\u60A8\u7684 Telegram \u8D26\u53F7\uFF0C\u8FD9\u662F\u4F7F\u7528\u6240\u6709\u529F\u80FD\u7684\u524D\u63D0",icon:"\u{1F4F1}",targetSelector:'[data-tour="accounts"]',position:"right",tips:["\u652F\u6301\u624B\u673A\u53F7\u9A8C\u8BC1\u767B\u5F55","\u53EF\u6DFB\u52A0\u591A\u4E2A\u8D26\u53F7\u540C\u65F6\u8FD0\u8425","\u5EFA\u8BAE\u4F7F\u7528\u72EC\u7ACB\u8425\u9500\u53F7"],actionLabel:"\u53BB\u6DFB\u52A0\u8D26\u53F7",actionTarget:"accounts"},{id:"search-discovery",title:"\u7B2C\u4E8C\u6B65\uFF1A\u641C\u7D22\u53D1\u73B0",description:"\u641C\u7D22\u76EE\u6807\u7FA4\u7EC4\u548C\u9891\u9053\uFF0C\u53D1\u73B0\u6F5C\u5728\u5BA2\u6237\u8D44\u6E90",icon:"\u{1F50D}",targetSelector:'[data-tour="search-discovery"]',position:"right",tips:["\u652F\u6301\u591A\u6E20\u9053\u641C\u7D22\uFF08\u5B98\u65B9/\u4E2D\u6587\u641C\u7D22\uFF09","\u4E00\u952E\u52A0\u5165\u76EE\u6807\u7FA4\u7EC4","\u6536\u85CF\u548C\u7BA1\u7406\u641C\u7D22\u7ED3\u679C"],actionLabel:"\u53BB\u641C\u7D22\u53D1\u73B0",actionTarget:"search-discovery"},{id:"ai-marketing",title:"\u7B2C\u4E09\u6B65\uFF1AAI \u667A\u80FD\u8425\u9500",description:"\u8BA9 AI \u5E2E\u60A8\u5236\u5B9A\u8425\u9500\u7B56\u7565\uFF0C\u81EA\u52A8\u6267\u884C\u8425\u9500\u4EFB\u52A1",icon:"\u{1F916}",targetSelector:'[data-tour="ai-assistant"]',position:"right",tips:["AI \u4E00\u952E\u751F\u6210\u8425\u9500\u7B56\u7565","\u81EA\u52A8\u5316\u6267\u884C\u548C\u8DDF\u8FDB","\u6570\u636E\u5206\u6790\u548C\u6548\u679C\u8FFD\u8E2A"],actionLabel:"\u4F53\u9A8C AI \u8425\u9500",actionTarget:"ai-assistant"},{id:"complete",title:"\u51C6\u5907\u5C31\u7EEA\uFF01",description:"\u60A8\u5DF2\u4E86\u89E3\u6838\u5FC3\u529F\u80FD\uFF0C\u73B0\u5728\u53EF\u4EE5\u5F00\u59CB\u60A8\u7684\u8425\u9500\u4E4B\u65C5\u4E86",icon:"\u{1F680}",position:"center",tips:["\u4EEA\u8868\u76D8\u67E5\u770B\u6574\u4F53\u6570\u636E","\u6709\u95EE\u9898\u968F\u65F6\u70B9\u51FB\u53F3\u4E0A\u89D2 \u2753 \u5E2E\u52A9","\u795D\u60A8\u8425\u9500\u987A\u5229\uFF01"]}];this.currentStep=G(()=>this.steps[this.currentIndex()])}ngOnInit(){this.checkFirstRun(),this.loadNeverShowSetting()}handleKeydown(e){if(this.show())switch(e.key){case"Escape":this.skipAll();break;case"ArrowRight":case"Enter":this.currentIndex()<this.steps.length-1?this.next():this.complete();break;case"ArrowLeft":this.previous();break}}checkFirstRun(){let e=localStorage.getItem(Zs);localStorage.getItem(wn)!=="true"&&(e||setTimeout(()=>this.show.set(!0),800))}loadNeverShowSetting(){let e=localStorage.getItem(wn);this.neverShowAgain.set(e==="true")}toggleNeverShow(){let e=!this.neverShowAgain();this.neverShowAgain.set(e),localStorage.setItem(wn,String(e))}open(){this.currentIndex.set(0),this.show.set(!0),this.updateHighlight()}close(){this.show.set(!1),this.highlightRect.set(null)}next(){this.currentIndex()<this.steps.length-1&&(this.currentIndex.update(e=>e+1),this.updateHighlight())}previous(){this.currentIndex()>0&&(this.currentIndex.update(e=>e-1),this.updateHighlight())}goToStep(e){e>=0&&e<this.steps.length&&(this.currentIndex.set(e),this.updateHighlight())}skipAll(){this.markAsCompleted(),this.close()}complete(){this.markAsCompleted(),this.close()}markAsCompleted(){localStorage.setItem(Zs,new Date().toISOString()),this.neverShowAgain()&&localStorage.setItem(wn,"true")}handleAction(e){this.navigateEvent.emit(e),this.next()}onBackdropClick(e){}updateHighlight(){let e=this.currentStep();e?.targetSelector?setTimeout(()=>{let t=document.querySelector(e.targetSelector);t?(this.highlightRect.set(t.getBoundingClientRect()),t.scrollIntoView({behavior:"smooth",block:"center"})):this.highlightRect.set(null)},100):this.highlightRect.set(null)}reset(){localStorage.removeItem(Zs),localStorage.removeItem(wn),this.neverShowAgain.set(!1),this.currentIndex.set(0)}shouldShowOnboarding(){return localStorage.getItem(wn)!=="true"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-onboarding"]],hostBindings:function(t,n){t&1&&x("keydown",function(a){return n.handleKeydown(a)},sa)},outputs:{navigateEvent:"navigateEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center"],[1,"fixed","inset-0","z-[10000]","flex","items-center","justify-center",3,"click"],[1,"absolute","inset-0","bg-black/80","backdrop-blur-sm"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none",3,"left","top","width","height"],[1,"relative","w-full","max-w-lg","mx-4","sm:mx-auto","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","rounded-2xl","sm:rounded-3xl","shadow-2xl","border","border-slate-600/50","overflow-hidden",3,"click"],[1,"px-4","sm:px-6","pt-4","sm:pt-5"],[1,"flex","items-center","gap-1.5","sm:gap-2"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"bg-gradient-to-r","from-cyan-500","to-blue-500","bg-slate-700"],[1,"flex","justify-between","items-center","mt-2","text-xs","text-slate-500"],[1,"hover:text-slate-300","transition-colors","px-2","py-1","-mr-2",3,"click"],[1,"p-4","sm:p-6"],[1,"text-center"],[1,"px-4","sm:px-6","pb-4","sm:pb-5"],[1,"flex","items-center","justify-center","mb-4"],[1,"flex","items-center","gap-2","cursor-pointer","text-sm","text-slate-500","hover:text-slate-400","transition-colors"],["type","checkbox",1,"w-4","h-4","rounded","border-slate-600","bg-slate-700","text-cyan-500","focus:ring-cyan-500/50",3,"change","checked"],[1,"flex","justify-between","gap-3"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-slate-700/80","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-40","disabled:cursor-not-allowed","text-sm","sm:text-base",3,"click","disabled"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25"],[1,"hidden","sm:block","px-6","pb-4","text-center","text-xs","text-slate-600"],[1,"px-1.5","py-0.5","bg-slate-700","rounded","text-slate-400"],[1,"absolute","border-2","border-cyan-400","rounded-xl","shadow-[0_0_20px_rgba(34,211,238,0.5)]","animate-pulse","pointer-events-none"],[1,"flex-1","h-1","sm:h-1.5","rounded-full","transition-all","duration-300","cursor-pointer",3,"click"],[1,"text-5xl","sm:text-6xl","mb-4","sm:mb-5","animate-bounce-slow"],[1,"text-xl","sm:text-2xl","font-bold","text-white","mb-2","sm:mb-3"],[1,"text-slate-300","text-sm","sm:text-base","mb-4","sm:mb-5","max-w-sm","mx-auto","leading-relaxed"],[1,"bg-slate-800/60","rounded-xl","p-3","sm:p-4","mb-4","sm:mb-5","text-left","max-w-sm","mx-auto","border","border-slate-700/50"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25"],[1,"space-y-2"],[1,"flex","items-start","gap-2","text-slate-400","text-sm"],[1,"text-cyan-400","mt-0.5","flex-shrink-0"],[1,"mb-3","px-5","py-2.5","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","text-sm","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-xl","font-medium","hover:from-cyan-600","hover:to-blue-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-cyan-500/25",3,"click"],[1,"flex-1","px-4","py-2.5","sm:py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","rounded-xl","font-medium","hover:from-green-600","hover:to-emerald-600","transition-all","text-sm","sm:text-base","shadow-lg","shadow-green-500/25",3,"click"]],template:function(t,n){t&1&&S(0,j1,36,7,"div",0),t&2&&w(n.show()?0:-1)},dependencies:[te,me],styles:["@keyframes _ngcontent-%COMP%_bounce-slow{0%,to{transform:translateY(0)}50%{transform:translateY(-8px)}}.animate-bounce-slow[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-slow 2s ease-in-out infinite}"]})}},Ad=class i{constructor(){this.show=_(!1);this.title="";this.description="";this.position={top:0,left:0}}highlight(e,t,n){let o=e.getBoundingClientRect();this.position={top:o.top,left:o.left},this.title=t,this.description=n,this.show.set(!0)}dismiss(){this.show.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-feature-highlight"]],decls:1,vars:1,consts:[[1,"fixed","z-[9998]",3,"top","left"],[1,"fixed","z-[9998]"],[1,"absolute","-inset-2","bg-cyan-500/20","rounded-xl","animate-pulse"],[1,"absolute","top-full","left-1/2","-translate-x-1/2","mt-4","w-64","bg-slate-800","rounded-xl","shadow-xl","border","border-slate-600","p-4","z-10"],[1,"absolute","-top-2","left-1/2","-translate-x-1/2","w-4","h-4","bg-slate-800","border-l","border-t","border-slate-600","rotate-45"],[1,"font-bold","text-white","mb-2"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(t,n){t&1&&S(0,eC,10,6,"div",0),t&2&&w(n.show()?0:-1)},dependencies:[te],encapsulation:2})}};var tC=(i,e)=>e.code;function nC(i,e){if(i&1){let t=M();P(0,"div",7),oe("click",function(){let o=v(t).$implicit,a=g(2);return b(a.selectLocale(o.code))}),P(1,"span",2),l(2),N(),P(3,"span",8),l(4),N()()}if(i&2){let t=e.$implicit,n=g(2);I("active",t.code===n.i18n.locale()),c(2),A(t.flag),c(2),A(t.nativeName)}}function iC(i,e){if(i&1&&(P(0,"div",5),$(1,nC,5,4,"div",6,tC),N()),i&2){let t=g();c(),H(t.locales)}}var Io=class i{constructor(){this.i18n=O(Xe);this.locales=Aa;this.isOpen=!1}toggleDropdown(){this.isOpen=!this.isOpen}selectLocale(e){this.i18n.setLocale(e),this.isOpen=!1}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-language-switcher-compact"]],decls:9,vars:5,consts:[[1,"language-switcher"],[1,"current-language",3,"click"],[1,"flag"],[1,"lang-name"],[1,"arrow"],[1,"dropdown"],[1,"option",3,"active"],[1,"option",3,"click"],[1,"name"]],template:function(t,n){t&1&&(P(0,"div",0)(1,"div",1),oe("click",function(){return n.toggleDropdown()}),P(2,"span",2),l(3),N(),P(4,"span",3),l(5),N(),P(6,"span",4),l(7,"\u25BC"),N()(),S(8,iC,3,0,"div",5),N()),t&2&&(c(3),A(n.i18n.currentLocaleInfo().flag),c(2),A(n.i18n.currentLocaleInfo().nativeName),c(),I("open",n.isOpen),c(2),w(n.isOpen?8:-1))},dependencies:[te],styles:[".language-switcher[_ngcontent-%COMP%]{position:relative;display:inline-block}.current-language[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;cursor:pointer;transition:all .2s ease}.current-language[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.flag[_ngcontent-%COMP%]{font-size:18px}.lang-name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}.arrow[_ngcontent-%COMP%]{font-size:10px;color:var(--text-muted, #888);transition:transform .2s ease}.arrow.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin-top:4px;background:var(--card-bg, #1e1e2e);border:1px solid var(--border-color, #333);border-radius:8px;overflow:hidden;z-index:100;box-shadow:0 4px 12px #0000004d}.option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 12px;cursor:pointer;transition:background .2s ease}.option[_ngcontent-%COMP%]:hover{background:var(--hover-bg, #2a2a3a)}.option.active[_ngcontent-%COMP%]{background:var(--primary-color, #7c3aed)}.option[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color, #fff)}"]})}};var oC=(i,e)=>e.api_id;function rC(i,e){i&1&&(P(0,"div",5),Ge(1,"span",6),P(2,"span"),l(3,"\u6B63\u5728\u5206\u6790\u6700\u4F73 API..."),N()())}function sC(i,e){if(i&1){let t=M();P(0,"div",7)(1,"div",8),l(2,"\u2B50 \u63A8\u85A6"),N(),P(3,"div",9)(4,"div",10),l(5),N(),P(6,"div",11),l(7),N()(),P(8,"div",12)(9,"div",13),Ge(10,"div",14),N(),P(11,"span",15),l(12),N()(),P(13,"button",16),oe("click",function(){v(t);let o=g(2);return b(o.useRecommended())}),l(14,"\u4F7F\u7528\u6B64 API"),N()(),P(15,"p",17),l(16,"\u{1F4A1} \u6B64 API \u8CA0\u8F09\u6700\u4F4E\uFF0C\u53EF\u7528\u7A7A\u9593\u5145\u8DB3"),N()}if(i&2){let t=g(2);c(5),A(t.safeDisplayName(t.recommendedApi().name,t.recommendedApi().api_id)),c(2),D("ID: ",t.recommendedApi().api_id),c(3),X("width",t.recommendedApi().account_count/t.recommendedApi().max_accounts*100,"%"),c(2),Y("",t.recommendedApi().account_count,"/",t.recommendedApi().max_accounts)}}function aC(i,e){if(i&1){let t=M();P(0,"div",18)(1,"div",19),l(2,"\u{1F680} \u4E00\u9375\u767B\u5165"),N(),P(3,"div",20),l(4,"\u{1F510}"),N(),P(5,"h3"),l(6,"\u4F7F\u7528\u5E73\u53F0\u516C\u5171 API"),N(),P(7,"p",21),l(8,"\u7121\u9700\u4E86\u89E3 API\uFF0C\u76F4\u63A5\u958B\u59CB\u767B\u5165"),N(),P(9,"ul",22)(10,"li"),l(11,"\u2705 \u514D\u914D\u7F6E\uFF0C\u5373\u958B\u5373\u7528"),N(),P(12,"li"),l(13,"\u2705 \u7A69\u5B9A\u53EF\u9760"),N(),P(14,"li"),l(15,"\u2705 \u9069\u5408\u65B0\u624B\u7528\u6236"),N()(),P(16,"button",23),oe("click",function(){v(t);let o=g(2);return b(o.usePlatformApi())}),l(17," \u{1F680} \u7ACB\u5373\u4F7F\u7528 "),N()(),P(18,"div",24)(19,"span"),l(20,"\u6216\u8005"),N()(),P(21,"div",25)(22,"button",26),oe("click",function(){v(t);let o=g(2);return b(o.selectMode("manual"))}),l(23," \u{1F527} \u6211\u6709\u81EA\u5DF1\u7684 API\uFF08\u9032\u968E\u7528\u6236\uFF09 "),N(),P(24,"p",27),l(25,"\u5982\u679C\u60A8\u6709\u81EA\u5DF1\u7684 Telegram API \u6191\u64DA\uFF0C\u9EDE\u64CA\u6B64\u8655\u6DFB\u52A0"),N()()}}function lC(i,e){if(i&1&&(P(0,"div",3),S(1,rC,4,0,"div",5)(2,sC,17,6)(3,aC,26,0),N()),i&2){let t=g();c(),w(t.isLoading()?1:t.recommendedApi()?2:3)}}function cC(i,e){if(i&1){let t=M();P(0,"div",28)(1,"span",29),l(2,"\u{1F4ED}"),N(),P(3,"p"),l(4,"\u60A8\u9084\u6C92\u6709\u6DFB\u52A0\u4EFB\u4F55 API"),N(),P(5,"button",30),oe("click",function(){v(t);let o=g(2);return b(o.selectMode("manual"))}),l(6,"\u2795 \u6DFB\u52A0\u7B2C\u4E00\u500B API"),N()()}}function dC(i,e){i&1&&(P(0,"span",42),l(1,"\u505C\u7528"),N())}function uC(i,e){i&1&&(P(0,"span",43),l(1,"\u5DF2\u6EFF"),N())}function mC(i,e){i&1&&(P(0,"span",44),l(1,"\u63A8\u85A6"),N())}function pC(i,e){if(i&1){let t=M();P(0,"div",36),oe("click",function(){let o=v(t).$implicit,a=g(3);return b(a.selectPoolApi(o))}),P(1,"div",37)(2,"span",38),l(3),N(),P(4,"span",39),l(5),N()(),P(6,"div",40)(7,"span",41),l(8),N(),S(9,dC,2,0,"span",42)(10,uC,2,0,"span",43)(11,mC,2,0,"span",44),N()()}if(i&2){let t,n=e.$implicit,o=g(3);I("selected",o.selectedPoolApi()===n.api_id)("disabled",!n.is_active||n.account_count>=n.max_accounts),c(3),A(o.safeDisplayName(n.name,n.api_id)),c(2),D("ID: ",n.api_id),c(2),I("warning",n.account_count>=n.max_accounts*.8)("full",n.account_count>=n.max_accounts),c(),Y(" ",n.account_count,"/",n.max_accounts," "),c(),w(n.is_active?n.account_count>=n.max_accounts?10:((t=o.recommendedApi())==null?null:t.api_id)===n.api_id?11:-1:9)}}function gC(i,e){if(i&1){let t=M();P(0,"button",45),oe("click",function(){v(t);let o=g(3);return b(o.confirmPoolSelection())}),l(1,"\u78BA\u8A8D\u9078\u64C7"),N()}}function hC(i,e){if(i&1){let t=M();P(0,"div",31),$(1,pC,12,13,"div",32,oC),N(),S(3,gC,2,0,"button",33),P(4,"div",34)(5,"button",35),oe("click",function(){v(t);let o=g(2);return b(o.selectMode("manual"))}),l(6,"\u2795 \u6DFB\u52A0\u65B0 API"),N()()}if(i&2){let t=g(2);c(),H(t.apiList()),c(2),w(t.selectedPoolApi()?3:-1)}}function fC(i,e){if(i&1&&(P(0,"div",3),S(1,cC,7,0,"div",28)(2,hC,7,1),N()),i&2){let t=g();c(),w(t.apiList().length===0?1:2)}}function _C(i,e){if(i&1){let t=M();P(0,"div",46)(1,"label"),l(2,"API \u540D\u7A31\uFF08\u53EF\u9078\uFF09"),N(),P(3,"input",56),oe("input",function(o){v(t);let a=g(2);return b(a.manualApiName.set(o.target.value))}),N()()}if(i&2){let t=g(2);c(3),Je("value",t.manualApiName())}}function CC(i,e){if(i&1){let t=M();P(0,"div",3)(1,"div",46)(2,"label"),l(3,"API ID "),P(4,"span",47),l(5,"*"),N()(),P(6,"input",48),oe("input",function(o){v(t);let a=g();return b(a.manualApiId.set(o.target.value))}),N()(),P(7,"div",46)(8,"label"),l(9,"API Hash "),P(10,"span",47),l(11,"*"),N()(),P(12,"input",49),oe("input",function(o){v(t);let a=g();return b(a.manualApiHash.set(o.target.value))}),N()(),P(13,"div",50)(14,"input",51),oe("change",function(o){v(t);let a=g();return b(a.saveToPool.set(o.target.checked))}),N(),P(15,"label",52),l(16,"\u4FDD\u5B58\u5230\u6211\u7684 API \u6C60\uFF08\u65B9\u4FBF\u4E0B\u6B21\u4F7F\u7528\uFF09"),N()(),S(17,_C,4,1,"div",46),P(18,"button",53),oe("click",function(){v(t);let o=g();return b(o.confirmManualInput())}),l(19," \u78BA\u8A8D\u4F7F\u7528 "),N(),P(20,"div",54)(21,"span"),l(22,"\u{1F449}"),N(),P(23,"a",55),l(24,"\u524D\u5F80\u7533\u8ACB API \u6191\u64DA"),N()()()}if(i&2){let t=g();c(6),Je("value",t.manualApiId()),c(6),Je("value",t.manualApiHash()),c(2),Je("checked",t.saveToPool()),c(3),w(t.saveToPool()?17:-1),c(),Je("disabled",!t.isManualValid())}}function vC(i,e){if(i&1){let t=M();P(0,"div",4)(1,"div",57)(2,"span",58),l(3,"\u5DF2\u9078\u64C7\uFF1A"),N(),P(4,"span",59),l(5),N(),P(6,"span",60),l(7),N()(),P(8,"button",61),oe("click",function(){v(t);let o=g();return b(o.clearSelection())}),l(9,"\u2715"),N()()}if(i&2){let t=g();c(5),A(t.safeDisplayName(t.selectedApi().name,t.selectedApi().api_id)),c(2),D("ID: ",t.selectedApi().api_id)}}var En=class i{constructor(){this.ipcService=O(ye);this.toast=O(ue);this.membershipService=O(Re);this.showSelected=!0;this.apiSelected=new ot;this.selectionCleared=new ot;this.currentMode=_("recommend");this.isLoading=_(!1);this.apiList=_([]);this.selectedApi=_(null);this.recommendedApi=_(null);this.selectedPoolApi=_(null);this.manualApiId=_("");this.manualApiHash=_("");this.manualApiName=_("");this.saveToPool=_(!0);this.ipcChannels=[];this.isManualValid=G(()=>{let e=this.manualApiId(),t=this.manualApiHash();return e&&/^\d+$/.test(e)&&t&&/^[a-f0-9]{32}$/i.test(t)})}safeDisplayName(e,t){return e?/[\uFFFD\u0000-\u001F]/.test(e)||e.includes("\uFFFD")||/[\uE000-\uF8FF]/.test(e)||(e.match(/[\u4E00-\u9FFF]/g)?.length||0)===0&&/[^\x00-\x7F]/.test(e)&&e.length<10?`API ${t}`:e.replace(/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\w\s\-_@#$%&*()+=\[\]{}|;:'",.<>?/\\]/g,"").length>e.length*.3?`API ${t}`:e:`API ${t}`}ngOnInit(){this.setupIpcListeners(),this.loadApiList()}ngOnDestroy(){this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("api-credentials-updated",e=>{if(this.isLoading.set(!1),e.credentials){let t=e.credentials.filter(n=>!n.is_public&&n.is_active);this.apiList.set(t),this.findBestApi(t)}}),this.ipcChannels.push("api-credentials-updated"),this.ipcService.on("api-credential-added",e=>{e.success?(this.toast.success("\u2705 API \u6191\u64DA\u5DF2\u4FDD\u5B58\u5230 API \u6C60"),this.loadApiList()):this.toast.error(`\u4FDD\u5B58\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcChannels.push("api-credential-added")}loadApiList(){this.isLoading.set(!0),this.ipcService.send("get-api-credentials",{})}findBestApi(e){let t=e.filter(n=>n.is_active&&n.account_count<n.max_accounts);t.length>0?(t.sort((n,o)=>n.account_count/n.max_accounts-o.account_count/o.max_accounts),this.recommendedApi.set(t[0])):this.recommendedApi.set(null)}selectMode(e){this.currentMode.set(e)}useRecommended(){let e=this.recommendedApi();if(e&&e.api_hash){let t=this.safeDisplayName(e.name,e.api_id),n={api_id:e.api_id,api_hash:e.api_hash,name:t,source:"pool"};this.selectedApi.set(n),this.apiSelected.emit(n),this.toast.success(`\u5DF2\u9078\u64C7 ${t}`)}else e&&this.toast.error("\u6B64 API \u7F3A\u5C11 Hash\uFF0C\u8ACB\u91CD\u65B0\u6DFB\u52A0")}usePlatformApi(){let e={api_id:"2040",api_hash:"b18441a1ff607e10a989891a5462e627",name:"\u5E73\u53F0\u516C\u5171 API",source:"platform"};this.selectedApi.set(e),this.apiSelected.emit(e),this.toast.success("\u2705 \u5DF2\u9078\u64C7\u5E73\u53F0\u516C\u5171 API\uFF0C\u53EF\u76F4\u63A5\u767B\u5165")}selectPoolApi(e){!e.is_active||e.account_count>=e.max_accounts||this.selectedPoolApi.set(e.api_id)}confirmPoolSelection(){let e=this.selectedPoolApi(),t=this.apiList().find(n=>n.api_id===e);if(t&&t.api_hash){let n=this.safeDisplayName(t.name,t.api_id),o={api_id:t.api_id,api_hash:t.api_hash,name:n,source:"pool"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success(`\u5DF2\u9078\u64C7 ${n}`)}}confirmManualInput(){if(!this.isManualValid())return;let e=this.manualApiId(),t=this.manualApiHash(),n=this.manualApiName()||`API ${e}`;this.saveToPool()&&this.ipcService.send("add-api-credential",{api_id:e,api_hash:t,name:n,source:"manual"});let o={api_id:e,api_hash:t,name:n,source:"manual"};this.selectedApi.set(o),this.apiSelected.emit(o),this.toast.success("API \u5DF2\u78BA\u8A8D")}clearSelection(){this.selectedApi.set(null),this.selectedPoolApi.set(null),this.manualApiId.set(""),this.manualApiHash.set(""),this.manualApiName.set(""),this.selectionCleared.emit()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-api-selector"]],inputs:{showSelected:"showSelected"},outputs:{apiSelected:"apiSelected",selectionCleared:"selectionCleared"},decls:12,vars:10,consts:[[1,"api-selector"],[1,"mode-tabs"],[1,"mode-tab",3,"click"],[1,"mode-content"],[1,"selected-display"],[1,"loading-state"],[1,"spinner"],[1,"recommended-card"],[1,"recommend-badge"],[1,"api-info"],[1,"api-name"],[1,"api-id"],[1,"api-quota"],[1,"quota-bar"],[1,"quota-fill"],[1,"quota-text"],[1,"use-btn",3,"click"],[1,"recommend-reason"],[1,"platform-api-card"],[1,"platform-badge"],[1,"platform-icon"],[1,"platform-desc"],[1,"platform-features"],[1,"platform-btn",3,"click"],[1,"divider-text"],[1,"advanced-option"],[1,"advanced-btn",3,"click"],[1,"advanced-hint"],[1,"empty-state"],[1,"empty-icon"],[1,"add-btn",3,"click"],[1,"api-list"],[1,"api-item",3,"selected","disabled"],[1,"confirm-btn"],[1,"pool-footer"],[1,"add-more-btn",3,"click"],[1,"api-item",3,"click"],[1,"api-item-info"],[1,"api-item-name"],[1,"api-item-id"],[1,"api-item-right"],[1,"quota-badge"],[1,"status-badge","inactive"],[1,"status-badge","full"],[1,"status-badge","recommend"],[1,"confirm-btn",3,"click"],[1,"form-group"],[1,"required"],["type","text","placeholder","\u4F8B\u5982\uFF1A12345678",1,"form-input",3,"input","value"],["type","text","placeholder","\u4F8B\u5982\uFF1Aa1b2c3d4e5f6g7h8...",1,"form-input",3,"input","value"],[1,"save-option"],["type","checkbox","id","saveToPool",3,"change","checked"],["for","saveToPool"],[1,"confirm-btn",3,"click","disabled"],[1,"guide-link"],["href","https://my.telegram.org","target","_blank"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u4E3B\u529B API",1,"form-input",3,"input","value"],[1,"selected-info"],[1,"selected-label"],[1,"selected-name"],[1,"selected-id"],[1,"clear-btn",3,"click"]],template:function(t,n){t&1&&(P(0,"div",0)(1,"div",1)(2,"button",2),oe("click",function(){return n.selectMode("recommend")}),l(3," \u{1F3AF} \u667A\u80FD\u63A8\u85A6 "),N(),P(4,"button",2),oe("click",function(){return n.selectMode("pool")}),l(5," \u{1F4CB} \u6211\u7684 API "),N(),P(6,"button",2),oe("click",function(){return n.selectMode("manual")}),l(7," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),N()(),S(8,lC,4,1,"div",3),S(9,fC,3,1,"div",3),S(10,CC,25,5,"div",3),S(11,vC,10,2,"div",4),N()),t&2&&(c(2),I("active",n.currentMode()==="recommend"),c(2),I("active",n.currentMode()==="pool"),c(2),I("active",n.currentMode()==="manual"),c(2),w(n.currentMode()==="recommend"?8:-1),c(),w(n.currentMode()==="pool"?9:-1),c(),w(n.currentMode()==="manual"?10:-1),c(),w(n.selectedApi()&&n.showSelected?11:-1))},dependencies:[te,me],styles:['.api-selector[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;overflow:hidden}.mode-tabs[_ngcontent-%COMP%]{display:flex;background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.25rem}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.625rem .5rem;background:transparent;border:none;border-radius:.5rem;color:var(--text-muted, #94a3b8);font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s}.mode-tab[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.mode-tab.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.mode-content[_ngcontent-%COMP%]{padding:1rem}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:2rem;color:var(--text-muted, #94a3b8)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:1.5rem}.empty-icon[_ngcontent-%COMP%]{font-size:2rem;display:block;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-secondary, #cbd5e1)}.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);margin-bottom:1rem}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);border:none;border-radius:.5rem;color:#fff;font-size:.8rem;cursor:pointer}.recommended-card[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid var(--primary, #06b6d4);border-radius:.75rem;padding:1rem;position:relative}.recommend-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;right:12px;padding:.25rem .75rem;background:var(--primary, #06b6d4);border-radius:1rem;font-size:.7rem;color:#fff;font-weight:600}.api-info[_ngcontent-%COMP%]{margin-bottom:.75rem}.api-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white);font-size:1rem}.api-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-quota[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.quota-bar[_ngcontent-%COMP%]{flex:1;height:6px;background:#ffffff1a;border-radius:3px;overflow:hidden}.quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#22c55e,#06b6d4);border-radius:3px}.quota-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #cbd5e1);min-width:40px}.use-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.recommend-reason[_ngcontent-%COMP%]{margin:.75rem 0 0;font-size:.75rem;color:var(--text-muted, #94a3b8);text-align:center}.api-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto}.api-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.api-item[_ngcontent-%COMP%]:hover:not(.disabled){border-color:var(--primary, #06b6d4)}.api-item.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.api-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.api-item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.api-item-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white);font-size:.875rem}.api-item-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.api-item-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.quota-badge[_ngcontent-%COMP%]{padding:.125rem .5rem;background:#22c55e33;border-radius:.25rem;font-size:.7rem;color:#86efac}.quota-badge.warning[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.quota-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.status-badge[_ngcontent-%COMP%]{padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}.status-badge.recommend[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.status-badge.inactive[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.status-badge.full[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.confirm-btn[_ngcontent-%COMP%]{width:100%;padding:.625rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;margin-top:.75rem}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.pool-footer[_ngcontent-%COMP%]{margin-top:.75rem;text-align:center}.add-more-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);font-size:.8rem;cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:.75rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.required[_ngcontent-%COMP%]{color:#ef4444}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;box-sizing:border-box}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.save-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;font-size:.8rem;color:var(--text-secondary, #cbd5e1)}.save-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.guide-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.25rem;margin-top:.75rem;font-size:.75rem}.guide-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.platform-api-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d426,#3b82f626);border:2px solid rgba(6,182,212,.5);border-radius:.75rem;padding:1.25rem;text-align:center;position:relative}.platform-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;left:50%;transform:translate(-50%);padding:.25rem 1rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border-radius:1rem;font-size:.75rem;color:#fff;font-weight:600;white-space:nowrap}.platform-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin:.5rem 0}.platform-api-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:.5rem 0;color:var(--text-primary, white);font-size:1.125rem}.platform-desc[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.platform-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;text-align:left;display:inline-block}.platform-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary, #cbd5e1);margin-bottom:.25rem}.platform-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}.platform-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #06b6d466}.divider-text[_ngcontent-%COMP%]{display:flex;align-items:center;margin:1rem 0;color:var(--text-muted, #64748b);font-size:.75rem}.divider-text[_ngcontent-%COMP%]:before, .divider-text[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:var(--border-default, rgba(148, 163, 184, .2))}.divider-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 .75rem}.advanced-option[_ngcontent-%COMP%]{text-align:center}.advanced-btn[_ngcontent-%COMP%]{background:transparent;border:1px dashed var(--border-default, rgba(148, 163, 184, .3));border-radius:.5rem;padding:.625rem 1rem;color:var(--text-muted, #94a3b8);font-size:.8rem;cursor:pointer;transition:all .2s}.advanced-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.advanced-hint[_ngcontent-%COMP%]{margin:.5rem 0 0;font-size:.7rem;color:var(--text-muted, #64748b)}.selected-display[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:#22c55e1a;border-top:1px solid rgba(34,197,94,.2)}.selected-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.selected-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.selected-name[_ngcontent-%COMP%]{font-weight:500;color:#86efac}.selected-id[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8)}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:1rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:var(--primary, #06b6d4);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}']})}};function bC(i,e){i&1&&(k(0,"span",21),l(1," \u751F\u6210\u4E2D... "))}function xC(i,e){i&1&&l(0," \u{1F4F7} \u751F\u6210\u4E8C\u7DAD\u78BC ")}function yC(i,e){if(i&1){let t=M();r(0,"div",6)(1,"div",7)(2,"p"),l(3,"\u4F7F\u7528 Telegram App \u6383\u63CF\u4E8C\u7DAD\u78BC\uFF0C\u5FEB\u901F\u6DFB\u52A0\u5E33\u865F\u3002"),s()(),r(4,"div",8)(5,"label",9),l(6,"\u{1F510} \u9078\u64C7 API \u6191\u64DA"),s(),r(7,"app-api-selector",10),x("apiSelected",function(o){v(t);let a=g();return b(a.onApiSelected(o))})("selectionCleared",function(){v(t);let o=g();return b(o.onApiCleared())}),s()(),r(8,"div",8)(9,"label",9),l(10,"\u{1F4F2} \u8A2D\u5099\u6A21\u64EC"),s(),r(11,"div",11)(12,"button",12),x("click",function(){v(t);let o=g();return b(o.deviceType.set("random"))}),l(13," \u{1F3B2} \u667A\u80FD\u96A8\u6A5F "),s(),r(14,"button",12),x("click",function(){v(t);let o=g();return b(o.deviceType.set("ios"))}),l(15," \u{1F4F1} iOS "),s(),r(16,"button",12),x("click",function(){v(t);let o=g();return b(o.deviceType.set("android"))}),l(17," \u{1F916} Android "),s(),r(18,"button",12),x("click",function(){v(t);let o=g();return b(o.deviceType.set("desktop"))}),l(19," \u{1F4BB} Desktop "),s()()(),r(20,"div",8)(21,"label",9),l(22,"\u{1F310} \u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),s(),r(23,"div",13)(24,"input",14),W("ngModelChange",function(o){v(t);let a=g();return K(a.proxyInput,o)||(a.proxyInput=o),b(o)}),s(),r(25,"button",15),x("click",function(){v(t);let o=g();return b(o.selectRandomProxy())}),l(26," \u{1F3B2} "),s()(),r(27,"div",16)(28,"input",17),W("ngModelChange",function(o){v(t);let a=g();return K(a.bindProxyToAccount,o)||(a.bindProxyToAccount=o),b(o)}),s(),r(29,"label",18),l(30,"\u70BA\u6B64\u5E33\u865F\u7D81\u5B9A\u6B64\u4EE3\u7406 IP\uFF08\u63A8\u85A6\uFF09"),s()()(),r(31,"div",8)(32,"label",9),l(33,"\u{1F510} \u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09"),s(),r(34,"input",19),W("ngModelChange",function(o){v(t);let a=g();return K(a.twoFactorPassword,o)||(a.twoFactorPassword=o),b(o)}),s()(),r(35,"button",20),x("click",function(){v(t);let o=g();return b(o.createQRLogin())}),S(36,bC,2,0)(37,xC,1,0),s()()}if(i&2){let t=g();c(7),V("showSelected",!1),c(5),I("active",t.deviceType()==="random"),c(2),I("active",t.deviceType()==="ios"),c(2),I("active",t.deviceType()==="android"),c(2),I("active",t.deviceType()==="desktop"),c(6),z("ngModel",t.proxyInput),c(4),z("ngModel",t.bindProxyToAccount),c(6),z("ngModel",t.twoFactorPassword),c(),V("disabled",t.isCreating()||!t.selectedApi()),c(),w(t.isCreating()?36:37)}}function SC(i,e){if(i&1&&k(0,"img",28),i&2){let t=g(3);V("src","data:image/png;base64,"+t.session().qrImageBase64,Ut)}}function wC(i,e){i&1&&(r(0,"div",29),k(1,"span",36),s())}function EC(i,e){if(i&1&&(r(0,"div",27),S(1,SC,1,1,"img",28)(2,wC,2,0,"div",29),s(),r(3,"div",30)(4,"div",31),l(5),s(),r(6,"p",32),l(7," 1. \u6253\u958B Telegram App"),k(8,"br"),l(9," 2. \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC"),k(10,"br"),l(11," 3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u767B\u5165 "),s()(),r(12,"div",33)(13,"span",34),l(14,"\u6A21\u64EC\u8A2D\u5099:"),s(),r(15,"span",35),l(16),s()()),i&2){let t,n=g(2);c(),w(n.session().qrImageBase64?1:2),c(3),I("warning",n.countdown()<=10),c(),D(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A",n.countdown()," \u79D2 "),c(11),Y("",(t=n.session().deviceInfo)==null?null:t.model," (",(t=n.session().deviceInfo)==null?null:t.system,")")}}function AC(i,e){i&1&&(k(0,"span",21),l(1," \u9A57\u8B49\u4E2D... "))}function DC(i,e){i&1&&l(0," \u78BA\u8A8D ")}function MC(i,e){if(i&1){let t=M();r(0,"div",23)(1,"div",37),l(2,"\u{1F510}"),s(),r(3,"h4"),l(4,"\u9700\u8981\u4E8C\u6B65\u9A57\u8B49"),s(),r(5,"p"),l(6,"\u8ACB\u8F38\u5165\u60A8\u7684\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF1A"),s(),r(7,"input",38),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.twoFactorInput,o)||(a.twoFactorInput=o),b(o)}),x("keyup.enter",function(){v(t);let o=g(2);return b(o.submit2FA())}),s(),r(8,"button",39),x("click",function(){v(t);let o=g(2);return b(o.submit2FA())}),S(9,AC,2,0)(10,DC,1,0),s()()}if(i&2){let t=g(2);c(7),z("ngModel",t.twoFactorInput),c(),V("disabled",!t.twoFactorInput||t.isSubmitting2FA()),c(),w(t.isSubmitting2FA()?9:10)}}function TC(i,e){if(i&1&&l(0),i&2){let t=g(4);D(" ",t.session().userInfo.lastName," ")}}function kC(i,e){if(i&1&&(r(0,"div",48),l(1),s()),i&2){let t=g(4);c(),A("@"+t.session().userInfo.username)}}function IC(i,e){if(i&1&&(r(0,"div",41)(1,"div",44),l(2),s(),r(3,"div",45)(4,"div",46),l(5),S(6,TC,1,1),s(),r(7,"div",47),l(8),s(),S(9,kC,2,1,"div",48),s()()),i&2){let t=g(3);c(2),D(" ",(t.session().userInfo.firstName||"?").charAt(0).toUpperCase()," "),c(3),D(" ",t.session().userInfo.firstName," "),c(),w(t.session().userInfo.lastName?6:-1),c(2),A(t.session().phone),c(),w(t.session().userInfo.username?9:-1)}}function PC(i,e){if(i&1){let t=M();r(0,"div",24)(1,"div",40),l(2,"\u2705"),s(),r(3,"h4"),l(4,"\u767B\u5165\u6210\u529F\uFF01"),s(),S(5,IC,10,5,"div",41),r(6,"p",42),l(7,"\u5E33\u865F\u5DF2\u6210\u529F\u6DFB\u52A0\uFF0C\u6B63\u5728\u5F8C\u53F0\u5347\u7D1A\u70BA\u539F\u751F API..."),s(),r(8,"button",43),x("click",function(){v(t);let o=g(2);return b(o.onClose())}),l(9,"\u5B8C\u6210"),s()()}if(i&2){let t=g(2);c(5),w(t.session().userInfo?5:-1)}}function FC(i,e){if(i&1){let t=M();r(0,"div",25)(1,"div",37),l(2,"\u23F0"),s(),r(3,"h4"),l(4,"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"),s(),r(5,"p"),l(6,"\u8ACB\u9EDE\u64CA\u4E0B\u65B9\u6309\u9215\u91CD\u65B0\u751F\u6210\u3002"),s(),r(7,"button",49),x("click",function(){v(t);let o=g(2);return b(o.refreshQR())}),l(8,"\u{1F504} \u91CD\u65B0\u751F\u6210"),s()()}}function NC(i,e){if(i&1){let t=M();r(0,"div",25)(1,"div",50),l(2,"\u274C"),s(),r(3,"h4"),l(4,"\u767B\u5165\u5931\u6557"),s(),r(5,"p"),l(6),s(),r(7,"button",49),x("click",function(){v(t);let o=g(2);return b(o.refreshQR())}),l(8,"\u{1F504} \u91CD\u8A66"),s()()}if(i&2){let t=g(2);c(6),A(t.session().message||"\u672A\u77E5\u932F\u8AA4")}}function RC(i,e){if(i&1){let t=M();r(0,"div",26)(1,"button",51),x("click",function(){v(t);let o=g(2);return b(o.refreshQR())}),l(2," \u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC "),s(),r(3,"button",52),x("click",function(){v(t);let o=g(2);return b(o.cancelLogin())}),l(4," \u274C \u53D6\u6D88 "),s()()}}function OC(i,e){if(i&1&&(r(0,"div",22),S(1,EC,17,6)(2,MC,11,3,"div",23)(3,PC,10,1,"div",24)(4,FC,9,0,"div",25)(5,NC,9,1,"div",25),s(),S(6,RC,5,0,"div",26)),i&2){let t,n=g();c(),w((t=n.session().status)==="pending"?1:t==="waiting_2fa"?2:t==="success"?3:t==="expired"?4:t==="error"?5:-1),c(5),w(n.session().status==="pending"?6:-1)}}var Po=class i{constructor(){this.ipcService=O(ye);this.toast=O(ue);this.i18n=O(Xe);this.closed=new ot;this.loginSuccess=new ot;this.session=_(null);this.isCreating=_(!1);this.isSubmitting2FA=_(!1);this.countdown=_(60);this.deviceType=_("random");this.proxyInput="";this.twoFactorPassword="";this.twoFactorInput="";this.bindProxyToAccount=!0;this.selectedApi=_(null);this.countdownTimer=null;this.statusCheckTimer=null;this.createTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}onApiSelected(e){this.selectedApi.set(e)}onApiCleared(){this.selectedApi.set(null)}ngOnDestroy(){this.clearTimers(),this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.ipcChannels.forEach(e=>{this.ipcService.cleanup(e)}),this.ipcChannels=[]}setupIpcListeners(){this.ipcService.on("qr-login-created",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),console.log("[QR Login] QR code created successfully",e),e.success!==!1&&(this.session.set({sessionId:e.sessionId,qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,expiresIn:e.expiresIn,status:"pending",deviceInfo:e.deviceInfo,message:e.message}),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-created"),this.ipcService.on("qr-login-status",e=>{let t=this.session();t&&e.sessionId===t.sessionId&&this.session.set(B(F({},t),{status:e.status,message:e.message}))}),this.ipcChannels.push("qr-login-status"),this.ipcService.on("qr-login-success",e=>{this.clearTimers();let t=this.session();t&&this.session.set(B(F({},t),{status:"success",phone:e.phone,userInfo:e.userInfo,message:e.message})),this.toast.success(e.message||"\u767B\u5165\u6210\u529F\uFF01"),this.loginSuccess.emit(e)}),this.ipcChannels.push("qr-login-success"),this.ipcService.on("qr-login-refreshed",e=>{let t=this.session();t&&e.success!==!1&&(this.session.set(B(F({},t),{qrUrl:e.qrUrl,qrImageBase64:e.qrImageBase64,expiresAt:e.expiresAt,status:"pending"})),this.startCountdown(e.expiresIn||60))}),this.ipcChannels.push("qr-login-refreshed"),this.ipcService.on("qr-login-error",e=>{this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!1),this.isSubmitting2FA.set(!1),console.error("[QR Login] Error:",e.error);let t=this.session();t&&this.session.set(B(F({},t),{status:"error",message:e.error})),this.toast.error(e.error||"\u64CD\u4F5C\u5931\u6557")}),this.ipcChannels.push("qr-login-error"),this.ipcService.on("qr-login-2fa-success",e=>{this.isSubmitting2FA.set(!1)}),this.ipcChannels.push("qr-login-2fa-success")}createQRLogin(){let e=this.selectedApi();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API \u6191\u64DA");return}this.createTimeout&&(clearTimeout(this.createTimeout),this.createTimeout=null),this.isCreating.set(!0);let t={proxy:this.proxyInput||null,deviceType:this.deviceType()==="random"?null:this.deviceType(),twoFactorPassword:this.twoFactorPassword||null,bindProxy:this.bindProxyToAccount,customApiId:e.api_id,customApiHash:e.api_hash};console.log("[QR Login] Creating QR login...",B(F({},t),{customApiHash:"***"})),this.createTimeout=setTimeout(()=>{this.isCreating()&&(console.error("[QR Login] Timeout waiting for QR code generation (60s)"),this.isCreating.set(!1),this.toast.error(`\u751F\u6210\u4E8C\u7DAD\u78BC\u8D85\u6642\uFF0860\u79D2\uFF09\uFF0C\u8ACB\u6AA2\u67E5\uFF1A
1. \u5F8C\u7AEF\u65E5\u8A8C\u662F\u5426\u6709\u932F\u8AA4
2. \u7DB2\u7D61\u9023\u63A5\u662F\u5426\u6B63\u5E38
3. \u4EE3\u7406\u8A2D\u7F6E\u662F\u5426\u6B63\u78BA
4. \u662F\u5426\u5DF2\u5B89\u88DD telethon \u548C qrcode \u5EAB`),this.createTimeout=null)},6e4),this.ipcService.send("qr-login-create",t)}refreshQR(){let e=this.session();e?this.ipcService.send("qr-login-refresh",{sessionId:e.sessionId}):this.createQRLogin()}submit2FA(){let e=this.session();!e||!this.twoFactorInput||(this.isSubmitting2FA.set(!0),this.ipcService.send("qr-login-submit-2fa",{sessionId:e.sessionId,password:this.twoFactorInput}))}cancelLogin(){let e=this.session();e&&this.ipcService.send("qr-login-cancel",{sessionId:e.sessionId}),this.clearTimers(),this.session.set(null)}onClose(){this.cancelLogin(),this.closed.emit()}selectRandomProxy(){this.toast.info("\u4EE3\u7406\u6C60\u529F\u80FD\u5373\u5C07\u63A8\u51FA")}startCountdown(e){this.clearTimers(),this.countdown.set(e),this.countdownTimer=setInterval(()=>{let t=this.countdown();if(t<=1){this.clearTimers();let n=this.session();n&&n.status==="pending"&&this.session.set(B(F({},n),{status:"expired",message:"\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"}))}else this.countdown.set(t-1)},1e3)}clearTimers(){this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null),this.statusCheckTimer&&(clearInterval(this.statusCheckTimer),this.statusCheckTimer=null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-qr-login"]],outputs:{closed:"closed",loginSuccess:"loginSuccess"},decls:11,vars:1,consts:[[1,"qr-login-container"],[1,"header"],[1,"title"],[1,"icon"],[1,"close-btn",3,"click"],[1,"content"],[1,"setup-section"],[1,"info-box"],[1,"option-group"],[1,"option-label"],[3,"apiSelected","selectionCleared","showSelected"],[1,"device-options"],[1,"device-btn",3,"click"],[1,"proxy-input-group"],["type","text","placeholder","socks5://host:port \u6216\u7559\u7A7A\u4F7F\u7528\u76F4\u9023",1,"proxy-input",3,"ngModelChange","ngModel"],["title","\u96A8\u6A5F\u9078\u64C7\u4EE3\u7406",1,"random-proxy-btn",3,"click"],[1,"checkbox-option"],["type","checkbox","id","bindProxy",3,"ngModelChange","ngModel"],["for","bindProxy"],["type","password","placeholder","\u53EF\u9078\uFF0C\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49",1,"form-input",3,"ngModelChange","ngModel"],[1,"create-btn",3,"click","disabled"],[1,"spinner"],[1,"qr-section"],[1,"tfa-section"],[1,"success-section"],[1,"error-section"],[1,"action-buttons"],[1,"qr-display"],["alt","QR Code",1,"qr-image",3,"src"],[1,"qr-placeholder"],[1,"qr-info"],[1,"countdown"],[1,"instruction"],[1,"device-info"],[1,"label"],[1,"value"],[1,"spinner","large"],[1,"status-icon","warning"],["type","password","placeholder","\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input","tfa-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"submit-btn",3,"click","disabled"],[1,"status-icon","success"],[1,"user-info-card"],[1,"success-message"],[1,"done-btn",3,"click"],[1,"user-avatar"],[1,"user-details"],[1,"user-name"],[1,"user-phone"],[1,"user-username"],[1,"refresh-btn",3,"click"],[1,"status-icon","error"],[1,"action-btn","secondary",3,"click"],[1,"action-btn","cancel",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2)(3,"span",3),l(4,"\u{1F4F1}"),s(),l(5," \u6383\u78BC\u5FEB\u901F\u767B\u5165 "),s(),r(6,"button",4),x("click",function(){return n.onClose()}),l(7,"\xD7"),s()(),r(8,"div",5),S(9,yC,38,14,"div",6)(10,OC,7,2),s()()),t&2&&(c(9),w(n.session()?10:9))},dependencies:[te,me,xe,nn,_e,Ce,En],styles:[".qr-login-container[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .95));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;width:420px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px -12px #00000080}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary, white)}.icon[_ngcontent-%COMP%]{font-size:1.25rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);font-size:1.5rem;cursor:pointer;padding:.25rem;line-height:1}.close-btn[_ngcontent-%COMP%]:hover{color:var(--text-primary, white)}.content[_ngcontent-%COMP%]{padding:1.5rem}.setup-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.info-box[_ngcontent-%COMP%]{background:#06b6d41a;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:1rem}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-secondary, #cbd5e1);font-size:.875rem}.info-box[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.75rem;margin-top:.5rem}.option-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.option-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary, #cbd5e1)}.device-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem}.device-btn[_ngcontent-%COMP%]{padding:.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);font-size:.75rem;cursor:pointer;transition:all .2s}.device-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.device-btn.active[_ngcontent-%COMP%]{background:#06b6d433;border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.proxy-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.proxy-input[_ngcontent-%COMP%]{flex:1;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.proxy-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.random-proxy-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s}.random-proxy-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.checkbox-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.checkbox-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--primary, #06b6d4)}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.create-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;margin-top:.5rem}.create-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.create-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.qr-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.qr-display[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:.75rem}.qr-image[_ngcontent-%COMP%]{width:200px;height:200px;display:block}.qr-placeholder[_ngcontent-%COMP%]{width:200px;height:200px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.qr-info[_ngcontent-%COMP%]{text-align:center}.countdown[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--primary, #06b6d4);margin-bottom:.5rem}.countdown.warning[_ngcontent-%COMP%]{color:#f59e0b;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.instruction[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-muted, #94a3b8);line-height:1.6;margin:0}.device-info[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.5rem 1rem;border-radius:.5rem}.device-info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-right:.5rem}.tfa-section[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:1rem}.status-icon[_ngcontent-%COMP%]{font-size:3rem}.status-icon.success[_ngcontent-%COMP%]{color:#22c55e}.status-icon.warning[_ngcontent-%COMP%]{color:#f59e0b}.status-icon.error[_ngcontent-%COMP%]{color:#ef4444}.tfa-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.tfa-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .success-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-muted, #94a3b8);font-size:.875rem}.tfa-input[_ngcontent-%COMP%]{max-width:250px;text-align:center}.submit-btn[_ngcontent-%COMP%], .done-btn[_ngcontent-%COMP%], .refresh-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.refresh-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.user-info-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;width:100%}.user-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:700;color:#fff}.user-details[_ngcontent-%COMP%]{text-align:left}.user-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.user-phone[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.user-username[_ngcontent-%COMP%]{font-size:.75rem;color:var(--primary, #06b6d4)}.success-message[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem;width:100%}.action-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem 1rem;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;font-size:.875rem;cursor:pointer;transition:all .2s}.action-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-secondary, #cbd5e1)}.action-btn.secondary[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.action-btn.cancel[_ngcontent-%COMP%]{background:#ef44441a;border-color:#ef44444d;color:#fca5a5}.action-btn.cancel[_ngcontent-%COMP%]:hover{background:#ef444433}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.spinner.large[_ngcontent-%COMP%]{width:40px;height:40px;border-width:3px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.warning-box[_ngcontent-%COMP%]{background:#ef444426;border:1px solid rgba(239,68,68,.4);border-radius:.75rem;overflow:hidden}.warning-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#ef444433;border-bottom:1px solid rgba(239,68,68,.3)}.warning-icon[_ngcontent-%COMP%]{font-size:1.25rem}.warning-title[_ngcontent-%COMP%]{flex:1;font-weight:600;color:#fca5a5}.dismiss-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fca5a5;font-size:1.25rem;cursor:pointer;padding:0;line-height:1}.warning-content[_ngcontent-%COMP%]{padding:.75rem 1rem}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#fecaca;font-size:.8rem}.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:.5rem 0;padding-left:1.25rem;color:#fca5a5;font-size:.75rem}.warning-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.warning-action[_ngcontent-%COMP%]{margin-top:.75rem!important;padding-top:.5rem;border-top:1px solid rgba(239,68,68,.2)}.warning-action[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa;text-decoration:underline}.api-section[_ngcontent-%COMP%]{background:#06b6d40d;border:1px solid rgba(6,182,212,.2);border-radius:.5rem;padding:.75rem}.option-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.checkbox-option.inline[_ngcontent-%COMP%]{font-size:.75rem}.api-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.api-input-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.input-label[_ngcontent-%COMP%]{width:70px;font-size:.75rem;color:var(--text-muted, #94a3b8)}.api-input-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1}.api-hint[_ngcontent-%COMP%]{margin:0;font-size:.7rem;color:var(--text-muted, #64748b)}.api-hint[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.public-api-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#ef44441a;border-radius:.25rem;font-size:.75rem;color:#fca5a5}.warning-badge[_ngcontent-%COMP%]{background:#ef44444d;padding:.125rem .375rem;border-radius:.25rem;font-size:.65rem;font-weight:600}"]})}};var BC=()=>[],VC=(i,e)=>e.index;function LC(i,e){if(i&1){let t=M();r(0,"div",9)(1,"div",13)(2,"h2"),l(3,"\u{1F510} \u9078\u64C7 API \u6191\u64DA"),s(),r(4,"p"),l(5,"\u9078\u64C7\u6216\u6DFB\u52A0 API \u6191\u64DA\u4EE5\u9023\u63A5 Telegram"),s()(),r(6,"app-api-selector",14),x("apiSelected",function(o){v(t);let a=g();return b(a.onApiSelected(o))})("selectionCleared",function(){v(t);let o=g();return b(o.onApiCleared())}),s(),r(7,"div",15)(8,"button",16),x("click",function(){v(t);let o=g();return b(o.goBack())}),l(9,"\u2190 \u8FD4\u56DE"),s(),r(10,"button",17),x("click",function(){v(t);let o=g();return b(o.proceedToLogin())}),l(11," \u4E0B\u4E00\u6B65\uFF1A\u9078\u64C7\u767B\u5165\u65B9\u5F0F \u2192 "),s()()()}if(i&2){let t=g();c(6),V("showSelected",!0),c(4),V("disabled",!t.selectedApiCredential())}}function GC(i,e){if(i&1){let t=M();r(0,"div",10)(1,"div",13)(2,"h2"),l(3,"\u9078\u64C7\u767B\u5165\u65B9\u5F0F"),s(),r(4,"p"),l(5,"\u9078\u64C7\u6700\u9069\u5408\u60A8\u7684\u5E33\u865F\u767B\u5165\u65B9\u5F0F"),s()(),r(6,"div",18)(7,"div",19),x("click",function(){v(t);let o=g();return b(o.selectLoginMethod("code"))}),r(8,"div",20),l(9,"\u2705 \u63A8\u85A6"),s(),r(10,"div",21),l(11,"\u{1F4AC}"),s(),r(12,"h3"),l(13,"\u9A57\u8B49\u78BC\u767B\u5165"),s(),r(14,"p"),l(15,"\u8F38\u5165\u624B\u6A5F\u865F\uFF0C\u63A5\u6536\u9A57\u8B49\u78BC\u5B8C\u6210\u767B\u5165"),s(),r(16,"ul")(17,"li"),l(18,"\u{1F7E2} \u6A19\u6E96\u5B98\u65B9\u767B\u5165\u65B9\u5F0F"),s(),r(19,"li"),l(20,"\u{1F7E2} \u98A8\u96AA\u6700\u4F4E"),s(),r(21,"li"),l(22,"\u{1F7E1} \u9700\u8981\u80FD\u6536\u5230\u9A57\u8B49\u78BC"),s()(),r(23,"div",22),l(24,"\u98A8\u96AA\uFF1A\u4F4E"),s()(),r(25,"div",23),x("click",function(){v(t);let o=g();return b(o.selectLoginMethod("tdata"))}),r(26,"div",20),l(27,"\u{1F6E1}\uFE0F \u6700\u5B89\u5168"),s(),r(28,"div",21),l(29,"\u{1F4C2}"),s(),r(30,"h3"),l(31,"TData \u5C0E\u5165"),s(),r(32,"p"),l(33,"\u5C0E\u5165\u5DF2\u6709\u7684 Session \u6587\u4EF6"),s(),r(34,"ul")(35,"li"),l(36,"\u{1F7E2} \u7121\u9700\u91CD\u65B0\u767B\u5165"),s(),r(37,"li"),l(38,"\u{1F7E2} \u98A8\u96AA\u6700\u4F4E"),s(),r(39,"li"),l(40,"\u{1F7E2} \u652F\u6301\u6279\u91CF\u5C0E\u5165"),s()(),r(41,"div",24),l(42,"\u98A8\u96AA\uFF1A\u6700\u4F4E"),s()(),r(43,"div",25),x("click",function(){v(t);let o=g();return b(o.selectLoginMethod("qr"))}),r(44,"div",20),l(45,"\u26A0\uFE0F \u9700\u8B39\u614E"),s(),r(46,"div",21),l(47,"\u{1F4F1}"),s(),r(48,"h3"),l(49,"\u6383\u78BC\u767B\u5165"),s(),r(50,"p"),l(51,"\u4F7F\u7528 Telegram APP \u6383\u63CF\u4E8C\u7DAD\u78BC"),s(),r(52,"ul")(53,"li"),l(54,"\u{1F7E2} \u7121\u9700\u9A57\u8B49\u78BC"),s(),r(55,"li"),l(56,"\u{1F7E1} \u9700\u8981\u624B\u6A5F\u5728\u65C1"),s(),r(57,"li"),l(58,"\u{1F534} \u7B2C\u4E09\u65B9\u7279\u5FB5\uFF0C\u98A8\u96AA\u8F03\u9AD8"),s()(),r(59,"div",26),l(60,"\u98A8\u96AA\uFF1A\u8F03\u9AD8"),s()()(),r(61,"div",15)(62,"button",16),x("click",function(){v(t);let o=g();return b(o.currentStep.set(1))}),l(63,"\u2190 \u8FD4\u56DE"),s()()()}}function UC(i,e){i&1&&(r(0,"span",32),l(1,"\u2713"),s())}function qC(i,e){if(i&1&&(r(0,"span",33),l(1),s()),i&2){let t=g(3);c(),A(t.phoneError())}}function $C(i,e){i&1&&(r(0,"span",34),l(1,"\u8ACB\u5305\u542B\u570B\u5BB6\u4EE3\u78BC\uFF0C\u4F8B\u5982 +63, +86, +1"),s())}function HC(i,e){if(i&1){let t=M();r(0,"input",45),W("ngModelChange",function(o){v(t);let a=g(3);return K(a.proxyAddress,o)||(a.proxyAddress=o),b(o)}),s()}if(i&2){let t=g(3);z("ngModel",t.proxyAddress)}}function zC(i,e){i&1&&(k(0,"span",46),l(1," \u767C\u9001\u4E2D... "))}function KC(i,e){i&1&&l(0," \u767C\u9001\u9A57\u8B49\u78BC \u2192 ")}function WC(i,e){if(i&1){let t=M();r(0,"div",28)(1,"label"),l(2,"\u624B\u6A5F\u865F\u78BC "),r(3,"span",29),l(4,"*"),s()(),r(5,"div",30)(6,"input",31),x("ngModelChange",function(o){v(t);let a=g(2);return b(a.onPhoneChange(o))}),s(),S(7,UC,2,0,"span",32),s(),S(8,qC,2,1,"span",33)(9,$C,2,0,"span",34),s(),r(10,"div",28)(11,"label"),l(12,"\u4EE3\u7406\u8A2D\u7F6E"),s(),r(13,"div",35)(14,"label",36)(15,"input",37),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.proxyMode,o)||(a.proxyMode=o),b(o)}),s(),r(16,"span",38)(17,"span",39),l(18,"\u{1F310}"),s(),r(19,"span",40)(20,"strong"),l(21,"\u81EA\u52D5\u5206\u914D\u975C\u614B\u4EE3\u7406"),s(),r(22,"small"),l(23,"\u5F9E\u4EE3\u7406\u6C60\u81EA\u52D5\u5206\u914D\uFF0C\u9632\u5C01\u63A8\u85A6"),s()()()(),r(24,"label",36)(25,"input",41),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.proxyMode,o)||(a.proxyMode=o),b(o)}),s(),r(26,"span",38)(27,"span",39),l(28,"\u270F\uFE0F"),s(),r(29,"span",40)(30,"strong"),l(31,"\u624B\u52D5\u8F38\u5165\u4EE3\u7406"),s(),r(32,"small"),l(33,"\u4F7F\u7528\u81EA\u5DF1\u7684\u4EE3\u7406\u5730\u5740"),s()()()(),r(34,"label",36)(35,"input",42),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.proxyMode,o)||(a.proxyMode=o),b(o)}),s(),r(36,"span",38)(37,"span",39),l(38,"\u{1F6AB}"),s(),r(39,"span",40)(40,"strong"),l(41,"\u4E0D\u4F7F\u7528\u4EE3\u7406"),s(),r(42,"small"),l(43,"\u76F4\u63A5\u9023\u63A5\uFF0C\u6709\u5C01\u865F\u98A8\u96AA"),s()()()()(),S(44,HC,1,1,"input",43),s(),r(45,"div",28)(46,"label"),l(47,"\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09"),s(),r(48,"input",44),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.twoFactorPassword,o)||(a.twoFactorPassword=o),b(o)}),s()(),r(49,"div",15)(50,"button",16),x("click",function(){v(t);let o=g(2);return b(o.currentLoginMethod.set("select"))}),l(51,"\u2190 \u8FD4\u56DE"),s(),r(52,"button",17),x("click",function(){v(t);let o=g(2);return b(o.sendVerificationCode())}),S(53,zC,2,0)(54,KC,1,0),s()()}if(i&2){let t=g(2);c(6),I("error",t.phoneError())("valid",t.phoneValid()),V("ngModel",t.phoneNumber),c(),w(t.phoneValid()?7:-1),c(),w(t.phoneError()?8:9),c(7),z("ngModel",t.proxyMode),c(10),z("ngModel",t.proxyMode),c(10),z("ngModel",t.proxyMode),c(9),w(t.proxyMode==="manual"?44:-1),c(4),z("ngModel",t.twoFactorPassword),c(4),V("disabled",!t.phoneValid()||t.isSending()),c(),w(t.isSending()?53:54)}}function JC(i,e){if(i&1){let t=M();r(0,"div",28)(1,"label"),l(2,"\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC "),r(3,"span",29),l(4,"*"),s()(),r(5,"input",52),W("ngModelChange",function(o){v(t);let a=g(3);return K(a.twoFactorPassword,o)||(a.twoFactorPassword=o),b(o)}),s()()}if(i&2){let t=g(3);c(5),z("ngModel",t.twoFactorPassword)}}function QC(i,e){if(i&1&&l(0),i&2){let t=g(3);D(" ",t.resendCooldown(),"\u79D2\u5F8C\u53EF\u91CD\u767C ")}}function YC(i,e){i&1&&l(0," \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC ")}function XC(i,e){i&1&&(k(0,"span",46),l(1," \u9A57\u8B49\u4E2D... "))}function ZC(i,e){i&1&&l(0," \u9A57\u8B49\u4E26\u767B\u5165 \u2192 ")}function jC(i,e){if(i&1){let t=M();r(0,"div",47)(1,"span",48),l(2,"\u{1F4F1}"),s(),l(3),s(),r(4,"div",28)(5,"label"),l(6,"\u9A57\u8B49\u78BC "),r(7,"span",29),l(8,"*"),s()(),r(9,"input",49),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.verificationCode,o)||(a.verificationCode=o),b(o)}),s()(),S(10,JC,6,1,"div",28),r(11,"div",50)(12,"button",51),x("click",function(){v(t);let o=g(2);return b(o.resendCode())}),S(13,QC,1,1)(14,YC,1,0),s()(),r(15,"div",15)(16,"button",16),x("click",function(){v(t);let o=g(2);return b(o.codeStep.set(!1))}),l(17,"\u2190 \u8FD4\u56DE"),s(),r(18,"button",17),x("click",function(){v(t);let o=g(2);return b(o.submitVerificationCode())}),S(19,XC,2,0)(20,ZC,1,0),s()()}if(i&2){let t=g(2);c(3),D(" \u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 ",t.phoneNumber," "),c(6),z("ngModel",t.verificationCode),c(),w(t.needs2FA()?10:-1),c(2),V("disabled",t.resendCooldown()>0),c(),w(t.resendCooldown()>0?13:14),c(5),V("disabled",!t.verificationCode||t.isVerifying()),c(),w(t.isVerifying()?19:20)}}function ev(i,e){if(i&1&&(r(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4AC} \u9A57\u8B49\u78BC\u767B\u5165"),s()(),r(4,"div",27),S(5,WC,55,14)(6,jC,21,7),s()()),i&2){let t=g();c(5),w(t.codeStep()?6:5)}}function tv(i,e){if(i&1&&(r(0,"span",78),l(1),s()),i&2){let t=g().$implicit;c(),A(t.first_name||t.username)}}function nv(i,e){if(i&1&&(r(0,"span",79),l(1),s()),i&2){let t=g().$implicit;c(),A(t.error||"\u7121\u6CD5\u5C0E\u5165")}}function iv(i,e){if(i&1){let t=M();r(0,"label",74)(1,"input",75),x("change",function(){let o=v(t).$implicit,a=g(5);return b(a.toggleTdataAccount(o.index))}),s(),r(2,"div",76)(3,"span",77),l(4),s(),S(5,tv,2,1,"span",78),S(6,nv,2,1,"span",79),s()()}if(i&2){let t=e.$implicit,n=g(5);I("disabled",!t.can_import),c(),V("checked",n.selectedTdataAccounts().includes(t.index))("disabled",!t.can_import),c(3),A(t.phone),c(),w(t.first_name||t.username?5:-1),c(),w(t.can_import?-1:6)}}function ov(i,e){if(i&1&&(r(0,"div",70)(1,"h4"),l(2),s(),r(3,"div",72),$(4,iv,7,7,"label",73,VC),s()()),i&2){let t,n=g(4);c(2),D("\u{1F4CB} \u6AA2\u6E2C\u5230 ",((t=n.tdataScanResult().accounts)==null?null:t.length)||0," \u500B\u5E33\u865F"),c(2),H(n.tdataScanResult().accounts||$t(1,BC))}}function rv(i,e){if(i&1&&(r(0,"div",71)(1,"span",80),l(2,"\u274C"),s(),r(3,"span"),l(4),s()()),i&2){let t=g(4);c(4),A(t.tdataScanResult().error||"\u6383\u63CF\u5931\u6557")}}function sv(i,e){if(i&1&&S(0,ov,6,2,"div",70)(1,rv,5,1,"div",71),i&2){let t=g(3);w(t.tdataScanResult().success?0:1)}}function av(i,e){i&1&&(r(0,"div",69),k(1,"span",46),r(2,"span"),l(3,"\u6B63\u5728\u6383\u63CF TData..."),s()())}function lv(i,e){if(i&1){let t=M();r(0,"div",57)(1,"h4"),l(2,"\u{1F4CD} TData \u4F4D\u7F6E"),s(),r(3,"div",58)(4,"code"),l(5),s(),r(6,"div",59)(7,"button",60),x("click",function(){v(t);let o=g(2);return b(o.copyTdataPath())}),l(8,"\u{1F4CB}"),s(),r(9,"button",61),x("click",function(){v(t);let o=g(2);return b(o.openTdataFolder())}),l(10,"\u{1F4C2}"),s()()()(),r(11,"div",62),x("dragover",function(o){v(t);let a=g(2);return b(a.onDragOver(o))})("dragleave",function(o){v(t);let a=g(2);return b(a.onDragLeave(o))})("drop",function(o){v(t);let a=g(2);return b(a.onDropTdata(o))}),r(12,"div",63),l(13,"\u{1F4C1}"),s(),r(14,"p",64),l(15,"\u62D6\u653E tdata \u6587\u4EF6\u593E\u5230\u9019\u88E1"),s(),r(16,"p",65),l(17,"\u652F\u6301\uFF1A\u6574\u500B\u6587\u4EF6\u593E / ZIP \u58D3\u7E2E\u5305"),s(),r(18,"div",66)(19,"button",67),x("click",function(){v(t);let o=g(2);return b(o.selectTdataFolder())}),l(20,"\u9078\u64C7\u6587\u4EF6\u593E"),s(),r(21,"button",68),x("click",function(){v(t);let o=g(2);return b(o.selectTdataZip())}),l(22,"\u9078\u64C7 ZIP"),s()()(),S(23,sv,2,1),S(24,av,4,0,"div",69)}if(i&2){let t=g(2);c(5),A(t.getDefaultTdataPath()),c(6),I("dragging",t.isDragging()),c(12),w(t.tdataScanResult()?23:-1),c(),w(t.isScanningTdata()?24:-1)}}function cv(i,e){if(i&1){let t=M();r(0,"div",83)(1,"span",84),l(2,"\u{1F4C4}"),s(),r(3,"span",85),l(4),s(),r(5,"button",86),x("click",function(){v(t);let o=g(3);return b(o.clearSelectedFile())}),l(6,"\xD7"),s()()}if(i&2){let t=g(3);c(4),A(t.selectedFilePath())}}function dv(i,e){if(i&1){let t=M();r(0,"div",81)(1,"h4"),l(2,"\u652F\u6301\u7684\u683C\u5F0F"),s(),r(3,"ul")(4,"li")(5,"strong"),l(6,".tgpkg"),s(),l(7," - TG-Matrix \u5C0E\u51FA\u5305\uFF08\u63A8\u85A6\uFF09"),s(),r(8,"li")(9,"strong"),l(10,".session"),s(),l(11," - Pyrogram Session \u6587\u4EF6"),s(),r(12,"li")(13,"strong"),l(14,".telethon.session"),s(),l(15," - Telethon Session \u6587\u4EF6"),s()()(),r(16,"div",82),x("dragover",function(o){v(t);let a=g(2);return b(a.onDragOver(o))})("dragleave",function(o){v(t);let a=g(2);return b(a.onDragLeave(o))})("drop",function(o){v(t);let a=g(2);return b(a.onDrop(o))})("click",function(){v(t);let o=g(2);return b(o.selectSessionFile())}),r(17,"div",63),l(18,"\u{1F4C4}"),s(),r(19,"p",64),l(20,"\u62D6\u653E Session \u6587\u4EF6\u5230\u9019\u88E1"),s(),r(21,"p",65),l(22,"\u6216\u9EDE\u64CA\u9078\u64C7\u6587\u4EF6"),s()(),S(23,cv,7,1,"div",83)}if(i&2){let t=g(2);c(16),I("dragging",t.isDragging()),c(7),w(t.selectedFilePath()?23:-1)}}function uv(i,e){i&1&&(k(0,"span",46),l(1," \u5C0E\u5165\u4E2D... "))}function mv(i,e){if(i&1&&l(0),i&2){let t=g(3);D(" \u5C0E\u5165 ",t.selectedTdataAccounts().length," \u500B\u5E33\u865F \u2192 ")}}function pv(i,e){if(i&1){let t=M();r(0,"button",17),x("click",function(){v(t);let o=g(2);return b(o.importTdataAccounts())}),S(1,uv,2,0)(2,mv,1,1),s()}if(i&2){let t=g(2);V("disabled",t.selectedTdataAccounts().length===0||t.isImporting()),c(),w(t.isImporting()?1:2)}}function gv(i,e){i&1&&(k(0,"span",46),l(1," \u5C0E\u5165\u4E2D... "))}function hv(i,e){i&1&&l(0," \u5C0E\u5165 Session \u2192 ")}function fv(i,e){if(i&1){let t=M();r(0,"button",17),x("click",function(){v(t);let o=g(2);return b(o.importSession())}),S(1,gv,2,0)(2,hv,1,0),s()}if(i&2){let t=g(2);V("disabled",!t.selectedFilePath()||t.isImporting()),c(),w(t.isImporting()?1:2)}}function _v(i,e){if(i&1){let t=M();r(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4C2} TData / Session \u5C0E\u5165"),s()(),r(4,"div",27)(5,"div",53)(6,"button",54),x("click",function(){v(t);let o=g();return b(o.tdataImportMode.set("tdata"))}),l(7," \u{1F4C2} TData \u6587\u4EF6\u593E "),r(8,"span",55),l(9,"\u63A8\u85A6"),s()(),r(10,"button",54),x("click",function(){v(t);let o=g();return b(o.tdataImportMode.set("session"))}),l(11," \u{1F4C4} Session \u6587\u4EF6 "),s()(),S(12,lv,25,5),S(13,dv,24,3),r(14,"div",15)(15,"button",16),x("click",function(){v(t);let o=g();return b(o.currentLoginMethod.set("select"))}),l(16,"\u2190 \u8FD4\u56DE"),s(),S(17,pv,3,2,"button",56)(18,fv,3,2,"button",56),s()()()}if(i&2){let t=g();c(6),I("active",t.tdataImportMode()==="tdata"),c(4),I("active",t.tdataImportMode()==="session"),c(2),w(t.tdataImportMode()==="tdata"?12:-1),c(),w(t.tdataImportMode()==="session"?13:-1),c(4),w(t.tdataImportMode()==="tdata"?17:18)}}function Cv(i,e){if(i&1){let t=M();r(0,"div",15)(1,"button",16),x("click",function(){v(t);let o=g(2);return b(o.currentLoginMethod.set("select"))}),l(2,"\u2190 \u8FD4\u56DE"),s(),r(3,"button",90),x("click",function(){v(t);let o=g(2);return b(o.generateQRCode())}),l(4,"\u751F\u6210\u4E8C\u7DAD\u78BC \u2192"),s()()}}function vv(i,e){if(i&1){let t=M();r(0,"div",91)(1,"div",92),k(2,"img",93),s(),r(3,"div",94),l(4),s(),r(5,"div",95)(6,"p"),l(7,"1. \u6253\u958B\u624B\u6A5F Telegram APP"),s(),r(8,"p"),l(9,"2. \u524D\u5F80 \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC"),s(),r(10,"p"),l(11,"3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u6388\u6B0A"),s()()(),r(12,"div",15)(13,"button",16),x("click",function(){v(t);let o=g(2);return b(o.currentLoginMethod.set("select"))}),l(14,"\u2190 \u8FD4\u56DE"),s(),r(15,"button",90),x("click",function(){v(t);let o=g(2);return b(o.refreshQRCode())}),l(16,"\u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC"),s()()}if(i&2){let t=g(2);c(2),V("src","data:image/png;base64,"+t.qrImageBase64(),Ut),c(),I("warning",t.qrCountdown()<=10),c(),D(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A",t.qrCountdown()," \u79D2 ")}}function bv(i,e){if(i&1){let t=M();r(0,"div",11)(1,"div",13)(2,"h2"),l(3,"\u{1F4F1} \u6383\u78BC\u767B\u5165"),s()(),r(4,"div",27)(5,"div",28)(6,"label"),l(7,"\u8A2D\u5099\u6A21\u64EC"),s(),r(8,"div",87)(9,"button",88),x("click",function(){v(t);let o=g();return b(o.deviceType.set("random"))}),l(10,"\u{1F3B2} \u96A8\u6A5F"),s(),r(11,"button",88),x("click",function(){v(t);let o=g();return b(o.deviceType.set("ios"))}),l(12,"\u{1F4F1} iOS"),s(),r(13,"button",88),x("click",function(){v(t);let o=g();return b(o.deviceType.set("android"))}),l(14,"\u{1F916} Android"),s()()(),r(15,"div",28)(16,"label"),l(17,"\u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09"),s(),r(18,"input",89),W("ngModelChange",function(o){v(t);let a=g();return K(a.proxyAddress,o)||(a.proxyAddress=o),b(o)}),s()(),S(19,Cv,5,0,"div",15)(20,vv,17,4),s()()}if(i&2){let t=g();c(9),I("active",t.deviceType()==="random"),c(2),I("active",t.deviceType()==="ios"),c(2),I("active",t.deviceType()==="android"),c(5),z("ngModel",t.proxyAddress),c(),w(t.qrImageBase64()?20:19)}}function xv(i,e){if(i&1&&(r(0,"div",101),l(1),s()),i&2){let t=g(3);c(),A("@"+t.addedAccountInfo().username)}}function yv(i,e){i&1&&(r(0,"span",103),l(1,"\u{1F680} \u5E73\u53F0\u516C\u5171 API"),s())}function Sv(i,e){if(i&1&&(r(0,"span",104),l(1),s()),i&2){let t=g(4);c(),D("\u{1F510} ",t.selectedApiCredential().name||"API "+t.selectedApiCredential().api_id)}}function wv(i,e){if(i&1&&(r(0,"div",102),S(1,yv,2,0,"span",103)(2,Sv,2,1,"span",104),s()),i&2){let t=g(3);c(),w(t.selectedApiCredential().source==="platform"?1:2)}}function Ev(i,e){if(i&1&&(r(0,"div",98)(1,"div",99),l(2),s(),r(3,"div",100)(4,"div",78),l(5),s(),r(6,"div",77),l(7),s(),S(8,xv,2,1,"div",101),s()(),S(9,wv,3,1,"div",102)),i&2){let t=g(2);c(2),D(" ",(t.addedAccountInfo().firstName||t.addedAccountInfo().phone||"?").charAt(0).toUpperCase()," "),c(3),Y(" ",t.addedAccountInfo().firstName||""," ",t.addedAccountInfo().lastName||""," "),c(2),A(t.addedAccountInfo().phone),c(),w(t.addedAccountInfo().username?8:-1),c(),w(t.selectedApiCredential()?9:-1)}}function Av(i,e){if(i&1){let t=M();r(0,"div",12)(1,"div",96),l(2,"\u2705"),s(),r(3,"h2"),l(4,"\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01"),s(),S(5,Ev,10,6),r(6,"div",97)(7,"button",16),x("click",function(){v(t);let o=g();return b(o.addAnother())}),l(8,"\u2795 \u7E7C\u7E8C\u6DFB\u52A0"),s(),r(9,"button",90),x("click",function(){v(t);let o=g();return b(o.goBack())}),l(10,"\u8FD4\u56DE\u5E33\u6236\u5217\u8868 \u2192"),s()()()}if(i&2){let t=g();c(5),w(t.addedAccountInfo()?5:-1)}}var Fo=class i{constructor(){this.ipcService=O(ye);this.toast=O(ue);this.membershipService=O(Re);this.back=new ot;this.accountAdded=new ot;this.currentStep=_(1);this.currentLoginMethod=_("select");this.selectedApiCredential=_(null);this.phoneCodeHash="";this.loginAccountId="";this.phoneNumber="";this.verificationCode="";this.twoFactorPassword="";this.proxyAddress="";this.proxyMode="auto";this.codeStep=_(!1);this.isSending=_(!1);this.isVerifying=_(!1);this.needs2FA=_(!1);this.resendCooldown=_(0);this.phoneError=_("");this.phoneValid=_(!1);this.deviceType=_("random");this.qrImageBase64=_("");this.qrCountdown=_(60);this.isDragging=_(!1);this.selectedFilePath=_("");this.isImporting=_(!1);this.tdataImportMode=_("tdata");this.tdataScanResult=_(null);this.selectedTdataAccounts=_([]);this.isScanningTdata=_(!1);this.defaultTdataPath=_("");this.addedAccountInfo=_(null);this.resendTimer=null;this.qrTimer=null;this.sendTimeout=null;this.verifyTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}ngOnDestroy(){this.resendTimer&&clearInterval(this.resendTimer),this.qrTimer&&clearInterval(this.qrTimer),this.sendTimeout&&clearTimeout(this.sendTimeout),this.verifyTimeout&&clearTimeout(this.verifyTimeout),this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("login-requires-code",e=>{this.isSending.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),(e.phone===this.phoneNumber||e.accountId)&&(this.phoneCodeHash=e.phoneCodeHash,this.loginAccountId=e.accountId,this.codeStep.set(!0),this.startResendCooldown(),(e.sendType||"app")==="sms"?this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3\u624B\u6A5F\u77ED\u4FE1"):this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 Telegram App"))}),this.ipcChannels.push("login-requires-code"),this.ipcService.on("login-success",e=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.addedAccountInfo.set(e.userInfo||{phone:this.phoneNumber}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u767B\u5165\u6210\u529F\uFF01")}),this.ipcChannels.push("login-success"),this.ipcService.on("login-requires-2fa",e=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.needs2FA.set(!0),this.toast.info("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC")}),this.ipcChannels.push("login-requires-2fa"),this.ipcService.on("login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("login-error"),this.ipcService.on("account-login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("account-login-error"),this.ipcService.on("qr-login-created",e=>{e.success!==!1&&e.qrImageBase64?(this.qrImageBase64.set(e.qrImageBase64),this.startQRCountdown()):this.toast.error(e.error||"\u751F\u6210\u4E8C\u7DAD\u78BC\u5931\u6557")}),this.ipcChannels.push("qr-login-created"),this.ipcService.on("qr-login-success",e=>{this.stopQRCountdown(),this.addedAccountInfo.set(e.userInfo||e),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u767B\u5165\u6210\u529F\uFF01")}),this.ipcChannels.push("qr-login-success"),this.ipcService.on("session-imported",e=>{this.isImporting.set(!1),e.success?(this.addedAccountInfo.set(e.account||{phone:e.phone}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success("\u5C0E\u5165\u6210\u529F\uFF01")):this.toast.error(e.error||"\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("session-imported"),this.ipcService.on("session-file-selected",e=>{e.path&&this.selectedFilePath.set(e.path)}),this.ipcChannels.push("session-file-selected"),this.ipcService.on("tdata-folder-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-folder-selected"),this.ipcService.on("tdata-zip-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-zip-selected"),this.ipcService.on("tdata-scan-result",e=>{if(this.isScanningTdata.set(!1),this.tdataScanResult.set(e),e.success&&e.accounts?.length>0){let t=e.accounts.filter(n=>n.can_import).map(n=>n.index);this.selectedTdataAccounts.set(t),this.toast.success(`\u627E\u5230 ${e.accounts.length} \u500B\u5E33\u865F`)}else e.error&&this.toast.error(e.error)}),this.ipcChannels.push("tdata-scan-result"),this.ipcService.on("tdata-import-result",e=>{this.isImporting.set(!1),e.success?(this.addedAccountInfo.set({phone:e.phone,first_name:e.first_name,last_name:e.last_name,username:e.username}),this.currentStep.set(3),this.accountAdded.emit(e),this.toast.success(`\u5E33\u865F ${e.phone} \u5C0E\u5165\u6210\u529F\uFF01`)):this.toast.error(e.error||"\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-import-result"),this.ipcService.on("tdata-batch-result",e=>{this.isImporting.set(!1),e.success_count>0?(this.currentStep.set(3),this.addedAccountInfo.set({batch:!0,count:e.success_count,failed:e.fail_count}),this.toast.success(`\u6210\u529F\u5C0E\u5165 ${e.success_count} \u500B\u5E33\u865F`),e.fail_count>0&&this.toast.warning(`${e.fail_count} \u500B\u5E33\u865F\u5C0E\u5165\u5931\u6557`)):this.toast.error(e.error||"\u6240\u6709\u5E33\u865F\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-batch-result"),this.ipcService.on("tdata-import-progress",e=>{console.log(`TData import progress: ${e.current}/${e.total}`)}),this.ipcChannels.push("tdata-import-progress")}onApiSelected(e){this.selectedApiCredential.set(e)}onApiCleared(){this.selectedApiCredential.set(null)}proceedToLogin(){this.selectedApiCredential()&&this.currentStep.set(2)}selectLoginMethod(e){this.currentLoginMethod.set(e)}goBack(){this.back.emit()}addAnother(){this.currentStep.set(1),this.currentLoginMethod.set("select"),this.selectedApiCredential.set(null),this.resetForm()}openUpgrade(){window.dispatchEvent(new CustomEvent("open-membership-dialog"))}resetForm(){this.phoneNumber="",this.verificationCode="",this.twoFactorPassword="",this.proxyAddress="",this.proxyMode="auto",this.phoneCodeHash="",this.loginAccountId="",this.codeStep.set(!1),this.qrImageBase64.set(""),this.selectedFilePath.set(""),this.needs2FA.set(!1),this.addedAccountInfo.set(null)}validatePhone(e){if(!e)return{valid:!1,error:""};let t=e.trim();if(!t.startsWith("+"))return{valid:!1,error:"\u865F\u78BC\u5FC5\u9808\u4EE5 + \u958B\u982D\uFF0C\u4F8B\u5982 +63\u3001+86\u3001+1"};let n=t.slice(1);return/^\d+$/.test(n)?n.length<8?{valid:!1,error:"\u865F\u78BC\u9577\u5EA6\u4E0D\u8DB3\uFF08\u81F3\u5C11\u9700\u8981 8 \u4F4D\u6578\u5B57\uFF09"}:n.length>15?{valid:!1,error:"\u865F\u78BC\u9577\u5EA6\u904E\u9577\uFF08\u6700\u591A 15 \u4F4D\u6578\u5B57\uFF09"}:{valid:!0,error:""}:{valid:!1,error:"\u865F\u78BC\u53EA\u80FD\u5305\u542B\u6578\u5B57\uFF08+ \u865F\u5F8C\u9762\uFF09"}}onPhoneChange(e){this.phoneNumber=e;let t=this.validatePhone(e);this.phoneValid.set(t.valid),this.phoneError.set(t.error)}sendVerificationCode(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}if(!this.phoneNumber){this.phoneError.set("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC"),this.toast.error("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC");return}let t=this.validatePhone(this.phoneNumber);if(!t.valid){this.phoneError.set(t.error),this.toast.error(t.error);return}this.sendTimeout&&clearTimeout(this.sendTimeout),this.isSending.set(!0),this.phoneError.set("");let n=this.getProxyValue();this.ipcService.send("add-account",{phone:this.phoneNumber,apiId:e.api_id,apiHash:e.api_hash,proxy:n,twoFactorPassword:this.twoFactorPassword||null}),setTimeout(()=>{this.ipcService.send("login-account",{phone:this.phoneNumber,apiId:e.api_id,apiHash:e.api_hash,proxy:n,twoFactorPassword:this.twoFactorPassword||null})},500),this.sendTimeout=setTimeout(()=>{this.isSending()&&(this.isSending.set(!1),this.phoneError.set("\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66"),this.toast.error("\u767C\u9001\u9A57\u8B49\u78BC\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},3e4)}submitVerificationCode(){if(!this.verificationCode){this.toast.error("\u8ACB\u8F38\u5165\u9A57\u8B49\u78BC");return}if(this.needs2FA()&&!this.twoFactorPassword){this.toast.error("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC");return}this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.isVerifying.set(!0);let e=this.selectedApiCredential();this.ipcService.send("login-account",{phone:this.phoneNumber,phoneCode:this.verificationCode,phoneCodeHash:this.phoneCodeHash,twoFactorPassword:this.twoFactorPassword||null,apiId:e?.api_id,apiHash:e?.api_hash}),this.verifyTimeout=setTimeout(()=>{this.isVerifying()&&(this.isVerifying.set(!1),this.toast.error("\u9A57\u8B49\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66"))},3e4)}getProxyValue(){switch(this.proxyMode){case"auto":return"auto";case"manual":return this.proxyAddress||null;case"none":default:return null}}resendCode(){this.sendVerificationCode()}handleLoginError(e){this.isSending.set(!1),this.isVerifying.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null);let t=e.friendlyMessage||e.error||e.message||"\u767B\u5165\u5931\u6557";if(t.includes("2FA")&&t.includes("\u5BC6\u78BC")){this.toast.error("\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\u932F\u8AA4\uFF0C\u8ACB\u91CD\u65B0\u8F38\u5165"),this.twoFactorPassword="";return}if(e.codeExpired){this.toast.error("\u9A57\u8B49\u78BC\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767C\u9001"),this.codeStep.set(!1),this.verificationCode="",this.phoneCodeHash="";return}this.toast.error(t)}startResendCooldown(){this.resendCooldown.set(60),this.resendTimer=setInterval(()=>{let e=this.resendCooldown();e<=1?(clearInterval(this.resendTimer),this.resendCooldown.set(0)):this.resendCooldown.set(e-1)},1e3)}generateQRCode(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}this.ipcService.send("qr-login-create",{proxy:this.getProxyValue(),deviceType:this.deviceType()==="random"?null:this.deviceType(),customApiId:e.api_id,customApiHash:e.api_hash})}refreshQRCode(){this.qrImageBase64.set(""),this.generateQRCode()}startQRCountdown(){this.qrCountdown.set(60),this.qrTimer=setInterval(()=>{let e=this.qrCountdown();e<=1?this.stopQRCountdown():this.qrCountdown.set(e-1)},1e3)}stopQRCountdown(){this.qrTimer&&(clearInterval(this.qrTimer),this.qrTimer=null)}onDragOver(e){e.preventDefault(),this.isDragging.set(!0)}onDragLeave(e){e.preventDefault(),this.isDragging.set(!1)}onDrop(e){e.preventDefault(),this.isDragging.set(!1);let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0].path;n&&this.selectedFilePath.set(n)}}onDropTdata(e){e.preventDefault(),this.isDragging.set(!1);let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0].path;n&&this.scanTdata(n)}}selectSessionFile(){this.ipcService.send("select-session-file",{})}selectTdataFolder(){this.ipcService.send("select-tdata-folder",{})}selectTdataZip(){this.ipcService.send("select-tdata-zip",{})}scanTdata(e){this.isScanningTdata.set(!0),this.tdataScanResult.set(null),this.selectedTdataAccounts.set([]),this.ipcService.send("scan-tdata",{path:e})}toggleTdataAccount(e){this.selectedTdataAccounts.update(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])}getDefaultTdataPath(){let e=navigator.userAgent.includes("Windows"),t=navigator.userAgent.includes("Mac");return e?"%APPDATA%\\Telegram Desktop\\tdata":t?"~/Library/Application Support/Telegram Desktop/tdata":"~/.local/share/TelegramDesktop/tdata"}copyTdataPath(){let e=this.getDefaultTdataPath();navigator.clipboard.writeText(e.replace("%APPDATA%","").replace("~","")),this.toast.success("\u8DEF\u5F91\u5DF2\u8907\u88FD")}openTdataFolder(){this.ipcService.send("open-default-tdata-folder",{})}importTdataAccounts(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}let t=this.tdataScanResult();if(!t?.tdata_path){this.toast.error("\u8ACB\u5148\u6383\u63CF TData");return}let n=this.selectedTdataAccounts();if(n.length===0){this.toast.error("\u8ACB\u9078\u64C7\u8981\u5C0E\u5165\u7684\u5E33\u865F");return}this.isImporting.set(!0),n.length===1?this.ipcService.send("import-tdata-account",{tdataPath:t.tdata_path,accountIndex:n[0],apiId:e.api_id,apiHash:e.api_hash}):this.ipcService.send("import-tdata-batch",{tdataPath:t.tdata_path,accountIndices:n,apiId:e.api_id,apiHash:e.api_hash})}clearSelectedFile(){this.selectedFilePath.set("")}importSession(){let e=this.selectedApiCredential();if(!e){this.toast.error("\u8ACB\u5148\u9078\u64C7 API");return}this.isImporting.set(!0),this.ipcService.send("import-session",{filePath:this.selectedFilePath(),apiId:e.api_id,apiHash:e.api_hash})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-add-account-page"]],outputs:{back:"back",accountAdded:"accountAdded"},decls:30,vars:20,consts:[[1,"add-account-page"],[1,"page-header"],[1,"back-btn",3,"click"],[1,"page-title"],[1,"step-indicator"],[1,"step"],[1,"step-number"],[1,"step-label"],[1,"step-line"],[1,"config-section"],[1,"login-selection"],[1,"login-form"],[1,"success-section"],[1,"section-header"],[3,"apiSelected","selectionCleared","showSelected"],[1,"form-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click","disabled"],[1,"login-cards"],[1,"login-card","recommended",3,"click"],[1,"login-badge"],[1,"login-icon"],[1,"login-risk","low"],[1,"login-card","safe",3,"click"],[1,"login-risk","lowest"],[1,"login-card","warning",3,"click"],[1,"login-risk","high"],[1,"form-card"],[1,"form-group"],[1,"required"],[1,"input-with-prefix"],["type","tel","placeholder","+639952947692",1,"form-input",3,"ngModelChange","ngModel"],[1,"input-status","valid"],[1,"error-text"],[1,"hint"],[1,"proxy-options"],[1,"proxy-option"],["type","radio","name","proxyMode","value","auto",3,"ngModelChange","ngModel"],[1,"option-content"],[1,"option-icon"],[1,"option-text"],["type","radio","name","proxyMode","value","manual",3,"ngModelChange","ngModel"],["type","radio","name","proxyMode","value","none",3,"ngModelChange","ngModel"],["type","text","placeholder","socks5://user:pass@host:port",1,"form-input","mt-2",3,"ngModel"],["type","password","placeholder","\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49",1,"form-input",3,"ngModelChange","ngModel"],["type","text","placeholder","socks5://user:pass@host:port",1,"form-input","mt-2",3,"ngModelChange","ngModel"],[1,"spinner"],[1,"code-sent-info"],[1,"info-icon"],["type","text","placeholder","\u8F38\u5165\u6536\u5230\u7684\u9A57\u8B49\u78BC","maxlength","6",1,"form-input","code-input",3,"ngModelChange","ngModel"],[1,"resend-section"],[1,"resend-btn",3,"click","disabled"],["type","password","placeholder","\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input",3,"ngModelChange","ngModel"],[1,"import-mode-tabs"],[1,"mode-tab",3,"click"],[1,"badge-recommend"],[1,"btn-primary",3,"disabled"],[1,"tdata-path-hint"],[1,"path-box"],[1,"path-actions"],["title","\u8907\u88FD\u8DEF\u5F91",1,"icon-btn",3,"click"],["title","\u6253\u958B\u6587\u4EF6\u593E",1,"icon-btn",3,"click"],[1,"drop-zone","large",3,"dragover","dragleave","drop"],[1,"drop-icon"],[1,"drop-text"],[1,"drop-hint"],[1,"drop-buttons"],[1,"select-btn",3,"click"],[1,"select-btn","secondary",3,"click"],[1,"scanning-indicator"],[1,"scan-result","success"],[1,"scan-result","error"],[1,"accounts-list"],[1,"account-item",3,"disabled"],[1,"account-item"],["type","checkbox",3,"change","checked","disabled"],[1,"account-info"],[1,"account-phone"],[1,"account-name"],[1,"account-error"],[1,"error-icon"],[1,"tdata-info"],[1,"drop-zone",3,"dragover","dragleave","drop","click"],[1,"selected-file"],[1,"file-icon"],[1,"file-path"],[1,"clear-btn",3,"click"],[1,"device-options"],[1,"device-btn",3,"click"],["type","text","placeholder","socks5://host:port",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"click"],[1,"qr-section"],[1,"qr-container"],["alt","QR Code",1,"qr-image",3,"src"],[1,"qr-countdown"],[1,"qr-instructions"],[1,"success-icon"],[1,"form-actions","center"],[1,"account-card"],[1,"account-avatar"],[1,"account-details"],[1,"account-username"],[1,"api-info"],[1,"api-badge","platform"],[1,"api-badge","expert"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),x("click",function(){return n.goBack()}),l(3," \u2190 \u8FD4\u56DE\u5E33\u6236\u5217\u8868 "),s(),r(4,"h1",3),l(5,"\u2795 \u6DFB\u52A0\u65B0\u5E33\u6236"),s()(),r(6,"div",4)(7,"div",5)(8,"span",6),l(9,"1"),s(),r(10,"span",7),l(11,"\u9078\u64C7 API"),s()(),k(12,"div",8),r(13,"div",5)(14,"span",6),l(15,"2"),s(),r(16,"span",7),l(17,"\u767B\u5165\u5E33\u865F"),s()(),k(18,"div",8),r(19,"div",5)(20,"span",6),l(21,"3"),s(),r(22,"span",7),l(23,"\u5B8C\u6210"),s()()(),S(24,LC,12,2,"div",9),S(25,GC,64,0,"div",10),S(26,ev,7,1,"div",11),S(27,_v,19,7,"div",11),S(28,bv,21,8,"div",11),S(29,Av,11,1,"div",12),s()),t&2&&(c(7),I("active",n.currentStep()>=1)("completed",n.currentStep()>1),c(5),I("active",n.currentStep()>1),c(),I("active",n.currentStep()>=2)("completed",n.currentStep()>2),c(5),I("active",n.currentStep()>2),c(),I("active",n.currentStep()>=3),c(5),w(n.currentStep()===1?24:-1),c(),w(n.currentStep()===2&&n.currentLoginMethod()==="select"?25:-1),c(),w(n.currentStep()===2&&n.currentLoginMethod()==="code"?26:-1),c(),w(n.currentStep()===2&&n.currentLoginMethod()==="tdata"?27:-1),c(),w(n.currentStep()===2&&n.currentLoginMethod()==="qr"?28:-1),c(),w(n.currentStep()===3?29:-1))},dependencies:[te,me,xe,on,_e,Pt,Ce,En],styles:[".add-account-page[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:2rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem;margin-bottom:.5rem;padding:0}.back-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-title[_ngcontent-%COMP%]{margin:0;font-size:2rem;color:var(--text-primary, white)}.step-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:2rem;flex-wrap:wrap;gap:.5rem}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.step-number[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:var(--bg-tertiary, rgba(15, 23, 42, .5));display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.step-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%]{color:var(--text-primary, white)}.step-line[_ngcontent-%COMP%]{width:40px;height:2px;background:var(--bg-tertiary, rgba(15, 23, 42, .5))}.step-line.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4)}.mode-selection[_ngcontent-%COMP%], .login-selection[_ngcontent-%COMP%]{text-align:center}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .selection-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-primary, white);font-size:1.5rem}.section-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .selection-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 2rem;color:var(--text-muted, #94a3b8)}.mode-cards[_ngcontent-%COMP%], .login-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-bottom:2rem}@media(max-width:700px){.mode-cards[_ngcontent-%COMP%], .login-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}}.login-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}@media(max-width:800px){.login-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}}.mode-card[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:2px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:1rem;padding:1.5rem;cursor:pointer;transition:all .2s;position:relative;text-align:left}.mode-card[_ngcontent-%COMP%]:hover, .login-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 24px #0003}.mode-card.expert[_ngcontent-%COMP%]:hover{border-color:#22c55e}.mode-card.platform[_ngcontent-%COMP%]:hover{border-color:#06b6d4}.mode-card.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.mode-card.disabled[_ngcontent-%COMP%]:hover{transform:none}.login-card.recommended[_ngcontent-%COMP%]:hover{border-color:#22c55e}.login-card.safe[_ngcontent-%COMP%]:hover{border-color:#06b6d4}.login-card.warning[_ngcontent-%COMP%]:hover{border-color:#f59e0b}.mode-badge[_ngcontent-%COMP%], .login-badge[_ngcontent-%COMP%]{position:absolute;top:-10px;right:1rem;padding:.25rem .75rem;border-radius:1rem;font-size:.7rem;font-weight:600}.mode-card.expert[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.mode-card.platform[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.login-card.recommended[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.login-card.safe[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.login-card.warning[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%]{background:#f59e0b;color:#000}.mode-icon[_ngcontent-%COMP%], .login-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:.75rem}.mode-title[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-primary, white);font-size:1.25rem}.mode-subtitle[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:.875rem;color:var(--text-muted, #94a3b8)}.mode-features[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;font-size:.8rem}.mode-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .login-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.375rem;color:var(--text-secondary, #cbd5e1)}.mode-suitable[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);margin-bottom:1rem}.mode-risk[_ngcontent-%COMP%], .login-risk[_ngcontent-%COMP%]{padding:.375rem .75rem;border-radius:.5rem;font-size:.7rem;font-weight:500;display:inline-block;margin-bottom:1rem}.mode-risk.safe[_ngcontent-%COMP%], .login-risk.lowest[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.mode-risk.medium[_ngcontent-%COMP%], .login-risk.low[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.login-risk.high[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.quota-info[_ngcontent-%COMP%]{margin-bottom:1rem}.quota-bar[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.75rem;border-radius:.5rem}.quota-label[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #94a3b8);margin-bottom:.375rem}.quota-progress[_ngcontent-%COMP%]{height:6px;background:var(--bg-tertiary, rgba(15, 23, 42, .8));border-radius:3px;overflow:hidden;margin-bottom:.375rem}.quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#22c55e);border-radius:3px}.quota-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #cbd5e1)}.quota-locked[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem;background:#f59e0b1a;border-radius:.5rem;font-size:.75rem;color:#fcd34d}.mode-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:none;border-radius:.5rem;font-weight:500;cursor:pointer;transition:all .2s}.mode-card.expert[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.mode-card.platform[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%]{background:#06b6d4;color:#fff}.mode-btn.upgrade[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#ef4444)}.help-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;text-align:left}@media(max-width:600px){.help-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.help-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .5));padding:1rem;border-radius:.75rem}.help-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.help-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.config-section[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.form-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.required[_ngcontent-%COMP%]{color:#ef4444}.proxy-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-top:.5rem}.proxy-option[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.75rem 1rem;background:var(--bg-secondary, #1e293b);border:2px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.proxy-option[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary, #334155)}.proxy-option[_ngcontent-%COMP%]:has(input:checked){border-color:var(--accent-color, #8b5cf6);background:#8b5cf61a}.proxy-option[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{display:none}.proxy-option[_ngcontent-%COMP%]   .option-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.proxy-option[_ngcontent-%COMP%]   .option-icon[_ngcontent-%COMP%]{font-size:1.5rem}.proxy-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.proxy-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-primary, #f1f5f9)}.proxy-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary, #94a3b8)}.mt-2[_ngcontent-%COMP%]{margin-top:.5rem}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem;box-sizing:border-box}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.form-input.error[_ngcontent-%COMP%]{border-color:#ef4444;background:#ef44440d}.form-input.valid[_ngcontent-%COMP%]{border-color:#22c55e}.input-with-prefix[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-with-prefix[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1;padding-right:2.5rem}.input-status[_ngcontent-%COMP%]{position:absolute;right:.75rem;font-size:1rem}.input-status.valid[_ngcontent-%COMP%]{color:#22c55e}.form-input.code-input[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;letter-spacing:.5rem}.hint[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:var(--text-muted, #64748b)}.error-text[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:#ef4444}.guide-box[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:1rem;border-radius:.5rem;margin-bottom:1rem}.guide-box[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--text-primary, white)}.guide-box[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:0;padding-left:1.25rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.guide-box[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.375rem}.guide-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #06b6d4)}.warning-box[_ngcontent-%COMP%], .risk-warning[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding:1rem;background:#f59e0b1a;border:1px solid rgba(245,158,11,.3);border-radius:.5rem}.warning-icon[_ngcontent-%COMP%]{font-size:1.25rem}.warning-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#fcd34d;margin-bottom:.375rem;font-size:.875rem}.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding-left:1rem;font-size:.75rem;color:var(--text-muted, #94a3b8)}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:0}.quota-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem}.membership-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.level-icon[_ngcontent-%COMP%]{font-size:2rem}.level-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.level-name[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--text-primary, white)}.level-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.quota-item[_ngcontent-%COMP%]{margin-bottom:1rem}.quota-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem}.quota-title[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.quota-value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-primary, white)}.quota-bar-large[_ngcontent-%COMP%]{height:8px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:4px;overflow:hidden}.quota-bar-large[_ngcontent-%COMP%]   .quota-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#22c55e)}.quota-summary[_ngcontent-%COMP%]{margin-top:1rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;text-align:center}.summary-good[_ngcontent-%COMP%]{color:#22c55e}.summary-bad[_ngcontent-%COMP%]{color:#ef4444}.upgrade-prompt[_ngcontent-%COMP%]{margin-top:1rem;text-align:center;padding:1rem;background:linear-gradient(135deg,#f59e0b1a,#ef44441a);border-radius:.5rem}.upgrade-prompt[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:#fcd34d}.btn-upgrade[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#ef4444);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.5rem;cursor:pointer}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;margin-top:1.5rem}.form-actions.center[_ngcontent-%COMP%]{justify-content:center}.btn-primary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;transition:all .2s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .3));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer}.device-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}.device-btn[_ngcontent-%COMP%]{padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.device-btn[_ngcontent-%COMP%]:hover, .device-btn.active[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--border-default, rgba(148, 163, 184, .3));border-radius:.75rem;padding:3rem;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:1rem}.drop-zone[_ngcontent-%COMP%]:hover, .drop-zone.dragging[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d40d}.drop-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:.75rem}.drop-text[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.drop-hint[_ngcontent-%COMP%]{margin:.5rem 0 0;font-size:.8rem;color:var(--text-muted, #94a3b8)}.selected-file[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.file-path[_ngcontent-%COMP%]{flex:1;color:var(--text-primary, white);font-size:.875rem;word-break:break-all}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:1.25rem}.qr-section[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.qr-container[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:.75rem;display:inline-block;margin-bottom:.75rem}.qr-image[_ngcontent-%COMP%]{width:180px;height:180px;display:block}.qr-countdown[_ngcontent-%COMP%]{font-size:1rem;color:var(--primary, #06b6d4);margin-bottom:.75rem}.qr-countdown.warning[_ngcontent-%COMP%]{color:#f59e0b;animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.qr-instructions[_ngcontent-%COMP%]{text-align:left;display:inline-block;background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:.75rem 1.25rem;border-radius:.5rem}.qr-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0;color:var(--text-muted, #94a3b8);font-size:.8rem}.code-sent-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#22c55e1a;border-radius:.5rem;margin-bottom:1rem;color:#86efac}.resend-section[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.resend-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem}.resend-btn[_ngcontent-%COMP%]:disabled{color:var(--text-muted, #94a3b8);cursor:not-allowed}.tdata-info[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:1rem;border-radius:.5rem;margin-bottom:1rem}.tdata-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.tdata-info[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1rem;font-size:.8rem;color:var(--text-muted, #94a3b8)}.import-mode-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem}.mode-tab[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid transparent;border-radius:.5rem;color:var(--text-muted, #94a3b8);cursor:pointer;transition:all .2s;position:relative}.mode-tab[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8));color:var(--text-primary, white)}.mode-tab.active[_ngcontent-%COMP%]{background:var(--bg-secondary, rgba(30, 41, 59, .8));border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.badge-recommend[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#10b981,#059669);color:#fff;font-size:.65rem;padding:2px 6px;border-radius:4px}.tdata-path-hint[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border, rgba(100, 116, 139, .3));border-radius:.5rem;padding:1rem;margin-bottom:1rem}.tdata-path-hint[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.path-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:var(--bg-primary, rgba(2, 6, 23, .8));padding:.5rem 1rem;border-radius:.375rem}.path-box[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:.8rem;color:var(--primary, #06b6d4);word-break:break-all}.path-actions[_ngcontent-%COMP%]{display:flex;gap:.25rem}.icon-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:none;cursor:pointer;opacity:.7;transition:opacity .2s}.icon-btn[_ngcontent-%COMP%]:hover{opacity:1}.drop-zone.large[_ngcontent-%COMP%]{padding:2rem;min-height:180px}.drop-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem}.select-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);color:#fff;border:none;border-radius:.375rem;cursor:pointer;transition:background .2s}.select-btn[_ngcontent-%COMP%]:hover{background:var(--primary-dark, #0891b2)}.select-btn.secondary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border, rgba(100, 116, 139, .3))}.select-btn.secondary[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.scan-result[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem;padding:1rem;margin:1rem 0}.scan-result.success[_ngcontent-%COMP%]{border:1px solid rgba(16,185,129,.3)}.scan-result.error[_ngcontent-%COMP%]{border:1px solid rgba(239,68,68,.3);display:flex;align-items:center;gap:.5rem;color:#f87171}.scan-result[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--text-primary, white)}.accounts-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto}.account-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem;background:var(--bg-primary, rgba(2, 6, 23, .8));border-radius:.375rem;cursor:pointer;transition:background .2s}.account-item[_ngcontent-%COMP%]:hover{background:var(--bg-secondary, rgba(30, 41, 59, .8))}.account-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.account-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem}.account-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.125rem}.account-phone[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-primary, white)}.account-name[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.account-error[_ngcontent-%COMP%]{font-size:.7rem;color:#f87171}.scanning-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--text-muted, #94a3b8)}.success-section[_ngcontent-%COMP%]{text-align:center;padding:2rem}.success-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.success-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--text-primary, white)}.account-card[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:1rem;padding:1rem 2rem;background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:.75rem;margin-bottom:1rem}.account-avatar[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#fff}.account-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.account-phone[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1)}.account-username[_ngcontent-%COMP%]{font-size:.875rem;color:var(--primary, #06b6d4)}.api-info[_ngcontent-%COMP%]{margin:1rem 0}.api-badge[_ngcontent-%COMP%]{display:inline-block;padding:.5rem 1rem;border-radius:2rem;font-size:.8rem}.api-badge.expert[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.api-badge.platform[_ngcontent-%COMP%]{background:#06b6d433;color:#67e8f9}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};var Dv=()=>[],Mv=(i,e)=>e.index;function Tv(i,e){if(i&1){let t=M();r(0,"div",22)(1,"div",23),x("click",function(){v(t);let o=g(2);return b(o.startAdvancedMode())}),r(2,"div",14),l(3,"\u{1F511}"),s(),r(4,"div",15)(5,"h3"),l(6,"\u4F7F\u7528\u81EA\u5DF1\u7684 API"),s(),r(7,"p"),l(8,"\u9069\u5408\u6280\u8853\u7528\u6236\u6216\u5927\u6279\u91CF\u5E33\u865F"),s()(),r(9,"div",16),l(10,"\u2192"),s()()()}}function kv(i,e){if(i&1){let t=M();r(0,"div",9)(1,"div",12),x("click",function(){v(t);let o=g();return b(o.startPhoneLogin())}),r(2,"div",13),l(3,"\u63A8\u85A6"),s(),r(4,"div",14),l(5,"\u{1F4F1}"),s(),r(6,"div",15)(7,"h3"),l(8,"\u624B\u6A5F\u865F\u767B\u5165"),s(),r(9,"p"),l(10,"\u8F38\u5165\u624B\u6A5F\u865F\u548C\u9A57\u8B49\u78BC\uFF0C30\u79D2\u5B8C\u6210"),s()(),r(11,"div",16),l(12,"\u2192"),s()(),r(13,"div",17),x("click",function(){v(t);let o=g();return b(o.startTdataImport())}),r(14,"div",18),l(15,"\u6700\u5B89\u5168"),s(),r(16,"div",14),l(17,"\u{1F4C2}"),s(),r(18,"div",15)(19,"h3"),l(20,"\u5C0E\u5165\u5DF2\u6709\u5E33\u865F"),s(),r(21,"p"),l(22,"\u5F9E Telegram Desktop \u5C0E\u5165\uFF0C\u7121\u9700\u91CD\u65B0\u767B\u5165"),s()(),r(23,"div",16),l(24,"\u2192"),s()(),r(25,"div",19)(26,"button",20),x("click",function(){v(t);let o=g();return b(o.showAdvanced.set(!o.showAdvanced()))}),l(27," \u{1F527} \u9032\u968E\u9078\u9805 "),r(28,"span",21),l(29),s()(),S(30,Tv,11,0,"div",22),s()()}if(i&2){let t=g();c(29),A(t.showAdvanced()?"\u25B2":"\u25BC"),c(),w(t.showAdvanced()?30:-1)}}function Iv(i,e){if(i&1&&(r(0,"span",29),l(1),s()),i&2){let t=g(3);c(),A(t.phoneError())}}function Pv(i,e){i&1&&(r(0,"span",30),l(1,"\u8ACB\u8F38\u5165\u5B8C\u6574\u624B\u6A5F\u865F\uFF0C\u5305\u542B\u570B\u5BB6\u4EE3\u78BC\uFF08\u5982 +86\u3001+1\uFF09"),s())}function Fv(i,e){i&1&&(k(0,"span",37),l(1," \u767C\u9001\u4E2D... "))}function Nv(i,e){i&1&&l(0," \u767C\u9001\u9A57\u8B49\u78BC ")}function Rv(i,e){if(i&1){let t=M();r(0,"div",27)(1,"label"),l(2,"\u624B\u6A5F\u865F\u78BC"),s(),r(3,"input",28),x("ngModelChange",function(o){v(t);let a=g(2);return b(a.onPhoneChange(o))}),s(),S(4,Iv,2,1,"span",29)(5,Pv,2,0,"span",30),s(),r(6,"div",27)(7,"label"),l(8,"\u7DB2\u7D61\u8A2D\u7F6E"),s(),r(9,"div",31)(10,"label",32)(11,"input",33),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.proxyMode,o)||(a.proxyMode=o),b(o)}),s(),r(12,"span",34)(13,"strong"),l(14,"\u{1F310} \u81EA\u52D5\uFF08\u63A8\u85A6\uFF09"),s(),r(15,"small"),l(16,"\u7CFB\u7D71\u81EA\u52D5\u5206\u914D\u6700\u4F73\u7DB2\u7D61"),s()()(),r(17,"label",32)(18,"input",35),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.proxyMode,o)||(a.proxyMode=o),b(o)}),s(),r(19,"span",34)(20,"strong"),l(21,"\u{1F50C} \u76F4\u9023"),s(),r(22,"small"),l(23,"\u4E0D\u4F7F\u7528\u4EE3\u7406"),s()()()()(),r(24,"button",36),x("click",function(){v(t);let o=g(2);return b(o.sendVerificationCode())}),S(25,Fv,2,0)(26,Nv,1,0),s()}if(i&2){let t=g(2);c(3),I("error",t.phoneError())("valid",t.phoneValid()),V("ngModel",t.phoneNumber),c(),w(t.phoneError()?4:5),c(6),I("selected",t.proxyMode==="auto"),c(),z("ngModel",t.proxyMode),c(6),I("selected",t.proxyMode==="none"),c(),z("ngModel",t.proxyMode),c(6),V("disabled",!t.phoneValid()||t.isSending()),c(),w(t.isSending()?25:26)}}function Ov(i,e){if(i&1){let t=M();r(0,"div",27)(1,"label"),l(2,"\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC"),s(),r(3,"input",47),W("ngModelChange",function(o){v(t);let a=g(3);return K(a.twoFactorPassword,o)||(a.twoFactorPassword=o),b(o)}),s()()}if(i&2){let t=g(3);c(3),z("ngModel",t.twoFactorPassword)}}function Bv(i,e){if(i&1&&(r(0,"span",42),l(1),s()),i&2){let t=g(3);c(),D("",t.resendCooldown(),"\u79D2\u5F8C\u53EF\u91CD\u767C")}}function Vv(i,e){if(i&1){let t=M();r(0,"button",48),x("click",function(){v(t);let o=g(3);return b(o.resendCode())}),l(1,"\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC"),s()}}function Lv(i,e){i&1&&(k(0,"span",37),l(1," \u9A57\u8B49\u4E2D... "))}function Gv(i,e){i&1&&l(0," \u78BA\u8A8D\u767B\u5165 ")}function Uv(i,e){if(i&1){let t=M();r(0,"div",38)(1,"span",39),l(2,"\u2705"),s(),r(3,"span"),l(4,"\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 "),r(5,"strong"),l(6),s()()(),r(7,"div",27)(8,"label"),l(9,"\u9A57\u8B49\u78BC"),s(),r(10,"input",40),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.verificationCode,o)||(a.verificationCode=o),b(o)}),s(),r(11,"span",30),l(12,"\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u5230\u60A8\u7684 Telegram App"),s()(),S(13,Ov,4,1,"div",27),r(14,"div",41),S(15,Bv,2,1,"span",42)(16,Vv,2,0,"button",43),s(),r(17,"div",44)(18,"button",45),x("click",function(){v(t);let o=g(2);return b(o.codeStep.set(!1))}),l(19,"\u8FD4\u56DE"),s(),r(20,"button",46),x("click",function(){v(t);let o=g(2);return b(o.submitVerificationCode())}),S(21,Lv,2,0)(22,Gv,1,0),s()()}if(i&2){let t=g(2);c(6),A(t.phoneNumber),c(4),z("ngModel",t.verificationCode),c(3),w(t.needs2FA()?13:-1),c(2),w(t.resendCooldown()>0?15:16),c(5),V("disabled",!t.verificationCode||t.isVerifying()),c(),w(t.isVerifying()?21:22)}}function qv(i,e){if(i&1){let t=M();r(0,"div",10)(1,"div",24)(2,"button",25),x("click",function(){v(t);let o=g();return b(o.activeMethod.set(null))}),l(3,"\u2190 \u8FD4\u56DE\u9078\u64C7"),s(),r(4,"h2"),l(5,"\u{1F4F1} \u624B\u6A5F\u865F\u767B\u5165"),s()(),r(6,"div",26),S(7,Rv,27,14)(8,Uv,23,6),s()()}if(i&2){let t=g();c(7),w(t.codeStep()?8:7)}}function $v(i,e){if(i&1&&(r(0,"span",67),l(1),s()),i&2){let t=g().$implicit;c(),A(t.first_name)}}function Hv(i,e){if(i&1){let t=M();r(0,"label",64)(1,"input",65),x("change",function(){let o=v(t).$implicit,a=g(4);return b(a.toggleTdataAccount(o.index))}),s(),r(2,"span",66)(3,"strong"),l(4),s(),S(5,$v,2,1,"span",67),s()()}if(i&2){let t=e.$implicit,n=g(4);I("disabled",!t.can_import),c(),V("checked",n.selectedTdataAccounts().includes(t.index))("disabled",!t.can_import),c(3),A(t.phone),c(),w(t.first_name?5:-1)}}function zv(i,e){i&1&&(k(0,"span",37),l(1," \u5C0E\u5165\u4E2D... "))}function Kv(i,e){if(i&1&&l(0),i&2){let t=g(4);D(" \u5C0E\u5165 ",t.selectedTdataAccounts().length," \u500B\u5E33\u865F ")}}function Wv(i,e){if(i&1){let t=M();r(0,"div",60)(1,"h4"),l(2),s(),r(3,"div",62),$(4,Hv,6,6,"label",63,Mv),s(),r(6,"button",36),x("click",function(){v(t);let o=g(3);return b(o.importTdataAccounts())}),S(7,zv,2,0)(8,Kv,1,1),s()()}if(i&2){let t=g(3);c(2),D("\u{1F4CB} \u627E\u5230 ",t.tdataScanResult().accounts.length," \u500B\u5E33\u865F"),c(2),H(t.tdataScanResult().accounts||$t(3,Dv)),c(2),V("disabled",t.selectedTdataAccounts().length===0||t.isImporting()),c(),w(t.isImporting()?7:8)}}function Jv(i,e){if(i&1&&(r(0,"div",61),l(1),s()),i&2){let t=g(3);c(),D(" \u274C ",t.tdataScanResult().error||"\u672A\u627E\u5230\u6709\u6548\u5E33\u865F"," ")}}function Qv(i,e){if(i&1&&S(0,Wv,9,4,"div",60)(1,Jv,2,1,"div",61),i&2){let t,n=g(2);w(n.tdataScanResult().success&&((t=n.tdataScanResult().accounts)!=null&&t.length)?0:1)}}function Yv(i,e){i&1&&(r(0,"div",59),k(1,"span",37),l(2," \u6B63\u5728\u6383\u63CF... "),s())}function Xv(i,e){if(i&1){let t=M();r(0,"div",10)(1,"div",24)(2,"button",25),x("click",function(){v(t);let o=g();return b(o.activeMethod.set(null))}),l(3,"\u2190 \u8FD4\u56DE\u9078\u64C7"),s(),r(4,"h2"),l(5,"\u{1F4C2} \u5C0E\u5165\u5DF2\u6709\u5E33\u865F"),s()(),r(6,"div",26)(7,"div",49)(8,"h4"),l(9,"\u{1F4CD} TData \u6587\u4EF6\u4F4D\u7F6E"),s(),r(10,"code"),l(11),s(),r(12,"div",50)(13,"button",51),x("click",function(){v(t);let o=g();return b(o.copyTdataPath())}),l(14,"\u{1F4CB} \u8907\u88FD"),s(),r(15,"button",51),x("click",function(){v(t);let o=g();return b(o.openTdataFolder())}),l(16,"\u{1F4C2} \u6253\u958B"),s()()(),r(17,"div",52),x("dragover",function(o){v(t);let a=g();return b(a.onDragOver(o))})("dragleave",function(o){v(t);let a=g();return b(a.onDragLeave(o))})("drop",function(o){v(t);let a=g();return b(a.onDropTdata(o))}),r(18,"div",53),l(19,"\u{1F4C1}"),s(),r(20,"p",54),l(21,"\u62D6\u653E tdata \u6587\u4EF6\u593E\u5230\u9019\u88E1"),s(),r(22,"p",55),l(23,"\u6216\u9EDE\u64CA\u4E0B\u65B9\u6309\u9215\u9078\u64C7"),s(),r(24,"div",56)(25,"button",57),x("click",function(){v(t);let o=g();return b(o.selectTdataFolder())}),l(26,"\u9078\u64C7\u6587\u4EF6\u593E"),s(),r(27,"button",58),x("click",function(){v(t);let o=g();return b(o.selectTdataZip())}),l(28,"\u9078\u64C7 ZIP"),s()()(),S(29,Qv,2,1),S(30,Yv,3,0,"div",59),s()()}if(i&2){let t=g();c(11),A(t.getDefaultTdataPath()),c(6),I("dragging",t.isDragging()),c(12),w(t.tdataScanResult()?29:-1),c(),w(t.isScanningTdata()?30:-1)}}function Zv(i,e){i&1&&(k(0,"span",37),l(1," \u767C\u9001\u4E2D... "))}function jv(i,e){i&1&&l(0," \u767C\u9001\u9A57\u8B49\u78BC ")}function eb(i,e){if(i&1){let t=M();r(0,"div",10)(1,"div",24)(2,"button",25),x("click",function(){v(t);let o=g();return b(o.activeMethod.set(null))}),l(3,"\u2190 \u8FD4\u56DE\u9078\u64C7"),s(),r(4,"h2"),l(5,"\u{1F511} \u4F7F\u7528\u81EA\u5DF1\u7684 API"),s()(),r(6,"div",26)(7,"div",68)(8,"p"),l(9,"\u8ACB\u5148\u5728 "),r(10,"a",69),l(11,"my.telegram.org"),s(),l(12," \u7533\u8ACB API \u6191\u64DA"),s(),r(13,"p",70),l(14,"\u9700\u8981\u66F4\u591A\u529F\u80FD\uFF1F"),r(15,"a",71),x("click",function(){v(t);let o=g();return b(o.goToAdvancedPage())}),l(16,"\u5207\u63DB\u5230\u5C08\u696D\u7248 \u2192"),s()()(),r(17,"div",27)(18,"label"),l(19,"API ID"),s(),r(20,"input",72),W("ngModelChange",function(o){v(t);let a=g();return K(a.customApiId,o)||(a.customApiId=o),b(o)}),s()(),r(21,"div",27)(22,"label"),l(23,"API Hash"),s(),r(24,"input",73),W("ngModelChange",function(o){v(t);let a=g();return K(a.customApiHash,o)||(a.customApiHash=o),b(o)}),s()(),r(25,"div",27)(26,"label"),l(27,"\u624B\u6A5F\u865F\u78BC"),s(),r(28,"input",74),x("ngModelChange",function(o){v(t);let a=g();return b(a.onPhoneChange(o))}),s()(),r(29,"button",36),x("click",function(){v(t);let o=g();return b(o.sendVerificationCodeWithCustomApi())}),S(30,Zv,2,0)(31,jv,1,0),s()()()}if(i&2){let t=g();c(20),z("ngModel",t.customApiId),c(4),z("ngModel",t.customApiHash),c(4),I("error",t.phoneError()),V("ngModel",t.phoneNumber),c(),V("disabled",!t.isAdvancedFormValid()||t.isSending()),c(),w(t.isSending()?30:31)}}function tb(i,e){if(i&1&&(r(0,"div",67),l(1),s()),i&2){let t=g(3);c(),Y(" ",t.addedAccountInfo().firstName||""," ",t.addedAccountInfo().lastName||""," ")}}function nb(i,e){if(i&1&&(r(0,"div",82),l(1),s()),i&2){let t=g(3);c(),D("@",t.addedAccountInfo().username)}}function ib(i,e){if(i&1&&(r(0,"div",76)(1,"div",79),l(2),s(),r(3,"div",80),S(4,tb,2,2,"div",67),r(5,"div",81),l(6),s(),S(7,nb,2,1,"div",82),s()()),i&2){let t=g(2);c(2),D(" ",t.getAvatarLetter()," "),c(2),w(t.addedAccountInfo().firstName||t.addedAccountInfo().lastName?4:-1),c(2),A(t.addedAccountInfo().phone),c(),w(t.addedAccountInfo().username?7:-1)}}function ob(i,e){if(i&1){let t=M();r(0,"div",11)(1,"div",75),l(2,"\u2705"),s(),r(3,"h2"),l(4,"\u5E33\u865F\u6DFB\u52A0\u6210\u529F\uFF01"),s(),S(5,ib,8,4,"div",76),r(6,"div",77)(7,"button",45),x("click",function(){v(t);let o=g();return b(o.addAnother())}),l(8,"\u2795 \u7E7C\u7E8C\u6DFB\u52A0"),s(),r(9,"button",78),x("click",function(){v(t);let o=g();return b(o.goBack())}),l(10,"\u8FD4\u56DE\u5E33\u6236\u5217\u8868"),s()()()}if(i&2){let t=g();c(5),w(t.addedAccountInfo()?5:-1)}}var No=class i{constructor(){this.ipcService=O(ye);this.toast=O(ue);this.membershipService=O(Re);this.authService=O(xt);this.back=new ot;this.accountAdded=new ot;this.switchToAdvanced=new ot;this.currentStep=_(1);this.activeMethod=_(null);this.showAdvanced=_(!1);this.phoneNumber="";this.verificationCode="";this.twoFactorPassword="";this.proxyMode="auto";this.codeStep=_(!1);this.isSending=_(!1);this.isVerifying=_(!1);this.needs2FA=_(!1);this.resendCooldown=_(0);this.phoneError=_("");this.phoneValid=_(!1);this.customApiId="";this.customApiHash="";this.isDragging=_(!1);this.isScanningTdata=_(!1);this.isImporting=_(!1);this.tdataScanResult=_(null);this.selectedTdataAccounts=_([]);this.addedAccountInfo=_(null);this.phoneCodeHash="";this.resendTimer=null;this.sendTimeout=null;this.verifyTimeout=null;this.ipcChannels=[]}ngOnInit(){this.setupIpcListeners()}ngOnDestroy(){this.resendTimer&&clearInterval(this.resendTimer),this.sendTimeout&&clearTimeout(this.sendTimeout),this.verifyTimeout&&clearTimeout(this.verifyTimeout),this.ipcChannels.forEach(e=>this.ipcService.cleanup(e))}setupIpcListeners(){this.ipcService.on("login-requires-code",e=>{this.isSending.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),(e.phone===this.phoneNumber||e.accountId)&&(this.phoneCodeHash=e.phoneCodeHash,this.codeStep.set(!0),this.startResendCooldown(),this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001"))}),this.ipcChannels.push("login-requires-code"),this.ipcService.on("login-success",e=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.addedAccountInfo.set(e.userInfo||{phone:this.phoneNumber}),this.currentStep.set(2),this.accountAdded.emit(e),this.toast.success("\u767B\u5165\u6210\u529F\uFF01")}),this.ipcChannels.push("login-success"),this.ipcService.on("login-requires-2fa",()=>{this.isVerifying.set(!1),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),this.needs2FA.set(!0),this.toast.info("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC")}),this.ipcChannels.push("login-requires-2fa"),this.ipcService.on("login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("login-error"),this.ipcService.on("account-login-error",e=>{this.handleLoginError(e)}),this.ipcChannels.push("account-login-error"),this.ipcService.on("account-added",e=>{e&&!e.success&&e.code==="QUOTA_EXCEEDED"&&this.handleLoginError(e)}),this.ipcChannels.push("account-added"),this.ipcService.on("tdata-scan-result",e=>{if(this.isScanningTdata.set(!1),this.tdataScanResult.set(e),e.success&&e.accounts?.length>0){let t=e.accounts.filter(n=>n.can_import).map(n=>n.index);this.selectedTdataAccounts.set(t),this.toast.success(`\u627E\u5230 ${e.accounts.length} \u500B\u5E33\u865F`)}}),this.ipcChannels.push("tdata-scan-result"),this.ipcService.on("tdata-import-result",e=>{this.isImporting.set(!1),e.success?(this.addedAccountInfo.set({phone:e.phone,firstName:e.first_name,lastName:e.last_name,username:e.username}),this.currentStep.set(2),this.accountAdded.emit(e),this.toast.success("\u5C0E\u5165\u6210\u529F\uFF01")):this.toast.error(e.error||"\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-import-result"),this.ipcService.on("tdata-batch-result",e=>{this.isImporting.set(!1),e.success_count>0?(this.addedAccountInfo.set({batch:!0,count:e.success_count}),this.currentStep.set(2),this.toast.success(`\u6210\u529F\u5C0E\u5165 ${e.success_count} \u500B\u5E33\u865F`)):this.toast.error("\u5C0E\u5165\u5931\u6557")}),this.ipcChannels.push("tdata-batch-result"),this.ipcService.on("tdata-folder-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-folder-selected"),this.ipcService.on("tdata-zip-selected",e=>{e.path&&this.scanTdata(e.path)}),this.ipcChannels.push("tdata-zip-selected")}goBack(){this.back.emit()}startPhoneLogin(){this.activeMethod.set("phone")}startTdataImport(){this.activeMethod.set("tdata")}startAdvancedMode(){this.activeMethod.set("advanced")}goToAdvancedPage(){this.switchToAdvanced.emit()}onPhoneChange(e){this.phoneNumber=e;let t=this.validatePhone(e);this.phoneValid.set(t.valid),this.phoneError.set(t.error)}validatePhone(e){if(!e)return{valid:!1,error:""};let t=e.trim();if(!t.startsWith("+"))return{valid:!1,error:"\u8ACB\u4EE5 + \u958B\u982D\uFF0C\u4F8B\u5982 +86"};let n=t.slice(1);return/^\d+$/.test(n)?n.length<8?{valid:!1,error:"\u865F\u78BC\u9577\u5EA6\u4E0D\u8DB3"}:{valid:!0,error:""}:{valid:!1,error:"\u865F\u78BC\u53EA\u80FD\u5305\u542B\u6578\u5B57"}}sendVerificationCode(){if(!this.phoneValid())return;this.isSending.set(!0),this.phoneError.set("");let e=this.authService.user(),t=e?.id?String(e.id):void 0;this.ipcService.send("add-account",{phone:this.phoneNumber,proxy:this.proxyMode==="auto"?"auto":null,usePlatformApi:!0,ownerUserId:t}),setTimeout(()=>{this.ipcService.send("login-account",{phone:this.phoneNumber,proxy:this.proxyMode==="auto"?"auto":null,usePlatformApi:!0,ownerUserId:t})},500),this.sendTimeout=setTimeout(()=>{this.isSending()&&(this.isSending.set(!1),this.toast.error("\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},3e4)}sendVerificationCodeWithCustomApi(){if(!this.isAdvancedFormValid())return;this.isSending.set(!0);let e=this.authService.user(),t=e?.id?String(e.id):void 0;this.ipcService.send("add-account",{phone:this.phoneNumber,apiId:this.customApiId,apiHash:this.customApiHash,proxy:this.proxyMode==="auto"?"auto":null,ownerUserId:t}),setTimeout(()=>{this.ipcService.send("login-account",{phone:this.phoneNumber,apiId:this.customApiId,apiHash:this.customApiHash,proxy:this.proxyMode==="auto"?"auto":null,ownerUserId:t})},500),this.sendTimeout=setTimeout(()=>{this.isSending()&&(this.isSending.set(!1),this.toast.error("\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},3e4)}submitVerificationCode(){if(this.verificationCode){if(this.needs2FA()&&!this.twoFactorPassword){this.toast.error("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC");return}this.isVerifying.set(!0),this.ipcService.send("login-account",{phone:this.phoneNumber,phoneCode:this.verificationCode,phoneCodeHash:this.phoneCodeHash,twoFactorPassword:this.twoFactorPassword||null,usePlatformApi:this.activeMethod()!=="advanced",apiId:this.customApiId||void 0,apiHash:this.customApiHash||void 0}),this.verifyTimeout=setTimeout(()=>{this.isVerifying()&&(this.isVerifying.set(!1),this.toast.error("\u9A57\u8B49\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},3e4)}}resendCode(){this.sendVerificationCode()}isAdvancedFormValid(){return this.phoneValid()&&!!this.customApiId&&/^\d+$/.test(this.customApiId)&&!!this.customApiHash&&/^[a-f0-9]{32}$/i.test(this.customApiHash)}handleLoginError(e){if(this.isSending.set(!1),this.isVerifying.set(!1),this.sendTimeout&&(clearTimeout(this.sendTimeout),this.sendTimeout=null),this.verifyTimeout&&(clearTimeout(this.verifyTimeout),this.verifyTimeout=null),e.code==="QUOTA_EXCEEDED"){let n=e.detail||e.quota||{},o=n.limit||"?",d=`\u5E33\u865F\u6578\u91CF\u5DF2\u9054\u4E0A\u9650\uFF08${n.used||"?"}/${o}\uFF09\u3002\u5347\u7D1A\u6703\u54E1\u53EF\u6DFB\u52A0\u66F4\u591A\u5E33\u865F\u3002`;this.toast.error(d);return}let t=e.friendlyMessage||e.error||"\u767B\u5165\u5931\u6557";this.toast.error(t)}startResendCooldown(){this.resendCooldown.set(60),this.resendTimer=setInterval(()=>{let e=this.resendCooldown();e<=1?(clearInterval(this.resendTimer),this.resendCooldown.set(0)):this.resendCooldown.set(e-1)},1e3)}getDefaultTdataPath(){let e=navigator.userAgent.includes("Windows"),t=navigator.userAgent.includes("Mac");return e?"%APPDATA%\\Telegram Desktop\\tdata":t?"~/Library/Application Support/Telegram Desktop/tdata":"~/.local/share/TelegramDesktop/tdata"}copyTdataPath(){navigator.clipboard.writeText(this.getDefaultTdataPath()),this.toast.success("\u8DEF\u5F91\u5DF2\u8907\u88FD")}openTdataFolder(){this.ipcService.send("open-default-tdata-folder",{})}selectTdataFolder(){this.ipcService.send("select-tdata-folder",{})}selectTdataZip(){this.ipcService.send("select-tdata-zip",{})}onDragOver(e){e.preventDefault(),this.isDragging.set(!0)}onDragLeave(e){e.preventDefault(),this.isDragging.set(!1)}onDropTdata(e){e.preventDefault(),this.isDragging.set(!1);let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0].path;n&&this.scanTdata(n)}}scanTdata(e){this.isScanningTdata.set(!0),this.tdataScanResult.set(null),this.selectedTdataAccounts.set([]),this.ipcService.send("scan-tdata",{path:e})}toggleTdataAccount(e){this.selectedTdataAccounts.update(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])}importTdataAccounts(){let e=this.tdataScanResult();if(!e?.tdata_path)return;let t=this.selectedTdataAccounts();if(t.length===0)return;this.isImporting.set(!0);let n=this.authService.user(),o=n?.id?String(n.id):void 0;t.length===1?this.ipcService.send("import-tdata-account",{tdataPath:e.tdata_path,accountIndex:t[0],usePlatformApi:!0,ownerUserId:o}):this.ipcService.send("import-tdata-batch",{tdataPath:e.tdata_path,accountIndices:t,usePlatformApi:!0,ownerUserId:o})}getAvatarLetter(){let e=this.addedAccountInfo();return e?e.firstName?e.firstName.charAt(0).toUpperCase():e.phone&&e.phone.charAt(1)||"?":"?"}addAnother(){this.currentStep.set(1),this.activeMethod.set(null),this.resetForm()}resetForm(){this.phoneNumber="",this.verificationCode="",this.twoFactorPassword="",this.customApiId="",this.customApiHash="",this.proxyMode="auto",this.phoneCodeHash="",this.codeStep.set(!1),this.needs2FA.set(!1),this.tdataScanResult.set(null),this.selectedTdataAccounts.set([]),this.addedAccountInfo.set(null)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-add-account-simple"]],outputs:{back:"back",accountAdded:"accountAdded",switchToAdvanced:"switchToAdvanced"},decls:23,vars:13,consts:[[1,"add-account-page"],[1,"page-header"],[1,"back-btn",3,"click"],[1,"page-title"],[1,"step-indicator"],[1,"step"],[1,"step-number"],[1,"step-label"],[1,"step-line"],[1,"login-options"],[1,"login-form"],[1,"success-section"],[1,"login-option","primary",3,"click"],[1,"option-badge"],[1,"option-icon"],[1,"option-content"],[1,"option-arrow"],[1,"login-option","secondary",3,"click"],[1,"option-badge","safe"],[1,"advanced-section"],[1,"advanced-toggle",3,"click"],[1,"toggle-icon"],[1,"advanced-options"],[1,"login-option","tertiary",3,"click"],[1,"form-header"],[1,"back-link",3,"click"],[1,"form-card"],[1,"form-group"],["type","tel","placeholder","+86 138 xxxx xxxx",1,"form-input","large",3,"ngModelChange","ngModel"],[1,"error-hint"],[1,"input-hint"],[1,"proxy-simple"],[1,"radio-option"],["type","radio","name","proxy","value","auto",3,"ngModelChange","ngModel"],[1,"radio-label"],["type","radio","name","proxy","value","none",3,"ngModelChange","ngModel"],[1,"btn-primary","full-width",3,"click","disabled"],[1,"spinner"],[1,"code-sent-banner"],[1,"banner-icon"],["type","text","placeholder","\u8ACB\u8F38\u5165\u9A57\u8B49\u78BC","maxlength","6","autofocus","",1,"form-input","large","code-input",3,"ngModelChange","ngModel"],[1,"resend-row"],[1,"resend-countdown"],[1,"resend-btn"],[1,"form-actions-row"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click","disabled"],["type","password","placeholder","\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC",1,"form-input",3,"ngModelChange","ngModel"],[1,"resend-btn",3,"click"],[1,"tdata-hint"],[1,"hint-actions"],[1,"hint-btn",3,"click"],[1,"drop-zone",3,"dragover","dragleave","drop"],[1,"drop-icon"],[1,"drop-text"],[1,"drop-hint"],[1,"drop-buttons"],[1,"select-btn",3,"click"],[1,"select-btn","outline",3,"click"],[1,"scanning"],[1,"scan-result","success"],[1,"scan-result","error"],[1,"accounts-list"],[1,"account-checkbox",3,"disabled"],[1,"account-checkbox"],["type","checkbox",3,"change","checked","disabled"],[1,"account-info"],[1,"account-name"],[1,"api-guide"],["href","https://my.telegram.org","target","_blank"],[1,"advanced-link"],[1,"link-btn",3,"click"],["type","text","placeholder","\u4F8B\u5982\uFF1A12345678",1,"form-input",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4F8B\u5982\uFF1Aa1b2c3d4e5f6...",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","placeholder","+86 138 xxxx xxxx",1,"form-input",3,"ngModelChange","ngModel"],[1,"success-animation"],[1,"account-card"],[1,"success-actions"],[1,"btn-primary",3,"click"],[1,"account-avatar"],[1,"account-details"],[1,"account-phone"],[1,"account-username"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),x("click",function(){return n.goBack()}),l(3,"\u2190 \u8FD4\u56DE"),s(),r(4,"h1",3),l(5,"\u6DFB\u52A0 Telegram \u5E33\u865F"),s()(),r(6,"div",4)(7,"div",5)(8,"span",6),l(9,"1"),s(),r(10,"span",7),l(11,"\u767B\u5165\u5E33\u865F"),s()(),k(12,"div",8),r(13,"div",5)(14,"span",6),l(15,"2"),s(),r(16,"span",7),l(17,"\u5B8C\u6210"),s()()(),S(18,kv,31,2,"div",9),S(19,qv,9,1,"div",10),S(20,Xv,31,5,"div",10),S(21,eb,32,7,"div",10),S(22,ob,11,1,"div",11),s()),t&2&&(c(7),I("active",n.currentStep()===1)("completed",n.currentStep()>1),c(5),I("active",n.currentStep()>1),c(),I("active",n.currentStep()===2),c(5),w(n.currentStep()===1&&!n.activeMethod()?18:-1),c(),w(n.currentStep()===1&&n.activeMethod()==="phone"?19:-1),c(),w(n.currentStep()===1&&n.activeMethod()==="tdata"?20:-1),c(),w(n.currentStep()===1&&n.activeMethod()==="advanced"?21:-1),c(),w(n.currentStep()===2?22:-1))},dependencies:[te,me,xe,on,_e,Pt,Ce],styles:[".add-account-page[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem;padding:0;margin-bottom:.5rem}.page-title[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;color:var(--text-primary, white)}.step-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:2rem;gap:.5rem}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.step-number[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:var(--bg-tertiary, rgba(15, 23, 42, .5));display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--primary, #06b6d4);color:#fff}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.step-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-muted, #94a3b8)}.step.active[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%]{color:var(--text-primary, white)}.step-line[_ngcontent-%COMP%]{width:60px;height:2px;background:var(--bg-tertiary, rgba(15, 23, 42, .5))}.step-line.active[_ngcontent-%COMP%]{background:var(--primary, #06b6d4)}.login-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.login-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:2px solid transparent;border-radius:1rem;cursor:pointer;transition:all .2s;position:relative}.login-option[_ngcontent-%COMP%]:hover{transform:translate(4px);border-color:var(--primary, #06b6d4)}.login-option.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d426,#3b82f61a);border-color:#06b6d44d}.login-option.primary[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);box-shadow:0 4px 20px #06b6d433}.option-badge[_ngcontent-%COMP%]{position:absolute;top:-8px;right:1rem;padding:.2rem .6rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border-radius:.75rem;font-size:.7rem;font-weight:600;color:#fff}.option-badge.safe[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a)}.option-icon[_ngcontent-%COMP%]{font-size:2rem;width:50px;text-align:center}.option-content[_ngcontent-%COMP%]{flex:1}.option-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1.125rem;color:var(--text-primary, white)}.option-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.8rem;color:var(--text-muted, #94a3b8)}.option-arrow[_ngcontent-%COMP%]{font-size:1.25rem;color:var(--text-muted, #64748b)}.advanced-section[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border-default, rgba(148, 163, 184, .1))}.advanced-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;width:100%;padding:.75rem;background:transparent;border:none;color:var(--text-muted, #64748b);font-size:.8rem;cursor:pointer}.advanced-toggle[_ngcontent-%COMP%]:hover{color:var(--text-secondary, #94a3b8)}.toggle-icon[_ngcontent-%COMP%]{font-size:.6rem}.advanced-options[_ngcontent-%COMP%]{margin-top:.75rem}.login-option.tertiary[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px dashed var(--border-default, rgba(148, 163, 184, .2))}.login-form[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.form-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.back-link[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.8rem;padding:0;margin-bottom:.5rem}.form-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--text-primary, white)}.form-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;padding:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.form-input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:1rem;box-sizing:border-box;transition:border-color .2s}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.form-input.large[_ngcontent-%COMP%]{font-size:1.125rem;padding:1rem 1.25rem}.form-input.error[_ngcontent-%COMP%]{border-color:#ef4444}.form-input.valid[_ngcontent-%COMP%]{border-color:#22c55e}.form-input.code-input[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;letter-spacing:.5rem}.input-hint[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:var(--text-muted, #64748b)}.error-hint[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:#ef4444}.proxy-simple[_ngcontent-%COMP%]{display:flex;gap:.75rem}.radio-option[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:2px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .2s}.radio-option[_ngcontent-%COMP%]:hover{border-color:var(--border-default, rgba(148, 163, 184, .3))}.radio-option.selected[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.radio-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.radio-label[_ngcontent-%COMP%]{display:flex;flex-direction:column}.radio-label[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-primary, white)}.radio-label[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted, #64748b)}.btn-primary[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.875rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary.full-width[_ngcontent-%COMP%]{width:100%}.btn-secondary[_ngcontent-%COMP%]{padding:.875rem 1.5rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .3));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);font-size:1rem;cursor:pointer}.code-sent-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#22c55e26;border-radius:.5rem;margin-bottom:1.25rem;color:#86efac;font-size:.875rem}.resend-row[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.resend-countdown[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-muted, #64748b)}.resend-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary, #06b6d4);cursor:pointer;font-size:.875rem}.form-actions-row[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:1rem}.form-actions-row[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{flex:1}.form-actions-row[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{flex:2}.tdata-hint[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));padding:1rem;border-radius:.5rem;margin-bottom:1rem}.tdata-hint[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.875rem;color:var(--text-primary, white)}.tdata-hint[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;font-size:.75rem;color:var(--primary, #06b6d4);word-break:break-all;margin-bottom:.5rem}.hint-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.hint-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:none;border-radius:.25rem;color:var(--text-muted, #94a3b8);font-size:.7rem;cursor:pointer}.drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--border-default, rgba(148, 163, 184, .3));border-radius:.75rem;padding:2rem;text-align:center;transition:all .2s}.drop-zone[_ngcontent-%COMP%]:hover, .drop-zone.dragging[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d40d}.drop-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:.5rem}.drop-text[_ngcontent-%COMP%]{margin:0;color:var(--text-primary, white)}.drop-hint[_ngcontent-%COMP%]{margin:.5rem 0 1rem;font-size:.8rem;color:var(--text-muted, #64748b)}.drop-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem}.select-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary, #06b6d4);border:none;border-radius:.375rem;color:#fff;font-size:.875rem;cursor:pointer}.select-btn.outline[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .3));color:var(--text-secondary, #94a3b8)}.scan-result[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;border-radius:.5rem}.scan-result.success[_ngcontent-%COMP%]{background:#22c55e1a;border:1px solid rgba(34,197,94,.2)}.scan-result.error[_ngcontent-%COMP%]{background:#ef44441a;border:1px solid rgba(239,68,68,.2);color:#fca5a5}.scan-result[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;color:var(--text-primary, white)}.accounts-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1rem;max-height:200px;overflow-y:auto}.account-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.375rem;cursor:pointer}.account-checkbox.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.account-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary, white)}.account-name[_ngcontent-%COMP%]{margin-left:.5rem;color:var(--text-muted, #94a3b8);font-size:.8rem}.scanning[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--text-muted, #94a3b8)}.api-guide[_ngcontent-%COMP%]{padding:.75rem;background:#f59e0b1a;border-radius:.5rem;margin-bottom:1rem;font-size:.8rem;color:#fcd34d}.api-guide[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#06b6d4}.api-guide[_ngcontent-%COMP%]   .advanced-link[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.75rem;color:#9ca3af}.api-guide[_ngcontent-%COMP%]   .link-btn[_ngcontent-%COMP%]{color:#8b5cf6;cursor:pointer;transition:color .2s}.api-guide[_ngcontent-%COMP%]   .link-btn[_ngcontent-%COMP%]:hover{color:#a78bfa;text-decoration:underline}.success-section[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem}.success-animation[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;animation:_ngcontent-%COMP%_success-pop .5s ease-out}@keyframes _ngcontent-%COMP%_success-pop{0%{transform:scale(0)}50%{transform:scale(1.2)}to{transform:scale(1)}}.success-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--text-primary, white)}.account-card[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:1rem;padding:1rem 2rem;background:var(--bg-card, rgba(30, 41, 59, .8));border-radius:1rem;margin-bottom:1.5rem}.account-avatar[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#fff}.account-details[_ngcontent-%COMP%]{text-align:left}.account-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.account-phone[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1)}.account-username[_ngcontent-%COMP%]{font-size:.875rem;color:var(--primary, #06b6d4)}.success-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.75rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};var Oo=(i,e)=>e.key,rb=(i,e)=>e.id,sb=(i,e)=>e.test_id,ab=(i,e)=>e.name;function lb(i,e){if(i&1){let t=M();r(0,"button",53),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.filterTemplateCategory.set(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(3);I("bg-blue-500",n.filterTemplateCategory()===t.key)("text-white",n.filterTemplateCategory()===t.key)("bg-slate-700",n.filterTemplateCategory()!==t.key)("text-slate-400",n.filterTemplateCategory()!==t.key),c(),Y(" ",t.icon," ",t.label," ")}}function cb(i,e){i&1&&(r(0,"div",50),ne(),r(1,"svg",54),k(2,"circle",55)(3,"path",56),s(),ge(),r(4,"span",57),l(5,"\u8F09\u5165\u6A21\u677F..."),s()())}function db(i,e){i&1&&(r(0,"div",51)(1,"p"),l(2,"\u6C92\u6709\u627E\u5230\u6A21\u677F"),s(),r(3,"p",58),l(4,"\u8ACB\u5148\u5230\u300C\u804A\u5929\u6A21\u677F\u300D\u9801\u9762\u5275\u5EFA\u6A21\u677F"),s()())}function ub(i,e){if(i&1){let t=M();r(0,"button",60),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.selectTemplate(o))}),r(1,"div",61)(2,"span",62),l(3),s(),r(4,"span",23),l(5),s()(),r(6,"p",63),l(7),s()()}if(i&2){let t,n,o,a,d,m=e.$implicit,f=g(4);I("border-blue-500",((t=f.selectedTemplate())==null?null:t.id)===m.id)("bg-blue-500/10",((n=f.selectedTemplate())==null?null:n.id)===m.id)("border-slate-600",((o=f.selectedTemplate())==null?null:o.id)!==m.id)("bg-slate-800/50",((a=f.selectedTemplate())==null?null:a.id)!==m.id)("hover:border-slate-500",((d=f.selectedTemplate())==null?null:d.id)!==m.id),c(3),A(m.name),c(2),D("\u4F7F\u7528 ",m.usageCount," \u6B21"),c(2),A(m.content)}}function mb(i,e){if(i&1&&(r(0,"div",52),$(1,ub,8,13,"button",59,rb),s()),i&2){let t=g(3);c(),H(t.filteredTemplates())}}function pb(i,e){if(i&1){let t=M();r(0,"div",17)(1,"div",45)(2,"label",46),l(3,"\u9078\u64C7\u804A\u5929\u6A21\u677F"),s(),r(4,"button",47),x("click",function(){v(t);let o=g(2);return b(o.loadTemplates())}),l(5," \u{1F504} \u5237\u65B0 "),s()(),r(6,"div",48),$(7,lb,2,10,"button",49,Oo),s(),S(9,cb,6,0,"div",50)(10,db,5,0,"div",51)(11,mb,3,0,"div",52),s()}if(i&2){let t=g(2);c(7),H(t.templateCategories),c(2),w(t.isLoadingTemplates()?9:t.filteredTemplates().length===0?10:11)}}function gb(i,e){if(i&1&&(k(0,"span",73),r(1,"span"),l(2),s()),i&2){let t=g(4);c(2),D("\u5DF2\u9023\u63A5 ",t.aiStatus().model)}}function hb(i,e){i&1&&(k(0,"span",74),r(1,"span"),l(2,"\u4F7F\u7528\u672C\u5730\u6A21\u677F"),s())}function fb(i,e){if(i&1&&(r(0,"div",72),S(1,gb,3,1)(2,hb,3,0),s()),i&2){let t=g(3);I("bg-green-500/20",t.aiStatus().connected)("text-green-400",t.aiStatus().connected)("bg-amber-500/20",!t.aiStatus().connected)("text-amber-400",!t.aiStatus().connected),c(),w(t.aiStatus().connected?1:2)}}function _b(i,e){if(i&1){let t=M();r(0,"button",75),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.selectedAiStyle.set(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(3);I("bg-purple-500",n.selectedAiStyle()===t.key)("text-white",n.selectedAiStyle()===t.key)("bg-slate-700",n.selectedAiStyle()!==t.key)("text-slate-400",n.selectedAiStyle()!==t.key),c(),D(" ",t.label," ")}}function Cb(i,e){i&1&&(ne(),r(0,"svg",76),k(1,"circle",55)(2,"path",56),s(),l(3," \u751F\u6210\u4E2D... "))}function vb(i,e){i&1&&l(0," \u2728 \u751F\u6210 5 \u7A2E\u4E0D\u540C\u8868\u9054 ")}function bb(i,e){if(i&1){let t=M();r(0,"label",83)(1,"input",84),x("change",function(){let o=v(t).$implicit,a=g(4);return b(a.toggleMessageSelection(o))}),s(),r(2,"span",85),l(3),s()()}if(i&2){let t=e.$implicit,n=g(4);I("border-purple-500",n.isMessageSelected(t))("bg-purple-500/10",n.isMessageSelected(t))("border-slate-600",!n.isMessageSelected(t))("bg-slate-800/50",!n.isMessageSelected(t)),c(),V("checked",n.isMessageSelected(t)),c(2),A(t)}}function xb(i,e){if(i&1){let t=M();r(0,"button",90),x("click",function(){let o=v(t).$implicit,a=g(5);return b(a.setSendStrategy(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(5);I("bg-purple-500",n.sendStrategy()===t.key)("text-white",n.sendStrategy()===t.key)("bg-slate-700",n.sendStrategy()!==t.key)("text-slate-400",n.sendStrategy()!==t.key),V("title",t.desc),c(),D(" ",t.label," ")}}function yb(i,e){if(i&1&&(r(0,"div",81)(1,"span",86),l(2,"\u{1F4E4} \u767C\u9001\u7B56\u7565\uFF1A"),s(),r(3,"div",87),$(4,xb,2,10,"button",88,Oo),s(),r(6,"p",89),l(7),s()()),i&2){let t=g(4);c(4),H(t.sendStrategies),c(3),D(" ",t.getStrategyDescription()," ")}}function Sb(i,e){if(i&1){let t=M();r(0,"button",90),x("click",function(){let o=v(t).$implicit,a=g(5);return b(a.abTestId.set(o.test_id))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(5);I("bg-purple-500",n.abTestId()===t.test_id)("text-white",n.abTestId()===t.test_id)("bg-slate-700/50",n.abTestId()!==t.test_id)("text-slate-400",n.abTestId()!==t.test_id),V("title","\u4F7F\u7528 A/B \u6E2C\u8A66: "+t.name),c(),D(" \u{1F9EA} ",t.name," ")}}function wb(i,e){i&1&&(r(0,"p",94),l(1," \u5C07\u7531\u5F8C\u7AEF A/B \u6E2C\u8A66\u5F15\u64CE\u81EA\u52D5\u9078\u64C7\u6A21\u677F\u8B8A\u9AD4\u4E26\u8A18\u9304\u6548\u679C "),s())}function Eb(i,e){if(i&1){let t=M();r(0,"div",82)(1,"span",91),l(2,"\u{1F9EA} A/B \u6E2C\u8A66\uFF08\u53EF\u9078\uFF09\uFF1A"),s(),r(3,"div",87)(4,"button",92),x("click",function(){v(t);let o=g(4);return b(o.abTestId.set(""))}),l(5," \u4E0D\u4F7F\u7528 "),s(),$(6,Sb,2,10,"button",93,sb),s(),S(8,wb,2,0,"p",94),s()}if(i&2){let t=g(4);c(4),I("bg-slate-600",!t.abTestId())("text-white",!t.abTestId())("bg-slate-700/50",t.abTestId())("text-slate-400",t.abTestId()),c(2),H(t.abTests()),c(2),w(t.abTestId()?8:-1)}}function Ab(i,e){if(i&1){let t=M();r(0,"div",71)(1,"div",5)(2,"span",77),l(3),s(),r(4,"div",15)(5,"button",78),x("click",function(){v(t);let o=g(3);return b(o.selectAllMessages())}),l(6," \u5168\u9078 "),s(),r(7,"button",79),x("click",function(){v(t);let o=g(3);return b(o.clearSelectedMessages())}),l(8," \u6E05\u9664 "),s()()(),$(9,bb,4,10,"label",80,vt),S(11,yb,8,1,"div",81),S(12,Eb,9,9,"div",82),s()}if(i&2){let t=g(3);c(3),D("\u53EF\u591A\u9078\u6A21\u677F\uFF08\u5DF2\u9078 ",t.selectedMessages().size," \u500B\uFF09\uFF1A"),c(6),H(t.aiGeneratedMessages()),c(2),w(t.selectedMessages().size>1?11:-1),c(),w(t.abTestsLoaded()&&t.abTests().length>0&&t.selectedMessages().size>1?12:-1)}}function Db(i,e){if(i&1){let t=M();r(0,"div",18)(1,"div",45)(2,"label",64),l(3,"\u{1F916} AI \u667A\u80FD\u751F\u6210"),s(),S(4,fb,3,9,"div",65),s(),r(5,"div",66)(6,"div")(7,"span",67),l(8,"\u8A9E\u8A00\u98A8\u683C\uFF1A"),s(),r(9,"div",37),$(10,_b,2,9,"button",68,Oo),s()(),r(12,"div")(13,"span",67),l(14,"\u6D88\u606F\u4E3B\u984C\uFF1A"),s(),r(15,"input",69),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.aiTopic,o)||(a.aiTopic=o),b(o)}),s()(),r(16,"button",70),x("click",function(){v(t);let o=g(2);return b(o.generateAiMessage())}),S(17,Cb,4,0)(18,vb,1,0),s(),S(19,Ab,13,3,"div",71),s()()}if(i&2){let t=g(2);c(4),w(t.aiStatus().source!=="unknown"?4:-1),c(6),H(t.aiStyles),c(5),z("ngModel",t.aiTopic),c(),V("disabled",t.isGeneratingAi()||!t.aiTopic.trim()),c(),w(t.isGeneratingAi()?17:18),c(2),w(t.aiGeneratedMessages().length>0?19:-1)}}function Mb(i,e){if(i&1&&(r(0,"span",20),l(1),s()),i&2){let t,n=g(2);c(),D("\uFF08\u4F7F\u7528\u6A21\u677F\uFF1A",(t=n.selectedTemplate())==null?null:t.name,"\uFF09")}}function Tb(i,e){if(i&1){let t=M();r(0,"button",95),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.insertVariable(o.key))}),r(1,"span",31),l(2),s(),r(3,"span",96),l(4,"|"),s(),r(5,"span",97),l(6),s()()}if(i&2){let t=e.$implicit;V("title","\u63D2\u5165 "+t.key),c(2),A(t.key),c(4),A(t.label)}}function kb(i,e){if(i&1){let t=M();r(0,"div",98)(1,"span",99),l(2),s(),r(3,"span",100),l(4),s(),r(5,"button",101),x("click",function(){let o=v(t).$index,a=g(3);return b(a.removeAttachment(o))}),ne(),r(6,"svg",102),k(7,"path",12),s()()()}if(i&2){let t=e.$implicit;c(2),A(t.type.startsWith("image")?"\u{1F5BC}\uFE0F":"\u{1F4C4}"),c(2),A(t.name)}}function Ib(i,e){if(i&1&&(r(0,"div",27),$(1,kb,8,2,"div",98,ab),s()),i&2){let t=g(2);c(),H(t.attachments())}}function Pb(i,e){if(i&1&&(r(0,"span",38),l(1),s()),i&2){let t=e.$implicit;c(),D(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function Fb(i,e){if(i&1&&(r(0,"span",39),l(1),s()),i&2){let t=g(2);c(),D(" +",t.targets().length-20," \u66F4\u591A... ")}}function Nb(i,e){if(i&1&&(r(0,"div",108),l(1),s()),i&2){let t=g(3);c(),D(" \u{1F4E8} \u6B63\u5728\u767C\u9001\u7D66: ",t.currentTarget()," ")}}function Rb(i,e){if(i&1&&(r(0,"span",111),l(1),s()),i&2){let t=e.$implicit;c(),Y(" ",t.label,": ",t.count," ")}}function Ob(i,e){if(i&1&&(r(0,"div",109)(1,"div",110),l(2,"\u5931\u6557\u539F\u56E0\uFF1A"),s(),r(3,"div",37),$(4,Rb,2,2,"span",111,vt),s()()),i&2){let t=g(3);c(4),H(t.failureReasonsList())}}function Bb(i,e){if(i&1&&(r(0,"div",40)(1,"div",103)(2,"span",104),l(3,"\u767C\u9001\u9032\u5EA6"),s(),r(4,"span",9),l(5),s()(),r(6,"div",105),k(7,"div",106),s(),r(8,"div",107)(9,"span"),l(10),s(),r(11,"span"),l(12),s(),r(13,"span"),l(14),s()(),S(15,Nb,2,1,"div",108),S(16,Ob,6,0,"div",109),s()),i&2){let t=g(2);c(5),Y("",t.sentCount()," / ",t.targets().length),c(2),X("width",t.progressPercent(),"%"),c(3),D("\u2705 \u6210\u529F: ",t.successCount()),c(2),D("\u274C \u5931\u6557: ",t.failedCount()),c(2),D("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining()),c(),w(t.currentTarget()?15:-1),c(),w(t.failedCount()>0&&t.failureReasonsList().length>0?16:-1)}}function Vb(i,e){i&1&&(r(0,"span",112),l(1,"\u23F3"),s(),l(2," \u767C\u9001\u4E2D... "))}function Lb(i,e){if(i&1&&l(0),i&2){let t=g(2);D(" \u{1F4E8} \u958B\u59CB\u767C\u9001 (",t.targets().length," \u4EBA) ")}}function Gb(i,e){if(i&1){let t=M();r(0,"div",2),x("click",function(o){v(t);let a=g();return b(a.onBackdropClick(o))}),r(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),l(6," \u{1F4E8} "),s(),r(7,"div")(8,"h2",8),l(9,"\u6279\u91CF\u767C\u9001\u6D88\u606F"),s(),r(10,"p",9),l(11),s()()(),r(12,"button",10),x("click",function(){v(t);let o=g();return b(o.close())}),ne(),r(13,"svg",11),k(14,"path",12),s()()()(),ge(),r(15,"div",13)(16,"div")(17,"label",14),l(18," \u{1F4DD} \u6D88\u606F\u4F86\u6E90 "),s(),r(19,"div",15)(20,"button",16),x("click",function(){v(t);let o=g();return b(o.setMessageSource("template"))}),l(21," \u{1F4C4} \u804A\u5929\u6A21\u677F "),s(),r(22,"button",16),x("click",function(){v(t);let o=g();return b(o.setMessageSource("custom"))}),l(23," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),s(),r(24,"button",16),x("click",function(){v(t);let o=g();return b(o.setMessageSource("ai"))}),l(25," \u{1F916} AI \u751F\u6210 "),s()()(),S(26,pb,12,1,"div",17),S(27,Db,20,5,"div",18),r(28,"div")(29,"label",19),l(30," \u{1F4DD} \u6D88\u606F\u5167\u5BB9 "),S(31,Mb,2,1,"span",20),s(),r(32,"textarea",21),W("ngModelChange",function(o){v(t);let a=g();return K(a.messageContent,o)||(a.messageContent=o),b(o)}),l(33,"              "),s(),r(34,"div",22)(35,"span",23),l(36,"\u53EF\u7528\u8B8A\u91CF\uFF1A"),s(),$(37,Tb,7,3,"button",24,Oo),s()(),r(39,"div")(40,"label",19),l(41," \u{1F4CE} \u9644\u4EF6\uFF08\u53EF\u9078\uFF09 "),s(),r(42,"div",25)(43,"button",26),x("click",function(){v(t);let o=g();return b(o.selectImages())}),l(44," \u{1F5BC}\uFE0F \u6DFB\u52A0\u5716\u7247 "),s(),r(45,"button",26),x("click",function(){v(t);let o=g();return b(o.selectFiles())}),l(46," \u{1F4C4} \u6DFB\u52A0\u6587\u4EF6 "),s()(),S(47,Ib,3,0,"div",27),s(),r(48,"div",17)(49,"label",14),l(50," \u2699\uFE0F \u767C\u9001\u8A2D\u7F6E "),s(),r(51,"div",28)(52,"div",6)(53,"span",29),l(54,"\u767C\u9001\u9593\u9694\uFF1A"),s(),r(55,"input",30),W("ngModelChange",function(o){v(t);let a=g();return K(a.minInterval,o)||(a.minInterval=o),b(o)}),s(),r(56,"span",31),l(57,"-"),s(),r(58,"input",32),W("ngModelChange",function(o){v(t);let a=g();return K(a.maxInterval,o)||(a.maxInterval=o),b(o)}),s(),r(59,"span",9),l(60,"\u79D2\uFF08\u96A8\u6A5F\uFF09"),s()(),r(61,"div",6)(62,"span",29),l(63,"\u5E33\u865F\u8F2A\u63DB\uFF1A"),s(),r(64,"label",33)(65,"input",34),W("ngModelChange",function(o){v(t);let a=g();return K(a.accountRotation,o)||(a.accountRotation=o),b(o)}),s(),k(66,"div",35),s(),r(67,"span",9),l(68,"\u555F\u7528\u591A\u5E33\u865F\u8F2A\u63DB\u767C\u9001"),s()()()(),r(69,"div")(70,"label",19),l(71),s(),r(72,"div",36)(73,"div",37),$(74,Pb,2,1,"span",38,vt),S(76,Fb,2,1,"span",39),s()()()(),S(77,Bb,17,9,"div",40),r(78,"div",41)(79,"button",42),x("click",function(){v(t);let o=g();return b(o.close())}),l(80),s(),r(81,"button",43),x("click",function(){v(t);let o=g();return b(o.previewMessage())}),l(82," \u{1F441}\uFE0F \u9810\u89BD "),s(),r(83,"button",44),x("click",function(){v(t);let o=g();return b(o.startSending())}),S(84,Vb,3,0)(85,Lb,1,1),s()()()()}if(i&2){let t=g();c(11),D("\u5411 ",t.targets().length," \u500B\u7528\u6236\u767C\u9001\u6D88\u606F"),c(9),I("border-blue-500",t.messageSource()==="template")("bg-blue-500/20",t.messageSource()==="template")("text-blue-400",t.messageSource()==="template")("border-slate-600",t.messageSource()!=="template")("bg-slate-800/50",t.messageSource()!=="template")("text-slate-400",t.messageSource()!=="template"),c(2),I("border-cyan-500",t.messageSource()==="custom")("bg-cyan-500/20",t.messageSource()==="custom")("text-cyan-400",t.messageSource()==="custom")("border-slate-600",t.messageSource()!=="custom")("bg-slate-800/50",t.messageSource()!=="custom")("text-slate-400",t.messageSource()!=="custom"),c(2),I("border-purple-500",t.messageSource()==="ai")("bg-purple-500/20",t.messageSource()==="ai")("text-purple-400",t.messageSource()==="ai")("border-slate-600",t.messageSource()!=="ai")("bg-slate-800/50",t.messageSource()!=="ai")("text-slate-400",t.messageSource()!=="ai"),c(2),w(t.messageSource()==="template"?26:-1),c(),w(t.messageSource()==="ai"?27:-1),c(4),w(t.messageSource()==="template"&&t.selectedTemplate()?31:-1),c(),z("ngModel",t.messageContent),c(5),H(t.availableVariables),c(10),w(t.attachments().length>0?47:-1),c(8),z("ngModel",t.minInterval),c(3),z("ngModel",t.maxInterval),c(7),z("ngModel",t.accountRotation),c(6),D(" \u{1F465} \u767C\u9001\u76EE\u6A19\uFF08",t.targets().length," \u4EBA\uFF09 "),c(3),H(t.targets().slice(0,20)),c(2),w(t.targets().length>20?76:-1),c(),w(t.isSending()?77:-1),c(2),V("disabled",t.isSending()),c(),D(" ",t.isSending()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),c(),V("disabled",!t.canSend()||t.isSending()),c(2),V("disabled",!t.canSend()||t.isSending()),c(),w(t.isSending()?84:85)}}function Ub(i,e){if(i&1&&(r(0,"div",116),l(1),s()),i&2){let t=g(2);c(),D(" \u{1F4CE} \u5305\u542B ",t.attachments().length," \u500B\u9644\u4EF6 ")}}function qb(i,e){if(i&1){let t=M();r(0,"div",1)(1,"div",113)(2,"h3",114),l(3,"\u{1F4F1} \u6D88\u606F\u9810\u89BD"),s(),r(4,"div",115),l(5),s(),S(6,Ub,2,1,"div",116),r(7,"button",117),x("click",function(){v(t);let o=g();return b(o.showPreview.set(!1))}),l(8," \u95DC\u9589 "),s()()()}if(i&2){let t=g();c(5),D(" ",t.previewText()," "),c(),w(t.attachments().length>0?6:-1)}}var Ro=class i{constructor(){this.ipc=O(ye);this.toast=O(ue);this.bizApi=O(ii);this.listeners=[];this.isOpen=at(!1);this.targets=at([]);this.closeDialog=Me();this.sendComplete=Me();this.messageSource=_("custom");this.chatTemplates=_([]);this.isLoadingTemplates=_(!1);this.selectedTemplate=_(null);this.filterTemplateCategory=_("all");this.templateCategories=[{key:"all",icon:"\u{1F4CB}",label:"\u5168\u90E8"},{key:"greeting",icon:"\u{1F44B}",label:"\u554F\u5019\u8A9E"},{key:"follow_up",icon:"\u{1F4E9}",label:"\u8DDF\u9032\u6D88\u606F"},{key:"promotion",icon:"\u{1F4E2}",label:"\u63A8\u5EE3\u6D88\u606F"},{key:"custom",icon:"\u270F\uFE0F",label:"\u81EA\u5B9A\u7FA9"}];this.filteredTemplates=G(()=>{let e=this.filterTemplateCategory(),t=this.chatTemplates();return e==="all"?t.filter(n=>n.isEnabled):t.filter(n=>n.isEnabled&&n.category===e)});this.selectedAiStyle=_("friendly");this.aiTopic="";this.isGeneratingAi=_(!1);this.aiGeneratedMessages=_([]);this.aiStatus=_({connected:!1,model:null,source:"unknown"});this.selectedMessages=_(new Set);this.sendStrategy=_("random");this.sendStrategies=[{key:"random",label:"\u{1F3B2} \u96A8\u6A5F\u767C\u9001",desc:"\u6BCF\u500B\u7528\u6236\u96A8\u6A5F\u9078\u64C7\u4E00\u500B\u6A21\u677F"},{key:"rotate",label:"\u{1F504} \u8F2A\u8F49\u767C\u9001",desc:"\u4F9D\u6B21\u4F7F\u7528\u6A21\u677F\uFF081\u21922\u21923\u21921...\uFF09"},{key:"sequential",label:"\u{1F4CB} \u9806\u5E8F\u767C\u9001",desc:"\u6309\u9806\u5E8F\u7528\u5B8C\u518D\u91CD\u8907"}];this.abTestId=_("");this.abTests=_([]);this.abTestsLoaded=_(!1);this.aiStyles=[{key:"friendly",label:"\u53CB\u597D\u89AA\u5207"},{key:"formal",label:"\u6B63\u5F0F\u5546\u52D9"},{key:"humorous",label:"\u8F15\u9B06\u5E7D\u9ED8"},{key:"concise",label:"\u7C21\u6F54\u660E\u4E86"},{key:"enthusiastic",label:"\u71B1\u60C5\u6D0B\u6EA2"}];this.messageContent="";this.attachments=_([]);this.minInterval=30;this.maxInterval=60;this.accountRotation=!0;this.availableVariables=[{key:"{firstName}",label:"\u540D\u5B57"},{key:"{lastName}",label:"\u59D3\u6C0F"},{key:"{username}",label:"\u7528\u6236\u540D"},{key:"{name}",label:"\u986F\u793A\u540D"},{key:"{fullName}",label:"\u5168\u540D"},{key:"{groupName}",label:"\u4F86\u6E90\u7FA4\u7D44"},{key:"{keyword}",label:"\u89F8\u767C\u95DC\u9375\u8A5E"},{key:"{source}",label:"\u4F86\u6E90\u6E20\u9053"},{key:"{greeting}",label:"\u554F\u5019\u8A9E"},{key:"{date}",label:"\u65E5\u671F"},{key:"{time}",label:"\u6642\u9593"},{key:"{day}",label:"\u661F\u671F"}];this.isSending=_(!1);this.sentCount=_(0);this.successCount=_(0);this.failedCount=_(0);this.currentTarget=_("");this.failureReasons=_({});this.failureReasonLabels={privacy_restricted:"\u{1F512} \u96B1\u79C1\u9650\u5236",flood_wait:"\u23F1\uFE0F API \u9650\u5236",user_not_found:"\u2753 \u7528\u6236\u4E0D\u5B58\u5728",user_blocked:"\u{1F6AB} \u88AB\u5C01\u9396",invalid_id:"\u26A0\uFE0F \u7121\u6548 ID",no_account:"\u{1F4F1} \u7121\u53EF\u7528\u5E33\u865F",cancelled:"\u23F9\uFE0F \u5DF2\u53D6\u6D88",other:"\u274C \u5176\u4ED6\u932F\u8AA4"};this.showPreview=_(!1);this.progressPercent=G(()=>{let e=this.targets().length;return e>0?this.sentCount()/e*100:0});this.failureReasonsList=G(()=>{let e=this.failureReasons();return Object.keys(e).map(t=>({key:t,label:this.failureReasonLabels[t]||t,count:e[t]}))});this.estimatedRemaining=G(()=>{let e=this.targets().length-this.sentCount(),t=(this.minInterval+this.maxInterval)/2,n=e*t;return n<60?`${Math.round(n)} \u79D2`:n<3600?`${Math.round(n/60)} \u5206\u9418`:`${Math.round(n/3600)} \u5C0F\u6642`});this.previewText=G(()=>{let e=this.targets()[0]||{};return this.replaceVariables(this.messageContent,e)});this.aiGenerateTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadTemplates(),this.loadABTests()}async loadABTests(){try{let e=await this.bizApi.loadABTests();this.abTests.set(e.filter(t=>t.status==="running")),this.abTestsLoaded.set(!0)}catch{this.abTestsLoaded.set(!0)}}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-send:progress",a=>{this.sentCount.set(a.sent),this.successCount.set(a.success),this.failedCount.set(a.failed),a.currentTarget&&this.currentTarget.set(a.currentTarget),a.failureReasons&&this.failureReasons.set(a.failureReasons)});this.listeners.push(e);let t=this.ipc.on("batch-send:complete",a=>{if(this.isSending.set(!1),this.sendComplete.emit({success:a.success,failed:a.failed}),a.error)this.toast.error(`\u274C \u767C\u9001\u5931\u6557\uFF1A${a.error}`);else if(a.failed>0){let d=a.failureSummary||`\u5931\u6557 ${a.failed} \u500B`;this.toast.warning(`\u26A0\uFE0F \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${a.success}\uFF0C${d}`)}else this.toast.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${a.success} \u500B`);a.failureReasons&&this.failureReasons.set(a.failureReasons)});this.listeners.push(t);let n=this.ipc.on("get-chat-templates-result",a=>{this.isLoadingTemplates.set(!1),a.templates&&this.chatTemplates.set(a.templates)});this.listeners.push(n);let o=this.ipc.on("ai-generate-message-result",a=>{console.log("[AI] \u6536\u5230\u751F\u6210\u7D50\u679C:",a),this.aiGenerateTimeout&&(clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=null),this.isGeneratingAi.set(!1),a.success&&a.messages?(this.aiGeneratedMessages.set(a.messages),a.source==="ai"&&a.model?(this.aiStatus.set({connected:!0,model:a.model,source:"ai"}),this.toast.success(`\u{1F916} ${a.model} \u751F\u6210\u4E86 ${a.messages.length} \u689D\u6D88\u606F\uFF01`)):(this.aiStatus.set({connected:!1,model:null,source:"local"}),this.toast.info("\u{1F4CB} \u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F\u751F\u6210\u6D88\u606F"))):this.toast.error(a.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(o)}setMessageSource(e){this.messageSource.set(e),e==="template"&&this.loadTemplates()}loadTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectTemplate(e){this.selectedTemplate.set(e),this.messageContent=e.content,this.toast.info(`\u5DF2\u9078\u64C7\u6A21\u677F\uFF1A${e.name}`)}generateAiMessage(){if(!this.aiTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingAi.set(!0),this.aiGeneratedMessages.set([]),this.aiGenerateTimeout&&clearTimeout(this.aiGenerateTimeout),this.aiGenerateTimeout=setTimeout(()=>{this.isGeneratingAi()&&(this.isGeneratingAi.set(!1),this.toast.warning("AI \u751F\u6210\u8D85\u6642\uFF0C\u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F"),this.useLocalAiTemplates())},1e4),console.log("[AI] \u767C\u9001\u751F\u6210\u8ACB\u6C42:",{topic:this.aiTopic,style:this.selectedAiStyle()}),this.ipc.send("ai-generate-message",{topic:this.aiTopic,style:this.selectedAiStyle(),count:5,context:{targetCount:this.targets().length,sampleTarget:this.targets()[0]}})}useLocalAiTemplates(){let e=this.aiTopic||"\u6253\u62DB\u547C",t=this.selectedAiStyle(),n={friendly:["{greeting}\uFF01\u6211\u662F\u5728\u7FA4\u88E1\u770B\u5230\u4F60\u7684\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B~","Hi {name}\uFF01\u5F88\u9AD8\u8208\u80FD\u8A8D\u8B58\u4F60\uFF0C\u5E0C\u671B\u4EE5\u5F8C\u591A\u591A\u4EA4\u6D41 \u{1F60A}","{greeting}{name}\uFF0C\u6211\u89BA\u5F97\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u8A71\u984C\uFF0C\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F","\u55E8\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u60F3\u8DDF\u4F60\u4EA4\u500B\u670B\u53CB~",`{greeting}\uFF01\u6211\u662F${e}\u76F8\u95DC\u7684\uFF0C\u770B\u5230\u4F60\u4E5F\u5C0D\u9019\u500B\u611F\u8208\u8DA3\uFF1F`],formal:["{greeting}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u60A8\u3002\u6211\u6CE8\u610F\u5230\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u7684\u8208\u8DA3\u9EDE\uFF0C\u4E0D\u77E5\u662F\u5426\u65B9\u4FBF\u4EA4\u6D41\uFF1F",`\u60A8\u597D {name}\uFF0C\u5192\u6627\u6253\u64FE\u3002\u6211\u5C08\u6CE8\u65BC${e}\u9818\u57DF\uFF0C\u5E0C\u671B\u80FD\u8207\u60A8\u5EFA\u7ACB\u806F\u7E6B\u3002`,"{greeting}\uFF0C\u6211\u662F\u901A\u904E\u7FA4\u7D44\u8A8D\u8B58\u5230\u60A8\u7684\u3002\u5982\u6709\u5408\u4F5C\u6A5F\u6703\uFF0C\u671F\u5F85\u9032\u4E00\u6B65\u6E9D\u901A\u3002","\u5C0A\u656C\u7684 {name}\uFF0C\u5F88\u69AE\u5E78\u80FD\u5920\u8207\u60A8\u53D6\u5F97\u806F\u7E6B\u3002\u671F\u5F85\u672A\u4F86\u6709\u6A5F\u6703\u5408\u4F5C\u3002",`{greeting}\uFF0C\u6211\u5C0D${e}\u5F88\u611F\u8208\u8DA3\uFF0C\u770B\u5230\u60A8\u4E5F\u5728\u9019\u500B\u9818\u57DF\uFF0C\u60F3\u5411\u60A8\u8ACB\u6559\u3002`],humorous:["{greeting}\uFF01\u6211\u4E0D\u662F\u63A8\u92B7\u54E1\uFF0C\u53EA\u662F\u89BA\u5F97\u4F60\u770B\u8D77\u4F86\u5F88\u9177\u60F3\u8A8D\u8B58\u4E00\u4E0B \u{1F60E}",`Hi {name}\uFF01\u5225\u64D4\u5FC3\uFF0C\u6211\u53EA\u662F\u60F3\u804A\u804A${e}\u800C\u5DF2\uFF0C\u4E0D\u6703\u63A8\u92B7\u4EFB\u4F55\u6771\u897F \u{1F923}`,`{greeting}\uFF01\u80FD\u9047\u5230\u5C0D${e}\u611F\u8208\u8DA3\u7684\u4EBA\u771F\u662F\u592A\u96E3\u5F97\u4E86\uFF01`,"\u55E8\uFF01\u770B\u5230\u4F60\u5728\u7FA4\u88E1\u7684\u767C\u8A00\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u5FCD\u4E0D\u4F4F\u4F86\u6253\u500B\u62DB\u547C~","{greeting}\uFF01\u96E3\u5F97\u9047\u5230\u540C\u597D\uFF0C\u5FC5\u9808\u8A8D\u8B58\u4E00\u4E0B\uFF01"],concise:["{greeting}\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B\u3002",`Hi {name}\uFF0C\u95DC\u65BC${e}\u60F3\u548C\u4F60\u804A\u804A\u3002`,`\u60A8\u597D\uFF0C\u770B\u5230\u4F60\u5C0D${e}\u611F\u8208\u8DA3\uFF0C\u65B9\u4FBF\u4EA4\u6D41\u55CE\uFF1F`,`{greeting}\uFF0C\u6211\u4E5F\u95DC\u6CE8${e}\uFF0C\u4EA4\u500B\u670B\u53CB\uFF1F`,`Hi\uFF0C\u60F3\u8ACB\u6559\u4E00\u4E0B${e}\u76F8\u95DC\u7684\u554F\u984C\u3002`],enthusiastic:["{greeting}\uFF01\uFF01\u592A\u958B\u5FC3\u80FD\u8A8D\u8B58\u4F60\u4E86\uFF01\u{1F389}",`\u54C7\uFF01{name}\uFF01\u7D42\u65BC\u627E\u5230\u540C\u6A23\u559C\u6B61${e}\u7684\u4EBA\u4E86\uFF01\u2728`,"{greeting}\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u8D85\u8208\u596E\u7684\uFF01\u6211\u5011\u4E00\u5B9A\u6709\u5F88\u591A\u5171\u540C\u8A71\u984C\uFF01",`Hi {name}\uFF01\u2764\uFE0F \u8D85\u7D1A\u671F\u5F85\u548C\u4F60\u804A${e}\uFF01`,"{greeting}\uFF01\u9047\u5230\u4F60\u7C21\u76F4\u592A\u68D2\u4E86\uFF01\u{1F31F}"]},o=n[t]||n.friendly;this.aiGeneratedMessages.set(o),this.toast.info("\u5DF2\u751F\u6210\u672C\u5730\u6A21\u677F\u4F9B\u9078\u64C7")}selectAiMessage(e){this.messageContent=e}isMessageSelected(e){return this.selectedMessages().has(e)}toggleMessageSelection(e){let t=new Set(this.selectedMessages());t.has(e)?t.delete(e):t.add(e),this.selectedMessages.set(t),t.size===1?this.messageContent=Array.from(t)[0]:t.size>1?this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${t.size} \u500B\u6A21\u677F`:this.messageContent=""}selectAllMessages(){let e=new Set(this.aiGeneratedMessages());this.selectedMessages.set(e),this.messageContent=`[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${e.size} \u500B\u6A21\u677F`}clearSelectedMessages(){this.selectedMessages.set(new Set),this.messageContent=""}setSendStrategy(e){this.sendStrategy.set(e)}getStrategyDescription(){return{random:`\u5C07\u96A8\u6A5F\u9078\u64C7\u6A21\u677F\u767C\u9001\u7D66 ${this.targets().length} \u500B\u7528\u6236\uFF0C\u589E\u52A0\u6D88\u606F\u591A\u6A23\u6027`,rotate:"\u6A21\u677F\u5C07\u8F2A\u6D41\u4F7F\u7528\uFF0C\u78BA\u4FDD\u6BCF\u500B\u6A21\u677F\u88AB\u5747\u52FB\u4F7F\u7528",sequential:"\u6309\u9806\u5E8F\u4F9D\u6B21\u4F7F\u7528\u6BCF\u500B\u6A21\u677F"}[this.sendStrategy()]||""}canSend(){return this.selectedMessages().size>0?!0:this.messageContent.trim().length>0||this.attachments().length>0}insertVariable(e){this.messageContent+=e}async selectImages(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"Images",extensions:["jpg","jpeg","png","gif","webp"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(n=>({name:n.fileName,path:n.filePath,type:n.fileType}));this.attachments.update(n=>[...n,...t])}}catch(e){console.error("Select images failed:",e)}}async selectFiles(){try{let e=await this.ipc.invoke("select-file-for-attachment",{filters:[{name:"All Files",extensions:["*"]}],multiSelections:!0});if(e&&e.length>0){let t=e.map(n=>({name:n.fileName,path:n.filePath,type:n.fileType}));this.attachments.update(n=>[...n,...t])}}catch(e){console.error("Select files failed:",e)}}removeAttachment(e){this.attachments.update(t=>t.filter((n,o)=>o!==e))}previewMessage(){this.showPreview.set(!0)}replaceVariables(e,t){let n=e,o=t.firstName||t.first_name||"",a=t.lastName||t.last_name||"",d=t.username||"",m=t.displayName||t.name||o||d||"\u670B\u53CB",f=`${o} ${a}`.trim()||m,h=t.groupName||t.sourceGroup||t.source||"\u7FA4\u7D44",C=t.keyword||t.triggeredKeyword||t.matchedKeyword||"",y=t.source||t.sourceType||"";n=n.replace(/{firstName}/g,o),n=n.replace(/{first_name}/g,o),n=n.replace(/{lastName}/g,a),n=n.replace(/{last_name}/g,a),n=n.replace(/{username}/g,d),n=n.replace(/{displayName}/g,m),n=n.replace(/{name}/g,m),n=n.replace(/{fullName}/g,f),n=n.replace(/{full_name}/g,f),n=n.replace(/{groupName}/g,h),n=n.replace(/{group_name}/g,h),n=n.replace(/{keyword}/g,C),n=n.replace(/{source}/g,y);let E=new Date,T=E.getHours(),R="\u60A8\u597D";T>=5&&T<12?R="\u65E9\u4E0A\u597D":T>=12&&T<14?R="\u4E2D\u5348\u597D":T>=14&&T<18?R="\u4E0B\u5348\u597D":T>=18&&T<22?R="\u665A\u4E0A\u597D":R="\u591C\u6DF1\u4E86";let L=["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],q=`${E.getMonth()+1}\u6708${E.getDate()}\u65E5`,U=`${E.getHours().toString().padStart(2,"0")}:${E.getMinutes().toString().padStart(2,"0")}`,Q=L[E.getDay()];return n=n.replace(/{greeting}/g,R),n=n.replace(/{date}/g,q),n=n.replace(/{time}/g,U),n=n.replace(/{day}/g,Q),n}startSending(){if(!this.canSend())return;this.isSending.set(!0),this.sentCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.currentTarget.set(""),this.failureReasons.set({});let e=Array.from(this.selectedMessages()),t=e.length>1,n={targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,lastName:o.lastName,displayName:o.displayName,groupName:o.groupName,keyword:o.keyword,source:o.source})),attachments:this.attachments(),config:F({minInterval:this.minInterval,maxInterval:this.maxInterval,accountRotation:this.accountRotation},this.abTestId()?{abTestId:this.abTestId()}:{})};t?(n.messages=e,n.sendStrategy=this.sendStrategy(),n.message="",this.toast.info(`\u{1F4E8} \u4F7F\u7528 ${e.length} \u500B\u6A21\u677F${this.sendStrategy()==="random"?"\u96A8\u6A5F":this.sendStrategy()==="rotate"?"\u8F2A\u8F49":"\u9806\u5E8F"}\u767C\u9001...`)):e.length===1?n.message=e[0]:n.message=this.messageContent,this.ipc.send("batch-send:start",n),t||this.toast.info(`\u{1F4E8} \u958B\u59CB\u6279\u91CF\u767C\u9001 ${this.targets().length} \u689D\u6D88\u606F...`)}close(){if(this.isSending()){if(!confirm("\u767C\u9001\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-send:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isSending()&&this.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-batch-send-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"]},outputs:{closeDialog:"closeDialog",sendComplete:"sendComplete"},decls:2,vars:2,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/80","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-blue-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-blue-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"p-4","bg-purple-500/10","rounded-xl","border","border-purple-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"text-xs","text-blue-400","ml-2"],["rows","5","placeholder",`\u8F38\u5165\u6D88\u606F\u5167\u5BB9...

\u9EDE\u64CA\u4E0B\u65B9\u8B8A\u91CF\u6309\u9215\u53EF\u5FEB\u901F\u63D2\u5165\uFF0C\u4F8B\u5982\uFF1A
{greeting}{name}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u4F60\uFF01`,1,"w-full","bg-slate-800/50","border","border-slate-600","rounded-xl","p-4","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mt-2","flex","flex-wrap","gap-2","items-center"],[1,"text-xs","text-slate-500"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"title"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-800/50","border","border-dashed","border-slate-600","rounded-xl","text-slate-400","hover:text-white","hover:border-slate-500","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],[1,"mt-3","flex","flex-wrap","gap-2"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","10","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","10","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","ngModel"],[1,"w-11","h-6","bg-slate-700","peer-focus:ring-2","peer-focus:ring-blue-500","rounded-full","peer","peer-checked:after:translate-x-full","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-500"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-3","bg-slate-700","text-white","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-blue-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-blue-500/20",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium","text-slate-300"],[1,"text-xs","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","gap-2","mb-3","flex-wrap"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-blue-500","text-white","bg-slate-700","text-slate-400"],[1,"flex","items-center","justify-center","py-6"],[1,"text-center","py-6","text-slate-500"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"ml-2","text-slate-400","text-sm"],[1,"text-xs","mt-1"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","p-3","rounded-lg","border","transition-all","text-left",3,"click"],[1,"flex","items-center","justify-between","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","line-clamp-2"],[1,"text-sm","font-medium","text-purple-300"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs",3,"bg-green-500/20","text-green-400","bg-amber-500/20","text-amber-400"],[1,"space-y-3"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u6253\u500B\u62DB\u547C\u3001\u4ECB\u7D39\u7522\u54C1\u3001\u9080\u8ACB\u52A0\u7FA4...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"w-full","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"space-y-3","mt-3"],[1,"flex","items-center","gap-2","px-2","py-1","rounded-lg","text-xs"],[1,"w-2","h-2","bg-green-500","rounded-full","animate-pulse"],[1,"w-2","h-2","bg-amber-500","rounded-full"],[1,"px-3","py-1.5","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],[1,"text-xs","text-slate-400"],[1,"text-xs","px-2","py-1","bg-purple-500/20","text-purple-400","rounded","hover:bg-purple-500/30",3,"click"],[1,"text-xs","px-2","py-1","bg-slate-700","text-slate-400","rounded","hover:bg-slate-600",3,"click"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"mt-3","p-3","bg-gradient-to-r","from-purple-500/5","to-blue-500/5","rounded-lg","border","border-purple-500/20"],[1,"flex","items-start","gap-3","w-full","p-3","rounded-lg","border","transition-all","cursor-pointer"],["type","checkbox",1,"mt-1","w-4","h-4","rounded","bg-slate-700","border-slate-500","text-purple-500","focus:ring-purple-500",3,"change","checked"],[1,"flex-1","text-sm","text-slate-300"],[1,"text-xs","text-slate-400","block","mb-2"],[1,"flex","gap-2","flex-wrap"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400","title"],[1,"text-xs","text-slate-500","mt-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"click","title"],[1,"text-xs","text-purple-400","block","mb-2"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-xs","transition-all",3,"bg-purple-500","text-white","bg-slate-700/50","text-slate-400","title"],[1,"text-xs","text-purple-400/70","mt-2"],[1,"px-2.5","py-1","text-xs","bg-slate-700/80","text-cyan-400","rounded-lg","hover:bg-cyan-500/20","hover:text-cyan-300","transition-all","border","border-slate-600","hover:border-cyan-500/50","flex","items-center","gap-1",3,"click","title"],[1,"text-slate-500"],[1,"text-white"],[1,"flex","items-center","gap-2","px-3","py-2","bg-slate-800/50","rounded-lg","border","border-slate-700"],[1,"text-lg"],[1,"text-sm","text-white","max-w-[150px]","truncate"],[1,"text-slate-400","hover:text-red-400",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-white"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-blue-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"mt-2","text-xs","text-cyan-400"],[1,"mt-3","p-2","bg-red-500/10","border","border-red-500/20","rounded-lg"],[1,"text-xs","text-red-400","font-medium","mb-1"],[1,"text-xs","px-2","py-0.5","bg-red-500/20","text-red-300","rounded"],[1,"animate-spin"],[1,"bg-slate-900","rounded-xl","p-6","max-w-md","w-full","border","border-slate-700"],[1,"text-lg","font-bold","text-white","mb-4"],[1,"p-4","bg-slate-800","rounded-lg","text-white","whitespace-pre-wrap"],[1,"mt-3","text-sm","text-slate-400"],[1,"mt-4","w-full","py-2","bg-slate-700","text-white","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"]],template:function(t,n){t&1&&(S(0,Gb,86,53,"div",0),S(1,qb,9,2,"div",1)),t&2&&(w(n.isOpen()?0:-1),c(),w(n.showPreview()?1:-1))},dependencies:[te,me,xe,jn,nn,_e,ti,ei,Ce],encapsulation:2})}};var $b=(i,e)=>e.telegramId,Dd=(i,e)=>e.id,Hb=(i,e)=>e.key;function zb(i,e){i&1&&(r(0,"div",42),ne(),r(1,"svg",45),k(2,"circle",46)(3,"path",47),s(),ge(),r(4,"span",48),l(5,"\u8F09\u5165\u7FA4\u7D44\u5217\u8868..."),s()())}function Kb(i,e){i&1&&(r(0,"div",43)(1,"p",49),l(2,"\u{1F605} \u6C92\u6709\u53EF\u7528\u7684\u7FA4\u7D44"),s(),r(3,"p",50),l(4,"\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44\u4E26\u4E14\u64C1\u6709\u9080\u8ACB\u6B0A\u9650"),s()())}function Wb(i,e){i&1&&(r(0,"span",57),l(1,"\u7BA1\u7406\u54E1"),s())}function Jb(i,e){i&1&&(r(0,"span",58),l(1,"\u6210\u54E1"),s())}function Qb(i,e){i&1&&(ne(),r(0,"svg",61),k(1,"path",62),s())}function Yb(i,e){if(i&1){let t=M();r(0,"button",52),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.selectGroup(o))}),r(1,"div",53),l(2),s(),r(3,"div",54)(4,"div",55)(5,"span",56),l(6),s(),S(7,Wb,2,0,"span",57)(8,Jb,2,0,"span",58),s(),r(9,"div",59)(10,"span"),l(11),ke(12,"number"),s(),r(13,"span"),l(14,"\u2022"),s(),r(15,"span",60),l(16),s()()(),S(17,Qb,2,0,":svg:svg",61),s()}if(i&2){let t,n,o,a,d,m,f=e.$implicit,h=g(4);I("border-emerald-500",((t=h.selectedGroup())==null?null:t.id)===f.id)("bg-emerald-500/10",((n=h.selectedGroup())==null?null:n.id)===f.id)("border-slate-600",((o=h.selectedGroup())==null?null:o.id)!==f.id)("bg-slate-800/50",((a=h.selectedGroup())==null?null:a.id)!==f.id)("hover:border-slate-500",((d=h.selectedGroup())==null?null:d.id)!==f.id),c(),I("from-blue-500",f.type==="group")("to-cyan-500",f.type==="group")("from-purple-500",f.type==="supergroup")("to-pink-500",f.type==="supergroup")("from-amber-500",f.type==="channel")("to-orange-500",f.type==="channel"),c(),D(" ",f.type==="channel"?"\u{1F4E2}":"\u{1F465}"," "),c(4),A(f.name),c(),w(f.isAdmin?7:8),c(4),D("\u{1F464} ",Ne(12,28,f.memberCount)," \u6210\u54E1"),c(5),A(f.url),c(),w(((m=h.selectedGroup())==null?null:m.id)===f.id?17:-1)}}function Xb(i,e){if(i&1&&(r(0,"div",44),$(1,Yb,18,30,"button",51,Dd),s()),i&2){let t=g(3);c(),H(t.availableGroups())}}function Zb(i,e){if(i&1&&(r(0,"div")(1,"label",30),l(2," \u9078\u64C7\u76EE\u6A19\u7FA4\u7D44 "),s(),S(3,zb,6,0,"div",42)(4,Kb,5,0,"div",43)(5,Xb,3,0,"div",44),s()),i&2){let t=g(2);c(3),w(t.isLoadingGroups()?3:t.availableGroups().length===0?4:5)}}function jb(i,e){if(i&1){let t=M();r(0,"div")(1,"span",64),l(2,"\u7FA4\u7D44\u540D\u7A31\uFF1A"),s(),r(3,"input",71),W("ngModelChange",function(o){v(t);let a=g(3);return K(a.newGroupName,o)||(a.newGroupName=o),b(o)}),s(),r(4,"span",72),l(5),s()()}if(i&2){let t=g(3);c(3),z("ngModel",t.newGroupName),c(2),D("",t.newGroupName.length,"/128")}}function ex(i,e){if(i&1){let t=M();r(0,"button",76),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.selectedGroupNameStyle.set(o.key))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(4);I("bg-purple-500",n.selectedGroupNameStyle()===t.key)("text-white",n.selectedGroupNameStyle()===t.key)("bg-slate-700",n.selectedGroupNameStyle()!==t.key)("text-slate-400",n.selectedGroupNameStyle()!==t.key),c(),D(" ",t.label," ")}}function tx(i,e){i&1&&(ne(),r(0,"svg",77),k(1,"circle",46)(2,"path",78),s(),l(3," \u751F\u6210\u4E2D... "))}function nx(i,e){i&1&&l(0," \u2728 \u751F\u6210\u7FA4\u540D ")}function ix(i,e){if(i&1){let t=M();r(0,"button",81),x("click",function(){let o=v(t).$implicit,a=g(5);return b(a.selectGeneratedName(o))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(5);I("border-purple-500",n.newGroupName===t)("bg-purple-500/10",n.newGroupName===t)("border-slate-600",n.newGroupName!==t)("bg-slate-800/50",n.newGroupName!==t),c(),D(" ",t," ")}}function ox(i,e){if(i&1&&(r(0,"div",26)(1,"span",79),l(2,"\u9078\u64C7\u4E00\u500B\uFF1A"),s(),$(3,ix,2,9,"button",80,vt),s()),i&2){let t=g(4);c(3),H(t.generatedGroupNames())}}function rx(i,e){if(i&1){let t=M();r(0,"div",27)(1,"div")(2,"span",64),l(3,"\u4E3B\u984C/\u95DC\u9375\u8A5E\uFF1A"),s(),r(4,"input",73),W("ngModelChange",function(o){v(t);let a=g(3);return K(a.aiGroupKeywords,o)||(a.aiGroupKeywords=o),b(o)}),s()(),r(5,"div")(6,"span",64),l(7,"\u98A8\u683C\uFF1A"),s(),r(8,"div",32),$(9,ex,2,9,"button",74,Hb),s()(),r(11,"button",75),x("click",function(){v(t);let o=g(3);return b(o.generateGroupNames())}),S(12,tx,4,0)(13,nx,1,0),s(),S(14,ox,5,0,"div",26),s()}if(i&2){let t=g(3);c(4),z("ngModel",t.aiGroupKeywords),c(5),H(t.groupNameStyles),c(2),V("disabled",t.isGeneratingNames()||!t.aiGroupKeywords.trim()),c(),w(t.isGeneratingNames()?12:13),c(2),w(t.generatedGroupNames().length>0?14:-1)}}function sx(i,e){if(i&1){let t=M();r(0,"div",16)(1,"label",63),l(2,"\u{1F4DD} \u65B0\u7FA4\u7D44\u4FE1\u606F"),s(),r(3,"div")(4,"span",64),l(5,"\u7FA4\u540D\u751F\u6210\uFF1A"),s(),r(6,"div",14)(7,"button",25),x("click",function(){v(t);let o=g(2);return b(o.groupNameMode.set("manual"))}),l(8," \u270F\uFE0F \u624B\u52D5\u8F38\u5165 "),s(),r(9,"button",25),x("click",function(){v(t);let o=g(2);return b(o.groupNameMode.set("ai"))}),l(10," \u{1F916} AI \u751F\u6210 "),s()()(),S(11,jb,6,2,"div"),S(12,rx,15,4,"div",27),r(13,"div")(14,"span",64),l(15,"\u7FA4\u7D44\u985E\u578B\uFF1A"),s(),r(16,"div",65)(17,"label",66)(18,"input",67),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.newGroupType,o)||(a.newGroupType=o),b(o)}),s(),r(19,"span",68),l(20,"\u666E\u901A\u7FA4\u7D44 (\u6700\u591A 200 \u4EBA)"),s()(),r(21,"label",66)(22,"input",69),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.newGroupType,o)||(a.newGroupType=o),b(o)}),s(),r(23,"span",68),l(24,"\u8D85\u7D1A\u7FA4\u7D44 (\u6700\u591A 20 \u842C\u4EBA)"),s()()()(),r(25,"div")(26,"span",64),l(27,"\u7FA4\u7D44\u63CF\u8FF0\uFF08\u53EF\u9078\uFF09\uFF1A"),s(),r(28,"textarea",70),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.newGroupDescription,o)||(a.newGroupDescription=o),b(o)}),l(29,"                  "),s()()()}if(i&2){let t=g(2);c(7),I("bg-cyan-500",t.groupNameMode()==="manual")("text-white",t.groupNameMode()==="manual")("bg-slate-700",t.groupNameMode()!=="manual")("text-slate-400",t.groupNameMode()!=="manual"),c(2),I("bg-purple-500",t.groupNameMode()==="ai")("text-white",t.groupNameMode()==="ai")("bg-slate-700",t.groupNameMode()!=="ai")("text-slate-400",t.groupNameMode()!=="ai"),c(2),w(t.groupNameMode()==="manual"?11:-1),c(),w(t.groupNameMode()==="ai"?12:-1),c(6),z("ngModel",t.newGroupType),c(4),z("ngModel",t.newGroupType),c(6),z("ngModel",t.newGroupDescription)}}function ax(i,e){i&1&&(r(0,"div",82),ne(),r(1,"svg",85),k(2,"circle",46)(3,"path",78),s(),ge(),r(4,"span",86),l(5,"\u8F09\u5165\u6A21\u677F..."),s()())}function lx(i,e){i&1&&(r(0,"p",83),l(1,"\u6C92\u6709\u53EF\u7528\u7684\u6A21\u677F"),s())}function cx(i,e){if(i&1){let t=M();r(0,"button",81),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.selectWelcomeTemplate(o))}),r(1,"span",88),l(2),s(),r(3,"p",89),l(4),s()()}if(i&2){let t,n,o,a,d=e.$implicit,m=g(4);I("border-blue-500",((t=m.selectedWelcomeTemplate())==null?null:t.id)===d.id)("bg-blue-500/10",((n=m.selectedWelcomeTemplate())==null?null:n.id)===d.id)("border-slate-600",((o=m.selectedWelcomeTemplate())==null?null:o.id)!==d.id)("bg-slate-800/50",((a=m.selectedWelcomeTemplate())==null?null:a.id)!==d.id),c(2),A(d.name),c(2),A(d.content)}}function dx(i,e){if(i&1&&(r(0,"div",84),$(1,cx,5,10,"button",87,Dd),s()),i&2){let t=g(3);c(),H(t.welcomeTemplates())}}function ux(i,e){if(i&1&&(r(0,"div",26),S(1,ax,6,0,"div",82)(2,lx,2,0,"p",83)(3,dx,3,0,"div",84),s()),i&2){let t=g(2);c(),w(t.isLoadingTemplates()?1:t.welcomeTemplates().length===0?2:3)}}function mx(i,e){i&1&&(ne(),r(0,"svg",77),k(1,"circle",46)(2,"path",78),s(),l(3," \u751F\u6210\u4E2D... "))}function px(i,e){i&1&&l(0," \u2728 \u751F\u6210\u6B61\u8FCE\u6D88\u606F ")}function gx(i,e){if(i&1&&(r(0,"div",91)(1,"p",92),l(2),s()()),i&2){let t=g(3);c(2),A(t.generatedWelcomeMessage())}}function hx(i,e){if(i&1){let t=M();r(0,"div",27)(1,"input",90),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.aiWelcomeTopic,o)||(a.aiWelcomeTopic=o),b(o)}),s(),r(2,"button",75),x("click",function(){v(t);let o=g(2);return b(o.generateWelcomeMessage())}),S(3,mx,4,0)(4,px,1,0),s(),S(5,gx,3,1,"div",91),s()}if(i&2){let t=g(2);c(),z("ngModel",t.aiWelcomeTopic),c(),V("disabled",t.isGeneratingWelcome()||!t.aiWelcomeTopic.trim()),c(),w(t.isGeneratingWelcome()?3:4),c(2),w(t.generatedWelcomeMessage()?5:-1)}}function fx(i,e){if(i&1){let t=M();r(0,"div",28)(1,"span",64),l(2,"\u6D88\u606F\u5167\u5BB9\uFF1A"),s(),r(3,"textarea",93),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.welcomeMessageContent,o)||(a.welcomeMessageContent=o),b(o)}),l(4,"                  "),s()()}if(i&2){let t=g(2);c(3),z("ngModel",t.welcomeMessageContent)}}function _x(i,e){if(i&1&&(r(0,"span",98),l(1),s()),i&2){let t=g(3);c(),D("\u26A0\uFE0F \u5DF2\u5728\u7FA4\u5167: ",t.permissionCheck().alreadyInGroup," \u4EBA")}}function Cx(i,e){if(i&1&&(r(0,"span",99),l(1),s()),i&2){let t=g(3);c(),D("\u274C \u96B1\u79C1\u9650\u5236: ",t.permissionCheck().privacyRestricted," \u4EBA")}}function vx(i,e){if(i&1&&(r(0,"div",94)(1,"h4",95),l(2,"\u{1F4CA} \u6B0A\u9650\u6AA2\u67E5\u7D50\u679C"),s(),r(3,"div",96)(4,"span",97),l(5),s(),S(6,_x,2,1,"span",98),S(7,Cx,2,1,"span",99),s()()),i&2){let t=g(2);I("bg-emerald-500/10",t.permissionCheck().canInvite>0)("border",!0)("border-emerald-500/30",t.permissionCheck().canInvite>0)("bg-amber-500/10",t.permissionCheck().canInvite===0)("border-amber-500/30",t.permissionCheck().canInvite===0),c(5),D("\u2705 \u53EF\u62C9\u5165: ",t.permissionCheck().canInvite," \u4EBA"),c(),w(t.permissionCheck().alreadyInGroup>0?6:-1),c(),w(t.permissionCheck().privacyRestricted>0?7:-1)}}function bx(i,e){if(i&1&&(r(0,"span",33),l(1),s()),i&2){let t=e.$implicit;c(),D(" ",t.displayName||t.firstName||t.username||t.telegramId," ")}}function xx(i,e){if(i&1&&(r(0,"span",34),l(1),s()),i&2){let t=g(2);c(),D(" +",t.targets().length-20," \u66F4\u591A... ")}}function yx(i,e){if(i&1&&(r(0,"div",35)(1,"div",100)(2,"span",92),l(3,"\u62C9\u7FA4\u9032\u5EA6"),s(),r(4,"span",8),l(5),s()(),r(6,"div",101),k(7,"div",102),s(),r(8,"div",103)(9,"span",104),l(10),s(),r(11,"span",98),l(12),s(),r(13,"span",99),l(14),s(),r(15,"span"),l(16),s()(),r(17,"p",105),l(18," \u{1F4A1} \u6210\u529F\u5305\u542B\uFF1A\u76F4\u63A5\u9080\u8ACB + \u5DF2\u767C\u9001\u9080\u8ACB\u93C8\u63A5 "),s()()),i&2){let t=g(2);c(5),Y("",t.invitedCount()," / ",t.targets().length),c(2),X("width",t.progressPercent(),"%"),c(3),D("\u2705 \u6210\u529F: ",t.successCount()),c(2),D("\u26A0\uFE0F \u8DF3\u904E: ",t.skippedCount()),c(2),D("\u274C \u5931\u6557: ",t.failedCount()),c(2),D("\u23F3 \u9810\u8A08\u5269\u9918: ",t.estimatedRemaining())}}function Sx(i,e){i&1&&(r(0,"div",36)(1,"div",106)(2,"span"),l(3,"\u26A0\uFE0F"),s(),r(4,"span"),l(5,"\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F\u5F8C\u518D\u9032\u884C\u62C9\u7FA4\u64CD\u4F5C"),s()()())}function wx(i,e){if(i&1&&(r(0,"div",37)(1,"div",107)(2,"span"),l(3,"\u{1F517}"),s(),r(4,"span"),l(5),s(),r(6,"span",108),l(7,"|"),s(),r(8,"span"),l(9),s()()()),i&2){let t,n=g(2);c(5),D("\u53EF\u7528\u5E33\u865F: ",n.onlineAccountsCount()," \u500B\u5728\u7DDA"),c(4),D("\u5C07\u4F7F\u7528: ",((t=n.preferredAccount())==null?null:t.firstName)||((t=n.preferredAccount())==null?null:t.phone)||"\u81EA\u52D5\u9078\u64C7")}}function Ex(i,e){i&1&&l(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function Ax(i,e){if(i&1&&(l(0),S(1,Ex,1,0)),i&2){let t=g(3);Y(" \u5275\u5EFA\u7FA4\u7D44\u300C",t.newGroupName,"\u300D\u2192 \u62C9\u5165 ",t.targets().length," \u4EBA "),c(),w(t.welcomeMessageSource()!=="none"?1:-1)}}function Dx(i,e){i&1&&l(0," \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ")}function Mx(i,e){if(i&1&&(l(0),S(1,Dx,1,0)),i&2){let t,n=g(3);Y(" \u62C9\u5165\u7FA4\u7D44\u300C",(t=n.selectedGroup())==null?null:t.name,"\u300D\u2192 ",n.targets().length," \u4EBA "),c(),w(n.welcomeMessageSource()!=="none"?1:-1)}}function Tx(i,e){if(i&1&&(r(0,"div",38)(1,"div",109)(2,"span"),l(3,"\u{1F4CB}"),s(),r(4,"span"),S(5,Ax,2,3)(6,Mx,2,3),s()()()),i&2){let t=g(2);c(5),w(t.groupSource()==="create"?5:6)}}function kx(i,e){if(i&1&&(r(0,"span",110),l(1,"\u23F3"),s(),l(2)),i&2){let t=g(2);c(2),D(" ",t.createGroupProgressMessage()||"\u5275\u5EFA\u7FA4\u7D44\u4E2D..."," ")}}function Ix(i,e){i&1&&(r(0,"span",110),l(1,"\u23F3"),s(),l(2," \u62C9\u7FA4\u4E2D... "))}function Px(i,e){if(i&1&&l(0),i&2){let t=g(2);D(" \u{1F680} \u5275\u5EFA\u4E26\u62C9\u4EBA (",t.targets().length," \u4EBA) ")}}function Fx(i,e){if(i&1&&l(0),i&2){let t=g(2);D(" \u{1F465} \u958B\u59CB\u62C9\u7FA4 (",t.targets().length," \u4EBA) ")}}function Nx(i,e){if(i&1){let t=M();r(0,"div",1),x("click",function(o){v(t);let a=g();return b(a.onBackdropClick(o))}),r(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),l(6," \u{1F465} "),s(),r(7,"div")(8,"h2",7),l(9,"\u6279\u91CF\u62C9\u5165\u7FA4\u7D44"),s(),r(10,"p",8),l(11),s()()(),r(12,"button",9),x("click",function(){v(t);let o=g();return b(o.close())}),ne(),r(13,"svg",10),k(14,"path",11),s()()()(),ge(),r(15,"div",12)(16,"div")(17,"label",13),l(18," \u{1F3AF} \u7FA4\u7D44\u4F86\u6E90 "),s(),r(19,"div",14)(20,"button",15),x("click",function(){v(t);let o=g();return b(o.setGroupSource("existing"))}),l(21," \u{1F3E0} \u73FE\u6709\u7FA4\u7D44 "),s(),r(22,"button",15),x("click",function(){v(t);let o=g();return b(o.setGroupSource("create"))}),l(23," \u2795 \u5275\u5EFA\u65B0\u7FA4 "),s()()(),S(24,Zb,6,1,"div"),S(25,sx,30,21,"div",16),r(26,"div",17)(27,"label",13),l(28," \u2699\uFE0F \u62C9\u7FA4\u8A2D\u7F6E "),s(),r(29,"div",18)(30,"div",5)(31,"span",19),l(32,"\u6BCF\u6279\u6B21\u4EBA\u6578\uFF1A"),s(),r(33,"input",20),W("ngModelChange",function(o){v(t);let a=g();return K(a.batchSize,o)||(a.batchSize=o),b(o)}),s(),r(34,"span",8),l(35,"\u4EBA"),s()(),r(36,"div",5)(37,"span",19),l(38,"\u6279\u6B21\u9593\u9694\uFF1A"),s(),r(39,"input",21),W("ngModelChange",function(o){v(t);let a=g();return K(a.minInterval,o)||(a.minInterval=o),b(o)}),s(),r(40,"span",22),l(41,"-"),s(),r(42,"input",23),W("ngModelChange",function(o){v(t);let a=g();return K(a.maxInterval,o)||(a.maxInterval=o),b(o)}),s(),r(43,"span",8),l(44,"\u79D2"),s()()()(),r(45,"div",17)(46,"label",13),l(47," \u{1F4AC} \u6B61\u8FCE\u6D88\u606F "),s(),r(48,"div",24)(49,"button",25),x("click",function(){v(t);let o=g();return b(o.welcomeMessageSource.set("none"))}),l(50," \u274C \u4E0D\u767C\u9001 "),s(),r(51,"button",25),x("click",function(){v(t);let o=g();return b(o.welcomeMessageSource.set("template"))}),l(52," \u{1F4C4} \u9078\u6A21\u677F "),s(),r(53,"button",25),x("click",function(){v(t);let o=g();return b(o.welcomeMessageSource.set("ai"))}),l(54," \u{1F916} AI \u751F\u6210 "),s()(),S(55,ux,4,1,"div",26),S(56,hx,6,4,"div",27),S(57,fx,5,1,"div",28),s(),S(58,vx,8,13,"div",29),r(59,"div")(60,"label",30),l(61),s(),r(62,"div",31)(63,"div",32),$(64,bx,2,1,"span",33,$b),S(66,xx,2,1,"span",34),s()()()(),S(67,yx,19,8,"div",35),S(68,Sx,6,0,"div",36)(69,wx,10,2,"div",37),S(70,Tx,7,1,"div",38),r(71,"div",39)(72,"button",40),x("click",function(){v(t);let o=g();return b(o.close())}),l(73),s(),r(74,"button",41),x("click",function(){v(t);let o=g();return b(o.startInviting())}),S(75,kx,3,1)(76,Ix,3,0)(77,Px,1,1)(78,Fx,1,1),s()()()()}if(i&2){let t=g();c(11),D("\u5C07 ",t.targets().length," \u500B\u7528\u6236\u62C9\u5165\u7FA4\u7D44"),c(9),I("border-emerald-500",t.groupSource()==="existing")("bg-emerald-500/20",t.groupSource()==="existing")("text-emerald-400",t.groupSource()==="existing")("border-slate-600",t.groupSource()!=="existing")("bg-slate-800/50",t.groupSource()!=="existing")("text-slate-400",t.groupSource()!=="existing"),c(2),I("border-cyan-500",t.groupSource()==="create")("bg-cyan-500/20",t.groupSource()==="create")("text-cyan-400",t.groupSource()==="create")("border-slate-600",t.groupSource()!=="create")("bg-slate-800/50",t.groupSource()!=="create")("text-slate-400",t.groupSource()!=="create"),c(2),w(t.groupSource()==="existing"?24:-1),c(),w(t.groupSource()==="create"?25:-1),c(8),z("ngModel",t.batchSize),c(6),z("ngModel",t.minInterval),c(3),z("ngModel",t.maxInterval),c(7),I("bg-slate-600",t.welcomeMessageSource()==="none")("text-white",t.welcomeMessageSource()==="none")("bg-slate-700",t.welcomeMessageSource()!=="none")("text-slate-400",t.welcomeMessageSource()!=="none"),c(2),I("bg-blue-500",t.welcomeMessageSource()==="template")("text-white",t.welcomeMessageSource()==="template")("bg-slate-700",t.welcomeMessageSource()!=="template")("text-slate-400",t.welcomeMessageSource()!=="template"),c(2),I("bg-purple-500",t.welcomeMessageSource()==="ai")("text-white",t.welcomeMessageSource()==="ai")("bg-slate-700",t.welcomeMessageSource()!=="ai")("text-slate-400",t.welcomeMessageSource()!=="ai"),c(2),w(t.welcomeMessageSource()==="template"?55:-1),c(),w(t.welcomeMessageSource()==="ai"?56:-1),c(),w(t.welcomeMessageSource()!=="none"?57:-1),c(),w(t.selectedGroup()?58:-1),c(3),D(" \u{1F465} \u76EE\u6A19\u7528\u6236\uFF08",t.targets().length," \u4EBA\uFF09 "),c(3),H(t.targets().slice(0,20)),c(2),w(t.targets().length>20?66:-1),c(),w(t.isInviting()?67:-1),c(),w(t.onlineAccountsCount()===0?68:69),c(2),w(t.canInvite()?70:-1),c(2),V("disabled",t.isInviting()||t.isCreatingGroup()),c(),D(" ",t.isInviting()||t.isCreatingGroup()?"\u23F3 \u9032\u884C\u4E2D":"\u53D6\u6D88"," "),c(),V("disabled",!t.canInvite()||t.isInviting()||t.isCreatingGroup()),c(),w(t.isCreatingGroup()?75:t.isInviting()?76:t.groupSource()==="create"?77:78)}}var Bo=class i{constructor(){this.ipc=O(ye);this.toast=O(ue);this.isOpen=at(!1);this.targets=at([]);this.accounts=at([]);this.closeDialog=Me();this.inviteComplete=Me();this._currentInviteId=_(null);this.groupSource=_("existing");this.availableGroups=_([]);this.isLoadingGroups=_(!1);this.selectedGroup=_(null);this.groupNameMode=_("manual");this.newGroupName="";this.newGroupType="supergroup";this.newGroupDescription="";this.aiGroupKeywords="";this.selectedGroupNameStyle=_("professional");this.isGeneratingNames=_(!1);this.generatedGroupNames=_([]);this.groupNameStyles=[{key:"professional",label:"\u5C08\u696D\u6B63\u5F0F"},{key:"lively",label:"\u6D3B\u6F51\u6709\u8DA3"},{key:"mysterious",label:"\u795E\u79D8\u9AD8\u7AEF"},{key:"simple",label:"\u7C21\u7D04\u660E\u4E86"}];this.welcomeMessageSource=_("none");this.welcomeTemplates=_([]);this.isLoadingTemplates=_(!1);this.selectedWelcomeTemplate=_(null);this.welcomeMessageContent="";this.aiWelcomeTopic="";this.isGeneratingWelcome=_(!1);this.generatedWelcomeMessage=_("");this.batchSize=10;this.minInterval=60;this.maxInterval=120;this.isInviting=_(!1);this.invitedCount=_(0);this.successCount=_(0);this.failedCount=_(0);this.skippedCount=_(0);this.isCreatingGroup=_(!1);this.createdGroupId=_(null);this.createGroupProgressMessage=_("");this.listeners=[];this.progressPercent=G(()=>{let e=this.targets().length;return e>0?this.invitedCount()/e*100:0});this.estimatedRemaining=G(()=>{let e=this.targets().length-this.invitedCount(),t=(this.minInterval+this.maxInterval)/2,o=Math.ceil(e/this.batchSize)*t;return o<60?`${Math.round(o)} \u79D2`:o<3600?`${Math.round(o/60)} \u5206\u9418`:`${Math.round(o/3600)} \u5C0F\u6642`});this.permissionCheck=G(()=>{let e=this.targets().length;return{canInvite:Math.floor(e*.8),alreadyInGroup:Math.floor(e*.1),privacyRestricted:Math.floor(e*.1)}});this.onlineAccountsCount=G(()=>this.accounts().filter(e=>e.status==="Online").length);this.preferredAccount=G(()=>{let e=this.accounts().filter(n=>n.status==="Online");return e.find(n=>n.role==="Sender")||e[0]||null});this.createGroupTimeout=null}ngOnInit(){this.setupIpcListeners(),this.loadAvailableGroups(),this.loadWelcomeTemplates()}ngOnDestroy(){this.listeners.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("batch-invite:progress",h=>{this.invitedCount.set(h.invited),this.successCount.set(h.success),this.failedCount.set(h.failed),this.skippedCount.set(h.skipped)});this.listeners.push(e);let t=this.ipc.on("batch-invite:complete",h=>{let C=this._currentInviteId();if(h.inviteId&&C&&h.inviteId!==C){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08inviteId \u4E0D\u5339\u914D\uFF09:",h.inviteId,"!=",C);return}if(!this.isOpen()&&!this.isInviting()&&!C){console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08\u5C0D\u8A71\u6846\u672A\u6253\u958B\u4E14\u7121\u6D3B\u8E8D\u9080\u8ACB\uFF09");return}this._currentInviteId.set(null),this.isInviting.set(!1),this.isCreatingGroup.set(!1),this.inviteComplete.emit({success:h.success,failed:h.failed,skipped:h.skipped}),h.success>0?this.toast.success(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u2705 \u6210\u529F/\u5DF2\u767C\u9001\u9080\u8ACB ${h.success} \u4EBA\uFF0C\u26A0\uFE0F \u8DF3\u904E ${h.skipped}\uFF0C\u274C \u5931\u6557 ${h.failed}`):h.skipped>0?this.toast.warning("\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6240\u6709\u7528\u6236\u5DF2\u5728\u7FA4\u5167\u6216\u96B1\u79C1\u9650\u5236"):this.toast.error("\u6279\u91CF\u62C9\u7FA4\u5931\u6557\uFF1A\u7121\u6CD5\u9080\u8ACB\u4EFB\u4F55\u7528\u6236\uFF0C\u8ACB\u6AA2\u67E5\u5E33\u865F\u72C0\u614B")});this.listeners.push(t);let n=this.ipc.on("get-admin-groups-result",h=>{this.isLoadingGroups.set(!1),h.groups&&this.availableGroups.set(h.groups)});this.listeners.push(n);let o=this.ipc.on("get-chat-templates-result",h=>{this.isLoadingTemplates.set(!1),h.templates&&this.welcomeTemplates.set(h.templates.filter(C=>C.isEnabled))});this.listeners.push(o);let a=this.ipc.on("ai-generate-group-names-result",h=>{this.isGeneratingNames.set(!1),h.success&&h.names?(this.generatedGroupNames.set(h.names),this.toast.success("\u7FA4\u540D\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(h.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(a);let d=this.ipc.on("ai-generate-welcome-result",h=>{this.isGeneratingWelcome.set(!1),h.success&&h.message?(this.generatedWelcomeMessage.set(h.message),this.welcomeMessageContent=h.message,this.toast.success("\u6B61\u8FCE\u6D88\u606F\u751F\u6210\u6210\u529F\uFF01")):this.toast.error(h.error||"AI \u751F\u6210\u5931\u6557")});this.listeners.push(d);let m=this.ipc.on("create-group-progress",h=>{console.log("[BatchInvite] \u5275\u5EFA\u9032\u5EA6:",h),this.createGroupProgressMessage.set(h.message)});this.listeners.push(m);let f=this.ipc.on("create-group-result",h=>{if(console.log("[BatchInvite] \u6536\u5230\u5275\u5EFA\u7FA4\u7D44\u7D50\u679C:",h),this.createGroupTimeout&&(clearTimeout(this.createGroupTimeout),this.createGroupTimeout=null),this.isCreatingGroup.set(!1),h.success&&h.groupId)this.createdGroupId.set(h.groupId),this.toast.success(`\u7FA4\u7D44\u300C${this.newGroupName}\u300D\u5275\u5EFA\u6210\u529F\uFF01`),this.startInvitingToGroup(h.groupId,h.groupUrl||"");else{let C=h.error||"\u5275\u5EFA\u7FA4\u7D44\u5931\u6557";C.includes("FLOOD")?this.toast.error("\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"):C.includes("not connected")||C.includes("Offline")?this.toast.error("\u5E33\u865F\u672A\u9023\u63A5\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"):C.includes("PEER_FLOOD")?this.toast.error("\u5E33\u865F\u88AB\u9650\u5236\uFF0C\u8ACB\u66F4\u63DB\u5E33\u865F\u6216\u7A0D\u5F8C\u518D\u8A66"):this.toast.error(C)}});this.listeners.push(f)}setGroupSource(e){this.groupSource.set(e),e==="existing"&&this.loadAvailableGroups()}loadAvailableGroups(){this.isLoadingGroups.set(!0),this.ipc.send("get-admin-groups",{})}loadWelcomeTemplates(){this.isLoadingTemplates.set(!0),this.ipc.send("get-chat-templates",{})}selectGroup(e){this.selectedGroup.set(e)}selectGeneratedName(e){this.newGroupName=e}generateGroupNames(){if(!this.aiGroupKeywords.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u4E3B\u984C\u95DC\u9375\u8A5E");return}this.isGeneratingNames.set(!0),this.generatedGroupNames.set([]),this.ipc.send("ai-generate-group-names",{keywords:this.aiGroupKeywords,style:this.selectedGroupNameStyle(),count:5})}selectWelcomeTemplate(e){this.selectedWelcomeTemplate.set(e),this.welcomeMessageContent=e.content}generateWelcomeMessage(){if(!this.aiWelcomeTopic.trim()){this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");return}this.isGeneratingWelcome.set(!0),this.generatedWelcomeMessage.set(""),this.ipc.send("ai-generate-welcome",{topic:this.aiWelcomeTopic,groupName:this.newGroupName||this.selectedGroup()?.name||""})}canInvite(){return this.groupSource()==="existing"?this.selectedGroup()!==null&&this.targets().length>0:this.newGroupName.trim().length>0&&this.targets().length>0}startInviting(){this.canInvite()&&(this.groupSource()==="create"?this.createGroupAndInvite():this.startInvitingToGroup(this.selectedGroup().id,this.selectedGroup().url))}async createGroupAndInvite(){let e=await this.checkOnlineAccounts();if(e.length===0){this.toast.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.isCreatingGroup.set(!0),this.createGroupProgressMessage.set("\u6B63\u5728\u6E96\u5099\u5275\u5EFA\u7FA4\u7D44..."),this.createGroupTimeout&&clearTimeout(this.createGroupTimeout),this.createGroupTimeout=setTimeout(()=>{this.isCreatingGroup()&&(this.isCreatingGroup.set(!1),this.toast.error("\u5275\u5EFA\u7FA4\u7D44\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u6216\u5E33\u865F\u72C0\u614B\uFF0C\u6216\u5617\u8A66\u5275\u5EFA\u666E\u901A\u7FA4\u7D44"))},6e4),console.log("[BatchInvite] \u958B\u59CB\u5275\u5EFA\u7FA4\u7D44:",{name:this.newGroupName,type:this.newGroupType,account:e[0]?.phone}),this.ipc.send("create-group",{name:this.newGroupName,description:this.newGroupDescription,type:this.newGroupType,accountPhone:e[0]?.phone}),this.toast.info(`\u6B63\u5728\u4F7F\u7528\u5E33\u865F ${e[0]?.firstName||e[0]?.phone} \u5275\u5EFA\u7FA4\u7D44...`)}async checkOnlineAccounts(){let e=this.accounts(),t=e.filter(n=>n.status==="Online");return console.log("[BatchInvite] \u6AA2\u67E5\u5E33\u865F: \u7E3D\u6578",e.length,", \u5728\u7DDA",t.length),t.length===0&&this.toast.warning("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F"),t}startInvitingToGroup(e,t){let n=`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this._currentInviteId.set(n),this.isInviting.set(!0),this.invitedCount.set(0),this.successCount.set(0),this.failedCount.set(0),this.skippedCount.set(0),this.ipc.send("batch-invite:start",{inviteId:n,groupId:e,groupUrl:t,targets:this.targets().map(o=>({telegramId:o.telegramId,username:o.username,firstName:o.firstName,displayName:o.displayName})),config:{batchSize:this.batchSize,minInterval:this.minInterval,maxInterval:this.maxInterval,sendWelcomeMessage:this.welcomeMessageSource()!=="none",welcomeMessage:this.welcomeMessageContent}}),this.toast.info("\u958B\u59CB\u6279\u91CF\u62C9\u7FA4..."),console.log("[BatchInvite] \u958B\u59CB\u9080\u8ACB\uFF0CinviteId:",n)}close(){if(this.isInviting()){if(!confirm("\u62C9\u7FA4\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F"))return;this.ipc.send("batch-invite:cancel",{})}this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&!this.isInviting()&&this.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-batch-invite-dialog"]],inputs:{isOpen:[1,"isOpen"],targets:[1,"targets"],accounts:[1,"accounts"]},outputs:{closeDialog:"closeDialog",inviteComplete:"inviteComplete"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","pb-8","space-y-5"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"flex","gap-2"],[1,"flex-1","py-3","rounded-xl","border","transition-all","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30","space-y-4"],[1,"p-4","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"space-y-4"],[1,"text-sm","text-slate-400","w-24"],["type","number","min","1","max","50",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],["type","number","min","30","max","300",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"text-slate-400"],["type","number","min","30","max","600",1,"w-20","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-center","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"flex","gap-2","mb-3"],[1,"flex-1","py-2","rounded-lg","text-sm","transition-all",3,"click"],[1,"space-y-2"],[1,"space-y-3"],[1,"mt-3"],[1,"p-4","rounded-xl",3,"bg-emerald-500/10","border","border-emerald-500/30","bg-amber-500/10","border-amber-500/30"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"max-h-32","overflow-y-auto","p-3","bg-slate-800/30","rounded-xl","border","border-slate-700/50"],[1,"flex","flex-wrap","gap-2"],[1,"px-2","py-1","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-1","text-slate-400","text-xs"],[1,"p-4","bg-slate-800/50","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-red-500/10","border-t","border-red-500/30"],[1,"px-5","py-2","bg-slate-800/30","border-t","border-slate-700/50"],[1,"px-5","py-3","bg-slate-800/50","border-t","border-slate-700/50"],[1,"sticky","bottom-0","left-0","right-0","p-4","border-t","border-slate-700/50","bg-slate-900","flex","gap-3","z-10","shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"],[1,"px-4","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","text-white","font-bold","rounded-xl","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-base","shadow-lg","shadow-emerald-500/20",3,"click","disabled"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2","max-h-48","overflow-y-auto","pr-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-6","w-6","text-cyan-400"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"ml-2","text-slate-400"],[1,"text-lg","mb-2"],[1,"text-sm"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"border-emerald-500","bg-emerald-500/10","border-slate-600","bg-slate-800/50","hover:border-slate-500"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","border","transition-all","text-left",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","flex","items-center","justify-center","text-lg"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white","truncate"],[1,"px-1.5","py-0.5","bg-emerald-500/20","text-emerald-400","text-xs","rounded"],[1,"px-1.5","py-0.5","bg-slate-600","text-slate-400","text-xs","rounded"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"truncate"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-emerald-400","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"block","text-sm","font-medium","text-cyan-300"],[1,"text-xs","text-slate-400","mb-2","block"],[1,"flex","gap-3"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","radio","name","groupType","value","group",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300"],["type","radio","name","groupType","value","supergroup",1,"w-4","h-4","text-cyan-500","border-slate-600","focus:ring-cyan-500",3,"ngModelChange","ngModel"],["rows","2","placeholder","\u7C21\u77ED\u4ECB\u7D39\u7FA4\u7D44\u76EE\u7684...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-cyan-500","text-sm",3,"ngModelChange","ngModel"],["type","text","placeholder","\u8F38\u5165\u7FA4\u7D44\u540D\u7A31...","maxlength","128",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500","mt-1","block"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u5E63\u5708\u3001\u4EA4\u6D41\u3001VIP...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"bg-purple-500","text-white","bg-slate-700","text-slate-400"],[1,"w-full","py-2","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-lg","hover:opacity-90","transition-opacity","disabled:opacity-50","flex","items-center","justify-center","gap-2","text-sm",3,"click","disabled"],[1,"px-3","py-1","text-xs","rounded-lg","transition-all",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"text-xs","text-slate-400"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-purple-500","bg-purple-500/10","border-slate-600","bg-slate-800/50"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"click"],[1,"flex","items-center","justify-center","py-4"],[1,"text-sm","text-slate-500","text-center","py-4"],[1,"max-h-32","overflow-y-auto","space-y-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-400"],[1,"ml-2","text-slate-400","text-sm"],[1,"w-full","p-2","rounded-lg","border","transition-all","text-left","text-sm",3,"border-blue-500","bg-blue-500/10","border-slate-600","bg-slate-800/50"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400","truncate","mt-1"],["type","text","placeholder","\u6B61\u8FCE\u6D88\u606F\u4E3B\u984C\uFF0C\u4F8B\u5982\uFF1A\u6B61\u8FCE\u52A0\u5165\u3001\u793E\u7FA4\u4ECB\u7D39...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","text-sm","placeholder-slate-500","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"p-3","bg-slate-800/50","rounded-lg","border","border-purple-500/30"],[1,"text-sm","text-white"],["rows","2","placeholder","\u8F38\u5165\u6B61\u8FCE\u6D88\u606F\u5167\u5BB9...",1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-600","rounded-lg","text-white","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-emerald-500","text-sm",3,"ngModelChange","ngModel"],[1,"p-4","rounded-xl"],[1,"text-sm","font-medium","text-slate-300","mb-2"],[1,"flex","items-center","gap-6","text-sm"],[1,"text-emerald-400"],[1,"text-amber-400"],[1,"text-red-400"],[1,"flex","items-center","justify-between","mb-2"],[1,"w-full","h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","transition-all","duration-300"],[1,"mt-2","flex","items-center","gap-4","text-xs","text-slate-400"],[1,"text-green-400"],[1,"mt-1","text-xs","text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-red-400"],[1,"flex","items-center","gap-2","text-xs","text-slate-400"],[1,"text-slate-500"],[1,"flex","items-center","gap-2","text-sm","text-slate-400"],[1,"animate-spin"]],template:function(t,n){t&1&&S(0,Nx,79,67,"div",0),t&2&&w(n.isOpen()?0:-1)},dependencies:[te,me,xe,jn,on,_e,Pt,ti,ei,Ce,tn],encapsulation:2})}};var Md=(i,e)=>e.value;function Rx(i,e){if(i&1&&(r(0,"p",30),l(1),ke(2,"number"),s(),r(3,"p",31),l(4,"\u6210\u54E1\u6578"),s()),i&2){let t=g(3);c(),A(Ne(2,1,t.group().memberCount))}}function Ox(i,e){i&1&&(r(0,"p",32),l(1,"?"),s(),r(2,"p",33),l(3,"\u7121\u6578\u64DA"),s())}function Bx(i,e){i&1&&(r(0,"span",41),l(1,"\u23F3"),s(),r(2,"span"),l(3,"\u7372\u53D6\u4E2D..."),s())}function Vx(i,e){i&1&&(r(0,"span"),l(1,"\u{1F504}"),s(),r(2,"span"),l(3,"\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578"),s())}function Lx(i,e){if(i&1){let t=M();r(0,"div",27)(1,"div",34)(2,"span",35),l(3,"\u26A0\uFE0F"),s(),r(4,"div",24)(5,"p",36),l(6,"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\u64DA"),s(),r(7,"p",37),l(8,"\u53EF\u80FD\u539F\u56E0\uFF1A"),s(),r(9,"ul",38)(10,"li"),l(11,"\u5C1A\u672A\u52A0\u5165\u8A72\u7FA4\u7D44"),s(),r(12,"li"),l(13,"\u7FA4\u7D44\u5DF2\u8B8A\u70BA\u79C1\u6709"),s(),r(14,"li"),l(15,"\u983B\u9053\u985E\u578B\u4E0D\u652F\u6301\u63D0\u53D6\u6210\u54E1"),s(),r(16,"li"),l(17,"\u5E33\u865F\u88AB\u8E22\u51FA\u7FA4\u7D44"),s()(),r(18,"div",39)(19,"button",40),x("click",function(){v(t);let o=g(3);return b(o.refreshMemberCount())}),S(20,Bx,4,0)(21,Vx,4,0),s()()()()()}if(i&2){let t=g(3);c(19),V("disabled",t.isRefreshingCount()),c(),w(t.isRefreshingCount()?20:21)}}function Gx(i,e){i&1&&(r(0,"div",28)(1,"div",34)(2,"span",35),l(3,"\u{1F6AB}"),s(),r(4,"div",24)(5,"p",42),l(6,"\u983B\u9053\u4E0D\u652F\u6301\u6210\u54E1\u63D0\u53D6"),s(),r(7,"p",8),l(8," Telegram \u983B\u9053\uFF08Channel\uFF09\u6C92\u6709\u6210\u54E1\u5217\u8868\uFF0C\u53EA\u6709\u8A02\u95B1\u8005\u3002 \u5982\u9700\u7372\u53D6\u8A02\u95B1\u8005\u4FE1\u606F\uFF0C\u8ACB\u4F7F\u7528\u983B\u9053\u5206\u6790\u529F\u80FD\u3002 "),s()()()())}function Ux(i,e){if(i&1){let t=M();r(0,"div",48)(1,"p",49),l(2,"\u{1F4CB} \u66FF\u4EE3\u65B9\u6848\uFF1A"),s(),r(3,"ul",50)(4,"li",51)(5,"span",52),l(6,"1."),s(),r(7,"span"),l(8,"\u78BA\u4FDD\u7FA4\u7D44\u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u767C\u8A00\u7528\u6236"),s()(),r(9,"li",51)(10,"span",52),l(11,"2."),s(),r(12,"span"),l(13,"\u5728\u300C\u5DF2\u6536\u96C6\u7528\u6236\u300D\u6A19\u7C64\u9801\u67E5\u770B\u76E3\u63A7\u671F\u9593\u6536\u96C6\u7684\u7528\u6236"),s()(),r(14,"li",51)(15,"span",52),l(16,"3."),s(),r(17,"span"),l(18,"\u6216\u806F\u7E6B\u7FA4\u4E3B\u7372\u53D6\u7BA1\u7406\u54E1\u6B0A\u9650"),s()()()(),r(19,"div",53)(20,"button",54),x("click",function(){v(t);let o=g(4);return b(o.checkMonitoringStatus())}),r(21,"span"),l(22,"\u{1F4E1}"),s(),r(23,"span"),l(24,"\u78BA\u8A8D\u76E3\u63A7\u72C0\u614B"),s()(),r(25,"button",55),x("click",function(){v(t);let o=g(4);return b(o.collectFromHistory())}),r(26,"span"),l(27,"\u{1F504}"),s(),r(28,"span"),l(29,"\u5F9E\u6B77\u53F2\u6536\u96C6"),s()(),r(30,"button",56),x("click",function(){v(t);let o=g(4);return b(o.viewCollectedUsers())}),r(31,"span"),l(32,"\u{1F465}"),s(),r(33,"span"),l(34),s()()()}if(i&2){let t=g(4);c(34),D("\u67E5\u770B\u5DF2\u6536\u96C6 (",t.collectedUsersCount(),")")}}function qx(i,e){if(i&1&&(r(0,"div",46)(1,"p",57)(2,"span"),l(3,"\u{1F4A1}"),s(),r(4,"span"),l(5),s()()()),i&2){let t=g(4);c(5),A(t.extractionError().suggestion)}}function $x(i,e){if(i&1){let t=M();r(0,"button",58),x("click",function(){v(t);let o=g(4);return b(o.joinGroup())}),r(1,"span"),l(2,"\u2795"),s(),r(3,"span"),l(4,"\u52A0\u5165\u7FA4\u7D44"),s()()}}function Hx(i,e){if(i&1&&(r(0,"div",43)(1,"div",34)(2,"span",35),l(3),s(),r(4,"div",24)(5,"p",44),l(6),s(),r(7,"p",45),l(8),s(),S(9,Ux,35,1)(10,qx,6,1,"div",46),S(11,$x,5,0,"button",47),s()()()),i&2){let t=g(3);I("bg-red-500/10",t.extractionError().code==="ADMIN_REQUIRED")("border-red-500/30",t.extractionError().code==="ADMIN_REQUIRED")("bg-amber-500/10",t.extractionError().code!=="ADMIN_REQUIRED")("border-amber-500/30",t.extractionError().code!=="ADMIN_REQUIRED"),c(3),A(t.extractionError().code==="ADMIN_REQUIRED"?"\u{1F512}":"\u26A0\uFE0F"),c(2),I("text-red-400",t.extractionError().code==="ADMIN_REQUIRED")("text-amber-400",t.extractionError().code!=="ADMIN_REQUIRED"),c(),D(" ",t.extractionError().title," "),c(2),A(t.extractionError().reason),c(),w(t.extractionError().code==="ADMIN_REQUIRED"?9:10),c(2),w(t.extractionError().canAutoJoin?11:-1)}}function zx(i,e){if(i&1&&(r(0,"div",22)(1,"div",5)(2,"div",23),l(3),s(),r(4,"div",24)(5,"h3",25),l(6),s(),r(7,"p",8),l(8),s()(),r(9,"div",26),S(10,Rx,5,3)(11,Ox,4,0),s()()(),S(12,Lx,22,2,"div",27),S(13,Gx,9,0,"div",28),S(14,Hx,12,17,"div",29)),i&2){let t=g(2);c(3),D(" ",t.group().name[0]," "),c(3),A(t.group().name),c(2),A(t.group().url||"\u79C1\u5BC6\u7FA4\u7D44"),c(2),w(t.group().memberCount>0?10:11),c(2),w(t.group().memberCount===0?12:-1),c(),w(t.isChannel()?13:-1),c(),w(t.extractionError()?14:-1)}}function Kx(i,e){i&1&&(r(0,"span",79),l(1,"\u{1F512}"),s())}function Wx(i,e){if(i&1){let t=M();r(0,"button",78),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.setLimit(o.value))}),l(1),S(2,Kx,2,0,"span",79),s()}if(i&2){let t=e.$implicit,n=g(3);I("border-emerald-500",n.config().limit===t.value)("bg-emerald-500/20",n.config().limit===t.value)("text-emerald-400",n.config().limit===t.value)("border-slate-700",n.config().limit!==t.value)("bg-slate-800/50",n.config().limit!==t.value)("text-slate-400",n.config().limit!==t.value),V("disabled",t.value>n.maxLimit()),c(),D(" ",t.label," "),c(),w(t.value>n.maxLimit()?2:-1)}}function Jx(i,e){if(i&1){let t=M();r(0,"button",80),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.setOnlineStatus(o.value))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(3);I("border-cyan-500",n.config().filters.onlineStatus===t.value)("bg-cyan-500/20",n.config().filters.onlineStatus===t.value)("text-cyan-400",n.config().filters.onlineStatus===t.value)("border-slate-700",n.config().filters.onlineStatus!==t.value)("bg-slate-800/50",n.config().filters.onlineStatus!==t.value)("text-slate-400",n.config().filters.onlineStatus!==t.value),c(),Y(" ",t.icon," ",t.label," ")}}function Qx(i,e){if(i&1){let t=M();r(0,"div",77)(1,"div")(2,"label",81),l(3,"\u23F0 \u6D3B\u8E8D\u5EA6\u7BE9\u9078"),s(),r(4,"div",82)(5,"span",83),l(6,"\u6700\u8FD1"),s(),r(7,"select",84),x("change",function(o){v(t);let a=g(3);return b(a.setActivityDays(o))}),r(8,"option",85),l(9,"\u4E0D\u9650"),s(),r(10,"option",86),l(11,"3 \u5929"),s(),r(12,"option",87),l(13,"7 \u5929"),s(),r(14,"option",88),l(15,"14 \u5929"),s(),r(16,"option",89),l(17,"30 \u5929"),s()(),r(18,"span",83),l(19,"\u5167\u6D3B\u52D5"),s()()(),r(20,"div",68)(21,"label",90)(22,"input",70),x("change",function(){v(t);let o=g(3);return b(o.toggleAdvanced("autoSaveToResources"))}),s(),r(23,"div")(24,"p",71),l(25,"\u81EA\u52D5\u4FDD\u5B58"),s(),r(26,"p",31),l(27,"\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3"),s()()(),r(28,"label",90)(29,"input",70),x("change",function(){v(t);let o=g(3);return b(o.toggleAdvanced("skipDuplicates"))}),s(),r(30,"div")(31,"p",71),l(32,"\u8DF3\u904E\u91CD\u8907"),s(),r(33,"p",31),l(34,"\u5DF2\u5B58\u5728\u7684\u6210\u54E1"),s()()(),r(35,"label",90)(36,"input",70),x("change",function(){v(t);let o=g(3);return b(o.toggleFilter("excludeAdmins"))}),s(),r(37,"div")(38,"p",71),l(39,"\u6392\u9664\u7BA1\u7406\u54E1"),s(),r(40,"p",31),l(41,"\u7FA4\u4E3B\u548C\u7BA1\u7406\u54E1"),s()()(),r(42,"label",90)(43,"input",70),x("change",function(){v(t);let o=g(3);return b(o.toggleAdvanced("shuffleOrder"))}),s(),r(44,"div")(45,"p",71),l(46,"\u96A8\u6A5F\u9806\u5E8F"),s(),r(47,"p",31),l(48,"\u6253\u4E82\u63D0\u53D6\u9806\u5E8F"),s()()()()()}if(i&2){let t=g(3);c(7),V("value",t.config().filters.minActivityDays||""),c(15),V("checked",t.config().advanced.autoSaveToResources),c(7),V("checked",t.config().advanced.skipDuplicates),c(7),V("checked",t.config().filters.excludeAdmins),c(7),V("checked",t.config().advanced.shuffleOrder)}}function Yx(i,e){if(i&1){let t=M();r(0,"div")(1,"label",59),l(2," \u26A1 \u5FEB\u901F\u6A21\u677F "),s(),r(3,"div",60)(4,"button",61),x("click",function(){v(t);let o=g(2);return b(o.selectTemplate("quick"))}),r(5,"div",62),l(6,"\u26A1"),s(),r(7,"p",63),l(8,"\u5FEB\u901F\u63D0\u53D6"),s(),r(9,"p",64),l(10,"100\u4EBA \xB7 \u50C5\u5728\u7DDA"),s()(),r(11,"button",61),x("click",function(){v(t);let o=g(2);return b(o.selectTemplate("deep"))}),r(12,"div",62),l(13,"\u{1F50D}"),s(),r(14,"p",63),l(15,"\u6DF1\u5EA6\u63D0\u53D6"),s(),r(16,"p",64),l(17,"500\u4EBA \xB7 \u5168\u72C0\u614B"),s()(),r(18,"button",61),x("click",function(){v(t);let o=g(2);return b(o.selectTemplate("precise"))}),r(19,"div",62),l(20,"\u{1F3AF}"),s(),r(21,"p",63),l(22,"\u7CBE\u6E96\u63D0\u53D6"),s(),r(23,"p",64),l(24,"\u81EA\u5B9A\u7FA9\u689D\u4EF6"),s()()()(),r(25,"div")(26,"label",59),l(27," \u{1F522} \u63D0\u53D6\u6578\u91CF "),s(),r(28,"div",53),$(29,Wx,3,15,"button",65,Md),s()(),r(31,"div")(32,"label",59),l(33," \u{1F4CD} \u5728\u7DDA\u72C0\u614B "),s(),r(34,"div",66),$(35,Jx,2,14,"button",67,Md),s()(),r(37,"div")(38,"label",59),l(39," \u{1F3F7}\uFE0F \u6210\u54E1\u5C6C\u6027 "),s(),r(40,"div",68)(41,"label",69)(42,"input",70),x("change",function(){v(t);let o=g(2);return b(o.toggleFilter("excludeBots"))}),s(),r(43,"div")(44,"p",71),l(45,"\u6392\u9664\u6A5F\u5668\u4EBA"),s(),r(46,"p",31),l(47,"\u904E\u6FFE Bot \u5E33\u865F"),s()()(),r(48,"label",69)(49,"input",70),x("change",function(){v(t);let o=g(2);return b(o.toggleFilter("hasUsername"))}),s(),r(50,"div")(51,"p",71),l(52,"\u9700\u6709\u7528\u6236\u540D"),s(),r(53,"p",31),l(54,"\u50C5\u63D0\u53D6\u6709 @username"),s()()(),r(55,"label",69)(56,"input",70),x("change",function(){v(t);let o=g(2);return b(o.toggleFilter("hasChinese"))}),s(),r(57,"div")(58,"p",71),l(59,"\u50C5\u83EF\u4EBA\u7528\u6236"),s(),r(60,"p",31),l(61,"\u4E2D\u6587\u540D\u7A31\u512A\u5148"),s()()(),r(62,"label",69)(63,"input",70),x("change",function(){v(t);let o=g(2);return b(o.toggleFilter("isPremium"))}),s(),r(64,"div")(65,"p",71),l(66,"Premium \u7528\u6236"),s(),r(67,"p",31),l(68,"\u50C5\u4ED8\u8CBB\u6703\u54E1 \u2B50"),s()()()()(),r(69,"div",72)(70,"button",73),x("click",function(){v(t);let o=g(2);return b(o.showAdvanced.set(!o.showAdvanced()))}),r(71,"span",74),l(72,"\u2699\uFE0F \u9AD8\u7D1A\u9078\u9805"),s(),ne(),r(73,"svg",75),k(74,"path",76),s()(),S(75,Qx,49,5,"div",77),s()}if(i&2){let t=g(2);c(4),I("border-emerald-500",t.selectedTemplate()==="quick")("bg-emerald-500/20",t.selectedTemplate()==="quick")("border-slate-700",t.selectedTemplate()!=="quick")("bg-slate-800/50",t.selectedTemplate()!=="quick"),c(7),I("border-blue-500",t.selectedTemplate()==="deep")("bg-blue-500/20",t.selectedTemplate()==="deep")("border-slate-700",t.selectedTemplate()!=="deep")("bg-slate-800/50",t.selectedTemplate()!=="deep"),c(7),I("border-purple-500",t.selectedTemplate()==="precise")("bg-purple-500/20",t.selectedTemplate()==="precise")("border-slate-700",t.selectedTemplate()!=="precise")("bg-slate-800/50",t.selectedTemplate()!=="precise"),c(11),H(t.limitOptions),c(6),H(t.onlineStatusOptions),c(7),V("checked",t.config().filters.excludeBots),c(7),V("checked",t.config().filters.hasUsername===!0),c(7),V("checked",t.config().filters.hasChinese===!0),c(7),V("checked",t.config().filters.isPremium===!0),c(10),I("rotate-180",t.showAdvanced()),c(2),w(t.showAdvanced()?75:-1)}}function Xx(i,e){if(i&1){let t=M();r(0,"div",1),x("click",function(o){v(t);let a=g();return b(a.onBackdropClick(o))}),r(1,"div",2),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),l(6," \u{1F465} "),s(),r(7,"div")(8,"h2",7),l(9,"\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1"),s(),r(10,"p",8),l(11,"\u914D\u7F6E\u63D0\u53D6\u9078\u9805\u548C\u7BE9\u9078\u689D\u4EF6"),s()()(),r(12,"button",9),x("click",function(){v(t);let o=g();return b(o.close())}),ne(),r(13,"svg",10),k(14,"path",11),s()()()(),ge(),r(15,"div",12),S(16,zx,15,7),S(17,Yx,76,31),s(),r(18,"div",13)(19,"div",14)(20,"div",15)(21,"span",16),l(22," \u{1F4A1} \u9810\u8A08\u63D0\u53D6\uFF1A "),r(23,"span",17),l(24),s(),l(25," \u4EBA "),s()(),r(26,"div",16),l(27," \u{1F4CA} \u4ECA\u65E5\u914D\u984D\uFF1A "),r(28,"span",18),l(29),s(),l(30),s()(),r(31,"div",19)(32,"button",20),x("click",function(){v(t);let o=g();return b(o.close())}),l(33," \u53D6\u6D88 "),s(),r(34,"button",21),x("click",function(){v(t);let o=g();return b(o.startExtraction())}),r(35,"span"),l(36,"\u{1F465}"),s(),r(37,"span"),l(38),s()()()()()()}if(i&2){let t=g();c(16),w(t.group()?16:-1),c(),w(t.isChannel()?-1:17),c(7),A(t.estimatedCount()),c(5),A(t.remainingQuota()),c(),D(" / ",t.dailyQuota()," "),c(4),V("disabled",!t.canStart()),c(4),D("\u958B\u59CB\u63D0\u53D6 (",t.config().limit," \u4EBA)")}}var Vo=class i{constructor(){this.isOpen=at(!1);this.group=at(null);this.closeDialog=Me();this.startExtractionEvent=Me();this.memberCountRefreshed=Me();this.enableMonitoringEvent=Me();this.joinGroupEvent=Me();this.viewCollectedUsersEvent=Me();this.ipcService=O(ye);this.toast=O(ue);this.showAdvanced=_(!1);this.selectedTemplate=_("quick");this.isRefreshingCount=_(!1);this.extractionError=_(null);this.collectedUsersCount=_(0);this.isMonitoring=_(!1);this.config=_({limit:100,filters:{onlineStatus:"all",hasChinese:null,hasUsername:null,isPremium:null,excludeBots:!0,excludeAdmins:!1,minActivityDays:null},advanced:{shuffleOrder:!1,skipDuplicates:!0,autoSaveToResources:!0,extractAvatar:!1}});this.limitOptions=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:-1,label:"\u5168\u90E8"}];this.onlineStatusOptions=[{value:"all",label:"\u5168\u90E8",icon:"\u{1F4CA}"},{value:"online",label:"\u5728\u7DDA",icon:"\u{1F7E2}"},{value:"recently",label:"\u6700\u8FD1",icon:"\u{1F7E1}"},{value:"offline",label:"\u96E2\u7DDA",icon:"\u26AB"}];this.maxLimit=G(()=>{let e=this.group()?.memberCount||0;return Math.min(e,1e4)});this.dailyQuota=_(1e3);this.remainingQuota=_(800);this.estimatedCount=G(()=>{let e=this.config().limit,t=this.group()?.memberCount||0;return e===-1?Math.min(t,this.remainingQuota()):Math.min(e,t,this.remainingQuota())});this.isChannel=G(()=>this.group()?.resourceType==="channel");this.canStart=G(()=>!this.group()||this.isChannel()?!1:this.estimatedCount()>0);this.listeners=[]}ngOnInit(){this.loadQuota(),this.listenForExtractionErrors(),this.loadCollectedUsersCount()}ngOnDestroy(){this.listeners.forEach(e=>e())}loadQuota(){let e=this.ipcService.on("extraction-quota",t=>{t&&(this.dailyQuota.set(t.daily||1e3),this.remainingQuota.set(t.remaining||800))});this.listeners.push(e),this.ipcService.send("get-extraction-quota",{})}listenForExtractionErrors(){let e=this.ipcService.on("members-extracted",t=>{let n=this.group();if(!(!n||String(t.resourceId)!==String(n.id)))if(!t.success&&t.error_code){let o=t.error_details||{},d={ADMIN_REQUIRED:{title:"\u9700\u8981\u7BA1\u7406\u54E1\u6B0A\u9650",defaultReason:"\u6B64\u7FA4\u7D44\u8A2D\u7F6E\u4E86\u6210\u54E1\u5217\u8868\u53EA\u5C0D\u7BA1\u7406\u54E1\u53EF\u898B"},PEER_ID_INVALID:{title:"\u5E33\u865F\u5C1A\u672A\u9023\u63A5\u6B64\u7FA4\u7D44",defaultReason:"Telegram \u8981\u6C42\u5E33\u865F\u5FC5\u9808\u5148\u52A0\u5165\u7FA4\u7D44"},NOT_PARTICIPANT:{title:"\u5E33\u865F\u4E0D\u662F\u7FA4\u7D44\u6210\u54E1",defaultReason:"\u7576\u524D\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44"},CHANNEL_PRIVATE:{title:"\u79C1\u6709\u7FA4\u7D44",defaultReason:"\u9019\u662F\u4E00\u500B\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u5148\u52A0\u5165"},CHANNEL_INVALID:{title:"\u7121\u6548\u7684\u7FA4\u7D44",defaultReason:"\u7FA4\u7D44\u53EF\u80FD\u5DF2\u88AB\u522A\u9664\u6216 ID \u7121\u6548"},USERNAME_NOT_OCCUPIED:{title:"\u7121\u6CD5\u89E3\u6790\u7FA4\u7D44",defaultReason:"\u9019\u53EF\u80FD\u662F\u79C1\u6709\u7FA4\u7D44\uFF0C\u6C92\u6709\u516C\u958B\u7684 username"}}[t.error_code]||{title:"\u63D0\u53D6\u5931\u6557",defaultReason:t.error||"\u672A\u77E5\u932F\u8AA4"};this.extractionError.set({code:t.error_code,title:d.title,reason:o.reason||d.defaultReason,suggestion:o.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66\u6216\u5617\u8A66\u5176\u4ED6\u65B9\u5F0F",alternative:o.alternative==="monitor_messages"?"monitor":void 0,canAutoJoin:o.can_auto_join})}else t.success&&this.extractionError.set(null)});this.listeners.push(e)}enableMonitoring(){let e=this.group();e&&(this.enableMonitoringEvent.emit(e),this.toast.info("\u{1F4E1} \u6B63\u5728\u958B\u555F\u6D88\u606F\u76E3\u63A7\uFF0C\u5C07\u81EA\u52D5\u6536\u96C6\u767C\u8A00\u7528\u6236"),this.close())}joinGroup(){let e=this.group();e&&(this.joinGroupEvent.emit(e),this.toast.info("\u2795 \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44..."))}selectTemplate(e){switch(this.selectedTemplate.set(e),e){case"quick":this.config.update(t=>B(F({},t),{limit:100,filters:B(F({},t.filters),{onlineStatus:"online",excludeBots:!0})}));break;case"deep":this.config.update(t=>B(F({},t),{limit:500,filters:B(F({},t.filters),{onlineStatus:"all",excludeBots:!0})}));break;case"precise":break}}setLimit(e){this.selectedTemplate.set("precise"),this.config.update(t=>B(F({},t),{limit:e}))}setOnlineStatus(e){this.selectedTemplate.set("precise"),this.config.update(t=>B(F({},t),{filters:B(F({},t.filters),{onlineStatus:e})}))}toggleFilter(e){this.selectedTemplate.set("precise"),this.config.update(t=>{let n=F({},t.filters);return e==="excludeBots"||e==="excludeAdmins"?n[e]=!n[e]:n[e]===null||n[e]===void 0?n[e]=!0:n[e]===!0?n[e]=!1:n[e]=null,B(F({},t),{filters:n})})}toggleAdvanced(e){this.config.update(t=>B(F({},t),{advanced:B(F({},t.advanced),{[e]:!t.advanced[e]})}))}setActivityDays(e){let t=e.target.value,n=t?parseInt(t,10):null;this.selectedTemplate.set("precise"),this.config.update(o=>B(F({},o),{filters:B(F({},o.filters),{minActivityDays:n})}))}refreshMemberCount(){let e=this.group();if(!e)return;this.isRefreshingCount.set(!0);let t=this.ipcService.on("group-member-count-result",n=>{this.isRefreshingCount.set(!1),t(),n.success&&n.memberCount>0?(this.toast.success(`\u2705 \u6210\u529F\u7372\u53D6\u6210\u54E1\u6578\uFF1A${n.memberCount} \u4EBA`),this.memberCountRefreshed.emit({groupId:e.id,memberCount:n.memberCount})):this.toast.error(n.error||"\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\uFF0C\u8ACB\u78BA\u8A8D\u5DF2\u52A0\u5165\u8A72\u7FA4\u7D44")});this.listeners.push(t),this.ipcService.send("get-group-member-count",{groupId:e.id,url:e.url,telegramId:e.telegramId||e.id,accountPhone:e.accountPhone}),setTimeout(()=>{this.isRefreshingCount()&&(this.isRefreshingCount.set(!1),this.toast.error("\u7372\u53D6\u6210\u54E1\u6578\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"))},15e3)}startExtraction(){let e=this.group();if(!e){this.toast.error("\u7FA4\u7D44\u4FE1\u606F\u4E0D\u5B58\u5728");return}if(this.estimatedCount()===0){this.toast.warning("\u6210\u54E1\u6578\u64DA\u4E0D\u53EF\u7528\uFF0C\u8ACB\u5148\u9EDE\u64CA\u300C\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578\u300D");return}this.startExtractionEvent.emit({group:e,config:this.config()}),this.close()}close(){this.closeDialog.emit()}onBackdropClick(e){e.target===e.currentTarget&&this.close()}checkMonitoringStatus(){let e=this.group();if(!e)return;this.ipcService.send("get-group-monitoring-status",{groupId:e.id,telegramId:e.telegramId});let t=this.ipcService.on("group-monitoring-status",n=>{String(n.groupId)===String(e.id)&&(this.isMonitoring.set(n.isMonitoring),this.collectedUsersCount.set(n.collectedUsers||0),n.isMonitoring?this.toast.success(`\u2705 \u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u5DF2\u6536\u96C6 ${n.collectedUsers} \u4F4D\u7528\u6236`):this.toast.warning("\u26A0\uFE0F \u76E3\u63A7\u672A\u958B\u555F\uFF0C\u8ACB\u5728\u7FA4\u7D44\u8A73\u60C5\u4E2D\u958B\u555F\u76E3\u63A7"),t())});this.listeners.push(t),this.toast.info("\u{1F50D} \u6B63\u5728\u6AA2\u67E5\u76E3\u63A7\u72C0\u614B...")}viewCollectedUsers(){let e=this.group();e&&(this.viewCollectedUsersEvent.emit(e),this.close())}collectFromHistory(){let e=this.group();if(!e)return;this.toast.info("\u{1F504} \u6B63\u5728\u5F9E\u6B77\u53F2\u6D88\u606F\u4E2D\u6536\u96C6\u7528\u6236..."),this.ipcService.send("collect-users-from-history",{groupId:e.id,telegramId:e.telegramId,limit:500});let t=this.ipcService.on("collect-from-history-result",n=>{String(n.groupId)===String(e.id)&&(t(),n.success?(this.toast.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${n.collected} \u4F4D\u7528\u6236\uFF0C\u65B0\u589E ${n.newUsers||0} \u4F4D`),this.collectedUsersCount.update(o=>o+(n.newUsers||0))):this.toast.error(n.error||"\u6536\u96C6\u5931\u6557"))});this.listeners.push(t)}loadCollectedUsersCount(){let e=this.group();if(!e)return;this.ipcService.send("get-collected-users-count",{groupId:e.id,sourceType:"monitoring"});let t=this.ipcService.on("collected-users-count",n=>{String(n.groupId)===String(e.id)&&(this.collectedUsersCount.set(n.count||0),t())});this.listeners.push(t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-member-extraction-dialog"]],inputs:{isOpen:[1,"isOpen"],group:[1,"group"]},outputs:{closeDialog:"closeDialog",startExtractionEvent:"startExtractionEvent",memberCountRefreshed:"memberCountRefreshed",enableMonitoringEvent:"enableMonitoringEvent",joinGroupEvent:"joinGroupEvent",viewCollectedUsersEvent:"viewCollectedUsersEvent"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[60]","p-4",3,"click"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-xl","shadow-2xl","border","border-slate-700/50","overflow-hidden","max-h-[90vh]","flex","flex-col",3,"click"],[1,"p-5","border-b","border-slate-700/50","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gradient-to-br","from-emerald-500","to-cyan-500","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"p-2","hover:bg-slate-800","rounded-lg","transition-colors","text-slate-400","hover:text-white",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-5","space-y-5"],[1,"p-5","border-t","border-slate-700/50","bg-slate-800/30"],[1,"flex","items-center","justify-between","mb-4","text-sm"],[1,"flex","items-center","gap-4"],[1,"text-slate-400"],[1,"text-emerald-400","font-medium"],[1,"text-cyan-400","font-medium"],[1,"flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-colors","font-medium",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","rounded-xl","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"p-4","bg-slate-800/50","rounded-xl","border","border-slate-700/50"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-emerald-500/20","to-cyan-500/20","flex","items-center","justify-center","text-2xl"],[1,"flex-1"],[1,"font-medium","text-white"],[1,"text-right"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-4","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"border",3,"bg-red-500/10","border-red-500/30","bg-amber-500/10","border-amber-500/30"],[1,"text-lg","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-lg","font-bold","text-amber-400"],[1,"text-xs","text-amber-400"],[1,"flex","items-start","gap-3"],[1,"text-xl"],[1,"font-medium","text-amber-400","mb-1"],[1,"text-sm","text-slate-400","mb-3"],[1,"text-sm","text-slate-400","space-y-1","list-disc","list-inside","mb-3"],[1,"flex","gap-2"],[1,"px-3","py-1.5","bg-amber-500/20","hover:bg-amber-500/30","text-amber-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-1",3,"click","disabled"],[1,"animate-spin"],[1,"font-medium","text-red-400","mb-1"],[1,"border"],[1,"font-medium","mb-1"],[1,"text-sm","text-slate-400","mb-2"],[1,"p-3","bg-slate-800/50","rounded-lg"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2"],[1,"p-3","bg-slate-800/50","rounded-lg","mb-3"],[1,"text-sm","text-slate-300","mb-2"],[1,"text-sm","text-slate-400","space-y-1.5"],[1,"flex","items-start","gap-2"],[1,"text-emerald-400"],[1,"flex","flex-wrap","gap-2"],[1,"px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-orange-500/20","hover:bg-orange-500/30","text-orange-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-cyan-500/20","hover:bg-cyan-500/30","text-cyan-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"text-sm","text-cyan-400","flex","items-center","gap-2"],[1,"mt-3","px-4","py-2","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","rounded-lg","text-sm","transition-colors","flex","items-center","gap-2",3,"click"],[1,"block","text-sm","font-medium","text-slate-300","mb-3"],[1,"grid","grid-cols-3","gap-3"],[1,"p-4","rounded-xl","border","transition-all","text-center","group",3,"click"],[1,"text-2xl","mb-1"],[1,"font-medium","text-white","text-sm"],[1,"text-xs","text-slate-400","mt-1"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"border-emerald-500","bg-emerald-500/20","text-emerald-400","border-slate-700","bg-slate-800/50","text-slate-400","disabled"],[1,"grid","grid-cols-4","gap-2"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"border-cyan-500","bg-cyan-500/20","text-cyan-400","border-slate-700","bg-slate-800/50","text-slate-400"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","gap-3","p-3","bg-slate-800/50","rounded-xl","border","border-slate-700/50","cursor-pointer","hover:bg-slate-800","transition-colors"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600","text-emerald-500","focus:ring-emerald-500",3,"change","checked"],[1,"text-sm","text-white"],[1,"border","border-slate-700/50","rounded-xl","overflow-hidden"],[1,"w-full","p-4","bg-slate-800/30","flex","items-center","justify-between","hover:bg-slate-800/50","transition-colors",3,"click"],[1,"text-sm","font-medium","text-slate-300"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-400","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-4","space-y-4","border-t","border-slate-700/50"],[1,"px-4","py-2","rounded-lg","border","transition-all","text-sm",3,"click","disabled"],[1,"ml-1","text-xs","text-orange-400"],[1,"px-3","py-2","rounded-lg","border","transition-all","text-sm","text-center",3,"click"],[1,"block","text-sm","text-slate-400","mb-2"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-slate-300"],[1,"px-3","py-1.5","bg-slate-700","border","border-slate-600","rounded-lg","text-sm","text-white","focus:ring-emerald-500","focus:border-emerald-500",3,"change","value"],["value",""],["value","3"],["value","7"],["value","14"],["value","30"],[1,"flex","items-center","gap-3","cursor-pointer","p-2","bg-slate-700/30","rounded-lg","hover:bg-slate-700/50"]],template:function(t,n){t&1&&S(0,Xx,39,7,"div",0),t&2&&w(n.isOpen()?0:-1)},dependencies:[te,me,Qe,Ye,tn],encapsulation:2})}};var Zx=(i,e)=>e.title,jx=(i,e)=>e.id;function ey(i,e){i&1&&(r(0,"div",11)(1,"div",16),l(2,"\u{1F50D}"),s(),r(3,"p",17),l(4,"\u672A\u627E\u5230\u5339\u914D\u7684\u7D50\u679C"),s(),r(5,"p",18),l(6,"\u5617\u8A66\u5176\u4ED6\u95DC\u9375\u8A5E"),s()())}function ty(i,e){if(i&1&&(r(0,"div",26),l(1),s()),i&2){let t=g().$implicit;c(),A(t.subtitle)}}function ny(i,e){if(i&1&&(r(0,"kbd",9),l(1),s()),i&2){let t=g().$implicit;c(),D(" ",t.shortcut," ")}}function iy(i,e){if(i&1){let t=M();r(0,"div",22),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.executeCommand(o))})("mouseenter",function(){let o=v(t).$index,a=g().$implicit,d=g(3);return b(d.selectedIndex.set(d.getGlobalIndex(a,o)))}),r(1,"div",23),l(2),s(),r(3,"div",24)(4,"div",25),l(5),s(),S(6,ty,2,1,"div",26),s(),r(7,"span",27),l(8),s(),S(9,ny,2,1,"kbd",9),s()}if(i&2){let t=e.$implicit,n=e.$index,o=g().$implicit,a=g(3);I("bg-cyan-500/20",a.isSelected(o,n))("hover:bg-slate-800",!a.isSelected(o,n)),c(),I("bg-cyan-500/20",a.isSelected(o,n))("bg-slate-800",!a.isSelected(o,n)),c(),D(" ",t.icon," "),c(3),A(t.title),c(),w(t.subtitle?6:-1),c(),I("bg-blue-500/20",t.type==="page")("text-blue-400",t.type==="page")("bg-green-500/20",t.type==="action")("text-green-400",t.type==="action")("bg-purple-500/20",t.type==="contact")("text-purple-400",t.type==="contact")("bg-amber-500/20",t.type==="recent")("text-amber-400",t.type==="recent"),c(),D(" ",a.getTypeLabel(t.type)," "),c(),w(t.shortcut?9:-1)}}function oy(i,e){if(i&1&&(r(0,"div",19)(1,"div",20),l(2),s(),$(3,iy,10,29,"div",21,jx),s()),i&2){let t=e.$implicit;c(2),D(" ",t.title," "),c(),H(t.items)}}function ry(i,e){if(i&1&&$(0,oy,5,1,"div",19,Zx),i&2){let t=g(2);H(t.filteredGroups())}}function sy(i,e){if(i&1){let t=M();r(0,"div",2),x("click",function(){v(t);let o=g();return b(o.close())}),k(1,"div",3),r(2,"div",4),x("click",function(o){return v(t),b(o.stopPropagation())}),r(3,"div",5),ne(),r(4,"svg",6),k(5,"path",7),s(),ge(),r(6,"input",8,0),W("ngModelChange",function(o){v(t);let a=g();return K(a.query,o)||(a.query=o),b(o)}),x("ngModelChange",function(o){v(t);let a=g();return b(a.onQueryChange(o))})("keydown",function(o){v(t);let a=g();return b(a.onKeyDown(o))}),s(),r(8,"kbd",9),l(9,"ESC"),s()(),r(10,"div",10),S(11,ey,7,0,"div",11)(12,ry,2,0),s(),r(13,"div",12)(14,"div",13)(15,"span",14)(16,"kbd",15),l(17,"\u2191"),s(),r(18,"kbd",15),l(19,"\u2193"),s(),l(20," \u5C0E\u822A "),s(),r(21,"span",14)(22,"kbd",15),l(23,"\u21B5"),s(),l(24," \u9078\u64C7 "),s(),r(25,"span",14)(26,"kbd",15),l(27,"ESC"),s(),l(28," \u95DC\u9589 "),s()(),r(29,"span"),l(30,"TG-Matrix \u547D\u4EE4\u9762\u677F"),s()()()()}if(i&2){let t=g();I("animate-fade-in",t.animateIn()),c(2),I("animate-slide-down",t.animateIn()),c(4),z("ngModel",t.query),c(5),w(t.filteredGroups().length===0?11:12)}}var Lo=class i{constructor(){this.navigate=Me();this.isOpen=_(!1);this.animateIn=_(!0);this.query="";this.selectedIndex=_(0);this.recentPages=_([]);this.commands=_([]);this.filteredGroups=G(()=>{let e=this.query.toLowerCase().trim(),t=this.commands();if(!e)return this.getDefaultGroups(t);let n=t.filter(o=>o.title.toLowerCase().includes(e)||o.subtitle?.toLowerCase().includes(e)||o.keywords.some(a=>a.toLowerCase().includes(e)));return this.groupByType(n)})}ngOnInit(){this.initCommands(),this.loadRecentPages()}ngOnDestroy(){}initCommands(){let e=[{id:"nav-dashboard",type:"page",icon:"\u{1F4CA}",title:"\u5100\u8868\u677F",subtitle:"\u67E5\u770B\u7CFB\u7D71\u6982\u89BD",keywords:["dashboard","\u9996\u9801","\u6982\u89BD"],action:()=>this.navigateTo("dashboard")},{id:"nav-accounts",type:"page",icon:"\u{1F464}",title:"\u5E33\u865F\u7BA1\u7406",subtitle:"\u7BA1\u7406 Telegram \u5E33\u865F",keywords:["accounts","\u5E33\u6236","\u767B\u9304"],action:()=>this.navigateTo("accounts")},{id:"nav-resource",type:"page",icon:"\u{1F4C7}",title:"\u8CC7\u6E90\u4E2D\u5FC3",subtitle:"\u7BA1\u7406\u806F\u7E6B\u4EBA\u548C\u7FA4\u7D44",keywords:["resource","\u806F\u7E6B\u4EBA","\u7FA4\u7D44","contacts"],action:()=>this.navigateTo("resource-center")},{id:"nav-ai-assistant",type:"page",icon:"\u{1F3AF}",title:"\u7B56\u7565\u898F\u5283",subtitle:"AI \u71DF\u92B7\u52A9\u624B",keywords:["ai","\u71DF\u92B7","\u7B56\u7565","marketing"],action:()=>this.navigateTo("ai-assistant")},{id:"nav-ai-team",type:"page",icon:"\u{1F916}",title:"\u81EA\u52D5\u57F7\u884C",subtitle:"AI \u5718\u968A\u92B7\u552E",keywords:["ai","\u5718\u968A","\u81EA\u52D5","team"],action:()=>this.navigateTo("ai-team")},{id:"nav-analytics",type:"page",icon:"\u{1F4C8}",title:"\u6578\u64DA\u6D1E\u5BDF",subtitle:"\u667A\u80FD\u5206\u6790\u5831\u544A",keywords:["analytics","\u5206\u6790","\u5831\u544A","\u7D71\u8A08"],action:()=>this.navigateTo("analytics")},{id:"nav-automation",type:"page",icon:"\u26A1",title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",subtitle:"\u76E3\u63A7\u548C\u81EA\u52D5\u56DE\u8986",keywords:["automation","\u81EA\u52D5\u5316","\u76E3\u63A7"],action:()=>this.navigateTo("automation")},{id:"nav-leads",type:"page",icon:"\u{1F3AF}",title:"\u6F5B\u5728\u5BA2\u6236",subtitle:"\u5BA2\u6236\u7BA1\u7406",keywords:["leads","\u5BA2\u6236","crm"],action:()=>this.navigateTo("leads")},{id:"nav-settings",type:"page",icon:"\u2699\uFE0F",title:"\u7CFB\u7D71\u8A2D\u7F6E",subtitle:"\u914D\u7F6E\u7CFB\u7D71\u9078\u9805",keywords:["settings","\u8A2D\u7F6E","\u914D\u7F6E"],action:()=>this.navigateTo("settings")},{id:"action-add-account",type:"action",icon:"\u2795",title:"\u6DFB\u52A0\u5E33\u865F",subtitle:"\u6DFB\u52A0\u65B0\u7684 Telegram \u5E33\u865F",keywords:["add","account","\u65B0\u589E"],shortcut:"\u2318N",action:()=>this.navigateTo("add-account")},{id:"action-send-message",type:"action",icon:"\u2709\uFE0F",title:"\u767C\u9001\u6D88\u606F",subtitle:"\u5411\u806F\u7E6B\u4EBA\u767C\u9001\u6D88\u606F",keywords:["send","message","\u767C\u9001"],action:()=>this.emitAction("send-message")},{id:"action-extract",type:"action",icon:"\u{1F4E5}",title:"\u63D0\u53D6\u6210\u54E1",subtitle:"\u5F9E\u7FA4\u7D44\u63D0\u53D6\u6210\u54E1",keywords:["extract","member","\u63D0\u53D6"],action:()=>this.emitAction("extract-members")},{id:"action-search-group",type:"action",icon:"\u{1F50D}",title:"\u641C\u7D22\u7FA4\u7D44",subtitle:"\u641C\u7D22 Telegram \u7FA4\u7D44",keywords:["search","group","\u641C\u7D22"],action:()=>this.emitAction("search-groups")},{id:"action-start-monitor",type:"action",icon:"\u{1F4E1}",title:"\u555F\u52D5\u76E3\u63A7",subtitle:"\u958B\u59CB\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F",keywords:["monitor","start","\u76E3\u63A7"],action:()=>this.emitAction("start-monitor")},{id:"action-refresh",type:"action",icon:"\u{1F504}",title:"\u5237\u65B0\u6578\u64DA",subtitle:"\u91CD\u65B0\u52A0\u8F09\u6578\u64DA",keywords:["refresh","reload","\u5237\u65B0"],shortcut:"\u2318R",action:()=>this.emitAction("refresh")},{id:"help-docs",type:"help",icon:"\u{1F4D6}",title:"\u5E6B\u52A9\u6587\u6A94",subtitle:"\u67E5\u770B\u4F7F\u7528\u6307\u5357",keywords:["help","docs","\u5E6B\u52A9","\u6587\u6A94"],action:()=>this.emitAction("open-docs")},{id:"help-shortcuts",type:"help",icon:"\u2328\uFE0F",title:"\u5FEB\u6377\u9375",subtitle:"\u67E5\u770B\u6240\u6709\u5FEB\u6377\u9375",keywords:["shortcuts","keyboard","\u5FEB\u6377\u9375"],action:()=>this.emitAction("show-shortcuts")},{id:"help-feedback",type:"help",icon:"\u{1F4AC}",title:"\u610F\u898B\u53CD\u994B",subtitle:"\u63D0\u4EA4\u554F\u984C\u6216\u5EFA\u8B70",keywords:["feedback","\u53CD\u994B","\u5EFA\u8B70"],action:()=>this.emitAction("open-feedback")}];this.commands.set(e)}getDefaultGroups(e){let t=this.recentPages(),n=[];if(t.length>0){let d=e.filter(m=>t.includes(m.id)).sort((m,f)=>t.indexOf(m.id)-t.indexOf(f.id)).slice(0,5).map(m=>B(F({},m),{type:"recent"}));d.length>0&&n.push({title:"\u6700\u8FD1\u8A2A\u554F",items:d})}let o=e.filter(d=>d.type==="page").slice(0,6);n.push({title:"\u9801\u9762",items:o});let a=e.filter(d=>d.type==="action").slice(0,4);return n.push({title:"\u5FEB\u901F\u64CD\u4F5C",items:a}),n}groupByType(e){let t=[],n=e.filter(m=>m.type==="page"),o=e.filter(m=>m.type==="action"),a=e.filter(m=>m.type==="contact"),d=e.filter(m=>m.type==="help");return n.length>0&&t.push({title:"\u9801\u9762",items:n}),o.length>0&&t.push({title:"\u64CD\u4F5C",items:o}),a.length>0&&t.push({title:"\u806F\u7E6B\u4EBA",items:a}),d.length>0&&t.push({title:"\u5E6B\u52A9",items:d}),t}onGlobalKeyDown(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),this.toggle()),e.key==="Escape"&&this.isOpen()&&(e.preventDefault(),this.close())}onKeyDown(e){let n=this.filteredGroups().reduce((o,a)=>o+a.items.length,0);switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex.update(a=>(a+1)%n);break;case"ArrowUp":e.preventDefault(),this.selectedIndex.update(a=>(a-1+n)%n);break;case"Enter":e.preventDefault();let o=this.getSelectedItem();o&&this.executeCommand(o);break}}onQueryChange(e){this.selectedIndex.set(0)}getSelectedItem(){let e=this.filteredGroups(),t=0;for(let n of e)for(let o of n.items){if(t===this.selectedIndex())return o;t++}return null}getGlobalIndex(e,t){let n=this.filteredGroups(),o=0;for(let a of n){if(a===e)return o+t;o+=a.items.length}return 0}isSelected(e,t){return this.getGlobalIndex(e,t)===this.selectedIndex()}getTypeLabel(e){return{page:"\u9801\u9762",action:"\u64CD\u4F5C",contact:"\u806F\u7E6B\u4EBA",recent:"\u6700\u8FD1",help:"\u5E6B\u52A9"}[e]}toggle(){this.isOpen()?this.close():this.open()}open(){this.query="",this.selectedIndex.set(0),this.animateIn.set(!0),this.isOpen.set(!0)}close(){this.animateIn.set(!1),setTimeout(()=>{this.isOpen.set(!1)},150)}executeCommand(e){e.type==="page"&&this.addToRecent(e.id),e.action(),this.close()}navigateTo(e){this.navigate.emit(e)}emitAction(e){this.navigate.emit(`action:${e}`)}addToRecent(e){this.recentPages.update(t=>{let n=t.filter(o=>o!==e);return[e,...n].slice(0,10)}),this.saveRecentPages()}loadRecentPages(){try{let e=localStorage.getItem("tg-matrix-recent-pages");e&&this.recentPages.set(JSON.parse(e))}catch{}}saveRecentPages(){try{localStorage.setItem("tg-matrix-recent-pages",JSON.stringify(this.recentPages()))}catch{}}addCommand(e){this.commands.update(t=>[...t,e])}addContactCommands(e){let t=e.map(n=>({id:`contact-${n.id}`,type:"contact",icon:"\u{1F464}",title:n.name,subtitle:n.username?`@${n.username}`:void 0,keywords:[n.name,n.username||""].filter(Boolean),action:()=>this.navigate.emit(`contact:${n.id}`)}));this.commands.update(n=>[...n.filter(o=>o.type!=="contact"),...t])}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-command-palette"]],hostBindings:function(t,n){t&1&&x("keydown",function(a){return n.onGlobalKeyDown(a)},qt)},outputs:{navigate:"navigate"},decls:1,vars:1,consts:[["searchInput",""],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"animate-fade-in"],[1,"command-palette-overlay","fixed","inset-0","z-[9999]","flex","items-start","justify-center","pt-[15vh]",3,"click"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm"],[1,"command-palette","relative","w-full","max-w-2xl","mx-4","bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-700/50","overflow-hidden",3,"click"],[1,"flex","items-center","gap-3","p-4","border-b","border-slate-700/50"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-slate-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text","placeholder","\u641C\u7D22\u9801\u9762\u3001\u529F\u80FD\u3001\u806F\u7E6B\u4EBA...","autofocus","",1,"flex-1","bg-transparent","text-white","placeholder-slate-500","outline-none","text-lg",3,"ngModelChange","keydown","ngModel"],[1,"px-2","py-1","text-xs","text-slate-400","bg-slate-800","rounded","border","border-slate-700"],[1,"max-h-[60vh]","overflow-y-auto"],[1,"p-8","text-center"],[1,"flex","items-center","justify-between","px-4","py-3","border-t","border-slate-700/50","text-xs","text-slate-500"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-1"],[1,"px-1.5","py-0.5","bg-slate-800","rounded"],[1,"text-4xl","mb-3"],[1,"text-slate-400"],[1,"text-sm","text-slate-500","mt-1"],[1,"py-2"],[1,"px-4","py-2","text-xs","font-semibold","text-slate-500","uppercase","tracking-wider"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"bg-cyan-500/20","hover:bg-slate-800"],[1,"flex","items-center","gap-3","px-4","py-3","mx-2","rounded-lg","cursor-pointer","transition-colors",3,"click","mouseenter"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","text-xl"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","truncate"],[1,"text-sm","text-slate-400","truncate"],[1,"px-2","py-0.5","text-xs","rounded-full"]],template:function(t,n){t&1&&S(0,sy,31,6,"div",1),t&2&&w(n.isOpen()?0:-1)},dependencies:[te,me,xe,_e,Ce],styles:[".animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .15s ease-out}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}.animate-slide-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-down .2s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_slide-down{0%{opacity:0;transform:translateY(-20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b}"]})}};function ay(i,e){if(i&1&&(P(0,"span",3),l(1),N()),i&2){let t=g();I("animate-bounce",t.level==="king")("animate-pulse",t.level!=="king"&&t.level!=="bronze"),c(),D(" ",t.levelIcon()," ")}}function ly(i,e){if(i&1&&(P(0,"span",2),l(1),N()),i&2){let t=g();c(),A(t.levelText())}}var Vt=class i{constructor(){this.i18n=O(Xe);this.level="bronze";this.size="sm";this.showIcon=!0;this.showText=!0;this.LEVEL_ICONS={bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"};this.LEVEL_NAMES={bronze:"membershipLevels.bronze",silver:"membershipLevels.silver",gold:"membershipLevels.gold",diamond:"membershipLevels.diamond",star:"membershipLevels.star",king:"membershipLevels.king"};this.badgeClasses=G(()=>`badge-${this.size} badge-${this.level}`);this.levelIcon=G(()=>this.LEVEL_ICONS[this.level]||"\u2694\uFE0F");this.levelText=G(()=>{let e=this.LEVEL_NAMES[this.level];return this.i18n.t(e)});this.tooltip=G(()=>this.levelText())}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["user-level-badge"]],inputs:{level:"level",size:"size",showIcon:"showIcon",showText:"showText"},decls:3,vars:5,consts:[[1,"user-level-badge",3,"title"],[1,"badge-icon",3,"animate-bounce","animate-pulse"],[1,"badge-text"],[1,"badge-icon"]],template:function(t,n){t&1&&(P(0,"span",0),S(1,ay,2,5,"span",1),S(2,ly,2,1,"span",2),N()),t&2&&(de(n.badgeClasses()),Je("title",n.tooltip()),c(),w(n.showIcon?1:-1),c(),w(n.showText?2:-1))},dependencies:[te],styles:[".user-level-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:9999px;font-weight:600;white-space:nowrap;transition:all .2s ease}.badge-xs[_ngcontent-%COMP%]{font-size:10px;padding:1px 4px;gap:2px}.badge-sm[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px;gap:3px}.badge-md[_ngcontent-%COMP%]{font-size:12px;padding:3px 10px;gap:4px}.badge-lg[_ngcontent-%COMP%]{font-size:14px;padding:4px 12px;gap:5px}.badge-bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b6914,peru);color:#fff8dc;border:1px solid rgba(205,133,63,.5)}.badge-silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,#708090,silver,#a8a8a8);color:#1a1a2e;border:1px solid rgba(192,192,192,.5);box-shadow:0 0 8px #c0c0c04d}.badge-gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b8860b,gold,orange);color:#1a1a2e;border:1px solid rgba(255,215,0,.5);box-shadow:0 0 10px #ffd70066}.badge-diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#00ced1,#87ceeb,#b9f2ff);color:#1a1a2e;border:1px solid rgba(135,206,235,.5);box-shadow:0 0 12px #00ced180}.badge-star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9932cc,orchid,#ff69b4);color:#fff;border:1px solid rgba(218,112,214,.5);box-shadow:0 0 15px #9932cc80}.badge-king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff4500,tomato 30%,gold 70%,orange);color:#fff;border:1px solid rgba(255,215,0,.6);box-shadow:0 0 20px #ff450099,0 0 40px #ffd7004d;animation:_ngcontent-%COMP%_king-glow 2s ease-in-out infinite alternate}@keyframes _ngcontent-%COMP%_king-glow{0%{box-shadow:0 0 20px #ff450099,0 0 40px #ffd7004d}to{box-shadow:0 0 25px #ff4500cc,0 0 50px #ffd70080}}.badge-icon[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center}.badge-text[_ngcontent-%COMP%]{line-height:1}.animate-pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}.animate-bounce[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce 1s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.7}}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(-10%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:translateY(0);animation-timing-function:cubic-bezier(0,0,.2,1)}}"]})}};function cy(i,e){if(i&1){let t=M();P(0,"button",5),oe("click",function(){v(t);let o=g(2);return b(o.dismiss())}),l(1,"\u2715"),N()}}function dy(i,e){if(i&1&&(P(0,"div",1)(1,"span",2),l(2),N(),P(3,"span",3),l(4),N(),S(5,cy,2,0,"button",4),N()),i&2){let t=g();de("status-"+t.status()),c(2),A(t.getIcon()),c(2),A(t.message()),c(),w(t.status()==="online"?5:-1)}}var Go=class i{constructor(){this.networkService=O(Sn);this.subscription=null;this.showBanner=_(!1);this.status=_("online");this.message=_("");this.dismissTimer=null}ngOnInit(){this.subscription=this.networkService.networkEvents$.subscribe(e=>{this.status.set(e.status),this.message.set(e.message||""),this.showBanner.set(!0),this.dismissTimer&&clearTimeout(this.dismissTimer),e.status==="online"&&(this.dismissTimer=setTimeout(()=>{this.showBanner.set(!1)},3e3))})}ngOnDestroy(){this.subscription?.unsubscribe(),this.dismissTimer&&clearTimeout(this.dismissTimer)}getIcon(){return this.networkService.getStatusIcon()}dismiss(){this.showBanner.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-network-status"]],decls:1,vars:1,consts:[[1,"network-banner",3,"class"],[1,"network-banner"],[1,"icon"],[1,"message"],[1,"dismiss-btn"],[1,"dismiss-btn",3,"click"]],template:function(t,n){t&1&&S(0,dy,6,5,"div",0),t&2&&w(n.showBanner()?0:-1)},dependencies:[te],styles:[".network-banner[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:9999;padding:.75rem 1rem;display:flex;align-items:center;justify-content:center;gap:.5rem;font-size:.875rem;font-weight:500;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}.status-offline[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}.status-online[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.status-slow[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.icon[_ngcontent-%COMP%]{font-size:1rem}.message[_ngcontent-%COMP%]{flex:1;text-align:center}.dismiss-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;opacity:.8;cursor:pointer;padding:.25rem;font-size:.875rem}.dismiss-btn[_ngcontent-%COMP%]:hover{opacity:1}"]})}};function uy(i,e){i&1&&(P(0,"div",6),l(1,"\u2713"),N(),P(2,"h2",7),l(3,"\u6B61\u8FCE\u56DE\u4F86"),N(),P(4,"p",8),l(5,"\u6B63\u5728\u9032\u5165\u7CFB\u7D71..."),N())}function my(i,e){i&1&&(P(0,"div",9),l(1,"\u{1F44B}"),N(),P(2,"h2",7),l(3,"\u5DF2\u5B89\u5168\u767B\u51FA"),N(),P(4,"p",8),l(5,"\u671F\u5F85\u60A8\u7684\u518D\u6B21\u8A2A\u554F"),N())}function py(i,e){i&1&&(P(0,"div",10),l(1,"\u26A0\uFE0F"),N(),P(2,"h2",7),l(3,"\u6703\u8A71\u5DF2\u904E\u671F"),N(),P(4,"p",8),l(5,"\u8ACB\u91CD\u65B0\u767B\u5165"),N())}function gy(i,e){if(i&1&&(P(0,"div",1)(1,"div",2),S(2,uy,6,0)(3,my,6,0)(4,py,6,0),N(),P(5,"div",3)(6,"span",4),l(7,"\u{1F916}"),N(),P(8,"span",5),l(9,"TG-AI \u667A\u63A7\u738B"),N()()()),i&2){let t,n=g();de("type-"+n.type()),c(2),w((t=n.type())==="login"?2:t==="logout"?3:t==="session_expired"?4:-1)}}var Uo=class i{constructor(){this.authEvents=O(rn);this.subscription=null;this.show=_(!1);this.type=_("none");this.hideTimer=null}ngOnInit(){this.subscription=this.authEvents.authEvents$.subscribe(e=>{this.handleEvent(e)})}ngOnDestroy(){this.subscription?.unsubscribe(),this.hideTimer&&clearTimeout(this.hideTimer)}handleEvent(e){switch(this.hideTimer&&clearTimeout(this.hideTimer),e.type){case"login":this.type.set("login"),this.show.set(!0),this.hideTimer=setTimeout(()=>{this.show.set(!1)},1500);break;case"logout":this.type.set("logout"),this.show.set(!0),this.hideTimer=setTimeout(()=>{this.show.set(!1)},1e3);break;case"session_expired":this.type.set("session_expired"),this.show.set(!0),this.hideTimer=setTimeout(()=>{this.show.set(!1)},2e3);break}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-auth-transition"]],decls:1,vars:1,consts:[[1,"transition-overlay",3,"class"],[1,"transition-overlay"],[1,"transition-content"],[1,"brand-footer"],[1,"brand-icon"],[1,"brand-name"],[1,"success-icon"],[1,"title"],[1,"subtitle"],[1,"logout-icon"],[1,"warning-icon"]],template:function(t,n){t&1&&S(0,gy,10,3,"div",0),t&2&&w(n.show()?0:-1)},dependencies:[te],styles:[".transition-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.type-login[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0f172a,#1e3a5f,#0f172a)}.type-logout[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e293b,#334155,#1e293b)}.type-session_expired[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e293b,#422006,#1e293b)}.transition-content[_ngcontent-%COMP%]{text-align:center;animation:_ngcontent-%COMP%_scaleIn .4s ease-out}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}.success-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.5rem;color:#fff;animation:_ngcontent-%COMP%_bounceIn .5s ease-out}.logout-icon[_ngcontent-%COMP%], .warning-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1.5rem;animation:_ngcontent-%COMP%_bounceIn .5s ease-out}@keyframes _ngcontent-%COMP%_bounceIn{0%{transform:scale(0);opacity:0}50%{transform:scale(1.1)}to{transform:scale(1);opacity:1}}.title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;color:#fff;margin:0 0 .5rem}.subtitle[_ngcontent-%COMP%]{font-size:1rem;color:#ffffffb3;margin:0}.brand-footer[_ngcontent-%COMP%]{position:absolute;bottom:2rem;display:flex;align-items:center;gap:.5rem;color:#ffffff80;font-size:.875rem}.brand-icon[_ngcontent-%COMP%]{font-size:1.25rem}.brand-name[_ngcontent-%COMP%]{font-weight:500}"]})}};var hy=(i,e)=>e.api_id;function fy(i,e){i&1&&(r(0,"span",37),l(1,"\u23F3"),s(),l(2," \u4FDD\u5B58\u4E2D... "))}function _y(i,e){i&1&&(r(0,"span"),l(1,"\u2795"),s(),l(2," \u6DFB\u52A0 "))}function Cy(i,e){i&1&&(r(0,"div",34)(1,"div",38),l(2,"\u23F3"),s(),r(3,"p",39),l(4,"\u6B63\u5728\u52A0\u8F09..."),s()())}function vy(i,e){i&1&&(r(0,"div",34)(1,"div",40),l(2,"\u{1F4ED}"),s(),r(3,"p",41),l(4,"\u9084\u6C92\u6709\u4EFB\u4F55 API \u6191\u64DA"),s(),r(5,"p",39),l(6,"\u8ACB\u5728\u4E0A\u65B9\u8868\u55AE\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B API"),s()())}function by(i,e){i&1&&(r(0,"span",46),l(1,"\u516C\u5171"),s())}function xy(i,e){i&1&&(r(0,"span",47),l(1,"\u624B\u52D5\u6DFB\u52A0"),s())}function yy(i,e){if(i&1){let t=M();r(0,"button",52),x("click",function(){v(t);let o=g().$implicit,a=g(2);return b(a.toggleCredential(o.api_id,!o.is_active))}),l(1),s(),r(2,"button",53),x("click",function(){v(t);let o=g().$implicit,a=g(2);return b(a.confirmDelete(o))}),l(3," \u522A\u9664 "),s()}if(i&2){let t=g().$implicit;I("bg-green-500/20",!t.is_active)("text-green-400",!t.is_active)("hover:bg-green-500/30",!t.is_active)("bg-amber-500/20",t.is_active)("text-amber-400",t.is_active)("hover:bg-amber-500/30",t.is_active),c(),D(" ",t.is_active?"\u505C\u7528":"\u555F\u7528"," ")}}function Sy(i,e){if(i&1&&(r(0,"div",42)(1,"div",2),k(2,"div",43),r(3,"div")(4,"div",44)(5,"span",45),l(6),s(),S(7,by,2,0,"span",46),S(8,xy,2,0,"span",47),s(),r(9,"div",12),l(10),s()()(),r(11,"div",2)(12,"div",48)(13,"div",49),l(14),s(),r(15,"div",50),k(16,"div",51),s()(),r(17,"div",44),S(18,yy,4,13),s()()()),i&2){let t=e.$implicit;c(2),I("bg-green-500",t.is_active)("bg-slate-500",!t.is_active),c(4),A(t.name),c(),w(t.is_public?7:-1),c(),w(t.source==="manual"?8:-1),c(2),st(" ID: ",t.api_id," \u2022 Hash: ",t.api_hash.slice(0,8),"...",t.api_hash.slice(-4)," "),c(3),I("text-green-400",t.account_count<t.max_accounts*.8)("text-amber-400",t.account_count>=t.max_accounts*.8&&t.account_count<t.max_accounts)("text-red-400",t.account_count>=t.max_accounts),c(),Y(" ",t.account_count,"/",t.max_accounts," \u5E33\u865F "),c(2),X("width",t.account_count/t.max_accounts*100,"%"),I("bg-green-500",t.account_count<t.max_accounts*.8)("bg-amber-500",t.account_count>=t.max_accounts*.8&&t.account_count<t.max_accounts)("bg-red-500",t.account_count>=t.max_accounts),c(2),w(t.is_public?-1:18)}}function wy(i,e){if(i&1&&(r(0,"div",35),$(1,Sy,19,27,"div",42,hy),s()),i&2){let t=g();c(),H(t.credentials())}}function Ey(i,e){if(i&1&&(k(0,"br"),r(1,"span",62),l(2),s()),i&2){let t=g(2);c(2),D("\u26A0\uFE0F \u6B64 API \u76EE\u524D\u6709 ",t.deleteTarget().account_count," \u500B\u5E33\u865F\u5728\u4F7F\u7528\u3002")}}function Ay(i,e){if(i&1){let t=M();r(0,"div",54),x("click",function(){v(t);let o=g();return b(o.cancelDelete())}),r(1,"div",55),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"h3",56),l(3,"\u78BA\u8A8D\u522A\u9664"),s(),r(4,"p",57),l(5," \u78BA\u5B9A\u8981\u522A\u9664 API\u300C"),r(6,"span",58),l(7),s(),l(8,"\u300D\u55CE\uFF1F "),S(9,Ey,3,1),s(),r(10,"div",59)(11,"button",60),x("click",function(){v(t);let o=g();return b(o.cancelDelete())}),l(12," \u53D6\u6D88 "),s(),r(13,"button",61),x("click",function(){v(t);let o=g();return b(o.doDelete())}),l(14," \u78BA\u8A8D\u522A\u9664 "),s()()()()}if(i&2){let t=g();c(7),A(t.deleteTarget().name),c(2),w(t.deleteTarget().account_count>0?9:-1)}}var qo=class i{constructor(){this.ipc=O(ye);this.toast=O(ue);this.nav=O(sn);this.credentials=_([]);this.isLoading=_(!0);this.isSaving=_(!1);this.deleteTarget=_(null);this.newApiId="";this.newApiHash="";this.newApiName="";this.activeCount=()=>this.credentials().filter(e=>e.is_active&&!e.is_public).length;this.totalAccountsUsed=()=>this.credentials().reduce((e,t)=>e+t.account_count,0);this.totalCapacity=()=>this.credentials().filter(e=>!e.is_public).reduce((e,t)=>e+t.max_accounts,0);this.ipcCleanup=[]}ngOnInit(){this.setupIpcListeners(),this.refreshList()}ngOnDestroy(){this.ipcCleanup.forEach(e=>e())}setupIpcListeners(){let e=this.ipc.on("api-credentials-updated",a=>{this.isLoading.set(!1),a.credentials&&this.credentials.set(a.credentials)}),t=this.ipc.on("api-credential-added",a=>{this.isSaving.set(!1),a.success?(this.toast.success("\u2705 API \u6191\u64DA\u6DFB\u52A0\u6210\u529F\uFF01"),this.clearForm()):this.toast.error(`\u6DFB\u52A0\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`)}),n=this.ipc.on("api-credential-removed",a=>{a.success?this.toast.success("\u{1F5D1}\uFE0F API \u6191\u64DA\u5DF2\u522A\u9664"):this.toast.error(`\u522A\u9664\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`)}),o=this.ipc.on("api-credential-toggled",a=>{a.success?this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0"):this.toast.error(`\u64CD\u4F5C\u5931\u6557: ${a.error||"\u672A\u77E5\u932F\u8AA4"}`)});this.ipcCleanup.push(e,t,n,o)}refreshList(){this.isLoading.set(!0),this.ipc.send("get-api-credentials",{})}isFormValid(){let e=this.newApiId.trim(),t=this.newApiHash.trim();return e.length>0&&/^\d+$/.test(e)&&t.length===32&&/^[a-f0-9]{32}$/i.test(t)}addCredential(){if(!this.isFormValid()){this.toast.error("\u8ACB\u6AA2\u67E5 API ID \u548C API Hash \u683C\u5F0F");return}this.isSaving.set(!0),this.ipc.send("add-api-credential",{api_id:this.newApiId.trim(),api_hash:this.newApiHash.trim(),name:this.newApiName.trim()||`API_${this.newApiId.slice(-4)}`,source:"manual",max_accounts:5})}clearForm(){this.newApiId="",this.newApiHash="",this.newApiName=""}toggleCredential(e,t){this.ipc.send("toggle-api-credential",{api_id:e,is_active:t})}confirmDelete(e){this.deleteTarget.set(e)}cancelDelete(){this.deleteTarget.set(null)}doDelete(){let e=this.deleteTarget();e&&(this.ipc.send("remove-api-credential",{api_id:e.api_id}),this.deleteTarget.set(null))}goBack(){this.nav.navigateTo("accounts")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-api-credentials-view"]],decls:80,vars:14,consts:[[1,"max-w-6xl","mx-auto"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-2","text-slate-400","hover:text-white","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"flex","items-center","gap-2","px-4","py-2","bg-slate-800","hover:bg-slate-700","rounded-lg","transition-colors",3,"click","disabled"],[1,"text-3xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-8"],[1,"grid","grid-cols-4","gap-4","mb-8"],[1,"bg-gradient-to-br","from-cyan-500/10","to-blue-500/10","border","border-cyan-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400"],[1,"bg-gradient-to-br","from-green-500/10","to-emerald-500/10","border","border-green-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-green-400"],[1,"bg-gradient-to-br","from-amber-500/10","to-orange-500/10","border","border-amber-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-amber-400"],[1,"bg-gradient-to-br","from-purple-500/10","to-pink-500/10","border","border-purple-500/20","rounded-xl","p-4"],[1,"text-2xl","font-bold","text-purple-400"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","rounded-xl","p-6","mb-8"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-slate-400","mb-1"],[1,"text-red-400"],["type","text","placeholder","\u4F8B\u5982: 12345678",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","text","placeholder","32\u4F4D\u5341\u516D\u9032\u5236\u5B57\u7B26\u4E32",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4F8B\u5982: \u4E3B\u529B API",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-4","py-2","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","items-end"],[1,"w-full","bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-600","hover:to-blue-600","disabled:from-slate-600","disabled:to-slate-600","disabled:cursor-not-allowed","text-white","font-bold","py-2","px-4","rounded-lg","transition-all","flex","items-center","justify-center","gap-2",3,"click","disabled"],[1,"mt-3","text-sm","text-slate-500","flex","items-center","gap-2"],["href","https://my.telegram.org","target","_blank",1,"text-cyan-400","hover:underline"],[1,"bg-slate-900/50","backdrop-blur-sm","border","border-slate-700","rounded-xl","overflow-hidden"],[1,"p-4","border-b","border-slate-700"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"p-12","text-center"],[1,"divide-y","divide-slate-700"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"animate-spin"],[1,"animate-spin","text-4xl","mb-4"],[1,"text-slate-400"],[1,"text-6xl","mb-4"],[1,"text-xl","font-medium","text-white","mb-2"],[1,"p-4","hover:bg-slate-800/50","transition-colors","flex","items-center","justify-between"],[1,"w-3","h-3","rounded-full"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-white"],[1,"text-xs","bg-amber-500/20","text-amber-400","px-2","py-0.5","rounded"],[1,"text-xs","bg-cyan-500/20","text-cyan-400","px-2","py-0.5","rounded"],[1,"text-right"],[1,"text-sm","font-medium"],[1,"w-24","h-1.5","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","transition-all"],[1,"px-3","py-1.5","rounded-lg","text-sm","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","text-red-400","hover:bg-red-500/30","rounded-lg","text-sm","transition-colors",3,"click"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-xl","p-6","max-w-md","w-full","mx-4",3,"click"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"text-slate-400","mb-6"],[1,"text-white"],[1,"flex","gap-3"],[1,"flex-1","px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"flex-1","px-4","py-2","bg-red-500","hover:bg-red-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"text-amber-400"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),x("click",function(){return n.goBack()}),ne(),r(4,"svg",4),k(5,"path",5),s(),l(6," \u8FD4\u56DE\u5E33\u865F\u7BA1\u7406 "),s()(),ge(),r(7,"button",6),x("click",function(){return n.refreshList()}),r(8,"span"),l(9,"\u{1F504}"),s(),l(10," \u5237\u65B0 "),s()(),r(11,"h1",7),l(12,"\u{1F510} API \u6191\u64DA\u6C60"),s(),r(13,"p",8),l(14,"\u7BA1\u7406\u60A8\u7684 Telegram API \u6191\u64DA\uFF0C\u6DFB\u52A0\u81EA\u5B9A\u7FA9 API \u4EE5\u7372\u5F97\u66F4\u597D\u7684\u7A69\u5B9A\u6027"),s(),r(15,"div",9)(16,"div",10)(17,"div",11),l(18),s(),r(19,"div",12),l(20,"\u7E3D API \u6578\u91CF"),s()(),r(21,"div",13)(22,"div",14),l(23),s(),r(24,"div",12),l(25,"\u6D3B\u8E8D\u4E2D"),s()(),r(26,"div",15)(27,"div",16),l(28),s(),r(29,"div",12),l(30,"\u5DF2\u7D81\u5B9A\u5E33\u865F"),s()(),r(31,"div",17)(32,"div",18),l(33),s(),r(34,"div",12),l(35,"\u7E3D\u5BB9\u91CF"),s()()(),r(36,"div",19)(37,"h3",20)(38,"span"),l(39,"\u2795"),s(),l(40," \u6DFB\u52A0\u65B0 API \u6191\u64DA "),s(),r(41,"div",21)(42,"div")(43,"label",22),l(44,"API ID "),r(45,"span",23),l(46,"*"),s()(),r(47,"input",24),W("ngModelChange",function(a){return K(n.newApiId,a)||(n.newApiId=a),a}),s()(),r(48,"div")(49,"label",22),l(50,"API Hash "),r(51,"span",23),l(52,"*"),s()(),r(53,"input",25),W("ngModelChange",function(a){return K(n.newApiHash,a)||(n.newApiHash=a),a}),s()(),r(54,"div")(55,"label",22),l(56,"\u540D\u7A31\uFF08\u53EF\u9078\uFF09"),s(),r(57,"input",26),W("ngModelChange",function(a){return K(n.newApiName,a)||(n.newApiName=a),a}),s()(),r(58,"div",27)(59,"button",28),x("click",function(){return n.addCredential()}),S(60,fy,3,0)(61,_y,3,0),s()()(),r(62,"div",29)(63,"span"),l(64,"\u{1F4A1}"),s(),r(65,"span"),l(66,"\u524D\u5F80 "),r(67,"a",30),l(68,"my.telegram.org"),s(),l(69," \u7533\u8ACB\u60A8\u81EA\u5DF1\u7684 API \u6191\u64DA"),s()()(),r(70,"div",31)(71,"div",32)(72,"h3",33)(73,"span"),l(74,"\u{1F4CB}"),s(),l(75," \u6211\u7684 API \u5217\u8868 "),s()(),S(76,Cy,5,0,"div",34)(77,vy,7,0,"div",34)(78,wy,3,0,"div",35),s(),S(79,Ay,15,2,"div",36),s()),t&2&&(c(7),V("disabled",n.isLoading()),c(),I("animate-spin",n.isLoading()),c(10),A(n.credentials().length),c(5),A(n.activeCount()),c(5),A(n.totalAccountsUsed()),c(5),A(n.totalCapacity()),c(14),z("ngModel",n.newApiId),c(6),z("ngModel",n.newApiHash),c(4),z("ngModel",n.newApiName),c(2),V("disabled",!n.isFormValid()||n.isSaving()),c(),w(n.isSaving()?60:61),c(16),w(n.isLoading()?76:n.credentials().length===0?77:78),c(3),w(n.deleteTarget()?79:-1))},dependencies:[te,me,xe,_e,Ce],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}};var Dy=()=>["bronze","silver"],My=()=>["bronze","silver","gold"],Ty=(i,e)=>e.id;function ky(i,e){if(i&1&&(r(0,"p",10),l(1),r(2,"span",25),l(3),s()()),i&2){let t=g();c(),D(" \u6709\u6548\u671F\u81F3 ",t.formatDate(t.membershipExpires())," "),c(2),D("(\u5269\u9918 ",t.membershipDaysLeft()," \u5929)")}}function Iy(i,e){i&1&&(r(0,"p",10),l(1,"\u6C38\u4E45\u514D\u8CBB\u7248"),s())}function Py(i,e){if(i&1){let t=M();r(0,"button",26),x("click",function(){v(t);let o=g();return b(o.activeTab.set("upgrade"))}),l(1," \u{1F680} \u7ACB\u5373\u5347\u7D1A "),s()}}function Fy(i,e){if(i&1){let t=M();r(0,"div",24)(1,"div",27)(2,"h3",28),l(3,"\u{1F4CA} \u672C\u6708\u4F7F\u7528\u8A73\u60C5"),s(),r(4,"div",29)(5,"div",30)(6,"span",31),l(7,"\u{1F916} AI \u8ABF\u7528\u6B21\u6578"),s(),r(8,"div",32)(9,"div",33),k(10,"div",34),s()(),r(11,"span",35),l(12),s()(),r(13,"div",30)(14,"span",31),l(15,"\u{1F4E8} \u6D88\u606F\u767C\u9001"),s(),r(16,"div",32)(17,"div",33),k(18,"div",34),s()(),r(19,"span",35),l(20),s()(),r(21,"div",30)(22,"span",31),l(23,"\u{1F465} \u5E33\u865F\u6578\u91CF"),s(),r(24,"div",32)(25,"div",33),k(26,"div",34),s()(),r(27,"span",35),l(28),s()(),r(29,"div",30)(30,"span",31),l(31,"\u{1F4BE} \u5B58\u5132\u7A7A\u9593"),s(),r(32,"div",32)(33,"div",33),k(34,"div",34),s()(),r(35,"span",35),l(36),s()()()(),r(37,"div",36)(38,"h3",28),l(39,"\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5"),s(),r(40,"p",37),l(41,"\u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 "),r(42,"strong"),l(43,"3 \u5929\u767D\u9280\u7CBE\u82F1"),s(),l(44," \u734E\u52F5\uFF01"),s(),r(45,"div",38)(46,"span",39),l(47,"\u6211\u7684\u9080\u8ACB\u78BC"),s(),r(48,"span",40),l(49),s(),r(50,"button",41),x("click",function(){v(t);let o=g();return b(o.copyInviteCode())}),l(51,"\u{1F4CB} \u8907\u88FD"),s()(),r(52,"div",42)(53,"div",43)(54,"span",44),l(55),s(),r(56,"span",39),l(57,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),s()(),r(58,"div",43)(59,"span",44),l(60),s(),r(61,"span",39),l(62,"\u7372\u5F97\u734E\u52F5\u5929\u6578"),s()()()()()}if(i&2){let t,n,o,a,d=g();c(10),X("width",d.getAiUsagePercent(),"%"),c(2),Y("",((t=d.usageStats())==null||t.aiCalls==null?null:t.aiCalls.used)||0," / ",((t=d.usageStats())==null||t.aiCalls==null?null:t.aiCalls.limit)||50),c(6),X("width",d.getMessageUsagePercent(),"%"),c(2),Y("",((n=d.usageStats())==null||n.messagesSent==null?null:n.messagesSent.used)||0," / ",((n=d.usageStats())==null||n.messagesSent==null?null:n.messagesSent.limit)||100),c(6),X("width",d.getAccountUsagePercent(),"%"),c(2),Y("",((o=d.usageStats())==null||o.accounts==null?null:o.accounts.used)||0," / ",((o=d.usageStats())==null||o.accounts==null?null:o.accounts.limit)||2),c(6),X("width",d.getStorageUsagePercent(),"%"),c(2),Y("",((a=d.usageStats())==null||a.storage==null?null:a.storage.used)||0," MB / ",((a=d.usageStats())==null||a.storage==null?null:a.storage.limit)||10," MB"),c(13),A(d.inviteCode()),c(6),A(d.invitedCount()),c(5),A(d.rewardDays())}}function Ny(i,e){i&1&&(r(0,"div",24)(1,"div",45)(2,"table",46)(3,"thead")(4,"tr")(5,"th",47),l(6,"\u529F\u80FD"),s(),r(7,"th",48),l(8,"\u2694\uFE0F \u9752\u9285"),s(),r(9,"th",49),l(10,"\u{1F948} \u767D\u9280"),s(),r(11,"th",50),l(12,"\u{1F947} \u9EC3\u91D1"),s(),r(13,"th",51),l(14,"\u{1F48E} \u947D\u77F3"),s(),r(15,"th",52),l(16,"\u{1F31F} \u661F\u8000"),s(),r(17,"th",53),l(18,"\u{1F451} \u738B\u8005"),s()()(),r(19,"tbody")(20,"tr")(21,"td",54),l(22,"\u5E33\u865F\u6578\u91CF"),s(),r(23,"td"),l(24,"2 \u500B"),s(),r(25,"td"),l(26,"5 \u500B"),s(),r(27,"td"),l(28,"10 \u500B"),s(),r(29,"td"),l(30,"20 \u500B"),s(),r(31,"td"),l(32,"50 \u500B"),s(),r(33,"td"),l(34,"\u7121\u9650"),s()(),r(35,"tr")(36,"td",54),l(37,"\u6BCF\u65E5\u6D88\u606F"),s(),r(38,"td"),l(39,"20 \u689D"),s(),r(40,"td"),l(41,"100 \u689D"),s(),r(42,"td"),l(43,"300 \u689D"),s(),r(44,"td"),l(45,"1,000 \u689D"),s(),r(46,"td"),l(47,"\u7121\u9650"),s(),r(48,"td"),l(49,"\u7121\u9650"),s()(),r(50,"tr")(51,"td",54),l(52,"\u6BCF\u65E5 AI \u8ABF\u7528"),s(),r(53,"td"),l(54,"10 \u6B21"),s(),r(55,"td"),l(56,"50 \u6B21"),s(),r(57,"td"),l(58,"200 \u6B21"),s(),r(59,"td"),l(60,"\u7121\u9650"),s(),r(61,"td"),l(62,"\u7121\u9650"),s(),r(63,"td"),l(64,"\u7121\u9650"),s()(),r(65,"tr")(66,"td",54),l(67,"\u7FA4\u7D44\u6578\u91CF"),s(),r(68,"td"),l(69,"3 \u500B"),s(),r(70,"td"),l(71,"10 \u500B"),s(),r(72,"td"),l(73,"30 \u500B"),s(),r(74,"td"),l(75,"100 \u500B"),s(),r(76,"td"),l(77,"\u7121\u9650"),s(),r(78,"td"),l(79,"\u7121\u9650"),s()(),r(80,"tr")(81,"td",54),l(82,"\u5EE3\u544A\u767C\u9001"),s(),r(83,"td"),l(84,"\u274C"),s(),r(85,"td"),l(86,"\u2705"),s(),r(87,"td"),l(88,"\u2705"),s(),r(89,"td"),l(90,"\u2705"),s(),r(91,"td"),l(92,"\u2705"),s(),r(93,"td"),l(94,"\u2705"),s()(),r(95,"tr")(96,"td",54),l(97,"\u6279\u91CF\u64CD\u4F5C"),s(),r(98,"td"),l(99,"\u274C"),s(),r(100,"td"),l(101,"\u274C"),s(),r(102,"td"),l(103,"\u2705"),s(),r(104,"td"),l(105,"\u2705"),s(),r(106,"td"),l(107,"\u2705"),s(),r(108,"td"),l(109,"\u2705"),s()(),r(110,"tr")(111,"td",54),l(112,"AI \u92B7\u552E\u6F0F\u6597"),s(),r(113,"td"),l(114,"\u274C"),s(),r(115,"td"),l(116,"\u274C"),s(),r(117,"td"),l(118,"\u274C"),s(),r(119,"td"),l(120,"\u2705"),s(),r(121,"td"),l(122,"\u2705"),s(),r(123,"td"),l(124,"\u2705"),s()(),r(125,"tr")(126,"td",54),l(127,"\u667A\u80FD\u9632\u5C01"),s(),r(128,"td"),l(129,"\u274C"),s(),r(130,"td"),l(131,"\u274C"),s(),r(132,"td"),l(133,"\u274C"),s(),r(134,"td"),l(135,"\u274C"),s(),r(136,"td"),l(137,"\u2705"),s(),r(138,"td"),l(139,"\u2705"),s()(),r(140,"tr")(141,"td",54),l(142,"API \u63A5\u53E3"),s(),r(143,"td"),l(144,"\u274C"),s(),r(145,"td"),l(146,"\u274C"),s(),r(147,"td"),l(148,"\u274C"),s(),r(149,"td"),l(150,"\u274C"),s(),r(151,"td"),l(152,"\u274C"),s(),r(153,"td"),l(154,"\u2705"),s()(),r(155,"tr")(156,"td",54),l(157,"\u512A\u5148\u652F\u6301"),s(),r(158,"td"),l(159,"\u274C"),s(),r(160,"td"),l(161,"\u274C"),s(),r(162,"td"),l(163,"\u274C"),s(),r(164,"td"),l(165,"\u274C"),s(),r(166,"td"),l(167,"\u2705"),s(),r(168,"td"),l(169,"\u2705 \u5C08\u5C6C"),s()(),r(170,"tr",55)(171,"td",54),l(172,"\u50F9\u683C"),s(),r(173,"td",56),l(174,"\u514D\u8CBB"),s(),r(175,"td",56),l(176,"4.99 USDT/\u6708"),s(),r(177,"td",56),l(178,"19.9 USDT/\u6708"),s(),r(179,"td",56),l(180,"59.9 USDT/\u6708"),s(),r(181,"td",56),l(182,"199 USDT/\u6708"),s(),r(183,"td",56),l(184,"599 USDT/\u6708"),s()()()()()())}function Ry(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function Oy(i,e){if(i&1){let t=M();r(0,"button",80),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("silver","month"))}),l(1),s()}if(i&2){let t=g(2);c(),D(" ",t.membershipLevel()==="bronze"?"\u7ACB\u5373\u958B\u901A":"\u5207\u63DB\u65B9\u6848"," ")}}function By(i,e){if(i&1){let t=M();r(0,"button",81),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("silver","month"))}),l(1," \u7E8C\u8CBB "),s()}}function Vy(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function Ly(i,e){if(i&1){let t=M();r(0,"button",80),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("gold","month"))}),l(1),s()}if(i&2){let t=g(2);c(),D(" ",$t(1,Dy).includes(t.membershipLevel())?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function Gy(i,e){if(i&1){let t=M();r(0,"button",81),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("gold","month"))}),l(1," \u7E8C\u8CBB "),s()}}function Uy(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function qy(i,e){if(i&1){let t=M();r(0,"button",80),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("diamond","month"))}),l(1),s()}if(i&2){let t=g(2);c(),D(" ",$t(1,My).includes(t.membershipLevel())?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function $y(i,e){if(i&1){let t=M();r(0,"button",81),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("diamond","month"))}),l(1," \u7E8C\u8CBB "),s()}}function Hy(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function zy(i,e){if(i&1){let t=M();r(0,"button",80),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("star","month"))}),l(1),s()}if(i&2){let t=g(2);c(),D(" ",t.membershipLevel()!=="king"?"\u7ACB\u5373\u5347\u7D1A":"\u5207\u63DB\u65B9\u6848"," ")}}function Ky(i,e){if(i&1){let t=M();r(0,"button",81),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("star","month"))}),l(1," \u7E8C\u8CBB "),s()}}function Wy(i,e){i&1&&(r(0,"div",59),l(1,"\u7576\u524D\u65B9\u6848"),s())}function Jy(i,e){if(i&1){let t=M();r(0,"button",80),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("king","month"))}),l(1," \u7D42\u6975\u5347\u7D1A "),s()}}function Qy(i,e){if(i&1){let t=M();r(0,"button",81),x("click",function(){v(t);let o=g(2);return b(o.onPurchase("king","month"))}),l(1," \u7E8C\u8CBB "),s()}}function Yy(i,e){if(i&1){let t=M();r(0,"div",24)(1,"div",57)(2,"div",58),S(3,Ry,2,0,"div",59),r(4,"div",60),l(5,"\u{1F948}"),s(),r(6,"h3",61),l(7,"\u767D\u9280\u7CBE\u82F1"),s(),r(8,"div",62)(9,"span",63),l(10,"4.99 USDT"),s(),r(11,"span",64),l(12,"/\u6708"),s()(),r(13,"ul",65)(14,"li"),l(15,"\u2705 5 \u500B\u5E33\u865F"),s(),r(16,"li"),l(17,"\u2705 \u6BCF\u65E5 100 \u689D\u6D88\u606F"),s(),r(18,"li"),l(19,"\u2705 \u6BCF\u65E5 50 \u6B21 AI"),s(),r(20,"li"),l(21,"\u2705 10 \u500B\u7FA4\u7D44"),s(),r(22,"li"),l(23,"\u2705 \u5EE3\u544A\u767C\u9001"),s()(),S(24,Oy,2,1,"button",66)(25,By,2,0,"button",67),s(),r(26,"div",68),S(27,Vy,2,0,"div",59),r(28,"div",60),l(29,"\u{1F947}"),s(),r(30,"h3",61),l(31,"\u9EC3\u91D1\u5927\u5E2B"),s(),r(32,"div",62)(33,"span",63),l(34,"19.9 USDT"),s(),r(35,"span",64),l(36,"/\u6708"),s()(),r(37,"ul",65)(38,"li"),l(39,"\u2705 15 \u500B\u5E33\u865F"),s(),r(40,"li"),l(41,"\u2705 \u6BCF\u65E5 500 \u689D\u6D88\u606F"),s(),r(42,"li"),l(43,"\u2705 \u6BCF\u65E5 300 \u6B21 AI"),s(),r(44,"li"),l(45,"\u2705 50 \u500B\u7FA4\u7D44"),s(),r(46,"li"),l(47,"\u2705 \u6279\u91CF\u64CD\u4F5C"),s(),r(48,"li"),l(49,"\u2705 \u6578\u64DA\u5C0E\u51FA"),s()(),S(50,Ly,2,2,"button",66)(51,Gy,2,0,"button",67),s(),r(52,"div",69)(53,"div",70),l(54,"\u63A8\u85A6"),s(),S(55,Uy,2,0,"div",59),r(56,"div",60),l(57,"\u{1F48E}"),s(),r(58,"h3",61),l(59,"\u947D\u77F3\u738B\u724C"),s(),r(60,"div",62)(61,"span",63),l(62,"59.9 USDT"),s(),r(63,"span",64),l(64,"/\u6708"),s()(),r(65,"ul",65)(66,"li"),l(67,"\u2705 50 \u500B\u5E33\u865F"),s(),r(68,"li"),l(69,"\u2705 \u6BCF\u65E5 2000 \u689D\u6D88\u606F"),s(),r(70,"li"),l(71,"\u2705 \u7121\u9650 AI \u8ABF\u7528"),s(),r(72,"li"),l(73,"\u2705 200 \u500B\u7FA4\u7D44"),s(),r(74,"li"),l(75,"\u2705 AI \u92B7\u552E\u6F0F\u6597"),s(),r(76,"li"),l(77,"\u2705 \u9AD8\u7D1A\u5206\u6790"),s()(),S(78,qy,2,2,"button",66)(79,$y,2,0,"button",67),s(),r(80,"div",71),S(81,Hy,2,0,"div",59),r(82,"div",60),l(83,"\u{1F31F}"),s(),r(84,"h3",61),l(85,"\u661F\u8000\u50B3\u8AAA"),s(),r(86,"div",62)(87,"span",63),l(88,"199 USDT"),s(),r(89,"span",64),l(90,"/\u6708"),s()(),r(91,"ul",65)(92,"li"),l(93,"\u2705 100 \u500B\u5E33\u865F"),s(),r(94,"li"),l(95,"\u2705 \u7121\u9650\u6D88\u606F"),s(),r(96,"li"),l(97,"\u2705 \u7121\u9650 AI"),s(),r(98,"li"),l(99,"\u2705 \u7121\u9650\u7FA4\u7D44"),s(),r(100,"li"),l(101,"\u2705 \u667A\u80FD\u9632\u5C01"),s(),r(102,"li"),l(103,"\u2705 \u5718\u968A\u7BA1\u7406"),s()(),S(104,zy,2,1,"button",66)(105,Ky,2,0,"button",67),s(),r(106,"div",72),S(107,Wy,2,0,"div",59),r(108,"div",60),l(109,"\u{1F451}"),s(),r(110,"h3",61),l(111,"\u69AE\u8000\u738B\u8005"),s(),r(112,"div",62)(113,"span",63),l(114,"599 USDT"),s(),r(115,"span",64),l(116,"/\u6708"),s()(),r(117,"div",73),l(118,"\u5C0A\u4EAB\u7279\u6B0A"),s(),r(119,"ul",65)(120,"li"),l(121,"\u2705 \u7121\u9650\u5E33\u865F"),s(),r(122,"li"),l(123,"\u2705 \u7121\u9650\u4E00\u5207"),s(),r(124,"li"),l(125,"\u2705 API \u63A5\u53E3"),s(),r(126,"li"),l(127,"\u2705 \u81EA\u5B9A\u7FA9\u54C1\u724C"),s(),r(128,"li"),l(129,"\u2705 \u5C08\u5C6C\u9867\u554F"),s(),r(130,"li"),l(131,"\u2705 \u65B0\u529F\u80FD\u5167\u6E2C"),s()(),S(132,Jy,2,0,"button",66)(133,Qy,2,0,"button",67),s()(),r(134,"div",27)(135,"h3",28),l(136,"\u{1F3AB} \u4F7F\u7528\u5361\u5BC6\u6FC0\u6D3B"),s(),r(137,"div",74)(138,"input",75),W("ngModelChange",function(o){v(t);let a=g();return K(a.licenseKey,o)||(a.licenseKey=o),b(o)}),s(),r(139,"button",76),x("click",function(){v(t);let o=g();return b(o.onActivateLicense())}),l(140," \u6FC0\u6D3B "),s()()(),r(141,"div",27)(142,"h3",28),l(143,"\u{1F4B3} \u652F\u4ED8\u65B9\u5F0F"),s(),r(144,"div",77)(145,"button",78),x("click",function(){v(t);let o=g();return b(o.selectedPayment.set("alipay"))}),r(146,"span",79),l(147,"\u{1F499}"),s(),l(148," \u652F\u4ED8\u5BF6 "),s(),r(149,"button",78),x("click",function(){v(t);let o=g();return b(o.selectedPayment.set("wechat"))}),r(150,"span",79),l(151,"\u{1F49A}"),s(),l(152," \u5FAE\u4FE1\u652F\u4ED8 "),s(),r(153,"button",78),x("click",function(){v(t);let o=g();return b(o.selectedPayment.set("usdt"))}),r(154,"span",79),l(155,"\u{1F48E}"),s(),l(156," USDT "),s()()()()}if(i&2){let t=g();c(2),I("current",t.membershipLevel()==="silver"),c(),w(t.membershipLevel()==="silver"?3:-1),c(21),w(t.membershipLevel()!=="silver"?24:25),c(2),I("current",t.membershipLevel()==="gold"),c(),w(t.membershipLevel()==="gold"?27:-1),c(23),w(t.membershipLevel()!=="gold"?50:51),c(2),I("current",t.membershipLevel()==="diamond"),c(3),w(t.membershipLevel()==="diamond"?55:-1),c(23),w(t.membershipLevel()!=="diamond"?78:79),c(2),I("current",t.membershipLevel()==="star"),c(),w(t.membershipLevel()==="star"?81:-1),c(23),w(t.membershipLevel()!=="star"?104:105),c(2),I("current",t.membershipLevel()==="king"),c(),w(t.membershipLevel()==="king"?107:-1),c(25),w(t.membershipLevel()!=="king"?132:133),c(6),z("ngModel",t.licenseKey),c(),V("disabled",!t.licenseKey),c(6),I("active",t.selectedPayment()==="alipay"),c(4),I("active",t.selectedPayment()==="wechat"),c(4),I("active",t.selectedPayment()==="usdt")}}function Xy(i,e){i&1&&(r(0,"div",83),l(1,"\u8F09\u5165\u4E2D..."),s())}function Zy(i,e){i&1&&(r(0,"div",84),l(1,"\u66AB\u7121\u8A02\u95B1\u8A18\u9304"),s())}function jy(i,e){if(i&1&&(r(0,"div",85)(1,"div",86),l(2),s(),r(3,"div",87)(4,"div",88),l(5),s(),r(6,"div",89),l(7),s()(),r(8,"div",90),l(9),s()()),i&2){let t=e.$implicit,n=g(3);c(2),A(t.level_icon||"\u{1F3AB}"),c(3),Y("",t.level_name," ",t.duration_name,"\u6FC0\u6D3B"),c(2),D("",n.formatActivationDate(t.activated_at)," \xB7 \u5361\u5BC6\u6FC0\u6D3B"),c(),I("active",t.is_active)("used",!t.is_active),c(),D(" ",t.is_active?"\u751F\u6548\u4E2D":"\u5DF2\u904E\u671F"," ")}}function e2(i,e){if(i&1&&$(0,jy,10,9,"div",85,Ty),i&2){let t=g(2);H(t.subscriptionHistory())}}function t2(i,e){if(i&1&&(r(0,"div",24)(1,"div",27)(2,"h3",28),l(3,"\u{1F4DC} \u8A02\u95B1\u6B77\u53F2"),s(),r(4,"div",82),S(5,Xy,2,0,"div",83)(6,Zy,2,0,"div",84)(7,e2,2,0),s()()()),i&2){let t=g();c(5),w(t.isLoadingHistory()?5:t.subscriptionHistory().length===0?6:7)}}var $o=class i{constructor(){this.authService=O(xt);this.membershipService=O(Re);this.i18n=O(Xe);this.toast=O(ue);this.licenseClient=O(Ot);this.cdr=O(en);this.walletService=O(ll);this.router=O(It);this.membershipUpdateHandler=null;this.activeTab=_("overview");this.selectedPayment=_("alipay");this.licenseKey="";this.wallet=_(null);this.walletBalanceDisplay=G(()=>{let e=this.wallet();return e?"$"+(e.available_balance/100).toFixed(2):"$0.00"});this.walletBonusDisplay=G(()=>{let e=this.wallet();return e?"$"+((e.bonus_balance||0)/100).toFixed(2):"$0.00"});this.user=G(()=>this.authService.user());this.membershipLevel=G(()=>this.membershipService.level());this.membershipExpires=G(()=>this.authService.user()?.membershipExpires);this.membershipDaysLeft=G(()=>this.membershipService.daysRemaining());this.usageStats=G(()=>this.authService.usageStats());this.inviteCode=_("");this.invitedCount=_(0);this.rewardDays=_(0);this.subscriptionHistory=_([]);this.isLoadingHistory=_(!1)}async ngOnInit(){this.authService.loadUsageStats().catch(t=>console.warn("[Membership] Load usage stats error:",t));let e=await this.authService.getInviteRewards();this.inviteCode.set(e.inviteCode),this.invitedCount.set(e.invitedCount),this.rewardDays.set(e.rewardDays),await this.loadWallet(),await this.loadSubscriptionHistory(),this.membershipUpdateHandler=t=>{console.log("[MembershipCenterComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",t.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler)}ngOnDestroy(){this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler)}async loadSubscriptionHistory(){this.isLoadingHistory.set(!0);try{let e=await this.licenseClient.getActivationHistory(50,0);e.success&&e.data&&this.subscriptionHistory.set(e.data)}catch(e){console.error("\u8F09\u5165\u8A02\u95B1\u8A18\u9304\u5931\u6557:",e)}finally{this.isLoadingHistory.set(!1)}}async loadWallet(){try{let e=await this.walletService.loadWallet();e&&this.wallet.set(e)}catch(e){console.error("\u8F09\u5165\u9322\u5305\u5931\u6557:",e)}}goToWallet(){this.router.navigate(["/wallet"])}goToRecharge(){this.router.navigate(["/wallet/recharge"])}getMembershipIcon(){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[this.membershipLevel()]||"\u2694\uFE0F"}getMembershipName(){let e=this.membershipLevel();return this.i18n.t(`membershipLevels.${e}`)||this.i18n.t("membershipLevels.bronze")}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}getAiUsagePercent(){let e=this.usageStats();return e?.aiCalls?Math.min(100,e.aiCalls.used/e.aiCalls.limit*100):0}getMessageUsagePercent(){let e=this.usageStats();return e?.messagesSent?Math.min(100,e.messagesSent.used/e.messagesSent.limit*100):0}getAccountUsagePercent(){let e=this.usageStats();return e?.accounts?Math.min(100,e.accounts.used/e.accounts.limit*100):0}getStorageUsagePercent(){let e=this.usageStats();return e?.storage?Math.min(100,e.storage.used/e.storage.limit*100):0}copyInviteCode(){navigator.clipboard.writeText(this.inviteCode()),this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD")}onPurchase(e,t){this.toast.info(`\u6B63\u5728\u8DF3\u8F49\u5230\u652F\u4ED8\u9801\u9762... (${e} ${t})`)}async onActivateLicense(){let e=await this.authService.renewMembership(this.licenseKey);e.success?(this.toast.success(e.message||"\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01"),this.licenseKey="",await this.loadSubscriptionHistory(),this.cdr.detectChanges()):this.toast.error(e.message)}formatActivationDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-membership-center"]],decls:72,vars:32,consts:[[1,"membership-container"],[1,"page-header"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"membership-status-card"],[1,"status-left"],[1,"level-badge"],[1,"level-info"],["size","lg",3,"level"],[1,"expires-info"],[1,"status-right"],[1,"upgrade-btn"],[1,"quick-stats"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-label"],[1,"stat-value"],[1,"stat-bar"],[1,"stat-fill"],[1,"stat-hint"],[1,"tabs"],[1,"tab-btn",3,"click"],[1,"tab-content"],[1,"days-left"],[1,"upgrade-btn",3,"click"],[1,"section-card"],[1,"section-title"],[1,"usage-details"],[1,"usage-row"],[1,"usage-name"],[1,"usage-bar-container"],[1,"usage-bar"],[1,"usage-fill"],[1,"usage-count"],[1,"section-card","invite-card"],[1,"invite-desc"],[1,"invite-code-display"],[1,"label"],[1,"code"],[1,"copy-btn",3,"click"],[1,"invite-stats-row"],[1,"invite-stat"],[1,"value"],[1,"benefits-table-container"],[1,"benefits-table"],[1,"feature-col"],[1,"level-col","bronze"],[1,"level-col","silver"],[1,"level-col","gold"],[1,"level-col","diamond"],[1,"level-col","star"],[1,"level-col","king"],[1,"feature-name"],[1,"price-row"],[1,"price"],[1,"pricing-cards"],[1,"pricing-card","silver"],[1,"current-badge"],[1,"plan-icon"],[1,"plan-name"],[1,"plan-price"],[1,"amount"],[1,"period"],[1,"plan-features"],[1,"buy-btn"],[1,"buy-btn","renew"],[1,"pricing-card","gold"],[1,"pricing-card","diamond","popular"],[1,"popular-badge"],[1,"pricing-card","star"],[1,"pricing-card","king"],[1,"savings"],[1,"license-input-row"],["type","text","placeholder","\u8F38\u5165\u5361\u5BC6\uFF1AXXXX-XXXX-XXXX-XXXX",1,"license-input",3,"ngModelChange","ngModel"],[1,"activate-btn",3,"click","disabled"],[1,"payment-methods"],[1,"payment-btn",3,"click"],[1,"payment-icon"],[1,"buy-btn",3,"click"],[1,"buy-btn","renew",3,"click"],[1,"history-list"],[1,"loading-state"],[1,"empty-state"],[1,"history-item"],[1,"history-icon"],[1,"history-info"],[1,"history-title"],[1,"history-meta"],[1,"history-status"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2)(3,"span",3),l(4,"\u2B50"),s(),l(5," \u6703\u54E1\u4E2D\u5FC3 "),s(),r(6,"p",4),l(7,"\u7BA1\u7406\u60A8\u7684\u6703\u54E1\u6B0A\u76CA\u548C\u8A02\u95B1"),s()(),r(8,"div",5)(9,"div",6)(10,"div",7),l(11),s(),r(12,"div",8),k(13,"user-level-badge",9),S(14,ky,4,2,"p",10)(15,Iy,2,0,"p",10),s()(),r(16,"div",11),S(17,Py,2,0,"button",12),s()(),r(18,"div",13)(19,"div",14)(20,"div",15),l(21,"\u{1F916}"),s(),r(22,"div",16)(23,"div",17),l(24,"AI \u8ABF\u7528"),s(),r(25,"div",18),l(26),s(),r(27,"div",19),k(28,"div",20),s()()(),r(29,"div",14)(30,"div",15),l(31,"\u{1F4E8}"),s(),r(32,"div",16)(33,"div",17),l(34,"\u6D88\u606F\u767C\u9001"),s(),r(35,"div",18),l(36),s(),r(37,"div",19),k(38,"div",20),s()()(),r(39,"div",14)(40,"div",15),l(41,"\u{1F465}"),s(),r(42,"div",16)(43,"div",17),l(44,"\u5E33\u865F\u6578\u91CF"),s(),r(45,"div",18),l(46),s(),r(47,"div",19),k(48,"div",20),s()()(),r(49,"div",14)(50,"div",15),l(51,"\u{1F381}"),s(),r(52,"div",16)(53,"div",17),l(54,"\u9080\u8ACB\u734E\u52F5"),s(),r(55,"div",18),l(56),s(),r(57,"div",21),l(58),s()()()(),r(59,"div",22)(60,"button",23),x("click",function(){return n.activeTab.set("overview")}),l(61," \u{1F4CA} \u7E3D\u89BD "),s(),r(62,"button",23),x("click",function(){return n.activeTab.set("benefits")}),l(63," \u{1F3AF} \u6B0A\u76CA\u5C0D\u6BD4 "),s(),r(64,"button",23),x("click",function(){return n.activeTab.set("upgrade")}),l(65," \u{1F680} \u5347\u7D1A\u8CFC\u8CB7 "),s(),r(66,"button",23),x("click",function(){return n.activeTab.set("history")}),l(67," \u{1F4DC} \u8A02\u95B1\u8A18\u9304 "),s()(),S(68,Fy,63,19,"div",24),S(69,Ny,185,0,"div",24),S(70,Yy,157,28,"div",24),S(71,t2,8,1,"div",24),s()),t&2){let o,a,d;c(8),de("level-"+n.membershipLevel()),c(3),D(" ",n.getMembershipIcon()," "),c(2),V("level",n.membershipLevel()),c(),w(n.membershipExpires()?14:15),c(3),w(n.membershipLevel()!=="king"?17:-1),c(9),Y(" ",((o=n.usageStats())==null||o.aiCalls==null?null:o.aiCalls.used)||0," / ",((o=n.usageStats())==null||o.aiCalls==null?null:o.aiCalls.limit)||50," "),c(2),X("width",n.getAiUsagePercent(),"%"),c(8),Y(" ",((a=n.usageStats())==null||a.messagesSent==null?null:a.messagesSent.used)||0," / ",((a=n.usageStats())==null||a.messagesSent==null?null:a.messagesSent.limit)||100," "),c(2),X("width",n.getMessageUsagePercent(),"%"),c(8),Y(" ",((d=n.usageStats())==null||d.accounts==null?null:d.accounts.used)||0," / ",((d=n.usageStats())==null||d.accounts==null?null:d.accounts.limit)||2," "),c(2),X("width",n.getAccountUsagePercent(),"%"),c(8),D("",n.invitedCount()," \u4EBA"),c(2),D("\u5DF2\u7372 ",n.rewardDays()," \u5929\u734E\u52F5"),c(2),I("active",n.activeTab()==="overview"),c(2),I("active",n.activeTab()==="benefits"),c(2),I("active",n.activeTab()==="upgrade"),c(2),I("active",n.activeTab()==="history"),c(2),w(n.activeTab()==="overview"?68:-1),c(),w(n.activeTab()==="benefits"?69:-1),c(),w(n.activeTab()==="upgrade"?70:-1),c(),w(n.activeTab()==="history"?71:-1)}},dependencies:[te,me,xe,_e,Ce,Vt],styles:[".membership-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary, white);display:flex;align-items:center;gap:.5rem;margin:0}.title-icon[_ngcontent-%COMP%]{font-size:1.75rem}.page-desc[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);margin:.5rem 0 0}.membership-status-card[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-radius:1rem;margin-bottom:1.5rem;border:1px solid}.membership-status-card.level-free[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4755694d,#3341554d);border-color:#47556980}.membership-status-card.level-vip[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b33,#d9770633);border-color:#f59e0b80}.membership-status-card.level-svip[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf633,#7c3aed33);border-color:#8b5cf680}.membership-status-card.level-mvp[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ec489933,#db277733);border-color:#ec489980}.wallet-card[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-radius:1rem;margin-bottom:1.5rem;background:linear-gradient(135deg,#667eea33,#764ba233);border:1px solid rgba(102,126,234,.5);cursor:pointer;transition:all .2s}.wallet-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea4d}.wallet-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.wallet-icon[_ngcontent-%COMP%]{font-size:2rem}.wallet-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-muted, #94a3b8)}.wallet-amount[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#22c55e}.wallet-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.wallet-bonus[_ngcontent-%COMP%]{font-size:.875rem;color:#f59e0b;background:#f59e0b1a;padding:.25rem .75rem;border-radius:1rem}.wallet-recharge-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:.5rem;border:none;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:500;cursor:pointer;transition:all .2s}.wallet-recharge-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.status-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.level-badge[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:#ffffff1a;display:flex;align-items:center;justify-content:center;font-size:2rem}.level-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0}.expires-info[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);margin:.25rem 0 0}.days-left[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.upgrade-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.75rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s}.upgrade-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 20px -10px #06b6d480}.quick-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.75rem}.stat-icon[_ngcontent-%COMP%]{font-size:1.5rem}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.75rem}.stat-value[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white)}.stat-bar[_ngcontent-%COMP%]{height:4px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:2px;margin-top:.5rem;overflow:hidden}.stat-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:2px}.stat-hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b)}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;flex-wrap:wrap}.tab-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s}.tab-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4)}.tab-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);border-color:transparent;color:#fff}.section-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;padding:1.5rem;margin-bottom:1rem}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary, white);margin:0 0 1rem}.usage-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.usage-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.usage-name[_ngcontent-%COMP%]{width:150px;color:var(--text-secondary, #cbd5e1)}.usage-bar-container[_ngcontent-%COMP%]{flex:1}.usage-bar[_ngcontent-%COMP%]{height:8px;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:4px;overflow:hidden}.usage-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:4px}.usage-count[_ngcontent-%COMP%]{width:100px;text-align:right;color:var(--text-muted, #94a3b8);font-size:.875rem}.invite-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border-color:#06b6d44d}.invite-desc[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);margin-bottom:1rem}.invite-code-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;margin-bottom:1rem}.invite-code-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.invite-code-display[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{flex:1;font-family:monospace;font-size:1.25rem;font-weight:600;color:var(--primary, #06b6d4)}.copy-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary-bg, rgba(6, 182, 212, .1));border:1px solid var(--primary, #06b6d4);border-radius:.5rem;color:var(--primary, #06b6d4);cursor:pointer}.invite-stats-row[_ngcontent-%COMP%]{display:flex;gap:2rem}.invite-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.invite-stat[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--primary, #06b6d4)}.invite-stat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem}.benefits-table-container[_ngcontent-%COMP%]{overflow-x:auto}.benefits-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:center;border-bottom:1px solid var(--border-default, rgba(148, 163, 184, .1))}.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:var(--bg-tertiary, rgba(15, 23, 42, .5));color:var(--text-primary, white);font-weight:600}.benefits-table[_ngcontent-%COMP%]   .feature-col[_ngcontent-%COMP%]{text-align:left;min-width:150px}.benefits-table[_ngcontent-%COMP%]   .feature-name[_ngcontent-%COMP%]{text-align:left;color:var(--text-secondary, #cbd5e1)}.benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--text-primary, white)}.benefits-table[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-weight:600;color:var(--primary, #06b6d4)}.pricing-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:1.5rem}.pricing-card[_ngcontent-%COMP%]{position:relative;padding:2rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:2px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;text-align:center}.pricing-card.vip[_ngcontent-%COMP%]{border-color:#f59e0b4d}.pricing-card.svip[_ngcontent-%COMP%]{border-color:#8b5cf64d}.pricing-card.mvp[_ngcontent-%COMP%]{border-color:#ec48994d}.pricing-card.popular[_ngcontent-%COMP%]{transform:scale(1.02);box-shadow:0 20px 40px -20px #8b5cf64d}.pricing-card.current[_ngcontent-%COMP%]{border-width:3px}.popular-badge[_ngcontent-%COMP%]{position:absolute;top:-12px;left:50%;transform:translate(-50%);padding:.25rem 1rem;background:linear-gradient(135deg,#8b5cf6,#7c3aed);border-radius:1rem;color:#fff;font-size:.75rem;font-weight:600}.current-badge[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;padding:.25rem .5rem;background:var(--success, #22c55e);border-radius:.25rem;color:#fff;font-size:.625rem;font-weight:600}.plan-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.plan-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0 0 .5rem}.plan-price[_ngcontent-%COMP%]{margin-bottom:.5rem}.plan-price[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--primary, #06b6d4)}.plan-price[_ngcontent-%COMP%]   .period[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8)}.savings[_ngcontent-%COMP%]{font-size:.75rem;color:var(--success, #22c55e);margin-bottom:1rem}.plan-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:1rem 0;text-align:left}.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.5rem 0;color:var(--text-secondary, #cbd5e1)}.buy-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer}.buy-btn.renew[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a)}.license-input-row[_ngcontent-%COMP%]{display:flex;gap:.5rem}.license-input[_ngcontent-%COMP%]{flex:1;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-family:monospace}.activate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer}.activate-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.payment-methods[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.payment-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer;display:flex;align-items:center;gap:.5rem}.payment-btn.active[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4);background:#06b6d41a}.history-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.history-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem}.history-icon[_ngcontent-%COMP%]{font-size:1.5rem}.history-info[_ngcontent-%COMP%]{flex:1}.history-title[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white)}.history-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8)}.history-status[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.history-status.active[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.history-status.used[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}"]})}};var Ho=class i{constructor(){this._deviceCode=_(null);this._deviceDetails=_(null);this.deviceCode=G(()=>this._deviceCode());this.deviceDetails=G(()=>this._deviceDetails());this.initDeviceInfo()}async initDeviceInfo(){try{let e=await this.collectDeviceDetails();this._deviceDetails.set(e);let t=await this.generateDeviceCode(e);this._deviceCode.set(t)}catch(e){console.error("\u521D\u59CB\u5316\u8A2D\u5099\u4FE1\u606F\u5931\u6557:",e),this._deviceCode.set(this.generateFallbackDeviceCode())}}async getDeviceCode(){return this._deviceCode()?this._deviceCode():(await new Promise(e=>{let t=setInterval(()=>{this._deviceCode()&&(clearInterval(t),e())},100);setTimeout(()=>{clearInterval(t),this._deviceCode()||this._deviceCode.set(this.generateFallbackDeviceCode()),e()},3e3)}),this._deviceCode())}async collectDeviceDetails(){if(typeof window<"u"&&window.electronAPI!==void 0)try{let t=await window.electronAPI.invoke("get-system-info");if(t)return{platform:t.platform||"unknown",arch:t.arch||"unknown",hostname:t.hostname||"unknown",cpuModel:t.cpuModel||"unknown",cpuCores:t.cpuCores||1,totalMemory:t.totalMemory||0,osType:t.osType||"unknown",osVersion:t.osVersion||"unknown",username:t.username||"unknown",screenResolution:`${window.screen.width}x${window.screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language}}catch(t){console.warn("\u7121\u6CD5\u5F9E Electron \u7372\u53D6\u7CFB\u7D71\u4FE1\u606F:",t)}return{platform:navigator.platform||"web",arch:this.detectArch(),hostname:"browser",cpuModel:"unknown",cpuCores:navigator.hardwareConcurrency||1,totalMemory:navigator.deviceMemory||0,osType:this.detectOS(),osVersion:"unknown",username:"webuser",screenResolution:`${window.screen.width}x${window.screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language}}async generateDeviceCode(e){let t=[e.platform,e.arch,e.hostname,e.cpuCores.toString(),e.totalMemory.toString(),e.osType,e.screenResolution,e.timezone,e.language,this.getCanvasFingerprint(),this.getWebGLFingerprint()].join("|"),o=(await this.sha256(t)).substr(0,16).toUpperCase();return`TGM-${o.substr(0,4)}-${o.substr(4,4)}-${o.substr(8,4)}-${o.substr(12,4)}`}generateFallbackDeviceCode(){let e=localStorage.getItem("tgm_device_code");if(e)return e;let t=Math.random().toString(36).substr(2,16).toUpperCase(),n=`TGM-${t.substr(0,4)}-${t.substr(4,4)}-${t.substr(8,4)}-${t.substr(12,4)}`;return localStorage.setItem("tgm_device_code",n),n}async sha256(e){if(typeof crypto<"u"&&crypto.subtle){let t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("")}return this.simpleHash(e)}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);t=(t<<5)-t+o,t=t&t}return Math.abs(t).toString(16).padStart(16,"0")}detectOS(){let e=navigator.userAgent;return e.indexOf("Win")!==-1?"Windows":e.indexOf("Mac")!==-1?"macOS":e.indexOf("Linux")!==-1?"Linux":e.indexOf("Android")!==-1?"Android":e.indexOf("iOS")!==-1?"iOS":"Unknown"}detectArch(){let e=navigator.platform;return e.indexOf("64")!==-1?"x64":e.indexOf("ARM")!==-1?"arm":"x86"}getCanvasFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("TG-AI\u667A\u63A7\u738B",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("fingerprint",4,17),e.toDataURL().substr(-50)):"no-canvas"}catch{return"canvas-error"}}getWebGLFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"no-webgl";let n=t.getExtension("WEBGL_debug_renderer_info");if(n){let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),a=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return`${o}|${a}`.substr(0,50)}return"webgl-no-debug"}catch{return"webgl-error"}}getDeviceName(){let e=this._deviceDetails();if(!e)return"\u672A\u77E5\u8A2D\u5099";let t=e.osType,n=e.platform;return t==="Windows"?`Windows PC (${e.cpuCores} \u6838\u5FC3)`:t==="macOS"?`Mac (${e.cpuCores} \u6838\u5FC3)`:t==="Linux"?`Linux (${e.hostname})`:`${n} \u8A2D\u5099`}getShortDeviceId(){let e=this._deviceCode();return e?e.substr(4,9):"..."}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Td=(i,e)=>e.id;function n2(i,e){i&1&&(r(0,"div",1),k(1,"div",17),r(2,"span"),l(3,"\u6B63\u5728\u52A0\u8F09\u7528\u6236\u4FE1\u606F..."),s()())}function i2(i,e){if(i&1){let t=M();r(0,"div",2)(1,"span",18),l(2,"\u26A0\uFE0F"),s(),r(3,"span"),l(4),s(),r(5,"button",19),x("click",function(){v(t);let o=g();return b(o.ensureUserLoaded())}),l(6,"\u91CD\u8A66"),s()()}if(i&2){let t=g();c(4),A(t.userLoadError())}}function o2(i,e){if(i&1&&(r(0,"p",8),l(1),s()),i&2){let t,n=g();c(),D("\u767B\u5165\u5E33\u865F\uFF1A",(t=n.user())==null?null:t.username)}}function r2(i,e){if(i&1&&(r(0,"span",12),l(1),s()),i&2){let t=g();c(),D("\xB7 \u5269\u9918 ",t.membershipDaysLeft()," \u5929")}}function s2(i,e){i&1&&(k(0,"span",20),l(1," \u9000\u51FA\u4E2D... "))}function a2(i,e){i&1&&l(0," \u{1F6AA} \u9000\u51FA ")}function l2(i,e){if(i&1){let t=M();r(0,"button",38),x("click",function(){v(t);let o=g(2);return b(o.copyTelegramId())}),l(1,"\u{1F4CB}"),s()}}function c2(i,e){i&1&&(k(0,"span",51),l(1," \u4FDD\u5B58\u4E2D... "))}function d2(i,e){i&1&&l(0," \u78BA\u8A8D\u4FEE\u6539 ")}function u2(i,e){if(i&1){let t=M();r(0,"div",39),x("click",function(){v(t);let o=g(2);return b(o.closeEmailEditor())}),r(1,"div",40),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",41)(3,"h3"),l(4,"\u{1F4E7} \u4FEE\u6539\u90F5\u7BB1"),s(),r(5,"button",42),x("click",function(){v(t);let o=g(2);return b(o.closeEmailEditor())}),l(6,"\xD7"),s()(),r(7,"div",43)(8,"div",44)(9,"label"),l(10,"\u65B0\u90F5\u7BB1\u5730\u5740"),s(),r(11,"input",45),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.emailForm.newEmail,o)||(a.emailForm.newEmail=o),b(o)}),s()(),r(12,"div",44)(13,"label"),l(14,"\u7576\u524D\u5BC6\u78BC\uFF08\u9A57\u8B49\u8EAB\u4EFD\uFF09"),s(),r(15,"input",46),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.emailForm.password,o)||(a.emailForm.password=o),b(o)}),s()(),r(16,"p",47),l(17,"\u26A0\uFE0F \u4FEE\u6539\u90F5\u7BB1\u9700\u8981\u9A57\u8B49\u7576\u524D\u5BC6\u78BC"),s()(),r(18,"div",48)(19,"button",49),x("click",function(){v(t);let o=g(2);return b(o.closeEmailEditor())}),l(20,"\u53D6\u6D88"),s(),r(21,"button",50),x("click",function(){v(t);let o=g(2);return b(o.onSaveEmail())}),S(22,c2,2,0)(23,d2,1,0),s()()()()}if(i&2){let t=g(2);c(11),z("ngModel",t.emailForm.newEmail),c(4),z("ngModel",t.emailForm.password),c(6),V("disabled",t.isSavingEmail()),c(),w(t.isSavingEmail()?22:23)}}function m2(i,e){i&1&&(k(0,"span",51),l(1," \u4FDD\u5B58\u4E2D... "))}function p2(i,e){i&1&&l(0," \u78BA\u8A8D\u4FEE\u6539 ")}function g2(i,e){if(i&1){let t=M();r(0,"div",39),x("click",function(){v(t);let o=g(2);return b(o.closeDisplayNameEditor())}),r(1,"div",40),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",41)(3,"h3"),l(4,"\u270F\uFE0F \u4FEE\u6539\u986F\u793A\u540D\u7A31"),s(),r(5,"button",42),x("click",function(){v(t);let o=g(2);return b(o.closeDisplayNameEditor())}),l(6,"\xD7"),s()(),r(7,"div",43)(8,"div",44)(9,"label"),l(10,"\u986F\u793A\u540D\u7A31"),s(),r(11,"input",52),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.displayNameForm.newName,o)||(a.displayNameForm.newName=o),b(o)}),s()(),r(12,"p",47),l(13,"\u{1F4A1} \u986F\u793A\u540D\u7A31\u6703\u5728\u83DC\u55AE\u6B04\u548C\u500B\u4EBA\u4E2D\u5FC3\u986F\u793A\uFF0C\u6700\u591A30\u500B\u5B57\u7B26"),s()(),r(14,"div",48)(15,"button",49),x("click",function(){v(t);let o=g(2);return b(o.closeDisplayNameEditor())}),l(16,"\u53D6\u6D88"),s(),r(17,"button",50),x("click",function(){v(t);let o=g(2);return b(o.onSaveDisplayName())}),S(18,m2,2,0)(19,p2,1,0),s()()()()}if(i&2){let t=g(2);c(11),z("ngModel",t.displayNameForm.newName),c(6),V("disabled",t.isSavingDisplayName()),c(),w(t.isSavingDisplayName()?18:19)}}function h2(i,e){if(i&1){let t=M();r(0,"div",37)(1,"div",44)(2,"label"),l(3,"\u7576\u524D\u5BC6\u78BC"),s(),r(4,"input",53),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.passwordForm.oldPassword,o)||(a.passwordForm.oldPassword=o),b(o)}),s()(),r(5,"div",44)(6,"label"),l(7,"\u65B0\u5BC6\u78BC"),s(),r(8,"input",53),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.passwordForm.newPassword,o)||(a.passwordForm.newPassword=o),b(o)}),s()(),r(9,"div",44)(10,"label"),l(11,"\u78BA\u8A8D\u65B0\u5BC6\u78BC"),s(),r(12,"input",53),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.passwordForm.confirmPassword,o)||(a.passwordForm.confirmPassword=o),b(o)}),s()(),r(13,"div",54)(14,"button",49),x("click",function(){v(t);let o=g(2);return b(o.showChangePassword.set(!1))}),l(15,"\u53D6\u6D88"),s(),r(16,"button",55),x("click",function(){v(t);let o=g(2);return b(o.onChangePassword())}),l(17,"\u78BA\u8A8D\u4FEE\u6539"),s()()()}if(i&2){let t=g(2);c(4),z("ngModel",t.passwordForm.oldPassword),c(4),z("ngModel",t.passwordForm.newPassword),c(4),z("ngModel",t.passwordForm.confirmPassword)}}function f2(i,e){if(i&1){let t=M();r(0,"div",16)(1,"div",21)(2,"h3",22),l(3,"\u{1F4CB} \u57FA\u672C\u4FE1\u606F"),s(),r(4,"div",23)(5,"div",24)(6,"span",25),l(7,"Telegram ID"),s(),r(8,"span",26)(9,"span",27),l(10),s(),S(11,l2,2,0,"button",28),s()(),r(12,"div",24)(13,"span",25),l(14,"\u986F\u793A\u540D\u7A31"),s(),r(15,"span",29),l(16),s(),r(17,"button",30),x("click",function(){v(t);let o=g();return b(o.openDisplayNameEditor())}),l(18,"\u7DE8\u8F2F"),s()(),r(19,"div",24)(20,"span",25),l(21,"\u7528\u6236\u540D"),s(),r(22,"span",31),l(23),s(),r(24,"span",32),l(25,"\u767B\u5165\u7528\uFF0C\u4E0D\u53EF\u4FEE\u6539"),s()(),r(26,"div",24)(27,"span",25),l(28,"\u90F5\u7BB1"),s(),r(29,"span",29),l(30),s(),r(31,"button",30),x("click",function(){v(t);let o=g();return b(o.openEmailEditor())}),l(32,"\u7DE8\u8F2F"),s()(),r(33,"div",24)(34,"span",25),l(35,"\u8A3B\u518A\u6642\u9593"),s(),r(36,"span",29),l(37),s()(),r(38,"div",24)(39,"span",25),l(40,"\u6700\u5F8C\u767B\u5165"),s(),r(41,"span",29),l(42),s()()()(),S(43,u2,24,4,"div",33),S(44,g2,20,3,"div",33),r(45,"div",21)(46,"h3",22),l(47,"\u{1F510} \u5B89\u5168\u8A2D\u7F6E"),s(),r(48,"div",34)(49,"button",35),x("click",function(){v(t);let o=g();return b(o.showChangePassword.set(!0))}),l(50," \u{1F511} \u4FEE\u6539\u5BC6\u78BC "),s(),r(51,"button",36),l(52," \u{1F4F1} \u5169\u6B65\u9A57\u8B49 "),s()(),S(53,h2,18,3,"div",37),s()()}if(i&2){let t,n,o,a,d,m,f,h=g();c(10),A(((t=h.user())==null?null:t.telegramId)||"\u672A\u7D81\u5B9A"),c(),w((n=h.user())!=null&&n.telegramId?11:-1),c(5),A(((o=h.user())==null?null:o.displayName)||((o=h.user())==null?null:o.username)||"\u672A\u8A2D\u7F6E"),c(7),A((a=h.user())==null?null:a.username),c(7),A(((d=h.user())==null?null:d.email)||"\u672A\u8A2D\u7F6E"),c(7),A(h.formatDate((m=h.user())==null?null:m.createdAt)),c(5),A(h.formatDate((f=h.user())==null?null:f.lastLogin)),c(),w(h.showEditEmail()?43:-1),c(),w(h.showEditDisplayName()?44:-1),c(9),w(h.showChangePassword()?53:-1)}}function _2(i,e){i&1&&(r(0,"div",60),l(1,"\u8F09\u5165\u4E2D..."),s())}function C2(i,e){i&1&&(r(0,"div",61),l(1,"\u66AB\u7121\u6FC0\u6D3B\u8A18\u9304"),s())}function v2(i,e){if(i&1&&(r(0,"div",73)(1,"div",74)(2,"span",75),l(3),s(),r(4,"span",76),l(5),s()(),r(6,"div",77)(7,"span"),l(8),s(),r(9,"span",78),l(10),s()()()),i&2){let t=e.$implicit,n=g(3);c(3),A(n.formatLicenseKey(t.license_key)),c(2),st("",t.level_icon," ",t.level_name," ",t.duration_name),c(3),D("",n.formatActivationDate(t.activated_at)," \u6FC0\u6D3B"),c(),I("active",t.is_active)("used",!t.is_active),c(),D(" ",t.is_active?"\u6709\u6548":"\u5DF2\u904E\u671F"," ")}}function b2(i,e){if(i&1&&$(0,v2,11,10,"div",73,Td),i&2){let t=g(2);H(t.activationHistory())}}function x2(i,e){if(i&1){let t=M();r(0,"div",16)(1,"div",21)(2,"h3",22),l(3,"\u{1F3AB} \u6FC0\u6D3B\u65B0\u5361\u5BC6"),s(),r(4,"div",56)(5,"input",57),W("ngModelChange",function(o){v(t);let a=g();return K(a.newLicenseKey,o)||(a.newLicenseKey=o),b(o)}),s(),r(6,"button",58),x("click",function(){v(t);let o=g();return b(o.onActivateLicense())}),l(7," \u6FC0\u6D3B "),s()(),r(8,"p",47),l(9,"\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u4EE5\u7E8C\u8CBB\u6216\u5347\u7D1A\u6703\u54E1"),s()(),r(10,"div",21)(11,"h3",22),l(12,"\u{1F4DC} \u6FC0\u6D3B\u8A18\u9304"),s(),r(13,"div",59),S(14,_2,2,0,"div",60)(15,C2,2,0,"div",61)(16,b2,2,0),s()(),r(17,"div",21)(18,"h3",22),l(19,"\u{1F6D2} \u8CFC\u8CB7\u5361\u5BC6\uFF08\u738B\u8005\u69AE\u8000\u7B49\u7D1A\uFF09"),s(),r(20,"div",62)(21,"div",63)(22,"div",64),l(23,"\u{1F948} \u767D\u9280\u7CBE\u82F1"),s(),r(24,"div",65),l(25,"4.99 USDT/\u6708"),s(),r(26,"ul",66)(27,"li"),l(28,"5 \u500B\u5E33\u865F"),s(),r(29,"li"),l(30,"\u6BCF\u65E5 100 \u689D\u6D88\u606F"),s(),r(31,"li"),l(32,"\u6BCF\u65E5 50 \u6B21 AI"),s(),r(33,"li"),l(34,"10 \u500B\u7FA4\u7D44"),s()(),r(35,"button",67),l(36,"\u8CFC\u8CB7"),s()(),r(37,"div",68)(38,"div",64),l(39,"\u{1F947} \u9EC3\u91D1\u5927\u5E2B"),s(),r(40,"div",65),l(41,"19.9 USDT/\u6708"),s(),r(42,"div",69),l(43,"\u63A8\u85A6"),s(),r(44,"ul",66)(45,"li"),l(46,"15 \u500B\u5E33\u865F"),s(),r(47,"li"),l(48,"\u6BCF\u65E5 500 \u689D\u6D88\u606F"),s(),r(49,"li"),l(50,"\u6BCF\u65E5 300 \u6B21 AI"),s(),r(51,"li"),l(52,"\u6279\u91CF\u64CD\u4F5C"),s()(),r(53,"button",67),l(54,"\u8CFC\u8CB7"),s()(),r(55,"div",70)(56,"div",64),l(57,"\u{1F48E} \u947D\u77F3\u738B\u724C"),s(),r(58,"div",65),l(59,"59.9 USDT/\u6708"),s(),r(60,"ul",66)(61,"li"),l(62,"50 \u500B\u5E33\u865F"),s(),r(63,"li"),l(64,"\u6BCF\u65E5 2000 \u689D\u6D88\u606F"),s(),r(65,"li"),l(66,"\u7121\u9650 AI \u8ABF\u7528"),s(),r(67,"li"),l(68,"AI \u92B7\u552E\u6F0F\u6597"),s()(),r(69,"button",67),l(70,"\u8CFC\u8CB7"),s()(),r(71,"div",71)(72,"div",64),l(73,"\u{1F31F} \u661F\u8000\u50B3\u8AAA"),s(),r(74,"div",65),l(75,"199 USDT/\u6708"),s(),r(76,"ul",66)(77,"li"),l(78,"100 \u500B\u5E33\u865F"),s(),r(79,"li"),l(80,"\u7121\u9650\u6D88\u606F"),s(),r(81,"li"),l(82,"\u5718\u968A\u7BA1\u7406"),s(),r(83,"li"),l(84,"\u667A\u80FD\u9632\u5C01"),s()(),r(85,"button",67),l(86,"\u8CFC\u8CB7"),s()(),r(87,"div",72)(88,"div",64),l(89,"\u{1F451} \u69AE\u8000\u738B\u8005"),s(),r(90,"div",65),l(91,"599 USDT/\u6708"),s(),r(92,"ul",66)(93,"li"),l(94,"\u7121\u9650\u5E33\u865F"),s(),r(95,"li"),l(96,"\u7121\u9650\u4E00\u5207"),s(),r(97,"li"),l(98,"API \u63A5\u53E3"),s(),r(99,"li"),l(100,"\u5C08\u5C6C\u9867\u554F"),s()(),r(101,"button",67),l(102,"\u8CFC\u8CB7"),s()()()()()}if(i&2){let t=g();c(5),z("ngModel",t.newLicenseKey),c(),V("disabled",!t.newLicenseKey),c(8),w(t.isLoadingHistory()?14:t.activationHistory().length===0?15:16)}}function y2(i,e){i&1&&(r(0,"span",92),l(1,"\u672C\u6A5F"),s())}function S2(i,e){if(i&1){let t=M();r(0,"button",96),x("click",function(){v(t);let o=g().$implicit,a=g(2);return b(a.onUnbindDevice(o.id))}),l(1," \u89E3\u7D81 "),s()}if(i&2){let t=g(3);V("disabled",t.isUnbinding())}}function w2(i,e){if(i&1&&(r(0,"div",88)(1,"div",89),l(2),s(),r(3,"div",90)(4,"div",91),l(5),S(6,y2,2,0,"span",92),s(),r(7,"div",93),l(8),s(),r(9,"div",94),l(10),s()(),S(11,S2,2,1,"button",95),s()),i&2){let t=e.$implicit,n=g(2);I("current",t.isCurrent),c(2),D(" ",n.getDeviceIcon(t)," "),c(3),D(" ",t.deviceName," "),c(),w(t.isCurrent?6:-1),c(2),A(t.deviceCode),c(2),Y(" \u7D81\u5B9A\u65BC ",n.formatDate(t.boundAt)," \xB7 \u6700\u5F8C\u6D3B\u52D5 ",n.formatDate(t.lastSeen)," "),c(),w(t.isCurrent?-1:11)}}function E2(i,e){i&1&&(r(0,"div",61),l(1," \u66AB\u7121\u7D81\u5B9A\u8A2D\u5099\u8A18\u9304 "),s())}function A2(i,e){if(i&1){let t=M();r(0,"div",16)(1,"div",21)(2,"h3",22),l(3,"\u{1F4BB} \u5DF2\u7D81\u5B9A\u8A2D\u5099"),s(),r(4,"p",79),l(5),s(),r(6,"div",80),$(7,w2,12,9,"div",81,Td,!1,E2,2,0,"div",61),s()(),r(10,"div",21)(11,"h3",22),l(12,"\u{1F4F1} \u7576\u524D\u8A2D\u5099"),s(),r(13,"div",82)(14,"div",83)(15,"span",84),l(16,"\u8A2D\u5099\u78BC"),s(),r(17,"span",85),l(18),s(),r(19,"button",86),x("click",function(){v(t);let o=g();return b(o.copyDeviceCode())}),l(20,"\u{1F4CB}"),s()(),r(21,"div",83)(22,"span",84),l(23,"\u8A2D\u5099\u540D\u7A31"),s(),r(24,"span",87),l(25),s()()()()()}if(i&2){let t=g();c(5),Y(" \u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u6700\u591A\u53EF\u7D81\u5B9A ",t.getMaxDevices()," \u53F0\u8A2D\u5099\uFF0C\u5DF2\u4F7F\u7528 ",t.devices().length," \u53F0 "),c(2),H(t.devices()),c(11),A(t.currentDeviceCode()),c(7),A(t.currentDeviceName())}}function D2(i,e){if(i&1&&(r(0,"div",97)(1,"div",98)(2,"div",99),l(3,"\u{1F916}"),s(),r(4,"div",100)(5,"div",101),l(6,"AI \u8ABF\u7528"),s(),r(7,"div",102),k(8,"div",103),s(),r(9,"div",104),l(10),s()()(),r(11,"div",98)(12,"div",99),l(13,"\u{1F4E8}"),s(),r(14,"div",100)(15,"div",101),l(16,"\u6D88\u606F\u767C\u9001"),s(),r(17,"div",102),k(18,"div",103),s(),r(19,"div",104),l(20),s()()(),r(21,"div",98)(22,"div",99),l(23,"\u{1F465}"),s(),r(24,"div",100)(25,"div",101),l(26,"\u5E33\u865F\u6578\u91CF"),s(),r(27,"div",102),k(28,"div",103),s(),r(29,"div",104),l(30),s()()(),r(31,"div",98)(32,"div",99),l(33,"\u{1F4BE}"),s(),r(34,"div",100)(35,"div",101),l(36,"\u5B58\u5132\u7A7A\u9593"),s(),r(37,"div",102),k(38,"div",103),s(),r(39,"div",104),l(40),s()()()()),i&2){let t=g(2);c(8),X("width",t.getUsagePercent(t.usageStats().aiCalls),"%"),c(2),Y(" ",t.usageStats().aiCalls.used," / ",t.usageStats().aiCalls.limit," \u6B21 "),c(8),X("width",t.getUsagePercent(t.usageStats().messagesSent),"%"),c(2),Y(" ",t.usageStats().messagesSent.used," / ",t.usageStats().messagesSent.limit," \u689D "),c(8),X("width",t.getUsagePercent(t.usageStats().accounts),"%"),c(2),Y(" ",t.usageStats().accounts.used," / ",t.usageStats().accounts.limit," \u500B "),c(8),X("width",t.getUsagePercent(t.usageStats().storage),"%"),c(2),Y(" ",t.usageStats().storage.used," / ",t.usageStats().storage.limit," MB ")}}function M2(i,e){i&1&&(r(0,"div",60),l(1,"\u8F09\u5165\u4E2D..."),s())}function T2(i,e){if(i&1&&(r(0,"div",16)(1,"div",21)(2,"h3",22),l(3,"\u{1F4CA} \u672C\u6708\u4F7F\u7528\u60C5\u6CC1"),s(),S(4,D2,41,16,"div",97)(5,M2,2,0,"div",60),s(),r(6,"div",21)(7,"h3",22),l(8,"\u{1F4C8} \u6B77\u53F2\u8DA8\u52E2"),s(),r(9,"p",79),l(10,"\u656C\u8ACB\u671F\u5F85..."),s()()()),i&2){let t=g();c(4),w(t.usageStats()?4:5)}}function k2(i,e){if(i&1){let t=M();r(0,"div",16)(1,"div",105)(2,"h3",22),l(3,"\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5"),s(),r(4,"p",79),l(5," \u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 "),r(6,"strong"),l(7,"3 \u5929\u767D\u9280\u7CBE\u82F1"),s(),l(8," \u734E\u52F5\uFF01 "),s(),r(9,"div",106)(10,"span",107),l(11,"\u6211\u7684\u9080\u8ACB\u78BC"),s(),r(12,"div",108),l(13),s(),r(14,"button",86),x("click",function(){v(t);let o=g();return b(o.copyInviteCode())}),l(15," \u{1F4CB} \u8907\u88FD "),s()(),r(16,"div",109)(17,"span",107),l(18,"\u9080\u8ACB\u93C8\u63A5"),s(),k(19,"input",110),r(20,"button",86),x("click",function(){v(t);let o=g();return b(o.copyInviteLink())}),l(21," \u{1F4CB} \u8907\u88FD "),s()()(),r(22,"div",21)(23,"h3",22),l(24,"\u{1F4CA} \u9080\u8ACB\u7D71\u8A08"),s(),r(25,"div",111)(26,"div",112)(27,"div",113),l(28),s(),r(29,"div",114),l(30,"\u5DF2\u9080\u8ACB\u4EBA\u6578"),s()(),r(31,"div",112)(32,"div",113),l(33),s(),r(34,"div",114),l(35,"\u7372\u5F97\u734E\u52F5\u5929\u6578"),s()()()()()}if(i&2){let t=g();c(13),A(t.inviteCode()),c(6),V("value",t.inviteLink()),c(9),A(t.invitedCount()),c(5),A(t.rewardDays())}}var zo=class i{constructor(){this.authService=O(xt);this.authEvents=O(rn);this.membershipService=O(Re);this.deviceService=O(Ho);this.i18n=O(Xe);this.toast=O(ue);this.licenseClient=O(Ot);this.cdr=O(en);this.router=O(It);this.membershipUpdateHandler=null;this.activeTab=_("account");this.showChangePassword=_(!1);this.showEditEmail=_(!1);this.showEditDisplayName=_(!1);this.isUnbinding=_(!1);this.isLoggingOut=_(!1);this.isSavingEmail=_(!1);this.isSavingDisplayName=_(!1);this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""};this.emailForm={newEmail:"",password:""};this.displayNameForm={newName:""};this.newLicenseKey="";this.user=G(()=>this.authService.user());this.displayNameForHeader=G(()=>{let e=this.authService.user();if(!e)return null;let t=(e.displayName||e.display_name)?.trim();return!t||t===e.username?null:t});this.membershipLevel=G(()=>this.membershipService.level());this.membershipDaysLeft=G(()=>this.membershipService.daysRemaining());this.devices=G(()=>this.authService.devices());this.usageStats=G(()=>this.authService.usageStats());this.currentDeviceCode=_("");this.currentDeviceName=_("");this.inviteCode=_("");this.invitedCount=_(0);this.rewardDays=_(0);this.activationHistory=_([]);this.isLoadingHistory=_(!1);this.inviteLink=G(()=>`https://tg-matrix.com/invite?code=${this.inviteCode()}`);this.isLoadingUser=_(!1);this.userLoadError=_(null)}async ngOnInit(){await this.ensureUserLoaded(),this.currentDeviceCode.set(await this.deviceService.getDeviceCode()),this.currentDeviceName.set(this.deviceService.getDeviceName()),this.authService.loadDevices().catch(t=>console.warn("[Profile] Load devices error:",t)),this.authService.loadUsageStats().catch(t=>console.warn("[Profile] Load usage stats error:",t));let e=await this.authService.getInviteRewards();this.inviteCode.set(e.inviteCode),this.invitedCount.set(e.invitedCount),this.rewardDays.set(e.rewardDays),await this.loadActivationHistory(),this.membershipUpdateHandler=t=>{console.log("[ProfileComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",t.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler)}ngOnDestroy(){this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler)}async ensureUserLoaded(){this.isLoadingUser.set(!0),this.userLoadError.set(null);try{console.log("[Profile] Fetching fresh user info from backend...");let e=await this.authService.fetchCurrentUser();e?(console.log("[Profile] User loaded successfully:",e.username,"Level:",e.membershipLevel),this.authEvents.emitUserUpdate(e)):(console.warn("[Profile] No user returned from API"),this.userLoadError.set("\u7121\u6CD5\u7372\u53D6\u7528\u6236\u4FE1\u606F"))}catch(e){console.error("[Profile] Failed to load user:",e);let t=e?.message||"";t.startsWith("RATE_LIMITED")?this.userLoadError.set("\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"):this.userLoadError.set(t||"\u52A0\u8F09\u5931\u6557")}finally{this.isLoadingUser.set(!1),this.cdr.detectChanges()}}async loadActivationHistory(){this.isLoadingHistory.set(!0);try{let e=await this.licenseClient.getActivationHistory(50,0);e.success&&e.data&&this.activationHistory.set(e.data)}catch(e){console.error("\u8F09\u5165\u6FC0\u6D3B\u8A18\u9304\u5931\u6557:",e)}finally{this.isLoadingHistory.set(!1)}}getMembershipIcon(){return{bronze:"\u2694\uFE0F",silver:"\u{1F948}",gold:"\u{1F947}",diamond:"\u{1F48E}",star:"\u{1F31F}",king:"\u{1F451}"}[this.membershipLevel()]||"\u2694\uFE0F"}getMembershipName(){let e=this.membershipLevel();return this.i18n.t(`membershipLevels.${e}`)||this.i18n.t("membershipLevels.bronze")}getMaxDevices(){return{bronze:1,silver:2,gold:3,diamond:4,star:5,king:-1}[this.membershipLevel()]||1}getDeviceIcon(e){return e.deviceName.includes("Windows")?"\u{1F4BB}":e.deviceName.includes("Mac")?"\u{1F5A5}\uFE0F":e.deviceName.includes("Linux")?"\u{1F427}":"\u{1F4F1}"}getUsagePercent(e){return Math.min(100,e.used/e.limit*100)}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}async onLogout(){console.log("[Profile] Logging out..."),this.isLoggingOut.set(!0),await new Promise(e=>setTimeout(e,500)),await this.authService.logout()}async onChangePassword(){if(this.passwordForm.newPassword!==this.passwordForm.confirmPassword){this.toast.error("\u5169\u6B21\u8F38\u5165\u7684\u5BC6\u78BC\u4E0D\u4E00\u81F4");return}let e=await this.authService.changePassword(this.passwordForm.oldPassword,this.passwordForm.newPassword);e.success?(this.toast.success("\u5BC6\u78BC\u4FEE\u6539\u6210\u529F"),this.showChangePassword.set(!1),this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""}):this.toast.error(e.message||e.error||"\u5BC6\u78BC\u4FEE\u6539\u5931\u6557")}async onActivateLicense(){let e=await this.authService.renewMembership(this.newLicenseKey);e.success?(this.toast.success(e.message||"\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01"),this.newLicenseKey="",await this.loadActivationHistory(),this.cdr.detectChanges()):this.toast.error(e.message||"\u5361\u5BC6\u6FC0\u6D3B\u5931\u6557")}formatLicenseKey(e){return e?e.length>16?e.substring(0,12)+"-****":e:""}formatActivationDate(e){return e?new Date(e).toLocaleDateString("zh-TW"):"-"}async onUnbindDevice(e){this.isUnbinding.set(!0);let t=await this.authService.unbindDevice(e);t.success?this.toast.success("\u8A2D\u5099\u5DF2\u89E3\u7D81"):this.toast.error(t.message||"\u89E3\u7D81\u5931\u6557"),this.isUnbinding.set(!1)}copyDeviceCode(){navigator.clipboard.writeText(this.currentDeviceCode()),this.toast.success("\u8A2D\u5099\u78BC\u5DF2\u8907\u88FD")}copyInviteCode(){navigator.clipboard.writeText(this.inviteCode()),this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD")}copyInviteLink(){navigator.clipboard.writeText(this.inviteLink()),this.toast.success("\u9080\u8ACB\u93C8\u63A5\u5DF2\u8907\u88FD")}copyTelegramId(){let e=this.user()?.telegramId;e&&(navigator.clipboard.writeText(e),this.toast.success("Telegram ID \u5DF2\u8907\u88FD"))}openEmailEditor(){this.emailForm={newEmail:this.user()?.email||"",password:""},this.showEditEmail.set(!0)}closeEmailEditor(){this.showEditEmail.set(!1),this.emailForm={newEmail:"",password:""}}async onSaveEmail(){let e=this.emailForm.newEmail.trim(),t=this.emailForm.password,n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!e){this.toast.error("\u8ACB\u8F38\u5165\u90F5\u7BB1\u5730\u5740");return}if(!n.test(e)){this.toast.error("\u90F5\u7BB1\u683C\u5F0F\u4E0D\u6B63\u78BA");return}if(!t){this.toast.error("\u8ACB\u8F38\u5165\u7576\u524D\u5BC6\u78BC\u4EE5\u9A57\u8B49\u8EAB\u4EFD");return}this.isSavingEmail.set(!0);try{let o=await this.authService.updateEmail(e,t);o.success?(this.toast.success(o.message||"\u90F5\u7BB1\u66F4\u65B0\u6210\u529F"),this.closeEmailEditor(),await this.authService.fetchCurrentUser(),this.cdr.detectChanges()):this.toast.error(o.message||"\u90F5\u7BB1\u66F4\u65B0\u5931\u6557")}catch(o){this.toast.error(o.message||"\u90F5\u7BB1\u66F4\u65B0\u5931\u6557")}finally{this.isSavingEmail.set(!1)}}openDisplayNameEditor(){this.displayNameForm={newName:this.user()?.displayName||""},this.showEditDisplayName.set(!0)}closeDisplayNameEditor(){this.showEditDisplayName.set(!1),this.displayNameForm={newName:""}}async onSaveDisplayName(){let e=this.displayNameForm.newName.trim();if(!e){this.toast.error("\u8ACB\u8F38\u5165\u986F\u793A\u540D\u7A31");return}if(e.length>30){this.toast.error("\u986F\u793A\u540D\u7A31\u6700\u591A30\u500B\u5B57\u7B26");return}this.isSavingDisplayName.set(!0);try{let t=await this.authService.updateDisplayName(e);t.success?(this.toast.success(t.message||"\u986F\u793A\u540D\u7A31\u66F4\u65B0\u6210\u529F"),this.closeDisplayNameEditor(),await this.authService.fetchCurrentUser(),this.cdr.detectChanges()):this.toast.error(t.message||"\u986F\u793A\u540D\u7A31\u66F4\u65B0\u5931\u6557")}catch(t){this.toast.error(t.message||"\u986F\u793A\u540D\u7A31\u66F4\u65B0\u5931\u6557")}finally{this.isSavingDisplayName.set(!1)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-profile"]],decls:35,vars:25,consts:[[1,"profile-container"],[1,"loading-overlay"],[1,"error-alert"],[1,"profile-header"],[1,"avatar-section"],[1,"avatar"],[1,"user-info"],[1,"username"],[1,"login-account","text-sm","opacity-80"],[1,"email"],[1,"membership-badge-wrapper","flex","items-center","gap-2"],["size","md",3,"level"],[1,"expires","text-xs","opacity-70"],[1,"logout-btn",3,"click","disabled"],[1,"tabs"],[1,"tab-btn",3,"click"],[1,"tab-content"],[1,"loading-spinner"],[1,"error-icon"],[1,"retry-btn",3,"click"],[1,"logout-spinner"],[1,"section-card"],[1,"section-title"],[1,"info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value","user-id"],[1,"id-text"],["title","\u8907\u88FD Telegram ID",1,"copy-id-btn"],[1,"info-value"],[1,"edit-btn",3,"click"],[1,"info-value","username-value"],[1,"info-hint"],[1,"modal-overlay"],[1,"security-actions"],[1,"action-btn",3,"click"],[1,"action-btn"],[1,"change-password-form"],["title","\u8907\u88FD Telegram ID",1,"copy-id-btn",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"form-group"],["type","email","placeholder","\u8ACB\u8F38\u5165\u65B0\u90F5\u7BB1",1,"form-input",3,"ngModelChange","ngModel"],["type","password","placeholder","\u8ACB\u8F38\u5165\u7576\u524D\u5BC6\u78BC",1,"form-input",3,"ngModelChange","ngModel"],[1,"hint-text"],[1,"modal-footer"],[1,"cancel-btn",3,"click"],[1,"save-btn",3,"click","disabled"],[1,"btn-spinner"],["type","text","placeholder","\u8ACB\u8F38\u5165\u986F\u793A\u540D\u7A31","maxlength","30",1,"form-input",3,"ngModelChange","ngModel"],["type","password",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-actions"],[1,"submit-btn",3,"click"],[1,"license-input-group"],["type","text","placeholder","XXXX-XXXX-XXXX-XXXX",1,"form-input","font-mono",3,"ngModelChange","ngModel"],[1,"activate-btn",3,"click","disabled"],[1,"license-history"],[1,"loading-state"],[1,"empty-state"],[1,"purchase-options"],[1,"purchase-card","silver"],[1,"plan-name"],[1,"plan-price"],[1,"plan-features"],[1,"buy-btn"],[1,"purchase-card","gold"],[1,"recommended"],[1,"purchase-card","diamond"],[1,"purchase-card","star"],[1,"purchase-card","king"],[1,"history-item"],[1,"history-info"],[1,"license-code"],[1,"license-type"],[1,"history-meta"],[1,"status"],[1,"section-desc"],[1,"device-list"],[1,"device-item",3,"current"],[1,"current-device-info"],[1,"info-row"],[1,"label"],[1,"value","font-mono"],[1,"copy-btn",3,"click"],[1,"value"],[1,"device-item"],[1,"device-icon"],[1,"device-info"],[1,"device-name"],[1,"current-badge"],[1,"device-code"],[1,"device-meta"],[1,"unbind-btn",3,"disabled"],[1,"unbind-btn",3,"click","disabled"],[1,"usage-grid"],[1,"usage-item"],[1,"usage-icon"],[1,"usage-info"],[1,"usage-label"],[1,"usage-bar"],[1,"usage-fill"],[1,"usage-text"],[1,"section-card","highlight"],[1,"invite-code-box"],[1,"invite-label"],[1,"invite-code"],[1,"invite-link-box"],["type","text","readonly","",1,"invite-link-input",3,"value"],[1,"invite-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"]],template:function(t,n){if(t&1&&(r(0,"div",0),S(1,n2,4,0,"div",1),S(2,i2,7,1,"div",2),r(3,"div",3)(4,"div",4)(5,"div",5),l(6),s(),r(7,"div",6)(8,"h2",7),l(9),s(),S(10,o2,2,1,"p",8),r(11,"p",9),l(12),s(),r(13,"div",10),k(14,"user-level-badge",11),S(15,r2,2,1,"span",12),s()()(),r(16,"button",13),x("click",function(){return n.onLogout()}),S(17,s2,2,0)(18,a2,1,0),s()(),r(19,"div",14)(20,"button",15),x("click",function(){return n.activeTab.set("account")}),l(21," \u{1F464} \u5E33\u865F\u4FE1\u606F "),s(),r(22,"button",15),x("click",function(){return n.activeTab.set("license")}),l(23," \u{1F511} \u5361\u5BC6\u7BA1\u7406 "),s(),r(24,"button",15),x("click",function(){return n.activeTab.set("devices")}),l(25," \u{1F4BB} \u8A2D\u5099\u7BA1\u7406 "),s(),r(26,"button",15),x("click",function(){return n.activeTab.set("usage")}),l(27," \u{1F4CA} \u4F7F\u7528\u7D71\u8A08 "),s(),r(28,"button",15),x("click",function(){return n.activeTab.set("invite")}),l(29," \u{1F381} \u9080\u8ACB\u734E\u52F5 "),s()(),S(30,f2,54,10,"div",16),S(31,x2,103,3,"div",16),S(32,A2,26,5,"div",16),S(33,T2,11,1,"div",16),S(34,k2,36,4,"div",16),s()),t&2){let o,a,d;c(),w(n.isLoadingUser()?1:-1),c(),w(n.userLoadError()?2:-1),c(4),D(" ",((o=n.displayNameForHeader()||((o=n.user())==null?null:o.username))==null?null:o.charAt(0).toUpperCase())||"?"," "),c(3),A(n.displayNameForHeader()??(n.isLoadingUser()?"\u8F09\u5165\u4E2D...":n.user()?"\u672A\u8A2D\u7F6E\u986F\u793A\u540D\u7A31":"\u672A\u767B\u5165")),c(),w((a=n.user())!=null&&a.username?10:-1),c(2),A(((d=n.user())==null?null:d.email)||"\u672A\u8A2D\u7F6E\u90F5\u7BB1"),c(2),V("level",n.membershipLevel()),c(),w(n.membershipDaysLeft()>0?15:-1),c(),V("disabled",n.isLoggingOut()),c(),w(n.isLoggingOut()?17:18),c(3),I("active",n.activeTab()==="account"),c(2),I("active",n.activeTab()==="license"),c(2),I("active",n.activeTab()==="devices"),c(2),I("active",n.activeTab()==="usage"),c(2),I("active",n.activeTab()==="invite"),c(2),w(n.activeTab()==="account"?30:-1),c(),w(n.activeTab()==="license"?31:-1),c(),w(n.activeTab()==="devices"?32:-1),c(),w(n.activeTab()==="usage"?33:-1),c(),w(n.activeTab()==="invite"?34:-1)}},dependencies:[te,me,xe,_e,Pt,Ce,Vt],styles:[".profile-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:900px;margin:0 auto}.profile-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border:1px solid rgba(6,182,212,.2);border-radius:1rem;margin-bottom:1.5rem}.avatar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#fff}.username[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary, white);margin:0}.email[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin:.25rem 0}.membership-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;border-radius:1rem;font-size:.75rem;font-weight:500}.membership-badge.level-bronze[_ngcontent-%COMP%]{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}.membership-badge.level-silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,silver,#a8a8a8);color:#1e293b}.membership-badge.level-gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:#1e293b}.membership-badge.level-diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#b9f2ff,#06b6d4);color:#1e293b}.membership-badge.level-star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}.membership-badge.level-king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}.expires[_ngcontent-%COMP%]{opacity:.8}.logout-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:.5rem;color:#fca5a5;cursor:pointer;transition:all .2s}.logout-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ef444433}.logout-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.logout-spinner[_ngcontent-%COMP%]{display:inline-block;width:14px;height:14px;border:2px solid rgba(239,68,68,.3);border-top-color:#ef4444;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;flex-wrap:wrap}.tab-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.5rem;color:var(--text-secondary, #94a3b8);cursor:pointer;transition:all .2s;font-size:.875rem}.tab-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--text-primary, white)}.tab-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6);border-color:transparent;color:#fff}.section-card[_ngcontent-%COMP%]{background:var(--bg-card, rgba(30, 41, 59, .8));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:1rem;padding:1.5rem;margin-bottom:1rem}.section-card.highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d41a,#3b82f61a);border-color:#06b6d44d}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary, white);margin:0 0 1rem}.section-desc[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin-bottom:1rem}.info-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.5rem}.info-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;min-width:80px}.info-value[_ngcontent-%COMP%]{color:var(--text-primary, white);flex:1}.edit-btn[_ngcontent-%COMP%], .copy-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.25rem;color:var(--text-muted, #94a3b8);cursor:pointer;font-size:.75rem}.edit-btn[_ngcontent-%COMP%]:hover, .copy-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary, #06b6d4);color:var(--primary, #06b6d4)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--text-secondary, #cbd5e1);font-size:.875rem;margin-bottom:.5rem}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .2));border-radius:.5rem;color:var(--text-primary, white);font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #06b6d4)}.device-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.device-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border:1px solid var(--border-default, rgba(148, 163, 184, .1));border-radius:.75rem}.device-item.current[_ngcontent-%COMP%]{border-color:var(--primary, #06b6d4);background:#06b6d41a}.device-icon[_ngcontent-%COMP%]{font-size:1.5rem}.device-info[_ngcontent-%COMP%]{flex:1}.device-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary, white);display:flex;align-items:center;gap:.5rem}.current-badge[_ngcontent-%COMP%]{font-size:.625rem;padding:.125rem .375rem;background:var(--primary, #06b6d4);border-radius:.25rem;color:#fff}.device-code[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--text-muted, #94a3b8)}.device-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);margin-top:.25rem}.unbind-btn[_ngcontent-%COMP%]{padding:.375rem .75rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:.375rem;color:#fca5a5;cursor:pointer;font-size:.75rem}.usage-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.usage-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem}.usage-icon[_ngcontent-%COMP%]{font-size:1.5rem}.usage-info[_ngcontent-%COMP%]{flex:1}.usage-label[_ngcontent-%COMP%]{color:var(--text-secondary, #cbd5e1);font-size:.875rem;margin-bottom:.5rem}.usage-bar[_ngcontent-%COMP%]{height:8px;background:var(--bg-primary, #0f172a);border-radius:4px;overflow:hidden}.usage-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:4px;transition:width .3s}.usage-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #94a3b8);margin-top:.25rem}.invite-code-box[_ngcontent-%COMP%], .invite-link-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-tertiary, rgba(15, 23, 42, .5));border-radius:.75rem;margin-bottom:1rem}.invite-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;min-width:80px}.invite-code[_ngcontent-%COMP%]{font-family:monospace;font-size:1.25rem;font-weight:600;color:var(--primary, #06b6d4);flex:1}.invite-link-input[_ngcontent-%COMP%]{flex:1;padding:.5rem;background:transparent;border:none;color:var(--text-secondary, #cbd5e1);font-size:.875rem}.invite-stats[_ngcontent-%COMP%]{display:flex;gap:2rem;justify-content:center;padding:1rem}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--primary, #06b6d4)}.stat-label[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem}.purchase-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.purchase-card[_ngcontent-%COMP%]{padding:1.5rem;border-radius:1rem;text-align:center;border:1px solid var(--border-default, rgba(148, 163, 184, .1))}.purchase-card.silver[_ngcontent-%COMP%]{background:linear-gradient(135deg,#c0c0c01a,#a8a8a81a);border-color:#c0c0c04d}.purchase-card.gold[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ffd7001a,#ffa5001a);border-color:#ffd7004d}.purchase-card.diamond[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d426,#b9f2ff1a);border-color:#06b6d466}.purchase-card.star[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9b59b61a,#8e44ad1a);border-color:#9b59b64d}.purchase-card.king[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b26,#ee5a5a1a);border-color:#ff6b6b66}.recommended[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#06b6d4,#3b82f6);color:#fff;font-size:.625rem;padding:.125rem .5rem;border-radius:.25rem;font-weight:600}.purchase-card[_ngcontent-%COMP%]{position:relative}.plan-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary, white);margin-bottom:.5rem}.plan-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--primary, #06b6d4);margin-bottom:1rem}.plan-features[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;font-size:.875rem;color:var(--text-secondary, #cbd5e1)}.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.25rem 0}.buy-btn[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;cursor:pointer;font-weight:500}.license-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:.5rem}.license-input-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1;font-family:monospace}.activate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:.5rem;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}.activate-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #22c55e4d}.activate-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.hint-text[_ngcontent-%COMP%]{color:var(--text-muted, #94a3b8);font-size:.875rem;margin-top:.5rem}.empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--text-muted, #94a3b8)}.loading-overlay[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.75rem;padding:1.5rem;background:#06b6d41a;border:1px solid rgba(6,182,212,.2);border-radius:1rem;margin-bottom:1rem;color:var(--primary, #06b6d4)}.loading-overlay[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{width:24px;height:24px;border:3px solid rgba(6,182,212,.3);border-top-color:#06b6d4;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.error-alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem 1.25rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:.5rem;color:#fca5a5;margin-bottom:1rem}.error-icon[_ngcontent-%COMP%]{font-size:1.25rem}.retry-btn[_ngcontent-%COMP%]{margin-left:auto;padding:.375rem .75rem;background:#ef444433;border:1px solid rgba(239,68,68,.4);border-radius:.375rem;color:#fca5a5;font-size:.75rem;cursor:pointer;transition:all .2s}.retry-btn[_ngcontent-%COMP%]:hover{background:#ef44444d}.user-id[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.id-text[_ngcontent-%COMP%]{font-family:monospace;font-weight:600;color:var(--primary, #06b6d4)}.copy-id-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#06b6d41a;border:1px solid rgba(6,182,212,.3);border-radius:.375rem;cursor:pointer;transition:all .2s;font-size:.875rem}.copy-id-btn[_ngcontent-%COMP%]:hover{background:#06b6d433;border-color:#06b6d480}.username-value[_ngcontent-%COMP%]{font-family:monospace;color:var(--text-secondary, #94a3b8)}.info-hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #64748b);margin-left:.5rem}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-content[_ngcontent-%COMP%]{background:var(--bg-card, #1e293b);border-radius:1rem;width:100%;max-width:420px;border:1px solid rgba(255,255,255,.1);box-shadow:0 25px 50px -12px #00000080}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.25rem 1.5rem;border-bottom:1px solid rgba(255,255,255,.1)}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;color:var(--text-primary, white)}.close-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;border:none;background:#ffffff1a;color:var(--text-muted, #94a3b8);font-size:1.25rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ef444433;color:#f87171}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding:1rem 1.5rem;border-top:1px solid rgba(255,255,255,.1);justify-content:flex-end}.cancel-btn[_ngcontent-%COMP%]{padding:.625rem 1.25rem;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:.5rem;color:var(--text-secondary, #cbd5e1);cursor:pointer;transition:all .2s}.cancel-btn[_ngcontent-%COMP%]:hover{background:#ffffff26}.save-btn[_ngcontent-%COMP%]{padding:.625rem 1.25rem;background:linear-gradient(135deg,#06b6d4,#0891b2);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:.5rem}.save-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.save-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};var I2=(i,e)=>e.id,kd=(i,e)=>e.value,P2=(i,e)=>e.telegram_id;function F2(i,e){if(i&1){let t=M();r(0,"span",45),x("click",function(){v(t);let o=g();return b(o.forceEndSync())}),k(1,"span",46),l(2," \u540C\u6B65\u4E2D... (\u9EDE\u64CA\u53D6\u6D88) "),s()}}function N2(i,e){if(i&1){let t=M();r(0,"button",47),x("click",function(){let o=v(t).$implicit,a=g();return b(a.switchTab(o.id))}),l(1),s()}if(i&2){let t=e.$implicit,n=g();I("bg-purple-500",n.activeTab()===t.id)("text-white",n.activeTab()===t.id)("text-slate-400",n.activeTab()!==t.id)("hover:text-white",n.activeTab()!==t.id),c(),Y(" ",t.icon," ",t.label," ")}}function R2(i,e){if(i&1&&(r(0,"option",33),l(1),s()),i&2){let t=e.$implicit;V("value",t.value),c(),A(t.label)}}function O2(i,e){if(i&1&&(r(0,"option",33),l(1),s()),i&2){let t=e.$implicit;V("value",t),c(),A(t)}}function B2(i,e){if(i&1){let t=M();r(0,"div",40)(1,"span",48),l(2),s(),r(3,"button",49),x("click",function(){v(t);let o=g();return b(o.showBatchTagDialog.set(!0))}),l(4," \u6279\u91CF\u6A19\u8A18 "),s(),r(5,"button",50),x("click",function(){v(t);let o=g();return b(o.showBatchStatusDialog.set(!0))}),l(6," \u66F4\u65B0\u72C0\u614B "),s(),r(7,"button",51),x("click",function(){v(t);let o=g();return b(o.batchSendMessage())}),l(8," \u6279\u91CF\u767C\u9001 "),s(),r(9,"button",52),x("click",function(){v(t);let o=g();return b(o.sendToAISales())}),r(10,"span"),l(11,"\u{1F4E4}"),s(),l(12," \u52A0\u5165\u767C\u9001\u968A\u5217 "),s(),r(13,"button",53),x("click",function(){v(t);let o=g();return b(o.confirmBatchDelete())}),l(14," \u522A\u9664 "),s(),r(15,"button",54),x("click",function(){v(t);let o=g();return b(o.contactsService.clearSelection())}),l(16," \u53D6\u6D88\u9078\u64C7 "),s()()}if(i&2){let t=g();c(2),D(" \u5DF2\u9078\u64C7 ",t.contactsService.selectedIds().size," \u9805 ")}}function V2(i,e){i&1&&(r(0,"div",42),k(1,"div",55),s())}function L2(i,e){if(i&1){let t=M();r(0,"div",43)(1,"div",56),l(2,"\u{1F4E6}"),s(),r(3,"p",57),l(4,"\u66AB\u7121\u8CC7\u6E90\u6578\u64DA"),s(),r(5,"p",58),l(6,"\u9EDE\u64CA\u300C\u540C\u6B65\u6578\u64DA\u300D\u5F9E\u5404\u4F86\u6E90\u6574\u5408\u6578\u64DA"),s(),r(7,"button",39),x("click",function(){v(t);let o=g();return b(o.syncData())}),l(8," \u540C\u6B65\u6578\u64DA "),s()()}}function G2(i,e){if(i&1&&(r(0,"div",73),l(1),s()),i&2){let t=g().$implicit;c(),D("@",t.username)}}function U2(i,e){if(i&1&&(r(0,"div",78),l(1),s()),i&2){let t=g().$implicit;c(),D(" \u{1F4CD} ",t.source_name," ")}}function q2(i,e){if(i&1&&(r(0,"span",80),l(1),s()),i&2){let t=e.$implicit;c(),D(" ",t," ")}}function $2(i,e){if(i&1&&(r(0,"span",81),l(1),s()),i&2){let t=g().$implicit;c(),D(" +",t.tags.length-2," ")}}function H2(i,e){if(i&1){let t=M();r(0,"button",90),x("click",function(){v(t);let o=g().$implicit,a=g(2);return b(a.sendMessage(o))}),ne(),r(1,"svg",10),k(2,"path",91),s()()}}function z2(i,e){if(i&1){let t=M();r(0,"tr",66)(1,"td",65)(2,"input",64),x("change",function(){let o=v(t).$implicit,a=g(2);return b(a.contactsService.toggleSelect(o.telegram_id))}),s()(),r(3,"td",65)(4,"div",7)(5,"div",71),l(6),s(),r(7,"div")(8,"div",72),l(9),s(),S(10,G2,2,1,"div",73),s()()(),r(11,"td",65)(12,"span",74),l(13),s()(),r(14,"td",65)(15,"div",75)(16,"span",76),l(17),s(),r(18,"span",77),l(19),s()(),S(20,U2,2,1,"div",78),s(),r(21,"td",65)(22,"div",79),$(23,q2,2,1,"span",80,Pe),S(25,$2,2,1,"span",81),s()(),r(26,"td",65)(27,"span",74),l(28),s()(),r(29,"td",65)(30,"div",68)(31,"div",82),k(32,"div",83),s(),r(33,"span",73),l(34),s()()(),r(35,"td",65)(36,"div",68),S(37,H2,3,0,"button",84),r(38,"button",85),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.viewDetail(o))}),ne(),r(39,"svg",10),k(40,"path",86)(41,"path",87),s()(),ge(),r(42,"button",88),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.editContact(o))}),ne(),r(43,"svg",10),k(44,"path",89),s()()()()()}if(i&2){let t=e.$implicit,n=g(2);c(2),V("checked",n.contactsService.selectedIds().has(t.telegram_id)),c(4),D(" ",n.getInitial(t)," "),c(3),A(t.display_name),c(),w(t.username?10:-1),c(2),I("bg-blue-500/20",t.contact_type==="user")("text-blue-400",t.contact_type==="user")("bg-green-500/20",t.contact_type==="group")("text-green-400",t.contact_type==="group")("bg-purple-500/20",t.contact_type==="channel")("text-purple-400",t.contact_type==="channel"),c(),D(" ",n.getTypeLabel(t.contact_type)," "),c(4),A(n.getSourceIcon(t.source_type)),c(),de(n.getSourceColor(t.source_type)),c(),D(" ",n.getSourceLabel(t.source_type)," "),c(),w(t.source_name?20:-1),c(3),H(t.tags.slice(0,2)),c(2),w(t.tags.length>2?25:-1),c(2),de(n.contactsService.getStatusColor(t.status)),I("text-white",!0),c(),D(" ",n.contactsService.getStatusLabel(t.status)," "),c(4),X("width",t.ai_score*100,"%"),c(2),A((t.ai_score*100).toFixed(0)),c(3),w(t.contact_type==="user"?37:-1)}}function K2(i,e){if(i&1){let t=M();r(0,"div",59)(1,"table",60)(2,"thead",61)(3,"tr",62)(4,"th",63)(5,"input",64),x("change",function(){v(t);let o=g();return b(o.contactsService.toggleSelectAll())}),s()(),r(6,"th",65),l(7,"\u540D\u7A31"),s(),r(8,"th",65),l(9,"\u985E\u578B"),s(),r(10,"th",65),l(11,"\u4F86\u6E90"),s(),r(12,"th",65),l(13,"\u6A19\u7C64"),s(),r(14,"th",65),l(15,"\u72C0\u614B"),s(),r(16,"th",65),l(17,"\u8A55\u5206"),s(),r(18,"th",65),l(19,"\u64CD\u4F5C"),s()()(),r(20,"tbody"),$(21,z2,45,32,"tr",66,P2),s()()(),r(23,"div",67)(24,"div"),l(25),s(),r(26,"div",68)(27,"button",69),x("click",function(){v(t);let o=g();return b(o.prevPage())}),l(28," \u4E0A\u4E00\u9801 "),s(),r(29,"span",70),l(30),s(),r(31,"button",69),x("click",function(){v(t);let o=g();return b(o.nextPage())}),l(32," \u4E0B\u4E00\u9801 "),s()()()}if(i&2){let t=g();c(5),V("checked",t.isAllSelected()),c(16),H(t.contactsService.contacts()),c(4),Y(" \u986F\u793A ",t.contactsService.contacts().length," / ",t.contactsService.total()," \u689D "),c(2),V("disabled",t.currentPage()<=1),c(3),D("\u7B2C ",t.currentPage()," \u9801"),c(),V("disabled",!t.hasNextPage())}}function W2(i,e){if(i&1){let t=M();r(0,"label",95)(1,"input",64),x("change",function(){let o=v(t).$implicit,a=g(2);return b(a.toggleBatchTag(o))}),s(),r(2,"span",99),l(3),s()()}if(i&2){let t=e.$implicit,n=g(2);c(),V("checked",n.selectedBatchTags().has(t)),c(2),A(t)}}function J2(i,e){if(i&1){let t=M();r(0,"div",44)(1,"div",92)(2,"h3",93),l(3,"\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64"),s(),r(4,"div",94),$(5,W2,4,2,"label",95,Pe),s(),r(7,"div",96)(8,"button",97),x("click",function(){v(t);let o=g();return b(o.showBatchTagDialog.set(!1))}),l(9," \u53D6\u6D88 "),s(),r(10,"button",98),x("click",function(){v(t);let o=g();return b(o.applyBatchTags())}),l(11," \u61C9\u7528 "),s()()()()}if(i&2){let t=g();c(5),H(t.defaultTags)}}function Q2(i,e){if(i&1){let t=M();r(0,"button",103),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.applyBatchStatus(o.value))}),k(1,"span",104),r(2,"span",99),l(3),s()()}if(i&2){let t=e.$implicit;c(),de(t.color),c(2),A(t.label)}}function Y2(i,e){if(i&1){let t=M();r(0,"div",44)(1,"div",92)(2,"h3",93),l(3,"\u66F4\u65B0\u72C0\u614B"),s(),r(4,"div",100),$(5,Q2,4,3,"button",101,kd),s(),r(7,"button",102),x("click",function(){v(t);let o=g();return b(o.showBatchStatusDialog.set(!1))}),l(8," \u53D6\u6D88 "),s()()()}if(i&2){let t=g();c(5),H(t.statusOptions)}}function X2(i,e){if(i&1){let t=M();r(0,"div",44)(1,"div",92)(2,"h3",105),l(3,"\u26A0\uFE0F \u78BA\u8A8D\u522A\u9664"),s(),r(4,"p",106),l(5),s(),r(6,"div",107)(7,"button",97),x("click",function(){v(t);let o=g();return b(o.showDeleteConfirm.set(!1))}),l(8," \u53D6\u6D88 "),s(),r(9,"button",108),x("click",function(){v(t);let o=g();return b(o.confirmDelete())}),l(10," \u78BA\u8A8D\u522A\u9664 "),s()()()()}if(i&2){let t=g();c(5),D(" \u78BA\u5B9A\u8981\u522A\u9664\u9078\u4E2D\u7684 ",t.contactsService.selectedIds().size," \u500B\u806F\u7E6B\u4EBA\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002 ")}}var Ko=class i{constructor(){this.contactsService=O(ni);this.toast=O(ue);this.nav=O(sn);this.sendMessageEvent=Me();this.viewDetailEvent=Me();this.batchSendEvent=Me();this.sendToAISalesEvent=Me();this.statusChangedEvent=Me();this.refreshDataEvent=Me();this.tabs=[{id:"all",icon:"\u{1F4CA}",label:"\u5168\u90E8"},{id:"users",icon:"\u{1F464}",label:"\u6210\u54E1"},{id:"groups",icon:"\u{1F465}",label:"\u7FA4\u7D44"},{id:"channels",icon:"\u{1F4E2}",label:"\u983B\u9053"}];this.statusOptions=Ea;this.defaultTags=wa;this.activeTab=_("all");this.selectedStatus="";this.selectedTag="";this.searchKeyword="";this.pageSize=50;this.currentPage=_(1);this.showImportDialog=_(!1);this.showBatchTagDialog=_(!1);this.showBatchStatusDialog=_(!1);this.showDeleteConfirm=_(!1);this.selectedBatchTags=_(new Set)}ngOnInit(){console.log("[ResourceCenter] Initialized, using imported leads data"),console.log("[ResourceCenter] Current contacts:",this.contactsService.contacts().length),console.log("[ResourceCenter] Has imported data:",this.contactsService.hasData())}ngOnDestroy(){this.contactsService.forceEndSync()}forceEndSync(){this.contactsService.forceEndSync(),this.toast.info("\u5DF2\u53D6\u6D88",1500)}switchTab(e){this.activeTab.set(e);let t;switch(e){case"users":t="user";break;case"groups":t="group";break;case"channels":t="channel";break;default:t=void 0}this.contactsService.setFilter({contactType:t,offset:0}),this.currentPage.set(1)}syncData(){if(console.log("[ResourceCenter] ========== SYNC DATA CLICKED =========="),this.contactsService.isSyncing()){console.log("[ResourceCenter] Already syncing, skip"),this.toast.warning("\u6B63\u5728\u540C\u6B65\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}console.log("[ResourceCenter] Calling syncFromSources()..."),this.contactsService.syncFromSources(),this.toast.info("\u{1F504} \u6B63\u5728\u540C\u6B65\u6578\u64DA\uFF0C\u8ACB\u7A0D\u5019...",5e3),this.refreshDataEvent.emit()}search(){this.contactsService.search(this.searchKeyword),this.currentPage.set(1)}filterByStatus(e){this.contactsService.setFilter({status:e||void 0,offset:0}),this.currentPage.set(1)}filterByTag(e){this.contactsService.setFilter({tags:e?[e]:void 0,offset:0}),this.currentPage.set(1)}resetFilters(){this.selectedStatus="",this.selectedTag="",this.searchKeyword="",this.activeTab.set("all"),this.contactsService.resetFilter(),this.currentPage.set(1)}hasNextPage(){return this.currentPage()*this.pageSize<this.contactsService.total()}prevPage(){this.currentPage()>1&&(this.currentPage.update(e=>e-1),this.contactsService.setPage(this.currentPage(),this.pageSize))}nextPage(){this.hasNextPage()&&(this.currentPage.update(e=>e+1),this.contactsService.setPage(this.currentPage(),this.pageSize))}isAllSelected(){let e=this.contactsService.contacts(),t=this.contactsService.selectedIds();return e.length>0&&e.every(n=>t.has(n.telegram_id))}sendMessage(e){this.sendMessageEvent.emit(e)}viewDetail(e){this.viewDetailEvent.emit(e)}editContact(e){this.toast.info("\u7DE8\u8F2F\u529F\u80FD\u958B\u767C\u4E2D...",2e3)}batchSendMessage(){let t=this.contactsService.selectedContacts().filter(n=>n.contact_type==="user");if(t.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u7528\u6236",2e3);return}this.batchSendEvent.emit(t),this.toast.info(`\u6E96\u5099\u5411 ${t.length} \u500B\u7528\u6236\u767C\u9001\u6D88\u606F...`,2e3)}sendToAISales(){let e=this.contactsService.selectedContacts();if(e.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u806F\u7E6B\u4EBA",2e3);return}this.sendToAISalesEvent.emit(e),this.toast.success(`\u5DF2\u5C07 ${e.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165\u767C\u9001\u968A\u5217`,2e3),this.contactsService.clearSelection()}goToSendConsole(){this.nav.navigateTo("leads")}toggleBatchTag(e){let t=new Set(this.selectedBatchTags());t.has(e)?t.delete(e):t.add(e),this.selectedBatchTags.set(t)}applyBatchTags(){let e=Array.from(this.selectedBatchTags());if(e.length===0){this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u6A19\u7C64",2e3);return}this.contactsService.addTagsToSelected(e),this.showBatchTagDialog.set(!1),this.selectedBatchTags.set(new Set),this.toast.success("\u6A19\u7C64\u5DF2\u6DFB\u52A0",2e3)}applyBatchStatus(e){let t=this.contactsService.selectedContacts();this.contactsService.updateSelectedStatus(e),this.showBatchStatusDialog.set(!1),this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0",2e3),t.length>0&&this.statusChangedEvent.emit({contacts:t,status:e})}confirmBatchDelete(){this.showDeleteConfirm.set(!0)}confirmDelete(){this.contactsService.deleteSelected(),this.showDeleteConfirm.set(!1),this.toast.success("\u5DF2\u522A\u9664",2e3)}exportData(){this.toast.info("\u5C0E\u51FA\u529F\u80FD\u958B\u767C\u4E2D...",2e3)}getInitial(e){return e.display_name?e.display_name.charAt(0).toUpperCase():"?"}getTypeLabel(e){switch(e){case"user":return"\u6210\u54E1";case"group":return"\u7FA4\u7D44";case"channel":return"\u983B\u9053";default:return e}}getSourceLabel(e){switch(e){case"member":return"\u7FA4\u7D44\u63D0\u53D6";case"resource":return"\u8CC7\u6E90\u767C\u73FE";case"lead":return"\u71DF\u92B7\u6F0F\u6597";case"manual":return"\u624B\u52D5\u6DFB\u52A0";case"import":return"\u6279\u91CF\u5C0E\u5165";default:return e||"\u672A\u77E5"}}getSourceIcon(e){switch(e){case"member":return"\u{1F465}";case"resource":return"\u{1F50D}";case"lead":return"\u{1F3AF}";case"manual":return"\u270B";case"import":return"\u{1F4E5}";default:return"\u{1F4CB}"}}getSourceColor(e){switch(e){case"member":return"text-blue-400 bg-blue-500/20";case"resource":return"text-green-400 bg-green-500/20";case"lead":return"text-orange-400 bg-orange-500/20";case"manual":return"text-purple-400 bg-purple-500/20";case"import":return"text-cyan-400 bg-cyan-500/20";default:return"text-slate-400 bg-slate-500/20"}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-resource-center"]],outputs:{sendMessageEvent:"sendMessageEvent",viewDetailEvent:"viewDetailEvent",batchSendEvent:"batchSendEvent",sendToAISalesEvent:"sendToAISalesEvent",statusChangedEvent:"statusChangedEvent",refreshDataEvent:"refreshDataEvent"},decls:92,vars:14,consts:[[1,"resource-center","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],["title","\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65",1,"flex","items-center","gap-2","px-3","py-1","bg-blue-500/20","text-blue-400","rounded-full","text-sm","cursor-pointer","hover:bg-blue-500/30"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-lg","hover:from-cyan-600","hover:to-blue-600","transition-colors","flex","items-center","gap-2",3,"click"],[1,"px-4","py-2","bg-blue-500/20","text-blue-400","rounded-lg","hover:bg-blue-500/30","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","transition-colors",3,"click"],[1,"p-4","border-b","border-slate-700/30"],[1,"grid","grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-slate-800/80","to-slate-800/40","rounded-xl","p-4","border","border-slate-700/50"],[1,"text-slate-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"text-4xl","opacity-20"],[1,"bg-gradient-to-br","from-emerald-900/30","to-slate-800/40","rounded-xl","p-4","border","border-emerald-700/30"],[1,"text-emerald-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"bg-gradient-to-br","from-blue-900/30","to-slate-800/40","rounded-xl","p-4","border","border-blue-700/30"],[1,"text-blue-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-blue-400"],[1,"bg-gradient-to-br","from-yellow-900/30","to-slate-800/40","rounded-xl","p-4","border","border-yellow-700/30"],[1,"text-yellow-400","text-sm","mb-1"],[1,"text-3xl","font-bold","text-yellow-400"],[1,"flex","items-center","gap-4","flex-wrap"],[1,"flex","bg-slate-800/50","rounded-lg","p-1"],[1,"px-4","py-2","rounded-md","text-sm","transition-all",3,"bg-purple-500","text-white","text-slate-400","hover:text-white"],[1,"px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","text-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"flex-1","max-w-md"],[1,"relative"],["type","text","placeholder","\u641C\u7D22\u540D\u7A31\u3001\u7528\u6236\u540D\u6216 ID...",1,"w-full","px-4","py-2","pl-10","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-slate-500",3,"ngModelChange","keyup.enter","ngModel"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"absolute","left-3","top-1/2","-translate-y-1/2","h-4","w-4","text-slate-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400","transition-colors",3,"click"],[1,"p-3","bg-purple-500/10","border-b","border-purple-500/30","flex","items-center","gap-4"],[1,"flex-1","overflow-y-auto","p-4"],[1,"flex","items-center","justify-center","h-64"],[1,"flex","flex-col","items-center","justify-center","h-64","text-slate-400"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],["title","\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65",1,"flex","items-center","gap-2","px-3","py-1","bg-blue-500/20","text-blue-400","rounded-full","text-sm","cursor-pointer","hover:bg-blue-500/30",3,"click"],[1,"animate-spin","h-4","w-4","border-2","border-blue-400","border-t-transparent","rounded-full"],[1,"px-4","py-2","rounded-md","text-sm","transition-all",3,"click"],[1,"text-purple-400","text-sm"],[1,"px-3","py-1.5","bg-blue-500/20","text-blue-400","rounded-lg","text-sm","hover:bg-blue-500/30",3,"click"],[1,"px-3","py-1.5","bg-green-500/20","text-green-400","rounded-lg","text-sm","hover:bg-green-500/30",3,"click"],[1,"px-3","py-1.5","bg-purple-500/20","text-purple-400","rounded-lg","text-sm","hover:bg-purple-500/30",3,"click"],[1,"px-3","py-1.5","bg-cyan-500/20","text-cyan-400","rounded-lg","text-sm","hover:bg-cyan-500/30","flex","items-center","gap-1",3,"click"],[1,"px-3","py-1.5","bg-red-500/20","text-red-400","rounded-lg","text-sm","hover:bg-red-500/30",3,"click"],[1,"ml-auto","px-3","py-1.5","text-slate-400","text-sm","hover:text-white",3,"click"],[1,"animate-spin","rounded-full","h-12","w-12","border-t-2","border-b-2","border-purple-500"],[1,"text-5xl","mb-4"],[1,"text-lg","mb-2"],[1,"text-sm","mb-4"],[1,"bg-slate-800/30","rounded-xl","border","border-slate-700/50","overflow-hidden"],[1,"w-full"],[1,"bg-slate-800/50"],[1,"text-left","text-slate-400","text-sm"],[1,"p-3","w-12"],["type","checkbox",1,"rounded","bg-slate-700","border-slate-600",3,"change","checked"],[1,"p-3"],[1,"border-t","border-slate-700/30","hover:bg-slate-800/30","transition-colors"],[1,"flex","items-center","justify-between","mt-4","text-slate-400","text-sm"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-slate-800","rounded-lg","hover:bg-slate-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-white","font-bold"],[1,"font-medium","text-white"],[1,"text-sm","text-slate-400"],[1,"px-2","py-1","rounded-full","text-xs"],[1,"flex","items-center","gap-1"],[1,"text-sm"],[1,"text-sm","px-1.5","py-0.5","rounded"],[1,"text-xs","text-slate-500","truncate","max-w-32","mt-0.5"],[1,"flex","flex-wrap","gap-1"],[1,"px-2","py-0.5","bg-slate-700","text-slate-300","rounded","text-xs"],[1,"px-2","py-0.5","bg-slate-700","text-slate-400","rounded","text-xs"],[1,"w-16","bg-slate-700","rounded-full","h-2"],[1,"bg-gradient-to-r","from-purple-500","to-pink-500","h-2","rounded-full"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","text-blue-400","hover:bg-blue-500/20","rounded-lg","transition-colors"],["title","\u67E5\u770B\u8A73\u60C5",1,"p-2","text-slate-400","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["title","\u7DE8\u8F2F",1,"p-2","text-slate-400","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","\u767C\u9001\u6D88\u606F",1,"p-2","text-blue-400","hover:bg-blue-500/20","rounded-lg","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"bg-slate-800","rounded-2xl","w-full","max-w-md","p-6","shadow-xl","border","border-slate-700"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"space-y-3","max-h-64","overflow-y-auto"],[1,"flex","items-center","gap-3","p-2","hover:bg-slate-700/50","rounded-lg","cursor-pointer"],[1,"flex","gap-3","mt-6"],[1,"flex-1","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],[1,"flex-1","py-2.5","bg-purple-500","text-white","rounded-lg","hover:bg-purple-400",3,"click"],[1,"text-white"],[1,"space-y-2"],[1,"w-full","p-3","text-left","rounded-lg","hover:bg-slate-700/50","flex","items-center","gap-3"],[1,"w-full","mt-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600",3,"click"],[1,"w-full","p-3","text-left","rounded-lg","hover:bg-slate-700/50","flex","items-center","gap-3",3,"click"],[1,"w-3","h-3","rounded-full"],[1,"text-xl","font-bold","text-red-400","mb-4"],[1,"text-slate-300","mb-6"],[1,"flex","gap-3"],[1,"flex-1","py-2.5","bg-red-500","text-white","rounded-lg","hover:bg-red-400",3,"click"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u{1F4E6}"),s(),l(7," \u8CC7\u6E90\u4E2D\u5FC3 "),s(),S(8,F2,3,0,"span",6),s(),r(9,"div",7)(10,"button",8),x("click",function(){return n.goToSendConsole()}),r(11,"span"),l(12,"\u{1F4E4}"),s(),l(13," \u767C\u9001\u63A7\u5236\u53F0 "),s(),r(14,"button",9),x("click",function(){return n.syncData()}),ne(),r(15,"svg",10),k(16,"path",11),s(),l(17," \u540C\u6B65\u6578\u64DA "),s(),ge(),r(18,"button",12),x("click",function(){return n.showImportDialog.set(!0)}),l(19," \u5C0E\u5165 "),s(),r(20,"button",12),x("click",function(){return n.exportData()}),l(21," \u5C0E\u51FA "),s()()()(),r(22,"div",13)(23,"div",14)(24,"div",15)(25,"div",2)(26,"div")(27,"div",16),l(28,"\u{1F4CA} \u7E3D\u8CC7\u6E90"),s(),r(29,"div",17),l(30),s()(),r(31,"div",18),l(32,"\u{1F4E6}"),s()()(),r(33,"div",19)(34,"div",2)(35,"div")(36,"div",20),l(37,"\u{1F195} \u672C\u9031\u65B0\u589E"),s(),r(38,"div",21),l(39),s()(),r(40,"div",18),l(41,"\u{1F4C8}"),s()()(),r(42,"div",22)(43,"div",2)(44,"div")(45,"div",23),l(46,"\u{1F514} \u5F85\u8DDF\u9032"),s(),r(47,"div",24),l(48),s()(),r(49,"div",18),l(50,"\u{1F44B}"),s()()(),r(51,"div",25)(52,"div",2)(53,"div")(54,"div",26),l(55,"\u{1F4AC} \u5DF2\u806F\u7E6B"),s(),r(56,"div",27),l(57),s()(),r(58,"div",18),l(59,"\u2709\uFE0F"),s()()()()(),r(60,"div",13)(61,"div",28)(62,"div",29),$(63,N2,2,10,"button",30,I2),s(),r(65,"select",31),W("ngModelChange",function(a){return K(n.selectedStatus,a)||(n.selectedStatus=a),a}),x("ngModelChange",function(a){return n.filterByStatus(a)}),r(66,"option",32),l(67,"\u6240\u6709\u72C0\u614B"),s(),$(68,R2,2,2,"option",33,kd),s(),r(70,"select",31),W("ngModelChange",function(a){return K(n.selectedTag,a)||(n.selectedTag=a),a}),x("ngModelChange",function(a){return n.filterByTag(a)}),r(71,"option",32),l(72,"\u6240\u6709\u6A19\u7C64"),s(),$(73,O2,2,2,"option",33,Pe),s(),r(75,"div",34)(76,"div",35)(77,"input",36),W("ngModelChange",function(a){return K(n.searchKeyword,a)||(n.searchKeyword=a),a}),x("keyup.enter",function(){return n.search()}),s(),ne(),r(78,"svg",37),k(79,"path",38),s()()(),ge(),r(80,"button",39),x("click",function(){return n.search()}),l(81," \u641C\u7D22 "),s(),r(82,"button",12),x("click",function(){return n.resetFilters()}),l(83," \u91CD\u7F6E "),s()()(),S(84,B2,17,1,"div",40),r(85,"div",41),S(86,V2,2,0,"div",42)(87,L2,9,0,"div",43)(88,K2,33,6),s(),S(89,J2,12,0,"div",44),S(90,Y2,9,0,"div",44),S(91,X2,11,1,"div",44),s()),t&2){let o,a;c(8),w(n.contactsService.isSyncing()?8:-1),c(6),V("disabled",n.contactsService.isSyncing()),c(16),A(n.contactsService.stats().total),c(9),D("+",n.contactsService.stats().recent_added),c(9),A(((o=n.contactsService.stats().by_status)==null?null:o.new)||0),c(9),A(((a=n.contactsService.stats().by_status)==null?null:a.contacted)||0),c(6),H(n.tabs),c(2),z("ngModel",n.selectedStatus),c(3),H(n.statusOptions),c(2),z("ngModel",n.selectedTag),c(3),H(n.defaultTags),c(4),z("ngModel",n.searchKeyword),c(7),w(n.contactsService.selectedIds().size>0?84:-1),c(2),w(n.contactsService.isLoading()?86:n.contactsService.contacts().length===0?87:88),c(3),w(n.showBatchTagDialog()?89:-1),c(),w(n.showBatchStatusDialog()?90:-1),c(),w(n.showDeleteConfirm()?91:-1)}},dependencies:[te,me,Qe,Ye,xe,lt,_e,Ce],styles:[".resource-center[_ngcontent-%COMP%]{min-height:100vh}"]})}};var Z2=`\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u7CBE\u901A\u5404\u884C\u696D\u7684\u5BA2\u6236\u7372\u53D6\u548C\u71DF\u92B7\u8A71\u8853\u3002

\u7528\u6236\u9700\u6C42\uFF1A{USER_INPUT}

\u8ACB\u6839\u64DA\u7528\u6236\u9700\u6C42\uFF0C\u751F\u6210\u4E00\u4EFD\u5B8C\u6574\u7684\u71DF\u92B7\u7B56\u7565\u3002\u8FD4\u56DE\u7D14 JSON \u683C\u5F0F\uFF08\u4E0D\u8981 markdown \u4EE3\u78BC\u584A\uFF09\uFF1A

{
  "industry": "\u8B58\u5225\u7684\u76EE\u6A19\u884C\u696D",
  "targetAudience": "\u76EE\u6A19\u53D7\u773E\u63CF\u8FF0",
  "keywords": {
    "highIntent": ["\u9AD8\u610F\u5411\u95DC\u9375\u8A5E1", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E2", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E3"],
    "mediumIntent": ["\u4E2D\u610F\u5411\u95DC\u9375\u8A5E1", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E2", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E3"],
    "extended": ["\u64F4\u5C55\u95DC\u9375\u8A5E1", "\u64F4\u5C55\u95DC\u9375\u8A5E2", "\u64F4\u5C55\u95DC\u9375\u8A5E3"]
  },
  "customerProfile": {
    "identity": ["\u8EAB\u4EFD\u7279\u5FB51", "\u8EAB\u4EFD\u7279\u5FB52", "\u8EAB\u4EFD\u7279\u5FB53"],
    "features": ["\u884C\u70BA\u7279\u5FB51", "\u884C\u70BA\u7279\u5FB52", "\u884C\u70BA\u7279\u5FB53"],
    "needs": ["\u6838\u5FC3\u9700\u6C421", "\u6838\u5FC3\u9700\u6C422", "\u6838\u5FC3\u9700\u6C423"]
  },
  "recommendedGroups": ["\u63A8\u85A6\u641C\u7D22\u7684\u7FA4\u7D44\u985E\u578B1", "\u63A8\u85A6\u7FA4\u7D44\u985E\u578B2"],
  "messageTemplates": {
    "firstTouch": "\u9996\u6B21\u89F8\u9054\u6D88\u606F\u6A21\u677F\uFF08\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF09",
    "followUp": "\u8DDF\u9032\u6D88\u606F\u6A21\u677F",
    "closing": "\u4FC3\u6210\u8F49\u5316\u6D88\u606F\u6A21\u677F"
  },
  "automationSettings": {
    "monitorMode": "24/7 \u5168\u5929\u5019",
    "responseDelay": 30,
    "followUpInterval": 7200
  }
}

\u8981\u6C42\uFF1A
1. \u95DC\u9375\u8A5E\u8981\u7CBE\u6E96\uFF0C\u8986\u84CB\u884C\u696D\u5E38\u7528\u8853\u8A9E\u548C\u641C\u7D22\u8A5E
2. \u6D88\u606F\u6A21\u677F\u8981\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF0C\u907F\u514D\u6A5F\u5668\u4EBA\u611F
3. \u5BA2\u6236\u756B\u50CF\u8981\u5177\u9AD4\uFF0C\u4FBF\u65BC\u8B58\u5225\u76EE\u6A19\u5BA2\u6236
4. \u53EA\u8FD4\u56DE JSON\uFF0C\u4E0D\u8981\u4EFB\u4F55\u5176\u4ED6\u89E3\u91CB`,Wo=class i{constructor(){this.aiProviderService=O(nl);this.aiCenterService=O(Ka);this.toastService=O(ue);this.ipcService=O(ye);this._availableModels=_([]);this.availableModels=this._availableModels.asReadonly();this._selectedModelId=_("local-ollama");this.selectedModelId=this._selectedModelId.asReadonly();this._localAIConfig=_({endpoint:"https://ms-defysomwqybz.tail05a567.ts.net/api/chat",model:"huihui_ai/qwen2.5-abliterate",isConnected:!1,lastChecked:""});this.localAIConfig=this._localAIConfig.asReadonly();this._generationStatus=_({isGenerating:!1,currentProvider:"",progress:0,message:""});this.generationStatus=this._generationStatus.asReadonly();this._savedStrategies=_([]);this.savedStrategies=this._savedStrategies.asReadonly();this._currentStrategy=_(null);this.currentStrategy=this._currentStrategy.asReadonly();this.selectedModel=G(()=>this._availableModels().find(e=>e.id===this._selectedModelId()));this.loadConfig(),this.refreshAvailableModels()}async refreshAvailableModels(){let e=[],t=this.aiCenterService.models(),n=t.filter(m=>m.isLocal);if(n.length>0)for(let m of n)e.push({id:m.id,name:m.displayName||m.modelName,provider:"Ollama (\u672C\u5730)",icon:"\u{1F999}",isLocal:!0,isConnected:m.isConnected,endpoint:m.apiEndpoint}),m.apiEndpoint&&this._localAIConfig.update(f=>B(F({},f),{endpoint:m.apiEndpoint,model:m.modelName,isConnected:m.isConnected}));else{let m=this._localAIConfig();e.push({id:"local-ollama",name:`\u672C\u5730 AI (${m.model})`,provider:"Ollama (Tailscale)",icon:"\u{1F999}",isLocal:!0,isConnected:m.isConnected,endpoint:m.endpoint})}let o=t.filter(m=>!m.isLocal);for(let m of o){let f=this.getProviderInfo(m.provider),h=this.getModelCapability(m.modelName);e.push({id:m.id,name:m.displayName||m.modelName,provider:f.name,icon:f.icon,isLocal:!1,isConnected:m.isConnected,capability:h})}e.length===0&&console.log("[AIStrategy] \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B\uFF0C\u8ACB\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E"),e.sort((m,f)=>m.isConnected&&!f.isConnected?-1:!m.isConnected&&f.isConnected?1:m.isLocal&&!f.isLocal?-1:0),this._availableModels.set(e);let a=this._selectedModelId();if(!e.map(m=>m.id).includes(a)){let m=e.find(f=>f.isConnected);m?this._selectedModelId.set(m.id):e.length>0&&this._selectedModelId.set(e[0].id)}}selectModel(e){this._selectedModelId.set(e),this.saveConfig()}updateLocalAIConfig(e){this._localAIConfig.update(t=>F(F({},t),e)),this.saveConfig(),this.refreshAvailableModels()}async testLocalAIConnection(){let e=this._localAIConfig();try{this._generationStatus.set({isGenerating:!0,currentProvider:"\u672C\u5730 Ollama",progress:50,message:"\u6B63\u5728\u6E2C\u8A66\u9023\u63A5..."});let t=await fetch(e.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e.model,messages:[{role:"user",content:"Hi, please respond with OK."}],stream:!1,options:{temperature:.1,num_predict:10}}),signal:AbortSignal.timeout(1e4)});if(t.ok&&(await t.json()).message?.content)return this._localAIConfig.update(o=>B(F({},o),{isConnected:!0,lastChecked:new Date().toISOString()})),this.refreshAvailableModels(),this.toastService.success("\u672C\u5730 AI \u9023\u63A5\u6210\u529F\uFF01"),!0;throw new Error("\u7121\u6548\u97FF\u61C9")}catch(t){return this._localAIConfig.update(n=>B(F({},n),{isConnected:!1,lastChecked:new Date().toISOString()})),this.refreshAvailableModels(),this.toastService.error(`\u672C\u5730 AI \u9023\u63A5\u5931\u6557: ${t.message}`),!1}finally{this._generationStatus.set({isGenerating:!1,currentProvider:"",progress:0,message:""})}}async generateStrategy(e){let t=Z2.replace("{USER_INPUT}",e),n=[{role:"system",content:"\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u53EA\u8FD4\u56DE JSON \u683C\u5F0F\u7684\u7B56\u7565\u5206\u6790\u7D50\u679C\u3002"},{role:"user",content:t}],o=this.selectedModel(),a=o?.name||"\u672C\u5730 AI",d=o?.isLocal??!0;if(console.log(`[AIStrategy] \u4F7F\u7528\u6A21\u578B: ${a}, isLocal: ${d}`),d){this._generationStatus.set({isGenerating:!0,currentProvider:a,progress:20,message:`\u6B63\u5728\u4F7F\u7528 ${a} \u5206\u6790...`});try{let f=await this.callLocalAI(n);if(f){let h=this.parseStrategyResponse(f);if(h)return this._generationStatus.set({isGenerating:!1,currentProvider:a,progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),h}}catch(f){console.warn(`[AIStrategy] ${a} \u5931\u6557:`,f.message),this.toastService.warning(`${a} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u96F2\u7AEF\u56DE\u9000...`)}this._generationStatus.set({isGenerating:!0,currentProvider:"\u96F2\u7AEF AI (\u56DE\u9000)",progress:50,message:"\u672C\u5730 AI \u4E0D\u53EF\u7528\uFF0C\u6B63\u5728\u4F7F\u7528\u96F2\u7AEF AI..."});try{let f=await this.callCloudAI(n);if(f){let h=this.parseStrategyResponse(f);if(h)return this._generationStatus.set({isGenerating:!1,currentProvider:"\u96F2\u7AEF AI",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),h}}catch(f){console.warn("[AIStrategy] \u96F2\u7AEF AI \u56DE\u9000\u5931\u6557:",f.message)}}else{this._generationStatus.set({isGenerating:!0,currentProvider:a,progress:30,message:`\u6B63\u5728\u4F7F\u7528 ${a} \u5206\u6790...`});try{let f=await this.callSelectedCloudModel(n,o);if(f){let h=this.parseStrategyResponse(f);if(h)return this._generationStatus.set({isGenerating:!1,currentProvider:a,progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),h}}catch(f){console.warn(`[AIStrategy] ${a} \u5931\u6557:`,f.message),this.toastService.warning(`${a} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u5176\u4ED6\u6A21\u578B...`)}this._generationStatus.set({isGenerating:!0,currentProvider:"\u5176\u4ED6\u96F2\u7AEF\u6A21\u578B",progress:60,message:"\u5617\u8A66\u5176\u4ED6\u53EF\u7528\u6A21\u578B..."});try{let f=await this.callCloudAI(n);if(f){let h=this.parseStrategyResponse(f);if(h)return this._generationStatus.set({isGenerating:!1,currentProvider:"\u96F2\u7AEF AI",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF01"}),h}}catch(f){console.warn("[AIStrategy] \u6240\u6709\u96F2\u7AEF AI \u5931\u6557:",f.message)}}this._generationStatus.set({isGenerating:!0,currentProvider:"\u6A21\u677F\u56DE\u9000",progress:80,message:"AI \u4E0D\u53EF\u7528\uFF0C\u4F7F\u7528\u667A\u80FD\u6A21\u677F..."});let m=this.generateFromTemplate(e);return this._generationStatus.set({isGenerating:!1,currentProvider:"\u6A21\u677F\u56DE\u9000",progress:100,message:"\u751F\u6210\u5B8C\u6210\uFF08\u6A21\u677F\u6A21\u5F0F\uFF09"}),m}async callLocalAI(e){let t=this._localAIConfig(),n=await fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t.model,messages:e,stream:!1,options:{temperature:.7,num_predict:2048,top_p:.9}}),signal:AbortSignal.timeout(3e4)});if(!n.ok)throw new Error(`\u672C\u5730 AI \u8ACB\u6C42\u5931\u6557: ${n.status}`);return(await n.json()).message?.content||null}async callCloudAI(e){try{console.log("[AIStrategy] \u5617\u8A66\u901A\u904E\u5F8C\u7AEF IPC \u8ABF\u7528 AI...");let a=await this.callAIViaBackend(e);if(a)return console.log("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u6210\u529F"),a}catch(a){console.warn("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u5931\u6557:",a)}let t=this.aiCenterService.models(),n=t.filter(a=>a.isConnected&&!a.isLocal),o=n.length>0?n:t.filter(a=>!a.isLocal&&a.apiKey);for(let a of o)try{console.log(`[AIStrategy] \u5617\u8A66\u96F2\u7AEF\u6A21\u578B: ${a.modelName}`),this.aiProviderService.setConfig({provider:a.provider,model:a.modelName,apiKey:a.apiKey,baseUrl:a.apiEndpoint});let d=await this.aiProviderService.chat(e);if(d.content)return d.content}catch(d){console.warn(`[AIStrategy] \u96F2\u7AEF\u6A21\u578B ${a.modelName} \u5931\u6557:`,d)}if(this.aiProviderService.isConnected())try{return(await this.aiProviderService.chat(e)).content}catch(a){console.warn("[AIStrategy] AIProviderService \u8ABF\u7528\u5931\u6557:",a)}return null}callAIViaBackend(e){return new Promise((t,n)=>{let o=setTimeout(()=>{this.ipcService.off("ai-response",a),n(new Error("\u5F8C\u7AEF AI \u8ABF\u7528\u8D85\u6642"))},6e4),a=h=>{clearTimeout(o),this.ipcService.off("ai-response",a),h.success&&h.response?t(h.response):h.error?n(new Error(h.error)):t(null)};this.ipcService.on("ai-response",a);let d=e.find(h=>h.role==="system"),m=e.find(h=>h.role==="user"),f=this._localAIConfig();this.ipcService.send("generate-ai-response",{userId:"strategy-generator",message:m?.content||"",systemPrompt:d?.content||"",localAiEndpoint:f.endpoint,localAiModel:f.model})})}async callSelectedCloudModel(e,t){let o=this.aiCenterService.models().find(d=>d.id===t.id);return o?!o.apiKey&&!o.isConnected?(console.warn(`[AIStrategy] \u6A21\u578B ${t.name} \u672A\u914D\u7F6E API Key`),this.toastService.error(`\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E ${t.name} \u7684 API Key`),null):(console.log(`[AIStrategy] \u8ABF\u7528\u9078\u5B9A\u6A21\u578B: ${o.modelName}, provider: ${o.provider}`),this.aiProviderService.setConfig({provider:o.provider,model:o.modelName,apiKey:o.apiKey,baseUrl:o.apiEndpoint}),(await this.aiProviderService.chat(e)).content):(console.warn(`[AIStrategy] \u627E\u4E0D\u5230\u6A21\u578B\u914D\u7F6E: ${t.id}`),null)}getLocalAIFromCenter(){let e=this.aiCenterService.models().filter(t=>t.isLocal);if(e.length>0){let t=e[0];return{endpoint:t.apiEndpoint||"",model:t.modelName}}return null}syncLocalAIFromCenter(){let e=this.getLocalAIFromCenter();e&&e.endpoint&&this._localAIConfig.update(t=>B(F({},t),{endpoint:e.endpoint,model:e.model}))}parseStrategyResponse(e){try{let t=e,n=e.match(/```(?:json)?\s*([\s\S]*?)```/);n&&(t=n[1]);let o=t.indexOf("{"),a=t.lastIndexOf("}");o!==-1&&a!==-1&&(t=t.slice(o,a+1));let d=JSON.parse(t);if(!d.industry||!d.keywords)throw new Error("\u7F3A\u5C11\u5FC5\u8981\u5B57\u6BB5");return{industry:d.industry||"\u672A\u8B58\u5225\u884C\u696D",targetAudience:d.targetAudience||"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4",keywords:{highIntent:d.keywords?.highIntent||[],mediumIntent:d.keywords?.mediumIntent||[],extended:d.keywords?.extended||[]},customerProfile:{identity:d.customerProfile?.identity||[],features:d.customerProfile?.features||[],needs:d.customerProfile?.needs||[]},recommendedGroups:d.recommendedGroups||[],messageTemplates:{firstTouch:d.messageTemplates?.firstTouch||"",followUp:d.messageTemplates?.followUp||"",closing:d.messageTemplates?.closing||""},automationSettings:{monitorMode:d.automationSettings?.monitorMode||"24/7 \u5168\u5929\u5019",responseDelay:d.automationSettings?.responseDelay||30,followUpInterval:d.automationSettings?.followUpInterval||7200}}}catch(t){return console.error("[AIStrategy] \u89E3\u6790 AI \u97FF\u61C9\u5931\u6557:",t,e),null}}generateFromTemplate(e){let t="\u901A\u7528\u884C\u696D",n={highIntent:["\u5408\u4F5C","\u4EE3\u7406","\u5C0D\u63A5"],mediumIntent:["\u8CC7\u6E90","\u6E20\u9053","\u696D\u52D9"],extended:["\u4EA4\u6D41","\u4E86\u89E3","\u54A8\u8A62"]};return e.includes("\u652F\u4ED8")||e.includes("\u63DB\u532F")||e.includes("\u8DD1\u5206")?(t="\u652F\u4ED8/\u63DB\u532F",n={highIntent:["\u652F\u4ED8\u901A\u9053","U\u5546","\u63DB\u532F","USDT","\u4EE3\u6536\u4EE3\u4ED8","\u8DD1\u5206"],mediumIntent:["\u56DB\u65B9\u652F\u4ED8","\u4E09\u65B9\u652F\u4ED8","API\u5C0D\u63A5","\u627F\u514C\u5546"],extended:["OTC","\u6536\u6B3E","\u51FA\u6B3E","\u8CBB\u7387","T+0","T+1"]}):e.includes("\u5E63")||e.includes("\u52A0\u5BC6")||e.includes("BTC")?(t="\u52A0\u5BC6\u8CA8\u5E63",n={highIntent:["BTC","ETH","\u5408\u7D04","\u73FE\u8CA8","\u4EA4\u6613\u6240"],mediumIntent:["DeFi","NFT","\u9322\u5305","\u516C\u93C8"],extended:["\u6316\u7926","\u8CEA\u62BC","\u7A7A\u6295","IDO"]}):(e.includes("\u96FB\u5546")||e.includes("\u8DE8\u5883")||e.includes("\u4E9E\u99AC\u905C"))&&(t="\u96FB\u5546/\u8DE8\u5883",n={highIntent:["\u4E9E\u99AC\u905C","\u7368\u7ACB\u7AD9","Shopify","\u7269\u6D41","\u9078\u54C1"],mediumIntent:["FBA","\u6D77\u5916\u5009","\u6E05\u95DC","\u652F\u4ED8"],extended:["\u6E2C\u8A55","\u5237\u55AE","\u7AD9\u5916\u63A8\u5EE3"]}),{industry:t,targetAudience:this.extractAudience(e),keywords:n,customerProfile:{identity:["\u4EE3\u7406\u5546","\u9805\u76EE\u65B9","\u904B\u71DF\u4EBA\u54E1"],features:["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44","\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F","\u6709\u660E\u78BA\u9700\u6C42"],needs:["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34","\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE","\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]},recommendedGroups:[`${t}\u4EA4\u6D41\u7FA4`,"\u696D\u52D9\u5C0D\u63A5\u7FA4","\u9805\u76EE\u5408\u4F5C\u7FA4"],messageTemplates:{firstTouch:`\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${t}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,followUp:"\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",closing:"\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"},automationSettings:{monitorMode:"24/7 \u5168\u5929\u5019",responseDelay:30,followUpInterval:7200}}}extractAudience(e){return e.includes("\u4EE3\u7406")?"\u4EE3\u7406\u5546/\u6E20\u9053\u5546":e.includes("\u5BA2\u6236")?"\u7D42\u7AEF\u5BA2\u6236":e.includes("\u9805\u76EE")?"\u9805\u76EE\u65B9/\u904B\u71DF\u5546":"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4"}getProviderInfo(e){switch(e){case"openai":return{name:"OpenAI",icon:"\u{1F916}"};case"claude":return{name:"Anthropic",icon:"\u{1F9E0}"};case"gemini":return{name:"Google",icon:"\u2728"};default:return{name:e,icon:"\u{1F527}"}}}getModelCapability(e){let t=e.toLowerCase();return t.includes("flash")||t.includes("mini")||t.includes("haiku")||t.includes("3.5-turbo")?"fast":t.includes("opus")||t.includes("pro")||t.includes("gpt-4o")||t.includes("ultra")?"powerful":t.includes("mini")||t.includes("nano")||t.includes("lite")?"economic":"balanced"}loadConfig(){try{let e=localStorage.getItem("ai-strategy-config");if(e){let t=JSON.parse(e);t.localAIConfig&&this._localAIConfig.set(t.localAIConfig),t.selectedModelId&&this._selectedModelId.set(t.selectedModelId)}this.loadSavedStrategies()}catch(e){console.error("Failed to load AI strategy config:",e)}}saveConfig(){try{localStorage.setItem("ai-strategy-config",JSON.stringify({localAIConfig:this._localAIConfig(),selectedModelId:this._selectedModelId()}))}catch(e){console.error("Failed to save AI strategy config:",e)}}loadSavedStrategies(){try{let e=localStorage.getItem("ai-saved-strategies");if(e){let t=JSON.parse(e);this._savedStrategies.set(t),console.log(`[AIStrategy] \u5DF2\u52A0\u8F09 ${t.length} \u500B\u4FDD\u5B58\u7684\u7B56\u7565`)}}catch(e){console.error("Failed to load saved strategies:",e)}}saveStrategy(e,t){let n={id:`strategy-${Date.now()}`,name:t||`${e.industry} - ${new Date().toLocaleDateString("zh-TW")}`,strategy:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usedCount:0},o=[...this._savedStrategies(),n];this._savedStrategies.set(o),this._currentStrategy.set(e);try{localStorage.setItem("ai-saved-strategies",JSON.stringify(o))}catch(a){console.error("Failed to save strategies:",a)}return this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01"),n}loadStrategy(e){let t=this._savedStrategies().find(n=>n.id===e);return t?(t.usedCount++,t.updatedAt=new Date().toISOString(),this._currentStrategy.set(t.strategy),this.persistStrategies(),t.strategy):null}deleteStrategy(e){let t=this._savedStrategies().filter(n=>n.id!==e);this._savedStrategies.set(t),this.persistStrategies(),this.toastService.success("\u7B56\u7565\u5DF2\u522A\u9664")}setCurrentStrategy(e){this._currentStrategy.set(e)}persistStrategies(){try{localStorage.setItem("ai-saved-strategies",JSON.stringify(this._savedStrategies()))}catch(e){console.error("Failed to persist strategies:",e)}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var js=(i,e)=>e.id;function j2(i,e){if(i&1&&(r(0,"span",18),l(1),s()),i&2){let t=g(2);c(),D(" ",t.connectedModelsCount()," \u500B\u5DF2\u9023\u63A5 ")}}function eS(i,e){i&1&&(r(0,"span",19),l(1,"\u672A\u914D\u7F6E"),s())}function tS(i,e){if(i&1){let t=M();r(0,"div",21)(1,"p",26),l(2,"\u26A0\uFE0F \u5C1A\u672A\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B"),s(),r(3,"p",27),l(4,"\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E\u4E26\u6E2C\u8A66 AI \u6A21\u578B"),s(),r(5,"button",28),x("click",function(){v(t);let o=g(2);return b(o.goToAICenter())}),l(6," \u{1F680} \u524D\u5F80\u914D\u7F6E AI "),s()()}}function nS(i,e){if(i&1&&(r(0,"span",38),l(1),s()),i&2){let t=g().$implicit,n=g(4);de(n.getCapabilityStyle(t.capability)),c(),D(" ",n.getCapabilityLabel(t.capability)," ")}}function iS(i,e){if(i&1){let t=M();r(0,"button",35),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.selectModel(o.id))}),r(1,"span"),l(2),s(),r(3,"span"),l(4),s(),S(5,nS,2,3,"span",36),k(6,"span",37),s()}if(i&2){let t=e.$implicit,n=g(4);de(n.selectedModelId()===t.id?"bg-emerald-500/30 text-emerald-400 border-2 border-emerald-500/50 shadow-lg shadow-emerald-500/20":"bg-slate-700/50 text-slate-300 border border-slate-600 hover:bg-slate-600/50 hover:border-emerald-500/30"),c(2),A(t.icon),c(2),A(t.name),c(),w(t.capability?5:-1)}}function oS(i,e){if(i&1&&(r(0,"div")(1,"p",31),k(2,"span",32),l(3," \u53EF\u7528\u6A21\u578B "),s(),r(4,"div",33),$(5,iS,7,5,"button",34,js),s()()),i&2){let t=g(3);c(5),H(t.connectedModels())}}function rS(i,e){if(i&1){let t=M();r(0,"button",41),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.selectModel(o.id))}),r(1,"span"),l(2),s(),r(3,"span"),l(4),s(),r(5,"span",42),l(6,"\u672A\u6E2C\u8A66"),s()()}if(i&2){let t=e.$implicit,n=g(4);de(n.selectedModelId()===t.id?"bg-slate-600/50 text-slate-300 border border-slate-500":"bg-slate-800/50 text-slate-500 border border-slate-700 hover:opacity-80"),c(2),A(t.icon),c(2),A(t.name)}}function sS(i,e){if(i&1&&(r(0,"div")(1,"p",31),k(2,"span",39),l(3," \u672A\u9023\u63A5\uFF08\u9700\u8981\u6E2C\u8A66\uFF09 "),s(),r(4,"div",33),$(5,rS,7,4,"button",40,js),s()()),i&2){let t=g(3);c(5),H(t.disconnectedModels())}}function aS(i,e){i&1&&(r(0,"p",30),l(1," \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI\uFF08\u514D\u8CBB\u7121\u9650\uFF09\uFF0C\u96F2\u7AEF AI \u6309\u4F7F\u7528\u91CF\u8A08\u8CBB "),s())}function lS(i,e){if(i&1&&(r(0,"div",29),S(1,oS,7,0,"div"),S(2,sS,7,0,"div"),s(),S(3,aS,2,0,"p",30)),i&2){let t=g(2);c(),w(t.connectedModels().length>0?1:-1),c(),w(t.disconnectedModels().length>0?2:-1),c(),w(t.connectedModels().length>0?3:-1)}}function cS(i,e){i&1&&(r(0,"span",45),l(1,"\u2713 \u5DF2\u9023\u63A5"),s())}function dS(i,e){i&1&&(r(0,"span",46),l(1,"\u672A\u9023\u63A5"),s())}function uS(i,e){i&1&&k(0,"span",60)}function mS(i,e){i&1&&(r(0,"span",42),l(1,"\u672A\u914D\u7F6E"),s())}function pS(i,e){if(i&1){let t=M();r(0,"div",55),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.selectModel(o.id))}),r(1,"div",56)(2,"span",57),l(3),s(),r(4,"div",58)(5,"div",59),l(6),s(),r(7,"div",42),l(8),s()(),S(9,uS,1,0,"span",60)(10,mS,2,0,"span",42),s()()}if(i&2){let t=e.$implicit,n=g(3);de(n.selectedModelId()===t.id?"bg-purple-500/20 border-purple-500/50":"bg-slate-800/50 border-slate-700 hover:border-slate-500"),c(3),A(t.icon),c(3),A(t.name),c(2),A(t.provider),c(),w(t.isConnected?9:t.isLocal?-1:10)}}function gS(i,e){if(i&1){let t=M();r(0,"div",22)(1,"div",43)(2,"h4",44),l(3," \u{1F999} \u672C\u5730 Ollama \u914D\u7F6E "),S(4,cS,2,0,"span",45)(5,dS,2,0,"span",46),s(),r(6,"div",47)(7,"div")(8,"label",48),l(9,"API \u7AEF\u9EDE"),s(),r(10,"input",49),x("change",function(o){v(t);let a=g(2);return b(a.updateLocalEndpoint(o.target.value))}),s()(),r(11,"div")(12,"label",48),l(13,"\u6A21\u578B\u540D\u7A31"),s(),r(14,"input",50),x("change",function(o){v(t);let a=g(2);return b(a.updateLocalModel(o.target.value))}),s()()(),r(15,"button",51),x("click",function(){v(t);let o=g(2);return b(o.testLocalAI())}),l(16," \u{1F517} \u6E2C\u8A66\u9023\u63A5 "),s()(),r(17,"div")(18,"h4",52),l(19,"\u53EF\u7528\u6A21\u578B"),s(),r(20,"div",53),$(21,pS,11,6,"div",54,js),s()(),r(23,"p",42),l(24," \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI (\u514D\u8CBB\u3001\u96B1\u79C1)\uFF0C\u672C\u5730\u4E0D\u53EF\u7528\u6642\u81EA\u52D5\u5207\u63DB\u5230\u96F2\u7AEF AI "),s()()}if(i&2){let t=g(2);c(4),w(t.localAIConfig().isConnected?4:5),c(6),V("value",t.localAIConfig().endpoint),c(4),V("value",t.localAIConfig().model),c(7),H(t.availableModels())}}function hS(i,e){i&1&&(r(0,"span",61),l(1,"\u27F3"),s(),l(2," AI \u5206\u6790\u4E2D... "))}function fS(i,e){i&1&&l(0," \u{1F680} \u751F\u6210 AI \u71DF\u92B7\u7B56\u7565 ")}function _S(i,e){if(i&1&&(r(0,"div",25)(1,"div",62)(2,"span",63),l(3),s(),r(4,"span",64),l(5),s()(),r(6,"div",65),k(7,"div",66),s()()),i&2){let t=g(2);c(3),A(t.generationStatus().message),c(2),A(t.generationStatus().currentProvider),c(2),X("width",t.generationStatus().progress,"%")}}function CS(i,e){if(i&1){let t=M();r(0,"div",7)(1,"div",9)(2,"label",10),l(3," \u{1F4AC} \u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u6A23\u7684\u5BA2\u6236\uFF1F "),s(),r(4,"textarea",11),W("ngModelChange",function(o){v(t);let a=g();return K(a.userInput,o)||(a.userInput=o),b(o)}),x("keydown.enter",function(o){v(t);let a=g();return b(o.ctrlKey&&a.generateStrategy())}),l(5,"                "),s(),r(6,"p",12),l(7,"\u{1F4A1} \u63D0\u793A\uFF1A\u63CF\u8FF0\u8D8A\u8A73\u7D30\uFF0CAI \u5206\u6790\u8D8A\u7CBE\u6E96"),s()(),r(8,"div",9)(9,"label",13),l(10,"\u26A1 \u5FEB\u901F\u9078\u64C7\u884C\u696D\u6A21\u677F"),s(),r(11,"div",14)(12,"button",15),x("click",function(){v(t);let o=g();return b(o.selectIndustry("payment"))}),l(13," \u{1F4B3} \u652F\u4ED8/\u63DB\u532F "),s(),r(14,"button",15),x("click",function(){v(t);let o=g();return b(o.selectIndustry("crypto"))}),l(15," \u{1FA99} \u52A0\u5BC6\u8CA8\u5E63 "),s(),r(16,"button",15),x("click",function(){v(t);let o=g();return b(o.selectIndustry("ecommerce"))}),l(17," \u{1F6D2} \u96FB\u5546/\u8DE8\u5883 "),s(),r(18,"button",15),x("click",function(){v(t);let o=g();return b(o.selectIndustry("custom"))}),l(19," \u270F\uFE0F \u81EA\u5B9A\u7FA9 "),s()()(),r(20,"div",9)(21,"div",16)(22,"label",17),l(23," \u{1F916} AI \u6A21\u578B "),S(24,j2,2,1,"span",18)(25,eS,2,0,"span",19),s(),r(26,"a",20),x("click",function(){v(t);let o=g();return b(o.goToAICenter())}),l(27," \u2699\uFE0F \u524D\u5F80 AI \u4E2D\u5FC3 "),s()(),S(28,tS,7,0,"div",21)(29,lS,4,3),S(30,gS,25,3,"div",22),s(),r(31,"div",23)(32,"button",24),x("click",function(){v(t);let o=g();return b(o.generateStrategy())}),S(33,hS,3,0)(34,fS,1,0),s(),S(35,_S,8,4,"div",25),s()()}if(i&2){let t=g();c(4),z("ngModel",t.userInput),c(8),de(t.selectedIndustry()==="payment"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(2),de(t.selectedIndustry()==="crypto"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(2),de(t.selectedIndustry()==="ecommerce"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(2),de(t.selectedIndustry()==="custom"?"bg-purple-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),c(6),w(t.connectedModelsCount()>0?24:25),c(4),w(t.availableModels().length===0?28:29),c(2),w(t.showModelSettings()?30:-1),c(2),V("disabled",t.isGenerating()||!t.userInput&&t.selectedIndustry()==="custom"),c(),w(t.isGenerating()?33:34),c(2),w(t.isGenerating()?35:-1)}}function vS(i,e){if(i&1&&(r(0,"span",77),l(1),s()),i&2){let t=e.$implicit;c(),D(" ",t," ")}}function bS(i,e){if(i&1&&(r(0,"span",81),l(1),s()),i&2){let t=e.$implicit;c(),D(" ",t," ")}}function xS(i,e){if(i&1&&(r(0,"span",84),l(1),s()),i&2){let t=e.$implicit;c(),D(" ",t," ")}}function yS(i,e){if(i&1&&(r(0,"li",88)(1,"span",101),l(2,"\u2022"),s(),l(3),s()),i&2){let t=e.$implicit;c(3),D(" ",t," ")}}function SS(i,e){if(i&1&&(r(0,"li",88)(1,"span",102),l(2,"\u2022"),s(),l(3),s()),i&2){let t=e.$implicit;c(3),D(" ",t," ")}}function wS(i,e){if(i&1&&(r(0,"li",88)(1,"span",103),l(2,"\u2022"),s(),l(3),s()),i&2){let t=e.$implicit;c(3),D(" ",t," ")}}function ES(i,e){if(i&1){let t=M();r(0,"div",67)(1,"div",68)(2,"span",69),l(3,"\u2728"),s(),r(4,"div")(5,"p",70),l(6,"AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01"),s(),r(7,"p",5),l(8,"\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0CAI \u5DF2\u751F\u6210\u4EE5\u4E0B\u71DF\u92B7\u7B56\u7565"),s()()(),r(9,"div",9)(10,"h3",71)(11,"span"),l(12,"\u{1F4CA}"),s(),l(13," \u884C\u696D\u5206\u6790 "),s(),r(14,"div",72)(15,"div")(16,"label",63),l(17,"\u76EE\u6A19\u884C\u696D"),s(),r(18,"p",73),l(19),s()(),r(20,"div")(21,"label",63),l(22,"\u76EE\u6A19\u53D7\u773E"),s(),r(23,"p",73),l(24),s()()()(),r(25,"div",9)(26,"h3",71)(27,"span"),l(28,"\u{1F511}"),s(),l(29," AI \u63A8\u85A6\u95DC\u9375\u8A5E "),r(30,"span",74),l(31,"\u9EDE\u64CA\u53EF\u7DE8\u8F2F"),s()(),r(32,"div",75)(33,"div")(34,"label",76),k(35,"span",37),l(36," \u9AD8\u610F\u5411\u95DC\u9375\u8A5E "),s(),r(37,"div",33),$(38,vS,2,1,"span",77,vt),r(40,"button",78),x("click",function(){v(t);let o=g(2);return b(o.addKeyword("high"))}),l(41," + \u6DFB\u52A0 "),s()()(),r(42,"div")(43,"label",79),k(44,"span",80),l(45," \u4E2D\u610F\u5411\u95DC\u9375\u8A5E "),s(),r(46,"div",33),$(47,bS,2,1,"span",81,vt),r(49,"button",78),x("click",function(){v(t);let o=g(2);return b(o.addKeyword("medium"))}),l(50," + \u6DFB\u52A0 "),s()()(),r(51,"div")(52,"label",82),k(53,"span",83),l(54," \u64F4\u5C55\u95DC\u9375\u8A5E "),s(),r(55,"div",33),$(56,xS,2,1,"span",84,vt),r(58,"button",78),x("click",function(){v(t);let o=g(2);return b(o.addKeyword("extended"))}),l(59," + \u6DFB\u52A0 "),s()()()()(),r(60,"div",9)(61,"h3",71)(62,"span"),l(63,"\u{1F465}"),s(),l(64," \u76EE\u6A19\u5BA2\u6236\u756B\u50CF "),s(),r(65,"div",85)(66,"div")(67,"label",86),l(68,"\u8EAB\u4EFD\u7279\u5FB5"),s(),r(69,"ul",87),$(70,yS,4,1,"li",88,Pe),s()(),r(72,"div")(73,"label",86),l(74,"\u884C\u70BA\u7279\u5FB5"),s(),r(75,"ul",87),$(76,SS,4,1,"li",88,Pe),s()(),r(78,"div")(79,"label",86),l(80,"\u6838\u5FC3\u9700\u6C42"),s(),r(81,"ul",87),$(82,wS,4,1,"li",88,Pe),s()()()(),r(84,"div",9)(85,"h3",71)(86,"span"),l(87,"\u{1F4AC}"),s(),l(88," AI \u751F\u6210\u8A71\u8853\u6A21\u677F "),s(),r(89,"div",75)(90,"div")(91,"label",89),l(92,"\u9996\u6B21\u89F8\u9054"),s(),r(93,"textarea",90),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.editableTemplates.firstTouch,o)||(a.editableTemplates.firstTouch=o),b(o)}),l(94,"                      "),s()(),r(95,"div")(96,"label",91),l(97,"\u8DDF\u9032\u8A71\u8853"),s(),r(98,"textarea",90),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.editableTemplates.followUp,o)||(a.editableTemplates.followUp=o),b(o)}),l(99,"                      "),s()(),r(100,"div")(101,"label",92),l(102,"\u4FC3\u6210\u8A71\u8853"),s(),r(103,"textarea",90),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.editableTemplates.closing,o)||(a.editableTemplates.closing=o),b(o)}),l(104,"                      "),s()()()(),r(105,"div",93)(106,"button",94),x("click",function(){v(t);let o=g(2);return b(o.backToInput())}),l(107," \u2190 \u8FD4\u56DE\u4FEE\u6539 "),s(),r(108,"div",95)(109,"button",96),x("click",function(){v(t);let o=g(2);return b(o.saveStrategy())}),l(110," \u{1F4BE} \u4FDD\u5B58\u7B56\u7565 "),s(),r(111,"button",97),x("click",function(){v(t);let o=g(2);return b(o.handoverToAITeam())}),l(112," \u{1F916} \u4EA4\u7D66 AI \u5718\u968A "),s(),r(113,"button",98),x("click",function(){v(t);let o=g(2);return b(o.startAutomation())}),l(114," \u{1F680} \u624B\u52D5\u57F7\u884C "),s()()(),r(115,"div",99)(116,"div",100)(117,"span",69),l(118,"\u{1F4A1}"),s(),r(119,"div")(120,"p",73),l(121,"\u63A8\u85A6\u4F7F\u7528\u300C\u4EA4\u7D66 AI \u5718\u968A\u300D"),s(),r(122,"p",5),l(123,"AI \u6703\u81EA\u52D5\u7D44\u5EFA\u5718\u968A\u3001\u5206\u914D\u89D2\u8272\u3001\u5236\u5B9A\u8A71\u8853\uFF0C24/7 \u667A\u80FD\u92B7\u552E"),s()()()()()}if(i&2){let t=g(2);c(19),A(t.strategyResult().industry),c(5),A(t.strategyResult().targetAudience),c(14),H(t.strategyResult().keywords.highIntent),c(9),H(t.strategyResult().keywords.mediumIntent),c(9),H(t.strategyResult().keywords.extended),c(14),H(t.strategyResult().customerProfile.identity),c(6),H(t.strategyResult().customerProfile.features),c(6),H(t.strategyResult().customerProfile.needs),c(11),z("ngModel",t.editableTemplates.firstTouch),c(5),z("ngModel",t.editableTemplates.followUp),c(5),z("ngModel",t.editableTemplates.closing)}}function AS(i,e){if(i&1&&S(0,ES,124,5,"div",67),i&2){let t=g();w(t.strategyResult()?0:-1)}}function DS(i,e){if(i&1){let t=M();r(0,"div",104),x("click",function(){v(t);let o=g();return b(o.cancelAddKeyword())}),r(1,"div",105),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"h3",106)(3,"span",107),l(4,"\u{1F3F7}\uFE0F"),s(),l(5),s(),r(6,"input",108),W("ngModelChange",function(o){v(t);let a=g();return K(a.newKeywordInput,o)||(a.newKeywordInput=o),b(o)}),x("keydown.enter",function(){v(t);let o=g();return b(o.confirmAddKeyword())})("keydown.escape",function(){v(t);let o=g();return b(o.cancelAddKeyword())}),s(),r(7,"div",109)(8,"button",110),x("click",function(){v(t);let o=g();return b(o.cancelAddKeyword())}),l(9," \u53D6\u6D88 "),s(),r(10,"button",111),x("click",function(){v(t);let o=g();return b(o.confirmAddKeyword())}),l(11," \u78BA\u5B9A\u6DFB\u52A0 "),s()()()()}if(i&2){let t=g();c(5),D(" \u6DFB\u52A0",t.getKeywordLevelLabel(t.keywordDialogLevel()),"\u95DC\u9375\u8A5E "),c(),z("ngModel",t.newKeywordInput),c(4),V("disabled",!t.newKeywordInput.trim())}}var Jo={payment:{industry:"\u652F\u4ED8/\u63DB\u532F",keywords:{highIntent:["\u652F\u4ED8\u901A\u9053","U\u5546","\u63DB\u532F","USDT","\u4EE3\u6536\u4EE3\u4ED8","\u8DD1\u5206"],mediumIntent:["\u56DB\u65B9\u652F\u4ED8","\u4E09\u65B9\u652F\u4ED8","API\u5C0D\u63A5","\u627F\u514C\u5546"],extended:["OTC","\u6536\u6B3E","\u51FA\u6B3E","\u8CBB\u7387","T+0","T+1"]},recommendedGroups:["\u652F\u4ED8\u884C\u696D\u4EA4\u6D41\u7FA4","USDT/\u63DB\u532F\u4EA4\u6613\u7FA4","\u9805\u76EE\u5C0D\u63A5\u7FA4"]},crypto:{industry:"\u52A0\u5BC6\u8CA8\u5E63",keywords:{highIntent:["BTC","ETH","\u5408\u7D04","\u73FE\u8CA8","\u4EA4\u6613\u6240"],mediumIntent:["DeFi","NFT","\u9322\u5305","\u516C\u93C8"],extended:["\u6316\u7926","\u8CEA\u62BC","\u7A7A\u6295","IDO"]},recommendedGroups:["\u5E63\u5708\u4EA4\u6D41\u7FA4","\u5408\u7D04\u4EA4\u6613\u7FA4","\u9805\u76EE\u9996\u767C\u7FA4"]},ecommerce:{industry:"\u96FB\u5546/\u8DE8\u5883",keywords:{highIntent:["\u4E9E\u99AC\u905C","\u7368\u7ACB\u7AD9","Shopify","\u7269\u6D41","\u9078\u54C1"],mediumIntent:["FBA","\u6D77\u5916\u5009","\u6E05\u95DC","\u652F\u4ED8"],extended:["\u6E2C\u8A55","\u5237\u55AE","\u7AD9\u5916\u63A8\u5EE3"]},recommendedGroups:["\u8DE8\u5883\u96FB\u5546\u4EA4\u6D41\u7FA4","\u4E9E\u99AC\u905C\u8CE3\u5BB6\u7FA4","\u7269\u6D41\u5C0D\u63A5\u7FA4"]}},Qo=class i{constructor(){this.ipcService=O(ye);this.toastService=O(ue);this.aiStrategyService=O(Wo);this.startAutomationEvent=Me();this.handoverToAITeamEvent=Me();this.navigateEvent=Me();this.currentStep=_("input");this.userInput="";this.selectedIndustry=_("custom");this.isGenerating=_(!1);this.strategyResult=_(null);this.showModelSettings=_(!1);this.availableModels=this.aiStrategyService.availableModels;this.selectedModelId=this.aiStrategyService.selectedModelId;this.showKeywordDialog=_(!1);this.keywordDialogLevel=_("high");this.newKeywordInput="";this.localAIConfig=this.aiStrategyService.localAIConfig;this.generationStatus=this.aiStrategyService.generationStatus;this.connectedModels=G(()=>this.availableModels().filter(e=>e.isConnected));this.disconnectedModels=G(()=>this.availableModels().filter(e=>!e.isConnected));this.connectedModelsCount=G(()=>this.connectedModels().length);this.editableTemplates={firstTouch:"",followUp:"",closing:""}}ngOnInit(){this.setupEventListeners(),this.aiStrategyService.refreshAvailableModels()}setupEventListeners(){this.ipcService.on("ai-strategy-generated",e=>{this.isGenerating.set(!1),e.success?(this.strategyResult.set(e.strategy),this.editableTemplates=F({},e.strategy.messageTemplates),this.currentStep.set("result"),this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01")):this.toastService.error(`\u751F\u6210\u5931\u6557: ${e.error}`)})}goToAICenter(){this.navigateEvent.emit("ai-center"),this.toastService.info("\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E\u6A21\u578B...")}selectModel(e){this.aiStrategyService.selectModel(e)}getCapabilityStyle(e){switch(e){case"fast":return"bg-cyan-500/20 text-cyan-400";case"powerful":return"bg-purple-500/20 text-purple-400";case"economic":return"bg-green-500/20 text-green-400";case"balanced":return"bg-amber-500/20 text-amber-400";default:return"bg-slate-500/20 text-slate-400"}}getCapabilityLabel(e){switch(e){case"fast":return"\u5FEB\u901F";case"powerful":return"\u5F37\u5927";case"economic":return"\u7D93\u6FDF";case"balanced":return"\u5747\u8861";default:return""}}async testLocalAI(){await this.aiStrategyService.testLocalAIConnection()}updateLocalEndpoint(e){this.aiStrategyService.updateLocalAIConfig({endpoint:e})}updateLocalModel(e){this.aiStrategyService.updateLocalAIConfig({model:e})}selectIndustry(e){if(this.selectedIndustry.set(e),e!=="custom"){let t=Jo[e];t&&(this.userInput=`\u6211\u60F3\u627E${t.industry}\u884C\u696D\u7684\u5BA2\u6236`)}}async generateStrategy(){if(!this.userInput&&this.selectedIndustry()==="custom"){this.toastService.warning("\u8ACB\u8F38\u5165\u60A8\u7684\u9700\u6C42\u6216\u9078\u64C7\u4E00\u500B\u884C\u696D\u6A21\u677F");return}this.isGenerating.set(!0);let e=this.userInput||`\u6211\u60F3\u627E${Jo[this.selectedIndustry()]?.industry||"\u76EE\u6A19\u884C\u696D"}\u7684\u5BA2\u6236`;try{let t=await this.aiStrategyService.generateStrategy(e);if(t){this.strategyResult.set(t),this.editableTemplates=F({},t.messageTemplates),this.currentStep.set("result");let n=this.generationStatus();n.currentProvider==="\u6A21\u677F\u56DE\u9000"?this.toastService.warning("\u96F2\u7AEF AI \u9023\u63A5\u5931\u6557\uFF0C\u5DF2\u4F7F\u7528\u667A\u80FD\u6A21\u677F\u751F\u6210\u3002\u8ACB\u6AA2\u67E5 AI \u4E2D\u5FC3\u914D\u7F6E\u3002"):n.currentProvider.includes("\u672C\u5730")?this.toastService.success(`\u2705 \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01\u4F7F\u7528\uFF1A${n.currentProvider}`):this.toastService.success(`\u2705 AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01(${n.currentProvider})`)}else this.toastService.error("\u7B56\u7565\u751F\u6210\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}catch(t){console.error("[AIMarketing] \u7B56\u7565\u751F\u6210\u5931\u6557:",t),this.toastService.error(`\u751F\u6210\u5931\u6557: ${t.message}`)}finally{this.isGenerating.set(!1)}}generateFromTemplate(){let e=this.selectedIndustry(),t=Jo[e]||Jo.payment,n={industry:t.industry||"\u81EA\u5B9A\u7FA9\u884C\u696D",targetAudience:this.extractAudience(this.userInput),keywords:t.keywords||{highIntent:[],mediumIntent:[],extended:[]},customerProfile:{identity:["\u4EE3\u7406\u5546","\u9805\u76EE\u65B9","\u904B\u71DF\u4EBA\u54E1"],features:["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44","\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F","\u6709\u660E\u78BA\u9700\u6C42"],needs:["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34","\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE","\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]},recommendedGroups:t.recommendedGroups||["\u884C\u696D\u4EA4\u6D41\u7FA4","\u696D\u52D9\u5C0D\u63A5\u7FA4"],messageTemplates:{firstTouch:`\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${t.industry||"\u9019\u500B"}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,followUp:"\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",closing:"\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"},automationSettings:{monitorMode:"24/7 \u5168\u5929\u5019",responseDelay:30,followUpInterval:7200}};this.strategyResult.set(n),this.editableTemplates=F({},n.messageTemplates),this.currentStep.set("result"),this.isGenerating.set(!1),this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01")}extractAudience(e){return e.includes("\u4EE3\u7406")?"\u4EE3\u7406\u5546/\u6E20\u9053\u5546":e.includes("\u5BA2\u6236")?"\u7D42\u7AEF\u5BA2\u6236":e.includes("\u9805\u76EE")?"\u9805\u76EE\u65B9/\u904B\u71DF\u5546":"\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4"}addKeyword(e){this.keywordDialogLevel.set(e),this.newKeywordInput="",this.showKeywordDialog.set(!0)}confirmAddKeyword(){let e=this.newKeywordInput.trim();if(e&&this.strategyResult()){let t=F({},this.strategyResult());switch(this.keywordDialogLevel()){case"high":t.keywords.highIntent=[...t.keywords.highIntent,e];break;case"medium":t.keywords.mediumIntent=[...t.keywords.mediumIntent,e];break;case"extended":t.keywords.extended=[...t.keywords.extended,e];break}this.strategyResult.set(t),this.toastService.success(`\u5DF2\u6DFB\u52A0\u95DC\u9375\u8A5E: ${e}`)}this.showKeywordDialog.set(!1),this.newKeywordInput=""}cancelAddKeyword(){this.showKeywordDialog.set(!1),this.newKeywordInput=""}getKeywordLevelLabel(e){switch(e){case"high":return"\u9AD8\u610F\u5411";case"medium":return"\u4E2D\u610F\u5411";case"extended":return"\u64F4\u5C55"}}backToInput(){this.currentStep.set("input")}saveStrategy(){let e=this.strategyResult();e&&(e.messageTemplates=F({},this.editableTemplates),this.ipcService.send("save-ai-strategy",{strategy:e}),this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01"))}startAutomation(){let e=this.strategyResult();e&&(e.messageTemplates=F({},this.editableTemplates),this.startAutomationEvent.emit(e),this.toastService.success("\u6B63\u5728\u555F\u52D5\u624B\u52D5\u71DF\u92B7..."))}handoverToAITeam(){let e=this.strategyResult();e&&(e.messageTemplates=F({},this.editableTemplates),this.handoverToAITeamEvent.emit(e),this.toastService.success("\u{1F916} \u6B63\u5728\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A..."))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-ai-marketing-assistant"]],outputs:{startAutomationEvent:"startAutomationEvent",handoverToAITeamEvent:"handoverToAITeamEvent",navigateEvent:"navigateEvent"},decls:14,vars:2,consts:[[1,"ai-assistant","h-full","flex","flex-col","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900"],[1,"p-6","border-b","border-slate-700/50"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-2xl","bg-gradient-to-br","from-purple-500","to-cyan-500","flex","items-center","justify-center","text-2xl","shadow-lg","shadow-purple-500/20"],[1,"text-2xl","font-bold","text-white"],[1,"text-slate-400","text-sm"],[1,"flex-1","overflow-y-auto","p-6"],[1,"max-w-3xl","mx-auto","space-y-6"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center"],[1,"bg-slate-800/50","rounded-2xl","p-6","border","border-slate-700/50"],[1,"block","text-lg","font-medium","text-white","mb-4"],["rows","4","placeholder","\u4F8B\u5982\uFF1A\u6211\u60F3\u627E\u652F\u4ED8\u884C\u696D\u7684\u4EE3\u7406\u5546\uFF0C\u4ED6\u5011\u9700\u8981\u6709\u63DB\u532F\u548C\u8DD1\u5206\u9700\u6C42...",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-xl","p-4","text-white","text-lg","placeholder-slate-500","focus:border-purple-500","focus:ring-2","focus:ring-purple-500/20","resize-none",3,"ngModelChange","keydown.enter","ngModel"],[1,"text-xs","text-slate-500","mt-2"],[1,"block","text-sm","font-medium","text-slate-400","mb-3"],[1,"flex","flex-wrap","gap-3"],[1,"px-4","py-2","rounded-xl","text-sm","font-medium","transition-all",3,"click"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-sm","font-medium","text-slate-400","flex","items-center","gap-2"],[1,"px-2","py-0.5","bg-emerald-500/20","text-emerald-400","rounded-full","text-xs"],[1,"px-2","py-0.5","bg-amber-500/20","text-amber-400","rounded-full","text-xs"],[1,"text-sm","text-purple-400","hover:text-purple-300","cursor-pointer","flex","items-center","gap-1",3,"click"],[1,"p-4","bg-amber-500/10","border","border-amber-500/30","rounded-xl","text-center"],[1,"mt-4","pt-4","border-t","border-slate-700/50","space-y-4"],[1,"flex","flex-col","items-center","gap-4"],[1,"px-8","py-4","bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","text-lg","font-bold","rounded-2xl","shadow-lg","shadow-purple-500/30","transition-all","flex","items-center","gap-3",3,"click","disabled"],[1,"w-full","max-w-md","bg-slate-800/80","rounded-xl","p-4","border","border-slate-700/50"],[1,"text-amber-400","mb-2"],[1,"text-sm","text-slate-400","mb-3"],[1,"px-4","py-2","bg-purple-500/20","text-purple-400","rounded-lg","hover:bg-purple-500/30","transition-colors",3,"click"],[1,"space-y-3"],[1,"text-xs","text-slate-500","mt-3","flex","items-center","gap-1"],[1,"text-xs","text-slate-500","mb-2","flex","items-center","gap-1"],[1,"w-1.5","h-1.5","bg-emerald-500","rounded-full"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5",3,"class"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5",3,"click"],[1,"text-[10px]","px-1.5","py-0.5","rounded-full",3,"class"],[1,"w-2","h-2","bg-emerald-500","rounded-full"],[1,"text-[10px]","px-1.5","py-0.5","rounded-full"],[1,"w-1.5","h-1.5","bg-slate-500","rounded-full"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5","opacity-60",3,"class"],[1,"px-3","py-1.5","rounded-lg","text-sm","font-medium","transition-all","flex","items-center","gap-1.5","opacity-60",3,"click"],[1,"text-xs","text-slate-500"],[1,"bg-slate-900/50","rounded-xl","p-4"],[1,"text-sm","font-medium","text-white","mb-3","flex","items-center","gap-2"],[1,"text-emerald-400","text-xs"],[1,"text-amber-400","text-xs"],[1,"grid","grid-cols-2","gap-3"],[1,"text-xs","text-slate-500","block","mb-1"],["type","text","placeholder","https://your-ollama.ts.net/api/chat",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm",3,"change","value"],["type","text","placeholder","qwen2.5",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","px-3","py-2","text-white","text-sm",3,"change","value"],[1,"mt-3","px-4","py-2","bg-cyan-500/20","text-cyan-400","rounded-lg","text-sm","hover:bg-cyan-500/30","transition-colors",3,"click"],[1,"text-sm","font-medium","text-white","mb-2"],[1,"grid","grid-cols-2","gap-2","max-h-48","overflow-y-auto"],[1,"p-3","rounded-lg","cursor-pointer","transition-all","border",3,"class"],[1,"p-3","rounded-lg","cursor-pointer","transition-all","border",3,"click"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-white","truncate"],[1,"w-2","h-2","bg-emerald-500","rounded-full","flex-shrink-0"],[1,"animate-spin"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-slate-400"],[1,"text-sm","text-purple-400"],[1,"h-2","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-purple-500","to-cyan-500","transition-all","duration-500"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","rounded-2xl","p-4","border","border-emerald-500/30","flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-emerald-400","font-medium"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","gap-4"],[1,"text-white","font-medium"],[1,"text-xs","text-slate-500","font-normal","ml-2"],[1,"space-y-4"],[1,"text-sm","text-emerald-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-emerald-500/20","text-emerald-400","rounded-lg","text-sm","border","border-emerald-500/30","cursor-pointer","hover:bg-emerald-500/30","transition-all"],[1,"px-3","py-1.5","bg-slate-700","text-slate-400","rounded-lg","text-sm","hover:bg-slate-600",3,"click"],[1,"text-sm","text-amber-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"w-2","h-2","bg-amber-500","rounded-full"],[1,"px-3","py-1.5","bg-amber-500/20","text-amber-400","rounded-lg","text-sm","border","border-amber-500/30","cursor-pointer","hover:bg-amber-500/30","transition-all"],[1,"text-sm","text-slate-400","font-medium","mb-2","flex","items-center","gap-2"],[1,"w-2","h-2","bg-slate-500","rounded-full"],[1,"px-3","py-1.5","bg-slate-700","text-slate-300","rounded-lg","text-sm","border","border-slate-600","cursor-pointer","hover:bg-slate-600","transition-all"],[1,"grid","grid-cols-3","gap-4"],[1,"text-sm","text-slate-400","mb-2","block"],[1,"space-y-1"],[1,"text-white","text-sm","flex","items-center","gap-2"],[1,"text-sm","text-emerald-400","font-medium","mb-2","block"],["rows","2",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-lg","p-3","text-white","text-sm","resize-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-amber-400","font-medium","mb-2","block"],[1,"text-sm","text-purple-400","font-medium","mb-2","block"],[1,"flex","justify-between","items-center","pt-4"],[1,"px-6","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-all",3,"click"],[1,"flex","gap-3"],[1,"px-6","py-3","bg-slate-700","hover:bg-slate-600","text-white","rounded-xl","transition-all","flex","items-center","gap-2",3,"click"],[1,"px-6","py-3","bg-gradient-to-r","from-emerald-500","to-cyan-500","hover:from-emerald-600","hover:to-cyan-600","text-white","font-bold","rounded-xl","shadow-lg","shadow-emerald-500/30","transition-all","flex","items-center","gap-2",3,"click"],[1,"px-8","py-3","bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","text-white","font-bold","rounded-xl","shadow-lg","shadow-purple-500/30","transition-all","flex","items-center","gap-2",3,"click"],[1,"mt-4","p-4","bg-gradient-to-r","from-emerald-500/10","to-cyan-500/10","border","border-emerald-500/30","rounded-xl"],[1,"flex","items-center","gap-3"],[1,"text-purple-400"],[1,"text-cyan-400"],[1,"text-emerald-400"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-50","flex","items-center","justify-center",3,"click"],[1,"bg-slate-800","rounded-2xl","p-6","w-full","max-w-md","mx-4","border","border-slate-700","shadow-2xl",3,"click"],[1,"text-lg","font-bold","text-white","mb-4","flex","items-center","gap-2"],[1,"text-xl"],["type","text","placeholder","\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E...","autofocus","",1,"w-full","px-4","py-3","bg-slate-900","border","border-slate-600","rounded-xl","text-white","placeholder-slate-500","focus:border-purple-500","focus:ring-2","focus:ring-purple-500/20","outline-none","transition-all",3,"ngModelChange","keydown.enter","keydown.escape","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2.5","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-xl","transition-all","font-medium",3,"click"],[1,"flex-1","px-4","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","hover:from-purple-600","hover:to-pink-600","text-white","rounded-xl","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l(4," \u{1F916} "),s(),r(5,"div")(6,"h1",4),l(7,"AI \u71DF\u92B7\u52A9\u624B"),s(),r(8,"p",5),l(9,"\u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u5BA2\u6236\uFF0CAI \u5E6B\u4F60\u5B8C\u6210\u4E00\u5207"),s()()()(),r(10,"div",6),S(11,CS,36,15,"div",7)(12,AS,1,1),s(),S(13,DS,12,3,"div",8),s()),t&2){let o;c(11),w((o=n.currentStep())==="input"?11:o==="result"?12:-1),c(2),w(n.showKeywordDialog()?13:-1)}},dependencies:[te,me,xe,_e,Ce],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})}};var jt=(i,e)=>e.id;function MS(i,e){i&1&&(r(0,"span",6),k(1,"span",22),l(2," \u57F7\u884C\u4E2D "),s())}function TS(i,e){if(i&1&&(r(0,"span",16),l(1),s()),i&2){let t=g();c(),A(t.runningCount())}}function kS(i,e){if(i&1){let t=M();r(0,"div",23)(1,"div",2)(2,"div",39)(3,"span",5),l(4,"\u{1F517}"),s(),r(5,"div")(6,"p",40),l(7,"\u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565"),s(),r(8,"p",41),l(9,"\u7B56\u7565\u5DF2\u81EA\u52D5\u586B\u5165\uFF0C\u78BA\u8A8D\u5F8C\u5373\u53EF\u958B\u59CB\u57F7\u884C"),s()()(),r(10,"button",42),x("click",function(){v(t);let o=g(2);return b(o.clearIncomingStrategy())}),l(11," \u2715 \u6E05\u9664 "),s()()()}}function IS(i,e){i&1&&(r(0,"span",43),l(1,"\u23F3"),s(),l(2," \u7B56\u5283\u4E2D... "))}function PS(i,e){i&1&&(r(0,"span"),l(1,"\u{1F680}"),s(),l(2," AI \u958B\u59CB\u5DE5\u4F5C "))}function FS(i,e){if(i&1){let t=M();r(0,"button",44),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.quickStart(o.goal))}),r(1,"div",36),l(2),s(),r(3,"div",45),l(4),s(),r(5,"div",38),l(6),s()()}if(i&2){let t=e.$implicit;c(2),A(t.icon),c(2),A(t.name),c(2),A(t.description)}}function NS(i,e){if(i&1){let t=M();r(0,"div",18),S(1,kS,12,0,"div",23),r(2,"div",24)(3,"div",25)(4,"h2",26),l(5,"\u{1F3AF} \u4E00\u53E5\u8A71\uFF0C\u555F\u52D5\u4F60\u7684 AI \u92B7\u552E\u5718\u968A"),s(),r(6,"p",27),l(7,"\u544A\u8A34 AI \u4F60\u60F3\u8981\u4EC0\u9EBC\uFF0C\u5269\u4E0B\u7684\u4EA4\u7D66\u6211\u5011"),s()(),r(8,"div",28)(9,"textarea",29),W("ngModelChange",function(o){v(t);let a=g();return K(a.userGoal,o)||(a.userGoal=o),b(o)}),x("keydown.enter",function(o){v(t);let a=g();return b(a.onEnterKey(o))}),l(10,"                  "),s(),r(11,"button",30),x("click",function(){v(t);let o=g();return b(o.startFromGoal())}),S(12,IS,3,0)(13,PS,3,0),s()()(),r(14,"div")(15,"h3",31)(16,"span"),l(17,"\u{1F4A1}"),s(),l(18," \u6216\u9078\u64C7\u5E38\u898B\u76EE\u6A19\uFF0C\u4E00\u9375\u958B\u59CB "),s(),r(19,"div",32),$(20,FS,7,3,"button",33,jt),s()(),r(22,"div",34)(23,"div",35)(24,"div",36),l(25,"\u{1F3AD}"),s(),r(26,"div",37),l(27,"\u50CF\u771F\u4EBA\u4E00\u6A23"),s(),r(28,"div",38),l(29,"\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E\u3001\u81EA\u7136\u5F15\u5C0E"),s()(),r(30,"div",35)(31,"div",36),l(32,"\u{1F504}"),s(),r(33,"div",37),l(34,"\u5BE6\u6642\u8ABF\u6574"),s(),r(35,"div",38),l(36,"\u6BCF10\u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21"),s()(),r(37,"div",35)(38,"div",36),l(39,"\u{1F91D}"),s(),r(40,"div",37),l(41,"\u591A\u89D2\u8272\u914D\u5408"),s(),r(42,"div",38),l(43,"AI \u81EA\u52D5\u5354\u8ABF\u6700\u4F73\u7D44\u5408"),s()()()()}if(i&2){let t=g();c(),w(t.hasIncomingStrategy()?1:-1),c(8),z("ngModel",t.userGoal),c(2),V("disabled",!t.userGoal.trim()||t.engine.isProcessing()),c(),w(t.engine.isProcessing()?12:13),c(8),H(t.presetGoals)}}function RS(i,e){if(i&1){let t=M();r(0,"div",46)(1,"div",47),l(2,"\u{1F680}"),s(),r(3,"p",48),l(4,"\u66AB\u7121\u57F7\u884C\u4E2D\u7684\u4EFB\u52D9"),s(),r(5,"p",49),l(6,"\u524D\u5F80\u300C\u4E00\u9375\u555F\u52D5\u300D\u5275\u5EFA\u65B0\u4EFB\u52D9"),s(),r(7,"button",50),x("click",function(){v(t);let o=g(2);return b(o.activeTab.set("start"))}),l(8," \u{1F680} \u5275\u5EFA\u4EFB\u52D9 "),s()()}}function OS(i,e){if(i&1){let t=M();r(0,"button",70),x("click",function(){v(t);let o=g(2).$implicit,a=g(3);return b(a.confirmStart(o))}),l(1," \u25B6\uFE0F \u78BA\u8A8D\u958B\u59CB "),s()}}function BS(i,e){if(i&1){let t=M();r(0,"button",71),x("click",function(){v(t);let o=g(2).$implicit,a=g(3);return b(a.pauseExecution(o))}),l(1," \u23F8\uFE0F \u66AB\u505C "),s()}}function VS(i,e){if(i&1){let t=M();r(0,"button",72),x("click",function(){v(t);let o=g(2).$implicit,a=g(3);return b(a.resumeExecution(o))}),l(1," \u25B6\uFE0F \u7E7C\u7E8C "),s()}}function LS(i,e){if(i&1&&(r(0,"div",62)(1,"div",73)(2,"span"),l(3,"\u{1F916}"),s(),l(4," AI \u7406\u89E3 "),s(),r(5,"p",74),l(6),s(),r(7,"div",75)(8,"span"),l(9),s(),r(10,"span"),l(11),s(),r(12,"span"),l(13),s()()()),i&2){let t=g(2).$implicit;c(6),A(t.intent.goal),c(3),D("\u7F6E\u4FE1\u5EA6: ",t.intent.confidence,"%"),c(2),D("\u76EE\u6A19\u7FA4\u9AD4: ",t.intent.targetAudience),c(2),D("\u5EFA\u8B70\u9031\u671F: ",t.intent.suggestedDuration)}}function GS(i,e){if(i&1&&(r(0,"div",78)(1,"span",79),l(2),s(),r(3,"div")(4,"div",80),l(5),s(),r(6,"div",66),l(7),s()()()),i&2){let t=e.$implicit;c(2),A(t.icon),c(3),A(t.name),c(2),A(t.purpose)}}function US(i,e){if(i&1&&(r(0,"div",63)(1,"div",76),l(2,"\u{1F3AD} AI \u5718\u968A"),s(),r(3,"div",77),$(4,GS,8,3,"div",78,jt),s()()),i&2){let t=g(2).$implicit;c(4),H(t.roles)}}function qS(i,e){i&1&&(ne(),r(0,"svg",83),k(1,"path",84),s())}function $S(i,e){if(i&1&&(r(0,"div",81)(1,"div",82),l(2),s(),S(3,qS,2,0,":svg:svg",83),s()),i&2){let t=e.$implicit,n=e.$index,o=g(3).$implicit;c(),I("bg-green-500",n<o.stats.currentPhase)("text-white",n<o.stats.currentPhase)("bg-purple-500",n===o.stats.currentPhase)("text-white",n===o.stats.currentPhase)("bg-slate-700",n>o.stats.currentPhase)("text-slate-400",n>o.stats.currentPhase),c(),D(" ",t.name," "),c(),w(n<o.strategy.phases.length-1?3:-1)}}function HS(i,e){if(i&1&&(r(0,"div",63)(1,"div",76),l(2,"\u{1F4CB} \u57F7\u884C\u968E\u6BB5"),s(),r(3,"div",56),$(4,$S,4,14,"div",81,jt),s()()),i&2){let t=g(2).$implicit;c(4),H(t.strategy.phases)}}function zS(i,e){if(i&1&&(r(0,"div",68)(1,"div",85)(2,"span"),l(3,"\u{1F50D}"),s(),l(4," AI \u6700\u65B0\u5206\u6790 "),s(),r(5,"p",86),l(6),s(),r(7,"div",87),l(8),s()()),i&2){let t=g(2).$implicit;c(6),A(t.stats.lastAnalysis.suggestions.reasoning),c(2),D(" \u5EFA\u8B70: ",t.stats.lastAnalysis.suggestions.topicSuggestion," ")}}function KS(i,e){if(i&1){let t=M();r(0,"div",69)(1,"div",2)(2,"div")(3,"div",88)(4,"span"),l(5,"\u{1F3AF}"),s(),l(6," \u9AD8\u610F\u5411\u5BA2\u6236 "),s(),r(7,"p",86),l(8,"\u6AA2\u6E2C\u5230\u9AD8\u610F\u5411\u5BA2\u6236\uFF0C\u5EFA\u8B70\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\u9032\u884C\u591A\u89D2\u8272\u5354\u4F5C\u6210\u4EA4"),s()(),r(9,"button",89),x("click",function(){v(t);let o=g(2).$implicit,a=g(3);return b(a.createGroupForExecution(o))}),r(10,"span"),l(11,"\u{1F465}"),s(),l(12," \u4E00\u9375\u5EFA\u7FA4 "),s()()()}}function WS(i,e){if(i&1){let t=M();r(0,"div",51)(1,"div",52)(2,"div",3),k(3,"div",53),r(4,"div")(5,"div",54),l(6),s(),r(7,"div",55)(8,"span"),l(9),s(),r(10,"span"),l(11,"\xB7"),s(),r(12,"span"),l(13),s()()()(),r(14,"div",56),S(15,OS,2,0,"button",57),S(16,BS,2,0,"button",58),S(17,VS,2,0,"button",59),r(18,"button",60),x("click",function(){v(t);let o=g().$implicit,a=g(3);return b(a.stopExecution(o))}),l(19," \u23F9\uFE0F \u505C\u6B62 "),s()()(),r(20,"div",61),S(21,LS,14,4,"div",62),S(22,US,6,0,"div",63),S(23,HS,6,0,"div",63),r(24,"div",64)(25,"div",65)(26,"div",12),l(27),s(),r(28,"div",66),l(29,"\u5DF2\u767C\u6D88\u606F"),s()(),r(30,"div",65)(31,"div",9),l(32),s(),r(33,"div",66),l(34,"\u6536\u5230\u56DE\u8986"),s()(),r(35,"div",65)(36,"div",13),l(37),s(),r(38,"div",66),l(39,"\u8208\u8DA3\u5EA6"),s()(),r(40,"div",65)(41,"div",67),l(42),s(),r(43,"div",66),l(44,"\u7576\u524D\u968E\u6BB5"),s()()(),S(45,zS,9,2,"div",68),S(46,KS,13,0,"div",69),s()()}if(i&2){let t=g().$implicit,n=g(3);c(3),I("bg-green-500",t.status==="running")("bg-yellow-500",t.status==="planning")("bg-orange-500",t.status==="paused")("animate-pulse",t.status==="running"),c(3),A(t.goal),c(3),A(n.getStatusLabel(t.status)),c(4),A(n.getExecutionDuration(t)),c(2),w(t.status==="planning"?15:-1),c(),w(t.status==="running"?16:-1),c(),w(t.status==="paused"?17:-1),c(4),w(t.intent?21:-1),c(),w(t.roles.length>0?22:-1),c(),w(t.strategy?23:-1),c(4),A(t.stats.messagesSent),c(5),A(t.stats.responsesReceived),c(5),D("",t.stats.interestScore,"%"),c(5),Y("",t.stats.currentPhase+1,"/",(t.strategy==null||t.strategy.phases==null?null:t.strategy.phases.length)||0),c(3),w(t.stats.lastAnalysis?45:-1),c(),w(t.stats.interestScore>=50&&t.status==="running"?46:-1)}}function JS(i,e){i&1&&S(0,WS,47,24,"div",51),i&2&&w(0)}function QS(i,e){if(i&1&&$(0,JS,1,1,null,null,jt),i&2){let t=g(2);H(t.activeExecutions())}}function YS(i,e){if(i&1&&(r(0,"div",19),S(1,RS,9,0,"div",46)(2,QS,2,0),s()),i&2){let t=g();c(),w(t.activeExecutions().length===0?1:2)}}function XS(i,e){i&1&&(r(0,"div",46)(1,"div",47),l(2,"\u{1F4DC}"),s(),r(3,"p",48),l(4,"\u66AB\u7121\u6B77\u53F2\u8A18\u9304"),s(),r(5,"p",27),l(6,"\u5B8C\u6210\u7684\u4EFB\u52D9\u6703\u986F\u793A\u5728\u9019\u88E1"),s()())}function ZS(i,e){if(i&1&&(r(0,"div",90)(1,"div",2)(2,"div")(3,"div",54),l(4),s(),r(5,"div",91),l(6),s()(),r(7,"div",92)(8,"div",93),l(9),s(),r(10,"div",94),l(11,"\u5DF2\u5B8C\u6210"),s()()()()),i&2){let t=e.$implicit,n=g(3);c(4),A(t.goal),c(2),Y(" ",t.intent==null?null:t.intent.goal," \xB7 ",t.stats.messagesSent," \u689D\u6D88\u606F "),c(3),A(n.formatDate(t.stats.startTime))}}function jS(i,e){if(i&1&&$(0,ZS,12,4,"div",90,jt),i&2){let t=g(2);H(t.completedExecutions())}}function e5(i,e){if(i&1&&(r(0,"div",20),S(1,XS,7,0,"div",46)(2,jS,2,0),s()),i&2){let t=g();c(),w(t.completedExecutions().length===0?1:2)}}function t5(i,e){if(i&1&&(r(0,"div",103)(1,"div",113)(2,"span",5),l(3),s(),r(4,"span",114),l(5),s()(),r(6,"p",66),l(7),s(),r(8,"p",115),l(9),s()()),i&2){let t=e.$implicit;c(3),A(t.icon),c(2),A(t.name),c(2),A(t.purpose),c(2),A(t.entryTiming)}}function n5(i,e){if(i&1&&(r(0,"div",110)(1,"div",116),l(2),s(),r(3,"div",117)(4,"div",2)(5,"span",114),l(6),s(),r(7,"span",66),l(8),s()(),r(9,"p",91),l(10),s()()()),i&2){let t=e.$implicit,n=e.$index;c(2),D(" ",n+1," "),c(4),A(t.name),c(2),A(t.duration),c(2),A(t.goal)}}function i5(i,e){if(i&1&&(r(0,"div",99)(1,"div",103)(2,"div",76),l(3,"\u{1F3AF} AI \u7406\u89E3\u7684\u76EE\u6A19"),s(),r(4,"p",74),l(5),s(),r(6,"div",104)(7,"span",105),l(8),s(),r(9,"span",106),l(10),s()()(),r(11,"div")(12,"div",107),l(13,"\u{1F3AD} AI \u63A8\u85A6\u7684\u5718\u968A"),s(),r(14,"div",108),$(15,t5,10,4,"div",103,jt),s()(),r(17,"div")(18,"div",107),l(19,"\u{1F4CB} \u57F7\u884C\u8A08\u5283"),s(),r(20,"div",109),$(21,n5,11,4,"div",110,jt),s()(),r(23,"div",111)(24,"div",85)(25,"span"),l(26,"\u{1F4A1}"),s(),l(27," AI \u6703\u9019\u6A23\u505A "),s(),r(28,"ul",112)(29,"li"),l(30,"\u2022 \u50CF\u771F\u4EBA\u4E00\u6A23\u5728\u7FA4\u88E1\u804A\u5929\uFF0C\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E"),s(),r(31,"li"),l(32,"\u2022 \u81EA\u7136\u5730\u5F15\u5165\u7522\u54C1\u8A71\u984C\uFF0C\u4E0D\u751F\u786C\u63A8\u92B7"),s(),r(33,"li"),l(34,"\u2022 \u6BCF 10 \u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21\uFF0C\u52D5\u614B\u8ABF\u6574\u7B56\u7565"),s(),r(35,"li"),l(36,"\u2022 \u6839\u64DA\u5BA2\u6236\u53CD\u61C9\u9748\u6D3B\u5207\u63DB\u89D2\u8272"),s()()()()),i&2){let t,n,o,a,d,m=g(2);c(5),A((t=m.pendingExecution())==null||t.intent==null?null:t.intent.goal),c(3),D("\u7F6E\u4FE1\u5EA6: ",(n=m.pendingExecution())==null||n.intent==null?null:n.intent.confidence,"%"),c(2),D("\u5EFA\u8B70\u9031\u671F: ",(o=m.pendingExecution())==null||o.intent==null?null:o.intent.suggestedDuration),c(5),H((a=m.pendingExecution())==null?null:a.roles),c(6),H((d=m.pendingExecution())==null||d.strategy==null?null:d.strategy.phases)}}function o5(i,e){if(i&1){let t=M();r(0,"div",21)(1,"div",95)(2,"div",96)(3,"div",3)(4,"div",97),l(5," \u{1F916} "),s(),r(6,"div")(7,"h2",98),l(8,"AI \u7B56\u5283\u5B8C\u6210\uFF01"),s(),r(9,"p",27),l(10,"\u78BA\u8A8D\u4EE5\u4E0B\u65B9\u6848\uFF0C\u5373\u53EF\u958B\u59CB\u57F7\u884C"),s()()()(),S(11,i5,37,3,"div",99),r(12,"div",100)(13,"button",101),x("click",function(){v(t);let o=g();return b(o.cancelPendingExecution())}),l(14," \u53D6\u6D88 "),s(),r(15,"button",102),x("click",function(){v(t);let o=g();return b(o.confirmPendingExecution())}),r(16,"span"),l(17,"\u25B6\uFE0F"),s(),l(18," \u78BA\u8A8D\u958B\u59CB "),s()()()()}if(i&2){let t=g();c(11),w(t.pendingExecution()?11:-1)}}var Yo=class i{constructor(){this.engine=O(ol);this.toast=O(ue);this.autoGroup=O(il);this.incomingStrategy=at(null);this.activeTab=_("start");this.userGoal="";this.hasIncomingStrategy=_(!1);this.receivedStrategy=null;this.showPlanningResult=_(!1);this.pendingExecution=_(null);this.presetGoals=[{id:"convert",icon:"\u{1F4B0}",name:"\u4FC3\u9032\u6210\u4EA4",description:"\u591A\u89D2\u8272\u914D\u5408\uFF0C\u4FC3\u6210\u7336\u8C6B\u5BA2\u6236\u4E0B\u55AE",goal:"\u8B93\u7FA4\u88E1\u5C0D\u7522\u54C1\u611F\u8208\u8DA3\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u6F5B\u5728\u5BA2\u6236\u5B8C\u6210\u8CFC\u8CB7"},{id:"recovery",icon:"\u{1F49D}",name:"\u633D\u56DE\u6D41\u5931",description:"\u95DC\u61F7\u56DE\u8A2A + \u7279\u5225\u512A\u60E0",goal:"\u633D\u56DE\u5DF2\u7D93\u6D41\u5931\u6216\u6C89\u9ED8\u7684\u8001\u5BA2\u6236\uFF0C\u8B93\u4ED6\u5011\u91CD\u65B0\u8CFC\u8CB7"},{id:"active",icon:"\u{1F389}",name:"\u793E\u7FA4\u6D3B\u8E8D",description:"\u8A71\u984C\u5F15\u5C0E + \u4E92\u52D5\u6FC0\u52F5",goal:"\u63D0\u5347\u793E\u7FA4\u6D3B\u8E8D\u5EA6\uFF0C\u8B93\u7FA4\u6210\u54E1\u66F4\u9858\u610F\u4E92\u52D5\u548C\u8A0E\u8AD6"},{id:"support",icon:"\u{1F527}",name:"\u552E\u5F8C\u670D\u52D9",description:"\u5FEB\u901F\u97FF\u61C9 + \u554F\u984C\u89E3\u6C7A",goal:"\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C\uFF0C\u63D0\u5347\u5BA2\u6236\u6EFF\u610F\u5EA6"},{id:"nurture",icon:"\u{1F331}",name:"\u6F5B\u5BA2\u57F9\u80B2",description:"\u50F9\u503C\u8F38\u51FA + \u4FE1\u4EFB\u5EFA\u7ACB",goal:"\u901A\u904E\u6301\u7E8C\u7684\u50F9\u503C\u8F38\u51FA\u57F9\u80B2\u6F5B\u5728\u5BA2\u6236\uFF0C\u63D0\u5347\u8CFC\u8CB7\u610F\u9858"},{id:"brand",icon:"\u{1F3C6}",name:"\u54C1\u724C\u63A8\u5EE3",description:"\u53E3\u7891\u50B3\u64AD + \u5F62\u8C61\u5EFA\u7ACB",goal:"\u63D0\u5347\u54C1\u724C\u77E5\u540D\u5EA6\u548C\u597D\u611F\u5EA6\uFF0C\u8B93\u66F4\u591A\u4EBA\u4E86\u89E3\u6211\u5011"}];this.runningCount=G(()=>this.engine.executions().filter(e=>e.status==="running").length);this.todayMessages=G(()=>this.engine.executions().filter(e=>e.status==="running").reduce((e,t)=>e+t.stats.messagesSent,0));this.todayConversions=G(()=>0);this.completedExecutions=G(()=>this.engine.executions().filter(e=>e.status==="completed"));this.activeExecutions=G(()=>this.engine.executions().filter(e=>e.status==="running"||e.status==="planning"||e.status==="paused"));Dn(()=>{let e=this.incomingStrategy();e&&this.handleIncomingStrategy(e)})}ngOnInit(){}ngOnDestroy(){}onEnterKey(e){let t=e;t.shiftKey||(t.preventDefault(),this.startFromGoal())}async startFromGoal(){if(!this.userGoal.trim())return;let e=await this.engine.startFromOnePhrase(this.userGoal);e&&(this.pendingExecution.set(e),this.showPlanningResult.set(!0))}quickStart(e){this.userGoal=e,this.startFromGoal()}confirmPendingExecution(){let e=this.pendingExecution();e&&(this.engine.confirmAndStart(e.id),this.showPlanningResult.set(!1),this.pendingExecution.set(null),this.userGoal="",this.activeTab.set("running"))}cancelPendingExecution(){let e=this.pendingExecution();e&&this.engine.stopExecution(e.id),this.showPlanningResult.set(!1),this.pendingExecution.set(null)}confirmStart(e){this.engine.confirmAndStart(e.id)}pauseExecution(e){this.engine.pauseExecution(e.id),this.toast.info("\u5DF2\u66AB\u505C\u57F7\u884C")}resumeExecution(e){this.engine.resumeExecution(e.id),this.toast.success("\u5DF2\u6062\u5FA9\u57F7\u884C")}stopExecution(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u9019\u500B\u4EFB\u52D9\u55CE\uFF1F")&&(this.engine.stopExecution(e.id),this.toast.info("\u4EFB\u52D9\u5DF2\u505C\u6B62"))}getStatusLabel(e){return{idle:"\u5F85\u547D",planning:"\u7B56\u5283\u4E2D",running:"\u57F7\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210"}[e]}getExecutionDuration(e){let t=new Date(e.stats.startTime),o=new Date().getTime()-t.getTime(),a=Math.floor(o/6e4);if(a<60)return`${a} \u5206\u9418`;let d=Math.floor(a/60);return d<24?`${d} \u5C0F\u6642`:`${Math.floor(d/24)} \u5929`}formatDate(e){return new Date(e).toLocaleDateString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}async createGroupForExecution(e){if(!e.targetUsers||e.targetUsers.length===0){this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u76EE\u6A19\u7528\u6236\uFF0C\u8ACB\u7E7C\u7E8C\u7B49\u5F85...");return}let t=e.targetUsers.filter(d=>d.intentScore>=50);if(t.length===0){this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u7528\u6236\u53EF\u5EFA\u7FA4");return}let n=t[0],o={targetCustomer:{id:n.id.toString(),username:n.username,firstName:n.firstName||n.username},groupName:this.autoGroup.generateGroupName(n.firstName||n.username||"VIP","{\u5BA2\u6236\u540D}\u5C08\u5C6C\u670D\u52D9\u7FA4"),roleAccounts:e.roles.map((d,m)=>({roleId:d.id,accountId:d.accountId||m+1})),scriptId:void 0,inviteMessage:`\u60A8\u597D ${n.firstName||""}\uFF01\u6211\u5011\u70BA\u60A8\u5275\u5EFA\u4E86\u5C08\u5C6C\u670D\u52D9\u7FA4\u7D44\uFF0C\u6211\u5011\u7684\u5C08\u696D\u5718\u968A\u5C07\u70BA\u60A8\u63D0\u4F9B\u4E00\u5C0D\u4E00\u670D\u52D9\u3002`,intentScore:n.intentScore};this.toast.info("\u6B63\u5728\u70BA\u9AD8\u610F\u5411\u5BA2\u6236\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44...");let a=await this.autoGroup.createGroup(o);a.success?this.toast.success(`\u{1F389} \u5DF2\u70BA ${n.firstName||n.username} \u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\uFF01`):this.toast.error(`\u5EFA\u7FA4\u5931\u6557: ${a.error}`)}handleIncomingStrategy(e){console.log("[AITeamHub] \u6536\u5230 AI \u71DF\u92B7\u52A9\u624B\u7B56\u7565:",e),this.hasIncomingStrategy.set(!0),this.receivedStrategy=e;let t=[`\u5728${e.industry}\u884C\u696D`,`\u5C0B\u627E${e.targetAudience}`];e.keywords.highIntent.length>0&&t.push(`\u95DC\u6CE8\u300C${e.keywords.highIntent.slice(0,3).join("\u3001")}\u300D\u7B49\u95DC\u9375\u8A5E`),e.customerProfile.needs.length>0&&t.push(`\u6EFF\u8DB3\u5BA2\u6236\u300C${e.customerProfile.needs[0]}\u300D\u7684\u9700\u6C42`);let n=t.join("\uFF0C")+"\uFF0C\u4FC3\u6210\u6210\u4EA4";this.userGoal=n,this.toast.success(`\u{1F916} \u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565\uFF01\u884C\u696D: ${e.industry}`),this.activeTab.set("start"),setTimeout(()=>{this.startWithFullStrategy()},500)}clearIncomingStrategy(){this.hasIncomingStrategy.set(!1),this.receivedStrategy=null,this.userGoal=""}async startWithFullStrategy(){if(!this.receivedStrategy){this.startFromGoal();return}let e=this.receivedStrategy,t=await this.engine.startWithMarketingStrategy(this.userGoal,e);t&&(this.pendingExecution.set(t),this.showPlanningResult.set(!0),this.hasIncomingStrategy.set(!1))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-ai-team-hub"]],inputs:{incomingStrategy:[1,"incomingStrategy"]},decls:46,vars:37,consts:[[1,"ai-team-hub","h-full","flex","flex-col","bg-slate-900"],[1,"p-4","border-b","border-slate-700/50","bg-slate-900/80","backdrop-blur-sm"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-2xl"],[1,"flex","items-center","gap-2","px-3","py-1","bg-green-500/20","text-green-400","rounded-full","text-sm","animate-pulse"],[1,"flex","items-center","gap-4","px-4","py-2","bg-slate-800/80","rounded-xl","border","border-slate-700/50"],[1,"text-center"],[1,"text-lg","font-bold","text-green-400"],[1,"text-xs","text-slate-500"],[1,"w-px","h-8","bg-slate-700"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-lg","font-bold","text-purple-400"],[1,"flex","gap-1","mt-4","bg-slate-800/50","p-1","rounded-xl","w-fit"],[1,"px-6","py-2.5","rounded-lg","transition-all","flex","items-center","gap-2","text-sm","font-medium",3,"click"],[1,"bg-white/20","px-2","py-0.5","rounded-full","text-xs"],[1,"flex-1","overflow-y-auto","p-6"],[1,"max-w-3xl","mx-auto","space-y-8"],[1,"space-y-6"],[1,"space-y-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"w-2","h-2","bg-green-500","rounded-full"],[1,"p-4","bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","border","border-emerald-500/30","rounded-2xl"],[1,"bg-gradient-to-br","from-purple-500/10","via-pink-500/10","to-cyan-500/10","rounded-3xl","border","border-purple-500/30","p-8"],[1,"text-center","mb-6"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-400"],[1,"relative"],["rows","3","placeholder","\u4F8B\u5982\uFF1A\u6211\u60F3\u8B93\u7FA4\u88E1\u90A3\u4E9B\u770B\u904E\u7522\u54C1\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u4EBA\u8CFC\u8CB7...",1,"w-full","px-6","py-4","bg-slate-800/80","border","border-slate-600","rounded-2xl","text-white","text-lg","placeholder-slate-500","resize-none","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"ngModelChange","keydown.enter","ngModel"],[1,"absolute","right-3","bottom-3","px-6","py-2.5","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"text-sm","text-slate-400","mb-4","flex","items-center","gap-2"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl","text-left","hover:bg-slate-800","hover:border-purple-500/30","transition-all","group"],[1,"grid","grid-cols-3","gap-4"],[1,"p-4","bg-slate-800/30","rounded-xl","text-center"],[1,"text-2xl","mb-2"],[1,"text-sm","text-white","font-medium"],[1,"text-xs","text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"text-emerald-400","font-medium"],[1,"text-slate-400","text-sm"],[1,"p-2","text-slate-400","hover:text-white","hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],[1,"animate-spin"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl","text-left","hover:bg-slate-800","hover:border-purple-500/30","transition-all","group",3,"click"],[1,"font-medium","text-white","group-hover:text-purple-400","transition-colors"],[1,"text-center","py-16"],[1,"text-6xl","mb-4"],[1,"text-xl","text-white","mb-2"],[1,"text-slate-400","mb-6"],[1,"px-6","py-3","bg-purple-500","text-white","rounded-xl","hover:bg-purple-400","transition-colors",3,"click"],[1,"bg-slate-800/50","border","border-slate-700/50","rounded-2xl","overflow-hidden"],[1,"p-4","border-b","border-slate-700/50","flex","items-center","justify-between"],[1,"w-3","h-3","rounded-full"],[1,"font-medium","text-white"],[1,"text-xs","text-slate-400","flex","items-center","gap-2"],[1,"flex","items-center","gap-2"],[1,"px-4","py-2","bg-green-500","text-white","rounded-lg","hover:bg-green-400","transition-colors","text-sm"],[1,"px-4","py-2","bg-orange-500/20","text-orange-400","rounded-lg","hover:bg-orange-500/30","transition-colors","text-sm"],[1,"px-4","py-2","bg-green-500/20","text-green-400","rounded-lg","hover:bg-green-500/30","transition-colors","text-sm"],[1,"px-4","py-2","bg-red-500/20","text-red-400","rounded-lg","hover:bg-red-500/30","transition-colors","text-sm",3,"click"],[1,"p-4"],[1,"mb-4","p-3","bg-purple-500/10","border","border-purple-500/20","rounded-xl"],[1,"mb-4"],[1,"grid","grid-cols-4","gap-4"],[1,"p-3","bg-slate-700/30","rounded-lg","text-center"],[1,"text-xs","text-slate-400"],[1,"text-lg","font-bold","text-yellow-400"],[1,"mt-4","p-3","bg-cyan-500/10","border","border-cyan-500/20","rounded-xl"],[1,"mt-4","p-4","bg-gradient-to-r","from-amber-500/10","to-orange-500/10","border","border-amber-500/20","rounded-xl"],[1,"px-4","py-2","bg-green-500","text-white","rounded-lg","hover:bg-green-400","transition-colors","text-sm",3,"click"],[1,"px-4","py-2","bg-orange-500/20","text-orange-400","rounded-lg","hover:bg-orange-500/30","transition-colors","text-sm",3,"click"],[1,"px-4","py-2","bg-green-500/20","text-green-400","rounded-lg","hover:bg-green-500/30","transition-colors","text-sm",3,"click"],[1,"flex","items-center","gap-2","text-purple-400","text-sm","mb-2"],[1,"text-white"],[1,"flex","items-center","gap-4","mt-2","text-xs","text-slate-400"],[1,"text-sm","text-slate-400","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"flex","items-center","gap-2","px-3","py-2","bg-slate-700/50","rounded-lg"],[1,"text-xl"],[1,"text-sm","text-white"],[1,"flex","items-center"],[1,"px-3","py-1.5","rounded-lg","text-xs"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-slate-500","mx-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"flex","items-center","gap-2","text-cyan-400","text-sm","mb-2"],[1,"text-white","text-sm"],[1,"text-xs","text-slate-400","mt-2"],[1,"flex","items-center","gap-2","text-amber-400","text-sm","mb-1"],[1,"px-4","py-2","bg-gradient-to-r","from-amber-500","to-orange-500","text-white","rounded-lg","hover:from-amber-400","hover:to-orange-400","transition-all","text-sm","font-medium","flex","items-center","gap-2","whitespace-nowrap",3,"click"],[1,"p-4","bg-slate-800/50","border","border-slate-700/50","rounded-xl"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-right"],[1,"text-sm","text-slate-400"],[1,"text-xs","text-green-400"],[1,"bg-slate-900","rounded-2xl","w-full","max-w-2xl","shadow-2xl","border","border-purple-500/30","overflow-hidden","max-h-[90vh]","overflow-y-auto"],[1,"p-6","bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border-b","border-slate-700/50"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-purple-500","to-pink-500","flex","items-center","justify-center","text-2xl"],[1,"text-xl","font-bold","text-white"],[1,"p-6","space-y-6"],[1,"p-6","border-t","border-slate-700/50","flex","gap-3"],[1,"flex-1","py-3","bg-slate-700","text-slate-300","rounded-xl","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","bg-gradient-to-r","from-green-500","to-emerald-500","text-white","font-medium","rounded-xl","hover:opacity-90","transition-opacity","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-4","bg-slate-800/50","rounded-xl"],[1,"flex","items-center","gap-4","mt-2","text-xs"],[1,"text-purple-400"],[1,"text-cyan-400"],[1,"text-sm","text-slate-400","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"space-y-3"],[1,"flex","items-start","gap-4","p-3","bg-slate-800/50","rounded-lg"],[1,"p-4","bg-cyan-500/10","border","border-cyan-500/20","rounded-xl"],[1,"text-sm","text-slate-300","space-y-1"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-white","font-medium"],[1,"text-xs","text-cyan-400","mt-1"],[1,"w-8","h-8","rounded-full","bg-purple-500/30","text-purple-400","flex","items-center","justify-center","flex-shrink-0"],[1,"flex-1"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),l(6,"\u{1F916}"),s(),l(7," AI \u5718\u968A\u92B7\u552E "),s(),S(8,MS,3,0,"span",6),s(),r(9,"div",7)(10,"div",8)(11,"div",9),l(12),s(),r(13,"div",10),l(14,"\u57F7\u884C\u4E2D"),s()(),k(15,"div",11),r(16,"div",8)(17,"div",12),l(18),s(),r(19,"div",10),l(20,"\u4ECA\u65E5\u6D88\u606F"),s()(),k(21,"div",11),r(22,"div",8)(23,"div",13),l(24),s(),r(25,"div",10),l(26,"\u6210\u4EA4"),s()()()(),r(27,"div",14)(28,"button",15),x("click",function(){return n.activeTab.set("start")}),r(29,"span"),l(30,"\u{1F680}"),s(),l(31," \u4E00\u9375\u555F\u52D5 "),s(),r(32,"button",15),x("click",function(){return n.activeTab.set("running")}),r(33,"span"),l(34,"\u{1F4CA}"),s(),l(35," \u57F7\u884C\u76E3\u63A7 "),S(36,TS,2,1,"span",16),s(),r(37,"button",15),x("click",function(){return n.activeTab.set("history")}),r(38,"span"),l(39,"\u{1F4DC}"),s(),l(40," \u6B77\u53F2\u8A18\u9304 "),s()()(),r(41,"div",17),S(42,NS,44,4,"div",18)(43,YS,3,1,"div",19)(44,e5,3,1,"div",20),s(),S(45,o5,19,1,"div",21),s()),t&2){let o,a;c(8),w(((o=n.engine.currentExecution())==null?null:o.status)==="running"?8:-1),c(4),A(n.runningCount()),c(6),A(n.todayMessages()),c(6),A(n.todayConversions()),c(4),I("bg-gradient-to-r",n.activeTab()==="start")("from-purple-500",n.activeTab()==="start")("to-pink-500",n.activeTab()==="start")("text-white",n.activeTab()==="start")("text-slate-400",n.activeTab()!=="start"),c(4),I("bg-gradient-to-r",n.activeTab()==="running")("from-green-500",n.activeTab()==="running")("to-emerald-500",n.activeTab()==="running")("text-white",n.activeTab()==="running")("text-slate-400",n.activeTab()!=="running"),c(4),w(n.runningCount()>0?36:-1),c(),I("bg-gradient-to-r",n.activeTab()==="history")("from-slate-600",n.activeTab()==="history")("to-slate-500",n.activeTab()==="history")("text-white",n.activeTab()==="history")("text-slate-400",n.activeTab()!=="history"),c(5),w((a=n.activeTab())==="start"?42:a==="running"?43:a==="history"?44:-1),c(3),w(n.showPlanningResult()?45:-1)}},dependencies:[te,me,xe,_e,Ce],encapsulation:2})}};var r5=(i,e)=>e.group,s5=(i,e)=>e.user_id;function a5(i,e){if(i&1){let t=M();r(0,"div",9)(1,"button",50),x("click",function(){v(t);let o=g();return o.deduplicateMembers(),b(o.showAdvancedMenu.set(!1))}),l(2," \u{1F504} \u667A\u80FD\u53BB\u91CD "),r(3,"span",51),l(4,"\u8DE8\u7FA4\u7D44\u5408\u4F75"),s()(),r(5,"button",50),x("click",function(){v(t);let o=g();return o.recalculateScores(),b(o.showAdvancedMenu.set(!1))}),l(6," \u{1F4CA} \u91CD\u7B97\u8A55\u5206 "),r(7,"span",51),l(8,"\u66F4\u65B0\u50F9\u503C\u7B49\u7D1A"),s()(),k(9,"div",52),r(10,"button",50),x("click",function(){v(t);let o=g();return o.showGroupProfile(),b(o.showAdvancedMenu.set(!1))}),l(11," \u{1F4C8} \u7FA4\u7D44\u756B\u50CF "),r(12,"span",51),l(13,"\u8CEA\u91CF\u5206\u6790"),s()(),r(14,"button",50),x("click",function(){v(t);let o=g();return o.compareGroups(),b(o.showAdvancedMenu.set(!1))}),l(15," \u{1F4CA} \u7FA4\u7D44\u5C0D\u6BD4 "),r(16,"span",51),l(17,"\u591A\u7FA4\u5C0D\u6BD4"),s()(),k(18,"div",52),r(19,"button",50),x("click",function(){v(t);let o=g();return o.viewExtractionStats(),b(o.showAdvancedMenu.set(!1))}),l(20," \u{1F4C9} \u63D0\u53D6\u7D71\u8A08 "),r(21,"span",51),l(22,"\u6210\u529F\u7387/\u6548\u80FD"),s()()()}}function l5(i,e){if(i&1&&(r(0,"div",18),l(1),s()),i&2){let t=g();c(),D("+",t.stats().todayNew," \u4ECA\u65E5")}}function c5(i,e){if(i&1){let t=M();r(0,"button",53),x("click",function(){v(t);let o=g();return b(o.clearSearch())}),l(1,"\u2715"),s()}}function d5(i,e){if(i&1&&(r(0,"option",33),l(1),s()),i&2){let t=e.$implicit;V("value",t.group),c(),Y("",t.title," (",t.count,")")}}function u5(i,e){if(i&1){let t=M();r(0,"button",54),x("click",function(){v(t);let o=g();return b(o.clearFilters())}),l(1," \u{1F5D1}\uFE0F \u6E05\u9664\u7BE9\u9078 "),s()}}function m5(i,e){i&1&&(r(0,"div",48),k(1,"div",55),r(2,"p"),l(3,"\u6B63\u5728\u8F09\u5165\u6210\u54E1\u6578\u64DA..."),s()())}function p5(i,e){i&1&&(r(0,"div",49)(1,"div",56),l(2,"\u{1F4ED}"),s(),r(3,"h3"),l(4,"\u66AB\u7121\u6210\u54E1\u6578\u64DA"),s(),r(5,"p"),l(6,"\u8ACB\u5148\u5F9E\u300C\u8CC7\u6E90\u767C\u73FE\u300D\u9801\u9762\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1"),s()())}function g5(i,e){if(i&1){let t=M();r(0,"div",57)(1,"span",78),l(2),s(),r(3,"div",79)(4,"button",80),x("click",function(){v(t);let o=g(2);return b(o.batchSendMessage())}),l(5," \u{1F4E8} \u6279\u91CF\u767C\u6D88\u606F "),s(),r(6,"button",80),x("click",function(){v(t);let o=g(2);return b(o.batchAddTags())}),l(7," \u{1F3F7}\uFE0F \u6279\u91CF\u6A19\u7C64 "),s(),r(8,"button",80),x("click",function(){v(t);let o=g(2);return b(o.batchMarkContacted())}),l(9," \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B "),s(),r(10,"button",80),x("click",function(){v(t);let o=g(2);return b(o.batchExport())}),l(11," \u{1F4E5} \u5C0E\u51FA\u9078\u4E2D "),s(),r(12,"button",81),x("click",function(){v(t);let o=g(2);return b(o.clearSelection())}),l(13," \u2715 \u53D6\u6D88\u9078\u64C7 "),s()()()}if(i&2){let t=g(2);c(2),D("\u5DF2\u9078\u64C7 ",t.selectedMemberIds().length," \u500B\u6210\u54E1")}}function h5(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=g(2);c(),A(t.sortDirection==="asc"?"\u2191":"\u2193")}}function f5(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=g(2);c(),A(t.sortDirection==="asc"?"\u2191":"\u2193")}}function _5(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=g(2);c(),A(t.sortDirection==="asc"?"\u2191":"\u2193")}}function C5(i,e){if(i&1&&(r(0,"span"),l(1),s()),i&2){let t=g(2);c(),A(t.sortDirection==="asc"?"\u2191":"\u2193")}}function v5(i,e){i&1&&(r(0,"span",92),l(1,"\u2B50"),s())}function b5(i,e){i&1&&(r(0,"span",93),l(1,"\u2713"),s())}function x5(i,e){i&1&&(r(0,"span",94),l(1,"\u{1F1E8}\u{1F1F3}"),s())}function y5(i,e){if(i&1&&(r(0,"span",95),l(1),s()),i&2){let t=g().$implicit;V("title",t.bio),c(),A(t.bio)}}function S5(i,e){if(i&1){let t=M();r(0,"a",112),x("click",function(o){return v(t),b(o.stopPropagation())}),l(1),s()}if(i&2){let t=g().$implicit;V("href","https://t.me/"+t.username,Ut),c(),D(" @",t.username," ")}}function w5(i,e){i&1&&(r(0,"span",97),l(1,"-"),s())}function E5(i,e){if(i&1&&(r(0,"span",113),l(1),s()),i&2){let t=e.$implicit;c(),A(t)}}function A5(i,e){if(i&1&&(r(0,"span",114),l(1),s()),i&2){let t=g(2).$implicit,n=g(2);c(),D("+",n.getMemberTags(t).length-2)}}function D5(i,e){if(i&1&&(r(0,"div",103),$(1,E5,2,1,"span",113,Pe),S(3,A5,2,1,"span",114),s()),i&2){let t=g().$implicit,n=g(2);c(),H(n.getMemberTags(t).slice(0,2)),c(2),w(n.getMemberTags(t).length>2?3:-1)}}function M5(i,e){i&1&&(r(0,"span",104),l(1,"-"),s())}function T5(i,e){i&1&&(r(0,"span",105),l(1," \u2705 \u5DF2\u806F\u7E6B "),s())}function k5(i,e){i&1&&(r(0,"span",106),l(1," \u{1F4ED} \u672A\u806F\u7E6B "),s())}function I5(i,e){if(i&1){let t=M();r(0,"tr",82),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.openMemberDetail(o))}),r(1,"td",83),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"input",84),x("change",function(){let o=v(t).$implicit,a=g(2);return b(a.toggleMemberSelection(o.user_id))}),s()(),r(3,"td",85)(4,"span",86),l(5),s()(),r(6,"td",87)(7,"div",88)(8,"div",89),l(9),s(),r(10,"div",90)(11,"span",91),l(12),S(13,v5,2,0,"span",92),S(14,b5,2,0,"span",93),S(15,x5,2,0,"span",94),s(),S(16,y5,2,2,"span",95),s()()(),r(17,"td",64),S(18,S5,2,2,"a",96)(19,w5,2,0,"span",97),s(),r(20,"td",98)(21,"span",99),l(22),s()(),r(23,"td",100)(24,"span",101),l(25),s()(),r(26,"td",67)(27,"span",102),l(28),s()(),r(29,"td",68),S(30,D5,4,1,"div",103)(31,M5,2,0,"span",104),s(),r(32,"td",69),S(33,T5,2,0,"span",105)(34,k5,2,0,"span",106),s(),r(35,"td",107),x("click",function(o){return v(t),b(o.stopPropagation())}),r(36,"div",108)(37,"button",109),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.sendMessage(o))}),l(38," \u{1F4AC} "),s(),r(39,"button",110),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.addToFunnel(o))}),l(40," \u{1F4E4} "),s(),r(41,"button",111),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.openMemberDetail(o))}),l(42," \u{1F441}\uFE0F "),s()()()()}if(i&2){let t=e.$implicit,n=g(2);I("selected",n.isMemberSelected(t.user_id)),c(2),V("checked",n.isMemberSelected(t.user_id)),c(2),V("title",t.user_id),c(),A(t.user_id),c(3),I("has-photo",t.has_photo),c(),D(" ",n.getAvatarLetter(t)," "),c(3),Y(" ",t.first_name," ",t.last_name," "),c(),w(t.is_premium?13:-1),c(),w(t.is_verified?14:-1),c(),w(n.isChinese(t)?15:-1),c(),w(t.bio?16:-1),c(2),w(t.username?18:19),c(3),de("status-"+t.online_status),c(),Y(" ",n.getStatusIcon(t.online_status)," ",n.getStatusText(t.online_status)," "),c(2),de("level-"+t.value_level),c(),D(" ",t.value_level," "),c(2),V("title",t.source_chat_title),c(),D(" ",t.source_chat_title||"\u672A\u77E5"," "),c(2),w(n.getMemberTags(t).length>0?30:31),c(3),w(t.contacted?33:34)}}function P5(i,e){if(i&1){let t=M();S(0,g5,14,1,"div",57),r(1,"div",58)(2,"table",59)(3,"thead")(4,"tr")(5,"th",60)(6,"input",61),x("change",function(){v(t);let o=g();return b(o.toggleSelectAll())}),s()(),r(7,"th",62),x("click",function(){v(t);let o=g();return b(o.sortBy("user_id"))}),l(8," ID "),S(9,h5,2,1,"span"),s(),r(10,"th",63),x("click",function(){v(t);let o=g();return b(o.sortBy("first_name"))}),l(11," \u7528\u6236 "),S(12,f5,2,1,"span"),s(),r(13,"th",64),l(14,"\u7528\u6236\u540D"),s(),r(15,"th",65),x("click",function(){v(t);let o=g();return b(o.sortBy("online_status"))}),l(16," \u72C0\u614B "),S(17,_5,2,1,"span"),s(),r(18,"th",66),x("click",function(){v(t);let o=g();return b(o.sortBy("value_level"))}),l(19," \u7B49\u7D1A "),S(20,C5,2,1,"span"),s(),r(21,"th",67),l(22,"\u4F86\u6E90\u7FA4\u7D44"),s(),r(23,"th",68),l(24,"\u6A19\u7C64"),s(),r(25,"th",69),l(26,"\u806F\u7E6B\u72C0\u614B"),s(),r(27,"th",70),l(28,"\u64CD\u4F5C"),s()()(),r(29,"tbody"),$(30,I5,43,26,"tr",71,s5),s()()(),r(32,"div",72)(33,"div",73),l(34),s(),r(35,"div",74)(36,"button",75),x("click",function(){v(t);let o=g();return b(o.goToPage(1))}),l(37," \u23EE\uFE0F "),s(),r(38,"button",75),x("click",function(){v(t);let o=g();return b(o.goToPage(o.currentPage-1))}),l(39," \u25C0\uFE0F "),s(),r(40,"span",76),l(41),s(),r(42,"button",75),x("click",function(){v(t);let o=g();return b(o.goToPage(o.currentPage+1))}),l(43," \u25B6\uFE0F "),s(),r(44,"button",75),x("click",function(){v(t);let o=g();return b(o.goToPage(o.totalPages()))}),l(45," \u23ED\uFE0F "),s(),r(46,"select",77),W("ngModelChange",function(o){v(t);let a=g();return K(a.pageSize,o)||(a.pageSize=o),b(o)}),x("ngModelChange",function(){v(t);let o=g();return b(o.onPageSizeChange())}),r(47,"option",33),l(48,"25 / \u9801"),s(),r(49,"option",33),l(50,"50 / \u9801"),s(),r(51,"option",33),l(52,"100 / \u9801"),s(),r(53,"option",33),l(54,"200 / \u9801"),s()()()()}if(i&2){let t=g();w(t.selectedMemberIds().length>0?0:-1),c(6),V("checked",t.isAllSelected())("indeterminate",t.isPartialSelected()),c(3),w(t.sortField==="user_id"?9:-1),c(3),w(t.sortField==="first_name"?12:-1),c(5),w(t.sortField==="online_status"?17:-1),c(3),w(t.sortField==="value_level"?20:-1),c(10),H(t.paginatedMembers()),c(4),st(" \u986F\u793A ",t.getPageStart()," - ",t.getPageEnd()," / ",t.filteredMembers().length," \u500B\u6210\u54E1 "),c(2),V("disabled",t.currentPage===1),c(2),V("disabled",t.currentPage===1),c(3),Y("",t.currentPage," / ",t.totalPages()),c(),V("disabled",t.currentPage>=t.totalPages()),c(2),V("disabled",t.currentPage>=t.totalPages()),c(2),z("ngModel",t.pageSize),c(),V("value",25),c(2),V("value",50),c(2),V("value",100),c(2),V("value",200)}}function F5(i,e){i&1&&(r(0,"span",125),l(1,"\u2B50"),s())}function N5(i,e){if(i&1&&(r(0,"a",126),l(1),s()),i&2){let t=g(2);V("href","https://t.me/"+t.selectedMember().username,Ut),c(),D(" @",t.selectedMember().username," ")}}function R5(i,e){if(i&1&&(r(0,"div",129)(1,"span",130),l(2,"\u96FB\u8A71\u865F\u78BC"),s(),r(3,"span",133),l(4),s()()),i&2){let t=g(2);c(4),A(t.selectedMember().phone)}}function O5(i,e){if(i&1&&(r(0,"div",129)(1,"span",130),l(2,"\u8A9E\u8A00"),s(),r(3,"span",133),l(4),s()()),i&2){let t=g(2);c(4),A(t.selectedMember().language_code)}}function B5(i,e){i&1&&(r(0,"span",135),l(1,"\u2B50 Premium"),s())}function V5(i,e){i&1&&(r(0,"span",136),l(1,"\u2713 \u5DF2\u9A57\u8B49"),s())}function L5(i,e){i&1&&(r(0,"span",137),l(1,"\u{1F4F7} \u6709\u982D\u50CF"),s())}function G5(i,e){i&1&&(r(0,"span",138),l(1,"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA"),s())}function U5(i,e){i&1&&(r(0,"span",139),l(1,"\u26A0\uFE0F \u8A50\u9A19\u6A19\u8A18"),s())}function q5(i,e){i&1&&(r(0,"span",140),l(1,"\u{1F5D1}\uFE0F \u5DF2\u522A\u9664"),s())}function $5(i,e){if(i&1&&(r(0,"div",120)(1,"h4",127),l(2,"\u{1F4DD} \u500B\u4EBA\u7C21\u4ECB"),s(),r(3,"p",156),l(4),s()()),i&2){let t=g(2);c(4),A(t.selectedMember().bio)}}function H5(i,e){if(i&1&&(r(0,"div",142)(1,"span",143),l(2),s()()),i&2){let t=g().$implicit;c(2),D("\u7FA4\u7D44 ",t)}}function z5(i,e){if(i&1&&S(0,H5,3,1,"div",142),i&2){let t=e.$implicit,n=g(2);w(t!==n.selectedMember().source_chat_id?0:-1)}}function K5(i,e){if(i&1){let t=M();r(0,"span",146),l(1),r(2,"button",157),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.removeTag(a.selectedMember(),o))}),l(3,"\u2715"),s()()}if(i&2){let t=e.$implicit;c(),D(" ",t," ")}}function W5(i,e){if(i&1&&(r(0,"div",150)(1,"span",151),l(2,"\u806F\u7E6B\u6642\u9593"),s(),r(3,"span",152),l(4),s()()),i&2){let t=g(2);c(4),A(t.formatDate(t.selectedMember().contacted_at))}}function J5(i,e){if(i&1&&(r(0,"div",150)(1,"span",151),l(2,"\u56DE\u8986\u72C0\u614B"),s(),r(3,"span",152),l(4),s()()),i&2){let t=g(2);c(4),A(t.selectedMember().response_status)}}function Q5(i,e){if(i&1){let t=M();r(0,"button",8),x("click",function(){v(t);let o=g(2);return b(o.markAsContacted(o.selectedMember()))}),l(1," \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B "),s()}}function Y5(i,e){if(i&1){let t=M();r(0,"div",115),x("click",function(){v(t);let o=g();return b(o.closeMemberDetail())}),s(),r(1,"div",116)(2,"div",117)(3,"h2"),l(4,"\u6210\u54E1\u8A73\u60C5"),s(),r(5,"button",118),x("click",function(){v(t);let o=g();return b(o.closeMemberDetail())}),l(6,"\u2715"),s()(),r(7,"div",119)(8,"div",120)(9,"div",121)(10,"div",122),l(11),s(),r(12,"div",123)(13,"h3",124),l(14),S(15,F5,2,0,"span",125),s(),S(16,N5,2,2,"a",126),r(17,"span",99),l(18),s()()()(),r(19,"div",120)(20,"h4",127),l(21,"\u{1F4CB} \u57FA\u672C\u4FE1\u606F"),s(),r(22,"div",128)(23,"div",129)(24,"span",130),l(25,"Telegram ID"),s(),r(26,"span",131),x("click",function(){v(t);let o=g();return b(o.copyToClipboard(o.selectedMember().user_id))}),l(27),r(28,"span",132),l(29,"\u{1F4CB}"),s()()(),S(30,R5,5,1,"div",129),S(31,O5,5,1,"div",129),r(32,"div",129)(33,"span",130),l(34,"\u50F9\u503C\u7B49\u7D1A"),s(),r(35,"span",133)(36,"span",101),l(37),s()()(),r(38,"div",129)(39,"span",130),l(40,"\u6D3B\u8E8D\u5EA6\u8A55\u5206"),s(),r(41,"span",133),l(42),s()()()(),r(43,"div",120)(44,"h4",127),l(45,"\u{1F516} \u5E33\u865F\u72C0\u614B"),s(),r(46,"div",134),S(47,B5,2,0,"span",135),S(48,V5,2,0,"span",136),S(49,L5,2,0,"span",137),S(50,G5,2,0,"span",138),S(51,U5,2,0,"span",139),S(52,q5,2,0,"span",140),s()(),S(53,$5,5,1,"div",120),r(54,"div",120)(55,"h4",127),l(56,"\u{1F4CD} \u4F86\u6E90\u7FA4\u7D44"),s(),r(57,"div",141)(58,"div",142)(59,"span",143),l(60),s(),r(61,"span",144),l(62),s()(),$(63,z5,1,1,null,null,Pe),s()(),r(65,"div",120)(66,"h4",127),l(67,"\u{1F3F7}\uFE0F \u6A19\u7C64"),s(),r(68,"div",145),$(69,K5,4,1,"span",146,Pe),r(71,"button",147),x("click",function(){v(t);let o=g();return b(o.openAddTagDialog())}),l(72,"+ \u6DFB\u52A0\u6A19\u7C64"),s()()(),r(73,"div",120)(74,"h4",127),l(75,"\u{1F4DD} \u5099\u8A3B"),s(),r(76,"textarea",148),W("ngModelChange",function(o){v(t);let a=g();return K(a.memberNotes,o)||(a.memberNotes=o),b(o)}),x("blur",function(){v(t);let o=g();return b(o.saveMemberNotes())}),s()(),r(77,"div",120)(78,"h4",127),l(79,"\u{1F4CA} \u71DF\u92B7\u72C0\u614B"),s(),r(80,"div",149)(81,"div",150)(82,"span",151),l(83,"\u806F\u7E6B\u72C0\u614B"),s(),r(84,"span",152),l(85),s()(),S(86,W5,5,1,"div",150),S(87,J5,5,1,"div",150),r(88,"div",150)(89,"span",151),l(90,"\u8F49\u5316\u72C0\u614B"),s(),r(91,"span",152),l(92),s()()()()(),r(93,"div",153)(94,"button",154),x("click",function(){v(t);let o=g();return b(o.sendMessage(o.selectedMember()))}),l(95," \u{1F4AC} \u767C\u6D88\u606F "),s(),r(96,"button",8),x("click",function(){v(t);let o=g();return b(o.addToFunnel(o.selectedMember()))}),l(97," \u{1F4E4} \u52A0\u5165\u6F0F\u6597 "),s(),S(98,Q5,2,0,"button",155),s()()}if(i&2){let t=g();c(10),I("has-photo",t.selectedMember().has_photo),c(),D(" ",t.getAvatarLetter(t.selectedMember())," "),c(3),Y(" ",t.selectedMember().first_name," ",t.selectedMember().last_name," "),c(),w(t.selectedMember().is_premium?15:-1),c(),w(t.selectedMember().username?16:-1),c(),de("status-"+t.selectedMember().online_status),c(),Y(" ",t.getStatusIcon(t.selectedMember().online_status)," ",t.getStatusText(t.selectedMember().online_status)," "),c(9),D(" ",t.selectedMember().user_id," "),c(3),w(t.selectedMember().phone?30:-1),c(),w(t.selectedMember().language_code?31:-1),c(5),de("level-"+t.selectedMember().value_level),c(),D(" ",t.selectedMember().value_level," \u7D1A "),c(5),D("",t.selectedMember().activity_score,"/100"),c(5),w(t.selectedMember().is_premium?47:-1),c(),w(t.selectedMember().is_verified?48:-1),c(),w(t.selectedMember().has_photo?49:-1),c(),w(t.isChinese(t.selectedMember())?50:-1),c(),w(t.selectedMember().is_scam?51:-1),c(),w(t.selectedMember().is_deleted?52:-1),c(),w(t.selectedMember().bio?53:-1),c(7),A(t.selectedMember().source_chat_title),c(2),A(t.formatDate(t.selectedMember().extracted_at)),c(),H(t.getGroupsList(t.selectedMember())),c(6),H(t.getMemberTags(t.selectedMember())),c(7),z("ngModel",t.memberNotes),c(8),I("contacted",t.selectedMember().contacted),c(),D(" ",t.selectedMember().contacted?"\u2705 \u5DF2\u806F\u7E6B":"\u{1F4ED} \u672A\u806F\u7E6B"," "),c(),w(t.selectedMember().contacted_at?86:-1),c(),w(t.selectedMember().response_status?87:-1),c(4),I("converted",t.selectedMember().converted),c(),D(" ",t.selectedMember().converted?"\u2705 \u5DF2\u8F49\u5316":"\u23F3 \u5F85\u8F49\u5316"," "),c(6),w(t.selectedMember().contacted?-1:98)}}function X5(i,e){if(i&1){let t=M();r(0,"button",168),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.addSuggestedTag(o))}),l(1),s()}if(i&2){let t=e.$implicit;c(),A(t)}}function Z5(i,e){if(i&1){let t=M();r(0,"div",158),x("click",function(){v(t);let o=g();return b(o.closeAddTagDialog())}),s(),r(1,"div",159)(2,"div",160)(3,"h3"),l(4,"\u6DFB\u52A0\u6A19\u7C64"),s(),r(5,"button",118),x("click",function(){v(t);let o=g();return b(o.closeAddTagDialog())}),l(6,"\u2715"),s()(),r(7,"div",161)(8,"input",162),W("ngModelChange",function(o){v(t);let a=g();return K(a.newTagName,o)||(a.newTagName=o),b(o)}),x("keyup.enter",function(){v(t);let o=g();return b(o.addTag())}),s(),r(9,"div",163)(10,"p",164),l(11,"\u5E38\u7528\u6A19\u7C64\uFF1A"),s(),r(12,"div",165),$(13,X5,2,1,"button",166,Pe),s()()(),r(15,"div",167)(16,"button",8),x("click",function(){v(t);let o=g();return b(o.closeAddTagDialog())}),l(17,"\u53D6\u6D88"),s(),r(18,"button",11),x("click",function(){v(t);let o=g();return b(o.addTag())}),l(19,"\u6DFB\u52A0"),s()()()}if(i&2){let t=g();c(8),z("ngModel",t.newTagName),c(5),H(t.suggestedTags),c(5),V("disabled",!t.newTagName)}}var Xo=class i{constructor(){this.ipcService=O(ye);this.toastService=O(ue);this.sendMessageEvent=Me();this.addToFunnelEvent=Me();this.batchSendMessageEvent=Me();this.members=_([]);this.filteredMembers=_([]);this.isLoading=_(!1);this.stats=_({total:0,online:0,recently:0,premium:0,chinese:0,contacted:0,converted:0,todayNew:0,byValueLevel:{},bySource:[]});this.sourceGroups=_([]);this.searchQuery="";this.selectedSource="";this.selectedOnlineStatus="";this.selectedValueLevel="";this.filterPremium=!1;this.filterChinese=!1;this.filterHasUsername=!1;this.filterNotContacted=!1;this.filterHasPhoto=!1;this.sortField="extracted_at";this.sortDirection="desc";this.currentPage=1;this.pageSize=50;this.selectedMemberIds=_([]);this.selectedMember=_(null);this.memberNotes="";this.showAddTagDialog=_(!1);this.newTagName="";this.suggestedTags=["\u9AD8\u610F\u5411","\u5E63\u5708","DeFi","NFT","\u6295\u8CC7","\u4EA4\u6613","\u91CF\u5316","\u7926\u5DE5","\u958B\u767C\u8005","\u904B\u71DF"];this.showAdvancedMenu=_(!1);this.loadTimeout=null;this.paginatedMembers=G(()=>{let e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.filteredMembers().slice(e,t)});this.totalPages=G(()=>Math.ceil(this.filteredMembers().length/this.pageSize)||1)}ngOnInit(){this.loadMembers(),this.setupEventListeners()}ngOnDestroy(){}setupEventListeners(){this.ipcService.on("extracted-members-list",e=>{console.log("[MemberDatabase] Received extracted-members-list event:",e),this.loadTimeout&&(clearTimeout(this.loadTimeout),this.loadTimeout=null),e.success?(console.log(`[MemberDatabase] Loaded ${e.members?.length||0} members`),this.members.set(e.members||[]),this.applyFilters(),this.calculateStats(),this.isLoading.set(!1)):(console.error("[MemberDatabase] Load failed:",e.error),this.toastService.error(`\u8F09\u5165\u5931\u6557: ${e.error}`),this.isLoading.set(!1))}),this.ipcService.on("member-stats",e=>{e.success&&this.stats.update(t=>F(F({},t),e))})}loadMembers(){console.log("[MemberDatabase] loadMembers called"),this.isLoading.set(!0),this.loadTimeout&&clearTimeout(this.loadTimeout),this.loadTimeout=setTimeout(()=>{this.isLoading()&&(console.warn("[MemberDatabase] Load timeout after 15 seconds"),this.isLoading.set(!1),this.toastService.error("\u8F09\u5165\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66"))},15e3),console.log("[MemberDatabase] Sending get-extracted-members request"),this.ipcService.send("get-extracted-members",{limit:500,offset:0})}refreshMembers(){this.loadMembers(),this.toastService.info("\u6B63\u5728\u5237\u65B0\u6578\u64DA...")}onSearchChange(e){this.searchQuery=e,this.applyFilters()}clearSearch(){this.searchQuery="",this.applyFilters()}applyFilters(){let e=[...this.members()];if(this.searchQuery){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.user_id.includes(t)||n.username?.toLowerCase().includes(t)||n.first_name?.toLowerCase().includes(t)||n.last_name?.toLowerCase().includes(t))}this.selectedSource&&(e=e.filter(t=>t.source_chat_id===this.selectedSource)),this.selectedOnlineStatus&&(e=e.filter(t=>t.online_status===this.selectedOnlineStatus)),this.selectedValueLevel&&(e=e.filter(t=>t.value_level===this.selectedValueLevel)),this.filterPremium&&(e=e.filter(t=>t.is_premium)),this.filterChinese&&(e=e.filter(t=>this.isChinese(t))),this.filterHasUsername&&(e=e.filter(t=>t.username)),this.filterNotContacted&&(e=e.filter(t=>!t.contacted)),this.filterHasPhoto&&(e=e.filter(t=>t.has_photo)),e.sort((t,n)=>{let o=t[this.sortField],a=n[this.sortField];return typeof o=="string"&&(o=o.toLowerCase()),typeof a=="string"&&(a=a.toLowerCase()),o<a?this.sortDirection==="asc"?-1:1:o>a?this.sortDirection==="asc"?1:-1:0}),this.filteredMembers.set(e),this.currentPage=1}hasActiveFilters(){return!!(this.searchQuery||this.selectedSource||this.selectedOnlineStatus||this.selectedValueLevel||this.filterPremium||this.filterChinese||this.filterHasUsername||this.filterNotContacted||this.filterHasPhoto)}clearFilters(){this.searchQuery="",this.selectedSource="",this.selectedOnlineStatus="",this.selectedValueLevel="",this.filterPremium=!1,this.filterChinese=!1,this.filterHasUsername=!1,this.filterNotContacted=!1,this.filterHasPhoto=!1,this.applyFilters()}sortBy(e){this.sortField===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=e,this.sortDirection="asc"),this.applyFilters()}getPageStart(){return(this.currentPage-1)*this.pageSize+1}getPageEnd(){return Math.min(this.currentPage*this.pageSize,this.filteredMembers().length)}goToPage(e){e>=1&&e<=this.totalPages()&&(this.currentPage=e)}onPageSizeChange(){this.currentPage=1}isAllSelected(){return this.paginatedMembers().length>0&&this.paginatedMembers().every(e=>this.selectedMemberIds().includes(e.user_id))}isPartialSelected(){let e=this.paginatedMembers().filter(t=>this.selectedMemberIds().includes(t.user_id));return e.length>0&&e.length<this.paginatedMembers().length}toggleSelectAll(){if(this.isAllSelected()){let e=this.paginatedMembers().map(t=>t.user_id);this.selectedMemberIds.update(t=>t.filter(n=>!e.includes(n)))}else{let e=this.paginatedMembers().map(t=>t.user_id);this.selectedMemberIds.update(t=>[...new Set([...t,...e])])}}isMemberSelected(e){return this.selectedMemberIds().includes(e)}toggleMemberSelection(e){this.selectedMemberIds.update(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])}clearSelection(){this.selectedMemberIds.set([])}calculateStats(){let e=this.members(),t=new Date().toDateString(),n={total:e.length,online:e.filter(a=>a.online_status==="online").length,recently:e.filter(a=>a.online_status==="recently").length,premium:e.filter(a=>a.is_premium).length,chinese:e.filter(a=>this.isChinese(a)).length,contacted:e.filter(a=>a.contacted).length,converted:e.filter(a=>a.converted).length,todayNew:e.filter(a=>new Date(a.created_at).toDateString()===t).length,byValueLevel:{},bySource:[]},o=new Map;e.forEach(a=>{if(a.source_chat_id){let d=o.get(a.source_chat_id);d?d.count++:o.set(a.source_chat_id,{title:a.source_chat_title||a.source_chat_id,count:1})}}),this.sourceGroups.set(Array.from(o.entries()).map(([a,d])=>({group:a,title:d.title,count:d.count})).sort((a,d)=>d.count-a.count)),this.stats.set(n)}getOnlinePercent(){let e=this.stats().total;return e>0?(this.stats().online/e*100).toFixed(1):"0"}getPremiumPercent(){let e=this.stats().total;return e>0?(this.stats().premium/e*100).toFixed(1):"0"}getChinesePercent(){let e=this.stats().total;return e>0?(this.stats().chinese/e*100).toFixed(1):"0"}getContactedPercent(){let e=this.stats().total;return e>0?(this.stats().contacted/e*100).toFixed(1):"0"}getConvertedPercent(){let e=this.stats().contacted;return e>0?(this.stats().converted/e*100).toFixed(1):"0"}getAvatarLetter(e){return(e.first_name||e.username||"?").charAt(0).toUpperCase()}getStatusIcon(e){switch(e){case"online":return"\u{1F7E2}";case"recently":return"\u{1F7E1}";case"last_week":return"\u{1F7E0}";case"last_month":return"\u26AA";default:return"\u26AA"}}getStatusText(e){switch(e){case"online":return"\u5728\u7DDA";case"recently":return"\u6700\u8FD1";case"last_week":return"\u672C\u9031";case"last_month":return"\u672C\u6708";case"long_ago":return"\u96E2\u7DDA";default:return"\u672A\u77E5"}}isChinese(e){let t=(e.first_name||"")+(e.last_name||""),n=e.bio||"",o=/[\u4e00-\u9fff]/;return o.test(t)||o.test(n)}getMemberTags(e){if(!e.tags)return[];try{return JSON.parse(e.tags)}catch{return[]}}getGroupsList(e){if(!e.groups)return[];try{return JSON.parse(e.groups)}catch{return[]}}formatDate(e){if(!e)return"-";try{return new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return e}}copyToClipboard(e){navigator.clipboard.writeText(e),this.toastService.success("\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u677F")}openMemberDetail(e){this.selectedMember.set(e),this.memberNotes=e.notes||""}closeMemberDetail(){this.selectedMember.set(null),this.memberNotes=""}saveMemberNotes(){let e=this.selectedMember();e&&(this.ipcService.send("update-member",{userId:e.user_id,updates:{notes:this.memberNotes}}),this.members.update(t=>t.map(n=>n.user_id===e.user_id?B(F({},n),{notes:this.memberNotes}):n)))}openAddTagDialog(){this.showAddTagDialog.set(!0),this.newTagName=""}closeAddTagDialog(){this.showAddTagDialog.set(!1),this.newTagName=""}addTag(){if(!this.newTagName.trim())return;let e=this.selectedMember();if(!e)return;let t=this.getMemberTags(e);t.includes(this.newTagName)||(t.push(this.newTagName),this.ipcService.send("update-member",{userId:e.user_id,updates:{tags:JSON.stringify(t)}}),this.members.update(n=>n.map(o=>o.user_id===e.user_id?B(F({},o),{tags:JSON.stringify(t)}):o)),this.selectedMember.update(n=>n?B(F({},n),{tags:JSON.stringify(t)}):null)),this.closeAddTagDialog()}addSuggestedTag(e){this.newTagName=e,this.addTag()}removeTag(e,t){let n=this.getMemberTags(e).filter(o=>o!==t);this.ipcService.send("update-member",{userId:e.user_id,updates:{tags:JSON.stringify(n)}}),this.members.update(o=>o.map(a=>a.user_id===e.user_id?B(F({},a),{tags:JSON.stringify(n)}):a)),this.selectedMember.update(o=>o?B(F({},o),{tags:JSON.stringify(n)}):null)}sendMessage(e){this.sendMessageEvent.emit(e)}addToFunnel(e){this.addToFunnelEvent.emit(e)}markAsContacted(e){this.ipcService.send("update-member",{userId:e.user_id,updates:{contacted:!0,contacted_at:new Date().toISOString()}}),this.members.update(t=>t.map(n=>n.user_id===e.user_id?B(F({},n),{contacted:!0,contacted_at:new Date().toISOString()}):n)),this.selectedMember.update(t=>t?B(F({},t),{contacted:!0,contacted_at:new Date().toISOString()}):null),this.calculateStats(),this.toastService.success("\u5DF2\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B")}batchSendMessage(){let e=this.members().filter(t=>this.selectedMemberIds().includes(t.user_id));e.length>0&&this.batchSendMessageEvent.emit(e)}batchAddTags(){this.toastService.info("\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64\u529F\u80FD\u958B\u767C\u4E2D...")}batchMarkContacted(){let e=this.selectedMemberIds(),t=new Date().toISOString();e.forEach(n=>{this.ipcService.send("update-member",{userId:n,updates:{contacted:!0,contacted_at:t}})}),this.members.update(n=>n.map(o=>e.includes(o.user_id)?B(F({},o),{contacted:!0,contacted_at:t}):o)),this.calculateStats(),this.applyFilters(),this.clearSelection(),this.toastService.success(`\u5DF2\u5C07 ${e.length} \u500B\u6210\u54E1\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B`)}batchExport(){let e=this.selectedMemberIds(),t=this.members().filter(n=>e.includes(n.user_id));this.exportMembersToCSV(t)}exportMembers(){this.exportMembersToCSV(this.filteredMembers())}exportMembersToCSV(e){let t=["Telegram ID","\u7528\u6236\u540D","\u59D3","\u540D","\u96FB\u8A71","\u7C21\u4ECB","\u8A9E\u8A00","Premium","\u5DF2\u9A57\u8B49","\u6709\u982D\u50CF","\u5728\u7DDA\u72C0\u614B","\u6700\u5F8C\u5728\u7DDA","\u6D3B\u8E8D\u5206\u6578","\u50F9\u503C\u7B49\u7D1A","\u4F86\u6E90\u7FA4\u7D44","\u4F86\u6E90\u7FA4\u7D44ID","\u63D0\u53D6\u6642\u9593","\u6A19\u7C64","\u5099\u8A3B","\u5DF2\u806F\u7E6B","\u806F\u7E6B\u6642\u9593","\u5DF2\u8F49\u5316"],n=e.map(h=>[h.user_id,h.username||"",h.last_name||"",h.first_name||"",h.phone||"",h.bio||"",h.language_code||"",h.is_premium?"\u662F":"\u5426",h.is_verified?"\u662F":"\u5426",h.has_photo?"\u662F":"\u5426",this.getStatusText(h.online_status),h.last_online||"",h.activity_score?.toString()||"",h.value_level||"",h.source_chat_title||"",h.source_chat_id||"",h.extracted_at||"",this.getMemberTags(h).join("; "),h.notes||"",h.contacted?"\u662F":"\u5426",h.contacted_at||"",h.converted?"\u662F":"\u5426"]),o=h=>h.includes(",")||h.includes('"')||h.includes(`
`)?`"${h.replace(/"/g,'""')}"`:h,a=[t,...n].map(h=>h.map(o).join(",")).join(`
`),d=new Blob(["\uFEFF"+a],{type:"text/csv;charset=utf-8"}),m=URL.createObjectURL(d),f=document.createElement("a");f.href=m,f.download=`members_${new Date().toISOString().slice(0,10)}.csv`,f.click(),URL.revokeObjectURL(m),this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}deduplicateMembers(){this.toastService.info("\u{1F504} \u6B63\u5728\u57F7\u884C\u667A\u80FD\u53BB\u91CD..."),this.ipcService.send("deduplicate-members",{});let e=this.ipcService.on("members-deduplicated",t=>{e(),t.success?(this.toastService.success(`\u2705 \u53BB\u91CD\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${t.mergedCount||0} \u500B\u91CD\u8907\u6210\u54E1`),this.loadMembers()):this.toastService.error(`\u53BB\u91CD\u5931\u6557: ${t.error}`)})}recalculateScores(){this.toastService.info("\u{1F4CA} \u6B63\u5728\u91CD\u65B0\u8A08\u7B97\u8A55\u5206..."),this.ipcService.send("recalculate-scores",{});let e=this.ipcService.on("scores-recalculated",t=>{e(),t.success?(this.toastService.success(`\u2705 \u8A55\u5206\u8A08\u7B97\u5B8C\u6210\uFF01\u66F4\u65B0\u4E86 ${t.updatedCount||0} \u500B\u6210\u54E1`),this.loadMembers()):this.toastService.error(`\u8A08\u7B97\u5931\u6557: ${t.error}`)})}showGroupProfile(){if(!this.selectedSource){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u4F86\u6E90\u7FA4\u7D44");return}this.toastService.info("\u{1F4C8} \u6B63\u5728\u751F\u6210\u7FA4\u7D44\u756B\u50CF..."),this.ipcService.send("get-group-profile",{chatId:this.selectedSource});let e=this.ipcService.on("group-profile-result",t=>{if(e(),t.success&&t.profile){let n=t.profile;this.toastService.success(`
          \u{1F4CA} \u7FA4\u7D44\u756B\u50CF\uFF1A
          \u8CEA\u91CF\u5206\u6578: ${n.qualityScore}/100
          \u7E3D\u6210\u54E1: ${n.totalMembers}
          Premium: ${n.premiumRate}%
          \u6D3B\u8E8D\u7387: ${n.activeRate}%
        `.trim())}else this.toastService.error(`\u7372\u53D6\u756B\u50CF\u5931\u6557: ${t.error}`)})}compareGroups(){let e=this.sourceGroups();if(e.length<2){this.toastService.warning("\u9700\u8981\u81F3\u5C112\u500B\u7FA4\u7D44\u624D\u80FD\u9032\u884C\u5C0D\u6BD4");return}let t=e.slice(0,5).map(o=>o.group);this.toastService.info("\u{1F4CA} \u6B63\u5728\u5C0D\u6BD4\u7FA4\u7D44..."),this.ipcService.send("compare-groups",{chatIds:t});let n=this.ipcService.on("groups-compared",o=>{if(n(),o.success&&o.comparison){let a=o.comparison;this.toastService.success(`
          \u{1F4CA} \u7FA4\u7D44\u5C0D\u6BD4\u5B8C\u6210\uFF01
          \u6700\u9AD8\u8CEA\u91CF: ${a.bestGroup?.name||"\u672A\u77E5"}
          \u5E73\u5747\u8CEA\u91CF: ${a.avgQuality}/100
          \u5C0D\u6BD4\u7FA4\u7D44\u6578: ${a.groupCount}
        `.trim())}else this.toastService.error(`\u5C0D\u6BD4\u5931\u6557: ${o.error}`)})}viewExtractionStats(){this.toastService.info("\u{1F4C9} \u6B63\u5728\u7372\u53D6\u63D0\u53D6\u7D71\u8A08..."),this.ipcService.send("get-extraction-stats",{});let e=this.ipcService.on("extraction-stats-result",t=>{if(e(),t.success&&t.stats){let n=t.stats;this.toastService.success(`
          \u{1F4C9} \u63D0\u53D6\u7D71\u8A08\uFF1A
          \u6210\u529F\u7387: ${n.successRate}%
          \u7E3D\u63D0\u53D6: ${n.totalExtractions}
          \u6210\u529F: ${n.successCount}
          \u5931\u6557: ${n.failedCount}
        `.trim())}else this.toastService.error(`\u7372\u53D6\u7D71\u8A08\u5931\u6557: ${t.error}`)})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-member-database"]],outputs:{sendMessageEvent:"sendMessageEvent",addToFunnelEvent:"addToFunnelEvent",batchSendMessageEvent:"batchSendMessageEvent"},decls:156,vars:47,consts:[[1,"member-database-container"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"relative","inline-block",2,"position","relative"],[1,"btn-secondary",3,"click"],[1,"absolute","right-0","mt-2","w-56","bg-slate-800","rounded-xl","shadow-xl","border","border-slate-700","py-2","z-50",2,"position","absolute","right","0","margin-top","8px","width","240px"],[1,"btn-secondary",3,"click","disabled"],[1,"btn-primary",3,"click","disabled"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-value"],[1,"stat-label"],[1,"stat-badge","success"],[1,"stat-card","online"],[1,"stat-percent"],[1,"stat-card","premium"],[1,"stat-card","chinese"],[1,"stat-card","contacted"],[1,"stat-card","converted"],[1,"filter-section"],[1,"filter-row"],[1,"search-box"],[1,"search-icon"],["type","text","placeholder","\u641C\u7D22\u59D3\u540D\u3001\u7528\u6236\u540D\u3001ID...",1,"search-input",3,"ngModelChange","ngModel"],[1,"search-clear"],[1,"filter-select",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["value","online"],["value","recently"],["value","last_week"],["value","long_ago"],["value","S"],["value","A"],["value","B"],["value","C"],["value","D"],[1,"filter-checkbox"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"btn-text"],[1,"filter-result"],[1,"member-list-section"],[1,"loading-state"],[1,"empty-state"],[1,"w-full","px-4","py-2","text-left","hover:bg-slate-700","flex","items-center","gap-2",2,"display","flex","align-items","center","padding","8px 16px",3,"click"],[1,"ml-auto","text-xs","text-slate-400",2,"margin-left","auto","font-size","11px","color","#94a3b8"],[1,"border-t","border-slate-700","my-1",2,"border-top","1px solid #334155","margin","4px 0"],[1,"search-clear",3,"click"],[1,"btn-text",3,"click"],[1,"loading-spinner"],[1,"empty-icon"],[1,"batch-action-bar"],[1,"member-table-container"],[1,"member-table"],[1,"col-checkbox"],["type","checkbox",3,"change","checked","indeterminate"],[1,"col-id",3,"click"],[1,"col-user",3,"click"],[1,"col-username"],[1,"col-status",3,"click"],[1,"col-level",3,"click"],[1,"col-source"],[1,"col-tags"],[1,"col-contacted"],[1,"col-actions"],[3,"selected"],[1,"pagination"],[1,"page-info"],[1,"page-controls"],[1,"page-btn",3,"click","disabled"],[1,"page-number"],[1,"page-size-select",3,"ngModelChange","ngModel"],[1,"selected-count"],[1,"batch-actions"],[1,"btn-batch",3,"click"],[1,"btn-batch","danger",3,"click"],[3,"click"],[1,"col-checkbox",3,"click"],["type","checkbox",3,"change","checked"],[1,"col-id"],[1,"user-id",3,"title"],[1,"col-user"],[1,"user-info"],[1,"user-avatar"],[1,"user-name-wrapper"],[1,"user-name"],["title","Premium",1,"premium-badge"],["title","\u5DF2\u9A57\u8B49",1,"verified-badge"],["title","\u83EF\u4EBA",1,"chinese-badge"],[1,"user-bio",3,"title"],["target","_blank",1,"username-link",3,"href"],[1,"no-username"],[1,"col-status"],[1,"status-badge"],[1,"col-level"],[1,"level-badge"],[1,"source-name",3,"title"],[1,"tags-container"],[1,"no-tags"],[1,"contacted-badge","yes"],[1,"contacted-badge","no"],[1,"col-actions",3,"click"],[1,"action-buttons"],["title","\u767C\u6D88\u606F",1,"action-btn",3,"click"],["title","\u52A0\u5165\u6F0F\u6597",1,"action-btn",3,"click"],["title","\u67E5\u770B\u8A73\u60C5",1,"action-btn",3,"click"],["target","_blank",1,"username-link",3,"click","href"],[1,"tag"],[1,"tag-more"],[1,"member-detail-overlay",3,"click"],[1,"member-detail-drawer"],[1,"drawer-header"],[1,"close-btn",3,"click"],[1,"drawer-content"],[1,"detail-section"],[1,"member-profile"],[1,"profile-avatar"],[1,"profile-info"],[1,"profile-name"],[1,"premium-badge"],["target","_blank",1,"profile-username",3,"href"],[1,"section-title"],[1,"detail-grid"],[1,"detail-item"],[1,"detail-label"],[1,"detail-value","copyable",3,"click"],[1,"copy-icon"],[1,"detail-value"],[1,"status-tags"],[1,"status-tag","premium"],[1,"status-tag","verified"],[1,"status-tag","photo"],[1,"status-tag","chinese"],[1,"status-tag","danger"],[1,"status-tag","deleted"],[1,"source-list"],[1,"source-item"],[1,"source-name"],[1,"source-date"],[1,"tags-edit"],[1,"tag","editable"],[1,"add-tag-btn",3,"click"],["placeholder","\u6DFB\u52A0\u8DDF\u9032\u5099\u8A3B...",1,"notes-textarea",3,"ngModelChange","blur","ngModel"],[1,"marketing-status"],[1,"status-item"],[1,"status-label"],[1,"status-value"],[1,"drawer-footer"],[1,"btn-primary",3,"click"],[1,"btn-secondary"],[1,"bio-text"],[1,"tag-remove",3,"click"],[1,"dialog-overlay",3,"click"],[1,"dialog"],[1,"dialog-header"],[1,"dialog-content"],["type","text","placeholder","\u8F38\u5165\u6A19\u7C64\u540D\u7A31...",1,"tag-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"suggested-tags"],[1,"suggested-title"],[1,"suggested-list"],[1,"suggested-tag"],[1,"dialog-footer"],[1,"suggested-tag",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u{1F4C1}"),s(),l(6," \u6210\u54E1\u8CC7\u6599\u5EAB "),s(),r(7,"p",5),l(8,"\u7BA1\u7406\u548C\u5206\u6790\u63D0\u53D6\u7684 Telegram \u6210\u54E1\u6578\u64DA"),s()(),r(9,"div",6)(10,"div",7)(11,"button",8),x("click",function(){return n.showAdvancedMenu.set(!n.showAdvancedMenu())}),l(12," \u{1F6E0}\uFE0F \u9AD8\u7D1A\u5DE5\u5177 \u25BE "),s(),S(13,a5,23,0,"div",9),s(),r(14,"button",10),x("click",function(){return n.refreshMembers()}),r(15,"span"),l(16,"\u{1F504}"),s(),l(17),s(),r(18,"button",11),x("click",function(){return n.exportMembers()}),l(19," \u{1F4E5} \u5C0E\u51FA CSV "),s()()(),r(20,"div",12)(21,"div",13)(22,"div",14),l(23,"\u{1F465}"),s(),r(24,"div",15)(25,"div",16),l(26),ke(27,"number"),s(),r(28,"div",17),l(29,"\u7E3D\u6210\u54E1\u6578"),s()(),S(30,l5,2,1,"div",18),s(),r(31,"div",19)(32,"div",14),l(33,"\u{1F7E2}"),s(),r(34,"div",15)(35,"div",16),l(36),ke(37,"number"),s(),r(38,"div",17),l(39,"\u5728\u7DDA\u6210\u54E1"),s()(),r(40,"div",20),l(41),s()(),r(42,"div",21)(43,"div",14),l(44,"\u2B50"),s(),r(45,"div",15)(46,"div",16),l(47),ke(48,"number"),s(),r(49,"div",17),l(50,"Premium \u7528\u6236"),s()(),r(51,"div",20),l(52),s()(),r(53,"div",22)(54,"div",14),l(55,"\u{1F1E8}\u{1F1F3}"),s(),r(56,"div",15)(57,"div",16),l(58),ke(59,"number"),s(),r(60,"div",17),l(61,"\u83EF\u4EBA\u6210\u54E1"),s()(),r(62,"div",20),l(63),s()(),r(64,"div",23)(65,"div",14),l(66,"\u{1F4AC}"),s(),r(67,"div",15)(68,"div",16),l(69),ke(70,"number"),s(),r(71,"div",17),l(72,"\u5DF2\u806F\u7E6B"),s()(),r(73,"div",20),l(74),s()(),r(75,"div",24)(76,"div",14),l(77,"\u2705"),s(),r(78,"div",15)(79,"div",16),l(80),ke(81,"number"),s(),r(82,"div",17),l(83,"\u5DF2\u8F49\u5316"),s()(),r(84,"div",20),l(85),s()()(),r(86,"div",25)(87,"div",26)(88,"div",27)(89,"span",28),l(90,"\u{1F50D}"),s(),r(91,"input",29),W("ngModelChange",function(a){return K(n.searchQuery,a)||(n.searchQuery=a),a}),x("ngModelChange",function(a){return n.onSearchChange(a)}),s(),S(92,c5,2,0,"button",30),s(),r(93,"select",31),W("ngModelChange",function(a){return K(n.selectedSource,a)||(n.selectedSource=a),a}),x("ngModelChange",function(){return n.applyFilters()}),r(94,"option",32),l(95,"\u6240\u6709\u4F86\u6E90\u7FA4\u7D44"),s(),$(96,d5,2,3,"option",33,r5),s(),r(98,"select",31),W("ngModelChange",function(a){return K(n.selectedOnlineStatus,a)||(n.selectedOnlineStatus=a),a}),x("ngModelChange",function(){return n.applyFilters()}),r(99,"option",32),l(100,"\u6240\u6709\u72C0\u614B"),s(),r(101,"option",34),l(102,"\u{1F7E2} \u5728\u7DDA"),s(),r(103,"option",35),l(104,"\u{1F7E1} \u6700\u8FD1\u4E0A\u7DDA"),s(),r(105,"option",36),l(106,"\u{1F7E0} \u672C\u9031\u4E0A\u7DDA"),s(),r(107,"option",37),l(108,"\u26AA \u9577\u671F\u96E2\u7DDA"),s()(),r(109,"select",31),W("ngModelChange",function(a){return K(n.selectedValueLevel,a)||(n.selectedValueLevel=a),a}),x("ngModelChange",function(){return n.applyFilters()}),r(110,"option",32),l(111,"\u6240\u6709\u7B49\u7D1A"),s(),r(112,"option",38),l(113,"S \u7D1A - \u9802\u7D1A"),s(),r(114,"option",39),l(115,"A \u7D1A - \u512A\u8CEA"),s(),r(116,"option",40),l(117,"B \u7D1A - \u666E\u901A"),s(),r(118,"option",41),l(119,"C \u7D1A - \u4E00\u822C"),s(),r(120,"option",42),l(121,"D \u7D1A - \u4F4E\u50F9\u503C"),s()()(),r(122,"div",26)(123,"label",43)(124,"input",44),W("ngModelChange",function(a){return K(n.filterPremium,a)||(n.filterPremium=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(125,"span"),l(126,"\u2B50 Premium"),s()(),r(127,"label",43)(128,"input",44),W("ngModelChange",function(a){return K(n.filterChinese,a)||(n.filterChinese=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(129,"span"),l(130,"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA"),s()(),r(131,"label",43)(132,"input",44),W("ngModelChange",function(a){return K(n.filterHasUsername,a)||(n.filterHasUsername=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(133,"span"),l(134,"\u{1F4DB} \u6709\u7528\u6236\u540D"),s()(),r(135,"label",43)(136,"input",44),W("ngModelChange",function(a){return K(n.filterNotContacted,a)||(n.filterNotContacted=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(137,"span"),l(138,"\u{1F4ED} \u672A\u806F\u7E6B"),s()(),r(139,"label",43)(140,"input",44),W("ngModelChange",function(a){return K(n.filterHasPhoto,a)||(n.filterHasPhoto=a),a}),x("ngModelChange",function(){return n.applyFilters()}),s(),r(141,"span"),l(142,"\u{1F4F7} \u6709\u982D\u50CF"),s()(),S(143,u5,2,0,"button",45),r(144,"div",46),l(145," \u627E\u5230 "),r(146,"strong"),l(147),ke(148,"number"),s(),l(149," \u500B\u6210\u54E1 "),s()()(),r(150,"div",47),S(151,m5,4,0,"div",48)(152,p5,7,0,"div",49)(153,P5,55,21),s(),S(154,Y5,99,37),S(155,Z5,20,2),s()),t&2&&(c(13),w(n.showAdvancedMenu()?13:-1),c(),V("disabled",n.isLoading()),c(),I("animate-spin",n.isLoading()),c(2),D(" ",n.isLoading()?"\u8F09\u5165\u4E2D...":"\u5237\u65B0"," "),c(),V("disabled",n.filteredMembers().length===0),c(8),A(Ne(27,33,n.stats().total)),c(4),w(n.stats().todayNew>0?30:-1),c(6),A(Ne(37,35,n.stats().online)),c(5),D("",n.getOnlinePercent(),"%"),c(6),A(Ne(48,37,n.stats().premium)),c(5),D("",n.getPremiumPercent(),"%"),c(6),A(Ne(59,39,n.stats().chinese)),c(5),D("",n.getChinesePercent(),"%"),c(6),A(Ne(70,41,n.stats().contacted)),c(5),D("",n.getContactedPercent(),"%"),c(6),A(Ne(81,43,n.stats().converted)),c(5),D("",n.getConvertedPercent(),"%"),c(6),z("ngModel",n.searchQuery),c(),w(n.searchQuery?92:-1),c(),z("ngModel",n.selectedSource),c(3),H(n.sourceGroups()),c(2),z("ngModel",n.selectedOnlineStatus),c(11),z("ngModel",n.selectedValueLevel),c(15),z("ngModel",n.filterPremium),c(4),z("ngModel",n.filterChinese),c(4),z("ngModel",n.filterHasUsername),c(4),z("ngModel",n.filterNotContacted),c(4),z("ngModel",n.filterHasPhoto),c(3),w(n.hasActiveFilters()?143:-1),c(4),A(Ne(148,45,n.filteredMembers().length)),c(4),w(n.isLoading()?151:n.filteredMembers().length===0?152:153),c(3),w(n.selectedMember()?154:-1),c(),w(n.showAddTagDialog()?155:-1))},dependencies:[te,me,Qe,Ye,xe,nn,lt,_e,Ce,tn],styles:[".member-database-container[_ngcontent-%COMP%]{padding:1.5rem;height:100%;overflow-y:auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#fff;display:flex;align-items:center;gap:.5rem;margin:0}.title-icon[_ngcontent-%COMP%]{font-size:1.75rem}.page-desc[_ngcontent-%COMP%]{color:#94a3b8;margin:.25rem 0 0;font-size:.875rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.btn-primary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#06b6d4,#3b82f6);border:none;border-radius:.5rem;color:#fff;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .2s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #06b6d44d}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#47556980;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#e2e8f0;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .2s}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#475569b3;border-color:#94a3b84d}.btn-secondary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-text[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:none;color:#94a3b8;cursor:pointer;font-size:.875rem}.btn-text[_ngcontent-%COMP%]:hover{color:#f87171}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{background:#1e293bcc;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;padding:1rem;display:flex;align-items:center;gap:.75rem;position:relative}.stat-icon[_ngcontent-%COMP%]{font-size:1.5rem}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:.75rem;color:#94a3b8}.stat-badge[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem;padding:.125rem .375rem;border-radius:.25rem;font-size:.625rem;font-weight:600}.stat-badge.success[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.stat-percent[_ngcontent-%COMP%]{font-size:.875rem;color:#94a3b8}.stat-card.online[_ngcontent-%COMP%]{border-left:3px solid #22c55e}.stat-card.premium[_ngcontent-%COMP%]{border-left:3px solid #f59e0b}.stat-card.chinese[_ngcontent-%COMP%]{border-left:3px solid #ef4444}.stat-card.contacted[_ngcontent-%COMP%]{border-left:3px solid #3b82f6}.stat-card.converted[_ngcontent-%COMP%]{border-left:3px solid #8b5cf6}.filter-section[_ngcontent-%COMP%]{background:#1e293b99;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;padding:1rem;margin-bottom:1rem}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:.75rem;margin-bottom:.75rem}.filter-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.search-box[_ngcontent-%COMP%]{position:relative;flex:1;min-width:200px;max-width:300px}.search-icon[_ngcontent-%COMP%]{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);font-size:.875rem}.search-input[_ngcontent-%COMP%]{width:100%;padding:.5rem 2rem .5rem 2.25rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.search-clear[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;color:#94a3b8;cursor:pointer;font-size:.75rem}.filter-select[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;min-width:140px}.filter-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.filter-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;padding:.375rem .75rem;background:#0f172a4d;border:1px solid rgba(148,163,184,.15);border-radius:.5rem;color:#e2e8f0;font-size:.8rem;cursor:pointer;transition:all .2s}.filter-checkbox[_ngcontent-%COMP%]:hover{background:#0f172a80;border-color:#94a3b840}.filter-checkbox[_ngcontent-%COMP%]:has(input:checked){background:#06b6d426;border-color:#06b6d466}.filter-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0}.filter-result[_ngcontent-%COMP%]{margin-left:auto;color:#94a3b8;font-size:.875rem}.member-list-section[_ngcontent-%COMP%]{background:#1e293b99;border:1px solid rgba(148,163,184,.1);border-radius:.75rem;overflow:hidden}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:#94a3b8}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(6,182,212,.2);border-top-color:#06b6d4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;margin:0 0 .5rem}.batch-action-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;background:#06b6d41a;border-bottom:1px solid rgba(6,182,212,.2)}.selected-count[_ngcontent-%COMP%]{color:#22d3ee;font-weight:500}.batch-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.btn-batch[_ngcontent-%COMP%]{padding:.375rem .75rem;background:#1e293bcc;border:1px solid rgba(148,163,184,.2);border-radius:.375rem;color:#e2e8f0;font-size:.8rem;cursor:pointer;transition:all .2s}.btn-batch[_ngcontent-%COMP%]:hover{background:#334155cc}.btn-batch.danger[_ngcontent-%COMP%]{color:#f87171}.btn-batch.danger[_ngcontent-%COMP%]:hover{background:#ef444433}.member-table-container[_ngcontent-%COMP%]{overflow-x:auto}.member-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:left;background:#0f172a80;color:#94a3b8;font-weight:500;border-bottom:1px solid rgba(148,163,184,.1);cursor:pointer;-webkit-user-select:none;user-select:none;white-space:nowrap}.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover{background:#0f172ab3}.member-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;border-bottom:1px solid rgba(148,163,184,.05);color:#e2e8f0}.member-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s}.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#3341554d}.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background:#06b6d41a}.col-checkbox[_ngcontent-%COMP%]{width:40px}.col-id[_ngcontent-%COMP%]{width:120px}.col-user[_ngcontent-%COMP%]{min-width:180px}.col-username[_ngcontent-%COMP%]{width:120px}.col-status[_ngcontent-%COMP%]{width:100px}.col-level[_ngcontent-%COMP%]{width:60px}.col-source[_ngcontent-%COMP%]{width:150px}.col-tags[_ngcontent-%COMP%]{width:120px}.col-contacted[_ngcontent-%COMP%], .col-actions[_ngcontent-%COMP%]{width:100px}.user-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:#94a3b8}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#475569,#334155);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:500;font-size:.875rem}.user-avatar.has-photo[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.user-name-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.premium-badge[_ngcontent-%COMP%], .verified-badge[_ngcontent-%COMP%], .chinese-badge[_ngcontent-%COMP%]{font-size:.75rem}.user-bio[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.username-link[_ngcontent-%COMP%]{color:#22d3ee;text-decoration:none}.username-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.no-username[_ngcontent-%COMP%], .no-tags[_ngcontent-%COMP%]{color:#475569}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.status-badge.status-online[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.status-badge.status-recently[_ngcontent-%COMP%]{background:#eab30833;color:#fde047}.status-badge.status-last_week[_ngcontent-%COMP%]{background:#f9731633;color:#fdba74}.status-badge.status-last_month[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.status-badge.status-long_ago[_ngcontent-%COMP%], .status-badge.status-unknown[_ngcontent-%COMP%]{background:#47556933;color:#64748b}.level-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;font-size:.75rem;font-weight:600}.level-badge.level-S[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.level-badge.level-A[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff}.level-badge.level-B[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.level-badge.level-C[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.level-badge.level-D[_ngcontent-%COMP%]{background:#47556980;color:#94a3b8}.source-name[_ngcontent-%COMP%]{max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block}.tags-container[_ngcontent-%COMP%]{display:flex;gap:.25rem;flex-wrap:wrap}.tag[_ngcontent-%COMP%]{padding:.125rem .375rem;background:#3b82f633;border-radius:.25rem;font-size:.7rem;color:#93c5fd}.tag-more[_ngcontent-%COMP%]{padding:.125rem .375rem;background:#4755694d;border-radius:.25rem;font-size:.7rem;color:#94a3b8}.contacted-badge[_ngcontent-%COMP%]{font-size:.75rem}.contacted-badge.yes[_ngcontent-%COMP%]{color:#86efac}.contacted-badge.no[_ngcontent-%COMP%]{color:#94a3b8}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem}.action-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;font-size:.875rem;cursor:pointer;transition:all .2s}.action-btn[_ngcontent-%COMP%]:hover{background:#475569b3}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:#0f172a4d;border-top:1px solid rgba(148,163,184,.1)}.page-info[_ngcontent-%COMP%]{color:#94a3b8;font-size:.875rem}.page-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.page-btn[_ngcontent-%COMP%]{padding:.375rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;font-size:.75rem;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#475569b3}.page-number[_ngcontent-%COMP%]{color:#fff;font-size:.875rem;padding:0 .5rem}.page-size-select[_ngcontent-%COMP%]{padding:.375rem .5rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;color:#fff;font-size:.75rem}.member-detail-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:100}.member-detail-drawer[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:400px;max-width:90vw;height:100vh;background:#1e293b;border-left:1px solid rgba(148,163,184,.1);z-index:101;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%)}to{transform:translate(0)}}.drawer-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.25rem;border-bottom:1px solid rgba(148,163,184,.1)}.drawer-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;color:#fff}.close-btn[_ngcontent-%COMP%]{padding:.375rem;background:#47556980;border:none;border-radius:.375rem;color:#94a3b8;cursor:pointer;font-size:1rem}.close-btn[_ngcontent-%COMP%]:hover{background:#475569cc;color:#fff}.drawer-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.25rem}.detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.section-title[_ngcontent-%COMP%]{font-size:.875rem;color:#94a3b8;margin:0 0 .75rem;display:flex;align-items:center;gap:.375rem}.member-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.profile-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#475569,#334155);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:1.5rem}.profile-avatar.has-photo[_ngcontent-%COMP%]{background:linear-gradient(135deg,#06b6d4,#3b82f6)}.profile-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.profile-name[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;color:#fff;display:flex;align-items:center;gap:.375rem}.profile-username[_ngcontent-%COMP%]{color:#22d3ee;text-decoration:none;font-size:.875rem}.profile-username[_ngcontent-%COMP%]:hover{text-decoration:underline}.detail-grid[_ngcontent-%COMP%]{display:grid;gap:.75rem}.detail-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.detail-label[_ngcontent-%COMP%]{color:#64748b;font-size:.875rem}.detail-value[_ngcontent-%COMP%]{color:#fff;font-size:.875rem}.detail-value.copyable[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;gap:.375rem}.detail-value.copyable[_ngcontent-%COMP%]:hover{color:#22d3ee}.copy-icon[_ngcontent-%COMP%]{font-size:.75rem;opacity:.5}.status-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.status-tag[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}.status-tag.premium[_ngcontent-%COMP%]{background:#f59e0b33;color:#fbbf24}.status-tag.verified[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.status-tag.photo[_ngcontent-%COMP%]{background:#3b82f633;color:#93c5fd}.status-tag.chinese[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.status-tag.danger[_ngcontent-%COMP%]{background:#ef44444d;color:#f87171}.status-tag.deleted[_ngcontent-%COMP%]{background:#4755694d;color:#94a3b8}.bio-text[_ngcontent-%COMP%]{color:#cbd5e1;font-size:.875rem;line-height:1.5;background:#0f172a80;padding:.75rem;border-radius:.5rem;margin:0}.source-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.source-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:#0f172a80;border-radius:.375rem}.source-item[_ngcontent-%COMP%]   .source-name[_ngcontent-%COMP%]{color:#fff;font-size:.875rem}.source-date[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem}.tags-edit[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.tag.editable[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.tag-remove[_ngcontent-%COMP%]{background:none;border:none;color:#64748b;cursor:pointer;font-size:.625rem;padding:0}.tag-remove[_ngcontent-%COMP%]:hover{color:#f87171}.add-tag-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px dashed rgba(148,163,184,.3);border-radius:.25rem;color:#94a3b8;font-size:.75rem;cursor:pointer}.add-tag-btn[_ngcontent-%COMP%]:hover{background:#334155b3;color:#fff}.notes-textarea[_ngcontent-%COMP%]{width:100%;min-height:80px;padding:.75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;resize:vertical}.notes-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.marketing-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.status-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:#0f172a4d;border-radius:.375rem}.status-label[_ngcontent-%COMP%]{color:#64748b;font-size:.875rem}.status-value[_ngcontent-%COMP%]{font-size:.875rem}.status-value.contacted[_ngcontent-%COMP%]{color:#86efac}.status-value.converted[_ngcontent-%COMP%]{color:#c084fc}.drawer-footer[_ngcontent-%COMP%]{padding:1rem 1.25rem;border-top:1px solid rgba(148,163,184,.1);display:flex;gap:.75rem}.drawer-footer[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], .drawer-footer[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{flex:1;justify-content:center}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:200}.dialog[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;max-width:90vw;background:#1e293b;border:1px solid rgba(148,163,184,.2);border-radius:.75rem;z-index:201}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.25rem;border-bottom:1px solid rgba(148,163,184,.1)}.dialog-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff}.dialog-content[_ngcontent-%COMP%]{padding:1.25rem}.tag-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#0f172a80;border:1px solid rgba(148,163,184,.2);border-radius:.5rem;color:#fff;font-size:.875rem;margin-bottom:1rem}.tag-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#06b6d4}.suggested-tags[_ngcontent-%COMP%]{margin-top:1rem}.suggested-title[_ngcontent-%COMP%]{color:#94a3b8;font-size:.75rem;margin:0 0 .5rem}.suggested-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.suggested-tag[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#33415580;border:1px solid rgba(148,163,184,.2);border-radius:.25rem;color:#e2e8f0;font-size:.75rem;cursor:pointer}.suggested-tag[_ngcontent-%COMP%]:hover{background:#06b6d433;border-color:#06b6d466}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.25rem;border-top:1px solid rgba(148,163,184,.1)}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"],changeDetection:0})}};var wt=class i{constructor(e,t){this.ipcService=e;this.toastService=t;this._isInitialized=_(!1);this._isLoading=_(!1);this._isSearching=_(!1);this._stats=_(null);this._recentKnowledge=_([]);this._learningEvents=_([]);this._searchResults=_([]);this._buildProgress=_(null);this._healthScore=_(0);this._knowledgeGaps=_([]);this._healthReport=_(null);this._guidedQuestion=_(null);this._guidedAnswers=_({});this._lastImportResult=_(null);this._lastError=_(null);this.lastError=G(()=>this._lastError());this._pendingRequests=new Map;this.REQUEST_TIMEOUT=15e3;this._currentRequest=_(null);this._requestStartTime=_(0);this.currentRequest=G(()=>this._currentRequest());this.requestElapsed=G(()=>{let e=this._requestStartTime();return e?Date.now()-e:0});this.isInitialized=G(()=>this._isInitialized());this.isLoading=G(()=>this._isLoading());this.isSearching=G(()=>this._isSearching());this.stats=G(()=>this._stats());this.recentKnowledge=G(()=>this._recentKnowledge());this.learningEvents=G(()=>this._learningEvents());this.searchResults=G(()=>this._searchResults());this.buildProgress=G(()=>this._buildProgress());this.healthScore=G(()=>this._healthScore());this.knowledgeGaps=G(()=>this._knowledgeGaps());this.healthReport=G(()=>this._healthReport());this.guidedQuestion=G(()=>this._guidedQuestion());this.gapsCount=G(()=>this._knowledgeGaps().length);this.totalKnowledge=G(()=>this._stats()?.totalKnowledge||0);this.hitRate=G(()=>{let e=this._stats();return!e||e.totalKnowledge===0?0:Math.round(e.totalUses/Math.max(1,e.totalKnowledge*10)*100)});this.todayLearned=G(()=>this._learningEvents().filter(e=>{let t=new Date().toDateString();return new Date(e.timestamp).toDateString()===t}).length);this.setupEventListeners()}clearLastError(){this._lastError.set(null)}startRequestWithTimeout(e,t=this.REQUEST_TIMEOUT){this.cancelRequest(e),this._currentRequest.set(e),this._requestStartTime.set(Date.now());let n=setTimeout(()=>{console.warn(`[RAGBrain] Request timeout: ${e}`),this._isLoading.set(!1),this._currentRequest.set(null),this._requestStartTime.set(0),this._pendingRequests.delete(e),this.toastService.error(`\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66 (${this.getRequestDisplayName(e)})`),(e==="build"||e==="guided-build")&&this._buildProgress.set(null),e==="search"&&this._searchResults.set([])},t);this._pendingRequests.set(e,n)}getRequestDisplayName(e){return{initialize:"\u521D\u59CB\u5316",search:"\u641C\u7D22",build:"\u69CB\u5EFA\u77E5\u8B58\u5EAB","guided-build":"\u5F15\u5C0E\u5F0F\u69CB\u5EFA","import-url":"\u7DB2\u9801\u5C0E\u5165","import-doc":"\u6587\u6A94\u5C0E\u5165"}[e]||e}getCurrentRequestName(){let e=this._currentRequest();return e?this.getRequestDisplayName(e):""}completeRequest(e){let t=this._pendingRequests.get(e);t&&(clearTimeout(t),this._pendingRequests.delete(e)),this._currentRequest()===e&&(this._currentRequest.set(null),this._requestStartTime.set(0))}cancelRequest(e){let t=this._pendingRequests.get(e);t&&(clearTimeout(t),this._pendingRequests.delete(e)),this._currentRequest()===e&&(this._currentRequest.set(null),this._requestStartTime.set(0))}cancelAllRequests(){this._pendingRequests.forEach(e=>clearTimeout(e)),this._pendingRequests.clear(),this._currentRequest.set(null),this._requestStartTime.set(0)}cancelCurrentRequest(){let e=this._currentRequest();e&&(this.cancelRequest(e),this._isLoading.set(!1),this._buildProgress.set(null),this.toastService.info("\u5DF2\u53D6\u6D88\u8ACB\u6C42"))}setupEventListeners(){this.ipcService.on("rag-initialized",e=>{console.log("[RAGBrain] System initialized:",e),this.completeRequest("initialize"),this._isLoading.set(!1),e.success?(this._isInitialized.set(!0),this.refreshStats(),this.toastService.success("\u{1F9E0} AI \u77E5\u8B58\u5927\u8166\u5DF2\u555F\u52D5")):this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-search-results",e=>{console.log("[RAGBrain] Search results:",e),this.completeRequest("search"),this._isLoading.set(!1),e.success&&e.results?this._searchResults.set(e.results.map(this.mapSearchResult)):e.success||(this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`),this._searchResults.set([]))}),this.ipcService.on("rag-stats-updated",e=>{console.log("[RAGBrain] Stats updated:",e),e.success&&e.stats&&(this._stats.set(this.mapStats(e.stats)),this.calculateHealthScore())}),this.ipcService.on("rag-knowledge-added",e=>{console.log("[RAGBrain] Knowledge added:",e),e.success&&(this.addLearningEvent({type:"new_knowledge",description:`\u6DFB\u52A0\u4E86\u65B0${this.getTypeName(e.knowledgeType)}\u77E5\u8B58`,details:{knowledgeType:e.knowledgeType}}),this.refreshStats())}),this.ipcService.on("rag-auto-learned",e=>{if(console.log("[RAGBrain] Auto learned:",e),e.success&&e.result){let t=e.result,n=(t.qa_extracted||0)+(t.scripts_extracted||0)+(t.objections_extracted||0);n>0&&(this.addLearningEvent({type:"auto_learn",description:`\u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${n} \u689D\u77E5\u8B58`,details:{userId:e.userId,count:n,quality:t.quality_score}}),this.refreshStats(),this.toastService.info(`\u{1F4AC} \u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${n} \u689D\u77E5\u8B58`))}}),this.ipcService.on("rag-build-progress",e=>{console.log("[RAGBrain] Build progress:",e),e.progress&&this._buildProgress.set(e.progress)}),this.ipcService.on("rag-build-complete",e=>{console.log("[RAGBrain] Build complete:",e),this.completeRequest("build"),this._buildProgress.set(null),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u901A\u904E\u5C0D\u8A71\u69CB\u5EFA\u4E86 ${e.totalItems} \u689D\u77E5\u8B58`,details:{count:e.totalItems}}),this.refreshStats(),this._lastImportResult.set({success:!0,totalItems:e.totalItems||0,stats:e.stats||{},source:"conversation"}),this.toastService.success(`\u2728 \u77E5\u8B58\u5927\u8166\u69CB\u5EFA\u5B8C\u6210\uFF01\u5171 ${e.totalItems} \u689D\u77E5\u8B58`)):this.toastService.error(`\u69CB\u5EFA\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-url-imported",e=>{console.log("[RAGBrain] URL imported:",e),this.completeRequest("import-url"),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u5F9E\u7DB2\u9801\u5C0E\u5165\u4E86 ${e.itemsCount} \u689D\u77E5\u8B58`,details:{count:e.itemsCount}}),this.refreshStats(),this.toastService.success(`\u{1F310} \u5DF2\u5F9E\u7DB2\u9801\u5C0E\u5165 ${e.itemsCount} \u689D\u77E5\u8B58`)):e.needsApiKey?(this.toastService.error(`\u26A0\uFE0F ${e.error}`,8e3),this._lastError.set({type:"api_key_missing",message:e.error,action:"configure_ai"})):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-document-imported",e=>{console.log("[RAGBrain] Document imported:",e),this.completeRequest("import-doc"),this._isLoading.set(!1),e.success?(this.addLearningEvent({type:"new_knowledge",description:`\u5F9E\u6587\u6A94\u5C0E\u5165\u4E86 ${e.itemsCount} \u689D\u77E5\u8B58`,details:{count:e.itemsCount}}),this.refreshStats(),this.toastService.success(`\u{1F4C4} \u5DF2\u5F9E\u6587\u6A94\u5C0E\u5165 ${e.itemsCount} \u689D\u77E5\u8B58`)):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-gaps-list",e=>{console.log("[RAGBrain] Gaps list:",e),e.success&&e.gaps&&this._knowledgeGaps.set(e.gaps)}),this.ipcService.on("rag-gap-resolved",e=>{console.log("[RAGBrain] Gap resolved:",e),e.success&&(this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e.gapId)),this.toastService.success("\u2705 \u77E5\u8B58\u7F3A\u53E3\u5DF2\u89E3\u6C7A\uFF01"),this.refreshStats())}),this.ipcService.on("rag-gap-ignored",e=>{e.success&&this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e.gapId))}),this.ipcService.on("rag-gap-suggestion",e=>{console.log("[RAGBrain] Gap suggestion:",e),e.success&&e.suggestedAnswer&&this._knowledgeGaps.update(t=>t.map(n=>n.id===e.gapId?B(F({},n),{suggestedAnswer:e.suggestedAnswer}):n))}),this.ipcService.on("rag-health-report",e=>{console.log("[RAGBrain] Health report:",e),e.success&&e.report&&(this._healthReport.set(e.report),this._healthScore.set(e.report.overallScore||0))}),this.ipcService.on("rag-guided-question",e=>{console.log("[RAGBrain] Guided question:",e),this.completeRequest("guided-build"),this._isLoading.set(!1),e.success?this._guidedQuestion.set({step:e.step,totalSteps:e.totalSteps,title:e.title,question:e.question,type:e.type,options:e.options,placeholder:e.placeholder,suggestions:e.suggestions}):this.toastService.error(`\u5F15\u5C0E\u5F0F\u69CB\u5EFA\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("rag-error",e=>{console.error("[RAGBrain] Error event:",e),this.cancelAllRequests(),this._isLoading.set(!1),this._buildProgress.set(null),this.toastService.error(`RAG \u932F\u8AA4: ${e.error||"\u64CD\u4F5C\u5931\u6557"}`)}),this.ipcService.on("backend-status",e=>{e.running||(console.warn("[RAGBrain] Backend disconnected, resetting states"),this.cancelAllRequests(),this._isLoading.set(!1),this._isInitialized.set(!1),this._buildProgress.set(null))})}async initialize(){this._isInitialized()||this._isLoading()||(console.log("[RAGBrain] Initializing..."),this._isLoading.set(!0),this.startRequestWithTimeout("initialize",3e4),this.ipcService.send("rag-initialize",{useChromadb:!0,useNeural:!0}))}refreshStats(){this.ipcService.send("rag-get-stats",{})}search(e,t){this._isLoading()||(this._isLoading.set(!0),this._searchResults.set([]),this.startRequestWithTimeout("search"),this.ipcService.send("rag-search",{query:e,limit:t?.limit||5,knowledgeType:t?.type,minScore:t?.minScore||.3}))}async buildFromConversation(e){this._isLoading()||(this._isLoading.set(!0),this._buildProgress.set({step:1,totalSteps:5,currentAction:"\u5206\u6790\u696D\u52D9\u63CF\u8FF0...",itemsGenerated:0}),this.startRequestWithTimeout("build",12e4),this.ipcService.send("rag-build-from-conversation",e))}importFromUrl(e){this._isLoading()||(this._isLoading.set(!0),this.startRequestWithTimeout("import-url",6e4),this.toastService.info("\u{1F50D} \u6B63\u5728\u89E3\u6790\u7DB2\u9801\u5167\u5BB9..."),this.ipcService.send("rag-import-url",{url:e}))}importFromDocument(e,t){this._isLoading()||(this._isLoading.set(!0),this.startRequestWithTimeout("import-doc",6e4),this.toastService.info("\u{1F4D6} \u6B63\u5728\u89E3\u6790\u6587\u6A94..."),this.ipcService.send("rag-import-document",{filePath:e,fileType:t}))}addKnowledge(e,t,n,o){this.ipcService.send("rag-add-knowledge",{knowledgeType:e,question:t,answer:n,context:o||""})}recordFeedback(e,t){this.ipcService.send("rag-record-feedback",{knowledgeId:e,isPositive:t}),this.addLearningEvent({type:"feedback",description:`\u6536\u5230${t?"\u6B63\u9762":"\u8CA0\u9762"}\u53CD\u994B`,details:{}})}getRecentKnowledge(e=20){this.ipcService.send("rag-get-recent",{limit:e})}cleanupLowQuality(){this.ipcService.send("rag-cleanup",{minScore:.2,minUses:0,daysOld:30})}mergeSimilar(){this.ipcService.send("rag-merge-similar",{similarityThreshold:.9})}getKnowledgeGaps(e=1){this.ipcService.send("rag-get-gaps",{status:"pending",limit:50,minHits:e})}resolveGap(e,t,n,o){this.ipcService.send("rag-resolve-gap",{gapId:e,knowledgeType:t,question:n,answer:o})}ignoreGap(e){this.ipcService.send("rag-ignore-gap",{gapId:e})}deleteGap(e){this.ipcService.send("rag-delete-gap",{gapId:e}),this._knowledgeGaps.update(t=>t.filter(n=>n.id!==e))}deleteGapsBatch(e){this.ipcService.send("rag-delete-gaps-batch",{gapIds:e}),this._knowledgeGaps.update(t=>t.filter(n=>!e.includes(n.id)))}cleanupDuplicateGaps(){this.ipcService.send("rag-cleanup-duplicate-gaps",{}),setTimeout(()=>this.getKnowledgeGaps(),1e3)}suggestGapAnswer(e,t){this.ipcService.send("rag-suggest-gap-answer",{gapId:e,query:t})}getHealthReport(){this.ipcService.send("rag-get-health-report",{})}startGuidedBuild(){this._isLoading()||(this._guidedAnswers.set({}),this._isLoading.set(!0),this.startRequestWithTimeout("guided-build",3e4),this.ipcService.send("rag-start-guided-build",{step:1,answers:{}}))}answerGuidedQuestion(e){let t=this._guidedQuestion();if(!t)return;let n=`step${t.step}`;this._guidedAnswers.update(d=>B(F({},d),{[n]:e}));let o=t.step+1;this._isLoading.set(!0);let a=o>t.totalSteps?12e4:3e4;this.startRequestWithTimeout("guided-build",a),o<=t.totalSteps?this.ipcService.send("rag-start-guided-build",{step:o,answers:this._guidedAnswers()}):(this._guidedQuestion.set(null),this.ipcService.send("rag-start-guided-build",{step:o,answers:this._guidedAnswers()}))}cancelGuidedBuild(){this.cancelRequest("guided-build"),this._guidedQuestion.set(null),this._guidedAnswers.set({}),this._isLoading.set(!1)}addLearningEvent(e){let t=F({id:`event_${Date.now()}`,timestamp:new Date().toISOString()},e);this._learningEvents.update(n=>[t,...n].slice(0,50))}calculateHealthScore(){let e=this._stats();if(!e){this._healthScore.set(0);return}let t=0;t+=Math.min(25,e.totalKnowledge*.5),t+=e.avgScore*25;let n=e.totalUses/Math.max(1,e.totalKnowledge);t+=Math.min(25,n*5);let o=Object.keys(e.byType).length;t+=Math.min(25,o*5),this._healthScore.set(Math.round(t))}mapSearchResult(e){return{item:{id:e.item.id,type:e.item.knowledge_type||e.item.type,question:e.item.question,answer:e.item.answer,context:e.item.context,keywords:e.item.keywords||[],successScore:e.item.success_score||e.item.successScore||.5,useCount:e.item.use_count||e.item.useCount||0,feedbackPositive:e.item.feedback_positive||0,feedbackNegative:e.item.feedback_negative||0,createdAt:e.item.created_at||e.item.createdAt||"",updatedAt:e.item.updated_at||e.item.updatedAt||""},similarity:e.similarity,source:e.source}}mapStats(e){return{totalKnowledge:e.total_knowledge||e.totalKnowledge||0,totalUses:e.total_uses||e.totalUses||0,avgScore:e.avg_score||e.avgScore||0,byType:e.by_type||e.byType||{},vectorCount:e.vector_count||e.vectorCount,chromadbEnabled:e.chromadb_enabled??e.chromadbEnabled??!1,neuralEmbedding:e.neural_embedding??e.neuralEmbedding??!1,learning:e.learning?{sessionsProcessed:e.learning.sessions_processed||0,totalQaExtracted:e.learning.total_qa_extracted||0,totalScriptsExtracted:e.learning.total_scripts_extracted||0,avgQualityScore:e.learning.avg_quality_score||0}:void 0}}getTypeName(e){return{qa:"\u554F\u7B54",script:"\u8A71\u8853",product:"\u7522\u54C1",objection:"\u7570\u8B70\u8655\u7406",greeting:"\u958B\u5834\u767D",closing:"\u6210\u4EA4",faq:"FAQ",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)(Ke(ye),Ke(ue))}}static{this.\u0275prov=be({token:i,factory:i.\u0275fac,providedIn:"root"})}};var j5=(i,e)=>e.item.id,jo=(i,e)=>e.id,ew=(i,e)=>e.message,tw=(i,e)=>e.name;function nw(i,e){if(i&1){let t=M();r(0,"div",52),x("click",function(){v(t);let o=g(2);return b(o.scrollToGaps())}),r(1,"span",53),l(2,"\u{1F534}"),s(),r(3,"span",54),l(4),s(),r(5,"span",55),l(6,"\u7ACB\u5373\u8655\u7406 \u2192"),s()()}if(i&2){let t=g(2);c(4),D("",t.ragService.gapsCount()," \u500B\u77E5\u8B58\u7F3A\u53E3\u5F85\u8655\u7406")}}function iw(i,e){if(i&1&&(r(0,"div",50)(1,"span",56),l(2,"\u{1F7E1}"),s(),r(3,"span",54),l(4),s(),r(5,"span",55),l(6,"\u512A\u5316 \u2192"),s()()),i&2){let t=g(2);c(4),D("\u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u504F\u4F4E (",t.ragService.healthScore(),"%)")}}function ow(i,e){if(i&1){let t=M();r(0,"div",57),x("click",function(){v(t);let o=g(2);return b(o.focusBuildInput())}),r(1,"span",58),l(2,"\u{1F7E2}"),s(),r(3,"span",54),l(4,"\u5EFA\u8B70\u6DFB\u52A0\u66F4\u591A\u77E5\u8B58"),s(),r(5,"span",55),l(6,"\u958B\u59CB \u2192"),s()()}}function rw(i,e){if(i&1&&(r(0,"div",45)(1,"div",46)(2,"span",47),l(3,"\u{1F4CC}"),s(),r(4,"span"),l(5,"\u4ECA\u65E5\u5F85\u8FA6"),s()(),r(6,"div",48),S(7,nw,7,1,"div",49),S(8,iw,7,1,"div",50),S(9,ow,7,0,"div",51),s()()),i&2){let t=g();c(7),w(t.ragService.gapsCount()>0?7:-1),c(),w(t.ragService.healthScore()<60?8:-1),c(),w(t.ragService.totalKnowledge()<10?9:-1)}}function sw(i,e){if(i&1&&(r(0,"div",19)(1,"div",59),k(2,"div",60),s(),r(3,"div",61),l(4),s()()),i&2){let t=e;c(2),X("width",t.step/t.totalSteps*100,"%"),c(2),Y(" ",t.currentAction," (",t.itemsGenerated," \u689D) ")}}function aw(i,e){i&1&&(k(0,"span",62),l(1," \u69CB\u5EFA\u4E2D... "))}function lw(i,e){i&1&&(r(0,"span",14),l(1,"\u2728"),s(),l(2," \u4E00\u9375\u69CB\u5EFA\u77E5\u8B58\u5EAB "))}function cw(i,e){if(i&1){let t=M();r(0,"button",63),x("click",function(){v(t);let o=g();return b(o.cancelCurrentRequest())}),l(1," \u2715 \u53D6\u6D88 "),s()}}function dw(i,e){if(i&1){let t=M();r(0,"div",31),k(1,"span",62),l(2," \u6B63\u5728\u641C\u7D22... "),r(3,"button",64),x("click",function(){v(t);let o=g();return b(o.cancelCurrentRequest())}),l(4,"\u53D6\u6D88"),s()()}}function uw(i,e){if(i&1){let t=M();r(0,"div",66)(1,"div",67)(2,"span",68),l(3),s(),r(4,"span",69),l(5),s()(),r(6,"div",70),l(7),s(),r(8,"div",71),l(9),s(),r(10,"div",72)(11,"button",73),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.recordFeedback(o.item.id,!0))}),l(12," \u{1F44D} \u6709\u7528 "),s(),r(13,"button",74),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.recordFeedback(o.item.id,!1))}),l(14," \u{1F44E} \u7121\u7528 "),s()()()}if(i&2){let t=e.$implicit,n=g(2);I("high-match",t.similarity>=.8),c(2),Et("data-type",t.item.type),c(),D(" ",n.getTypeName(t.item.type)," "),c(2),D(" \u5339\u914D\u5EA6: ",(t.similarity*100).toFixed(0),"% "),c(2),A(t.item.question),c(2),A(t.item.answer)}}function mw(i,e){if(i&1&&$(0,uw,15,7,"div",65,j5),i&2){let t=g();H(t.ragService.searchResults())}}function pw(i,e){if(i&1){let t=M();r(0,"div",32)(1,"span",14),l(2,"\u{1F50D}"),s(),r(3,"p"),l(4,"\u672A\u627E\u5230\u76F8\u95DC\u77E5\u8B58"),s(),r(5,"button",75),x("click",function(){v(t);let o=g();return b(o.addNewKnowledge())}),l(6,"\u6DFB\u52A0\u9019\u689D\u77E5\u8B58"),s()()}}function gw(i,e){i&1&&(r(0,"div",33)(1,"span",14),l(2,"\u{1F4A1}"),s(),r(3,"p"),l(4,"\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u7528\u8A9E\u7FA9\u7406\u89E3\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58"),s()())}function hw(i,e){i&1&&l(0," \u{1F4DA} ")}function fw(i,e){i&1&&l(0," \u{1F4AC} ")}function _w(i,e){i&1&&l(0," \u{1F44D} ")}function Cw(i,e){i&1&&l(0," \u{1F4C8} ")}function vw(i,e){if(i&1&&(r(0,"div",76)(1,"div",77),S(2,hw,1,0)(3,fw,1,0)(4,_w,1,0)(5,Cw,1,0),s(),r(6,"div",78)(7,"div",79),l(8),s(),r(9,"div",80),l(10),s()()()),i&2){let t,n=e.$implicit,o=g(2);Et("data-type",n.type),c(2),w((t=n.type)==="new_knowledge"?2:t==="auto_learn"?3:t==="feedback"?4:t==="quality_update"?5:-1),c(6),A(n.description),c(2),A(o.formatTime(n.timestamp))}}function bw(i,e){if(i&1&&$(0,vw,11,4,"div",76,jo),i&2){let t=g();H(t.ragService.learningEvents().slice(0,10))}}function xw(i,e){i&1&&(r(0,"div",37)(1,"p"),l(2,"\u7B49\u5F85\u5B78\u7FD2\u4E8B\u4EF6..."),s(),r(3,"p",81),l(4,"AI \u6703\u5F9E\u5C0D\u8A71\u4E2D\u81EA\u52D5\u5B78\u7FD2"),s()())}function yw(i,e){if(i&1){let t=M();r(0,"button",91),x("click",function(){v(t);let o=g(2);return b(o.deleteSelectedGaps())}),l(1),s()}if(i&2){let t=g(2);c(),D(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedGapIds().length,") ")}}function Sw(i,e){i&1&&(r(0,"span",99),l(1,"\u{1F525} \u71B1\u9580"),s())}function ww(i,e){if(i&1&&(r(0,"span",107),l(1),s()),i&2){let t=g().$implicit,n=g(2);de("cat-"+t.category),c(),D(" ",n.getCategoryLabel(t.category)," ")}}function Ew(i,e){if(i&1&&(r(0,"div",102)(1,"span",108),l(2,"\u{1F4A1} AI:"),s(),r(3,"span",109),l(4),s()()),i&2){let t=g().$implicit;c(4),A(t.suggestedAnswer.length>80?t.suggestedAnswer.slice(0,80)+"...":t.suggestedAnswer)}}function Aw(i,e){if(i&1){let t=M();r(0,"button",110),x("click",function(){v(t);let o=g().$implicit,a=g(2);return b(a.suggestAnswer(o))}),l(1," \u{1F916} \u751F\u6210 "),s()}}function Dw(i,e){if(i&1){let t=M();r(0,"div",92)(1,"div",93)(2,"input",94),x("change",function(){let o=v(t).$implicit,a=g(2);return b(a.toggleGapSelection(o.id))}),s()(),r(3,"div",95)(4,"div",96)(5,"span",97),l(6),s(),r(7,"div",98),S(8,Sw,2,0,"span",99),S(9,ww,2,3,"span",100),r(10,"span",101),l(11),s()()(),S(12,Ew,5,1,"div",102),r(13,"div",103),S(14,Aw,2,0,"button",104),r(15,"button",105),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.resolveGap(o))}),l(16," \u2705 \u63A1\u7528 "),s(),r(17,"button",106),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.deleteGap(o))}),l(18," \u{1F5D1}\uFE0F "),s()()()()}if(i&2){let t=e.$implicit,n=g(2);I("selected",n.isGapSelected(t.id)),c(2),V("checked",n.isGapSelected(t.id)),c(3),V("title",t.query),c(),D(" ",t.query.length>60?t.query.slice(0,60)+"...":t.query," "),c(2),w(t.hitCount>=5?8:-1),c(),w(t.category?9:-1),c(2),D("",t.hitCount,"\u6B21"),c(),w(t.suggestedAnswer?12:-1),c(2),w(t.suggestedAnswer?-1:14)}}function Mw(i,e){if(i&1&&(r(0,"div",90)(1,"span"),l(2),s()()),i&2){let t=g(2);c(2),D("\u9084\u6709 ",t.ragService.gapsCount()-15," \u689D\u672A\u986F\u793A")}}function Tw(i,e){if(i&1){let t=M();r(0,"div",41)(1,"div",82)(2,"h3",13)(3,"span",14),l(4,"\u{1F514}"),s(),l(5," \u77E5\u8B58\u7F3A\u53E3 "),r(6,"span",83),l(7),s()(),r(8,"div",84)(9,"button",85),x("click",function(){v(t);let o=g();return b(o.cleanupDuplicateGaps())}),l(10," \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 "),s(),S(11,yw,2,1,"button",86),s()(),r(12,"p",87),l(13,"\u{1F4A1} \u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u597D\u7B54\u6848\u7684\u554F\u984C\uFF0C\u5EFA\u8B70\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C"),s(),r(14,"div",88),$(15,Dw,19,10,"div",89,jo),s(),S(17,Mw,3,1,"div",90),s()}if(i&2){let t=g();c(7),D("(",t.ragService.gapsCount(),")"),c(4),w(t.selectedGapIds().length>0?11:-1),c(4),H(t.ragService.knowledgeGaps().slice(0,15)),c(2),w(t.ragService.gapsCount()>15?17:-1)}}function kw(i,e){i&1&&(r(0,"div",42)(1,"span",111),l(2,"\u2728"),s(),r(3,"p"),l(4,"\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u66AB\u7121\u77E5\u8B58\u7F3A\u53E3"),s()())}function Iw(i,e){if(i&1&&(r(0,"div",124)(1,"span",125),l(2),s(),l(3),s()),i&2){let t=e.$implicit;Et("data-priority",t.priority),c(2),A(t.priority==="high"?"\u{1F534}":t.priority==="medium"?"\u{1F7E1}":"\u{1F7E2}"),c(),D(" ",t.message," ")}}function Pw(i,e){if(i&1&&(r(0,"div",123)(1,"h4"),l(2,"\u{1F4A1} \u512A\u5316\u5EFA\u8B70"),s(),$(3,Iw,4,3,"div",124,ew),s()),i&2){let t=g(2);c(3),H(t.suggestions)}}function Fw(i,e){if(i&1&&(r(0,"div",112)(1,"h3",13)(2,"span",14),l(3,"\u{1F4CA}"),s(),l(4," \u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u5831\u544A "),s(),r(5,"div",113)(6,"div",114)(7,"span",115),l(8),s(),r(9,"span",116),l(10,"\u7E3D\u5206"),s()(),r(11,"div",117)(12,"div",118)(13,"span",119),l(14,"\u5B8C\u6574\u6027"),s(),r(15,"div",120),k(16,"div",121),s(),r(17,"span",122),l(18),s()(),r(19,"div",118)(20,"span",119),l(21,"\u6548\u679C"),s(),r(22,"div",120),k(23,"div",121),s(),r(24,"span",122),l(25),s()(),r(26,"div",118)(27,"span",119),l(28,"\u6642\u6548\u6027"),s(),r(29,"div",120),k(30,"div",121),s(),r(31,"span",122),l(32),s()()()(),S(33,Pw,5,0,"div",123),s()),i&2){let t=g();c(6),I("healthy",t.overallScore>=70)("warning",t.overallScore>=40&&t.overallScore<70)("danger",t.overallScore<40),c(2),A(t.overallScore),c(8),X("width",(t.completeness==null?null:t.completeness.score)||0,"%"),c(2),D("",(t.completeness==null?null:t.completeness.score)||0,"%"),c(5),X("width",(t.effectiveness==null?null:t.effectiveness.score)||0,"%"),c(2),D("",(t.effectiveness==null?null:t.effectiveness.score)||0,"%"),c(5),X("width",(t.freshness==null?null:t.freshness.score)||0,"%"),c(2),D("",(t.freshness==null?null:t.freshness.score)||0,"%"),c(),w(t.suggestions&&t.suggestions.length>0?33:-1)}}function Nw(i,e){i&1&&S(0,Fw,34,17,"div",112),i&2&&w(e.overallScore!==void 0?0:-1)}function Rw(i,e){if(i&1&&(r(0,"div",127)(1,"div",128),l(2),s(),r(3,"div",129)(4,"span",130),l(5),s(),r(6,"span",131),l(7),s()(),r(8,"div",132),k(9,"div",121),s()()),i&2){let t=e.$implicit,n=g(),o=g();c(2),A(t.name),c(3),D("",t.count," \u689D"),c(2),D("\u8A55\u5206: ",t.avgScore),c(2),X("width",t.count/n.totalKnowledge*100,"%")("background",o.getTypeColor(t.key))}}function Ow(i,e){if(i&1&&(r(0,"div",43)(1,"h3"),l(2,"\u77E5\u8B58\u5206\u5E03"),s(),r(3,"div",126),$(4,Rw,10,7,"div",127,tw),s()()),i&2){let t=g();c(4),H(t.getStatTypes(e.byType))}}function Bw(i,e){if(i&1){let t=M();r(0,"button",145),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.guidedAnswer=o.id)}),l(1),s()}if(i&2){let t=e.$implicit,n=g(3);I("selected",n.guidedAnswer===t.id),c(),D(" ",t.label," ")}}function Vw(i,e){if(i&1&&(r(0,"div",139),$(1,Bw,2,3,"button",144,jo),s()),i&2){let t=g();c(),H(t.options)}}function Lw(i,e){if(i&1){let t=M();r(0,"button",145),x("click",function(){let o=v(t).$implicit,a=g(3);return b(a.toggleOption(o.id))}),l(1),s()}if(i&2){let t=e.$implicit,n=g(3);I("selected",n.isOptionSelected(t.id)),c(),D(" ",t.label," ")}}function Gw(i,e){if(i&1&&(r(0,"div",140),$(1,Lw,2,3,"button",144,jo),s()),i&2){let t=g();c(),H(t.options)}}function Uw(i,e){if(i&1){let t=M();r(0,"button",150),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.addSuggestion(o))}),l(1),s()}if(i&2){let t=e.$implicit;c(),A(t)}}function qw(i,e){if(i&1&&(r(0,"div",147)(1,"span",148),l(2,"\u5E38\u898B:"),s(),$(3,Uw,2,1,"button",149,Pe),s()),i&2){let t=g(2);c(3),H(t.suggestions)}}function $w(i,e){if(i&1){let t=M();r(0,"textarea",146),W("ngModelChange",function(o){v(t);let a=g(2);return K(a.guidedAnswer,o)||(a.guidedAnswer=o),b(o)}),s(),S(1,qw,5,0,"div",147)}if(i&2){let t=g(),n=g();z("ngModel",n.guidedAnswer),V("placeholder",t.placeholder||""),c(),w(t.suggestions&&t.suggestions.length?1:-1)}}function Hw(i,e){i&1&&l(0," \u4E0B\u4E00\u6B65 \u2192 ")}function zw(i,e){i&1&&l(0," \u958B\u59CB\u69CB\u5EFA \u2728 ")}function Kw(i,e){if(i&1){let t=M();r(0,"div",44)(1,"div",133)(2,"div",134)(3,"span",135),l(4),s(),r(5,"h3"),l(6),s(),r(7,"button",136),x("click",function(){v(t);let o=g();return b(o.cancelGuidedBuild())}),l(8,"\u2715"),s()(),r(9,"div",137)(10,"p",138),l(11),s(),S(12,Vw,3,0,"div",139)(13,Gw,3,0,"div",140)(14,$w,2,3),s(),r(15,"div",141)(16,"button",142),x("click",function(){v(t);let o=g();return b(o.cancelGuidedBuild())}),l(17,"\u53D6\u6D88"),s(),r(18,"button",143),x("click",function(){v(t);let o=g();return b(o.submitGuidedAnswer())}),S(19,Hw,1,0)(20,zw,1,0),s()()()()}if(i&2){let t,n=e,o=g();c(4),Y("\u6B65\u9A5F ",n.step," / ",n.totalSteps),c(2),A(n.title),c(5),A(n.question),c(),w((t=n.type)==="select"?12:t==="multiselect"?13:t==="textarea"?14:-1),c(6),V("disabled",!o.guidedAnswer||o.ragService.isLoading()),c(),w(n.step<n.totalSteps?19:20)}}var Zo=class i{constructor(){this.ragService=O(wt);this.dialogService=O(bt);this.toastService=O(ue);this.businessDescription="";this.searchQuery="";this.guidedAnswer="";this.selectedOptions=[];this.selectedGapIds=_([])}ngOnInit(){this.ragService.initialize(),this.ragService.refreshStats(),this.ragService.getKnowledgeGaps(),this.ragService.getHealthReport()}isGapSelected(e){return this.selectedGapIds().includes(e)}toggleGapSelection(e){let t=this.selectedGapIds();t.includes(e)?this.selectedGapIds.set(t.filter(n=>n!==e)):this.selectedGapIds.set([...t,e])}deleteSelectedGaps(){let e=this.selectedGapIds();e.length!==0&&(this.ragService.deleteGapsBatch(e),this.selectedGapIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D\u7F3A\u53E3`))}getCategoryLabel(e){return{price:"\u{1F4B0} \u50F9\u683C",process:"\u{1F4CB} \u6D41\u7A0B",product:"\u{1F4E6} \u7522\u54C1",support:"\u{1F6E0}\uFE0F \u552E\u5F8C",other:"\u2753 \u5176\u4ED6"}[e]||e}hasPendingTasks(){return this.ragService.gapsCount()>0||this.ragService.healthScore()<60||this.ragService.totalKnowledge()<10}scrollToGaps(){let e=document.querySelector(".gaps-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}focusBuildInput(){let e=document.querySelector(".build-textarea");e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}))}async startBuild(){this.businessDescription.trim()&&await this.ragService.buildFromConversation({businessDescription:this.businessDescription})}importFromUrl(){this.ragService.lastError()?.type==="api_key_missing"&&this.ragService.clearLastError?.(),this.dialogService.prompt({title:"\u5F9E\u7DB2\u9801\u5C0E\u5165\u77E5\u8B58",message:`\u8F38\u5165\u7DB2\u9801 URL\uFF0CAI \u6703\u81EA\u52D5\u63D0\u53D6\u77E5\u8B58\uFF1A

\u{1F4A1} \u63D0\u793A\uFF1A\u9700\u8981\u5148\u5728\u300CAI \u4E2D\u5FC3\u300D\u2192\u300C\u6A21\u578B\u8A2D\u5B9A\u300D\u914D\u7F6E AI API Key`,placeholder:"https://example.com/about",confirmText:"\u5C0E\u5165",onConfirm:t=>{t&&this.ragService.importFromUrl(t)}})}importFromDocument(){let e=document.createElement("input");e.type="file",e.accept=".txt,.pdf,.doc,.docx",e.onchange=t=>{let n=t.target.files?.[0];if(n){let o=n.name.split(".").pop()||"";this.toastService.info(`\u9078\u64C7\u4E86\u6587\u4EF6: ${n.name}\uFF0C\u6B63\u5728\u8655\u7406...`)}},e.click()}openTemplateSelector(){this.dialogService.prompt({title:"\u9078\u64C7\u884C\u696D\u6A21\u677F",message:"\u8F38\u5165\u884C\u696D\u985E\u578B\uFF08payment/ecommerce/education/realestate/finance/healthcare/travel/legal\uFF09\uFF1A",placeholder:"payment",confirmText:"\u61C9\u7528",onConfirm:e=>{e&&this.toastService.info(`\u6B63\u5728\u61C9\u7528\u300C${e}\u300D\u6A21\u677F...`)}})}search(){this.searchQuery.trim()&&this.ragService.search(this.searchQuery)}recordFeedback(e,t){this.ragService.recordFeedback(e,t),this.toastService.success(t?"\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF01":"\u5DF2\u8A18\u9304\uFF0C\u6211\u5011\u6703\u6539\u9032")}addNewKnowledge(){this.dialogService.prompt({title:"\u6DFB\u52A0\u65B0\u77E5\u8B58",message:"\u8F38\u5165\u56DE\u7B54\u5167\u5BB9\uFF1A",placeholder:"\u5C08\u696D\u7684\u56DE\u7B54...",confirmText:"\u6DFB\u52A0",onConfirm:e=>{e&&this.ragService.addKnowledge("qa",this.searchQuery,e)}})}cleanupKnowledge(){this.dialogService.confirm({title:"\u6E05\u7406\u4F4E\u8CEA\u91CF\u77E5\u8B58",message:"\u5C07\u522A\u9664\u8A55\u5206\u4F4E\u65BC 0.2 \u4E14\u672A\u88AB\u4F7F\u7528\u7684\u820A\u77E5\u8B58\uFF0C\u78BA\u8A8D\u7E7C\u7E8C\uFF1F",confirmText:"\u6E05\u7406",type:"warning",onConfirm:()=>{this.ragService.cleanupLowQuality(),this.toastService.info("\u6B63\u5728\u6E05\u7406...")}})}mergeKnowledge(){this.ragService.mergeSimilar(),this.toastService.info("\u6B63\u5728\u5408\u4F75\u76F8\u4F3C\u77E5\u8B58...")}refreshStats(){this.ragService.refreshStats(),this.toastService.success("\u5DF2\u5237\u65B0\u7D71\u8A08")}cancelCurrentRequest(){this.ragService.cancelCurrentRequest()}getTypeName(e){return{qa:"\u554F\u7B54",script:"\u8A71\u8853",product:"\u7522\u54C1",objection:"\u7570\u8B70\u8655\u7406",greeting:"\u958B\u5834\u767D",closing:"\u6210\u4EA4",faq:"FAQ",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}getTypeColor(e){return{"Q&A \u554F\u7B54":"#667eea",\u6210\u529F\u8A71\u8853:"#10b981",\u7522\u54C1\u4FE1\u606F:"#f59e0b",\u7570\u8B70\u8655\u7406:"#ef4444",\u958B\u5834\u767D:"#8b5cf6",\u6210\u4EA4\u8A71\u8853:"#06b6d4",FAQ:"#ec4899",\u81EA\u5B9A\u7FA9:"#6b7280"}[e]||"#667eea"}getStatTypes(e){return Object.entries(e||{}).map(([t,n])=>({key:t,name:t,count:n.count||0,avgScore:n.avg_score||n.avgScore||0}))}formatTime(e){let t=new Date(e),o=new Date().getTime()-t.getTime();return o<6e4?"\u525B\u525B":o<36e5?`${Math.floor(o/6e4)} \u5206\u9418\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u6642\u524D`:t.toLocaleDateString("zh-TW")}suggestAnswer(e){this.ragService.suggestGapAnswer(e.id,e.query),this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...")}resolveGap(e){let t=e.suggestedAnswer||"";this.dialogService.prompt({title:"\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",message:`\u554F\u984C: "${e.query}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,placeholder:t||"\u5C08\u696D\u7684\u56DE\u7B54...",defaultValue:t,confirmText:"\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",onConfirm:n=>{n&&this.ragService.resolveGap(e.id,"faq",e.query,n)}})}ignoreGap(e){this.ragService.ignoreGap(e.id)}deleteGap(e){this.ragService.deleteGap(e.id),this.toastService.success("\u5DF2\u522A\u9664")}cleanupDuplicateGaps(){this.ragService.cleanupDuplicateGaps(),this.toastService.info("\u6B63\u5728\u6E05\u7406\u91CD\u8907\u7F3A\u53E3...")}startGuidedBuild(){this.guidedAnswer="",this.selectedOptions=[],this.ragService.startGuidedBuild()}isOptionSelected(e){return this.selectedOptions.includes(e)}toggleOption(e){this.selectedOptions.includes(e)?this.selectedOptions=this.selectedOptions.filter(t=>t!==e):this.selectedOptions.push(e),this.guidedAnswer=this.selectedOptions}addSuggestion(e){typeof this.guidedAnswer=="string"&&(this.guidedAnswer=this.guidedAnswer?`${this.guidedAnswer}
${e}`:e)}submitGuidedAnswer(){this.ragService.answerGuidedQuestion(this.guidedAnswer),this.guidedAnswer="",this.selectedOptions=[]}cancelGuidedBuild(){this.ragService.cancelGuidedBuild(),this.guidedAnswer="",this.selectedOptions=[]}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-ai-brain"]],decls:106,vars:20,consts:[[1,"ai-brain-container"],["class","task-banner",4,"ngIf"],[1,"brain-header"],[1,"brain-title"],[1,"brain-icon"],[1,"version-badge"],[1,"brain-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],[1,"stat-item","health"],[1,"brain-content"],[1,"build-section"],[1,"section-title"],[1,"icon"],[1,"conversation-builder"],[1,"chat-bubble","ai"],[1,"bubble-content"],["placeholder","\u4F8B\u5982\uFF1A\u6211\u662F\u505A\u8DE8\u5883\u652F\u4ED8\u7684\uFF0C\u4E3B\u8981\u5E6B\u5BA2\u6236\u514C\u63DB USDT\uFF0C\u532F\u7387\u6BD4\u5E02\u5834\u9AD8 0.5%\uFF0C10 \u5206\u9418\u5230\u8CEC...","rows","4",1,"business-input",3,"ngModelChange","ngModel"],[1,"build-progress"],[1,"build-btn",3,"click","disabled"],[1,"cancel-request-btn"],[1,"quick-import"],[1,"import-buttons"],[1,"import-btn","guided",3,"click"],[1,"import-btn",3,"click"],[1,"search-section"],[1,"search-box"],["type","text","placeholder","\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58...",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-btn",3,"click","disabled"],[1,"search-results"],[1,"loading-state"],[1,"empty-state"],[1,"placeholder-state"],[1,"learning-section"],[1,"live-badge"],[1,"learning-feed"],[1,"empty-learning"],[1,"maintenance-section"],[1,"maintenance-buttons"],[1,"maint-btn",3,"click"],[1,"gaps-section"],[1,"gaps-empty"],[1,"knowledge-distribution"],[1,"guided-overlay"],[1,"task-banner"],[1,"task-title"],[1,"task-icon"],[1,"task-list"],[1,"task-item","priority-high"],[1,"task-item","priority-medium"],[1,"task-item","priority-low"],[1,"task-item","priority-high",3,"click"],[1,"task-badge","high"],[1,"task-text"],[1,"task-action"],[1,"task-badge","medium"],[1,"task-item","priority-low",3,"click"],[1,"task-badge","low"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"spinner"],[1,"cancel-request-btn",3,"click"],[1,"cancel-link",3,"click"],[1,"result-card",3,"high-match"],[1,"result-card"],[1,"result-header"],[1,"type-badge"],[1,"similarity"],[1,"result-question"],[1,"result-answer"],[1,"result-actions"],[1,"action-btn","positive",3,"click"],[1,"action-btn","negative",3,"click"],[1,"add-btn",3,"click"],[1,"learning-event"],[1,"event-icon"],[1,"event-content"],[1,"event-desc"],[1,"event-time"],[1,"hint"],[1,"gaps-header"],[1,"gap-count"],[1,"gaps-actions-bar"],["title","\u4E00\u9375\u6E05\u7406\u6240\u6709\u5783\u573E\u6578\u64DA",1,"batch-btn","cleanup",3,"click"],[1,"batch-btn","delete-selected"],[1,"gaps-hint"],[1,"gaps-list"],[1,"gap-card",3,"selected"],[1,"gaps-more"],[1,"batch-btn","delete-selected",3,"click"],[1,"gap-card"],[1,"gap-select"],["type","checkbox",3,"change","checked"],[1,"gap-main"],[1,"gap-top"],[1,"gap-query",3,"title"],[1,"gap-tags"],[1,"tag","hot"],[1,"tag","category",3,"class"],[1,"tag","hits"],[1,"gap-suggestion"],[1,"gap-actions"],["title","\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848",1,"gap-btn","suggest"],["title","\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",1,"gap-btn","resolve",3,"click"],["title","\u76F4\u63A5\u522A\u9664",1,"gap-btn","delete",3,"click"],[1,"tag","category"],[1,"suggestion-label"],[1,"suggestion-text"],["title","\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848",1,"gap-btn","suggest",3,"click"],[1,"empty-icon"],[1,"health-dashboard"],[1,"health-overview"],[1,"health-score-circle"],[1,"score-value"],[1,"score-label"],[1,"health-metrics"],[1,"metric"],[1,"metric-label"],[1,"metric-bar"],[1,"bar-fill"],[1,"metric-value"],[1,"health-suggestions"],[1,"suggestion-item"],[1,"priority-badge"],[1,"distribution-grid"],[1,"type-card"],[1,"type-name"],[1,"type-stats"],[1,"count"],[1,"score"],[1,"type-bar"],[1,"guided-dialog"],[1,"guided-header"],[1,"step-indicator"],[1,"close-btn",3,"click"],[1,"guided-content"],[1,"question-text"],[1,"options-grid"],[1,"options-grid","multi"],[1,"guided-footer"],[1,"cancel-btn",3,"click"],[1,"next-btn",3,"click","disabled"],[1,"option-btn",3,"selected"],[1,"option-btn",3,"click"],[1,"guided-textarea",3,"ngModelChange","ngModel","placeholder"],[1,"suggestions"],[1,"label"],[1,"suggestion-chip"],[1,"suggestion-chip",3,"click"]],template:function(t,n){if(t&1&&(r(0,"div",0),da(1,rw,10,3,"div",1),r(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F9E0}"),s(),r(6,"span"),l(7,"AI \u77E5\u8B58\u5927\u8166"),s(),r(8,"span",5),l(9,"2.0"),s()(),r(10,"div",6)(11,"div",7)(12,"span",8),l(13),s(),r(14,"span",9),l(15,"\u77E5\u8B58\u7E3D\u6578"),s()(),r(16,"div",7)(17,"span",8),l(18),s(),r(19,"span",9),l(20,"\u547D\u4E2D\u7387"),s()(),r(21,"div",7)(22,"span",8),l(23),s(),r(24,"span",9),l(25,"\u4ECA\u65E5\u5B78\u7FD2"),s()(),r(26,"div",10)(27,"span",8),l(28),s(),r(29,"span",9),l(30,"\u5065\u5EB7\u5EA6"),s()()()(),r(31,"div",11)(32,"div",12)(33,"h3",13)(34,"span",14),l(35,"\u{1F4AC}"),s(),l(36," \u5C0D\u8A71\u5F0F\u77E5\u8B58\u69CB\u5EFA "),s(),r(37,"div",15)(38,"div",16)(39,"div",17),l(40," \u544A\u8A34\u6211\u4F60\u7684\u696D\u52D9\uFF0C\u6211\u4F86\u5E6B\u4F60\u69CB\u5EFA\u77E5\u8B58\u5EAB... "),s()(),r(41,"textarea",18),W("ngModelChange",function(a){return K(n.businessDescription,a)||(n.businessDescription=a),a}),s(),S(42,sw,5,4,"div",19),r(43,"button",20),x("click",function(){return n.startBuild()}),S(44,aw,2,0)(45,lw,3,0),s(),S(46,cw,2,0,"button",21),s(),r(47,"div",22)(48,"h4"),l(49,"\u6216\u8005\u5FEB\u901F\u5C0E\u5165"),s(),r(50,"div",23)(51,"button",24),x("click",function(){return n.startGuidedBuild()}),r(52,"span",14),l(53,"\u{1F3AF}"),s(),l(54," \u5F15\u5C0E\u5F0F\u69CB\u5EFA (\u63A8\u85A6) "),s(),r(55,"button",25),x("click",function(){return n.importFromUrl()}),r(56,"span",14),l(57,"\u{1F310}"),s(),l(58," \u5F9E\u7DB2\u9801\u5C0E\u5165 "),s(),r(59,"button",25),x("click",function(){return n.importFromDocument()}),r(60,"span",14),l(61,"\u{1F4C4}"),s(),l(62," \u4E0A\u50B3\u6587\u6A94 "),s(),r(63,"button",25),x("click",function(){return n.openTemplateSelector()}),r(64,"span",14),l(65,"\u{1F4DA}"),s(),l(66," \u884C\u696D\u6A21\u677F "),s()()()(),r(67,"div",26)(68,"h3",13)(69,"span",14),l(70,"\u{1F50D}"),s(),l(71," \u8A9E\u7FA9\u641C\u7D22 "),s(),r(72,"div",27)(73,"input",28),W("ngModelChange",function(a){return K(n.searchQuery,a)||(n.searchQuery=a),a}),x("keyup.enter",function(){return n.search()}),s(),r(74,"button",29),x("click",function(){return n.search()}),l(75," \u641C\u7D22 "),s()(),r(76,"div",30),S(77,dw,5,0,"div",31)(78,mw,2,0)(79,pw,7,0,"div",32)(80,gw,5,0,"div",33),s()(),r(81,"div",34)(82,"h3",13)(83,"span",14),l(84,"\u{1F534}"),s(),r(85,"span",35),l(86,"LIVE"),s(),l(87," \u5BE6\u6642\u5B78\u7FD2 "),s(),r(88,"div",36),S(89,bw,2,0)(90,xw,5,0,"div",37),s(),r(91,"div",38)(92,"h4"),l(93,"\u77E5\u8B58\u7DAD\u8B77"),s(),r(94,"div",39)(95,"button",40),x("click",function(){return n.cleanupKnowledge()}),l(96," \u{1F9F9} \u6E05\u7406\u4F4E\u8CEA\u91CF "),s(),r(97,"button",40),x("click",function(){return n.mergeKnowledge()}),l(98," \u{1F504} \u5408\u4F75\u76F8\u4F3C "),s(),r(99,"button",40),x("click",function(){return n.refreshStats()}),l(100," \u{1F4CA} \u5237\u65B0\u7D71\u8A08 "),s()()()()(),S(101,Tw,18,3,"div",41)(102,kw,5,0,"div",42),S(103,Nw,1,1),S(104,Ow,6,0,"div",43),S(105,Kw,21,7,"div",44),s()),t&2){let o,a,d,m;c(),V("ngIf",n.hasPendingTasks()),c(12),A(n.ragService.totalKnowledge()),c(5),D("",n.ragService.hitRate(),"%"),c(5),D("+",n.ragService.todayLearned()),c(3),I("healthy",n.ragService.healthScore()>=70),c(2),D("",n.ragService.healthScore(),"%"),c(13),z("ngModel",n.businessDescription),c(),w((o=n.ragService.buildProgress())?42:-1,o),c(),V("disabled",!n.businessDescription||n.ragService.isLoading()),c(),w(n.ragService.isLoading()&&n.ragService.currentRequest()==="build"?44:45),c(2),w(n.ragService.isLoading()&&n.ragService.currentRequest()==="build"?46:-1),c(27),z("ngModel",n.searchQuery),c(),V("disabled",!n.searchQuery),c(3),w(n.ragService.isLoading()&&n.ragService.currentRequest()==="search"?77:n.ragService.searchResults().length>0?78:n.searchQuery&&!n.ragService.isLoading()?79:80),c(12),w(n.ragService.learningEvents().length>0?89:90),c(12),w(n.ragService.knowledgeGaps().length>0?101:102),c(2),w((a=n.ragService.healthReport())?103:-1,a),c(),w((d=n.ragService.stats())?104:-1,d),c(),w((m=n.ragService.guidedQuestion())?105:-1,m)}},dependencies:[te,ha,me,xe,_e,Ce],styles:[".ai-brain-container[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.task-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#a855f726,#3b82f626);border:1px solid rgba(168,85,247,.3);border-radius:16px;padding:16px 20px;margin-bottom:20px}.task-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:16px;font-weight:600;color:#e0e0e0;margin-bottom:12px}.task-icon[_ngcontent-%COMP%]{font-size:18px}.task-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.task-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 14px;background:#0000004d;border-radius:10px;cursor:pointer;transition:all .2s}.task-item[_ngcontent-%COMP%]:hover{background:#00000080;transform:translate(4px)}.task-badge[_ngcontent-%COMP%]{font-size:12px}.task-text[_ngcontent-%COMP%]{flex:1;font-size:14px;color:#ccc}.task-action[_ngcontent-%COMP%]{font-size:12px;color:#a855f7;font-weight:500}.task-item.priority-high[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#f87171}.task-item.priority-medium[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#fbbf24}.task-item.priority-low[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%]{color:#34d399}.brain-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding:16px 24px;background:#ffffff0d;border-radius:16px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.brain-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700}.brain-icon[_ngcontent-%COMP%]{font-size:32px}.version-badge[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600}.brain-stats[_ngcontent-%COMP%]{display:flex;gap:32px}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-value[_ngcontent-%COMP%]{display:block;font-size:24px;font-weight:700;color:#667eea}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-item.health[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f59e0b}.stat-item.health.healthy[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#10b981}.brain-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:24px;margin-bottom:24px}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px;font-size:16px;font-weight:600}.live-badge[_ngcontent-%COMP%]{background:#ef4444;padding:2px 8px;border-radius:4px;font-size:10px;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.build-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.conversation-builder[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.chat-bubble.ai[_ngcontent-%COMP%]{background:#667eea33;padding:12px 16px;border-radius:16px 16px 16px 4px;font-size:14px}.business-input[_ngcontent-%COMP%]{background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;color:#fff;font-size:14px;resize:none}.business-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.build-progress[_ngcontent-%COMP%]{padding:12px;background:#667eea1a;border-radius:8px}.progress-bar[_ngcontent-%COMP%]{height:4px;background:#ffffff1a;border-radius:2px;overflow:hidden;margin-bottom:8px}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);transition:width .3s}.progress-text[_ngcontent-%COMP%]{font-size:12px;color:#888}.build-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s}.build-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 20px #667eea66}.build-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.quick-import[_ngcontent-%COMP%]{margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,.1)}.quick-import[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:12px}.import-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.import-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 14px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:13px;cursor:pointer;transition:all .2s}.import-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#667eea}.import-btn.guided[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea33,#764ba233);border-color:#667eea}.search-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.search-box[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:12px 16px;background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:14px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.search-btn[_ngcontent-%COMP%]{padding:12px 20px;background:#667eea;border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer}.search-btn[_ngcontent-%COMP%]:disabled{opacity:.5}.search-results[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.result-card[_ngcontent-%COMP%]{background:#0003;border:1px solid rgba(255,255,255,.05);border-radius:12px;padding:14px;margin-bottom:12px}.result-card.high-match[_ngcontent-%COMP%]{border-color:#10b981}.result-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.type-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;background:#667eea33;color:#667eea}.similarity[_ngcontent-%COMP%]{font-size:12px;color:#10b981}.result-question[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px;font-size:14px}.result-answer[_ngcontent-%COMP%]{font-size:13px;color:#aaa;line-height:1.5}.result-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:12px}.action-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;transition:all .2s}.action-btn.positive[_ngcontent-%COMP%]{background:#10b9811a;border:1px solid rgba(16,185,129,.3);color:#10b981}.action-btn.negative[_ngcontent-%COMP%]{background:#ef44441a;border:1px solid rgba(239,68,68,.3);color:#ef4444}.action-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.empty-state[_ngcontent-%COMP%], .placeholder-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#888}.empty-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .placeholder-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px}.add-btn[_ngcontent-%COMP%]{margin-top:12px;padding:10px 20px;background:#667eea;border:none;border-radius:8px;color:#fff;cursor:pointer}.learning-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.learning-feed[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.learning-event[_ngcontent-%COMP%]{display:flex;gap:12px;padding:10px;background:#0003;border-radius:8px;margin-bottom:8px}.event-icon[_ngcontent-%COMP%]{font-size:20px}.event-desc[_ngcontent-%COMP%]{font-size:13px}.event-time[_ngcontent-%COMP%]{font-size:11px;color:#666}.empty-learning[_ngcontent-%COMP%]{text-align:center;padding:30px;color:#666}.empty-learning[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:12px;color:#555}.maintenance-section[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1)}.maintenance-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:12px}.maintenance-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.maint-btn[_ngcontent-%COMP%]{padding:8px 12px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#aaa;font-size:12px;cursor:pointer;transition:all .2s}.maint-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.knowledge-distribution[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px}.knowledge-distribution[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:16px;font-size:16px}.distribution-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}.type-card[_ngcontent-%COMP%]{background:#0003;border-radius:8px;padding:12px}.type-name[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.type-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;color:#888;margin-bottom:8px}.type-bar[_ngcontent-%COMP%]{height:4px;background:#ffffff1a;border-radius:2px;overflow:hidden}.bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:2px}.spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.cancel-request-btn[_ngcontent-%COMP%]{display:block;width:100%;margin-top:8px;padding:10px;background:#ef444433;border:1px solid rgba(239,68,68,.4);border-radius:8px;color:#ef4444;font-size:13px;cursor:pointer;transition:all .2s}.cancel-request-btn[_ngcontent-%COMP%]:hover{background:#ef44444d}.cancel-link[_ngcontent-%COMP%]{display:block;margin-top:8px;background:none;border:none;color:#888;font-size:12px;cursor:pointer;text-decoration:underline}.cancel-link[_ngcontent-%COMP%]:hover{color:#ef4444}@media(max-width:1200px){.brain-content[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.learning-section[_ngcontent-%COMP%]{grid-column:span 2}}@media(max-width:768px){.brain-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.learning-section[_ngcontent-%COMP%]{grid-column:auto}.brain-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.brain-stats[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}}.gaps-section[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef444414,#a855f714);border:1px solid rgba(239,68,68,.2);border-radius:16px;padding:20px;margin-bottom:24px}.gaps-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.gap-count[_ngcontent-%COMP%]{color:#ef4444;font-weight:700}.gaps-actions-bar[_ngcontent-%COMP%]{display:flex;gap:8px}.gaps-hint[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:16px}.gaps-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.gap-card[_ngcontent-%COMP%]{display:flex;gap:12px;background:#0000004d;border-radius:12px;padding:12px;transition:all .2s;border:1px solid transparent}.gap-card[_ngcontent-%COMP%]:hover{background:#0006;border-color:#a855f74d}.gap-card.selected[_ngcontent-%COMP%]{background:#a855f726;border-color:#a855f780}.gap-select[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding-top:4px}.gap-select[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:#a855f7}.gap-main[_ngcontent-%COMP%]{flex:1;min-width:0}.gap-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:8px}.gap-query[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;flex:1;line-height:1.4}.gap-tags[_ngcontent-%COMP%]{display:flex;gap:6px;flex-shrink:0}.tag[_ngcontent-%COMP%]{font-size:11px;padding:2px 8px;border-radius:10px;white-space:nowrap}.tag.hot[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.tag.hits[_ngcontent-%COMP%]{background:#64748b4d;color:#94a3b8}.tag.category[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.tag.cat-price[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.tag.cat-process[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.tag.cat-product[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.tag.cat-support[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gap-suggestion[_ngcontent-%COMP%]{display:flex;gap:6px;font-size:12px;color:#888;margin-bottom:8px;padding:6px 10px;background:#a855f71a;border-radius:6px}.suggestion-label[_ngcontent-%COMP%]{color:#a855f7;flex-shrink:0}.suggestion-text[_ngcontent-%COMP%]{color:#aaa}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:6px}.gap-btn[_ngcontent-%COMP%]{padding:4px 10px;border-radius:6px;border:none;font-size:12px;cursor:pointer;transition:all .2s}.gap-btn.suggest[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.gap-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.gap-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gap-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.batch-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:none;font-size:12px;cursor:pointer;transition:all .2s}.batch-btn.cleanup[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.batch-btn.delete-selected[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.gaps-more[_ngcontent-%COMP%]{text-align:center;padding:12px;color:#666;font-size:13px}.gaps-empty[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.gaps-empty[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:48px;display:block;margin-bottom:12px}.gaps-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.gap-card[_ngcontent-%COMP%]{background:#0000004d;border-radius:12px;padding:14px}.gap-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px}.gap-query[_ngcontent-%COMP%]{font-weight:600;color:#fff}.gap-hits[_ngcontent-%COMP%]{background:#ef4444;padding:2px 8px;border-radius:10px;font-size:11px}.gap-suggestion[_ngcontent-%COMP%]{background:#667eea1a;padding:10px;border-radius:8px;font-size:13px;color:#aaa;margin-bottom:10px}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.gap-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;border:none;transition:all .2s}.gap-btn.suggest[_ngcontent-%COMP%]{background:#667eea33;color:#667eea}.gap-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#10b981}.gap-btn.ignore[_ngcontent-%COMP%]{background:#6b728033;color:#9ca3af}.gap-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#ef4444}.gap-btn.delete[_ngcontent-%COMP%]:hover{background:#ef444466}.gap-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.batch-btn[_ngcontent-%COMP%]{margin-left:auto;padding:6px 12px;border:none;border-radius:8px;font-size:12px;cursor:pointer;transition:all .2s}.batch-btn.cleanup[_ngcontent-%COMP%]{background:#f59e0b33;color:#f59e0b}.batch-btn.cleanup[_ngcontent-%COMP%]:hover{background:#f59e0b66}.health-dashboard[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px;margin-bottom:24px}.health-overview[_ngcontent-%COMP%]{display:flex;gap:30px;align-items:center}.health-score-circle[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#0000004d;border:3px solid #667eea}.health-score-circle.healthy[_ngcontent-%COMP%]{border-color:#10b981}.health-score-circle.warning[_ngcontent-%COMP%]{border-color:#f59e0b}.health-score-circle.danger[_ngcontent-%COMP%]{border-color:#ef4444}.score-value[_ngcontent-%COMP%]{font-size:28px;font-weight:700}.score-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.health-metrics[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:12px}.metric[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.metric-label[_ngcontent-%COMP%]{width:60px;font-size:13px;color:#888}.metric-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:#ffffff1a;border-radius:4px;overflow:hidden}.metric-bar[_ngcontent-%COMP%]   .bar-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:4px}.metric-value[_ngcontent-%COMP%]{width:40px;text-align:right;font-size:13px;font-weight:600}.health-suggestions[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1)}.health-suggestions[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;margin-bottom:12px}.suggestion-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#0003;border-radius:8px;margin-bottom:8px;font-size:13px}.guided-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000}.guided-dialog[_ngcontent-%COMP%]{background:#1a1a2e;border-radius:20px;width:90%;max-width:600px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}.guided-header[_ngcontent-%COMP%]{padding:20px;border-bottom:1px solid rgba(255,255,255,.1);position:relative}.step-indicator[_ngcontent-%COMP%]{font-size:12px;color:#667eea;margin-bottom:4px;display:block}.guided-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}.close-btn[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;background:none;border:none;color:#888;font-size:20px;cursor:pointer}.guided-content[_ngcontent-%COMP%]{padding:20px;flex:1;overflow-y:auto}.question-text[_ngcontent-%COMP%]{font-size:16px;margin-bottom:20px}.options-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}.options-grid.multi[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}.option-btn[_ngcontent-%COMP%]{padding:14px;background:#ffffff0d;border:2px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:14px;cursor:pointer;transition:all .2s;text-align:left}.option-btn[_ngcontent-%COMP%]:hover{border-color:#667eea}.option-btn.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea33}.guided-textarea[_ngcontent-%COMP%]{width:100%;min-height:120px;padding:14px;background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:14px;resize:vertical}.suggestions[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}.suggestions[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#888}.suggestion-chip[_ngcontent-%COMP%]{padding:4px 10px;background:#667eea33;border:none;border-radius:12px;color:#667eea;font-size:12px;cursor:pointer}.guided-footer[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid rgba(255,255,255,.1);display:flex;justify-content:flex-end;gap:12px}.cancel-btn[_ngcontent-%COMP%]{padding:10px 20px;background:transparent;border:1px solid rgba(255,255,255,.2);border-radius:8px;color:#888;cursor:pointer}.next-btn[_ngcontent-%COMP%]{padding:10px 24px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer}.next-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})}};var Ww=(i,e)=>e.id;function Jw(i,e){if(i&1){let t=M();r(0,"button",38),x("click",function(){v(t);let o=g();return b(o.deleteSelected())}),l(1),s(),r(2,"button",39),x("click",function(){v(t);let o=g();return b(o.batchResolve())}),l(3," \u2705 \u6279\u91CF\u63A1\u7528 "),s()}if(i&2){let t=g();c(),D(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedIds().length,") ")}}function Qw(i,e){i&1&&(r(0,"div",36),k(1,"span",40),r(2,"span"),l(3,"\u8F09\u5165\u4E2D..."),s()())}function Yw(i,e){i&1&&(r(0,"div",37)(1,"span",41),l(2,"\u2728"),s(),r(3,"h3"),l(4,"\u6C92\u6709\u5F85\u8655\u7406\u7684\u77E5\u8B58\u7F3A\u53E3"),s(),r(5,"p"),l(6,"\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01"),s()())}function Xw(i,e){if(i&1&&(r(0,"div",52)(1,"span",61),l(2,"\u{1F4A1} AI:"),s(),l(3),s()),i&2){let t=g().$implicit,n=g(2);c(3),D(" ",n.truncateText(t.suggestedAnswer,100)," ")}}function Zw(i,e){i&1&&(r(0,"span",55),l(1,"\u{1F525}"),s())}function jw(i,e){if(i&1){let t=M();r(0,"button",62),x("click",function(){v(t);let o=g().$implicit,a=g(2);return b(a.generateAnswer(o))}),l(1," \u{1F916} "),s()}}function eE(i,e){if(i&1){let t=M();r(0,"div",44)(1,"div",45)(2,"input",46),x("change",function(){let o=v(t).$implicit,a=g(2);return b(a.toggleSelect(o.id))}),s()(),r(3,"div",47),l(4),s(),r(5,"div",48)(6,"span",49),l(7),s()(),r(8,"div",50)(9,"div",51),l(10),s(),S(11,Xw,4,1,"div",52),s(),r(12,"div",53)(13,"span",54),l(14),s(),S(15,Zw,2,0,"span",55),s(),r(16,"div",56),l(17),s(),r(18,"div",57),S(19,jw,2,0,"button",58),r(20,"button",59),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.resolveGap(o))}),l(21," \u2705 "),s(),r(22,"button",60),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.deleteGap(o))}),l(23," \u{1F5D1}\uFE0F "),s()()()}if(i&2){let t=e.$implicit,n=e.$index,o=g(2);I("selected",o.isSelected(t.id)),c(2),V("checked",o.isSelected(t.id)),c(2),A((o.currentPage()-1)*o.pageSize+n+1),c(2),de("cat-"+(t.category||"other")),c(),D(" ",o.getCategoryIcon(t.category)," "),c(2),V("title",t.query),c(),D(" ",o.truncateText(t.query,80)," "),c(),w(t.suggestedAnswer?11:-1),c(2),I("hot",t.hitCount>=5),c(),D(" ",t.hitCount,"\u6B21 "),c(),w(t.hitCount>=5?15:-1),c(2),D(" ",o.formatTime(t.createdAt)," "),c(2),w(t.suggestedAnswer?-1:19)}}function tE(i,e){if(i&1){let t=M();r(0,"div",43)(1,"button",63),x("click",function(){v(t);let o=g(2);return b(o.goToPage(o.currentPage()-1))}),l(2," \u2190 \u4E0A\u4E00\u9801 "),s(),r(3,"span",64),l(4),s(),r(5,"button",63),x("click",function(){v(t);let o=g(2);return b(o.goToPage(o.currentPage()+1))}),l(6," \u4E0B\u4E00\u9801 \u2192 "),s()()}if(i&2){let t=g(2);c(),V("disabled",t.currentPage()===1),c(3),st(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801 \uFF08\u5171 ",t.filteredGaps().length," \u689D\uFF09 "),c(),V("disabled",t.currentPage()===t.totalPages())}}function nE(i,e){if(i&1&&($(0,eE,24,16,"div",42,Ww),S(2,tE,7,5,"div",43)),i&2){let t=g();H(t.paginatedGaps()),c(2),w(t.totalPages()>1?2:-1)}}var er=class i{constructor(){this.ragService=O(wt);this.dialogService=O(bt);this.toastService=O(ue);this.isLoading=_(!1);this.gaps=_([]);this.selectedIds=_([]);this.currentPage=_(1);this.pageSize=20;this.categoryFilter="all";this.sortOption="hitCount";this.filteredGaps=G(()=>{let e=[...this.gaps()];return this.categoryFilter!=="all"&&(e=e.filter(t=>(t.category||"other")===this.categoryFilter)),e.sort((t,n)=>{switch(this.sortOption){case"hitCount":return n.hitCount-t.hitCount;case"createdAt":return new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime();case"category":return(t.category||"z").localeCompare(n.category||"z");default:return 0}}),e});this.paginatedGaps=G(()=>{let e=(this.currentPage()-1)*this.pageSize;return this.filteredGaps().slice(e,e+this.pageSize)});this.totalPages=G(()=>Math.ceil(this.filteredGaps().length/this.pageSize));this.totalGaps=G(()=>this.gaps().length);this.hotGapsCount=G(()=>this.gaps().filter(e=>e.hitCount>=5).length);this.categoryStats=G(()=>{let e={price:0,process:0,product:0,support:0,other:0};return this.gaps().forEach(t=>{let n=t.category||"other";e[n]!==void 0&&e[n]++}),e})}ngOnInit(){this.loadGaps()}async loadGaps(){this.isLoading.set(!0);try{await this.ragService.getKnowledgeGaps(),this.gaps.set(this.ragService.knowledgeGaps())}finally{this.isLoading.set(!1)}}refreshGaps(){this.loadGaps(),this.toastService.success("\u5DF2\u5237\u65B0")}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(e){return this.selectedIds().includes(e)}toggleSelect(e){let t=this.selectedIds();t.includes(e)?this.selectedIds.set(t.filter(n=>n!==e)):this.selectedIds.set([...t,e])}isAllSelected(){let e=this.paginatedGaps();return e.length>0&&e.every(t=>this.selectedIds().includes(t.id))}isPartialSelected(){let e=this.paginatedGaps(),t=e.filter(n=>this.selectedIds().includes(n.id));return t.length>0&&t.length<e.length}toggleSelectAll(){let e=this.paginatedGaps();if(this.isAllSelected()){let t=e.map(n=>n.id);this.selectedIds.set(this.selectedIds().filter(n=>!t.includes(n)))}else{let t=[...new Set([...this.selectedIds(),...e.map(n=>n.id)])];this.selectedIds.set(t)}}generateAnswer(e){this.ragService.suggestGapAnswer(e.id,e.query),this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...")}resolveGap(e){let t=e.suggestedAnswer||"";this.dialogService.prompt({title:"\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",message:`\u554F\u984C: "${this.truncateText(e.query,60)}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,placeholder:t||"\u5C08\u696D\u7684\u56DE\u7B54...",defaultValue:t,confirmText:"\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",onConfirm:n=>{n&&(this.ragService.resolveGap(e.id,"faq",e.query,n),this.toastService.success("\u5DF2\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB"),this.loadGaps())}})}deleteGap(e){this.ragService.deleteGap(e.id),this.gaps.set(this.gaps().filter(t=>t.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664")}deleteSelected(){let e=this.selectedIds();e.length!==0&&(this.ragService.deleteGapsBatch(e),this.gaps.set(this.gaps().filter(t=>!e.includes(t.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D`))}batchResolve(){let e=this.paginatedGaps().filter(t=>this.selectedIds().includes(t.id)&&t.suggestedAnswer);if(e.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u6709 AI \u5EFA\u8B70\u7684\u7F3A\u53E3");return}e.forEach(t=>{this.ragService.resolveGap(t.id,"faq",t.query,t.suggestedAnswer)}),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u6279\u91CF\u63A1\u7528 ${e.length} \u689D`),this.loadGaps()}cleanupAllInvalid(){this.ragService.cleanupDuplicateGaps(),this.toastService.info("\u6B63\u5728\u6DF1\u5EA6\u6E05\u7406..."),setTimeout(()=>this.loadGaps(),1500)}goToPage(e){e>=1&&e<=this.totalPages()&&(this.currentPage.set(e),this.selectedIds.set([]))}truncateText(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}getCategoryIcon(e){return{price:"\u{1F4B0}",process:"\u{1F4CB}",product:"\u{1F4E6}",support:"\u{1F6E0}\uFE0F",other:"\u2753"}[e||"other"]||"\u2753"}formatTime(e){if(!e)return"";let t=new Date(e),o=new Date().getTime()-t.getTime();return o<6e4?"\u525B\u525B":o<36e5?`${Math.floor(o/6e4)} \u5206\u9418\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u6642\u524D`:o<6048e5?`${Math.floor(o/864e5)} \u5929\u524D`:t.toLocaleDateString("zh-TW")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-knowledge-gaps"]],decls:93,vars:11,consts:[[1,"gaps-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","cleanup",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","hot"],[1,"stat-card","price"],[1,"stat-card","process"],[1,"stat-card","product"],[1,"filter-bar"],[1,"filter-left"],[1,"select-all"],["type","checkbox",3,"change","checked","indeterminate"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","price"],["value","process"],["value","product"],["value","support"],["value","other"],["value","hitCount"],["value","createdAt"],["value","category"],[1,"filter-right"],[1,"gaps-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"batch-btn","resolve",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"gap-row",3,"selected"],[1,"pagination"],[1,"gap-row"],[1,"gap-checkbox"],["type","checkbox",3,"change","checked"],[1,"gap-index"],[1,"gap-category"],[1,"category-tag"],[1,"gap-content"],[1,"gap-query",3,"title"],[1,"gap-answer"],[1,"gap-hits"],[1,"hits-badge"],[1,"hot-tag"],[1,"gap-time"],[1,"gap-actions"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate"],["title","\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",1,"btn-icon","resolve",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"answer-label"],["title","AI \u751F\u6210\u7B54\u6848",1,"btn-icon","generate",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u2753"),s(),l(6," \u77E5\u8B58\u7F3A\u53E3\u7BA1\u7406 "),s(),r(7,"p",5),l(8,"\u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u7B54\u6848\u7684\u554F\u984C\uFF0C\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C\u53EF\u63D0\u5347 AI \u56DE\u8986\u8CEA\u91CF"),s()(),r(9,"div",6)(10,"button",7),x("click",function(){return n.cleanupAllInvalid()}),l(11," \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 "),s(),r(12,"button",8),x("click",function(){return n.refreshGaps()}),l(13," \u{1F504} \u5237\u65B0 "),s()()(),r(14,"div",9)(15,"div",10)(16,"div",11),l(17,"\u{1F4CB}"),s(),r(18,"div",12)(19,"span",13),l(20),s(),r(21,"span",14),l(22,"\u5F85\u8655\u7406"),s()()(),r(23,"div",15)(24,"div",11),l(25,"\u{1F525}"),s(),r(26,"div",12)(27,"span",13),l(28),s(),r(29,"span",14),l(30,"\u71B1\u9580\u554F\u984C"),s()()(),r(31,"div",16)(32,"div",11),l(33,"\u{1F4B0}"),s(),r(34,"div",12)(35,"span",13),l(36),s(),r(37,"span",14),l(38,"\u50F9\u683C\u76F8\u95DC"),s()()(),r(39,"div",17)(40,"div",11),l(41,"\u{1F4CB}"),s(),r(42,"div",12)(43,"span",13),l(44),s(),r(45,"span",14),l(46,"\u6D41\u7A0B\u76F8\u95DC"),s()()(),r(47,"div",18)(48,"div",11),l(49,"\u{1F4E6}"),s(),r(50,"div",12)(51,"span",13),l(52),s(),r(53,"span",14),l(54,"\u7522\u54C1\u76F8\u95DC"),s()()()(),r(55,"div",19)(56,"div",20)(57,"label",21)(58,"input",22),x("change",function(){return n.toggleSelectAll()}),s(),r(59,"span"),l(60,"\u5168\u9078"),s()(),r(61,"div",23)(62,"label"),l(63,"\u5206\u985E\uFF1A"),s(),r(64,"select",24),W("ngModelChange",function(a){return K(n.categoryFilter,a)||(n.categoryFilter=a),a}),x("change",function(){return n.applyFilters()}),r(65,"option",25),l(66,"\u5168\u90E8"),s(),r(67,"option",26),l(68,"\u{1F4B0} \u50F9\u683C"),s(),r(69,"option",27),l(70,"\u{1F4CB} \u6D41\u7A0B"),s(),r(71,"option",28),l(72,"\u{1F4E6} \u7522\u54C1"),s(),r(73,"option",29),l(74,"\u{1F6E0}\uFE0F \u552E\u5F8C"),s(),r(75,"option",30),l(76,"\u2753 \u5176\u4ED6"),s()()(),r(77,"div",23)(78,"label"),l(79,"\u6392\u5E8F\uFF1A"),s(),r(80,"select",24),W("ngModelChange",function(a){return K(n.sortOption,a)||(n.sortOption=a),a}),x("change",function(){return n.applyFilters()}),r(81,"option",31),l(82,"\u{1F525} \u71B1\u5EA6"),s(),r(83,"option",32),l(84,"\u{1F550} \u6642\u9593"),s(),r(85,"option",33),l(86,"\u{1F4C2} \u5206\u985E"),s()()()(),r(87,"div",34),S(88,Jw,4,1),s()(),r(89,"div",35),S(90,Qw,4,0,"div",36)(91,Yw,7,0,"div",37)(92,nE,3,1),s()()),t&2&&(c(20),A(n.totalGaps()),c(8),A(n.hotGapsCount()),c(8),A(n.categoryStats().price),c(8),A(n.categoryStats().process),c(8),A(n.categoryStats().product),c(6),V("checked",n.isAllSelected())("indeterminate",n.isPartialSelected()),c(6),z("ngModel",n.categoryFilter),c(16),z("ngModel",n.sortOption),c(8),w(n.selectedIds().length>0?88:-1),c(2),w(n.isLoading()?90:n.filteredGaps().length===0?91:92))},dependencies:[te,me,Qe,Ye,lt,_e,Ce],styles:[".gaps-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.cleanup[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08);transition:all .2s}.stat-card[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#ffffff26}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.hot[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.stat-card.price[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.process[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.select-all[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;color:#aaa}.select-all[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;cursor:pointer}.filter-right[_ngcontent-%COMP%]{display:flex;gap:10px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.batch-btn.resolve[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.batch-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.gaps-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.gap-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 40px 50px 1fr 80px 80px 100px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.gap-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.gap-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.gap-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.gap-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7;cursor:pointer}.gap-index[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-category[_ngcontent-%COMP%]{text-align:center}.category-tag[_ngcontent-%COMP%]{font-size:18px}.gap-content[_ngcontent-%COMP%]{min-width:0}.gap-query[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;line-height:1.4;margin-bottom:4px}.gap-answer[_ngcontent-%COMP%]{font-size:12px;color:#888;padding:6px 10px;background:#a855f71a;border-radius:6px;margin-top:6px}.answer-label[_ngcontent-%COMP%]{color:#a855f7;margin-right:4px}.gap-hits[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;justify-content:center}.hits-badge[_ngcontent-%COMP%]{padding:3px 8px;background:#64748b33;border-radius:10px;font-size:12px;color:#94a3b8}.hits-badge.hot[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.hot-tag[_ngcontent-%COMP%]{font-size:14px}.gap-time[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.gap-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}.btn-icon.generate[_ngcontent-%COMP%]{background:#a855f733}.btn-icon.resolve[_ngcontent-%COMP%]{background:#10b98133}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer;transition:all .2s}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media(max-width:900px){.gap-row[_ngcontent-%COMP%]{grid-template-columns:40px 40px 1fr 60px 80px}.gap-category[_ngcontent-%COMP%], .gap-time[_ngcontent-%COMP%]{display:none}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media(max-width:600px){.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.filter-left[_ngcontent-%COMP%], .filter-right[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.stats-overview[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}};var iE=(i,e)=>e.id;function oE(i,e){if(i&1){let t=M();r(0,"button",42),x("click",function(){v(t);let o=g();return b(o.deleteSelected())}),l(1),s()}if(i&2){let t=g();c(),D(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (",t.selectedIds().length,") ")}}function rE(i,e){i&1&&(r(0,"div",40),k(1,"span",43),r(2,"span"),l(3,"\u8F09\u5165\u4E2D..."),s()())}function sE(i,e){if(i&1){let t=M();r(0,"div",41)(1,"span",44),l(2,"\u{1F4DA}"),s(),r(3,"h3"),l(4,"\u66AB\u7121\u77E5\u8B58"),s(),r(5,"p"),l(6,"\u9EDE\u64CA\u300C\u6DFB\u52A0\u77E5\u8B58\u300D\u958B\u59CB\u69CB\u5EFA\u77E5\u8B58\u5EAB"),s(),r(7,"button",45),x("click",function(){v(t);let o=g();return b(o.addKnowledge())}),l(8,"\u2795 \u6DFB\u52A0\u77E5\u8B58"),s()()}}function aE(i,e){if(i&1){let t=M();r(0,"div",48)(1,"div",49)(2,"input",50),x("change",function(){let o=v(t).$implicit,a=g(2);return b(a.toggleSelect(o.id))}),s()(),r(3,"div",51)(4,"span",52),l(5),s()(),r(6,"div",53),l(7),s(),r(8,"div",54),l(9),s(),r(10,"div",55)(11,"span",56),l(12),s()(),r(13,"div",57),l(14),s(),r(15,"div",58)(16,"button",59),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.editKnowledge(o))}),l(17," \u270F\uFE0F "),s(),r(18,"button",60),x("click",function(){let o=v(t).$implicit,a=g(2);return b(a.deleteKnowledge(o))}),l(19," \u{1F5D1}\uFE0F "),s()()()}if(i&2){let t=e.$implicit,n=g(2);I("selected",n.isSelected(t.id)),c(2),V("checked",n.isSelected(t.id)),c(2),de("type-"+t.type),c(),Y(" ",n.getTypeIcon(t.type)," ",n.getTypeName(t.type)," "),c(),V("title",t.question),c(),D(" ",n.truncateText(t.question,60)," "),c(),V("title",t.answer),c(),D(" ",n.truncateText(t.answer,80)," "),c(2),I("high",t.successScore>=.7)("low",t.successScore<.4),c(),D(" ",(t.successScore*10).toFixed(1)," "),c(2),D(" ",t.useCount,"\u6B21 ")}}function lE(i,e){if(i&1){let t=M();r(0,"div",47)(1,"button",61),x("click",function(){v(t);let o=g(2);return b(o.goToPage(o.currentPage()-1))}),l(2," \u2190 \u4E0A\u4E00\u9801 "),s(),r(3,"span",62),l(4),s(),r(5,"button",61),x("click",function(){v(t);let o=g(2);return b(o.goToPage(o.currentPage()+1))}),l(6," \u4E0B\u4E00\u9801 \u2192 "),s()()}if(i&2){let t=g(2);c(),V("disabled",t.currentPage()===1),c(3),st(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801 \uFF08\u5171 ",t.filteredKnowledge().length," \u689D\uFF09 "),c(),V("disabled",t.currentPage()===t.totalPages())}}function cE(i,e){if(i&1&&($(0,aE,20,17,"div",46,iE),S(2,lE,7,5,"div",47)),i&2){let t=g();H(t.paginatedKnowledge()),c(2),w(t.totalPages()>1?2:-1)}}var tr=class i{constructor(){this.ragService=O(wt);this.dialogService=O(bt);this.toastService=O(ue);this.ipc=O(ye);this.isLoading=_(!1);this.knowledge=_([]);this.selectedIds=_([]);this.currentPage=_(1);this.pageSize=20;this.searchQuery="";this.typeFilter="all";this.sortOption="createdAt";this.filteredKnowledge=G(()=>{let e=[...this.knowledge()];if(this.searchQuery.trim()){let t=this.searchQuery.toLowerCase();e=e.filter(n=>n.question.toLowerCase().includes(t)||n.answer.toLowerCase().includes(t))}return this.typeFilter!=="all"&&(e=e.filter(t=>t.type===this.typeFilter)),e.sort((t,n)=>{switch(this.sortOption){case"createdAt":return new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime();case"useCount":return n.useCount-t.useCount;case"successScore":return n.successScore-t.successScore;case"type":return t.type.localeCompare(n.type);default:return 0}}),e});this.paginatedKnowledge=G(()=>{let e=(this.currentPage()-1)*this.pageSize;return this.filteredKnowledge().slice(e,e+this.pageSize)});this.totalPages=G(()=>Math.ceil(this.filteredKnowledge().length/this.pageSize));this.totalKnowledge=G(()=>this.knowledge().length);this.typeStats=G(()=>{let e={product:0,qa:0,script:0,faq:0,objection:0,greeting:0,closing:0};return this.knowledge().forEach(t=>{let n=t.type;e[n]!==void 0&&e[n]++}),e});this.avgScore=G(()=>{let e=this.knowledge();return e.length===0?0:e.reduce((t,n)=>t+n.successScore,0)/e.length})}ngOnInit(){this.loadKnowledge()}async loadKnowledge(){this.isLoading.set(!0);try{let e=await this.ipc.invoke("rag-get-all-knowledge",{});e?.success&&e.knowledge&&this.knowledge.set(e.knowledge.map(t=>({id:t.id,type:t.knowledge_type||t.type||"qa",question:t.question||"",answer:t.answer||"",context:t.context||"",successScore:t.success_score||t.successScore||.5,useCount:t.use_count||t.useCount||0,feedbackPositive:t.feedback_positive||0,feedbackNegative:t.feedback_negative||0,isActive:t.is_active!==!1,createdAt:t.created_at||t.createdAt||new Date().toISOString(),updatedAt:t.updated_at||t.updatedAt})))}catch(e){console.error("Failed to load knowledge:",e),this.toastService.error("\u8F09\u5165\u77E5\u8B58\u5931\u6557")}finally{this.isLoading.set(!1)}}applyFilters(){this.currentPage.set(1),this.selectedIds.set([])}isSelected(e){return this.selectedIds().includes(e)}toggleSelect(e){let t=this.selectedIds();t.includes(e)?this.selectedIds.set(t.filter(n=>n!==e)):this.selectedIds.set([...t,e])}addKnowledge(){this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:"\u8ACB\u8F38\u5165\u554F\u984C\uFF1A",placeholder:"\u4F8B\u5982\uFF1A\u8CBB\u7387\u662F\u591A\u5C11\uFF1F",confirmText:"\u4E0B\u4E00\u6B65",onConfirm:e=>{e&&this.dialogService.prompt({title:"\u6DFB\u52A0\u77E5\u8B58",message:`\u554F\u984C: "${e}"

\u8ACB\u8F38\u5165\u7B54\u6848\uFF1A`,placeholder:"\u5C08\u696D\u7684\u56DE\u7B54...",confirmText:"\u6DFB\u52A0",onConfirm:async t=>{if(t)try{await this.ipc.invoke("rag-add-knowledge",{type:"qa",question:e,answer:t}),this.toastService.success("\u6DFB\u52A0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u6DFB\u52A0\u5931\u6557")}}})}})}editKnowledge(e){this.dialogService.prompt({title:"\u7DE8\u8F2F\u77E5\u8B58",message:`\u554F\u984C: "${e.question}"

\u8ACB\u4FEE\u6539\u7B54\u6848\uFF1A`,placeholder:e.answer,defaultValue:e.answer,confirmText:"\u4FDD\u5B58",onConfirm:async t=>{if(t&&t!==e.answer)try{await this.ipc.invoke("rag-update-knowledge",{id:e.id,answer:t}),this.toastService.success("\u66F4\u65B0\u6210\u529F"),this.loadKnowledge()}catch{this.toastService.error("\u66F4\u65B0\u5931\u6557")}}})}async deleteKnowledge(e){try{await this.ipc.invoke("rag-delete-knowledge",{id:e.id}),this.knowledge.set(this.knowledge().filter(t=>t.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664")}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}async deleteSelected(){let e=this.selectedIds();if(e.length!==0)try{await this.ipc.invoke("rag-delete-knowledge-batch",{ids:e}),this.knowledge.set(this.knowledge().filter(t=>!e.includes(t.id))),this.selectedIds.set([]),this.toastService.success(`\u5DF2\u522A\u9664 ${e.length} \u689D`)}catch{this.toastService.error("\u522A\u9664\u5931\u6557")}}goToPage(e){e>=1&&e<=this.totalPages()&&this.currentPage.set(e)}truncateText(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}getTypeIcon(e){return{product:"\u{1F4E6}",qa:"\u{1F4AC}",script:"\u{1F4DC}",faq:"\u2753",objection:"\u{1F6E1}\uFE0F",greeting:"\u{1F44B}",closing:"\u{1F3AF}"}[e]||"\u{1F4DD}"}getTypeName(e){return{product:"\u7522\u54C1",qa:"\u554F\u7B54",script:"\u8A71\u8853",faq:"FAQ",objection:"\u7570\u8B70",greeting:"\u958B\u5834",closing:"\u6210\u4EA4"}[e]||e}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-knowledge-manage"]],decls:97,vars:10,consts:[[1,"knowledge-page"],[1,"page-header"],[1,"header-left"],[1,"page-title"],[1,"title-icon"],[1,"page-desc"],[1,"header-actions"],[1,"action-btn","add",3,"click"],[1,"action-btn","refresh",3,"click"],[1,"stats-overview"],[1,"stat-card","total"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","product"],[1,"stat-card","qa"],[1,"stat-card","script"],[1,"stat-card","score"],[1,"filter-bar"],[1,"filter-left"],[1,"search-box"],["type","text","placeholder","\u641C\u7D22\u77E5\u8B58...",3,"ngModelChange","input","ngModel"],[1,"filter-group"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","product"],["value","qa"],["value","script"],["value","faq"],["value","objection"],["value","greeting"],["value","closing"],["value","createdAt"],["value","useCount"],["value","successScore"],["value","type"],[1,"filter-right"],[1,"batch-btn","delete"],[1,"knowledge-list"],[1,"loading-state"],[1,"empty-state"],[1,"batch-btn","delete",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"add-btn",3,"click"],[1,"knowledge-row",3,"selected"],[1,"pagination"],[1,"knowledge-row"],[1,"item-checkbox"],["type","checkbox",3,"change","checked"],[1,"item-type"],[1,"type-tag"],[1,"item-question",3,"title"],[1,"item-answer",3,"title"],[1,"item-score"],[1,"score-badge"],[1,"item-usage"],[1,"item-actions"],["title","\u7DE8\u8F2F",1,"btn-icon","edit",3,"click"],["title","\u522A\u9664",1,"btn-icon","delete",3,"click"],[1,"page-btn",3,"click","disabled"],[1,"page-info"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"span",4),l(5,"\u{1F4DD}"),s(),l(6," \u77E5\u8B58\u7BA1\u7406 "),s(),r(7,"p",5),l(8,"\u67E5\u770B\u548C\u7BA1\u7406\u5DF2\u5C0E\u5165\u7684\u6240\u6709\u77E5\u8B58\uFF0C\u652F\u6301\u7DE8\u8F2F\u548C\u522A\u9664"),s()(),r(9,"div",6)(10,"button",7),x("click",function(){return n.addKnowledge()}),l(11," \u2795 \u6DFB\u52A0\u77E5\u8B58 "),s(),r(12,"button",8),x("click",function(){return n.loadKnowledge()}),l(13," \u{1F504} \u5237\u65B0 "),s()()(),r(14,"div",9)(15,"div",10)(16,"div",11),l(17,"\u{1F4DA}"),s(),r(18,"div",12)(19,"span",13),l(20),s(),r(21,"span",14),l(22,"\u77E5\u8B58\u7E3D\u6578"),s()()(),r(23,"div",15)(24,"div",11),l(25,"\u{1F4E6}"),s(),r(26,"div",12)(27,"span",13),l(28),s(),r(29,"span",14),l(30,"\u7522\u54C1\u4FE1\u606F"),s()()(),r(31,"div",16)(32,"div",11),l(33,"\u{1F4AC}"),s(),r(34,"div",12)(35,"span",13),l(36),s(),r(37,"span",14),l(38,"\u554F\u7B54"),s()()(),r(39,"div",17)(40,"div",11),l(41,"\u{1F4DC}"),s(),r(42,"div",12)(43,"span",13),l(44),s(),r(45,"span",14),l(46,"\u8A71\u8853"),s()()(),r(47,"div",18)(48,"div",11),l(49,"\u2B50"),s(),r(50,"div",12)(51,"span",13),l(52),s(),r(53,"span",14),l(54,"\u5E73\u5747\u8A55\u5206"),s()()()(),r(55,"div",19)(56,"div",20)(57,"div",21)(58,"input",22),W("ngModelChange",function(a){return K(n.searchQuery,a)||(n.searchQuery=a),a}),x("input",function(){return n.applyFilters()}),s()(),r(59,"div",23)(60,"label"),l(61,"\u985E\u578B\uFF1A"),s(),r(62,"select",24),W("ngModelChange",function(a){return K(n.typeFilter,a)||(n.typeFilter=a),a}),x("change",function(){return n.applyFilters()}),r(63,"option",25),l(64,"\u5168\u90E8"),s(),r(65,"option",26),l(66,"\u{1F4E6} \u7522\u54C1"),s(),r(67,"option",27),l(68,"\u{1F4AC} \u554F\u7B54"),s(),r(69,"option",28),l(70,"\u{1F4DC} \u8A71\u8853"),s(),r(71,"option",29),l(72,"\u2753 FAQ"),s(),r(73,"option",30),l(74,"\u{1F6E1}\uFE0F \u7570\u8B70\u8655\u7406"),s(),r(75,"option",31),l(76,"\u{1F44B} \u958B\u5834\u767D"),s(),r(77,"option",32),l(78,"\u{1F3AF} \u6210\u4EA4"),s()()(),r(79,"div",23)(80,"label"),l(81,"\u6392\u5E8F\uFF1A"),s(),r(82,"select",24),W("ngModelChange",function(a){return K(n.sortOption,a)||(n.sortOption=a),a}),x("change",function(){return n.applyFilters()}),r(83,"option",33),l(84,"\u{1F550} \u6642\u9593"),s(),r(85,"option",34),l(86,"\u{1F4CA} \u4F7F\u7528\u6B21\u6578"),s(),r(87,"option",35),l(88,"\u2B50 \u8A55\u5206"),s(),r(89,"option",36),l(90,"\u{1F4C2} \u985E\u578B"),s()()()(),r(91,"div",37),S(92,oE,2,1,"button",38),s()(),r(93,"div",39),S(94,rE,4,0,"div",40)(95,sE,9,0,"div",41)(96,cE,3,1),s()()),t&2&&(c(20),A(n.totalKnowledge()),c(8),A(n.typeStats().product),c(8),A(n.typeStats().qa),c(8),A(n.typeStats().script),c(8),A(n.avgScore().toFixed(1)),c(6),z("ngModel",n.searchQuery),c(4),z("ngModel",n.typeFilter),c(20),z("ngModel",n.sortOption),c(10),w(n.selectedIds().length>0?92:-1),c(2),w(n.isLoading()?94:n.filteredKnowledge().length===0?95:96))},dependencies:[te,me,Qe,Ye,xe,lt,_e,Ce],styles:[".knowledge-page[_ngcontent-%COMP%]{padding:24px;background:linear-gradient(135deg,#0f0f1a,#1a1a2e);min-height:100vh;color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;margin:0 0 8px}.title-icon[_ngcontent-%COMP%]{font-size:28px}.page-desc[_ngcontent-%COMP%]{color:#888;font-size:14px;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.action-btn.add[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.action-btn.refresh[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.action-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(-1px)}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:16px 20px;background:#ffffff0d;border-radius:14px;border:1px solid rgba(255,255,255,.08)}.stat-icon[_ngcontent-%COMP%]{font-size:28px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888}.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#a78bfa}.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#34d399}.stat-card.qa[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#60a5fa}.stat-card.script[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#fbbf24}.stat-card.score[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f87171}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#ffffff08;border-radius:12px;margin-bottom:16px}.filter-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 14px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px;width:200px}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;color:#888}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;background:#0000004d;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#fff;font-size:13px}.batch-btn[_ngcontent-%COMP%]{padding:8px 14px;border:none;border-radius:8px;font-size:13px;cursor:pointer}.batch-btn.delete[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.knowledge-list[_ngcontent-%COMP%]{background:#ffffff08;border-radius:14px;overflow:hidden}.knowledge-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 100px 1fr 1.5fr 60px 60px 80px;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);transition:all .15s}.knowledge-row[_ngcontent-%COMP%]:hover{background:#ffffff0a}.knowledge-row.selected[_ngcontent-%COMP%]{background:#a855f71a}.knowledge-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.item-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#a855f7}.type-tag[_ngcontent-%COMP%]{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:500;white-space:nowrap}.type-tag.type-product[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.type-tag.type-qa[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.type-tag.type-script[_ngcontent-%COMP%]{background:#eab30833;color:#fbbf24}.type-tag.type-faq[_ngcontent-%COMP%]{background:#a855f733;color:#c4b5fd}.type-tag.type-objection[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.type-tag.type-greeting[_ngcontent-%COMP%]{background:#06b6d433;color:#22d3ee}.type-tag.type-closing[_ngcontent-%COMP%]{background:#ec489933;color:#f472b6}.item-question[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0}.item-answer[_ngcontent-%COMP%]{font-size:13px;color:#888}.score-badge[_ngcontent-%COMP%]{padding:3px 8px;border-radius:10px;font-size:12px;background:#64748b33;color:#94a3b8}.score-badge.high[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.score-badge.low[_ngcontent-%COMP%]{background:#ef444433;color:#f87171}.item-usage[_ngcontent-%COMP%]{font-size:12px;color:#666;text-align:center}.item-actions[_ngcontent-%COMP%]{display:flex;gap:6px;justify-content:flex-end}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:8px;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}.btn-icon.edit[_ngcontent-%COMP%]{background:#3b82f633}.btn-icon.delete[_ngcontent-%COMP%]{background:#ef444433}.btn-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.3);transform:scale(1.08)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;padding:16px;border-top:1px solid rgba(255,255,255,.05)}.page-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#ffffff14;border:none;border-radius:8px;color:#aaa;font-size:13px;cursor:pointer}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff1f;color:#fff}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:13px;color:#888}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;display:block;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:0 0 8px;color:#e0e0e0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0 0 20px}.add-btn[_ngcontent-%COMP%]{padding:12px 24px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:10px;color:#fff;font-size:14px;cursor:pointer}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:60px;color:#888}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:#a855f7;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:1200px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 80px 1fr 60px 60px}.item-answer[_ngcontent-%COMP%]{display:none}}@media(max-width:768px){.stats-overview[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.filter-bar[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.knowledge-row[_ngcontent-%COMP%]{grid-template-columns:40px 1fr 60px 60px}.item-type[_ngcontent-%COMP%]{display:none}}"]})}};var dE=(i,e)=>e.stage,uE=(i,e)=>e.comboId;function mE(i,e){if(i&1&&(r(0,"span",48),l(1),s()),i&2){let t=g();I("bg-green-500/20",t.comparison().changes.sessions>0)("text-green-400",t.comparison().changes.sessions>0)("bg-red-500/20",t.comparison().changes.sessions<0)("text-red-400",t.comparison().changes.sessions<0),c(),Y(" ",t.comparison().changes.sessions>0?"+":"","",t.comparison().changes.sessions.toFixed(1),"% ")}}function pE(i,e){if(i&1&&(r(0,"span",48),l(1),s()),i&2){let t=g();I("bg-green-500/20",t.comparison().changes.conversions>0)("text-green-400",t.comparison().changes.conversions>0)("bg-red-500/20",t.comparison().changes.conversions<0)("text-red-400",t.comparison().changes.conversions<0),c(),Y(" ",t.comparison().changes.conversions>0?"+":"","",t.comparison().changes.conversions.toFixed(1),"% ")}}function gE(i,e){if(i&1&&(r(0,"span",48),l(1),s()),i&2){let t=g();I("bg-green-500/20",t.comparison().changes.revenue>0)("text-green-400",t.comparison().changes.revenue>0)("bg-red-500/20",t.comparison().changes.revenue<0)("text-red-400",t.comparison().changes.revenue<0),c(),Y(" ",t.comparison().changes.revenue>0?"+":"","",t.comparison().changes.revenue.toFixed(1),"% ")}}function hE(i,e){if(i&1&&(r(0,"div",28)(1,"div",49)(2,"span",50),l(3),s(),r(4,"span",17),l(5),s()(),r(6,"div",51),k(7,"div",52),s()()),i&2){let t=e.$implicit,n=e.$index,o=g();c(3),A(o.getStageName(t.stage)),c(2),Y("",t.count," (",t.rate.toFixed(1),"%)"),c(2),de(o.getFunnelColor(n)),X("width",t.rate,"%")}}function fE(i,e){i&1&&(r(0,"div",29),l(1," \u66AB\u7121\u6578\u64DA "),s())}function _E(i,e){i&1&&(r(0,"span",58),l(1,"\u2191"),s())}function CE(i,e){i&1&&(r(0,"span",59),l(1,"\u2193"),s())}function vE(i,e){if(i&1&&(r(0,"div",30)(1,"div",13)(2,"div",53)(3,"span",54),l(4),s(),r(5,"span",55),l(6),s()(),r(7,"div",56)(8,"span",57),l(9),s(),S(10,_E,2,0,"span",58)(11,CE,2,0,"span",59),s()(),r(12,"div",60)(13,"span",61),l(14),s(),r(15,"span",62),l(16),s()(),r(17,"div",63),k(18,"div",64),s()()),i&2){let t=e.$implicit,n=e.$index,o=g();c(4),A(o.getMedalEmoji(n)),c(2),A(t.comboName),c(3),D("",t.conversionRate.toFixed(1),"%"),c(),w(t.trend==="up"?10:t.trend==="down"?11:-1),c(4),Y(" ",t.totalSessions," \u6B21\u4F7F\u7528 \xB7 ",t.conversions," \u6B21\u8F49\u5316 "),c(2),D(" \u5E73\u5747 ",t.avgMessageCount.toFixed(0)," \u689D\u6D88\u606F "),c(2),X("width",t.conversionRate,"%")}}function bE(i,e){i&1&&(r(0,"div",29)(1,"div",65),l(2,"\u{1F4CA}"),s(),r(3,"div"),l(4,"\u958B\u59CB\u71DF\u92B7\u5F8C\u5C07\u986F\u793A\u89D2\u8272\u7D44\u5408\u6548\u679C"),s()())}function xE(i,e){if(i&1&&(r(0,"div",47)(1,"div",66)(2,"div",67),l(3,"\u{1F4A1}"),s(),r(4,"div",68)(5,"h4",69),l(6,"\u63A8\u85A6\u4F7F\u7528\u89D2\u8272\u7D44\u5408"),s(),r(7,"p",70),l(8," \u6839\u64DA\u6B77\u53F2\u6578\u64DA\uFF0C\u300C"),r(9,"span",71),l(10),s(),l(11,"\u300D \u7D44\u5408\u8868\u73FE\u6700\u4F73\uFF0C\u8F49\u5316\u7387\u9054 "),r(12,"span",57),l(13),s()()(),r(14,"button",72),l(15," \u4F7F\u7528\u6B64\u7D44\u5408 "),s()()()),i&2){let t=g();c(10),A(t.recommendedCombo().comboName),c(3),D("",t.recommendedCombo().conversionRate.toFixed(1),"%")}}var nr=class i{constructor(){this.analytics=O(Wa);this.selectedPeriod="week";this.todayDate=new Date().toLocaleDateString("zh-TW");this.totalStats=this.analytics.totalStats;this.todayStats=this.analytics.todayStats;this.topCombos=this.analytics.topRoleCombos;this.userProfiles=this.analytics.userProfiles;this.roleCombos=this.analytics.roleComboStats;this.todayReport=_(this.getEmptyReport());this.funnelData=_([]);this.comparison=_({current:{sessions:0,conversions:0,revenue:0},previous:{sessions:0,conversions:0,revenue:0},changes:{sessions:0,conversions:0,revenue:0}});this.recommendedCombo=_(null)}ngOnInit(){this.refreshData()}refreshData(){let e=this.analytics.generateDailyReport();this.todayReport.set(e),this.funnelData.set(e.funnel);let t=this.analytics.generatePeriodComparison(7);this.comparison.set(t);let n=this.analytics.recommendRoleCombo();this.recommendedCombo.set(n)}onPeriodChange(){this.refreshData()}getStageName(e){return{opening:"\u958B\u5834\u968E\u6BB5",building_trust:"\u5EFA\u7ACB\u4FE1\u4EFB",discovering_needs:"\u767C\u73FE\u9700\u6C42",presenting_value:"\u5C55\u793A\u50F9\u503C",handling_objections:"\u8655\u7406\u7570\u8B70",closing:"\u4FC3\u6210\u6210\u4EA4",follow_up:"\u8DDF\u9032\u670D\u52D9"}[e]||e}getFunnelColor(e){let t=["bg-blue-500","bg-cyan-500","bg-teal-500","bg-green-500","bg-lime-500","bg-amber-500","bg-orange-500"];return t[e%t.length]}getMedalEmoji(e){return["\u{1F947}","\u{1F948}","\u{1F949}","4\uFE0F\u20E3","5\uFE0F\u20E3"][e]||"\u{1F3C5}"}formatNumber(e){return e>=1e4?(e/1e4).toFixed(1)+"\u842C":e.toLocaleString()}getEmptyReport(){return{date:new Date().toISOString().split("T")[0],totalSessions:0,newUsers:0,activeUsers:0,conversions:0,conversionRate:0,totalRevenue:0,totalMessages:0,avgResponseTime:0,accountUsage:[],topRoleCombos:[],funnel:[]}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-marketing-report"]],decls:139,vars:21,consts:[[1,"marketing-report","p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-3"],[1,"text-slate-400","mt-1"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white",3,"ngModelChange","change","ngModel"],["value","today"],["value","week"],["value","month"],["value","all"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-600","flex","items-center","gap-2",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-blue-500/20","to-blue-600/10","border","border-blue-500/30","rounded-xl","p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-blue-400","text-2xl"],[1,"text-xs","px-2","py-1","rounded-full",3,"bg-green-500/20","text-green-400","bg-red-500/20","text-red-400"],[1,"text-3xl","font-bold","text-white"],[1,"text-sm","text-slate-400"],[1,"bg-gradient-to-br","from-green-500/20","to-green-600/10","border","border-green-500/30","rounded-xl","p-4"],[1,"text-green-400","text-2xl"],[1,"bg-gradient-to-br","from-purple-500/20","to-purple-600/10","border","border-purple-500/30","rounded-xl","p-4"],[1,"text-purple-400","text-2xl"],[1,"bg-gradient-to-br","from-amber-500/20","to-amber-600/10","border","border-amber-500/30","rounded-xl","p-4"],[1,"text-amber-400","text-2xl"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-slate-800/50","border","border-slate-700","rounded-xl","p-5"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","gap-2"],[1,"space-y-3"],[1,"relative"],[1,"text-center","py-8","text-slate-500"],[1,"p-3","bg-slate-900/50","rounded-lg","border","border-slate-700/50"],[1,"text-center","p-4","bg-slate-900/50","rounded-lg"],[1,"text-2xl","font-bold","text-cyan-400"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-2xl","font-bold","text-pink-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"text-2xl","font-bold","text-indigo-400"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white","flex","items-center","gap-2"],[1,"grid","grid-cols-2","md:grid-cols-5","gap-4"],[1,"text-center"],[1,"text-xl","font-bold","text-white"],[1,"text-xs","text-slate-400"],[1,"text-xl","font-bold","text-green-400"],[1,"text-xl","font-bold","text-purple-400"],[1,"text-xl","font-bold","text-cyan-400"],[1,"text-xl","font-bold","text-amber-400"],[1,"bg-gradient-to-r","from-purple-500/20","to-pink-500/20","border","border-purple-500/30","rounded-xl","p-5"],[1,"text-xs","px-2","py-1","rounded-full"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","text-slate-300"],[1,"h-8","bg-slate-700","rounded-lg","overflow-hidden"],[1,"h-full","transition-all","duration-500"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"text-white","font-medium"],[1,"flex","items-center","gap-1"],[1,"text-green-400","font-bold"],[1,"text-green-400"],[1,"text-red-400"],[1,"flex","items-center","justify-between","text-sm"],[1,"text-slate-400"],[1,"text-slate-500"],[1,"mt-2","h-1.5","bg-slate-700","rounded-full","overflow-hidden"],[1,"h-full","bg-gradient-to-r","from-green-500","to-emerald-400","rounded-full"],[1,"text-3xl","mb-2"],[1,"flex","items-center","gap-4"],[1,"text-4xl"],[1,"flex-1"],[1,"text-white","font-semibold"],[1,"text-slate-300","mt-1"],[1,"text-purple-400","font-medium"],[1,"px-4","py-2","bg-purple-500","text-white","rounded-lg","hover:bg-purple-600"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2)(4,"span"),l(5,"\u{1F4CA}"),s(),l(6," \u71DF\u92B7\u6578\u64DA\u5831\u8868 "),s(),r(7,"p",3),l(8,"\u8FFD\u8E64\u71DF\u92B7\u6548\u679C\uFF0C\u512A\u5316\u89D2\u8272\u7D44\u5408"),s()(),r(9,"div",4)(10,"select",5),W("ngModelChange",function(a){return K(n.selectedPeriod,a)||(n.selectedPeriod=a),a}),x("change",function(){return n.onPeriodChange()}),r(11,"option",6),l(12,"\u4ECA\u65E5"),s(),r(13,"option",7),l(14,"\u672C\u9031"),s(),r(15,"option",8),l(16,"\u672C\u6708"),s(),r(17,"option",9),l(18,"\u5168\u90E8"),s()(),r(19,"button",10),x("click",function(){return n.refreshData()}),r(20,"span"),l(21,"\u{1F504}"),s(),l(22," \u5237\u65B0 "),s()()(),r(23,"div",11)(24,"div",12)(25,"div",13)(26,"span",14),l(27,"\u{1F4EC}"),s(),S(28,mE,2,10,"span",15),s(),r(29,"div",16),l(30),s(),r(31,"div",17),l(32,"\u7E3D\u6703\u8A71\u6578"),s()(),r(33,"div",18)(34,"div",13)(35,"span",19),l(36,"\u2705"),s(),S(37,pE,2,10,"span",15),s(),r(38,"div",16),l(39),s(),r(40,"div",17),l(41,"\u6210\u529F\u8F49\u5316"),s()(),r(42,"div",20)(43,"div",13)(44,"span",21),l(45,"\u{1F4C8}"),s()(),r(46,"div",16),l(47),s(),r(48,"div",17),l(49,"\u8F49\u5316\u7387"),s()(),r(50,"div",22)(51,"div",13)(52,"span",23),l(53,"\u{1F4B0}"),s(),S(54,gE,2,10,"span",15),s(),r(55,"div",16),l(56),s(),r(57,"div",17),l(58,"\u7E3D\u6536\u5165"),s()()(),r(59,"div",24)(60,"div",25)(61,"h3",26)(62,"span"),l(63,"\u{1F53B}"),s(),l(64," \u8F49\u5316\u6F0F\u6597 "),s(),r(65,"div",27),$(66,hE,8,7,"div",28,dE),s(),S(68,fE,2,0,"div",29),s(),r(69,"div",25)(70,"h3",26)(71,"span"),l(72,"\u{1F3C6}"),s(),l(73," \u6700\u4F73\u89D2\u8272\u7D44\u5408 "),s(),r(74,"div",27),$(75,vE,19,9,"div",30,uE),S(77,bE,5,0,"div",29),s()()(),r(78,"div",25)(79,"h3",26)(80,"span"),l(81,"\u{1F465}"),s(),l(82," \u7528\u6236\u4E92\u52D5\u5206\u6790 "),s(),r(83,"div",11)(84,"div",31)(85,"div",32),l(86),s(),r(87,"div",33),l(88,"\u5E73\u5747\u8208\u8DA3\u5EA6"),s()(),r(89,"div",31)(90,"div",34),l(91),s(),r(92,"div",33),l(93,"\u5E73\u5747\u53C3\u8207\u5EA6"),s()(),r(94,"div",31)(95,"div",35),l(96),s(),r(97,"div",33),l(98,"\u7528\u6236\u756B\u50CF\u6578"),s()(),r(99,"div",31)(100,"div",36),l(101),s(),r(102,"div",33),l(103,"\u89D2\u8272\u7D44\u5408\u6578"),s()()()(),r(104,"div",25)(105,"div",37)(106,"h3",38)(107,"span"),l(108,"\u{1F4C5}"),s(),l(109," \u4ECA\u65E5\u8A73\u60C5 "),s(),r(110,"span",17),l(111),s()(),r(112,"div",39)(113,"div",40)(114,"div",41),l(115),s(),r(116,"div",42),l(117,"\u6703\u8A71"),s()(),r(118,"div",40)(119,"div",43),l(120),s(),r(121,"div",42),l(122,"\u8F49\u5316"),s()(),r(123,"div",40)(124,"div",44),l(125),s(),r(126,"div",42),l(127,"\u8F49\u5316\u7387"),s()(),r(128,"div",40)(129,"div",45),l(130),s(),r(131,"div",42),l(132,"\u6D88\u606F\u6578"),s()(),r(133,"div",40)(134,"div",46),l(135),s(),r(136,"div",42),l(137,"\u6536\u5165"),s()()()(),S(138,xE,16,2,"div",47),s()),t&2&&(c(10),z("ngModel",n.selectedPeriod),c(18),w(n.comparison().changes.sessions!==0?28:-1),c(2),A(n.totalStats().totalSessions),c(7),w(n.comparison().changes.conversions!==0?37:-1),c(2),A(n.totalStats().conversions),c(8),D("",n.totalStats().conversionRate.toFixed(1),"%"),c(7),w(n.comparison().changes.revenue!==0?54:-1),c(2),D("\xA5",n.formatNumber(n.totalStats().totalRevenue)),c(10),H(n.funnelData()),c(2),w(n.funnelData().length===0?68:-1),c(7),H(n.topCombos()),c(2),w(n.topCombos().length===0?77:-1),c(9),A(n.totalStats().avgInterestScore.toFixed(0)),c(5),A(n.totalStats().avgEngagementScore.toFixed(0)),c(5),A(n.userProfiles().length),c(5),A(n.roleCombos().length),c(10),A(n.todayDate),c(4),A(n.todayReport().totalSessions),c(5),A(n.todayReport().conversions),c(5),D("",n.todayReport().conversionRate.toFixed(1),"%"),c(5),A(n.todayReport().totalMessages),c(5),D("\xA5",n.formatNumber(n.todayReport().totalRevenue)),c(3),w(n.recommendedCombo()?138:-1))},dependencies:[te,me,Qe,Ye,lt,_e,Ce],styles:[".marketing-report[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}"]})}};var yE=["onboardingRef"],SE=["monitoringGroupsRef"],or=(i,e)=>e.id,wE=(i,e)=>e.name,EE=(i,e)=>e.phone;function AE(i,e){i&1&&(r(0,"p",15),l(1,"\u4F7F\u7528\u7DE9\u5B58\u6578\u64DA"),s())}function DE(i,e){if(i&1&&(r(0,"p",16),l(1),s()),i&2){let t=g(3);c(),D("",t.offlineCache.pendingOperations().length," \u500B\u5F85\u540C\u6B65\u64CD\u4F5C")}}function ME(i,e){if(i&1&&(r(0,"div",10),k(1,"div",11),r(2,"div",12)(3,"div",13)(4,"p",14),l(5,"\u{1F4F4} \u96E2\u7DDA\u6A21\u5F0F"),s(),S(6,AE,2,0,"p",15),S(7,DE,2,1,"p",16),s()()()),i&2){let t=g(2);c(6),w(t.offlineCache.isCacheValid()?6:-1),c(),w(t.offlineCache.hasPendingOperations()?7:-1)}}function TE(i,e){if(i&1&&(r(0,"div",10),k(1,"div",17),r(2,"div",12)(3,"div",13)(4,"p",18),l(5),s()()()()),i&2){let t=g(2);c(5),A(t.backendConnectionMessage())}}function kE(i,e){if(i&1){let t=M();r(0,"div",10)(1,"div",19),x("click",function(){v(t);let o=g(2);return b(o.retryConnection())}),s(),r(2,"div",12)(3,"div",13)(4,"p",20),l(5,"\u964D\u7D1A\u6A21\u5F0F\uFF08\u9EDE\u64CA\u91CD\u9023\uFF09"),s()()()()}}function IE(i,e){if(i&1){let t=M();r(0,"div",10)(1,"div",21),x("click",function(){v(t);let o=g(2);return b(o.retryConnection())}),s(),r(2,"div",12)(3,"div",13)(4,"p",22),l(5),s(),r(6,"p",15),l(7,"\u9EDE\u64CA\u91CD\u8A66"),s()()()()}if(i&2){let t=g(2);c(5),A(t.backendConnectionMessage())}}function PE(i,e){if(i&1&&(r(0,"div",1),S(1,ME,8,2,"div",10)(2,TE,6,1,"div",10)(3,kE,6,0,"div",10)(4,IE,8,1,"div",10),s()),i&2){let t=g();c(),w(t.offlineCache.isOnline()?t.backendConnectionState()==="connecting"?2:t.backendConnectionState()==="timeout"?3:t.backendConnectionState()==="error"?4:-1:1)}}function FE(i,e){if(i&1&&(r(0,"p",32),l(1),s()),i&2){let t,n=g(2);c(),A((t=n.successOverlayConfig())==null?null:t.subtitle)}}function NE(i,e){if(i&1&&(r(0,"div",2),k(1,"div",23),r(2,"div",24),k(3,"div",25),r(4,"div",26)(5,"div",27)(6,"div",28)(7,"span",29),l(8),s()()(),r(9,"div",30)(10,"h3",31),l(11),s(),S(12,FE,2,1,"p",32),s(),k(13,"div",33)(14,"div",34)(15,"div",35)(16,"div",36),s()()()),i&2){let t,n,o,a=g();c(8),A(((t=a.successOverlayConfig())==null?null:t.icon)||"\u2705"),c(3),A(((n=a.successOverlayConfig())==null?null:n.title)||"\u64CD\u4F5C\u6210\u529F"),c(),w((o=a.successOverlayConfig())!=null&&o.subtitle?12:-1)}}function RE(i,e){if(i&1){let t=M();r(0,"div",7)(1,"div",37),x("click",function(){v(t);let o=g();return b(o.closeQrLogin())}),s(),r(2,"div",38)(3,"app-qr-login",39),x("closed",function(){v(t);let o=g();return b(o.closeQrLogin())})("loginSuccess",function(o){v(t);let a=g();return b(a.onQrLoginSuccess(o))}),s()()()}}function OE(i,e){if(i&1&&(r(0,"p",112),l(1," \u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236 "),r(2,"span",118),l(3),s(),l(4," \u55CE\uFF1F "),s()),i&2){let t,n=g(3);c(3),D("@",((t=n.deleteConfirmDialog().lead)==null?null:t.username)||((t=n.deleteConfirmDialog().lead)==null?null:t.userId))}}function BE(i,e){if(i&1&&(r(0,"p",112),l(1," \u78BA\u5B9A\u8981\u522A\u9664 "),r(2,"span",119),l(3),s(),l(4," \u500B\u9078\u4E2D\u7684\u5BA2\u6236\u55CE\uFF1F "),s()),i&2){let t=g(3);c(3),A(t.deleteConfirmDialog().count)}}function VE(i,e){if(i&1){let t=M();r(0,"div",102),x("click",function(){v(t);let o=g(2);return b(o.cancelDeleteLeads())}),r(1,"div",103),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",104)(3,"div",105),ne(),r(4,"svg",106),k(5,"path",107)(6,"line",108)(7,"line",109),s()(),ge(),r(8,"h3",110),l(9,"\u78BA\u8A8D\u522A\u9664"),s()(),r(10,"div",111),S(11,OE,5,1,"p",112)(12,BE,5,1,"p",112),r(13,"div",113),l(14," \u26A0\uFE0F \u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\uFF0C\u6240\u6709\u76F8\u95DC\u8A18\u9304\u5C07\u88AB\u6C38\u4E45\u522A\u9664\u3002 "),s()(),r(15,"div",114)(16,"button",115),x("click",function(){v(t);let o=g(2);return b(o.cancelDeleteLeads())}),l(17," \u53D6\u6D88 "),s(),r(18,"button",116),x("click",function(){v(t);let o=g(2);return b(o.executeDeleteLeads())}),ne(),r(19,"svg",117),k(20,"path",107),s(),l(21," \u78BA\u8A8D\u522A\u9664 "),s()()()()}if(i&2){let t=g(2);c(11),w(t.deleteConfirmDialog().type==="single"?11:12)}}function LE(i,e){if(i&1){let t=M();r(0,"div",123)(1,"p",127),l(2,"\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44"),s(),r(3,"button",128),x("click",function(){v(t);let o=g(3);return o.currentView.set("multi-role"),b(o.showInviteGroupDialog.set(!1))}),l(4," \u53BB\u5275\u5EFA\u7FA4\u7D44 \u2192 "),s()()}}function GE(i,e){if(i&1){let t=M();r(0,"button",130),x("click",function(){let o=v(t).$implicit,a=g(4);return b(a.executeInviteToGroup(o.id))}),r(1,"div",131)(2,"div")(3,"p",132),l(4),s(),r(5,"p",133),l(6),s()(),r(7,"span",134),l(8,"\u2192"),s()()()}if(i&2){let t=e.$implicit;c(4),A(t.name),c(2),D("",(t.members==null?null:t.members.length)||0," \u500B\u6210\u54E1")}}function UE(i,e){if(i&1&&(r(0,"div",124),$(1,GE,9,2,"button",129,or),s()),i&2){let t=g(3);c(),H(t.collabGroups())}}function qE(i,e){if(i&1){let t=M();r(0,"div",102),x("click",function(){v(t);let o=g(2);return b(o.showInviteGroupDialog.set(!1))}),r(1,"div",103),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",104)(3,"div",120)(4,"span",121),l(5,"\u{1F465}"),s()(),r(6,"div")(7,"h3",110),l(8,"\u9080\u8ACB\u9032\u7FA4"),s(),r(9,"p",32),l(10,"\u9078\u64C7\u5354\u4F5C\u7FA4\u7D44"),s()()(),r(11,"div",122),S(12,LE,5,0,"div",123)(13,UE,3,0,"div",124),s(),r(14,"div",125)(15,"button",126),x("click",function(){v(t);let o=g(2);return b(o.showInviteGroupDialog.set(!1))}),l(16," \u53D6\u6D88 "),s()()()()}if(i&2){let t=g(2);c(12),w(t.collabGroups().length===0?12:13)}}function $E(i,e){i&1&&(ne(),r(0,"svg",136),k(1,"line",137)(2,"line",138),s())}function HE(i,e){i&1&&(ne(),r(0,"svg",136),k(1,"line",139)(2,"line",140)(3,"line",141),s())}function zE(i,e){if(i&1){let t=M();r(0,"button",135),x("click",function(){v(t);let o=g(2);return b(o.toggleMobileMenu())}),S(1,$E,3,0,":svg:svg",136)(2,HE,4,0,":svg:svg",136),s()}if(i&2){let t=g(2);Et("aria-expanded",t.mobileMenuOpen())("aria-label",t.mobileMenuOpen()?"\u95DC\u9589\u9078\u55AE":"\u958B\u555F\u9078\u55AE"),c(),w(t.mobileMenuOpen()?1:2)}}function KE(i,e){if(i&1){let t=M();r(0,"div",142),x("click",function(){v(t);let o=g(2);return b(o.mobileMenuOpen.set(!1))}),s()}}function WE(i,e){if(i&1){let t=M();r(0,"button",143),x("click",function(){v(t);let o=g(2);return b(o.toggleSidebarCollapse())}),ne(),r(1,"svg",144),k(2,"polyline",145),s()()}if(i&2){let t=g(2);V("title",t.sidebarCollapsed()?"\u5C55\u958B\u5074\u908A\u6B04":"\u6536\u7E2E\u5074\u908A\u6B04"),c(),I("rotate-180",t.sidebarCollapsed())}}function JE(i,e){if(i&1&&(r(0,"div")(1,"h1",146),l(2),s(),r(3,"p",147),l(4),s()()),i&2){let t=g(2);c(2),A(t.t("title")),c(2),A(t.t("subtitle"))}}function QE(i,e){i&1&&(r(0,"div",63),k(1,"app-notification-center"),s())}function YE(i,e){i&1&&(r(0,"div",64)(1,"div",148),k(2,"div",149),r(3,"div",150),k(4,"div",151)(5,"div",152),s()()())}function XE(i,e){i&1&&(r(0,"span",167),l(1,"\u{1F948}"),s())}function ZE(i,e){i&1&&(r(0,"span",167),l(1,"\u{1F947}"),s())}function jE(i,e){i&1&&(r(0,"span",167),l(1,"\u{1F48E}"),s())}function e3(i,e){i&1&&(r(0,"span",167),l(1,"\u{1F31F}"),s())}function t3(i,e){i&1&&(r(0,"span",168),l(1,"\u{1F451}"),s())}function n3(i,e){if(i&1&&(r(0,"div",166),S(1,XE,2,0,"span",167)(2,ZE,2,0,"span",167)(3,jE,2,0,"span",167)(4,e3,2,0,"span",167)(5,t3,2,0,"span",168),s()),i&2){let t,n=g(3);I("badge-silver",n.userMembershipLevel()==="silver")("badge-gold",n.userMembershipLevel()==="gold")("badge-diamond",n.userMembershipLevel()==="diamond")("badge-star",n.userMembershipLevel()==="star")("badge-king",n.userMembershipLevel()==="king"),c(),w((t=n.userMembershipLevel())==="silver"?1:t==="gold"?2:t==="diamond"?3:t==="star"?4:t==="king"?5:-1)}}function i3(i,e){if(i&1){let t=M();r(0,"div",153),x("click",function(){v(t);let o=g(2);return b(o.changeView("profile"))}),r(1,"div",154)(2,"div",155),k(3,"div",156),r(4,"div",157)(5,"div",158),l(6),s()(),S(7,n3,6,11,"div",159),s(),r(8,"div",150)(9,"div",160),l(10),s(),r(11,"div",161),k(12,"user-level-badge",162),s()(),r(13,"div",163),ne(),r(14,"svg",164),k(15,"polyline",165),s()()()()}if(i&2){let t,n,o,a,d=g(2);I("level-bronze",d.userMembershipLevel()==="bronze")("level-silver",d.userMembershipLevel()==="silver")("level-gold",d.userMembershipLevel()==="gold")("level-diamond",d.userMembershipLevel()==="diamond")("level-star",d.userMembershipLevel()==="star")("level-king",d.userMembershipLevel()==="king"),c(3),I("glow-bronze",d.userMembershipLevel()==="bronze")("glow-silver",d.userMembershipLevel()==="silver")("glow-gold",d.userMembershipLevel()==="gold")("glow-diamond",d.userMembershipLevel()==="diamond")("glow-star",d.userMembershipLevel()==="star")("glow-king",d.userMembershipLevel()==="king"),c(),I("border-bronze",d.userMembershipLevel()==="bronze")("border-silver",d.userMembershipLevel()==="silver")("border-gold",d.userMembershipLevel()==="gold")("border-diamond",d.userMembershipLevel()==="diamond")("border-star",d.userMembershipLevel()==="star")("border-king",d.userMembershipLevel()==="king"),c(),I("avatar-bronze",d.userMembershipLevel()==="bronze")("avatar-silver",d.userMembershipLevel()==="silver")("avatar-gold",d.userMembershipLevel()==="gold")("avatar-diamond",d.userMembershipLevel()==="diamond")("avatar-star",d.userMembershipLevel()==="star")("avatar-king",d.userMembershipLevel()==="king"),c(),D(" ",((((t=d.currentUser())==null?null:t.displayName)||((n=d.currentUser())==null?null:n.display_name)||((o=d.currentUser())==null?null:o.username))==null?null:(((t=t)==null?null:t.displayName)||((n=n)==null?null:n.display_name)||((o=o)==null?null:o.username)).charAt(0).toUpperCase())||"?"," "),c(),w(d.userMembershipLevel()!=="bronze"?7:-1),c(3),D(" ",((a=d.currentUser())==null?null:a.displayName)||((a=d.currentUser())==null?null:a.display_name)||((a=d.currentUser())==null?null:a.username)||"\u7528\u6236"," "),c(2),V("level",d.userMembershipLevel())}}function o3(i,e){if(i&1){let t=M();r(0,"div",81)(1,"a",169),x("click",function(){v(t);let o=g(2);return b(o.changeView("accounts"))}),ne(),r(2,"svg",68),k(3,"path",170)(4,"circle",171)(5,"path",172)(6,"path",173),s(),ge(),r(7,"span"),l(8),s()(),r(9,"a",174),x("click",function(){v(t);let o=g(2);return b(o.changeView("search-discovery"))}),ne(),r(10,"svg",68),k(11,"circle",175)(12,"path",176),s(),ge(),r(13,"span"),l(14),s(),r(15,"span",177),l(16,"NEW"),s()(),r(17,"a",178),x("click",function(){v(t);let o=g(2);return b(o.changeView("resource-center"))}),ne(),r(18,"svg",68),k(19,"ellipse",179)(20,"path",180)(21,"path",181),s(),ge(),r(22,"span"),l(23),s()(),r(24,"a",67),x("click",function(){v(t);let o=g(2);return b(o.changeView("leads"))}),ne(),r(25,"svg",68),k(26,"path",182)(27,"path",183),s(),ge(),r(28,"span"),l(29),s()()()}if(i&2){g();let t=kt(32),n=g();c(),X("background-color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-item-active)":"transparent")("color",t==="accounts"||t==="add-account"||t==="api-credentials"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",t==="accounts"||t==="add-account"||t==="api-credentials"),c(7),A(n.t("accounts")),c(),X("background-color",t==="search-discovery"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="search-discovery"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="search-discovery"),c(5),A(n.t("menu.searchDiscovery")),c(3),X("background-color",t==="resource-center"||t==="resources"?"rgba(6, 182, 212, 0.2)":"transparent")("color",t==="resource-center"||t==="resources"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="resource-center"||t==="resources"),c(6),A(n.t("menu.resourceCenter")),c(),X("background-color",t==="leads"?"var(--sidebar-item-active)":"transparent")("color",t==="leads"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",t==="leads"),c(5),A(n.t("menu.sendConsole"))}}function r3(i,e){if(i&1){let t=M();r(0,"div",81)(1,"a",184),x("click",function(){v(t);let o=g(2);return b(o.changeView("automation"))}),r(2,"div",185)(3,"span",186),l(4,"\u{1F4CA}"),s()(),r(5,"div",187)(6,"span",188),l(7),s(),r(8,"span",189),l(9),s()()(),r(10,"a",190),x("click",function(){v(t);let o=g(2);return b(o.changeView("monitoring-accounts"))}),r(11,"span",191),l(12,"\u{1F4F1}"),s(),r(13,"span"),l(14),s()(),r(15,"a",190),x("click",function(){v(t);let o=g(2);return b(o.changeView("monitoring-groups"))}),r(16,"span",191),l(17,"\u{1F4AC}"),s(),r(18,"span"),l(19),s()(),r(20,"a",190),x("click",function(){v(t);let o=g(2);return b(o.changeView("keyword-sets"))}),r(21,"span",191),l(22,"\u{1F511}"),s(),r(23,"span"),l(24),s()(),r(25,"a",190),x("click",function(){v(t);let o=g(2);return b(o.changeView("chat-templates"))}),r(26,"span",191),l(27,"\u{1F4DD}"),s(),r(28,"span"),l(29),s()(),r(30,"a",190),x("click",function(){v(t);let o=g(2);return b(o.changeView("trigger-rules"))}),r(31,"span",191),l(32,"\u26A1"),s(),r(33,"span"),l(34),s()(),r(35,"a",190),x("click",function(){v(t);let o=g(2);return b(o.changeView("collected-users"))}),r(36,"span",191),l(37,"\u{1F465}"),s(),r(38,"span"),l(39),s(),r(40,"span",192),l(41,"NEW"),s()()()}if(i&2){g();let t=kt(32),n=g();c(),X("background-color",t==="automation"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="automation"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="automation"),c(),I("bg-gradient-to-br",t==="automation")("from-cyan-500",t==="automation")("to-blue-500",t==="automation")("bg-slate-700/50",t!=="automation")("group-hover:bg-slate-700",t!=="automation"),c(5),A(n.t("menu.automationOverview")),c(2),A(n.t("menu.configAndStatus")),c(),X("background-color",t==="monitoring-accounts"?"rgba(6, 182, 212, 0.1)":"transparent")("color",t==="monitoring-accounts"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="monitoring-accounts"),c(4),A(n.t("menu.monitorAccounts")),c(),X("background-color",t==="monitoring-groups"?"rgba(16, 185, 129, 0.1)":"transparent")("color",t==="monitoring-groups"?"#34d399":"var(--sidebar-text)"),I("active",t==="monitoring-groups"),c(4),A(n.t("menu.monitorGroups")),c(),X("background-color",t==="keyword-sets"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="keyword-sets"?"#a78bfa":"var(--sidebar-text)"),I("active",t==="keyword-sets"),c(4),A(n.t("menu.keywordSets")),c(),X("background-color",t==="chat-templates"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="chat-templates"?"#f472b6":"var(--sidebar-text)"),I("active",t==="chat-templates"),c(4),A(n.t("menu.chatTemplates")),c(),X("background-color",t==="trigger-rules"?"rgba(251, 146, 60, 0.1)":"transparent")("color",t==="trigger-rules"?"#fb923c":"var(--sidebar-text)"),I("active",t==="trigger-rules"),c(4),A(n.t("menu.triggerRules")),c(),X("background-color",t==="collected-users"?"rgba(139, 92, 246, 0.1)":"transparent")("color",t==="collected-users"?"#a78bfa":"var(--sidebar-text)"),I("active",t==="collected-users"),c(4),A(n.t("menu.collectedUsers"))}}function s3(i,e){i&1&&(r(0,"span",194),l(1,"1"),s())}function a3(i,e){i&1&&(r(0,"span",195),l(1,"\u{1F48E}"),s())}function l3(i,e){i&1&&(r(0,"span",197),l(1,"2"),s())}function c3(i,e){i&1&&(r(0,"span",195),l(1,"\u{1F48E}"),s())}function d3(i,e){i&1&&(r(0,"span",198),l(1,"3"),s())}function u3(i,e){i&1&&(r(0,"span",195),l(1,"\u{1F947}"),s())}function m3(i,e){if(i&1){let t=M();r(0,"div",81)(1,"a",193),x("click",function(){v(t);let o=g(2);return b(o.changeView("ai-assistant"))}),r(2,"div",185)(3,"span",186),l(4,"\u{1F3AF}"),s()(),r(5,"div",187)(6,"span",188),l(7,"\u7B56\u7565\u898F\u5283"),s(),r(8,"span",189),l(9,"AI \u71DF\u92B7\u52A9\u624B"),s()(),S(10,s3,2,0,"span",194)(11,a3,2,0,"span",195),s(),r(12,"a",196),x("click",function(){v(t);let o=g(2);return b(o.changeView("ai-team"))}),r(13,"div",185)(14,"span",186),l(15,"\u{1F916}"),s()(),r(16,"div",187)(17,"span",188),l(18,"\u81EA\u52D5\u57F7\u884C"),s(),r(19,"span",189),l(20,"AI \u5718\u968A\u92B7\u552E"),s()(),S(21,l3,2,0,"span",197)(22,c3,2,0,"span",195),s(),r(23,"a",196),x("click",function(){v(t);let o=g(2);return b(o.changeView("analytics"))}),r(24,"div",185)(25,"span",186),l(26,"\u{1F4CA}"),s()(),r(27,"div",187)(28,"span",188),l(29,"\u6578\u64DA\u6D1E\u5BDF"),s(),r(30,"span",189),l(31,"\u667A\u80FD\u5206\u6790\u5831\u544A"),s()(),S(32,d3,2,0,"span",198)(33,u3,2,0,"span",195),s()()}if(i&2){g();let t=kt(32),n=g();c(),X("background-color",t==="ai-assistant"?"rgba(249, 115, 22, 0.15)":"transparent")("color",t==="ai-assistant"?"#fb923c":"var(--sidebar-text)"),I("active",t==="ai-assistant")("opacity-50",!n.membershipService.hasFeature("strategyPlanning")),V("title",n.membershipService.hasFeature("strategyPlanning")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),c(),I("bg-gradient-to-br",t==="ai-assistant")("from-orange-500",t==="ai-assistant")("to-amber-500",t==="ai-assistant")("bg-slate-700/50",t!=="ai-assistant")("group-hover:bg-slate-700",t!=="ai-assistant"),c(8),w(n.membershipService.hasFeature("strategyPlanning")?10:11),c(2),X("background-color",t==="ai-team"?"rgba(168, 85, 247, 0.15)":"transparent")("color",t==="ai-team"?"#c084fc":"var(--sidebar-text)"),I("active",t==="ai-team")("opacity-50",!n.membershipService.hasFeature("autoExecution")),V("title",n.membershipService.hasFeature("autoExecution")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),c(),I("bg-gradient-to-br",t==="ai-team")("from-purple-500",t==="ai-team")("to-pink-500",t==="ai-team")("bg-slate-700/50",t!=="ai-team")("group-hover:bg-slate-700",t!=="ai-team"),c(8),w(n.membershipService.hasFeature("autoExecution")?21:22),c(2),X("background-color",t==="analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="analytics")("opacity-50",!n.membershipService.hasFeature("dataInsightsBasic")),V("title",n.membershipService.hasFeature("dataInsightsBasic")?"":"\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),c(),I("bg-gradient-to-br",t==="analytics")("from-cyan-500",t==="analytics")("to-blue-500",t==="analytics")("bg-slate-700/50",t!=="analytics")("group-hover:bg-slate-700",t!=="analytics"),c(8),w(n.membershipService.hasFeature("dataInsightsBasic")?32:33)}}function p3(i,e){i&1&&(r(0,"span",206),l(1,"\u{1F48E}"),s())}function g3(i,e){if(i&1){let t=M();r(0,"div",81)(1,"a",67),x("click",function(){v(t);let o=g(2);return b(o.changeView("analytics-center"))}),ne(),r(2,"svg",68),k(3,"path",199)(4,"path",200)(5,"path",201),s(),ge(),r(6,"span"),l(7,"\u5206\u6790\u4E2D\u5FC3"),s()(),r(8,"a",67),x("click",function(){v(t);let o=g(2);return b(o.changeView("lead-nurturing"))}),ne(),r(9,"svg",68),k(10,"path",202)(11,"circle",203),s(),ge(),r(12,"span"),l(13,"\u5BA2\u6236\u57F9\u80B2"),s(),r(14,"span",204),l(15,"AI"),s()(),r(16,"a",205),x("click",function(){v(t);let o=g(2);return o.changeView("multi-role"),b(o.loadMultiRoleData())}),ne(),r(17,"svg",68),k(18,"path",170)(19,"circle",171)(20,"path",172)(21,"path",173),s(),ge(),r(22,"span"),l(23,"\u591A\u89D2\u8272\u5354\u4F5C"),s(),S(24,p3,2,0,"span",206),s()()}if(i&2){g();let t=kt(32),n=g();c(),X("background-color",t==="analytics-center"||t==="nurturing-analytics"?"rgba(6, 182, 212, 0.15)":"transparent")("color",t==="analytics-center"||t==="nurturing-analytics"?"#22d3ee":"var(--sidebar-text)"),I("active",t==="analytics-center"||t==="nurturing-analytics"),c(7),X("background-color",t==="lead-nurturing"?"rgba(236, 72, 153, 0.15)":"transparent")("color",t==="lead-nurturing"?"#f472b6":"var(--sidebar-text)"),I("active",t==="lead-nurturing"),c(8),X("background-color",t==="multi-role"?"rgba(99, 102, 241, 0.15)":"transparent")("color",t==="multi-role"?"#a5b4fc":n.membershipService.hasFeature("multiRole")?"var(--sidebar-text)":"var(--sidebar-text-muted)"),I("active",t==="multi-role")("opacity-50",!n.membershipService.hasFeature("multiRole"))("cursor-not-allowed",!n.membershipService.hasFeature("multiRole")),V("title",n.membershipService.hasFeature("multiRole")?"":"\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),c(8),w(n.membershipService.hasFeature("multiRole")?-1:24)}}function h3(i,e){if(i&1&&(r(0,"span",214),l(1),s()),i&2){let t=g(4);c(),A(t.ragBrainService.gapsCount())}}function f3(i,e){if(i&1){let t=M();r(0,"div",210)(1,"a",212),x("click",function(){v(t);let o=g(3);return b(o.changeView("knowledge-brain"))}),r(2,"span"),l(3,"\u{1F4CA}"),s(),r(4,"span"),l(5),s()(),r(6,"a",212),x("click",function(){v(t);let o=g(3);return b(o.changeView("knowledge-manage"))}),r(7,"span"),l(8,"\u{1F4DD}"),s(),r(9,"span"),l(10),s()(),r(11,"a",213),x("click",function(){v(t);let o=g(3);return b(o.changeView("knowledge-gaps"))}),r(12,"span"),l(13,"\u2753"),s(),r(14,"span"),l(15),s(),S(16,h3,2,1,"span",214),s()()}if(i&2){g(2);let t=kt(32),n=g();c(),X("background-color",t==="knowledge-brain"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-brain"?"#f472b6":"var(--sidebar-text-muted)"),I("active",t==="knowledge-brain"),c(4),A(n.t("menu.overview")),c(),X("background-color",t==="knowledge-manage"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-manage"?"#f472b6":"var(--sidebar-text-muted)"),I("active",t==="knowledge-manage"),c(4),A(n.t("menu.knowledgeManagement")),c(),X("background-color",t==="knowledge-gaps"?"rgba(236, 72, 153, 0.1)":"transparent")("color",t==="knowledge-gaps"?"#f472b6":"var(--sidebar-text-muted)"),I("active",t==="knowledge-gaps"),c(4),A(n.t("menu.knowledgeGaps")),c(),w(n.ragBrainService.gapsCount()>0?16:-1)}}function _3(i,e){if(i&1){let t=M();r(0,"div",81)(1,"div",207)(2,"a",67),x("click",function(){v(t);let o=g(2);return b(o.toggleKnowledgeMenu())}),r(3,"span",186),l(4,"\u{1F9E0}"),s(),r(5,"span",208),l(6),s(),r(7,"span",209),l(8,"\u25BC"),s()(),S(9,f3,17,22,"div",210),s(),r(10,"a",67),x("click",function(){v(t);let o=g(2);return b(o.changeView("ai-center"))}),ne(),r(11,"svg",68),k(12,"path",211),s(),ge(),r(13,"span"),l(14),s()()()}if(i&2){g();let t=kt(32),n=g();c(2),X("background-color",n.isKnowledgeView()?"rgba(236, 72, 153, 0.15)":"transparent")("color",n.isKnowledgeView()?"#f472b6":"var(--sidebar-text)"),I("active",n.isKnowledgeView()),c(4),A(n.t("menu.knowledgeBrain")),c(),I("rotate-180",n.knowledgeMenuExpanded()),c(2),w(n.knowledgeMenuExpanded()?9:-1),c(),X("background-color",t==="ai-center"?"rgba(168, 85, 247, 0.15)":"transparent")("color",t==="ai-center"?"#c084fc":"var(--sidebar-text)"),I("active",t==="ai-center"),c(4),A(n.t("aiCenter"))}}function C3(i,e){if(i&1){let t=M();r(0,"div",81)(1,"a",67),x("click",function(){v(t);let o=g(2);return b(o.changeView("settings"))}),ne(),r(2,"svg",68),k(3,"circle",215)(4,"path",216),s(),ge(),r(5,"span"),l(6),s()()()}if(i&2){g();let t=kt(32),n=g();c(),X("background-color",t==="settings"?"var(--sidebar-item-active)":"transparent")("color",t==="settings"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",t==="settings"),c(5),A(n.t("settings"))}}function v3(i,e){i&1&&k(0,"app-dashboard-view")}function b3(i,e){i&1&&k(0,"app-accounts-view")}function x3(i,e){if(i&1){let t=M();r(0,"app-add-account-simple",217),x("accountAdded",function(o){v(t);let a=g(2);return b(a.onAccountAdded(o))})("back",function(){v(t);let o=g(2);return b(o.changeView("accounts"))})("switchToAdvanced",function(){v(t);let o=g(2);return b(o.changeView("add-account-advanced"))}),s()}}function y3(i,e){if(i&1){let t=M();r(0,"app-add-account-page",218),x("accountAdded",function(o){v(t);let a=g(2);return b(a.onAccountAdded(o))})("back",function(){v(t);let o=g(2);return b(o.changeView("add-account"))}),s()}}function S3(i,e){i&1&&k(0,"app-api-credentials-view")}function w3(i,e){i&1&&k(0,"app-settings-view")}function E3(i,e){i&1&&k(0,"app-leads-view")}function A3(i,e){i&1&&k(0,"app-automation-view")}function D3(i,e){i&1&&k(0,"app-resource-discovery-view")}function M3(i,e){i&1&&k(0,"app-resource-discovery-view")}function T3(i,e){i&1&&k(0,"app-ai-center-view")}function k3(i,e){i&1&&(r(0,"div",95),k(1,"app-ai-brain"),s())}function I3(i,e){i&1&&(r(0,"div",96),k(1,"app-knowledge-gaps"),s())}function P3(i,e){i&1&&(r(0,"div",96),k(1,"app-knowledge-manage"),s())}function F3(i,e){i&1&&k(0,"app-multi-role-view")}function N3(i,e){i&1&&k(0,"app-analytics-view")}function R3(i,e){i&1&&k(0,"app-monitoring-view")}function O3(i,e){i&1&&k(0,"app-monitoring-view")}function B3(i,e){i&1&&k(0,"app-monitoring-view")}function V3(i,e){i&1&&k(0,"app-monitoring-view")}function L3(i,e){i&1&&k(0,"app-monitoring-view")}function G3(i,e){i&1&&k(0,"app-monitoring-view")}function U3(i,e){i&1&&k(0,"app-monitoring-view")}function q3(i,e){i&1&&k(0,"app-runtime-logs-view")}function $3(i,e){i&1&&k(0,"app-membership-center")}function H3(i,e){i&1&&k(0,"app-wallet-view")}function z3(i,e){i&1&&k(0,"app-wallet-recharge")}function K3(i,e){i&1&&k(0,"app-wallet-withdraw")}function W3(i,e){i&1&&k(0,"app-wallet-transactions")}function J3(i,e){i&1&&k(0,"app-wallet-orders")}function Q3(i,e){i&1&&k(0,"app-wallet-analytics")}function Y3(i,e){i&1&&k(0,"app-profile")}function X3(i,e){i&1&&k(0,"app-resource-center")}function Z3(i,e){i&1&&k(0,"app-search-discovery")}function j3(i,e){i&1&&k(0,"app-ai-marketing-assistant")}function e6(i,e){i&1&&k(0,"app-ai-team-hub")}function t6(i,e){i&1&&k(0,"app-member-database")}function n6(i,e){i&1&&k(0,"app-leads-view")}function i6(i,e){i&1&&k(0,"app-analytics-view")}function o6(i,e){i&1&&k(0,"app-analytics-view")}function r6(i,e){i&1&&k(0,"app-automation-view")}function s6(i,e){i&1&&k(0,"app-automation-view")}function a6(i,e){i&1&&k(0,"app-analytics-view")}function l6(i,e){i&1&&k(0,"app-marketing-report")}function c6(i,e){i&1&&k(0,"app-runtime-logs-view")}function d6(i,e){i&1&&k(0,"app-runtime-logs-view")}function u6(i,e){i&1&&k(0,"app-runtime-logs-view")}function m6(i,e){i&1&&k(0,"app-dashboard-view")}function p6(i,e){if(i&1&&l(0),i&2){let t=g();D(" @",t.username," ")}}function g6(i,e){if(i&1&&l(0),i&2){let t=g();Y(" ",t.firstName," ",t.lastName||""," ")}}function h6(i,e){if(i&1&&(l(0),ke(1,"slice")),i&2){let t=g();D(" ID: ",Yn(1,1,t.userId,0,12)," ")}}function f6(i,e){if(i&1&&(r(0,"p",228),l(1),s()),i&2){let t=g();c(),D("\u{1F4F1} ",t.phone)}}function _6(i,e){if(i&1&&(r(0,"span",230),l(1),ke(2,"slice"),s()),i&2){let t=g();c(),D("\u{1F4CD} ",Yn(2,1,t.sourceGroup,0,20))}}function C6(i,e){if(i&1&&(r(0,"span",231),l(1),ke(2,"slice"),s()),i&2){let t=g();c(),D("\u{1F511} ",Yn(2,1,t.triggeredKeyword,0,15))}}function v6(i,e){if(i&1&&(r(0,"span",240),l(1),s()),i&2){let t=g(),n=g(2);de(n.getIntentLevelColor(t.intentLevel)),c(),Y("",n.getIntentLevelEmoji(t.intentLevel)," ",n.t(t.intentLevel))}}function b6(i,e){if(i&1&&(r(0,"option",244),l(1),s()),i&2){let t=g(4);c(),A(t.t("noSenderAccounts"))}}function x6(i,e){if(i&1&&(r(0,"option",265),l(1),s()),i&2){let t=e.$implicit,n=g(5);V("value",t.id),c(),Y("",t.phone," (",t.username||n.t(t.status),")")}}function y6(i,e){if(i&1&&(r(0,"option",244),l(1,"\u9078\u64C7\u767C\u9001\u5E33\u865F..."),s(),$(2,x6,2,3,"option",265,or)),i&2){let t=g(4);c(2),H(t.senderAccounts())}}function S6(i,e){if(i&1){let t=M();r(0,"div",245)(1,"p",20),l(2),s(),r(3,"a",266),x("click",function(){v(t);let o=g(4);return o.currentView.set("accounts"),b(o.closeLeadDetailModal())}),l(4,"\u524D\u5F80\u5E33\u865F\u7BA1\u7406 \u2192"),s()()}if(i&2){let t=g(4);c(2),D("\u26A0\uFE0F ",t.t("noSenderAccountsHint"))}}function w6(i,e){i&1&&(r(0,"span",268),l(1,"\u2713 \u5DF2\u9023\u63A5"),s())}function E6(i,e){i&1&&(r(0,"span",269),l(1,"\u{1F4DA} RAG \u5DF2\u555F\u7528"),s())}function A6(i,e){if(i&1&&l(0),i&2){let t=g(6);D(" | \u4F86\u6E90: ",t.generationState().lead.sourceGroup," ")}}function D6(i,e){if(i&1&&l(0),i&2){let t=g(6);D(" | \u89F8\u767C\u8A5E: ",t.generationState().lead.triggerKeyword," ")}}function M6(i,e){if(i&1&&(r(0,"div",270)(1,"strong",279),l(2,"\u5BA2\u6236\u8CC7\u8A0A\uFF1A"),s(),l(3),S(4,A6,1,1),S(5,D6,1,1),s()),i&2){let t=g(5);c(3),D(" @",t.generationState().lead.username," "),c(),w(t.generationState().lead.sourceGroup?4:-1),c(),w(t.generationState().lead.triggerKeyword?5:-1)}}function T6(i,e){if(i&1&&(r(0,"span",280),l(1,"\u27F3"),s(),r(2,"span"),l(3),s()),i&2){let t=g(5);c(3),A(t.t("generating"))}}function k6(i,e){if(i&1&&(r(0,"span"),l(1,"\u2728"),s(),r(2,"span"),l(3),s()),i&2){let t=g(5);c(3),A(t.t("generateWithAi"))}}function I6(i,e){if(i&1){let t=M();r(0,"button",281),x("click",function(){v(t);let o=g(5);return b(o.generateMessage())}),l(1," \u{1F504} "),s()}}function P6(i,e){if(i&1){let t=M();r(0,"div",276),l(1),r(2,"a",282),x("click",function(){v(t);let o=g(5);return o.currentView.set("settings"),b(o.closeLeadDetailModal())}),l(3),s()()}if(i&2){let t=g(5);c(),D(" \u26A0\uFE0F ",t.t("aiNotConfigured")," "),c(2),A(t.t("goToSettings"))}}function F6(i,e){if(i&1){let t=M();r(0,"div",277)(1,"strong"),l(2),s(),l(3),r(4,"button",283),x("click",function(){v(t);let o=g(5);return b(o.generateMessage())}),l(5,"\u91CD\u8A66"),s()()}if(i&2){let t=g(5);c(2),D("",t.t("error"),":"),c(),D(" ",t.generationState().error," ")}}function N6(i,e){i&1&&(r(0,"div",278)(1,"p",284),l(2,"\u2713 AI \u5DF2\u751F\u6210\u6D88\u606F\uFF0C\u60A8\u53EF\u4EE5\u5728\u4E0B\u65B9\u7DE8\u8F2F\u5F8C\u767C\u9001"),s()())}function R6(i,e){if(i&1){let t=M();r(0,"div",250)(1,"div",267)(2,"div",225)(3,"span",186),l(4,"\u{1F916}"),s(),r(5,"span",32),l(6),s(),S(7,w6,2,0,"span",268),s(),S(8,E6,2,0,"span",269),s(),S(9,M6,6,3,"div",270),r(10,"div")(11,"label",271),l(12),s(),r(13,"textarea",272),x("ngModelChange",function(o){v(t);let a=g(4);return b(a.updateCustomPrompt(o))}),l(14,"                        "),s()(),r(15,"div",273)(16,"button",274),x("click",function(){v(t);let o=g(4);return b(o.generateMessage())}),S(17,T6,4,1)(18,k6,4,1),s(),S(19,I6,2,0,"button",275),s(),S(20,P6,4,2,"div",276),S(21,F6,6,2,"div",277),S(22,N6,3,0,"div",278),s()}if(i&2){let t=g(4);c(6),D(" ",t.aiApiType()==="local"?"\u672C\u5730 AI":t.aiApiType()==="openai"?"OpenAI":t.aiApiType()==="custom"?"\u81EA\u5B9A\u7FA9 API":"Gemini"," "),c(),w(t.isAiConfigured()?7:-1),c(),w(t.ragEnabled()?8:-1),c(),w(t.generationState().lead?9:-1),c(3),A(t.t("customizePrompt")),c(),V("ngModel",t.generationState().customPrompt)("placeholder",t.t("aiPromptPlaceholder")),c(3),V("disabled",t.generationState().status==="loading"||!t.isAiConfigured()),c(),w(t.generationState().status==="loading"?17:18),c(2),w(t.generationState().status==="success"?19:-1),c(),w(t.isAiConfigured()?-1:20),c(),w(t.generationState().status==="error"?21:-1),c(),w(t.generationState().status==="success"&&t.generationState().generatedMessage?22:-1)}}function O6(i,e){if(i&1&&(r(0,"option",265),l(1),s()),i&2){let t=e.$implicit;V("value",t.id),c(),A(t.name)}}function B6(i,e){if(i&1){let t=M();r(0,"div",241)(1,"label",242),l(2),s(),r(3,"select",285),x("change",function(o){v(t);let a=g(4);return b(a.applyTemplate(o))}),r(4,"option",244),l(5),s(),$(6,O6,2,2,"option",265,or),s()()}if(i&2){let t=g(4);c(2),D("\u{1F4CB} ",t.t("selectTemplate")),c(3),A(t.t("selectTemplatePlaceholder")),c(),H(t.messageTemplates())}}function V6(i,e){if(i&1){let t=M();r(0,"button",286),x("click",function(){v(t);let o=g(4);return b(o.addMoreAttachments("file"))}),l(1," \u2795 \u6DFB\u52A0\u66F4\u591A "),s(),r(2,"button",287),x("click",function(){v(t);let o=g(4);return b(o.clearAllAttachments())}),l(3," \u{1F5D1}\uFE0F \u6E05\u7A7A "),s()}}function L6(i,e){i&1&&(r(0,"span",292),l(1,"\u{1F5BC}\uFE0F"),s())}function G6(i,e){i&1&&(r(0,"span",293),l(1,"\u{1F4C4}"),s())}function U6(i,e){if(i&1&&(r(0,"span",295),l(1),s()),i&2){let t=g().$implicit;c(),D(" (",(t.fileSize/1024/1024).toFixed(2)," MB) ")}}function q6(i,e){i&1&&(r(0,"span",296),l(1,"\u2713"),s())}function $6(i,e){if(i&1){let t=M();r(0,"div",290)(1,"div",291),S(2,L6,2,0,"span",292)(3,G6,2,0,"span",293),r(4,"span",294),l(5),s(),S(6,U6,2,1,"span",295),S(7,q6,2,0,"span",296),s(),r(8,"button",297),x("click",function(){let o=v(t).$index,a=g(5);return b(a.removeAttachmentByIndex(o))}),l(9,"\xD7"),s()()}if(i&2){let t=e.$implicit;c(2),w(t.type==="image"?2:3),c(3),A(t.name),c(),w(t.fileSize?6:-1),c(),w(t.filePath?7:-1)}}function H6(i,e){if(i&1&&(r(0,"div",257)(1,"div",251)(2,"span",288),l(3),s(),r(4,"span",133),l(5),s()(),r(6,"div",289),$(7,$6,10,4,"div",290,wE),s()()),i&2){let t=g(4);c(3),D("\u{1F4CE} \u9644\u4EF6\u5217\u8868 (",t.generationState().attachments.length,")"),c(2),D(" \u7E3D\u5927\u5C0F: ",t.getTotalAttachmentSize()," MB "),c(2),H(t.generationState().attachments)}}function z6(i,e){i&1&&l(0," \u26A0\uFE0F \u7121\u53EF\u7528\u767C\u9001\u5E33\u865F ")}function K6(i,e){i&1&&l(0," \u26A0\uFE0F \u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F ")}function W6(i,e){i&1&&l(0," \u26A0\uFE0F \u8ACB\u8F38\u5165\u8A0A\u606F\u5167\u5BB9\u6216\u6DFB\u52A0\u9644\u4EF6 ")}function J6(i,e){if(i&1&&(r(0,"div",258)(1,"p",298),S(2,z6,1,0)(3,K6,1,0)(4,W6,1,0),s()()),i&2){let t=g(4);c(2),w(t.senderAccounts().length===0?2:t.selectedSenderId()?t.editableMessage().trim().length===0&&!t.generationState().attachment&&t.generationState().attachments.length===0?4:-1:3)}}function Q6(i,e){i&1&&(r(0,"div",259)(1,"p",299),l(2,"\u{1F6AB} \u6B64\u5BA2\u6236\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE\uFF0C\u7121\u6CD5\u767C\u9001\u8A0A\u606F"),s()())}function Y6(i,e){if(i&1){let t=M();r(0,"div",238)(1,"div",241)(2,"label",242),l(3),s(),r(4,"select",243),x("ngModelChange",function(o){v(t);let a=g(3);return b(a.selectedSenderId.set(o))}),S(5,b6,2,1,"option",244)(6,y6,4,0),s(),S(7,S6,5,1,"div",245),s(),r(8,"div",246)(9,"label",247),x("click",function(){v(t);let o=g(3);return b(o.messageMode.set("manual"))}),r(10,"div",248),l(11,"\u{1F4DD}"),s(),r(12,"span",249),l(13),s()(),r(14,"label",247),x("click",function(){v(t);let o=g(3);return b(o.messageMode.set("ai"))}),r(15,"div",248),l(16,"\u{1F916}"),s(),r(17,"span",249),l(18),s()(),r(19,"label",247),x("click",function(){v(t);let o=g(3);return b(o.messageMode.set("template"))}),r(20,"div",248),l(21,"\u{1F4CB}"),s(),r(22,"span",249),l(23),s()()(),S(24,R6,23,13,"div",250),S(25,B6,8,2,"div",241),r(26,"div",241)(27,"div",251)(28,"label",252),l(29),s(),r(30,"span",253),l(31),s()(),r(32,"textarea",254),x("ngModelChange",function(o){v(t);let a=g(3);return b(a.editableMessage.set(o))}),l(33,"                "),s()(),r(34,"div",250)(35,"div",255)(36,"button",256),x("click",function(){v(t);let o=g(3);return b(o.selectAttachment("image",!0))}),l(37),s(),r(38,"button",256),x("click",function(){v(t);let o=g(3);return b(o.selectAttachment("file",!0))}),l(39),s(),S(40,V6,4,0),s(),S(41,H6,9,2,"div",257),s(),S(42,J6,5,1,"div",258),S(43,Q6,3,0,"div",259),r(44,"div",260)(45,"button",261),x("click",function(){v(t);let o=g(),a=g(2);return b(a.addToDoNotContact(o.id))}),l(46),s(),r(47,"div",262)(48,"button",263),x("click",function(){v(t);let o=g(3);return b(o.closeLeadDetailModal())}),l(49),s(),r(50,"button",264),x("click",function(){v(t);let o=g(3);return b(o.sendMessageToLead())}),l(51),s()()()()}if(i&2){let t=g(),n=g(2);c(3),D("\u{1F4E4} ",n.t("selectSenderAccount")),c(),V("ngModel",n.selectedSenderId()),c(),w(n.senderAccounts().length===0?5:6),c(2),w(n.senderAccounts().length===0?7:-1),c(2),de(n.messageMode()==="manual"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),c(4),A(n.t("manualInput")),c(),de(n.messageMode()==="ai"?"bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),c(4),A(n.t("aiGenerate")),c(),de(n.messageMode()==="template"?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30"),c(4),A(n.t("useTemplate")),c(),w(n.messageMode()==="ai"?24:-1),c(),w(n.messageMode()==="template"?25:-1),c(4),D("\u270F\uFE0F ",n.t("messageContent")),c(2),Y("",n.editableMessage().length," ",n.t("characters")),c(),V("ngModel",n.editableMessage())("placeholder",n.t("messageContentPlaceholder")),c(5),D(" \u{1F5BC}\uFE0F ",n.t("attachImage")," "),c(2),D(" \u{1F4CE} ",n.t("attachFile")," "),c(),w(n.generationState().attachments.length>0?40:-1),c(),w(n.generationState().attachments.length>0?41:-1),c(),w(!n.canSendMessage()&&!t.doNotContact?42:-1),c(),w(t.doNotContact?43:-1),c(2),V("disabled",t.doNotContact),c(),D(" \u{1F6AB} ",t.doNotContact?n.t("userOnDNC"):n.t("addToDNC")," "),c(3),D(" ",n.t("cancel")," "),c(),V("disabled",!n.canSendMessage()||t.doNotContact),c(),D(" \u2708\uFE0F ",n.t("sendMessage")," ")}}function X6(i,e){i&1&&(r(0,"span",280),l(1,"\u27F3"),s(),r(2,"span"),l(3,"\u52A0\u8F09\u4E2D..."),s())}function Z6(i,e){i&1&&(r(0,"span"),l(1,"\u{1F4AC}"),s(),r(2,"span"),l(3,"\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304"),s())}function j6(i,e){if(i&1&&(r(0,"span",133),l(1),s()),i&2){let t=g(4);c(),D("\u5171 ",t.chatHistory().length," \u689D\u6D88\u606F")}}function e4(i,e){if(i&1&&(r(0,"div",310)(1,"div",312)(2,"div",313)(3,"p",314),l(4),s()(),r(5,"p",15),l(6),s()()()),i&2){let t=g().$implicit,n=g(5);c(4),A(t.content),c(2),A(n.formatTimestamp(t.timestamp))}}function t4(i,e){if(i&1&&(r(0,"div",311)(1,"div",312)(2,"div",315)(3,"p",314),l(4),s()(),r(5,"div",316)(6,"span",133),l(7),s(),r(8,"span",317),l(9,"\u{1F916} AI"),s()()()()),i&2){let t=g().$implicit,n=g(5);c(4),A(t.content),c(3),A(n.formatTimestamp(t.timestamp))}}function n4(i,e){if(i&1&&S(0,e4,7,2,"div",310)(1,t4,10,2,"div",311),i&2){let t=e.$implicit;w(t.role==="user"?0:t.role==="assistant"?1:-1)}}function i4(i,e){i&1&&(r(0,"div",308)(1,"span",318),l(2,"\u27F3"),s(),r(3,"span",319),l(4,"\u52A0\u8F09\u4E2D..."),s()())}function o4(i,e){if(i&1){let t=M();r(0,"div",309)(1,"button",320),x("click",function(){v(t);let o=g(5);return b(o.loadMoreChatHistory())}),l(2," \u52A0\u8F09\u66F4\u591A\u6D88\u606F "),s()()}}function r4(i,e){if(i&1){let t=M();r(0,"div",307),x("scroll",function(o){v(t);let a=g(4);return b(a.onChatHistoryScroll(o))}),$(1,n4,2,1,null,null,dr().trackByChatMessageId,!0),S(3,i4,5,0,"div",308),S(4,o4,3,0,"div",309),s()}if(i&2){let t=g(4);c(),H(t.chatHistory()),c(2),w(t.chatHistoryLoadingMore()?3:-1),c(),w(t.chatHistoryHasMore()&&!t.chatHistoryLoadingMore()?4:-1)}}function s4(i,e){i&1&&(r(0,"span",317),l(1,"\u{1F916} AI"),s())}function a4(i,e){if(i&1&&(r(0,"div",311)(1,"div",312)(2,"div",315)(3,"p",314),l(4),s()(),r(5,"div",316)(6,"span",133),l(7),s(),S(8,s4,2,0,"span",317),s()()()),i&2){let t=g().$implicit,n=g(4);c(4),A(t.content),c(3),A(n.formatTimestamp(t.timestamp)),c(),w(t.type.includes("AI")?8:-1)}}function l4(i,e){if(i&1&&(r(0,"div",310)(1,"div",312)(2,"div",313)(3,"p",314),l(4),s()(),r(5,"p",15),l(6),s()()()),i&2){let t=g().$implicit,n=g(4);c(4),A(t.content),c(2),A(n.formatTimestamp(t.timestamp))}}function c4(i,e){if(i&1&&(r(0,"div",321)(1,"div",322),l(2),s()()),i&2){let t=g().$implicit,n=g(4);c(2),st(" ",t.type,": ",t.content," \xB7 ",n.formatTimestamp(t.timestamp)," ")}}function d4(i,e){if(i&1&&S(0,a4,9,3,"div",311)(1,l4,7,2,"div",310)(2,c4,3,3,"div",321),i&2){let t=e.$implicit;w(t.type.includes("Sent")||t.type.includes("Message")?0:t.type.includes("Reply")||t.type.includes("Received")?1:2)}}function u4(i,e){if(i&1&&(r(0,"div",305)(1,"div",323),l(2,"\u{1F4AC}"),s(),r(3,"p",324),l(4),s(),r(5,"p",325),l(6,"\u9EDE\u64CA\u300C\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304\u300D\u67E5\u770B\u6240\u6709\u5C0D\u8A71"),s()()),i&2){let t=g(4);c(4),A(t.t("noHistoryFound"))}}function m4(i,e){if(i&1&&(r(0,"div",306)(1,"h4",326)(2,"span"),l(3,"\u{1F4CA}"),s(),l(4," AI \u5C0D\u8A71\u5206\u6790 "),s(),r(5,"div",327)(6,"div",328)(7,"p",329),l(8,"\u7E3D\u4E92\u52D5"),s(),r(9,"p",110),l(10),s()(),r(11,"div",328)(12,"p",329),l(13,"\u5C0D\u8A71\u968E\u6BB5"),s(),r(14,"p",330),l(15),s()(),r(16,"div",328)(17,"p",329),l(18,"\u8208\u8DA3\u7A0B\u5EA6"),s(),r(19,"p",186),l(20,"\u2B50\u2B50\u2B50"),s()()()()),i&2){let t=g(2);c(10),A(t.interactionHistory.length),c(5),A(t.status||"\u521D\u6B21\u63A5\u89F8")}}function p4(i,e){if(i&1){let t=M();r(0,"div",239)(1,"div",300)(2,"button",301),x("click",function(){v(t);let o=g(),a=g(2);return b(a.loadChatHistory(o.userId))}),S(3,X6,4,0)(4,Z6,4,0),s(),S(5,j6,2,1,"span",133),s(),S(6,r4,5,2,"div",302),r(7,"div",303)(8,"div",304),$(9,d4,3,1,null,null,dr().trackByChatMessageId,!0),s()(),S(11,u4,7,1,"div",305),S(12,m4,21,2,"div",306),s()}if(i&2){let t=g(),n=g(2);c(2),V("disabled",n.isLoadingChatHistory()),c(),w(n.isLoadingChatHistory()?3:4),c(2),w(n.selectedChatUserId()===t.userId&&n.chatHistory().length>0?5:-1),c(),w(n.selectedChatUserId()===t.userId&&n.chatHistory().length>0?6:-1),c(3),H(t.interactionHistory),c(2),w(t.interactionHistory.length===0&&(!n.selectedChatUserId()||n.chatHistory().length===0)?11:-1),c(),w(t.interactionHistory.length>0?12:-1)}}function g4(i,e){if(i&1){let t=M();r(0,"div",219),x("click",function(){v(t);let o=g(2);return b(o.closeLeadDetailModal())}),r(1,"div",220),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",221)(3,"div",222)(4,"div",223)(5,"div",224),l(6),s(),r(7,"div")(8,"div",225)(9,"h3",226),S(10,p6,1,1)(11,g6,1,2)(12,h6,2,5),s(),k(13,"span",227),s(),S(14,f6,2,1,"p",228),r(15,"div",229),S(16,_6,3,5,"span",230),S(17,C6,3,5,"span",231),S(18,v6,2,4,"span",232),s()()(),r(19,"button",233),x("click",function(){v(t);let o=g(2);return b(o.closeLeadDetailModal())}),l(20,"\u2715"),s()()(),r(21,"div",234)(22,"nav",235)(23,"a",236),x("click",function(){v(t);let o=g(2);return b(o.leadDetailView.set("sendMessage"))}),l(24),s(),r(25,"a",236),x("click",function(){v(t);let o=g(2);return b(o.leadDetailView.set("history"))}),l(26),s()()(),r(27,"div",237),S(28,Y6,52,31,"div",238),S(29,p4,13,6,"div",239),s()()()}if(i&2){let t=e,n=g(2);c(6),D(" ",(t.username||t.firstName||t.userId||"?")[0].toUpperCase()," "),c(4),w(t.username?10:t.firstName?11:12),c(3),de(n.getOnlineStatusColor(t.onlineStatus)),c(),w(t.phone?14:-1),c(2),w(t.sourceGroup?16:-1),c(),w(t.triggeredKeyword&&t.triggeredKeyword!=="\u7121"?17:-1),c(),w(t.intentLevel?18:-1),c(5),I("border-cyan-400",n.leadDetailView()==="sendMessage")("text-cyan-400",n.leadDetailView()==="sendMessage")("bg-cyan-500/10",n.leadDetailView()==="sendMessage"),c(),D(" \u{1F4AC} ",n.t("sendMessageTab")," "),c(),I("border-cyan-400",n.leadDetailView()==="history")("text-cyan-400",n.leadDetailView()==="history")("bg-cyan-500/10",n.leadDetailView()==="history"),c(),D(" \u{1F4CB} ",n.t("historyTab")," "),c(2),w(n.leadDetailView()==="sendMessage"?28:-1),c(),w(n.leadDetailView()==="history"?29:-1)}}function h4(i,e){i&1&&(r(0,"div",342),ne(),r(1,"svg",345),k(2,"circle",346)(3,"path",347),s(),ge(),r(4,"p"),l(5,"\u66AB\u7121\u64CD\u4F5C\u6B77\u53F2"),s()())}function f4(i,e){i&1&&(r(0,"span",352),l(1,"\uFF08\u5DF2\u64A4\u92B7\uFF09"),s())}function _4(i,e){if(i&1&&(r(0,"span",353),l(1),s()),i&2){let t=g().$implicit;c(),D("",t.failureCount," \u5931\u6557")}}function C4(i,e){if(i&1){let t=M();r(0,"button",355),x("click",function(){v(t);let o=g().$implicit,a=g(4);return b(a.undoBatchOperation(o.id))}),l(1," \u64A4\u92B7 "),s()}}function v4(i,e){if(i&1&&(r(0,"div",349)(1,"div",131)(2,"div",154)(3,"div",350),ne(),r(4,"svg",117),k(5,"rect",72)(6,"rect",73)(7,"rect",74)(8,"rect",75),s()(),ge(),r(9,"div")(10,"p",351),l(11),s(),r(12,"p",133),l(13),S(14,f4,2,0,"span",352),s()()(),r(15,"div",154)(16,"div",314)(17,"span",292),l(18),s(),S(19,_4,2,1,"span",353),s(),S(20,C4,2,0,"button",354),s()()()),i&2){let t=e.$implicit,n=g(4);I("opacity-50",t.reversed),c(3),I("bg-cyan-500/20",t.operationType==="update_status")("bg-blue-500/20",t.operationType==="add_tag")("bg-red-500/20",t.operationType==="delete"||t.operationType==="add_to_dnc"),c(),I("text-cyan-400",t.operationType==="update_status")("text-blue-400",t.operationType==="add_tag")("text-red-400",t.operationType==="delete"||t.operationType==="add_to_dnc"),c(7),A(n.getOperationTypeName(t.operationType)),c(2),Y(" ",t.itemCount," \u9805 \xB7 ",n.formatBatchOperationDate(t.createdAt)," "),c(),w(t.reversed?14:-1),c(4),D("",t.successCount," \u6210\u529F"),c(),w(t.failureCount>0?19:-1),c(),w(t.isReversible&&!t.reversed?20:-1)}}function b4(i,e){if(i&1&&(r(0,"div",250),$(1,v4,21,21,"div",348,or),s()),i&2){let t=g(3);c(),H(t.batchOperationHistory())}}function x4(i,e){if(i&1){let t=M();r(0,"div",331),x("click",function(){v(t);let o=g(2);return b(o.showBatchOperationHistory.set(!1))}),r(1,"div",332),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",333)(3,"h3",334),ne(),r(4,"svg",335),k(5,"path",336)(6,"path",337)(7,"path",338),s(),l(8," \u6279\u91CF\u64CD\u4F5C\u6B77\u53F2 "),s(),ge(),r(9,"button",339),x("click",function(){v(t);let o=g(2);return b(o.showBatchOperationHistory.set(!1))}),ne(),r(10,"svg",340),k(11,"line",137)(12,"line",138),s()()(),ge(),r(13,"div",341),S(14,h4,6,0,"div",342)(15,b4,3,0,"div",250),s(),r(16,"div",343)(17,"button",344),x("click",function(){v(t);let o=g(2);return b(o.showBatchOperationHistory.set(!1))}),l(18," \u95DC\u9589 "),s()()()()}if(i&2){let t=g(2);c(14),w(t.batchOperationHistory().length===0?14:15)}}function y4(i,e){i&1&&(r(0,"div",363)(1,"div",369)(2,"div",370)(3,"div",371),l(4,"\u{1F916}"),s(),r(5,"div",372),l(6,"AI \u81EA\u52D5\u56DE\u8986"),s(),r(7,"div",14),l(8,"\u667A\u80FD\u5BA2\u670D\u52A9\u624B"),s()(),r(9,"div",370)(10,"div",371),l(11,"\u{1F50D}"),s(),r(12,"div",372),l(13,"\u8CC7\u6E90\u767C\u73FE"),s(),r(14,"div",14),l(15,"\u81EA\u52D5\u641C\u7D22\u7FA4\u7D44"),s()(),r(16,"div",370)(17,"div",371),l(18,"\u{1F4CA}"),s(),r(19,"div",372),l(20,"\u6578\u64DA\u5206\u6790"),s(),r(21,"div",14),l(22,"\u8F49\u5316\u8FFD\u8E64\u5831\u8868"),s()()(),r(23,"p",373),l(24," TG-AI\u667A\u63A7\u738B \u5C07\u5E6B\u52A9\u60A8\u81EA\u52D5\u5316 Telegram \u71DF\u92B7\u6D41\u7A0B\uFF0C"),k(25,"br"),l(26," \u8B93\u60A8\u5C08\u6CE8\u65BC\u696D\u52D9\u589E\u9577\u800C\u975E\u91CD\u8907\u64CD\u4F5C\u3002 "),s()())}function S4(i,e){if(i&1&&(r(0,"option",265),l(1),s()),i&2){let t=e.$implicit;V("value",t),c(),A(t)}}function w4(i,e){if(i&1){let t=M();r(0,"select",382),x("ngModelChange",function(o){v(t);let a=g(5);return b(a.localAiModel.set(o))}),$(1,S4,2,2,"option",265,Pe),s()}if(i&2){let t=g(5);V("ngModel",t.localAiModel()),c(),H(t.detectedOllamaModels())}}function E4(i,e){if(i&1){let t=M();r(0,"input",383),x("ngModelChange",function(o){v(t);let a=g(5);return b(a.localAiModel.set(o))}),s()}if(i&2){let t=g(5);V("ngModel",t.localAiModel())}}function A4(i,e){if(i&1&&(r(0,"div",370)(1,"label",379),l(2,"\u9078\u64C7 AI \u6A21\u578B"),s(),S(3,w4,3,1,"select",380)(4,E4,1,1,"input",381),r(5,"p",15),l(6,"\u63A8\u85A6\uFF1Aqwen2:7b\uFF08\u4E2D\u82F1\u6587\u901A\u7528\uFF09"),s()()),i&2){let t=g(4);c(3),w(t.detectedOllamaModels().length>0?3:4)}}function D4(i,e){if(i&1){let t=M();r(0,"div",389)(1,"select",390),x("ngModelChange",function(o){v(t);let a=g(5);return b(a.aiBackupProvider.set(o))}),r(2,"option",391),l(3,"Google Gemini\uFF08\u514D\u8CBB\u984D\u5EA6\uFF09"),s(),r(4,"option",392),l(5,"OpenAI GPT"),s()()()}if(i&2){let t=g(5);c(),V("ngModel",t.aiBackupProvider())}}function M4(i,e){if(i&1){let t=M();r(0,"div",370)(1,"div",384)(2,"p",188),l(3,"\u{1F4E6} \u5B89\u88DD Ollama\uFF08\u514D\u8CBB\uFF09\uFF1A"),s(),r(4,"code",385),l(5," curl -fsSL https://ollama.com/install.sh | sh "),s(),r(6,"p",133),l(7," \u5B89\u88DD\u5F8C\u904B\u884C "),r(8,"code",279),l(9,"ollama pull qwen2:7b"),s(),l(10," \u4E0B\u8F09\u6A21\u578B "),s()()(),r(11,"div",370)(12,"label",386)(13,"input",387),x("change",function(){v(t);let o=g(4);return b(o.aiAutoFallback.set(!o.aiAutoFallback()))}),s(),r(14,"span",388),l(15,"\u4F7F\u7528\u96F2\u7AEF AI \u4F5C\u70BA\u5099\u9078"),s()(),S(16,D4,6,1,"div",389),s()}if(i&2){let t=g(4);c(13),V("checked",t.aiAutoFallback()),c(3),w(t.aiAutoFallback()?16:-1)}}function T4(i,e){if(i&1){let t=M();r(0,"div",238)(1,"h3",374),l(2,"\u{1F999} AI \u670D\u52D9\u914D\u7F6E"),s(),r(3,"div",375)(4,"div",131)(5,"div",154)(6,"span",376),l(7),s(),r(8,"div")(9,"div",377),l(10),s(),r(11,"div",32),l(12),s()()(),r(13,"button",378),x("click",function(){v(t);let o=g(3);return b(o.detectOllama())}),l(14),s()()(),S(15,A4,7,1,"div",370)(16,M4,17,2),s()}if(i&2){let t=g(3);c(3),de(t.ollamaDetected()?"bg-green-500/20 border border-green-500/30":"bg-yellow-500/20 border border-yellow-500/30"),c(4),A(t.ollamaDetected()?"\u2705":"\u26A0\uFE0F"),c(3),D(" ",t.ollamaDetected()?"Ollama \u5DF2\u6AA2\u6E2C\u5230":"Ollama \u672A\u904B\u884C"," "),c(2),D(" ",t.ollamaDetected()?"\u672C\u5730 AI \u670D\u52D9\u53EF\u7528":"\u5EFA\u8B70\u5B89\u88DD Ollama \u7372\u5F97\u514D\u8CBB AI \u80FD\u529B"," "),c(),V("disabled",t.isDetectingOllama()),c(),D(" ",t.isDetectingOllama()?"\u6AA2\u6E2C\u4E2D...":"\u91CD\u65B0\u6AA2\u6E2C"," "),c(),w(t.ollamaDetected()?15:16)}}function k4(i,e){if(i&1&&(r(0,"p"),l(1),s()),i&2){let t=g(4);c(),D("\u2705 \u6A21\u578B\uFF1A",t.localAiModel())}}function I4(i,e){if(i&1&&(r(0,"div",363)(1,"div",393),l(2,"\u{1F389}"),s(),r(3,"h3",394),l(4,"\u8A2D\u7F6E\u5B8C\u6210\uFF01"),s(),r(5,"p",373),l(6," \u60A8\u5DF2\u6E96\u5099\u597D\u958B\u59CB\u4F7F\u7528 TG-AI\u667A\u63A7\u738B\u3002"),k(7,"br"),l(8," \u63A5\u4E0B\u4F86\u8ACB\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B Telegram \u5E33\u865F\u3002 "),s(),r(9,"div",395)(10,"div",396)(11,"p"),l(12),s(),S(13,k4,2,1,"p"),r(14,"p"),l(15),s()()()()),i&2){let t=g(3);c(12),D("\u2705 AI \u670D\u52D9\uFF1A",t.ollamaDetected()?"Ollama \u672C\u5730 AI":"\u96F2\u7AEF AI"),c(),w(t.ollamaDetected()?13:-1),c(2),D("\u2705 \u81EA\u52D5\u964D\u7D1A\uFF1A",t.aiAutoFallback()?"\u5DF2\u555F\u7528":"\u5DF2\u7981\u7528")}}function P4(i,e){if(i&1){let t=M();r(0,"button",397),x("click",function(){v(t);let o=g(3);return b(o.welcomeStep.set(o.welcomeStep()-1))}),l(1," \u4E0A\u4E00\u6B65 "),s()}}function F4(i,e){if(i&1){let t=M();r(0,"button",398),x("click",function(){v(t);let o=g(3);return b(o.welcomeStep.set(o.welcomeStep()+1))}),l(1," \u4E0B\u4E00\u6B65 "),s()}}function N4(i,e){if(i&1){let t=M();r(0,"button",399),x("click",function(){v(t);let o=g(3);return b(o.completeFirstRunSetup())}),l(1," \u958B\u59CB\u4F7F\u7528 \u{1F680} "),s()}}function R4(i,e){if(i&1){let t=M();r(0,"div",99)(1,"div",356)(2,"div",357)(3,"h1",358),l(4,"\u{1F680} \u6B61\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B"),s(),r(5,"p",359),l(6,"AI \u9A45\u52D5\u7684 Telegram \u71DF\u92B7\u81EA\u52D5\u5316\u5E73\u53F0"),s()(),r(7,"div",360),k(8,"div",361)(9,"div",361)(10,"div",361),s(),r(11,"div",362),S(12,y4,27,0,"div",363)(13,T4,17,8,"div",238)(14,I4,16,3,"div",363),s(),r(15,"div",364)(16,"button",365),x("click",function(){v(t);let o=g(2);return b(o.skipFirstRunSetup())}),l(17," \u8DF3\u904E\u8A2D\u7F6E "),s(),r(18,"div",262),S(19,P4,2,0,"button",366),S(20,F4,2,0,"button",367)(21,N4,2,0,"button",368),s()()()()}if(i&2){let t,n=g(2);c(8),de(n.welcomeStep()>=1?"bg-cyan-500":"bg-slate-600"),c(),de(n.welcomeStep()>=2?"bg-cyan-500":"bg-slate-600"),c(),de(n.welcomeStep()>=3?"bg-cyan-500":"bg-slate-600"),c(2),w((t=n.welcomeStep())===1?12:t===2?13:t===3?14:-1),c(7),w(n.welcomeStep()>1?19:-1),c(),w(n.welcomeStep()<3?20:21)}}function O4(i,e){if(i&1&&(r(0,"p",415),l(1),s()),i&2){let t=g().$implicit;c(),Y(" \u2713 \u6709\u5143\u6578\u64DA: ",t.metadata.firstName||""," ",t.metadata.username?"@"+t.metadata.username:""," ")}}function B4(i,e){i&1&&(r(0,"p",416),l(1,"\u26A0 \u7121\u5143\u6578\u64DA\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u9304\u9A57\u8B49"),s())}function V4(i,e){if(i&1&&(r(0,"div",408)(1,"div",154)(2,"span",376),l(3,"\u{1F4F1}"),s(),r(4,"div")(5,"p",414),l(6),s(),S(7,O4,2,2,"p",415)(8,B4,2,0,"p",416),s()()()),i&2){let t=e.$implicit;c(6),D("+",t.phone),c(),w(t.hasMetadata&&t.metadata?7:8)}}function L4(i,e){i&1&&(r(0,"span",280),l(1,"\u23F3"),s(),r(2,"span"),l(3,"\u6062\u5FA9\u4E2D..."),s())}function G4(i,e){i&1&&(r(0,"span"),l(1,"\u{1F504}"),s(),r(2,"span"),l(3,"\u6062\u5FA9\u5E33\u865F"),s())}function U4(i,e){if(i&1){let t=M();r(0,"div",99)(1,"div",400)(2,"div",401)(3,"div",402),l(4,"\u{1F504}"),s(),r(5,"h2",403),l(6,"\u767C\u73FE\u53EF\u6062\u5FA9\u7684\u5E33\u865F"),s(),r(7,"p",404),l(8),s()(),r(9,"div",405)(10,"p",406),l(11," \u9019\u4E9B Session \u6587\u4EF6\u5B58\u5728\u65BC\u7CFB\u7D71\u4E2D\uFF0C\u4F46\u672A\u5728\u6578\u64DA\u5EAB\u4E2D\u627E\u5230\u5C0D\u61C9\u7684\u5E33\u865F\u8A18\u9304\u3002 \u60A8\u53EF\u4EE5\u5617\u8A66\u6062\u5FA9\u9019\u4E9B\u5E33\u865F\uFF0C\u6216\u9078\u64C7\u5FFD\u7565\u3002 "),s(),r(12,"div",407),$(13,V4,9,2,"div",408,EE),s(),r(15,"div",409)(16,"p",410),l(17," \u{1F4A1} "),r(18,"strong"),l(19,"\u63D0\u793A\uFF1A"),s(),l(20," \u6062\u5FA9\u5F8C\uFF0C\u5E33\u865F\u5C07\u4EE5\u300C\u96E2\u7DDA\u300D\u72C0\u614B\u6DFB\u52A0\u5230\u5217\u8868\u4E2D\u3002 \u60A8\u9700\u8981\u9EDE\u64CA\u300C\u767B\u9304\u300D\u4F86\u91CD\u65B0\u9023\u63A5\u5E33\u865F\u3002 "),s()()(),r(21,"div",411)(22,"button",412),x("click",function(){v(t);let o=g(2);return b(o.dismissOrphanSessionDialog())}),l(23," \u7A0D\u5F8C\u8655\u7406 "),s(),r(24,"button",413),x("click",function(){v(t);let o=g(2);return b(o.recoverOrphanSessions())}),S(25,L4,4,0)(26,G4,4,0),s()()()()}if(i&2){let t=g(2);c(8),D(" \u767C\u73FE ",t.orphanSessions().length," \u500B Session \u6587\u4EF6\u9700\u8981\u624B\u52D5\u6062\u5FA9 "),c(5),H(t.orphanSessions()),c(11),V("disabled",t.isRecoveringOrphanSessions()),c(),w(t.isRecoveringOrphanSessions()?25:26)}}function q4(i,e){if(i&1&&(r(0,"div",425)(1,"p",426)(2,"span",188),l(3,"\u932F\u8AA4\u8A73\u60C5\uFF1A"),s(),l(4),s()()),i&2){let t=g(3);c(4),D(" ",t.backendError()," ")}}function $4(i,e){if(i&1){let t=M();r(0,"div",99)(1,"div",417)(2,"div",418)(3,"div",402),l(4,"\u26A0\uFE0F"),s(),r(5,"h2",419),l(6,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),s()(),r(7,"div",405)(8,"p",373),l(9," \u7A0B\u5E8F\u9700\u8981 Python \u74B0\u5883\u624D\u80FD\u6B63\u5E38\u904B\u884C\u3002\u8ACB\u78BA\u4FDD\uFF1A "),s(),r(10,"div",420)(11,"div",421)(12,"span",279),l(13,"1."),s(),r(14,"div")(15,"p",414),l(16,"\u5B89\u88DD Python 3.9+"),s(),r(17,"a",422),l(18," https://www.python.org/downloads/ "),s()()(),r(19,"div",421)(20,"span",279),l(21,"2."),s(),r(22,"div")(23,"p",414),l(24,'\u5B89\u88DD\u6642\u52FE\u9078 "Add Python to PATH"'),s(),r(25,"p",423),l(26,"\u78BA\u4FDD Python \u6DFB\u52A0\u5230\u7CFB\u7D71\u74B0\u5883\u8B8A\u91CF"),s()()(),r(27,"div",421)(28,"span",279),l(29,"3."),s(),r(30,"div")(31,"p",414),l(32,"\u5B89\u88DD\u4F9D\u8CF4"),s(),r(33,"code",424),l(34," pip install pyrogram tgcrypto aiosqlite "),s()()(),r(35,"div",421)(36,"span",279),l(37,"4."),s(),r(38,"div")(39,"p",414),l(40,"\u91CD\u65B0\u555F\u52D5\u7A0B\u5E8F"),s()()()(),S(41,q4,5,1,"div",425),s(),r(42,"div",411)(43,"button",412),x("click",function(){v(t);let o=g(2);return b(o.showBackendErrorDialog.set(!1))}),l(44," \u6211\u77E5\u9053\u4E86 "),s()()()()}if(i&2){let t=g(2);c(41),w(t.backendError()?41:-1)}}function H4(i,e){if(i&1){let t=M();r(0,"div",427),x("click",function(){v(t);let o=g(2);return b(o.showBackendErrorDialog.set(!0))}),r(1,"span",167),l(2,"\u26A0\uFE0F"),s(),r(3,"span",249),l(4,"Python \u5F8C\u7AEF\u672A\u904B\u884C"),s()()}}function z4(i,e){if(i&1){let t=M();r(0,"div",428),x("click",function(){v(t);let o=g(2);return b(o.cancelNewKeywordSet())}),r(1,"div",429),x("click",function(o){return v(t),b(o.stopPropagation())}),r(2,"div",430)(3,"h2",431)(4,"span"),l(5,"\u{1F511}"),s(),l(6," \u5275\u5EFA\u95DC\u9375\u8A5E\u96C6 "),s()(),r(7,"div",362)(8,"label",432),l(9,"\u95DC\u9375\u8A5E\u96C6\u540D\u7A31"),s(),r(10,"input",433),x("input",function(o){v(t);let a=g(2);return b(a.newKeywordSet.set({name:o.target.value}))})("keyup.enter",function(){v(t);let o=g(2);return b(o.submitNewKeywordSet())}),s(),r(11,"p",325),l(12," \u{1F4A1} \u5275\u5EFA\u5F8C\u53EF\u5728\u8A5E\u96C6\u4E2D\u6DFB\u52A0\u591A\u500B\u95DC\u9375\u8A5E "),s()(),r(13,"div",411)(14,"button",412),x("click",function(){v(t);let o=g(2);return b(o.cancelNewKeywordSet())}),l(15," \u53D6\u6D88 "),s(),r(16,"button",434),x("click",function(){v(t);let o=g(2);return b(o.submitNewKeywordSet())}),l(17," \u5275\u5EFA "),s()()()()}if(i&2){let t=g(2);c(10),V("value",t.newKeywordSet().name)}}function K4(i,e){if(i&1){let t=M();r(0,"div",8)(1,"app-onboarding",40,0),x("navigateEvent",function(o){v(t);let a=g();return b(a.handleOnboardingNavigate(o))}),s(),k(3,"app-progress-dialog",41),S(4,VE,22,1,"div",42),S(5,qE,17,1,"div",42),S(6,zE,3,3,"button",43),S(7,KE,1,0,"div",44),r(8,"aside",45)(9,"div",46),S(10,WE,3,3,"button",47),r(11,"div",48)(12,"div",49),k(13,"div",50),ne(),r(14,"svg",51),k(15,"path",52)(16,"path",53)(17,"path",54)(18,"path",55)(19,"circle",56),r(20,"defs")(21,"linearGradient",57),k(22,"stop",58)(23,"stop",59),s(),r(24,"linearGradient",60),k(25,"stop",61)(26,"stop",62),s()()()(),S(27,JE,5,2,"div"),s(),S(28,QE,2,0,"div",63),S(29,YE,6,0,"div",64)(30,i3,16,52,"div",65),s(),ge(),r(31,"nav",66),ua(32),r(33,"a",67),x("click",function(){v(t);let o=g();return b(o.changeView("membership-center"))}),ne(),r(34,"svg",68),k(35,"polygon",69),s(),ge(),r(36,"span"),l(37),s()(),r(38,"a",67),x("click",function(){v(t);let o=g();return b(o.changeView("wallet"))}),ne(),r(39,"svg",68),k(40,"rect",70)(41,"line",71),s(),ge(),r(42,"span"),l(43),s()(),r(44,"a",67),x("click",function(){v(t);let o=g();return b(o.changeView("dashboard"))}),ne(),r(45,"svg",68),k(46,"rect",72)(47,"rect",73)(48,"rect",74)(49,"rect",75),s(),ge(),r(50,"span"),l(51),s()(),r(52,"div",76)(53,"button",77),x("click",function(){v(t);let o=g();return b(o.toggleSidebarGroup("manual"))}),r(54,"span",78),l(55),s(),ne(),r(56,"svg",79),k(57,"polyline",80),s()(),S(58,o3,30,28,"div",81),s(),ge(),r(59,"div",76)(60,"button",77),x("click",function(){v(t);let o=g();return b(o.toggleSidebarGroup("monitoring"))}),r(61,"span",82)(62,"span",83),l(63,"\u{1F4E1}"),s(),l(64),s(),ne(),r(65,"svg",79),k(66,"polyline",80),s()(),S(67,r3,42,60,"div",81),s(),ge(),r(68,"div",76)(69,"button",77),x("click",function(){v(t);let o=g();return b(o.toggleSidebarGroup("marketing"))}),r(70,"span",82)(71,"span",84),l(72,"AI"),s(),l(73),s(),ne(),r(74,"svg",79),k(75,"polyline",80),s()(),S(76,m3,34,60,"div",81),s(),ge(),r(77,"div",76)(78,"button",77),x("click",function(){v(t);let o=g();return b(o.toggleSidebarGroup("analytics"))}),r(79,"span",78),l(80," \u{1F4CA} \u6578\u64DA\u5206\u6790 "),s(),ne(),r(81,"svg",79),k(82,"polyline",80),s()(),S(83,g3,25,24,"div",81),s(),ge(),r(84,"div",76)(85,"button",77),x("click",function(){v(t);let o=g();return b(o.toggleSidebarGroup("ai"))}),r(86,"span",78),l(87),s(),ne(),r(88,"svg",79),k(89,"polyline",80),s()(),S(90,_3,15,17,"div",81),s(),ge(),r(91,"div",76)(92,"button",77),x("click",function(){v(t);let o=g();return b(o.toggleSidebarGroup("system"))}),r(93,"span",78),l(94),s(),ne(),r(95,"svg",79),k(96,"polyline",80),s()(),S(97,C3,7,7,"div",81),s()(),ge(),r(98,"div",85)(99,"button",86),x("click",function(){v(t);let o=g();return b(o.openOnboarding())}),r(100,"span",87),l(101,"\u2753"),s(),r(102,"span"),l(103),s()(),r(104,"div")(105,"label",88),l(106),s(),k(107,"app-language-switcher-compact"),s(),r(108,"div")(109,"label",88),l(110),s(),r(111,"div",89)(112,"button",90),x("click",function(){v(t);let o=g();return b(o.theme.set("light"))}),ne(),r(113,"svg",91),k(114,"path",92),s()(),ge(),r(115,"button",90),x("click",function(){v(t);let o=g();return b(o.theme.set("dark"))}),ne(),r(116,"svg",91),k(117,"path",93),s()()()()()(),ge(),r(118,"main",94),S(119,v3,1,0,"app-dashboard-view")(120,b3,1,0,"app-accounts-view")(121,x3,1,0,"app-add-account-simple")(122,y3,1,0,"app-add-account-page")(123,S3,1,0,"app-api-credentials-view")(124,w3,1,0,"app-settings-view")(125,E3,1,0,"app-leads-view")(126,A3,1,0,"app-automation-view")(127,D3,1,0,"app-resource-discovery-view")(128,M3,1,0,"app-resource-discovery-view")(129,T3,1,0,"app-ai-center-view")(130,k3,2,0,"div",95)(131,I3,2,0,"div",96)(132,P3,2,0,"div",96)(133,F3,1,0,"app-multi-role-view")(134,N3,1,0,"app-analytics-view")(135,R3,1,0,"app-monitoring-view")(136,O3,1,0,"app-monitoring-view")(137,B3,1,0,"app-monitoring-view")(138,V3,1,0,"app-monitoring-view")(139,L3,1,0,"app-monitoring-view")(140,G3,1,0,"app-monitoring-view")(141,U3,1,0,"app-monitoring-view")(142,q3,1,0,"app-runtime-logs-view")(143,$3,1,0,"app-membership-center")(144,H3,1,0,"app-wallet-view")(145,z3,1,0,"app-wallet-recharge")(146,K3,1,0,"app-wallet-withdraw")(147,W3,1,0,"app-wallet-transactions")(148,J3,1,0,"app-wallet-orders")(149,Q3,1,0,"app-wallet-analytics")(150,Y3,1,0,"app-profile")(151,X3,1,0,"app-resource-center")(152,Z3,1,0,"app-search-discovery")(153,j3,1,0,"app-ai-marketing-assistant")(154,e6,1,0,"app-ai-team-hub")(155,t6,1,0,"app-member-database")(156,n6,1,0,"app-leads-view")(157,i6,1,0,"app-analytics-view")(158,o6,1,0,"app-analytics-view")(159,r6,1,0,"app-automation-view")(160,s6,1,0,"app-automation-view")(161,a6,1,0,"app-analytics-view")(162,l6,1,0,"app-marketing-report")(163,c6,1,0,"app-runtime-logs-view")(164,d6,1,0,"app-runtime-logs-view")(165,u6,1,0,"app-runtime-logs-view")(166,m6,1,0,"app-dashboard-view"),s(),S(167,g4,30,24,"div",97),S(168,x4,19,1,"div",98),S(169,R4,22,9,"div",99),S(170,U4,27,3,"div",99),S(171,$4,45,1,"div",99),S(172,H4,5,0,"div",100),S(173,z4,18,1,"div",101),s()}if(i&2){let t,n,o=g();c(3),V("show",o.progressDialog().show)("title",o.progressDialog().title)("progress",o.progressDialog().progress)("cancellable",o.progressDialog().cancellable),c(),w(o.deleteConfirmDialog().show?4:-1),c(),w(o.showInviteGroupDialog()?5:-1),c(),w(o.isMobile()?6:-1),c(),w(o.isMobile()&&o.mobileMenuOpen()?7:-1),c(),I("w-64",!o.sidebarCollapsed()||o.isMobile()&&o.mobileMenuOpen())("w-16",o.sidebarCollapsed()&&!o.isMobile())("mobile-sidebar-hidden",o.isMobile()&&!o.mobileMenuOpen())("mobile-sidebar-visible",o.isMobile()&&o.mobileMenuOpen()),c(2),w(o.isMobile()?-1:10),c(),I("justify-center",o.sidebarCollapsed()),c(16),w(o.sidebarCollapsed()?-1:27),c(),w(o.sidebarCollapsed()?-1:28),c(),w(o.currentUser()?30:29),c(3);let a=ma(o.currentView());c(),X("background-color",a==="membership-center"?"var(--sidebar-item-active)":"transparent")("color",a==="membership-center"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",a==="membership-center"),c(4),A(o.t("menu.membershipCenter")),c(),X("background-color",a==="wallet"?"var(--sidebar-item-active)":"transparent")("color",a==="wallet"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",a==="wallet"),c(5),A(o.t("menu.myWallet")),c(),X("background-color",a==="dashboard"?"var(--sidebar-item-active)":"transparent")("color",a==="dashboard"?"var(--sidebar-text-active)":"var(--sidebar-text)"),I("active",a==="dashboard"),c(7),A(o.t("dashboard")),c(4),D(" \u{1F527} ",o.t("menu.manualOperations")," "),c(),I("rotate-180",!o.isSidebarGroupExpanded("manual")),c(2),w(o.isSidebarGroupExpanded("manual")?58:-1),c(6),D(" ",o.t("menu.monitoringCenter")," "),c(),I("rotate-180",!o.isSidebarGroupExpanded("monitoring")),c(2),w(o.isSidebarGroupExpanded("monitoring")?67:-1),c(6),D(" ",o.t("menu.aiMarketing")," "),c(),I("rotate-180",!o.isSidebarGroupExpanded("marketing")),c(2),w(o.isSidebarGroupExpanded("marketing")?76:-1),c(5),I("rotate-180",!o.isSidebarGroupExpanded("analytics")),c(2),w(o.isSidebarGroupExpanded("analytics")?83:-1),c(4),D(" \u{1F9E0} ",o.t("aiIntelligence")," "),c(),I("rotate-180",!o.isSidebarGroupExpanded("ai")),c(2),w(o.isSidebarGroupExpanded("ai")?90:-1),c(4),D(" \u2699\uFE0F ",o.t("systemMonitor")," "),c(),I("rotate-180",!o.isSidebarGroupExpanded("system")),c(2),w(o.isSidebarGroupExpanded("system")?97:-1),c(6),A(o.t("menu.help")),c(3),A(o.t("language")),c(4),A(o.t("appearance")),c(2),X("background-color",o.theme()==="light"?"var(--bg-card)":"transparent")("color",o.theme()==="light"?"var(--primary)":"var(--text-muted)")("box-shadow",o.theme()==="light"?"var(--shadow-sm)":"none"),c(3),X("background-color",o.theme()==="dark"?"var(--primary-bg)":"transparent")("color",o.theme()==="dark"?"var(--primary)":"var(--text-muted)")("box-shadow",o.theme()==="dark"?"var(--shadow-sm)":"none"),c(3),I("pt-14",o.isMobile())("pl-0",o.isMobile()),c(),w((t=o.currentView())==="dashboard"?119:t==="accounts"?120:t==="add-account"?121:t==="add-account-advanced"?122:t==="api-credentials"?123:t==="settings"?124:t==="leads"?125:t==="automation"?126:t==="resource-discovery"?127:t==="resources"?128:t==="ai-center"?129:t==="knowledge-brain"?130:t==="knowledge-gaps"?131:t==="knowledge-manage"?132:t==="multi-role"?133:t==="analytics"?134:t==="monitoring"?135:t==="monitoring-accounts"?136:t==="monitoring-groups"?137:t==="keyword-sets"?138:t==="chat-templates"?139:t==="trigger-rules"?140:t==="collected-users"?141:t==="runtime-logs"?142:t==="membership-center"?143:t==="wallet"?144:t==="wallet-recharge"?145:t==="wallet-withdraw"?146:t==="wallet-transactions"?147:t==="wallet-orders"?148:t==="wallet-analytics"?149:t==="profile"?150:t==="resource-center"?151:t==="search-discovery"?152:t==="ai-assistant"?153:t==="ai-team"?154:t==="member-database"?155:t==="lead-nurturing"?156:t==="nurturing-analytics"?157:t==="user-tracking"?158:t==="ads"?159:t==="campaigns"?160:t==="analytics-center"?161:t==="marketing-report"?162:t==="performance"?163:t==="alerts"?164:t==="logs"?165:166),c(48),w((n=o.generationState().lead)?167:-1,n),c(),w(o.showBatchOperationHistory()?168:-1),c(),w(o.showWelcomeDialog()?169:-1),c(),w(o.showOrphanSessionDialog()?170:-1),c(),w(o.showBackendErrorDialog()?171:-1),c(),w(o.backendRunning()?-1:172),c(),w(o.showKeywordSetCreator()?173:-1)}}function W4(i,e){i&1&&(r(0,"div",9),k(1,"router-outlet"),s())}var ir=class i{constructor(){this.router=O(It);this.geminiService=O(lo);this.accountLoaderService=O($n);this.ipcService=O(ye);this.offlineCache=O(bn);this.swManager=O(To);this.toastService=O(ue);this.membershipService=O(Re);this.securityService=O(bo);this.loadingService=O(Mo);this.contactsService=O(ni);this.backupService=O(Ha);this.i18n=O(Xe);this.authService=O(xt);this.webVitals=O(xo);this.auditTracker=O(Do);this.navBridge=O(sn);this.navShortcuts=O(Ma);this.unifiedNav=O(Da);this.navigationService=O(Ia);this.monitoringMgmt=O(Pa);this.leadMgmt=O(Fa);this.campaignMgmt=O(Ta);this.templateMgmt=O(ka);this.groupMgmt=O(Na);this.messageMgmt=O(Ra);this.facade=O(Oa);this.animationConfig=O(Ba);this.settingsService=O(Va);this.aiChatService=O(La);this.resourceService=O(Ga);this.exportService=O(Ua);this.ragService=O(qa);this.ragBrainService=O(wt);this.vectorMemoryService=O($a);this.schedulerService=O(za);this.dialogService=O(bt);this.document=O(Jn);this.cdr=O(en);this.ngZone=O(We);this.membershipUpdateHandler=null;this.Math=Math;this.isAuthenticated=G(()=>this.authService.isAuthenticated());this.currentUser=G(()=>this.authService.user());this.userMembershipLevel=G(()=>this.authService.membershipLevel());this.t=(e,t)=>this.i18n.t(e,t);this.theme=_("dark");this.currentView=_("dashboard");this.dashboardMode=_("smart");this.useRouterMode=_(!0);this.navMode=_("classic");this.leadDetailView=_("sendMessage");this.leadsViewMode=_("kanban");this.leadStatusFilter=_("all");this.leadSourceFilter=_("all");this.leadSortBy=_("time");this.showLeadsViewMenu=_(!1);this.showLeadsActionMenu=_(!1);this.aiCenterTab=_("config");this.automationTab=_("targets");this.knowledgeMenuExpanded=_(!0);this.sidebarGroups=_({manual:!0,monitoring:!0,marketing:!0,analytics:!1,advanced:!1,ai:!0,system:!1});this.sidebarCollapsed=_(!1);this.isMobile=_(!1);this.mobileMenuOpen=_(!1);this._mobileMediaQuery=null;this.aiTeamIncomingStrategy=_(null);this.showBatchMessageDialogState=_(!1);this.batchSelectedLeads=_([]);this.batchSendTargets=_([]);this.showBatchInviteDialogState=_(!1);this.batchInviteTargets=_([]);this.migrationStatus=_({currentVersion:0,latestVersion:0,appliedCount:0,pendingCount:0,appliedMigrations:[],pendingMigrations:[]});this.isLoadingMigration=_(!1);this.isRunningMigration=_(!1);this.schedulerStatus=_({isRunning:!1,tasks:[]});this.schedulerTab=_("tasks");this.logFiles=_([]);this.logStats=_({totalFiles:0,totalSize:0,totalSizeFormatted:"0 B",compressedFiles:0,oldestFile:null,newestFile:null});this.isLoadingLogs=_(!1);this.isRotatingLogs=_(!1);this.selectedLogFile=_(null);this.logFileContent=_("");this.showResourceBatchMenu=_(!1);this.resourceBatchAction=_(null);this.showMembershipDialog=_(!1);this.settingsTab=_("backup");this.vectorMemoryStats=_({totalMemories:0,byType:{},totalUsers:0,avgImportance:0});this.vectorMemorySearchQuery="";this.vectorMemorySearchResults=_([]);this.isSearchingMemory=_(!1);this.isAddingMemory=_(!1);this.showAddMemoryDialog=_(!1);this.newMemory={userId:"",content:"",type:"conversation",importance:.5};this.selectedMemoryUserId=_("");this.memoryUserList=_([]);this.showVoiceRecordingDialog=_(!1);this.voiceCloneTab=_("manage");this.messageMode=_("manual");this.editableMessage=_("");this.selectedSenderId=_(null);this.aiApiKey=_("");this.aiApiType=_("gemini");this.customApiEndpoint=_("");this.showApiKey=_(!1);this.isTestingAi=_(!1);this.aiConnectionStatus=_(null);this.aiConnectionError=_("");this.localAiEndpoint=_("http://localhost:11434");this.localAiModel=_("qwen2:7b");this.localAiProvider=_("ollama");this.isTestingLocalAi=_(!1);this.localAiStatus=_(null);this.localAiError=_("");this.availableOllamaModels=_([]);this.aiAutoFallback=_(!0);this.aiBackupProvider=_("gemini");this.aiShowProviderLabel=_(!0);this.isFirstRun=_(!1);this.showWelcomeDialog=_(!1);this.welcomeStep=_(1);this.isDetectingOllama=_(!1);this.ollamaDetected=_(!1);this.detectedOllamaModels=_([]);this.autoSelectedModel=_("");this.backendRunning=_(!0);this.backendError=_("");this.showBackendErrorDialog=_(!1);this.showOrphanSessionDialog=_(!1);this.orphanSessions=_([]);this.isRecoveringOrphanSessions=_(!1);this.showMembershipStats=_(!1);this.ttsEndpoint=_("");this.ttsEnabled=_(!1);this.ttsVoice=_("");this.isTestingTts=_(!1);this.ttsStatus=_(null);this.ttsError=_("");this.sttEndpoint=_("");this.sttEnabled=_(!1);this.isTestingStt=_(!1);this.sttStatus=_(null);this.sttError=_("");this.aiAutoChatEnabled=_(!1);this.aiAutoChatMode=_("semi");this.aiTypingSpeed=_(50);this.aiReplyDelay=_([2,8]);this.aiSystemPrompt=_("");this.aiMaxContextMessages=_(20);this.aiEnableMemory=_(!0);this.aiAutoGreeting=_(!1);this.aiGreetingMessage=_("");this.ragEnabled=_(!0);this.aiGreetingSuggestion=_(null);this.showAiGreetingDialog=_(!1);this.knowledgeStats=_({documents:0,images:0,videos:0,qa_pairs:0});this.knowledgeDocuments=_([]);this.knowledgeImages=_([]);this.knowledgeVideos=_([]);this.knowledgeQaPairs=_([]);this.knowledgeTab=_("documents");this.isLoadingKnowledge=_(!1);this.showAddDocumentDialog=_(!1);this.showAddMediaDialog=_(!1);this.showAddQaDialog=_(!1);this.newDocument=_({title:"",category:"general",tags:"",content:""});this.newMedia=_({name:"",category:"general",description:"",mediaType:"image"});this.newQaPair=_({question:"",answer:"",category:"general",keywords:""});this.ragSystemInitialized=_(!1);this.isInitializingRag=_(!1);this.isRagLearning=_(!1);this.isReindexing=_(!1);this.isCleaningRag=_(!1);this.isSearchingRag=_(!1);this.ragSearchQuery="";this.ragSearchResults=_([]);this.ragStats=_({total_knowledge:0,qa_count:0,scripts_count:0,total_uses:0,avg_score:0,chromadb_enabled:!1,neural_embedding:!1,by_type:{}});this.showAddRagKnowledgeDialog=_(!1);this.newRagKnowledge={type:"qa",question:"",answer:"",context:""};this.ragTypeKeys=G(()=>Object.keys(this.ragStats().by_type));this.resourceDiscoveryInitialized=_(!1);this.isSearchingResources=_(!1);this.isProcessingJoinQueue=_(!1);this.resourceSearchQuery="";this.pendingSearchQuery="";this.resourceSearchType=_("all");this.searchError=_({hasError:!1,message:"",details:"",suggestions:[]});this.currentSearchSessionId=_("");this.currentSearchKeyword=_("");this.showSearchHistory=_(!1);this.searchHistoryKeywords=_([]);this.savedResources=_(new Set);this.showSearchSuggestions=_(!1);this.hotSearchKeywords=_(["\u652F\u4ED8","USDT","\u4EA4\u6613","\u62DB\u8058","\u4EE3\u8CFC","\u52A0\u5BC6\u8CA8\u5E63","\u96FB\u5F71","\u97F3\u6A02","\u8CC7\u6E90\u5206\u4EAB","\u4EA4\u6D41\u7FA4"]);this.resourceAccountId=_(null);this.showResourceAccountSelector=_(!1);this.resourceMinMembers=_(0);this.showSearchOptions=_(!1);this.searchReplaceMode=_(!0);this.isRefreshing=_(!1);this.linkAnalysisInput="";this.isAnalyzingLink=_(!1);this.discoveredResources=_([]);this.resourceStats=_({total_resources:0,by_status:{},by_type:{},today_discovered:0,pending_joins:0,joined_count:0,avg_score:0});this.discoveryKeywords=_([]);this.showAddResourceDialog=_(!1);this.showAddKeywordDialog=_(!1);this.showChannelManageDialog=_(!1);this.showAddChannelDialog=_(!1);this.newResourceKeyword="";this.systemChannels=_([]);this.customChannels=_([]);this.newChannelUsername="";this.newChannelDisplayName="";this.newChannelQueryFormat="{keyword}";this.newChannelPriority="backup";this.showJoinMonitorDialog=_(!1);this.joinMonitorResource=_(null);this.joinMonitorSelectedPhone=_("");this.joinMonitorSelectedPhones=_([]);this.joinMonitorKeywords=_([]);this.joinMonitorSelectedKeywordSetIds=_([]);this.joinMonitorNewKeyword="";this.joinMonitorAutoEnable=_(!0);this.joinMonitorBatchMode=_(!0);this.joinMonitorBatchInterval=_(45);this.isJoiningResource=_(!1);this.showQuickCreateKeywordSet=_(!1);this.quickCreateKeywordSetName="";this.showChangeMonitorAccount=_(!1);this.openResourceMenuId=_(null);this.quickCreateKeywordSetKeywords=_([]);this.quickCreateKeywordSetNewKeyword="";this.showBatchJoinMonitorDialog=_(!1);this.batchJoinResources=_([]);this.batchJoinProgress=_({current:0,total:0,status:""});this.showMemberListDialog=_(!1);this.memberListResource=_(null);this.memberListData=_([]);this.memberListLoading=_(!1);this.memberListProgress=_({extracted:0,total:0,status:""});this.selectedMemberIds=_([]);this.memberExtractStarted=_(!1);this.memberListFilter=_("all");this.memberExtractConfig=_({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}});this.extractPresets=[{id:"precise",name:"\u{1F3AF} \u7CBE\u6E96\u6D3B\u8E8D",desc:"\u73FE\u5728\u5728\u7DDA+\u6709\u7528\u6236\u540D",config:{activityFilters:{onlineNow:!0,within3Days:!0},accountFeatures:{hasUsername:!0}}},{id:"chinese",name:"\u{1F1E8}\u{1F1F3} \u83EF\u4EBA\u512A\u5148",desc:"\u83EF\u4EBA+7\u5929\u5167\u6D3B\u8E8D",config:{userTypes:{chinese:!0},activityFilters:{within7Days:!0}}},{id:"premium",name:"\u{1F48E} \u9AD8\u50F9\u503C",desc:"Premium+\u6D3B\u8E8D\u7528\u6236",config:{accountFeatures:{premium:!0},activityFilters:{within7Days:!0}}},{id:"all",name:"\u{1F4E6} \u5168\u90E8\u63D0\u53D6",desc:"\u4E0D\u7BE9\u9078\uFF0C\u63D0\u53D6\u6240\u6709",config:{}}];this.selectedPreset=_("");this.showExtractionSummaryDialog=_(!1);this.extractionSummary=_({groupName:"",groupUrl:"",totalExtracted:0,totalInGroup:0,onlineCount:0,recentlyCount:0,premiumCount:0,chineseCount:0,hasUsernameCount:0,botCount:0,valueLevelDistribution:{S:0,A:0,B:0,C:0,D:0},extractedAt:"",duration:0});this.extractionStartTime=_(0);this.showMemberExtractionDialog=_(!1);this.memberExtractionGroup=_(null);this.showSingleMessageDialog=_(!1);this.singleMessageResource=_(null);this.singleMessageContent="";this.singleMessageScheduled=_(!1);this.singleMessageScheduleTime="";this.singleMessageAccountId=_("");this.accountQuotas=_([]);this.newChannelNotes="";this.isTestingChannel=_(!1);this.selectedResourceIds=_([]);this.resourceFilterStatus=_("");this.resourceFilterType=_("");this.resourceFilterLink=_("");this.selectedSearchSources=_(["telegram","jiso"]);this.showBatchJoinMenu=_(!1);this.searchResultsCache=new Map;this.CACHE_EXPIRY_MS=300*1e3;this.showBatchMessageDialog=_(!1);this.showBatchInviteDialog=_(!1);this.batchMessageContent="";this.batchMessageTargets=[];this.batchMessageConfig={delayMin:60,delayMax:120,dailyLimit:50,smartAntiBlock:!0,accountMode:"rotate",scheduled:!1,scheduleTime:""};this.batchInviteConfig={selectedMemberIds:[],selectAll:!1,delayMin:120,delayMax:300,perGroupLimit:10,smartAntiBlock:!0};this.availableMembersForInvite=_([]);this.discussionWatcherInitialized=_(!1);this.channelDiscussions=_([]);this.discussionMessages=_([]);this.discussionStats=_({total_discussions:0,monitoring_count:0,total_messages:0,matched_messages:0,leads_from_discussions:0,today_messages:0,today_leads:0});this.selectedDiscussionId=_("");this.discoverChannelId="";this.resourcesTab=_("resources");this.resourceCenterTab=_("manage");this.isLoadingDiscussionMessages=_(!1);this.discussionReplyText=_("");this.clonedVoices=_([]);this.selectedClonedVoice=_("");this.isUploadingVoice=_(!1);this.voiceUploadProgress=_(0);this.voiceCloneError=_("");this.isRecording=_(!1);this.recordingTime=_(0);this.recordingTimer=null;this.mediaRecorder=null;this.audioChunks=[];this.voicePromptText=_("");this.voiceName=_("");this.showRecordingDialog=_(!1);this.recordedAudioBlob=_(null);this.recordedAudioUrl=_("");this.accounts=_([]);this.keywordSets=_([]);this.monitoredGroups=_([]);this.leads=_([]);this.leadsTotal=_(0);this.leadsHasMore=_(!1);this.leadsLoading=_(!1);this.logs=_([]);this.selectedLeadForInvite=_(null);this.showInviteGroupDialog=_(!1);this.realtimeMatches=_([]);this.todayStats=_({matchCount:0,newLeads:0,messagesSent:0,conversions:0});this.chatList=_([]);this.chatHistory=_([]);this.selectedChatUserId=_(null);this.isLoadingChatHistory=_(!1);this.chatListSearch=_("");this.chatListFunnelFilter=_("");this.chatHistoryPage=_(0);this.chatHistoryPageSize=_(50);this.chatHistoryHasMore=_(!1);this.chatHistoryLoadingMore=_(!1);this.chatHistoryAllMessages=_([]);this.lastQueueStatusRefresh=0;this.queueStatuses=_({});this.queueMessages=_([]);this.selectedQueuePhone=_(null);this.queueStats=_({pending:0,sending:0,sent:0,failed:0,retrying:0,totalToday:0,successRate:0,avgSendTime:0});this.sendingStatsData=_(null);this.queueLengthHistoryData=_(null);this.accountComparisonData=_(null);this.campaignPerformanceData=_(null);this.alerts=_([]);this.unacknowledgedAlertsCount=G(()=>this.alerts().filter(e=>!e.acknowledged&&!e.resolved).length);this.selectedLeadIds=_(new Set);this.isSelectAllLeads=_(!1);this.showBatchOperationMenu=_(!1);this.showFloatingMoreMenu=_(!1);this.batchOperationInProgress=_(!1);this.batchOperationHistory=_([]);this.showBatchOperationHistory=_(!1);this.allTags=_([]);this.newTagName=_("");this.newTagColor=_("#3B82F6");this.showAddTagDialog=_(!1);this.batchTagInput=_("");this.showBatchTagSelector=_(!1);this.showBatchRemoveTagSelector=_(!1);this.leadSearchQuery=_("");this.leadSearchResults=_([]);this.isSearchingLeads=_(!1);this.leadSearchTimeout=null;this.backups=_([]);this.isCreatingBackup=_(!1);this.isRestoringBackup=_(!1);this.selectedLeadsCount=G(()=>this.selectedLeadIds().size);this.hasSelectedLeads=G(()=>this.selectedLeadIds().size>0);this.adTemplates=_([]);this.adSchedules=_([]);this.adSendLogs=_([]);this.adOverviewStats=_(null);this.showAdTemplateForm=_(!1);this.showAdScheduleForm=_(!1);this.editingAdTemplate=_(null);this.editingAdSchedule=_(null);this.newAdTemplate=_({name:"",content:"",mediaType:"text"});this.newAdSchedule=_({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]});this.spintaxPreview=_([]);this.isPreviewingSpintax=_(!1);this.adSystemTab=_("templates");this.trackedUsers=_([]);this.userGroups=_([]);this.highValueGroups=_([]);this.trackingStats=_(null);this.showAddUserForm=_(!1);this.newTrackedUser=_({userId:"",username:"",notes:""});this.selectedTrackedUser=_(null);this.isTrackingUser=_(!1);this.userTrackingTab=_("users");this.userValueFilter=_("");this.selectedCampaign=_(null);this.unifiedOverview=_(null);this.funnelAnalysis=_(null);this.showCampaignForm=_(!1);this.campaignKeywordInput=_("");this.campaignFormData=_({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]});this.roleTemplates=_({});this.allRoles=_([]);this.scriptTemplates=_([]);this.collabGroups=_([]);this.collabStats=_(null);this.roleStats=_(null);this.showRoleAssignForm=_(!1);this.multiRoleTab=_("roles");this.newRoleAssign=_({accountPhone:"",roleType:"seller",roleName:""});this.validationErrors=_({});this.progressDialog=_({show:!1,title:"\u5904\u7406\u4E2D...",progress:{current:0,total:0},cancellable:!1});this.logFilterType=_("");this.logFilterStartDate=_("");this.logFilterEndDate=_("");this.logFilterSearch=_("");this.filteredLogs=G(()=>{let e=this.logs(),t=this.logFilterType(),n=this.logFilterStartDate(),o=this.logFilterEndDate(),a=this.logFilterSearch();return e.filter(d=>{if(t&&d.type!==t)return!1;if(n){let m=new Date(n);if(d.timestamp<m)return!1}if(o){let m=new Date(o);if(m.setHours(23,59,59,999),d.timestamp>m)return!1}if(a){let m=a.toLowerCase();if(!d.message.toLowerCase().includes(m))return!1}return!0})});this.generationState=_({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]});this.messageTemplates=_([]);this.doNotContactList=_(new Set);this.campaigns=_([]);this.spintaxEnabled=_(!0);this.autoReplyEnabled=_(!1);this.autoReplyMessage=_("Thanks for getting back to me! I'll read your message and respond shortly.");this.smartSendingEnabled=_(!0);this.saveSettingsTimer=null;this.searchTimeout=null;this.showPostJoinDialog=_(!1);this.postJoinResource=_(null);this.postJoinPhone=_("");this.showSuccessOverlay=_(!1);this.successOverlayConfig=_(null);this.newAccount=_({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""});this.newKeyword=_({setId:null,keyword:"",isRegex:!1});this.testKeywordText=_("");this.keywordTestResult=_(null);this.newKeywordSet=_({name:""});this.newGroup=_({url:"",keywordSetIds:[]});this.newTemplate=_({name:"",prompt:""});this.showTemplateCreator=_(!1);this.showKeywordSetCreator=_(!1);this.newCampaign=_(this.getEmptyCampaignForm());this.loginState=_({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1});this.loginCode=_("");this.login2FAPassword=_("");this.accountRoles=["Listener","Sender","Unassigned"];this.selectedAccountGroup=_("All");this.accountGroups=G(()=>["All",...new Set(this.accounts().map(e=>e.group).filter(Boolean))]);this.filteredAccounts=G(()=>{let e=this.accounts(),t=this.selectedAccountGroup();return t==="All"?e:e.filter(n=>n.group===t)});this.selectedAccounts=G(()=>this.accounts().filter(e=>e.selected));this.isAllAccountsSelected=G(()=>{let e=this.filteredAccounts();return e.length>0&&e.every(t=>t.selected)});this.listenerAccounts=G(()=>this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online"));this.senderAccounts=G(()=>this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up")));this.leadStatuses=["New","Contacted","Replied","Follow-up","Closed-Won","Closed-Lost"];this.openLeadMenuId=_(null);this.displayLeads=G(()=>this.leadSearchQuery().trim()&&this.leadSearchResults().length>0?this.leadSearchResults():this.leads());this.leadsByStatusMap=G(()=>{let e=this.displayLeads(),t=new Map;return this.leadStatuses.forEach(n=>t.set(n,[])),e.forEach(n=>{t.has(n.status)&&t.get(n.status).push(n)}),t});this.filteredLeads=G(()=>{let e=this.leadStatusFilter(),t=this.leadSourceFilter(),n=this.leadSortBy(),o=this.displayLeads();return e!=="all"&&(o=o.filter(a=>a.status===e)),t!=="all"&&(o=o.filter(a=>a.sourceType===t)),o.sort((a,d)=>n==="intent"?(d.intentScore||0)-(a.intentScore||0):n==="time"?new Date(d.timestamp).getTime()-new Date(a.timestamp).getTime():(a.username||"").localeCompare(d.username||""))});this.leadsBySource=G(()=>{let e=this.leads();return{group_extract:e.filter(t=>t.sourceType==="group_extract").length,keyword_trigger:e.filter(t=>t.sourceType==="keyword_trigger").length,import:e.filter(t=>t.sourceType==="import").length,unknown:e.filter(t=>!t.sourceType||t.sourceType==="unknown").length}});this.funnelStats=_({stages:{},tags:[],interest_distribution:{},today_new:0,week_converted:0});this.funnelOverview=_({stages:[],totalLeads:0,convertedLeads:0,averageConversionDays:0,conversionRate:0});this.showFunnelVisualization=_(!1);this.isLoadingFunnel=_(!1);this.selectedJourneyUserId=_("");this.userJourneyData=_(null);this.isLoadingJourney=_(!1);this.leadsTab=_("kanban");this.marketingCampaigns=_([]);this.marketingStats=_({totalCampaigns:0,running:0,completed:0,totalMessages:0,totalInvites:0,successRate:0});this.showCreateCampaignDialog=_(!1);this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""};this.isLoadingMarketing=_(!1);this.warmupDetails=_({});this.showWarmupConfig=_(!1);this.selectedWarmupAccountId=_(null);this.usersWithProfiles=_({users:[],total:0,limit:50,offset:0});this.userFilterStage=_("");this.userFilterTags=_("");this.userFilterSearch=_("");this.selectedUserIds=_([]);this.funnelStages=[{key:"new",name:"\u65B0\u5BA2\u6236",color:"bg-blue-500"},{key:"contacted",name:"\u5DF2\u806F\u7E6B",color:"bg-cyan-500"},{key:"replied",name:"\u5DF2\u56DE\u5FA9",color:"bg-green-500"},{key:"interested",name:"\u6709\u8208\u8DA3",color:"bg-yellow-500"},{key:"negotiating",name:"\u6D3D\u8AC7\u4E2D",color:"bg-orange-500"},{key:"follow_up",name:"\u9700\u8DDF\u9032",color:"bg-purple-500"},{key:"converted",name:"\u5DF2\u6210\u4EA4",color:"bg-emerald-500"},{key:"churned",name:"\u5DF2\u6D41\u5931",color:"bg-red-500"}];this.dashboardStats=G(()=>{let e=this.accounts(),t=this.leads(),n=e.filter(m=>m.status==="Online").length,o=new Date;o.setHours(0,0,0,0);let a=t.filter(m=>new Date(m.timestamp)>=o).length,d=e.reduce((m,f)=>m+f.dailySendCount,0);return{totalAccounts:e.length,onlineAccounts:n,totalLeads:t.length,leadsToday:a,messagesSentToday:d}});this.selectedAnalyticsCampaignId=_("all");this.filteredAnalyticsLeads=G(()=>{let e=this.leads(),t=this.selectedAnalyticsCampaignId();return t==="all"?e:e.filter(n=>n.campaignId===t)});this.analyticsData=G(()=>{let e=this.filteredAnalyticsLeads(),t=new Date;t.setHours(0,0,0,0);let n=[];for(let d=6;d>=0;d--){let m=new Date(t);m.setDate(t.getDate()-d);let f=e.filter(h=>{let C=new Date(h.timestamp);return C.setHours(0,0,0,0),C.getTime()===m.getTime()}).length;n.push({date:m,count:f})}let o=Math.max(...n.map(d=>d.count),1),a={new:e.length,contacted:e.filter(d=>d.status!=="New").length,replied:e.filter(d=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(d.status)).length};return{leadsByDay:n,maxLeadsInPeriod:o,funnel:a}});this.campaignPerformance=G(()=>{let e=this.leads();return this.campaigns().map(t=>{let n=e.filter(m=>m.campaignId===t.id),o=n.filter(m=>m.status!=="New").length,a=n.filter(m=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(m.status)).length,d=o>0?a/o*100:0;return{id:t.id,name:t.name,isActive:t.isActive,leads:n.length,contacted:o,replied:a,replyRate:d}})});this.isMonitoring=_(!1);this.coreDataLoaded=_(!1);this.senderRoundRobinIndex=_(0);this.oneClickStarting=_(!1);this.oneClickProgress=_(0);this.oneClickMessage=_("");this.oneClickStartReport=_(null);this.showStartReport=_(!1);this.systemStatus=_({accounts:{total:0,online:0,offline:0},monitoring:{active:!1,groups:0},ai:{enabled:!1,mode:"semi",endpoint:""},keywords:{sets:0,total:0},campaigns:{total:0,active:0},templates:{total:0,active:0},poller:{running:!1}});this.lastInitialStateTime=0;this.isPageVisible=!0;this.backendConnectionState=_("connecting");this.backendConnectionMessage=_("\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...");this.backendConnectionProgress=_(0);this.connectionStartTime=0;this.connectionTimeoutId=null;this.isStartingMonitoring=_(!1);this.lastConfigCheck=_(null);this.errorNavigationMap={NO_LISTENER:{view:"accounts",elementId:"accounts-section"},LISTENER_OFFLINE:{view:"accounts",elementId:"accounts-section"},NO_SENDER:{view:"accounts",elementId:"accounts-section"},SENDER_OFFLINE:{view:"accounts",elementId:"accounts-section"},SENDER_LIMIT_REACHED:{view:"accounts",elementId:"accounts-section"},NO_GROUPS:{view:"automation",elementId:"monitored-groups-section"},NO_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},EMPTY_KEYWORDS:{view:"automation",elementId:"keyword-sets-section"},GROUP_NO_KEYWORD:{view:"automation",elementId:"monitored-groups-section"},NO_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_ACTIVE_CAMPAIGN:{view:"trigger-rules",elementId:"trigger-rules-section"},CAMPAIGN_INCOMPLETE:{view:"trigger-rules",elementId:"trigger-rules-section"},NO_TEMPLATE:{view:"automation",elementId:"templates-section"},AI_NOT_ENABLED:{view:"ai-center",elementId:"ai-settings-section"}};this.selectedDays=_(7);this.alertManagementTab=_("alerts");this.alertRules=_([]);this.alertHistory=_([]);this.showAddAlertRuleDialog=_(!1);this.deleteConfirmDialog=_({show:!1,type:"single"});this.isSubmittingCampaign=_(!1);let e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.theme.set(e?"dark":"light"),Dn(()=>{this.document.documentElement.className=this.theme()}),Dn(()=>{let t=this.navBridge.currentView(),n=this.currentView();t&&t!==n&&(console.log("[AppComponent] \u540C\u6B65\u5C0E\u822A:",t,"\u2190 from NavBridge"),this.currentView.set(t))})}get routerUrl(){return this.router?.url||"N/A"}toggleSidebarGroup(e){let t=this.sidebarGroups();this.sidebarGroups.set(B(F({},t),{[e]:!t[e]})),localStorage.setItem("sidebar_groups",JSON.stringify(this.sidebarGroups()))}isSidebarGroupExpanded(e){return this.sidebarGroups()[e]??!0}loadSidebarGroupsState(){try{let e=localStorage.getItem("sidebar_groups");if(e){let n=JSON.parse(e);this.sidebarGroups.set(F(F({},this.sidebarGroups()),n))}localStorage.getItem("sidebar_collapsed")==="true"&&this.sidebarCollapsed.set(!0)}catch(e){console.warn("[Sidebar] Failed to load sidebar groups state:",e)}}initMobileDetection(){if(typeof window>"u")return;this._mobileMediaQuery=window.matchMedia("(max-width: 768px)");let e=t=>{let n=t.matches;this.isMobile.set(n),n&&(this.sidebarCollapsed.set(!1),this.mobileMenuOpen.set(!1))};e(this._mobileMediaQuery),this._mobileMediaQuery.addEventListener("change",e)}toggleMobileMenu(){this.mobileMenuOpen.update(e=>!e)}onMobileNavSelect(){this.isMobile()&&this.mobileMenuOpen.set(!1)}toggleSidebarCollapse(){if(this.isMobile()){this.toggleMobileMenu();return}let e=!this.sidebarCollapsed();this.sidebarCollapsed.set(e),localStorage.setItem("sidebar_collapsed",String(e))}get showQrLoginDialog(){return this.dialogService.showQrLoginDialog}hideSearchSuggestions(){setTimeout(()=>this.showSearchSuggestions.set(!1),200)}isInSearchResultMode(){return this.currentSearchKeyword().length>0}exitSearchResultMode(){this.currentSearchKeyword.set(""),this.loadResources()}saveSettings(){this.saveSettingsTimer&&clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=setTimeout(()=>{this.ipcService.send("save-settings",{settings:{spintaxEnabled:this.spintaxEnabled(),autoReplyEnabled:this.autoReplyEnabled(),autoReplyMessage:this.autoReplyMessage(),smartSendingEnabled:this.smartSendingEnabled()}}),this.saveSettingsTimer=null},500)}showSettingsSavedToast(){this.toastService.success(this.t("settingsSaved"),2e3)}async testAiConnection(){if(this.aiApiType()==="local"){await this.testLocalAiConnection();return}if(this.aiApiKey()){this.isTestingAi.set(!0),this.aiConnectionStatus.set(null);try{this.ipcService.send("test-ai-connection",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint()}),await new Promise(t=>setTimeout(t,1500));let e=this.aiApiKey();this.aiApiType()==="gemini"&&e.startsWith("AIza")?this.aiConnectionStatus.set("success"):this.aiApiType()==="openai"&&e.startsWith("sk-")?this.aiConnectionStatus.set("success"):this.aiApiType()==="custom"&&e.length>10?this.aiConnectionStatus.set("success"):(this.aiConnectionStatus.set("error"),this.aiConnectionError.set(this.t("invalidApiKeyFormat")))}catch(e){this.aiConnectionStatus.set("error"),this.aiConnectionError.set(e.message)}finally{this.isTestingAi.set(!1)}}}async testLocalAiConnection(){let e=this.localAiEndpoint();if(e){this.isTestingLocalAi.set(!0),this.localAiStatus.set(null);try{this.ipcService.send("test-local-ai",{endpoint:e,provider:this.localAiProvider(),model:this.localAiModel()}),this.localAiProvider()==="ollama"&&this.ipcService.send("get-ollama-models",{endpoint:e}),await new Promise(t=>setTimeout(t,3e3)),e.startsWith("http://")||e.startsWith("https://")?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success("\u672C\u5730 AI \u670D\u52D9\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(this.t("invalidEndpointFormat")))}catch(t){this.localAiStatus.set("error"),this.localAiError.set(t.message)}finally{this.isTestingLocalAi.set(!1)}}}refreshOllamaModels(){let e=this.localAiEndpoint();e&&(this.toastService.info("\u6B63\u5728\u7372\u53D6\u6A21\u578B\u5217\u8868..."),this.ipcService.send("get-ollama-models",{endpoint:e}))}setLocalAiPresets(e){switch(this.localAiProvider.set(e),e){case"ollama":this.localAiEndpoint.set("http://localhost:11434"),this.localAiModel.set("qwen2:7b");break;case"lmstudio":this.localAiEndpoint.set("http://localhost:1234"),this.localAiModel.set("");break;case"custom":this.localAiEndpoint.set(""),this.localAiModel.set("");break}}async testTtsConnection(){let e=this.ttsEndpoint();if(e){this.isTestingTts.set(!0),this.ttsStatus.set(null);try{this.ipcService.send("test-tts-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.ttsStatus.set("success"):(this.ttsStatus.set("error"),this.ttsError.set(this.t("invalidEndpointFormat")))}catch(t){this.ttsStatus.set("error"),this.ttsError.set(t.message)}finally{this.isTestingTts.set(!1)}}}async testSttConnection(){let e=this.sttEndpoint();if(e){this.isTestingStt.set(!0),this.sttStatus.set(null);try{this.ipcService.send("test-stt-service",{endpoint:e}),await new Promise(t=>setTimeout(t,2e3)),e.startsWith("http://")||e.startsWith("https://")?this.sttStatus.set("success"):(this.sttStatus.set("error"),this.sttError.set(this.t("invalidEndpointFormat")))}catch(t){this.sttStatus.set("error"),this.sttError.set(t.message)}finally{this.isTestingStt.set(!1)}}}saveAiSettings(){localStorage.setItem("ai_api_key",this.aiApiKey()),localStorage.setItem("ai_api_type",this.aiApiType()),localStorage.setItem("ai_custom_endpoint",this.customApiEndpoint()),localStorage.setItem("local_ai_endpoint",this.localAiEndpoint()),localStorage.setItem("local_ai_model",this.localAiModel()),localStorage.setItem("tts_endpoint",this.ttsEndpoint()),localStorage.setItem("tts_enabled",String(this.ttsEnabled())),localStorage.setItem("tts_voice",this.ttsVoice()),localStorage.setItem("stt_endpoint",this.sttEndpoint()),localStorage.setItem("stt_enabled",String(this.sttEnabled())),this.ipcService.send("save-ai-settings",{apiType:this.aiApiType(),apiKey:this.aiApiKey(),endpoint:this.customApiEndpoint(),localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel(),ttsEndpoint:this.ttsEndpoint(),ttsEnabled:this.ttsEnabled(),ttsVoice:this.ttsVoice(),sttEndpoint:this.sttEndpoint(),sttEnabled:this.sttEnabled()}),this.aiApiType()==="gemini"&&this.aiApiKey()&&this.geminiService.setApiKey(this.aiApiKey()),this.toastService.success(this.t("aiSettingsSaved"),2e3)}toggleAiAutoChat(){this.aiAutoChatEnabled.set(!this.aiAutoChatEnabled()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoChatEnabled()?"AI \u81EA\u52D5\u804A\u5929\u5DF2\u958B\u555F":"AI \u81EA\u52D5\u804A\u5929\u5DF2\u95DC\u9589",2e3)}toggleAiAutoGreeting(){this.aiAutoGreeting.set(!this.aiAutoGreeting()),this.saveAiChatSettings(),this.toastService.success(this.aiAutoGreeting()?"\u81EA\u52D5\u554F\u5019\u5DF2\u958B\u555F":"\u81EA\u52D5\u554F\u5019\u5DF2\u95DC\u9589",2e3)}saveAiChatSettings(){localStorage.setItem("ai_auto_chat_enabled",String(this.aiAutoChatEnabled())),localStorage.setItem("ai_auto_chat_mode",this.aiAutoChatMode()),localStorage.setItem("ai_typing_speed",String(this.aiTypingSpeed())),localStorage.setItem("ai_reply_delay",JSON.stringify(this.aiReplyDelay())),localStorage.setItem("ai_system_prompt",this.aiSystemPrompt()),localStorage.setItem("ai_max_context_messages",String(this.aiMaxContextMessages())),localStorage.setItem("ai_enable_memory",String(this.aiEnableMemory())),localStorage.setItem("ai_auto_greeting",String(this.aiAutoGreeting())),localStorage.setItem("ai_greeting_message",this.aiGreetingMessage()),this.ipcService.send("update-ai-chat-settings",{settings:{auto_chat_enabled:this.aiAutoChatEnabled()?1:0,auto_chat_mode:this.aiAutoChatMode(),typing_speed:this.aiTypingSpeed(),reply_delay_min:this.aiReplyDelay()[0],reply_delay_max:this.aiReplyDelay()[1],system_prompt:this.aiSystemPrompt(),max_context_messages:this.aiMaxContextMessages(),enable_memory:this.aiEnableMemory()?1:0,auto_greeting:this.aiAutoGreeting()?1:0,greeting_message:this.aiGreetingMessage()},localAiEndpoint:this.localAiEndpoint(),localAiModel:this.localAiModel()}),this.toastService.success(this.t("aiSettingsSaved"),2e3)}loadAiChatSettings(){let e=localStorage.getItem("ai_auto_chat_enabled"),t=localStorage.getItem("ai_auto_chat_mode"),n=localStorage.getItem("ai_typing_speed"),o=localStorage.getItem("ai_reply_delay"),a=localStorage.getItem("ai_system_prompt"),d=localStorage.getItem("ai_max_context_messages"),m=localStorage.getItem("ai_enable_memory"),f=localStorage.getItem("ai_auto_greeting"),h=localStorage.getItem("ai_greeting_message");if(e&&this.aiAutoChatEnabled.set(e==="true"),t&&this.aiAutoChatMode.set(t),n&&this.aiTypingSpeed.set(parseInt(n)),o)try{this.aiReplyDelay.set(JSON.parse(o))}catch{}a&&this.aiSystemPrompt.set(a),d&&this.aiMaxContextMessages.set(parseInt(d)),m&&this.aiEnableMemory.set(m==="true"),f&&this.aiAutoGreeting.set(f==="true"),h&&this.aiGreetingMessage.set(h)}initRagSystem(){this.isInitializingRag.set(!0),this.ipcService.send("init-rag-system",{})}triggerRagLearning(){this.isRagLearning.set(!0),this.ipcService.send("trigger-rag-learning",{})}reindexHighValueConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30})}cleanupRagKnowledge(){this.isCleaningRag.set(!0),this.ipcService.send("cleanup-rag-knowledge",{minScore:.2,daysOld:30,mergeSimilar:!0})}reindexConversations(){this.isReindexing.set(!0),this.ipcService.send("reindex-conversations",{highValueOnly:!0,days:30}),this.toastService.info("\u958B\u59CB\u91CD\u5EFA\u7D22\u5F15...")}refreshRagStats(){this.ipcService.send("get-rag-stats",{})}searchRagKnowledge(){this.ragSearchQuery.trim()&&(this.isSearchingRag.set(!0),this.ipcService.send("search-rag",{query:this.ragSearchQuery,limit:10}))}sendRagFeedback(e,t){this.ipcService.send("rag-feedback",{knowledgeId:e,isPositive:t}),this.toastService.info(t?"\u{1F44D} \u611F\u8B1D\u53CD\u994B\uFF01":"\u{1F44E} \u5DF2\u8A18\u9304\u53CD\u994B")}addRagKnowledge(){if(!this.newRagKnowledge.answer.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u56DE\u7B54\u5167\u5BB9");return}this.ipcService.send("add-rag-knowledge",{type:this.newRagKnowledge.type,question:this.newRagKnowledge.question,answer:this.newRagKnowledge.answer,context:this.newRagKnowledge.context}),this.newRagKnowledge={type:"qa",question:"",answer:"",context:""},this.showAddRagKnowledgeDialog.set(!1)}searchVectorMemory(){this.vectorMemorySearchQuery.trim()&&(this.isSearchingMemory.set(!0),this.ipcService.send("search-vector-memories",{userId:this.selectedMemoryUserId()||"",query:this.vectorMemorySearchQuery,limit:10}))}addVectorMemory(){if(!this.newMemory.content.trim()){this.toastService.error("\u8ACB\u586B\u5BEB\u8A18\u61B6\u5167\u5BB9");return}this.isAddingMemory.set(!0),this.ipcService.send("add-vector-memory",{userId:this.newMemory.userId||"manual",content:this.newMemory.content,type:this.newMemory.type,importance:this.newMemory.importance})}refreshMemoryStats(){this.ipcService.send("get-memory-stats",{userId:""})}deleteVectorMemory(e){this.ipcService.send("delete-vector-memory",{memoryId:e})}loadMemoryUserList(){this.ipcService.send("get-memory-user-list",{})}cleanupOldMemories(){this.ipcService.send("cleanup-old-memories",{daysOld:90})}mergeSimilarMemories(){let e=this.selectedMemoryUserId();if(!e){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("merge-similar-memories",{userId:e,threshold:.85})}getResourceDiscoveryAccounts(){return this.accounts().filter(t=>t.status==="Online").sort((t,n)=>{let o={Explorer:1,Listener:2,Sender:3,AI:4,Backup:5,Unassigned:6};return(o[t.role]||99)-(o[n.role]||99)})}getSelectedResourceAccount(){let e=this.resourceAccountId();if(e)return this.accounts().find(n=>n.id===e)||null;let t=this.getResourceDiscoveryAccounts();return t.length>0?t[0]:null}selectResourceAccount(e){this.resourceAccountId.set(e);let t=this.accounts().find(n=>n.id===e);t&&this.toastService.success(`\u8CC7\u6E90\u767C\u73FE\u5C07\u4F7F\u7528: ${t.phone}`),this.showResourceAccountSelector.set(!1)}getRoleDisplayName(e){return{Explorer:"\u{1F50D} \u63A2\u7D22\u865F",Listener:"\u{1F441}\uFE0F \u76E3\u63A7\u865F",Sender:"\u{1F4E4} \u767C\u9001\u865F",AI:"\u{1F916} AI\u865F",Backup:"\u26A1 \u5099\u7528\u865F",Unassigned:"\u2B55 \u672A\u5206\u914D"}[e]||"\u2B55 \u672A\u5206\u914D"}initResourceDiscovery(){let e=this.getSelectedResourceAccount();if(!e){this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");return}this.toastService.info(`\u6B63\u5728\u4F7F\u7528 ${e.phone} \u521D\u59CB\u5316\u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71...`),this.ipcService.send("init-resource-discovery",{accountId:e.id,phone:e.phone})}autoInitResourceDiscovery(){this.resourceDiscoveryInitialized()||this.initResourceDiscovery(),this.refreshResourceStats(),this.loadDiscoveryKeywords()}generateSearchSessionId(){return`search_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}generateSearchCacheKey(e,t){let n=e.toLowerCase().trim(),o=[...t].sort().join(",");return`${n}|${o}`}getSearchCache(e){let t=this.searchResultsCache.get(e);return t?Date.now()-t.timestamp>this.CACHE_EXPIRY_MS?(this.searchResultsCache.delete(e),null):t.results:null}setSearchCache(e,t){if(this.searchResultsCache.size>20){let n=Array.from(this.searchResultsCache.entries());n.sort((a,d)=>a[1].timestamp-d[1].timestamp),n.slice(0,n.length-20).forEach(([a])=>this.searchResultsCache.delete(a))}this.searchResultsCache.set(e,{results:[...t],timestamp:Date.now()}),console.log(`[Search Cache] \u5DF2\u7DE9\u5B58\u641C\u7D22\u7D50\u679C: "${e}" (${t.length} \u689D)`)}clearSearchCache(){this.searchResultsCache.clear(),console.log("[Search Cache] \u5DF2\u6E05\u9664\u6240\u6709\u7DE9\u5B58")}searchResources(){if(!this.resourceSearchQuery.trim()){this.toastService.error(this.t("searchPlaceholder"));return}if(this.selectedSearchSources().length===0){this.toastService.error("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u641C\u7D22\u6E20\u9053");return}if(this.getOnlineAccountsCount()===0){this.toastService.error("\u8ACB\u5148\u767B\u9304\u5E33\u865F");return}let e=this.resourceSearchQuery.trim(),t=this.selectedSearchSources(),n=this.generateSearchCacheKey(e,t),o=this.getSearchCache(n);if(o){console.log(`[Search Cache] \u4F7F\u7528\u7DE9\u5B58\u7D50\u679C: "${e}" (${o.length} \u689D)`),this.currentSearchKeyword.set(e),this.discoveredResources.set(o),this.showSearchHistory.set(!1);let h=this.searchHistoryKeywords(),C=[e,...h.filter(y=>y!==e)].slice(0,10);this.searchHistoryKeywords.set(C);return}let a=this.generateSearchSessionId();this.currentSearchSessionId.set(a),this.currentSearchKeyword.set(e),this.showSearchHistory.set(!1);let d=this.searchHistoryKeywords(),m=[e,...d.filter(h=>h!==e)].slice(0,10);this.searchHistoryKeywords.set(m),this.discoveredResources.set([]);let f=e.split(/[,;]/).map(h=>h.trim()).filter(h=>h.length>0);f.length>1?(console.log(`[Search] \u6B63\u5728\u641C\u7D22 ${f.length} \u4E2A\u5173\u952E\u8BCD...`),this.searchMultipleKeywords(f)):(this.isSearchingResources.set(!0),this.searchError.set({hasError:!1,message:"",details:"",suggestions:[]}),console.log(`[Search] \u6B63\u5728\u641C\u7D22 "${e}"...`),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u7A0D\u540E\u518D\u8BD5"))},7e4),this.executeMultiSourceSearch(e,t))}executeMultiSourceSearch(e,t){let n=this.getSelectedResourceAccount()?.phone,o=this.currentSearchSessionId();(t.includes("telegram")||t.includes("local"))&&this.ipcService.send("search-resources",{query:e,phone:n,sources:t.filter(a=>a!=="jiso"),limit:50,searchType:this.resourceSearchType(),minMembers:this.resourceMinMembers(),replaceMode:!0,searchSessionId:o,searchKeyword:e}),t.includes("jiso")&&(console.log("[Search] \u6B63\u5728\u901A\u8FC7\u6781\u641C Bot \u641C\u7D22..."),this.ipcService.send("search-jiso",{keyword:e,phone:n,limit:50,searchSessionId:o,searchKeyword:e})),t.includes("tgstat")}searchMultipleKeywords(e){this.isSearchingResources.set(!0);let t=this.selectedSearchSources();this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.isSearchingResources()&&(this.isSearchingResources.set(!1),this.toastService.error("\u641C\u7D22\u8D85\u65F6"))},e.length*1e4+3e4),e.forEach((n,o)=>{setTimeout(()=>{this.executeMultiSourceSearch(n,t)},o*5e3)})}openTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link;t?this.ipcService.send("open-external-link",{url:t}):this.toastService.warning("\u6B64\u7FA4\u7D44\u6C92\u6709\u516C\u958B\u93C8\u63A5")}copyTelegramLink(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||"";t?(navigator.clipboard.writeText(t),this.toastService.success("\u93C8\u63A5\u5DF2\u8907\u88FD")):(navigator.clipboard.writeText(e.title),this.toastService.warning("\u6B64\u7FA4\u7D44\u7121\u516C\u958B\u93C8\u63A5\uFF0C\u5DF2\u8907\u88FD\u7FA4\u7D44\u540D\u7A31\uFF0C\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u641C\u7D22"))}copyUsername(e){let t=`@${e}`;navigator.clipboard.writeText(t),this.toastService.success("\u5DF2\u8907\u88FD "+t)}getResourceTypeIcon(e){switch(e){case"channel":return"\u{1F4E2}";case"supergroup":return"\u{1F465}";case"group":return"\u{1F4AC}";default:return"\u{1F4CC}"}}getResourceTypeLabel(e){switch(e){case"channel":return"\u983B\u9053";case"supergroup":return"\u8D85\u7D1A\u7FA4\u7D44";case"group":return"\u7FA4\u7D44";default:return"\u672A\u77E5"}}formatMemberCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}quickJoinResource(e){this.ipcService.send("batch-join-resources",{resourceIds:[e]}),this.toastService.info("\u6B63\u5728\u5617\u8A66\u52A0\u5165...")}loadResources(){this.ipcService.send("get-resources",{status:this.resourceFilterStatus()||void 0,type:this.resourceFilterType()||void 0,limit:100,offset:0})}filterResourcesByLink(){let e=this.resourceFilterLink();if(!e){this.loadResources();return}let n=this.discoveredResources().filter(o=>{let a=!!(o.username||o.invite_link);return e==="has_link"?a:e==="no_link"?!a:!0});this.discoveredResources.set(n)}refreshResourceStats(){this.ipcService.send("get-resource-stats",{})}openChannelManageDialog(){this.loadSearchChannels(),this.showChannelManageDialog.set(!0)}closeChannelManageDialog(){this.showChannelManageDialog.set(!1)}loadSearchChannels(){this.ipcService.send("get-search-channels",{})}openAddChannelDialog(){this.newChannelUsername="",this.newChannelDisplayName="",this.newChannelQueryFormat="{keyword}",this.newChannelPriority="backup",this.newChannelNotes="",this.showAddChannelDialog.set(!0)}closeAddChannelDialog(){this.showAddChannelDialog.set(!1)}addSearchChannel(){if(!this.newChannelUsername.trim()){this.toastService.error("\u8ACB\u8F38\u5165 Bot \u7528\u6236\u540D");return}this.ipcService.send("add-search-channel",{botUsername:this.newChannelUsername.trim(),displayName:this.newChannelDisplayName.trim()||this.newChannelUsername.trim(),queryFormat:this.newChannelQueryFormat,priority:this.newChannelPriority,notes:this.newChannelNotes})}deleteSearchChannel(e){if(e<0){this.toastService.warning("\u7121\u6CD5\u522A\u9664\u7CFB\u7D71\u6E20\u9053");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u500B\u641C\u7D22\u6E20\u9053\u55CE\uFF1F")&&this.ipcService.send("delete-search-channel",{channelId:e})}testSearchChannel(e){this.isTestingChannel.set(!0),this.toastService.info(`\u6B63\u5728\u6E2C\u8A66 @${e}...`),this.ipcService.send("test-search-channel",{botUsername:e})}toggleChannelEnabled(e,t){if(e<0){this.toastService.warning("\u7121\u6CD5\u4FEE\u6539\u7CFB\u7D71\u6E20\u9053");return}this.ipcService.send("update-search-channel",{channelId:e,enabled:!t})}getChannelStatusColor(e){switch(e){case"online":return"text-green-400";case"offline":return"text-red-400";case"captcha":return"text-yellow-400";default:return"text-gray-400"}}getChannelStatusIcon(e){switch(e){case"online":return"\u{1F7E2}";case"offline":return"\u{1F534}";case"captcha":return"\u{1F7E1}";default:return"\u26AA"}}openJoinAndMonitorDialog(e){this.joinMonitorResource.set(e),this.joinMonitorKeywords.set([]),this.joinMonitorNewKeyword="",this.joinMonitorAutoEnable.set(!0),this.loadAccountQuotas(),e.joined_by_phone?this.joinMonitorSelectedPhone.set(e.joined_by_phone):this.joinMonitorSelectedPhone.set("");let t=this.monitoredGroups().find(n=>n.url===e.username||n.url===`@${e.username}`||n.url===e.telegram_id||n.id===e.id);t&&t.keywordSetIds?this.joinMonitorSelectedKeywordSetIds.set([...t.keywordSetIds]):this.joinMonitorSelectedKeywordSetIds.set([]),this.showQuickCreateKeywordSet.set(!1),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword="",this.showJoinMonitorDialog.set(!0)}closeJoinMonitorDialog(){this.showJoinMonitorDialog.set(!1),this.joinMonitorResource.set(null),this.showChangeMonitorAccount.set(!1)}getAvailableAccountsForMonitor(){return this.accounts().filter(e=>e.status==="Online")}selectMonitorAccount(e){this.joinMonitorSelectedPhone.set(e),this.showChangeMonitorAccount.set(!1)}stopMonitoringGroup(e){if(!e)return;let t=e.telegram_id||e.id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u8B58\u5225\u7FA4\u7D44");return}this.ipcService.send("remove-group",{groupId:t,id:e.id,telegramId:e.telegram_id,username:e.username,link:e.link||e.invite_link}),this.updateResourceStatusLocally(e,"joined"),this.closeJoinMonitorDialog(),this.closeResourceMenu(),this.toastService.info("\u6B63\u5728\u505C\u6B62\u76E3\u63A7..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},500)}confirmLeaveGroup(e){if(!e)return;let t=e.title||e.username||"\u6B64\u7FA4\u7D44";confirm(`\u78BA\u5B9A\u8981\u9000\u51FA\u300C${t}\u300D\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\uFF1A
\u2022 \u5F9E Telegram \u9000\u51FA\u7FA4\u7D44
\u2022 \u505C\u6B62\u6240\u6709\u76E3\u63A7
\u2022 \u522A\u9664\u76F8\u95DC\u6578\u64DA`)&&this.leaveGroup(e)}leaveGroup(e){if(!e)return;let t=e.joined_by_phone||this.joinMonitorSelectedPhone(),n=e.telegram_id||e.username;if(!t){this.toastService.error("\u7121\u6CD5\u78BA\u5B9A\u4F7F\u7528\u7684\u5E33\u865F");return}this.ipcService.send("leave-group",{phone:t,groupId:n,resourceId:e.id}),this.updateResourceStatusLocally(e,"discovered"),this.closeJoinMonitorDialog(),this.toastService.info("\u6B63\u5728\u9000\u51FA\u7FA4\u7D44..."),setTimeout(()=>{this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")},1e3)}openInTelegram(e){let t=e.username?`https://t.me/${e.username}`:e.invite_link||e.link;t?window.open(t,"_blank"):this.toastService.warning("\u6C92\u6709\u53EF\u7528\u7684\u93C8\u63A5")}deleteResource(e){if(e?.id&&confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u300C${e.title||"\u6B64\u8CC7\u6E90"}\u300D\u7684\u8A18\u9304\u55CE\uFF1F`)){this.ipcService.send("delete-resource",{resourceId:e.id});let t=this.discoveredResources();this.discoveredResources.set(t.filter(n=>n.id!==e.id)),this.toastService.success("\u5DF2\u522A\u9664\u8CC7\u6E90\u8A18\u9304"),this.refreshResourceStats()}}updateResourceStatusLocally(e,t,n,o){if(!e)return;let a=this.discoveredResources(),d=e.telegram_id||e.username||e.title,m=a.map(f=>{if((f.telegram_id||f.username||f.title)===d){let C=B(F({},f),{status:t,joined_at:new Date().toISOString()});return n&&(C.joined_by_phone=n),o&&o>0&&(C.member_count=o),C}return f});this.discoveredResources.set(m),console.log(`[Frontend] Updated resource status: ${d} -> ${t}`)}showPostJoinOptions(e,t,n){this.showJoinMonitorDialog.set(!1),this.showSuccessAnimation({icon:"\u{1F680}",title:"\u52A0\u5165\u6210\u529F\uFF01",subtitle:e?.title||"\u7FA4\u7D44\u5DF2\u6DFB\u52A0\u5230\u76E3\u63A7",duration:1200}),setTimeout(()=>{this.postJoinResource.set(e),this.postJoinPhone.set(t),this.showPostJoinDialog.set(!0)},1200)}closePostJoinDialog(){this.showPostJoinDialog.set(!1),this.postJoinResource.set(null),this.postJoinPhone.set("")}showSuccessAnimation(e){this.successOverlayConfig.set(e),this.showSuccessOverlay.set(!0);let t=e.duration||1500;setTimeout(()=>{this.hideSuccessAnimation()},t)}hideSuccessAnimation(){this.showSuccessOverlay.set(!1),this.successOverlayConfig.set(null)}postJoinExtractMembers(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openMemberListDialog(e))}postJoinSendMessage(){let e=this.postJoinResource();e&&(this.closePostJoinDialog(),this.openSingleMessageDialog(e))}postJoinContinue(){this.closePostJoinDialog(),this.toastService.info("\u7E7C\u7E8C\u700F\u89BD\u5176\u4ED6\u7FA4\u7D44",2e3)}loadAccountQuotas(){let n=this.accounts().filter(o=>o.status==="Online").map(o=>{let a=Math.floor(o.dailySendCount/10)||0,d=20,m=Math.floor(o.dailySendCount/5)||0,f=o.healthScore||0,h=d>0?(d-m)/d*100:0,C=f*.5+h*.5;return{phone:o.phone,nickname:o.group||o.phone,joinedGroups:a,dailyLimit:d,dailyUsed:Math.min(m,d),isRecommended:!1,recommendScore:C,healthScore:f}}).sort((o,a)=>a.recommendScore-o.recommendScore).map((o,a)=>{let d=o.healthScore>=70&&o.dailyUsed<o.dailyLimit*.8,m=a<2&&d;return B(F({},o),{isRecommended:m})});if(this.accountQuotas.set(n),!this.joinMonitorSelectedPhone()){let o=n.find(a=>a.isRecommended);o?this.joinMonitorSelectedPhone.set(o.phone):n.length>0&&this.joinMonitorSelectedPhone.set(n[0].phone)}}toggleKeywordSetSelection(e){let t=this.joinMonitorSelectedKeywordSetIds();if(t.includes(e))this.joinMonitorSelectedKeywordSetIds.set(t.filter(n=>n!==e));else{let n=this.keywordSets().find(o=>o.id===e);if(n&&(!n.keywords||n.keywords.length===0)){this.toastService.warning(`\u26A0\uFE0F \u300C${n.name}\u300D\u6C92\u6709\u95DC\u9375\u8A5E\uFF0C\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u518D\u4F7F\u7528`);return}this.joinMonitorSelectedKeywordSetIds.set([...t,e])}}isKeywordSetSelected(e){return this.joinMonitorSelectedKeywordSetIds().includes(e)}openQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!0),this.quickCreateKeywordSetName="",this.quickCreateKeywordSetKeywords.set([]),this.quickCreateKeywordSetNewKeyword=""}closeQuickCreateKeywordSet(){this.showQuickCreateKeywordSet.set(!1)}addQuickKeyword(){let e=this.quickCreateKeywordSetNewKeyword.trim();e&&!this.quickCreateKeywordSetKeywords().includes(e)&&(this.quickCreateKeywordSetKeywords.update(t=>[...t,e]),this.quickCreateKeywordSetNewKeyword="")}removeQuickKeyword(e){this.quickCreateKeywordSetKeywords.update(t=>t.filter(n=>n!==e))}addQuickRecommendedKeyword(e){this.quickCreateKeywordSetKeywords().includes(e)||this.quickCreateKeywordSetKeywords.update(t=>[...t,e])}executeQuickCreateKeywordSet(){let e=this.quickCreateKeywordSetName.trim(),t=this.quickCreateKeywordSetKeywords();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u8A5E\u96C6\u540D\u7A31");return}if(t.length===0){this.toastService.warning("\u8ACB\u81F3\u5C11\u6DFB\u52A0\u4E00\u500B\u95DC\u9375\u8A5E");return}this.ipcService.send("add-keyword-set",{name:e});let n=o=>{if(o.success&&o.setId){for(let a of t)this.ipcService.send("add-keyword",{setId:o.setId,keyword:a,isRegex:!1});this.joinMonitorSelectedKeywordSetIds.update(a=>[...a,o.setId]),this.toastService.success(`\u5DF2\u5275\u5EFA\u4E26\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6\u300C${e}\u300D`),this.closeQuickCreateKeywordSet(),this.ipcService.send("get-keyword-sets")}this.ipcService.off("keyword-set-added",n)};this.ipcService.on("keyword-set-added",n)}addMonitorKeyword(){let e=this.joinMonitorNewKeyword.trim();e&&!this.joinMonitorKeywords().includes(e)&&(this.joinMonitorKeywords.update(t=>[...t,e]),this.joinMonitorNewKeyword="")}removeMonitorKeyword(e){this.joinMonitorKeywords.update(t=>t.filter(n=>n!==e))}addRecommendedKeyword(e){this.joinMonitorKeywords().includes(e)||this.joinMonitorKeywords.update(t=>[...t,e])}getRecommendedKeywords(){let e=this.joinMonitorResource();if(!e)return[];let t=e.title||"",n=[];return(t.includes("\u4E8C\u624B")||t.includes("\u4EA4\u6613"))&&n.push("\u6C42\u8CFC","\u51FA\u552E","\u8F49\u8B93"),(t.includes("\u62DB\u8058")||t.includes("\u6C42\u8077"))&&n.push("\u62DB\u4EBA","\u6C42\u8077","\u517C\u8077"),(t.includes("\u83EF\u4EBA")||t.includes("\u6D77\u5916"))&&n.push("\u5408\u4F5C","\u8CC7\u6E90","\u6C42\u52A9"),n.length===0&&n.push("\u6C42\u8CFC","\u5408\u4F5C","\u8AEE\u8A62"),n.filter(o=>!this.joinMonitorKeywords().includes(o))}getKeywordPreview(e){if(!e||e.length===0)return"";let t=e.slice(0,3).map(n=>n.keyword||n.text||n).join(", ");return e.length>3?t+"...":t}executeJoinAndMonitor(){let e=this.joinMonitorResource(),t=this.joinMonitorSelectedPhone();if(!e){this.toastService.error("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}if(e.status!=="joined"&&e.status!=="monitoring"&&!t){this.toastService.error("\u8ACB\u9078\u64C7\u52A0\u5165\u5E33\u865F");return}this.isJoiningResource.set(!0);let n=this.joinMonitorSelectedKeywordSetIds(),o={resourceId:e.id||0,phone:t,keywordSetIds:n,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable()};if(!e.id||e.id===0){let a=e.link||e.invite_link||"",d=e.username||"";if(d&&d.toLowerCase().endsWith("bot")&&(console.log(`[Frontend] \u904E\u6FFE bot username: ${d}`),d=""),a&&/t\.me\/[^/]+\/\d+/.test(a)&&(console.log(`[Frontend] \u904E\u6FFE\u6D88\u606F\u93C8\u63A5: ${a}`),a=""),!a&&!d){let f=e.title||"\u6B64\u7FA4\u7D44";this.toastService.error(`\u7121\u6CD5\u52A0\u5165\u300C${f}\u300D\uFF1A
\u2022 \u6B64\u641C\u7D22\u7D50\u679C\u6C92\u6709\u63D0\u4F9B\u7FA4\u7D44\u7684\u9080\u8ACB\u93C8\u63A5
\u2022 \u8ACB\u5728 Telegram \u4E2D\u9EDE\u64CA\u641C\u7D22\u6A5F\u5668\u4EBA\u7684\u7D50\u679C
\u2022 \u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5\u5F8C\u518D\u8A66`),this.isJoiningResource.set(!1);return}let m="";e.telegram_id&&e.telegram_id!==e.title&&!e.telegram_id.toLowerCase().endsWith("bot")?m=e.telegram_id:d&&(m=d),o.resourceInfo={username:d,telegram_id:m,title:e.title||d||"\u672A\u547D\u540D\u7FA4\u7D44",description:e.description||"",member_count:e.member_count||0,resource_type:e.resource_type||"supergroup",link:a||(d?`https://t.me/${d}`:"")},console.log("[Frontend] Sending resourceInfo:",o.resourceInfo)}if(this.ipcService.send("join-and-monitor-with-account",o),e.status==="joined"||e.status==="monitoring"){let a=e.username?`@${e.username}`:e.telegram_id;this.ipcService.send("add-group",{url:a,keywordSetIds:n})}}openMonitorSettings(e){this.openJoinAndMonitorDialog(e)}openBatchJoinMonitorDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.batchJoinResources.set(t),this.joinMonitorSelectedPhones.set([]),this.joinMonitorKeywords.set([]),this.joinMonitorSelectedKeywordSetIds.set([]),this.joinMonitorBatchMode.set(!0),this.joinMonitorBatchInterval.set(45),this.loadAccountQuotas(),this.showBatchJoinMonitorDialog.set(!0)}getBatchJoinTotalMembers(){return this.batchJoinResources().reduce((e,t)=>e+(t.member_count||0),0)}closeBatchJoinMonitorDialog(){this.showBatchJoinMonitorDialog.set(!1),this.batchJoinResources.set([])}toggleAccountSelection(e){let t=this.joinMonitorSelectedPhones();t.includes(e)?this.joinMonitorSelectedPhones.set(t.filter(n=>n!==e)):this.joinMonitorSelectedPhones.set([...t,e])}selectAllAccounts(){let e=this.accountQuotas().map(t=>t.phone);this.joinMonitorSelectedPhones.set(e)}executeBatchJoinMonitor(){let e=this.batchJoinResources(),t=this.joinMonitorSelectedPhones();if(e.length===0){this.toastService.error("\u6C92\u6709\u9078\u64C7\u7FA4\u7D44");return}if(t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u5E33\u865F");return}this.isJoiningResource.set(!0),this.batchJoinProgress.set({current:0,total:e.length,status:"\u6E96\u5099\u4E2D..."});let n=this.joinMonitorSelectedKeywordSetIds();this.ipcService.send("batch-join-and-monitor",{resourceIds:e.map(o=>o.id),phones:t,keywordSetIds:n,keywords:this.joinMonitorKeywords(),autoEnableMonitor:this.joinMonitorAutoEnable(),batchMode:this.joinMonitorBatchMode(),batchInterval:this.joinMonitorBatchInterval()}),this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44\uFF0C\u4F7F\u7528 ${t.length} \u500B\u5E33\u865F`)}openMemberListDialog(e){this.memberListResource.set(e),this.memberListData.set([]),this.memberListLoading.set(!1),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:""}),this.selectedMemberIds.set([]),this.memberExtractStarted.set(!1),this.memberListFilter.set("all"),this.memberExtractConfig.set({limit:500,customLimit:1e3,backgroundMode:!1,userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1},excludeFilters:{bots:!0,scam:!0,deleted:!0}}),this.showMemberListDialog.set(!0)}closeMemberListDialog(){this.showMemberListDialog.set(!1),this.memberListResource.set(null),this.memberListData.set([])}loadMemberList(e){if(!e||!e.telegram_id){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44\u4FE1\u606F");return}this.memberListLoading.set(!0),this.memberListProgress.update(t=>B(F({},t),{status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:0})}extractMoreMembers(){let e=this.memberListResource(),t=this.memberListData().length;e&&(this.memberListLoading.set(!0),this.memberListProgress.update(n=>B(F({},n),{status:"\u6B63\u5728\u63D0\u53D6\u66F4\u591A\u6210\u54E1..."})),this.ipcService.send("extract-members",{resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:200,offset:t}))}toggleMemberIdSelection(e){let t=this.selectedMemberIds();t.includes(e)?this.selectedMemberIds.set(t.filter(n=>n!==e)):this.selectedMemberIds.set([...t,e])}selectAllMembers(){let e=this.memberListData().map(t=>t.user_id);this.selectedMemberIds.set(e)}exportMembersToCSV(){let e=this.getFilteredMembers();if(e.length===0){this.toastService.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u6210\u54E1");return}let t=this.memberListResource(),n=`members_${t?.username||t?.telegram_id}_${new Date().toISOString().slice(0,10)}.csv`,o=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u5168\u540D","\u96FB\u8A71\u865F\u78BC","\u500B\u4EBA\u7C21\u4ECB","\u8A9E\u8A00","DC","\u5728\u7DDA\u72C0\u614B","\u6700\u5F8C\u4E0A\u7DDA","\u89D2\u8272","\u52A0\u5165\u65E5\u671F","Premium","\u5DF2\u8A8D\u8B49","Bot","\u6709\u982D\u50CF","\u8A50\u9A19","\u5047\u5E33\u865F","\u53D7\u9650\u5236","\u5DF2\u522A\u9664","\u83EF\u4EBA","\u6D3B\u8E8D\u5EA6","\u50F9\u503C\u7B49\u7D1A","\u4F86\u6E90\u7FA4\u7D44","\u63D0\u53D6\u6642\u9593"],a=y=>{if(y==null)return"";let E=String(y);return E.includes(",")||E.includes('"')||E.includes(`
`)?`"${E.replace(/"/g,'""')}"`:E},d=e.map(y=>[y.user_id,y.username||"",y.first_name||"",y.last_name||"",y.full_name||`${y.first_name||""} ${y.last_name||""}`.trim(),y.phone||"",a(y.bio||""),y.language_code||"",y.dc_id||"",y.online_status||"",y.last_online||"",y.chat_member_status||"member",y.joined_date||"",y.is_premium?"\u662F":"\u5426",y.is_verified?"\u662F":"\u5426",y.is_bot?"\u662F":"\u5426",y.has_photo?"\u662F":"\u5426",y.is_scam?"\u662F":"\u5426",y.is_fake?"\u662F":"\u5426",y.is_restricted?"\u662F":"\u5426",y.is_deleted?"\u662F":"\u5426",this.isChineseMember(y)?"\u662F":"\u5426",y.activity_score?(y.activity_score*100).toFixed(0)+"%":"",y.value_level||"",y.source_chat_title||"",y.extracted_at||""]),m=[o,...d].map(y=>y.map(a).join(",")).join(`
`),f=new Blob(["\uFEFF"+m],{type:"text/csv;charset=utf-8"}),h=URL.createObjectURL(f),C=document.createElement("a");C.href=h,C.download=n,C.click(),URL.revokeObjectURL(h),this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${e.length} \u500B\u6210\u54E1`)}setMemberExtractLimit(e){this.memberExtractConfig.update(t=>B(F({},t),{limit:e}))}applyExtractPreset(e){this.selectedPreset.set(e);let t=this.extractPresets.find(n=>n.id===e);t&&(this.memberExtractConfig.update(n=>B(F({},n),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),t.config.userTypes&&this.memberExtractConfig.update(n=>B(F({},n),{userTypes:F(F({},n.userTypes),t.config.userTypes)})),t.config.activityFilters&&this.memberExtractConfig.update(n=>B(F({},n),{activityFilters:F(F({},n.activityFilters),t.config.activityFilters)})),t.config.accountFeatures&&this.memberExtractConfig.update(n=>B(F({},n),{accountFeatures:F(F({},n.accountFeatures),t.config.accountFeatures)})),this.toastService.info(`\u5DF2\u61C9\u7528\u300C${t.name}\u300D\u9810\u8A2D`))}toggleUserType(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>B(F({},t),{userTypes:B(F({},t.userTypes),{[e]:!t.userTypes[e]})}))}toggleActivityFilter(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>B(F({},t),{activityFilters:B(F({},t.activityFilters),{[e]:!t.activityFilters[e]})}))}toggleAccountFeature(e){this.selectedPreset.set(""),this.memberExtractConfig.update(t=>B(F({},t),{accountFeatures:B(F({},t.accountFeatures),{[e]:!t.accountFeatures[e]})}))}toggleExcludeFilter(e){this.memberExtractConfig.update(t=>B(F({},t),{excludeFilters:B(F({},t.excludeFilters),{[e]:!t.excludeFilters[e]})}))}getActiveFilterCount(){let e=this.memberExtractConfig(),t=0;return Object.values(e.userTypes).forEach(n=>n&&t++),Object.values(e.activityFilters).forEach(n=>n&&t++),Object.values(e.accountFeatures).forEach(n=>n&&t++),t}clearAllFilters(){this.selectedPreset.set(""),this.memberExtractConfig.update(e=>B(F({},e),{userTypes:{chinese:!1,overseas:!1},activityFilters:{onlineNow:!1,within3Days:!1,within7Days:!1,within30Days:!1,longOffline:!1},accountFeatures:{premium:!1,hasUsername:!1,hasPhoto:!1,newAccount:!1,activeAccount:!1,verified:!1}})),this.toastService.info("\u5DF2\u6E05\u9664\u6240\u6709\u7BE9\u9078\u689D\u4EF6")}startMemberExtraction(){console.log("[Frontend] startMemberExtraction called");let e=this.memberListResource();if(console.log("[Frontend] Resource:",e),!e){console.error("[Frontend] No resource selected"),this.toastService.error("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u7FA4\u7D44");return}this.memberExtractStarted.set(!0),this.memberListLoading.set(!0),this.memberListData.set([]),this.extractionStartTime.set(Date.now());let t=this.memberExtractConfig(),n=t.limit===-1?t.customLimit:t.limit===0?99999:t.limit;console.log("[Frontend] Extraction config:",{limit:n,config:t}),this.memberListProgress.set({extracted:0,total:e.member_count||0,status:"\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."});let o={resourceId:e.id,telegramId:e.telegram_id,username:e.username,phone:e.joined_phone||e.joined_by_phone||null,limit:n,offset:0,filters:{onlineOnly:t.activityFilters.onlineNow,chineseOnly:t.userTypes.chinese,premiumOnly:t.accountFeatures.premium,hasUsername:t.accountFeatures.hasUsername,excludeBots:t.excludeFilters.bots}};console.log("[Frontend] Sending extract-members IPC:",o),this.toastService.info("\u{1F4E4} \u6B63\u5728\u767C\u9001\u63D0\u53D6\u8ACB\u6C42..."),this.ipcService.send("extract-members",o),t.backgroundMode&&(this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C"),this.closeMemberListDialog())}pauseMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>B(F({},e),{status:"\u5DF2\u66AB\u505C"})),this.toastService.info("\u23F8\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u66AB\u505C")}stopMemberExtraction(){this.memberListLoading.set(!1),this.memberListProgress.update(e=>B(F({},e),{status:"\u5DF2\u505C\u6B62"})),this.toastService.info("\u23F9\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u505C\u6B62")}toggleMemberExtractBackground(){this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C\uFF0C\u5B8C\u6210\u5F8C\u6703\u901A\u77E5\u60A8"),this.closeMemberListDialog()}handleMemberExtractionError(e){let t=e.error_code||"UNKNOWN",n=e.error_details||{};switch(this.memberListProgress.update(o=>B(F({},o),{status:"\u63D0\u53D6\u5931\u6557"})),t){case"PEER_ID_INVALID":case"NOT_PARTICIPANT":case"CHANNEL_PRIVATE":let o=n.attempts||0;o>1?this.showExtractionErrorWithAction("\u26A0\uFE0F \u7FA4\u7D44\u540C\u6B65\u672A\u5B8C\u6210",n.reason||`\u5DF2\u5617\u8A66 ${o} \u6B21\uFF0CTelegram \u670D\u52D9\u5668\u5C1A\u672A\u540C\u6B65`,n.suggestion||"\u8ACB\u7B49\u5F85 30 \u79D2\u5F8C\u518D\u8A66\uFF0C\u6216\u91CD\u65B0\u52A0\u5165\u7FA4\u7D44",void 0):this.showExtractionErrorWithAction("\u26A0\uFE0F \u7121\u6CD5\u63D0\u53D6\u6210\u54E1",n.reason||"\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44",n.suggestion||"\u8ACB\u5148\u52A0\u5165\u7FA4\u7D44\u518D\u5617\u8A66\u63D0\u53D6",n.can_auto_join?"join":void 0);break;case"ADMIN_REQUIRED":this.showExtractionErrorWithAction("\u{1F512} \u6210\u54E1\u5217\u8868\u53D7\u9650",n.reason||"\u7FA4\u7D44\u8A2D\u7F6E\u9650\u5236\u4E86\u6210\u54E1\u5217\u8868\u8A2A\u554F",n.suggestion||"\u53EF\u5617\u8A66\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u6536\u96C6\u6D3B\u8E8D\u7528\u6236",n.alternative==="monitor_messages"?"monitor":void 0);break;case"FLOOD_WAIT":this.toastService.warning(`\u23F3 ${e.error}

${n.suggestion||"\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}`);break;case"CHANNEL_INVALID":this.toastService.error(`\u274C ${e.error}

${n.suggestion||"\u8ACB\u5237\u65B0\u8CC7\u6E90\u5217\u8868"}`);break;default:this.toastService.error(`\u274C \u63D0\u53D6\u5931\u6557: ${e.error}`)}}showExtractionErrorWithAction(e,t,n,o){let a=this.memberListResource(),d=`${e}

\u539F\u56E0\uFF1A${t}

\u{1F4A1} ${n}`;o==="join"&&a?(d+=`

\u9EDE\u64CA\u300C\u52A0\u5165\u7FA4\u7D44\u300D\u6309\u9215\u5F8C\u91CD\u8A66`,this.toastService.warning(d),this.memberListProgress.update(m=>B(F({},m),{status:"\u9700\u8981\u5148\u52A0\u5165\u7FA4\u7D44"}))):o==="monitor"&&a?(d+=`

\u5EFA\u8B70\uFF1A\u555F\u52D5\u6D88\u606F\u76E3\u63A7\u4F86\u6536\u96C6\u6D3B\u8E8D\u7528\u6236`,this.toastService.warning(d),this.memberListProgress.update(m=>B(F({},m),{status:"\u5EFA\u8B70\u4F7F\u7528\u6D88\u606F\u76E3\u63A7"}))):this.toastService.error(d)}async autoJoinAndExtract(){let e=this.memberListResource();if(!e)return;this.toastService.info("\u{1F680} \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44...");let t=this.accounts().find(n=>n.status==="Online");t?(this.ipcService.send("join-group",{phone:t.phone,groupUrl:e.username?`https://t.me/${e.username}`:e.invite_link}),this.ipcService.once("group-join-result",n=>{n.success?(this.toastService.success("\u2705 \u6210\u529F\u52A0\u5165\u7FA4\u7D44\uFF0C\u6B63\u5728\u91CD\u65B0\u63D0\u53D6..."),setTimeout(()=>{this.startMemberExtraction()},2e3)):this.toastService.error(`\u274C \u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${n.error}`)})):this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F")}getFirstOnlineAccount(){return this.accounts().find(e=>e.status==="Online")}calculateAndShowExtractionSummary(e){let t=this.memberListResource(),n=this.extractionStartTime(),o=n>0?Math.round((Date.now()-n)/1e3):0,a=0,d=0,m=0,f=0,h=0,C=0,y={S:0,A:0,B:0,C:0,D:0};for(let E of e){E.online_status==="online"?a++:E.online_status==="recently"&&d++,E.is_premium&&m++,this.isChineseMember(E)&&f++,E.username&&h++,E.is_bot&&C++;let T=E.value_level||this.calculateMemberValueLevel(E);T&&y.hasOwnProperty(T)&&y[T]++}this.extractionSummary.set({groupName:t?.title||t?.name||"\u672A\u77E5\u7FA4\u7D44",groupUrl:t?.username?`t.me/${t.username}`:t?.url||"",totalExtracted:e.length,totalInGroup:t?.member_count||0,onlineCount:a,recentlyCount:d,premiumCount:m,chineseCount:f,hasUsernameCount:h,botCount:C,valueLevelDistribution:y,extractedAt:new Date().toLocaleString("zh-TW"),duration:o}),this.showExtractionSummaryDialog.set(!0),this.toastService.success(`\u2705 \u6210\u529F\u63D0\u53D6 ${e.length} \u500B\u6210\u54E1`)}calculateMemberValueLevel(e){let t=0;return e.is_premium&&(t+=30),e.online_status==="online"?t+=25:e.online_status==="recently"?t+=20:e.online_status==="last_week"&&(t+=10),e.username&&(t+=15),this.isChineseMember(e)&&(t+=10),e.is_bot&&(t-=50),e.activity_score&&(t+=Math.min(e.activity_score,20)),t>=70?"S":t>=50?"A":t>=30?"B":t>=10?"C":"D"}closeExtractionSummaryDialog(){this.showExtractionSummaryDialog.set(!1)}goToMemberDatabaseFromSummary(){this.closeExtractionSummaryDialog(),this.closeMemberListDialog(),this.currentView.set("member-database")}startBatchMarketingFromSummary(){this.closeExtractionSummaryDialog(),this.toastService.info("\u{1F4A1} \u8ACB\u5728\u6210\u54E1\u5217\u8868\u4E2D\u9078\u64C7\u8981\u71DF\u92B7\u7684\u7528\u6236\uFF0C\u7136\u5F8C\u9EDE\u64CA\u300C\u6279\u91CF\u767C\u9001\u300D")}getValueLevelPercent(e){let t=this.extractionSummary(),n=t.totalExtracted;if(n===0)return 0;let o=t.valueLevelDistribution[e]||0;return Math.round(o/n*100)}setMemberFilter(e){this.memberListFilter.set(e)}getFilteredMembers(){let e=this.memberListData();switch(this.memberListFilter()){case"chinese":return e.filter(n=>this.isChineseMember(n));case"online":return e.filter(n=>n.online_status==="online"||n.online_status==="recently");case"premium":return e.filter(n=>n.is_premium);case"hasUsername":return e.filter(n=>!!n.username);default:return e}}isChineseMember(e){let t=/[\u4e00-\u9fa5]/,n=(e.first_name||"")+(e.last_name||"");return t.test(n)}getChineseMemberCount(){return this.memberListData().filter(e=>this.isChineseMember(e)).length}getOnlineMemberCount(){return this.memberListData().filter(e=>e.online_status==="online"||e.online_status==="recently").length}getPremiumMemberCount(){return this.memberListData().filter(e=>e.is_premium).length}getMemberExtractPercent(){let e=this.memberListProgress();return e.total===0?0:Math.min(100,Math.round(this.memberListData().length/e.total*100))}isAllMembersSelected(){let e=this.getFilteredMembers();return e.length>0&&e.every(t=>this.selectedMemberIds().includes(t.user_id))}toggleSelectAllMembersList(){let e=this.getFilteredMembers();this.isAllMembersSelected()?this.selectedMemberIds.set([]):this.selectedMemberIds.set(e.map(t=>t.user_id))}sendPrivateMessage(e){if(!e.username){this.toastService.warning("\u8A72\u7528\u6236\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u79C1\u4FE1");return}this.toastService.info(`\u{1F4E8} \u6E96\u5099\u767C\u9001\u79C1\u4FE1\u7D66 @${e.username}`)}batchSendPrivateMessage(){let e=this.selectedMemberIds().length;this.toastService.info(`\u{1F4E8} \u6E96\u5099\u6279\u91CF\u767C\u9001\u79C1\u4FE1\u7D66 ${e} \u500B\u6210\u54E1`)}batchAddFriend(){let e=this.selectedMemberIds().length;this.toastService.info(`\u2795 \u6E96\u5099\u6279\u91CF\u6DFB\u52A0 ${e} \u500B\u597D\u53CB`)}addMemberToFunnel(e){let t={userId:e.user_id,username:e.username||"",firstName:e.first_name||"",lastName:e.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u624B\u52D5\u6DFB\u52A0",onlineStatus:e.online_status||"unknown"};this.ipcService.send("add-lead",t),this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${e.first_name||e.username||"ID:"+e.user_id} \u52A0\u5165\u71DF\u92B7\u6F0F\u6597`)}batchAddToFunnel(){let e=this.selectedMemberIds(),t=this.memberListData().filter(o=>e.includes(o.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let n=0;for(let o of t){let a={userId:o.user_id,username:o.username||"",firstName:o.first_name||"",lastName:o.last_name||"",sourceGroup:this.memberListResource()?.title||"",triggeredKeyword:"\u6279\u91CF\u6DFB\u52A0",onlineStatus:o.online_status||"unknown"};this.ipcService.send("add-lead",a),n++}this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${n} \u500B\u6210\u54E1\u52A0\u5165\u71DF\u92B7\u6F0F\u6597`),this.clearMemberSelection()}clearMemberSelection(){this.selectedMemberIds.set([])}exportSelectedMembersToCSV(){let e=this.selectedMemberIds(),t=this.memberListData().filter(f=>e.includes(f.user_id));if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let n=["\u7528\u6236ID","\u7528\u6236\u540D","\u540D\u5B57","\u59D3\u6C0F","\u8A55\u7D1A","\u5728\u7DDA\u72C0\u614B","Premium","\u4F86\u6E90\u7FA4\u7D44"],o=t.map(f=>[f.user_id,f.username||"",f.first_name||"",f.last_name||"",this.calculateMemberValueLevel(f),f.online_status||"unknown",f.is_premium?"\u662F":"\u5426",this.memberListResource()?.title||""]),a=[n.join(","),...o.map(f=>f.join(","))].join(`
`),d=new Blob(["\uFEFF"+a],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a");m.href=URL.createObjectURL(d),m.download=`selected-members-${new Date().toISOString().split("T")[0]}.csv`,m.click(),this.toastService.success(`\u{1F4E5} \u5DF2\u5C0E\u51FA ${t.length} \u500B\u6210\u54E1`)}selectHighValueMembers(){let t=this.memberListData().filter(n=>{let o=this.calculateMemberValueLevel(n);return o==="S"||o==="A"}).map(n=>n.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B S/A \u7D1A\u6210\u54E1`)}selectOnlineMembers(){let t=this.memberListData().filter(n=>n.online_status==="online"||n.online_status==="recently").map(n=>n.user_id);this.selectedMemberIds.set(t),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${t.length} \u500B\u5728\u7DDA/\u6700\u8FD1\u6D3B\u8E8D\u6210\u54E1`)}selectAllMembersInList(){let e=this.getFilteredMembers();this.selectedMemberIds.set(e.map(t=>t.user_id)),this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${e.length} \u500B\u6210\u54E1`)}openBatchMemberExtractDialog(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u63D0\u53D6 ${e.length} \u500B\u7FA4\u7D44\u7684\u6210\u54E1`),this.ipcService.send("batch-extract-members",{resourceIds:e,limit:100,safeMode:!0})}openSingleMessageDialog(e){this.singleMessageResource.set(e),this.singleMessageContent="",this.singleMessageScheduled.set(!1),this.singleMessageScheduleTime="",this.singleMessageAccountId.set(""),this.loadAccountQuotas(),this.showSingleMessageDialog.set(!0)}closeSingleMessageDialog(){this.showSingleMessageDialog.set(!1),this.singleMessageResource.set(null)}executeSingleMessage(){let e=this.singleMessageResource(),t=this.singleMessageContent.trim();if(!e){this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44");return}if(!t){this.toastService.error("\u8ACB\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let n=this.singleMessageAccountId();if(!n){this.toastService.error("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.singleMessageScheduled()&&this.singleMessageScheduleTime?(this.ipcService.send("schedule-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:n,scheduledTime:this.singleMessageScheduleTime}),this.toastService.success(`\u23F0 \u6D88\u606F\u5DF2\u6392\u7A0B\uFF0C\u5C07\u65BC ${this.singleMessageScheduleTime} \u767C\u9001`)):(this.ipcService.send("send-group-message",{resourceId:e.id,telegramId:e.telegram_id,content:t,accountPhone:n}),this.toastService.info("\u{1F4E8} \u6B63\u5728\u767C\u9001\u6D88\u606F...")),this.closeSingleMessageDialog()}refreshAllResources(){this.isRefreshing.set(!0),this.toastService.info("\u6B63\u5728\u5237\u65B0\u8CC7\u6E90\u6578\u64DA..."),this.refreshResourceStats(),this.loadResources(),this.loadDiscoveryKeywords(),setTimeout(()=>{this.isRefreshing.set(!1),this.toastService.success("\u5237\u65B0\u5B8C\u6210")},2e3)}clearSearchResults(){let e=this.discoveredResources().length;if(e===0){this.toastService.warning("\u6C92\u6709\u53EF\u6E05\u7A7A\u7684\u8CC7\u6E90");return}confirm(`\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709 ${e} \u689D\u641C\u7D22\u7D50\u679C\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u8CC7\u6E90\u8A18\u9304\uFF0C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&this.ngZone.run(()=>{this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.refreshResourceStats(),this.cdr.detectChanges()})}deleteAllDiscoveredResources(){let e=this.discoveredResources().filter(t=>t.status==="discovered").map(t=>t.id);if(e.length===0){this.toastService.info("\u6C92\u6709\u53EF\u522A\u9664\u7684\u672A\u8655\u7406\u8CC7\u6E90");return}confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6240\u6709\u672A\u8655\u7406\u7684\u8CC7\u6E90\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002")&&(this.ipcService.send("delete-resources-batch",{resourceIds:e}),this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u522A\u9664 ${e.length} \u500B\u8CC7\u6E90`),setTimeout(()=>this.loadResources(),500))}clearDiscoveredResources(){this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.toastService.info("\u5DF2\u6E05\u7A7A\u7576\u524D\u641C\u7D22\u7D50\u679C")}clearHistoryData(e="all"){confirm(`\u78BA\u5B9A\u8981\u6E05\u7406 ${{all:"\u6240\u6709\u8CC7\u6E90\u6578\u64DA",old_data:"\u820A\u6578\u64DA",search_history:"\u641C\u7D22\u6B77\u53F2\uFF08\u4FDD\u7559\u6536\u85CF\uFF09"}[e]} \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002`)&&(this.toastService.info("\u{1F9F9} \u6B63\u5728\u6E05\u7406..."),this.ipcService.send("clear-resources",{type:e,daysToKeep:e==="old_data"?7:0}))}clearAllSearchHistory(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2\u55CE\uFF1F\u6B64\u64CD\u4F5C\u6703\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u641C\u7D22\u7D50\u679C\u3002")&&(this.ipcService.send("clear-all-resources",{}),this.discoveredResources.set([]),this.selectedResourceIds.set([]),this.searchHistoryKeywords.set([]),this.currentSearchSessionId.set(""),this.currentSearchKeyword.set(""),this.showSearchHistory.set(!1),this.toastService.success("\u5DF2\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2"))}toggleSearchHistoryMode(){let e=!this.showSearchHistory();this.showSearchHistory.set(e),e?(this.loadResources(),this.toastService.info("\u6B63\u5728\u8F09\u5165\u6B77\u53F2\u641C\u7D22\u7D50\u679C...")):this.currentSearchKeyword()||this.discoveredResources.set([])}searchFromHistory(e){this.resourceSearchQuery=e,this.showSearchHistory.set(!1),this.searchResources()}handleSearchDiscoverySearch(e){this.resourceSearchQuery=e.query,this.selectedSearchSources.set(e.sources),this.searchResources()}handleSearchDiscoverySelectAccount(e){this.selectResourceAccount(e.id)}handleOnboardingNavigate(e){console.log("[Onboarding] \u5BFC\u822A\u5230:",e),this.changeView(e)}openOnboarding(){this.onboardingComponent&&this.onboardingComponent.open()}resetOnboarding(){this.onboardingComponent&&(this.onboardingComponent.reset(),this.onboardingComponent.open())}saveResource(e){if(!e.telegram_id){this.toastService.error("\u7121\u6CD5\u6536\u85CF\uFF1A\u7F3A\u5C11\u8CC7\u6E90 ID");return}this.ipcService.send("save-resource",{telegram_id:e.telegram_id,username:e.username,title:e.title,description:e.description,member_count:e.member_count,resource_type:e.resource_type,overall_score:e.overall_score,discovery_keyword:this.currentSearchKeyword()});let t=new Set(this.savedResources());t.add(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(a=>a.telegram_id===e.telegram_id?B(F({},a),{is_saved:!0}):a);this.discoveredResources.set(o),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF\u300C${e.title}\u300D`)}unsaveResource(e){if(!e.telegram_id)return;this.ipcService.send("unsave-resource",{telegram_id:e.telegram_id});let t=new Set(this.savedResources());t.delete(e.telegram_id),this.savedResources.set(t);let o=this.discoveredResources().map(a=>a.telegram_id===e.telegram_id?B(F({},a),{is_saved:!1}):a);this.discoveredResources.set(o),this.toastService.info(`\u5DF2\u53D6\u6D88\u6536\u85CF\u300C${e.title}\u300D`)}batchSaveResources(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u6536\u85CF\u7684\u8CC7\u6E90");return}let t=this.discoveredResources().filter(n=>e.includes(n.id)||e.some(o=>String(o)===n.telegram_id));t.forEach(n=>this.saveResource(n)),this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF ${t.length} \u500B\u8CC7\u6E90`)}isResourceSaved(e){return e.is_saved||this.savedResources().has(e.telegram_id)}syncContactsData(){this.contactsService.syncFromSources(),this.toastService.info("\u6B63\u5728\u540C\u6B65\u6578\u64DA...",2e3)}joinAndMonitor(e){let t=this.discoveredResources().find(n=>n.id===e);if(!t){this.toastService.error("\u627E\u4E0D\u5230\u8A72\u8CC7\u6E90");return}this.toastService.info(`\u6B63\u5728\u52A0\u5165\u4E26\u76E3\u63A7: ${t.title}`),this.ipcService.send("join-and-monitor-resource",{resourceId:e,username:t.username,telegramId:t.telegram_id,title:t.title})}batchJoinAndMonitor(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");return}this.toastService.info(`\u6B63\u5728\u6279\u91CF\u52A0\u5165\u4E26\u76E3\u63A7 ${e.length} \u500B\u7FA4\u7D44...`),this.ipcService.send("batch-join-and-monitor",{resourceIds:e})}loadDiscoveryKeywords(){this.ipcService.send("get-discovery-keywords",{})}addDiscoveryKeyword(){if(!this.newResourceKeyword.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E");return}this.ipcService.send("add-discovery-keyword",{keyword:this.newResourceKeyword.trim(),category:"general",priority:5})}searchWithKeyword(e){this.resourceSearchQuery=e,this.searchResources()}toggleResourceSelection(e){let t=this.selectedResourceIds();t.includes(e)?this.selectedResourceIds.set(t.filter(n=>n!==e)):this.selectedResourceIds.set([...t,e])}toggleSelectAllResources(){let e=this.discoveredResources();this.selectedResourceIds().length===e.length?this.selectedResourceIds.set([]):this.selectedResourceIds.set(e.map(n=>n.id))}addSelectedToJoinQueue(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("add-to-join-queue",{resourceIds:e,priority:5})}processJoinQueue(){this.isProcessingJoinQueue.set(!0),this.ipcService.send("process-join-queue",{limit:5})}toggleSearchSource(e){let t=this.selectedSearchSources();t.includes(e)?this.selectedSearchSources.set(t.filter(n=>n!==e)):this.selectedSearchSources.set([...t,e])}selectAllSearchSources(){this.selectedSearchSources.set(["telegram","jiso","tgstat","local"])}enterGroup(e){this.changeView("resources"),this.toastService.info(`\u6E96\u5099\u9032\u5165\u7FA4\u7D44\uFF1A${e.title}`)}batchEnterGroups(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.toastService.info(`\u6E96\u5099\u9032\u5165 ${t.length} \u500B\u7FA4\u7D44\u67E5\u770B\u6210\u54E1`)}sendGroupMessage(e){this.selectedResourceIds.set([e.id]),this.showBatchMessageDialog.set(!0)}executeBatchMessage(){let e=this.selectedResourceIds();if(e.length===0||!this.batchMessageContent.trim()){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u4E26\u8F38\u5165\u6D88\u606F\u5167\u5BB9");return}let t=this.discoveredResources().filter(n=>e.includes(n.id));this.toastService.success(`\u958B\u59CB\u5411 ${t.length} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!1)}inviteMembersToGroup(e){this.selectedResourceIds.set([e.id]),this.loadAvailableMembers(),this.showBatchInviteDialog.set(!0)}executeBatchInvite(){let e=this.selectedResourceIds(),t=this.batchInviteConfig.selectedMemberIds;if(e.length===0||t.length===0){this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u548C\u6210\u54E1");return}this.toastService.success(`\u958B\u59CB\u9080\u8ACB ${t.length} \u4F4D\u6210\u54E1\u52A0\u5165 ${e.length} \u500B\u7FA4\u7D44`),this.showBatchInviteDialog.set(!1)}loadAvailableMembers(){this.availableMembersForInvite.set([{id:"1",name:"\u793A\u4F8B\u6210\u54E11",username:"member1"},{id:"2",name:"\u793A\u4F8B\u6210\u54E12",username:"member2"}])}toggleSelectAllMembers(e){e.target.checked?(this.batchInviteConfig.selectedMemberIds=this.availableMembersForInvite().map(n=>n.id),this.batchInviteConfig.selectAll=!0):(this.batchInviteConfig.selectedMemberIds=[],this.batchInviteConfig.selectAll=!1)}toggleMemberSelection(e,t){let n=t.target.checked,o=this.batchInviteConfig.selectedMemberIds;n?this.batchInviteConfig.selectedMemberIds=[...o,e]:this.batchInviteConfig.selectedMemberIds=o.filter(a=>a!==e),this.batchInviteConfig.selectAll=this.batchInviteConfig.selectedMemberIds.length===this.availableMembersForInvite().length}batchJoinSelected(){let e=this.selectedResourceIds();if(e.length===0){this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");return}this.ipcService.send("batch-join-resources",{resourceIds:e,delayMin:30,delayMax:60})}toggleResourceMenu(e,t){t&&t.stopPropagation(),this.openResourceMenuId()===e?this.openResourceMenuId.set(null):this.openResourceMenuId.set(e)}closeResourceMenu(){this.openResourceMenuId.set(null)}getResourceStatusColor(e){return{discovered:"bg-blue-500",queued:"bg-yellow-500",joining:"bg-orange-500",joined:"bg-green-500",monitoring:"bg-emerald-500",left:"bg-gray-500",blocked:"bg-red-500",invalid:"bg-slate-500"}[e]||"bg-gray-500"}getSizeGrade(e){return e>=1e5?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",label:"\u8D85\u5927\u578B"}:e>=1e4?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",label:"\u5927\u578B"}:e>=1e3?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",label:"\u4E2D\u578B"}:e>=100?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",label:"\u5C0F\u578B"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",label:"\u5FAE\u578B"}}getScoreGrade(e){let t=e*100;return t>=90?{grade:"S",color:"text-amber-400",bgColor:"bg-amber-500/20 border-amber-500/50",icon:"\u{1F3C6}"}:t>=75?{grade:"A",color:"text-green-400",bgColor:"bg-green-500/20 border-green-500/50",icon:"\u2B50"}:t>=60?{grade:"B",color:"text-blue-400",bgColor:"bg-blue-500/20 border-blue-500/50",icon:"\u{1F44D}"}:t>=40?{grade:"C",color:"text-slate-400",bgColor:"bg-slate-500/20 border-slate-500/50",icon:"\u{1F44C}"}:{grade:"D",color:"text-red-400",bgColor:"bg-red-500/20 border-red-500/50",icon:"\u26A0\uFE0F"}}getScoreBarColor(e){let t=e*100;return t>=90?"bg-amber-400":t>=75?"bg-green-400":t>=60?"bg-blue-400":t>=40?"bg-slate-400":"bg-red-400"}getResourceStatusName(e){return{discovered:"\u5DF2\u767C\u73FE",queued:"\u968A\u5217\u4E2D",joining:"\u52A0\u5165\u4E2D",joined:"\u5DF2\u52A0\u5165",monitoring:"\u76E3\u63A7\u4E2D",left:"\u5DF2\u9000\u51FA",blocked:"\u88AB\u5C01\u7981",invalid:"\u7121\u6548"}[e]||e}getResourceTypeName(e){return{group:"\u7FA4\u7D44",supergroup:"\u8D85\u7D1A\u7FA4\u7D44",channel:"\u983B\u9053",bot:"\u6A5F\u5668\u4EBA"}[e]||e}getResourceTypeStyle(e){return{channel:{icon:"\u{1F4E2}",label:"\u983B\u9053",bgClass:"bg-purple-500/20",textClass:"text-purple-400",canMessage:!1,canExtract:!1},supergroup:{icon:"\u{1F465}",label:"\u8D85\u7D1A\u7FA4\u7D44",bgClass:"bg-blue-500/20",textClass:"text-blue-400",canMessage:!0,canExtract:!0},group:{icon:"\u{1F4AC}",label:"\u7FA4\u7D44",bgClass:"bg-green-500/20",textClass:"text-green-400",canMessage:!0,canExtract:!0},bot:{icon:"\u{1F916}",label:"\u6A5F\u5668\u4EBA",bgClass:"bg-orange-500/20",textClass:"text-orange-400",canMessage:!0,canExtract:!1}}[e]||{icon:"\u{1F4CC}",label:"\u672A\u77E5",bgClass:"bg-slate-500/20",textClass:"text-slate-400",canMessage:!1,canExtract:!1}}isChannel(e){return e?.resource_type==="channel"}canSendMessageToResource(e){return!this.isChannel(e)}canExtractMembers(e){return!this.isChannel(e)}showChannelMemberWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u63D0\u53D6\u6210\u54E1\u5217\u8868

Telegram \u4E0D\u5141\u8A31\u67E5\u770B\u983B\u9053\u7684\u8A02\u95B1\u8005\u5217\u8868\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u5C0B\u627E\u8A72\u983B\u9053\u7684\u95DC\u806F\u8A0E\u8AD6\u7FA4\u7D44`)}showChannelMessageWarning(){this.toastService.warning(`\u{1F4E2} \u983B\u9053\u7121\u6CD5\u767C\u9001\u6D88\u606F

\u53EA\u6709\u983B\u9053\u7BA1\u7406\u54E1\u53EF\u4EE5\u767C\u5E03\u5167\u5BB9\u3002

\u{1F4A1} \u5EFA\u8B70\uFF1A\u95DC\u6CE8\u983B\u9053\u7372\u53D6\u8CC7\u8A0A\uFF0C\u6216\u5C0B\u627E\u8A0E\u8AD6\u7FA4\u7D44`)}verifyResourceType(e){if(!e?.id){this.toastService.error("\u7121\u6548\u7684\u8CC7\u6E90");return}this.toastService.info(`\u{1F50D} \u6B63\u5728\u9A57\u8B49: ${e.title||e.username}...`),this.ipcService.send("verify-resource-type",{resourceId:e.id})}getResourcePermissionStatus(e){return this.isChannel(e)?{icon:"\u{1F4E2}",text:"\u50C5\u8A02\u95B1",class:"text-purple-400"}:{icon:"\u2705",text:"\u53EF\u4E92\u52D5",class:"text-green-400"}}getSelectedChannelCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type==="channel").length}getSelectedGroupCount(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel").length}getSelectedMessageableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel")}getSelectedExtractableResources(){let e=this.selectedResourceIds();return this.discoveredResources().filter(n=>e.includes(n.id)&&n.resource_type!=="channel")}openBatchMessageWithFilter(){let e=this.getSelectedChannelCount();e>0&&this.toastService.info(`\u{1F4E2} \u5DF2\u81EA\u52D5\u6392\u9664 ${e} \u500B\u983B\u9053\uFF0C\u5C07\u5C0D ${this.getSelectedGroupCount()} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`),this.showBatchMessageDialog.set(!0)}initDiscussionWatcher(){this.ipcService.send("init-discussion-watcher",{})}discoverDiscussion(){if(!this.discoverChannelId.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u983B\u9053 ID \u6216 username");return}this.ipcService.send("discover-discussion",{channelId:this.discoverChannelId.trim()}),this.discoverChannelId=""}discoverDiscussionsFromResources(){this.ipcService.send("discover-discussions-from-resources",{})}loadChannelDiscussions(){this.ipcService.send("get-channel-discussions",{activeOnly:!0})}refreshDiscussionStats(){this.ipcService.send("get-discussion-stats",{})}startDiscussionMonitoring(e){this.ipcService.send("start-discussion-monitoring",{discussionId:e})}stopDiscussionMonitoring(e){this.ipcService.send("stop-discussion-monitoring",{discussionId:e})}loadDiscussionMessages(e){this.selectedDiscussionId.set(e),this.isLoadingDiscussionMessages.set(!0),this.ipcService.send("get-discussion-messages",{discussionId:e,limit:50,matchedOnly:!1})}replyToDiscussion(e,t,n){if(!n||!n.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u56DE\u5FA9\u5167\u5BB9");return}this.ipcService.send("reply-to-discussion",{discussionId:t,messageId:e,replyText:n.trim()}),this.discussionReplyText.set("")}initKnowledgeBase(){this.ipcService.send("init-knowledge-base",{})}loadKnowledgeData(){this.isLoadingKnowledge.set(!0),this.ipcService.send("get-knowledge-stats",{}),this.refreshCurrentKnowledgeTab()}refreshCurrentKnowledgeTab(){switch(this.knowledgeTab()){case"documents":this.ipcService.send("get-documents",{});break;case"images":this.ipcService.send("get-media",{mediaType:"image"});break;case"videos":this.ipcService.send("get-media",{mediaType:"video"});break;case"qa":this.ipcService.send("get-qa-pairs",{});break}}switchKnowledgeTab(e){this.knowledgeTab.set(e),this.refreshCurrentKnowledgeTab()}addDocument(){let e=this.newDocument();if(!e.title&&!e.content){this.toastService.error(this.t("documentTitle")+" required",2e3);return}this.ipcService.send("add-document",{title:e.title,content:e.content,category:e.category,tags:e.tags.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})}async uploadDocumentFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0],o=this.newDocument(),a=new FileReader;a.onload=()=>{let d=a.result;this.ipcService.send("add-document",{title:o.title||n.name.replace(/\.[^/.]+$/,""),content:d,category:o.category,tags:o.tags.split(",").map(m=>m.trim()).filter(m=>m)}),this.showAddDocumentDialog.set(!1),this.newDocument.set({title:"",category:"general",tags:"",content:""})},n.type==="application/pdf"?this.toastService.info("PDF \u6587\u4EF6\u5C07\u7531\u5F8C\u7AEF\u8655\u7406",2e3):a.readAsText(n),t.value=""}deleteDocument(e){this.ipcService.send("delete-document",{id:e}),this.knowledgeDocuments.update(t=>t.filter(n=>n.id!==e))}async uploadMediaFile(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0],o=this.newMedia(),d=n.type.startsWith("video/")?"video":"image",m=new FileReader;m.onload=()=>{let f=m.result.split(",")[1];this.ipcService.send("add-media",{base64Data:f,name:o.name||n.name.replace(/\.[^/.]+$/,""),category:o.category,description:o.description,mediaType:d}),this.showAddMediaDialog.set(!1),this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"})},m.readAsDataURL(n),t.value=""}deleteMedia(e,t){this.ipcService.send("delete-media",{id:e}),t==="image"?this.knowledgeImages.update(n=>n.filter(o=>o.id!==e)):this.knowledgeVideos.update(n=>n.filter(o=>o.id!==e))}addQaPair(){let e=this.newQaPair();if(!e.question||!e.answer){this.toastService.error(this.t("question")+" & "+this.t("answer")+" required",2e3);return}this.ipcService.send("add-qa-pair",{question:e.question,answer:e.answer,category:e.category,keywords:e.keywords.split(",").map(t=>t.trim()).filter(t=>t)}),this.showAddQaDialog.set(!1),this.newQaPair.set({question:"",answer:"",category:"general",keywords:""})}deleteQaPair(e){this.knowledgeQaPairs.update(t=>t.filter(n=>n.id!==e))}openAddImageDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"image"}),this.showAddMediaDialog.set(!0)}openAddVideoDialog(){this.newMedia.set({name:"",category:"general",description:"",mediaType:"video"}),this.showAddMediaDialog.set(!0)}updateNewDocumentField(e,t){let n=this.newDocument();this.newDocument.set(B(F({},n),{[e]:t}))}updateNewMediaField(e,t){let n=this.newMedia();this.newMedia.set(B(F({},n),{[e]:t}))}updateNewQaPairField(e,t){let n=this.newQaPair();this.newQaPair.set(B(F({},n),{[e]:t}))}searchKnowledge(e){e.trim()&&this.ipcService.send("search-knowledge",{query:e,includeDocs:!0,includeImages:!0,includeVideos:!0,limit:20})}sendAiGreeting(){let e=this.aiGreetingSuggestion();e&&(this.ipcService.send("send-message",{phone:e.accountPhone,recipientId:e.userId,text:e.suggestedGreeting,leadId:e.leadId}),this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null),this.toastService.success(`\u2713 \u554F\u5019\u6D88\u606F\u5DF2\u767C\u9001\u7D66 @${e.username||e.firstName}`))}editAiGreeting(e){let t=this.aiGreetingSuggestion();t&&this.aiGreetingSuggestion.set(B(F({},t),{suggestedGreeting:e}))}dismissAiGreeting(){this.showAiGreetingDialog.set(!1),this.aiGreetingSuggestion.set(null)}formatFileSize(e){if(!e)return"0 B";let t=1024,n=["B","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}async uploadVoiceSample(e){let t=e.target;if(!t.files||t.files.length===0)return;let n=t.files[0];if(!["audio/wav","audio/mp3","audio/mpeg","audio/ogg","audio/flac"].includes(n.type)){this.voiceCloneError.set(this.t("invalidAudioFormat"));return}if(n.size>50*1024*1024){this.voiceCloneError.set(this.t("audioFileTooLarge"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0),this.voiceCloneError.set("");try{let a=new FileReader;a.onprogress=d=>{d.lengthComputable&&this.voiceUploadProgress.set(Math.round(d.loaded/d.total*50))},a.onload=async()=>{let d=a.result.split(",")[1],m=n.name.replace(/\.[^/.]+$/,"");this.ipcService.send("upload-voice-sample",{name:m,audioData:d,fileName:n.name,fileType:n.type}),this.voiceUploadProgress.set(100),setTimeout(()=>{let f={id:Date.now().toString(),name:m,audioPath:n.name,promptText:"",createdAt:new Date};this.clonedVoices.update(h=>[...h,f]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3)},500)},a.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},a.readAsDataURL(n)}catch(a){this.voiceCloneError.set(a.message),this.isUploadingVoice.set(!1)}t.value=""}selectClonedVoice(e){this.selectedClonedVoice.set(e);let t=this.clonedVoices().find(n=>n.id===e);t&&this.ttsVoice.set(t.audioPath)}deleteClonedVoice(e){this.clonedVoices.update(t=>t.filter(n=>n.id!==e)),this.selectedClonedVoice()===e&&(this.selectedClonedVoice.set(""),this.ttsVoice.set("")),this.saveClonedVoicesToStorage(),this.ipcService.send("delete-voice-sample",{voiceId:e}),this.toastService.success(this.t("voiceDeleted"),2e3)}async previewClonedVoice(e){let t=this.clonedVoices().find(n=>n.id===e);t&&this.ipcService.send("preview-voice-sample",{voiceId:e,audioPath:t.audioPath})}async generateWithClonedVoice(e){let t=this.ttsEndpoint(),n=this.selectedClonedVoice();if(!t){this.toastService.error(this.t("ttsEndpointRequired"),2e3);return}if(!n){this.toastService.error(this.t("selectVoiceFirst"),2e3);return}let o=this.clonedVoices().find(a=>a.id===n);o&&this.ipcService.send("generate-cloned-voice",{endpoint:t,text:e,voiceId:n,audioPath:o.audioPath})}saveClonedVoicesToStorage(){let e=this.clonedVoices().map(t=>B(F({},t),{createdAt:t.createdAt.toISOString()}));localStorage.setItem("cloned_voices",JSON.stringify(e))}loadClonedVoicesFromStorage(){let e=localStorage.getItem("cloned_voices");if(e)try{let t=JSON.parse(e).map(n=>B(F({},n),{createdAt:new Date(n.createdAt)}));this.clonedVoices.set(t)}catch(t){console.error("Failed to load cloned voices:",t)}}openRecordingDialog(){this.showRecordingDialog.set(!0),this.voiceName.set(""),this.voicePromptText.set(""),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.voiceCloneError.set(""),this.recordingTime.set(0)}closeRecordingDialog(){this.stopRecording(),this.showRecordingDialog.set(!1),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl())}async startRecording(){try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:44100,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});this.audioChunks=[],this.mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"}),this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.onstop=()=>{let t=new Blob(this.audioChunks,{type:"audio/webm"});this.recordedAudioBlob.set(t),this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioUrl.set(URL.createObjectURL(t)),e.getTracks().forEach(n=>n.stop())},this.mediaRecorder.start(100),this.isRecording.set(!0),this.recordingTime.set(0),this.recordingTimer=setInterval(()=>{this.recordingTime.update(t=>t+1),this.recordingTime()>=10&&this.stopRecording()},1e3)}catch(e){console.error("Recording error:",e),this.voiceCloneError.set(this.t("microphoneAccessDenied"))}}stopRecording(){this.mediaRecorder&&this.isRecording()&&(this.mediaRecorder.stop(),this.isRecording.set(!1),this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null))}async confirmAndUploadRecording(){let e=this.recordedAudioBlob(),t=this.voiceName().trim(),n=this.voicePromptText().trim();if(!t){this.voiceCloneError.set(this.t("voiceNameRequired"));return}if(!e){this.voiceCloneError.set(this.t("noRecordingToUpload"));return}let o=this.recordingTime();if(o<3){this.voiceCloneError.set(this.t("recordingTooShort"));return}this.isUploadingVoice.set(!0),this.voiceUploadProgress.set(0);try{let a=new FileReader;a.onprogress=d=>{d.lengthComputable&&this.voiceUploadProgress.set(Math.round(d.loaded/d.total*50))},a.onload=async()=>{let d=a.result.split(",")[1];this.ipcService.send("upload-voice-sample",{name:t,audioData:d,fileName:`${t}.webm`,fileType:"audio/webm",promptText:n,duration:o}),this.voiceUploadProgress.set(100);let m={id:Date.now().toString(),name:t,audioPath:`${t}.webm`,promptText:n,createdAt:new Date};this.clonedVoices.update(f=>[...f,m]),this.saveClonedVoicesToStorage(),this.isUploadingVoice.set(!1),this.toastService.success(this.t("voiceUploadSuccess"),2e3),this.closeRecordingDialog()},a.onerror=()=>{this.voiceCloneError.set(this.t("voiceUploadFailed")),this.isUploadingVoice.set(!1)},a.readAsDataURL(e)}catch(a){this.voiceCloneError.set(a.message),this.isUploadingVoice.set(!1)}}resetRecording(){this.recordedAudioUrl()&&URL.revokeObjectURL(this.recordedAudioUrl()),this.recordedAudioBlob.set(null),this.recordedAudioUrl.set(""),this.recordingTime.set(0),this.voiceCloneError.set("")}loadAiSettings(){let e=localStorage.getItem("ai_api_key"),t=localStorage.getItem("ai_api_type"),n=localStorage.getItem("ai_custom_endpoint");e&&this.aiApiKey.set(e),t&&this.aiApiType.set(t),n&&this.customApiEndpoint.set(n);let o=localStorage.getItem("local_ai_endpoint"),a=localStorage.getItem("local_ai_model");o&&this.localAiEndpoint.set(o),a&&this.localAiModel.set(a);let d=localStorage.getItem("tts_endpoint"),m=localStorage.getItem("tts_enabled"),f=localStorage.getItem("tts_voice"),h=localStorage.getItem("stt_endpoint"),C=localStorage.getItem("stt_enabled");d&&this.ttsEndpoint.set(d),m&&this.ttsEnabled.set(m==="true"),f&&this.ttsVoice.set(f),h&&this.sttEndpoint.set(h),C&&this.sttEnabled.set(C==="true"),this.loadClonedVoicesFromStorage(),this.loadAiChatSettings()}isRegexValid(e){if(!e)return!0;try{return new RegExp(e),!0}catch{return!1}}getRegexError(e){if(!e)return null;try{return new RegExp(e),null}catch(t){return t.message}}getListenerAccounts(){return this.accounts().filter(e=>e.role==="Listener"&&e.status==="Online")}getSenderAccounts(){return this.accounts().filter(e=>e.role==="Sender"&&(e.status==="Online"||e.status==="Warming Up"))}getOnlineAccountsCount(){return this.accounts().filter(e=>e.status==="Online").length}navigateToView(e){this.changeView(e)}navigateToAutomationTab(e){this.currentView.set("automation"),this.automationTab.set(e)}toggleKnowledgeMenu(){this.knowledgeMenuExpanded.set(!this.knowledgeMenuExpanded())}isKnowledgeView(){let e=this.currentView();return e==="knowledge-brain"||e==="knowledge-manage"||e==="knowledge-gaps"}leadsByStatus(e){return this.leadsByStatusMap().get(e)||[]}todayNewLeads(){let e=new Date;return e.setHours(0,0,0,0),this.leads().filter(t=>new Date(t.timestamp)>=e).length}getConversionRate(){let e=this.leads().length;return e===0?"0.0":(this.leadsByStatus("Closed-Won").length/e*100).toFixed(1)}getContactRate(){let e=this.leads().length;if(e===0)return"0.0";let t=this.leadsByStatus("New").length;return((e-t)/e*100).toFixed(1)}getReplyRate(){let e=this.leads().length-this.leadsByStatus("New").length;return e===0?"0.0":((this.leadsByStatus("Replied").length+this.leadsByStatus("Follow-up").length+this.leadsByStatus("Closed-Won").length+this.leadsByStatus("Closed-Lost").length)/e*100).toFixed(1)}loadFunnelStats(){this.ipcService.send("get-funnel-stats",{})}loadFunnelOverview(){this.isLoadingFunnel.set(!0),this.ipcService.send("get-funnel-overview",{})}loadUserJourney(e){e&&(this.isLoadingJourney.set(!0),this.selectedJourneyUserId.set(e),this.ipcService.send("get-user-journey",{userId:e}))}transitionFunnelStage(e,t,n){this.ipcService.send("transition-funnel-stage",{userId:e,stage:t,reason:n||"\u624B\u52D5\u8F49\u63DB"})}loadMarketingStats(){this.isLoadingMarketing.set(!0),this.ipcService.send("get-marketing-stats",{})}loadMarketingCampaigns(){this.ipcService.send("get-marketing-campaigns",{})}createMarketingCampaign(){if(!this.newMarketingCampaign.name.trim()){this.toastService.error("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}this.ipcService.send("create-marketing-campaign",{name:this.newMarketingCampaign.name,type:this.newMarketingCampaign.type,targetGroup:this.newMarketingCampaign.targetGroup,messageTemplate:this.newMarketingCampaign.messageTemplate})}startMarketingCampaign(e){this.ipcService.send("start-marketing-campaign",{campaignId:e})}loadWarmupDetails(e){this.ipcService.send("get-warmup-progress",{accountId:e})}loadAllWarmupDetails(){this.accounts().forEach(t=>{t.id&&this.loadWarmupDetails(t.id)})}toggleWarmup(e,t){this.ipcService.send("update-account",{id:e,warmupEnabled:t}),this.toastService.info(t?"\u5DF2\u555F\u7528\u9810\u71B1":"\u5DF2\u505C\u7528\u9810\u71B1")}getWarmupStageColor(e){return{1:"text-blue-400",2:"text-cyan-400",3:"text-yellow-400",4:"text-green-400"}[e]||"text-slate-400"}getWarmupStageIcon(e){return{1:"\u{1F507}",2:"\u{1F4AC}",3:"\u{1F4C8}",4:"\u2705"}[e]||"\u2753"}loadMigrationStatus(){this.isLoadingMigration.set(!0),this.ipcService.send("migration-status",{})}runMigration(e){this.isRunningMigration.set(!0),this.ipcService.send("migrate",{targetVersion:e})}rollbackMigration(e){confirm(`\u78BA\u5B9A\u8981\u56DE\u6EFE\u5230\u7248\u672C ${e} \u55CE\uFF1F\u9019\u53EF\u80FD\u6703\u5C0E\u81F4\u6578\u64DA\u4E1F\u5931\uFF01`)&&(this.isRunningMigration.set(!0),this.ipcService.send("rollback-migration",{targetVersion:e}))}loadSchedulerStatus(){this.ipcService.send("get-scheduler-status",{})}startScheduler(){this.ipcService.send("start-scheduler",{})}stopScheduler(){this.ipcService.send("stop-scheduler",{})}runSchedulerTask(e){this.ipcService.send("run-scheduler-task",{taskName:e})}updateSchedulerInterval(e,t){this.ipcService.send("update-scheduler-interval",{taskName:e,interval:t})}loadLogFiles(){this.isLoadingLogs.set(!0),this.ipcService.send("list-log-files",{})}loadLogStats(){this.ipcService.send("get-log-stats",{})}rotateLogs(){this.isRotatingLogs.set(!0),this.ipcService.send("rotate-logs",{})}viewLogFile(e){this.selectedLogFile.set(e),this.ipcService.send("read-log-file",{filename:e})}downloadLogFile(e){this.ipcService.send("download-log-file",{filename:e})}deleteLogFile(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u65E5\u8A8C\u6587\u4EF6 ${e} \u55CE\uFF1F`)&&this.ipcService.send("delete-log-file",{filename:e})}hasSelectedResources(){return this.selectedResourceIds().length>0}selectedResourceCount(){return this.selectedResourceIds().length}batchApproveResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"approved"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchRejectResources(){let e=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:e,status:"rejected"}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchSetResourcePriority(e){let t=this.selectedResourceIds();this.ipcService.send("batch-update-resources",{resourceIds:t,priority:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}batchDeleteResources(){if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${this.selectedResourceCount()} \u500B\u8CC7\u6E90\u55CE\uFF1F`))return;let e=this.selectedResourceIds();this.ipcService.send("batch-delete-resources",{resourceIds:e}),this.selectedResourceIds.set([]),this.showResourceBatchMenu.set(!1)}loadUsersWithProfiles(){this.ipcService.send("get-users-with-profiles",{stage:this.userFilterStage()||void 0,tags:this.userFilterTags()||void 0,search:this.userFilterSearch()||void 0,limit:50,offset:0})}toggleUserSelection(e){let t=this.selectedUserIds();t.includes(e)?this.selectedUserIds.set(t.filter(n=>n!==e)):this.selectedUserIds.set([...t,e])}selectAllUsers(){let e=this.usersWithProfiles().users.map(t=>t.user_id);this.selectedUserIds.set(e)}deselectAllUsers(){this.selectedUserIds.set([])}bulkUpdateTags(e,t){let n=this.selectedUserIds();if(n.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-tags",{userIds:n,tags:e,action:t})}bulkUpdateStage(e){let t=this.selectedUserIds();if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");return}this.ipcService.send("bulk-update-user-stage",{userIds:t,stage:e})}getStageName(e){let t=this.funnelStages.find(n=>n.key===e);return t?t.name:e}getStageColor(e){let t=this.funnelStages.find(n=>n.key===e);return t?t.color:"bg-gray-500"}onDocumentClick(e){this.openResourceMenuId()!==null&&this.openResourceMenuId.set(null)}ngOnInit(){console.log("[App] ngOnInit called, coreDataLoaded:",this.coreDataLoaded()),console.log("[App] Current URL:",window.location.href),console.log("[App] Router URL:",this.router.url),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[App] Angular ready event dispatched")},100),this.loadAiSettings(),this.initMobileDetection(),this.loadSidebarGroupsState(),window.addEventListener("changeView",e=>{let t=e;t.detail&&this.changeView(t.detail)}),this.setupVisibilityListener(),this.setupIpcListeners(),this.checkFirstRun(),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),this.loadCachedStateIfAvailable(),window.addEventListener("page-became-visible",()=>{console.log("[App] Page became visible, refreshing data..."),this.ipcService.send("get-initial-state")}),window.addEventListener("sync-offline-operations",(e=>{this.syncOfflineOperations(e.detail.operations)})),console.log("[App] Current URL:",window.location.href),this.ipcService.send("get-initial-state"),this.isAuthenticated()&&this.authService.fetchCurrentUser().then(e=>{if(e){if(console.log("[App] User data refreshed:",{displayName:e.displayName||e.display_name,telegramId:e.telegramId||e.telegram_id,membership:this.authService.membershipLevel()}),this.membershipService.isSaaSMode()){let t=this.authService.membershipLevel(),n=this.authService.user()?.membershipExpires;this.membershipService.syncFromAuthService(t,n)}this.cdr.detectChanges()}}).catch(e=>console.warn("[App] Failed to refresh user data:",e)),this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4),setTimeout(()=>{this.refreshQueueStatusThrottled()},2e3),this.watchViewChanges(),this.setupKeyboardShortcuts(),this.membershipUpdateHandler=e=>{console.log("[AppComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:",e.detail),this.cdr.detectChanges()},window.addEventListener("membership-updated",this.membershipUpdateHandler),window.addEventListener("save-ai-settings",(e=>{let t=e.detail;console.log("[AppComponent] \u6536\u5230 AI \u8A2D\u7F6E\u4FDD\u5B58\u4E8B\u4EF6:",t),t.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(t.auto_chat_enabled===1),t.auto_chat_mode&&this.aiAutoChatMode.set(t.auto_chat_mode),t.auto_greeting!==void 0&&this.aiAutoGreeting.set(t.auto_greeting===1),this.ipcService.send("update-ai-chat-settings",{settings:t}),this.toastService.success("AI \u8A2D\u7F6E\u5DF2\u4FDD\u5B58",2e3)})),window.addEventListener("get-sender-accounts",(()=>{let t=this.accounts().filter(n=>n.role==="Sender"&&n.status==="Online").map(n=>({phone:n.phone,username:n.username||n.first_name||n.phone,avatar:n.avatar,sentToday:n.sentToday||n.dailySendCount||0,dailyLimit:n.dailySendLimit||50}));window.dispatchEvent(new CustomEvent("sender-accounts-loaded",{detail:t}))}))}checkFirstRun(){this.ipcService.send("check-first-run",{})}detectOllama(){this.isDetectingOllama.set(!0),this.ipcService.send("detect-ollama",{})}completeFirstRunSetup(){let e={aiConfig:{primaryProvider:this.ollamaDetected()?"local":"cloud",localAi:{provider:"ollama",endpoint:this.localAiEndpoint(),model:this.autoSelectedModel()||this.localAiModel(),autoDetect:!0},cloudAi:{enabled:!this.ollamaDetected(),provider:this.aiApiType(),apiKey:this.aiApiKey()},autoFallback:{enabled:this.aiAutoFallback(),fallbackProvider:this.aiBackupProvider()}},settings:{language:"zh",theme:this.theme(),firstRun:{completed:!0,completedAt:new Date().toISOString()}}};this.ipcService.send("save-first-run-settings",e),this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.success("\u{1F389} \u8A2D\u7F6E\u5B8C\u6210\uFF01\u6B61\u8FCE\u4F7F\u7528 TG-Matrix")}skipFirstRunSetup(){this.showWelcomeDialog.set(!1),this.isFirstRun.set(!1),this.toastService.info("\u60A8\u53EF\u4EE5\u7A0D\u5F8C\u5728\u8A2D\u7F6E\u4E2D\u914D\u7F6E AI")}watchViewChanges(){let e=null,t=()=>{let n=this.currentView();n!==e&&(e=n,n==="leads"?(this.loadFunnelStats(),this.loadUsersWithProfiles()):n==="resources"?(this.refreshResourceStats(),this.isInSearchResultMode()||this.loadResources(),this.loadDiscoveryKeywords()):n==="ai-center"&&this.refreshRagStats())};t(),this.viewCheckInterval=setInterval(t,2e3)}setupVisibilityListener(){this.visibilityChangeHandler=()=>{this.isPageVisible=!document.hidden,this.isPageVisible?(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u53EF\u898B\uFF0C\u6062\u5FA9\u5237\u65B0"),this.resumeRefreshIntervals()):(console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u96B1\u85CF\uFF0C\u66AB\u505C\u5237\u65B0"),this.pauseRefreshIntervals())},document.addEventListener("visibilitychange",this.visibilityChangeHandler)}pauseRefreshIntervals(){this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0)}resumeRefreshIntervals(){if(!this.viewCheckInterval){let e="",t=()=>{let n=this.currentView();n!==e&&(e=n)};this.viewCheckInterval=setInterval(t,2e3)}this.queueRefreshInterval||(this.queueRefreshInterval=setInterval(()=>{this.refreshQueueStatusThrottled()},6e4)),this.isAuthenticated()&&this.authService.forceRefreshUser().then(e=>{e&&(console.log("[App] \u9801\u9762\u53EF\u898B\uFF0C\u7528\u6236\u6578\u64DA\u5DF2\u5237\u65B0:",{displayName:e.displayName,membershipLevel:e.membershipLevel}),this.cdr.detectChanges())}).catch(e=>{console.warn("[App] \u9801\u9762\u53EF\u898B\u6642\u5237\u65B0\u7528\u6236\u6578\u64DA\u5931\u6557:",e)})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&e.key==="n"&&this.currentView()==="accounts"&&(e.preventDefault(),setTimeout(()=>{let t=document.querySelector('[name="phone"]');t&&t.focus()},100)),e.key==="Escape"&&(this.selectedQueuePhone()&&this.closeQueueDetails(),this.progressDialog().show&&this.progressDialog().cancellable&&this.progressDialog.set(B(F({},this.progressDialog()),{show:!1}))),!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement)&&(e.key==="1"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("dashboard")):e.key==="2"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("accounts")):e.key==="3"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("automation")):e.key==="4"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("leads")):e.key==="5"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("ads")):e.key==="6"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.changeView("campaigns")):e.key==="7"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.changeView("settings")))})}ngOnDestroy(){this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.membershipUpdateHandler&&window.removeEventListener("membership-updated",this.membershipUpdateHandler),this.ipcService.cleanup("log-entry"),this.ipcService.cleanup("monitoring-status-changed"),this.ipcService.cleanup("monitoring-status-report"),this.ipcService.cleanup("monitoring-start-failed"),this.ipcService.cleanup("monitoring-config-check"),this.ipcService.cleanup("initial-state"),this.ipcService.cleanup("accounts-updated"),this.ipcService.cleanup("new-lead-captured"),this.ipcService.cleanup("queue-status"),this.ipcService.cleanup("queue-messages"),this.ipcService.cleanup("sending-stats"),this.ipcService.cleanup("queue-length-history"),this.ipcService.cleanup("account-sending-comparison"),this.ipcService.cleanup("campaign-performance-stats"),this.ipcService.cleanup("alert-triggered"),this.ipcService.cleanup("alerts-loaded"),this.ipcService.cleanup("account-validation-error"),this.ipcService.cleanup("keyword-set-validation-error"),this.ipcService.cleanup("keyword-validation-error"),this.ipcService.cleanup("group-validation-error"),this.ipcService.cleanup("group-membership-status"),this.ipcService.cleanup("group-join-result"),this.ipcService.cleanup("template-validation-error"),this.ipcService.cleanup("campaign-validation-error"),this.ipcService.cleanup("keyword-sets-updated"),this.ipcService.cleanup("groups-updated"),this.ipcService.cleanup("templates-updated"),this.ipcService.cleanup("campaigns-updated"),this.ipcService.cleanup("leads-updated"),this.ipcService.cleanup("funnel-stats"),this.ipcService.cleanup("users-with-profiles"),this.ipcService.cleanup("bulk-update-complete"),this.ipcService.cleanup("login-requires-code"),this.ipcService.cleanup("login-requires-2fa"),this.ipcService.cleanup("account-login-error"),this.ipcService.cleanup("session-files-cleaned"),this.ipcService.cleanup("session-files-cleanup-error"),this.ipcService.cleanup("session-import-result"),this.ipcService.cleanup("session-import-needs-credentials"),this.ipcService.cleanup("orphan-sessions-detected"),this.ipcService.cleanup("orphan-sessions-scanned"),this.ipcService.cleanup("orphan-sessions-recovered"),this.queueRefreshInterval&&(clearInterval(this.queueRefreshInterval),this.queueRefreshInterval=void 0),this.viewCheckInterval&&(clearInterval(this.viewCheckInterval),this.viewCheckInterval=void 0),this.initialStateDebounceTimer&&(clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=void 0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),this.saveSettingsTimer&&(clearTimeout(this.saveSettingsTimer),this.saveSettingsTimer=null),this.queueStatusRefreshThrottleTimer&&(clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=void 0),this.chatListSearchDebounceTimer&&(clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=void 0),this.logFilterDebounceTimer&&(clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=void 0)}startConnectionTimeout(){setTimeout(()=>{this.backendConnectionState()==="connecting"&&(this.backendConnectionMessage.set("\u6B63\u5728\u9023\u63A5..."),this.backendConnectionProgress.set(50))},3e3)}hideConnectionIndicator(){setTimeout(()=>{this.backendConnectionState()},2e3)}async loadCachedStateIfAvailable(){try{let e=await this.offlineCache.loadCachedState();e&&this.offlineCache.isCacheValid()&&(console.log("[App] \u{1F680} Loading cached state for fast startup"),e.accounts?.length>0&&this.accounts.set(e.accounts),e.keywordSets?.length>0&&this.keywordSets.set(e.keywordSets),e.leads?.length>0&&this.leads.set(e.leads.map(t=>this.mapLeadFromBackend(t))),e.settings&&this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),console.log("[App] \u2705 Cached state applied, waiting for fresh data..."))}catch(e){console.warn("[App] Failed to load cached state:",e)}}async syncOfflineOperations(e){if(!this.offlineCache.isOnline()){console.log("[App] Still offline, skipping sync");return}console.log("[App] \u{1F504} Syncing",e.length,"offline operations");for(let t of e)try{this.ipcService.send(t.command,t.payload),await this.offlineCache.removeOperation(t.id),console.log("[App] \u2705 Synced operation:",t.command)}catch(n){console.error("[App] Failed to sync operation:",t.command,n)}e.length>0&&this.toastService.success(`\u2705 \u5DF2\u540C\u6B65 ${e.length} \u500B\u96E2\u7DDA\u64CD\u4F5C`)}retryConnection(){this.backendConnectionState.set("connecting"),this.backendConnectionMessage.set("\u6B63\u5728\u91CD\u65B0\u9023\u63A5..."),this.backendConnectionProgress.set(0),this.connectionStartTime=Date.now(),this.startConnectionTimeout(),this.ipcService.send("get-initial-state")}setupIpcListeners(){this.ipcService.on("connection-confirmed",e=>{console.log("[Frontend] \u2705 Connection confirmed:",e),this.backendConnectionState.set("connected"),this.backendConnectionProgress.set(100),this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.hideConnectionIndicator()}),this.ipcService.on("connection-error",e=>{console.log("[Frontend] \u274C Connection error:",e),this.backendConnectionState()==="connecting"&&(this.backendConnectionState.set("error"),this.backendConnectionMessage.set(e.message||"\u9023\u63A5\u5931\u6557"))}),this.ipcService.on("connection-mode-changed",e=>{console.log("[Frontend] Connection mode changed:",e.mode),e.mode==="polling"?console.log("[Frontend] \u26A0\uFE0F Running in degraded mode (HTTP polling)"):e.mode==="websocket"&&console.log("[Frontend] \u2705 WebSocket connection restored")}),this.ipcService.on("loading-progress",e=>{console.log("[Frontend] Loading progress:",e),this.backendConnectionProgress.set(e.progress),this.backendConnectionMessage.set(e.message),e.step==="complete"&&(this.backendConnectionState.set("connected"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.hideConnectionIndicator())}),this.ipcService.on("log-entry",e=>{e.timestamp=new Date(e.timestamp),this.logs.update(t=>[e,...t].slice(0,100))}),this.ipcService.on("log-entries-batch",e=>{if(e.entries&&e.entries.length>0){let t=e.entries.map(n=>B(F({},n),{timestamp:new Date(n.timestamp)}));this.logs.update(n=>[...t.reverse(),...n].slice(0,100))}}),this.ipcService.on("monitoring-status-changed",e=>{this.isMonitoring.set(e),this.isStartingMonitoring.set(!1)}),this.ipcService.on("monitoring-start-failed",e=>{if(console.log("[Frontend] Monitoring start failed:",e),this.isStartingMonitoring.set(!1),e.reason==="config_check_failed"){let t=e.issues||[],n=e.warnings||[],o=t.some(a=>a.message?.includes("\u96E2\u7DDA")||a.message?.includes("offline")||a.code==="no_online_accounts");if(t.length>0){let a=t.map(d=>`\u2022 ${d.message}`).join(`
`);o?this.toastService.withActions("error",`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${a}`,[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],15e3):this.toastService.error(`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${a}`,1e4)}n.length>0&&setTimeout(()=>{let a=n.slice(0,3).map(d=>d.message).join("\uFF1B");this.toastService.warning(`\u26A0 \u5176\u4ED6\u554F\u984C\uFF1A${a}`,8e3)},1e3)}else if(e.reason==="no_online_listeners")this.toastService.withActions("error","\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u5728\u7DDA\u7684\u76E3\u807D\u8CEC\u6236",[{label:"\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",variant:"primary",handler:()=>this.navigateToView("manageAccounts")},{label:"\u95DC\u9589",variant:"secondary",handler:()=>{}}],1e4);else if(e.reason==="no_groups")this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",5e3);else if(e.reason==="no_accessible_groups"){let t=e.cannot_join_list||[];if(t.length>0){let n=t.map(o=>`\u2022 ${o.url}: ${o.reason||"\u672A\u77E5\u539F\u56E0"}`).join(`
`);this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002
${n}`,12e3)}else this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002\u8ACB\u78BA\u4FDD\u76E3\u63A7\u865F\u5DF2\u52A0\u5165\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002",8e3)}else e.reason==="exception"?this.toastService.error(e.message||"\u555F\u52D5\u76E3\u63A7\u6642\u767C\u751F\u932F\u8AA4",8e3):this.toastService.error(e.message||"\u555F\u52D5\u76E3\u63A7\u5931\u6557",5e3)}),this.ipcService.on("monitoring-config-check",e=>{if(console.log("[Frontend] Monitoring config check:",e),this.lastConfigCheck.set(e),e.passed&&e.warnings.length>0){let t=e.warnings.slice(0,2);for(let n of t){let o=n.code||"";this.errorNavigationMap[o]?this.toastService.warningWithAction(`\u26A0 ${n.message}`,"\u53BB\u8A2D\u7F6E",()=>this.navigateToError(o)):this.toastService.warning(`\u26A0 ${n.message}
\u4FEE\u5FA9: ${n.fix}`,8e3)}e.summary.can_send_messages||setTimeout(()=>{this.toastService.warningWithAction("\u76E3\u63A7\u5C07\u904B\u884C\uFF0C\u4F46 Lead \u4E0D\u6703\u81EA\u52D5\u767C\u9001\u6D88\u606F\u3002","\u914D\u7F6E\u898F\u5247",()=>this.navigateToError("NO_CAMPAIGN"))},2e3)}}),this.ipcService.on("monitoring-status-report",e=>{if(console.log("[Frontend] Monitoring status report:",e),e.accessible_groups>0){let t=e.accessible_list.slice(0,3).map(o=>o.title||o.url).join(", "),n=e.accessible_groups>3?`\u7B49 ${e.accessible_groups} \u500B\u7FA4\u7D44`:"";this.toastService.success(`\u2713 \u53EF\u76E3\u63A7\u7FA4\u7D44: ${t}${n}`,4e3)}if(e.groups_needing_join>0){let t=e.needing_join_list.slice(0,2).map(o=>o.url).join(", "),n=e.groups_needing_join>2?`\u7B49 ${e.groups_needing_join} \u500B`:"";this.toastService.warning(`\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u7FA4\u7D44: ${t}${n}\u3002\u6B63\u5728\u5617\u8A66\u81EA\u52D5\u52A0\u5165...`,6e3)}e.accessible_groups===0&&e.groups_needing_join>0&&this.toastService.warning("\u76E3\u63A7\u865F\u5C1A\u672A\u52A0\u5165\u4EFB\u4F55\u76E3\u63A7\u7FA4\u7D44\u3002\u7CFB\u7D71\u5C07\u5617\u8A66\u81EA\u52D5\u52A0\u5165\u516C\u958B\u7FA4\u7D44\u3002",5e3)}),this.ipcService.on("template-already-exists",e=>{console.log("[Frontend] Template already exists:",e),this.toastService.warning(e.message||`\u6A21\u677F "${e.name}" \u5DF2\u5B58\u5728`,3e3)}),this.ipcService.on("accounts-updated",e=>{console.log("[Frontend] Received accounts-updated event:",e.length,"accounts");let t=this.accounts().length,n=this.accounts();this.accounts.set(e),e.forEach(o=>{let a=n.find(d=>d.id===o.id);if(a&&a.status!==o.status)if(console.log(`[Frontend] Account ${o.phone} status changed: ${a.status} -> ${o.status}`),o.status==="Online")this.toastService.success(`\u8D26\u6237 ${o.phone} \u767B\u5F55\u6210\u529F`),this.cancelLogin();else if(o.status==="Logging in...")this.toastService.info(`\u8D26\u6237 ${o.phone} \u6B63\u5728\u767B\u5F55...`);else if(o.status==="Waiting Code"){let d=this.loginState();d.accountId===o.id&&!d.requiresCode&&this.toastService.info(`\u8D26\u6237 ${o.phone} \u7B49\u5F85\u9A8C\u8BC1\u7801`)}else if(o.status==="Waiting 2FA"){let d=this.loginState();d.accountId===o.id&&!d.requires2FA&&(this.loginState.set({accountId:o.id,phone:o.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info(`\u8D26\u6237 ${o.phone} \u7B49\u5F85 2FA \u5BC6\u7801`))}else(o.status.includes("Error")||o.status==="Error")&&(this.toastService.error(`\u8D26\u6237 ${o.phone} \u767B\u5F55\u5931\u8D25`),this.cancelLogin())}),e.length>t&&this.toastService.success(`\u8D26\u6237\u5217\u8868\u5DF2\u66F4\u65B0\uFF08${e.length} \u4E2A\u8D26\u6237\uFF09`)}),this.ipcService.on("account-validation-error",e=>{console.error("Account validation error:",e);let t=Array.isArray(e.errors)?e.errors:[e.errors||"\u9A8C\u8BC1\u5931\u8D25"];if((e.error_type||"validation")==="duplicate"||t.some(d=>d.includes("\u5DF2\u5B58\u5728")||d.includes("already exists"))){this.validationErrors.set({account:t}),this.toastService.error(t.join("; "));return}this.accounts().length===0?(this.validationErrors.set({account:t}),this.toastService.error(`\u6DFB\u52A0\u8D26\u6237\u5931\u8D25: ${t.join("; ")}`)):console.warn("Validation error received but accounts already exist, ignoring:",t)}),this.ipcService.on("new-lead-captured",e=>{e.timestamp=new Date(e.timestamp),e.interactionHistory.forEach(t=>t.timestamp=new Date(t.timestamp)),this.leads.update(t=>[e,...t])}),this.ipcService.on("keyword-matched",e=>{console.log("[Frontend] Keyword matched event:",e),this.realtimeMatches.update(t=>[e,...t].slice(0,50)),this.todayStats.update(t=>B(F({},t),{matchCount:t.matchCount+1}))}),this.ipcService.on("lead-captured",e=>{console.log("[Frontend] Lead captured event received:",e),this.todayStats.update(n=>B(F({},n),{newLeads:n.newLeads+1})),this.showNotification("\u65B0\u6F5B\u5728\u5BA2\u6236\u5DF2\u6355\u7372",`@${e.username||e.firstName||"\u7528\u6236"} \u5DF2\u6355\u7372`,{requireInteraction:!0}),e.interactionHistory||(e.interactionHistory=[]),e.status||(e.status="New"),e.doNotContact===void 0&&(e.doNotContact=!1),e.timestamp=new Date(e.timestamp||new Date),e.interactionHistory&&e.interactionHistory.forEach(n=>n.timestamp=new Date(n.timestamp)),this.leads.update(n=>{let o=n.findIndex(a=>a.userId===e.userId);return o>=0?(n[o]=e,[...n]):[e,...n]});let t=e.username?`@${e.username}`:e.firstName||e.userId;this.toastService.success(`\u{1F3AF} ${this.t("newLeadCaptured")}: ${t}`,4e3)}),this.ipcService.on("session-files-cleaned",e=>{this.toastService.success(`\u6E05\u7406\u5B8C\u6210\uFF1A\u5220\u9664\u4E86 ${e.deleted_count} \u4E2A\u5B64\u7ACB\u6587\u4EF6\uFF0C\u4FDD\u7559\u4E86 ${e.kept_count} \u4E2A\u6709\u6548\u6587\u4EF6`),console.log("[Frontend] Session files cleaned:",e)}),this.ipcService.on("session-files-cleanup-error",e=>{this.toastService.error(`\u6E05\u7406\u5931\u8D25\uFF1A${e.error}`),console.error("[Frontend] Session files cleanup error:",e)}),this.ipcService.on("session-import-result",e=>{console.log("[Frontend] Session import result:",e),e.success?(this.toastService.success(e.phone?`\u2705 Session \u5C0E\u5165\u6210\u529F: ${e.phone}`:`\u2705 \u5C0E\u5165\u5B8C\u6210: ${e.count||1} \u500B\u5E33\u865F`,3e3),this.ipcService.send("get-initial-state")):this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${e.message}`,4e3)}),this.ipcService.on("session-import-needs-credentials",e=>{console.log("[Frontend] Session import needs credentials:",e),this.toastService.warning(`\u26A0\uFE0F \u5C0E\u5165 ${e.phoneNumber} \u9700\u8981 API \u6191\u64DA`,4e3),this.toastService.info("\u8ACB\u5148\u5728\u300CAPI \u6191\u64DA\u6C60\u300D\u9801\u9762\u6DFB\u52A0 API \u6191\u64DA\uFF0C\u7136\u5F8C\u91CD\u8A66\u5C0E\u5165",5e3)}),this.ipcService.on("orphan-sessions-detected",e=>{console.log("[Frontend] Orphan sessions detected:",e),e.count>0&&(this.orphanSessions.set(e.sessions),this.showOrphanSessionDialog.set(!0),this.toastService.warning(`\u767C\u73FE ${e.count} \u500B\u9700\u8981\u624B\u52D5\u6062\u5FA9\u7684 Session \u6587\u4EF6`,5e3))}),this.ipcService.on("orphan-sessions-scanned",e=>{console.log("[Frontend] Orphan sessions scanned:",e),e.success&&e.orphan_sessions.length>0&&this.orphanSessions.set(e.orphan_sessions)}),this.ipcService.on("orphan-sessions-recovered",e=>{console.log("[Frontend] Orphan sessions recovered:",e),this.isRecoveringOrphanSessions.set(!1),e.success?(this.toastService.success(`\u6210\u529F\u6062\u5FA9 ${e.recovered_count} \u500B\u5E33\u865F`,3e3),this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([]),this.ipcService.send("get-accounts")):this.toastService.error(`\u6062\u5FA9\u5931\u6557: ${e.message}`,4e3)}),this.ipcService.on("keyword-set-validation-error",e=>{console.error("[Frontend] Keyword set validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${t}`)}),this.ipcService.on("keyword-set-error",e=>{if(console.log("[Frontend] Keyword set error event:",e),e.success)e.message&&this.toastService.success(e.message),this.newKeywordSet.set({name:""});else{let t=e.error||"\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";console.warn("[Frontend] Keyword set error:",t,e.details),t.includes("\u5DF2\u5B58\u5728")||t.includes("already exists")?this.toastService.warning("\u5173\u952E\u8BCD\u96C6\u5DF2\u5B58\u5728",3e3):t.includes("\u4E0D\u5B58\u5728")||t.includes("not found")?console.log("[Frontend] Keyword set already deleted, ignoring"):t.includes("\u6570\u636E\u5EAB")||t.includes("\u6570\u636E\u5E93")||t.includes("\u640D\u58DE")||t.includes("\u635F\u574F")?this.toastService.error(`\u6570\u636E\u5E93\u9519\u8BEF: ${t}\u3002\u8BF7\u4F7F\u7528 rebuild_database.py \u91CD\u5EFA\u6570\u636E\u5E93\u3002`,1e4):this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${t}`)}}),this.ipcService.on("keyword-validation-error",e=>{console.error("[Frontend] Keyword validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u5173\u952E\u8BCD\u5931\u8D25";this.toastService.error(`\u5173\u952E\u8BCD\u9519\u8BEF: ${t}`)}),this.ipcService.on("group-validation-error",e=>{console.error("[Frontend] Group validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u7FA4\u7EC4\u5931\u8D25";this.toastService.error(`\u7FA4\u7EC4\u9519\u8BEF: ${t}`)}),this.ipcService.on("group-membership-status",e=>{console.log("[Frontend] Group membership status:",e),e.status.is_member?this.toastService.success(`\u2713 \u76E3\u63A7\u865F\u5DF2\u5728\u7FA4\u7D44\u4E2D: ${e.status.chat_title||e.url}`,3e3):e.status.can_join&&(e.status.is_private?this.toastService.warning("\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u624B\u52D5\u5C07\u76E3\u63A7\u865F\u52A0\u5165\u7FA4\u7D44",5e3):this.toastService.info("\u2139 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u7FA4\u7D44\uFF0C\u555F\u52D5\u76E3\u63A7\u6642\u5C07\u81EA\u52D5\u52A0\u5165",4e3))}),this.ipcService.on("group-join-result",e=>{console.log("[Frontend] Group join result:",e),e.success?e.alreadyMember?this.toastService.success(`${e.phone} \u5DF2\u7D93\u5728\u7FA4\u7D44 ${e.chatTitle||e.groupUrl} \u4E2D`,3e3):this.toastService.success(`${e.phone} \u6210\u529F\u52A0\u5165\u7FA4\u7D44 ${e.chatTitle||e.groupUrl}`,4e3):this.toastService.error(`\u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${e.error}`,5e3)}),this.ipcService.on("template-validation-error",e=>{console.error("[Frontend] Template validation error:",e);let t=e.errors?.join("; ")||"\u6DFB\u52A0\u6A21\u677F\u5931\u8D25";this.toastService.error(`\u6A21\u677F\u9519\u8BEF: ${t}`)}),this.ipcService.on("campaign-validation-error",e=>{console.error("[Frontend] Campaign validation error:",e);let t=e.errors?.join("; ")||"\u521B\u5EFA\u6D3B\u52A8\u5931\u8D25";this.toastService.error(`\u6D3B\u52A8\u9519\u8BEF: ${t}`)}),this.ipcService.on("login-requires-code",e=>{console.log("[Frontend] Received login-requires-code event:",e),console.log("[Frontend] Current loginState before update:",this.loginState()),this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!1,canRetrySMS:e.canRetrySMS||!1,waitSeconds:e.waitSeconds}),console.log("[Frontend] Updated loginState:",this.loginState()),console.log("[Frontend] requiresCode value:",this.loginState().requiresCode),this.loginCode.set(""),e.message?e.sendType==="app"?this.toastService.info(e.message,8e3):this.toastService.info(e.message):e.sendType==="app"?this.toastService.info("\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230\u60A8\u7684 Telegram \u5E94\u7528\u3002\u8BF7\u68C0\u67E5\u60A8\u624B\u673A\u4E0A\u5DF2\u767B\u5F55\u7684 Telegram \u5E94\u7528\uFF0C\u67E5\u770B\u9A8C\u8BC1\u7801\u6D88\u606F\u3002",8e3):e.sendType==="sms"?this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${e.phone} \u7684\u77ED\u4FE1\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`):this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${e.phone}\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`)}),this.ipcService.on("login-requires-2fa",e=>{console.log("[Frontend] Received login-requires-2fa event:",e),this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!0,phoneCodeHash:null,isSubmittingCode:!1}),this.login2FAPassword.set(""),this.toastService.info("\u8BF7\u8F93\u5165 2FA \u5BC6\u7801")}),this.ipcService.on("account-login-error",e=>{if(console.error("[Frontend] Account login error:",e),e.floodWait){let n=e.floodWait,o=Math.floor(n/3600),a=Math.floor(n%3600/60),d=n%60,m="";o>0?(m=`${o} \u5C0F\u65F6`,a>0&&(m+=` ${a} \u5206\u949F`)):a>0?(m=`${a} \u5206\u949F`,d>0&&(m+=` ${d} \u79D2`)):m=`${d} \u79D2`;let f=`\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7B49\u5F85 ${m} \u540E\u518D\u8BD5\u3002\u9A8C\u8BC1\u7801\u672A\u53D1\u9001\u3002`;this.toastService.error(f),console.error("FloodWait error:",{waitSeconds:n,timeStr:m})}else this.toastService.error(e.friendlyMessage||e.message);console.error("Login error details:",{accountId:e.accountId,phone:e.phone,status:e.status,message:e.message,codeExpired:e.codeExpired,floodWait:e.floodWait});let t=this.loginState();if(this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:t.requiresCode,requires2FA:t.requires2FA,phoneCodeHash:t.phoneCodeHash,isSubmittingCode:!1}),e.floodWait){this.cancelLogin();return}e.codeExpired?(this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set("")):e.message&&(e.message.includes("banned")||e.message.includes("invalid phone"))?this.cancelLogin():e.message&&e.message.includes("Invalid verification code")&&this.loginState.set({accountId:t.accountId,phone:t.phone,requiresCode:!0,requires2FA:!1,phoneCodeHash:t.phoneCodeHash,isSubmittingCode:!1})}),this.ipcService.on("account-status-updated",e=>{}),this.ipcService.on("initial-state-core",e=>{console.log("[Frontend] \u{1F680} Received initial-state-core (accounts + settings)"),e?.accounts&&(this.accounts.set(e.accounts),console.log("[Frontend] Accounts loaded:",e.accounts.length)),e?.settings&&(this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(e.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(e.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.settings.smartSendingEnabled??!0)),e?.isMonitoring!==void 0&&this.isMonitoring.set(e.isMonitoring),console.log("[App] Setting coreDataLoaded to true"),this.coreDataLoaded.set(!0),console.log("[App] coreDataLoaded is now:",this.coreDataLoaded())}),this.ipcService.on("initial-state-config",e=>{console.log("[Frontend] \u{1F4CB} Received initial-state-config"),e?.keywordSets&&this.keywordSets.set(e.keywordSets),e?.monitoredGroups&&this.monitoredGroups.set(e.monitoredGroups),e?.campaigns&&this.campaigns.set(e.campaigns),e?.messageTemplates&&this.messageTemplates.set(e.messageTemplates)}),this.ipcService.on("initial-state-data",e=>{if(console.log("[Frontend] \u{1F4CA} Received initial-state-data (leads + logs)"),console.log("[Frontend] leads count:",e?.leads?.length,"total:",e?.leadsTotal,"hasMore:",e?.leadsHasMore),e?.leads){let t=(e.leads||[]).map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.contactsService.importLeadsDirectly(t),console.log("[Frontend] Initial leads synced to resource center:",t.length)}e?.leadsTotal!==void 0&&this.leadsTotal.set(e.leadsTotal),e?.leadsHasMore!==void 0&&this.leadsHasMore.set(e.leadsHasMore),e?.leads&&e?.leadsTotal&&e.leads.length<e.leadsTotal&&(console.log("[Frontend] \u{1F504} Auto-loading remaining leads..."),this.leadsHasMore.set(!0),this.leadsLoading.set(!1),setTimeout(()=>this.loadRemainingLeads(),500)),e?.logs&&this.logs.set(e.logs)}),this.ipcService.on("initial-state",e=>{console.log("[Frontend] \u2605\u2605\u2605 Received initial-state event \u2605\u2605\u2605"),console.log("[Frontend] initial-state payload:",e),console.log("[Frontend] accounts in payload:",e?.accounts?.length||0);let t=Date.now();if(t-this.lastInitialStateTime<500){this.initialStateDebounceTimer&&clearTimeout(this.initialStateDebounceTimer),this.initialStateDebounceTimer=setTimeout(()=>{try{this.applyInitialState(e)}catch(n){console.error("[Frontend] Error applying initial state:",n)}finally{this.initialStateDebounceTimer=void 0}},500);return}this.lastInitialStateTime=t;try{this.applyInitialState(e)}catch(n){console.error("[Frontend] Error applying initial state:",n)}}),this.ipcService.on("keyword-sets-updated",e=>{typeof console<"u"&&console.log&&console.log("[Frontend] Received keyword-sets-updated:",e.keywordSets?.length||0),this.keywordSetsUpdateDebounceTimer&&(clearTimeout(this.keywordSetsUpdateDebounceTimer),this.keywordSetsUpdateDebounceTimer=void 0),e.keywordSets&&Array.isArray(e.keywordSets)?this.keywordSetsUpdateDebounceTimer=setTimeout(()=>{try{let t=new Set,n=e.keywordSets.filter(d=>!d||typeof d.id!="number"||t.has(d.id)?!1:(t.add(d.id),!0)).map(d=>{let m=Array.isArray(d.keywords)?d.keywords:[],f=new Set,h=m.filter(C=>{if(!C||typeof C.keyword!="string")return!1;let y=`${C.keyword}_${C.isRegex}`;return f.has(y)?!1:(f.add(y),!0)});return B(F({},d),{keywords:h})}),o=this.keywordSets();JSON.stringify(o)!==JSON.stringify(n)&&this.keywordSets.set(n)}catch(t){console.error("[Frontend] Error processing keyword-sets-updated:",t)}finally{this.keywordSetsUpdateDebounceTimer=void 0}},150):this.keywordSets().length>0&&this.keywordSets.set([])}),this.ipcService.on("keyword-validation-error",e=>{console.log("[Frontend] Keyword validation error:",e),e.errors&&e.errors.length>0&&(this.toastService.error(`\u95DC\u9375\u8A5E\u9A57\u8B49\u5931\u6557: ${e.errors.join(", ")}`,4e3),setTimeout(()=>{},1e3))}),this.ipcService.on("groups-updated",e=>{console.log("[Frontend] Received groups-updated:",e.monitoredGroups?.length||0),this.monitoredGroups.set(e.monitoredGroups||[])}),this.ipcService.on("templates-updated",e=>{console.log("[Frontend] Received templates-updated:",e.messageTemplates?.length||0),this.messageTemplates.set(e.messageTemplates||[])}),this.ipcService.on("campaigns-updated",e=>{console.log("[Frontend] Received campaigns-updated:",e.campaigns?.length||0),this.campaigns.set(e.campaigns||[]),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-already-exists",e=>{console.log("[Frontend] Campaign already exists:",e),this.toastService.warning(e.message||`\u6D3B\u52D5 "${e.name}" \u5DF2\u5B58\u5728`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("campaign-validation-error",e=>{console.log("[Frontend] Campaign validation error:",e),e.errors&&e.errors.length>0&&this.toastService.error(`\u6D3B\u52D5\u9A57\u8B49\u5931\u6557: ${e.errors.join(", ")}`,4e3),this.isSubmittingCampaign.set(!1)}),this.ipcService.on("search-leads-result",e=>{this.isSearchingLeads.set(!1),e.success&&e.results?(this.leadSearchResults.set(e.results),e.results.length===0&&this.toastService.info("\u672A\u627E\u5230\u5339\u914D\u7684\u6F5C\u5728\u5BA2\u6237")):(this.toastService.error(e.error||"\u641C\u7D22\u5931\u8D25"),this.leadSearchResults.set([]))}),this.ipcService.on("backup-created",e=>{this.isCreatingBackup.set(!1),e.success?(this.toastService.success("\u5907\u4EFD\u521B\u5EFA\u6210\u529F"),this.loadBackups()):this.toastService.error(e.error||"\u5907\u4EFD\u521B\u5EFA\u5931\u8D25")}),this.ipcService.on("backups-list",e=>{e.success&&e.backups&&this.backups.set(e.backups)}),this.ipcService.on("backup-restored",e=>{this.isRestoringBackup.set(!1),e.success?this.toastService.success("\u5907\u4EFD\u6062\u590D\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u9875\u9762"):this.toastService.error(e.error||"\u5907\u4EFD\u6062\u590D\u5931\u8D25")}),this.ipcService.on("backup-deleted",e=>{e.success?(this.toastService.success("\u5907\u4EFD\u5DF2\u5220\u9664"),this.loadBackups()):this.toastService.error(e.error||"\u5220\u9664\u5907\u4EFD\u5931\u8D25")}),this.ipcService.on("leads-updated",e=>{let t=e.total??e.leads?.length??0;console.log("[Frontend] Received leads-updated:",e.leads?.length||0,"total:",t);let n=(e.leads||[]).map(o=>this.mapLeadFromBackend(o));this.leads.set(n),this.leadsTotal.set(t),this.contactsService.importLeadsDirectly(n)}),this.ipcService.on("leads-paginated",e=>{if(console.log("[Frontend] Received leads-paginated:",e.leads?.length||0,"total:",e.total),this.leadsLoading.set(!1),e.leads&&e.leads.length>0){let t=e.leads.map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.leadsTotal.set(e.total),this.leadsHasMore.set(e.hasMore),this.contactsService.importLeadsDirectly(t),console.log("[Frontend] \u2705 Synced to resource center:",t.length,"leads"),e.hasMore||this.toastService.success(`\u6578\u64DA\u52A0\u8F09\u5B8C\u6210\uFF1A\u5171 ${t.length} \u689D`)}}),this.ipcService.on("funnel-stats",e=>{console.log("[Frontend] Received funnel-stats:",e),e.error||this.funnelStats.set(e)}),this.ipcService.on("funnel-overview",e=>{this.isLoadingFunnel.set(!1),e.success&&this.funnelOverview.set({stages:e.stages||[],totalLeads:e.total_leads||0,convertedLeads:e.converted_leads||0,averageConversionDays:e.average_days||0,conversionRate:e.conversion_rate||0})}),this.ipcService.on("user-journey",e=>{this.isLoadingJourney.set(!1),e.success&&e.journey&&this.userJourneyData.set({userId:e.userId,stages:e.journey.transitions||[],currentStage:e.journey.current_stage||"new",totalDays:e.journey.total_days||0,isConverted:e.journey.is_converted||!1})}),this.ipcService.on("funnel-stage-transitioned",e=>{e.success?(this.toastService.success(`\u2705 \u6F0F\u6597\u968E\u6BB5\u5DF2\u66F4\u65B0: ${e.stage}`),this.loadFunnelOverview(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("marketing-stats",e=>{this.isLoadingMarketing.set(!1),e.success!==!1&&this.marketingStats.set({totalCampaigns:e.total_campaigns||0,running:e.running||0,completed:e.completed||0,totalMessages:e.total_messages||0,totalInvites:e.total_invites||0,successRate:e.success_rate||0})}),this.ipcService.on("marketing-campaigns",e=>{e.success&&e.campaigns&&this.marketingCampaigns.set(e.campaigns)}),this.ipcService.on("campaign-created",e=>{e.success?(this.toastService.success("\u2705 \u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.showCreateCampaignDialog.set(!1),this.newMarketingCampaign={name:"",type:"pm",targetGroup:"",messageTemplate:""},this.loadMarketingCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}),this.ipcService.on("campaign-started",e=>{e.success&&(this.toastService.info("\u{1F680} \u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadMarketingCampaigns())}),this.ipcService.on("campaign-complete",e=>{e.success&&(this.toastService.success(`\u2705 \u6D3B\u52D5\u5B8C\u6210\uFF01\u6210\u529F: ${e.stats?.success||0}, \u5931\u6557: ${e.stats?.failed||0}`),this.loadMarketingStats(),this.loadMarketingCampaigns())}),this.ipcService.on("warmup-progress",e=>{e.success&&e.accountId&&this.warmupDetails.update(t=>B(F({},t),{[e.accountId]:{enabled:e.enabled||!1,startDate:e.start_date||null,stage:e.stage?.stage||0,stageName:e.stage?.stage_name||"",daysCompleted:e.days_completed||0,totalDays:e.total_days||14,progressPercent:e.progress_percentage||0,dailyLimit:e.stage?.daily_limit||0,allowedActions:e.stage?.allowed_actions||[]}}))}),this.ipcService.on("migration-status",e=>{this.isLoadingMigration.set(!1),e.error||this.migrationStatus.set({currentVersion:e.current_version||0,latestVersion:e.latest_version||0,appliedCount:e.applied_count||0,pendingCount:e.pending_count||0,appliedMigrations:e.applied_migrations||[],pendingMigrations:e.pending_migrations||[]})}),this.ipcService.on("migration-completed",e=>{this.isRunningMigration.set(!1),e.error?this.toastService.error(`\u9077\u79FB\u5931\u6557: ${e.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u9077\u79FB\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("rollback-completed",e=>{this.isRunningMigration.set(!1),e.error?this.toastService.error(`\u56DE\u6EFE\u5931\u6557: ${e.error}`):(this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u56DE\u6EFE\u5B8C\u6210"),this.loadMigrationStatus())}),this.ipcService.on("scheduler-status",e=>{e.success!==!1&&this.schedulerStatus.set({isRunning:e.is_running||!1,tasks:e.tasks||[]})}),this.ipcService.on("scheduler-started",e=>{e.success&&(this.toastService.success("\u2705 \u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-stopped",e=>{e.success&&(this.toastService.info("\u8ABF\u5EA6\u5668\u5DF2\u505C\u6B62"),this.loadSchedulerStatus())}),this.ipcService.on("scheduler-task-result",e=>{e.success?this.toastService.success(`\u2705 \u4EFB\u52D9 ${e.taskName} \u57F7\u884C\u5B8C\u6210`):this.toastService.error(`\u4EFB\u52D9\u57F7\u884C\u5931\u6557: ${e.error}`),this.loadSchedulerStatus()}),this.ipcService.on("log-files",e=>{this.isLoadingLogs.set(!1),e.files&&this.logFiles.set(e.files.map(t=>({name:t.name,size:t.size,sizeFormatted:this.formatFileSize(t.size),modifiedAt:t.modified_at,isCompressed:t.name.endsWith(".gz")})))}),this.ipcService.on("log-stats",e=>{e.error||this.logStats.set({totalFiles:e.total_files||0,totalSize:e.total_size||0,totalSizeFormatted:this.formatFileSize(e.total_size||0),compressedFiles:e.compressed_files||0,oldestFile:e.oldest_file,newestFile:e.newest_file})}),this.ipcService.on("logs-rotated",e=>{this.isRotatingLogs.set(!1),e.success?(this.toastService.success(`\u2705 \u65E5\u8A8C\u8F2A\u8F49\u5B8C\u6210\uFF0C\u8F2A\u8F49\u4E86 ${e.rotated_count||0} \u500B\u6587\u4EF6`),this.loadLogFiles(),this.loadLogStats()):this.toastService.error(`\u65E5\u8A8C\u8F2A\u8F49\u5931\u6557: ${e.error}`)}),this.ipcService.on("log-file-content",e=>{e.content&&this.logFileContent.set(e.content)}),this.ipcService.on("log-file-deleted",e=>{e.success&&(this.toastService.success("\u2705 \u65E5\u8A8C\u6587\u4EF6\u5DF2\u522A\u9664"),this.loadLogFiles(),this.loadLogStats())}),this.ipcService.on("resources-batch-updated",e=>{e.success&&(this.toastService.success(`\u2705 \u5DF2\u66F4\u65B0 ${e.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-batch-deleted",e=>{e.success&&(this.toastService.success(`\u2705 \u5DF2\u522A\u9664 ${e.count||0} \u500B\u8CC7\u6E90`),this.loadResources())}),this.ipcService.on("resources-cleared",e=>{e.success?(this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u6E05\u7A7A\u6240\u6709\u8CC7\u6E90\uFF0C\u5171 ${e.deletedCount||0} \u689D`),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7A7A\u5931\u6557: ${e.error}`)}),this.ipcService.on("clear-resources-complete",e=>{e.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF0C\u5DF2\u522A\u9664 ${e.deleted_count||0} \u689D\u8A18\u9304`),this.discoveredResources.set([]),this.refreshResourceStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("users-with-profiles",e=>{console.log("[Frontend] Received users-with-profiles:",e.users?.length||0),e.error||this.usersWithProfiles.set(e)}),this.ipcService.on("one-click-start-progress",e=>{console.log("[Frontend] One-click progress:",e),this.oneClickProgress.set(e.progress),this.oneClickMessage.set(e.message)}),this.ipcService.on("group-join-progress",e=>{let t=`\u{1F465} \u6B63\u5728\u6AA2\u67E5\u7FA4\u7D44 ${e.current}/${e.total}...`;this.oneClickMessage.set(t);let n=42+e.current/e.total*6;this.oneClickProgress.set(Math.round(n))}),this.ipcService.on("group-join-complete",e=>{console.log("[Frontend] Group join complete:",e);let t=e.skipped_cached?` (${e.skipped_cached} \u500B\u7DE9\u5B58\u547D\u4E2D)`:"";this.oneClickMessage.set(`\u2705 \u7FA4\u7D44\u52A0\u5165\u5B8C\u6210: ${e.success_count}/${e.total} \u6210\u529F${t}`)}),this.ipcService.on("one-click-start-result",e=>{console.log("[Frontend] One-click result:",e),this.oneClickStarting.set(!1),this.oneClickStartReport.set(e),this.showStartReport.set(!0),e.overall_success?this.toastService.success("\u{1F389} \u4E00\u9375\u555F\u52D5\u6210\u529F\uFF01\u7CFB\u7D71\u5DF2\u5C31\u7DD2",5e3):this.toastService.warning("\u26A0\uFE0F \u90E8\u5206\u529F\u80FD\u555F\u52D5\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u65E5\u8A8C",5e3),this.loadSystemStatus()}),this.ipcService.on("one-click-stop-result",e=>{console.log("[Frontend] One-click stop result:",e),e.success&&this.toastService.info("\u{1F6D1} \u6240\u6709\u670D\u52D9\u5DF2\u505C\u6B62",3e3),this.loadSystemStatus()}),this.ipcService.on("system-status",e=>{console.log("[Frontend] System status:",e),e.error||this.systemStatus.set(e)}),this.ipcService.on("trigger-rules-result",e=>{e.success&&setTimeout(()=>this.loadSystemStatus(),100)}),this.ipcService.on("ai-settings-updated",e=>{console.log("[Frontend] AI settings updated:",e),e.auto_chat_enabled!==void 0&&this.aiAutoChatEnabled.set(e.auto_chat_enabled),e.auto_chat_mode&&this.aiAutoChatMode.set(e.auto_chat_mode)}),this.ipcService.on("bulk-update-complete",e=>{console.log("[Frontend] Bulk update complete:",e),e.success?(this.toastService.success(`\u5DF2\u66F4\u65B0 ${e.count} \u500B\u7528\u6236`),this.selectedUserIds.set([]),this.loadUsersWithProfiles(),this.loadFunnelStats()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("settings-updated",e=>{e&&(this.spintaxEnabled.set(e.spintaxEnabled??!0),this.autoReplyEnabled.set(e.autoReplyEnabled??!1),this.autoReplyMessage.set(e.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.smartSendingEnabled??!0))}),this.ipcService.on("queue-status",e=>{if(typeof e=="object"&&"phone"in e){let f=e;this.queueStatuses.update(h=>B(F({},h),{[f.phone]:f}))}else{let f=e;this.queueStatuses.set(f)}let t=Object.values(this.queueStatuses()),n=t.reduce((f,h)=>f+(h.pending||0),0),o=t.reduce((f,h)=>f+(h.processing||0),0),a=t.reduce((f,h)=>f+(h.stats?.completed||0),0),d=t.reduce((f,h)=>f+(h.failed||0),0),m=a+d;this.queueStats.set({pending:n,sending:o,sent:a,failed:d,retrying:t.reduce((f,h)=>f+(h.retrying||0),0),totalToday:m,successRate:m>0?a/m:0,avgSendTime:t.reduce((f,h)=>f+(h.stats?.avg_time||0),0)/(t.length||1)})}),this.ipcService.on("queue-messages",e=>{this.queueMessages.set(e.messages)}),this.ipcService.on("sending-stats",e=>{let t={labels:e.stats.map(n=>n.date),datasets:[{label:"\u6210\u529F\u53D1\u9001",data:e.stats.map(n=>n.successful||0),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5931\u8D25",data:e.stats.map(n=>n.failed||0),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0}]};this.sendingStatsData.set(t)}),this.ipcService.on("queue-length-history",e=>{let t={labels:e.history.map(n=>n.date),datasets:[{label:"\u961F\u5217\u957F\u5EA6",data:e.history.map(n=>n.queue_length||0),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]};this.queueLengthHistoryData.set(t)}),this.ipcService.on("account-sending-comparison",e=>{let t={labels:e.comparison.map(n=>n.phone),datasets:[{label:"\u603B\u53D1\u9001",data:e.comparison.map(n=>n.total_sent||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u6210\u529F",data:e.comparison.map(n=>n.successful||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5931\u8D25",data:e.comparison.map(n=>n.failed||0),backgroundColor:"rgba(239, 68, 68, 0.8)"}]};this.accountComparisonData.set(t)}),this.ipcService.on("campaign-performance-stats",e=>{let t={labels:e.stats.map(n=>n.campaign_name||"Unknown"),datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:e.stats.map(n=>n.leads_captured||0),backgroundColor:"rgba(59, 130, 246, 0.8)"},{label:"\u5DF2\u8054\u7CFB",data:e.stats.map(n=>n.leads_contacted||0),backgroundColor:"rgba(34, 197, 94, 0.8)"},{label:"\u5DF2\u56DE\u590D",data:e.stats.map(n=>n.leads_replied||0),backgroundColor:"rgba(168, 85, 247, 0.8)"}]};this.campaignPerformanceData.set(t)}),this.ipcService.on("ai-greeting-suggestion",e=>{console.log("[AI] Received greeting suggestion:",e),this.aiGreetingSuggestion.set(e),this.showAiGreetingDialog.set(!0),this.toastService.info(`\u{1F916} AI \u5DF2\u70BA @${e.username||e.firstName} \u751F\u6210\u554F\u5019\u5EFA\u8B70`,5e3)}),this.ipcService.on("alert-triggered",e=>{e.timestamp=new Date(e.timestamp).toISOString(),this.alerts.update(t=>t.some(o=>o.alert_type===e.alert_type&&o.message===e.message&&Math.abs(new Date(o.timestamp).getTime()-new Date(e.timestamp).getTime())<6e4)?t:[e,...t].slice(0,100)),this.showBrowserNotification(e),this.showNotification(`\u544A\u8B66: ${e.level.toUpperCase()}`,e.message,{requireInteraction:e.level==="critical"})}),this.ipcService.on("alert-rules-loaded",e=>{e.success&&e.rules&&this.alertRules.set(e.rules)}),this.ipcService.on("alert-rule-updated",e=>{e.success?(this.toastService.success("\u544A\u8B66\u89C4\u5219\u5DF2\u66F4\u65B0"),this.loadAlertRules()):this.toastService.error(e.error||"\u66F4\u65B0\u5931\u8D25")}),this.ipcService.on("alert-history-loaded",e=>{e.success&&e.history&&this.alertHistory.set(e.history)}),this.ipcService.on("alerts-loaded",e=>{this.alerts.set(e.alerts)}),this.ipcService.on("rag-initialized",e=>{this.isInitializingRag.set(!1),e.success?(this.ragSystemInitialized.set(!0),this.toastService.success("\u2705 RAG \u7CFB\u7D71\u521D\u59CB\u5316\u5B8C\u6210"),this.refreshRagStats()):this.toastService.error(`RAG \u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-stats",e=>{if(e.success&&e.rag){let t=e.rag,n=t.by_type||{},o=0,a=0;for(let d of Object.keys(n))(d.toLowerCase().includes("qa")||d.toLowerCase().includes("\u554F\u7B54"))&&(o+=n[d].count||0),(d.toLowerCase().includes("script")||d.toLowerCase().includes("\u8A71\u8853"))&&(a+=n[d].count||0);this.ragStats.set({total_knowledge:t.total_knowledge||0,qa_count:o,scripts_count:a,total_uses:t.total_uses||0,avg_score:t.avg_score||0,chromadb_enabled:t.chromadb_enabled||!1,neural_embedding:t.neural_embedding||!1,by_type:n}),t.total_knowledge>0&&this.ragSystemInitialized.set(!0)}}),this.ipcService.on("rag-search-result",e=>{this.isSearchingRag.set(!1),e.success&&e.results?this.ragSearchResults.set(e.results):e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-learning-triggered",e=>{this.isRagLearning.set(!1),e.success?(this.toastService.success(`\u{1F393} \u5B78\u7FD2\u5B8C\u6210\uFF01\u8655\u7406 ${e.conversationsProcessed||0} \u500B\u5C0D\u8A71\uFF0C\u63D0\u53D6 ${e.knowledgeExtracted||0} \u689D\u77E5\u8B58`),this.refreshRagStats()):this.toastService.error(`\u5B78\u7FD2\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-reindex-complete",e=>{this.isReindexing.set(!1),e.success?(this.toastService.success(`\u{1F504} \u91CD\u65B0\u7D22\u5F15\u5B8C\u6210\uFF01\u8655\u7406 ${e.conversations_processed||0} \u500B\u5C0D\u8A71`),this.refreshRagStats()):this.toastService.error(`\u91CD\u65B0\u7D22\u5F15\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-cleanup-complete",e=>{this.isCleaningRag.set(!1),e.success?(this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664 ${e.deleted||0} \u689D\uFF0C\u5408\u4F75 ${e.merged||0} \u689D`),this.refreshRagStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-knowledge-added",e=>{e.success?(this.toastService.success("\u2705 \u77E5\u8B58\u5DF2\u6DFB\u52A0"),this.refreshRagStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("rag-feedback-recorded",e=>{e.success||this.toastService.error(`\u53CD\u994B\u8A18\u9304\u5931\u6557: ${e.error}`)}),this.ipcService.on("memories-searched",e=>{this.isSearchingMemory.set(!1),e.success&&e.memories?this.vectorMemorySearchResults.set(e.memories.map(t=>({id:t.id,userId:t.user_id,content:t.content,memoryType:t.memory_type,importance:t.importance,similarity:t.similarity||0,createdAt:t.created_at}))):e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("memory-added",e=>{this.isAddingMemory.set(!1),e.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u6DFB\u52A0"),this.newMemory={userId:"",content:"",type:"conversation",importance:.5},this.showAddMemoryDialog.set(!1),this.refreshMemoryStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("memory-stats",e=>{e.success&&this.vectorMemoryStats.set({totalMemories:e.totalMemories||0,byType:e.byType||{},totalUsers:e.totalUsers||0,avgImportance:e.avgImportance||0})}),this.ipcService.on("memory-user-list",e=>{e.success&&e.users&&this.memoryUserList.set(e.users)}),this.ipcService.on("memory-deleted",e=>{e.success?(this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u522A\u9664"),this.vectorMemorySearchResults.update(t=>t.filter(n=>n.id!==e.memoryId)),this.refreshMemoryStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("memories-merged",e=>{e.success?(this.toastService.success(`\u2705 \u5408\u4F75\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${e.mergedCount||0} \u689D\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u5408\u4F75\u5931\u6557: ${e.error}`)}),this.ipcService.on("old-memories-cleaned",e=>{e.success?(this.toastService.success(`\u2705 \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664\u4E86 ${e.deletedCount||0} \u689D\u820A\u8A18\u61B6`),this.refreshMemoryStats()):this.toastService.error(`\u6E05\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("batch-operation-result",e=>{this.handleBatchOperationResult(e)}),this.ipcService.on("batch-operation-progress",e=>{this.handleBatchOperationProgress(e)}),this.ipcService.on("batch-undo-result",e=>{this.handleBatchUndoResult(e)}),this.ipcService.on("batch-operation-history",e=>{this.handleBatchOperationHistory(e)}),this.ipcService.on("all-tags",e=>{this.handleAllTags(e)}),this.ipcService.on("tag-created",e=>{this.handleTagCreated(e)}),this.ipcService.on("tag-deleted",e=>{this.handleTagDeleted(e)}),this.ipcService.on("ad-templates",e=>{this.handleAdTemplates(e)}),this.ipcService.on("ad-schedules",e=>{this.handleAdSchedules(e)}),this.ipcService.on("ad-send-logs",e=>{this.handleAdSendLogs(e)}),this.ipcService.on("ad-overview-stats",e=>{this.handleAdOverviewStats(e)}),this.ipcService.on("ad-template-created",e=>{this.handleAdTemplateCreated(e)}),this.ipcService.on("ad-template-deleted",e=>{this.handleAdTemplateDeleted(e)}),this.ipcService.on("ad-template-toggled",e=>{e.success&&this.loadAdTemplates()}),this.ipcService.on("ad-schedule-created",e=>{this.handleAdScheduleCreated(e)}),this.ipcService.on("ad-schedule-deleted",e=>{this.handleAdScheduleDeleted(e)}),this.ipcService.on("ad-schedule-toggled",e=>{e.success&&this.loadAdSchedules()}),this.ipcService.on("ad-schedule-run-result",e=>{this.handleAdScheduleRunResult(e)}),this.ipcService.on("spintax-validated",e=>{this.handleSpintaxValidated(e)}),this.ipcService.on("ad-sent",e=>{this.toastService.success(`\u5EE3\u544A\u5DF2\u767C\u9001\u5230 ${e.groupTitle||e.groupId}`)}),this.ipcService.on("ad-send-failed",e=>{this.toastService.error(`\u767C\u9001\u5931\u6557: ${e.error}`)}),this.ipcService.on("broadcast-progress",e=>{this.progressDialog.set({show:!0,title:"\u5EE3\u544A\u767C\u9001\u4E2D...",progress:{current:e.current,total:e.total,message:`\u5DF2\u767C\u9001 ${e.sent}\uFF0C\u5931\u6557 ${e.failed}`},cancellable:!1})}),this.ipcService.on("broadcast-completed",e=>{this.progressDialog.update(t=>B(F({},t),{show:!1})),this.toastService.success(`\u5EE3\u544A\u767C\u9001\u5B8C\u6210: ${e.sent} \u6210\u529F, ${e.failed} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()}),this.ipcService.on("tracked-users",e=>{this.handleTrackedUsers(e)}),this.ipcService.on("user-groups",e=>{this.handleUserGroups(e)}),this.ipcService.on("high-value-groups",e=>{this.handleHighValueGroups(e)}),this.ipcService.on("tracking-stats",e=>{this.handleTrackingStats(e)}),this.ipcService.on("user-added-to-track",e=>{this.handleUserAddedToTrack(e)}),this.ipcService.on("user-added-from-lead",e=>{e.success?this.toastService.success("Lead \u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("user-removed",e=>{this.handleUserRemoved(e)}),this.ipcService.on("user-tracking-started",e=>{this.isTrackingUser.set(!0)}),this.ipcService.on("user-tracking-completed",e=>{this.handleUserTrackingCompleted(e)}),this.ipcService.on("user-tracking-failed",e=>{this.handleUserTrackingFailed(e)}),this.ipcService.on("user-value-updated",e=>{e.success&&this.loadTrackedUsers()}),this.ipcService.on("batch-tracking-progress",e=>{this.progressDialog.set({show:!0,title:"\u6279\u91CF\u8FFD\u8E64\u4E2D...",progress:{current:e.current,total:e.total,message:`\u6B63\u5728\u8FFD\u8E64\u7528\u6236 ${e.userId}`},cancellable:!1})}),this.ipcService.on("batch-tracking-completed",e=>{this.progressDialog.update(t=>B(F({},t),{show:!1})),this.toastService.success(`\u6279\u91CF\u8FFD\u8E64\u5B8C\u6210: ${e.completed} \u6210\u529F, ${e.failed} \u5931\u6557`),this.loadTrackedUsers(),this.loadTrackingStats()}),this.ipcService.on("campaigns",e=>{this.handleCampaigns(e)}),this.ipcService.on("campaign-created",e=>{this.handleCampaignCreated(e)}),this.ipcService.on("campaign-deleted",e=>{this.handleCampaignDeleted(e)}),this.ipcService.on("campaign-started",e=>{e.success!==!1&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5"),this.loadCampaigns())}),this.ipcService.on("campaign-paused",e=>{e.success&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u66AB\u505C"),this.loadCampaigns())}),this.ipcService.on("campaign-stopped",e=>{e.success!==!1&&(this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u505C\u6B62"),this.loadCampaigns())}),this.ipcService.on("campaign-completed",e=>{this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u57F7\u884C\u5B8C\u6210"),this.loadCampaigns(),this.loadUnifiedOverview()}),this.ipcService.on("campaign-step-started",e=>{this.progressDialog.set({show:!0,title:"\u57F7\u884C\u71DF\u92B7\u6D3B\u52D5...",progress:{current:0,total:0,message:`\u57F7\u884C\u6B65\u9A5F: ${e.actionType}`},cancellable:!1})}),this.ipcService.on("campaign-step-completed",e=>{this.progressDialog.update(t=>B(F({},t),{show:!1}))}),this.ipcService.on("unified-overview",e=>{this.handleUnifiedOverview(e)}),this.ipcService.on("funnel-analysis",e=>{this.handleFunnelAnalysis(e)}),this.ipcService.on("role-templates",e=>{this.handleRoleTemplates(e)}),this.ipcService.on("all-roles",e=>{this.handleAllRoles(e)}),this.ipcService.on("role-assigned",e=>{e.success?(this.toastService.success("\u89D2\u8272\u5DF2\u5206\u914D"),this.loadAllRoles(),this.loadRoleStats()):this.toastService.error(`\u5206\u914D\u5931\u6557: ${e.error}`)}),this.ipcService.on("role-removed",e=>{e.success&&(this.toastService.success("\u89D2\u8272\u5DF2\u79FB\u9664"),this.loadAllRoles(),this.loadRoleStats())}),this.ipcService.on("role-stats",e=>{this.handleRoleStats(e)}),this.ipcService.on("script-templates",e=>{this.handleScriptTemplates(e)}),this.ipcService.on("collab-groups",e=>{this.handleCollabGroups(e)}),this.ipcService.on("collab-stats",e=>{this.handleCollabStats(e)}),this.ipcService.on("collab-group-created",e=>{e.success!==!1&&(this.toastService.success("\u5354\u4F5C\u7FA4\u7D44\u5DF2\u5275\u5EFA"),this.loadCollabGroups())}),this.ipcService.on("resource-discovery-initialized",e=>{if(e.success){if(this.resourceDiscoveryInitialized.set(!0),this.toastService.success("\u2705 \u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71\u5DF2\u521D\u59CB\u5316"),this.refreshResourceStats(),this.loadDiscoveryKeywords(),this.pendingSearchQuery){let t=this.pendingSearchQuery;this.pendingSearchQuery="",this.toastService.info(`\u6B63\u5728\u641C\u7D22 "${t}"...`),setTimeout(()=>this.searchResources(),500)}}else this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-results-direct",e=>{if(this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),e.success&&e.results){let t=e.results,n=e.query?.toLowerCase()||"",o=t.sort((m,f)=>{let h=(m.title||"").toLowerCase(),C=(f.title||"").toLowerCase(),y=h.includes(n)?1:0,E=C.includes(n)?1:0;return y!==E?E-y:(f.overall_score||0)-(m.overall_score||0)}),a=new Set,d=o.filter(m=>a.has(m.telegram_id)?!1:(a.add(m.telegram_id),!0));if(this.discoveredResources.set(d),this.currentSearchKeyword.set(n),d.length>0){let m=this.generateSearchCacheKey(e.query||"",this.selectedSearchSources());this.setSearchCache(m,d)}d.length===0?console.log(`[Search] \u672A\u627E\u5230\u8207\u300C${e.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`):console.log(`[Search] \u627E\u5230 ${d.length} \u500B\u8207\u300C${e.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`)}else e.error&&this.toastService.error(`\u641C\u7D22\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-resources-complete",e=>{this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.isSearchingResources.set(!1),e.success?(e.found===0?console.log("[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C"):console.log(`[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u627E\u5230 ${e.found} \u4E2A`),this.refreshResourceStats()):this.toastService.error(`\u641C\u7D22\u5931\u8D25: ${e.error}`)}),this.ipcService.on("search-jiso-complete",e=>{if(e.success&&e.results){let n=e.results.length;if(n===0)console.log("[Search] \u6781\u641C\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C");else{let o=e.cached?"\uFF08\u7F13\u5B58\uFF09":"",a=e.bot?`\uFF08\u4F86\u81EA @${e.bot}\uFF09`:"";console.log(`[Search] \u6781\u641C\u5B8C\u6210${o}\uFF1A\u627E\u5230 ${n} \u4E2A\u7FA4\u7EC4${a}`);let d=this.discoveredResources(),m=new Set(d.map(h=>h.telegram_id||h.username)),f=e.results.filter(h=>!m.has(h.telegram_id)&&!m.has(h.username)).map(h=>{let C=h.username||"";C&&C.toLowerCase().endsWith("bot")&&(C="");let y=h.link||"";return y&&/t\.me\/[^/]+\/\d+/.test(y)&&(y=""),{id:0,telegram_id:h.telegram_id&&/^-?\d+$/.test(String(h.telegram_id))?String(h.telegram_id):"",username:C,title:h.title||"",description:h.description||"",member_count:h.member_count||0,resource_type:h.chat_type||h.resource_type||"group",activity_score:.5,relevance_score:.6,overall_score:.6,status:"discovered",discovery_source:"jiso",discovery_keyword:this.currentSearchKeyword(),created_at:new Date().toISOString(),invite_link:y,link:y||(C?`https://t.me/${C}`:""),is_saved:!1,can_join:!!(y||C)}});if(f.length>0){let h=[...d,...f];this.discoveredResources.set(h),console.log(`[Search] \u5DF2\u5408\u4F75 ${f.length} \u500B\u65B0\u7D50\u679C`);let C=this.currentSearchKeyword();if(C&&h.length>0){let y=this.generateSearchCacheKey(C,this.selectedSearchSources());this.setSearchCache(y,h)}}}this.refreshResourceStats()}else if(e.error){let n=e.error,o=[],a="";n.includes("Username not found")||n.includes("\u4E0D\u53EF\u7528")?(o=["\u641C\u7D22\u6A5F\u5668\u4EBA\u9996\u6B21\u4F7F\u7528\u9700\u8981\u6FC0\u6D3B","\u8ACB\u5728 Telegram \u4E2D\u6253\u958B @smss \u4E26\u767C\u9001 /start","\u6216\u8005\u6253\u958B @jisou3 \u4E26\u767C\u9001 /start","\u6FC0\u6D3B\u5F8C\u91CD\u65B0\u641C\u7D22"],a="\u641C\u7D22\u6A5F\u5668\u4EBA\u5C1A\u672A\u6FC0\u6D3B"):n.includes("FloodWait")||n.includes("\u9650\u5236")?(o=["\u7B49\u5F85\u5E7E\u5206\u9418\u5F8C\u91CD\u8A66","\u6E1B\u5C11\u641C\u7D22\u983B\u7387","\u4F7F\u7528\u5176\u4ED6\u5E33\u865F\u641C\u7D22"],a="Telegram \u8ACB\u6C42\u983B\u7387\u9650\u5236"):n.includes("\u6CA1\u6709\u53EF\u7528")?(o=["\u6AA2\u67E5\u5E33\u865F\u662F\u5426\u5DF2\u767B\u9304","\u78BA\u4FDD\u81F3\u5C11\u6709\u4E00\u500B\u5E33\u865F\u5728\u7DDA"],a="\u6C92\u6709\u53EF\u7528\u5E33\u865F"):o=["\u91CD\u8A66\u641C\u7D22","\u4F7F\u7528\u4E0D\u540C\u95DC\u9375\u8A5E"],this.searchError.set({hasError:!0,message:n,details:a,suggestions:o}),this.toastService.error(`\u6781\u641C\u5931\u6557: ${a||n}`)}let t=this.selectedSearchSources();t.length===1&&t[0]==="jiso"&&(this.isSearchingResources.set(!1),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null))}),this.ipcService.on("jiso-search-progress",e=>{e.status==="searching"?console.log(`[Search] \u6781\u641C\uFF1A${e.message}`):e.status==="waiting"&&console.log(`[Search] \u6781\u641C\u7B49\u5F85\uFF1A${e.message}`)}),this.ipcService.on("search-channels-list",e=>{e.success&&(this.systemChannels.set(e.system_channels||[]),this.customChannels.set(e.custom_channels||[]))}),this.ipcService.on("search-channel-added",e=>{e.success?(this.toastService.success(`\u2705 \u5DF2\u6DFB\u52A0\u6E20\u9053 @${e.botUsername}`),this.showAddChannelDialog.set(!1),this.loadSearchChannels()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-updated",e=>{e.success?(this.toastService.success("\u2705 \u6E20\u9053\u5DF2\u66F4\u65B0"),this.loadSearchChannels()):this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-deleted",e=>{e.success?(this.toastService.success("\u{1F5D1}\uFE0F \u6E20\u9053\u5DF2\u522A\u9664"),this.loadSearchChannels()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("search-channel-tested",e=>{this.isTestingChannel.set(!1),e.success?(this.toastService.success(`\u2705 @${e.botUsername} \u6E2C\u8A66\u6210\u529F (${e.responseTime?.toFixed(1)}s)`),this.loadSearchChannels()):(this.toastService.warning(`\u274C @${e.botUsername} \u6E2C\u8A66\u5931\u6557: ${e.error}`),this.loadSearchChannels())}),this.ipcService.on("resources-list",e=>{if(this.isInSearchResultMode()){console.log("[\u8CC7\u6E90\u4E2D\u5FC3] \u5FFD\u7565 resources-list\uFF0C\u7576\u524D\u8655\u65BC\u641C\u7D22\u7D50\u679C\u6A21\u5F0F");return}if(e.success&&e.resources){this.discoveredResources.set(e.resources);let t=e.resources.filter(n=>!n.type_verified&&n.username);if(t.length>0){let o=t.slice(0,10).map(a=>a.id);this.ipcService.send("batch-verify-resource-types",{resourceIds:o})}}}),this.ipcService.on("resource-stats",e=>{e.success&&(this.resourceStats.set({total_resources:e.total_resources||0,by_status:e.by_status||{},by_type:e.by_type||{},today_discovered:e.today_discovered||0,pending_joins:e.pending_joins||0,joined_count:e.joined_count||0,avg_score:e.avg_score||0}),e.total_resources&&e.total_resources>0&&this.resourceDiscoveryInitialized.set(!0))}),this.ipcService.on("resource-added",e=>{e.success?(this.toastService.success("\u2705 \u8CC7\u6E90\u5DF2\u6DFB\u52A0"),this.showAddResourceDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("resource-type-verified",e=>{e.success?(e.oldType!==e.newType?this.toastService.success(`\u2705 \u985E\u578B\u5DF2\u66F4\u65B0: ${e.oldType} \u2192 ${e.newType}`):this.toastService.info(`\u{1F4CB} \u985E\u578B\u78BA\u8A8D: ${e.newType}`),this.loadResources()):this.toastService.error(`\u9A57\u8B49\u5931\u6557: ${e.error}`)}),this.ipcService.on("resources-types-verified",e=>{e.success&&e.count&&e.count>0&&this.loadResources()}),this.ipcService.on("resource-deleted",e=>{e.success?(this.toastService.success("\u{1F5D1}\uFE0F \u8CC7\u6E90\u5DF2\u522A\u9664"),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u522A\u9664\u5931\u6557: ${e.error}`)}),this.ipcService.on("leave-group-complete",e=>{e.success?(this.toastService.success("\u{1F6AA} \u5DF2\u9000\u51FA\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):this.toastService.error(`\u9000\u51FA\u7FA4\u7D44\u5931\u6557: ${e.error}`)}),this.ipcService.on("remove-group-result",e=>{e.success?(this.toastService.success("\u2705 \u5DF2\u505C\u6B62\u76E3\u63A7\u7FA4\u7D44"),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")):(this.toastService.error(`\u505C\u6B62\u76E3\u63A7\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`),this.loadResources())}),this.ipcService.on("join-queue-updated",e=>{e.success?(this.toastService.success(`\u{1F4CB} \u5DF2\u6DFB\u52A0 ${e.added} \u500B\u8CC7\u6E90\u5230\u52A0\u5165\u968A\u5217`),this.refreshResourceStats(),this.selectedResourceIds.set([])):this.toastService.error(`\u6DFB\u52A0\u5230\u968A\u5217\u5931\u6557: ${e.error}`)}),this.ipcService.on("join-queue-processed",e=>{this.isProcessingJoinQueue.set(!1),e.success?(this.toastService.success(`\u{1F680} \u8655\u7406\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}`),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u8655\u7406\u5931\u6557: ${e.error}`)}),this.ipcService.on("batch-join-started",e=>{e.success&&this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${e.count} \u500B\u8CC7\u6E90`)}),this.ipcService.on("batch-join-complete",e=>{e.success&&(this.toastService.success(`\u2705 \u6279\u91CF\u52A0\u5165\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}\uFF0C\u8DF3\u904E ${e.skipped}`),this.loadResources(),this.refreshResourceStats())}),this.ipcService.on("join-and-monitor-complete",e=>{this.isJoiningResource.set(!1),e.success?(this.toastService.success("\u2705 \u5DF2\u52A0\u5165\u4E26\u6DFB\u52A0\u5230\u76E3\u63A7"),this.showJoinMonitorDialog.set(!1),this.loadResources(),this.refreshResourceStats()):this.toastService.error(`\u52A0\u5165\u5931\u6557: ${e.error}`)}),this.ipcService.on("join-and-monitor-with-account-complete",e=>{if(this.isJoiningResource.set(!1),e.success){let t=this.joinMonitorSelectedKeywordSetIds().length,n=this.joinMonitorResource(),o=e.status==="pending_approval"?"pending_approval":"joined";this.updateResourceStatusLocally(n,o,e.phone,e.memberCount),e.status==="pending_approval"?(this.toastService.info(`\u{1F4E8} \u52A0\u5165\u8ACB\u6C42\u5DF2\u767C\u9001\uFF0C\u7B49\u5F85\u7BA1\u7406\u54E1\u6279\u51C6
\u5E33\u865F: ${e.phone}`,5e3),this.showJoinMonitorDialog.set(!1)):this.showPostJoinOptions(n,e.phone,t),this.loadResources(),this.refreshResourceStats(),this.ipcService.send("get-monitored-groups")}else{let t=e.error||"\u672A\u77E5\u932F\u8AA4";t.includes("\u7F3A\u5C11\u52A0\u5165\u65B9\u5F0F")||t.includes("username")?this.toastService.error(`\u274C \u7121\u6CD5\u52A0\u5165\uFF1A\u6B64\u7FA4\u7D44\u6C92\u6709\u63D0\u4F9B\u6709\u6548\u7684\u52A0\u5165\u93C8\u63A5
\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5`,6e3):this.toastService.error(`\u274C \u52A0\u5165\u5931\u6557: ${t}`,5e3)}}),this.ipcService.on("batch-join-and-monitor-complete",e=>{if(this.isJoiningResource.set(!1),this.closeBatchJoinMonitorDialog(),e.success){let t=this.joinMonitorSelectedKeywordSetIds().length,n=t>0?`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}\uFF0C\u5DF2\u7D81\u5B9A ${t} \u500B\u95DC\u9375\u8A5E\u96C6`:`\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${e.successCount}\uFF0C\u5931\u6557 ${e.failed}`;this.toastService.success(n),this.loadResources(),this.refreshResourceStats(),this.selectedResourceIds.set([]),this.ipcService.send("get-monitored-groups")}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${e.error}`)}),this.ipcService.on("members-extraction-progress",e=>{this.memberListProgress.set({extracted:e.extracted,total:e.total,status:e.status})}),this.ipcService.on("members-extracted",e=>{if(this.memberListLoading.set(!1),e.success&&e.members){let t=new Set(this.memberListData().map(o=>o.user_id)),n=e.members.filter(o=>!t.has(o.user_id));this.memberListData.update(o=>[...o,...n]),this.memberListProgress.update(o=>B(F({},o),{extracted:this.memberListData().length,status:`\u5DF2\u63D0\u53D6 ${this.memberListData().length} \u500B\u6210\u54E1`})),n.length>0?this.calculateAndShowExtractionSummary(n):this.toastService.info("\u6C92\u6709\u66F4\u591A\u65B0\u6210\u54E1")}else e.error&&this.handleMemberExtractionError(e)}),this.ipcService.on("batch-members-extracted",e=>{e.success?this.toastService.success(`\u2705 \u6279\u91CF\u63D0\u53D6\u5B8C\u6210\uFF1A${e.totalGroups} \u500B\u7FA4\u7D44\uFF0C\u5171 ${e.totalMembers} \u500B\u6210\u54E1`):this.toastService.error(`\u6279\u91CF\u63D0\u53D6\u5931\u6557: ${e.error}`)}),this.ipcService.on("group-message-sent",e=>{e.success?this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001\u5230\u7FA4\u7D44"):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("message-queued",e=>{console.log("[Frontend] Message queued:",e),this.toastService.info("\u{1F4E4} \u6D88\u606F\u5DF2\u52A0\u5165\u767C\u9001\u968A\u5217")}),this.ipcService.on("message-sent",e=>{console.log("[Frontend] Message sent result:",e),e.success?(this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001"),this.closeLeadDetailModal(),this.ipcService.send("get-leads",{})):this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}),this.ipcService.on("link-analysis-complete",e=>{this.isAnalyzingLink.set(!1),e.success?e.isPrivate?this.toastService.warning(e.message||"\u9019\u662F\u79C1\u6709\u93C8\u63A5"):(this.toastService.success("\u2705 \u5206\u6790\u5B8C\u6210"),console.log("Link analysis result:",e)):this.toastService.error(`\u5206\u6790\u5931\u6557: ${e.error}`)}),this.ipcService.on("ollama-models",e=>{e.success&&e.models?(this.availableOllamaModels.set(e.models),this.toastService.success(`\u627E\u5230 ${e.models.length} \u500B\u6A21\u578B`)):e.error&&this.toastService.error(`\u7372\u53D6\u6A21\u578B\u5217\u8868\u5931\u6557: ${e.error}`)}),this.ipcService.on("local-ai-test-result",e=>{this.isTestingLocalAi.set(!1),e.success?(this.localAiStatus.set("success"),this.aiConnectionStatus.set("success"),this.toastService.success(e.message||"\u9023\u63A5\u6210\u529F")):(this.localAiStatus.set("error"),this.localAiError.set(e.error||"\u9023\u63A5\u5931\u6557"),this.toastService.error(e.error||"\u9023\u63A5\u5931\u6557"))}),this.ipcService.on("first-run-status",e=>{this.isFirstRun.set(e.isFirstRun),e.isFirstRun&&(console.log("[App] \u9996\u6B21\u904B\u884C\uFF0C\u5F8C\u53F0\u975C\u9ED8\u914D\u7F6E AI\uFF08\u4E0D\u5F37\u5236\u986F\u793A\u5411\u5C0E\uFF09"),setTimeout(()=>this.detectOllama(),1e3))}),this.ipcService.on("backend-status",e=>{console.log("[App] Backend status:",e),this.backendRunning.set(e.running),!e.running&&e.error&&(this.backendError.set(e.error),this.showBackendErrorDialog.set(!0),this.toastService.error("\u274C Python \u5F8C\u7AEF\u672A\u904B\u884C\uFF0C\u90E8\u5206\u529F\u80FD\u7121\u6CD5\u4F7F\u7528"))}),this.ipcService.on("ollama-detected",e=>{if(this.isDetectingOllama.set(!1),e.success&&(this.ollamaDetected.set(e.available||!1),e.models&&e.models.length>0)){this.detectedOllamaModels.set(e.models);let n=["qwen2:7b","qwen:7b","llama3:8b","mistral:7b"].find(o=>e.models.some(a=>a.includes(o.split(":")[0])))||e.models[0];this.autoSelectedModel.set(n),this.localAiModel.set(n)}}),this.ipcService.on("first-run-settings-saved",e=>{e.success?console.log("[App] \u9996\u6B21\u8A2D\u7F6E\u5DF2\u4FDD\u5B58"):console.error("[App] \u9996\u6B21\u8A2D\u7F6E\u4FDD\u5B58\u5931\u6557:",e.error)}),this.ipcService.on("discovery-keywords",e=>{e.success&&e.keywords&&this.discoveryKeywords.set(e.keywords)}),this.ipcService.on("discovery-keyword-added",e=>{e.success?(this.toastService.success(`\u2795 \u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0: ${e.keyword}`),this.showAddKeywordDialog.set(!1),this.newResourceKeyword="",this.loadDiscoveryKeywords()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-watcher-initialized",e=>{e.success?(this.discussionWatcherInitialized.set(!0),this.toastService.success("\u2705 \u8A0E\u8AD6\u7D44\u76E3\u63A7\u670D\u52D9\u5DF2\u521D\u59CB\u5316"),this.loadChannelDiscussions(),this.refreshDiscussionStats()):this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-discovered",e=>{e.success&&e.discussion?(this.toastService.success(`\u2705 \u767C\u73FE\u8A0E\u8AD6\u7D44: ${e.discussion.discussion_title}`),this.loadChannelDiscussions()):this.toastService.error(e.error||"\u672A\u627E\u5230\u8A0E\u8AD6\u7D44")}),this.ipcService.on("discussions-batch-discovered",e=>{e.success?(this.toastService.success(`\u2705 \u767C\u73FE\u4E86 ${e.count} \u500B\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u767C\u73FE\u5931\u6557: ${e.error}`)}),this.ipcService.on("channel-discussions-list",e=>{e.success&&e.discussions&&this.channelDiscussions.set(e.discussions)}),this.ipcService.on("discussion-monitoring-status",e=>{e.success?(this.toastService.success(`${e.status==="monitoring"?"\u{1F7E2} \u958B\u59CB":"\u{1F534} \u505C\u6B62"}\u76E3\u63A7\u8A0E\u8AD6\u7D44`),this.loadChannelDiscussions()):this.toastService.error(`\u64CD\u4F5C\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-messages",e=>{this.isLoadingDiscussionMessages.set(!1),e.success&&e.messages?this.discussionMessages.set(e.messages):(this.toastService.error(e.error||"\u52A0\u8F7D\u6D88\u606F\u5931\u8D25"),this.discussionMessages.set([]))}),this.ipcService.on("discussion-message",e=>{e.is_matched&&this.toastService.info(`\u{1F3AF} \u95DC\u9375\u8A5E\u5339\u914D: @${e.username} - ${e.keywords.join(", ")}`)}),this.ipcService.on("discussion-lead-captured",e=>{this.toastService.success(`\u{1F464} \u65B0\u6F5B\u5728\u5BA2\u6236: @${e.username}`),this.refreshDiscussionStats()}),this.ipcService.on("discussion-reply-result",e=>{e.success?(this.toastService.success("\u2705 \u56DE\u5FA9\u5DF2\u767C\u9001"),this.selectedDiscussionId()&&this.loadDiscussionMessages(this.selectedDiscussionId())):this.toastService.error(`\u56DE\u5FA9\u5931\u6557: ${e.error}`)}),this.ipcService.on("discussion-stats",e=>{e.success&&(this.discussionStats.set({total_discussions:e.total_discussions||0,monitoring_count:e.monitoring_count||0,total_messages:e.total_messages||0,matched_messages:e.matched_messages||0,leads_from_discussions:e.leads_from_discussions||0,today_messages:e.today_messages||0,today_leads:e.today_leads||0}),e.total_discussions>0&&this.discussionWatcherInitialized.set(!0))}),this.ipcService.on("chat-list",e=>{e.success&&e.chats?this.chatList.set(e.chats):console.error("[Frontend] Chat list error:",e.error)}),this.ipcService.on("chat-history-full",e=>{if(console.log("[Frontend] Received chat-history-full event:",e),e.success&&e.messages){let t=this.chatHistoryPage();if(t===0)this.chatHistoryAllMessages.set(e.messages),this.chatHistory.set(e.messages),console.log("[Frontend] Loaded first page:",e.messages.length,"messages");else{let o=[...this.chatHistoryAllMessages(),...e.messages];this.chatHistoryAllMessages.set(o),this.chatHistory.set(o),console.log("[Frontend] Loaded page",t,":",e.messages.length,"messages, total:",o.length)}this.chatHistoryHasMore.set(e.hasMore||!1),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1),console.log("[Frontend] Chat history loaded. Has more:",e.hasMore,"Total:",e.total)}else console.error("[Frontend] Chat history error:",e.error),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}),this.ipcService.on("chat-message-received",e=>{this.selectedChatUserId()===e.userId&&this.loadChatHistory(e.userId),this.loadChatList()}),this.ipcService.on("ai-response-generated",e=>{this.selectedChatUserId()===e.userId&&this.loadChatHistory(e.userId)}),this.ipcService.on("monitoring-status",e=>{e.success&&console.log("[Frontend] Monitoring status:",e)}),this.ipcService.on("monitoring-health",e=>{e.success&&(e.issues&&e.issues.length>0&&console.warn("[Frontend] Monitoring issues:",e.issues),e.warnings&&e.warnings.length>0&&console.warn("[Frontend] Monitoring warnings:",e.warnings))}),this.ipcService.on("alerts-loaded",e=>{let t=e.alerts.map(n=>B(F({},n),{timestamp:new Date(n.timestamp).toISOString(),acknowledged_at:n.acknowledged_at?new Date(n.acknowledged_at).toISOString():void 0,resolved_at:n.resolved_at?new Date(n.resolved_at).toISOString():void 0}));this.alerts.set(t)})}applyInitialState(e){console.log("Received initial state from backend:",e),this.backendConnectionState.set("connected"),this.backendConnectionProgress.set(100),this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F"),this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.accounts.set(e.accounts||[]),this.keywordSets.set(e.keywordSets||[]),this.monitoredGroups.set(e.monitoredGroups||[]),this.campaigns.set(e.campaigns||[]),this.messageTemplates.set(e.messageTemplates||[]),e.isMonitoring!==void 0&&this.isMonitoring.set(e.isMonitoring);let t=(e.leads||[]).map(n=>this.mapLeadFromBackend(n));this.leads.set(t),this.leadsTotal.set(e.leadsTotal??e.leads?.length??0),this.contactsService.importLeadsDirectly(t),this.logs.set((e.logs||[]).map(n=>B(F({},n),{timestamp:new Date(n.timestamp)}))),e.settings&&(this.spintaxEnabled.set(e.settings.spintaxEnabled??!0),this.autoReplyEnabled.set(e.settings.autoReplyEnabled??!1),this.autoReplyMessage.set(e.settings.autoReplyMessage||"Thanks for getting back to me! I'll read your message and respond shortly."),this.smartSendingEnabled.set(e.settings.smartSendingEnabled??!0)),this.offlineCache.cacheState({accounts:e.accounts||[],keywordSets:e.keywordSets||[],monitoredGroups:e.monitoredGroups||[],campaigns:e.campaigns||[],leads:e.leads||[],settings:e.settings||{}})}setLanguage(e){let t={en:"en",zh:"zh-TW"};this.i18n.setLocale(t[e]||"zh-TW")}changeView(e){if(e==="ads"&&!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="multi-role"&&!this.membershipService.hasFeature("multiRole")){this.toastService.warning("\u{1F48E} \u591A\u89D2\u8272\u5354\u4F5C\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="user-tracking"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u7528\u6236\u8FFD\u8E64\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="campaigns"&&!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-team"&&!this.membershipService.hasFeature("autoExecution")){this.toastService.warning("\u{1F48E} AI\u5718\u968A\u92B7\u552E\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="ai-assistant"&&!this.membershipService.hasFeature("strategyPlanning")){this.toastService.warning("\u{1F48E} AI\u7B56\u7565\u898F\u5283\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u6D1E\u5BDF\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="analytics-center"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5206\u6790\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="lead-nurturing"&&!this.membershipService.hasFeature("dataInsightsBasic")){this.toastService.warning("\u{1F947} \u5BA2\u6236\u57F9\u80B2\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}if(e==="nurturing-analytics"&&!this.membershipService.hasFeature("advancedAnalytics")){this.toastService.warning("\u{1F48E} \u57F9\u80B2\u5206\u6790\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.currentView();if(this.navBridge.navigateTo(e),this.currentView.set(e),this.auditTracker.trackViewChange(t,e),e==="resources"){let n=this.leads();n.length>0&&(this.syncLeadsToResourceCenter(n),console.log("[changeView] Synced leads to resource center:",n.length))}this.onMobileNavSelect()}switchDashboardMode(e){if(e==="smart"&&!this.membershipService.hasFeature("smartMode")){this.toastService.warning("\u{1F947} \u667A\u80FD\u6A21\u5F0F\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.dashboardMode.set(e)}handleDashboardNavigation(e){let n={"monitoring-accounts":"monitoring-accounts","monitoring-groups":"monitoring-groups","keyword-sets":"keyword-sets","chat-templates":"chat-templates","trigger-rules":"trigger-rules","collected-users":"collected-users","automation-rules":"trigger-rules",resources:"resources",rules:"trigger-rules","send-settings":"leads",analytics:"analytics"}[e];n&&this.changeView(n)}handleDashboardConfigAction(e){this.handleDashboardNavigation(e)}checkBatchOperationPermission(){return this.membershipService.hasFeature("batchOperations")?!0:(this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),!1)}addAccount(){let e=this.membershipService.canAddAccount(this.accounts().length);if(!e.allowed){this.toastService.warning(e.message||"\u5DF2\u9054\u5230\u8CEC\u6236\u6578\u91CF\u4E0A\u9650"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newAccount();this.validationErrors.set({});let n=[],o=t.phone.trim().replace(/[\s\-\(\)]/g,"");if(o?/^\+\d{1,15}$/.test(o)||n.push("Phone number must be in format +1234567890 (with country code)"):n.push("Phone number is required"),t.apiId&&!/^\d+$/.test(t.apiId.trim())&&n.push("API ID must be a positive integer"),t.apiHash&&!/^[a-fA-F0-9]{32}$/.test(t.apiHash.trim())&&n.push("API Hash must be a 32-character hexadecimal string"),t.proxy&&!/^(socks5|http|https):\/\/([^:]+(:[^@]+)?@)?[^:]+(:\d+)?$/.test(t.proxy.trim())&&n.push("Proxy must be in format: socks5://host:port or http://host:port"),n.length>0){this.validationErrors.set({account:n}),this.toastService.error(`\u9A8C\u8BC1\u5931\u8D25: ${n.join("; ")}`),console.error("Account validation errors:",n);return}let d={phone:t.phone.trim().replace(/[\s\-\(\)]/g,""),apiId:t.apiId.trim(),apiHash:t.apiHash.trim(),proxy:t.proxy.trim()||"",group:t.group.trim()||"",twoFactorPassword:t.twoFactorPassword.trim()||"",role:"Unassigned",enableWarmup:t.enableWarmup||!1};console.log("Sending add-account command:",d),this.ipcService.send("add-account",d),this.newAccount.set({phone:"",proxy:"",apiId:"",apiHash:"",enableWarmup:!0,twoFactorPassword:"",group:""}),this.toastService.info("\u6B63\u5728\u6DFB\u52A0\u8D26\u6237\uFF0C\u8BF7\u7A0D\u5019...")}onAccountAdded(e){console.log("[Frontend] Account added from add-account page:",e),this.toastService.success("\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01"),this.changeView("accounts")}goToAddAccount(){this.changeView("add-account")}loginAccount(e){console.log("[Frontend] loginAccount called with accountId:",e);let t=this.accounts().find(n=>n.id===e);if(!t){console.error("[Frontend] Account not found:",e),this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}console.log("[Frontend] Found account:",t.phone,"Status:",t.status),this.toastService.info("\u6B63\u5728\u767B\u5F55\u8D26\u6237..."),this.loginState.set({accountId:e,phone:t.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set(""),console.log("[Frontend] Sending login-account command to IPC"),this.ipcService.send("login-account",e)}logoutAccount(e){let t=this.accounts().find(n=>n.id===e);if(!t){this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");return}confirm(`\u786E\u5B9A\u8981\u9000\u51FA\u8D26\u6237 ${t.phone} \u5417\uFF1F`)&&(this.toastService.info("\u6B63\u5728\u9000\u51FA\u8D26\u6237..."),this.ipcService.send("logout-account",e),this.ipcService.once("logout-account-result",n=>{n.success?this.toastService.success(`\u8D26\u6237 ${t.phone} \u5DF2\u9000\u51FA`):this.toastService.error(`\u9000\u51FA\u5931\u8D25: ${n.error||"\u672A\u77E5\u9519\u8BEF"}`)}))}editAccount(e){this.toastService.info(`\u7DE8\u8F2F\u5E33\u6236: ${e.phone}`)}submitLoginCode(){let e=this.loginState();!e.accountId||!e.phoneCodeHash||!this.loginCode().trim()||(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:e.phoneCodeHash,isSubmittingCode:!0}),this.toastService.info("\u6B63\u5728\u9A8C\u8BC1\u9A8C\u8BC1\u7801..."),this.ipcService.send("login-account",{accountId:e.accountId,phoneCode:this.loginCode().trim(),phoneCodeHash:e.phoneCodeHash}),this.loginCode.set(""))}submitLogin2FA(){let e=this.loginState();!e.accountId||!this.login2FAPassword().trim()||(this.ipcService.send("login-account",{accountId:e.accountId,twoFactorPassword:this.login2FAPassword().trim()}),this.login2FAPassword.set(""))}cancelLogin(){this.loginState.set({accountId:null,phone:"",requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.login2FAPassword.set("")}resendVerificationCode(){let e=this.loginState();e.accountId&&(this.loginState.set({accountId:e.accountId,phone:e.phone,requiresCode:!1,requires2FA:!1,phoneCodeHash:null,isSubmittingCode:!1}),this.loginCode.set(""),this.toastService.info("\u6B63\u5728\u91CD\u65B0\u53D1\u9001\u9A8C\u8BC1\u7801\u5230\u60A8\u7684 Telegram \u5E94\u7528...",5e3),this.ipcService.send("login-account",e.accountId))}checkAccountStatus(e){this.ipcService.send("check-account-status",e)}navigateToError(e){let t=this.errorNavigationMap[e];if(!t){console.log("[Frontend] No navigation defined for error:",e);return}this.changeView(t.view),setTimeout(()=>{if(t.elementId){let n=document.getElementById(t.elementId);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("highlight-pulse"),setTimeout(()=>{n.classList.remove("highlight-pulse")},3e3))}t.action&&t.action()},300),this.toastService.info("\u5DF2\u8DF3\u8F49\u5230\u76F8\u95DC\u8A2D\u7F6E\u5340\u57DF",2e3)}startMonitoring(){if(this.isStartingMonitoring()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u76E3\u63A7\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.listenerAccounts();if(e.length===0){let n=this.accounts().filter(o=>o.role==="Listener");if(n.length>0){let o=n.filter(a=>a.status!=="Online");o.length>0?this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6709 ${n.length} \u500B\u76E3\u807D\u8CEC\u6236\uFF0C\u4F46\u6C92\u6709\u5728\u7DDA\u7684\u8CEC\u6236\u3002

\u8ACB\u5148\u767B\u9304\u4EE5\u4E0B\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA\uFF1A
`+o.map(a=>`- ${a.phone} (${a.status})`).join(`
`),8e3):this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u7570\u5E38\uFF0C\u8ACB\u6AA2\u67E5\u8CEC\u6236\u72C0\u614B\u3002",5e3)}else this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u807D\u8CEC\u6236\u3002

\u8ACB\u5148\uFF1A
1. \u5728"\u8CEC\u6236\u7BA1\u7406"\u4E2D\u6DFB\u52A0\u8CEC\u6236
2. \u5C07\u8CEC\u6236\u89D2\u8272\u8A2D\u7F6E\u70BA"\u76E3\u807D"
3. \u767B\u9304\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA`,6e3);return}if(this.monitoredGroups().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44\u3002",4e3);return}if(this.keywordSets().length===0){this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u95DC\u9375\u8A5E\u96C6\u3002\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u96C6\u3002",4e3);return}if(e.filter(n=>n.status==="Online").length===0){this.toastService.warning("\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u4E0D\u7A69\u5B9A\uFF0C\u8ACB\u7B49\u5F85\u8CEC\u6236\u5B8C\u5168\u4E0A\u7DDA\u5F8C\u518D\u8A66\u3002",4e3);return}this.isStartingMonitoring.set(!0),this.ipcService.send("start-monitoring"),setTimeout(()=>{this.isStartingMonitoring.set(!1)},5e3)}stopMonitoring(){this.ipcService.send("stop-monitoring")}oneClickStart(){if(this.oneClickStarting()){this.toastService.warning("\u6B63\u5728\u555F\u52D5\u4E2D\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.accounts().length;if(e===0){this.toastService.error("\u274C \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55\u5E33\u865F\uFF0C\u8ACB\u5148\u6DFB\u52A0\u5E33\u865F",4e3);return}this.oneClickStarting.set(!0),this.oneClickProgress.set(0),this.oneClickMessage.set(`\u{1F680} \u958B\u59CB\u555F\u52D5 (${e} \u500B\u5E33\u865F)...`),this.ipcService.send("one-click-start",{forceRefresh:!0}),this.toastService.info(`\u{1F680} \u958B\u59CB\u4E00\u9375\u555F\u52D5\uFF0C\u5F8C\u7AEF\u5C07\u81EA\u52D5\u9023\u63A5 ${e} \u500B\u5E33\u865F`,3e3)}oneClickStop(){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6240\u6709\u670D\u52D9\u55CE\uFF1F\u9019\u5C07\u505C\u6B62\u76E3\u63A7\u548C AI \u81EA\u52D5\u804A\u5929\u3002")&&this.ipcService.send("one-click-stop")}loadSystemStatus(){this.ipcService.send("get-system-status")}clearLogs(){confirm("\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u65E5\u5FD7\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-logs"),this.logs.set([]),this.toastService.success("\u65E5\u5FD7\u5DF2\u6E05\u9664"))}refreshQueueStatus(e){this.ipcService.send("get-queue-status",e?{phone:e}:{})}clearPendingQueue(){confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5F85\u767C\u9001\u6D88\u606F\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002")&&(this.ipcService.send("clear-queue",{status:"pending"}),this.toastService.success("\u5F85\u767C\u9001\u968A\u5217\u5DF2\u6E05\u7A7A"))}retryMessage(e){this.ipcService.send("retry-message",{messageId:e}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u767C\u9001...")}cancelMessage(e){this.ipcService.send("cancel-message",{messageId:e}),this.toastService.success("\u6D88\u606F\u5DF2\u53D6\u6D88"),this.refreshQueueStatus()}clearQueue(e,t){confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u961F\u5217\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&(this.ipcService.send("clear-queue",{phone:e,status:t}),this.toastService.info("\u6B63\u5728\u6E05\u7A7A\u961F\u5217..."))}pauseQueue(e){this.ipcService.send("pause-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6682\u505C\u961F\u5217...")}resumeQueue(e){this.ipcService.send("resume-queue",{phone:e}),this.toastService.info("\u6B63\u5728\u6062\u590D\u961F\u5217...")}deleteQueueMessage(e,t){confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u6D88\u606F\u5417\uFF1F")&&(this.ipcService.send("delete-queue-message",{phone:e,messageId:t}),this.toastService.info("\u6B63\u5728\u5220\u9664\u6D88\u606F..."))}updateQueueMessagePriority(e,t,n){let o=n==="HIGH"||n==="NORMAL"||n==="LOW"?n:"NORMAL";this.ipcService.send("update-queue-message-priority",{phone:e,messageId:t,priority:o})}getQueueMessages(e,t,n=100){this.ipcService.send("get-queue-messages",{phone:e,status:t,limit:n})}viewQueueDetails(e){this.selectedQueuePhone.set(e),this.getQueueMessages(e)}closeQueueDetails(){this.selectedQueuePhone.set(null),this.queueMessages.set([])}loadSendingStats(e=7,t){this.ipcService.send("get-sending-stats",{days:e,phone:t})}loadQueueLengthHistory(e=7){this.ipcService.send("get-queue-length-history",{days:e})}loadAccountSendingComparison(e=7){this.ipcService.send("get-account-sending-comparison",{days:e})}loadCampaignPerformanceStats(e=7){this.ipcService.send("get-campaign-performance-stats",{days:e})}onDaysChange(e){this.selectedDays.set(e),this.loadAllAnalytics(e)}loadAllAnalytics(e=7){this.loadSendingStats(e),this.loadQueueLengthHistory(e),this.loadAccountSendingComparison(e),this.loadCampaignPerformanceStats(e)}capturesChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),n=new Date;n.setHours(0,0,0,0);let o=[],a=[];for(let d=t-1;d>=0;d--){let m=new Date(n);m.setDate(n.getDate()-d);let f=m.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(f);let h=e.filter(C=>{let y=new Date(C.timestamp);return y.setHours(0,0,0,0),y.getTime()===m.getTime()}).length;a.push(h)}return{labels:o,datasets:[{label:"\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",data:a,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]}}conversionsChartData(){let e=this.filteredAnalyticsLeads(),t=this.selectedDays(),n=new Date;n.setHours(0,0,0,0);let o=[],a=[],d=[];for(let m=t-1;m>=0;m--){let f=new Date(n);f.setDate(n.getDate()-m);let h=f.toLocaleDateString("zh-CN",{month:"short",day:"numeric"});o.push(h);let C=e.filter(y=>{let E=new Date(y.timestamp);return E.setHours(0,0,0,0),E.getTime()===f.getTime()});a.push(C.filter(y=>y.status!=="New").length),d.push(C.filter(y=>["Replied","Follow-up","Closed-Won","Closed-Lost"].includes(y.status)).length)}return{labels:o,datasets:[{label:"\u5DF2\u8054\u7CFB",data:a,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0},{label:"\u5DF2\u56DE\u590D",data:d,borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",fill:!0}]}}messagesChartData(){return this.sendingStatsData()}funnelChartData(){let e=this.funnelStats();if(!e||!e.stages||Object.keys(e.stages).length===0)return null;let t=this.funnelStages,n=t.map(a=>a.name),o=t.map(a=>{let d=e.stages[a.key];return d?d.count:0});return{labels:n,datasets:[{label:"\u6F0F\u6597\u6570\u636E",data:o,backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(34, 197, 94, 0.8)","rgba(168, 85, 247, 0.8)","rgba(239, 68, 68, 0.8)","rgba(245, 158, 11, 0.8)","rgba(236, 72, 153, 0.8)","rgba(16, 185, 129, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(34, 197, 94)","rgb(168, 85, 247)","rgb(239, 68, 68)","rgb(245, 158, 11)","rgb(236, 72, 153)","rgb(16, 185, 129)","rgb(239, 68, 68)"],borderWidth:1}]}}loadAlerts(e=!1,t){this.ipcService.send("get-alerts",{limit:50,unresolvedOnly:e,level:t})}acknowledgeAlert(e){this.ipcService.send("acknowledge-alert",{alertId:e})}resolveAlert(e){this.ipcService.send("resolve-alert",{alertId:e})}loadAlertHistory(e=30){this.ipcService.send("get-alert-history",{days:e})}loadAlertRules(){this.ipcService.send("get-alert-rules",{})}toggleAlertRule(e){this.ipcService.send("toggle-alert-rule",{ruleId:e})}editAlertRule(e){this.showAddAlertRuleDialog.set(!0)}deleteAlertRule(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u544A\u8B66\u89C4\u5219\u5417\uFF1F")&&this.ipcService.send("delete-alert-rule",{ruleId:e})}async showNotification(e,t,n){"Notification"in window&&(Notification.permission==="granted"?new Notification(e,F({body:t,icon:"/assets/icon.png",badge:"/assets/badge.png",tag:"tg-matrix-notification",requireInteraction:!1},n)):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&this.showNotification(e,t,n))}showBrowserNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification(`\u544A\u8B66: ${e.level.toUpperCase()}`,{body:e.message,icon:"/assets/icon.ico",tag:`alert-${e.id}`,requireInteraction:e.level==="critical"||e.level==="error"})}async requestNotificationPermission(){"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()}formatDate(e){return new Date(e).toLocaleString()}mapLeadFromBackend(e){let t="unknown",n=e.notes||"",o=e.triggered_keyword||e.triggeredKeyword||"";return n.includes("\u89F8\u767C\u8A5E")||o?t="keyword_trigger":e.extracted_by_phone||e.source_chat_id?t="group_extract":(n.includes("\u5C0E\u5165")||n.includes("import"))&&(t="import"),{id:e.id,userId:e.user_id||e.userId||"",username:e.username||"",firstName:e.first_name||e.firstName||"",lastName:e.last_name||e.lastName||"",sourceGroup:e.source_chat_title||e.sourceGroup||e.source_group||"",triggeredKeyword:n||o||"",timestamp:new Date(e.created_at||e.timestamp||e.extracted_at||Date.now()),status:e.status||e.response_status||"New",onlineStatus:e.online_status||e.onlineStatus||"hidden",assignedTemplateId:e.assignedTemplateId||e.assigned_template_id,interactionHistory:e.interactionHistory||e.interaction_history||[],doNotContact:!!e.doNotContact||!!e.do_not_contact,campaignId:e.campaignId||e.campaign_id,intentScore:e.intent_score||e.intentScore||0,intentLevel:e.intent_level||e.intentLevel||"none",sourceType:e.source_type||e.sourceType||t}}syncLeadsToResourceCenter(e){let t=(e||[]).map(n=>this.mapLeadFromBackend(n));this.contactsService.importLeadsDirectly(t),console.log("[Frontend] Synced",t.length,"leads to resource center")}loadRemainingLeads(){if(console.log("[Frontend] loadRemainingLeads called, loading:",this.leadsLoading(),"hasMore:",this.leadsHasMore()),this.leadsLoading()){console.log("[Frontend] \u23F3 Already loading, skipping...");return}let e=this.leads().length,t=this.leadsTotal();if(e>=t&&t>0){console.log("[Frontend] \u2705 All data already loaded:",e,"/",t);return}console.log("[Frontend] \u{1F4E5} Loading remaining leads:",e,"/",t),this.leadsLoading.set(!0),this.ipcService.send("get-leads-paginated",{page:1,pageSize:500,status:null,search:null})}safeFormatDate(e,t="MM/dd HH:mm"){if(!e)return"-";try{let n=e instanceof Date?e:new Date(e);if(isNaN(n.getTime()))return"-";let o=C=>C.toString().padStart(2,"0"),a=o(n.getMonth()+1),d=o(n.getDate()),m=o(n.getHours()),f=o(n.getMinutes()),h=n.getFullYear();return t==="MM/dd HH:mm"?`${a}/${d} ${m}:${f}`:t==="yyyy-MM-dd HH:mm"?`${h}-${a}-${d} ${m}:${f}`:t==="HH:mm:ss"?`${m}:${f}:${o(n.getSeconds())}`:`${a}/${d} ${m}:${f}`}catch{return"-"}}getQueueStatusForAccount(e){return this.queueStatuses()[e]||null}getTotalQueueStats(){let e=this.queueStatuses(),t=0,n=0,o=0,a=0,d=0,m=0;return Object.values(e).forEach(f=>{t+=f.pending,n+=f.processing,o+=f.retrying,a+=f.failed,d+=f.stats.completed,m+=f.stats.failed}),{pending:t,processing:n,retrying:o,failed:a,completed:d,failedCount:m,totalAccounts:Object.keys(e).length}}applyLogFilter(){this.ipcService.send("get-logs",{limit:1e3,type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}resetLogFilter(){this.logFilterType.set(""),this.logFilterStartDate.set(""),this.logFilterEndDate.set(""),this.logFilterSearch.set(""),this.ipcService.send("get-logs",{limit:100})}exportLogs(){this.ipcService.send("export-logs",{type:this.logFilterType()||void 0,startDate:this.logFilterStartDate()||void 0,endDate:this.logFilterEndDate()||void 0,search:this.logFilterSearch()||void 0})}onExcelFileSelected(){this.accountLoaderService.loadAccountsFromExcel()}onDownloadTemplate(){this.accountLoaderService.downloadExcelTemplate()}reloadSessionsAndAccounts(){this.accountLoaderService.reloadSessionsAndAccounts()}openQrLogin(){this.dialogService.openQrLogin()}closeQrLogin(){this.dialogService.closeQrLogin()}onQrLoginSuccess(e){this.dialogService.closeQrLogin(),this.toastService.success(`\u5E33\u865F ${e.phone||""} \u5DF2\u6210\u529F\u6DFB\u52A0\uFF01`),this.reloadSessionsAndAccounts()}exportLeads(){if(!this.membershipService.hasFeature("dataExport")){this.toastService.warning("\u{1F947} \u6578\u64DA\u5C0E\u51FA\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.accountLoaderService.exportLeadsToExcel(this.leads())}importSession(){this.ipcService.send("import-session")}exportSession(e){this.ipcService.send("export-session",e)}cleanupSessionFiles(){confirm("\u786E\u5B9A\u8981\u6E05\u7406\u6240\u6709\u5B64\u7ACB\u7684 session \u6587\u4EF6\u5417\uFF1F\u8FD9\u5C06\u5220\u9664\u6240\u6709\u5E26\u65F6\u95F4\u6233\u7684 session \u6587\u4EF6\u548C\u4E0D\u5728\u6570\u636E\u5E93\u4E2D\u7684 session \u6587\u4EF6\u3002")&&(this.ipcService.send("cleanup-session-files"),this.toastService.info("\u6B63\u5728\u6E05\u7406\u5B64\u7ACB\u7684 session \u6587\u4EF6..."))}scanOrphanSessions(){this.toastService.info("\u6B63\u5728\u6383\u63CF\u5B64\u7ACB\u7684 Session \u6587\u4EF6...",2e3),this.ipcService.send("scan-orphan-sessions",{})}recoverOrphanSessions(){let e=this.orphanSessions();if(e.length===0){this.toastService.warning("\u6C92\u6709\u9700\u8981\u6062\u5FA9\u7684 Session \u6587\u4EF6");return}this.isRecoveringOrphanSessions.set(!0),this.toastService.info(`\u6B63\u5728\u6062\u5FA9 ${e.length} \u500B\u5E33\u865F...`,2e3),this.ipcService.send("recover-orphan-sessions",{sessions:e})}dismissOrphanSessionDialog(){this.showOrphanSessionDialog.set(!1),this.orphanSessions.set([])}toggleAllAccountSelection(e){let t=e.target.checked,n=new Set(this.filteredAccounts().map(o=>o.id));this.accounts.update(o=>o.map(a=>n.has(a.id)?B(F({},a),{selected:t}):a))}bulkAssignRole(e){let t=this.selectedAccounts().map(n=>n.id);if(t.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u89D2\u8272...",progress:{current:0,total:t.length},cancellable:!1}),this.simulateBulkOperationProgress(t.length,()=>{this.ipcService.send("bulk-assign-role",{accountIds:t,role:e}),this.toastService.success(`\u5DF2\u4E3A ${t.length} \u4E2A\u8D26\u6237\u5206\u914D\u89D2\u8272`)})}bulkAssignGroup(e){let t=e||window.prompt(this.t("enterGroupName"));if(t){let n=this.selectedAccounts().map(o=>o.id);if(n.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");return}this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5206\u914D\u5206\u7EC4...",progress:{current:0,total:n.length},cancellable:!1}),this.simulateBulkOperationProgress(n.length,()=>{this.ipcService.send("bulk-assign-group",{accountIds:n,group:t}),this.toastService.success(`\u5DF2\u4E3A ${n.length} \u4E2A\u8D26\u6237\u5206\u914D\u5206\u7EC4`)})}}bulkDelete(){let e=this.selectedAccounts().map(t=>t.id);if(e.length===0){this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u8D26\u6237");return}window.confirm(`\u786E\u5B9A\u8981\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`)&&(this.progressDialog.set({show:!0,title:"\u6B63\u5728\u6279\u91CF\u5220\u9664\u8D26\u6237...",progress:{current:0,total:e.length},cancellable:!1}),this.simulateBulkOperationProgress(e.length,()=>{this.ipcService.send("bulk-delete-accounts",{accountIds:e}),this.toastService.success(`\u5DF2\u5220\u9664 ${e.length} \u4E2A\u8D26\u6237`)}))}simulateBulkOperationProgress(e,t){let n=0,o=setInterval(()=>{n+=Math.max(1,Math.floor(e/20)),n>=e&&(n=e,clearInterval(o),setTimeout(()=>{this.progressDialog.set(B(F({},this.progressDialog()),{show:!1})),t()},300)),this.progressDialog.set(B(F({},this.progressDialog()),{progress:{current:n,total:e,message:`\u5904\u7406\u4E2D ${n}/${e}`}}))},50)}updateAccountRole(e,t){this.ipcService.send("update-account-data",{id:e,updates:{role:t}})}showAddGroupDialog(){this.toastService.info("\u8ACB\u5728\u76E3\u63A7\u7FA4\u7D44\u5340\u584A\u4E2D\u9EDE\u64CA\u300C+ \u6DFB\u52A0\u7FA4\u7D44\u300D")}showAddKeywordSetDialog(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}this.newKeywordSet.set({name:""}),this.showKeywordSetCreator.set(!0)}submitNewKeywordSet(){let t=this.newKeywordSet().name.trim();t?(console.log("[Frontend] Sending add-keyword-set command:",t),this.ipcService.send("add-keyword-set",{name:t}),this.toastService.success("\u6B63\u5728\u5275\u5EFA\u95DC\u9375\u8A5E\u96C6...",2e3),this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})):this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}cancelNewKeywordSet(){this.showKeywordSetCreator.set(!1),this.newKeywordSet.set({name:""})}addKeywordSet(){let e=this.membershipService.quotas();if(e.maxKeywordSets!==-1&&this.keywordSets().length>=e.maxKeywordSets){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let n=this.newKeywordSet().name.trim();if(n){if(!n){this.toastService.warning("\u95DC\u9375\u8A5E\u96C6\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A",3e3);return}console.log("[Frontend] Sending add-keyword-set command:",n),this.ipcService.send("add-keyword-set",{name:n})}else this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31",3e3)}handleSaveGroupConfig(e){console.log("[Frontend] Saving group config:",e);let t=this.monitoredGroups().find(n=>n.id===e.groupId);t?(this.ipcService.send("add-group",{url:t.url,keywordSetIds:e.keywordSetIds}),this.toastService.success("\u7FA4\u7D44\u914D\u7F6E\u5DF2\u4FDD\u5B58",2e3)):(console.error("[Frontend] Group not found for config save:",e.groupId),this.toastService.error("\u627E\u4E0D\u5230\u7FA4\u7D44\uFF0C\u7121\u6CD5\u4FDD\u5B58\u914D\u7F6E"))}handleSaveKeywordSetConfig(e){console.log("[Frontend] Saving keyword set config:",e);let n=this.keywordSets().find(a=>a.id===e.setId)?.keywords?.map(a=>a.keyword)||[],o=e.keywords.filter(a=>!n.includes(a));for(let a of o)console.log("[Frontend] Adding keyword:",a,"to set:",e.setId),this.ipcService.send("add-keyword",{setId:e.setId,keyword:a,isRegex:!1});o.length>0?this.toastService.success(`\u5DF2\u6DFB\u52A0 ${o.length} \u500B\u95DC\u9375\u8A5E`,2e3):this.toastService.info("\u6C92\u6709\u65B0\u95DC\u9375\u8A5E\u9700\u8981\u6DFB\u52A0",2e3)}handleExtractMembersFromAutomation(e){console.log("[Frontend] Extract members from automation center:",e);try{let t="";e.groupUrl&&(t=e.groupUrl.replace("@","").replace("https://t.me/","").replace("http://t.me/","").replace("t.me/","").split("/")[0]);let n=this.monitoredGroups().find(d=>d.id===parseInt(e.groupId,10)||d.url===e.groupUrl||d.url===`@${t}`||d.url===t),o=this.discoveredResources().find(d=>d.username===t||d.id===parseInt(e.groupId,10)),a={id:o?.id||parseInt(e.groupId,10)||0,title:e.groupName,username:t,telegram_id:o?.telegram_id||n?.telegram_id||t||e.groupId,member_count:e.memberCount||n?.member_count||0,resource_type:"group"};if(console.log("[Frontend] Opening member list dialog with resource:",a),!a.telegram_id&&!a.username){this.toastService.error("\u7121\u6CD5\u7372\u53D6\u7FA4\u7D44\u4FE1\u606F\uFF0C\u8ACB\u5F9E\u8CC7\u6E90\u767C\u73FE\u9801\u9762\u63D0\u53D6\u6210\u54E1");return}this.currentView.set("resources"),setTimeout(()=>{this.openMemberListDialog(a)},100)}catch(t){console.error("[Frontend] Error opening member list dialog:",t),this.toastService.error("\u6253\u958B\u6210\u54E1\u63D0\u53D6\u5C0D\u8A71\u6846\u5931\u6557")}}addKeyword(){let e=this.newKeyword();if(!e.setId){this.toastService.warning(this.t("selectKeywordSetFirst"),3e3);return}if(!e.keyword.trim()){this.toastService.warning(this.t("keywordEmpty"),3e3);return}if(e.isRegex)try{new RegExp(e.keyword)}catch(m){this.toastService.error(`${this.t("invalidRegex")}: ${m.message}`,4e3);return}let t=e.keyword.trim(),n=this.keywordSets().find(m=>m.id===e.setId);if(!n){this.toastService.error("\u95DC\u9375\u8A5E\u96C6\u4E0D\u5B58\u5728",3e3);return}if(n.keywords.some(m=>m.keyword===t&&m.isRegex===e.isRegex)){this.toastService.warning("\u8A72\u95DC\u9375\u8A5E\u5DF2\u5B58\u5728\u65BC\u6B64\u95DC\u9375\u8A5E\u96C6\u4E2D",3e3);return}let d={id:Date.now(),keyword:t,isRegex:e.isRegex};this.keywordSets.update(m=>m.map(f=>f.id===e.setId?B(F({},f),{keywords:[...f.keywords,d]}):f)),this.newKeyword.set({setId:e.setId,keyword:"",isRegex:!1}),this.testKeywordText.set(""),this.keywordTestResult.set(null),this.ipcService.send("add-keyword",{setId:e.setId,keyword:t,isRegex:e.isRegex}),this.toastService.success(this.t("keywordAdded"),2e3)}onTestTextInput(e){e.target.value.trim()||this.keywordTestResult.set(null)}testKeyword(){let e=this.newKeyword(),t=this.testKeywordText().trim();if(!e.keyword.trim()){this.toastService.warning("\u8ACB\u5148\u8F38\u5165\u95DC\u9375\u8A5E",2e3),this.keywordTestResult.set(null);return}if(!t){this.keywordTestResult.set(null);return}try{let n=!1;if(e.isRegex)try{n=new RegExp(e.keyword,"i").test(t)}catch(o){this.keywordTestResult.set({matches:!1,error:o.message}),this.toastService.error(`${this.t("invalidRegex")}: ${o.message}`,4e3);return}else n=t.toLowerCase().includes(e.keyword.toLowerCase());this.keywordTestResult.set({matches:n})}catch(n){this.keywordTestResult.set({matches:!1,error:n.message}),this.toastService.error(`\u6E2C\u8A66\u5931\u6557: ${n.message}`,3e3)}}removeKeywordFromSet(e,t){let n=this.keywordSets().find(a=>a.id===e),o=n?.keywords.find(a=>a.id===t);n&&o?(this.keywordSets.update(a=>a.map(d=>d.id===e?B(F({},d),{keywords:d.keywords.filter(m=>m.id!==t)}):d)),this.ipcService.send("remove-keyword",{setId:e,keywordId:t}),this.toastService.success("\u95DC\u9375\u8A5E\u5DF2\u522A\u9664",2e3)):this.toastService.warning("\u95DC\u9375\u8A5E\u4E0D\u5B58\u5728",2e3)}addGroup(){let e=this.membershipService.quotas();if(e.maxGroups!==-1&&this.monitoredGroups().length>=e.maxGroups){this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${e.maxGroups} \u500B\u7FA4\u7D44`),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.newGroup();t.url.trim()&&(this.monitoredGroups().some(o=>o.url===t.url.trim())&&this.toastService.warning("\u8A72\u7FA4\u7D44\u5DF2\u5B58\u5728\uFF0C\u5C07\u66F4\u65B0\u95DC\u9375\u8A5E\u96C6\u914D\u7F6E",3e3),this.ipcService.send("add-group",{url:t.url.trim(),keywordSetIds:t.keywordSetIds}),this.newGroup.set({url:"",keywordSetIds:[]}))}joinGroup(e){console.log("[Frontend] joinGroup called with:",e),console.log("[Frontend] All accounts:",this.accounts());let t=this.accounts(),n=t.filter(a=>a.role==="Listener"&&a.status==="Online");if(console.log("[Frontend] Listener accounts:",n),n.length===0){let a=t.filter(d=>d.status==="Online");if(console.log("[Frontend] Online accounts (any role):",a),a.length===0){this.toastService.error("\u6C92\u6709\u5728\u7DDA\u7684\u5E33\u865F\uFF0C\u7121\u6CD5\u52A0\u5165\u7FA4\u7D44",3e3);return}n=a,this.toastService.warning("\u6C92\u6709\u76E3\u63A7\u5E33\u865F\uFF0C\u4F7F\u7528\u5176\u4ED6\u5728\u7DDA\u5E33\u865F\u52A0\u5165",3e3)}let o=n[0].phone;console.log("[Frontend] Using phone to join:",o),this.toastService.info(`\u6B63\u5728\u5617\u8A66\u8B93 ${o} \u52A0\u5165\u7FA4\u7D44...`,3e3),this.ipcService.send("join-group",{phone:o,groupUrl:e})}toggleArrayItem(e,t){let n=[...e],o=n.indexOf(t);return o>-1?n.splice(o,1):n.push(t),n}toggleKeywordSetForNewGroup(e){this.newGroup.update(t=>t?B(F({},t),{keywordSetIds:this.toggleArrayItem(t.keywordSetIds||[],e)}):{url:"",keywordSetIds:[e]})}toggleTriggerGroup(e,t){this.campaigns.update(n=>n.map(o=>o.id===e?B(F({},o),{trigger:B(F({},o.trigger),{sourceGroupIds:this.toggleArrayItem(o.trigger.sourceGroupIds,t)})}):o))}toggleTriggerKeywordSet(e,t){this.campaigns.update(n=>n.map(o=>o.id===e?B(F({},o),{trigger:B(F({},o.trigger),{keywordSetIds:this.toggleArrayItem(o.trigger.keywordSetIds,t)})}):o))}toggleNewCampaignSourceGroup(e){this.newCampaign.update(t=>B(F({},t),{trigger:B(F({},t.trigger),{sourceGroupIds:this.toggleArrayItem(t.trigger.sourceGroupIds,e)})}))}toggleNewCampaignKeywordSet(e){this.newCampaign.update(t=>B(F({},t),{trigger:B(F({},t.trigger),{keywordSetIds:this.toggleArrayItem(t.trigger.keywordSetIds,e)})}))}removeById(e,t,n){console.log(`[Frontend] Removing ${n} with id: ${t}`);let o=e();o.find(d=>d.id===t)?(e.set(o.filter(d=>d.id!==t)),console.log(`[Frontend] Optimistically removed ${n} ${t} from local list`),this.toastService.success(`${n==="keyword-set"?"\u95DC\u9375\u8A5E\u96C6":n} \u522A\u9664\u6210\u529F`,2e3)):console.warn(`[Frontend] ${n} ${t} not found in local list`),this.ipcService.send(`remove-${n.replace(" ","-")}`,{id:t})}openLeadDetailModal(e){let t=this.messageTemplates().find(o=>o.id===e.assignedTemplateId);this.generationState.set({status:"idle",lead:e,generatedMessage:"",error:null,customPrompt:t?.prompt||"",attachment:null,attachments:[]}),this.leadDetailView.set("sendMessage"),this.messageMode.set("manual"),this.editableMessage.set("");let n=this.senderAccounts();n.length>0&&!this.selectedSenderId()&&this.selectedSenderId.set(n[0].id)}closeLeadDetailModal(){this.generationState.set({status:"idle",lead:null,generatedMessage:"",error:null,customPrompt:"",attachment:null,attachments:[]}),this.editableMessage.set(""),this.messageMode.set("manual")}startAiChat(e){this.openLeadDetailModal(e),this.messageMode.set("ai"),this.toastService.info(`\u{1F916} \u5DF2\u958B\u555F AI \u804A\u5929\u6A21\u5F0F\uFF0C\u70BA @${e.username||e.userId} \u751F\u6210\u667A\u80FD\u56DE\u8986`)}inviteToGroup(e){if(this.collabGroups().length===0){this.toastService.warning("\u26A0\uFE0F \u8ACB\u5148\u5728\u300C\u591A\u89D2\u8272\u5354\u4F5C\u300D\u4E2D\u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44"),this.currentView.set("multi-role");return}this.selectedLeadForInvite.set(e),this.showInviteGroupDialog.set(!0),this.toastService.info(`\u{1F465} \u9078\u64C7\u8981\u9080\u8ACB @${e.username||e.userId} \u7684\u7FA4\u7D44`)}executeInviteToGroup(e){let t=this.selectedLeadForInvite();t&&(this.ipcService.send("invite-lead-to-collab-group",{leadId:t.id,userId:t.userId,username:t.username,groupId:e}),this.showInviteGroupDialog.set(!1),this.selectedLeadForInvite.set(null),this.toastService.success("\u2713 \u5DF2\u767C\u9001\u9080\u8ACB\u8ACB\u6C42"))}addToDnc(e){this.ipcService.send("add-to-dnc",{leadId:e.id,userId:e.userId}),this.toastService.success(`\u{1F6AB} \u5DF2\u5C07 @${e.username||e.userId} \u52A0\u5165\u9ED1\u540D\u55AE`)}async generateMessage(){let e=this.membershipService.canUseAi();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5 AI \u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState();if(t.lead){this.generationState.update(n=>B(F({},n),{status:"loading",error:null}));try{let n=t.customPrompt;this.spintaxEnabled()&&(n=this.parseSpintax(n));let o=this.aiApiType(),a="";o==="local"||o==="custom"?a=await this.generateWithLocalAI(t.lead,n):o==="openai"?a=await this.generateWithOpenAI(t.lead,n):a=await this.geminiService.generateOutreachMessage(t.lead,n),this.membershipService.recordAiCall(1),this.generationState.update(d=>B(F({},d),{status:"success",generatedMessage:a})),this.editableMessage.set(a)}catch(n){this.generationState.update(o=>B(F({},o),{status:"error",error:n.message}))}}}async generateWithLocalAI(e,t){let n=this.aiApiType()==="local"?this.localAiEndpoint():this.customApiEndpoint(),o=this.localAiModel()||"default";if(!n)throw new Error("\u672C\u5730 AI \u7AEF\u9EDE\u672A\u914D\u7F6E");let a=`\u4F60\u662F\u4E00\u500B\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\u6D88\u606F\u3002
\u898F\u5247\uFF1A
1. \u6D88\u606F\u5FC5\u9808\u7C21\u77ED\uFF0815-40\u5B57\u4EE5\u5167\uFF09
2. \u50CF\u670B\u53CB\u804A\u5929\u4E00\u6A23\u81EA\u7136\uFF0C\u4E0D\u8981\u592A\u6B63\u5F0F
3. \u4E0D\u8981\u4F7F\u7528"\u60A8\u597D"\u7B49\u904E\u65BC\u6B63\u5F0F\u7684\u958B\u982D
4. \u53EF\u4EE5\u7528"\u55E8"\u3001"\u54C8\u56C9"\u3001"hi"\u7B49\u8F15\u9B06\u554F\u5019
5. \u76F4\u63A5\u5207\u5165\u8A71\u984C\uFF0C\u4E0D\u8981\u56C9\u55E6
6. \u8A9E\u6C23\u8F15\u9B06\u53CB\u597D\uFF0C\u50CF\u662F\u5728\u5FAE\u4FE1\u804A\u5929`,d=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\u3002
\u7528\u4E00\u53E5\u8A71\u6253\u500B\u62DB\u547C\uFF0C\u7C21\u77ED\u81EA\u7136\u5C31\u597D\u3002`;return new Promise((m,f)=>{let h=setTimeout(()=>{f(new Error("AI \u751F\u6210\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u670D\u52D9\u9023\u63A5"))},6e4);this.ipcService.once("ai-response",C=>{clearTimeout(h),console.log("[AI] Received ai-response:",C),C?.success&&C?.response?m(C.response):f(new Error(C?.error||"AI \u751F\u6210\u5931\u6557"))}),console.log("[AI] Sending generate-ai-response with endpoint:",n),this.ipcService.send("generate-ai-response",{userId:e.id||e.username,message:d,systemPrompt:a,localAiEndpoint:n,localAiModel:o})})}async generateWithOpenAI(e,t){let n=this.aiApiKey();if(!n)throw new Error("OpenAI API Key \u672A\u914D\u7F6E");let o="\u4F60\u662F\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\uFF0815-40\u5B57\uFF09\uFF0C\u50CF\u670B\u53CB\u804A\u5929\uFF0C\u4E0D\u8981\u6B63\u5F0F\u3002",a=t||`\u7528\u6236 @${e.username||"\u670B\u53CB"} \u5C0D\u300C${e.triggerKeyword||"\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\uFF0C\u7528\u4E00\u53E5\u8A71\u6253\u62DB\u547C\u3002`,d=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:o},{role:"user",content:a}],max_tokens:500,temperature:.7})});if(!d.ok)throw new Error(`OpenAI API \u932F\u8AA4: ${d.status}`);return(await d.json()).choices?.[0]?.message?.content||"\u751F\u6210\u5931\u6557"}updateCustomPrompt(e){this.generationState.update(t=>B(F({},t),{customPrompt:e}))}applyTemplate(e){let t=e.target,n=parseInt(t.value,10);if(!n)return;let o=this.messageTemplates().find(a=>a.id===n);if(o){let a=o.prompt;this.spintaxEnabled()&&(a=this.parseSpintax(a)),this.editableMessage.set(a)}}isAiConfigured(){let e=this.aiApiType();return e==="local"?!!this.localAiEndpoint():e==="custom"?!!this.customApiEndpoint()&&!!this.aiApiKey():this.geminiService.isConfigured()||!!this.aiApiKey()}canSendMessage(){let e=this.editableMessage().trim().length>0,t=this.generationState(),n=t.attachment!==null||t.attachments.length>0,o=this.selectedSenderId()!==null&&this.senderAccounts().length>0;return(e||n)&&o}sendMessageToLead(){let e=this.membershipService.canSendMessage();if(!e.allowed){this.toastService.warning(e.message||"\u4ECA\u65E5\u6D88\u606F\u914D\u984D\u5DF2\u7528\u5B8C"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=this.generationState(),n=t.lead;if(!n)return;let o=this.editableMessage().trim(),a=t.attachment!==null;if(!o&&!a){this.toastService.error(this.t("messageRequired"),3e3);return}let d=this.selectedSenderId();if(!d){this.toastService.error(this.t("selectSenderFirst"),3e3);return}let m=this.accounts().find(h=>h.id===d);if(!m){this.toastService.error(this.t("senderAccountNotFound"),3e3);return}let f=t.attachments.length>0?t.attachments:t.attachment?[t.attachment]:[];f.length===0?this.ipcService.send("send-message",{leadId:n.id,accountPhone:m.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:o,attachment:null}):f.length===1?this.ipcService.send("send-message",{leadId:n.id,accountPhone:m.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:o,attachment:f[0]}):f.forEach((h,C)=>{this.ipcService.send("send-message",{leadId:n.id,accountPhone:m.phone,userId:n.userId,username:n.username,sourceGroup:n.sourceGroup,message:C===0?o:"",attachment:h})}),this.membershipService.recordMessageSent(1),this.toastService.success(this.t("messageQueued"),2e3),this.closeLeadDetailModal()}sendMessage(){this.sendMessageToLead()}onFileAttached(e,t){let n=e.target;if(!n.files?.length)return;let o=n.files[0];o.size>10*1024*1024&&this.toastService.warning("\u5927\u6587\u4EF6\u5EFA\u8B70\u4F7F\u7528\u300C\u9078\u64C7\u6587\u4EF6\u300D\u6309\u9215\u4E0A\u50B3",3e3);let a=new FileReader;a.onload=()=>{let d={name:o.name,type:t,dataUrl:a.result,fileSize:o.size};this.generationState.update(m=>B(F({},m),{attachment:d}))},a.readAsDataURL(o),n.value=""}async selectAttachment(e,t=!1){let n=await this.ipcService.selectFileForAttachment(e,t);if(!n.success){n.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}if(t&&n.files){let o=n.files.map(m=>({name:m.fileName,type:m.fileType,filePath:m.filePath,fileSize:m.fileSize}));this.generationState.update(m=>B(F({},m),{attachments:[...m.attachments,...o],attachment:o[0]}));let d=(o.reduce((m,f)=>m+(f.fileSize||0),0)/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7 ${o.length} \u500B\u6587\u4EF6 (\u5171 ${d} MB)`,2e3)}else{let o={name:n.fileName,type:n.fileType,filePath:n.filePath,fileSize:n.fileSize};this.generationState.update(d=>B(F({},d),{attachment:o,attachments:[o]}));let a=(n.fileSize/(1024*1024)).toFixed(2);this.toastService.success(`\u5DF2\u9078\u64C7: ${n.fileName} (${a} MB)`,2e3)}}async addMoreAttachments(e){let t=await this.ipcService.selectFileForAttachment(e,!0);if(!t.success||!t.files){t.canceled||this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557",2e3);return}let n=t.files.map(o=>({name:o.fileName,type:o.fileType,filePath:o.filePath,fileSize:o.fileSize}));this.generationState.update(o=>B(F({},o),{attachments:[...o.attachments,...n],attachment:o.attachment||n[0]})),this.toastService.success(`\u5DF2\u6DFB\u52A0 ${n.length} \u500B\u6587\u4EF6`,2e3)}removeAttachmentByIndex(e){this.generationState.update(t=>{let n=t.attachments.filter((o,a)=>a!==e);return B(F({},t),{attachments:n,attachment:n.length>0?n[0]:null})})}clearAllAttachments(){this.generationState.update(e=>B(F({},e),{attachments:[],attachment:null}))}getTotalAttachmentSize(){return(this.generationState().attachments.reduce((n,o)=>n+(o.fileSize||0),0)/1024/1024).toFixed(2)}removeAttachment(){this.clearAllAttachments()}parseSpintax(e){let t=/\{([^{}]+)\}/g;for(;t.test(e);)e=e.replace(t,(n,o)=>{let a=o.split("|");return a[Math.floor(Math.random()*a.length)]});return e}addInteractionHistory(e,t,n,o){let a={id:Date.now(),timestamp:new Date,type:t,content:n};if(o&&o.id===e){o.interactionHistory.unshift(a);return}this.leads.update(d=>d.map(m=>m.id===e?B(F({},m),{interactionHistory:[a,...m.interactionHistory]}):m))}updateLeadStatus(e,t,n=!0){this.ipcService.send("update-lead-status",{leadId:e,newStatus:t})}toggleLeadMenu(e){this.openLeadMenuId()===e?this.openLeadMenuId.set(null):this.openLeadMenuId.set(e)}closeLeadMenu(){this.openLeadMenuId.set(null)}addToDoNotContact(e){let t=this.leads().find(n=>n.id===e);t&&(this.ipcService.send("add-to-dnc",{userId:t.userId}),this.closeLeadDetailModal())}toggleLeadSelection(e){this.selectedLeadIds.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}),this.isSelectAllLeads.set(this.selectedLeadIds().size===this.leads().length)}toggleSelectAllLeads(){if(this.isSelectAllLeads())this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1);else{let e=this.leads(),t=new Set(e.map(n=>n.id));this.selectedLeadIds.set(t),this.isSelectAllLeads.set(!0),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}}clearLeadSelection(){this.selectedLeadIds.set(new Set),this.isSelectAllLeads.set(!1),this.showBatchOperationMenu.set(!1)}isLeadSelected(e){return this.selectedLeadIds().has(e)}selectAllFilteredLeads(){let e=this.filteredLeads(),t=new Set(e.map(n=>n.id));this.selectedLeadIds.set(t),t.size>0&&this.toastService.success(`\u5DF2\u9078\u64C7 ${t.size} \u500B\u5BA2\u6236`)}confirmDeleteLead(e){this.deleteConfirmDialog.set({show:!0,type:"single",lead:e})}confirmBatchDeleteLeads(){let e=this.selectedLeadsCount();if(e===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u522A\u9664\u7684\u5BA2\u6236");return}this.deleteConfirmDialog.set({show:!0,type:"batch",count:e})}executeDeleteLeads(){let e=this.deleteConfirmDialog();if(this.deleteConfirmDialog.set({show:!1,type:"single"}),e.type==="single"&&e.lead)this.ipcService.send("delete-lead",{leadId:e.lead.id}),this.leads.update(t=>t.filter(n=>n.id!==e.lead.id)),this.toastService.success(`\u5DF2\u522A\u9664\u5BA2\u6236 @${e.lead.username||e.lead.userId}`);else if(e.type==="batch"){let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u6C92\u6709\u9078\u4E2D\u7684\u5BA2\u6236");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-delete-leads",{leadIds:t}),this.leads.update(n=>n.filter(o=>!this.selectedLeadIds().has(o.id))),this.toastService.success(`\u6B63\u5728\u522A\u9664 ${t.length} \u500B\u5BA2\u6236...`),this.clearLeadSelection()}}cancelDeleteLeads(){this.deleteConfirmDialog.set({show:!1,type:"single"})}exportSelectedLeads(){let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u5C0E\u51FA\u7684\u5BA2\u6236");return}let t=this.leads().filter(h=>e.includes(h.id)),n=["ID","\u7528\u6236\u540D","\u59D3\u540D","\u72C0\u614B","\u4F86\u6E90","\u95DC\u9375\u8A5E","\u6642\u9593"],o=t.map(h=>[h.userId,h.username||"",`${h.firstName||""} ${h.lastName||""}`.trim(),h.status,h.sourceGroup,h.triggeredKeyword,new Date(h.timestamp).toLocaleString()]),a=[n.join(","),...o.map(h=>h.join(","))].join(`
`),d=new Blob(["\uFEFF"+a],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(d),f=document.createElement("a");f.href=m,f.download=`leads_export_${new Date().toISOString().slice(0,10)}.csv`,f.click(),URL.revokeObjectURL(m),this.toastService.success(`\u5DF2\u5C0E\u51FA ${t.length} \u500B\u5BA2\u6236`)}batchUpdateLeadStatus(e){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-lead-status",{leadIds:t,newStatus:e})}batchAddTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}if(!e||!e.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.batchOperationInProgress.set(!0),this.showBatchTagSelector.set(!1),this.ipcService.send("batch-add-tag",{leadIds:t,tag:e.trim()})}batchRemoveTag(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.ipcService.send("batch-remove-tag",{leadIds:t,tag:e})}batchAddToDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}confirm(`\u78BA\u5B9A\u8981\u5C07 ${e.length} \u500B Lead \u6DFB\u52A0\u5230 DNC \u5217\u8868\u55CE\uFF1F`)&&(this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-add-to-dnc",{leadIds:e}))}batchRemoveFromDnc(){if(!this.checkBatchOperationPermission())return;let e=Array.from(this.selectedLeadIds());if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-remove-from-dnc",{leadIds:e})}batchUpdateFunnelStage(e){if(!this.checkBatchOperationPermission())return;let t=Array.from(this.selectedLeadIds());if(t.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.batchOperationInProgress.set(!0),this.showBatchOperationMenu.set(!1),this.ipcService.send("batch-update-funnel-stage",{leadIds:t,newStage:e})}batchDeleteLeads(){if(!this.checkBatchOperationPermission())return;if(Array.from(this.selectedLeadIds()).length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");return}this.confirmBatchDeleteLeads()}undoBatchOperation(e){confirm("\u78BA\u5B9A\u8981\u64A4\u92B7\u6B64\u64CD\u4F5C\u55CE\uFF1F")&&this.ipcService.send("undo-batch-operation",{operationId:e})}loadBatchOperationHistory(){this.ipcService.send("get-batch-operation-history",{limit:50,offset:0}),this.showBatchOperationHistory.set(!0)}openBatchOperationMenu(){if(!this.membershipService.hasFeature("batchOperations")){this.toastService.warning("\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u9EDE\u64CA\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog")),this.showLeadsActionMenu.set(!1);return}this.showBatchOperationMenu.set(!this.showBatchOperationMenu()),this.loadAllTags(),this.showLeadsActionMenu.set(!1)}loadAllTags(){this.ipcService.send("get-all-tags",{})}createTag(){let e=this.newTagName().trim();if(!e){this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");return}this.ipcService.send("create-tag",{name:e,color:this.newTagColor()}),this.newTagName.set(""),this.showAddTagDialog.set(!1)}deleteTag(e){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A19\u7C64 "${e}" \u55CE\uFF1F\u6B64\u6A19\u7C64\u5C07\u5F9E\u6240\u6709 Lead \u4E2D\u79FB\u9664\u3002`)&&this.ipcService.send("delete-tag",{name:e})}onLeadSearchInput(){this.leadSearchTimeout&&clearTimeout(this.leadSearchTimeout);let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.leadSearchTimeout=setTimeout(()=>{this.searchLeads()},500)}searchLeads(){let e=this.leadSearchQuery().trim();if(!e||e.length<2){this.leadSearchResults.set([]);return}this.isSearchingLeads.set(!0),this.ipcService.send("search-leads",{query:e,limit:100})}clearLeadSearch(){this.leadSearchQuery.set(""),this.leadSearchResults.set([]),this.leadSearchTimeout&&(clearTimeout(this.leadSearchTimeout),this.leadSearchTimeout=null)}createBackup(){this.isCreatingBackup.set(!0),this.ipcService.send("create-backup",{name:`backup_${new Date().toISOString().replace(/[:.]/g,"-")}`,description:"Manual backup"})}loadBackups(){this.ipcService.send("list-backups",{})}restoreBackup(e){confirm("\u786E\u5B9A\u8981\u6062\u590D\u6B64\u5907\u4EFD\u5417\uFF1F\u5F53\u524D\u6570\u636E\u5C06\u88AB\u8986\u76D6\uFF01")&&(this.isRestoringBackup.set(!0),this.ipcService.send("restore-backup",{backupId:e}))}deleteBackup(e){confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5907\u4EFD\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF01")&&this.ipcService.send("delete-backup",{backupId:e})}handleBatchOperationResult(e){if(this.batchOperationInProgress.set(!1),e.success){let t=e.successCount||0,n=e.failureCount||0;n>0?this.toastService.warning(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u6210\u529F, ${n} \u5931\u6557`):this.toastService.success(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${t} \u9805\u5DF2\u8655\u7406`),this.clearLeadSelection(),this.ipcService.send("get-initial-state",{})}else this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationProgress(e){this.progressDialog.set({show:!0,title:"\u6279\u91CF\u64CD\u4F5C\u9032\u884C\u4E2D...",progress:{current:e.current,total:e.total,message:e.message},cancellable:!1}),e.current>=e.total&&setTimeout(()=>{this.progressDialog.update(t=>B(F({},t),{show:!1}))},500)}handleBatchUndoResult(e){e.success?(this.toastService.success("\u64CD\u4F5C\u5DF2\u64A4\u92B7"),this.ipcService.send("get-initial-state",{}),this.loadBatchOperationHistory()):this.toastService.error(`\u64A4\u92B7\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleBatchOperationHistory(e){e.success&&this.batchOperationHistory.set(e.operations||[])}handleAllTags(e){e.success&&this.allTags.set(e.tags||[])}handleTagCreated(e){e.success?(this.toastService.success("\u6A19\u7C64\u5275\u5EFA\u6210\u529F"),this.loadAllTags()):this.toastService.error(`\u5275\u5EFA\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}handleTagDeleted(e){e.success?(this.toastService.success("\u6A19\u7C64\u5DF2\u522A\u9664"),this.loadAllTags()):this.toastService.error(`\u522A\u9664\u6A19\u7C64\u5931\u6557: ${e.error||"\u672A\u77E5\u932F\u8AA4"}`)}getOperationTypeName(e){return{update_status:"\u66F4\u65B0\u72C0\u614B",add_tag:"\u6DFB\u52A0\u6A19\u7C64",remove_tag:"\u79FB\u9664\u6A19\u7C64",add_to_dnc:"\u6DFB\u52A0\u5230 DNC",remove_from_dnc:"\u5F9E DNC \u79FB\u9664",update_funnel_stage:"\u66F4\u65B0\u6F0F\u6597\u968E\u6BB5",delete:"\u522A\u9664"}[e]||e}formatBatchOperationDate(e){return new Date(e).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}loadAdTemplates(){this.ipcService.send("get-ad-templates",{activeOnly:!1})}loadAdSchedules(){this.ipcService.send("get-ad-schedules",{activeOnly:!1})}loadAdSendLogs(){this.ipcService.send("get-ad-send-logs",{limit:100})}loadAdOverviewStats(){this.ipcService.send("get-ad-overview-stats",{days:7})}loadAdSystemData(){this.loadAdTemplates(),this.loadAdSchedules(),this.loadAdOverviewStats()}createAdTemplate(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdTemplate();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31");return}if(!e.content.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9");return}this.ipcService.send("create-ad-template",{name:e.name,content:e.content,mediaType:e.mediaType}),this.newAdTemplate.set({name:"",content:"",mediaType:"text"}),this.showAdTemplateForm.set(!1)}deleteAdTemplate(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u6A21\u677F\u55CE\uFF1F")&&this.ipcService.send("delete-ad-template",{templateId:e})}toggleAdTemplateStatus(e){this.ipcService.send("toggle-ad-template-status",{templateId:e})}previewSpintax(e){if(!e.trim()){this.spintaxPreview.set([]);return}this.isPreviewingSpintax.set(!0),this.ipcService.send("validate-spintax",{content:e})}createAdSchedule(){if(!this.membershipService.hasFeature("adBroadcast")){this.toastService.warning("\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.newAdSchedule();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u8A08\u5283\u540D\u7A31");return}if(!e.templateId){this.toastService.warning("\u8ACB\u9078\u64C7\u5EE3\u544A\u6A21\u677F");return}if(e.targetGroups.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u76EE\u6A19\u7FA4\u7D44");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");return}this.ipcService.send("create-ad-schedule",e),this.newAdSchedule.set({name:"",templateId:0,targetGroups:[],sendMode:"scheduled",scheduleType:"once",scheduleTime:"",intervalMinutes:60,triggerKeywords:[],accountStrategy:"rotate",assignedAccounts:[]}),this.showAdScheduleForm.set(!1)}deleteAdSchedule(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u8A08\u5283\u55CE\uFF1F")&&this.ipcService.send("delete-ad-schedule",{scheduleId:e})}toggleAdScheduleStatus(e){this.ipcService.send("toggle-ad-schedule-status",{scheduleId:e})}runAdScheduleNow(e){confirm("\u78BA\u5B9A\u8981\u7ACB\u5373\u57F7\u884C\u6B64\u8A08\u5283\u55CE\uFF1F")&&(this.ipcService.send("run-ad-schedule-now",{scheduleId:e}),this.toastService.info("\u6B63\u5728\u57F7\u884C..."))}getSendModeLabel(e){return{scheduled:"\u5B9A\u6642\u767C\u9001",triggered:"\u95DC\u9375\u8A5E\u89F8\u767C",relay:"\u63A5\u529B\u767C\u9001",interval:"\u9593\u9694\u5FAA\u74B0"}[e]||e}getScheduleTypeLabel(e){return{once:"\u4E00\u6B21\u6027",daily:"\u6BCF\u65E5",interval:"\u9593\u9694",cron:"Cron"}[e]||e}getAccountStrategyLabel(e){return{single:"\u55AE\u4E00\u5E33\u865F",rotate:"\u8F2A\u63DB\u5E33\u865F",relay:"\u63A5\u529B\u767C\u9001",random:"\u96A8\u6A5F\u9078\u64C7"}[e]||e}getAdStatusColor(e){return{sent:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",deleted:"bg-yellow-500/20 text-yellow-400",banned:"bg-red-600/20 text-red-500"}[e]||"bg-slate-500/20 text-slate-400"}toggleAccountForSchedule(e){this.newAdSchedule.update(t=>{let n=[...t.assignedAccounts],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),B(F({},t),{assignedAccounts:n})})}updateScheduleTargetGroups(e){let t=e.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);this.newAdSchedule.update(n=>B(F({},n),{targetGroups:t}))}handleAdTemplates(e){e.success&&this.adTemplates.set(e.templates||[])}handleAdSchedules(e){e.success&&this.adSchedules.set(e.schedules||[])}handleAdSendLogs(e){e.success&&this.adSendLogs.set(e.logs||[])}handleAdOverviewStats(e){e.success&&this.adOverviewStats.set(e.overview||null)}handleAdTemplateCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u5275\u5EFA"),this.loadAdTemplates()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdTemplateDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u522A\u9664"),this.loadAdTemplates())}handleAdScheduleCreated(e){e.success?(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u5275\u5EFA"),this.loadAdSchedules()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleAdScheduleDeleted(e){e.success&&(this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u522A\u9664"),this.loadAdSchedules())}handleSpintaxValidated(e){this.isPreviewingSpintax.set(!1),e.success||e.valid?this.spintaxPreview.set(e.variants||[]):(this.toastService.error(`Spintax \u8A9E\u6CD5\u932F\u8AA4: ${e.error}`),this.spintaxPreview.set([]))}handleAdScheduleRunResult(e){e.success?(this.toastService.success(`\u8A08\u5283\u57F7\u884C\u5B8C\u6210: ${e.sent||0} \u6210\u529F, ${e.failed||0} \u5931\u6557`),this.loadAdSendLogs(),this.loadAdOverviewStats()):this.toastService.error(`\u57F7\u884C\u5931\u6557: ${e.error}`)}loadTrackedUsers(){this.ipcService.send("get-tracked-users",{limit:100,valueLevel:this.userValueFilter()||void 0})}loadTrackingStats(){this.ipcService.send("get-tracking-stats",{})}loadHighValueGroups(){this.ipcService.send("get-high-value-groups",{limit:50})}loadUserTrackingData(){this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups()}addUserToTrack(){let e=this.newTrackedUser();if(!e.userId.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u7528\u6236 ID");return}this.ipcService.send("add-user-to-track",{userId:e.userId.trim(),username:e.username.trim()||void 0,notes:e.notes.trim()||void 0,source:"manual"}),this.newTrackedUser.set({userId:"",username:"",notes:""}),this.showAddUserForm.set(!1)}addLeadToTracking(e){this.ipcService.send("add-user-from-lead",{leadId:e})}removeTrackedUser(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u7528\u6236\u8FFD\u8E64\u55CE\uFF1F")&&this.ipcService.send("remove-tracked-user",{userId:e})}trackUserGroups(e){let t=this.accounts().filter(n=>n.status==="Online");if(t.length===0){this.toastService.warning("\u6C92\u6709\u5728\u7DDA\u5E33\u865F\u53EF\u7528\u65BC\u8FFD\u8E64");return}this.isTrackingUser.set(!0),this.ipcService.send("track-user-groups",{userId:e,accountPhone:t[0].phone})}viewUserGroups(e){this.selectedTrackedUser.set(e),this.ipcService.send("get-user-groups",{userId:e.userId})}updateUserValueLevel(e,t){this.ipcService.send("update-user-value-level",{userId:e,valueLevel:t})}getValueLevelLabel(e){return{vip:"VIP",high:"\u9AD8\u50F9\u503C",medium:"\u4E2D\u7B49",low:"\u4F4E"}[e]||e}getValueLevelColor(e){return{vip:"bg-purple-500/20 text-purple-400 border-purple-500/30",high:"bg-orange-500/20 text-orange-400 border-orange-500/30",medium:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",low:"bg-slate-500/20 text-slate-400 border-slate-500/30"}[e]||"bg-slate-500/20 text-slate-400"}getTrackingStatusLabel(e){return{pending:"\u5F85\u8FFD\u8E64",tracking:"\u8FFD\u8E64\u4E2D",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getTrackingStatusColor(e){return{pending:"bg-yellow-500/20 text-yellow-400",tracking:"bg-blue-500/20 text-blue-400",completed:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}handleTrackedUsers(e){e.success&&this.trackedUsers.set(e.users||[])}handleUserGroups(e){e.success&&this.userGroups.set(e.groups||[])}handleHighValueGroups(e){e.success&&this.highValueGroups.set(e.groups||[])}handleTrackingStats(e){e.success&&this.trackingStats.set(e.stats||null)}handleUserAddedToTrack(e){e.success?(this.toastService.success("\u7528\u6236\u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868"),this.loadTrackedUsers()):this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${e.error}`)}handleUserRemoved(e){e.success&&(this.toastService.success("\u7528\u6236\u5DF2\u79FB\u9664"),this.loadTrackedUsers())}handleUserTrackingCompleted(e){this.isTrackingUser.set(!1),e.success&&(this.toastService.success(`\u8FFD\u8E64\u5B8C\u6210: \u767C\u73FE ${e.groupsFound} \u500B\u7FA4\u7D44, ${e.highValueGroups} \u500B\u9AD8\u50F9\u503C`),this.loadTrackedUsers(),this.loadTrackingStats(),this.loadHighValueGroups())}handleUserTrackingFailed(e){this.isTrackingUser.set(!1),this.toastService.error(`\u8FFD\u8E64\u5931\u6557: ${e.error}`),this.loadTrackedUsers()}loadCampaigns(){this.ipcService.send("get-campaigns",{limit:50})}loadUnifiedOverview(){this.ipcService.send("get-unified-overview",{days:7})}loadFunnelAnalysis(){this.ipcService.send("get-funnel-analysis",{})}loadCampaignData(){this.loadCampaigns(),this.loadUnifiedOverview(),this.loadFunnelAnalysis()}createCampaignFromForm(){if(!this.membershipService.hasFeature("aiSalesFunnel")){this.toastService.warning("\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD"),window.dispatchEvent(new CustomEvent("open-membership-dialog"));return}let e=this.campaignFormData();if(!e.name.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");return}if(e.assignedAccounts.length===0){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}this.ipcService.send("create-campaign",{name:e.name,description:e.description,phases:e.phases,keywords:e.keywords,targetGroups:e.targetGroups,assignedAccounts:e.assignedAccounts}),this.campaignFormData.set({name:"",description:"",phases:["discovery","monitoring","outreach"],keywords:[],targetGroups:[],assignedAccounts:[]}),this.showCampaignForm.set(!1)}startCampaign(e){confirm("\u78BA\u5B9A\u8981\u555F\u52D5\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("start-campaign",{campaignId:e})}pauseCampaign(e){this.ipcService.send("pause-campaign",{campaignId:e})}resumeCampaign(e){this.ipcService.send("resume-campaign",{campaignId:e})}stopCampaign(e){confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("stop-campaign",{campaignId:e})}deleteCampaign(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D3B\u52D5\u55CE\uFF1F")&&this.ipcService.send("delete-campaign",{campaignId:e})}viewCampaignDetails(e){this.selectedCampaign.set(e),this.ipcService.send("get-campaign-logs",{campaignId:e.id})}getCampaignStatusLabel(e){return{draft:"\u8349\u7A3F",scheduled:"\u5DF2\u6392\u7A0B",running:"\u904B\u884C\u4E2D",paused:"\u5DF2\u66AB\u505C",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u6557"}[e]||e}getCampaignStatusColor(e){return{draft:"bg-slate-500/20 text-slate-400",scheduled:"bg-blue-500/20 text-blue-400",running:"bg-green-500/20 text-green-400",paused:"bg-yellow-500/20 text-yellow-400",completed:"bg-cyan-500/20 text-cyan-400",failed:"bg-red-500/20 text-red-400"}[e]||"bg-slate-500/20 text-slate-400"}getPhaseLabel(e){return{discovery:"\u8CC7\u6E90\u767C\u73FE",monitoring:"\u76E3\u63A7\u7372\u5BA2",outreach:"\u5EE3\u544A\u89F8\u9054",tracking:"\u7528\u6236\u8FFD\u8E64",conversion:"\u8F49\u5316\u6210\u4EA4"}[e]||e}toggleCampaignPhase(e){this.campaignFormData.update(t=>{let n=[...t.phases],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),B(F({},t),{phases:n})})}addCampaignKeyword(){let e=this.campaignKeywordInput().trim();e&&(this.campaignFormData.update(t=>B(F({},t),{keywords:[...t.keywords,e]})),this.campaignKeywordInput.set(""))}removeCampaignKeyword(e){this.campaignFormData.update(t=>B(F({},t),{keywords:t.keywords.filter(n=>n!==e)}))}toggleCampaignAccount(e){this.campaignFormData.update(t=>{let n=[...t.assignedAccounts],o=n.indexOf(e);return o>=0?n.splice(o,1):n.push(e),B(F({},t),{assignedAccounts:n})})}handleCampaigns(e){e.success&&this.campaigns.set(e.campaigns||[])}handleCampaignCreated(e){e.success?(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA"),this.loadCampaigns()):this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${e.error}`)}handleCampaignDeleted(e){e.success&&(this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u522A\u9664"),this.loadCampaigns())}handleUnifiedOverview(e){e.success&&this.unifiedOverview.set(e)}handleFunnelAnalysis(e){e.success&&this.funnelAnalysis.set(e)}loadRoleTemplates(){this.ipcService.send("get-role-templates",{})}loadAllRoles(){this.ipcService.send("get-all-roles",{activeOnly:!0})}loadScriptTemplates(){this.ipcService.send("get-script-templates",{activeOnly:!0})}loadCollabGroups(){this.ipcService.send("get-collab-groups",{limit:50})}loadCollabStats(){this.ipcService.send("get-collab-stats",{})}loadRoleStats(){this.ipcService.send("get-role-stats",{})}loadMultiRoleData(){this.loadRoleTemplates(),this.loadAllRoles(),this.loadScriptTemplates(),this.loadCollabGroups(),this.loadCollabStats(),this.loadRoleStats()}assignRole(){let e=this.newRoleAssign();if(!e.accountPhone){this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");return}if(!e.roleName.trim()){this.toastService.warning("\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31");return}this.ipcService.send("assign-role",{accountPhone:e.accountPhone,roleType:e.roleType,roleName:e.roleName}),this.newRoleAssign.set({accountPhone:"",roleType:"seller",roleName:""}),this.showRoleAssignForm.set(!1)}removeRole(e){confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u89D2\u8272\u55CE\uFF1F")&&this.ipcService.send("remove-role",{roleId:e})}getRoleIcon(e){return{seller:"\u{1F9D1}\u200D\u{1F4BC}",expert:"\u{1F468}\u200D\u{1F52C}",satisfied:"\u{1F60A}",hesitant:"\u{1F914}",converted:"\u{1F389}",curious:"\u2753",manager:"\u{1F454}",support:"\u{1F6E0}\uFE0F"}[e]||"\u{1F464}"}getRoleLabel(e){return{seller:"\u92B7\u552E\u9867\u554F",expert:"\u5C08\u696D\u9867\u554F",satisfied:"\u6EFF\u610F\u5BA2\u6236",hesitant:"\u7336\u8C6B\u5BA2\u6236",converted:"\u6210\u4EA4\u5BA2\u6236",curious:"\u597D\u5947\u8005",manager:"\u7D93\u7406\u4E3B\u7BA1",support:"\u552E\u5F8C\u5BA2\u670D"}[e]||e}getScenarioLabel(e){return{group_conversion:"\u7FA4\u804A\u8F49\u5316",private_followup:"\u79C1\u804A\u8DDF\u9032",objection_handling:"\u7570\u8B70\u8655\u7406",product_intro:"\u7522\u54C1\u4ECB\u7D39",trust_building:"\u5EFA\u7ACB\u4FE1\u4EFB",urgency_creation:"\u88FD\u9020\u7DCA\u8FEB\u611F",custom:"\u81EA\u5B9A\u7FA9"}[e]||e}getCollabStatusLabel(e){return{warming:"\u9810\u71B1\u4E2D",active:"\u6D3B\u8E8D\u4E2D",completed:"\u5DF2\u5B8C\u6210",archived:"\u5DF2\u6B78\u6A94"}[e]||e}getCollabStatusColor(e){return{warming:"bg-yellow-500/20 text-yellow-400",active:"bg-green-500/20 text-green-400",completed:"bg-blue-500/20 text-blue-400",archived:"bg-slate-500/20 text-slate-400"}[e]||"bg-slate-500/20 text-slate-400"}handleRoleTemplates(e){e.success&&this.roleTemplates.set(e.templates||{})}handleAllRoles(e){e.success&&this.allRoles.set(e.roles||[])}handleScriptTemplates(e){e.success&&this.scriptTemplates.set(e.templates||[])}handleCollabGroups(e){e.success&&this.collabGroups.set(e.groups||[])}handleCollabStats(e){e.success&&this.collabStats.set(e)}handleRoleStats(e){e.success&&this.roleStats.set(e)}updateAdTemplateName(e){this.newAdTemplate.update(t=>B(F({},t),{name:e}))}updateAdTemplateContent(e){this.newAdTemplate.update(t=>B(F({},t),{content:e}))}updateAdTemplateMediaType(e){this.newAdTemplate.update(t=>B(F({},t),{mediaType:e}))}updateAdScheduleName(e){this.newAdSchedule.update(t=>B(F({},t),{name:e}))}updateAdScheduleTemplateId(e){this.newAdSchedule.update(t=>B(F({},t),{templateId:e}))}updateAdScheduleSendMode(e){this.newAdSchedule.update(t=>B(F({},t),{sendMode:e}))}updateAdScheduleType(e){this.newAdSchedule.update(t=>B(F({},t),{scheduleType:e}))}updateAdScheduleTime(e){this.newAdSchedule.update(t=>B(F({},t),{scheduleTime:e}))}updateAdScheduleInterval(e){this.newAdSchedule.update(t=>B(F({},t),{intervalMinutes:e}))}updateAdScheduleStrategy(e){this.newAdSchedule.update(t=>B(F({},t),{accountStrategy:e}))}updateTrackedUserId(e){this.newTrackedUser.update(t=>B(F({},t),{userId:e}))}updateTrackedUserName(e){this.newTrackedUser.update(t=>B(F({},t),{username:e}))}updateTrackedUserNotes(e){this.newTrackedUser.update(t=>B(F({},t),{notes:e}))}updateCampaignFormName(e){this.campaignFormData.update(t=>B(F({},t),{name:e}))}updateCampaignFormDesc(e){this.campaignFormData.update(t=>B(F({},t),{description:e}))}updateRoleAssignPhone(e){this.newRoleAssign.update(t=>B(F({},t),{accountPhone:e}))}updateRoleAssignType(e){this.newRoleAssign.update(t=>B(F({},t),{roleType:e}))}updateRoleAssignName(e){this.newRoleAssign.update(t=>B(F({},t),{roleName:e}))}getRolesOfType(e){return this.allRoles().filter(t=>t.roleType===e)}addTemplate(){let e=this.newTemplate();e.name.trim()&&e.prompt.trim()?(this.ipcService.send("add-template",{name:e.name,prompt:e.prompt}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F")):this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}addTemplateQuick(e,t){if(e?.trim()&&t?.trim()){if(this.messageTemplates().some(o=>o.name===e.trim())){this.toastService.warning("\u6A21\u677F\u540D\u7A31\u5DF2\u5B58\u5728\uFF0C\u7121\u6CD5\u5275\u5EFA\u91CD\u8907\u6A21\u677F",3e3);return}this.ipcService.send("add-template",{name:e.trim(),prompt:t.trim()}),this.newTemplate.set({name:"",prompt:""}),this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F"),this.messageTemplates().length>0&&this.showTemplateCreator.set(!1)}else this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9")}updateTemplateName(e){this.newTemplate.update(t=>B(F({},t),{name:e}))}updateTemplatePrompt(e){this.newTemplate.update(t=>B(F({},t),{prompt:e}))}insertTemplateVariable(e,t){let n=e.selectionStart,o=e.selectionEnd,a=e.value,d=a.substring(0,n)+t+a.substring(o);e.value=d,this.updateTemplatePrompt(d),setTimeout(()=>{e.focus(),e.selectionStart=e.selectionEnd=n+t.length},0)}toggleTemplateStatus(e){this.ipcService.send("toggle-template-status",{id:e})}removeTemplate(e){let t=this.messageTemplates().find(o=>o.id===e);if(!t)return;let n=this.campaigns().filter(o=>o.actions.some(a=>a.templateId===e));if(n.length>0){let o=n.map(a=>a.name).join(", ");if(!confirm(`\u6A21\u677F "${t.name}" \u6B63\u5728\u88AB\u4EE5\u4E0B\u6D3B\u52D5\u4F7F\u7528\uFF1A${o}

\u522A\u9664\u6A21\u677F\u5F8C\uFF0C\u9019\u4E9B\u6D3B\u52D5\u5C07\u7121\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002

\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F`))return}else if(!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F "${t.name}" \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002`))return;this.ipcService.send("remove-template",{id:e}),this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664")}getTemplateName(e){return e?this.messageTemplates().find(t=>t.id===e)?.name||"Unknown Template":"N/A"}getKeywordSetName(e){return this.keywordSets().find(t=>t.id===e)?.name||"Unknown Set"}getGroupName(e){return this.monitoredGroups().find(t=>t.id===e)?.name||"Unknown Group"}getCampaignName(e){return e?this.campaigns().find(t=>t.id===e)?.name||"Unknown Campaign":"N/A"}getCampaignById(e){if(e!==void 0)return this.campaigns().find(t=>t.id===e)}getEmptyCampaignForm(){return{name:"",trigger:{sourceGroupIds:[],keywordSetIds:[]},action:{templateId:0,minDelaySeconds:30,maxDelaySeconds:120}}}addCampaign(){if(this.isSubmittingCampaign()){this.toastService.warning("\u6B63\u5728\u5275\u5EFA\u6D3B\u52D5\uFF0C\u8ACB\u7A0D\u5019...",2e3);return}let e=this.newCampaign(),t=[];if(e.name?.trim()||t.push("\u6D3B\u52A8\u540D\u79F0"),(!e.action.templateId||e.action.templateId===0)&&t.push("\u6D88\u606F\u6A21\u677F"),e.trigger.sourceGroupIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6765\u6E90\u7FA4\u7EC4"),e.trigger.keywordSetIds.length===0&&t.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5173\u952E\u8BCD\u96C6"),t.length>0){this.toastService.error(`\u8BF7\u5B8C\u5584\u4EE5\u4E0B\u5185\u5BB9: ${t.join(", ")}`);return}let n=e.name.trim();if(this.campaigns().find(a=>a.name===n)){this.toastService.warning(`\u6D3B\u52D5 "${n}" \u5DF2\u5B58\u5728\uFF0C\u8ACB\u4F7F\u7528\u4E0D\u540C\u7684\u540D\u7A31`,4e3);return}this.isSubmittingCampaign.set(!0),this.newCampaign.set(this.getEmptyCampaignForm()),this.ipcService.send("add-campaign",F({},e)),setTimeout(()=>{this.isSubmittingCampaign.set(!1)},3e3)}toggleCampaignStatus(e){this.ipcService.send("toggle-campaign-status",{id:e})}getLogColor(e){switch(e){case"info":return"text-cyan-400";case"success":return"text-green-400";case"warning":return"text-yellow-400";case"error":return"text-red-400";default:return"text-slate-400"}}formatTimestamp(e){if(!e)return"";try{let t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString()+" "+t.toLocaleTimeString()}catch{return""}}async loadChatList(){try{let e=this.chatListSearch(),t=this.chatListFunnelFilter();this.ipcService.send("get-chat-list",{limit:50,offset:0,search:e||void 0,funnelStage:t||void 0})}catch(e){console.error("[Frontend] Error loading chat list:",e)}}onChatListSearchChange(e){this.chatListSearch.set(e),this.chatListSearchDebounceTimer&&clearTimeout(this.chatListSearchDebounceTimer),this.chatListSearchDebounceTimer=setTimeout(()=>{this.loadChatList(),this.chatListSearchDebounceTimer=void 0},300)}onLogFilterChange(){this.logFilterDebounceTimer&&clearTimeout(this.logFilterDebounceTimer),this.logFilterDebounceTimer=setTimeout(()=>{this.applyLogFilter(),this.logFilterDebounceTimer=void 0},500)}refreshQueueStatusThrottled(){let e=Date.now(),t=e-this.lastQueueStatusRefresh;t>=2e3?(this.lastQueueStatusRefresh=e,this.refreshQueueStatus()):(this.queueStatusRefreshThrottleTimer&&clearTimeout(this.queueStatusRefreshThrottleTimer),this.queueStatusRefreshThrottleTimer=setTimeout(()=>{this.lastQueueStatusRefresh=Date.now(),this.queueStatusRefreshThrottleTimer=void 0,this.refreshQueueStatus()},2e3-t))}getAccountQueueStatuses(){let e=this.queueStatuses();return Object.entries(e).map(([t,n])=>{let o=this.accounts().find(a=>a.phone===t);return{phone:t,displayName:t,status:n.processing>0?"active":(n.pending>0,"idle"),pending:n.pending,processing:n.processing,completed:n.stats.completed,failed:n.stats.failed,retrying:n.retrying,sendRate:n.processing>0?1.5:0,avgResponseTime:500,dailyLimit:o?.dailySendLimit??100,dailyUsed:o?.dailySendCount??0,estimatedMinutes:n.pending>0?Math.ceil(n.pending/1.5):0,lastError:n.failed>0?"\u90E8\u5206\u6D88\u606F\u767C\u9001\u5931\u6557":void 0}})}pauseAllQueues(){this.ipcService.send("pause-all-queues",{}),this.toastService.info("\u6B63\u5728\u66AB\u505C\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}resumeAllQueues(){this.ipcService.send("resume-all-queues",{}),this.toastService.info("\u6B63\u5728\u6062\u5FA9\u6240\u6709\u767C\u9001\u968A\u5217...",2e3)}retryAllFailed(){this.ipcService.send("retry-all-failed",{}),this.toastService.info("\u6B63\u5728\u91CD\u8A66\u6240\u6709\u5931\u6557\u7684\u6D88\u606F...",2e3)}checkAutomationConfig(){this.toastService.info("\u6B63\u5728\u6AA2\u67E5\u914D\u7F6E...",2e3),this.ipcService.send("check-automation-config",{accounts:this.accounts().map(e=>({phone:e.phone,role:e.role,status:e.status})),groups:this.monitoredGroups(),keywords:this.keywordSets(),campaigns:this.campaigns()})}handleWorkflowNavigation(e){this.changeView(e.view),e.handler&&setTimeout(()=>{switch(e.handler){case"start-monitoring":this.startMonitoring();break;case"scan-sessions":this.scanOrphanSessions();break;case"new-campaign":break;case"export-leads":this.exportLeads();break;default:console.log("[Workflow] Unknown handler:",e.handler)}},300)}onWorkflowCompleted(e){this.toastService.success(`\u{1F389} \u5DE5\u4F5C\u6D41\u300C${e.title}\u300D\u5DF2\u5B8C\u6210\uFF01`,4e3),console.log("[Workflow] Completed:",e.id)}async loadChatHistory(e,t=!0){try{console.log("[Frontend] Loading chat history for user:",e,"reset:",t),t?(this.isLoadingChatHistory.set(!0),this.chatHistoryPage.set(0),this.chatHistoryAllMessages.set([])):this.chatHistoryLoadingMore.set(!0),this.selectedChatUserId.set(e);let n=this.chatHistoryPage(),o=this.chatHistoryPageSize(),a=n*o;console.log("[Frontend] Sending get-chat-history-full:",{userId:e,limit:o,offset:a}),this.ipcService.send("get-chat-history-full",{userId:e,limit:o,offset:a})}catch(n){console.error("[Frontend] Error loading chat history:",n),this.isLoadingChatHistory.set(!1),this.chatHistoryLoadingMore.set(!1)}}async loadMoreChatHistory(){let e=this.selectedChatUserId();!e||this.chatHistoryLoadingMore()||!this.chatHistoryHasMore()||(this.chatHistoryPage.update(t=>t+1),await this.loadChatHistory(e,!1))}onChatHistoryScroll(e){let t=e.target;if(!t)return;let n=t.scrollTop,o=t.scrollHeight,a=t.clientHeight;o-n-a<200&&this.chatHistoryHasMore()&&!this.chatHistoryLoadingMore()&&this.loadMoreChatHistory()}async sendAiResponse(e,t){try{let n=this.generationState().lead;if(!n)return;this.ipcService.send("send-ai-response",{userId:e,message:t,accountPhone:this.senderAccounts().find(o=>o.id===this.selectedSenderId())?.phone,sourceGroup:n.sourceGroup,username:n.username}),setTimeout(()=>{this.loadChatHistory(e)},1e3)}catch(n){console.error("[Frontend] Error sending AI response:",n)}}async checkMonitoringStatus(){try{this.ipcService.send("get-monitoring-status",{})}catch(e){console.error("[Frontend] Error checking monitoring status:",e)}}async checkMonitoringHealth(){try{this.ipcService.send("check-monitoring-health",{})}catch(e){console.error("[Frontend] Error checking monitoring health:",e)}}trackByChatMessageId(e,t){return t.id||e}trackByChatId(e,t){return t.userId||e}trackByLogId(e,t){let n=0;return t.timestamp&&(t.timestamp instanceof Date?n=t.timestamp.getTime():typeof t.timestamp=="number"?n=t.timestamp:typeof t.timestamp=="string"&&(n=new Date(t.timestamp).getTime()||0)),`${t.id}-${n}-${e}`}isValidAlertDetails(e){if(!e||typeof e!="object"||e===null||Array.isArray(e))return!1;try{return Object.keys(e).length>0}catch{return!1}}safeStringify(e){try{return JSON.stringify(e,null,2)}catch{return"\u7121\u6CD5\u986F\u793A\u8A73\u60C5"}}getStatusColor(e){switch(e){case"Online":return"bg-green-500/10 text-green-400";case"Offline":return"bg-slate-500/10 text-slate-400";case"Banned":return"bg-red-500/10 text-red-400";case"Proxy Error":return"bg-orange-500/10 text-orange-400";case"Logging in...":return"bg-blue-500/10 text-blue-400 animate-pulse";case"Resting (Cooldown)":return"bg-yellow-500/10 text-yellow-400";case"Warming Up":return"bg-indigo-500/10 text-indigo-400 animate-pulse";case"New":return"bg-blue-500/10 text-blue-400";case"Contacted":return"bg-yellow-500/10 text-yellow-400";case"Replied":return"bg-green-500/10 text-green-400";case"Follow-up":return"bg-purple-500/10 text-purple-400";case"Closed-Won":return"bg-teal-500/10 text-teal-400";case"Closed-Lost":return"bg-red-500/10 text-red-400";default:return"bg-slate-700/20 text-slate-300"}}getStatusBarColor(e){switch(e){case"New":return"bg-amber-500";case"Contacted":return"bg-cyan-500";case"Replied":return"bg-purple-500";case"Follow-up":return"bg-orange-500";case"Closed-Won":return"bg-emerald-500";case"Closed-Lost":return"bg-red-500";default:return"bg-slate-500"}}getHealthColor(e){return e>80?"bg-green-500":e>50?"bg-yellow-500":"bg-red-500"}getOnlineStatusColor(e){switch(e){case"Online":return"bg-green-500";case"Recently":return"bg-yellow-500";case"Offline":return"bg-slate-500";default:return"bg-slate-400"}}getIntentLevelColor(e){switch(e){case"HOT":return"bg-red-500/20 text-red-400 border border-red-500/30";case"WARM":return"bg-orange-500/20 text-orange-400 border border-orange-500/30";case"NEUTRAL":return"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30";case"COLD":return"bg-blue-500/20 text-blue-400 border border-blue-500/30";case"NONE":return"bg-slate-500/20 text-slate-400 border border-slate-500/30";default:return"bg-slate-500/20 text-slate-400 border border-slate-500/30"}}getIntentLevelEmoji(e){switch(e){case"HOT":return"\u{1F525}";case"WARM":return"\u{1F321}\uFE0F";case"NEUTRAL":return"\u{1F610}";case"COLD":return"\u2744\uFE0F";case"NONE":return"\u26AA";default:return"\u26AA"}}handleMemberSendMessage(e){let t=this.convertMemberToLead(e);this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.first_name||e.username||e.user_id}`)}handleMemberAddToFunnel(e){let t=this.leads().find(o=>o.userId===e.user_id);if(t){this.toastService.warning(`\u26A0\uFE0F ${e.first_name||e.username||e.user_id} \u5DF2\u5728\u92B7\u552E\u6F0F\u6597\u4E2D`),this.currentView.set("leads"),setTimeout(()=>this.openLeadDetailModal(t),100);return}let n=this.convertMemberToLead(e);this.ipcService.send("add-lead",{user_id:e.user_id,username:e.username,first_name:e.first_name,last_name:e.last_name,source_chat_title:e.source_chat_title,source_chat_id:e.source_chat_id,notes:`\u5F9E\u6210\u54E1\u8CC7\u6599\u5EAB\u6DFB\u52A0 (${e.value_level}\u7D1A)`}),this.leads.update(o=>[n,...o]),this.toastService.success(`\u2705 \u5DF2\u5C07 ${e.first_name||e.username||e.user_id} \u52A0\u5165\u92B7\u552E\u6F0F\u6597`),this.currentView.set("leads")}handleResourceSendMessage(e){let t={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:"New",onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(t),this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${e.display_name||e.username||e.telegram_id}`)}handleResourceViewDetail(e){let t="New";e.status==="converted"?t="Closed-Won":e.status==="contacted"?t="Contacted":e.status==="interested"&&(t="Replied");let n={id:0,userId:e.telegram_id,username:e.username||"",firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_name||"",triggeredKeyword:"",timestamp:new Date(e.created_at),status:t,onlineStatus:"Unknown",interactionHistory:[],doNotContact:!1};this.openLeadDetailModal(n)}handleResourceBatchSend(e){if(e.length===0)return;let t=e.map(n=>({telegramId:n.telegram_id,username:n.username||"",firstName:n.first_name,lastName:n.last_name,displayName:n.display_name||n.first_name||n.username||n.telegram_id,groupName:n.source_name||n.source_chat_title||"",keyword:n.triggered_keyword||"",source:n.source_type||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u7528\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}handleBatchSendComplete(e){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u5931\u6557 ${e.failed}`)}closeBatchSendDialog(){this.showBatchMessageDialogState.set(!1),this.batchSendTargets.set([])}openBatchSendForLeads(){let e=this.leads().filter(n=>this.selectedLeadIds().has(n.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u767C\u9001\u6D88\u606F\u7684\u5BA2\u6236");return}let t=e.map(n=>({telegramId:n.userId||String(n.id),username:n.username,firstName:n.firstName,lastName:n.lastName,displayName:n.firstName||n.username||"\u672A\u77E5",groupName:n.sourceGroup||"",keyword:n.triggeredKeyword||"",source:n.sourceType||""}));this.batchSendTargets.set(t),this.showBatchMessageDialogState.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${e.length} \u500B\u5BA2\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`)}openBatchInviteForLeads(){let e=this.leads().filter(n=>this.selectedLeadIds().has(n.id));if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u62C9\u7FA4\u7684\u5BA2\u6236");return}let t=e.map(n=>({telegramId:n.userId||String(n.id),username:n.username,firstName:n.firstName,displayName:n.firstName||n.username||"\u672A\u77E5"}));this.batchInviteTargets.set(t),this.showBatchInviteDialogState.set(!0),this.toastService.info(`\u{1F465} \u6E96\u5099\u5C07 ${e.length} \u500B\u5BA2\u6236\u62C9\u5165\u7FA4\u7D44`)}closeBatchInviteDialog(){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([])}handleBatchInviteComplete(e){this.showBatchInviteDialogState.set(!1),this.batchInviteTargets.set([]),this.toastService.success(`\u2705 \u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6210\u529F ${e.success}\uFF0C\u8DF3\u904E ${e.skipped}\uFF0C\u5931\u6557 ${e.failed}`)}openMemberExtractionDialog(e){let t={id:String(e.id),name:e.name||e.title||"\u672A\u77E5\u7FA4\u7D44",url:e.url||"",telegramId:e.telegramId||e.telegram_id||"",memberCount:e.memberCount||e.member_count||0,accountPhone:e.accountPhone,resourceType:e.resourceType||e.resource_type||"group"};this.memberExtractionGroup.set(t),this.showMemberExtractionDialog.set(!0)}closeMemberExtractionDialog(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null)}closeMemberExtractionDialogUnified(){this.showMemberExtractionDialog.set(!1),this.memberExtractionGroup.set(null),this.dialogService.closeMemberExtraction()}handleMemberCountRefreshed(e){console.log("[Frontend] Member count refreshed:",e);let t=this.memberExtractionGroup();t&&t.id===e.groupId&&this.memberExtractionGroup.set(B(F({},t),{memberCount:e.memberCount})),this.monitoredGroups.update(n=>n.map(o=>String(o.id)===e.groupId?B(F({},o),{memberCount:e.memberCount,member_count:e.memberCount}):o))}handleMemberExtractionStart(e){if(this.showMemberExtractionDialog.set(!1),this.monitoringGroupsRef)this.monitoringGroupsRef.executeExtraction({limit:e.config.limit,filters:e.config.filters,advanced:e.config.advanced});else{let t=e.group,n="";if(t.url){let o=t.url.match(/t\.me\/([+\w]+)/);o&&(n=o[1])}this.ipcService.send("extract-members",{chatId:n||t.url,username:n,telegramId:t.telegramId,resourceId:t.id,groupName:t.name,phone:e.config.accountPhone||t.accountPhone||null,limit:e.config.limit===-1?void 0:e.config.limit,filters:{bots:!e.config.filters.excludeBots,onlineStatus:e.config.filters.onlineStatus,offline:e.config.filters.onlineStatus==="offline",online:e.config.filters.onlineStatus==="online",chinese:e.config.filters.hasChinese,hasUsername:e.config.filters.hasUsername,isPremium:e.config.filters.isPremium,excludeAdmins:e.config.filters.excludeAdmins},autoSave:e.config.advanced.autoSaveToResources,skipDuplicates:e.config.advanced.skipDuplicates}),this.toastService.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${t.name} \u7684\u6210\u54E1...`)}}handleMonitoringConfigAction(e){switch(e){case"goto-resource-center":this.currentView.set("resource-center");break;case"goto-accounts":this.currentView.set("monitoring-accounts");break;case"goto-keywords":this.currentView.set("keyword-sets");break;case"goto-templates":this.currentView.set("chat-templates");break;case"goto-triggers":this.currentView.set("trigger-rules");break;default:console.log("[Frontend] Unknown config action:",e)}}handleResourceSendToAISales(e){e.length!==0&&(this.ipcService.send("ai-team:add-targets",{targets:e.map(t=>({telegramId:t.telegram_id,username:t.username,displayName:t.display_name,sourceType:t.source_type}))}),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07 ${e.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165 AI \u92B7\u552E\u968A\u5217`))}handleResourceStatusChanged(e){if(!e.contacts.length)return;console.log("[Frontend] Syncing status change to leads:",e.contacts.length,"contacts, status:",e.status);let t=new Set(e.contacts.map(a=>a.telegram_id)),o={new:"New",contacted:"Contacted",interested:"Interested",negotiating:"Negotiating",converted:"Closed-Won",lost:"Closed-Lost",blocked:"Unsubscribed"}[e.status]||e.status;this.leads.update(a=>a.map(d=>t.has(String(d.userId))?B(F({},d),{status:o}):d)),this.ipcService.send("sync-resource-status-to-leads",{telegramIds:Array.from(t),status:o}),console.log("[Frontend] Status synced for",e.contacts.length,"contacts")}refreshLeadsData(){console.log("[Frontend] Refreshing leads data for resource center...");let e=this.leads();e.length>0&&(this.syncLeadsToResourceCenter(e),console.log("[Frontend] Synced current leads to resource center:",e.length)),this.leadsHasMore()&&!this.leadsLoading()?(this.loadRemainingLeads(),this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u66F4\u591A\u6578\u64DA... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3)):this.leadsLoading()?this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u4E2D... (\u7576\u524D ${e.length} / ${this.leadsTotal()} \u689D)`,2e3):this.toastService.success(`\u6578\u64DA\u5DF2\u540C\u6B65 (\u5171 ${e.length} \u689D)`)}handleCommandNavigation(e){if(!e.startsWith("action:")&&!e.startsWith("contact:")){this.currentView.set(e);return}if(e.startsWith("action:")){switch(e.replace("action:","")){case"send-message":this.toastService.info("\u8ACB\u5148\u9078\u64C7\u806F\u7E6B\u4EBA"),this.currentView.set("resource-center");break;case"extract-members":this.currentView.set("resource-center");break;case"search-groups":this.currentView.set("resource-center");break;case"start-monitor":this.startMonitoring();break;case"refresh":this.ipcService.send("get-initial-state"),this.toastService.success("\u6578\u64DA\u5DF2\u5237\u65B0");break;case"open-docs":window.open("https://docs.tg-matrix.com","_blank");break;case"show-shortcuts":this.toastService.info(`\u2318K \u6253\u958B\u547D\u4EE4\u9762\u677F
\u2318R \u5237\u65B0\u6578\u64DA
\u2318N \u6DFB\u52A0\u5E33\u865F`);break;case"open-feedback":this.toastService.info("\u8ACB\u767C\u9001\u90F5\u4EF6\u81F3 support@tg-matrix.com");break}return}if(e.startsWith("contact:")){let t=e.replace("contact:","");this.toastService.info(`\u6B63\u5728\u67E5\u770B\u806F\u7E6B\u4EBA ${t}`)}}handleMemberBatchSendMessage(e){if(e.length===0){this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");return}let t=e.filter(n=>n.username);if(t.length===0){this.toastService.warning("\u6240\u9078\u6210\u54E1\u90FD\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u6D88\u606F");return}t.length<e.length&&this.toastService.warning(`${e.length-t.length} \u500B\u6210\u54E1\u6C92\u6709\u7528\u6236\u540D\uFF0C\u5C07\u88AB\u8DF3\u904E`),this.batchMessageTargets=t.map(n=>({userId:n.user_id,username:n.username,firstName:n.first_name,lastName:n.last_name,displayName:`${n.first_name||""} ${n.last_name||""}`.trim()||n.username})),this.showBatchMessageDialog.set(!0),this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${t.length} \u500B\u6210\u54E1\u767C\u9001\u6D88\u606F`)}handleNavigate(e){console.log("[Frontend] Navigate to:",e),this.currentView.set(e)}handleAIStrategyStart(e){console.log("[Frontend] AI Strategy started:",e),this.ipcService.send("execute-ai-strategy",{strategy:e}),this.currentView.set("automation"),this.toastService.success(`\u{1F680} AI \u7B56\u7565\u5DF2\u555F\u52D5: ${e.industry}`)}handleAIStrategyHandover(e){console.log("[Frontend] Handover strategy to AI Team:",e),this.aiTeamIncomingStrategy.set(e),this.currentView.set("ai-team"),this.toastService.success(`\u{1F916} \u5DF2\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A: ${e.industry}`)}convertMemberToLead(e){return{id:parseInt(e.user_id)||Date.now(),userId:e.user_id,username:e.username,firstName:e.first_name,lastName:e.last_name,sourceGroup:e.source_chat_title,triggeredKeyword:"",timestamp:new Date(e.extracted_at||new Date),status:e.contacted?"Contacted":"New",onlineStatus:this.mapOnlineStatus(e.online_status),interactionHistory:[],doNotContact:!1,intentScore:this.mapValueLevelToScore(e.value_level),intentLevel:this.mapValueLevelToIntent(e.value_level),sourceType:"group_extract"}}mapOnlineStatus(e){switch(e){case"online":return"Online";case"recently":return"Recently";default:return"Offline"}}mapValueLevelToScore(e){switch(e){case"S":return 90;case"A":return 75;case"B":return 55;case"C":return 35;case"D":return 15;default:return 30}}mapValueLevelToIntent(e){switch(e){case"S":return"HOT";case"A":return"WARM";case"B":return"NEUTRAL";case"C":return"COLD";case"D":return"NONE";default:return"NEUTRAL"}}log(e,t){let n={id:Date.now(),timestamp:new Date,message:e,type:t};this.logs.update(o=>[n,...o].slice(0,100))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=ee({type:i,selectors:[["app-root"]],viewQuery:function(t,n){if(t&1&&Qn(yE,5)(SE,5),t&2){let o;Mn(o=Tn())&&(n.onboardingComponent=o.first),Mn(o=Tn())&&(n.monitoringGroupsRef=o.first)}},hostBindings:function(t,n){t&1&&x("click",function(a){return n.onDocumentClick(a)},qt)},features:[pa([$n,ue])],decls:19,vars:11,consts:[["onboardingRef",""],[1,"fixed","bottom-4","right-4","z-50"],[1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","pointer-events-none"],[3,"navigate"],[3,"closeDialog","sendComplete","isOpen","targets"],[3,"closeDialog","inviteComplete","isOpen","targets","accounts"],[3,"closeDialog","startExtractionEvent","memberCountRefreshed","isOpen","group"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"flex","h-screen",2,"background-color","var(--bg-primary)","color","var(--text-primary)"],[1,"auth-wrapper",2,"min-height","100vh","background","linear-gradient(to bottom right, #0f172a, #1e293b, #0f172a)"],[1,"group","relative"],[1,"w-3","h-3","rounded-full","bg-slate-500","cursor-default"],[1,"absolute","bottom-full","right-0","mb-2","hidden","group-hover:block"],[1,"bg-slate-800/95","backdrop-blur-sm","rounded-lg","px-3","py-2","shadow-lg","border","border-slate-700","whitespace-nowrap"],[1,"text-xs","text-slate-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-xs","text-amber-400","mt-1"],[1,"w-3","h-3","rounded-full","bg-cyan-500","animate-pulse","cursor-default"],[1,"text-xs","text-slate-300"],[1,"w-3","h-3","rounded-full","bg-amber-500","cursor-pointer",3,"click"],[1,"text-xs","text-amber-400"],[1,"w-3","h-3","rounded-full","bg-red-500","cursor-pointer","animate-pulse",3,"click"],[1,"text-xs","text-red-400"],[1,"absolute","inset-0","bg-black/40","animate-fade-in"],[1,"relative","z-10","animate-success-pop"],[1,"absolute","inset-0","-m-8","rounded-full","bg-gradient-to-r","from-emerald-500/20","to-cyan-500/20","blur-xl","animate-pulse"],[1,"relative","bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","p-8","shadow-2xl","border","border-emerald-500/30"],[1,"flex","justify-center","mb-4"],[1,"w-20","h-20","rounded-full","bg-gradient-to-r","from-emerald-500","to-cyan-500","flex","items-center","justify-center","shadow-lg","shadow-emerald-500/30"],[1,"text-4xl","animate-bounce"],[1,"text-center"],[1,"text-xl","font-bold","text-white","mb-1"],[1,"text-sm","text-slate-400"],[1,"absolute","-top-2","-left-2","w-4","h-4","bg-emerald-400","rounded-full","animate-ping"],[1,"absolute","-top-1","-right-3","w-3","h-3","bg-cyan-400","rounded-full","animate-ping",2,"animation-delay","0.1s"],[1,"absolute","-bottom-2","-left-1","w-2","h-2","bg-emerald-300","rounded-full","animate-ping",2,"animation-delay","0.2s"],[1,"absolute","-bottom-1","-right-2","w-3","h-3","bg-cyan-300","rounded-full","animate-ping",2,"animation-delay","0.3s"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm",3,"click"],[1,"relative","z-10"],[3,"closed","loginSuccess"],[3,"navigateEvent"],[3,"show","title","progress","cancellable"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center"],["aria-controls","mobile-sidebar",1,"fixed","top-3","left-3","z-[9999]","w-10","h-10","rounded-lg","flex","items-center","justify-center","transition-all","duration-200",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 12px rgba(6, 182, 212, 0.5)"],[1,"fixed","inset-0","bg-black/50","z-[998]","backdrop-blur-sm","transition-opacity"],["id","mobile-sidebar","role","navigation","aria-label","\u4E3B\u5C0E\u822A",1,"backdrop-blur-sm","flex-shrink-0","flex","flex-col","sidebar","h-screen","transition-all","duration-300",2,"background-color","var(--bg-sidebar)","border-right","1px solid var(--border-default)"],[1,"flex-shrink-0"],[1,"absolute","top-3","-right-3","z-50","w-6","h-6","rounded-full","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 8px rgba(6, 182, 212, 0.4)",3,"title"],[1,"flex","items-center","gap-3","p-4"],[1,"relative","flex-shrink-0"],[1,"absolute","inset-0","rounded-xl","blur-md","opacity-50",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)"],["viewBox","0 0 64 64","fill","none",1,"h-10","w-10","relative","z-10"],["d","M32 8L52 20V44L32 56L12 44V20L32 8Z","fill","url(#sidebarLogoGrad)","stroke","url(#sidebarLogoStroke)","stroke-width","1.5"],["d","M22 28L40 22L34 36L28 32L22 28Z","fill","white","opacity","0.95"],["d","M28 32L34 36L32 42L28 32Z","fill","white","opacity","0.8"],["d","M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z","fill","#fbbf24"],["cx","32","cy","8","r","1.2","fill","#fef3c7"],["id","sidebarLogoGrad","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#0891b2"],["offset","100%","stop-color","#7c3aed"],["id","sidebarLogoStroke","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%","stop-color","#22d3ee"],["offset","100%","stop-color","#a78bfa"],[1,"px-3","mb-2","flex","justify-end"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","level-bronze"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","cursor-pointer","transition-all","duration-300","hover:scale-[1.02]","group",3,"level-bronze","level-silver","level-gold","level-diamond","level-star","level-king"],[1,"flex-1","overflow-y-auto","overflow-x-hidden","sidebar-nav","mt-2","px-2","pb-2"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","sidebar-icon"],["points","12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"],["x","1","y","4","width","22","height","16","rx","2","ry","2"],["x1","1","y1","10","x2","23","y2","10"],["x","3","y","3","width","7","height","7"],["x","14","y","3","width","7","height","7"],["x","14","y","14","width","7","height","7"],["x","3","y","14","width","7","height","7"],[1,"sidebar-group"],[1,"w-full","flex","items-center","justify-between","px-3","py-2","mt-2","rounded-md","hover:bg-white/5","transition-colors","cursor-pointer","group",3,"click"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","transition-transform","duration-200",2,"color","var(--sidebar-group-title)"],["points","6 9 12 15 18 9"],[1,"sidebar-group-content","overflow-hidden"],[1,"sidebar-group-title","text-xs","uppercase","tracking-wider","font-semibold","flex","items-center","gap-1",2,"color","var(--sidebar-group-title)"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-cyan-500","to-blue-500","text-center","leading-5","text-[10px]"],[1,"inline-block","w-5","h-5","rounded","bg-gradient-to-br","from-violet-500","to-fuchsia-500","text-center","leading-5","text-[10px]"],[1,"flex-shrink-0","p-4","space-y-3","border-t",2,"border-color","var(--border-default)","background-color","var(--bg-sidebar)"],[1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2.5","bg-gradient-to-r","from-cyan-500/10","to-blue-500/10","hover:from-cyan-500/20","hover:to-blue-500/20","border","border-cyan-500/30","hover:border-cyan-500/50","text-cyan-400","rounded-xl","transition-all","text-sm","font-medium","group",3,"click"],[1,"text-lg","group-hover:animate-bounce"],[1,"block","text-sm","font-medium","mb-2",2,"color","var(--sidebar-group-title)"],[1,"flex","rounded-md","shadow-sm","p-1",2,"background-color","var(--bg-tertiary)"],[1,"w-full","text-sm","py-1.5","rounded","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"],["role","main","aria-label","\u4E3B\u8981\u5167\u5BB9",1,"flex-1","p-8","overflow-y-auto",2,"background-color","var(--bg-primary)"],[1,"h-full","p-6","overflow-auto"],[1,"h-full","overflow-auto"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","backdrop-blur-sm"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","z-[100]","flex","items-center","justify-center",3,"click"],[1,"bg-slate-900","border","border-slate-700","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden",3,"click"],[1,"px-6","py-4","border-b","border-slate-700","flex","items-center","gap-3"],[1,"p-2","bg-red-500/20","rounded-lg"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-6","w-6","text-red-400"],["d","M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],[1,"text-lg","font-bold","text-white"],[1,"px-6","py-6"],[1,"text-slate-300","mb-4"],[1,"bg-red-500/10","border","border-red-500/20","rounded-lg","p-3","text-sm","text-red-300"],[1,"px-6","py-4","border-t","border-slate-700","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-red-500","hover:bg-red-600","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],[1,"font-bold","text-cyan-400"],[1,"font-bold","text-red-400"],[1,"p-2","bg-emerald-500/20","rounded-lg"],[1,"text-xl"],[1,"px-6","py-4","max-h-64","overflow-y-auto"],[1,"text-center","py-8","text-slate-400"],[1,"space-y-2"],[1,"px-6","py-4","border-t","border-slate-700"],[1,"w-full","py-2","bg-slate-700","hover:bg-slate-600","text-slate-300","rounded-lg","transition-colors",3,"click"],[1,"mb-2"],[1,"text-cyan-400","hover:underline","text-sm",3,"click"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group"],[1,"w-full","p-3","bg-slate-800/50","hover:bg-emerald-500/20","border","border-slate-700","hover:border-emerald-500/50","rounded-xl","text-left","transition-all","group",3,"click"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-white","group-hover:text-emerald-400"],[1,"text-xs","text-slate-500"],[1,"text-emerald-400","opacity-0","group-hover:opacity-100","transition-opacity"],["aria-controls","mobile-sidebar",1,"fixed","top-3","left-3","z-[9999]","w-10","h-10","rounded-lg","flex","items-center","justify-center","transition-all","duration-200",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 12px rgba(6, 182, 212, 0.5)",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5","text-white"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],["x1","3","y1","6","x2","21","y2","6"],["x1","3","y1","12","x2","21","y2","12"],["x1","3","y1","18","x2","21","y2","18"],[1,"fixed","inset-0","bg-black/50","z-[998]","backdrop-blur-sm","transition-opacity",3,"click"],[1,"absolute","top-3","-right-3","z-50","w-6","h-6","rounded-full","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",2,"background","linear-gradient(135deg, #06b6d4, #8b5cf6)","box-shadow","0 2px 8px rgba(6, 182, 212, 0.4)",3,"click","title"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5","text-white","transition-transform","duration-200"],["points","15 18 9 12 15 6"],[1,"text-xl","font-bold","bg-gradient-to-r","from-cyan-400","to-purple-400","bg-clip-text","text-transparent"],[1,"text-xs",2,"color","var(--text-muted)"],[1,"flex","items-center","gap-3","animate-pulse"],[1,"w-12","h-12","rounded-full","bg-slate-600/40"],[1,"flex-1","min-w-0"],[1,"h-4","w-20","bg-slate-600/40","rounded","mb-2"],[1,"h-3","w-14","bg-slate-600/30","rounded"],[1,"user-profile-card","mx-3","mb-4","p-3","rounded-xl","cursor-pointer","transition-all","duration-300","hover:scale-[1.02]","group",3,"click"],[1,"flex","items-center","gap-3"],[1,"avatar-wrapper","relative"],[1,"avatar-glow","absolute","inset-0","rounded-full","opacity-0","group-hover:opacity-100","transition-opacity","duration-300"],[1,"avatar-border","w-12","h-12","rounded-full","p-[2px]"],[1,"w-full","h-full","rounded-full","flex","items-center","justify-center","text-white","font-bold","text-lg","avatar-inner"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg",3,"badge-silver","badge-gold","badge-diamond","badge-star","badge-king"],[1,"text-sm","font-semibold","truncate",2,"color","var(--text-primary)"],[1,"flex","items-center","gap-1.5","mt-0.5"],["size","sm",3,"level"],[1,"arrow-icon","transition-transform","duration-300","group-hover:translate-x-1"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4",2,"color","var(--text-muted)"],["points","9 18 15 12 9 6"],[1,"vip-badge","absolute","-bottom-1","-right-1","w-5","h-5","rounded-full","flex","items-center","justify-center","text-[10px]","shadow-lg"],[1,"animate-pulse"],[1,"animate-bounce"],["data-tour","accounts",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],["d","M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"],["cx","9","cy","7","r","4"],["d","M23 21v-2a4 4 0 0 0-3-3.87"],["d","M16 3.13a4 4 0 0 1 0 7.75"],["data-tour","search-discovery",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","11","cy","11","r","8"],["d","M21 21l-4.35-4.35"],[1,"absolute","right-2","px-1.5","py-0.5","text-[10px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1","relative",3,"click"],["cx","12","cy","5","rx","9","ry","3"],["d","M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"],["d","M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"],["d","M22 2L11 13"],["d","M22 2L15 22L11 13L2 9L22 2Z"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1","relative","group",3,"click"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","transition-all"],[1,"text-lg"],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-[10px]","opacity-60"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click"],[1,"text-lg","ml-1"],[1,"ml-auto","text-xs","px-1.5","py-0.5","bg-violet-500/20","text-violet-400","rounded"],["data-tour","ai-assistant",1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-orange-500","to-amber-500","text-white","rounded-full","font-bold","shadow-lg","shadow-orange-500/20"],[1,"absolute","right-2","text-xs"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-lg","transition-all","duration-200","cursor-pointer","mb-1.5","relative","group",3,"click","title"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-purple-500","to-pink-500","text-white","rounded-full","font-bold","shadow-lg","shadow-purple-500/20"],[1,"absolute","right-2","px-2","py-0.5","text-[9px]","bg-gradient-to-r","from-cyan-500","to-blue-500","text-white","rounded-full","font-bold","shadow-lg","shadow-cyan-500/20"],["d","M18 20V10"],["d","M12 20V4"],["d","M6 20v-6"],["d","M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"],["cx","12","cy","12","r","4"],[1,"ml-auto","px-1.5","py-0.5","text-xs","bg-pink-500/20","text-pink-400","rounded"],[1,"sidebar-item","flex","items-center","gap-3","px-3","py-2.5","rounded-md","transition-all","duration-200","cursor-pointer","mb-1",3,"click","title"],[1,"ml-auto","text-xs","opacity-60"],[1,"knowledge-menu"],[1,"flex-1"],[1,"text-xs","transition-transform","duration-200"],[1,"pl-6","space-y-1"],["d","M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"],[1,"sidebar-item","flex","items-center","gap-2","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","text-sm",3,"click"],[1,"sidebar-item","flex","items-center","gap-2","px-3","py-2","rounded-md","transition-all","duration-200","cursor-pointer","text-sm","relative",3,"click"],[1,"ml-auto","text-xs","font-bold","rounded-full","px-1.5","py-0.5",2,"background-color","rgba(239, 68, 68, 0.2)","color","#f87171"],["cx","12","cy","12","r","3"],["d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"],[3,"accountAdded","back","switchToAdvanced"],[3,"accountAdded","back"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-gradient-to-br","from-slate-900","via-slate-900","to-slate-800","border","border-cyan-500/30","rounded-2xl","shadow-2xl","shadow-cyan-500/10","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","text-slate-200",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/10","via-blue-500/10","to-purple-500/10","border-b","border-cyan-500/20","p-5"],[1,"flex","justify-between","items-start"],[1,"flex","items-center","gap-4"],[1,"w-14","h-14","rounded-full","bg-gradient-to-br","from-cyan-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold","text-xl","shadow-lg","shadow-cyan-500/30"],[1,"flex","items-center","gap-2"],[1,"text-xl","font-bold","text-white"],[1,"h-2.5","w-2.5","rounded-full","animate-pulse"],[1,"text-sm","text-cyan-400"],[1,"flex","items-center","gap-2","mt-1","flex-wrap"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-purple-500/20","text-purple-400","border","border-purple-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-cyan-500/20","text-cyan-400","border","border-cyan-500/30"],[1,"text-xs","px-2","py-0.5","rounded-full",3,"class"],[1,"text-slate-400","hover:text-white","text-2xl","leading-none","transition-colors","p-2","hover:bg-white/10","rounded-lg",3,"click"],[1,"border-b","border-cyan-500/20","bg-slate-900/50"],["aria-label","Tabs",1,"flex","px-5"],[1,"whitespace-nowrap","py-3","px-4","border-b-2","border-transparent","font-medium","text-sm","cursor-pointer","text-slate-400","hover:text-cyan-400","hover:bg-cyan-500/5","transition-all","rounded-t-lg","flex","items-center","gap-2",3,"click"],[1,"overflow-y-auto","max-h-[calc(90vh-220px)]","p-5"],[1,"space-y-4"],[1,"py-4"],[1,"text-xs","px-2","py-0.5","rounded-full"],[1,"bg-slate-800/50","rounded-xl","p-4","border","border-slate-700/50"],[1,"block","text-sm","font-medium","text-cyan-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","focus:border-cyan-500",3,"ngModelChange","ngModel"],["value",""],[1,"mt-2","p-2","bg-amber-500/10","border","border-amber-500/30","rounded-lg"],[1,"grid","grid-cols-3","gap-3"],[1,"cursor-pointer","p-3","rounded-xl","border-2","transition-all","text-center",3,"click"],[1,"text-2xl","mb-1"],[1,"text-sm","font-medium"],[1,"space-y-3"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-cyan-400"],[1,"text-xs","text-slate-500","bg-slate-700/50","px-2","py-1","rounded"],["rows","5",1,"form-textarea","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-3","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500","resize-none","placeholder-slate-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","gap-3","flex-wrap"],[1,"flex","items-center","gap-2","bg-slate-800/50","hover:bg-cyan-500/20","text-slate-300","hover:text-cyan-400","text-sm","font-medium","py-2","px-4","rounded-lg","transition-all","border","border-slate-700/50","hover:border-cyan-500/30",3,"click"],[1,"p-3","rounded-xl","bg-cyan-500/10","border","border-cyan-500/30"],[1,"p-3","bg-amber-500/10","border","border-amber-500/30","rounded-xl"],[1,"p-3","bg-red-500/10","border","border-red-500/30","rounded-xl"],[1,"flex","justify-between","items-center","pt-4","border-t","border-cyan-500/20"],[1,"text-sm","text-red-400","hover:text-red-300","disabled:text-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-1.5","px-3","py-2","rounded-lg","hover:bg-red-500/10","transition-all",3,"click","disabled"],[1,"flex","gap-3"],[1,"bg-slate-700/80","hover:bg-slate-600","text-slate-300","font-medium","py-2.5","px-5","rounded-xl","transition-all","border","border-slate-600/50","hover:border-slate-500",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","to-blue-500","hover:from-cyan-400","hover:to-blue-400","text-white","font-bold","py-2.5","px-6","rounded-xl","shadow-lg","shadow-cyan-500/30","disabled:from-slate-500","disabled:to-slate-600","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2","transition-all",3,"click","disabled"],[3,"value"],[1,"text-xs","text-cyan-400","hover:underline","cursor-pointer","mt-1","inline-block",3,"click"],[1,"flex","items-center","justify-between","p-2","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg"],[1,"text-xs","text-green-400"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-2","py-1","rounded"],[1,"p-2","bg-cyan-500/10","border","border-cyan-500/20","rounded-lg","text-xs","text-slate-400"],[1,"block","text-sm","font-medium","text-slate-500","dark:text-slate-400","mb-1"],["rows","2",1,"form-textarea","w-full","bg-slate-200/50","dark:bg-slate-800/50","border-slate-300","dark:border-slate-700","rounded-lg","py-2","px-3","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-center","justify-center","gap-3"],[1,"bg-gradient-to-r","from-purple-500","to-cyan-500","hover:from-purple-600","hover:to-cyan-600","text-white","font-bold","py-2","px-6","rounded-lg","transition","duration-200","shadow-lg","disabled:from-slate-400","disabled:to-slate-500","disabled:shadow-none","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg"],[1,"p-3","bg-amber-500/10","border","border-amber-500/20","text-amber-400","rounded-lg","text-sm","text-center"],[1,"p-3","bg-red-500/10","border","border-red-500/20","text-red-400","rounded-lg","text-sm"],[1,"p-3","bg-green-500/10","border","border-green-500/20","rounded-lg"],[1,"text-cyan-400"],[1,"animate-spin"],["title","\u91CD\u65B0\u751F\u6210",1,"p-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg",3,"click"],[1,"text-cyan-400","hover:underline","cursor-pointer","ml-1",3,"click"],[1,"ml-2","text-cyan-400","hover:underline",3,"click"],[1,"text-xs","text-green-400","mb-2"],[1,"form-select","w-full","bg-slate-900/50","border-cyan-500/30","rounded-lg","py-2.5","px-3","text-white","focus:outline-none","focus:ring-2","focus:ring-cyan-500",3,"change"],[1,"flex","items-center","gap-2","bg-green-500/20","hover:bg-green-500/30","text-green-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-green-500/30",3,"click"],[1,"flex","items-center","gap-2","bg-red-500/20","hover:bg-red-500/30","text-red-400","text-sm","font-medium","py-2","px-3","rounded-lg","transition-all","border","border-red-500/30",3,"click"],[1,"text-sm","text-cyan-400","font-medium"],[1,"space-y-2","max-h-40","overflow-y-auto"],[1,"flex","items-center","justify-between","text-sm","bg-slate-800/50","rounded-lg","px-3","py-2"],[1,"flex","items-center","gap-2","truncate","flex-1","min-w-0"],[1,"text-green-400"],[1,"text-blue-400"],[1,"truncate","text-white"],[1,"text-slate-500","text-xs","whitespace-nowrap"],[1,"text-green-500","text-xs"],[1,"text-red-400","hover:text-red-300","text-lg","font-bold","p-1","hover:bg-red-500/20","rounded","ml-2",3,"click"],[1,"text-sm","text-amber-400"],[1,"text-sm","text-red-400"],[1,"mb-4","flex","items-center","justify-between"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","font-bold","py-2","px-4","rounded-lg","text-sm","disabled:bg-slate-500","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4"],[1,"h-96","overflow-y-auto"],[1,"space-y-3","mb-4"],[1,"text-center","py-8"],[1,"mt-4","p-3","bg-slate-800/50","rounded-lg","border","border-cyan-500/20"],[1,"h-96","overflow-y-auto","space-y-3","mb-4","bg-slate-200/30","dark:bg-slate-800/30","rounded-lg","p-4",3,"scroll"],[1,"text-center","py-4"],[1,"text-center","py-2"],[1,"flex","justify-start"],[1,"flex","justify-end"],[1,"max-w-[75%]"],[1,"bg-slate-700","text-white","rounded-2xl","rounded-bl-sm","px-4","py-2"],[1,"text-sm"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","rounded-2xl","rounded-br-sm","px-4","py-2","shadow-lg"],[1,"flex","items-center","justify-end","gap-2","mt-1"],[1,"text-xs","bg-purple-500/20","text-purple-400","px-1.5","py-0.5","rounded"],[1,"animate-spin","text-cyan-400"],[1,"ml-2","text-sm","text-slate-500"],[1,"text-sm","text-cyan-400","hover:text-cyan-300",3,"click"],[1,"flex","justify-center"],[1,"bg-slate-800/50","text-slate-400","text-xs","px-3","py-1","rounded-full"],[1,"text-4xl","mb-2"],[1,"text-slate-500","dark:text-slate-400"],[1,"text-xs","text-slate-500","mt-2"],[1,"text-sm","font-medium","text-cyan-400","mb-2","flex","items-center","gap-2"],[1,"grid","grid-cols-3","gap-2","text-center","text-xs"],[1,"p-2","bg-slate-700/50","rounded"],[1,"text-slate-400"],[1,"text-sm","font-bold","text-cyan-400"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","backdrop-blur-sm",3,"click"],[1,"bg-slate-100","dark:bg-slate-900","rounded-2xl","shadow-2xl","border","border-slate-300","dark:border-slate-700","w-full","max-w-3xl","max-h-[80vh]","overflow-hidden",3,"click"],[1,"p-4","border-b","border-slate-300","dark:border-slate-700","flex","items-center","justify-between","bg-slate-200/50","dark:bg-slate-800/50"],[1,"text-lg","font-bold","text-slate-900","dark:text-white","flex","items-center","gap-2"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-purple-500"],["d","M3 3v5h5"],["d","M3.05 13A9 9 0 1 0 6 5.3L3 8"],["d","M12 7v5l4 2"],[1,"text-slate-500","hover:text-slate-700","dark:text-slate-400","dark:hover:text-white",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],[1,"p-4","overflow-y-auto","max-h-[60vh]"],[1,"text-center","py-8","text-slate-500"],[1,"p-4","border-t","border-slate-300","dark:border-slate-700","bg-slate-200/50","dark:bg-slate-800/50","flex","justify-end"],[1,"px-4","py-2","bg-slate-300","dark:bg-slate-700","hover:bg-slate-400","dark:hover:bg-slate-600","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"h-12","w-12","mx-auto","mb-3","text-slate-400"],["cx","12","cy","12","r","10"],["d","M12 8v4l3 3"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700",3,"opacity-50"],[1,"bg-slate-200/50","dark:bg-slate-800/50","rounded-lg","p-3","border","border-slate-300","dark:border-slate-700"],[1,"p-2","rounded-lg"],[1,"font-medium","text-slate-900","dark:text-white"],[1,"text-yellow-500","ml-2"],[1,"text-red-400","ml-2"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded"],[1,"text-xs","bg-yellow-500/20","hover:bg-yellow-500/30","text-yellow-400","px-2","py-1","rounded",3,"click"],[1,"bg-gradient-to-br","from-slate-800","to-slate-900","rounded-2xl","shadow-2xl","w-full","max-w-2xl","mx-4","overflow-hidden","border","border-cyan-500/30"],[1,"bg-gradient-to-r","from-cyan-500","to-purple-500","p-6","text-center"],[1,"text-3xl","font-bold","text-white","mb-2"],[1,"text-cyan-100"],[1,"flex","justify-center","gap-2","py-4","bg-slate-800/50"],[1,"w-3","h-3","rounded-full","transition-all"],[1,"p-6"],[1,"text-center","space-y-6"],[1,"p-6","bg-slate-800/50","flex","justify-between","items-center"],[1,"text-sm","text-slate-400","hover:text-white","transition-colors",3,"click"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all"],[1,"grid","grid-cols-3","gap-4","mb-6"],[1,"p-4","bg-slate-700/50","rounded-xl"],[1,"text-3xl","mb-2"],[1,"text-sm","font-medium","text-white"],[1,"text-slate-300"],[1,"text-lg","font-semibold","text-white","text-center","mb-4"],[1,"p-4","rounded-xl"],[1,"text-2xl"],[1,"font-medium","text-white"],[1,"px-3","py-1","bg-slate-700","hover:bg-slate-600","rounded","text-sm","text-white","disabled:opacity-50",3,"click","disabled"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModel"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],["placeholder","qwen2:7b",1,"w-full","bg-slate-800","border","border-slate-600","rounded-lg","py-2","px-3","text-white",3,"ngModelChange","ngModel"],[1,"text-sm","text-slate-300","space-y-2"],[1,"block","bg-slate-800","p-2","rounded","text-cyan-400","text-xs"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-cyan-500","rounded",3,"change","checked"],[1,"text-sm","text-slate-300"],[1,"mt-2"],[1,"w-full","bg-slate-800","border","border-slate-600","rounded","py-1","px-2","text-sm","text-white",3,"ngModelChange","ngModel"],["value","gemini"],["value","openai"],[1,"text-6xl","mb-4"],[1,"text-2xl","font-bold","text-white"],[1,"p-4","bg-cyan-500/10","rounded-xl","border","border-cyan-500/30"],[1,"text-sm","text-slate-300","space-y-1"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-cyan-500","to-purple-500","hover:from-cyan-600","hover:to-purple-600","text-white","font-medium","rounded-lg","transition-all",3,"click"],[1,"px-6","py-2","bg-gradient-to-r","from-green-500","to-emerald-500","hover:from-green-600","hover:to-emerald-600","text-white","font-medium","rounded-lg","transition-all",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-amber-500/50"],[1,"bg-amber-500/20","p-6","text-center","border-b","border-amber-500/30"],[1,"text-5xl","mb-3"],[1,"text-xl","font-bold","text-amber-400"],[1,"text-slate-400","text-sm","mt-2"],[1,"p-6","space-y-4"],[1,"text-slate-300","text-sm"],[1,"bg-slate-700/50","rounded-lg","p-3","max-h-48","overflow-y-auto","space-y-2"],[1,"flex","items-center","justify-between","p-2","bg-slate-600/50","rounded-lg"],[1,"bg-blue-500/10","border","border-blue-500/30","rounded-lg","p-3"],[1,"text-blue-400","text-sm"],[1,"p-4","bg-slate-700/30","flex","justify-end","gap-3"],[1,"px-4","py-2","bg-slate-600","hover:bg-slate-500","text-white","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-amber-500","hover:bg-amber-600","disabled:opacity-50","text-white","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click","disabled"],[1,"text-white","font-medium"],[1,"text-green-400","text-xs"],[1,"text-amber-400","text-xs"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden","border","border-red-500/50"],[1,"bg-red-500/20","p-6","text-center","border-b","border-red-500/30"],[1,"text-xl","font-bold","text-red-400"],[1,"bg-slate-700/50","rounded-lg","p-4","space-y-3"],[1,"flex","items-start","gap-3"],["href","https://www.python.org/downloads/","target","_blank",1,"text-cyan-400","text-sm","hover:underline"],[1,"text-slate-400","text-sm"],[1,"block","bg-slate-800","text-green-400","text-sm","p-2","rounded","mt-1"],[1,"bg-red-500/10","border","border-red-500/30","rounded-lg","p-3"],[1,"text-red-400","text-sm"],[1,"fixed","bottom-4","right-4","z-50","bg-red-500/90","text-white","px-4","py-2","rounded-lg","shadow-lg","flex","items-center","gap-2","cursor-pointer","hover:bg-red-600",3,"click"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-[100]",3,"click"],[1,"bg-slate-800","rounded-2xl","shadow-2xl","w-full","max-w-md","mx-4","overflow-hidden","border","border-cyan-500/30",3,"click"],[1,"bg-gradient-to-r","from-cyan-500/20","to-blue-500/20","p-4","border-b","border-slate-700/50"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],[1,"block","text-sm","text-slate-400","mb-2"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u8CB7\u5BB6\u610F\u5411\u3001\u7522\u54C1\u8AEE\u8A62...","autofocus","",1,"w-full","bg-slate-900/50","border","border-slate-600","rounded-lg","px-4","py-3","text-white","focus:border-cyan-500","focus:ring-1","focus:ring-cyan-500","transition-colors",3,"input","keyup.enter","value"],[1,"px-4","py-2","bg-cyan-500","hover:bg-cyan-400","text-white","rounded-lg","transition-colors","font-medium",3,"click"]],template:function(t,n){t&1&&(k(0,"app-network-status")(1,"app-auth-transition")(2,"app-toast")(3,"app-global-confirm-dialog")(4,"app-global-input-dialog")(5,"app-alert-notification")(6,"app-offline-indicator"),S(7,PE,5,1,"div",1),S(8,NE,17,3,"div",2),r(9,"app-command-palette",3),x("navigate",function(a){return n.handleCommandNavigation(a)}),s(),r(10,"app-batch-send-dialog",4),x("closeDialog",function(){return n.dialogService.closeBatchSend()})("sendComplete",function(a){return n.handleBatchSendComplete(a)}),s(),r(11,"app-batch-invite-dialog",5),x("closeDialog",function(){return n.dialogService.closeBatchInvite()})("inviteComplete",function(a){return n.handleBatchInviteComplete(a)}),s(),r(12,"app-member-extraction-dialog",6),x("closeDialog",function(){return n.closeMemberExtractionDialogUnified()})("startExtractionEvent",function(a){return n.handleMemberExtractionStart(a)})("memberCountRefreshed",function(a){return n.handleMemberCountRefreshed(a)}),s(),k(13,"app-membership-dialog")(14,"app-payment")(15,"app-upgrade-prompt"),S(16,RE,4,0,"div",7),S(17,K4,174,94,"div",8)(18,W4,2,0,"div",9)),t&2&&(c(7),w(n.backendConnectionState()!=="connected"||!n.offlineCache.isOnline()?7:-1),c(),w(n.showSuccessOverlay()?8:-1),c(2),V("isOpen",n.dialogService.showBatchMessageDialog())("targets",n.dialogService.batchSendTargets()),c(),V("isOpen",n.dialogService.showBatchInviteDialog())("targets",n.dialogService.batchInviteTargets())("accounts",n.accounts()),c(),V("isOpen",n.dialogService.showMemberExtractionDialog()||n.showMemberExtractionDialog())("group",n.dialogService.memberExtractionGroup()||n.memberExtractionGroup()),c(4),w(n.showQrLoginDialog()?16:-1),c(),w(n.isAuthenticated()?17:18))},dependencies:[te,me,Qe,Ye,xe,lt,_e,Ce,xa,Ja,Qa,Ya,Xa,Za,el,tl,rl,sl,al,Fo,No,$o,zo,Ko,ja,Qo,Yo,Xo,qo,cl,dl,ul,ml,pl,gl,Zo,er,tr,nr,co,uo,go,ho,So,Ao,po,Vt,fo,_o,vo,ko,Io,Po,Ro,Bo,Vo,Lo,Go,Uo,fa],styles:['[_nghost-%COMP%]     .highlight-pulse{animation:_ngcontent-%COMP%_highlight-pulse 1.5s ease-in-out 2}@keyframes _ngcontent-%COMP%_highlight-pulse{0%,to{box-shadow:0 0 #06b6d400;border-color:inherit}50%{box-shadow:0 0 20px 5px #06b6d480;border-color:#06b6d4}}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_success-pop{0%{transform:scale(.5);opacity:0}50%{transform:scale(1.1)}to{transform:scale(1);opacity:1}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .3s ease-out forwards}.animate-success-pop[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_success-pop .5s cubic-bezier(.68,-.55,.265,1.55) forwards}[_nghost-%COMP%]     .page-content{animation:_ngcontent-%COMP%_page-fade-in .3s ease-out}@keyframes _ngcontent-%COMP%_page-fade-in{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}[_nghost-%COMP%]     .card-hover{transition:all .2s ease}[_nghost-%COMP%]     .card-hover:hover{transform:translateY(-2px);box-shadow:0 8px 25px -5px #0000004d}[_nghost-%COMP%]     .sidebar-item{position:relative;overflow:hidden}[_nghost-%COMP%]     .sidebar-item:before{content:"";position:absolute;left:0;top:50%;width:3px;height:0;background:linear-gradient(to bottom,#06b6d4,#8b5cf6);transition:height .2s ease;transform:translateY(-50%);border-radius:0 2px 2px 0}[_nghost-%COMP%]     .sidebar-item:hover:before, [_nghost-%COMP%]     .sidebar-item.active:before{height:60%}[_nghost-%COMP%]     .btn-ripple{position:relative;overflow:hidden}[_nghost-%COMP%]     .btn-ripple:after{content:"";position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none;background-image:radial-gradient(circle,#fff 10%,transparent 10.01%);background-repeat:no-repeat;background-position:50%;transform:scale(10);opacity:0;transition:transform .5s,opacity .5s}[_nghost-%COMP%]     .btn-ripple:active:after{transform:scale(0);opacity:.3;transition:0s}[_nghost-%COMP%]     .animate-number{animation:_ngcontent-%COMP%_number-pop .3s ease-out}@keyframes _ngcontent-%COMP%_number-pop{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}[_nghost-%COMP%]     .gradient-border{position:relative;background:linear-gradient(var(--card-bg),var(--card-bg)) padding-box,linear-gradient(135deg,#06b6d4,#8b5cf6) border-box;border:1px solid transparent}[_nghost-%COMP%]     .mobile-sidebar-hidden{position:fixed!important;left:0;top:0;bottom:0;z-index:999;transform:translate(-100%);width:16rem!important;transition:transform .3s cubic-bezier(.4,0,.2,1)}[_nghost-%COMP%]     .mobile-sidebar-visible{position:fixed!important;left:0;top:0;bottom:0;z-index:999;transform:translate(0);width:16rem!important;transition:transform .3s cubic-bezier(.4,0,.2,1)}@media(max-width:768px){[_nghost-%COMP%]     main.flex-1{padding:52px 16px 16px!important}}'],changeDetection:0})}};var J4={dashboard:{},accounts:{},settings:{},leads:{requiredFeature:"leadManagement",membershipLevel:"bronze",membershipMessage:"\u6F5B\u5728\u5BA2\u6236\u7BA1\u7406\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},automation:{requiredFeature:"automation",membershipLevel:"silver",membershipMessage:"\u81EA\u52D5\u5316\u4E2D\u5FC3\u9700\u8981\u767D\u9280\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"resource-discovery":{requiredFeature:"resourceDiscovery",membershipLevel:"bronze",membershipMessage:"\u8CC7\u6E90\u767C\u73FE\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"ai-center":{requiredFeature:"aiCenter",membershipLevel:"gold",membershipMessage:"AI \u4E2D\u5FC3\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},"multi-role":{requiredFeature:"multiRole",membershipLevel:"diamond",membershipMessage:"\u591A\u89D2\u8272\u5354\u4F5C\u9700\u8981\u947D\u77F3\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},analytics:{requiredFeature:"dataInsightsBasic",membershipLevel:"gold",membershipMessage:"\u6578\u64DA\u5206\u6790\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"},monitoring:{}},Id={free:0,bronze:1,silver:2,gold:3,diamond:4,star:5,king:6};function Q4(i,e){let t=Id[i]??0,n=Id[e]??0;return t>=n}var Lt=(i,e)=>{let t=O(Re),n=O(ue),o=O(It);if(t.level()==="king")return!0;let d=i.routeConfig?.path||"",m=J4[d];if(!m||!m.requiredFeature&&!m.membershipLevel)return!0;if(m.requiredFeature&&!t.hasFeature(m.requiredFeature))return n.warning(m.membershipMessage||"\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD"),o.navigate(["/dashboard"]),!1;if(m.membershipLevel){let f=t.membership()?.level||"free";if(!Q4(f,m.membershipLevel))return n.warning(m.membershipMessage||"\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD"),o.navigate(["/dashboard"]),!1}return!0};var Pd=[{path:"auth",loadChildren:()=>import("./chunk-CVOHENQP.js").then(i=>i.AUTH_ROUTES)},{path:"login",redirectTo:"auth/login",pathMatch:"full"},{path:"register",redirectTo:"auth/register",pathMatch:"full"},{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-HWXAHZAJ.js").then(i=>i.DashboardViewComponent),title:"\u5100\u8868\u677F",canActivate:[He]},{path:"accounts",loadComponent:()=>import("./chunk-TXJMLVXK.js").then(i=>i.AccountsViewComponent),title:"\u5E33\u865F\u7BA1\u7406",canActivate:[He]},{path:"settings",loadComponent:()=>import("./chunk-NF7RHFN6.js").then(i=>i.SettingsViewComponent),title:"\u8A2D\u5B9A",canActivate:[He]},{path:"user-settings",loadComponent:()=>import("./chunk-N5PHBHT7.js").then(i=>i.UserSettingsViewComponent),title:"\u7528\u6236\u8A2D\u7F6E",canActivate:[He]},{path:"upgrade",loadComponent:()=>import("./chunk-MEFGXS7J.js").then(i=>i.UpgradeViewComponent),title:"\u5347\u7D1A\u65B9\u6848",canActivate:[He]},{path:"quota",loadComponent:()=>import("./chunk-NLVP775N.js").then(i=>i.QuotaDashboardViewComponent),title:"\u914D\u984D\u7BA1\u7406",canActivate:[He]},{path:"billing",loadComponent:()=>import("./chunk-KKCPUECA.js").then(i=>i.BillingViewComponent),title:"\u8A08\u8CBB\u7BA1\u7406",canActivate:[He]},{path:"payment",loadComponent:()=>import("./chunk-SBDZV3M6.js").then(i=>i.PaymentViewComponent),title:"\u652F\u4ED8\u4E2D\u5FC3",canActivate:[He]},{path:"wallet/recharge",loadComponent:()=>import("./chunk-D74KODSH.js").then(i=>i.WalletRechargeComponent),title:"\u5145\u503C\u4E2D\u5FC3",canActivate:[He]},{path:"wallet/withdraw",loadComponent:()=>import("./chunk-46SMIMQS.js").then(i=>i.WalletWithdrawComponent),title:"\u63D0\u73FE",canActivate:[He]},{path:"wallet/transactions",loadComponent:()=>import("./chunk-XDGRWMFM.js").then(i=>i.WalletTransactionsComponent),title:"\u4EA4\u6613\u8A18\u9304",canActivate:[He]},{path:"wallet/orders",loadComponent:()=>import("./chunk-IETTDJXV.js").then(i=>i.WalletOrdersComponent),title:"\u5145\u503C\u8A02\u55AE",canActivate:[He]},{path:"wallet/analytics",loadComponent:()=>import("./chunk-EYF2X6ZR.js").then(i=>i.WalletAnalyticsComponent),title:"\u6D88\u8CBB\u5206\u6790",canActivate:[He]},{path:"wallet",pathMatch:"full",loadComponent:()=>import("./chunk-YNSM3W5L.js").then(i=>i.WalletViewComponent),title:"\u6211\u7684\u9322\u5305",canActivate:[He]},{path:"leads",loadComponent:()=>import("./chunk-AJO3NK2D.js").then(i=>i.LeadsViewComponent),title:"\u6F5B\u5728\u5BA2\u6236",canActivate:[Lt]},{path:"automation",loadComponent:()=>import("./chunk-O47OTFN5.js").then(i=>i.AutomationViewComponent),title:"\u81EA\u52D5\u5316\u4E2D\u5FC3",canActivate:[Lt]},{path:"resource-discovery",loadComponent:()=>import("./chunk-TYBEOFS7.js").then(i=>i.ResourceDiscoveryViewComponent),title:"\u8CC7\u6E90\u767C\u73FE",canActivate:[Lt]},{path:"marketing-hub",loadComponent:()=>import("./chunk-6TCWHDWI.js").then(i=>i.SmartMarketingViewComponent),title:"\u71DF\u92B7\u4EFB\u52D9\u4E2D\u5FC3",canActivate:[Lt]},{path:"role-library",loadComponent:()=>import("./chunk-WEJOZKBU.js").then(i=>i.MultiRoleViewComponent),title:"\u89D2\u8272\u8CC7\u6E90\u5EAB",canActivate:[Lt]},{path:"ai-engine",loadComponent:()=>import("./chunk-35UI73T2.js").then(i=>i.AiCenterViewComponent),title:"\u667A\u80FD\u5F15\u64CE",canActivate:[Lt]},{path:"ai-center",redirectTo:"ai-engine",pathMatch:"full"},{path:"multi-role",redirectTo:"role-library",pathMatch:"full"},{path:"smart-marketing",redirectTo:"marketing-hub",pathMatch:"full"},{path:"analytics",loadComponent:()=>import("./chunk-7V3UZJK3.js").then(i=>i.AnalyticsViewComponent),title:"\u6578\u64DA\u5206\u6790",canActivate:[Lt]},{path:"monitoring",loadComponent:()=>import("./chunk-P2DCGMO6.js").then(i=>i.MonitoringViewComponent),title:"\u76E3\u63A7\u4E2D\u5FC3"},{path:"performance",redirectTo:"settings",pathMatch:"full"},{path:"alerts",redirectTo:"settings",pathMatch:"full"},{path:"**",redirectTo:"dashboard"}],Y4={dashboard:"/dashboard",accounts:"/accounts",settings:"/settings",wallet:"/wallet","wallet-transactions":"/wallet/transactions","wallet-recharge":"/wallet/recharge","wallet-orders":"/wallet/orders","wallet-analytics":"/wallet/analytics","wallet-withdraw":"/wallet/withdraw","marketing-hub":"/marketing-hub","marketing-tasks":"/marketing-hub","marketing-monitor":"/marketing-hub","role-library":"/role-library","role-store":"/role-library","my-roles":"/role-library","scene-templates":"/role-library","script-editor":"/role-library","ai-engine":"/ai-engine","ai-models":"/ai-engine","ai-brain":"/ai-engine","ai-persona":"/ai-engine",automation:"/automation","monitoring-groups":"/monitoring","keyword-sets":"/monitoring","trigger-rules":"/monitoring","chat-templates":"/monitoring","collected-users":"/monitoring",leads:"/leads","lead-nurturing":"/leads","member-database":"/leads","user-tracking":"/leads",analytics:"/analytics","analytics-center":"/analytics","search-discovery":"/resource-discovery",monitoring:"/monitoring",performance:"/settings",alerts:"/settings","ai-center":"/ai-engine","multi-role":"/role-library","smart-marketing":"/marketing-hub"},M9=Object.entries(Y4).reduce((i,[e,t])=>(i[t]=e,i),{});console.log("[Bootstrap] index.tsx loaded, starting Angular bootstrap...");console.log("[Bootstrap] Angular imports completed");console.log("[Bootstrap] AppComponent and routes imported, calling bootstrapApplication...");Ca(ir,{providers:[ga(),va(),uc(),ya(Pd)]}).then(()=>{console.log("[TG-AI\u667A\u63A7\u738B] Application started successfully"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("angular-ready")),console.log("[TG-AI\u667A\u63A7\u738B] angular-ready event dispatched")},50)}).catch(i=>{console.error("[TG-AI\u667A\u63A7\u738B] Application failed to start:",i);let e=document.getElementById("app-loading"),t=document.getElementById("error-container"),n=document.getElementById("error-message"),o=document.getElementById("loading-status"),a=document.getElementById("loading-progress");o&&(o.textContent="\u8F09\u5165\u5931\u6557"),a&&(a.style.background="#ef4444",a.style.width="100%"),t&&(t.style.display="block"),n&&(n.textContent="\u932F\u8AA4: "+(i?.message||i))});
